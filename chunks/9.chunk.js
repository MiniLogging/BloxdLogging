/*! For license information please see 593js5.9.7eaea89f.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{10548:function(z,a){!function(z){"use strict";var a=function(z,K){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(z,a){z.__proto__=a}||function(z,a){for(var K in a)Object.prototype.hasOwnProperty.call(a,K)&&(z[K]=a[K])},a(z,K)};function K(z,K){if("function"!==typeof K&&null!==K)throw new TypeError("Class extends value "+String(K)+" is not a constructor or null");function v(){this.constructor=z}a(z,K),z.prototype=null===K?Object.create(K):(v.prototype=K.prototype,new v)}function v(z,a,K,v){var T,m=arguments.length,p=m<3?a:null===v?v=Object.getOwnPropertyDescriptor(a,K):v;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)p=Reflect.decorate(z,a,K,v);else for(var j=z.length-1;j>=0;j--)(T=z[j])&&(p=(m<3?T(p):m>3?T(a,K,p):T(a,K))||p);return m>3&&p&&Object.defineProperty(a,K,p),p}function T(z,a,K){if(K||2===arguments.length)for(var v,T=0,m=a.length;T<m;T++)!v&&T in a||(v||(v=Array.prototype.slice.call(a,0,T)),v[T]=a[T]);return z.concat(v||Array.prototype.slice.call(a))}var m,p=255,j=213;z.OPERATION=void 0,(m=z.OPERATION||(z.OPERATION={}))[m.ADD=128]="ADD",m[m.REPLACE=0]="REPLACE",m[m.DELETE=64]="DELETE",m[m.DELETE_AND_ADD=192]="DELETE_AND_ADD",m[m.TOUCH=1]="TOUCH",m[m.CLEAR=10]="CLEAR";var s=function(){function a(z,a,K){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=z,this.setParent(a,K)}return a.prototype.setParent=function(z,a,K){var v=this;if(this.indexes||(this.indexes=this.ref instanceof Pz?this.ref._definition.indexes:{}),this.parent=z,this.parentIndex=K,a)if(this.root=a,this.ref instanceof Pz){var T=this.ref._definition;for(var m in T.schema){var p=this.ref[m];if(p&&p.$changes){var j=T.indexes[m];p.$changes.setParent(this.ref,a,j)}}}else"object"===typeof this.ref&&this.ref.forEach((function(z,a){if(z instanceof Pz){var K=z.$changes,T=v.ref.$changes.indexes[a];K.setParent(v.ref,v.root,T)}}))},a.prototype.operation=function(z){this.changes.set(--this.currentCustomOperation,z)},a.prototype.change=function(a,K){void 0===K&&(K=z.OPERATION.ADD);var v="number"===typeof a?a:this.indexes[a];this.assertValidIndex(v,a);var T=this.changes.get(v);T&&T.op!==z.OPERATION.DELETE&&T.op!==z.OPERATION.TOUCH||this.changes.set(v,{op:T&&T.op===z.OPERATION.DELETE?z.OPERATION.DELETE_AND_ADD:K,index:v}),this.allChanges.add(v),this.changed=!0,this.touchParents()},a.prototype.touch=function(a){var K="number"===typeof a?a:this.indexes[a];this.assertValidIndex(K,a),this.changes.has(K)||this.changes.set(K,{op:z.OPERATION.TOUCH,index:K}),this.allChanges.add(K),this.touchParents()},a.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},a.prototype.getType=function(z){if(this.ref._definition)return(a=this.ref._definition).schema[a.fieldsByIndex[z]];var a,K=(a=this.parent._definition).schema[a.fieldsByIndex[this.parentIndex]];return Object.values(K)[0]},a.prototype.getChildrenFilter=function(){var z=this.parent._definition.childFilters;return z&&z[this.parentIndex]},a.prototype.getValue=function(z){return this.ref.getByIndex(z)},a.prototype.delete=function(a){var K="number"===typeof a?a:this.indexes[a];if(void 0!==K){var v=this.getValue(K);this.changes.set(K,{op:z.OPERATION.DELETE,index:K}),this.allChanges.delete(K),delete this.caches[K],v&&v.$changes&&(v.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(a," (").concat(K,")"))},a.prototype.discard=function(a,K){var v=this;void 0===a&&(a=!1),void 0===K&&(K=!1),this.ref instanceof Pz||this.changes.forEach((function(a){if(a.op===z.OPERATION.DELETE){var K=v.ref.getIndex(a.index);delete v.indexes[K]}})),this.changes.clear(),this.changed=a,K&&this.allChanges.clear(),this.currentCustomOperation=0},a.prototype.discardAll=function(){var z=this;this.changes.forEach((function(a){var K=z.getValue(a.index);K&&K.$changes&&K.$changes.discardAll()})),this.discard()},a.prototype.cache=function(z,a){this.caches[z]=a},a.prototype.clone=function(){return new a(this.ref,this.parent,this.root)},a.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},a.prototype.assertValidIndex=function(z,a){if(void 0===z)throw new Error('ChangeTree: missing index for field "'.concat(a,'"'))},a}();function M(z,a,K,v){return z[a]||(z[a]=[]),z[a].push(K),null===v||void 0===v||v.forEach((function(z,a){return K(z,a)})),function(){return W(z[a],z[a].indexOf(K))}}function r(a){var K=this,v="string"!==typeof this.$changes.getType();this.$items.forEach((function(T,m){a.push({refId:K.$changes.refId,op:z.OPERATION.DELETE,field:m,value:void 0,previousValue:T}),v&&K.$changes.root.removeRef(T.$changes.refId)}))}function W(z,a){if(-1===a||a>=z.length)return!1;for(var K=z.length-1,v=a;v<K;v++)z[v]=z[v+1];return z.length=K,!0}var F=function(z,a){var K=z.toString(),v=a.toString();return K<v?-1:K>v?1:0};function G(z){return z.$proxy=!0,z=new Proxy(z,{get:function(z,a){return"symbol"===typeof a||isNaN(a)?z[a]:z.at(a)},set:function(z,a,K){if("symbol"===typeof a||isNaN(a))z[a]=K;else{var v=Array.from(z.$items.keys()),T=parseInt(v[a]||a);void 0===K||null===K?z.deleteAt(T):z.setAt(T,K)}return!0},deleteProperty:function(z,a){return"number"===typeof a?z.deleteAt(a):delete z[a],!0}})}var l=function(){function a(){for(var z=[],a=0;a<arguments.length;a++)z[a]=arguments[a];this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,z)}return a.prototype.$c=function(a,K){return void 0===K&&(K=!0),M(this.$callbacks||(this.$callbacks=[]),z.OPERATION.ADD,a,K?this.$items:void 0)},a.prototype.bb=function(a){return M(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,a)},a.prototype.onChange=function(a){return M(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,a)},a.is=function(z){return Array.isArray(z)||void 0!==z.array},Object.defineProperty(a.prototype,"length",{get:function(){return this.$items.size},set:function(z){0===z?this.clear():this.splice(z,this.length-z)},enumerable:!1,configurable:!0}),a.prototype.push=function(){for(var z,a=this,K=[],v=0;v<arguments.length;v++)K[v]=arguments[v];return K.forEach((function(K){z=a.$refId++,a.setAt(z,K)})),z},a.prototype.pop=function(){var z=Array.from(this.$indexes.values()).pop();if(void 0!==z){this.$changes.delete(z),this.$indexes.delete(z);var a=this.$items.get(z);return this.$items.delete(z),a}},a.prototype.at=function(z){var a=Array.from(this.$items.keys())[z];return this.$items.get(a)},a.prototype.setAt=function(a,K){var v,T;if(void 0!==K&&null!==K){if(this.$items.get(a)!==K){void 0!==K.$changes&&K.$changes.setParent(this,this.$changes.root,a);var m=null!==(T=null===(v=this.$changes.indexes[a])||void 0===v?void 0:v.op)&&void 0!==T?T:z.OPERATION.ADD;this.$changes.indexes[a]=a,this.$indexes.set(a,a),this.$items.set(a,K),this.$changes.change(a,m)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},a.prototype.deleteAt=function(z){var a=Array.from(this.$items.keys())[z];return void 0!==a&&this.$deleteAt(a)},a.prototype.$deleteAt=function(z){return this.$changes.delete(z),this.$indexes.delete(z),this.$items.delete(z)},a.prototype.clear=function(a){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),a&&r.call(this,a),this.$items.clear(),this.$changes.operation({index:0,op:z.OPERATION.CLEAR}),this.$changes.touchParents()},a.prototype.concat=function(){for(var z,K=[],v=0;v<arguments.length;v++)K[v]=arguments[v];return new(a.bind.apply(a,T([void 0],(z=Array.from(this.$items.values())).concat.apply(z,K),!1)))},a.prototype.join=function(z){return Array.from(this.$items.values()).join(z)},a.prototype.reverse=function(){var z=this,a=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(K,v){z.setAt(a[v],K)})),this},a.prototype.shift=function(){var z=Array.from(this.$items.keys()).shift();if(void 0!==z){var a=this.$items.get(z);return this.$deleteAt(z),a}},a.prototype.slice=function(z,K){var v=new a;return v.push.apply(v,Array.from(this.$items.values()).slice(z,K)),v},a.prototype.sort=function(z){var a=this;void 0===z&&(z=F);var K=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(z).forEach((function(z,v){a.setAt(K[v],z)})),this},a.prototype.splice=function(z,a){void 0===a&&(a=this.length-z);for(var K=Array.from(this.$items.keys()),v=[],T=z;T<z+a;T++)v.push(this.$items.get(K[T])),this.$deleteAt(K[T]);return v},a.prototype.unshift=function(){for(var z=this,a=[],K=0;K<arguments.length;K++)a[K]=arguments[K];var v=this.length,T=a.length,m=Array.from(this.$items.values());return a.forEach((function(a,K){z.setAt(K,a)})),m.forEach((function(a,K){z.setAt(T+K,a)})),v+T},a.prototype.indexOf=function(z,a){return Array.from(this.$items.values()).indexOf(z,a)},a.prototype.lastIndexOf=function(z,a){return void 0===a&&(a=this.length-1),Array.from(this.$items.values()).lastIndexOf(z,a)},a.prototype.every=function(z,a){return Array.from(this.$items.values()).every(z,a)},a.prototype.some=function(z,a){return Array.from(this.$items.values()).some(z,a)},a.prototype.forEach=function(z,a){Array.from(this.$items.values()).forEach(z,a)},a.prototype.map=function(z,a){return Array.from(this.$items.values()).map(z,a)},a.prototype.filter=function(z,a){return Array.from(this.$items.values()).filter(z,a)},a.prototype.reduce=function(z,a){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},a.prototype.reduceRight=function(z,a){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},a.prototype.find=function(z,a){return Array.from(this.$items.values()).find(z,a)},a.prototype.findIndex=function(z,a){return Array.from(this.$items.values()).findIndex(z,a)},a.prototype.fill=function(z,a,K){throw new Error("ArraySchema#fill() not implemented")},a.prototype.copyWithin=function(z,a,K){throw new Error("ArraySchema#copyWithin() not implemented")},a.prototype.toString=function(){return this.$items.toString()},a.prototype.toLocaleString=function(){return this.$items.toLocaleString()},a.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(a,Symbol.species,{get:function(){return a},enumerable:!1,configurable:!0}),a.prototype.entries=function(){return this.$items.entries()},a.prototype.keys=function(){return this.$items.keys()},a.prototype.values=function(){return this.$items.values()},a.prototype.includes=function(z,a){return Array.from(this.$items.values()).includes(z,a)},a.prototype.flatMap=function(z,a){throw new Error("ArraySchema#flatMap() is not supported.")},a.prototype.flat=function(z){throw new Error("ArraySchema#flat() is not supported.")},a.prototype.findLast=function(){var z=Array.from(this.$items.values());return z.findLast.apply(z,arguments)},a.prototype.findLastIndex=function(){var z=Array.from(this.$items.values());return z.findLastIndex.apply(z,arguments)},a.prototype.setIndex=function(z,a){this.$indexes.set(z,a)},a.prototype.getIndex=function(z){return this.$indexes.get(z)},a.prototype.getByIndex=function(z){return this.$items.get(this.$indexes.get(z))},a.prototype.deleteByIndex=function(z){var a=this.$indexes.get(z);this.$items.delete(a),this.$indexes.delete(z)},a.prototype.toArray=function(){return Array.from(this.$items.values())},a.prototype.toJSON=function(){return this.toArray().map((function(z){return"function"===typeof z.toJSON?z.toJSON():z}))},a.prototype.clone=function(z){return z?new(a.bind.apply(a,T([void 0],Array.from(this.$items.values()),!1))):new(a.bind.apply(a,T([void 0],this.map((function(z){return z.$changes?z.clone():z})),!1)))},a}();function V(z){return z.$proxy=!0,z=new Proxy(z,{get:function(z,a){return"symbol"!==typeof a&&"undefined"===typeof z[a]?z.get(a):z[a]},set:function(z,a,K){return"symbol"!==typeof a&&-1===a.indexOf("$")&&"$c"!==a&&"bb"!==a&&"onChange"!==a?z.set(a,K):z[a]=K,!0},deleteProperty:function(z,a){return z.delete(a),!0}})}var c=function(){function a(z){var K=this;if(this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,z)if(z instanceof Map||z instanceof a)z.forEach((function(z,a){return K.set(a,z)}));else for(var v in z)this.set(v,z[v])}return a.prototype.$c=function(a,K){return void 0===K&&(K=!0),M(this.$callbacks||(this.$callbacks=[]),z.OPERATION.ADD,a,K?this.$items:void 0)},a.prototype.bb=function(a){return M(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,a)},a.prototype.onChange=function(a){return M(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,a)},a.is=function(z){return void 0!==z.map},a.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(a.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(a,Symbol.species,{get:function(){return a},enumerable:!1,configurable:!0}),a.prototype.set=function(a,K){if(void 0===K||null===K)throw new Error("MapSchema#set('".concat(a,"', ").concat(K,"): trying to set ").concat(K," value on '").concat(a,"'."));a=a.toString();var v="undefined"!==typeof this.$changes.indexes[a],T=v?this.$changes.indexes[a]:this.$refId++,m=v?z.OPERATION.REPLACE:z.OPERATION.ADD,p=void 0!==K.$changes;if(p&&K.$changes.setParent(this,this.$changes.root,T),v){if(!p&&this.$items.get(a)===K)return;p&&this.$items.get(a)!==K&&(m=z.OPERATION.ADD)}else this.$changes.indexes[a]=T,this.$indexes.set(T,a);return this.$items.set(a,K),this.$changes.change(a,m),this},a.prototype.get=function(z){return this.$items.get(z)},a.prototype.delete=function(z){return this.$changes.delete(z),this.$items.delete(z)},a.prototype.clear=function(a){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),a&&r.call(this,a),this.$items.clear(),this.$changes.operation({index:0,op:z.OPERATION.CLEAR}),this.$changes.touchParents()},a.prototype.has=function(z){return this.$items.has(z)},a.prototype.forEach=function(z){this.$items.forEach(z)},a.prototype.entries=function(){return this.$items.entries()},a.prototype.keys=function(){return this.$items.keys()},a.prototype.values=function(){return this.$items.values()},Object.defineProperty(a.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),a.prototype.setIndex=function(z,a){this.$indexes.set(z,a)},a.prototype.getIndex=function(z){return this.$indexes.get(z)},a.prototype.getByIndex=function(z){return this.$items.get(this.$indexes.get(z))},a.prototype.deleteByIndex=function(z){var a=this.$indexes.get(z);this.$items.delete(a),this.$indexes.delete(z)},a.prototype.toJSON=function(){var z={};return this.forEach((function(a,K){z[K]="function"===typeof a.toJSON?a.toJSON():a})),z},a.prototype.clone=function(z){var K;return z?K=Object.assign(new a,this):(K=new a,this.forEach((function(z,a){z.$changes?K.set(a,z.clone()):K.set(a,z)}))),K},a}(),C={};function w(z,a){C[z]=a}function H(z){return C[z]}var f=function(){function z(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return z.create=function(a){var K=new z;return K.schema=Object.assign({},a&&a.schema||{}),K.indexes=Object.assign({},a&&a.indexes||{}),K.fieldsByIndex=Object.assign({},a&&a.fieldsByIndex||{}),K.descriptors=Object.assign({},a&&a.descriptors||{}),K.deprecated=Object.assign({},a&&a.deprecated||{}),K},z.prototype.addField=function(z,a){var K=this.getNextFieldIndex();this.fieldsByIndex[K]=z,this.indexes[z]=K,this.schema[z]=Array.isArray(a)?{array:a[0]}:a},z.prototype.hasField=function(z){return void 0!==this.indexes[z]},z.prototype.addFilter=function(z,a){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[z]]=a,this.indexesWithFilters.push(this.indexes[z]),!0},z.prototype.addChildrenFilter=function(z,a){var K=this.indexes[z],v=this.schema[z];if(H(Object.keys(v)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[K]=a,!0;console.warn("@filterChildren: field '".concat(z,"' can't have children. Ignoring filter."))},z.prototype.getChildrenFilter=function(z){return this.childFilters&&this.childFilters[this.indexes[z]]},z.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},z}();function Y(z){return z._context&&z._context.useFilters}var I=function(){function z(){this.types={},this.schemas=new Map,this.useFilters=!1}return z.prototype.has=function(z){return this.schemas.has(z)},z.prototype.get=function(z){return this.types[z]},z.prototype.add=function(z,a){void 0===a&&(a=this.schemas.size),z._definition=f.create(z._definition),z._typeid=a,this.types[a]=z,this.schemas.set(z,a)},z.create=function(a){return void 0===a&&(a={}),function(K){return a.context||(a.context=new z),B(K,a)}},z}(),q=new I;function B(z,a){return void 0===a&&(a={}),function(K,v){var m=a.context||q,p=K.constructor;if(p._context=m,!z)throw new Error("".concat(p.name,': @type() reference provided for "').concat(v,"\" is undefined. Make sure you don't have any circular dependencies."));m.has(p)||m.add(p);var j=p._definition;if(j.addField(v,z),j.descriptors[v]){if(j.deprecated[v])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(v,"' definition on '").concat(p.name,"'.\nCheck @type() annotation"))}catch(C){var s=C.stack.split("\n")[4].trim();throw new Error("".concat(C.message," ").concat(s))}}var M=l.is(z),r=!M&&c.is(z);if("string"!==typeof z&&!Pz.is(z)){var W=Object.values(z)[0];"string"===typeof W||m.has(W)||m.add(W)}if(a.manual)j.descriptors[v]={enumerable:!0,configurable:!0,writable:!0};else{var F="_".concat(v);j.descriptors[F]={enumerable:!1,configurable:!1,writable:!0},j.descriptors[v]={get:function(){return this[F]},set:function(z){z!==this[F]&&(void 0!==z&&null!==z?(!M||z instanceof l||(z=new(l.bind.apply(l,T([void 0],z,!1)))),!r||z instanceof c||(z=new c(z)),void 0===z.$proxy&&(r?z=V(z):M&&(z=G(z))),this.$changes.change(v),z.$changes&&z.$changes.setParent(this,this.$changes.root,this._definition.indexes[v])):this[F]&&this.$changes.delete(v),this[F]=z)},enumerable:!0,configurable:!0}}}}function x(z){return function(a,K){var v=a.constructor;v._definition.addFilter(K,z)&&(v._context.useFilters=!0)}}function Z(z){return function(a,K){var v=a.constructor;v._definition.addChildrenFilter(K,z)&&(v._context.useFilters=!0)}}function y(z){return void 0===z&&(z=!0),function(a,K){var v=a.constructor._definition;v.deprecated[K]=!0,z&&(v.descriptors[K]={get:function(){throw new Error("".concat(K," is deprecated."))},set:function(z){},enumerable:!1,configurable:!0})}}function i(z,a,K){for(var v in void 0===K&&(K={}),K.context||(K.context=z._context||K.context||q),a)B(a[v],K)(z.prototype,v);return z}function n(z){for(var a=0,K=0,v=0,T=z.length;v<T;v++)(a=z.charCodeAt(v))<128?K+=1:a<2048?K+=2:a<55296||a>=57344?K+=3:(v++,K+=4);return K}function X(z,a,K){for(var v=0,T=0,m=K.length;T<m;T++)(v=K.charCodeAt(T))<128?z[a++]=v:v<2048?(z[a++]=192|v>>6,z[a++]=128|63&v):v<55296||v>=57344?(z[a++]=224|v>>12,z[a++]=128|v>>6&63,z[a++]=128|63&v):(T++,v=65536+((1023&v)<<10|1023&K.charCodeAt(T)),z[a++]=240|v>>18,z[a++]=128|v>>12&63,z[a++]=128|v>>6&63,z[a++]=128|63&v)}function P(z,a){z.push(255&a)}function J(z,a){z.push(255&a)}function o(z,a){z.push(255&a),z.push(a>>8&255)}function N(z,a){z.push(255&a),z.push(a>>8&255)}function A(z,a){z.push(255&a),z.push(a>>8&255),z.push(a>>16&255),z.push(a>>24&255)}function g(z,a){var K=a>>24,v=a>>16,T=a>>8,m=a;z.push(255&m),z.push(255&T),z.push(255&v),z.push(255&K)}function d(z,a){var K=Math.floor(a/Math.pow(2,32));g(z,a>>>0),g(z,K)}function t(z,a){var K=a/Math.pow(2,32)|0;g(z,a>>>0),g(z,K)}function e(z,a){u(z,a)}function L(z,a){U(z,a)}var E=new Int32Array(2),b=new Float32Array(E.buffer),D=new Float64Array(E.buffer);function u(z,a){b[0]=a,A(z,E[0])}function U(z,a){D[0]=a,A(z,E[0]),A(z,E[1])}function R(z,a){return J(z,a?1:0)}function k(z,a){a||(a="");var K=n(a),v=0;if(K<32)z.push(160|K),v=1;else if(K<256)z.push(217),J(z,K),v=2;else if(K<65536)z.push(218),N(z,K),v=3;else{if(!(K<4294967296))throw new Error("String too long");z.push(219),g(z,K),v=5}return X(z,z.length,a),v+K}function h(z,a){return isNaN(a)?h(z,0):isFinite(a)?a!==(0|a)?(z.push(203),U(z,a),9):a>=0?a<128?(J(z,a),1):a<256?(z.push(204),J(z,a),2):a<65536?(z.push(205),N(z,a),3):a<4294967296?(z.push(206),g(z,a),5):(z.push(207),t(z,a),9):a>=-32?(z.push(224|a+32),1):a>=-128?(z.push(208),P(z,a),2):a>=-32768?(z.push(209),o(z,a),3):a>=-2147483648?(z.push(210),A(z,a),5):(z.push(211),d(z,a),9):h(z,a>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var S=Object.freeze({__proto__:null,utf8Write:X,int8:P,uint8:J,int16:o,uint16:N,int32:A,uint32:g,int64:d,uint64:t,float32:e,float64:L,writeFloat32:u,writeFloat64:U,boolean:R,string:k,number:h});function Q(z,a,K){for(var v="",T=0,m=a,p=a+K;m<p;m++){var j=z[m];0!==(128&j)?192!==(224&j)?224!==(240&j)?240!==(248&j)?console.error("Invalid byte "+j.toString(16)):(T=(7&j)<<18|(63&z[++m])<<12|(63&z[++m])<<6|63&z[++m])>=65536?(T-=65536,v+=String.fromCharCode(55296+(T>>>10),56320+(1023&T))):v+=String.fromCharCode(T):v+=String.fromCharCode((15&j)<<12|(63&z[++m])<<6|63&z[++m]):v+=String.fromCharCode((31&j)<<6|63&z[++m]):v+=String.fromCharCode(j)}return v}function O(z,a){return zz(z,a)<<24>>24}function zz(z,a){return z[a.offset++]}function az(z,a){return Kz(z,a)<<16>>16}function Kz(z,a){return z[a.offset++]|z[a.offset++]<<8}function vz(z,a){return z[a.offset++]|z[a.offset++]<<8|z[a.offset++]<<16|z[a.offset++]<<24}function Tz(z,a){return vz(z,a)>>>0}function mz(z,a){return Fz(z,a)}function pz(z,a){return Gz(z,a)}function jz(z,a){var K=Tz(z,a);return vz(z,a)*Math.pow(2,32)+K}function sz(z,a){var K=Tz(z,a);return Tz(z,a)*Math.pow(2,32)+K}var Mz=new Int32Array(2),rz=new Float32Array(Mz.buffer),Wz=new Float64Array(Mz.buffer);function Fz(z,a){return Mz[0]=vz(z,a),rz[0]}function Gz(z,a){return Mz[0]=vz(z,a),Mz[1]=vz(z,a),Wz[0]}function lz(z,a){return zz(z,a)>0}function Vz(z,a){var K,v=z[a.offset++];v<192?K=31&v:217===v?K=zz(z,a):218===v?K=Kz(z,a):219===v&&(K=Tz(z,a));var T=Q(z,a.offset,K);return a.offset+=K,T}function cz(z,a){var K=z[a.offset];return K<192&&K>160||217===K||218===K||219===K}function Cz(z,a){var K=z[a.offset++];return K<128?K:202===K?Fz(z,a):203===K?Gz(z,a):204===K?zz(z,a):205===K?Kz(z,a):206===K?Tz(z,a):207===K?sz(z,a):208===K?O(z,a):209===K?az(z,a):210===K?vz(z,a):211===K?jz(z,a):K>223?-1*(255-K+1):void 0}function wz(z,a){var K=z[a.offset];return K<128||K>=202&&K<=211}function Hz(z,a){return z[a.offset]<160}function fz(z,a){return z[a.offset-1]===p&&(z[a.offset]<128||z[a.offset]>=202&&z[a.offset]<=211)}var Yz=Object.freeze({__proto__:null,int8:O,uint8:zz,int16:az,uint16:Kz,int32:vz,uint32:Tz,float32:mz,float64:pz,int64:jz,uint64:sz,readFloat32:Fz,readFloat64:Gz,boolean:lz,string:Vz,stringCheck:cz,number:Cz,numberCheck:wz,arrayCheck:Hz,switchStructureCheck:fz}),Iz=function(){function a(z){var a=this;this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,z&&z.forEach((function(z){return a.add(z)}))}return a.prototype.$c=function(a,K){return void 0===K&&(K=!0),M(this.$callbacks||(this.$callbacks=[]),z.OPERATION.ADD,a,K?this.$items:void 0)},a.prototype.bb=function(a){return M(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,a)},a.prototype.onChange=function(a){return M(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,a)},a.is=function(z){return void 0!==z.collection},a.prototype.add=function(z){var a=this.$refId++;return void 0!==z.$changes&&z.$changes.setParent(this,this.$changes.root,a),this.$changes.indexes[a]=a,this.$indexes.set(a,a),this.$items.set(a,z),this.$changes.change(a),a},a.prototype.at=function(z){var a=Array.from(this.$items.keys())[z];return this.$items.get(a)},a.prototype.entries=function(){return this.$items.entries()},a.prototype.delete=function(z){for(var a,K,v=this.$items.entries();(K=v.next())&&!K.done;)if(z===K.value[1]){a=K.value[0];break}return void 0!==a&&(this.$changes.delete(a),this.$indexes.delete(a),this.$items.delete(a))},a.prototype.clear=function(a){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),a&&r.call(this,a),this.$items.clear(),this.$changes.operation({index:0,op:z.OPERATION.CLEAR}),this.$changes.touchParents()},a.prototype.has=function(z){return Array.from(this.$items.values()).some((function(a){return a===z}))},a.prototype.forEach=function(z){var a=this;this.$items.forEach((function(K,v,T){return z(K,v,a)}))},a.prototype.values=function(){return this.$items.values()},Object.defineProperty(a.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),a.prototype.setIndex=function(z,a){this.$indexes.set(z,a)},a.prototype.getIndex=function(z){return this.$indexes.get(z)},a.prototype.getByIndex=function(z){return this.$items.get(this.$indexes.get(z))},a.prototype.deleteByIndex=function(z){var a=this.$indexes.get(z);this.$items.delete(a),this.$indexes.delete(z)},a.prototype.toArray=function(){return Array.from(this.$items.values())},a.prototype.toJSON=function(){var z=[];return this.forEach((function(a,K){z.push("function"===typeof a.toJSON?a.toJSON():a)})),z},a.prototype.clone=function(z){var K;return z?K=Object.assign(new a,this):(K=new a,this.forEach((function(z){z.$changes?K.add(z.clone()):K.add(z)}))),K},a}(),qz=function(){function a(z){var a=this;this.$changes=new s(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,z&&z.forEach((function(z){return a.add(z)}))}return a.prototype.$c=function(a,K){return void 0===K&&(K=!0),M(this.$callbacks||(this.$callbacks=[]),z.OPERATION.ADD,a,K?this.$items:void 0)},a.prototype.bb=function(a){return M(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,a)},a.prototype.onChange=function(a){return M(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,a)},a.is=function(z){return void 0!==z.set},a.prototype.add=function(a){var K,v;if(this.has(a))return!1;var T=this.$refId++;void 0!==a.$changes&&a.$changes.setParent(this,this.$changes.root,T);var m=null!==(v=null===(K=this.$changes.indexes[T])||void 0===K?void 0:K.op)&&void 0!==v?v:z.OPERATION.ADD;return this.$changes.indexes[T]=T,this.$indexes.set(T,T),this.$items.set(T,a),this.$changes.change(T,m),T},a.prototype.entries=function(){return this.$items.entries()},a.prototype.delete=function(z){for(var a,K,v=this.$items.entries();(K=v.next())&&!K.done;)if(z===K.value[1]){a=K.value[0];break}return void 0!==a&&(this.$changes.delete(a),this.$indexes.delete(a),this.$items.delete(a))},a.prototype.clear=function(a){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),a&&r.call(this,a),this.$items.clear(),this.$changes.operation({index:0,op:z.OPERATION.CLEAR}),this.$changes.touchParents()},a.prototype.has=function(z){for(var a,K=this.$items.values(),v=!1;(a=K.next())&&!a.done;)if(z===a.value){v=!0;break}return v},a.prototype.forEach=function(z){var a=this;this.$items.forEach((function(K,v,T){return z(K,v,a)}))},a.prototype.values=function(){return this.$items.values()},Object.defineProperty(a.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),a.prototype.setIndex=function(z,a){this.$indexes.set(z,a)},a.prototype.getIndex=function(z){return this.$indexes.get(z)},a.prototype.getByIndex=function(z){return this.$items.get(this.$indexes.get(z))},a.prototype.deleteByIndex=function(z){var a=this.$indexes.get(z);this.$items.delete(a),this.$indexes.delete(z)},a.prototype.toArray=function(){return Array.from(this.$items.values())},a.prototype.toJSON=function(){var z=[];return this.forEach((function(a,K){z.push("function"===typeof a.toJSON?a.toJSON():a)})),z},a.prototype.clone=function(z){var K;return z?K=Object.assign(new a,this):(K=new a,this.forEach((function(z){z.$changes?K.add(z.clone()):K.add(z)}))),K},a}(),Bz=function(){function z(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return z.prototype.addRefId=function(z){this.refIds.has(z)||(this.refIds.add(z),this.containerIndexes.set(z,new Set))},z.get=function(a){return void 0===a.$filterState&&(a.$filterState=new z),a.$filterState},z}(),xz=function(){function z(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return z.prototype.getNextUniqueId=function(){return this.nextUniqueId++},z.prototype.addRef=function(z,a,K){void 0===K&&(K=!0),this.refs.set(z,a),K&&(this.refCounts[z]=(this.refCounts[z]||0)+1)},z.prototype.removeRef=function(z){this.refCounts[z]=this.refCounts[z]-1,this.deletedRefs.add(z)},z.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},z.prototype.garbageCollectDeletedRefs=function(){var z=this;this.deletedRefs.forEach((function(a){if(!(z.refCounts[a]>0)){var K=z.refs.get(a);if(K instanceof Pz)for(var v in K._definition.schema)"string"!==typeof K._definition.schema[v]&&K[v]&&K[v].$changes&&z.removeRef(K[v].$changes.refId);else{var T=K.$changes.parent._definition,m=T.schema[T.fieldsByIndex[K.$changes.parentIndex]];"function"===typeof Object.values(m)[0]&&Array.from(K.values()).forEach((function(a){return z.removeRef(a.$changes.refId)}))}z.refs.delete(a),delete z.refCounts[a]}})),this.deletedRefs.clear()},z}(),Zz=function(z){function a(){return null!==z&&z.apply(this,arguments)||this}return K(a,z),a}(Error);function yz(z,a,K,v){var T,m=!1;switch(a){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":T="number",isNaN(z)&&console.log('trying to encode "NaN" in '.concat(K.constructor.name,"#").concat(v));break;case"string":T="string",m=!0;break;case"boolean":return}if(typeof z!==T&&(!m||m&&null!==z)){var p="'".concat(JSON.stringify(z),"'").concat(z&&z.constructor&&" (".concat(z.constructor.name,")")||"");throw new Zz("a '".concat(T,"' was expected, but ").concat(p," was provided in ").concat(K.constructor.name,"#").concat(v))}}function iz(z,a,K,v){if(!(z instanceof a))throw new Zz("a '".concat(a.name,"' was expected, but '").concat(z.constructor.name,"' was provided in ").concat(K.constructor.name,"#").concat(v))}function nz(z,a,K,v,T){yz(K,z,v,T);var m=S[z];if(!m)throw new Zz("a '".concat(z,"' was expected, but ").concat(K," was provided in ").concat(v.constructor.name,"#").concat(T));m(a,K)}function Xz(z,a,K){return Yz[z](a,K)}var Pz=function(){function a(){for(var z=[],a=0;a<arguments.length;a++)z[a]=arguments[a];Object.defineProperties(this,{$changes:{value:new s(this,void 0,new xz),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var K=this._definition.descriptors;K&&Object.defineProperties(this,K),z[0]&&this.assign(z[0])}return a.onError=function(z){console.error(z)},a.is=function(z){return z._definition&&void 0!==z._definition.schema},a.prototype.onChange=function(a){return M(this.$callbacks||(this.$callbacks=[]),z.OPERATION.REPLACE,a)},a.prototype.bb=function(a){return M(this.$callbacks||(this.$callbacks=[]),z.OPERATION.DELETE,a)},a.prototype.assign=function(z){return Object.assign(this,z),this},Object.defineProperty(a.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),a.prototype.setDirty=function(z,a){this.$changes.change(z,a)},a.prototype.listen=function(z,a,K){var v=this;return void 0===K&&(K=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[z]||(this.$callbacks[z]=[]),this.$callbacks[z].push(a),K&&void 0!==this[z]&&a(this[z],void 0),function(){return W(v.$callbacks[z],v.$callbacks[z].indexOf(a))}},a.prototype.decode=function(K,v,T){var m;void 0===v&&(v={offset:0}),void 0===T&&(T=this);var j=[],s=this.$changes.root,M=K.length,r=0;for(s.refs.set(r,this);v.offset<M;){var W=K[v.offset++];if(W!=p){var F=T.$changes,G=void 0!==T._definition,V=G?W>>6<<6:W;if(V!==z.OPERATION.CLEAR){var C=G?W%(V||255):Cz(K,v),w=G?T._definition.fieldsByIndex[C]:"",f=F.getType(C),Y=void 0,I=void 0,q=void 0;if(G?I=T["_".concat(w)]:(I=T.getByIndex(C),(V&z.OPERATION.ADD)===z.OPERATION.ADD?(q=T instanceof c?Vz(K,v):C,T.setIndex(C,q)):q=T.getIndex(C)),(V&z.OPERATION.DELETE)===z.OPERATION.DELETE&&(V!==z.OPERATION.DELETE_AND_ADD&&T.deleteByIndex(C),I&&I.$changes&&s.removeRef(I.$changes.refId),Y=null),void 0!==w){if(V===z.OPERATION.DELETE);else if(a.is(f)){var B=Cz(K,v);if(Y=s.refs.get(B),V!==z.OPERATION.REPLACE){var x=this.getSchemaType(K,v,f);Y||((Y=this.createTypeInstance(x)).$changes.refId=B,I&&(Y.$callbacks=I.$callbacks,I.$changes.refId&&B!==I.$changes.refId&&s.removeRef(I.$changes.refId))),s.addRef(B,Y,Y!==I)}}else if("string"===typeof f)Y=Xz(f,K,v);else{var Z=H(Object.keys(f)[0]),y=Cz(K,v),i=s.refs.has(y)?I||s.refs.get(y):new Z.constructor;if((Y=i.clone(!0)).$changes.refId=y,I&&(Y.$callbacks=I.$callbacks,I.$changes.refId&&y!==I.$changes.refId)){s.removeRef(I.$changes.refId);for(var n=I.entries(),X=void 0;(X=n.next())&&!X.done;){var P=(m=X.value)[0],J=m[1];j.push({refId:y,op:z.OPERATION.DELETE,field:P,value:void 0,previousValue:J})}}s.addRef(y,Y,i!==I)}if(null!==Y&&void 0!==Y)if(Y.$changes&&Y.$changes.setParent(F.ref,F.root,C),T instanceof a)T[w]=Y;else if(T instanceof c)P=q,T.$items.set(P,Y),T.$changes.allChanges.add(C);else if(T instanceof l)T.setAt(C,Y);else if(T instanceof Iz){var o=T.add(Y);T.setIndex(C,o)}else T instanceof qz&&!1!==(o=T.add(Y))&&T.setIndex(C,o);I!==Y&&j.push({refId:r,op:V,field:w,dynamicIndex:q,value:Y,previousValue:I})}else{console.warn("@colyseus/schema: definition mismatch");for(var N={offset:v.offset};v.offset<M&&(!fz(K,v)||(N.offset=v.offset+1,!s.refs.has(Cz(K,N))));)v.offset++}}else T.clear(j)}else{r=Cz(K,v);var A=s.refs.get(r);if(!A)throw new Error('"refId" not found: '.concat(r));T=A}}return this._triggerChanges(j),s.garbageCollectDeletedRefs(),j},a.prototype.encode=function(K,v,T){void 0===K&&(K=!1),void 0===v&&(v=[]),void 0===T&&(T=!1);for(var m=this.$changes,j=new WeakSet,s=[m],M=1,r=0;r<M;r++){var W=s[r],F=W.ref,G=F instanceof a;W.ensureRefId(),j.add(W),W!==m&&(W.changed||K)&&(J(v,p),h(v,W.refId));for(var l=K?Array.from(W.allChanges):Array.from(W.changes.values()),V=0,C=l.length;V<C;V++){var w=K?{op:z.OPERATION.ADD,index:l[V]}:l[V],f=w.index,Y=G?F._definition.fieldsByIndex&&F._definition.fieldsByIndex[f]:f,I=v.length;if(w.op!==z.OPERATION.TOUCH)if(G)J(v,f|w.op);else{if(J(v,w.op),w.op===z.OPERATION.CLEAR)continue;h(v,f)}if(G||(w.op&z.OPERATION.ADD)!=z.OPERATION.ADD||F instanceof c&&k(v,W.ref.$indexes.get(f)),w.op!==z.OPERATION.DELETE){var q=W.getType(f),B=W.getValue(f);if(B&&B.$changes&&!j.has(B.$changes)&&(s.push(B.$changes),B.$changes.ensureRefId(),M++),w.op!==z.OPERATION.TOUCH){if(a.is(q))iz(B,q,F,Y),h(v,B.$changes.refId),(w.op&z.OPERATION.ADD)===z.OPERATION.ADD&&this.tryEncodeTypeId(v,q,B.constructor);else if("string"===typeof q)nz(q,v,B,F,Y);else{var x=H(Object.keys(q)[0]);iz(F["_".concat(Y)],x.constructor,F,Y),h(v,B.$changes.refId)}T&&W.cache(f,v.slice(I))}}}K||T||W.discard()}return v},a.prototype.encodeAll=function(z){return this.encode(!0,[],z)},a.prototype.applyFilters=function(K,v){var T,m;void 0===v&&(v=!1);for(var j=this,s=new Set,M=Bz.get(K),r=[this.$changes],W=1,F=[],G=function(G){var l=r[G];if(s.has(l.refId))return"continue";var V=l.ref,C=V instanceof a;J(F,p),h(F,l.refId);var w=M.refIds.has(l),H=v||!w;M.addRefId(l);var f=M.containerIndexes.get(l),Y=H?Array.from(l.allChanges):Array.from(l.changes.values());!v&&C&&V._definition.indexesWithFilters&&V._definition.indexesWithFilters.forEach((function(a){!f.has(a)&&l.allChanges.has(a)&&(H?Y.push(a):Y.push({op:z.OPERATION.ADD,index:a}))}));for(var I=0,q=Y.length;I<q;I++){var B=H?{op:z.OPERATION.ADD,index:Y[I]}:Y[I];if(B.op!==z.OPERATION.CLEAR){var x=B.index;if(B.op!==z.OPERATION.DELETE){var Z=l.getValue(x),y=l.getType(x);if(C){if((i=V._definition.filters&&V._definition.filters[x])&&!i.call(V,K,Z,j)){Z&&Z.$changes&&s.add(Z.$changes.refId);continue}}else{var i,n=l.parent;if((i=l.getChildrenFilter())&&!i.call(n,K,V.$indexes.get(x),Z,j)){Z&&Z.$changes&&s.add(Z.$changes.refId);continue}}if(Z.$changes&&(r.push(Z.$changes),W++),B.op!==z.OPERATION.TOUCH)if(B.op===z.OPERATION.ADD||C)F.push.apply(F,null!==(T=l.caches[x])&&void 0!==T?T:[]),f.add(x);else if(f.has(x))F.push.apply(F,null!==(m=l.caches[x])&&void 0!==m?m:[]);else{if(f.add(x),J(F,z.OPERATION.ADD),h(F,x),V instanceof c){var X=l.ref.$indexes.get(x);k(F,X)}Z.$changes?h(F,Z.$changes.refId):S[y](F,Z)}else Z.$changes&&!C&&(J(F,z.OPERATION.ADD),h(F,x),V instanceof c&&(X=l.ref.$indexes.get(x),k(F,X)),h(F,Z.$changes.refId))}else C?J(F,B.op|x):(J(F,B.op),h(F,x))}else J(F,B.op)}},l=0;l<W;l++)G(l);return F},a.prototype.clone=function(){var z,a=new this.constructor,K=this._definition.schema;for(var v in K)"object"===typeof this[v]&&"function"===typeof(null===(z=this[v])||void 0===z?void 0:z.clone)?a[v]=this[v].clone():a[v]=this[v];return a},a.prototype.toJSON=function(){var z=this._definition.schema,a=this._definition.deprecated,K={};for(var v in z)a[v]||null===this[v]||"undefined"===typeof this[v]||(K[v]="function"===typeof this[v].toJSON?this[v].toJSON():this["_".concat(v)]);return K},a.prototype.discardAllChanges=function(){this.$changes.discardAll()},a.prototype.getByIndex=function(z){return this[this._definition.fieldsByIndex[z]]},a.prototype.deleteByIndex=function(z){this[this._definition.fieldsByIndex[z]]=void 0},a.prototype.tryEncodeTypeId=function(z,a,K){a._typeid!==K._typeid&&(J(z,j),h(z,K._typeid))},a.prototype.getSchemaType=function(z,a,K){var v;return z[a.offset]===j&&(a.offset++,v=this.constructor._context.get(Cz(z,a))),v||K},a.prototype.createTypeInstance=function(z){var a=new z;return a.$changes.root=this.$changes.root,a},a.prototype._triggerChanges=function(K){for(var v,T,m,p,j,s,M,r,W,F=new Set,G=this.$changes.root.refs,l=function(l){var V=K[l],c=V.refId,C=G.get(c),w=C.$callbacks;if((V.op&z.OPERATION.DELETE)===z.OPERATION.DELETE&&V.previousValue instanceof a&&(null===(T=null===(v=V.previousValue.$callbacks)||void 0===v?void 0:v[z.OPERATION.DELETE])||void 0===T||T.forEach((function(z){return z()}))),!w)return"continue";if(C instanceof a){if(!F.has(c))try{null===(m=null===w||void 0===w?void 0:w[z.OPERATION.REPLACE])||void 0===m||m.forEach((function(z){return z()}))}catch(H){a.onError(H)}try{w.hasOwnProperty(V.field)&&(null===(p=w[V.field])||void 0===p||p.forEach((function(z){return z(V.value,V.previousValue)})))}catch(H){a.onError(H)}}else V.op===z.OPERATION.ADD&&void 0===V.previousValue?null===(j=w[z.OPERATION.ADD])||void 0===j||j.forEach((function(z){var a;return z(V.value,null!==(a=V.dynamicIndex)&&void 0!==a?a:V.field)})):V.op===z.OPERATION.DELETE?void 0!==V.previousValue&&(null===(s=w[z.OPERATION.DELETE])||void 0===s||s.forEach((function(z){var a;return z(V.previousValue,null!==(a=V.dynamicIndex)&&void 0!==a?a:V.field)}))):V.op===z.OPERATION.DELETE_AND_ADD&&(void 0!==V.previousValue&&(null===(M=w[z.OPERATION.DELETE])||void 0===M||M.forEach((function(z){var a;return z(V.previousValue,null!==(a=V.dynamicIndex)&&void 0!==a?a:V.field)}))),null===(r=w[z.OPERATION.ADD])||void 0===r||r.forEach((function(z){var a;return z(V.value,null!==(a=V.dynamicIndex)&&void 0!==a?a:V.field)}))),V.value!==V.previousValue&&(null===(W=w[z.OPERATION.REPLACE])||void 0===W||W.forEach((function(z){var a;return z(V.value,null!==(a=V.dynamicIndex)&&void 0!==a?a:V.field)})));F.add(c)},V=0;V<K.length;V++)l(V)},a._definition=f.create(),a}();function Jz(z){for(var a=[z.$changes],K=1,v={},T=v,m=function(z){var K=a[z];K.changes.forEach((function(z){var a=K.ref,v=z.index,m=a._definition?a._definition.fieldsByIndex[v]:a.$indexes.get(v);T[m]=K.getValue(v)}))},p=0;p<K;p++)m(p);return v}var oz={context:new I},Nz=function(z){function a(){return null!==z&&z.apply(this,arguments)||this}return K(a,z),v([B("string",oz)],a.prototype,"name",void 0),v([B("string",oz)],a.prototype,"type",void 0),v([B("number",oz)],a.prototype,"referencedType",void 0),a}(Pz),Az=function(z){function a(){var a=null!==z&&z.apply(this,arguments)||this;return a.fields=new l,a}return K(a,z),v([B("number",oz)],a.prototype,"id",void 0),v([B([Nz],oz)],a.prototype,"fields",void 0),a}(Pz),gz=function(z){function a(){var a=null!==z&&z.apply(this,arguments)||this;return a.types=new l,a}return K(a,z),a.encode=function(z){var K=z.constructor,v=new a;v.rootType=K._typeid;var T=function(z,a){for(var K in a){var T=new Nz;T.name=K;var m=void 0;if("string"===typeof a[K])m=a[K];else{var p=a[K],j=void 0;Pz.is(p)?(m="ref",j=a[K]):"string"===typeof p[m=Object.keys(p)[0]]?m+=":"+p[m]:j=p[m],T.referencedType=j?j._typeid:-1}T.type=m,z.fields.push(T)}v.types.push(z)},m=K._context.types;for(var p in m){var j=new Az;j.id=Number(p),T(j,m[p]._definition.schema)}return v.encodeAll()},a.decode=function(z,v){var T=new I,m=new a;m.decode(z,v);var p=m.types.reduce((function(z,a){var v=function(z){function a(){return null!==z&&z.apply(this,arguments)||this}return K(a,z),a}(Pz),m=a.id;return z[m]=v,T.add(v,m),z}),{});m.types.forEach((function(z){var a=p[z.id];z.fields.forEach((function(z){var K;if(void 0!==z.referencedType){var v=z.type,m=p[z.referencedType];if(!m){var j=z.type.split(":");v=j[0],m=j[1]}"ref"===v?B(m,{context:T})(a.prototype,z.name):B(((K={})[v]=m,K),{context:T})(a.prototype,z.name)}else B(z.type,{context:T})(a.prototype,z.name)}))}));var j=p[m.rootType],s=new j;for(var M in j._definition.schema){var r=j._definition.schema[M];"string"!==typeof r&&(s[M]="function"===typeof r?new r:new(H(Object.keys(r)[0]).constructor))}return s},v([B([Az],oz)],a.prototype,"types",void 0),v([B("number",oz)],a.prototype,"rootType",void 0),a}(Pz);w("map",{constructor:c}),w("array",{constructor:l}),w("set",{constructor:qz}),w("collection",{constructor:Iz}),z.ArraySchema=l,z.CollectionSchema=Iz,z.Context=I,z.MapSchema=c,z.Reflection=gz,z.ReflectionField=Nz,z.ReflectionType=Az,z.Schema=Pz,z.SchemaDefinition=f,z.SetSchema=qz,z.decode=Yz,z.defineTypes=i,z.deprecated=y,z.dumpChanges=Jz,z.encode=S,z.filter=x,z.filterChildren=Z,z.hasFilter=Y,z.registerType=w,z.type=B,Object.defineProperty(z,"__esModule",{value:!0})}(a)},12185:z=>{z.exports=function(z){return null!=z&&null!=z.constructor&&"function"===typeof z.constructor.isBuffer&&z.constructor.isBuffer(z)}},12163:(z,a,K)=>{"use strict";var v=K(12170),T=K(12178),m=K(12185);K.g.__TYPEDARRAY_POOL||(K.g.__TYPEDARRAY_POOL={UINT8:T([32,0]),UINT16:T([32,0]),UINT32:T([32,0]),INT8:T([32,0]),INT16:T([32,0]),INT32:T([32,0]),FLOAT:T([32,0]),DOUBLE:T([32,0]),DATA:T([32,0]),UINT8C:T([32,0]),BUFFER:T([32,0])});var p="undefined"!==typeof Uint8ClampedArray,j=K.g.__TYPEDARRAY_POOL;j.UINT8C||(j.UINT8C=T([32,0])),j.BUFFER||(j.BUFFER=T([32,0]));var s=j.DATA,M=j.BUFFER;function r(z){if(z){var a=z.length||z.byteLength,K=v.log2(a);s[K].push(z)}}function W(z){z=v.nextPow2(z);var a=v.log2(z),K=s[a];return K.length>0?K.pop():new ArrayBuffer(z)}function F(z){return new Uint8Array(W(z),0,z)}function G(z){return new Uint16Array(W(2*z),0,z)}function l(z){return new Uint32Array(W(4*z),0,z)}function V(z){return new Int8Array(W(z),0,z)}function c(z){return new Int16Array(W(2*z),0,z)}function C(z){return new Int32Array(W(4*z),0,z)}function w(z){return new Float32Array(W(4*z),0,z)}function H(z){return new Float64Array(W(8*z),0,z)}function f(z){return p?new Uint8ClampedArray(W(z),0,z):F(z)}function Y(z){return new DataView(W(z),0,z)}a.free=function(z){if(m(z))M[v.log2(z.length)].push(z);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(z)&&(z=z.buffer),!z)return;var a=z.length||z.byteLength,K=0|v.log2(a);s[K].push(z)}},a.freeUint8=a.freeUint16=a.freeUint32=a.freeInt8=a.freeInt16=a.freeInt32=a.freeFloat32=a.freeFloat=a.freeFloat64=a.freeDouble=a.freeUint8Clamped=a.freeDataView=function(z){r(z.buffer)},a.freeArrayBuffer=r,a.freeBuffer=function(z){M[v.log2(z.length)].push(z)},a.malloc=function(z,a){if(void 0===a||"arraybuffer"===a)return W(z);switch(a){case"uint8":return F(z);case"uint16":return G(z);case"uint32":return l(z);case"int8":return V(z);case"int16":return c(z);case"int32":return C(z);case"float":case"float32":return w(z);case"double":case"float64":return H(z);case"uint8_clamped":return f(z);case"buffer":throw"Buffer not supported";case"data":case"dataview":return Y(z);default:return null}return null},a.mallocArrayBuffer=W,a.mallocUint8=F,a.mallocUint16=G,a.mallocUint32=l,a.mallocInt8=V,a.mallocInt16=c,a.mallocInt32=C,a.mallocFloat32=a.mallocFloat=w,a.mallocFloat64=a.mallocDouble=H,a.mallocUint8Clamped=f,a.mallocDataView=Y,a.clearCache=function(){for(var z=0;z<32;++z)j.UINT8[z].length=0,j.UINT16[z].length=0,j.UINT32[z].length=0,j.INT8[z].length=0,j.INT16[z].length=0,j.INT32[z].length=0,j.FLOAT[z].length=0,j.DOUBLE[z].length=0,j.UINT8C[z].length=0,s[z].length=0,M[z].length=0}},12270:(z,a,K)=>{z.exports=T;var v=K(129);function T(z,a){if(!(this instanceof T))return new T(z,a);var K=v.create();v.add(K,z,a),this.base=v.min(v.create(),z,K),this.Lg=v.clone(a),this.max=v.max(v.create(),z,K),this.mag=v.length(this.Lg)}var m=T.prototype;m.width=function(){return this.Lg[0]},m.height=function(){return this.Lg[1]},m.depth=function(){return this.Lg[2]},m.x0=function(){return this.base[0]},m.y0=function(){return this.base[1]},m.z0=function(){return this.base[2]},m.x1=function(){return this.max[0]},m.y1=function(){return this.max[1]},m.z1=function(){return this.max[2]},m.translate=function(z){return v.add(this.max,this.max,z),v.add(this.base,this.base,z),this},m.setPosition=function(z){return v.add(this.max,z,this.Lg),v.i(this.base,z),this},m.expand=function(z){var a=v.create(),K=v.create();return v.max(a,z.max,this.max),v.min(K,z.base,this.base),v.sc(a,a,K),new T(K,a)},m.intersects=function(z){return!(z.base[0]>this.max[0])&&(!(z.base[1]>this.max[1])&&(!(z.base[2]>this.max[2])&&(!(z.max[0]<this.base[0])&&(!(z.max[1]<this.base[1])&&!(z.max[2]<this.base[2])))))},m.touches=function(z){var a=this.union(z);return null!==a&&(0==a.width()||0==a.height()||0==a.depth())},m.union=function(z){if(!this.intersects(z))return null;var a=Math.max(z.base[0],this.base[0]),K=Math.max(z.base[1],this.base[1]),v=Math.max(z.base[2],this.base[2]);return new T([a,K,v],[Math.min(z.max[0],this.max[0])-a,Math.min(z.max[1],this.max[1])-K,Math.min(z.max[2],this.max[2])-v])}},12170:(z,a)=>{"use strict";function K(z){var a=32;return(z&=-z)&&a--,65535&z&&(a-=16),16711935&z&&(a-=8),252645135&z&&(a-=4),858993459&z&&(a-=2),1431655765&z&&(a-=1),a}a.INT_BITS=32,a.INT_MAX=2147483647,a.INT_MIN=-1<<31,a.sign=function(z){return(z>0)-(z<0)},a.abs=function(z){var a=z>>31;return(z^a)-a},a.min=function(z,a){return a^(z^a)&-(z<a)},a.max=function(z,a){return z^(z^a)&-(z<a)},a.isPow2=function(z){return!(z&z-1)&&!!z},a.log2=function(z){var a,K;return a=(z>65535)<<4,a|=K=((z>>>=a)>255)<<3,a|=K=((z>>>=K)>15)<<2,(a|=K=((z>>>=K)>3)<<1)|(z>>>=K)>>1},a.log10=function(z){return z>=1e9?9:z>=1e8?8:z>=1e7?7:z>=1e6?6:z>=1e5?5:z>=1e4?4:z>=1e3?3:z>=100?2:z>=10?1:0},a.popCount=function(z){return 16843009*((z=(858993459&(z-=z>>>1&1431655765))+(z>>>2&858993459))+(z>>>4)&252645135)>>>24},a.countTrailingZeros=K,a.nextPow2=function(z){return z+=0===z,--z,z|=z>>>1,z|=z>>>2,z|=z>>>4,z|=z>>>8,(z|=z>>>16)+1},a.prevPow2=function(z){return z|=z>>>1,z|=z>>>2,z|=z>>>4,z|=z>>>8,(z|=z>>>16)-(z>>>1)},a.parity=function(z){return z^=z>>>16,z^=z>>>8,z^=z>>>4,27030>>>(z&=15)&1};var v=new Array(256);!function(z){for(var a=0;a<256;++a){var K=a,v=a,T=7;for(K>>>=1;K;K>>>=1)v<<=1,v|=1&K,--T;z[a]=v<<T&255}}(v),a.reverse=function(z){return v[255&z]<<24|v[z>>>8&255]<<16|v[z>>>16&255]<<8|v[z>>>24&255]},a.interleave2=function(z,a){return(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z&=65535)|z<<8))|z<<4))|z<<2))|z<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a&=65535)|a<<8))|a<<4))|a<<2))|a<<1))<<1},a.deinterleave2=function(z,a){return(z=65535&((z=16711935&((z=252645135&((z=858993459&((z=z>>>a&1431655765)|z>>>1))|z>>>2))|z>>>4))|z>>>16))<<16>>16},a.interleave3=function(z,a,K){return z=1227133513&((z=3272356035&((z=251719695&((z=4278190335&((z&=1023)|z<<16))|z<<8))|z<<4))|z<<2),(z|=(a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2))<<1)|(K=1227133513&((K=3272356035&((K=251719695&((K=4278190335&((K&=1023)|K<<16))|K<<8))|K<<4))|K<<2))<<2},a.deinterleave3=function(z,a){return(z=1023&((z=4278190335&((z=251719695&((z=3272356035&((z=z>>>a&1227133513)|z>>>2))|z>>>4))|z>>>8))|z>>>16))<<22>>22},a.nextCombination=function(z){var a=z|z-1;return a+1|(~a&-~a)-1>>>K(z)+1}},12161:(z,a,K)=>{"use strict";z.exports=function(z,a,K){switch(arguments.length){case 1:return v=[],M(T=z,T,r,!0),v;case 2:return"function"===typeof a?M(z,z,a,!0):function(z,a){return v=[],M(z,a,r,!1),v}(z,a);case 3:return M(z,a,K,!1);default:throw new Error("box-intersect: Invalid arguments")}var T};var v,T=K(12163),m=K(12187),p=K(12203);function j(z,a){for(var K=0;K<z;++K)if(!(a[K]<=a[K+z]))return!0;return!1}function s(z,a,K,v){for(var T=0,m=0,p=0,s=z.length;p<s;++p){var M=z[p];if(!j(a,M)){for(var r=0;r<2*a;++r)K[T++]=M[r];v[m++]=p}}return m}function M(z,a,K,v){var j=z.length,M=a.length;if(!(j<=0||M<=0)){var r=z[0].length>>>1;if(!(r<=0)){var W,F=T.mallocDouble(2*r*j),G=T.mallocInt32(j);if((j=s(z,r,F,G))>0){if(1===r&&v)m.init(j),W=m.sweepComplete(r,K,0,j,F,G,0,j,F,G);else{var l=T.mallocDouble(2*r*M),V=T.mallocInt32(M);(M=s(a,r,l,V))>0&&(m.init(j+M),W=1===r?m.sweepBipartite(r,K,0,j,F,G,0,M,l,V):p(r,K,v,j,F,G,M,l,V),T.free(l),T.free(V))}T.free(F),T.free(G)}return W}}}function r(z,a){v.push([z,a])}},12209:(z,a)=>{"use strict";var K="d",v="ax",T="fp",m="es",p="rs",j="re",s="rb",M="bs",r="be",W="bb",F=[K,v,"vv",p,j,s,"ri",M,r,W,"bi"];function G(z){var a="bruteForce"+(z?"Full":"Partial"),v=[],p=F.slice();z||p.splice(3,0,T);var j=["function "+a+"("+p.join()+"){"];function s(a,T){var p=function(z,a,v){var T="bruteForce"+(z?"Red":"Blue")+(a?"Flip":"")+(v?"Full":""),p=["function ",T,"(",F.join(),"){","var ",m,"=2*",K,";"],j="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",s="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(v?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return z?p.push(j,"Q",":",s):p.push(s,"Q",":",j),v?p.push("if(y1<x0||x1<y0)continue;"):a?p.push("if(y0<=x0||x1<y0)continue;"):p.push("if(y0<x0||x1<y0)continue;"),p.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),a?p.push("yi,xi"):p.push("xi,yi"),p.push(");if(rv!==void 0)return rv;}}}"),{name:T,code:p.join("")}}(a,T,z);v.push(p.code),j.push("return "+p.name+"("+F.join()+");")}j.push("if(re-rs>be-bs){"),z?(s(!0,!1),j.push("}else{"),s(!1,!1)):(j.push("if(fp){"),s(!0,!0),j.push("}else{"),s(!0,!1),j.push("}}else{if(fp){"),s(!1,!0),j.push("}else{"),s(!1,!1),j.push("}")),j.push("}}return "+a);var M=v.join("")+j.join("");return new Function(M)()}a.partial=G(!1),a.full=G(!0)},12203:(z,a,K)=>{"use strict";z.exports=function(z,a,K,m,r,y,i,n,X){!function(z,a){var K=8*T.log2(a+1)*(z+1)|0,m=T.nextPow2(f*K);I.length<m&&(v.free(I),I=v.mallocInt32(m));var p=T.nextPow2(Y*K);q.length<p&&(v.free(q),q=v.mallocDouble(p))}(z,m+i);var P,J=0,o=2*z;B(J++,0,0,m,0,i,K?16:0,-1/0,1/0),K||B(J++,0,0,i,0,m,1,-1/0,1/0);for(;J>0;){var N=(J-=1)*f,A=I[N],g=I[N+1],d=I[N+2],t=I[N+3],e=I[N+4],L=I[N+5],E=J*Y,b=q[E],D=q[E+1],u=1&L,U=!!(16&L),R=r,k=y,h=n,S=X;if(u&&(R=n,k=X,h=r,S=y),!(2&L&&g>=(d=c(z,A,g,d,R,k,D)))&&!(4&L&&(g=C(z,A,g,d,R,k,b))>=d)){var Q=d-g,O=e-t;if(U){if(z*Q*(Q+O)<G){if(void 0!==(P=s.scanComplete(z,A,a,g,d,R,k,t,e,h,S)))return P;continue}}else{if(z*Math.min(Q,O)<W){if(void 0!==(P=p(z,A,a,u,g,d,R,k,t,e,h,S)))return P;continue}if(z*Q*O<F){if(void 0!==(P=s.scanBipartite(z,A,a,u,g,d,R,k,t,e,h,S)))return P;continue}}var zz=l(z,A,g,d,R,k,b,D);if(g<zz)if(z*(zz-g)<W){if(void 0!==(P=j(z,A+1,a,g,zz,R,k,t,e,h,S)))return P}else if(A===z-2){if(void 0!==(P=u?s.sweepBipartite(z,a,t,e,h,S,g,zz,R,k):s.sweepBipartite(z,a,g,zz,R,k,t,e,h,S)))return P}else B(J++,A+1,g,zz,t,e,u,-1/0,1/0),B(J++,A+1,t,e,g,zz,1^u,-1/0,1/0);if(zz<d){var az=M(z,A,t,e,h,S),Kz=h[o*az+A],vz=V(z,A,az,e,h,S,Kz);if(vz<e&&B(J++,A,zz,d,vz,e,(4|u)+(U?16:0),Kz,D),t<az&&B(J++,A,zz,d,t,az,(2|u)+(U?16:0),b,Kz),az+1===vz){if(void 0!==(P=U?Z(z,A,a,zz,d,R,k,az,h,S[az]):x(z,A,a,u,zz,d,R,k,az,h,S[az])))return P}else if(az<vz){var Tz;if(U){if(zz<(Tz=w(z,A,zz,d,R,k,Kz))){var mz=V(z,A,zz,Tz,R,k,Kz);if(A===z-2){if(zz<mz&&void 0!==(P=s.sweepComplete(z,a,zz,mz,R,k,az,vz,h,S)))return P;if(mz<Tz&&void 0!==(P=s.sweepBipartite(z,a,mz,Tz,R,k,az,vz,h,S)))return P}else zz<mz&&B(J++,A+1,zz,mz,az,vz,16,-1/0,1/0),mz<Tz&&(B(J++,A+1,mz,Tz,az,vz,0,-1/0,1/0),B(J++,A+1,az,vz,mz,Tz,1,-1/0,1/0))}}else zz<(Tz=u?H(z,A,zz,d,R,k,Kz):w(z,A,zz,d,R,k,Kz))&&(A===z-2?P=u?s.sweepBipartite(z,a,az,vz,h,S,zz,Tz,R,k):s.sweepBipartite(z,a,zz,Tz,R,k,az,vz,h,S):(B(J++,A+1,zz,Tz,az,vz,u,-1/0,1/0),B(J++,A+1,az,vz,zz,Tz,1^u,-1/0,1/0)))}}}}};var v=K(12163),T=K(12170),m=K(12209),p=m.partial,j=m.full,s=K(12187),M=K(12217),r=K(12224),W=128,F=1<<22,G=1<<22,l=r("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),V=r("lo===p0",["p0"]),c=r("lo<p0",["p0"]),C=r("hi<=p0",["p0"]),w=r("lo<=p0&&p0<=hi",["p0"]),H=r("lo<p0&&p0<=hi",["p0"]),f=6,Y=2,I=v.mallocInt32(1024),q=v.mallocDouble(1024);function B(z,a,K,v,T,m,p,j,s){var M=f*z;I[M]=a,I[M+1]=K,I[M+2]=v,I[M+3]=T,I[M+4]=m,I[M+5]=p;var r=Y*z;q[r]=j,q[r+1]=s}function x(z,a,K,v,T,m,p,j,s,M,r){var W=2*z,F=s*W,G=M[F+a];z:for(var l=T,V=T*W;l<m;++l,V+=W){var c=p[V+a],C=p[V+a+z];if(!(G<c||C<G)&&(!v||G!==c)){for(var w,H=j[l],f=a+1;f<z;++f){c=p[V+f],C=p[V+f+z];var Y=M[F+f],I=M[F+f+z];if(C<Y||I<c)continue z}if(void 0!==(w=v?K(r,H):K(H,r)))return w}}}function Z(z,a,K,v,T,m,p,j,s,M){var r=2*z,W=j*r,F=s[W+a];z:for(var G=v,l=v*r;G<T;++G,l+=r){var V=p[G];if(V!==M){var c=m[l+a],C=m[l+a+z];if(!(F<c||C<F)){for(var w=a+1;w<z;++w){c=m[l+w],C=m[l+w+z];var H=s[W+w],f=s[W+w+z];if(C<H||f<c)continue z}var Y=K(V,M);if(void 0!==Y)return Y}}}}},12217:(z,a,K)=>{"use strict";z.exports=function(z,a,K,p,j,s){if(p<=K+1)return K;var M=K,r=p,W=p+K>>>1,F=2*z,G=W,l=j[F*W+a];for(;M<r;){if(r-M<T){m(z,a,M,r,j,s),l=j[F*W+a];break}var V=r-M,c=Math.random()*V+M|0,C=j[F*c+a],w=Math.random()*V+M|0,H=j[F*w+a],f=Math.random()*V+M|0,Y=j[F*f+a];C<=H?Y>=H?(G=w,l=H):C>=Y?(G=c,l=C):(G=f,l=Y):H>=Y?(G=w,l=H):Y>=C?(G=c,l=C):(G=f,l=Y);for(var I=F*(r-1),q=F*G,B=0;B<F;++B,++I,++q){var x=j[I];j[I]=j[q],j[q]=x}var Z=s[r-1];s[r-1]=s[G],s[G]=Z;for(I=F*(r-1),q=F*(G=v(z,a,M,r-1,j,s,l)),B=0;B<F;++B,++I,++q){x=j[I];j[I]=j[q],j[q]=x}Z=s[r-1];if(s[r-1]=s[G],s[G]=Z,W<G){for(r=G-1;M<r&&j[F*(r-1)+a]===l;)r-=1;r+=1}else{if(!(G<W))break;for(M=G+1;M<r&&j[F*M+a]===l;)M+=1}}return v(z,a,K,W,j,s,j[F*W+a])};var v=K(12224)("lo<p0",["p0"]),T=8;function m(z,a,K,v,T,m){for(var p=2*z,j=p*(K+1)+a,s=K+1;s<v;++s,j+=p)for(var M=T[j],r=s,W=p*(s-1);r>K&&T[W+a]>M;--r,W-=p){for(var F=W,G=W+p,l=0;l<p;++l,++F,++G){var V=T[F];T[F]=T[G],T[G]=V}var c=m[r];m[r]=m[r-1],m[r-1]=c}}},12224:z=>{"use strict";z.exports=function(z,K){var v="abcdef".split("").concat(K),T=[];z.indexOf("lo")>=0&&T.push("lo=e[k+n]");z.indexOf("hi")>=0&&T.push("hi=e[k+o]");return v.push(a.replace("_",T.join()).replace("$",z)),Function.apply(void 0,v)};var a="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12195:z=>{"use strict";z.exports=function(z,v){v<=4*a?K(0,v-1,z):M(0,v-1,z)};var a=32;function K(z,a,K){for(var v=2*(z+1),T=z+1;T<=a;++T){for(var m=K[v++],p=K[v++],j=T,s=v-2;j-- >z;){var M=K[s-2],r=K[s-1];if(M<m)break;if(M===m&&r<p)break;K[s]=M,K[s+1]=r,s-=2}K[s]=m,K[s+1]=p}}function v(z,a,K){a*=2;var v=K[z*=2],T=K[z+1];K[z]=K[a],K[z+1]=K[a+1],K[a]=v,K[a+1]=T}function T(z,a,K){a*=2,K[z*=2]=K[a],K[z+1]=K[a+1]}function m(z,a,K,v){a*=2,K*=2;var T=v[z*=2],m=v[z+1];v[z]=v[a],v[z+1]=v[a+1],v[a]=v[K],v[a+1]=v[K+1],v[K]=T,v[K+1]=m}function p(z,a,K,v,T){a*=2,T[z*=2]=T[a],T[a]=K,T[z+1]=T[a+1],T[a+1]=v}function j(z,a,K){a*=2;var v=K[z*=2],T=K[a];return!(v<T)&&(v!==T||K[z+1]>K[a+1])}function s(z,a,K,v){var T=v[z*=2];return T<a||T===a&&v[z+1]<K}function M(z,r,W){var F=(r-z+1)/6|0,G=z+F,l=r-F,V=z+r>>1,c=V-F,C=V+F,w=G,H=c,f=V,Y=C,I=l,q=z+1,B=r-1,x=0;j(w,H,W)&&(x=w,w=H,H=x),j(Y,I,W)&&(x=Y,Y=I,I=x),j(w,f,W)&&(x=w,w=f,f=x),j(H,f,W)&&(x=H,H=f,f=x),j(w,Y,W)&&(x=w,w=Y,Y=x),j(f,Y,W)&&(x=f,f=Y,Y=x),j(H,I,W)&&(x=H,H=I,I=x),j(H,f,W)&&(x=H,H=f,f=x),j(Y,I,W)&&(x=Y,Y=I,I=x);for(var Z=W[2*H],y=W[2*H+1],i=W[2*Y],n=W[2*Y+1],X=2*w,P=2*f,J=2*I,o=2*G,N=2*V,A=2*l,g=0;g<2;++g){var d=W[X+g],t=W[P+g],e=W[J+g];W[o+g]=d,W[N+g]=t,W[A+g]=e}T(c,z,W),T(C,r,W);for(var L=q;L<=B;++L)if(s(L,Z,y,W))L!==q&&v(L,q,W),++q;else if(!s(L,i,n,W))for(;;){if(s(B,i,n,W)){s(B,Z,y,W)?(m(L,q,B,W),++q,--B):(v(L,B,W),--B);break}if(--B<L)break}p(z,q-1,Z,y,W),p(r,B+1,i,n,W),q-2-z<=a?K(z,q-2,W):M(z,q-2,W),r-(B+2)<=a?K(B+2,r,W):M(B+2,r,W),B-q<=a?K(q,B,W):M(q,B,W)}},12187:(z,a,K)=>{"use strict";z.exports={init:function(z){var a=T.nextPow2(z);s.length<a&&(v.free(s),s=v.mallocInt32(a));M.length<a&&(v.free(M),M=v.mallocInt32(a));r.length<a&&(v.free(r),r=v.mallocInt32(a));W.length<a&&(v.free(W),W=v.mallocInt32(a));F.length<a&&(v.free(F),F=v.mallocInt32(a));G.length<a&&(v.free(G),G=v.mallocInt32(a));var K=8*a;l.length<K&&(v.free(l),l=v.mallocDouble(K))},sweepBipartite:function(z,a,K,v,T,j,F,G,C,w){for(var H=0,f=2*z,Y=z-1,I=f-1,q=K;q<v;++q){var B=j[q],x=f*q;l[H++]=T[x+Y],l[H++]=-(B+1),l[H++]=T[x+I],l[H++]=B}for(q=F;q<G;++q){B=w[q]+p;var Z=f*q;l[H++]=C[Z+Y],l[H++]=-B,l[H++]=C[Z+I],l[H++]=B}var y=H>>>1;m(l,y);var i=0,n=0;for(q=0;q<y;++q){var X=0|l[2*q+1];if(X>=p)V(r,W,n--,X=X-p|0);else if(X>=0)V(s,M,i--,X);else if(X<=-p){X=-X-p|0;for(var P=0;P<i;++P){if(void 0!==(J=a(s[P],X)))return J}c(r,W,n++,X)}else{X=-X-1|0;for(P=0;P<n;++P){var J;if(void 0!==(J=a(X,r[P])))return J}c(s,M,i++,X)}}},sweepComplete:function(z,a,K,v,T,p,j,C,w,H){for(var f=0,Y=2*z,I=z-1,q=Y-1,B=K;B<v;++B){var x=p[B]+1<<1,Z=Y*B;l[f++]=T[Z+I],l[f++]=-x,l[f++]=T[Z+q],l[f++]=x}for(B=j;B<C;++B){x=H[B]+1<<1;var y=Y*B;l[f++]=w[y+I],l[f++]=1|-x,l[f++]=w[y+q],l[f++]=1|x}var i=f>>>1;m(l,i);var n=0,X=0,P=0;for(B=0;B<i;++B){var J=0|l[2*B+1],o=1&J;if(B<i-1&&J>>1===l[2*B+3]>>1&&(o=2,B+=1),J<0){for(var N=-(J>>1)-1,A=0;A<P;++A){if(void 0!==(g=a(F[A],N)))return g}if(0!==o)for(A=0;A<n;++A){if(void 0!==(g=a(s[A],N)))return g}if(1!==o)for(A=0;A<X;++A){var g;if(void 0!==(g=a(r[A],N)))return g}0===o?c(s,M,n++,N):1===o?c(r,W,X++,N):2===o&&c(F,G,P++,N)}else{N=(J>>1)-1;0===o?V(s,M,n--,N):1===o?V(r,W,X--,N):2===o&&V(F,G,P--,N)}}},scanBipartite:function(z,a,K,v,T,j,r,W,F,G,C,w){var H=0,f=2*z,Y=a,I=a+z,q=1,B=1;v?B=p:q=p;for(var x=T;x<j;++x){var Z=x+q,y=f*x;l[H++]=r[y+Y],l[H++]=-Z,l[H++]=r[y+I],l[H++]=Z}for(x=F;x<G;++x){Z=x+B;var i=f*x;l[H++]=C[i+Y],l[H++]=-Z}var n=H>>>1;m(l,n);var X=0;for(x=0;x<n;++x){var P=0|l[2*x+1];if(P<0){var J=!1;if((Z=-P)>=p?(J=!v,Z-=p):(J=!!v,Z-=1),J)c(s,M,X++,Z);else{var o=w[Z],N=f*Z,A=C[N+a+1],g=C[N+a+1+z];z:for(var d=0;d<X;++d){var t=s[d],e=f*t;if(!(g<r[e+a+1]||r[e+a+1+z]<A)){for(var L=a+2;L<z;++L)if(C[N+L+z]<r[e+L]||r[e+L+z]<C[N+L])continue z;var E,b=W[t];if(void 0!==(E=v?K(o,b):K(b,o)))return E}}}}else V(s,M,X--,P-q)}},scanComplete:function(z,a,K,v,T,j,M,r,W,F,G){for(var V=0,c=2*z,C=a,w=a+z,H=v;H<T;++H){var f=H+p,Y=c*H;l[V++]=j[Y+C],l[V++]=-f,l[V++]=j[Y+w],l[V++]=f}for(H=r;H<W;++H){f=H+1;var I=c*H;l[V++]=F[I+C],l[V++]=-f}var q=V>>>1;m(l,q);var B=0;for(H=0;H<q;++H){var x=0|l[2*H+1];if(x<0){if((f=-x)>=p)s[B++]=f-p;else{var Z=G[f-=1],y=c*f,i=F[y+a+1],n=F[y+a+1+z];z:for(var X=0;X<B;++X){var P=s[X],J=M[P];if(J===Z)break;var o=c*P;if(!(n<j[o+a+1]||j[o+a+1+z]<i)){for(var N=a+2;N<z;++N)if(F[y+N+z]<j[o+N]||j[o+N+z]<F[y+N])continue z;var A=K(J,Z);if(void 0!==A)return A}}}}else{for(f=x-p,X=B-1;X>=0;--X)if(s[X]===f){for(N=X+1;N<B;++N)s[N-1]=s[N];break}--B}}}};var v=K(12163),T=K(12170),m=K(12195),p=1<<28,j=1024,s=v.mallocInt32(j),M=v.mallocInt32(j),r=v.mallocInt32(j),W=v.mallocInt32(j),F=v.mallocInt32(j),G=v.mallocInt32(j),l=v.mallocDouble(8192);function V(z,a,K,v){var T=a[v],m=z[K-1];z[T]=m,a[m]=T}function c(z,a,K,v){z[K]=v,a[v]=K}},12311:z=>{"use strict";z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12308:(z,a,K)=>{var v=K(12311),T=K(12315),m=Object.hasOwnProperty,p=Object.create(null);for(var j in v)m.call(v,j)&&(p[v[j]]=j);var s=z.exports={to:{},get:{}};function M(z,a,K){return Math.min(Math.max(a,z),K)}function r(z){var a=Math.round(z).toString(16).toUpperCase();return a.length<2?"0"+a:a}s.get=function(z){var a,K;switch(z.substring(0,3).toLowerCase()){case"hsl":a=s.get.hsl(z),K="hsl";break;case"hwb":a=s.get.hwb(z),K="hwb";break;default:a=s.get.rgb(z),K="rgb"}return a?{model:K,value:a}:null},s.get.rgb=function(z){if(!z)return null;var a,K,T,p=[0,0,0,1];if(a=z.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(T=a[2],a=a[1],K=0;K<3;K++){var j=2*K;p[K]=parseInt(a.slice(j,j+2),16)}T&&(p[3]=parseInt(T,16)/255)}else if(a=z.match(/^#([a-f0-9]{3,4})$/i)){for(T=(a=a[1])[3],K=0;K<3;K++)p[K]=parseInt(a[K]+a[K],16);T&&(p[3]=parseInt(T+T,16)/255)}else if(a=z.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(K=0;K<3;K++)p[K]=parseInt(a[K+1],0);a[4]&&(a[5]?p[3]=.01*parseFloat(a[4]):p[3]=parseFloat(a[4]))}else{if(!(a=z.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(a=z.match(/^(\w+)$/))?"transparent"===a[1]?[0,0,0,0]:m.call(v,a[1])?((p=v[a[1]])[3]=1,p):null:null;for(K=0;K<3;K++)p[K]=Math.round(2.55*parseFloat(a[K+1]));a[4]&&(a[5]?p[3]=.01*parseFloat(a[4]):p[3]=parseFloat(a[4]))}for(K=0;K<3;K++)p[K]=M(p[K],0,255);return p[3]=M(p[3],0,1),p},s.get.hsl=function(z){if(!z)return null;var a=z.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(a){var K=parseFloat(a[4]);return[(parseFloat(a[1])%360+360)%360,M(parseFloat(a[2]),0,100),M(parseFloat(a[3]),0,100),M(isNaN(K)?1:K,0,1)]}return null},s.get.hwb=function(z){if(!z)return null;var a=z.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(a){var K=parseFloat(a[4]);return[(parseFloat(a[1])%360+360)%360,M(parseFloat(a[2]),0,100),M(parseFloat(a[3]),0,100),M(isNaN(K)?1:K,0,1)]}return null},s.to.hex=function(){var z=T(arguments);return"#"+r(z[0])+r(z[1])+r(z[2])+(z[3]<1?r(Math.round(255*z[3])):"")},s.to.rgb=function(){var z=T(arguments);return z.length<4||1===z[3]?"rgb("+Math.round(z[0])+", "+Math.round(z[1])+", "+Math.round(z[2])+")":"rgba("+Math.round(z[0])+", "+Math.round(z[1])+", "+Math.round(z[2])+", "+z[3]+")"},s.to.rgb.percent=function(){var z=T(arguments),a=Math.round(z[0]/255*100),K=Math.round(z[1]/255*100),v=Math.round(z[2]/255*100);return z.length<4||1===z[3]?"rgb("+a+"%, "+K+"%, "+v+"%)":"rgba("+a+"%, "+K+"%, "+v+"%, "+z[3]+")"},s.to.hsl=function(){var z=T(arguments);return z.length<4||1===z[3]?"hsl("+z[0]+", "+z[1]+"%, "+z[2]+"%)":"hsla("+z[0]+", "+z[1]+"%, "+z[2]+"%, "+z[3]+")"},s.to.hwb=function(){var z=T(arguments),a="";return z.length>=4&&1!==z[3]&&(a=", "+z[3]),"hwb("+z[0]+", "+z[1]+"%, "+z[2]+"%"+a+")"},s.to.keyword=function(z){return p[z.slice(0,3)]}},12301:(z,a,K)=>{const v=K(12308),T=K(12328),m=["keyword","gray","hex"],p={};for(const G of Object.keys(T))p[[...T[G].labels].sort().join("")]=G;const j={};function s(z,a){if(!(this instanceof s))return new s(z,a);if(a&&a in m&&(a=null),a&&!(a in T))throw new Error("Unknown model: "+a);let K,M;if(null==z)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(z instanceof s)this.model=z.model,this.color=[...z.color],this.valpha=z.valpha;else if("string"===typeof z){const a=v.get(z);if(null===a)throw new Error("Unable to parse color from string: "+z);this.model=a.model,M=T[this.model].channels,this.color=a.value.slice(0,M),this.valpha="number"===typeof a.value[M]?a.value[M]:1}else if(z.length>0){this.model=a||"rgb",M=T[this.model].channels;const K=Array.prototype.slice.call(z,0,M);this.color=F(K,M),this.valpha="number"===typeof z[M]?z[M]:1}else if("number"===typeof z)this.model="rgb",this.color=[z>>16&255,z>>8&255,255&z],this.valpha=1;else{this.valpha=1;const a=Object.keys(z);"alpha"in z&&(a.splice(a.indexOf("alpha"),1),this.valpha="number"===typeof z.alpha?z.alpha:0);const v=a.sort().join("");if(!(v in p))throw new Error("Unable to parse color from object: "+JSON.stringify(z));this.model=p[v];const{labels:m}=T[this.model],j=[];for(K=0;K<m.length;K++)j.push(z[m[K]]);this.color=F(j)}if(j[this.model])for(M=T[this.model].channels,K=0;K<M;K++){const z=j[this.model][K];z&&(this.color[K]=z(this.color[K]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}s.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(z){let a=this.model in v.to?this:this.rgb();a=a.round("number"===typeof z?z:1);const K=1===a.valpha?a.color:[...a.color,this.valpha];return v.to[a.model](K)},percentString(z){const a=this.rgb().round("number"===typeof z?z:1),K=1===a.valpha?a.color:[...a.color,this.valpha];return v.to.rgb.percent(K)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const z={},{channels:a}=T[this.model],{labels:K}=T[this.model];for(let v=0;v<a;v++)z[K[v]]=this.color[v];return 1!==this.valpha&&(z.alpha=this.valpha),z},unitArray(){const z=this.rgb().color;return z[0]/=255,z[1]/=255,z[2]/=255,1!==this.valpha&&z.push(this.valpha),z},unitObject(){const z=this.rgb().object();return z.r/=255,z.g/=255,z.b/=255,1!==this.valpha&&(z.alpha=this.valpha),z},round(z){return z=Math.max(z||0,0),new s([...this.color.map(M(z)),this.valpha],this.model)},alpha(z){return void 0!==z?new s([...this.color,Math.max(0,Math.min(1,z))],this.model):this.valpha},red:r("rgb",0,W(255)),green:r("rgb",1,W(255)),blue:r("rgb",2,W(255)),hue:r(["hsl","hsv","hsl","hwb","hcg"],0,(z=>(z%360+360)%360)),saturationl:r("hsl",1,W(100)),lightness:r("hsl",2,W(100)),saturationv:r("hsv",1,W(100)),value:r("hsv",2,W(100)),chroma:r("hcg",1,W(100)),gray:r("hcg",2,W(100)),white:r("hwb",1,W(100)),wblack:r("hwb",2,W(100)),cyan:r("cmyk",0,W(100)),magenta:r("cmyk",1,W(100)),yellow:r("cmyk",2,W(100)),black:r("cmyk",3,W(100)),x:r("xyz",0,W(95.047)),y:r("xyz",1,W(100)),z:r("xyz",2,W(108.833)),l:r("lab",0,W(100)),a:r("lab",1),b:r("lab",2),keyword(z){return void 0!==z?new s(z):T[this.model].keyword(this.color)},hex(z){return void 0!==z?new s(z):v.to.hex(this.rgb().round().color)},hexa(z){if(void 0!==z)return new s(z);const a=this.rgb().round().color;let K=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===K.length&&(K="0"+K),v.to.hex(a)+K},rgbNumber(){const z=this.rgb().color;return(255&z[0])<<16|(255&z[1])<<8|255&z[2]},luminosity(){const z=this.rgb().color,a=[];for(const[K,v]of z.entries()){const z=v/255;a[K]=z<=.04045?z/12.92:((z+.055)/1.055)**2.4}return.2126*a[0]+.7152*a[1]+.0722*a[2]},contrast(z){const a=this.luminosity(),K=z.luminosity();return a>K?(a+.05)/(K+.05):(K+.05)/(a+.05)},level(z){const a=this.contrast(z);return a>=7?"AAA":a>=4.5?"AA":""},isDark(){const z=this.rgb().color;return(2126*z[0]+7152*z[1]+722*z[2])/1e4<128},isLight(){return!this.isDark()},negate(){const z=this.rgb();for(let a=0;a<3;a++)z.color[a]=255-z.color[a];return z},lighten(z){const a=this.hsl();return a.color[2]+=a.color[2]*z,a},darken(z){const a=this.hsl();return a.color[2]-=a.color[2]*z,a},saturate(z){const a=this.hsl();return a.color[1]+=a.color[1]*z,a},desaturate(z){const a=this.hsl();return a.color[1]-=a.color[1]*z,a},whiten(z){const a=this.hwb();return a.color[1]+=a.color[1]*z,a},blacken(z){const a=this.hwb();return a.color[2]+=a.color[2]*z,a},grayscale(){const z=this.rgb().color,a=.3*z[0]+.59*z[1]+.11*z[2];return s.rgb(a,a,a)},fade(z){return this.alpha(this.valpha-this.valpha*z)},opaquer(z){return this.alpha(this.valpha+this.valpha*z)},rotate(z){const a=this.hsl();let K=a.color[0];return K=(K+z)%360,K=K<0?360+K:K,a.color[0]=K,a},mix(z,a){if(!z||!z.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof z);const K=z.rgb(),v=this.rgb(),T=void 0===a?.5:a,m=2*T-1,p=K.alpha()-v.alpha(),j=((m*p===-1?m:(m+p)/(1+m*p))+1)/2,M=1-j;return s.rgb(j*K.red()+M*v.red(),j*K.green()+M*v.green(),j*K.blue()+M*v.blue(),K.alpha()*T+v.alpha()*(1-T))}};for(const G of Object.keys(T)){if(m.includes(G))continue;const{channels:z}=T[G];s.prototype[G]=function(){if(this.model===G)return new s(this);for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];return a.length>0?new s(a,G):new s([...(v=T[this.model][G].raw(this.color),Array.isArray(v)?v:[v]),this.valpha],G);var v},s[G]=function(){for(var a=arguments.length,K=new Array(a),v=0;v<a;v++)K[v]=arguments[v];let T=K[0];return"number"===typeof T&&(T=F(K,z)),new s(T,G)}}function M(z){return function(a){return function(z,a){return Number(z.toFixed(a))}(a,z)}}function r(z,a,K){z=Array.isArray(z)?z:[z];for(const v of z)(j[v]||(j[v]=[]))[a]=K;return z=z[0],function(v){let T;return void 0!==v?(K&&(v=K(v)),T=this[z](),T.color[a]=v,T):(T=this[z]().color[a],K&&(T=K(T)),T)}}function W(z){return function(a){return Math.max(0,Math.min(z,a))}}function F(z,a){for(let K=0;K<a;K++)"number"!==typeof z[K]&&(z[K]=0);return z}z.exports=s},12334:(z,a,K)=>{const v=K(12340),T={};for(const p of Object.keys(v))T[v[p]]=p;const m={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};z.exports=m;for(const p of Object.keys(m)){if(!("channels"in m[p]))throw new Error("missing channels property: "+p);if(!("labels"in m[p]))throw new Error("missing channel labels property: "+p);if(m[p].labels.length!==m[p].channels)throw new Error("channel and label counts mismatch: "+p);const{channels:z,labels:a}=m[p];delete m[p].channels,delete m[p].labels,Object.defineProperty(m[p],"channels",{value:z}),Object.defineProperty(m[p],"labels",{value:a})}m.rgb.hsl=function(z){const a=z[0]/255,K=z[1]/255,v=z[2]/255,T=Math.min(a,K,v),m=Math.max(a,K,v),p=m-T;let j,s;m===T?j=0:a===m?j=(K-v)/p:K===m?j=2+(v-a)/p:v===m&&(j=4+(a-K)/p),j=Math.min(60*j,360),j<0&&(j+=360);const M=(T+m)/2;return s=m===T?0:M<=.5?p/(m+T):p/(2-m-T),[j,100*s,100*M]},m.rgb.hsv=function(z){let a,K,v,T,m;const p=z[0]/255,j=z[1]/255,s=z[2]/255,M=Math.max(p,j,s),r=M-Math.min(p,j,s),W=function(z){return(M-z)/6/r+.5};return 0===r?(T=0,m=0):(m=r/M,a=W(p),K=W(j),v=W(s),p===M?T=v-K:j===M?T=1/3+a-v:s===M&&(T=2/3+K-a),T<0?T+=1:T>1&&(T-=1)),[360*T,100*m,100*M]},m.rgb.hwb=function(z){const a=z[0],K=z[1];let v=z[2];const T=m.rgb.hsl(z)[0],p=1/255*Math.min(a,Math.min(K,v));return v=1-1/255*Math.max(a,Math.max(K,v)),[T,100*p,100*v]},m.rgb.cmyk=function(z){const a=z[0]/255,K=z[1]/255,v=z[2]/255,T=Math.min(1-a,1-K,1-v);return[100*((1-a-T)/(1-T)||0),100*((1-K-T)/(1-T)||0),100*((1-v-T)/(1-T)||0),100*T]},m.rgb.keyword=function(z){const a=T[z];if(a)return a;let K,m=1/0;for(const T of Object.keys(v)){const a=v[T],s=(j=a,((p=z)[0]-j[0])**2+(p[1]-j[1])**2+(p[2]-j[2])**2);s<m&&(m=s,K=T)}var p,j;return K},m.keyword.rgb=function(z){return v[z]},m.rgb.xyz=function(z){let a=z[0]/255,K=z[1]/255,v=z[2]/255;a=a>.04045?((a+.055)/1.055)**2.4:a/12.92,K=K>.04045?((K+.055)/1.055)**2.4:K/12.92,v=v>.04045?((v+.055)/1.055)**2.4:v/12.92;return[100*(.4124*a+.3576*K+.1805*v),100*(.2126*a+.7152*K+.0722*v),100*(.0193*a+.1192*K+.9505*v)]},m.rgb.lab=function(z){const a=m.rgb.xyz(z);let K=a[0],v=a[1],T=a[2];K/=95.047,v/=100,T/=108.883,K=K>.008856?K**(1/3):7.787*K+16/116,v=v>.008856?v**(1/3):7.787*v+16/116,T=T>.008856?T**(1/3):7.787*T+16/116;return[116*v-16,500*(K-v),200*(v-T)]},m.hsl.rgb=function(z){const a=z[0]/360,K=z[1]/100,v=z[2]/100;let T,m,p;if(0===K)return p=255*v,[p,p,p];T=v<.5?v*(1+K):v+K-v*K;const j=2*v-T,s=[0,0,0];for(let M=0;M<3;M++)m=a+1/3*-(M-1),m<0&&m++,m>1&&m--,p=6*m<1?j+6*(T-j)*m:2*m<1?T:3*m<2?j+(T-j)*(2/3-m)*6:j,s[M]=255*p;return s},m.hsl.hsv=function(z){const a=z[0];let K=z[1]/100,v=z[2]/100,T=K;const m=Math.max(v,.01);v*=2,K*=v<=1?v:2-v,T*=m<=1?m:2-m;return[a,100*(0===v?2*T/(m+T):2*K/(v+K)),100*((v+K)/2)]},m.hsv.rgb=function(z){const a=z[0]/60,K=z[1]/100;let v=z[2]/100;const T=Math.floor(a)%6,m=a-Math.floor(a),p=255*v*(1-K),j=255*v*(1-K*m),s=255*v*(1-K*(1-m));switch(v*=255,T){case 0:return[v,s,p];case 1:return[j,v,p];case 2:return[p,v,s];case 3:return[p,j,v];case 4:return[s,p,v];case 5:return[v,p,j]}},m.hsv.hsl=function(z){const a=z[0],K=z[1]/100,v=z[2]/100,T=Math.max(v,.01);let m,p;p=(2-K)*v;const j=(2-K)*T;return m=K*T,m/=j<=1?j:2-j,m=m||0,p/=2,[a,100*m,100*p]},m.hwb.rgb=function(z){const a=z[0]/360;let K=z[1]/100,v=z[2]/100;const T=K+v;let m;T>1&&(K/=T,v/=T);const p=Math.floor(6*a),j=1-v;m=6*a-p,0!==(1&p)&&(m=1-m);const s=K+m*(j-K);let M,r,W;switch(p){default:case 6:case 0:M=j,r=s,W=K;break;case 1:M=s,r=j,W=K;break;case 2:M=K,r=j,W=s;break;case 3:M=K,r=s,W=j;break;case 4:M=s,r=K,W=j;break;case 5:M=j,r=K,W=s}return[255*M,255*r,255*W]},m.cmyk.rgb=function(z){const a=z[0]/100,K=z[1]/100,v=z[2]/100,T=z[3]/100;return[255*(1-Math.min(1,a*(1-T)+T)),255*(1-Math.min(1,K*(1-T)+T)),255*(1-Math.min(1,v*(1-T)+T))]},m.xyz.rgb=function(z){const a=z[0]/100,K=z[1]/100,v=z[2]/100;let T,m,p;return T=3.2406*a+-1.5372*K+-.4986*v,m=-.9689*a+1.8758*K+.0415*v,p=.0557*a+-.204*K+1.057*v,T=T>.0031308?1.055*T**(1/2.4)-.055:12.92*T,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,T=Math.min(Math.max(0,T),1),m=Math.min(Math.max(0,m),1),p=Math.min(Math.max(0,p),1),[255*T,255*m,255*p]},m.xyz.lab=function(z){let a=z[0],K=z[1],v=z[2];a/=95.047,K/=100,v/=108.883,a=a>.008856?a**(1/3):7.787*a+16/116,K=K>.008856?K**(1/3):7.787*K+16/116,v=v>.008856?v**(1/3):7.787*v+16/116;return[116*K-16,500*(a-K),200*(K-v)]},m.lab.xyz=function(z){let a,K,v;K=(z[0]+16)/116,a=z[1]/500+K,v=K-z[2]/200;const T=K**3,m=a**3,p=v**3;return K=T>.008856?T:(K-16/116)/7.787,a=m>.008856?m:(a-16/116)/7.787,v=p>.008856?p:(v-16/116)/7.787,a*=95.047,K*=100,v*=108.883,[a,K,v]},m.lab.lch=function(z){const a=z[0],K=z[1],v=z[2];let T;T=360*Math.atan2(v,K)/2/Math.PI,T<0&&(T+=360);return[a,Math.sqrt(K*K+v*v),T]},m.lch.lab=function(z){const a=z[0],K=z[1],v=z[2]/360*2*Math.PI;return[a,K*Math.cos(v),K*Math.sin(v)]},m.rgb.ansi16=function(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[K,v,T]=z;let p=null===a?m.rgb.hsv(z)[2]:a;if(p=Math.round(p/50),0===p)return 30;let j=30+(Math.round(T/255)<<2|Math.round(v/255)<<1|Math.round(K/255));return 2===p&&(j+=60),j},m.hsv.ansi16=function(z){return m.rgb.ansi16(m.hsv.rgb(z),z[2])},m.rgb.ansi256=function(z){const a=z[0],K=z[1],v=z[2];if(a===K&&K===v)return a<8?16:a>248?231:Math.round((a-8)/247*24)+232;return 16+36*Math.round(a/255*5)+6*Math.round(K/255*5)+Math.round(v/255*5)},m.ansi16.rgb=function(z){let a=z%10;if(0===a||7===a)return z>50&&(a+=3.5),a=a/10.5*255,[a,a,a];const K=.5*(1+~~(z>50));return[(1&a)*K*255,(a>>1&1)*K*255,(a>>2&1)*K*255]},m.ansi256.rgb=function(z){if(z>=232){const a=10*(z-232)+8;return[a,a,a]}let a;z-=16;return[Math.floor(z/36)/5*255,Math.floor((a=z%36)/6)/5*255,a%6/5*255]},m.rgb.hex=function(z){const a=(((255&Math.round(z[0]))<<16)+((255&Math.round(z[1]))<<8)+(255&Math.round(z[2]))).toString(16).toUpperCase();return"000000".substring(a.length)+a},m.hex.rgb=function(z){const a=z.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!a)return[0,0,0];let K=a[0];3===a[0].length&&(K=K.split("").map((z=>z+z)).join(""));const v=parseInt(K,16);return[v>>16&255,v>>8&255,255&v]},m.rgb.hcg=function(z){const a=z[0]/255,K=z[1]/255,v=z[2]/255,T=Math.max(Math.max(a,K),v),m=Math.min(Math.min(a,K),v),p=T-m;let j,s;return j=p<1?m/(1-p):0,s=p<=0?0:T===a?(K-v)/p%6:T===K?2+(v-a)/p:4+(a-K)/p,s/=6,s%=1,[360*s,100*p,100*j]},m.hsl.hcg=function(z){const a=z[1]/100,K=z[2]/100,v=K<.5?2*a*K:2*a*(1-K);let T=0;return v<1&&(T=(K-.5*v)/(1-v)),[z[0],100*v,100*T]},m.hsv.hcg=function(z){const a=z[1]/100,K=z[2]/100,v=a*K;let T=0;return v<1&&(T=(K-v)/(1-v)),[z[0],100*v,100*T]},m.hcg.rgb=function(z){const a=z[0]/360,K=z[1]/100,v=z[2]/100;if(0===K)return[255*v,255*v,255*v];const T=[0,0,0],m=a%1*6,p=m%1,j=1-p;let s=0;switch(Math.floor(m)){case 0:T[0]=1,T[1]=p,T[2]=0;break;case 1:T[0]=j,T[1]=1,T[2]=0;break;case 2:T[0]=0,T[1]=1,T[2]=p;break;case 3:T[0]=0,T[1]=j,T[2]=1;break;case 4:T[0]=p,T[1]=0,T[2]=1;break;default:T[0]=1,T[1]=0,T[2]=j}return s=(1-K)*v,[255*(K*T[0]+s),255*(K*T[1]+s),255*(K*T[2]+s)]},m.hcg.hsv=function(z){const a=z[1]/100,K=a+z[2]/100*(1-a);let v=0;return K>0&&(v=a/K),[z[0],100*v,100*K]},m.hcg.hsl=function(z){const a=z[1]/100,K=z[2]/100*(1-a)+.5*a;let v=0;return K>0&&K<.5?v=a/(2*K):K>=.5&&K<1&&(v=a/(2*(1-K))),[z[0],100*v,100*K]},m.hcg.hwb=function(z){const a=z[1]/100,K=a+z[2]/100*(1-a);return[z[0],100*(K-a),100*(1-K)]},m.hwb.hcg=function(z){const a=z[1]/100,K=1-z[2]/100,v=K-a;let T=0;return v<1&&(T=(K-v)/(1-v)),[z[0],100*v,100*T]},m.apple.rgb=function(z){return[z[0]/65535*255,z[1]/65535*255,z[2]/65535*255]},m.rgb.apple=function(z){return[z[0]/255*65535,z[1]/255*65535,z[2]/255*65535]},m.gray.rgb=function(z){return[z[0]/100*255,z[0]/100*255,z[0]/100*255]},m.gray.hsl=function(z){return[0,0,z[0]]},m.gray.hsv=m.gray.hsl,m.gray.hwb=function(z){return[0,100,z[0]]},m.gray.cmyk=function(z){return[0,0,0,z[0]]},m.gray.lab=function(z){return[z[0],0,0]},m.gray.hex=function(z){const a=255&Math.round(z[0]/100*255),K=((a<<16)+(a<<8)+a).toString(16).toUpperCase();return"000000".substring(K.length)+K},m.rgb.gray=function(z){return[(z[0]+z[1]+z[2])/3/255*100]}},12328:(z,a,K)=>{const v=K(12334),T=K(12345),m={};Object.keys(v).forEach((z=>{m[z]={},Object.defineProperty(m[z],"channels",{value:v[z].channels}),Object.defineProperty(m[z],"labels",{value:v[z].labels});const a=T(z);Object.keys(a).forEach((K=>{const v=a[K];m[z][K]=function(z){const a=function(){for(var a=arguments.length,K=new Array(a),v=0;v<a;v++)K[v]=arguments[v];const T=K[0];if(void 0===T||null===T)return T;T.length>1&&(K=T);const m=z(K);if("object"===typeof m)for(let z=m.length,p=0;p<z;p++)m[p]=Math.round(m[p]);return m};return"conversion"in z&&(a.conversion=z.conversion),a}(v),m[z][K].raw=function(z){const a=function(){for(var a=arguments.length,K=new Array(a),v=0;v<a;v++)K[v]=arguments[v];const T=K[0];return void 0===T||null===T?T:(T.length>1&&(K=T),z(K))};return"conversion"in z&&(a.conversion=z.conversion),a}(v)}))})),z.exports=m},12345:(z,a,K)=>{const v=K(12334);function T(z){const a=function(){const z={},a=Object.keys(v);for(let K=a.length,v=0;v<K;v++)z[a[v]]={distance:-1,parent:null};return z}(),K=[z];for(a[z].distance=0;K.length;){const z=K.pop(),T=Object.keys(v[z]);for(let v=T.length,m=0;m<v;m++){const v=T[m],p=a[v];-1===p.distance&&(p.distance=a[z].distance+1,p.parent=z,K.unshift(v))}}return a}function m(z,a){return function(K){return a(z(K))}}function p(z,a){const K=[a[z].parent,z];let T=v[a[z].parent][z],p=a[z].parent;for(;a[p].parent;)K.unshift(a[p].parent),T=m(v[a[p].parent][p],T),p=a[p].parent;return T.conversion=K,T}z.exports=function(z){const a=T(z),K={},v=Object.keys(a);for(let T=v.length,m=0;m<T;m++){const z=v[m];null!==a[z].parent&&(K[z]=p(z,a))}return K}},12340:z=>{"use strict";z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},10557:function(z,a,K){"use strict";var v=this&&this.__createBinding||(Object.create?function(z,a,K,v){void 0===v&&(v=K);var T=Object.getOwnPropertyDescriptor(a,K);T&&!("get"in T?!a.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return a[K]}}),Object.defineProperty(z,v,T)}:function(z,a,K,v){void 0===v&&(v=K),z[v]=a[K]}),T=this&&this.__setModuleDefault||(Object.create?function(z,a){Object.defineProperty(z,"default",{enumerable:!0,value:a})}:function(z,a){z.default=a}),m=this&&this.__importStar||function(z){if(z&&z.__esModule)return z;var a={};if(null!=z)for(var K in z)"default"!==K&&Object.prototype.hasOwnProperty.call(z,K)&&v(a,z,K);return T(a,z),a},p=this&&this.__awaiter||function(z,a,K,v){return new(K||(K=Promise))((function(T,m){function p(z){try{s(v.next(z))}catch(a){m(a)}}function j(z){try{s(v.throw(z))}catch(a){m(a)}}function s(z){var a;z.done?T(z.value):(a=z.value,a instanceof K?a:new K((function(z){z(a)}))).then(p,j)}s((v=v.apply(z,a||[])).next())}))};Object.defineProperty(a,"__esModule",{value:!0}),a.Auth=a.Platform=void 0;const j=m(K(10473)),s=K(10564),M="colyseus-auth-token";!function(z){z.ios="ios",z.android="android"}(a.Platform||(a.Platform={}));a.Auth=class{constructor(z){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=z.replace("ws","http"),(0,s.getItem)(M,(z=>this.token=z))}get hasToken(){return!!this.token}login(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return p(this,void 0,void 0,(function*(){const a=Object.assign({},z);this.hasToken&&(a.token=this.token);const K=yield this.request("post","/auth",a);this.token=K.token,(0,s.setItem)(M,this.token);for(let z in K)this.hasOwnProperty(z)&&(this[z]=K[z]);return this.registerPingService(),this}))}save(){return p(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return p(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return p(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return p(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(z){return p(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:z})}))}acceptFriendRequest(z){return p(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:z})}))}declineFriendRequest(z){return p(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:z})}))}blockUser(z){return p(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:z})}))}unblockUser(z){return p(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:z})}))}request(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},v=arguments.length>3?arguments[3]:void 0,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return p(this,void 0,void 0,(function*(){T.Accept="application/json",this.hasToken&&(T.Authorization="Bearer "+this.token);const m=[];for(const z in K)m.push(`${z}=${K[z]}`);const p=m.length>0?`?${m.join("&")}`:"",s={headers:T};return v&&(s.body=v),(yield j[z](`${this.endpoint}${a}${p}`,s)).data}))}logout(){this.token=void 0,(0,s.removeItem)(M),this.unregisterPingService()}registerPingService(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),z)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},10464:function(z,a,K){"use strict";var v,T=this&&this.__awaiter||function(z,a,K,v){return new(K||(K=Promise))((function(T,m){function p(z){try{s(v.next(z))}catch(a){m(a)}}function j(z){try{s(v.throw(z))}catch(a){m(a)}}function s(z){var a;z.done?T(z.value):(a=z.value,a instanceof K?a:new K((function(z){z(a)}))).then(p,j)}s((v=v.apply(z,a||[])).next())}))};Object.defineProperty(a,"__esModule",{value:!0}),a.Client=a.MatchMakeError=void 0;const m=K(10473),p=K(10476),j=K(10485);class s extends Error{constructor(z,a){super(z),this.code=a,Object.setPrototypeOf(this,s.prototype)}}a.MatchMakeError=s;const M="undefined"!==typeof window&&"undefined"!==typeof(null===(v=null===window||void 0===window?void 0:window.location)||void 0===v?void 0:v.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";a.Client=class{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M;if("string"===typeof z){const a=new URL(z),K="https:"===a.protocol||"wss:"===a.protocol,v=Number(a.port||(K?443:80));this.settings={hostname:a.hostname,pathname:"/"!==a.pathname?a.pathname:"",port:v,secure:K}}else void 0===z.port&&(z.port=z.secure?443:80),void 0===z.pathname&&(z.pathname=""),this.settings=z}joinOrCreate(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2?arguments[2]:void 0;return T(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",z,a,K)}))}create(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2?arguments[2]:void 0;return T(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",z,a,K)}))}join(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2?arguments[2]:void 0;return T(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",z,a,K)}))}joinById(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2?arguments[2]:void 0;return T(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",z,a,K)}))}reconnect(z,a){return T(this,void 0,void 0,(function*(){if("string"===typeof z&&"string"===typeof a)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[K,v]=z.split(":");return yield this.createMatchMakeRequest("reconnect",K,{reconnectionToken:v},a)}))}getAvailableRooms(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return T(this,void 0,void 0,(function*(){return(yield(0,m.get)(this.getHttpEndpoint(`${z}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(z,a,K){return T(this,void 0,void 0,(function*(){const v=this.createRoom(z.room.name,a);v.roomId=z.room.roomId,v.sessionId=z.sessionId;const m={sessionId:v.sessionId};z.reconnectionToken&&(m.reconnectionToken=z.reconnectionToken);const j=K||v;return v.connect(this.buildEndpoint(z.room,m),z.devMode&&(()=>T(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${v.roomId}'...`);let K=0;const m=()=>T(this,void 0,void 0,(function*(){K++;try{yield this.consumeSeatReservation(z,a,j),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${v.roomId}'`)}catch(T){K<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${K} out of 8)`),setTimeout(m,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(m,2e3)}))),j),new Promise(((z,a)=>{const K=(z,K)=>a(new p.ServerError(z,K));j.onError.once(K),j.onJoin.once((()=>{j.onError.remove(K),z(j)}))}))}))}createMatchMakeRequest(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},v=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0;return T(this,void 0,void 0,(function*(){const T=(yield(0,m.post)(this.getHttpEndpoint(`${z}/${a}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(K)})).data;if(T.error)throw new s(T.error,T.code);return"reconnect"===z&&(T.reconnectionToken=K.reconnectionToken),yield this.consumeSeatReservation(T,v,p)}))}createRoom(z,a){return new j.Room(z,a)}buildEndpoint(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const K=[];for(const T in a)a.hasOwnProperty(T)&&K.push(`${T}=${a[T]}`);let v=this.settings.secure?"wss://":"ws://";return z.publicAddress?v+=`${z.publicAddress}`:v+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${v}/${z.processId}/${z.roomId}?${K.join("&")}`}getHttpEndpoint(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${z}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},10499:(z,a,K)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Connection=void 0;const v=K(10507);a.Connection=class{constructor(){this.events={},this.transport=new v.WebSocketTransport(this.events)}send(z){this.transport.send(z)}connect(z){this.transport.connect(z)}close(z,a){this.transport.close(z,a)}get isOpen(){return this.transport.isOpen}}},10521:(z,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.utf8Length=a.utf8Read=a.ErrorCode=a.Protocol=void 0,function(z){z[z.HANDSHAKE=9]="HANDSHAKE",z[z.JOIN_ROOM=10]="JOIN_ROOM",z[z.ERROR=11]="ERROR",z[z.LEAVE_ROOM=12]="LEAVE_ROOM",z[z.ROOM_DATA=13]="ROOM_DATA",z[z.ROOM_STATE=14]="ROOM_STATE",z[z.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",z[z.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",z[z.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(a.Protocol||(a.Protocol={})),function(z){z[z.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",z[z.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",z[z.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",z[z.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",z[z.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",z[z.AUTH_FAILED=4215]="AUTH_FAILED",z[z.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(a.ErrorCode||(a.ErrorCode={})),a.utf8Read=function(z,a){const K=z[a++];for(var v="",T=0,m=a,p=a+K;m<p;m++){var j=z[m];if(0!==(128&j))if(192!==(224&j))if(224!==(240&j)){if(240!==(248&j))throw new Error("Invalid byte "+j.toString(16));(T=(7&j)<<18|(63&z[++m])<<12|(63&z[++m])<<6|63&z[++m])>=65536?(T-=65536,v+=String.fromCharCode(55296+(T>>>10),56320+(1023&T))):v+=String.fromCharCode(T)}else v+=String.fromCharCode((15&j)<<12|(63&z[++m])<<6|63&z[++m]);else v+=String.fromCharCode((31&j)<<6|63&z[++m]);else v+=String.fromCharCode(j)}return v},a.utf8Length=function(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=0,K=0;for(let v=0,T=z.length;v<T;v++)a=z.charCodeAt(v),a<128?K+=1:a<2048?K+=2:a<55296||a>=57344?K+=3:(v++,K+=4);return K+1}},10485:function(z,a,K){"use strict";var v=this&&this.__createBinding||(Object.create?function(z,a,K,v){void 0===v&&(v=K);var T=Object.getOwnPropertyDescriptor(a,K);T&&!("get"in T?!a.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return a[K]}}),Object.defineProperty(z,v,T)}:function(z,a,K,v){void 0===v&&(v=K),z[v]=a[K]}),T=this&&this.__setModuleDefault||(Object.create?function(z,a){Object.defineProperty(z,"default",{enumerable:!0,value:a})}:function(z,a){z.default=a}),m=this&&this.__importStar||function(z){if(z&&z.__esModule)return z;var a={};if(null!=z)for(var K in z)"default"!==K&&Object.prototype.hasOwnProperty.call(z,K)&&v(a,z,K);return T(a,z),a};Object.defineProperty(a,"__esModule",{value:!0}),a.Room=void 0;const p=m(K(10491)),j=K(10499),s=K(10521),M=K(10529),r=K(10535),W=K(10540),F=K(10548),G=K(10476);class l{constructor(z,a){this.onStateChange=(0,W.createSignal)(),this.onError=(0,W.createSignal)(),this.onLeave=(0,W.createSignal)(),this.onJoin=(0,W.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,r.createNanoEvents)(),this.roomId=null,this.name=z,a&&(this.serializer=new((0,M.getSerializer)("schema")),this.rootSchema=a,this.serializer.state=new a),this.onError(((z,a)=>{var K;return null===(K=console.warn)||void 0===K?void 0:K.call(console,`colyseus.js - onError => (${z}) ${a}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const v=new j.Connection;K.connection=v,v.events.onmessage=l.prototype.onMessageCallback.bind(K),v.events.onclose=function(z){var v;if(!K.hasJoined)return null===(v=console.warn)||void 0===v||v.call(console,`Room connection was closed unexpectedly (${z.code}): ${z.reason}`),void K.onError.invoke(z.code,z.reason);z.code===G.CloseCode.DEVMODE_RESTART&&a?a():(K.onLeave.invoke(z.code),K.destroy())},v.events.onerror=function(z){var a;null===(a=console.warn)||void 0===a||a.call(console,`Room, onError (${z.code}): ${z.reason}`),K.onError.invoke(z.code,z.reason)},v.connect(z)}leave(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((a=>{this.onLeave((z=>a(z))),this.connection?z?this.connection.send([s.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(G.CloseCode.CONSENTED)}))}onMessage(z,a){return this.onMessageHandlers.on(this.getMessageHandlerKey(z),a)}send(z,a){const K=[s.Protocol.ROOM_DATA];let v;if("string"===typeof z?F.encode.string(K,z):F.encode.number(K,z),void 0!==a){const z=p.encode(a);v=new Uint8Array(K.length+z.byteLength),v.set(new Uint8Array(K),0),v.set(new Uint8Array(z),K.length)}else v=new Uint8Array(K);this.connection.send(v.buffer)}sendBytes(z,a){const K=[s.Protocol.ROOM_DATA_BYTES];let v;"string"===typeof z?F.encode.string(K,z):F.encode.number(K,z),v=new Uint8Array(K.length+(a.byteLength||a.length)),v.set(new Uint8Array(K),0),v.set(new Uint8Array(a),K.length),this.connection.send(v.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(z){const a=Array.from(new Uint8Array(z.data)),K=a[0];if(K===s.Protocol.JOIN_ROOM){let z=1;const K=(0,s.utf8Read)(a,z);if(z+=(0,s.utf8Length)(K),this.serializerId=(0,s.utf8Read)(a,z),z+=(0,s.utf8Length)(this.serializerId),!this.serializer){const z=(0,M.getSerializer)(this.serializerId);this.serializer=new z}a.length>z&&this.serializer.handshake&&this.serializer.handshake(a,{offset:z}),this.reconnectionToken=`${this.roomId}:${K}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([s.Protocol.JOIN_ROOM])}else if(K===s.Protocol.ERROR){const z={offset:1},K=F.decode.number(a,z),v=F.decode.string(a,z);this.onError.invoke(K,v)}else if(K===s.Protocol.LEAVE_ROOM)this.leave();else if(K===s.Protocol.ROOM_DATA_SCHEMA){const z={offset:1},K=this.serializer.getState().constructor._context.get(F.decode.number(a,z)),v=new K;v.decode(a,z),this.dispatchMessage(K,v)}else if(K===s.Protocol.ROOM_STATE)a.shift(),this.setState(a);else if(K===s.Protocol.ROOM_STATE_PATCH)a.shift(),this.patch(a);else if(K===s.Protocol.ROOM_DATA){const K={offset:1},v=F.decode.stringCheck(a,K)?F.decode.string(a,K):F.decode.number(a,K),T=a.length>K.offset?p.decode(z.data,K.offset):void 0;this.dispatchMessage(v,T)}else if(K===s.Protocol.ROOM_DATA_BYTES){const z={offset:1},K=F.decode.stringCheck(a,z)?F.decode.string(a,z):F.decode.number(a,z);this.dispatchMessage(K,new Uint8Array(a.slice(z.offset)))}}setState(z){this.serializer.setState(z),this.onStateChange.invoke(this.serializer.getState())}patch(z){this.serializer.patch(z),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(z,a){var K;const v=this.getMessageHandlerKey(z);this.onMessageHandlers.events[v]?this.onMessageHandlers.emit(v,a):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",z,a):null===(K=console.warn)||void 0===K||K.call(console,`colyseus.js: onMessage() not registered for type '${z}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(z){switch(typeof z){case"function":return`$${z._typeid}`;case"string":return z;case"number":return`i${z}`;default:throw new Error("invalid message type.")}}}a.Room=l},10564:(z,a)=>{"use strict";let K;function v(){return K||(K="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(z,a){this.cache[z]=a},getItem:function(z){this.cache[z]},removeItem:function(z){delete this.cache[z]}}),K}Object.defineProperty(a,"__esModule",{value:!0}),a.getItem=a.removeItem=a.setItem=void 0,a.setItem=function(z,a){v().setItem(z,a)},a.removeItem=function(z){v().removeItem(z)},a.getItem=function(z,a){const K=v().getItem(z);"undefined"!==typeof Promise&&K instanceof Promise?K.then((z=>a(z))):a(K)}},10535:(z,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.createNanoEvents=void 0;a.createNanoEvents=()=>({emit(z){let a=this.events[z]||[];for(var K=arguments.length,v=new Array(K>1?K-1:0),T=1;T<K;T++)v[T-1]=arguments[T];for(let m=0,p=a.length;m<p;m++)a[m](...v)},events:{},on(z,a){var K;return(null===(K=this.events[z])||void 0===K?void 0:K.push(a))||(this.events[z]=[a]),()=>{var K;this.events[z]=null===(K=this.events[z])||void 0===K?void 0:K.filter((z=>a!==z))}}})},10540:(z,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.createSignal=a.EventEmitter=void 0;class K{constructor(){this.handlers=[]}register(z){return this.handlers.push(z),this}invoke(){for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];this.handlers.forEach((z=>z.apply(this,a)))}invokeAsync(){for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];return Promise.all(this.handlers.map((z=>z.apply(this,a))))}remove(z){const a=this.handlers.indexOf(z);this.handlers[a]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}a.EventEmitter=K,a.createSignal=function(){const z=new K;function a(a){return z.register(a,null===this)}return a.once=a=>{const K=function(){for(var v=arguments.length,T=new Array(v),m=0;m<v;m++)T[m]=arguments[m];a.apply(this,T),z.remove(K)};z.register(K)},a.remove=a=>z.remove(a),a.invoke=function(){return z.invoke(...arguments)},a.invokeAsync=function(){return z.invokeAsync(...arguments)},a.clear=()=>z.clear(),a}},10476:(z,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ServerError=a.CloseCode=void 0,function(z){z[z.CONSENTED=4e3]="CONSENTED",z[z.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(a.CloseCode||(a.CloseCode={}));class K extends Error{constructor(z,a){super(a),this.name="ServerError",this.code=z}}a.ServerError=K},10457:(z,a,K)=>{"use strict";a.b=void 0,K(10461);var v=K(10464);Object.defineProperty(a,"b",{enumerable:!0,get:function(){return v.Client}});var T=K(10521);var m=K(10485);var p=K(10557);const j=K(10568);const s=K(10574),M=K(10529);(0,M.registerSerializer)("schema",j.SchemaSerializer),(0,M.registerSerializer)("none",s.NoneSerializer)},10461:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=z=>null!==z&&"object"===typeof z&&z.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},10491:(z,a)=>{"use strict";function K(z,a){if(this._offset=a,z instanceof ArrayBuffer)this._buffer=z,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(z))throw new Error("Invalid argument");this._buffer=z.buffer,this._view=new DataView(this._buffer,z.byteOffset,z.byteLength)}}Object.defineProperty(a,"__esModule",{value:!0}),a.decode=a.encode=void 0,K.prototype._array=function(z){for(var a=new Array(z),K=0;K<z;K++)a[K]=this._parse();return a},K.prototype._map=function(z){for(var a={},K=0;K<z;K++)a[this._parse()]=this._parse();return a},K.prototype._str=function(z){var a=function(z,a,K){for(var v="",T=0,m=a,p=a+K;m<p;m++){var j=z.getUint8(m);if(0!==(128&j))if(192!==(224&j))if(224!==(240&j)){if(240!==(248&j))throw new Error("Invalid byte "+j.toString(16));(T=(7&j)<<18|(63&z.getUint8(++m))<<12|(63&z.getUint8(++m))<<6|63&z.getUint8(++m))>=65536?(T-=65536,v+=String.fromCharCode(55296+(T>>>10),56320+(1023&T))):v+=String.fromCharCode(T)}else v+=String.fromCharCode((15&j)<<12|(63&z.getUint8(++m))<<6|63&z.getUint8(++m));else v+=String.fromCharCode((31&j)<<6|63&z.getUint8(++m));else v+=String.fromCharCode(j)}return v}(this._view,this._offset,z);return this._offset+=z,a},K.prototype._bin=function(z){var a=this._buffer.slice(this._offset,this._offset+z);return this._offset+=z,a},K.prototype._parse=function(){var z,a=this._view.getUint8(this._offset++),K=0,v=0,T=0,m=0;if(a<192)return a<128?a:a<144?this._map(15&a):a<160?this._array(15&a):this._str(31&a);if(a>223)return-1*(255-a+1);switch(a){case 192:return null;case 194:return!1;case 195:return!0;case 196:return K=this._view.getUint8(this._offset),this._offset+=1,this._bin(K);case 197:return K=this._view.getUint16(this._offset),this._offset+=2,this._bin(K);case 198:return K=this._view.getUint32(this._offset),this._offset+=4,this._bin(K);case 199:if(K=this._view.getUint8(this._offset),v=this._view.getInt8(this._offset+1),this._offset+=2,-1===v){var p=this._view.getUint32(this._offset);return T=this._view.getInt32(this._offset+4),m=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*T+m)+p/1e6)}return[v,this._bin(K)];case 200:return K=this._view.getUint16(this._offset),v=this._view.getInt8(this._offset+2),this._offset+=3,[v,this._bin(K)];case 201:return K=this._view.getUint32(this._offset),v=this._view.getInt8(this._offset+4),this._offset+=5,[v,this._bin(K)];case 202:return z=this._view.getFloat32(this._offset),this._offset+=4,z;case 203:return z=this._view.getFloat64(this._offset),this._offset+=8,z;case 204:return z=this._view.getUint8(this._offset),this._offset+=1,z;case 205:return z=this._view.getUint16(this._offset),this._offset+=2,z;case 206:return z=this._view.getUint32(this._offset),this._offset+=4,z;case 207:return T=this._view.getUint32(this._offset)*Math.pow(2,32),m=this._view.getUint32(this._offset+4),this._offset+=8,T+m;case 208:return z=this._view.getInt8(this._offset),this._offset+=1,z;case 209:return z=this._view.getInt16(this._offset),this._offset+=2,z;case 210:return z=this._view.getInt32(this._offset),this._offset+=4,z;case 211:return T=this._view.getInt32(this._offset)*Math.pow(2,32),m=this._view.getUint32(this._offset+4),this._offset+=8,T+m;case 212:return v=this._view.getInt8(this._offset),this._offset+=1,0===v?void(this._offset+=1):[v,this._bin(1)];case 213:return v=this._view.getInt8(this._offset),this._offset+=1,[v,this._bin(2)];case 214:return v=this._view.getInt8(this._offset),this._offset+=1,-1===v?(z=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*z)):[v,this._bin(4)];case 215:return v=this._view.getInt8(this._offset),this._offset+=1,0===v?(T=this._view.getInt32(this._offset)*Math.pow(2,32),m=this._view.getUint32(this._offset+4),this._offset+=8,new Date(T+m)):-1===v?(T=this._view.getUint32(this._offset),m=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&T)+m)+(T>>>2)/1e6)):[v,this._bin(8)];case 216:return v=this._view.getInt8(this._offset),this._offset+=1,[v,this._bin(16)];case 217:return K=this._view.getUint8(this._offset),this._offset+=1,this._str(K);case 218:return K=this._view.getUint16(this._offset),this._offset+=2,this._str(K);case 219:return K=this._view.getUint32(this._offset),this._offset+=4,this._str(K);case 220:return K=this._view.getUint16(this._offset),this._offset+=2,this._array(K);case 221:return K=this._view.getUint32(this._offset),this._offset+=4,this._array(K);case 222:return K=this._view.getUint16(this._offset),this._offset+=2,this._map(K);case 223:return K=this._view.getUint32(this._offset),this._offset+=4,this._map(K)}throw new Error("Could not parse")},a.decode=function(z){var a=new K(z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),v=a._parse();if(a._offset!==z.byteLength)throw new Error(z.byteLength-a._offset+" trailing bytes");return v};function v(z,a,K){for(var v=0,T=0,m=K.length;T<m;T++)(v=K.charCodeAt(T))<128?z.setUint8(a++,v):v<2048?(z.setUint8(a++,192|v>>6),z.setUint8(a++,128|63&v)):v<55296||v>=57344?(z.setUint8(a++,224|v>>12),z.setUint8(a++,128|v>>6&63),z.setUint8(a++,128|63&v)):(T++,v=65536+((1023&v)<<10|1023&K.charCodeAt(T)),z.setUint8(a++,240|v>>18),z.setUint8(a++,128|v>>12&63),z.setUint8(a++,128|v>>6&63),z.setUint8(a++,128|63&v))}function T(z,a,K){var v=typeof K,m=0,p=0,j=0,s=0,M=0,r=0;if("string"===v){if(M=function(z){for(var a=0,K=0,v=0,T=z.length;v<T;v++)(a=z.charCodeAt(v))<128?K+=1:a<2048?K+=2:a<55296||a>=57344?K+=3:(v++,K+=4);return K}(K),M<32)z.push(160|M),r=1;else if(M<256)z.push(217,M),r=2;else if(M<65536)z.push(218,M>>8,M),r=3;else{if(!(M<4294967296))throw new Error("String too long");z.push(219,M>>24,M>>16,M>>8,M),r=5}return a.push({_str:K,_length:M,_offset:z.length}),r+M}if("number"===v)return Math.floor(K)===K&&isFinite(K)?K>=0?K<128?(z.push(K),1):K<256?(z.push(204,K),2):K<65536?(z.push(205,K>>8,K),3):K<4294967296?(z.push(206,K>>24,K>>16,K>>8,K),5):(j=K/Math.pow(2,32)|0,s=K>>>0,z.push(207,j>>24,j>>16,j>>8,j,s>>24,s>>16,s>>8,s),9):K>=-32?(z.push(K),1):K>=-128?(z.push(208,K),2):K>=-32768?(z.push(209,K>>8,K),3):K>=-2147483648?(z.push(210,K>>24,K>>16,K>>8,K),5):(j=Math.floor(K/Math.pow(2,32)),s=K>>>0,z.push(211,j>>24,j>>16,j>>8,j,s>>24,s>>16,s>>8,s),9):(z.push(203),a.push({_float:K,_length:8,_offset:z.length}),9);if("object"===v){if(null===K)return z.push(192),1;if(Array.isArray(K)){if((M=K.length)<16)z.push(144|M),r=1;else if(M<65536)z.push(220,M>>8,M),r=3;else{if(!(M<4294967296))throw new Error("Array too large");z.push(221,M>>24,M>>16,M>>8,M),r=5}for(m=0;m<M;m++)r+=T(z,a,K[m]);return r}if(K instanceof Date){var W=K.getTime(),F=Math.floor(W/1e3),G=1e6*(W-1e3*F);return F>=0&&G>=0&&F<=17179869183?0===G&&F<=4294967295?(z.push(214,255,F>>24,F>>16,F>>8,F),6):(j=F/4294967296,s=4294967295&F,z.push(215,255,G>>22,G>>14,G>>6,j,s>>24,s>>16,s>>8,s),10):(j=Math.floor(F/4294967296),s=F>>>0,z.push(199,12,255,G>>24,G>>16,G>>8,G,j>>24,j>>16,j>>8,j,s>>24,s>>16,s>>8,s),15)}if(K instanceof ArrayBuffer){if((M=K.byteLength)<256)z.push(196,M),r=2;else if(M<65536)z.push(197,M>>8,M),r=3;else{if(!(M<4294967296))throw new Error("Buffer too large");z.push(198,M>>24,M>>16,M>>8,M),r=5}return a.push({_bin:K,_length:M,_offset:z.length}),r+M}if("function"===typeof K.toJSON)return T(z,a,K.toJSON());var l=[],V="",c=Object.keys(K);for(m=0,p=c.length;m<p;m++)void 0!==K[V=c[m]]&&"function"!==typeof K[V]&&l.push(V);if((M=l.length)<16)z.push(128|M),r=1;else if(M<65536)z.push(222,M>>8,M),r=3;else{if(!(M<4294967296))throw new Error("Object too large");z.push(223,M>>24,M>>16,M>>8,M),r=5}for(m=0;m<M;m++)r+=T(z,a,V=l[m]),r+=T(z,a,K[V]);return r}if("boolean"===v)return z.push(K?195:194),1;if("undefined"===v)return z.push(192),1;if("function"===typeof K.toJSON)return T(z,a,K.toJSON());throw new Error("Could not encode")}a.encode=function(z){var a=[],K=[],m=T(a,K,z),p=new ArrayBuffer(m),j=new DataView(p),s=0,M=0,r=-1;K.length>0&&(r=K[0]._offset);for(var W,F=0,G=0,l=0,V=a.length;l<V;l++)if(j.setUint8(M+l,a[l]),l+1===r){if(F=(W=K[s])._length,G=M+r,W._bin)for(var c=new Uint8Array(W._bin),C=0;C<F;C++)j.setUint8(G+C,c[C]);else W._str?v(j,G,W._str):void 0!==W._float&&j.setFloat64(G,W._float);M+=F,K[++s]&&(r=K[s]._offset)}return p}},10574:(z,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.NoneSerializer=void 0;a.NoneSerializer=class{setState(z){}getState(){return null}patch(z){}teardown(){}handshake(z){}}},10568:(z,a,K)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.SchemaSerializer=void 0;const v=K(10548);a.SchemaSerializer=class{setState(z){return this.state.decode(z)}getState(){return this.state}patch(z){return this.state.decode(z)}teardown(){var z,a;null===(a=null===(z=this.state)||void 0===z?void 0:z.$changes)||void 0===a||a.root.clearRefs()}handshake(z,a){if(this.state){(new v.Reflection).decode(z,a)}else this.state=v.Reflection.decode(z,a)}}},10529:(z,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getSerializer=a.registerSerializer=void 0;const K={};a.registerSerializer=function(z,a){K[z]=a},a.getSerializer=function(z){const a=K[z];if(!a)throw new Error("missing serializer: "+z);return a}},10507:function(z,a,K){"use strict";var v=this&&this.__importDefault||function(z){return z&&z.__esModule?z:{default:z}};Object.defineProperty(a,"__esModule",{value:!0}),a.WebSocketTransport=void 0;const T=v(K(10515)),m=globalThis.WebSocket||T.default;a.WebSocketTransport=class{constructor(z){this.events=z}send(z){z instanceof ArrayBuffer?this.ws.send(z):Array.isArray(z)&&this.ws.send(new Uint8Array(z).buffer)}connect(z){this.ws=new m(z,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(z,a){this.ws.close(z,a)}get isOpen(){return this.ws.readyState===m.OPEN}}},10515:z=>{"use strict";z.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12178:z=>{"use strict";function a(z,K,v){var T=0|z[v];if(T<=0)return[];var m,p=new Array(T);if(v===z.length-1)for(m=0;m<T;++m)p[m]=K;else for(m=0;m<T;++m)p[m]=a(z,K,v+1);return p}z.exports=function(z,K){switch("undefined"===typeof K&&(K=0),typeof z){case"number":if(z>0)return function(z,a){var K,v;for(K=new Array(z),v=0;v<z;++v)K[v]=a;return K}(0|z,K);break;case"object":if("number"===typeof z.length)return a(z,K,0)}return[]}},12130:(z,a,K)=>{z.exports=function(){var z=this;this.components={},this.comps=this.components;var a=this.components,K=1,T={},m=[],p=[],j={timeout:!1,removals:[],multiComps:[]};function s(z,K){var v=a[K],m=T[K],p=m.hash[z];p&&(m.remove(z),v.bb&&(v.multi?(p.forEach((a=>{a&&v.bb(z,a)})),p.length=0):v.bb(z,p)),j.removals.push(m),M())}function M(){j.timeout||(j.timeout=!0,setTimeout(r,1))}function r(){j.timeout=!1,W()}function W(){j.multiComps.length&&function(z){for(var a=0;a<z.length;a++){var{entID:K,data:v}=z[a],T=v.hash[K];if(T){for(var m=0;m<T.length;m++)T[m]||(T.splice(m,1),m--);0===T.length&&(v.remove(K),j.removals.push(v))}}z.length=0}(j.multiComps),j.removals.length&&function(z){for(var a=0;a<z.length;a++){z[a].flush()}z.length=0}(j.removals)}this.Ei=T,this._systems=m,this._renderSystems=p,this.Qg=function(a){var v=K++;return Array.isArray(a)&&a.forEach((a=>z.af(v,a))),v},this.deleteEntity=function(a){return Object.keys(T).forEach((z=>{T[z].hash[a]&&s(a,z)})),z},this.qh=function(z){if(!z)throw new Error("Missing component definition");var K=z.name;if(!K)throw new Error("Component definition must have a name property.");if("string"!==typeof K)throw new Error("Component name must be a string.");if(""===K)throw new Error("Component name must be a non-empty string.");if(T[K])throw new Error(`Component ${K} already exists.`);var j={};return j.name=K,j.multi=!!z.multi,j.order=isNaN(z.order)?99:z.order,j.stateConstructor=z.stateConstructor||null,j.state=z.state||{},j.$c=z.$c||null,j.bb=z.bb||null,j.system=z.system||null,j.Jd=z.Jd||null,a[K]=j,T[K]=new v,T[K]._pendingMultiCleanup=!1,T[K]._multiCleanupIDs=j.multi?[]:null,j.system&&(m.push(K),m.sort(((z,K)=>a[z].order-a[K].order))),j.Jd&&(p.push(K),p.sort(((z,K)=>a[z].order-a[K].order))),K},this.overwriteComponent=function(z,K){var v=a[z];if(!v)throw new Error(`Unknown component: ${z}`);if(!K)throw new Error("Missing component definition");if(v.name!==K.name)throw new Error("Overwriting component must use the same name property.");var j={};j.name=z,j.multi=!!K.multi,j.order=isNaN(K.order)?99:K.order,j.state=K.state||{},j.$c=K.$c||null,j.bb=K.bb||null,j.system=K.system||null,j.Jd=K.Jd||null,a[z]=j,T[z]._pendingMultiCleanup=!1,T[z]._multiCleanupIDs=j.multi?[]:null;var s=m.indexOf(z);j.system&&s<0&&m.push(z),!j.system&&s>=0&&m.splice(s,1),m.sort(((z,K)=>a[z].order-a[K].order));var M=p.indexOf(z);j.Jd&&M<0&&p.push(z),!j.Jd&&M>=0&&p.splice(M,1),p.sort(((z,K)=>a[z].order-a[K].order));var r=j.state;return this.qg(z).forEach((z=>{for(var a in r)a in z||(z[a]=r[a]);j.$c&&j.$c(z.Fd,z)})),z},this.deleteComponent=function(K){var v=T[K];if(!v)throw new Error(`Unknown component: ${K}`);v.flush(),v.list.forEach((z=>{z&&s(z.Fd||z[0].Fd,K)}));var j=m.indexOf(K),M=p.indexOf(K);return j>-1&&m.splice(j,1),M>-1&&p.splice(M,1),T[K].dispose(),delete T[K],delete a[K],z},this.af=function(z,K,v){var m,p=a[K],j=T[K];if(!j)throw new Error(`Unknown component: ${K}.`);if(j.hash[z]&&!p.multi)throw new Error(`Entity ${z} already has component: ${K}.`);if(p.stateConstructor){if(!(m=new p.stateConstructor).hasOwnProperty("Fd"))throw new Error(`Component ${p.name} stateConstructor type does not have property __id`)}else m=Object.assign({},{Fd:z},p.state,v);if(m.Fd=z,p.multi){var s=j.hash[z];s||(s=[],j.add(z,s)),s.push(m)}else j.add(z,m);return p.$c&&p.$c(z,m),this},this.lf=function(z,a){var K=T[a];if(!K)throw new Error(`Unknown component: ${a}.`);return!!K.hash[z]},this.ef=function(a,K){if(!T[K])throw new Error(`Unknown component: ${K}.`);return s(a,K),z},this.getState=function(z,a){var K=T[a];if(!K)throw new Error(`Unknown component: ${a}.`);return K.hash[z]},this.qg=function(z){var a=T[z];if(!a)throw new Error(`Unknown component: ${z}.`);return W(),a.list},this.zk=function(z){if(!T[z])throw new Error(`Unknown component: ${z}.`);var a=T[z].hash;return z=>a[z]},this.Ck=function(z){if(!T[z])throw new Error(`Unknown component: ${z}.`);var a=T[z].hash;return z=>!!a[z]},this.Ad=function(K){W();for(var v=0;v<m.length;v++){var p=m[v],j=a[p],s=T[p];j.system(K,s.list),W()}return z},this.render=function(K){W();for(var v=0;v<p.length;v++){var m=p[v],j=a[m],s=T[m];j.Jd(K,s.list),W()}return z},this.removeMultiComponent=function(K,v,m){var p=a[v],s=T[v];if(!s)throw new Error(`Unknown component: ${v}.`);if(!p.multi)throw new Error("removeMultiComponent called on non-multi component");return function(z,a,K,v){var T=K.hash[z];if(T){var m=T[v];m&&(T[v]=null,a.bb&&a.bb(z,m),j.multiComps.push({entID:z,data:K}),M())}}(K,p,s,m),z}};var v=K(12133)},12133:z=>{function a(z,a){var K=z._map[a];if(delete z.hash[a],delete z._map[a],K===z.list.length-1)z.list.pop();else{var v=z.list.pop();if(z.list[K]=v,null===v||null===v[0]){var T=z.list.length;for(var m in z._map)if(z._map[m]===T)return void(z._map[m]=K)}else{var p=v.Fd||v[0].Fd;z._map[p]=K}}}z.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(z,a){if("number"===typeof this._map[z]){var K=this._map[z];this.hash[z]=a,this.list[K]=a}else this._map[z]=this.list.length,this.hash[z]=a,this.list.push(a)}remove(z){var a=this._map[z];this.hash[z]=null,this.list[a]=null,this._pendingRemovals.push(z)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var z=0;z<this._pendingRemovals.length;z++){var K=this._pendingRemovals[z];null===this.hash[K]&&a(this,K)}this._pendingRemovals.length=0}}},12401:z=>{"use strict";z.exports=function(z,a,K,v,T,m){var p=+a[0],j=+a[1],s=+a[2],M=+K[0],r=+K[1],W=+K[2],F=Math.sqrt(M*M+r*r+W*W);if(0===F)throw new Error("Can't raycast along a zero vector");return function(z,a,K,v,T,m,p,j,s,M){for(var r=0,W=Math.floor,F=0|W(a),G=0|W(K),l=0|W(v),V=T>0?1:-1,c=m>0?1:-1,C=p>0?1:-1,w=Math.abs(1/T),H=Math.abs(1/m),f=Math.abs(1/p),Y=w<1/0?w*(V>0?F+1-a:a-F):1/0,I=H<1/0?H*(c>0?G+1-K:K-G):1/0,q=f<1/0?f*(C>0?l+1-v:v-l):1/0,B=-1;r<=j;){var x=z(F,G,l);if(x)return s&&(s[0]=a+r*T,s[1]=K+r*m,s[2]=v+r*p),M&&(M[0]=M[1]=M[2]=0,0===B&&(M[0]=-V),1===B&&(M[1]=-c),2===B&&(M[2]=-C)),x;Y<I?Y<q?(F+=V,r=Y,Y+=w,B=0):(l+=C,r=q,q+=f,B=2):I<q?(G+=c,r=I,I+=H,B=1):(l+=C,r=q,q+=f,B=2)}return s&&(s[0]=a+r*T,s[1]=K+r*m,s[2]=v+r*p),M&&(M[0]=M[1]=M[2]=0),0}(z,p,j,s,M/=F,r/=F,W/=F,v="undefined"===typeof v?64:+v,T,m)}},12431:(z,a,K)=>{"use strict";K.d(a,{d:()=>m});var v=K(695);function T(){this.xj=!1,this.stopPropagation=!1,this.yj=!1,this.disabled=!1}class m{constructor(z,a){this.version="0.7.0";var K=Object.assign({},new T,a||{});this.element=z||document,this.xj=!!K.xj,this.stopPropagation=!!K.stopPropagation,this.yj=!!K.yj,this.disabled=!!K.disabled,this.filterEvents=(z,a)=>!0,this.down=new v.EventEmitter,this.up=new v.EventEmitter,this.state={},this.hg={dx:0,dy:0,qk:0,fg:0,rk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?j(this):document.addEventListener("DOMContentLoaded",(z=>{j(this)}),{once:!0})}bind(z){for(var a=arguments.length,K=new Array(a>1?a-1:0),v=1;v<a;v++)K[v-1]=arguments[v];K.forEach((a=>{var K=this._keyBindmap[a]||[];K.includes(z)||(K.push(z),this._keyBindmap[a]=K)})),this.state[z]=!!this.state[z],this.pressCount[z]=this.pressCount[z]||0,this.releaseCount[z]=this.releaseCount[z]||0}unbind(z){for(var a in this._keyBindmap){var K=this._keyBindmap[a],v=K.indexOf(z);v>-1&&K.splice(v,1)}}getBindings(){var z={};for(var a in this._keyBindmap){this._keyBindmap[a].forEach((K=>{z[K]=z[K]||[],z[K].push(a)}))}return z}Ad(){p(this.hg),p(this.pressCount),p(this.releaseCount)}}function p(z){for(var a in z)z[a]=0}function j(z){window.addEventListener("keydown",l.bind(null,z,!0),!1),window.addEventListener("keyup",l.bind(null,z,!1),!1);var a={passive:!0};z.element.addEventListener("touchstart",W.bind(void 0,z),{passive:!1}),z.element.addEventListener("touchend",G.bind(void 0,z),a),z.element.addEventListener("mousedown",V.bind(null,z,!0),a),window.document.addEventListener("mouseup",V.bind(null,z,!1),a),z.element.addEventListener("touchmove",c.bind(null,z),a),z.element.addEventListener("mousemove",c.bind(null,z),a),window.PointerEvent,z.element.addEventListener("wheel",C.bind(null,z),a),z.element.addEventListener("contextmenu",w.bind(null,z),!1),window.addEventListener("blur",H.bind(null,z),!1)}var s=0,M=0,r=null;function W(z,a){a.preventDefault(),F(a)}function F(z){let a=!1;for(let K=0;K<z.touches.length;++K)if(z.touches[K].identifier===r){a=!0;break}if(!a){const a=z.changedTouches[0];s=a.clientX,M=a.clientY,r=a.identifier}}function G(z,a){for(var K=a.changedTouches,v=0;v<K.length;++v)K[v].identifier===r&&(r=null)}function l(z,a,K){f(K.code,a,z,K)}function V(z,a,K){if("pointerId"in K)if(a){if(null!==z._touches.currID)return;z._touches.currID=K.pointerId}else{if(z._touches.currID!==K.pointerId)return;z._touches.currID=null}return f("Mouse"+("button"in K?K.button+1:1),a,z,K),!1}function c(z,a){var K=a.movementX||a.mozMovementX||0,v=a.movementY||a.mozMovementY||0;if(a.touches&&0===(K|v)){var T=function(z){F(z);for(let a=0;a<z.changedTouches.length;++a)if(z.changedTouches[a].identifier==r){const K=z.changedTouches[a],v=[K.clientX-s,K.clientY-M];return s=K.clientX,M=K.clientY,v}return console.error(`Did not find touch id ${r}`),[0,0]}(a);K=T[0],v=T[1]}z.hg.dx+=K,z.hg.dy+=v}function C(z,a){var K=1;switch(a.deltaMode){case 0:K=1;break;case 1:K=12;break;case 2:K=z.element.clientHeight||window.innerHeight}z.hg.qk+=(a.deltaX||0)*K,z.hg.fg+=(a.deltaY||0)*K,z.hg.rk+=(a.deltaZ||0)*K}function w(z,a){if(!z.yj)return a.preventDefault(),!1}function H(z){for(var a in z._keyStates)z._keyStates[a]&&(/^Mouse\d/.test(a)||f(a,!1,z,{code:a,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function f(z,a,K,v){var T=K._keyBindmap[z];T&&(Y(K._keyStates[z],a)&&(K._keyStates[z]=a,T.forEach((z=>{(!K.filterEvents||K.filterEvents(v,z))&&function(z,a,K,v){var T=a?K.pressCount:K.releaseCount;T[z]=(T[z]||0)+1;var m=K._bindPressCount[z]||0;(m+=a?1:-1)<0&&(m=0);K._bindPressCount[z]=m;var p=K.state[z];if(Y(p,m)){K.state[z]=m>0;var j=a?K.down:K.up;K.disabled||j.emit(z,v)}}(z,a,K,v)}))),"button"in v||(K.xj&&!v.defaultPrevented&&v.preventDefault(),K.stopPropagation&&v.stopPropagation()))}function Y(z,a){return z?!a:a}},10612:z=>{"use strict";z.exports=function(z){for(var a=new Array(z),K=0;K<z;++K)a[K]=K;return a}},10620:z=>{function a(z){return!!z.constructor&&"function"===typeof z.constructor.isBuffer&&z.constructor.isBuffer(z)}z.exports=function(z){return null!=z&&(a(z)||function(z){return"function"===typeof z.readFloatLE&&"function"===typeof z.slice&&a(z.slice(0,0))}(z)||!!z._isBuffer)}},12407:(z,a,K)=>{"use strict";K.d(a,{b:()=>v});class v{constructor(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Wh=!1,this.Xh=!1,this.Th=30,this.Vh=0,this.ii=!1,this.fullscreen=!1,this.$h=function(z){},this._h=function(){},this.ei=function(){},this.cb=function(){},this.bi=function(z){},this.onFullscreenChanged=function(z){},M((()=>{!function(z,a){z._nowObject=performance||Date,z._lastTick=0,z._renderAccum=0,z._rt=0,z._frameCB=j.bind(null,z),requestAnimationFrame(z._frameCB),a>0&&(z._intervalCB=p.bind(null,z),z._interval=setInterval(z._intervalCB,Math.max(a,1e3/z.Th/2)))}(this,a),function(z,a){if(!a)return;var K=!1,v=!1;document.addEventListener("pointerlockchange",(v=>{K=document.pointerLockElement===a,z.bi(K)})),document.addEventListener("fullscreenchange",(K=>{v=document.fullscreenElement===a,z.onFullscreenChanged(v)})),Object.defineProperty(z,"ii",{get:()=>K,set:z=>{z&&!K?s(a):K&&!z&&function(z){z.exitPointerLock&&z.exitPointerLock()}(document)}}),Object.defineProperty(z,"fullscreen",{get:()=>v,set:z=>{z&&!v?a.requestFullscreen():v&&!z&&document.exitFullscreen()}}),a.addEventListener("click",(T=>{z.Wh&&!K&&s(a),z.Xh&&!v&&a.requestFullscreen()}));var T=()=>z.cb();if(window.ResizeObserver){new ResizeObserver(T).observe(a)}else window.addEventListener("resize",T)}(this,z),this.ei()}))}}var T=3,m=20;function p(z){for(var a=1e3/z.Th,K=z._nowObject.now()+m,v=0;z._nowObject.now()>=z._lastTick+a&&z._nowObject.now()<K&&++v<=T;)z.$h(a),z._lastTick+=a;var p=5*(a+5),j=z._nowObject.now();if(j-z._lastTick>p)for(;j>=z._lastTick+a;)z._lastTick+=a}function j(z){requestAnimationFrame(z._frameCB),p(z);var a=z._nowObject.now(),K=a-z._rt;if(z._rt=a,z.Vh>0){z._renderAccum+=K;var v=1e3/z.Vh;if(z._renderAccum<v)return;z._renderAccum=Math.min(z._renderAccum-v,v)}var T=1e3/z.Th,m=(a-z._lastTick)/T;z._h(K,m,T)}function s(z){z.requestPointerLock&&z.requestPointerLock()}var M=z=>{if("loading"===document.readyState){var a=()=>{document.removeEventListener("readystatechange",a),z()};document.addEventListener("readystatechange",a)}else setTimeout(z,1)}},10610:(z,a,K)=>{var v=K(10612),T=K(10620),m="undefined"!==typeof Float64Array;function p(z,a){return z[0]-a[0]}function j(){var z,a=this.stride,K=new Array(a.length);for(z=0;z<K.length;++z)K[z]=[Math.abs(a[z]),z];K.sort(p);var v=new Array(K.length);for(z=0;z<v.length;++z)v[z]=K[z][1];return v}function s(z,a){var K=["View",a,"d",z].join("");a<0&&(K="View_Nil"+z);var T="generic"===z;if(-1===a){var m="function "+K+"(a){this.data=a;};var proto="+K+".prototype;proto.dtype='"+z+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+K+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+K+"(a){return new "+K+"(a);}";return new Function(m)()}if(0===a){m="function "+K+"(a,d) {this.data = a;this.offset = d};var proto="+K+".prototype;proto.dtype='"+z+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+K+"_copy() {return new "+K+"(this.data,this.offset)};proto.pick=function "+K+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+K+"_get(){return "+(T?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+K+"_set(v){return "+(T?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+K+"(a,b,c,d){return new "+K+"(a,d)}";return new Function("TrivialArray",m)(M[z][0])}m=["'use strict'"];var p=v(a),s=p.map((function(z){return"i"+z})),r="this.offset+"+p.map((function(z){return"this.stride["+z+"]*i"+z})).join("+"),W=p.map((function(z){return"b"+z})).join(","),F=p.map((function(z){return"c"+z})).join(",");m.push("function "+K+"(a,"+W+","+F+",d){this.data=a","this.shape=["+W+"]","this.stride=["+F+"]","this.offset=d|0}","var proto="+K+".prototype","proto.dtype='"+z+"'","proto.dimension="+a),m.push("Object.defineProperty(proto,'size',{get:function "+K+"_size(){return "+p.map((function(z){return"this.shape["+z+"]"})).join("*"),"}})"),1===a?m.push("proto.order=[0]"):(m.push("Object.defineProperty(proto,'order',{get:"),a<4?(m.push("function "+K+"_order(){"),2===a?m.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===a&&m.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):m.push("ORDER})")),m.push("proto.set=function "+K+"_set("+s.join(",")+",v){"),T?m.push("return this.data.set("+r+",v)}"):m.push("return this.data["+r+"]=v}"),m.push("proto.get=function "+K+"_get("+s.join(",")+"){"),T?m.push("return this.data.get("+r+")}"):m.push("return this.data["+r+"]}"),m.push("proto.index=function "+K+"_index(",s.join(),"){return "+r+"}"),m.push("proto.hi=function "+K+"_hi("+s.join(",")+"){return new "+K+"(this.data,"+p.map((function(z){return["(typeof i",z,"!=='number'||i",z,"<0)?this.shape[",z,"]:i",z,"|0"].join("")})).join(",")+","+p.map((function(z){return"this.stride["+z+"]"})).join(",")+",this.offset)}");var G=p.map((function(z){return"a"+z+"=this.shape["+z+"]"})),l=p.map((function(z){return"c"+z+"=this.stride["+z+"]"}));m.push("proto.lo=function "+K+"_lo("+s.join(",")+"){var b=this.offset,d=0,"+G.join(",")+","+l.join(","));for(var V=0;V<a;++V)m.push("if(typeof i"+V+"==='number'&&i"+V+">=0){d=i"+V+"|0;b+=c"+V+"*d;a"+V+"-=d}");m.push("return new "+K+"(this.data,"+p.map((function(z){return"a"+z})).join(",")+","+p.map((function(z){return"c"+z})).join(",")+",b)}"),m.push("proto.step=function "+K+"_step("+s.join(",")+"){var "+p.map((function(z){return"a"+z+"=this.shape["+z+"]"})).join(",")+","+p.map((function(z){return"b"+z+"=this.stride["+z+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(V=0;V<a;++V)m.push("if(typeof i"+V+"==='number'){d=i"+V+"|0;if(d<0){c+=b"+V+"*(a"+V+"-1);a"+V+"=ceil(-a"+V+"/d)}else{a"+V+"=ceil(a"+V+"/d)}b"+V+"*=d}");m.push("return new "+K+"(this.data,"+p.map((function(z){return"a"+z})).join(",")+","+p.map((function(z){return"b"+z})).join(",")+",c)}");var c=new Array(a),C=new Array(a);for(V=0;V<a;++V)c[V]="a[i"+V+"]",C[V]="b[i"+V+"]";m.push("proto.transpose=function "+K+"_transpose("+s+"){"+s.map((function(z,a){return z+"=("+z+"===undefined?"+a+":"+z+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+K+"(this.data,"+c.join(",")+","+C.join(",")+",this.offset)}"),m.push("proto.pick=function "+K+"_pick("+s+"){var a=[],b=[],c=this.offset");for(V=0;V<a;++V)m.push("if(typeof i"+V+"==='number'&&i"+V+">=0){c=(c+this.stride["+V+"]*i"+V+")|0}else{a.push(this.shape["+V+"]);b.push(this.stride["+V+"])}");return m.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),m.push("return function construct_"+K+"(data,shape,stride,offset){return new "+K+"(data,"+p.map((function(z){return"shape["+z+"]"})).join(",")+","+p.map((function(z){return"stride["+z+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",m.join("\n"))(M[z],j)}var M={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};z.exports=function(z,a,K,v){if(void 0===z)return(0,M.array[0])([]);"number"===typeof z&&(z=[z]),void 0===a&&(a=[z.length]);var p=a.length;if(void 0===K){K=new Array(p);for(var j=p-1,r=1;j>=0;--j)K[j]=r,r*=a[j]}if(void 0===v){v=0;for(j=0;j<p;++j)K[j]<0&&(v-=(a[j]-1)*K[j])}for(var W=function(z){if(T(z))return"buffer";if(m)switch(Object.prototype.toString.call(z)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(z)?"array":"generic"}(z),F=M[W];F.length<=p+1;)F.push(s(W,F.length-1));return(0,F[p+1])(z,a,K,v)}},10587:z=>{var a;self,a=()=>(()=>{"use strict";var z={d:(a,K)=>{for(var v in K)z.o(K,v)&&!z.o(a,v)&&Object.defineProperty(a,v,{enumerable:!0,get:K[v]})},o:(z,a)=>Object.prototype.hasOwnProperty.call(z,a)},a={};z.d(a,{default:()=>J});var K,v=function(z,a){var K=a.x-z.x,v=a.y-z.y;return Math.sqrt(K*K+v*v)},T=function(z){return z*(Math.PI/180)},m=new Map,p=function(z){m.has(z)&&clearTimeout(m.get(z)),m.set(z,setTimeout(z,100))},j=function(z,a,K){for(var v,T=a.split(/[ ,]+/g),m=0;m<T.length;m+=1)v=T[m],z.addEventListener?z.addEventListener(v,K,!1):z.attachEvent&&z.attachEvent(v,K)},s=function(z,a,K){for(var v,T=a.split(/[ ,]+/g),m=0;m<T.length;m+=1)v=T[m],z.removeEventListener?z.removeEventListener(v,K):z.detachEvent&&z.detachEvent(v,K)},M=function(z){return z.preventDefault(),z.type.match(/^touch/)?z.changedTouches:z},r=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},W=function(z,a){a.top||a.right||a.bottom||a.left?(z.style.top=a.top,z.style.right=a.right,z.style.bottom=a.bottom,z.style.left=a.left):(z.style.left=a.x+"px",z.style.top=a.y+"px")},F=function(z,a,K){var v=G(z);for(var T in v)if(v.hasOwnProperty(T))if("string"==typeof a)v[T]=a+" "+K;else{for(var m="",p=0,j=a.length;p<j;p+=1)m+=a[p]+" "+K+", ";v[T]=m.slice(0,-2)}return v},G=function(z){var a={};return a[z]="",["webkit","Moz","o"].forEach((function(K){a[K+z.charAt(0).toUpperCase()+z.slice(1)]=""})),a},l=function(z,a){for(var K in a)a.hasOwnProperty(K)&&(z[K]=a[K]);return z},V=function(z,a){if(z.length)for(var K=0,v=z.length;K<v;K+=1)a(z[K]);else a(z)},c="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,C=window.matchMedia("(any-hover: none)").matches,w=!!("ontouchstart"in window),H=!!window.PointerEvent,f=!!window.MSPointerEvent,Y={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},I={start:"mousedown",move:"mousemove",end:"mouseup"},q={};function B(){}c&&!C?K=Y:H?K={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:f?K={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:w?(K=Y,q=I):K=I,B.prototype.on=function(z,a){var K,v=this,T=z.split(/[ ,]+/g);v._handlers_=v._handlers_||{};for(var m=0;m<T.length;m+=1)K=T[m],v._handlers_[K]=v._handlers_[K]||[],v._handlers_[K].push(a);return v},B.prototype.off=function(z,a){var K=this;return K._handlers_=K._handlers_||{},void 0===z?K._handlers_={}:void 0===a?K._handlers_[z]=null:K._handlers_[z]&&K._handlers_[z].indexOf(a)>=0&&K._handlers_[z].splice(K._handlers_[z].indexOf(a),1),K},B.prototype.trigger=function(z,a){var K,v=this,T=z.split(/[ ,]+/g);v._handlers_=v._handlers_||{};for(var m=0;m<T.length;m+=1)K=T[m],v._handlers_[K]&&v._handlers_[K].length&&v._handlers_[K].forEach((function(z){z.call(v,{type:K,target:v},a)}))},B.prototype.config=function(z){var a=this;a.options=a.defaults||{},z&&(a.options=function(z,a){var K={};for(var v in z)z.hasOwnProperty(v)&&a.hasOwnProperty(v)?K[v]=a[v]:z.hasOwnProperty(v)&&(K[v]=z[v]);return K}(a.options,z))},B.prototype.bindEvt=function(z,a){var v=this;return v._domHandlers_=v._domHandlers_||{},v._domHandlers_[a]=function(){"function"==typeof v["on"+a]?v["on"+a].apply(v,arguments):console.warn('[WARNING] : Missing "on'+a+'" handler.')},j(z,K[a],v._domHandlers_[a]),q[a]&&j(z,q[a],v._domHandlers_[a]),v},B.prototype.unbindEvt=function(z,a){var v=this;return v._domHandlers_=v._domHandlers_||{},s(z,K[a],v._domHandlers_[a]),q[a]&&s(z,q[a],v._domHandlers_[a]),delete v._domHandlers_[a],this};const x=B;function Z(z,a){return this.identifier=a.identifier,this.position=a.position,this.frontPosition=a.frontPosition,this.collection=z,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(a),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=Z.id,Z.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Z.prototype=new x,Z.constructor=Z,Z.id=0,Z.prototype.buildEl=function(z){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},Z.prototype.stylize=function(){if(this.options.dataOnly)return this;var z=this.options.fadeTime+"ms",a=function(){var z=G("borderRadius");for(var a in z)z.hasOwnProperty(a)&&(z[a]="50%");return z}(),K=F("transition","opacity",z),v={};return v.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},v.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},v.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},l(v.el,K),"circle"===this.options.shape&&l(v.back,a),l(v.front,a),this.applyStyles(v),this},Z.prototype.applyStyles=function(z){for(var a in this.ui)if(this.ui.hasOwnProperty(a))for(var K in z[a])this.ui[a].style[K]=z[a][K];return this},Z.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},Z.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},Z.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},Z.prototype.show=function(z){var a=this;return a.options.dataOnly||(clearTimeout(a.removeTimeout),clearTimeout(a.showTimeout),clearTimeout(a.restTimeout),a.addToDom(),a.restCallback(),setTimeout((function(){a.ui.el.style.opacity=1}),0),a.showTimeout=setTimeout((function(){a.trigger("shown",a.instance),"function"==typeof z&&z.call(this)}),a.options.fadeTime)),a},Z.prototype.hide=function(z){var a=this;if(a.options.dataOnly)return a;if(a.ui.el.style.opacity=a.options.restOpacity,clearTimeout(a.removeTimeout),clearTimeout(a.showTimeout),clearTimeout(a.restTimeout),a.removeTimeout=setTimeout((function(){var K="dynamic"===a.options.mode?"none":"block";a.ui.el.style.display=K,"function"==typeof z&&z.call(a),a.trigger("hidden",a.instance)}),a.options.fadeTime),a.options.restJoystick){var K=a.options.restJoystick,v={};v.x=!0===K||!1!==K.x?0:a.instance.frontPosition.x,v.y=!0===K||!1!==K.y?0:a.instance.frontPosition.y,a.setPosition(z,v)}return a},Z.prototype.setPosition=function(z,a){var K=this;K.frontPosition={x:a.x,y:a.y};var v=K.options.fadeTime+"ms",T={};T.front=F("transition",["transform"],v);var m={front:{}};m.front={transform:"translate("+K.frontPosition.x+"px,"+K.frontPosition.y+"px)"},K.applyStyles(T),K.applyStyles(m),K.restTimeout=setTimeout((function(){"function"==typeof z&&z.call(K),K.restCallback()}),K.options.fadeTime)},Z.prototype.restCallback=function(){var z=this,a={};a.front=F("transition","none",""),z.applyStyles(a),z.trigger("rested",z.instance)},Z.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},Z.prototype.computeDirection=function(z){var a,K,v,T=z.angle.radian,m=Math.PI/4,p=Math.PI/2;if(T>m&&T<3*m&&!z.lockX?a="up":T>-m&&T<=m&&!z.lockY?a="left":T>3*-m&&T<=-m&&!z.lockX?a="down":z.lockY||(a="right"),z.lockY||(K=T>-p&&T<p?"left":"right"),z.lockX||(v=T>0?"up":"down"),z.force>this.options.threshold){var j,s={};for(j in this.direction)this.direction.hasOwnProperty(j)&&(s[j]=this.direction[j]);var M={};for(j in this.direction={x:K,y:v,angle:a},z.direction=this.direction,s)s[j]===this.direction[j]&&(M[j]=!0);if(M.x&&M.y&&M.angle)return z;M.x&&M.y||this.trigger("plain",z),M.x||this.trigger("plain:"+K,z),M.y||this.trigger("plain:"+v,z),M.angle||this.trigger("dir dir:"+a,z)}else this.resetDirection();return z};const y=Z;function i(z,a){var K=this;K.nipples=[],K.idles=[],K.actives=[],K.ids=[],K.pressureIntervals={},K.manager=z,K.id=i.id,i.id+=1,K.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},K.config(a),"static"!==K.options.mode&&"semi"!==K.options.mode||(K.options.multitouch=!1),K.options.multitouch||(K.options.maxNumberOfNipples=1);var v=getComputedStyle(K.options.zone.parentElement);return v&&"flex"===v.display&&(K.parentIsFlex=!0),K.updateBox(),K.prepareNipples(),K.zj(),K.begin(),K.nipples}i.prototype=new x,i.constructor=i,i.id=0,i.prototype.prepareNipples=function(){var z=this,a=z.nipples;a.on=z.on.bind(z),a.off=z.off.bind(z),a.options=z.options,a.destroy=z.destroy.bind(z),a.ids=z.ids,a.id=z.id,a.processOnMove=z.processOnMove.bind(z),a.processOnEnd=z.processOnEnd.bind(z),a.get=function(z){if(void 0===z)return a[0];for(var K=0,v=a.length;K<v;K+=1)if(a[K].identifier===z)return a[K];return!1}},i.prototype.zj=function(){var z=this;z.bindEvt(z.options.zone,"start"),z.options.zone.style.touchAction="none",z.options.zone.style.msTouchAction="none"},i.prototype.begin=function(){var z=this,a=z.options;if("static"===a.mode){var K=z.createNipple(a.position,z.manager.getIdentifier());K.add(),z.idles.push(K)}},i.prototype.createNipple=function(z,a){var K=this,v=K.manager.scroll,T={},m=K.options,p=K.parentIsFlex?v.x:v.x+K.box.left,j=K.parentIsFlex?v.y:v.y+K.box.top;if(z.x&&z.y)T={x:z.x-p,y:z.y-j};else if(z.top||z.right||z.bottom||z.left){var s=document.createElement("DIV");s.style.display="hidden",s.style.top=z.top,s.style.right=z.right,s.style.bottom=z.bottom,s.style.left=z.left,s.style.position="absolute",m.zone.appendChild(s);var M=s.getBoundingClientRect();m.zone.removeChild(s),T=z,z={x:M.left+v.x,y:M.top+v.y}}var r=new y(K,{color:m.color,size:m.size,threshold:m.threshold,fadeTime:m.fadeTime,dataOnly:m.dataOnly,restJoystick:m.restJoystick,restOpacity:m.restOpacity,mode:m.mode,identifier:a,position:z,zone:m.zone,frontPosition:{x:0,y:0},shape:m.shape});return m.dataOnly||(W(r.ui.el,T),W(r.ui.front,r.frontPosition)),K.nipples.push(r),K.trigger("added "+r.identifier+":added",r),K.manager.trigger("added "+r.identifier+":added",r),K.bindNipple(r),r},i.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},i.prototype.bindNipple=function(z){var a,K=this,v=function(z,v){a=z.type+" "+v.id+":"+z.type,K.trigger(a,v)};z.on("destroyed",K.onDestroyed.bind(K)),z.on("shown hidden rested dir plain",v),z.on("dir:up dir:right dir:down dir:left",v),z.on("plain:up plain:right plain:down plain:left",v)},i.prototype.pressureFn=function(z,a,K){var v=this,T=0;clearInterval(v.pressureIntervals[K]),v.pressureIntervals[K]=setInterval(function(){var K=z.force||z.pressure||z.webkitForce||0;K!==T&&(a.trigger("pressure",K),v.trigger("pressure "+a.identifier+":pressure",K),T=K)}.bind(v),100)},i.prototype.onstart=function(z){var a=this,K=a.options,v=z;return z=M(z),a.updateBox(),V(z,(function(T){a.actives.length<K.maxNumberOfNipples?a.processOnStart(T):v.type.match(/^touch/)&&(Object.keys(a.manager.ids).forEach((function(K){if(Object.values(v.touches).findIndex((function(z){return z.identifier===K}))<0){var T=[z[0]];T.identifier=K,a.processOnEnd(T)}})),a.actives.length<K.maxNumberOfNipples&&a.processOnStart(T))})),a.manager.bindDocument(),!1},i.prototype.processOnStart=function(z){var a,K=this,T=K.options,m=K.manager.getIdentifier(z),p=z.force||z.pressure||z.webkitForce||0,j={x:z.pageX,y:z.pageY},s=K.getOrCreate(m,j);s.identifier!==m&&K.manager.removeIdentifier(s.identifier),s.identifier=m;var M=function(a){a.trigger("start",a),K.trigger("start "+a.id+":start",a),a.show(),p>0&&K.pressureFn(z,a,a.identifier),K.processOnMove(z)};if((a=K.idles.indexOf(s))>=0&&K.idles.splice(a,1),K.actives.push(s),K.ids.push(s.identifier),"semi"!==T.mode)M(s);else{if(!(v(j,s.position)<=T.catchDistance))return s.destroy(),void K.processOnStart(z);M(s)}return s},i.prototype.getOrCreate=function(z,a){var K,v=this,T=v.options;return/(semi|static)/.test(T.mode)?(K=v.idles[0])?(v.idles.splice(0,1),K):"semi"===T.mode?v.createNipple(a,z):(console.warn("Coudln't find the needed nipple."),!1):K=v.createNipple(a,z)},i.prototype.processOnMove=function(z){var a=this,K=a.options,m=a.manager.getIdentifier(z),p=a.nipples.get(m),j=a.manager.scroll;if(function(z){return isNaN(z.buttons)?0!==z.pressure:0!==z.buttons}(z)){if(!p)return console.error("Found zombie joystick with ID "+m),void a.manager.removeIdentifier(m);if(K.dynamicPage){var s=p.el.getBoundingClientRect();p.position={x:j.x+s.left,y:j.y+s.top}}p.identifier=m;var M=p.options.size/2,r={x:z.pageX,y:z.pageY};K.lockX&&(r.y=p.position.y),K.lockY&&(r.x=p.position.x);var W,F,G,l,V,c,C,w,H,f,Y=v(r,p.position),I=(W=r,G=(F=p.position).x-W.x,l=F.y-W.y,function(z){return z*(180/Math.PI)}(Math.atan2(l,G))),q=T(I),B=Y/M,x={distance:Y,position:r};if("circle"===p.options.shape?(V=Math.min(Y,M),C=p.position,w=V,f={x:0,y:0},H=T(H=I),f.x=C.x-w*Math.cos(H),f.y=C.y-w*Math.sin(H),c=f):(c=function(z,a,K){return{x:Math.min(Math.max(z.x,a.x-K),a.x+K),y:Math.min(Math.max(z.y,a.y-K),a.y+K)}}(r,p.position,M),V=v(c,p.position)),K.follow){if(Y>M){var Z=r.x-c.x,y=r.y-c.y;p.position.x+=Z,p.position.y+=y,p.el.style.top=p.position.y-(a.box.top+j.y)+"px",p.el.style.left=p.position.x-(a.box.left+j.x)+"px",Y=v(r,p.position)}}else r=c,Y=V;var i=r.x-p.position.x,n=r.y-p.position.y;p.frontPosition={x:i,y:n},K.dataOnly||(p.ui.front.style.transform="translate("+i+"px,"+n+"px)");var X={identifier:p.identifier,position:r,force:B,pressure:z.force||z.pressure||z.webkitForce||0,distance:Y,angle:{radian:q,degree:I},vector:{x:i/M,y:-n/M},raw:x,instance:p,lockX:K.lockX,lockY:K.lockY};(X=p.computeDirection(X)).angle={radian:T(180-I),degree:180-I},p.trigger("move",X),a.trigger("move "+p.id+":move",X)}else this.processOnEnd(z)},i.prototype.processOnEnd=function(z){var a=this,K=a.options,v=a.manager.getIdentifier(z),T=a.nipples.get(v),m=a.manager.removeIdentifier(T.identifier);T&&(K.dataOnly||T.hide((function(){"dynamic"===K.mode&&(T.trigger("removed",T),a.trigger("removed "+T.id+":removed",T),a.manager.trigger("removed "+T.id+":removed",T),T.destroy())})),clearInterval(a.pressureIntervals[T.identifier]),T.resetDirection(),T.trigger("end",T),a.trigger("end "+T.id+":end",T),a.ids.indexOf(T.identifier)>=0&&a.ids.splice(a.ids.indexOf(T.identifier),1),a.actives.indexOf(T)>=0&&a.actives.splice(a.actives.indexOf(T),1),/(semi|static)/.test(K.mode)?a.idles.push(T):a.nipples.indexOf(T)>=0&&a.nipples.splice(a.nipples.indexOf(T),1),a.manager.unbindDocument(),/(semi|static)/.test(K.mode)&&(a.manager.ids[m.id]=m.identifier))},i.prototype.onDestroyed=function(z,a){var K=this;K.nipples.indexOf(a)>=0&&K.nipples.splice(K.nipples.indexOf(a),1),K.actives.indexOf(a)>=0&&K.actives.splice(K.actives.indexOf(a),1),K.idles.indexOf(a)>=0&&K.idles.splice(K.idles.indexOf(a),1),K.ids.indexOf(a.identifier)>=0&&K.ids.splice(K.ids.indexOf(a.identifier),1),K.manager.removeIdentifier(a.identifier),K.manager.unbindDocument()},i.prototype.destroy=function(){var z=this;for(var a in z.unbindEvt(z.options.zone,"start"),z.nipples.forEach((function(z){z.destroy()})),z.pressureIntervals)z.pressureIntervals.hasOwnProperty(a)&&clearInterval(z.pressureIntervals[a]);z.trigger("destroyed",z.nipples),z.manager.unbindDocument(),z.off()};const n=i;function X(z){var a=this;a.ids={},a.index=0,a.collections=[],a.scroll=r(),a.config(z),a.prepareCollections();var K=function(){var z;a.collections.forEach((function(K){K.forEach((function(K){z=K.el.getBoundingClientRect(),K.position={x:a.scroll.x+z.left,y:a.scroll.y+z.top}}))}))};j(window,"resize",(function(){p(K)}));var v=function(){a.scroll=r()};return j(window,"scroll",(function(){p(v)})),a.collections}X.prototype=new x,X.constructor=X,X.prototype.prepareCollections=function(){var z=this;z.collections.create=z.create.bind(z),z.collections.on=z.on.bind(z),z.collections.off=z.off.bind(z),z.collections.destroy=z.destroy.bind(z),z.collections.get=function(a){var K;return z.collections.every((function(z){return!(K=z.get(a))})),K}},X.prototype.create=function(z){return this.createCollection(z)},X.prototype.createCollection=function(z){var a=this,K=new n(a,z);return a.bindCollection(K),a.collections.push(K),K},X.prototype.bindCollection=function(z){var a,K=this,v=function(z,v){a=z.type+" "+v.id+":"+z.type,K.trigger(a,v)};z.on("destroyed",K.onDestroyed.bind(K)),z.on("shown hidden rested dir plain",v),z.on("dir:up dir:right dir:down dir:left",v),z.on("plain:up plain:right plain:down plain:left",v)},X.prototype.bindDocument=function(){var z=this;z.binded||(z.bindEvt(document,"move").bindEvt(document,"end"),z.binded=!0)},X.prototype.unbindDocument=function(z){var a=this;Object.keys(a.ids).length&&!0!==z||(a.unbindEvt(document,"move").unbindEvt(document,"end"),a.binded=!1)},X.prototype.getIdentifier=function(z){var a;return z?void 0===(a=void 0===z.identifier?z.pointerId:z.identifier)&&(a=this.latest||0):a=this.index,void 0===this.ids[a]&&(this.ids[a]=this.index,this.index+=1),this.latest=a,this.ids[a]},X.prototype.removeIdentifier=function(z){var a={};for(var K in this.ids)if(this.ids[K]===z){a.id=K,a.identifier=this.ids[K],delete this.ids[K];break}return a},X.prototype.onmove=function(z){return this.onAny("move",z),!1},X.prototype.onend=function(z){return this.onAny("end",z),!1},X.prototype.oncancel=function(z){return this.onAny("end",z),!1},X.prototype.onAny=function(z,a){var K,v=this,T="processOn"+z.charAt(0).toUpperCase()+z.slice(1);a=M(a);var m=function(z,a,K){K.ids.indexOf(a)>=0&&(K[T](z),z._found_=!0)};return V(a,(function(z){K=v.getIdentifier(z),V(v.collections,m.bind(null,z,K)),z._found_||v.removeIdentifier(K)})),!1},X.prototype.destroy=function(){var z=this;z.unbindDocument(!0),z.ids={},z.index=0,z.collections.forEach((function(z){z.destroy()})),z.off()},X.prototype.onDestroyed=function(z,a){var K=this;if(K.collections.indexOf(a)<0)return!1;K.collections.splice(K.collections.indexOf(a),1)};var P=new X;const J={create:function(z){return P.create(z)},factory:P};return a.default})(),z.exports=a()},10800:(z,a,K)=>{"use strict";const{Deflate:v,deflate:T,deflateRaw:m,gzip:p}=K(10808),{Inflate:j,inflate:s,inflateRaw:M,ungzip:r}=K(10860),W=K(10840);z.exports.Deflate=v,z.exports.deflate=T,z.exports.deflateRaw=m,z.exports.gzip=p,z.exports.Inflate=j,z.exports.inflate=s,z.exports.inflateRaw=M,z.exports.ungzip=r,z.exports.constants=W},10808:(z,a,K)=>{"use strict";const v=K(10812),T=K(10845),m=K(10847),p=K(10832),j=K(10855),s=Object.prototype.toString,{Z_NO_FLUSH:M,Z_SYNC_FLUSH:r,Z_FULL_FLUSH:W,Z_FINISH:F,Z_OK:G,Z_STREAM_END:l,Z_DEFAULT_COMPRESSION:V,Z_DEFAULT_STRATEGY:c,Z_DEFLATED:C}=K(10840);function w(z){this.options=T.assign({level:V,method:C,Ja:16384,windowBits:15,memLevel:8,strategy:c},z||{});let a=this.options;a.raw&&a.windowBits>0?a.windowBits=-a.windowBits:a.gzip&&a.windowBits>0&&a.windowBits<16&&(a.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new j,this.strm.avail_out=0;let K=v.deflateInit2(this.strm,a.level,a.method,a.windowBits,a.memLevel,a.strategy);if(K!==G)throw new Error(p[K]);if(a.header&&v.deflateSetHeader(this.strm,a.header),a.dictionary){let z;if(z="string"===typeof a.dictionary?m.string2buf(a.dictionary):"[object ArrayBuffer]"===s.call(a.dictionary)?new Uint8Array(a.dictionary):a.dictionary,K=v.deflateSetDictionary(this.strm,z),K!==G)throw new Error(p[K]);this._dict_set=!0}}function H(z,a){const K=new w(a);if(K.push(z,!0),K.err)throw K.msg||p[K.err];return K.result}w.prototype.push=function(z,a){const K=this.strm,T=this.options.Ja;let p,j;if(this.ended)return!1;for(j=a===~~a?a:!0===a?F:M,"string"===typeof z?K.input=m.string2buf(z):"[object ArrayBuffer]"===s.call(z)?K.input=new Uint8Array(z):K.input=z,K.next_in=0,K.avail_in=K.input.length;;)if(0===K.avail_out&&(K.output=new Uint8Array(T),K.next_out=0,K.avail_out=T),(j===r||j===W)&&K.avail_out<=6)this.onData(K.output.subarray(0,K.next_out)),K.avail_out=0;else{if(p=v.deflate(K,j),p===l)return K.next_out>0&&this.onData(K.output.subarray(0,K.next_out)),p=v.deflateEnd(this.strm),this.onEnd(p),this.ended=!0,p===G;if(0!==K.avail_out){if(j>0&&K.next_out>0)this.onData(K.output.subarray(0,K.next_out)),K.avail_out=0;else if(0===K.avail_in)break}else this.onData(K.output)}return!0},w.prototype.onData=function(z){this.chunks.push(z)},w.prototype.onEnd=function(z){z===G&&(this.result=T.flattenChunks(this.chunks)),this.chunks=[],this.err=z,this.msg=this.strm.msg},z.exports.Deflate=w,z.exports.deflate=H,z.exports.deflateRaw=function(z,a){return(a=a||{}).raw=!0,H(z,a)},z.exports.gzip=function(z,a){return(a=a||{}).gzip=!0,H(z,a)},z.exports.constants=K(10840)},10860:(z,a,K)=>{"use strict";const v=K(10869),T=K(10845),m=K(10847),p=K(10832),j=K(10855),s=K(10885),M=Object.prototype.toString,{Z_NO_FLUSH:r,Z_FINISH:W,Z_OK:F,Z_STREAM_END:G,Z_NEED_DICT:l,Z_STREAM_ERROR:V,Z_DATA_ERROR:c,Z_MEM_ERROR:C}=K(10840);function w(z){this.options=T.assign({Ja:65536,windowBits:15,to:""},z||{});const a=this.options;a.raw&&a.windowBits>=0&&a.windowBits<16&&(a.windowBits=-a.windowBits,0===a.windowBits&&(a.windowBits=-15)),!(a.windowBits>=0&&a.windowBits<16)||z&&z.windowBits||(a.windowBits+=32),a.windowBits>15&&a.windowBits<48&&0===(15&a.windowBits)&&(a.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new j,this.strm.avail_out=0;let K=v.inflateInit2(this.strm,a.windowBits);if(K!==F)throw new Error(p[K]);if(this.header=new s,v.inflateGetHeader(this.strm,this.header),a.dictionary&&("string"===typeof a.dictionary?a.dictionary=m.string2buf(a.dictionary):"[object ArrayBuffer]"===M.call(a.dictionary)&&(a.dictionary=new Uint8Array(a.dictionary)),a.raw&&(K=v.inflateSetDictionary(this.strm,a.dictionary),K!==F)))throw new Error(p[K])}function H(z,a){const K=new w(a);if(K.push(z),K.err)throw K.msg||p[K.err];return K.result}w.prototype.push=function(z,a){const K=this.strm,T=this.options.Ja,p=this.options.dictionary;let j,s,w;if(this.ended)return!1;for(s=a===~~a?a:!0===a?W:r,"[object ArrayBuffer]"===M.call(z)?K.input=new Uint8Array(z):K.input=z,K.next_in=0,K.avail_in=K.input.length;;){for(0===K.avail_out&&(K.output=new Uint8Array(T),K.next_out=0,K.avail_out=T),j=v.inflate(K,s),j===l&&p&&(j=v.inflateSetDictionary(K,p),j===F?j=v.inflate(K,s):j===c&&(j=l));K.avail_in>0&&j===G&&K.state.wrap>0&&0!==z[K.next_in];)v.inflateReset(K),j=v.inflate(K,s);switch(j){case V:case c:case l:case C:return this.onEnd(j),this.ended=!0,!1}if(w=K.avail_out,K.next_out&&(0===K.avail_out||j===G))if("string"===this.options.to){let z=m.utf8border(K.output,K.next_out),a=K.next_out-z,v=m.buf2string(K.output,z);K.next_out=a,K.avail_out=T-a,a&&K.output.set(K.output.subarray(z,z+a),0),this.onData(v)}else this.onData(K.output.length===K.next_out?K.output:K.output.subarray(0,K.next_out));if(j!==F||0!==w){if(j===G)return j=v.inflateEnd(this.strm),this.onEnd(j),this.ended=!0,!0;if(0===K.avail_in)break}}return!0},w.prototype.onData=function(z){this.chunks.push(z)},w.prototype.onEnd=function(z){z===F&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=T.flattenChunks(this.chunks)),this.chunks=[],this.err=z,this.msg=this.strm.msg},z.exports.Inflate=w,z.exports.inflate=H,z.exports.inflateRaw=function(z,a){return(a=a||{}).raw=!0,H(z,a)},z.exports.ungzip=H,z.exports.constants=K(10840)},10845:z=>{"use strict";const a=(z,a)=>Object.prototype.hasOwnProperty.call(z,a);z.exports.assign=function(z){const K=Array.prototype.slice.call(arguments,1);for(;K.length;){const v=K.shift();if(v){if("object"!==typeof v)throw new TypeError(v+"must be non-object");for(const K in v)a(v,K)&&(z[K]=v[K])}}return z},z.exports.flattenChunks=z=>{let a=0;for(let v=0,T=z.length;v<T;v++)a+=z[v].length;const K=new Uint8Array(a);for(let v=0,T=0,m=z.length;v<m;v++){let a=z[v];K.set(a,T),T+=a.length}return K}},10847:z=>{"use strict";let a=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(v){a=!1}const K=new Uint8Array(256);for(let T=0;T<256;T++)K[T]=T>=252?6:T>=248?5:T>=240?4:T>=224?3:T>=192?2:1;K[254]=K[254]=1,z.exports.string2buf=z=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(z);let a,K,v,T,m,p=z.length,j=0;for(T=0;T<p;T++)K=z.charCodeAt(T),55296===(64512&K)&&T+1<p&&(v=z.charCodeAt(T+1),56320===(64512&v)&&(K=65536+(K-55296<<10)+(v-56320),T++)),j+=K<128?1:K<2048?2:K<65536?3:4;for(a=new Uint8Array(j),m=0,T=0;m<j;T++)K=z.charCodeAt(T),55296===(64512&K)&&T+1<p&&(v=z.charCodeAt(T+1),56320===(64512&v)&&(K=65536+(K-55296<<10)+(v-56320),T++)),K<128?a[m++]=K:K<2048?(a[m++]=192|K>>>6,a[m++]=128|63&K):K<65536?(a[m++]=224|K>>>12,a[m++]=128|K>>>6&63,a[m++]=128|63&K):(a[m++]=240|K>>>18,a[m++]=128|K>>>12&63,a[m++]=128|K>>>6&63,a[m++]=128|63&K);return a};z.exports.buf2string=(z,v)=>{const T=v||z.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(z.subarray(0,v));let m,p;const j=new Array(2*T);for(p=0,m=0;m<T;){let a=z[m++];if(a<128){j[p++]=a;continue}let v=K[a];if(v>4)j[p++]=65533,m+=v-1;else{for(a&=2===v?31:3===v?15:7;v>1&&m<T;)a=a<<6|63&z[m++],v--;v>1?j[p++]=65533:a<65536?j[p++]=a:(a-=65536,j[p++]=55296|a>>10&1023,j[p++]=56320|1023&a)}}return((z,K)=>{if(K<65534&&z.subarray&&a)return String.fromCharCode.apply(null,z.length===K?z:z.subarray(0,K));let v="";for(let a=0;a<K;a++)v+=String.fromCharCode(z[a]);return v})(j,p)},z.exports.utf8border=(z,a)=>{(a=a||z.length)>z.length&&(a=z.length);let v=a-1;for(;v>=0&&128===(192&z[v]);)v--;return v<0||0===v?a:v+K[z[v]]>a?v:a}},10825:z=>{"use strict";z.exports=(z,a,K,v)=>{let T=65535&z,m=z>>>16&65535,p=0;for(;0!==K;){p=K>2e3?2e3:K,K-=p;do{T=T+a[v++]|0,m=m+T|0}while(--p);T%=65521,m%=65521}return T|m<<16}},10840:z=>{"use strict";z.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},10829:z=>{"use strict";const a=new Uint32Array((()=>{let z,a=[];for(var K=0;K<256;K++){z=K;for(var v=0;v<8;v++)z=1&z?3988292384^z>>>1:z>>>1;a[K]=z}return a})());z.exports=(z,K,v,T)=>{const m=a,p=T+v;z^=-1;for(let a=T;a<p;a++)z=z>>>8^m[255&(z^K[a])];return~z}},10812:(z,a,K)=>{"use strict";const{_tr_init:v,_tr_stored_block:T,_tr_flush_block:m,_tr_tally:p,_tr_align:j}=K(10821),s=K(10825),M=K(10829),r=K(10832),{Z_NO_FLUSH:W,Z_PARTIAL_FLUSH:F,Z_FULL_FLUSH:G,Z_FINISH:l,Z_BLOCK:V,Z_OK:c,Z_STREAM_END:C,Z_STREAM_ERROR:w,Z_DATA_ERROR:H,Z_BUF_ERROR:f,Z_DEFAULT_COMPRESSION:Y,Z_FILTERED:I,Z_HUFFMAN_ONLY:q,Z_RLE:B,Z_FIXED:x,Z_DEFAULT_STRATEGY:Z,Z_UNKNOWN:y,Z_DEFLATED:i}=K(10840),n=258,X=262,P=103,J=113,o=666,N=(z,a)=>(z.msg=r[a],a),A=z=>(z<<1)-(z>4?9:0),g=z=>{let a=z.length;for(;--a>=0;)z[a]=0};let d=(z,a,K)=>(a<<z.hash_shift^K)&z.hash_mask;const t=z=>{const a=z.state;let K=a.pending;K>z.avail_out&&(K=z.avail_out),0!==K&&(z.output.set(a.pending_buf.subarray(a.pending_out,a.pending_out+K),z.next_out),z.next_out+=K,a.pending_out+=K,z.total_out+=K,z.avail_out-=K,a.pending-=K,0===a.pending&&(a.pending_out=0))},e=(z,a)=>{m(z,z.block_start>=0?z.block_start:-1,z.strstart-z.block_start,a),z.block_start=z.strstart,t(z.strm)},L=(z,a)=>{z.pending_buf[z.pending++]=a},E=(z,a)=>{z.pending_buf[z.pending++]=a>>>8&255,z.pending_buf[z.pending++]=255&a},b=(z,a,K,v)=>{let T=z.avail_in;return T>v&&(T=v),0===T?0:(z.avail_in-=T,a.set(z.input.subarray(z.next_in,z.next_in+T),K),1===z.state.wrap?z.adler=s(z.adler,a,T,K):2===z.state.wrap&&(z.adler=M(z.adler,a,T,K)),z.next_in+=T,z.total_in+=T,T)},D=(z,a)=>{let K,v,T=z.max_chain_length,m=z.strstart,p=z.prev_length,j=z.nice_match;const s=z.strstart>z.w_size-X?z.strstart-(z.w_size-X):0,M=z.window,r=z.w_mask,W=z.prev,F=z.strstart+n;let G=M[m+p-1],l=M[m+p];z.prev_length>=z.good_match&&(T>>=2),j>z.lookahead&&(j=z.lookahead);do{if(K=a,M[K+p]===l&&M[K+p-1]===G&&M[K]===M[m]&&M[++K]===M[m+1]){m+=2,K++;do{}while(M[++m]===M[++K]&&M[++m]===M[++K]&&M[++m]===M[++K]&&M[++m]===M[++K]&&M[++m]===M[++K]&&M[++m]===M[++K]&&M[++m]===M[++K]&&M[++m]===M[++K]&&m<F);if(v=n-(F-m),m=F-n,v>p){if(z.match_start=a,p=v,v>=j)break;G=M[m+p-1],l=M[m+p]}}}while((a=W[a&r])>s&&0!==--T);return p<=z.lookahead?p:z.lookahead},u=z=>{const a=z.w_size;let K,v,T,m,p;do{if(m=z.window_size-z.lookahead-z.strstart,z.strstart>=a+(a-X)){z.window.set(z.window.subarray(a,a+a),0),z.match_start-=a,z.strstart-=a,z.block_start-=a,v=z.hash_size,K=v;do{T=z.head[--K],z.head[K]=T>=a?T-a:0}while(--v);v=a,K=v;do{T=z.prev[--K],z.prev[K]=T>=a?T-a:0}while(--v);m+=a}if(0===z.strm.avail_in)break;if(v=b(z.strm,z.window,z.strstart+z.lookahead,m),z.lookahead+=v,z.lookahead+z.insert>=3)for(p=z.strstart-z.insert,z.ins_h=z.window[p],z.ins_h=d(z,z.ins_h,z.window[p+1]);z.insert&&(z.ins_h=d(z,z.ins_h,z.window[p+3-1]),z.prev[p&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=p,p++,z.insert--,!(z.lookahead+z.insert<3)););}while(z.lookahead<X&&0!==z.strm.avail_in)},U=(z,a)=>{let K,v;for(;;){if(z.lookahead<X){if(u(z),z.lookahead<X&&a===W)return 1;if(0===z.lookahead)break}if(K=0,z.lookahead>=3&&(z.ins_h=d(z,z.ins_h,z.window[z.strstart+3-1]),K=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),0!==K&&z.strstart-K<=z.w_size-X&&(z.match_length=D(z,K)),z.match_length>=3)if(v=p(z,z.strstart-z.match_start,z.match_length-3),z.lookahead-=z.match_length,z.match_length<=z.max_lazy_match&&z.lookahead>=3){z.match_length--;do{z.strstart++,z.ins_h=d(z,z.ins_h,z.window[z.strstart+3-1]),K=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart}while(0!==--z.match_length);z.strstart++}else z.strstart+=z.match_length,z.match_length=0,z.ins_h=z.window[z.strstart],z.ins_h=d(z,z.ins_h,z.window[z.strstart+1]);else v=p(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++;if(v&&(e(z,!1),0===z.strm.avail_out))return 1}return z.insert=z.strstart<2?z.strstart:2,a===l?(e(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(e(z,!1),0===z.strm.avail_out)?1:2},R=(z,a)=>{let K,v,T;for(;;){if(z.lookahead<X){if(u(z),z.lookahead<X&&a===W)return 1;if(0===z.lookahead)break}if(K=0,z.lookahead>=3&&(z.ins_h=d(z,z.ins_h,z.window[z.strstart+3-1]),K=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),z.prev_length=z.match_length,z.prev_match=z.match_start,z.match_length=2,0!==K&&z.prev_length<z.max_lazy_match&&z.strstart-K<=z.w_size-X&&(z.match_length=D(z,K),z.match_length<=5&&(z.strategy===I||3===z.match_length&&z.strstart-z.match_start>4096)&&(z.match_length=2)),z.prev_length>=3&&z.match_length<=z.prev_length){T=z.strstart+z.lookahead-3,v=p(z,z.strstart-1-z.prev_match,z.prev_length-3),z.lookahead-=z.prev_length-1,z.prev_length-=2;do{++z.strstart<=T&&(z.ins_h=d(z,z.ins_h,z.window[z.strstart+3-1]),K=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart)}while(0!==--z.prev_length);if(z.match_available=0,z.match_length=2,z.strstart++,v&&(e(z,!1),0===z.strm.avail_out))return 1}else if(z.match_available){if(v=p(z,0,z.window[z.strstart-1]),v&&e(z,!1),z.strstart++,z.lookahead--,0===z.strm.avail_out)return 1}else z.match_available=1,z.strstart++,z.lookahead--}return z.match_available&&(v=p(z,0,z.window[z.strstart-1]),z.match_available=0),z.insert=z.strstart<2?z.strstart:2,a===l?(e(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(e(z,!1),0===z.strm.avail_out)?1:2};function k(z,a,K,v,T){this.good_length=z,this.max_lazy=a,this.nice_length=K,this.max_chain=v,this.func=T}const h=[new k(0,0,0,0,((z,a)=>{let K=65535;for(K>z.pending_buf_size-5&&(K=z.pending_buf_size-5);;){if(z.lookahead<=1){if(u(z),0===z.lookahead&&a===W)return 1;if(0===z.lookahead)break}z.strstart+=z.lookahead,z.lookahead=0;const v=z.block_start+K;if((0===z.strstart||z.strstart>=v)&&(z.lookahead=z.strstart-v,z.strstart=v,e(z,!1),0===z.strm.avail_out))return 1;if(z.strstart-z.block_start>=z.w_size-X&&(e(z,!1),0===z.strm.avail_out))return 1}return z.insert=0,a===l?(e(z,!0),0===z.strm.avail_out?3:4):(z.strstart>z.block_start&&(e(z,!1),z.strm.avail_out),1)})),new k(4,4,8,4,U),new k(4,5,16,8,U),new k(4,6,32,32,U),new k(4,4,16,16,R),new k(8,16,32,32,R),new k(8,16,128,128,R),new k(8,32,128,256,R),new k(32,128,258,1024,R),new k(32,258,258,4096,R)];function S(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=i,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),g(this.dyn_ltree),g(this.dyn_dtree),g(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),g(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),g(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Q=z=>{if(!z||!z.state)return N(z,w);z.total_in=z.total_out=0,z.data_type=y;const a=z.state;return a.pending=0,a.pending_out=0,a.wrap<0&&(a.wrap=-a.wrap),a.status=a.wrap?42:J,z.adler=2===a.wrap?0:1,a.last_flush=W,v(a),c},O=z=>{const a=Q(z);var K;return a===c&&((K=z.state).window_size=2*K.w_size,g(K.head),K.max_lazy_match=h[K.level].max_lazy,K.good_match=h[K.level].good_length,K.nice_match=h[K.level].nice_length,K.max_chain_length=h[K.level].max_chain,K.strstart=0,K.block_start=0,K.lookahead=0,K.insert=0,K.match_length=K.prev_length=2,K.match_available=0,K.ins_h=0),a},zz=(z,a,K,v,T,m)=>{if(!z)return w;let p=1;if(a===Y&&(a=6),v<0?(p=0,v=-v):v>15&&(p=2,v-=16),T<1||T>9||K!==i||v<8||v>15||a<0||a>9||m<0||m>x)return N(z,w);8===v&&(v=9);const j=new S;return z.state=j,j.strm=z,j.wrap=p,j.gzhead=null,j.w_bits=v,j.w_size=1<<j.w_bits,j.w_mask=j.w_size-1,j.hash_bits=T+7,j.hash_size=1<<j.hash_bits,j.hash_mask=j.hash_size-1,j.hash_shift=~~((j.hash_bits+3-1)/3),j.window=new Uint8Array(2*j.w_size),j.head=new Uint16Array(j.hash_size),j.prev=new Uint16Array(j.w_size),j.lit_bufsize=1<<T+6,j.pending_buf_size=4*j.lit_bufsize,j.pending_buf=new Uint8Array(j.pending_buf_size),j.d_buf=1*j.lit_bufsize,j.l_buf=3*j.lit_bufsize,j.level=a,j.strategy=m,j.method=K,O(z)};z.exports.deflateInit=(z,a)=>zz(z,a,i,15,8,Z),z.exports.deflateInit2=zz,z.exports.deflateReset=O,z.exports.deflateResetKeep=Q,z.exports.deflateSetHeader=(z,a)=>z&&z.state?2!==z.state.wrap?w:(z.state.gzhead=a,c):w,z.exports.deflate=(z,a)=>{let K,v;if(!z||!z.state||a>V||a<0)return z?N(z,w):w;const m=z.state;if(!z.output||!z.input&&0!==z.avail_in||m.status===o&&a!==l)return N(z,0===z.avail_out?f:w);m.strm=z;const s=m.last_flush;if(m.last_flush=a,42===m.status)if(2===m.wrap)z.adler=0,L(m,31),L(m,139),L(m,8),m.gzhead?(L(m,(m.gzhead.text?1:0)+(m.gzhead.hcrc?2:0)+(m.gzhead.extra?4:0)+(m.gzhead.name?8:0)+(m.gzhead.comment?16:0)),L(m,255&m.gzhead.time),L(m,m.gzhead.time>>8&255),L(m,m.gzhead.time>>16&255),L(m,m.gzhead.time>>24&255),L(m,9===m.level?2:m.strategy>=q||m.level<2?4:0),L(m,255&m.gzhead.os),m.gzhead.extra&&m.gzhead.extra.length&&(L(m,255&m.gzhead.extra.length),L(m,m.gzhead.extra.length>>8&255)),m.gzhead.hcrc&&(z.adler=M(z.adler,m.pending_buf,m.pending,0)),m.gzindex=0,m.status=69):(L(m,0),L(m,0),L(m,0),L(m,0),L(m,0),L(m,9===m.level?2:m.strategy>=q||m.level<2?4:0),L(m,3),m.status=J);else{let a=i+(m.w_bits-8<<4)<<8,K=-1;K=m.strategy>=q||m.level<2?0:m.level<6?1:6===m.level?2:3,a|=K<<6,0!==m.strstart&&(a|=32),a+=31-a%31,m.status=J,E(m,a),0!==m.strstart&&(E(m,z.adler>>>16),E(m,65535&z.adler)),z.adler=1}if(69===m.status)if(m.gzhead.extra){for(K=m.pending;m.gzindex<(65535&m.gzhead.extra.length)&&(m.pending!==m.pending_buf_size||(m.gzhead.hcrc&&m.pending>K&&(z.adler=M(z.adler,m.pending_buf,m.pending-K,K)),t(z),K=m.pending,m.pending!==m.pending_buf_size));)L(m,255&m.gzhead.extra[m.gzindex]),m.gzindex++;m.gzhead.hcrc&&m.pending>K&&(z.adler=M(z.adler,m.pending_buf,m.pending-K,K)),m.gzindex===m.gzhead.extra.length&&(m.gzindex=0,m.status=73)}else m.status=73;if(73===m.status)if(m.gzhead.name){K=m.pending;do{if(m.pending===m.pending_buf_size&&(m.gzhead.hcrc&&m.pending>K&&(z.adler=M(z.adler,m.pending_buf,m.pending-K,K)),t(z),K=m.pending,m.pending===m.pending_buf_size)){v=1;break}v=m.gzindex<m.gzhead.name.length?255&m.gzhead.name.charCodeAt(m.gzindex++):0,L(m,v)}while(0!==v);m.gzhead.hcrc&&m.pending>K&&(z.adler=M(z.adler,m.pending_buf,m.pending-K,K)),0===v&&(m.gzindex=0,m.status=91)}else m.status=91;if(91===m.status)if(m.gzhead.comment){K=m.pending;do{if(m.pending===m.pending_buf_size&&(m.gzhead.hcrc&&m.pending>K&&(z.adler=M(z.adler,m.pending_buf,m.pending-K,K)),t(z),K=m.pending,m.pending===m.pending_buf_size)){v=1;break}v=m.gzindex<m.gzhead.comment.length?255&m.gzhead.comment.charCodeAt(m.gzindex++):0,L(m,v)}while(0!==v);m.gzhead.hcrc&&m.pending>K&&(z.adler=M(z.adler,m.pending_buf,m.pending-K,K)),0===v&&(m.status=P)}else m.status=P;if(m.status===P&&(m.gzhead.hcrc?(m.pending+2>m.pending_buf_size&&t(z),m.pending+2<=m.pending_buf_size&&(L(m,255&z.adler),L(m,z.adler>>8&255),z.adler=0,m.status=J)):m.status=J),0!==m.pending){if(t(z),0===z.avail_out)return m.last_flush=-1,c}else if(0===z.avail_in&&A(a)<=A(s)&&a!==l)return N(z,f);if(m.status===o&&0!==z.avail_in)return N(z,f);if(0!==z.avail_in||0!==m.lookahead||a!==W&&m.status!==o){let K=m.strategy===q?((z,a)=>{let K;for(;;){if(0===z.lookahead&&(u(z),0===z.lookahead)){if(a===W)return 1;break}if(z.match_length=0,K=p(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,K&&(e(z,!1),0===z.strm.avail_out))return 1}return z.insert=0,a===l?(e(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(e(z,!1),0===z.strm.avail_out)?1:2})(m,a):m.strategy===B?((z,a)=>{let K,v,T,m;const j=z.window;for(;;){if(z.lookahead<=n){if(u(z),z.lookahead<=n&&a===W)return 1;if(0===z.lookahead)break}if(z.match_length=0,z.lookahead>=3&&z.strstart>0&&(T=z.strstart-1,v=j[T],v===j[++T]&&v===j[++T]&&v===j[++T])){m=z.strstart+n;do{}while(v===j[++T]&&v===j[++T]&&v===j[++T]&&v===j[++T]&&v===j[++T]&&v===j[++T]&&v===j[++T]&&v===j[++T]&&T<m);z.match_length=n-(m-T),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=3?(K=p(z,1,z.match_length-3),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):(K=p(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),K&&(e(z,!1),0===z.strm.avail_out))return 1}return z.insert=0,a===l?(e(z,!0),0===z.strm.avail_out?3:4):z.last_lit&&(e(z,!1),0===z.strm.avail_out)?1:2})(m,a):h[m.level].func(m,a);if(3!==K&&4!==K||(m.status=o),1===K||3===K)return 0===z.avail_out&&(m.last_flush=-1),c;if(2===K&&(a===F?j(m):a!==V&&(T(m,0,0,!1),a===G&&(g(m.head),0===m.lookahead&&(m.strstart=0,m.block_start=0,m.insert=0))),t(z),0===z.avail_out))return m.last_flush=-1,c}return a!==l?c:m.wrap<=0?C:(2===m.wrap?(L(m,255&z.adler),L(m,z.adler>>8&255),L(m,z.adler>>16&255),L(m,z.adler>>24&255),L(m,255&z.total_in),L(m,z.total_in>>8&255),L(m,z.total_in>>16&255),L(m,z.total_in>>24&255)):(E(m,z.adler>>>16),E(m,65535&z.adler)),t(z),m.wrap>0&&(m.wrap=-m.wrap),0!==m.pending?c:C)},z.exports.deflateEnd=z=>{if(!z||!z.state)return w;const a=z.state.status;return 42!==a&&69!==a&&73!==a&&91!==a&&a!==P&&a!==J&&a!==o?N(z,w):(z.state=null,a===J?N(z,H):c)},z.exports.deflateSetDictionary=(z,a)=>{let K=a.length;if(!z||!z.state)return w;const v=z.state,T=v.wrap;if(2===T||1===T&&42!==v.status||v.lookahead)return w;if(1===T&&(z.adler=s(z.adler,a,K,0)),v.wrap=0,K>=v.w_size){0===T&&(g(v.head),v.strstart=0,v.block_start=0,v.insert=0);let z=new Uint8Array(v.w_size);z.set(a.subarray(K-v.w_size,K),0),a=z,K=v.w_size}const m=z.avail_in,p=z.next_in,j=z.input;for(z.avail_in=K,z.next_in=0,z.input=a,u(v);v.lookahead>=3;){let z=v.strstart,a=v.lookahead-2;do{v.ins_h=d(v,v.ins_h,v.window[z+3-1]),v.prev[z&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=z,z++}while(--a);v.strstart=z,v.lookahead=2,u(v)}return v.strstart+=v.lookahead,v.block_start=v.strstart,v.insert=v.lookahead,v.lookahead=0,v.match_length=v.prev_length=2,v.match_available=0,z.next_in=p,z.input=j,z.avail_in=m,v.wrap=T,c},z.exports.deflateInfo="pako deflate (from Nodeca project)"},10885:z=>{"use strict";z.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},10873:z=>{"use strict";z.exports=function(z,a){let K,v,T,m,p,j,s,M,r,W,F,G,l,V,c,C,w,H,f,Y,I,q,B,x;const Z=z.state;K=z.next_in,B=z.input,v=K+(z.avail_in-5),T=z.next_out,x=z.output,m=T-(a-z.avail_out),p=T+(z.avail_out-257),j=Z.dmax,s=Z.wsize,M=Z.whave,r=Z.wnext,W=Z.window,F=Z.hold,G=Z.bits,l=Z.lencode,V=Z.distcode,c=(1<<Z.lenbits)-1,C=(1<<Z.distbits)-1;z:do{G<15&&(F+=B[K++]<<G,G+=8,F+=B[K++]<<G,G+=8),w=l[F&c];a:for(;;){if(H=w>>>24,F>>>=H,G-=H,H=w>>>16&255,0===H)x[T++]=65535&w;else{if(!(16&H)){if(0===(64&H)){w=l[(65535&w)+(F&(1<<H)-1)];continue a}if(32&H){Z.mode=12;break z}z.msg="invalid literal/length code",Z.mode=30;break z}f=65535&w,H&=15,H&&(G<H&&(F+=B[K++]<<G,G+=8),f+=F&(1<<H)-1,F>>>=H,G-=H),G<15&&(F+=B[K++]<<G,G+=8,F+=B[K++]<<G,G+=8),w=V[F&C];K:for(;;){if(H=w>>>24,F>>>=H,G-=H,H=w>>>16&255,!(16&H)){if(0===(64&H)){w=V[(65535&w)+(F&(1<<H)-1)];continue K}z.msg="invalid distance code",Z.mode=30;break z}if(Y=65535&w,H&=15,G<H&&(F+=B[K++]<<G,G+=8,G<H&&(F+=B[K++]<<G,G+=8)),Y+=F&(1<<H)-1,Y>j){z.msg="invalid distance too far back",Z.mode=30;break z}if(F>>>=H,G-=H,H=T-m,Y>H){if(H=Y-H,H>M&&Z.sane){z.msg="invalid distance too far back",Z.mode=30;break z}if(I=0,q=W,0===r){if(I+=s-H,H<f){f-=H;do{x[T++]=W[I++]}while(--H);I=T-Y,q=x}}else if(r<H){if(I+=s+r-H,H-=r,H<f){f-=H;do{x[T++]=W[I++]}while(--H);if(I=0,r<f){H=r,f-=H;do{x[T++]=W[I++]}while(--H);I=T-Y,q=x}}}else if(I+=r-H,H<f){f-=H;do{x[T++]=W[I++]}while(--H);I=T-Y,q=x}for(;f>2;)x[T++]=q[I++],x[T++]=q[I++],x[T++]=q[I++],f-=3;f&&(x[T++]=q[I++],f>1&&(x[T++]=q[I++]))}else{I=T-Y;do{x[T++]=x[I++],x[T++]=x[I++],x[T++]=x[I++],f-=3}while(f>2);f&&(x[T++]=x[I++],f>1&&(x[T++]=x[I++]))}break}}break}}while(K<v&&T<p);f=G>>3,K-=f,G-=f<<3,F&=(1<<G)-1,z.next_in=K,z.next_out=T,z.avail_in=K<v?v-K+5:5-(K-v),z.avail_out=T<p?p-T+257:257-(T-p),Z.hold=F,Z.bits=G}},10869:(z,a,K)=>{"use strict";const v=K(10825),T=K(10829),m=K(10873),p=K(10880),{Z_FINISH:j,Z_BLOCK:s,Z_TREES:M,Z_OK:r,Z_STREAM_END:W,Z_NEED_DICT:F,Z_STREAM_ERROR:G,Z_DATA_ERROR:l,Z_MEM_ERROR:V,Z_BUF_ERROR:c,Z_DEFLATED:C}=K(10840),w=12,H=30,f=z=>(z>>>24&255)+(z>>>8&65280)+((65280&z)<<8)+((255&z)<<24);function Y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const I=z=>{if(!z||!z.state)return G;const a=z.state;return z.total_in=z.total_out=a.total=0,z.msg="",a.wrap&&(z.adler=1&a.wrap),a.mode=1,a.last=0,a.havedict=0,a.dmax=32768,a.head=null,a.hold=0,a.bits=0,a.lencode=a.lendyn=new Int32Array(852),a.distcode=a.distdyn=new Int32Array(592),a.sane=1,a.back=-1,r},q=z=>{if(!z||!z.state)return G;const a=z.state;return a.wsize=0,a.whave=0,a.wnext=0,I(z)},B=(z,a)=>{let K;if(!z||!z.state)return G;const v=z.state;return a<0?(K=0,a=-a):(K=1+(a>>4),a<48&&(a&=15)),a&&(a<8||a>15)?G:(null!==v.window&&v.wbits!==a&&(v.window=null),v.wrap=K,v.wbits=a,q(z))},x=(z,a)=>{if(!z)return G;const K=new Y;z.state=K,K.window=null;const v=B(z,a);return v!==r&&(z.state=null),v};let Z,y,i=!0;const n=z=>{if(i){Z=new Int32Array(512),y=new Int32Array(32);let a=0;for(;a<144;)z.lens[a++]=8;for(;a<256;)z.lens[a++]=9;for(;a<280;)z.lens[a++]=7;for(;a<288;)z.lens[a++]=8;for(p(1,z.lens,0,288,Z,0,z.work,{bits:9}),a=0;a<32;)z.lens[a++]=5;p(2,z.lens,0,32,y,0,z.work,{bits:5}),i=!1}z.lencode=Z,z.lenbits=9,z.distcode=y,z.distbits=5},X=(z,a,K,v)=>{let T;const m=z.state;return null===m.window&&(m.wsize=1<<m.wbits,m.wnext=0,m.whave=0,m.window=new Uint8Array(m.wsize)),v>=m.wsize?(m.window.set(a.subarray(K-m.wsize,K),0),m.wnext=0,m.whave=m.wsize):(T=m.wsize-m.wnext,T>v&&(T=v),m.window.set(a.subarray(K-v,K-v+T),m.wnext),(v-=T)?(m.window.set(a.subarray(K-v,K),0),m.wnext=v,m.whave=m.wsize):(m.wnext+=T,m.wnext===m.wsize&&(m.wnext=0),m.whave<m.wsize&&(m.whave+=T))),0};z.exports.inflateReset=q,z.exports.inflateReset2=B,z.exports.inflateResetKeep=I,z.exports.inflateInit=z=>x(z,15),z.exports.inflateInit2=x,z.exports.inflate=(z,a)=>{let K,Y,I,q,B,x,Z,y,i,P,J,o,N,A,g,d,t,e,L,E,b,D,u=0;const U=new Uint8Array(4);let R,k;const h=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!z||!z.state||!z.output||!z.input&&0!==z.avail_in)return G;K=z.state,K.mode===w&&(K.mode=13),B=z.next_out,I=z.output,Z=z.avail_out,q=z.next_in,Y=z.input,x=z.avail_in,y=K.hold,i=K.bits,P=x,J=Z,D=r;z:for(;;)switch(K.mode){case 1:if(0===K.wrap){K.mode=13;break}for(;i<16;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}if(2&K.wrap&&35615===y){K.check=0,U[0]=255&y,U[1]=y>>>8&255,K.check=T(K.check,U,2,0),y=0,i=0,K.mode=2;break}if(K.flags=0,K.head&&(K.head.done=!1),!(1&K.wrap)||(((255&y)<<8)+(y>>8))%31){z.msg="incorrect header check",K.mode=H;break}if((15&y)!==C){z.msg="unknown compression method",K.mode=H;break}if(y>>>=4,i-=4,b=8+(15&y),0===K.wbits)K.wbits=b;else if(b>K.wbits){z.msg="invalid window size",K.mode=H;break}K.dmax=1<<K.wbits,z.adler=K.check=1,K.mode=512&y?10:w,y=0,i=0;break;case 2:for(;i<16;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}if(K.flags=y,(255&K.flags)!==C){z.msg="unknown compression method",K.mode=H;break}if(57344&K.flags){z.msg="unknown header flags set",K.mode=H;break}K.head&&(K.head.text=y>>8&1),512&K.flags&&(U[0]=255&y,U[1]=y>>>8&255,K.check=T(K.check,U,2,0)),y=0,i=0,K.mode=3;case 3:for(;i<32;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}K.head&&(K.head.time=y),512&K.flags&&(U[0]=255&y,U[1]=y>>>8&255,U[2]=y>>>16&255,U[3]=y>>>24&255,K.check=T(K.check,U,4,0)),y=0,i=0,K.mode=4;case 4:for(;i<16;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}K.head&&(K.head.xflags=255&y,K.head.os=y>>8),512&K.flags&&(U[0]=255&y,U[1]=y>>>8&255,K.check=T(K.check,U,2,0)),y=0,i=0,K.mode=5;case 5:if(1024&K.flags){for(;i<16;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}K.length=y,K.head&&(K.head.extra_len=y),512&K.flags&&(U[0]=255&y,U[1]=y>>>8&255,K.check=T(K.check,U,2,0)),y=0,i=0}else K.head&&(K.head.extra=null);K.mode=6;case 6:if(1024&K.flags&&(o=K.length,o>x&&(o=x),o&&(K.head&&(b=K.head.extra_len-K.length,K.head.extra||(K.head.extra=new Uint8Array(K.head.extra_len)),K.head.extra.set(Y.subarray(q,q+o),b)),512&K.flags&&(K.check=T(K.check,Y,o,q)),x-=o,q+=o,K.length-=o),K.length))break z;K.length=0,K.mode=7;case 7:if(2048&K.flags){if(0===x)break z;o=0;do{b=Y[q+o++],K.head&&b&&K.length<65536&&(K.head.name+=String.fromCharCode(b))}while(b&&o<x);if(512&K.flags&&(K.check=T(K.check,Y,o,q)),x-=o,q+=o,b)break z}else K.head&&(K.head.name=null);K.length=0,K.mode=8;case 8:if(4096&K.flags){if(0===x)break z;o=0;do{b=Y[q+o++],K.head&&b&&K.length<65536&&(K.head.comment+=String.fromCharCode(b))}while(b&&o<x);if(512&K.flags&&(K.check=T(K.check,Y,o,q)),x-=o,q+=o,b)break z}else K.head&&(K.head.comment=null);K.mode=9;case 9:if(512&K.flags){for(;i<16;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}if(y!==(65535&K.check)){z.msg="header crc mismatch",K.mode=H;break}y=0,i=0}K.head&&(K.head.hcrc=K.flags>>9&1,K.head.done=!0),z.adler=K.check=0,K.mode=w;break;case 10:for(;i<32;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}z.adler=K.check=f(y),y=0,i=0,K.mode=11;case 11:if(0===K.havedict)return z.next_out=B,z.avail_out=Z,z.next_in=q,z.avail_in=x,K.hold=y,K.bits=i,F;z.adler=K.check=1,K.mode=w;case w:if(a===s||a===M)break z;case 13:if(K.last){y>>>=7&i,i-=7&i,K.mode=27;break}for(;i<3;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}switch(K.last=1&y,y>>>=1,i-=1,3&y){case 0:K.mode=14;break;case 1:if(n(K),K.mode=20,a===M){y>>>=2,i-=2;break z}break;case 2:K.mode=17;break;case 3:z.msg="invalid block type",K.mode=H}y>>>=2,i-=2;break;case 14:for(y>>>=7&i,i-=7&i;i<32;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}if((65535&y)!==(y>>>16^65535)){z.msg="invalid stored block lengths",K.mode=H;break}if(K.length=65535&y,y=0,i=0,K.mode=15,a===M)break z;case 15:K.mode=16;case 16:if(o=K.length,o){if(o>x&&(o=x),o>Z&&(o=Z),0===o)break z;I.set(Y.subarray(q,q+o),B),x-=o,q+=o,Z-=o,B+=o,K.length-=o;break}K.mode=w;break;case 17:for(;i<14;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}if(K.nlen=257+(31&y),y>>>=5,i-=5,K.ndist=1+(31&y),y>>>=5,i-=5,K.ncode=4+(15&y),y>>>=4,i-=4,K.nlen>286||K.ndist>30){z.msg="too many length or distance symbols",K.mode=H;break}K.have=0,K.mode=18;case 18:for(;K.have<K.ncode;){for(;i<3;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}K.lens[h[K.have++]]=7&y,y>>>=3,i-=3}for(;K.have<19;)K.lens[h[K.have++]]=0;if(K.lencode=K.lendyn,K.lenbits=7,R={bits:K.lenbits},D=p(0,K.lens,0,19,K.lencode,0,K.work,R),K.lenbits=R.bits,D){z.msg="invalid code lengths set",K.mode=H;break}K.have=0,K.mode=19;case 19:for(;K.have<K.nlen+K.ndist;){for(;u=K.lencode[y&(1<<K.lenbits)-1],g=u>>>24,d=u>>>16&255,t=65535&u,!(g<=i);){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}if(t<16)y>>>=g,i-=g,K.lens[K.have++]=t;else{if(16===t){for(k=g+2;i<k;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}if(y>>>=g,i-=g,0===K.have){z.msg="invalid bit length repeat",K.mode=H;break}b=K.lens[K.have-1],o=3+(3&y),y>>>=2,i-=2}else if(17===t){for(k=g+3;i<k;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}y>>>=g,i-=g,b=0,o=3+(7&y),y>>>=3,i-=3}else{for(k=g+7;i<k;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}y>>>=g,i-=g,b=0,o=11+(127&y),y>>>=7,i-=7}if(K.have+o>K.nlen+K.ndist){z.msg="invalid bit length repeat",K.mode=H;break}for(;o--;)K.lens[K.have++]=b}}if(K.mode===H)break;if(0===K.lens[256]){z.msg="invalid code -- missing end-of-block",K.mode=H;break}if(K.lenbits=9,R={bits:K.lenbits},D=p(1,K.lens,0,K.nlen,K.lencode,0,K.work,R),K.lenbits=R.bits,D){z.msg="invalid literal/lengths set",K.mode=H;break}if(K.distbits=6,K.distcode=K.distdyn,R={bits:K.distbits},D=p(2,K.lens,K.nlen,K.ndist,K.distcode,0,K.work,R),K.distbits=R.bits,D){z.msg="invalid distances set",K.mode=H;break}if(K.mode=20,a===M)break z;case 20:K.mode=21;case 21:if(x>=6&&Z>=258){z.next_out=B,z.avail_out=Z,z.next_in=q,z.avail_in=x,K.hold=y,K.bits=i,m(z,J),B=z.next_out,I=z.output,Z=z.avail_out,q=z.next_in,Y=z.input,x=z.avail_in,y=K.hold,i=K.bits,K.mode===w&&(K.back=-1);break}for(K.back=0;u=K.lencode[y&(1<<K.lenbits)-1],g=u>>>24,d=u>>>16&255,t=65535&u,!(g<=i);){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}if(d&&0===(240&d)){for(e=g,L=d,E=t;u=K.lencode[E+((y&(1<<e+L)-1)>>e)],g=u>>>24,d=u>>>16&255,t=65535&u,!(e+g<=i);){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}y>>>=e,i-=e,K.back+=e}if(y>>>=g,i-=g,K.back+=g,K.length=t,0===d){K.mode=26;break}if(32&d){K.back=-1,K.mode=w;break}if(64&d){z.msg="invalid literal/length code",K.mode=H;break}K.extra=15&d,K.mode=22;case 22:if(K.extra){for(k=K.extra;i<k;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}K.length+=y&(1<<K.extra)-1,y>>>=K.extra,i-=K.extra,K.back+=K.extra}K.was=K.length,K.mode=23;case 23:for(;u=K.distcode[y&(1<<K.distbits)-1],g=u>>>24,d=u>>>16&255,t=65535&u,!(g<=i);){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}if(0===(240&d)){for(e=g,L=d,E=t;u=K.distcode[E+((y&(1<<e+L)-1)>>e)],g=u>>>24,d=u>>>16&255,t=65535&u,!(e+g<=i);){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}y>>>=e,i-=e,K.back+=e}if(y>>>=g,i-=g,K.back+=g,64&d){z.msg="invalid distance code",K.mode=H;break}K.offset=t,K.extra=15&d,K.mode=24;case 24:if(K.extra){for(k=K.extra;i<k;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}K.offset+=y&(1<<K.extra)-1,y>>>=K.extra,i-=K.extra,K.back+=K.extra}if(K.offset>K.dmax){z.msg="invalid distance too far back",K.mode=H;break}K.mode=25;case 25:if(0===Z)break z;if(o=J-Z,K.offset>o){if(o=K.offset-o,o>K.whave&&K.sane){z.msg="invalid distance too far back",K.mode=H;break}o>K.wnext?(o-=K.wnext,N=K.wsize-o):N=K.wnext-o,o>K.length&&(o=K.length),A=K.window}else A=I,N=B-K.offset,o=K.length;o>Z&&(o=Z),Z-=o,K.length-=o;do{I[B++]=A[N++]}while(--o);0===K.length&&(K.mode=21);break;case 26:if(0===Z)break z;I[B++]=K.length,Z--,K.mode=21;break;case 27:if(K.wrap){for(;i<32;){if(0===x)break z;x--,y|=Y[q++]<<i,i+=8}if(J-=Z,z.total_out+=J,K.total+=J,J&&(z.adler=K.check=K.flags?T(K.check,I,J,B-J):v(K.check,I,J,B-J)),J=Z,(K.flags?y:f(y))!==K.check){z.msg="incorrect data check",K.mode=H;break}y=0,i=0}K.mode=28;case 28:if(K.wrap&&K.flags){for(;i<32;){if(0===x)break z;x--,y+=Y[q++]<<i,i+=8}if(y!==(4294967295&K.total)){z.msg="incorrect length check",K.mode=H;break}y=0,i=0}K.mode=29;case 29:D=W;break z;case H:D=l;break z;case 31:return V;default:return G}return z.next_out=B,z.avail_out=Z,z.next_in=q,z.avail_in=x,K.hold=y,K.bits=i,(K.wsize||J!==z.avail_out&&K.mode<H&&(K.mode<27||a!==j))&&X(z,z.output,z.next_out,J-z.avail_out)?(K.mode=31,V):(P-=z.avail_in,J-=z.avail_out,z.total_in+=P,z.total_out+=J,K.total+=J,K.wrap&&J&&(z.adler=K.check=K.flags?T(K.check,I,J,z.next_out-J):v(K.check,I,J,z.next_out-J)),z.data_type=K.bits+(K.last?64:0)+(K.mode===w?128:0)+(20===K.mode||15===K.mode?256:0),(0===P&&0===J||a===j)&&D===r&&(D=c),D)},z.exports.inflateEnd=z=>{if(!z||!z.state)return G;let a=z.state;return a.window&&(a.window=null),z.state=null,r},z.exports.inflateGetHeader=(z,a)=>{if(!z||!z.state)return G;const K=z.state;return 0===(2&K.wrap)?G:(K.head=a,a.done=!1,r)},z.exports.inflateSetDictionary=(z,a)=>{const K=a.length;let T,m,p;return z&&z.state?(T=z.state,0!==T.wrap&&11!==T.mode?G:11===T.mode&&(m=1,m=v(m,a,K,0),m!==T.check)?l:(p=X(z,a,K,K),p?(T.mode=31,V):(T.havedict=1,r))):G},z.exports.inflateInfo="pako inflate (from Nodeca project)"},10880:z=>{"use strict";const a=15,K=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),v=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),T=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),m=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);z.exports=(z,p,j,s,M,r,W,F)=>{const G=F.bits;let l,V,c,C,w,H,f=0,Y=0,I=0,q=0,B=0,x=0,Z=0,y=0,i=0,n=0,X=null,P=0;const J=new Uint16Array(16),o=new Uint16Array(16);let N,A,g,d=null,t=0;for(f=0;f<=a;f++)J[f]=0;for(Y=0;Y<s;Y++)J[p[j+Y]]++;for(B=G,q=a;q>=1&&0===J[q];q--);if(B>q&&(B=q),0===q)return M[r++]=20971520,M[r++]=20971520,F.bits=1,0;for(I=1;I<q&&0===J[I];I++);for(B<I&&(B=I),y=1,f=1;f<=a;f++)if(y<<=1,y-=J[f],y<0)return-1;if(y>0&&(0===z||1!==q))return-1;for(o[1]=0,f=1;f<a;f++)o[f+1]=o[f]+J[f];for(Y=0;Y<s;Y++)0!==p[j+Y]&&(W[o[p[j+Y]]++]=Y);if(0===z?(X=d=W,H=19):1===z?(X=K,P-=257,d=v,t-=257,H=256):(X=T,d=m,H=-1),n=0,Y=0,f=I,w=r,x=B,Z=0,c=-1,i=1<<B,C=i-1,1===z&&i>852||2===z&&i>592)return 1;for(;;){N=f-Z,W[Y]<H?(A=0,g=W[Y]):W[Y]>H?(A=d[t+W[Y]],g=X[P+W[Y]]):(A=96,g=0),l=1<<f-Z,V=1<<x,I=V;do{V-=l,M[w+(n>>Z)+V]=N<<24|A<<16|g}while(0!==V);for(l=1<<f-1;n&l;)l>>=1;if(0!==l?(n&=l-1,n+=l):n=0,Y++,0===--J[f]){if(f===q)break;f=p[j+W[Y]]}if(f>B&&(n&C)!==c){for(0===Z&&(Z=B),w+=I,x=f-Z,y=1<<x;x+Z<q&&(y-=J[x+Z],!(y<=0));)x++,y<<=1;if(i+=1<<x,1===z&&i>852||2===z&&i>592)return 1;c=n&C,M[c]=B<<24|x<<16|w-r}}return 0!==n&&(M[w+n]=f-Z<<24|64<<16),F.bits=B,0}},10832:z=>{"use strict";z.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},10821:z=>{"use strict";function a(z){let a=z.length;for(;--a>=0;)z[a]=0}const K=256,v=286,T=30,m=15,p=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),j=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),s=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),M=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r=new Array(576);a(r);const W=new Array(60);a(W);const F=new Array(512);a(F);const G=new Array(256);a(G);const l=new Array(29);a(l);const V=new Array(T);function c(z,a,K,v,T){this.static_tree=z,this.extra_bits=a,this.extra_base=K,this.elems=v,this.max_length=T,this.has_stree=z&&z.length}let C,w,H;function f(z,a){this.dyn_tree=z,this.max_code=0,this.stat_desc=a}a(V);const Y=z=>z<256?F[z]:F[256+(z>>>7)],I=(z,a)=>{z.pending_buf[z.pending++]=255&a,z.pending_buf[z.pending++]=a>>>8&255},q=(z,a,K)=>{z.bi_valid>16-K?(z.bi_buf|=a<<z.bi_valid&65535,I(z,z.bi_buf),z.bi_buf=a>>16-z.bi_valid,z.bi_valid+=K-16):(z.bi_buf|=a<<z.bi_valid&65535,z.bi_valid+=K)},B=(z,a,K)=>{q(z,K[2*a],K[2*a+1])},x=(z,a)=>{let K=0;do{K|=1&z,z>>>=1,K<<=1}while(--a>0);return K>>>1},Z=(z,a,K)=>{const v=new Array(16);let T,p,j=0;for(T=1;T<=m;T++)v[T]=j=j+K[T-1]<<1;for(p=0;p<=a;p++){let a=z[2*p+1];0!==a&&(z[2*p]=x(v[a]++,a))}},y=z=>{let a;for(a=0;a<v;a++)z.dyn_ltree[2*a]=0;for(a=0;a<T;a++)z.dyn_dtree[2*a]=0;for(a=0;a<19;a++)z.bl_tree[2*a]=0;z.dyn_ltree[512]=1,z.opt_len=z.static_len=0,z.last_lit=z.matches=0},i=z=>{z.bi_valid>8?I(z,z.bi_buf):z.bi_valid>0&&(z.pending_buf[z.pending++]=z.bi_buf),z.bi_buf=0,z.bi_valid=0},n=(z,a,K,v)=>{const T=2*a,m=2*K;return z[T]<z[m]||z[T]===z[m]&&v[a]<=v[K]},X=(z,a,K)=>{const v=z.heap[K];let T=K<<1;for(;T<=z.heap_len&&(T<z.heap_len&&n(a,z.heap[T+1],z.heap[T],z.depth)&&T++,!n(a,v,z.heap[T],z.depth));)z.heap[K]=z.heap[T],K=T,T<<=1;z.heap[K]=v},P=(z,a,v)=>{let T,m,s,M,r=0;if(0!==z.last_lit)do{T=z.pending_buf[z.d_buf+2*r]<<8|z.pending_buf[z.d_buf+2*r+1],m=z.pending_buf[z.l_buf+r],r++,0===T?B(z,m,a):(s=G[m],B(z,s+K+1,a),M=p[s],0!==M&&(m-=l[s],q(z,m,M)),T--,s=Y(T),B(z,s,v),M=j[s],0!==M&&(T-=V[s],q(z,T,M)))}while(r<z.last_lit);B(z,256,a)},J=(z,a)=>{const K=a.dyn_tree,v=a.stat_desc.static_tree,T=a.stat_desc.has_stree,p=a.stat_desc.elems;let j,s,M,r=-1;for(z.heap_len=0,z.heap_max=573,j=0;j<p;j++)0!==K[2*j]?(z.heap[++z.heap_len]=r=j,z.depth[j]=0):K[2*j+1]=0;for(;z.heap_len<2;)M=z.heap[++z.heap_len]=r<2?++r:0,K[2*M]=1,z.depth[M]=0,z.opt_len--,T&&(z.static_len-=v[2*M+1]);for(a.max_code=r,j=z.heap_len>>1;j>=1;j--)X(z,K,j);M=p;do{j=z.heap[1],z.heap[1]=z.heap[z.heap_len--],X(z,K,1),s=z.heap[1],z.heap[--z.heap_max]=j,z.heap[--z.heap_max]=s,K[2*M]=K[2*j]+K[2*s],z.depth[M]=(z.depth[j]>=z.depth[s]?z.depth[j]:z.depth[s])+1,K[2*j+1]=K[2*s+1]=M,z.heap[1]=M++,X(z,K,1)}while(z.heap_len>=2);z.heap[--z.heap_max]=z.heap[1],((z,a)=>{const K=a.dyn_tree,v=a.max_code,T=a.stat_desc.static_tree,p=a.stat_desc.has_stree,j=a.stat_desc.extra_bits,s=a.stat_desc.extra_base,M=a.stat_desc.max_length;let r,W,F,G,l,V,c=0;for(G=0;G<=m;G++)z.bl_count[G]=0;for(K[2*z.heap[z.heap_max]+1]=0,r=z.heap_max+1;r<573;r++)W=z.heap[r],G=K[2*K[2*W+1]+1]+1,G>M&&(G=M,c++),K[2*W+1]=G,W>v||(z.bl_count[G]++,l=0,W>=s&&(l=j[W-s]),V=K[2*W],z.opt_len+=V*(G+l),p&&(z.static_len+=V*(T[2*W+1]+l)));if(0!==c){do{for(G=M-1;0===z.bl_count[G];)G--;z.bl_count[G]--,z.bl_count[G+1]+=2,z.bl_count[M]--,c-=2}while(c>0);for(G=M;0!==G;G--)for(W=z.bl_count[G];0!==W;)F=z.heap[--r],F>v||(K[2*F+1]!==G&&(z.opt_len+=(G-K[2*F+1])*K[2*F],K[2*F+1]=G),W--)}})(z,a),Z(K,r,z.bl_count)},o=(z,a,K)=>{let v,T,m=-1,p=a[1],j=0,s=7,M=4;for(0===p&&(s=138,M=3),a[2*(K+1)+1]=65535,v=0;v<=K;v++)T=p,p=a[2*(v+1)+1],++j<s&&T===p||(j<M?z.bl_tree[2*T]+=j:0!==T?(T!==m&&z.bl_tree[2*T]++,z.bl_tree[32]++):j<=10?z.bl_tree[34]++:z.bl_tree[36]++,j=0,m=T,0===p?(s=138,M=3):T===p?(s=6,M=3):(s=7,M=4))},N=(z,a,K)=>{let v,T,m=-1,p=a[1],j=0,s=7,M=4;for(0===p&&(s=138,M=3),v=0;v<=K;v++)if(T=p,p=a[2*(v+1)+1],!(++j<s&&T===p)){if(j<M)do{B(z,T,z.bl_tree)}while(0!==--j);else 0!==T?(T!==m&&(B(z,T,z.bl_tree),j--),B(z,16,z.bl_tree),q(z,j-3,2)):j<=10?(B(z,17,z.bl_tree),q(z,j-3,3)):(B(z,18,z.bl_tree),q(z,j-11,7));j=0,m=T,0===p?(s=138,M=3):T===p?(s=6,M=3):(s=7,M=4)}};let A=!1;const g=(z,a,K,v)=>{q(z,0+(v?1:0),3),((z,a,K,v)=>{i(z),v&&(I(z,K),I(z,~K)),z.pending_buf.set(z.window.subarray(a,a+K),z.pending),z.pending+=K})(z,a,K,!0)};z.exports._tr_init=z=>{A||((()=>{let z,a,K,M,f;const Y=new Array(16);for(K=0,M=0;M<28;M++)for(l[M]=K,z=0;z<1<<p[M];z++)G[K++]=M;for(G[K-1]=M,f=0,M=0;M<16;M++)for(V[M]=f,z=0;z<1<<j[M];z++)F[f++]=M;for(f>>=7;M<T;M++)for(V[M]=f<<7,z=0;z<1<<j[M]-7;z++)F[256+f++]=M;for(a=0;a<=m;a++)Y[a]=0;for(z=0;z<=143;)r[2*z+1]=8,z++,Y[8]++;for(;z<=255;)r[2*z+1]=9,z++,Y[9]++;for(;z<=279;)r[2*z+1]=7,z++,Y[7]++;for(;z<=287;)r[2*z+1]=8,z++,Y[8]++;for(Z(r,287,Y),z=0;z<T;z++)W[2*z+1]=5,W[2*z]=x(z,5);C=new c(r,p,257,v,m),w=new c(W,j,0,T,m),H=new c(new Array(0),s,0,19,7)})(),A=!0),z.l_desc=new f(z.dyn_ltree,C),z.d_desc=new f(z.dyn_dtree,w),z.bl_desc=new f(z.bl_tree,H),z.bi_buf=0,z.bi_valid=0,y(z)},z.exports._tr_stored_block=g,z.exports._tr_flush_block=(z,a,v,T)=>{let m,p,j=0;z.level>0?(2===z.strm.data_type&&(z.strm.data_type=(z=>{let a,v=4093624447;for(a=0;a<=31;a++,v>>>=1)if(1&v&&0!==z.dyn_ltree[2*a])return 0;if(0!==z.dyn_ltree[18]||0!==z.dyn_ltree[20]||0!==z.dyn_ltree[26])return 1;for(a=32;a<K;a++)if(0!==z.dyn_ltree[2*a])return 1;return 0})(z)),J(z,z.l_desc),J(z,z.d_desc),j=(z=>{let a;for(o(z,z.dyn_ltree,z.l_desc.max_code),o(z,z.dyn_dtree,z.d_desc.max_code),J(z,z.bl_desc),a=18;a>=3&&0===z.bl_tree[2*M[a]+1];a--);return z.opt_len+=3*(a+1)+5+5+4,a})(z),m=z.opt_len+3+7>>>3,p=z.static_len+3+7>>>3,p<=m&&(m=p)):m=p=v+5,v+4<=m&&-1!==a?g(z,a,v,T):4===z.strategy||p===m?(q(z,2+(T?1:0),3),P(z,r,W)):(q(z,4+(T?1:0),3),((z,a,K,v)=>{let T;for(q(z,a-257,5),q(z,K-1,5),q(z,v-4,4),T=0;T<v;T++)q(z,z.bl_tree[2*M[T]+1],3);N(z,z.dyn_ltree,a-1),N(z,z.dyn_dtree,K-1)})(z,z.l_desc.max_code+1,z.d_desc.max_code+1,j+1),P(z,z.dyn_ltree,z.dyn_dtree)),y(z),T&&i(z)},z.exports._tr_tally=(z,a,v)=>(z.pending_buf[z.d_buf+2*z.last_lit]=a>>>8&255,z.pending_buf[z.d_buf+2*z.last_lit+1]=255&a,z.pending_buf[z.l_buf+z.last_lit]=255&v,z.last_lit++,0===a?z.dyn_ltree[2*v]++:(z.matches++,a--,z.dyn_ltree[2*(G[v]+K+1)]++,z.dyn_dtree[2*Y(a)]++),z.last_lit===z.lit_bufsize-1),z.exports._tr_align=z=>{q(z,2,3),B(z,256,r),(z=>{16===z.bi_valid?(I(z,z.bi_buf),z.bi_buf=0,z.bi_valid=0):z.bi_valid>=8&&(z.pending_buf[z.pending++]=255&z.bi_buf,z.bi_buf>>=8,z.bi_valid-=8)})(z)}},10855:z=>{"use strict";z.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11861:z=>{function a(z,a,K){for(var v=z.length,T=-1/0,m=1/0,p=0;p<v;p++){var j=(K[0][p]-z[p])/a[p],s=(K[1][p]-z[p])/a[p];if(j>s){var M=j;j=s,s=M}if(s<T||j>m)return 1/0;j>T&&(T=j),s<m&&(m=s)}return T>m?1/0:T}z.exports=function(z,K,v,T){var m=a(K,v,T);if(m===1/0)z=null;else{z=z||[];for(var p=0;p<K.length;p++)z[p]=K[p]+v[p]*m}return z},z.exports.distance=a},12361:(z,a,K)=>{"use strict";K.d(a,{e:()=>p});var v=K(33);const T=v.useLayoutEffect;const m=function(z){var a=(0,v.useRef)(z);return T((function(){a.current=z})),a};var p=function(z){var a=m(z);(0,v.useEffect)((function(){var z=function(z){var K;if(null!=a.current&&(K=a.current(z)),z.defaultPrevented&&(z.returnValue=""),"string"===typeof K)return z.returnValue=K,K};return window.addEventListener("beforeunload",z),function(){window.removeEventListener("beforeunload",z)}}),[])}},12315:(z,a,K)=>{"use strict";var v=K(12322),T=Array.prototype.concat,m=Array.prototype.slice,p=z.exports=function(z){for(var a=[],K=0,p=z.length;K<p;K++){var j=z[K];v(j)?a=T.call(a,m.call(j)):a.push(j)}return a};p.wrap=function(z){return function(){return z(p(arguments))}}},12322:z=>{z.exports=function(z){return!(!z||"string"===typeof z)&&(z instanceof Array||Array.isArray(z)||z.length>=0&&(z.splice instanceof Function||Object.getOwnPropertyDescriptor(z,z.length-1)&&"String"!==z.constructor.name))}},12278:z=>{"use strict";var a=[],K=[],v=[],T=[],m=[],p=[],j=[],s=[],M=[],r=[],W=[],F=[];z.exports=function(z,G,l,V,c,C){for(var w=j,H=M,f=r,Y=F,I=0;I<3;I++)w[I]=+l[I],f[I]=+G.max[I],H[I]=+G.base[I];C||(C=1e-10);var q=function(z,j,M,r,F,G){var l=a,V=K,c=v,C=T,w=m,H=p,f=s,Y=Math.floor,I=0,q=0,B=0,x=0,Z=0;if(y(),0===B)return 0;for(x=X();q<=B;){if(i(x)&&n())return I;x=X()}for(I+=B,Z=0;Z<3;Z++)r[Z]+=M[Z],F[Z]+=M[Z];return I;function y(){if(q=0,0!==(B=Math.sqrt(M[0]*M[0]+M[1]*M[1]+M[2]*M[2])))for(var z=0;z<3;z++){var a=M[z]>=0;C[z]=a?1:-1;var K=a?F[z]:r[z];l[z]=a?r[z]:F[z],V[z]=P(K,C[z]),c[z]=J(l[z],C[z]),f[z]=M[z]/B,w[z]=Math.abs(1/f[z]);var v=a?V[z]+1-K:K-V[z];H[z]=w[z]<1/0?w[z]*v:1/0}}function i(a){for(var K=C[0],v=0===a?V[0]:c[0],T=V[0]+K,m=C[1],p=1===a?V[1]:c[1],j=V[1]+m,s=C[2],M=2===a?V[2]:c[2],r=V[2]+s,W=v;W!=T;W+=K)for(var F=p;F!=j;F+=m)for(var G=M;G!=r;G+=s)if(z(W,F,G))return!0;return!1}function n(){I+=q;var z=C[x],a=q/B,K=W;for(Z=0;Z<3;Z++){var v=M[Z]*a;r[Z]+=v,F[Z]+=v,K[Z]=M[Z]-v}if(z>0?F[x]=Math.round(F[x]):r[x]=Math.round(r[x]),j(I,x,z,K))return!0;for(Z=0;Z<3;Z++)M[Z]=K[Z];return y(),0===B}function X(){var z=H[0]<H[1]?H[0]<H[2]?0:2:H[1]<H[2]?1:2,a=H[z]-q;for(q=H[z],V[z]+=C[z],H[z]+=w[z],Z=0;Z<3;Z++)l[Z]+=a*f[Z],c[Z]=J(l[Z],C[Z]);return z}function P(z,a){return Y(z-a*G)}function J(z,a){return Y(z+a*G)}}(z,V,w,H,f,C);if(!c){for(I=0;I<3;I++)Y[I]=l[I]>0?f[I]-G.max[I]:H[I]-G.base[I];G.translate(Y)}return q}},10602:(z,a,K)=>{var v=K(10608);function T(z){for(var a,K,T=0,m=z.length,p=0;p<z.length;){for(a=z[p],K=0;p<m&&z[p]===a;)++p,++K;T+=v.log2(K)/7|0,T+=v.log2(a>>>0)/7|0,T+=2}return T}a.size=T,a.encode=function(z,a){a||(a=new Uint8Array(T(z)));for(var K,v,m=0,p=a.length,j=0;j<z.length;){for(K=z[j],v=0;j<z.length&&z[j]===K;)++j,++v;for(;m<p&&v>=128;)a[m++]=128+(127&v),v>>>=7;if(m>=p)throw new Error("RLE buffer overflow");for(a[m++]=v,K>>>=0;m<p&&K>=128;)a[m++]=128+(127&K),K>>>=7;if(m>=p)throw new Error("RLE buffer overflow");a[m++]=K}return a},a.decode=function(z,a){for(var K,v,T,m,p=a.length,j=z.length,s=0,M=0;M<j;){for(K=0,v=0;M<j&&z[M]>=128;)K+=(127&z[M++])<<v,v+=7;if(K+=z[M++]<<v,M>=j)throw new Error("RLE buffer underrun");if(s+K>p)throw new Error("Chunk buffer overflow");for(T=0,v=0;M<j&&z[M]>=128;)T+=(127&z[M++])<<v,v+=7;if(M>=j)throw new Error("RLE buffer underrun");for(T+=z[M++]<<v,m=0;m<K;++m)a[s++]=T}return a}},10608:(z,a)=>{"use strict";function K(z){var a=32;return(z&=-z)&&a--,65535&z&&(a-=16),16711935&z&&(a-=8),252645135&z&&(a-=4),858993459&z&&(a-=2),1431655765&z&&(a-=1),a}a.INT_BITS=32,a.INT_MAX=2147483647,a.INT_MIN=-1<<31,a.sign=function(z){return(z>0)-(z<0)},a.abs=function(z){var a=z>>31;return(z^a)-a},a.min=function(z,a){return a^(z^a)&-(z<a)},a.max=function(z,a){return z^(z^a)&-(z<a)},a.isPow2=function(z){return!(z&z-1)&&!!z},a.log2=function(z){var a,K;return a=(z>65535)<<4,a|=K=((z>>>=a)>255)<<3,a|=K=((z>>>=K)>15)<<2,(a|=K=((z>>>=K)>3)<<1)|(z>>>=K)>>1},a.log10=function(z){return z>=1e9?9:z>=1e8?8:z>=1e7?7:z>=1e6?6:z>=1e5?5:z>=1e4?4:z>=1e3?3:z>=100?2:z>=10?1:0},a.popCount=function(z){return 16843009*((z=(858993459&(z-=z>>>1&1431655765))+(z>>>2&858993459))+(z>>>4)&252645135)>>>24},a.countTrailingZeros=K,a.nextPow2=function(z){return z+=0===z,--z,z|=z>>>1,z|=z>>>2,z|=z>>>4,z|=z>>>8,(z|=z>>>16)+1},a.prevPow2=function(z){return z|=z>>>1,z|=z>>>2,z|=z>>>4,z|=z>>>8,(z|=z>>>16)-(z>>>1)},a.parity=function(z){return z^=z>>>16,z^=z>>>8,z^=z>>>4,27030>>>(z&=15)&1};var v=new Array(256);!function(z){for(var a=0;a<256;++a){var K=a,v=a,T=7;for(K>>>=1;K;K>>>=1)v<<=1,v|=1&K,--T;z[a]=v<<T&255}}(v),a.reverse=function(z){return v[255&z]<<24|v[z>>>8&255]<<16|v[z>>>16&255]<<8|v[z>>>24&255]},a.interleave2=function(z,a){return(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z&=65535)|z<<8))|z<<4))|z<<2))|z<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a&=65535)|a<<8))|a<<4))|a<<2))|a<<1))<<1},a.deinterleave2=function(z,a){return(z=65535&((z=16711935&((z=252645135&((z=858993459&((z=z>>>a&1431655765)|z>>>1))|z>>>2))|z>>>4))|z>>>16))<<16>>16},a.interleave3=function(z,a,K){return z=1227133513&((z=3272356035&((z=251719695&((z=4278190335&((z&=1023)|z<<16))|z<<8))|z<<4))|z<<2),(z|=(a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2))<<1)|(K=1227133513&((K=3272356035&((K=251719695&((K=4278190335&((K&=1023)|K<<16))|K<<8))|K<<4))|K<<2))<<2},a.deinterleave3=function(z,a){return(z=1023&((z=4278190335&((z=251719695&((z=3272356035&((z=z>>>a&1227133513)|z>>>2))|z>>>4))|z>>>8))|z>>>16))<<22>>22},a.nextCombination=function(z){var a=z|z-1;return a+1|(~a&-~a)-1>>>K(z)+1}},12433:(z,a,K)=>{"use strict";K.d(a,{b:()=>W});var v=K(12270),T=K(129);class m{constructor(z,a,K,m,p,j,s){this.og=new v(z.base,z.Lg),this.mass=a,this.friction=K,this.restitution=m,this.Dc=p,this.Kk=j,this.Gc=!!s,this.Kg=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.xl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Kf=T.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=T.create(),this._impulses=T.create(),this._sleepFrameCount=10}loadFromCopy(z){T.i(this.og.base,z.og.base),T.i(this.og.Lg,z.og.Lg),T.i(this.og.max,z.og.max),this.og.mag=z.og.mag,this.mass=z.mass,this.friction=z.friction,this.restitution=z.restitution,this.Dc=z.Dc,this.Kk=z.Kk,this.Gc=z.Gc,this.Kg=z.Kg,this.fluidDrag=z.fluidDrag,this.xl=z.xl,this.preventFallOffEdge=z.preventFallOffEdge,this.rolledBackLastTick=z.rolledBackLastTick,T.i(this.Kf,z.Kf),T.i(this.resting,z.resting),this.inFluid=z.inFluid,this._ratioInFluid=z._ratioInFluid,T.i(this._forces,z._forces),T.i(this._impulses,z._impulses),this._sleepFrameCount=z._sleepFrameCount}setPosition(z){p(z),T.sc(z,z,this.og.base),this.og.translate(z),this.Of()}eb(){return T.clone(this.og.base)}applyForce(z){p(z),T.add(this._forces,this._forces,z),this.Of()}applyImpulse(z){p(z),T.add(this._impulses,this._impulses,z),this.Of()}Of(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var p=z=>{};var j=K(12270),s=K(129),M=K(12278);function r(){this.Kg=.1,this.fluidDrag=.4,this.Vc=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function W(z,a,K){z=Object.assign(new r,z),this.gravity=z.gravity||[0,-10,0],this.Kg=z.Kg||.1,this.Vc=z.Vc||2,this.fluidDrag=z.fluidDrag||.4,this.minBounceImpulse=z.minBounceImpulse,this.bodies=[],this.fk=z.fk,this.testSolid=a,this.testFluid=K}W.prototype.Rk=function(z,a,K,v,T,p){z=z||new j([0,0,0],[1,1,1]),"undefined"==typeof a&&(a=1),"undefined"==typeof K&&(K=1),"undefined"==typeof v&&(v=0),"undefined"==typeof T&&(T=1);var s=new m(z,a,K,v,T,p);return this.bodies.push(s),s},W.prototype.Sk=function(z){var a=this.bodies.indexOf(z);a<0||(this.bodies.splice(a,1),z.og=z.Kk=null)};var F=s.create(),G=s.create(),l=s.create(),V=s.create(),c=s.create(),C=s.create(),w=s.create(),H=new j([0,0,0],[1,1,1]),f=new m(H,1,1,0,1,(()=>{}),!1);function Y(z,a,K){return a=K,a*=1-(1-z.ratioInFluid)**2}W.prototype.Ad=function(z){z/=1e3;var a=d(0,s.squaredLength(this.gravity));this.bodies.forEach((K=>function(z,a,K,v){s.i(c,a.resting),z.fk&&f.loadFromCopy(a);if(a.mass<=0)return s.set(a.Kf,0,0,0),s.set(a._forces,0,0,0),void s.set(a._impulses,0,0,0);var T=v||0===a.Dc;if(function(z,a,K,v){if(a._sleepFrameCount>0)return!1;if(v)return!0;var T=!1,m=.5*K*K*a.Dc;return s.scale(g,z.gravity,m),M(z.testSolid,a.og,g,(function(){return T=!0,!0}),!0),T}(z,a,K,T))return;a._sleepFrameCount--,function(z,a){var K=a.og,v=Math.floor(K.base[0]),T=Math.floor(K.base[2]),m=Math.floor(K.base[1]),p=Math.floor(K.max[1]);if(!z.testFluid(v,m,T))return a.inFluid=!1,void(a.ratioInFluid=0);var j=1,M=m+1;for(;M<=p&&z.testFluid(v,M,T);)j++,M++;var r=(m+j-K.base[1])/K.Lg[1];r>1&&(r=1);var W=K.Lg[0]*K.Lg[1]*K.Lg[2]*r,F=q;s.scale(F,z.gravity,-z.Vc*W*a.Dc),a.applyForce(F),a.inFluid=!0,a.ratioInFluid=r}(z,a),e(a._forces),e(a._impulses),e(a.Kf),e(a.resting),s.scale(F,a._forces,1/a.mass),s.od(F,F,z.gravity,a.Dc),s.scale(G,a._impulses,1/a.mass),s.od(G,G,F,K),s.add(a.Kf,a.Kf,G),a.friction&&(B(z,0,a,G,K),B(z,1,a,G,K),B(z,2,a,G,K));var m=a.fluidDrag>=0?a.fluidDrag:z.fluidDrag,p=a.Kg>=0?a.Kg:z.Kg,j=p,r=p;a.inFluid&&(j=Y(a,j,a.fluidDragHoriz>=0?a.fluidDragHoriz:m),r=Y(a,r,a.fluidDragVert>=0?a.fluidDragVert:m));j=Math.max(1-j*K/a.mass,0),r=Math.max(1-r*K/a.mass,0),s.set(I,j,r,j),s.multiply(a.Kf,a.Kf,I),s.scale(l,a.Kf,K),s.set(a._forces,0,0,0),s.set(a._impulses,0,0,0),a.Gc&&t(y,a.og);s.i(C,l),s.set(w,0,0,0),a.preventFallOffEdge&&function(z,a,K,v){if(!a.resting[1]||K[1]>0)return;var T=o;t(T,a.og);for(var m=0;m<3;m+=2){s.set(J,0,0,0),J[m]=K[m];var p=!0;(p=(p=(p=(p=p&&!A(z,T.base[0]+J[0]+1e-5,T.base[1],T.base[2]+J[2]+1e-5))&&!A(z,T.max[0]+J[0]-1e-5,T.base[1],T.base[2]+J[2]+1e-5))&&!A(z,T.base[0]+J[0]+1e-5,T.base[1],T.max[2]+J[2]-1e-5))&&!A(z,T.max[0]+J[0]-1e-5,T.base[1],T.max[2]+J[2]-1e-5))?(v[m]=K[m]>0?1:-1,K[m]=0):0===m&&(s.set(N,K[0],0,0),Z(z,T,N,v,a.slideOnCollision))}}(z,a,l,w);Z(z,a.og,l,a.resting,a.slideOnCollision),a.Gc&&function(z,a,K,v){if(a.resting[1]>=0&&!a.inFluid)return;var T=0!==a.resting[0],m=0!==a.resting[2];if(!T&&!m)return;var p=Math.abs(v[0]/v[2]),j=4;if(!T&&p>j)return;if(!m&&p<1/j)return;s.add(n,K.base,v);var r=z.testSolid;M(r,K,v,(function(z,a,K,v){if(1!==a)return!0;v[a]=0}));var W=K.base[1],F=a.inFluid?1.951:1.001,G=Math.floor(W+F)-W;s.set(X,0,G,0);var l=!1;if(M(r,K,X,(function(z,a,K,v){return l=!0,!0})),l)return;s.sc(P,n,K.base),P[1]=0,Z(z,K,P,i,!0);var V=d(K.base[0],n[0]),c=d(K.base[2],n[2]);if(T&&!V&&(!c||!m))return;if(m&&(!V||!T)&&!c)return;var C=!0;if(C=C&&!A(z,K.base[0]+1e-5,K.base[1],K.base[2]+1e-5),C=C&&!A(z,K.max[0]-1e-5,K.base[1],K.base[2]+1e-5),C=C&&!A(z,K.base[0]+1e-5,K.base[1],K.max[2]-1e-5),C=C&&!A(z,K.max[0]-1e-5,K.base[1],K.max[2]-1e-5),C)return;t(a.og,K),a.resting[0]=i[0],a.resting[2]=i[2],a.xl&&a.xl()}(z,a,y,C);for(var W=0;W<3;++W)a.resting[W]=a.resting[W]||w[W],V[W]=0,a.resting[W]&&(c[W]||(V[W]=-a.Kf[W]),a.Kf[W]=0);var H=s.length(V);H>.001&&(s.scale(V,V,a.mass),a.Kk&&a.Kk(V),a.restitution>0&&H>z.minBounceImpulse&&(s.scale(V,V,a.restitution),a.applyImpulse(V)));var x=s.squaredLength(a.Kf);x>1e-5&&a.Of();z.fk&&z.fk(a)?(a.loadFromCopy(f),a.rolledBackLastTick=!0):a.rolledBackLastTick=!1}(this,K,z,a)))};var I=s.create([0,0,0]);var q=s.create();function B(z,a,K,v,T){var m=K.resting[a],p=v[a];if(!K.alwaysApplyHorizFriction||1!==a){if(0===m)return;if(m*p<=0)return}s.i(x,K.Kf),x[a]=0;var j=s.length(x);if(!d(j,0)){var M=Math.abs(K.friction*z.gravity[a]*T),r=j>M?(j-M)/j:0;K.Kf[(a+1)%3]*=r,K.Kf[(a+2)%3]*=r}}var x=s.create();function Z(z,a,K,v,T){return s.set(v,0,0,0),M(z.testSolid,a,K,(function(z,a,K,m){v[a]=K,m[a]=0,T||(m[0]=0,m[1]=0,m[2]=0)}))}var y=new j([],[]),i=s.create(),n=s.create(),X=s.create(),P=s.create();var J=s.create(),o=new j([],[]),N=s.create();function A(z,a,K,v){return z.testSolid(Math.floor(a),Math.floor(K-1),Math.floor(v))}var g=s.create();function d(z,a){return Math.abs(z-a)<1e-5}function t(z,a){for(var K=0;K<3;K++)z.base[K]=a.base[K],z.max[K]=a.max[K],z.Lg[K]=a.Lg[K]}var e=function(z){}},10796:z=>{"use strict";z.exports=function(z,a,K,v){var T=self||window;try{try{var m;try{m=new T.Blob([z])}catch(M){(m=new(T.BlobBuilder||T.WebKitBlobBuilder||T.MozBlobBuilder||T.MSBlobBuilder)).append(z),m=m.getBlob()}var p=T.URL||T.webkitURL,j=p.createObjectURL(m),s=new T[a](j,K);return p.revokeObjectURL(j),s}catch(M){return new T[a]("data:application/javascript,".concat(encodeURIComponent(z)),K)}}catch(M){if(!v)throw Error("Inline worker is not supported");return new T[a](v,K)}}},11845:(z,a,K)=>{"use strict";function v(z,a,K,v,T){var m={};return Object.keys(v).forEach((function(z){m[z]=v[z]})),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=K.slice().reverse().reduce((function(K,v){return v(z,a,K)||K}),m),T&&void 0!==m.initializer&&(m.value=m.initializer?m.initializer.call(T):void 0,m.initializer=void 0),void 0===m.initializer&&(Object.defineProperty(z,a,m),m=null),m}K.d(a,{d:()=>v})},11841:(z,a,K)=>{"use strict";function v(z,a,K,v){K&&Object.defineProperty(z,a,{enumerable:K.enumerable,configurable:K.configurable,writable:K.writable,value:K.initializer?K.initializer.call(v):void 0})}K.d(a,{c:()=>v})},11900:(z,a,K)=>{"use strict";K.d(a,{e:()=>H,g:()=>c,h:()=>C,l:()=>F,m:()=>V,n:()=>l,r:()=>G});var v=K(10941),T=K(10971),m=K(10959),p=K(10767),j=K(11907),s=K(11215),M=K(11152),r=K(10672),W=K(10973);const F=Object.freeze(new v.f(0,0,0,0)),G=Object.freeze(v.o.Zero()),l=Object.freeze(v.m.Zero()),V=Object.freeze(M.c.Zero()),c=Object.freeze(T.c.Black()),C=Object.freeze(new T.d(0,0,0,0)),w={key:0,repeatCount:0,loopMode:2};class H{static _PrepareAnimation(z,a,K,m,p,j,s,r){let W;if(!isNaN(parseFloat(p))&&isFinite(p)?W=H.ANIMATIONTYPE_FLOAT:p instanceof v.f?W=H.ANIMATIONTYPE_QUATERNION:p instanceof v.o?W=H.ANIMATIONTYPE_VECTOR3:p instanceof v.m?W=H.ANIMATIONTYPE_VECTOR2:p instanceof T.c?W=H.ANIMATIONTYPE_COLOR3:p instanceof T.d?W=H.ANIMATIONTYPE_COLOR4:p instanceof M.c&&(W=H.ANIMATIONTYPE_SIZE),void 0==W)return null;const F=new H(z,a,K,W,s),G=[{frame:0,value:p},{frame:m,value:j}];return F.setKeys(G),void 0!==r&&F.setEasingFunction(r),F}static CreateAnimation(z,a,K,v){const T=new H(z+"Animation",z,K,a,H.ANIMATIONLOOPMODE_CONSTANT);return T.setEasingFunction(v),T}static CreateAndStartAnimation(z,a,K,v,T,m,p,j,s,M,r){const W=H._PrepareAnimation(z,K,v,T,m,p,j,s);return W?(a.va&&(r=a.va()),r?r.beginDirectAnimation(a,[W],0,T,1===W.loopMode,1,M):null):null}static CreateAndStartHierarchyAnimation(z,a,K,v,T,m,p,j,s,M,r){const W=H._PrepareAnimation(z,v,T,m,p,j,s,M);if(!W)return null;return a.va().beginDirectHierarchyAnimation(a,K,[W],0,m,1===W.loopMode,1,r)}static CreateMergeAndStartAnimation(z,a,K,v,T,m,p,j,s,M){const r=H._PrepareAnimation(z,K,v,T,m,p,j,s);return r?(a.animations.push(r),a.va().beginAnimation(a,0,T,1===r.loopMode,1,M)):null}static MakeAnimationAdditive(z,a,K){let T;T="object"===typeof a?a:{referenceFrame:a??0,range:K,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let m=z;if(T.cloneOriginalAnimation&&(m=z.clone(),m.name=T.clonedAnimationName||m.name),!m._keys.length)return m;const p=T.referenceFrame&&T.referenceFrame>=0?T.referenceFrame:0;let j=0;const s=m._keys[0];let M=m._keys.length-1;const r=m._keys[M],W={referenceValue:s.value,referencePosition:v.j.gb[0],referenceQuaternion:v.j.Quaternion[0],referenceScaling:v.j.gb[1],keyPosition:v.j.gb[2],keyQuaternion:v.j.Quaternion[1],keyScaling:v.j.gb[3]};let F=s.frame,G=r.frame;if(T.range){const z=m.getRange(T.range);z&&(F=z.from,G=z.to)}else F=T.fromFrame??F,G=T.toFrame??G;if(F!==s.frame&&(j=m.createKeyForFrame(F)),G!==r.frame&&(M=m.createKeyForFrame(G)),1===m._keys.length){const z=m._getKeyValue(m._keys[0]);W.referenceValue=z.clone?z.clone():z}else if(p<=s.frame){const z=m._getKeyValue(s.value);W.referenceValue=z.clone?z.clone():z}else if(p>=r.frame){const z=m._getKeyValue(r.value);W.referenceValue=z.clone?z.clone():z}else{w.key=0;const z=m._interpolate(p,w);W.referenceValue=z.clone?z.clone():z}m.dataType===H.ANIMATIONTYPE_QUATERNION?W.referenceValue.normalize().conjugateInPlace():m.dataType===H.ANIMATIONTYPE_MATRIX&&(W.referenceValue.decompose(W.referenceScaling,W.referenceQuaternion,W.referencePosition),W.referenceQuaternion.normalize().conjugateInPlace());let l=Number.MAX_VALUE;const V=T.clipKeys?[]:null;for(let c=j;c<=M;c++){let z=m._keys[c];if((V||T.cloneOriginalAnimation)&&(z={frame:z.frame,value:z.value.clone?z.value.clone():z.value,inTangent:z.inTangent,outTangent:z.outTangent,interpolation:z.interpolation,lockedTangent:z.lockedTangent},V&&(l===Number.MAX_VALUE&&(l=z.frame),z.frame-=l,V.push(z))),!c||m.dataType===H.ANIMATIONTYPE_FLOAT||z.value!==s.value)switch(m.dataType){case H.ANIMATIONTYPE_MATRIX:z.value.decompose(W.keyScaling,W.keyQuaternion,W.keyPosition),W.keyPosition.ri(W.referencePosition),W.keyScaling.divideInPlace(W.referenceScaling),W.referenceQuaternion.multiplyToRef(W.keyQuaternion,W.keyQuaternion),v.b.ComposeToRef(W.keyScaling,W.keyQuaternion,W.keyPosition,z.value);break;case H.ANIMATIONTYPE_QUATERNION:W.referenceValue.multiplyToRef(z.value,z.value);break;case H.ANIMATIONTYPE_VECTOR2:case H.ANIMATIONTYPE_VECTOR3:case H.ANIMATIONTYPE_COLOR3:case H.ANIMATIONTYPE_COLOR4:z.value.subtractToRef(W.referenceValue,z.value);break;case H.ANIMATIONTYPE_SIZE:z.value.width-=W.referenceValue.width,z.value.height-=W.referenceValue.height;break;default:z.value-=W.referenceValue}}return V&&m.setKeys(V,!0),m}static TransitionTo(z,a,K,v,T,m,p){let j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(p<=0)return K[z]=a,j&&j(),null;const s=T*(p/1e3);m.setKeys([{frame:0,value:K[z].clone?K[z].clone():K[z]},{frame:s,value:a}]),K.animations||(K.animations=[]),K.animations.push(m);const M=v.beginAnimation(K,0,s,!1);return M.onAnimationEnd=j,M}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const z of this._runtimeAnimations)if(!z.isStopped())return!0;return!1}constructor(z,a,K,v,T,m){this.name=z,this.targetProperty=a,this.framePerSecond=K,this.dataType=v,this.loopMode=T,this.enableBlending=m,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=a.split("."),this.dataType=v,this.loopMode=void 0===T?H.ANIMATIONLOOPMODE_CYCLE:T,this.uniqueId=H._UniqueIdGenerator++}toString(z){let a="Name: "+this.name+", property: "+this.targetProperty;if(a+=", datatype: "+["Float","gb","Quaternion","Matrix","ib","Vector2"][this.dataType],a+=", nKeys: "+(this._keys?this._keys.length:"none"),a+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),z){a+=", Ranges: {";let z=!0;for(const K in this._ranges)z&&(a+=", ",z=!1),a+=K;a+="}"}return a}addEvent(z){this._events.push(z),this._events.sort(((z,a)=>z.frame-a.frame))}removeEvents(z){for(let a=0;a<this._events.length;a++)this._events[a].frame===z&&(this._events.splice(a,1),a--)}getEvents(){return this._events}createRange(z,a,K){this._ranges[z]||(this._ranges[z]=new j.d(z,a,K))}deleteRange(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const K=this._ranges[z];if(K){if(a){const z=K.from,a=K.to;for(let K=this._keys.length-1;K>=0;K--)this._keys[K].frame>=z&&this._keys[K].frame<=a&&this._keys.splice(K,1)}this._ranges[z]=null}}getRange(z){return this._ranges[z]}getKeys(){return this._keys}getHighestFrame(){let z=0;for(let a=0,K=this._keys.length;a<K;a++)z<this._keys[a].frame&&(z=this._keys[a].frame);return z}getEasingFunction(){return this._easingFunction}setEasingFunction(z){this._easingFunction=z}floatInterpolateFunction(z,a,K){return(0,m.q)(z,a,K)}floatInterpolateFunctionWithTangents(z,a,K,v,T){return(0,m.h)(z,a,K,v,T)}quaternionInterpolateFunction(z,a,K){return v.f.Slerp(z,a,K)}quaternionInterpolateFunctionWithTangents(z,a,K,T,m){return v.f.Hermite(z,a,K,T,m).normalize()}vector3InterpolateFunction(z,a,K){return v.o.Lerp(z,a,K)}vector3InterpolateFunctionWithTangents(z,a,K,T,m){return v.o.Hermite(z,a,K,T,m)}vector2InterpolateFunction(z,a,K){return v.m.Lerp(z,a,K)}vector2InterpolateFunctionWithTangents(z,a,K,T,m){return v.m.Hermite(z,a,K,T,m)}sizeInterpolateFunction(z,a,K){return M.c.Lerp(z,a,K)}color3InterpolateFunction(z,a,K){return T.c.Lerp(z,a,K)}color3InterpolateFunctionWithTangents(z,a,K,v,m){return T.c.Hermite(z,a,K,v,m)}color4InterpolateFunction(z,a,K){return T.d.Lerp(z,a,K)}color4InterpolateFunctionWithTangents(z,a,K,v,m){return T.d.Hermite(z,a,K,v,m)}_getKeyValue(z){return"function"===typeof z?z():z}evaluate(z){return w.key=0,this._interpolate(z,w)}_interpolate(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(a.loopMode===H.ANIMATIONLOOPMODE_CONSTANT&&a.repeatCount>0)return a.highLimitValue.clone?a.highLimitValue.clone():a.highLimitValue;const v=this._keys,T=v.length;let m=a.key;for(;m>=0&&z<v[m].frame;)--m;for(;m+1<=T-1&&z>=v[m+1].frame;)++m;if(a.key=m,m<0)return K?void 0:this._getKeyValue(v[0].value);if(m+1>T-1)return K?void 0:this._getKeyValue(v[T-1].value);const p=v[m],j=v[m+1];if(K&&(z===p.frame||z===j.frame))return;const s=this._getKeyValue(p.value),M=this._getKeyValue(j.value);if(1===p.interpolation)return j.frame>z?s:M;const r=void 0!==p.outTangent&&void 0!==j.inTangent,W=j.frame-p.frame;let w=(z-p.frame)/W;const f=p.easingFunction||this.getEasingFunction();switch(null!==f&&(w=f.ease(w)),this.dataType){case H.ANIMATIONTYPE_FLOAT:{const z=r?this.floatInterpolateFunctionWithTangents(s,p.outTangent*W,M,j.inTangent*W,w):this.floatInterpolateFunction(s,M,w);switch(a.loopMode){case H.ANIMATIONLOOPMODE_CYCLE:case H.ANIMATIONLOOPMODE_CONSTANT:case H.ANIMATIONLOOPMODE_YOYO:return z;case H.ANIMATIONLOOPMODE_RELATIVE:case H.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(a.offsetValue??0)*a.repeatCount+z}break}case H.ANIMATIONTYPE_QUATERNION:{const z=r?this.quaternionInterpolateFunctionWithTangents(s,p.outTangent.scale(W),M,j.inTangent.scale(W),w):this.quaternionInterpolateFunction(s,M,w);switch(a.loopMode){case H.ANIMATIONLOOPMODE_CYCLE:case H.ANIMATIONLOOPMODE_CONSTANT:case H.ANIMATIONLOOPMODE_YOYO:return z;case H.ANIMATIONLOOPMODE_RELATIVE:case H.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return z.addInPlace((a.offsetValue||F).scale(a.repeatCount))}return z}case H.ANIMATIONTYPE_VECTOR3:{const z=r?this.vector3InterpolateFunctionWithTangents(s,p.outTangent.scale(W),M,j.inTangent.scale(W),w):this.vector3InterpolateFunction(s,M,w);switch(a.loopMode){case H.ANIMATIONLOOPMODE_CYCLE:case H.ANIMATIONLOOPMODE_CONSTANT:case H.ANIMATIONLOOPMODE_YOYO:return z;case H.ANIMATIONLOOPMODE_RELATIVE:case H.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return z.add((a.offsetValue||G).scale(a.repeatCount))}break}case H.ANIMATIONTYPE_VECTOR2:{const z=r?this.vector2InterpolateFunctionWithTangents(s,p.outTangent.scale(W),M,j.inTangent.scale(W),w):this.vector2InterpolateFunction(s,M,w);switch(a.loopMode){case H.ANIMATIONLOOPMODE_CYCLE:case H.ANIMATIONLOOPMODE_CONSTANT:case H.ANIMATIONLOOPMODE_YOYO:return z;case H.ANIMATIONLOOPMODE_RELATIVE:case H.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return z.add((a.offsetValue||l).scale(a.repeatCount))}break}case H.ANIMATIONTYPE_SIZE:switch(a.loopMode){case H.ANIMATIONLOOPMODE_CYCLE:case H.ANIMATIONLOOPMODE_CONSTANT:case H.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(s,M,w);case H.ANIMATIONLOOPMODE_RELATIVE:case H.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(s,M,w).add((a.offsetValue||V).scale(a.repeatCount))}break;case H.ANIMATIONTYPE_COLOR3:{const z=r?this.color3InterpolateFunctionWithTangents(s,p.outTangent.scale(W),M,j.inTangent.scale(W),w):this.color3InterpolateFunction(s,M,w);switch(a.loopMode){case H.ANIMATIONLOOPMODE_CYCLE:case H.ANIMATIONLOOPMODE_CONSTANT:case H.ANIMATIONLOOPMODE_YOYO:return z;case H.ANIMATIONLOOPMODE_RELATIVE:case H.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return z.add((a.offsetValue||c).scale(a.repeatCount))}break}case H.ANIMATIONTYPE_COLOR4:{const z=r?this.color4InterpolateFunctionWithTangents(s,p.outTangent.scale(W),M,j.inTangent.scale(W),w):this.color4InterpolateFunction(s,M,w);switch(a.loopMode){case H.ANIMATIONLOOPMODE_CYCLE:case H.ANIMATIONLOOPMODE_CONSTANT:case H.ANIMATIONLOOPMODE_YOYO:return z;case H.ANIMATIONLOOPMODE_RELATIVE:case H.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return z.add((a.offsetValue||C).scale(a.repeatCount))}break}case H.ANIMATIONTYPE_MATRIX:switch(a.loopMode){case H.ANIMATIONLOOPMODE_CYCLE:case H.ANIMATIONLOOPMODE_CONSTANT:case H.ANIMATIONLOOPMODE_YOYO:return H.AllowMatricesInterpolation?this.matrixInterpolateFunction(s,M,w,a.workValue):s;case H.ANIMATIONLOOPMODE_RELATIVE:case H.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return s}}return 0}matrixInterpolateFunction(z,a,K,T){return H.AllowMatrixDecomposeForInterpolation?T?(v.b.DecomposeLerpToRef(z,a,K,T),T):v.b.DecomposeLerp(z,a,K):T?(v.b.LerpToRef(z,a,K,T),T):v.b.Lerp(z,a,K)}clone(){const z=new H(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(z.enableBlending=this.enableBlending,z.blendingSpeed=this.blendingSpeed,this._keys&&z.setKeys(this._keys),this._ranges){z._ranges={};for(const a in this._ranges){const K=this._ranges[a];K&&(z._ranges[a]=K.clone())}}return z}setKeys(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=a?z:z.slice(0)}createKeyForFrame(z){w.key=0;const a=this._interpolate(z,w,!0);if(!a)return this._keys[w.key].frame===z?w.key:w.key+1;const K={frame:z,value:a.clone?a.clone():a};return this._keys.splice(w.key+1,0,K),w.key+1}serialize(){const z={};z.name=this.name,z.property=this.targetProperty,z.framePerSecond=this.framePerSecond,z.dataType=this.dataType,z.loopBehavior=this.loopMode,z.enableBlending=this.enableBlending,z.blendingSpeed=this.blendingSpeed;const a=this.dataType;z.keys=[];const K=this.getKeys();for(let v=0;v<K.length;v++){const T=K[v],m={};switch(m.frame=T.frame,a){case H.ANIMATIONTYPE_FLOAT:m.values=[T.value],void 0!==T.inTangent&&m.values.push(T.inTangent),void 0!==T.outTangent&&(void 0===T.inTangent&&m.values.push(void 0),m.values.push(T.outTangent)),void 0!==T.interpolation&&(void 0===T.inTangent&&m.values.push(void 0),void 0===T.outTangent&&m.values.push(void 0),m.values.push(T.interpolation));break;case H.ANIMATIONTYPE_QUATERNION:case H.ANIMATIONTYPE_MATRIX:case H.ANIMATIONTYPE_VECTOR3:case H.ANIMATIONTYPE_COLOR3:case H.ANIMATIONTYPE_COLOR4:m.values=T.value.kj(),void 0!=T.inTangent&&m.values.push(T.inTangent.kj()),void 0!=T.outTangent&&(void 0===T.inTangent&&m.values.push(void 0),m.values.push(T.outTangent.kj())),void 0!==T.interpolation&&(void 0===T.inTangent&&m.values.push(void 0),void 0===T.outTangent&&m.values.push(void 0),m.values.push(T.interpolation))}z.keys.push(m)}z.ranges=[];for(const v in this._ranges){const a=this._ranges[v];if(!a)continue;const K={};K.name=v,K.from=a.from,K.to=a.to,z.ranges.push(K)}return z}static _UniversalLerp(z,a,K){const v=z.constructor;return v.Lerp?v.Lerp(z,a,K):v.Slerp?v.Slerp(z,a,K):z.toFixed?z*(1-K)+K*a:a}static Parse(z){const a=new H(z.name,z.property,z.framePerSecond,z.dataType,z.loopBehavior),K=z.dataType,m=[];let p,j;for(z.enableBlending&&(a.enableBlending=z.enableBlending),z.blendingSpeed&&(a.blendingSpeed=z.blendingSpeed),j=0;j<z.keys.length;j++){const a=z.keys[j];let s,M,r;switch(K){case H.ANIMATIONTYPE_FLOAT:p=a.values[0],a.values.length>=2&&(s=a.values[1]),a.values.length>=3&&(M=a.values[2]),a.values.length>=4&&(r=a.values[3]);break;case H.ANIMATIONTYPE_QUATERNION:if(p=v.f.Jg(a.values),a.values.length>=8){const z=v.f.Jg(a.values.slice(4,8));z.equals(v.f.Zero())||(s=z)}if(a.values.length>=12){const z=v.f.Jg(a.values.slice(8,12));z.equals(v.f.Zero())||(M=z)}a.values.length>=13&&(r=a.values[12]);break;case H.ANIMATIONTYPE_MATRIX:p=v.b.Jg(a.values),a.values.length>=17&&(r=a.values[16]);break;case H.ANIMATIONTYPE_COLOR3:p=T.c.Jg(a.values),a.values[3]&&(s=T.c.Jg(a.values[3])),a.values[4]&&(M=T.c.Jg(a.values[4])),a.values[5]&&(r=a.values[5]);break;case H.ANIMATIONTYPE_COLOR4:p=T.d.Jg(a.values),a.values[4]&&(s=T.d.Jg(a.values[4])),a.values[5]&&(M=T.d.Jg(a.values[5])),a.values[6]&&(r=T.d.Jg(a.values[6]));break;case H.ANIMATIONTYPE_VECTOR3:default:p=v.o.Jg(a.values),a.values[3]&&(s=v.o.Jg(a.values[3])),a.values[4]&&(M=v.o.Jg(a.values[4])),a.values[5]&&(r=a.values[5])}const W={};W.frame=a.frame,W.value=p,void 0!=s&&(W.inTangent=s),void 0!=M&&(W.outTangent=M),void 0!=r&&(W.interpolation=r),m.push(W)}if(a.setKeys(m),z.ranges)for(j=0;j<z.ranges.length;j++)p=z.ranges[j],a.createRange(p.name,p.from,p.to);return a}static AppendSerializedAnimations(z,a){W.e.AppendSerializedAnimations(z,a)}static ParseFromFileAsync(z,a){return new Promise(((K,v)=>{const T=new r.b;T.addEventListener("readystatechange",(()=>{if(4==T.readyState)if(200==T.status){let a=JSON.parse(T.responseText);if(a.animations&&(a=a.animations),a.length){const z=[];for(const K of a)z.push(this.Parse(K));K(z)}else{const v=this.Parse(a);z&&(v.name=z),K(v)}}else v("Unable to load the animation")})),T.open("GET",a),T.send()}))}static ParseFromSnippetAsync(z){return new Promise(((a,K)=>{const v=new r.b;v.addEventListener("readystatechange",(()=>{if(4==v.readyState)if(200==v.status){const K=JSON.parse(JSON.parse(v.responseText).jsonPayload);if(K.animations){const v=JSON.parse(K.animations),T=[];for(const a of v.animations){const K=this.Parse(a);K.snippetId=z,T.push(K)}a(T)}else{const v=JSON.parse(K.animation),T=this.Parse(v);T.snippetId=z,a(T)}}else K("Unable to load the snippet "+z)})),v.open("GET",this.SnippetUrl+"/"+z.replace(/#/g,"/")),v.send()}))}}H._UniqueIdGenerator=0,H.AllowMatricesInterpolation=!1,H.AllowMatrixDecomposeForInterpolation=!0,H.SnippetUrl="https://snippet.babylonjs.com",H.ANIMATIONTYPE_FLOAT=0,H.ANIMATIONTYPE_VECTOR3=1,H.ANIMATIONTYPE_QUATERNION=2,H.ANIMATIONTYPE_MATRIX=3,H.ANIMATIONTYPE_COLOR3=4,H.ANIMATIONTYPE_COLOR4=7,H.ANIMATIONTYPE_VECTOR2=5,H.ANIMATIONTYPE_SIZE=6,H.ANIMATIONLOOPMODE_RELATIVE=0,H.ANIMATIONLOOPMODE_CYCLE=1,H.ANIMATIONLOOPMODE_CONSTANT=2,H.ANIMATIONLOOPMODE_YOYO=4,H.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,H.CreateFromSnippetAsync=H.ParseFromSnippetAsync,(0,p.e)("BABYLON.Animation",H),s.c._AnimationRangeFactory=(z,a,K)=>new j.d(z,a,K)},11907:(z,a,K)=>{"use strict";K.d(a,{d:()=>v});class v{constructor(z,a,K){this.name=z,this.from=a,this.to=K}clone(){return new v(this.name,this.from,this.to)}}},11502:(z,a,K)=>{"use strict";var v=K(10638),T=K(10648),m=K(10715),p=K(10640);m.b.AudioEngineFactory=(z,a,K)=>new j(z,a,K);class j{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new v.c,this.onAudioLockedObservable=new v.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,p.m)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const T=document.createElement("audio");this._hostElement=z,this._audioContext=a,this._audioDestination=K;try{T&&T.canPlayType&&(T.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||T.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(m){}try{T&&T.canPlayType&&T.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(m){}}lock(){this._triggerSuspendedState()}unlock(){var z,a;if("running"===(null===(z=this._audioContext)||void 0===z?void 0:z.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(a=this._audioContext)||void 0===a||a.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var z;null===(z=this._audioContext)||void 0===z||z.addEventListener("statechange",(()=>{var z;this.unlocked&&"running"!==(null===(z=this._audioContext)||void 0===z?void 0:z.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var z;return null!==(z=this._audioContext)&&void 0!==z&&z.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(z){this.canUseWebAudio=!1,T.c.Error("Web Audio: "+z.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const z=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",a=document.createElement("style");a.appendChild(document.createTextNode(z)),document.getElementsByTagName("head")[0].appendChild(a),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(z){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=z)}connectToAnalyser(z){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=z,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},11894:(z,a,K)=>{"use strict";K.d(a,{b:()=>p});var v=K(10941),T=K(10951),m=K(11215);class p extends m.c{get _matrix(){return this._compose(),this.Sj}set _matrix(z){(z.updateFlag!==this.Sj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Sj.p(z),this._markAsDirtyAndDecompose())}constructor(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(z,a.va(),!1),this.name=z,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=a,this.Sj=(null===T||void 0===T?void 0:T.clone())??v.b.Identity(),this._restMatrix=m??this.Sj.clone(),this._bindMatrix=p??this.Sj.clone(),this._index=j,this._absoluteMatrix=new v.b,this._absoluteBindMatrix=new v.b,this._absoluteInverseBindMatrix=new v.b,this._finalMatrix=new v.b,a.bones.push(this),this.setParent(K,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(z){this.setParent(z)}setParent(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==z){if(this.parent){const z=this.parent.children.indexOf(this);-1!==z&&this.parent.children.splice(z,1)}this._parentNode=z,this.parent&&this.parent.children.push(this),a&&this._updateAbsoluteBindMatrices(),this.zg()}}getLocalMatrix(){return this._compose(),this.Sj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(z){this._restMatrix.p(z)}setRestPose(z){this.setRestMatrix(z)}getBindPose(){return this.getBindMatrix()}setBindMatrix(z){this.Jj(z)}setBindPose(z){this.setBindMatrix(z)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const z=v.j.gb[0],a=v.j.Quaternion[0],K=v.j.gb[1];this.getRestMatrix().decompose(z,a,K),this._linkedTransformNode.position.p(K),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??v.f.Identity(),this._linkedTransformNode.rotationQuaternion.p(a),this._linkedTransformNode.Yd.p(z)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(z){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=z,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Td}set position(z){this._decompose(),this.Td.p(z),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(z){this.setRotation(z)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(z){this.setRotationQuaternion(z)}get Yd(){return this.getScale()}set Yd(z){this.setScale(z)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=v.o.Zero(),this._localRotation=v.f.Zero(),this.Td=v.o.Zero()),this.Sj.decompose(this._localScaling,this._localRotation,this.Td))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,v.b.ComposeToRef(this._localScaling,this._localRotation,this.Td,this.Sj)):this._needToCompose=!1)}Jj(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(z),a&&this._updateAbsoluteBindMatrices(),K?this._matrix=z:this.zg()}_updateAbsoluteBindMatrices(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(z||(z=this._bindMatrix),this.parent?z.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(z),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),a)for(let K=0;K<this.children.length;K++)this.children[K]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}zg(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.zg(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.zg(),this._needToDecompose=!0}_updatePosition(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const m=this.getLocalMatrix();if(0==a)T?(m.addAtIndex(12,z.x),m.addAtIndex(13,z.y),m.addAtIndex(14,z.z)):m.setTranslationFromFloats(z.x,z.y,z.z);else{let a=null;K&&(a=K.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const j=p._TmpMats[0],s=p._TmpVecs[0];this.parent?K&&a?(j.p(this.parent.getAbsoluteMatrix()),j.multiplyToRef(a,j)):j.p(this.parent.getAbsoluteMatrix()):v.b.IdentityToRef(j),T&&j.setTranslationFromFloats(0,0,0),j.invert(),v.o.TransformCoordinatesToRef(z,j,s),T?(m.addAtIndex(12,s.x),m.addAtIndex(13,s.y),m.addAtIndex(14,s.z)):m.setTranslationFromFloats(s.x,s.y,s.z)}this._markAsDirtyAndDecompose()}translate(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;this._updatePosition(z,a,K,!0)}setPosition(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;this._updatePosition(z,a,K,!1)}setAbsolutePosition(z,a){this.setPosition(z,1,a)}scale(z,a,K){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const m=this.getLocalMatrix(),j=p._TmpMats[0];v.b.ScalingToRef(z,a,K,j),j.multiplyToRef(m,m),j.invert();for(const v of this.children){const T=v.getLocalMatrix();T.multiplyToRef(j,T),T.multiplyAtIndex(12,z),T.multiplyAtIndex(13,a),T.multiplyAtIndex(14,K),v._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),T)for(const v of this.children)v.scale(z,a,K,T)}setScale(z){this._decompose(),this._localScaling.p(z),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(z){this._decompose(),z.p(this._localScaling)}setYawPitchRoll(z,a,K){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,m=arguments.length>4?arguments[4]:void 0;if(0===T){const j=p._TmpQuat;return v.f.RotationYawPitchRollToRef(z,a,K,j),void this.setRotationQuaternion(j,T,m)}const j=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(j,m))return;const s=p._TmpMats[1];v.b.RotationYawPitchRollToRef(z,a,K,s),j.multiplyToRef(s,s),this._rotateWithMatrix(s,T,m)}rotate(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3?arguments[3]:void 0;const m=p._TmpMats[0];m.setTranslationFromFloats(0,0,0),v.b.RotationAxisToRef(z,a,m),this._rotateWithMatrix(m,K,T)}setAxisAngle(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3?arguments[3]:void 0;if(0===K){const m=p._TmpQuat;return v.f.RotationAxisToRef(z,a,m),void this.setRotationQuaternion(m,K,T)}const m=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(m,T))return;const j=p._TmpMats[1];v.b.RotationAxisToRef(z,a,j),m.multiplyToRef(j,j),this._rotateWithMatrix(j,K,T)}setRotation(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(z.y,z.x,z.z,a,K)}setRotationQuaternion(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;if(0===a)return this._decompose(),this._localRotation.p(z),void this._markAsDirtyAndCompose();const T=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(T,K))return;const m=p._TmpMats[1];v.b.FromQuaternionToRef(z,m),T.multiplyToRef(m,m),this._rotateWithMatrix(m,a,K)}setRotationMatrix(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;if(0===a){const T=p._TmpQuat;return v.f.FromRotationMatrixToRef(z,T),void this.setRotationQuaternion(T,a,K)}const T=p._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(T,K))return;const m=p._TmpMats[1];m.p(z),T.multiplyToRef(z,m),this._rotateWithMatrix(m,a,K)}_rotateWithMatrix(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;const v=this.getLocalMatrix(),T=v.m[12],m=v.m[13],j=v.m[14],s=this.getParent(),M=p._TmpMats[3],r=p._TmpMats[4];s&&1==a?(K?(M.p(K.getWorldMatrix()),s.getAbsoluteMatrix().multiplyToRef(M,M)):M.p(s.getAbsoluteMatrix()),r.p(M),r.invert(),v.multiplyToRef(M,v),v.multiplyToRef(z,v),v.multiplyToRef(r,v)):1==a&&K?(M.p(K.getWorldMatrix()),r.p(M),r.invert(),v.multiplyToRef(M,v),v.multiplyToRef(z,v),v.multiplyToRef(r,v)):v.multiplyToRef(z,v),v.setTranslationFromFloats(T,m,j),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(z,a){const K=p._TmpMats[2];return z.p(this.getAbsoluteMatrix()),a?(z.multiplyToRef(a.getWorldMatrix(),z),v.b.ScalingToRef(a.Yd.x,a.Yd.y,a.Yd.z,K)):v.b.IdentityToRef(K),z.invert(),!isNaN(z.m[0])&&(K.multiplyAtIndex(0,this._scalingDeterminant),z.multiplyToRef(K,z),!0)}eb(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=v.o.Zero();return this.getPositionToRef(z,a,K),K}getPositionToRef(){let z=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const z=this.getLocalMatrix();a.x=z.m[12],a.y=z.m[13],a.z=z.m[14]}else{let K=null;z&&(K=z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let v=p._TmpMats[0];z&&K?(v.p(this.getAbsoluteMatrix()),v.multiplyToRef(K,v)):v=this.getAbsoluteMatrix(),a.x=v.m[12],a.y=v.m[13],a.z=v.m[14]}}getAbsolutePosition(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const a=v.o.Zero();return this.getPositionToRef(1,z,a),a}getAbsolutePositionToRef(z,a){this.getPositionToRef(1,z,a)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Sj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Sj);const z=this._skeleton.getPoseMatrix();z&&this._absoluteMatrix.multiplyToRef(z,this._absoluteMatrix)}const z=this.children,a=z.length;for(let K=0;K<a;K++)z[K].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Re(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=v.o.Zero();return this.getDirectionToRef(z,a,K),K}getDirectionToRef(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0,T=null;a&&(T=a.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const m=p._TmpMats[0];m.p(this.getAbsoluteMatrix()),a&&T&&m.multiplyToRef(T,m),v.o.TransformNormalToRef(z,m,K),K.normalize()}getRotation(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=v.o.Zero();return this.getRotationToRef(z,a,K),K}getRotationToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0;const v=p._TmpQuat;this.getRotationQuaternionToRef(z,a,v),v.toEulerAnglesToRef(K)}getRotationQuaternion(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=v.f.Identity();return this.getRotationQuaternionToRef(z,a,K),K}getRotationQuaternionToRef(){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),a.p(this._localRotation);else{const K=p._TmpMats[0],v=this.getAbsoluteMatrix();z?v.multiplyToRef(z.getWorldMatrix(),K):K.p(v),K.multiplyAtIndex(0,this._scalingDeterminant),K.multiplyAtIndex(1,this._scalingDeterminant),K.multiplyAtIndex(2,this._scalingDeterminant),K.decompose(void 0,a,void 0)}}getRotationMatrix(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1?arguments[1]:void 0;const K=v.b.Identity();return this.getRotationMatrixToRef(z,a,K),K}getRotationMatrixToRef(){let z=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(a);else{const K=p._TmpMats[0],v=this.getAbsoluteMatrix();z?v.multiplyToRef(z.getWorldMatrix(),K):K.p(v),K.multiplyAtIndex(0,this._scalingDeterminant),K.multiplyAtIndex(1,this._scalingDeterminant),K.multiplyAtIndex(2,this._scalingDeterminant),K.getRotationMatrixToRef(a)}}getAbsolutePositionFromLocal(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=v.o.Zero();return this.getAbsolutePositionFromLocalToRef(z,a,K),K}getAbsolutePositionFromLocalToRef(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0,T=null;a&&(T=a.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const m=p._TmpMats[0];m.p(this.getAbsoluteMatrix()),a&&T&&m.multiplyToRef(T,m),v.o.TransformCoordinatesToRef(z,m,K)}getLocalPositionFromAbsolute(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=v.o.Zero();return this.getLocalPositionFromAbsoluteToRef(z,a,K),K}getLocalPositionFromAbsoluteToRef(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0,T=null;a&&(T=a.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const m=p._TmpMats[0];m.p(this.getAbsoluteMatrix()),a&&T&&m.multiplyToRef(T,m),m.invert(),v.o.TransformCoordinatesToRef(z,m,K)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}p._TmpVecs=(0,T.d)(2,v.o.Zero),p._TmpQuat=v.f.Identity(),p._TmpMats=(0,T.d)(5,v.b.Identity)},11001:(z,a,K)=>{"use strict";K.d(a,{e:()=>m,h:()=>p});var v=K(11007),T=K(10648);class m{get u(){return this._isDisposed}constructor(z,a,K){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,m=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7?arguments[7]:void 0,M=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,z&&z.va?this._engine=z.va().getEngine():this._engine=z,this._updatable=K,this._instanced=p,this._divisor=s||1,this._label=M,a instanceof v.b?(this._data=null,this._buffer=a):(this._data=a,this._buffer=null),this.byteStride=j?T:T*Float32Array.BYTES_PER_ELEMENT,m||this.create()}createVertexBuffer(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6?arguments[6]:void 0;const s=m?a:a*Float32Array.BYTES_PER_ELEMENT,M=v?m?v:v*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new p(this._engine,this,z,this._updatable,!0,M,void 0===T?this._instanced:T,s,K,void 0,void 0,!0,this._divisor||j)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!z&&this._buffer||(z=z||this._data,z&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,z),this._data=z):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(z,this._label),this._data=z):this._buffer=this._engine.createVertexBuffer(z,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.lb>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.lb,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.lb,void 0,this._label));T.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(z){this.create(z)}updateDirectly(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,z,v?a:a*Float32Array.BYTES_PER_ELEMENT,K?K*this.byteStride:void 0),this._data=0===a&&void 0===K?z:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class p{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(z){const a=0!=z;this._instanceDivisor=z,a!==this._instanced&&(this._instanced=a,this._computeHashCode())}get _maxVerticesCount(){const z=this.getData();return z?Array.isArray(z)?z.length/(this.byteStride/4)-this.byteOffset/4:(z.byteLength-this.byteOffset)/this.byteStride:0}constructor(z,a,K,v,T,j,s,M,r,W){let F=arguments.length>10&&void 0!==arguments[10]&&arguments[10],G=arguments.length>11&&void 0!==arguments[11]&&arguments[11],l=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,V=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let c=!1;if(this.kd=z,"object"===typeof v&&null!==v?(c=v.updatable??!1,T=v.postponeInternalCreation,j=v.stride,s=v.instanced,M=v.offset,r=v.size,W=v.type,F=v.normalized??!1,G=v.useBytes??!1,l=v.divisor??1,V=v.takeBufferOwnership??!1,this._label=v.label):c=!!v,a instanceof m?(this._buffer=a,this._ownsBuffer=V):(this._buffer=new m(z,a,c,j,T,s,G,l,this._label),this._ownsBuffer=!0),this.uniqueId=p._Counter++,this._kind=K,void 0===W){const z=this.getData();this.type=z?p.GetDataType(z):p.FLOAT}else this.type=W;const C=p.GetTypeByteLength(this.type);G?(this._size=r||(j?j/C:p.DeduceStride(K)),this.byteStride=j||this._buffer.byteStride||this._size*C,this.byteOffset=M||0):(this._size=r||j||p.DeduceStride(K),this.byteStride=j?j*C:this._buffer.byteStride||this._size*C,this.byteOffset=(M||0)*C),this.normalized=F,this._instanced=void 0!==s&&s,this._instanceDivisor=s?l:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var z;null===(z=this._buffer)||void 0===z||z._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(z,a){const K=this.getData();return K?p.GetFloatData(K,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,z,a):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/p.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/p.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*p.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(z){this._buffer.create(z),this._alignBuffer()}update(z){this._buffer.update(z),this._alignBuffer()}updateDirectly(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(z,a,void 0,K),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(z,a){p.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,z,this.normalized,a)}_alignBuffer(){}static DeduceStride(z){switch(z){case p.UVKind:case p.UV2Kind:case p.UV3Kind:case p.UV4Kind:case p.UV5Kind:case p.UV6Kind:return 2;case p.NormalKind:case p.PositionKind:return 3;case p.ColorKind:case p.ColorInstanceKind:case p.MatricesIndicesKind:case p.MatricesIndicesExtraKind:case p.MatricesWeightsKind:case p.MatricesWeightsExtraKind:case p.TangentKind:return 4;default:throw new Error("Invalid kind '"+z+"'")}}static GetDataType(z){return z instanceof Int8Array?p.BYTE:z instanceof Uint8Array?p.UNSIGNED_BYTE:z instanceof Int16Array?p.SHORT:z instanceof Uint16Array?p.UNSIGNED_SHORT:z instanceof Int32Array?p.INT:z instanceof Uint32Array?p.UNSIGNED_INT:p.FLOAT}static GetTypeByteLength(z){switch(z){case p.BYTE:case p.UNSIGNED_BYTE:return 1;case p.SHORT:case p.UNSIGNED_SHORT:return 2;case p.INT:case p.UNSIGNED_INT:case p.FLOAT:return 4;default:throw new Error(`Invalid type '${z}'`)}}static ForEach(z,a,K,v,T,m,j,s){if(z instanceof Array){let T=a/4;const p=K/4;for(let a=0;a<m;a+=v){for(let K=0;K<v;K++)s(z[T+K],a+K);T+=p}}else{const M=z instanceof ArrayBuffer?new DataView(z):new DataView(z.buffer,z.byteOffset,z.byteLength),r=p.GetTypeByteLength(T);for(let z=0;z<m;z+=v){let m=a;for(let a=0;a<v;a++){s(p._GetFloatValue(M,T,m,j),z+a),m+=r}a+=K}}}static _GetFloatValue(z,a,K,v){switch(a){case p.BYTE:{let a=z.getInt8(K);return v&&(a=Math.max(a/127,-1)),a}case p.UNSIGNED_BYTE:{let a=z.getUint8(K);return v&&(a/=255),a}case p.SHORT:{let a=z.getInt16(K,!0);return v&&(a=Math.max(a/32767,-1)),a}case p.UNSIGNED_SHORT:{let a=z.getUint16(K,!0);return v&&(a/=65535),a}case p.INT:return z.getInt32(K,!0);case p.UNSIGNED_INT:return z.getUint32(K,!0);case p.FLOAT:return z.getFloat32(K,!0);default:throw new Error(`Invalid component type ${a}`)}}static GetFloatData(z,a,K,v,m,j,s,M){const r=a*p.GetTypeByteLength(K),W=s*a;if(K!==p.FLOAT||m!==r){const T=new Float32Array(W);return p.ForEach(z,v,m,a,K,W,j,((z,a)=>T[a]=z)),T}if(!(z instanceof Array||z instanceof Float32Array)||0!==v||z.length!==W){if(z instanceof Array){const a=v/4;return z.slice(a,a+W)}if(z instanceof ArrayBuffer)return new Float32Array(z,v,W);{const a=z.byteOffset+v;if(0!==(3&a)&&(T.c.Warn("Float array must be aligned to 4-bytes border"),M=!0),M){const K=new Uint8Array(W*Float32Array.BYTES_PER_ELEMENT),v=new Uint8Array(z.buffer,a,K.length);return K.set(v),new Float32Array(K.buffer)}return new Float32Array(z.buffer,a,W)}}return M?z.slice():z}}p._Counter=0,p.BYTE=5120,p.UNSIGNED_BYTE=5121,p.SHORT=5122,p.UNSIGNED_SHORT=5123,p.INT=5124,p.UNSIGNED_INT=5125,p.FLOAT=5126,p.PositionKind="position",p.NormalKind="normal",p.TangentKind="tangent",p.UVKind="uv",p.UV2Kind="uv2",p.UV3Kind="uv3",p.UV4Kind="uv4",p.UV5Kind="uv5",p.UV6Kind="uv6",p.ColorKind="color",p.ColorInstanceKind="instanceColor",p.MatricesIndicesKind="matricesIndices",p.MatricesWeightsKind="matricesWeights",p.MatricesIndicesExtraKind="matricesIndicesExtra",p.MatricesWeightsExtraKind="matricesWeightsExtra"},11007:(z,a,K)=>{"use strict";K.d(a,{b:()=>v});class v{get underlyingResource(){return null}constructor(){this.references=0,this.lb=0,this.is32Bits=!1,this.uniqueId=v._Counter++}}v._Counter=0},12353:(z,a,K)=>{"use strict";K.d(a,{d:()=>P});var v=K(10923),T=K(10927),m=K(10638),p=K(10941),j=K(11215),s=K(11194),M=K(11022),r=K(10658),W=K(10946);class F{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(z){this._zoomStopsAnimation=z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(z){this._idleRotationSpeed=z}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(z){this._idleRotationWaitTime=z}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(z){this._idleRotationSpinupTime=z}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(z){this._attachedCamera=z;const a=this._attachedCamera.va();this._onPrePointerObservableObserver=a.onPrePointerObservable.add((z=>{z.type!==M.e.POINTERDOWN?z.type===M.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=z.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const z=r.d.Now;let a=0;null!=this._lastFrameTime&&(a=z-this._lastFrameTime),this._lastFrameTime=z,this._applyUserInteraction();const K=z-this._lastInteractionTime-this._idleRotationWaitTime,v=Math.max(Math.min(K/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*v,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(a/1e3))}))}detach(){if(!this._attachedCamera)return;const z=this._attachedCamera.va();this._onPrePointerObservableObserver&&z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(z){this._lastInteractionTime=z??r.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<W.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let z=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(z=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?z:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=r.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}K(11446);class G{constructor(){this._easingMode=G.EASINGMODE_EASEIN}setEasingMode(z){const a=Math.min(Math.max(z,0),2);this._easingMode=a}getEasingMode(){return this._easingMode}easeInCore(z){throw new Error("You must implement this method")}ease(z){switch(this._easingMode){case G.EASINGMODE_EASEIN:return this.easeInCore(z);case G.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-z)}return z>=.5?.5*(1-this.easeInCore(2*(1-z)))+.5:.5*this.easeInCore(2*z)}}G.EASINGMODE_EASEIN=0,G.EASINGMODE_EASEOUT=1,G.EASINGMODE_EASEINOUT=2;var l=K(11900);class V{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(z){if(this._autoTransitionRange===z)return;this._autoTransitionRange=z;const a=this._attachedCamera;a&&(z?this._onMeshTargetChangedObserver=a.onMeshTargetChangedObservable.add((z=>{if(z&&(z.Qj(!0),z.getBoundingInfo)){const a=z.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*a,this.upperRadiusTransitionRange=.05*a}})):this._onMeshTargetChangedObserver&&a.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(z){this._attachedCamera=z,this._onAfterCheckInputsObserver=z.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(z){return!!this._attachedCamera&&(this._attachedCamera.radius===z&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(z){if(!this._attachedCamera)return;this._radiusBounceTransition||(V.EasingFunction.setEasingMode(V.EasingMode),this._radiusBounceTransition=l.e.CreateAnimation("radius",l.e.ANIMATIONTYPE_FLOAT,60,V.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const a=l.e.TransitionTo("radius",this._attachedCamera.radius+z,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));a&&this._animatables.push(a)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}V.EasingFunction=new class extends G{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=z}easeInCore(z){const a=Math.max(0,this.amplitude);return Math.pow(z,3)-z*a*Math.sin(3.141592653589793*z)}}(.3),V.EasingMode=G.EASINGMODE_EASEOUT;class c{constructor(){this.onTargetFramingAnimationEndObservable=new m.c,this._mode=c.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(z){this._mode=z}get mode(){return this._mode}set radiusScale(z){this._radiusScale=z}get radiusScale(){return this._radiusScale}set positionScale(z){this._positionScale=z}get positionScale(){return this._positionScale}set defaultElevation(z){this._defaultElevation=z}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(z){this._elevationReturnTime=z}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(z){this._elevationReturnWaitTime=z}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(z){this._zoomStopsAnimation=z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(z){this._framingTime=z}get framingTime(){return this._framingTime}init(){}attach(z){this._attachedCamera=z;const a=this._attachedCamera.va();c.EasingFunction.setEasingMode(c.EasingMode),this._onPrePointerObservableObserver=a.onPrePointerObservable.add((z=>{z.type!==M.e.POINTERDOWN?z.type===M.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=z.onMeshTargetChangedObservable.add((z=>{z&&z.getBoundingInfo&&this.zoomOnMesh(z,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=z.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const z=this._attachedCamera.va();this._onPrePointerObservableObserver&&z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;z.Qj(!0);const v=z.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(v.minimumWorld,v.maximumWorld,a,K)}zoomOnMeshHierarchy(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;z.Qj(!0);const v=z.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(v.min,v.max,a,K)}zoomOnMeshesHierarchy(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new p.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),T=new p.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let m=0;m<z.length;m++){const a=z[m].getHierarchyBoundingVectors(!0);p.o.CheckExtends(a.min,v,T),p.o.CheckExtends(a.max,v,T)}this.zoomOnBoundingInfo(v,T,a,K)}zoomOnBoundingInfo(z,a){let K,v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const m=z.y,j=m+(a.y-m)*this._positionScale,s=a.sc(z).scale(.5);if(v)K=new p.o(0,j,0);else{const a=z.add(s);K=new p.o(a.x,j,a.z)}this._vectorTransition||(this._vectorTransition=l.e.CreateAnimation("target",l.e.ANIMATIONTYPE_VECTOR3,60,c.EasingFunction)),this._betaIsAnimating=!0;let M=l.e.TransitionTo("target",K,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);M&&this._animatables.push(M);let r=0;if(this._mode===c.FitFrustumSidesMode){const K=this._calculateLowerRadiusFromModelBoundingSphere(z,a);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=s.length()+this._attachedCamera.Yi),r=K}else this._mode===c.IgnoreBoundsSizeMode&&(r=this._calculateLowerRadiusFromModelBoundingSphere(z,a),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Yi));if(this.autoCorrectCameraLimitsAndSensibility){const K=a.sc(z).length();this._attachedCamera.panningSensibility=5e3/K,this._attachedCamera.wheelPrecision=100/r}return this._radiusTransition||(this._radiusTransition=l.e.CreateAnimation("radius",l.e.ANIMATIONTYPE_FLOAT,60,c.EasingFunction)),M=l.e.TransitionTo("radius",r,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),T&&T(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),M&&this._animatables.push(M),!0}_calculateLowerRadiusFromModelBoundingSphere(z,a){const K=this._attachedCamera;if(!K)return 0;let v=K._calculateLowerRadiusFromModelBoundingSphere(z,a,this._radiusScale);return K.lowerRadiusLimit&&this._mode===c.IgnoreBoundsSizeMode&&(v=v<K.lowerRadiusLimit?K.lowerRadiusLimit:v),K.upperRadiusLimit&&(v=v>K.upperRadiusLimit?K.upperRadiusLimit:v),v}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const z=r.d.Now-this._lastInteractionTime,a=.5*Math.PI-this._defaultElevation,K=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>K&&z>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=l.e.CreateAnimation("beta",l.e.ANIMATIONTYPE_FLOAT,60,c.EasingFunction));const z=l.e.TransitionTo("beta",a,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));z&&this._animatables.push(z)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=r.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}c.EasingFunction=new class extends G{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=z}easeInCore(z){return this.exponent<=0?z:(Math.exp(this.exponent*z)-1)/(Math.exp(this.exponent)-1)}},c.EasingMode=G.EASINGMODE_EASEINOUT,c.IgnoreBoundsSizeMode=0,c.FitFrustumSidesMode=1;var C=K(11207),w=K(11882),H=K(11889),f=K(10631);class Y{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(z){z=f.h.BackCompatCameraNoPreventDefault(arguments);const a=this.camera.getEngine(),K=a.getInputElement();let v=0,T=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=m=>{var p,j;const s=m.event,r="touch"===s.pointerType;if(m.type!==M.e.POINTERMOVE&&-1===this.buttons.indexOf(s.button))return;const W=s.target;if(this._altKey=s.altKey,this._ctrlKey=s.ctrlKey,this._metaKey=s.metaKey,this._shiftKey=s.shiftKey,this._buttonsPressed=s.buttons,a.isPointerLock){const z=s.movementX,a=s.movementY;this.onTouch(null,z,a),this._pointA=null,this._pointB=null}else{if(m.type!==M.e.POINTERDOWN&&m.type!==M.e.POINTERDOUBLETAP&&r&&(null===(p=this._pointA)||void 0===p?void 0:p.pointerId)!==s.pointerId&&(null===(j=this._pointB)||void 0===j?void 0:j.pointerId)!==s.pointerId)return;if(m.type!==M.e.POINTERDOWN||-1!==this._currentActiveButton&&!r)if(m.type===M.e.POINTERDOUBLETAP)this.onDoubleTap(s.pointerType);else if(m.type!==M.e.POINTERUP||this._currentActiveButton!==s.button&&!r){if(m.type===M.e.POINTERMOVE)if(z||s.preventDefault(),this._pointA&&null===this._pointB){const z=s.clientX-this._pointA.x,a=s.clientY-this._pointA.y;this._pointA.x=s.clientX,this._pointA.y=s.clientY,this.onTouch(this._pointA,z,a)}else if(this._pointA&&this._pointB){const z=this._pointA.pointerId===s.pointerId?this._pointA:this._pointB;z.x=s.clientX,z.y=s.clientY;const a=this._pointA.x-this._pointB.x,K=this._pointA.y-this._pointB.y,p=a*a+K*K,j={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:s.pointerId,type:m.type};this.onMultiTouch(this._pointA,this._pointB,v,p,T,j),T=j,v=p}}else{try{null===W||void 0===W||W.releasePointerCapture(s.pointerId)}catch(F){}r||(this._pointB=null),a._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==s.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==s.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==v||T)&&(this.onMultiTouch(this._pointA,this._pointB,v,0,T,null),v=0,T=null),this._currentActiveButton=-1,this.onButtonUp(s),z||s.preventDefault()}else{try{null===W||void 0===W||W.setPointerCapture(s.pointerId)}catch(F){}if(null===this._pointA)this._pointA={x:s.clientX,y:s.clientY,pointerId:s.pointerId,type:s.pointerType};else{if(null!==this._pointB)return;this._pointB={x:s.clientX,y:s.clientY,pointerId:s.pointerId,type:s.pointerType}}-1!==this._currentActiveButton||r||(this._currentActiveButton=s.button),this.onButtonDown(s),z||(s.preventDefault(),K&&K.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,M.e.POINTERDOWN|M.e.POINTERUP|M.e.POINTERMOVE|M.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,v=0,T=null,this.onLostFocus()},this._contextMenuBind=z=>this.onContextMenu(z),K&&K.addEventListener("contextmenu",this._contextMenuBind,!1);const m=this.camera.va().getEngine().getHostWindow();m&&f.h.RegisterTopRootEvents(m,[{name:"blur",handler:this._onLostFocus}])}Ui(){if(this._onLostFocus){const z=this.camera.va().getEngine().getHostWindow();z&&f.h.UnregisterTopRootEvents(z,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const z=this.camera.va().getEngine().getInputElement();z&&z.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(z){}onTouch(z,a,K){}onMultiTouch(z,a,K,v,T,m){}onContextMenu(z){z.preventDefault()}onButtonDown(z){}onButtonUp(z){}onLostFocus(){}}(0,v.e)([(0,T.D)()],Y.prototype,"buttons",void 0);class I extends Y{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(z,a){if(0!==this.panningSensibility&&z&&a){const K=a.x-z.x,v=a.y-z.y;this.camera.inertialPanningX+=-K/this.panningSensibility,this.camera.inertialPanningY+=v/this.panningSensibility}}_computePinchZoom(z,a){const K=this.camera.radius||I.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=K*Math.sqrt(z)/Math.sqrt(a):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(a-z)*K*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(a-z)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(z,a,K){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-a/this.panningSensibility,this.camera.inertialPanningY+=K/this.panningSensibility):(this.camera.inertialAlphaOffset-=a/this.angularSensibilityX,this.camera.inertialBetaOffset-=K/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(z,a,K,v,T,m){0===K&&null===T||0===v&&null===m||(this.multiTouchPanAndZoom?(this._computePinchZoom(K,v),this._computeMultiTouchPanning(T,m)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(v)-Math.sqrt(K))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(K,v),this._isPinching=!0):this._computeMultiTouchPanning(T,m)):this.multiTouchPanning?this._computeMultiTouchPanning(T,m):this.pinchZoom&&this._computePinchZoom(K,v))}onButtonDown(z){this._isPanClick=z.button===this.camera._panningMouseButton}onButtonUp(z){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}I.MinimumRadiusForPinch=.001,(0,v.e)([(0,T.D)()],I.prototype,"buttons",void 0),(0,v.e)([(0,T.D)()],I.prototype,"angularSensibilityX",void 0),(0,v.e)([(0,T.D)()],I.prototype,"angularSensibilityY",void 0),(0,v.e)([(0,T.D)()],I.prototype,"pinchPrecision",void 0),(0,v.e)([(0,T.D)()],I.prototype,"pinchDeltaPercentage",void 0),(0,v.e)([(0,T.D)()],I.prototype,"useNaturalPinchZoom",void 0),(0,v.e)([(0,T.D)()],I.prototype,"pinchZoom",void 0),(0,v.e)([(0,T.D)()],I.prototype,"panningSensibility",void 0),(0,v.e)([(0,T.D)()],I.prototype,"multiTouchPanning",void 0),(0,v.e)([(0,T.D)()],I.prototype,"multiTouchPanAndZoom",void 0),H.c.ArcRotateCameraPointersInput=I;var q=K(11026);class B{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(z){z=f.h.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((a=>{const K=a.event;if(!K.metaKey)if(a.type===q.c.KEYDOWN){if(this._ctrlPressed=K.ctrlKey,this._altPressed=K.altKey,-1!==this.keysUp.indexOf(K.keyCode)||-1!==this.keysDown.indexOf(K.keyCode)||-1!==this.keysLeft.indexOf(K.keyCode)||-1!==this.keysRight.indexOf(K.keyCode)||-1!==this.keysReset.indexOf(K.keyCode)){-1===this._keys.indexOf(K.keyCode)&&this._keys.push(K.keyCode),K.preventDefault&&(z||K.preventDefault())}}else if(-1!==this.keysUp.indexOf(K.keyCode)||-1!==this.keysDown.indexOf(K.keyCode)||-1!==this.keysLeft.indexOf(K.keyCode)||-1!==this.keysRight.indexOf(K.keyCode)||-1!==this.keysReset.indexOf(K.keyCode)){const a=this._keys.indexOf(K.keyCode);a>=0&&this._keys.splice(a,1),K.preventDefault&&(z||K.preventDefault())}})))}Ui(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const z=this.camera;for(let a=0;a<this._keys.length;a++){const K=this._keys[a];-1!==this.keysLeft.indexOf(K)?this._ctrlPressed&&this.camera._useCtrlForPanning?z.inertialPanningX-=1/this.panningSensibility:z.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(K)?this._ctrlPressed&&this.camera._useCtrlForPanning?z.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?z.inertialRadiusOffset+=1/this.zoomingSensibility:z.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(K)?this._ctrlPressed&&this.camera._useCtrlForPanning?z.inertialPanningX+=1/this.panningSensibility:z.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(K)?this._ctrlPressed&&this.camera._useCtrlForPanning?z.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?z.inertialRadiusOffset-=1/this.zoomingSensibility:z.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(K)&&z.useInputToRestoreState&&z.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,v.e)([(0,T.D)()],B.prototype,"keysUp",void 0),(0,v.e)([(0,T.D)()],B.prototype,"keysDown",void 0),(0,v.e)([(0,T.D)()],B.prototype,"keysLeft",void 0),(0,v.e)([(0,T.D)()],B.prototype,"keysRight",void 0),(0,v.e)([(0,T.D)()],B.prototype,"keysReset",void 0),(0,v.e)([(0,T.D)()],B.prototype,"panningSensibility",void 0),(0,v.e)([(0,T.D)()],B.prototype,"zoomingSensibility",void 0),(0,v.e)([(0,T.D)()],B.prototype,"useAltToZoom",void 0),(0,v.e)([(0,T.D)()],B.prototype,"angularSpeed",void 0),H.c.ArcRotateCameraKeyboardMoveInput=B;var x=K(11038),Z=K(11029),y=K(10959);class i{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new p.o(0,0,0),this._globalOffset=new p.o(0,0,0),this._inertialPanning=p.o.Zero()}_computeDeltaFromMouseWheelLegacyEvent(z,a){let K=0;const v=.01*z*this.wheelDeltaPercentage*a;return K=z>0?v/(1+this.wheelDeltaPercentage):v*(1+this.wheelDeltaPercentage),K}attachControl(z){z=f.h.BackCompatCameraNoPreventDefault(arguments),this._wheel=a=>{if(a.type!==M.e.POINTERWHEEL)return;const K=a.event;let v=0;const T=K.deltaMode===Z.d.DOM_DELTA_LINE?40:1,m=-K.deltaY*T;if(this.customComputeDeltaFromMouseWheel)v=this.customComputeDeltaFromMouseWheel(m,this,K);else if(this.wheelDeltaPercentage){if(v=this._computeDeltaFromMouseWheelLegacyEvent(m,this.camera.radius),v>0){let z=this.camera.radius,a=this.camera.inertialRadiusOffset+v;for(let K=0;K<20&&Math.abs(a)>.001;K++)z-=a,a*=this.camera.inertia;z=(0,y.e)(z,0,Number.MAX_VALUE),v=this._computeDeltaFromMouseWheelLegacyEvent(m,z)}}else v=m/(40*this.wheelPrecision);v&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(v)):this.camera.inertialRadiusOffset+=v),K.preventDefault&&(z||K.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,M.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Vd(0)}Ui(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const z=this.camera;0+z.inertialAlphaOffset+z.inertialBetaOffset+z.inertialRadiusOffset&&(this._updateHitPlane(),z.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(z.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const z=this.camera,a=z.target.sc(z.position);this._hitPlane=x.d.FromPositionAndNormal(z.target,a)}_getPosition(){const z=this.camera,a=z.va(),K=a.createPickingRay(a.pointerX,a.pointerY,p.b.Identity(),z,!1);0===z.targetScreenOffset.x&&0===z.targetScreenOffset.y||(this._viewOffset.set(z.targetScreenOffset.x,z.targetScreenOffset.y,0),z.getViewMatrix().invertToRef(z._cameraTransformMatrix),this._globalOffset=p.o.TransformNormal(this._viewOffset,z._cameraTransformMatrix),K.origin.addInPlace(this._globalOffset));let v=0;return this._hitPlane&&(v=K.intersectsPlane(this._hitPlane)??0),K.origin.addInPlace(K.direction.scaleInPlace(v))}_zoomToMouse(z){const a=this.camera,K=1-a.inertia;if(a.lowerRadiusLimit){const v=a.lowerRadiusLimit??0;a.radius-(a.inertialRadiusOffset+z)/K<v&&(z=(a.radius-v)*K-a.inertialRadiusOffset)}if(a.upperRadiusLimit){const v=a.upperRadiusLimit??0;a.radius-(a.inertialRadiusOffset+z)/K>v&&(z=(a.radius-v)*K-a.inertialRadiusOffset)}const v=z/K/a.radius,T=this._getPosition(),m=p.j.gb[6];T.subtractToRef(a.target,m),m.scaleInPlace(v),m.scaleInPlace(K),this._inertialPanning.addInPlace(m),a.inertialRadiusOffset+=z}_zeroIfClose(z){Math.abs(z.x)<W.e&&(z.x=0),Math.abs(z.y)<W.e&&(z.y=0),Math.abs(z.z)<W.e&&(z.z=0)}}(0,v.e)([(0,T.D)()],i.prototype,"wheelPrecision",void 0),(0,v.e)([(0,T.D)()],i.prototype,"zoomToMouseLocation",void 0),(0,v.e)([(0,T.D)()],i.prototype,"wheelDeltaPercentage",void 0),H.c.ArcRotateCameraMouseWheelInput=i;class n extends H.g{constructor(z){super(z)}addMouseWheel(){return this.add(new i),this}addPointers(){return this.add(new I),this}addKeyboard(){return this.add(new B),this}}var X=K(10767);j.c.AddNodeConstructor("ArcRotateCamera",((z,a)=>()=>new P(z,0,0,1,p.o.Zero(),a)));class P extends w.c{get target(){return this._target}set target(z){this.setTarget(z)}get targetHost(){return this._targetHost}set targetHost(z){z&&this.setTarget(z)}getTarget(){return this.target}get position(){return this._position}set position(z){this.setPosition(z)}set upVector(z){this._upToYMatrix||(this._yToUpMatrix=new p.b,this._upToYMatrix=new p.b,this._upVector=p.o.Zero()),z.normalize(),this._upVector.p(z),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){p.b.RotationAlignToRef(p.o.UpReadOnly,this._upVector,this._yToUpMatrix),p.b.RotationAlignToRef(this._upVector,p.o.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const z=this.inputs.attached.pointers;return z?z.angularSensibilityX:0}set angularSensibilityX(z){const a=this.inputs.attached.pointers;a&&(a.angularSensibilityX=z)}get angularSensibilityY(){const z=this.inputs.attached.pointers;return z?z.angularSensibilityY:0}set angularSensibilityY(z){const a=this.inputs.attached.pointers;a&&(a.angularSensibilityY=z)}get pinchPrecision(){const z=this.inputs.attached.pointers;return z?z.pinchPrecision:0}set pinchPrecision(z){const a=this.inputs.attached.pointers;a&&(a.pinchPrecision=z)}get pinchDeltaPercentage(){const z=this.inputs.attached.pointers;return z?z.pinchDeltaPercentage:0}set pinchDeltaPercentage(z){const a=this.inputs.attached.pointers;a&&(a.pinchDeltaPercentage=z)}get useNaturalPinchZoom(){const z=this.inputs.attached.pointers;return!!z&&z.useNaturalPinchZoom}set useNaturalPinchZoom(z){const a=this.inputs.attached.pointers;a&&(a.useNaturalPinchZoom=z)}get panningSensibility(){const z=this.inputs.attached.pointers;return z?z.panningSensibility:0}set panningSensibility(z){const a=this.inputs.attached.pointers;a&&(a.panningSensibility=z)}get keysUp(){const z=this.inputs.attached.keyboard;return z?z.keysUp:[]}set keysUp(z){const a=this.inputs.attached.keyboard;a&&(a.keysUp=z)}get keysDown(){const z=this.inputs.attached.keyboard;return z?z.keysDown:[]}set keysDown(z){const a=this.inputs.attached.keyboard;a&&(a.keysDown=z)}get keysLeft(){const z=this.inputs.attached.keyboard;return z?z.keysLeft:[]}set keysLeft(z){const a=this.inputs.attached.keyboard;a&&(a.keysLeft=z)}get keysRight(){const z=this.inputs.attached.keyboard;return z?z.keysRight:[]}set keysRight(z){const a=this.inputs.attached.keyboard;a&&(a.keysRight=z)}get wheelPrecision(){const z=this.inputs.attached.mousewheel;return z?z.wheelPrecision:0}set wheelPrecision(z){const a=this.inputs.attached.mousewheel;a&&(a.wheelPrecision=z)}get zoomToMouseLocation(){const z=this.inputs.attached.mousewheel;return!!z&&z.zoomToMouseLocation}set zoomToMouseLocation(z){const a=this.inputs.attached.mousewheel;a&&(a.zoomToMouseLocation=z)}get wheelDeltaPercentage(){const z=this.inputs.attached.mousewheel;return z?z.wheelDeltaPercentage:0}set wheelDeltaPercentage(z){const a=this.inputs.attached.mousewheel;a&&(a.wheelDeltaPercentage=z)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(z){z!==this.useBouncingBehavior&&(z?(this._bouncingBehavior=new V,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(z){z!==this.useFramingBehavior&&(z?(this._framingBehavior=new c,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(z){z!==this.useAutoRotationBehavior&&(z?(this._autoRotationBehavior=new F,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(z,a,K,v,T,j){var s;let M=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(z,p.o.Zero(),j,M),s=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=p.o.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=p.m.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new p.b,this.panningAxis=new p.o(1,1,0),this._transformedDirection=new p.o,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new m.c,this.checkCollisions=!1,this.collisionRadius=new p.o(.5,.5,.5),this._previousPosition=p.o.Zero(),this._collisionVelocity=p.o.Zero(),this._newPosition=p.o.Zero(),this._computationVector=p.o.Zero(),this._onCollisionPositionChange=function(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;K?(s.setPosition(a),s.Kk&&s.Kk(K)):s._previousPosition.p(s._position);const v=Math.cos(s.alpha),T=Math.sin(s.alpha),m=Math.cos(s.beta);let p=Math.sin(s.beta);0===p&&(p=1e-4);const j=s._getTargetPosition();s._computationVector.Xd(s.radius*v*p,s.radius*m,s.radius*T*p),j.addToRef(s._computationVector,s._newPosition),s._position.p(s._newPosition);let M=s.upVector;s.allowUpsideDown&&s.beta<0&&(M=M.clone(),M=M.negate()),s._computeViewMatrix(s._position,j,M),s._viewMatrix.addAtIndex(12,s.targetScreenOffset.x),s._viewMatrix.addAtIndex(13,s.targetScreenOffset.y),s._collisionTriggered=!1},this._target=p.o.Zero(),T&&this.setTarget(T),this.alpha=a,this.beta=K,this.radius=v,this.getViewMatrix(),this.inputs=new n(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new p.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=p.m.Zero()}_updateCache(z){z||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const z=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?z.addToRef(this._targetBoundingCenter,this._target):this._target.p(z)}const z=this._getLockedTargetPosition();return z||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>W.e&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(z,a){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const T=arguments;a=f.h.BackCompatCameraNoPreventDefault(T),this._useCtrlForPanning=K,this._panningMouseButton=v,"boolean"===typeof T[0]&&(T.length>1&&(this._useCtrlForPanning=T[1]),T.length>2&&(this._panningMouseButton=T[2])),this.inputs.attachElement(a),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Ui(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const z=this._scene.getEngine().getDeltaTime()/1e3,a=1-Math.pow(2,-z/this.restoreStateInterpolationFactor);this.setTarget(p.o.Lerp(this.getTarget(),this._storedTarget,a)),p.f.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,p.j.Quaternion[0]),p.f.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,p.j.Quaternion[1]),p.f.SlerpToRef(p.j.Quaternion[1],p.j.Quaternion[0],a,p.j.Quaternion[2]),p.j.Quaternion[2].normalize(),p.j.Quaternion[2].toAlphaBetaGammaToRef(p.j.gb[0]),this.alpha=p.j.gb[0].x,this.beta=p.j.gb[0].y,this.radius+=(this._storedRadius-this.radius)*a,p.m.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,a,this.targetScreenOffset),(p.o.DistanceSquared(this.getTarget(),this._storedTarget)<W.e&&p.j.Quaternion[2].equalsWithEpsilon(p.j.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<W.e&&p.m.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<W.e||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const z=this.invertRotation?-1:1,a=this._calculateHandednessMultiplier();let K=this.inertialAlphaOffset*a;this.beta<0&&(K*=-1),this.alpha+=K*z,this.beta+=this.inertialBetaOffset*z,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<W.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<W.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*W.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const z=new p.o(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),z.multiplyInPlace(this.panningAxis),p.o.TransformNormalToRef(z,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const z=this.upVector,a=p.o.CrossToRef(this._transformedDirection,z,this._transformedDirection);p.o.CrossToRef(z,a,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);p.o.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const z=p.j.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(z),z.transposeToRef(z),p.o.TransformCoordinatesToRef(this._transformedDirection,z,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*W.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*W.e&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||p.o.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const z=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const a=Math.round((z-this.alpha)/(2*Math.PI));this.alpha+=2*a*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(z){this._position.equals(z)||(this._position.p(z),this.rebuildAnglesAndRadius())}setTarget(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(v=this.overrideCloneAlphaBetaRadius??v,z.Qj)a&&z.getBoundingInfo?this._targetBoundingCenter=z.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,z.Qj(),this._targetHost=z,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const a=z,v=this._getTargetPosition();if(v&&!K&&v.equals(a))return;this._targetHost=null,this._target=a,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}v||this.rebuildAnglesAndRadius()}_getViewMatrix(){const z=Math.cos(this.alpha),a=Math.sin(this.alpha),K=Math.cos(this.beta);let v=Math.sin(this.beta);0===v&&(v=1e-4),0===this.radius&&(this.radius=1e-4);const T=this._getTargetPosition();if(this._computationVector.Xd(this.radius*z*v,this.radius*K,this.radius*a*v),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||p.o.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),T.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const z=this.va().collisionCoordinator;this._collider||(this._collider=z.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,z.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let z=this.upVector;this.allowUpsideDown&&v<0&&(z=z.negate()),this._computeViewMatrix(this._position,T,z),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=T,this._viewMatrix}zoomOn(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];z=z||this.va().meshes;const K=s.c.MinMax(z);let v=this._calculateLowerRadiusFromModelBoundingSphere(K.min,K.max);v=Math.max(Math.min(v,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=v*this.zoomOnFactor,this.focusOn({min:K.min,max:K.max,distance:v},a)}focusOn(z){let a,K,v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===z.min){const v=z||this.va().meshes;a=s.c.MinMax(v),K=p.o.Distance(a.min,a.max)}else{a=z,K=z.distance}this._target=s.c.Center(a),v||(this.maxZ=2*K)}createRigCamera(z,a){let K=0;switch(this.cameraRigMode){case C.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case C.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case C.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case C.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case C.d.RIG_MODE_VR:K=this._cameraRigParams.stereoHalfAngle*(0===a?1:-1);break;case C.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:K=this._cameraRigParams.stereoHalfAngle*(0===a?-1:1)}const v=new P(z,this.alpha+K,this.beta,this.radius,this._target,this.va());return v._cameraRigParams={},v.isRigCamera=!0,v.rigParent=this,v.upVector=this.upVector,v.mode=this.mode,v.orthoLeft=this.orthoLeft,v.orthoRight=this.orthoRight,v.orthoBottom=this.orthoBottom,v.orthoTop=this.orthoTop,v}_updateRigCameras(){const z=this._rigCameras[0],a=this._rigCameras[1];switch(z.beta=a.beta=this.beta,this.cameraRigMode){case C.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case C.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case C.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case C.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case C.d.RIG_MODE_VR:z.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,a.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case C.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:z.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,a.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const v=p.o.Distance(z,a),T=this.va().getEngine().getAspectRatio(this),m=Math.tan(this.fov/2),j=m*T,s=.5*v*K,M=s*Math.sqrt(1+1/(j*j)),r=s*Math.sqrt(1+1/(m*m));return Math.max(M,r)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,v.e)([(0,T.D)()],P.prototype,"alpha",void 0),(0,v.e)([(0,T.D)()],P.prototype,"beta",void 0),(0,v.e)([(0,T.D)()],P.prototype,"radius",void 0),(0,v.e)([(0,T.D)()],P.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,v.e)([(0,T.B)("target")],P.prototype,"_target",void 0),(0,v.e)([(0,T.p)("targetHost")],P.prototype,"_targetHost",void 0),(0,v.e)([(0,T.D)()],P.prototype,"inertialAlphaOffset",void 0),(0,v.e)([(0,T.D)()],P.prototype,"inertialBetaOffset",void 0),(0,v.e)([(0,T.D)()],P.prototype,"inertialRadiusOffset",void 0),(0,v.e)([(0,T.D)()],P.prototype,"lowerAlphaLimit",void 0),(0,v.e)([(0,T.D)()],P.prototype,"upperAlphaLimit",void 0),(0,v.e)([(0,T.D)()],P.prototype,"lowerBetaLimit",void 0),(0,v.e)([(0,T.D)()],P.prototype,"upperBetaLimit",void 0),(0,v.e)([(0,T.D)()],P.prototype,"lowerRadiusLimit",void 0),(0,v.e)([(0,T.D)()],P.prototype,"upperRadiusLimit",void 0),(0,v.e)([(0,T.D)()],P.prototype,"inertialPanningX",void 0),(0,v.e)([(0,T.D)()],P.prototype,"inertialPanningY",void 0),(0,v.e)([(0,T.D)()],P.prototype,"pinchToPanMaxDistance",void 0),(0,v.e)([(0,T.D)()],P.prototype,"panningDistanceLimit",void 0),(0,v.e)([(0,T.B)()],P.prototype,"panningOriginTarget",void 0),(0,v.e)([(0,T.D)()],P.prototype,"panningInertia",void 0),(0,v.e)([(0,T.D)()],P.prototype,"zoomToMouseLocation",null),(0,v.e)([(0,T.D)()],P.prototype,"zoomOnFactor",void 0),(0,v.e)([(0,T.y)()],P.prototype,"targetScreenOffset",void 0),(0,v.e)([(0,T.D)()],P.prototype,"allowUpsideDown",void 0),(0,v.e)([(0,T.D)()],P.prototype,"useInputToRestoreState",void 0),(0,v.e)([(0,T.D)()],P.prototype,"restoreStateInterpolationFactor",void 0),(0,X.e)("BABYLON.ArcRotateCamera",P)},11207:(z,a,K)=>{"use strict";K.d(a,{d:()=>c});var v=K(10923),T=K(10927),m=K(10933),p=K(10631),j=K(10638),s=K(10941),M=K(11215),r=K(10648),W=K(10767),F=K(10663),G=K(11223),l=K(11036),V=K(10973);class c extends M.c{get position(){return this._position}set position(z){this._position=z}set upVector(z){this._upVector=z}get upVector(){return this._upVector}get screenArea(){let z=0,a=0;if(this.mode===c.PERSPECTIVE_CAMERA)this.fovMode===c.FOVMODE_VERTICAL_FIXED?(a=2*this.Yi*Math.tan(this.fov/2),z=this.getEngine().getAspectRatio(this)*a):(z=2*this.Yi*Math.tan(this.fov/2),a=z/this.getEngine().getAspectRatio(this));else{const K=this.getEngine().getRenderWidth()/2,v=this.getEngine().getRenderHeight()/2;z=(this.orthoRight??K)-(this.orthoLeft??-K),a=(this.orthoTop??v)-(this.orthoBottom??-v)}return z*a}set orthoLeft(z){this._orthoLeft=z;for(const a of this._rigCameras)a.orthoLeft=z}get orthoLeft(){return this._orthoLeft}set orthoRight(z){this._orthoRight=z;for(const a of this._rigCameras)a.orthoRight=z}get orthoRight(){return this._orthoRight}set orthoBottom(z){this._orthoBottom=z;for(const a of this._rigCameras)a.orthoBottom=z}get orthoBottom(){return this._orthoBottom}set orthoTop(z){this._orthoTop=z;for(const a of this._rigCameras)a.orthoTop=z}get orthoTop(){return this._orthoTop}set mode(z){this._mode=z;for(const a of this._rigCameras)a.mode=z}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(z,a,K){let v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(z,K,!1),this._position=s.o.Zero(),this._upVector=s.o.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Yi=1,this.maxZ=1e4,this.inertia=.9,this._mode=c.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new G.e(0,0,1,1),this.layerMask=268435455,this.fovMode=c.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=c.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new j.c,this.onProjectionMatrixChangedObservable=new j.c,this.onAfterCheckInputsObservable=new j.c,this.onRestoreStateObservable=new j.c,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new s.b,this._postProcesses=new Array,this._activeMeshes=new m.f(256),this._globalPosition=s.o.Zero(),this._computedViewMatrix=s.b.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=s.b.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=s.f.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),v&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=a,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${z}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"fh"}toString(z){let a="Name: "+this.name;if(a+=", type: "+this.getClassName(),this.animations)for(let K=0;K<this.animations.length;K++)a+=", animation[0]: "+this.animations[K].toString(z);return a}applyVerticalCorrection(){const z=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-z.x:z.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(z){return-1!==this._activeMeshes.indexOf(z)}isReady(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(z)for(const a of this._postProcesses)if(a&&!a.isReady())return!1;return super.isReady(z)}_initCache(){super._initCache(),this._cache.position=new s.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new s.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Yi=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(z){z||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let z=this._cache.mode===this.mode&&this._cache.Yi===this.Yi&&this._cache.maxZ===this.maxZ;if(!z)return!1;const a=this.getEngine();return this.mode===c.PERSPECTIVE_CAMERA?z=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===a.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(z=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===a.getRenderWidth()&&this._cache.renderHeight===a.getRenderHeight(),this.oblique&&(z=z&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),z}attachControl(z,a){}Ui(z){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==c.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let z=0;z<this._postProcesses.length;z++)if(null!==this._postProcesses[z])return this._postProcesses[z];return null}_cascadePostProcessesToRigCams(){const z=this._getFirstPostProcess();z&&z.markTextureDirty();for(let a=0,K=this._rigCameras.length;a<K;a++){const z=this._rigCameras[a],K=z._rigPostProcess;if(K){"pass"===K.getEffectName()&&(z.isIntermediate=0===this._postProcesses.length),z._postProcesses=this._postProcesses.slice(0).concat(K),K.markTextureDirty()}else z._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!z.isReusable()&&this._postProcesses.indexOf(z)>-1?(r.c.Error("You're trying to reuse a post process not defined as reusable."),0):(null==a||a<0?this._postProcesses.push(z):null===this._postProcesses[a]?this._postProcesses[a]=z:this._postProcesses.splice(a,0,z),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.zg(),this._postProcesses.indexOf(z))}detachPostProcess(z){const a=this._postProcesses.indexOf(z);-1!==a&&(this._postProcesses[a]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.zg(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return s.b.Identity()}getViewMatrix(z){return!z&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(z){this._doNotComputeProjectionMatrix=!0,void 0!==z&&(this._projectionMatrix=z)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(z){if(this._doNotComputeProjectionMatrix||!z&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Yi=this.Yi,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const a=this.getEngine(),K=this.va(),v=a.useReverseDepthBuffer;if(this.mode===c.PERSPECTIVE_CAMERA){let z;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=a.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Yi<=0&&(this.Yi=.1),z=K.useRightHandedSystem?s.b.PerspectiveFovRHToRef:s.b.PerspectiveFovLHToRef,z(this.fov,a.getAspectRatio(this),v?this.maxZ:this.Yi,v?this.Yi:this.maxZ,this._projectionMatrix,this.fovMode===c.FOVMODE_VERTICAL_FIXED,a.isNDCHalfZRange,this.projectionPlaneTilt,v)}else{var T,m,p;const z=a.getRenderWidth()/2,j=a.getRenderHeight()/2;K.useRightHandedSystem?this.oblique?s.b.ObliqueOffCenterRHToRef(this.orthoLeft??-z,this.orthoRight??z,this.orthoBottom??-j,this.orthoTop??j,v?this.maxZ:this.Yi,v?this.Yi:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,a.isNDCHalfZRange):s.b.OrthoOffCenterRHToRef(this.orthoLeft??-z,this.orthoRight??z,this.orthoBottom??-j,this.orthoTop??j,v?this.maxZ:this.Yi,v?this.Yi:this.maxZ,this._projectionMatrix,a.isNDCHalfZRange):this.oblique?s.b.ObliqueOffCenterLHToRef(this.orthoLeft??-z,this.orthoRight??z,this.orthoBottom??-j,this.orthoTop??j,v?this.maxZ:this.Yi,v?this.Yi:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,a.isNDCHalfZRange):s.b.OrthoOffCenterLHToRef(this.orthoLeft??-z,this.orthoRight??z,this.orthoBottom??-j,this.orthoTop??j,v?this.maxZ:this.Yi,v?this.Yi:this.maxZ,this._projectionMatrix,a.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(T=this.oblique)||void 0===T?void 0:T.angle,this._cache.obliqueLength=null===(m=this.oblique)||void 0===m?void 0:m.length,this._cache.obliqueOffset=null===(p=this.oblique)||void 0===p?void 0:p.offset,this._cache.renderWidth=a.getRenderWidth(),this._cache.renderHeight=a.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(z){return(this.radius||(this.target?s.o.Distance(this.position,this.target):this.position.length()))+z}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?l.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=l.b.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),a&&this.rigCameras.length>0){let a=!1;return this.rigCameras.forEach((K=>{K._updateFrustumPlanes(),a=a||z.isInFrustum(K._frustumPlanes)})),a}return z.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(z){return this._updateFrustumPlanes(),z.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,F.b)("Ray")}getForwardRayToRef(z){throw(0,F.b)("Ray")}dispose(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const z=this._rigCameras.pop();z&&z.dispose()}if(this._parentContainer){const z=this._parentContainer.cameras.indexOf(this);z>-1&&this._parentContainer.cameras.splice(z,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==c.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let z=this._postProcesses.length;for(;--z>=0;){const a=this._postProcesses[z];a&&a.dispose(this)}}let K=this.customRenderTargets.length;for(;--K>=0;)this.customRenderTargets[K].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(z,a)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(z,a){if(this.cameraRigMode!==z){for(;this._rigCameras.length>0;){const z=this._rigCameras.pop();z&&z.dispose()}if(this.cameraRigMode=z,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=a.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=p.h.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==c.RIG_MODE_NONE){const z=this.createRigCamera(this.name+"_L",0);z&&(z._isLeftCamera=!0);const a=this.createRigCamera(this.name+"_R",1);a&&(a._isRightCamera=!0),z&&a&&(this._rigCameras.push(z),this._rigCameras.push(a))}this._setRigMode(a),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(z){}_getVRProjectionMatrix(){return s.b.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Yi,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(z,a){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[z]=a,"interaxialDistance"===z&&(this._cameraRigParams.stereoHalfAngle=p.h.ToRadians(a/.0637))}createRigCamera(z,a){return null}_updateRigCameras(){for(let z=0;z<this._rigCameras.length;z++)this._rigCameras[z].Yi=this.Yi,this._rigCameras[z].maxZ=this.maxZ,this._rigCameras[z].fov=this.fov,this._rigCameras[z].upVector.p(this.upVector);this.cameraRigMode===c.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const z=V.e.Serialize(this);return z.uniqueId=this.uniqueId,z.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(z),this.inputs&&this.inputs.serialize(z),V.e.AppendSerializedAnimations(this,z),z.ranges=this.serializeAnimationRanges(),z.isEnabled=this.isEnabled(),z}clone(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=V.e.Clone(c.GetConstructorFromName(this.getClassName(),z,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return K.name=z,K.parent=a,this.onClonedObservable.notifyObservers(K),K}Re(z){const a=s.o.Zero();return this.getDirectionToRef(z,a),a}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(z,a){s.o.TransformNormalToRef(z,this.getWorldMatrix(),a)}static GetConstructorFromName(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,T=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const m=M.c.Construct(z,a,K,{interaxial_distance:v,isStereoscopicSideBySide:T});return m||(()=>c._CreateDefaultParsedCamera(a,K))}Qj(){return this.getWorldMatrix()}static Parse(z,a){const K=z.type,v=c.GetConstructorFromName(K,z.name,a,z.interaxial_distance,z.isStereoscopicSideBySide),T=V.e.Parse(v,z,a);if(void 0!==z.parentId&&(T._waitingParentId=z.parentId),void 0!==z.parentInstanceIndex&&(T._waitingParentInstanceIndex=z.parentInstanceIndex),T.inputs&&(T.inputs.parse(z),T._setupInputs()),z.upVector&&(T.upVector=s.o.Jg(z.upVector)),T.setPosition&&(T.position.Xd(0,0,0),T.setPosition(s.o.Jg(z.position))),z.target&&T.setTarget&&T.setTarget(s.o.Jg(z.target)),z.cameraRigMode){const a=z.interaxial_distance?{interaxialDistance:z.interaxial_distance}:{};T.setCameraRigMode(z.cameraRigMode,a)}if(z.animations){for(let a=0;a<z.animations.length;a++){const K=z.animations[a],v=(0,W.c)("BABYLON.Animation");v&&T.animations.push(v.Parse(K))}M.c.ParseAnimationRanges(T,z,a)}return z.autoAnimate&&a.beginAnimation(T,z.autoAnimateFrom,z.autoAnimateTo,z.autoAnimateLoop,z.autoAnimateSpeed||1),void 0!==z.isEnabled&&T.Nb(z.isEnabled),T}_calculateHandednessMultiplier(){let z=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(z*=-1),z}}c._CreateDefaultParsedCamera=(z,a)=>{throw(0,F.b)("UniversalCamera")},c.PERSPECTIVE_CAMERA=0,c.ORTHOGRAPHIC_CAMERA=1,c.FOVMODE_VERTICAL_FIXED=0,c.FOVMODE_HORIZONTAL_FIXED=1,c.RIG_MODE_NONE=0,c.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,c.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,c.RIG_MODE_STEREOSCOPIC_INTERLACED=14,c.RIG_MODE_VR=20,c.RIG_MODE_CUSTOM=22,c.ForceAttachControlToAlwaysPreventDefault=!1,(0,v.e)([(0,T.B)("position")],c.prototype,"_position",void 0),(0,v.e)([(0,T.B)("upVector")],c.prototype,"_upVector",void 0),(0,v.e)([(0,T.D)()],c.prototype,"orthoLeft",null),(0,v.e)([(0,T.D)()],c.prototype,"orthoRight",null),(0,v.e)([(0,T.D)()],c.prototype,"orthoBottom",null),(0,v.e)([(0,T.D)()],c.prototype,"orthoTop",null),(0,v.e)([(0,T.D)()],c.prototype,"fov",void 0),(0,v.e)([(0,T.D)()],c.prototype,"projectionPlaneTilt",void 0),(0,v.e)([(0,T.D)()],c.prototype,"Yi",void 0),(0,v.e)([(0,T.D)()],c.prototype,"maxZ",void 0),(0,v.e)([(0,T.D)()],c.prototype,"inertia",void 0),(0,v.e)([(0,T.D)()],c.prototype,"mode",null),(0,v.e)([(0,T.D)()],c.prototype,"layerMask",void 0),(0,v.e)([(0,T.D)()],c.prototype,"fovMode",void 0),(0,v.e)([(0,T.D)()],c.prototype,"cameraRigMode",void 0),(0,v.e)([(0,T.D)()],c.prototype,"interaxialDistance",void 0),(0,v.e)([(0,T.D)()],c.prototype,"isStereoscopicSideBySide",void 0)},11889:(z,a,K)=>{"use strict";K.d(a,{c:()=>p,g:()=>j});var v=K(10648),T=K(10973),m=K(11207),p={};class j{constructor(z){this.attachedToElement=!1,this.attached={},this.camera=z,this.checkInputs=()=>{}}add(z){const a=z.getSimpleName();this.attached[a]?v.c.Warn("camera input of type "+a+" already exists on camera"):(this.attached[a]=z,z.camera=this.camera,z.checkInputs&&(this.checkInputs=this._addCheckInputs(z.checkInputs.bind(z))),this.attachedToElement&&z.attachControl(this.noPreventDefault))}remove(z){for(const a in this.attached){const K=this.attached[a];if(K===z)return K.Ui(),K.camera=null,delete this.attached[a],void this.rebuildInputCheck()}}removeByType(z){for(const a in this.attached){const K=this.attached[a];K.getClassName()===z&&(K.Ui(),K.camera=null,delete this.attached[a],this.rebuildInputCheck())}}_addCheckInputs(z){const a=this.checkInputs;return()=>{a(),z()}}attachInput(z){this.attachedToElement&&z.attachControl(this.noPreventDefault)}attachElement(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){z=!m.d.ForceAttachControlToAlwaysPreventDefault&&z,this.attachedToElement=!0,this.noPreventDefault=z;for(const a in this.attached)this.attached[a].attachControl(z)}}detachElement(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const a in this.attached)this.attached[a].Ui(),z&&(this.attached[a].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const z in this.attached){const a=this.attached[z];a.checkInputs&&(this.checkInputs=this._addCheckInputs(a.checkInputs.bind(a)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(z){const a={};for(const K in this.attached){const z=this.attached[K],v=T.e.Serialize(z);a[z.getClassName()]=v}z.inputsmgr=a}parse(z){const a=z.inputsmgr;if(a){this.clear();for(const z in a){const K=p[z];if(K){const v=a[z],m=T.e.Parse((()=>new K),v,null);this.add(m)}}}else for(const K in this.attached){const a=p[this.attached[K].getClassName()];if(a){const v=T.e.Parse((()=>new a),z,null);this.remove(this.attached[K]),this.add(v)}}}}},11880:(z,a,K)=>{"use strict";K.d(a,{b:()=>I});var v=K(10923),T=K(10927),m=K(10941),p=K(11882),j=K(11889),s=K(11026),M=K(10631);class r{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(z){z=M.h.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((a=>{const K=a.event;if(!K.metaKey)if(a.type===s.c.KEYDOWN){if(-1!==this.keysUp.indexOf(K.keyCode)||-1!==this.keysDown.indexOf(K.keyCode)||-1!==this.keysLeft.indexOf(K.keyCode)||-1!==this.keysRight.indexOf(K.keyCode)||-1!==this.keysUpward.indexOf(K.keyCode)||-1!==this.keysDownward.indexOf(K.keyCode)||-1!==this.keysRotateLeft.indexOf(K.keyCode)||-1!==this.keysRotateRight.indexOf(K.keyCode)||-1!==this.keysRotateUp.indexOf(K.keyCode)||-1!==this.keysRotateDown.indexOf(K.keyCode)){-1===this._keys.indexOf(K.keyCode)&&this._keys.push(K.keyCode),z||K.preventDefault()}}else if(-1!==this.keysUp.indexOf(K.keyCode)||-1!==this.keysDown.indexOf(K.keyCode)||-1!==this.keysLeft.indexOf(K.keyCode)||-1!==this.keysRight.indexOf(K.keyCode)||-1!==this.keysUpward.indexOf(K.keyCode)||-1!==this.keysDownward.indexOf(K.keyCode)||-1!==this.keysRotateLeft.indexOf(K.keyCode)||-1!==this.keysRotateRight.indexOf(K.keyCode)||-1!==this.keysRotateUp.indexOf(K.keyCode)||-1!==this.keysRotateDown.indexOf(K.keyCode)){const a=this._keys.indexOf(K.keyCode);a>=0&&this._keys.splice(a,1),z||K.preventDefault()}})))}Ui(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const z=this.camera;for(let a=0;a<this._keys.length;a++){const K=this._keys[a],v=z._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(K)?z._localDirection.Xd(-v,0,0):-1!==this.keysUp.indexOf(K)?z._localDirection.Xd(0,0,v):-1!==this.keysRight.indexOf(K)?z._localDirection.Xd(v,0,0):-1!==this.keysDown.indexOf(K)?z._localDirection.Xd(0,0,-v):-1!==this.keysUpward.indexOf(K)?z._localDirection.Xd(0,v,0):-1!==this.keysDownward.indexOf(K)?z._localDirection.Xd(0,-v,0):-1!==this.keysRotateLeft.indexOf(K)?(z._localDirection.Xd(0,0,0),z.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(K)?(z._localDirection.Xd(0,0,0),z.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(K)?(z._localDirection.Xd(0,0,0),z.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(K)&&(z._localDirection.Xd(0,0,0),z.cameraRotation.x+=this._getLocalRotation()),z.va().useRightHandedSystem&&(z._localDirection.z*=-1),z.getViewMatrix().invertToRef(z._cameraTransformMatrix),m.o.TransformNormalToRef(z._localDirection,z._cameraTransformMatrix,z._transformedDirection),z.cameraDirection.addInPlace(z._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const z=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*z}}(0,v.e)([(0,T.D)()],r.prototype,"keysUp",void 0),(0,v.e)([(0,T.D)()],r.prototype,"keysUpward",void 0),(0,v.e)([(0,T.D)()],r.prototype,"keysDown",void 0),(0,v.e)([(0,T.D)()],r.prototype,"keysDownward",void 0),(0,v.e)([(0,T.D)()],r.prototype,"keysLeft",void 0),(0,v.e)([(0,T.D)()],r.prototype,"keysRight",void 0),(0,v.e)([(0,T.D)()],r.prototype,"rotationSpeed",void 0),(0,v.e)([(0,T.D)()],r.prototype,"keysRotateLeft",void 0),(0,v.e)([(0,T.D)()],r.prototype,"keysRotateRight",void 0),(0,v.e)([(0,T.D)()],r.prototype,"keysRotateUp",void 0),(0,v.e)([(0,T.D)()],r.prototype,"keysRotateDown",void 0),j.c.FreeCameraKeyboardMoveInput=r;var W=K(10638),F=K(11022);class G{constructor(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=z,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new W.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(z){z=M.h.BackCompatCameraNoPreventDefault(arguments);const a=this.camera.getEngine(),K=a.getInputElement();this._pointerInput||(this._pointerInput=v=>{const T=v.event,m="touch"===T.pointerType;if(!this.touchEnabled&&m)return;if(v.type!==F.e.POINTERMOVE&&-1===this.buttons.indexOf(T.button))return;const p=T.target;if(v.type===F.e.POINTERDOWN){if(m&&-1!==this._activePointerId||!m&&-1!==this._currentActiveButton)return;this._activePointerId=T.pointerId;try{null===p||void 0===p||p.setPointerCapture(T.pointerId)}catch(j){}-1===this._currentActiveButton&&(this._currentActiveButton=T.button),this._previousPosition={x:T.clientX,y:T.clientY},z||(T.preventDefault(),K&&K.focus()),a.isPointerLock&&this._onMouseMove&&this._onMouseMove(v.event)}else if(v.type===F.e.POINTERUP){if(m&&this._activePointerId!==T.pointerId||!m&&this._currentActiveButton!==T.button)return;try{null===p||void 0===p||p.releasePointerCapture(T.pointerId)}catch(j){}this._currentActiveButton=-1,this._previousPosition=null,z||T.preventDefault(),this._activePointerId=-1}else if(v.type===F.e.POINTERMOVE&&(this._activePointerId===T.pointerId||!m))if(a.isPointerLock&&this._onMouseMove)this._onMouseMove(v.event);else if(this._previousPosition){const a=this.camera._calculateHandednessMultiplier(),K=(T.clientX-this._previousPosition.x)*a,v=T.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=K/this.angularSensibility,this.camera.cameraRotation.x+=v/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:K,offsetY:v}),this._previousPosition={x:T.clientX,y:T.clientY},z||T.preventDefault()}}),this._onMouseMove=K=>{if(!a.isPointerLock)return;const v=this.camera._calculateHandednessMultiplier(),T=K.movementX*v;this.camera.cameraRotation.y+=T/this.angularSensibility;const m=K.movementY;this.camera.cameraRotation.x+=m/this.angularSensibility,this._previousPosition=null,z||K.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,F.e.POINTERDOWN|F.e.POINTERUP|F.e.POINTERMOVE),K&&(this._contextMenuBind=z=>this.onContextMenu(z),K.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(z){z.preventDefault()}Ui(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const z=this.camera.getEngine().getInputElement();z&&z.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,v.e)([(0,T.D)()],G.prototype,"buttons",void 0),(0,v.e)([(0,T.D)()],G.prototype,"angularSensibility",void 0),j.c.FreeCameraMouseInput=G;var l,V=K(11029);class c{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new W.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(z){z=M.h.BackCompatCameraNoPreventDefault(arguments),this._wheel=a=>{if(a.type!==F.e.POINTERWHEEL)return;const K=a.event,v=K.deltaMode===V.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*v*K.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*v*K.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*v*K.deltaZ/this._normalize,K.preventDefault&&(z||K.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,F.e.POINTERWHEEL)}Ui(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,v.e)([(0,T.D)()],c.prototype,"wheelPrecisionX",void 0),(0,v.e)([(0,T.D)()],c.prototype,"wheelPrecisionY",void 0),(0,v.e)([(0,T.D)()],c.prototype,"wheelPrecisionZ",void 0),function(z){z[z.MoveRelative=0]="MoveRelative",z[z.RotateRelative=1]="RotateRelative",z[z.MoveScene=2]="MoveScene"}(l||(l={}));class C extends c{constructor(){super(...arguments),this._moveRelative=m.o.Zero(),this._rotateRelative=m.o.Zero(),this._moveScene=m.o.Zero(),this._wheelXAction=l.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=l.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(z){null===z&&this._wheelXAction!==l.MoveRelative||(this._wheelXAction=l.MoveRelative,this._wheelXActionCoordinate=z)}get wheelXMoveRelative(){return this._wheelXAction!==l.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(z){null===z&&this._wheelYAction!==l.MoveRelative||(this._wheelYAction=l.MoveRelative,this._wheelYActionCoordinate=z)}get wheelYMoveRelative(){return this._wheelYAction!==l.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(z){null===z&&this._wheelZAction!==l.MoveRelative||(this._wheelZAction=l.MoveRelative,this._wheelZActionCoordinate=z)}get wheelZMoveRelative(){return this._wheelZAction!==l.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(z){null===z&&this._wheelXAction!==l.RotateRelative||(this._wheelXAction=l.RotateRelative,this._wheelXActionCoordinate=z)}get wheelXRotateRelative(){return this._wheelXAction!==l.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(z){null===z&&this._wheelYAction!==l.RotateRelative||(this._wheelYAction=l.RotateRelative,this._wheelYActionCoordinate=z)}get wheelYRotateRelative(){return this._wheelYAction!==l.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(z){null===z&&this._wheelZAction!==l.RotateRelative||(this._wheelZAction=l.RotateRelative,this._wheelZActionCoordinate=z)}get wheelZRotateRelative(){return this._wheelZAction!==l.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(z){null===z&&this._wheelXAction!==l.MoveScene||(this._wheelXAction=l.MoveScene,this._wheelXActionCoordinate=z)}get wheelXMoveScene(){return this._wheelXAction!==l.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(z){null===z&&this._wheelYAction!==l.MoveScene||(this._wheelYAction=l.MoveScene,this._wheelYActionCoordinate=z)}get wheelYMoveScene(){return this._wheelYAction!==l.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(z){null===z&&this._wheelZAction!==l.MoveScene||(this._wheelZAction=l.MoveScene,this._wheelZActionCoordinate=z)}get wheelZMoveScene(){return this._wheelZAction!==l.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Vd(0),this._rotateRelative.Vd(0),this._moveScene.Vd(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const z=m.b.Zero();this.camera.getViewMatrix().invertToRef(z);const a=m.o.Zero();m.o.TransformNormalToRef(this._moveRelative,z,a),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(a),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(z,a,K){if(0===z)return;if(null===a||null===K)return;let v=null;switch(a){case l.MoveRelative:v=this._moveRelative;break;case l.RotateRelative:v=this._rotateRelative;break;case l.MoveScene:v=this._moveScene}switch(K){case 0:v.set(z,0,0);break;case 1:v.set(0,z,0);break;case 2:v.set(0,0,z)}}}(0,v.e)([(0,T.D)()],C.prototype,"wheelXMoveRelative",null),(0,v.e)([(0,T.D)()],C.prototype,"wheelYMoveRelative",null),(0,v.e)([(0,T.D)()],C.prototype,"wheelZMoveRelative",null),(0,v.e)([(0,T.D)()],C.prototype,"wheelXRotateRelative",null),(0,v.e)([(0,T.D)()],C.prototype,"wheelYRotateRelative",null),(0,v.e)([(0,T.D)()],C.prototype,"wheelZRotateRelative",null),(0,v.e)([(0,T.D)()],C.prototype,"wheelXMoveScene",null),(0,v.e)([(0,T.D)()],C.prototype,"wheelYMoveScene",null),(0,v.e)([(0,T.D)()],C.prototype,"wheelZMoveScene",null),j.c.FreeCameraMouseWheelInput=C;class w{constructor(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=z,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=M.h.IsSafari()}attachControl(z){z=M.h.BackCompatCameraNoPreventDefault(arguments);let a=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=K=>{const v=K.event,T="mouse"===v.pointerType||this._isSafari&&"undefined"===typeof v.pointerType;if(this.allowMouse||!T)if(K.type===F.e.POINTERDOWN){if(z||v.preventDefault(),this._pointerPressed.push(v.pointerId),1!==this._pointerPressed.length)return;a={x:v.clientX,y:v.clientY}}else if(K.type===F.e.POINTERUP){z||v.preventDefault();const K=this._pointerPressed.indexOf(v.pointerId);if(-1===K)return;if(this._pointerPressed.splice(K,1),0!=K)return;a=null,this._offsetX=null,this._offsetY=null}else if(K.type===F.e.POINTERMOVE){if(z||v.preventDefault(),!a)return;if(0!=this._pointerPressed.indexOf(v.pointerId))return;this._offsetX=v.clientX-a.x,this._offsetY=-(v.clientY-a.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,F.e.POINTERDOWN|F.e.POINTERUP|F.e.POINTERMOVE),this._onLostFocus){const z=this.camera.getEngine().getInputElement();z&&z.addEventListener("blur",this._onLostFocus)}}Ui(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const z=this.camera.getEngine().getInputElement();z&&z.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const z=this.camera,a=z._calculateHandednessMultiplier();z.cameraRotation.y=a*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)z.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const a=z._computeLocalCameraSpeed(),K=new m.o(0,0,0!==this.touchMoveSensibility?a*this._offsetY/this.touchMoveSensibility:0);m.b.RotationYawPitchRollToRef(z.rotation.y,z.rotation.x,0,z._cameraRotationMatrix),z.cameraDirection.addInPlace(m.o.TransformCoordinates(K,z._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,v.e)([(0,T.D)()],w.prototype,"touchAngularSensibility",void 0),(0,v.e)([(0,T.D)()],w.prototype,"touchMoveSensibility",void 0),j.c.FreeCameraTouchInput=w;class H extends j.g{constructor(z){super(z),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new r),this}addMouse(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new G(z),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new C,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new w),this}clear(){super.clear(),this._mouseInput=null}}var f=K(10767),Y=K(10715);class I extends p.c{get angularSensibility(){const z=this.inputs.attached.mouse;return z?z.angularSensibility:0}set angularSensibility(z){const a=this.inputs.attached.mouse;a&&(a.angularSensibility=z)}get keysUp(){const z=this.inputs.attached.keyboard;return z?z.keysUp:[]}set keysUp(z){const a=this.inputs.attached.keyboard;a&&(a.keysUp=z)}get keysUpward(){const z=this.inputs.attached.keyboard;return z?z.keysUpward:[]}set keysUpward(z){const a=this.inputs.attached.keyboard;a&&(a.keysUpward=z)}get keysDown(){const z=this.inputs.attached.keyboard;return z?z.keysDown:[]}set keysDown(z){const a=this.inputs.attached.keyboard;a&&(a.keysDown=z)}get keysDownward(){const z=this.inputs.attached.keyboard;return z?z.keysDownward:[]}set keysDownward(z){const a=this.inputs.attached.keyboard;a&&(a.keysDownward=z)}get keysLeft(){const z=this.inputs.attached.keyboard;return z?z.keysLeft:[]}set keysLeft(z){const a=this.inputs.attached.keyboard;a&&(a.keysLeft=z)}get keysRight(){const z=this.inputs.attached.keyboard;return z?z.keysRight:[]}set keysRight(z){const a=this.inputs.attached.keyboard;a&&(a.keysRight=z)}get keysRotateLeft(){const z=this.inputs.attached.keyboard;return z?z.keysRotateLeft:[]}set keysRotateLeft(z){const a=this.inputs.attached.keyboard;a&&(a.keysRotateLeft=z)}get keysRotateRight(){const z=this.inputs.attached.keyboard;return z?z.keysRotateRight:[]}set keysRotateRight(z){const a=this.inputs.attached.keyboard;a&&(a.keysRotateRight=z)}get keysRotateUp(){const z=this.inputs.attached.keyboard;return z?z.keysRotateUp:[]}set keysRotateUp(z){const a=this.inputs.attached.keyboard;a&&(a.keysRotateUp=z)}get keysRotateDown(){const z=this.inputs.attached.keyboard;return z?z.keysRotateDown:[]}set keysRotateDown(z){const a=this.inputs.attached.keyboard;a&&(a.keysRotateDown=z)}constructor(z,a,K){var v;super(z,a,K,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),v=this,this.ellipsoid=new m.o(.5,1,.5),this.ellipsoidOffset=new m.o(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=m.o.Zero(),this._diffPosition=m.o.Zero(),this._newPosition=m.o.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;v._newPosition.p(a),v._newPosition.subtractToRef(v._oldPosition,v._diffPosition),v._diffPosition.length()>Y.b.CollisionsEpsilon&&(v.position.addToRef(v._diffPosition,v._deferredPositionUpdate),v._deferOnly?v._deferredUpdated=!0:v.position.p(v._deferredPositionUpdate),v.Kk&&K&&v.Kk(K))},this.inputs=new H(this),this.inputs.addKeyboard().addMouse()}attachControl(z,a){a=M.h.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(a)}Ui(){this.inputs.detachElement(),this.cameraDirection=new m.o(0,0,0),this.cameraRotation=new m.m(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(z){this._collisionMask=isNaN(z)?-1:z}_collideWithWorld(z){let a;a=this.parent?m.o.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,a.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const K=this.va().collisionCoordinator;this._collider||(this._collider=K.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let v=z;this.applyGravity&&(v=z.add(this.va().gravity)),K.getNewPosition(this._oldPosition,v,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=m.o.Zero(),this._transformedDirection=m.o.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(z){this._needMoveForGravity=z}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"mb"}}(0,v.e)([(0,T.B)()],I.prototype,"ellipsoid",void 0),(0,v.e)([(0,T.B)()],I.prototype,"ellipsoidOffset",void 0),(0,v.e)([(0,T.D)()],I.prototype,"checkCollisions",void 0),(0,v.e)([(0,T.D)()],I.prototype,"applyGravity",void 0),(0,f.e)("BABYLON.FreeCamera",I)},11882:(z,a,K)=>{"use strict";K.d(a,{c:()=>M});var v=K(10923),T=K(10927),m=K(11207),p=K(10941),j=K(10946),s=K(11256);K(11215).c.AddNodeConstructor("TargetCamera",((z,a)=>()=>new M(z,p.o.Zero(),a)));class M extends m.d{constructor(z,a,K){super(z,a,K,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=p.o.Zero(),this._tmpTargetVector=p.o.Zero(),this.cameraDirection=new p.o(0,0,0),this.cameraRotation=new p.m(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new p.f,this.rotation=new p.o(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=p.o.Zero(),this._initialFocalDistance=1,this._viewMatrix=p.b.Zero(),this._camMatrix=p.b.Zero(),this._cameraTransformMatrix=p.b.Zero(),this._cameraRotationMatrix=p.b.Zero(),this._referencePoint=new p.o(0,0,1),this._transformedReferencePoint=p.o.Zero(),this._deferredPositionUpdate=new p.o,this._deferredRotationQuaternionUpdate=new p.f,this._deferredRotationUpdate=new p.o,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=p.o.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(z){this.getWorldMatrix();const a=this.getTarget().sc(this.position);return a.normalize(),a.scaleInPlace(z),this.globalPosition.add(a)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const z=this.lockedTarget;z.Qj().getTranslationToRef(z.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Xd(0,0,0),this.cameraRotation.Xd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new p.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new p.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new p.f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(z){z||super._updateCache();const a=this._getLockedTargetPosition();a?this._cache.lockedTarget?this._cache.lockedTarget.p(a):this._cache.lockedTarget=a.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const z=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(z):!z)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const z=this.getEngine();return this.speed*Math.sqrt(z.getDeltaTime()/(100*z.getFps()))}setTarget(z){this.upVector.normalize(),this._initialFocalDistance=z.sc(this.position).length(),this.position.z===z.z&&(this.position.z+=j.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),p.b.LookAtLHToRef(this.position,z,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const a=z.sc(this.position);a.x>=0?this.rotation.y=-Math.atan(a.z/a.x)+Math.PI/2:this.rotation.y=-Math.atan(a.z/a.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&p.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(z){this.setTarget(z)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(p.j.Matrix[0]),p.o.TransformNormalToRef(this.cameraDirection,p.j.Matrix[0],p.j.gb[0]),this._deferredPositionUpdate.addInPlace(p.j.gb[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const z=this.invertRotation?-this.inverseRotationSpeed:1,a=this._decideIfNeedsToMove(),K=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),a&&this._updatePosition(),K){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*z,this._deferredRotationUpdate.y+=this.cameraRotation.y*z,!this.noRotationConstraint){const z=1.570796;this._deferredRotationUpdate.x>z&&(this._deferredRotationUpdate.x=z),this._deferredRotationUpdate.x<-z&&(this._deferredRotationUpdate.x=-z)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(p.f.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}a&&(Math.abs(this.cameraDirection.x)<this.speed*j.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*j.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*j.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),K&&(Math.abs(this.cameraRotation.x)<this.speed*j.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*j.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):p.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return p.o.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),p.o.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?s.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(p.f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),s.c.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(z,a,K){if(this.ignoreParentScaling){if(this.parent){const v=this.parent.getWorldMatrix();p.o.TransformCoordinatesToRef(z,v,this._globalPosition),p.o.TransformCoordinatesToRef(a,v,this._tmpTargetVector),p.o.TransformNormalToRef(K,v,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(z),this._tmpTargetVector.p(a),this._tmpUpVector.p(K);this.va().useRightHandedSystem?p.b.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):p.b.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?p.b.LookAtRHToRef(z,a,K,this._viewMatrix):p.b.LookAtLHToRef(z,a,K,this._viewMatrix),this.parent){const z=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(z,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(z)}createRigCamera(z,a){if(this.cameraRigMode!==m.d.RIG_MODE_NONE){const a=new M(z,this.position.clone(),this.va());return a.isRigCamera=!0,a.rigParent=this,this.cameraRigMode===m.d.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new p.f),a._cameraRigParams={},a.rotationQuaternion=new p.f),a.mode=this.mode,a.orthoLeft=this.orthoLeft,a.orthoRight=this.orthoRight,a.orthoTop=this.orthoTop,a.orthoBottom=this.orthoBottom,a}return null}_updateRigCameras(){const z=this._rigCameras[0],a=this._rigCameras[1];switch(this.Qj(),this.cameraRigMode){case m.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case m.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case m.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case m.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case m.d.RIG_MODE_STEREOSCOPIC_INTERLACED:{const K=this.cameraRigMode===m.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,v=this.cameraRigMode===m.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*K,z),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*v,a);break}case m.d.RIG_MODE_VR:z.rotationQuaternion?(z.rotationQuaternion.p(this.rotationQuaternion),a.rotationQuaternion.p(this.rotationQuaternion)):(z.rotation.p(this.rotation),a.rotation.p(this.rotation)),z.position.p(this.position),a.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(z,a){this.getTarget().subtractToRef(this.position,M._TargetFocalPoint),M._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const K=M._TargetFocalPoint.addInPlace(this.position);p.b.TranslationToRef(-K.x,-K.y,-K.z,M._TargetTransformMatrix),M._TargetTransformMatrix.multiplyToRef(p.b.RotationAxis(a.upVector,z),M._RigCamTransformMatrix),p.b.TranslationToRef(K.x,K.y,K.z,M._TargetTransformMatrix),M._RigCamTransformMatrix.multiplyToRef(M._TargetTransformMatrix,M._RigCamTransformMatrix),p.o.TransformCoordinatesToRef(this.position,M._RigCamTransformMatrix,a.position),a.setTarget(K)}getClassName(){return"TargetCamera"}}M._RigCamTransformMatrix=new p.b,M._TargetTransformMatrix=new p.b,M._TargetFocalPoint=new p.o,(0,v.e)([(0,T.B)()],M.prototype,"rotation",void 0),(0,v.e)([(0,T.D)()],M.prototype,"speed",void 0),(0,v.e)([(0,T.p)("lockedTargetId")],M.prototype,"lockedTarget",void 0)},11068:(z,a,K)=>{"use strict";K.d(a,{c:()=>v});class v{constructor(z,a,K){this.bu=z,this.bv=a,this.distance=K,this.faceId=0,this.subMeshId=0}}},10995:(z,a,K)=>{"use strict";K.d(a,{d:()=>m});var v=K(10941),T=K(11001);class m{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var z;let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],K=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||K&&!this.pickedMesh.isVerticesDataPresent(T.h.NormalKind))return null;let m,p=this.pickedMesh.Rf();0===(null===(z=p)||void 0===z?void 0:z.length)&&(p=null);const j=v.j.gb[0],s=v.j.gb[1],M=v.j.gb[2];if(K){const z=this.pickedMesh.getVerticesData(T.h.NormalKind);let a=p?v.o.FromArrayToRef(z,3*p[3*this.faceId],j):j.Xd(z[3*this.faceId*3],z[3*this.faceId*3+1],z[3*this.faceId*3+2]),K=p?v.o.FromArrayToRef(z,3*p[3*this.faceId+1],s):s.Xd(z[3*(3*this.faceId+1)],z[3*(3*this.faceId+1)+1],z[3*(3*this.faceId+1)+2]),r=p?v.o.FromArrayToRef(z,3*p[3*this.faceId+2],M):M.Xd(z[3*(3*this.faceId+2)],z[3*(3*this.faceId+2)+1],z[3*(3*this.faceId+2)+2]);a=a.scale(this.bu),K=K.scale(this.bv),r=r.scale(1-this.bu-this.bv),m=new v.o(a.x+K.x+r.x,a.y+K.y+r.y,a.z+K.z+r.z)}else{const z=this.pickedMesh.getVerticesData(T.h.PositionKind),a=p?v.o.FromArrayToRef(z,3*p[3*this.faceId],j):j.Xd(z[3*this.faceId*3],z[3*this.faceId*3+1],z[3*this.faceId*3+2]),K=p?v.o.FromArrayToRef(z,3*p[3*this.faceId+1],s):s.Xd(z[3*(3*this.faceId+1)],z[3*(3*this.faceId+1)+1],z[3*(3*this.faceId+1)+2]),r=p?v.o.FromArrayToRef(z,3*p[3*this.faceId+2],M):M.Xd(z[3*(3*this.faceId+2)],z[3*(3*this.faceId+2)+1],z[3*(3*this.faceId+2)+2]),W=a.sc(K),F=r.sc(K);m=v.o.Cross(W,F)}const r=(z,a)=>{let K=z.getWorldMatrix();z.nonUniformScaling&&(v.j.Matrix[0].p(K),K=v.j.Matrix[0],K.setTranslationFromFloats(0,0,0),K.invert(),K.transposeToRef(v.j.Matrix[1]),K=v.j.Matrix[1]),v.o.TransformNormalToRef(a,K,a)};if(a&&r(this.pickedMesh,m),this.ray){const z=v.j.gb[0].p(m);a||r(this.pickedMesh,z),v.o.Dot(z,this.ray.direction)>0&&m.negateInPlace()}return m.normalize(),m}getTextureCoordinates(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.h.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(z))return null;const a=this.pickedMesh.Rf();if(!a)return null;const K=this.pickedMesh.getVerticesData(z);if(!K)return null;let m=v.m.Jg(K,2*a[3*this.faceId]),p=v.m.Jg(K,2*a[3*this.faceId+1]),j=v.m.Jg(K,2*a[3*this.faceId+2]);return m=m.scale(this.bu),p=p.scale(this.bv),j=j.scale(1-this.bu-this.bv),new v.m(m.x+p.x+j.x,m.y+p.y+j.y)}}},11161:(z,a,K)=>{"use strict";K.d(a,{d:()=>v});let v=!1},12412:(z,a,K)=>{"use strict";K.d(a,{d:()=>m});var v=K(10933),T=K(12414);class m{constructor(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=K,this.oi=[],this._maxBlockCapacity=a||64,this._selectionContent=new v.e(1024),this._creationFunc=z}update(z,a,K){T.e._CreateBlocks(z,a,K,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}mi(z){for(let a=0;a<this.nh.length;a++){this.nh[a].addEntry(z)}}Bc(z){for(let a=0;a<this.nh.length;a++){this.nh[a].removeEntry(z)}}select(z,a){this._selectionContent.reset();for(let K=0;K<this.nh.length;K++){this.nh[K].select(z,this._selectionContent,a)}return a?this._selectionContent.concat(this.oi):this._selectionContent.concatWithNoDuplicate(this.oi),this._selectionContent}intersects(z,a,K){this._selectionContent.reset();for(let v=0;v<this.nh.length;v++){this.nh[v].intersects(z,a,this._selectionContent,K)}return K?this._selectionContent.concat(this.oi):this._selectionContent.concatWithNoDuplicate(this.oi),this._selectionContent}intersectsRay(z){this._selectionContent.reset();for(let a=0;a<this.nh.length;a++){this.nh[a].intersectsRay(z,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.oi),this._selectionContent}}m.CreationFuncForMeshes=(z,a)=>{const K=z.getBoundingInfo();!z.isBlocked&&K.boundingBox.intersectsMinMax(a.si,a.ti)&&a.entries.push(z)},m.CreationFuncForSubMeshes=(z,a)=>{z.getBoundingInfo().boundingBox.intersectsMinMax(a.si,a.ti)&&a.entries.push(z)}},12414:(z,a,K)=>{"use strict";K.d(a,{e:()=>m});var v=K(10941),T=K(11086);class m{constructor(z,a,K,v,T,m){this.entries=[],this.ui=new Array,this._capacity=K,this._depth=v,this._maxDepth=T,this._creationFunc=m,this._minPoint=z,this._maxPoint=a,this.ui.push(z.clone()),this.ui.push(a.clone()),this.ui.push(z.clone()),this.ui[2].x=a.x,this.ui.push(z.clone()),this.ui[3].y=a.y,this.ui.push(z.clone()),this.ui[4].z=a.z,this.ui.push(a.clone()),this.ui[5].z=z.z,this.ui.push(a.clone()),this.ui[6].x=z.x,this.ui.push(a.clone()),this.ui[7].y=z.y}get lb(){return this._capacity}get si(){return this._minPoint}get ti(){return this._maxPoint}addEntry(z){if(this.nh)for(let a=0;a<this.nh.length;a++){this.nh[a].addEntry(z)}else this._creationFunc(z,this),this.entries.length>this.lb&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(z){if(this.nh){for(let a=0;a<this.nh.length;a++){this.nh[a].removeEntry(z)}return}const a=this.entries.indexOf(z);a>-1&&this.entries.splice(a,1)}addEntries(z){for(let a=0;a<z.length;a++){const K=z[a];this.addEntry(K)}}select(z,a,K){if(T.c.IsInFrustum(this.ui,z)){if(this.nh){for(let v=0;v<this.nh.length;v++){this.nh[v].select(z,a,K)}return}K?a.concat(this.entries):a.concatWithNoDuplicate(this.entries)}}intersects(z,a,K,v){if(T.c.IntersectsSphere(this._minPoint,this._maxPoint,z,a)){if(this.nh){for(let T=0;T<this.nh.length;T++){this.nh[T].intersects(z,a,K,v)}return}v?K.concat(this.entries):K.concatWithNoDuplicate(this.entries)}}intersectsRay(z,a){if(z.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.nh){for(let K=0;K<this.nh.length;K++){this.nh[K].intersectsRay(z,a)}return}a.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){m._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(z,a,K,T,p,j,s,M){s.nh=new Array;const r=new v.o((a.x-z.x)/2,(a.y-z.y)/2,(a.z-z.z)/2);for(let v=0;v<2;v++)for(let a=0;a<2;a++)for(let W=0;W<2;W++){const F=z.add(r.multiplyByFloats(v,a,W)),G=z.add(r.multiplyByFloats(v+1,a+1,W+1)),l=new m(F,G,T,p+1,j,M);l.addEntries(K),s.nh.push(l)}}}},12420:(z,a,K)=>{"use strict";K.d(a,{b:()=>r});var v=K(10935),T=K(10941),m=K(11249),p=K(11599),j=K(11019),s=K(12412),M=K(10680);v.c.prototype.createOrUpdateSelectionOctree=function(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,K=this._getComponent(j.b.NAME_OCTREE);K||(K=new r(this),this.o(K)),this.ki||(this.ki=new s.d(s.d.CreationFuncForMeshes,z,a));const v=this.getWorldExtends();return this.ki.update(v.min,v.max,this.meshes),this.ki},Object.defineProperty(v.c.prototype,"selectionOctree",{get:function(){return this.ki},enumerable:!0,configurable:!0}),m.e.prototype.createOrUpdateSubmeshesOctree=function(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const K=this.va();let v=K._getComponent(j.b.NAME_OCTREE);v||(v=new r(K),K.o(v)),this._submeshesOctree||(this._submeshesOctree=new s.d(s.d.CreationFuncForSubMeshes,z,a)),this.Qj(!0);const T=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(T.minimumWorld,T.maximumWorld,this.Vf),this._submeshesOctree};class r{constructor(z){this.name=j.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new p.d(T.o.Zero(),new T.o(1,1,1)),(z=z||M.b.LastCreatedScene)&&(this.Oc=z,this.Oc.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Oc.getActiveSubMeshCandidates=z=>this.getActiveSubMeshCandidates(z),this.Oc.getCollidingSubMeshCandidates=(z,a)=>this.getCollidingSubMeshCandidates(z,a),this.Oc.getIntersectingSubMeshCandidates=(z,a)=>this.getIntersectingSubMeshCandidates(z,a))}register(){this.Oc.onMeshRemovedObservable.add((z=>{const a=this.Oc.selectionOctree;if(void 0!==a&&null!==a){const K=a.oi.indexOf(z);-1!==K&&a.oi.splice(K,1)}})),this.Oc.onMeshImportedObservable.add((z=>{const a=this.Oc.selectionOctree;void 0!==a&&null!==a&&a.mi(z)}))}getActiveMeshCandidates(){var z;return(null===(z=this.Oc.ki)||void 0===z?void 0:z.select(this.Oc.frustumPlanes))||this.Oc._getDefaultMeshCandidates()}getActiveSubMeshCandidates(z){if(z._submeshesOctree&&z.useOctreeForRenderingSelection){return z._submeshesOctree.select(this.Oc.frustumPlanes)}return this.Oc._getDefaultSubMeshCandidates(z)}getIntersectingSubMeshCandidates(z,a){if(z._submeshesOctree&&z.useOctreeForPicking){p.d.TransformToRef(a,z.getWorldMatrix(),this._tempRay);return z._submeshesOctree.intersectsRay(this._tempRay)}return this.Oc._getDefaultSubMeshCandidates(z)}getCollidingSubMeshCandidates(z,a){if(z._submeshesOctree&&z.useOctreeForCollisions){const K=a._velocityWorldLength+Math.max(a._radius.x,a._radius.y,a._radius.z);return z._submeshesOctree.intersects(a._basePointWorld,K)}return this.Oc._getDefaultSubMeshCandidates(z)}rebuild(){}dispose(){}}},11086:(z,a,K)=>{"use strict";K.d(a,{c:()=>p});var v=K(10951),T=K(10941),m=K(10946);class p{constructor(z,a,K){this.vectors=(0,v.d)(8,T.o.Zero),this.center=T.o.Zero(),this.centerWorld=T.o.Zero(),this.extendSize=T.o.Zero(),this.extendSizeWorld=T.o.Zero(),this.directions=(0,v.d)(3,T.o.Zero),this.vectorsWorld=(0,v.d)(8,T.o.Zero),this.minimumWorld=T.o.Zero(),this.maximumWorld=T.o.Zero(),this.minimum=T.o.Zero(),this.maximum=T.o.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(z,a,K)}reConstruct(z,a,K){const v=z.x,m=z.y,p=z.z,j=a.x,s=a.y,M=a.z,r=this.vectors;this.minimum.Xd(v,m,p),this.maximum.Xd(j,s,M),r[0].Xd(v,m,p),r[1].Xd(j,s,M),r[2].Xd(j,m,p),r[3].Xd(v,s,p),r[4].Xd(v,m,M),r[5].Xd(j,s,p),r[6].Xd(v,s,M),r[7].Xd(j,m,M),a.addToRef(z,this.center).scaleInPlace(.5),a.subtractToRef(z,this.extendSize).scaleInPlace(.5),this._worldMatrix=K||T.b.IdentityReadOnly,this._update(this._worldMatrix)}scale(z){const a=p._TmpVector3,K=this.maximum.subtractToRef(this.minimum,a[0]),v=K.length();K.normalizeFromLength(v);const T=v*z,m=K.scaleInPlace(.5*T),j=this.center.subtractToRef(m,a[1]),s=this.center.addToRef(m,a[2]);return this.reConstruct(j,s,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(z){const a=this.minimumWorld,K=this.maximumWorld,v=this.directions,m=this.vectorsWorld,p=this.vectors;if(z.isIdentity()){a.p(this.minimum),K.p(this.maximum);for(let z=0;z<8;++z)m[z].p(p[z]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{a.Vd(Number.MAX_VALUE),K.Vd(-Number.MAX_VALUE);for(let v=0;v<8;++v){const j=m[v];T.o.TransformCoordinatesToRef(p[v],z,j),a.minimizeInPlace(j),K.maximizeInPlace(j)}K.subtractToRef(a,this.extendSizeWorld).scaleInPlace(.5),K.addToRef(a,this.centerWorld).scaleInPlace(.5)}T.o.FromArrayToRef(z.m,0,v[0]),T.o.FromArrayToRef(z.m,4,v[1]),T.o.FromArrayToRef(z.m,8,v[2]),this._worldMatrix=z}isInFrustum(z){return p.IsInFrustum(this.vectorsWorld,z)}isCompletelyInFrustum(z){return p.IsCompletelyInFrustum(this.vectorsWorld,z)}intersectsPoint(z){const a=this.minimumWorld,K=this.maximumWorld,v=a.x,T=a.y,p=a.z,j=K.x,s=K.y,M=K.z,r=z.x,W=z.y,F=z.z,G=-m.e;return!(j-r<G||G>r-v)&&(!(s-W<G||G>W-T)&&!(M-F<G||G>F-p))}intersectsSphere(z){return p.IntersectsSphere(this.minimumWorld,this.maximumWorld,z.centerWorld,z.radiusWorld)}intersectsMinMax(z,a){const K=this.minimumWorld,v=this.maximumWorld,T=K.x,m=K.y,p=K.z,j=v.x,s=v.y,M=v.z,r=z.x,W=z.y,F=z.z,G=a.x,l=a.y,V=a.z;return!(j<r||T>G)&&(!(s<W||m>l)&&!(M<F||p>V))}dispose(){var z,a;null===(z=this._drawWrapperFront)||void 0===z||z.dispose(),null===(a=this._drawWrapperBack)||void 0===a||a.dispose()}static Intersects(z,a){return z.intersectsMinMax(a.minimumWorld,a.maximumWorld)}static IntersectsSphere(z,a,K,v){const m=p._TmpVector3[0];T.o.ClampToRef(K,z,a,m);return T.o.DistanceSquared(K,m)<=v*v}static IsCompletelyInFrustum(z,a){for(let K=0;K<6;++K){const v=a[K];for(let a=0;a<8;++a)if(v.dotCoordinate(z[a])<0)return!1}return!0}static IsInFrustum(z,a){for(let K=0;K<6;++K){let v=!0;const T=a[K];for(let a=0;a<8;++a)if(T.dotCoordinate(z[a])>=0){v=!1;break}if(v)return!1}return!0}}p._TmpVector3=(0,v.d)(3,T.o.Zero)},11077:(z,a,K)=>{"use strict";K.d(a,{e:()=>W});var v=K(10951),T=K(10941),m=K(11086),p=K(11092);const j={min:0,max:0},s={min:0,max:0},M=(z,a,K)=>{const v=T.o.Dot(a.centerWorld,z),m=Math.abs(T.o.Dot(a.directions[0],z))*a.extendSize.x+Math.abs(T.o.Dot(a.directions[1],z))*a.extendSize.y+Math.abs(T.o.Dot(a.directions[2],z))*a.extendSize.z;K.min=v-m,K.max=v+m},r=(z,a,K)=>(M(z,a,j),M(z,K,s),!(j.min>s.max||s.min>j.max));class W{constructor(z,a,K){this._isLocked=!1,this.boundingBox=new m.c(z,a,K),this.boundingSphere=new p.c(z,a,K)}reConstruct(z,a,K){this.boundingBox.reConstruct(z,a,K),this.boundingSphere.reConstruct(z,a,K)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(z){this._isLocked=z}update(z){this._isLocked||(this.boundingBox._update(z),this.boundingSphere._update(z))}centerOn(z,a){const K=W._TmpVector3[0].p(z).ri(a),v=W._TmpVector3[1].p(z).addInPlace(a);return this.boundingBox.reConstruct(K,v,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(K,v,this.boundingBox.getWorldMatrix()),this}encapsulate(z){const a=T.o.Minimize(this.minimum,z),K=T.o.Maximize(this.maximum,z);return this.reConstruct(a,K,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(z){const a=T.j.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(a);const K=T.j.gb[0];return T.o.TransformCoordinatesToRef(z.boundingBox.minimumWorld,a,K),this.encapsulate(K),T.o.TransformCoordinatesToRef(z.boundingBox.maximumWorld,a,K),this.encapsulate(K),this}scale(z){return this.boundingBox.scale(z),this.boundingSphere.scale(z),this}isInFrustum(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===a||3===a)&&this.boundingSphere.isCenterInFrustum(z))return!0;if(!this.boundingSphere.isInFrustum(z))return!1;return!(1!==a&&3!==a)||this.boundingBox.isInFrustum(z)}get diagonalLength(){const z=this.boundingBox;return z.maximumWorld.subtractToRef(z.minimumWorld,W._TmpVector3[0]).length()}isCompletelyInFrustum(z){return this.boundingBox.isCompletelyInFrustum(z)}_checkCollision(z){return z._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(z){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(z)&&!!this.boundingBox.intersectsPoint(z))}intersects(z,a){if(!p.c.Intersects(this.boundingSphere,z.boundingSphere))return!1;if(!m.c.Intersects(this.boundingBox,z.boundingBox))return!1;if(!a)return!0;const K=this.boundingBox,v=z.boundingBox;return!!r(K.directions[0],K,v)&&(!!r(K.directions[1],K,v)&&(!!r(K.directions[2],K,v)&&(!!r(v.directions[0],K,v)&&(!!r(v.directions[1],K,v)&&(!!r(v.directions[2],K,v)&&(!!r(T.o.Cross(K.directions[0],v.directions[0]),K,v)&&(!!r(T.o.Cross(K.directions[0],v.directions[1]),K,v)&&(!!r(T.o.Cross(K.directions[0],v.directions[2]),K,v)&&(!!r(T.o.Cross(K.directions[1],v.directions[0]),K,v)&&(!!r(T.o.Cross(K.directions[1],v.directions[1]),K,v)&&(!!r(T.o.Cross(K.directions[1],v.directions[2]),K,v)&&(!!r(T.o.Cross(K.directions[2],v.directions[0]),K,v)&&(!!r(T.o.Cross(K.directions[2],v.directions[1]),K,v)&&!!r(T.o.Cross(K.directions[2],v.directions[2]),K,v))))))))))))))}}W._TmpVector3=(0,v.d)(2,T.o.Zero)},11092:(z,a,K)=>{"use strict";K.d(a,{c:()=>m});var v=K(10951),T=K(10941);class m{constructor(z,a,K){this.center=T.o.Zero(),this.centerWorld=T.o.Zero(),this.minimum=T.o.Zero(),this.maximum=T.o.Zero(),this.reConstruct(z,a,K)}reConstruct(z,a,K){this.minimum.p(z),this.maximum.p(a);const v=T.o.Distance(z,a);a.addToRef(z,this.center).scaleInPlace(.5),this.radius=.5*v,this._update(K||T.b.IdentityReadOnly)}scale(z){const a=this.radius*z,K=m._TmpVector3,v=K[0].Vd(a),T=this.center.subtractToRef(v,K[1]),p=this.center.addToRef(v,K[2]);return this.reConstruct(T,p,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(z){if(z.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.radius;else{T.o.TransformCoordinatesToRef(this.center,z,this.centerWorld);const a=m._TmpVector3[0];T.o.TransformNormalFromFloatsToRef(1,1,1,z,a),this.radiusWorld=Math.max(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z))*this.radius}}isInFrustum(z){const a=this.centerWorld,K=this.radiusWorld;for(let v=0;v<6;v++)if(z[v].dotCoordinate(a)<=-K)return!1;return!0}isCenterInFrustum(z){const a=this.centerWorld;for(let K=0;K<6;K++)if(z[K].dotCoordinate(a)<0)return!1;return!0}intersectsPoint(z){const a=T.o.DistanceSquared(this.centerWorld,z);return!(this.radiusWorld*this.radiusWorld<a)}static Intersects(z,a){const K=T.o.DistanceSquared(z.centerWorld,a.centerWorld),v=z.radiusWorld+a.radiusWorld;return!(v*v<K)}static CreateFromCenterAndRadius(z,a,K){this._TmpVector3[0].p(z),this._TmpVector3[1].Xd(0,0,a),this._TmpVector3[2].p(z),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].ri(this._TmpVector3[1]);const v=new m(this._TmpVector3[0],this._TmpVector3[2]);return v._worldMatrix=K||T.b.Identity(),v}}m._TmpVector3=(0,v.d)(3,T.o.Zero)},11599:(z,a,K)=>{"use strict";K.d(a,{d:()=>G});var v=K(10935),T=K(11207),m=K(10946),p=K(10941),j=K(10951),s=K(11068),M=K(10995),r=K(10680),W=K(11031);const F={internalPickerForMesh:void 0};class G{constructor(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m.e;this.origin=z,this.direction=a,this.length=K,this.epsilon=v}clone(){return new G(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const v=G._TmpVector3[0].Xd(z.x-K,z.y-K,z.z-K),T=G._TmpVector3[1].Xd(a.x+K,a.y+K,a.z+K);let m,p,j,s,M=0,r=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<v.x||this.origin.x>T.x)return!1}else if(m=1/this.direction.x,p=(v.x-this.origin.x)*m,j=(T.x-this.origin.x)*m,j===-1/0&&(j=1/0),p>j&&(s=p,p=j,j=s),M=Math.max(p,M),r=Math.min(j,r),M>r)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<v.y||this.origin.y>T.y)return!1}else if(m=1/this.direction.y,p=(v.y-this.origin.y)*m,j=(T.y-this.origin.y)*m,j===-1/0&&(j=1/0),p>j&&(s=p,p=j,j=s),M=Math.max(p,M),r=Math.min(j,r),M>r)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<v.z||this.origin.z>T.z)return!1}else if(m=1/this.direction.z,p=(v.z-this.origin.z)*m,j=(T.z-this.origin.z)*m,j===-1/0&&(j=1/0),p>j&&(s=p,p=j,j=s),M=Math.max(p,M),r=Math.min(j,r),M>r)return!1;return!0}intersectsBox(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(z.minimum,z.maximum,a)}intersectsSphere(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const K=z.center.x-this.origin.x,v=z.center.y-this.origin.y,T=z.center.z-this.origin.z,m=K*K+v*v+T*T,p=z.radius+a,j=p*p;if(m<=j)return!0;const s=K*this.direction.x+v*this.direction.y+T*this.direction.z;if(s<0)return!1;return m-s*s<=j}intersectsTriangle(z,a,K){const v=G._TmpVector3[0],T=G._TmpVector3[1],m=G._TmpVector3[2],j=G._TmpVector3[3],M=G._TmpVector3[4];a.subtractToRef(z,v),K.subtractToRef(z,T),p.o.CrossToRef(this.direction,T,m);const r=p.o.Dot(v,m);if(0===r)return null;const W=1/r;this.origin.subtractToRef(z,j);const F=p.o.Dot(j,m)*W;if(F<-this.epsilon||F>1+this.epsilon)return null;p.o.CrossToRef(j,v,M);const l=p.o.Dot(this.direction,M)*W;if(l<-this.epsilon||F+l>1+this.epsilon)return null;const V=p.o.Dot(T,M)*W;return V>this.length?null:new s.c(1-F-l,F,V)}intersectsPlane(z){let a;const K=p.o.Dot(z.k,this.direction);if(Math.abs(K)<9.99999997475243e-7)return null;{const v=p.o.Dot(z.k,this.origin);return a=(-z.d-v)/K,a<0?a<-9.99999997475243e-7?null:0:a}}intersectsAxis(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(z){case"y":{const z=(this.origin.y-a)/this.direction.y;return z>0?null:new p.o(this.origin.x+this.direction.x*-z,a,this.origin.z+this.direction.z*-z)}case"x":{const z=(this.origin.x-a)/this.direction.x;return z>0?null:new p.o(a,this.origin.y+this.direction.y*-z,this.origin.z+this.direction.z*-z)}case"z":{const z=(this.origin.z-a)/this.direction.z;return z>0?null:new p.o(this.origin.x+this.direction.x*-z,this.origin.y+this.direction.y*-z,a)}default:return null}}intersectsMesh(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const j=p.j.Matrix[0];return z.getWorldMatrix().invertToRef(j),this._tmpRay?G.TransformToRef(this,j,this._tmpRay):this._tmpRay=G.Transform(this,j),z.intersects(this._tmpRay,a,K,v,T,m)}intersectsMeshes(z,a,K){K?K.length=0:K=[];for(let v=0;v<z.length;v++){const T=this.intersectsMesh(z[v],a);T.hit&&K.push(T)}return K.sort(this._comparePickingInfo),K}_comparePickingInfo(z,a){return z.distance<a.distance?-1:z.distance>a.distance?1:0}intersectionSegment(z,a,K){const v=this.origin,T=p.j.gb[0],m=p.j.gb[1],j=p.j.gb[2],s=p.j.gb[3];a.subtractToRef(z,T),this.direction.scaleToRef(G._Rayl,j),v.addToRef(j,m),z.subtractToRef(v,s);const M=p.o.Dot(T,T),r=p.o.Dot(T,j),W=p.o.Dot(j,j),F=p.o.Dot(T,s),l=p.o.Dot(j,s),V=M*W-r*r;let c,C,w=V,H=V;V<G._Smallnum?(c=0,w=1,C=l,H=W):(c=r*l-W*F,C=M*l-r*F,c<0?(c=0,C=l,H=W):c>w&&(c=w,C=l+r,H=W)),C<0?(C=0,-F<0?c=0:-F>M?c=w:(c=-F,w=M)):C>H&&(C=H,-F+r<0?c=0:-F+r>M?c=w:(c=-F+r,w=M));const f=Math.abs(c)<G._Smallnum?0:c/w,Y=Math.abs(C)<G._Smallnum?0:C/H,I=p.j.gb[4];j.scaleToRef(Y,I);const q=p.j.gb[5];T.scaleToRef(f,q),q.addInPlace(s);const B=p.j.gb[6];q.subtractToRef(I,B);return Y>0&&Y<=this.length&&B.lengthSquared()<K*K?q.length():-1}update(z,a,K,v,T,m,j){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){G._RayDistant||(G._RayDistant=G.Zero()),G._RayDistant.unprojectRayToRef(z,a,K,v,p.b.IdentityReadOnly,m,j);const s=p.j.Matrix[0];T.invertToRef(s),G.TransformToRef(G._RayDistant,s,this)}else this.unprojectRayToRef(z,a,K,v,T,m,j);return this}static Zero(){return new G(p.o.Zero(),p.o.Zero())}static CreateNew(z,a,K,v,T,m,p){return G.Zero().update(z,a,K,v,T,m,p)}static CreateNewFromTo(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.b.IdentityReadOnly;const v=new G(new p.o(0,0,0),new p.o(0,0,0));return G.CreateFromToToRef(z,a,v,K)}static CreateFromToToRef(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.b.IdentityReadOnly;K.origin.p(z);const T=a.subtractToRef(z,K.direction),m=Math.sqrt(T.x*T.x+T.y*T.y+T.z*T.z);return K.length=m,K.direction.normalize(),G.TransformToRef(K,v,K)}static Transform(z,a){const K=new G(new p.o(0,0,0),new p.o(0,0,0));return G.TransformToRef(z,a,K),K}static TransformToRef(z,a,K){p.o.TransformCoordinatesToRef(z.origin,a,K.origin),p.o.TransformNormalToRef(z.direction,a,K.direction),K.length=z.length,K.epsilon=z.epsilon;const v=K.direction,T=v.length();if(0!==T&&1!==T){const z=1/T;v.x*=z,v.y*=z,v.z*=z,K.length*=T}return K}unprojectRayToRef(z,a,K,v,T,m,j){const s=p.j.Matrix[0];T.multiplyToRef(m,s),s.multiplyToRef(j,s),s.invert();const M=r.b.LastCreatedEngine,W=p.j.gb[0];W.x=z/K*2-1,W.y=-(a/v*2-1),W.z=null!==M&&void 0!==M&&M.useReverseDepthBuffer?1:null!==M&&void 0!==M&&M.isNDCHalfZRange?0:-1;const F=p.j.gb[1].Xd(W.x,W.y,1-1e-8),G=p.j.gb[2],l=p.j.gb[3];p.o._UnprojectFromInvertedMatrixToRef(W,s,G),p.o._UnprojectFromInvertedMatrixToRef(F,s,l),this.origin.p(G),l.subtractToRef(G,this.direction),this.direction.normalize()}}function l(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const p=G.Zero();return V(z,a,K,v,p,T,m),p}function V(z,a,K,v,T,m){let j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const M=z.getEngine();if(!m&&!(m=z.activeCamera))return z;const r=m.viewport,W=M.getRenderHeight(),{x:F,y:G,width:l,height:V}=r.toGlobal(M.getRenderWidth(),W),c=1/M.getHardwareScalingLevel();return a=a*c-F,K=K*c-(W-G-V),T.update(a,K,l,V,v||p.b.IdentityReadOnly,j?p.b.IdentityReadOnly:m.getViewMatrix(),m.getProjectionMatrix(),s),z}function c(z,a,K,v,T){if(!M.d)return z;const m=z.getEngine();if(!T&&!(T=z.activeCamera))throw new Error("Active camera not set");const j=T.viewport,s=m.getRenderHeight(),{x:r,y:W,width:F,height:G}=j.toGlobal(m.getRenderWidth(),s),l=p.b.Identity(),V=1/m.getHardwareScalingLevel();return a=a*V-r,K=K*V-(s-W-G),v.update(a,K,F,G,l,l,T.getProjectionMatrix()),z}function C(z,a,K,v,T,m,p,j){const s=a(v,K.enableDistantPicking),M=K.intersects(s,T,p,m,v,j);return M&&M.hit?!T&&null!=z&&M.distance>=z.distance?null:M:null}function w(z,a,K,v,T,m){let j=null;const s=!!(z.activeCameras&&z.activeCameras.length>1&&z.cameraToUseForPointers!==z.activeCamera),r=z.cameraToUseForPointers||z.activeCamera,W=F.internalPickerForMesh||C;for(let M=0;M<z.meshes.length;M++){const F=z.meshes[M];if(K){if(!K(F,-1))continue}else if(!F.isEnabled()||!F.isVisible||!F.Hb)continue;const G=s&&F.isWorldMatrixCameraDependent(),l=F.Qj(G,r);if(F.hasThinInstances&&F.thinInstanceEnablePicking){const z=W(j,a,F,l,!0,!0,m);if(z){if(T)return z;const s=p.j.Matrix[1],M=F.thinInstanceGetWorldMatrices();for(let z=0;z<M.length;z++){if(K&&!K(F,z))continue;M[z].multiplyToRef(l,s);const p=W(j,a,F,s,v,T,m,!0);if(p&&(j=p,j.thinInstanceIndex=z,v))return j}}}else{const z=W(j,a,F,l,v,T,m);if(z&&(j=z,v))return j}}return j||new M.d}function H(z,a,K,v){if(!M.d)return null;const T=[],m=!!(z.activeCameras&&z.activeCameras.length>1&&z.cameraToUseForPointers!==z.activeCamera),j=z.cameraToUseForPointers||z.activeCamera,s=F.internalPickerForMesh||C;for(let M=0;M<z.meshes.length;M++){const r=z.meshes[M];if(K){if(!K(r,-1))continue}else if(!r.isEnabled()||!r.isVisible||!r.Hb)continue;const W=m&&r.isWorldMatrixCameraDependent(),F=r.Qj(W,j);if(r.hasThinInstances&&r.thinInstanceEnablePicking){if(s(null,a,r,F,!0,!0,v)){const z=p.j.Matrix[1],m=r.thinInstanceGetWorldMatrices();for(let p=0;p<m.length;p++){if(K&&!K(r,p))continue;m[p].multiplyToRef(F,z);const j=s(null,a,r,z,!1,!1,v,!0);j&&(j.thinInstanceIndex=p,T.push(j))}}}else{const z=s(null,a,r,F,!1,!1,v);z&&T.push(z)}}return T}function f(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,v=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0;v||(v=z.getWorldMatrix()),a.length=K,T?a.origin.p(T):a.origin.p(z.position);const m=p.j.gb[2];m.set(0,0,z._scene.useRightHandedSystem?-1:1);const j=p.j.gb[3];return p.o.TransformNormalToRef(m,v,j),p.o.NormalizeToRef(j,a.direction),a}var Y,I;G._TmpVector3=(0,j.d)(6,p.o.Zero),G._RayDistant=G.Zero(),G._Smallnum=1e-8,G._Rayl=1e9,Y=v.c,(I=T.d)&&(I.prototype.getForwardRay=function(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,a=arguments.length>1?arguments[1]:void 0,K=arguments.length>2?arguments[2]:void 0;return f(this,new G(p.o.Zero(),p.o.Zero(),z),z,a,K)},I.prototype.getForwardRayToRef=function(z){return f(this,z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),Y&&(W.c._IsPickingAvailable=!0,Y.prototype.createPickingRay=function(z,a,K,v){return l(this,z,a,K,v,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),v.c.prototype.createPickingRayToRef=function(z,a,K,v,T){return V(this,z,a,K,v,T,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},v.c.prototype.createPickingRayInCameraSpace=function(z,a,K){return function(z,a,K,v){const T=G.Zero();return c(z,a,K,T,v),T}(this,z,a,K)},v.c.prototype.createPickingRayInCameraSpaceToRef=function(z,a,K,v){return c(this,z,a,K,v)},v.c.prototype.pickWithBoundingInfo=function(z,a,K,v,T){return function(z,a,K,v,T,m){if(!M.d)return null;const j=w(z,(v=>(z._tempPickingRay||(z._tempPickingRay=G.Zero()),V(z,a,K,v,z._tempPickingRay,m||null),z._tempPickingRay)),v,T,!0);return j&&(j.ray=l(z,a,K,p.b.Identity(),m||null)),j}(this,z,a,K,v,T)},v.c.prototype.jc=function(z,a,K,v,T,m){return function(z,a,K,v,T,m,j){const s=w(z,((v,T)=>(z._tempPickingRay||(z._tempPickingRay=G.Zero()),V(z,a,K,v,z._tempPickingRay,m||null,!1,T),z._tempPickingRay)),v,T,!1,j);return s&&(s.ray=l(z,a,K,p.b.Identity(),m||null)),s}(this,z,a,K,v,T,m)},v.c.prototype.pickWithRay=function(z,a,K,v){return function(z,a,K,v,T){const m=w(z,(K=>(z._pickWithRayInverseMatrix||(z._pickWithRayInverseMatrix=p.b.Identity()),K.invertToRef(z._pickWithRayInverseMatrix),z._cachedRayForTransform||(z._cachedRayForTransform=G.Zero()),G.TransformToRef(a,z._pickWithRayInverseMatrix,z._cachedRayForTransform),z._cachedRayForTransform)),K,v,!1,T);return m&&(m.ray=a),m}(this,z,a,K,v)},v.c.prototype.multiPick=function(z,a,K,v,T){return function(z,a,K,v,T,m){return H(z,(v=>l(z,a,K,v,T||null)),v,m)}(this,z,a,K,v,T)},v.c.prototype.multiPickWithRay=function(z,a,K){return function(z,a,K,v){return H(z,(K=>(z._pickWithRayInverseMatrix||(z._pickWithRayInverseMatrix=p.b.Identity()),K.invertToRef(z._pickWithRayInverseMatrix),z._cachedRayForTransform||(z._cachedRayForTransform=G.Zero()),G.TransformToRef(a,z._pickWithRayInverseMatrix,z._cachedRayForTransform),z._cachedRayForTransform)),K,v)}(this,z,a,K)}},11495:(z,a,K)=>{"use strict";var v=K(10748),T=K(10648),m=K(10682),p=K(10776),j=K(10715),s=K(10758);j.b.prototype._partialLoadFile=function(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(z,(z=>{K[a]=z,K._internalCount++,6===K._internalCount&&v(K)}),void 0,void 0,!0,((z,a)=>{T&&z&&T(z.status+" "+z.statusText,a)}))},j.b.prototype._cascadeLoadFiles=function(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const T=[];T._internalCount=0;for(let m=0;m<6;m++)this._partialLoadFile(K[m],m,T,a,v)},j.b.prototype._cascadeLoadImgs=function(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5?arguments[5]:void 0;const p=[];p._internalCount=0;for(let j=0;j<6;j++)this._partialLoadImg(v[j],j,p,z,a,K,T,m)},j.b.prototype._partialLoadImg=function(z,a,K,v,T,j){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7?arguments[7]:void 0;const r=(0,p.c)();(0,m.p)(z,(z=>{K[a]=z,K._internalCount++,v&&v.removePendingData(r),6===K._internalCount&&j&&j(T,K)}),((z,a)=>{v&&v.removePendingData(r),s&&s(z,a)}),v?v.offlineProvider:null,M),v&&v.addPendingData(r)},j.b.prototype.createCubeTextureBase=function(z,a,K,m){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6?arguments[6]:void 0,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]&&arguments[8],F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,G=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,l=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,V=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,c=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,C=arguments.length>14&&void 0!==arguments[14]&&arguments[14],w=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const H=l||new v.b(this,7);H.isCube=!0,H.url=z,H.generateMipMaps=!m,H._lodGenerationScale=F,H._lodGenerationOffset=G,H._useSRGBBuffer=!!C&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!m),H!==l&&(H.label=z.substring(0,60)),this._doNotHandleContextLost||(H._extension=r,H._files=K,H._buffer=w);const f=z;this._transformTextureUrl&&!l&&(z=this._transformTextureUrl(z));const Y=z.split("?")[0],I=Y.lastIndexOf("."),q=r||(I>-1?Y.substring(I).toLowerCase():""),B=(0,s.e)(q),x=(v,s)=>{z===f?j&&v&&j(v.status+" "+v.statusText,s):(T.c.Warn(`Failed to load ${z}, falling back to the ${f}`),this.createCubeTextureBase(f,a,K,!!m,p,j,M,r,W,F,G,H,V,c,C,w))};if(B)B.then((v=>{const m=z=>{V&&V(H,z),v.loadCubeData(z,H,W,p,j)};w?m(w):K&&6===K.length?v.supportCascades?this._cascadeLoadFiles(a,(z=>m(z.map((z=>new Uint8Array(z))))),K,j):j?j("Textures type does not support cascades."):T.c.Warn("Texture loader does not support cascades."):this._loadFile(z,(z=>m(new Uint8Array(z))),void 0,void 0,!0,x)}));else{if(!K||0===K.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(a,H,((z,a)=>{c&&c(z,a)}),K,j)}return this._internalTexturesCache.push(H),H}},11430:(z,a,K)=>{"use strict";K(10715).b.prototype.createDepthStencilTexture=function(z,a,K){if(a.isCube){const K=z.width||z;return this._createDepthStencilCubeTexture(K,a)}return this._createDepthStencilTexture(z,a,K)}},11407:(z,a,K)=>{"use strict";K(11377).ThinEngine.prototype.setAlphaMode=function(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==z){switch(z){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}a||(this.depthCullingState.depthMask=0===z),this._alphaMode=z}else if(!a){const a=0===z;this.depthCullingState.depthMask!==a&&(this.depthCullingState.depthMask=a)}}},11375:(z,a,K)=>{"use strict";var v=K(11377);v.ThinEngine.prototype.updateDynamicIndexBuffer=function(z,a){let K;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(z),K=z.is32Bits?a instanceof Uint32Array?a:new Uint32Array(a):a instanceof Uint16Array?a:new Uint16Array(a),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,K,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},v.ThinEngine.prototype.updateDynamicVertexBuffer=function(z,a,K,v){this.bindArrayBuffer(z),void 0===K&&(K=0);const T=a.byteLength||a.length;void 0===v||v>=T&&0===K?a instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,K,new Float32Array(a)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,K,a):a instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(a).subarray(K,K+v)):(a=a instanceof ArrayBuffer?new Uint8Array(a,K,v):new Uint8Array(a.buffer,a.byteOffset+K,v),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,a)),this._resetVertexBufferBinding()}},11418:(z,a,K)=>{"use strict";var v=K(10748),T=K(10648),m=K(11377),p=K(11425);class j extends p.e{constructor(z,a,K,v,T){super(z,a,K,v),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=T}_cloneRenderTargetWrapper(){let z=null;return this._colorTextureArray&&this._depthStencilTextureArray?(z=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),z.texture.isReady=!0):z=super._cloneRenderTargetWrapper(),z}_swapRenderTargetWrapper(z){super._swapRenderTargetWrapper(z),z._framebuffer=this._framebuffer,z._depthStencilBuffer=this._depthStencilBuffer,z._MSAAFramebuffer=this._MSAAFramebuffer,z._colorTextureArray=this._colorTextureArray,z._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,m=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const z=this._engine,a=z._currentFramebuffer,K=this._context;z._bindUnboundFramebuffer(this._framebuffer),K.framebufferRenderbuffer(K.FRAMEBUFFER,K.DEPTH_STENCIL_ATTACHMENT,K.RENDERBUFFER,null),K.framebufferRenderbuffer(K.FRAMEBUFFER,K.DEPTH_ATTACHMENT,K.RENDERBUFFER,null),K.framebufferRenderbuffer(K.FRAMEBUFFER,K.STENCIL_ATTACHMENT,K.RENDERBUFFER,null),z._bindUnboundFramebuffer(a),K.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(z,a,K,v,T,m)}shareDepth(z){super.shareDepth(z);const a=this._context,K=this._depthStencilBuffer,v=z._MSAAFramebuffer||z._framebuffer,T=this._engine;z._depthStencilBuffer&&z._depthStencilBuffer!==K&&a.deleteRenderbuffer(z._depthStencilBuffer),z._depthStencilBuffer=K;const m=z._generateStencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;T._bindUnboundFramebuffer(v),a.framebufferRenderbuffer(a.FRAMEBUFFER,m,a.RENDERBUFFER,K),T._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!z._hardwareTexture)return;const T=this._framebuffer,m=this._engine,p=m._currentFramebuffer;if(m._bindUnboundFramebuffer(T),m.webGLVersion>1){const T=this._context,m=T["COLOR_ATTACHMENT"+a];var j;if(z.is2DArray||z.is3D)K=K??(null===(j=this.layerIndices)||void 0===j?void 0:j[a])??0,T.framebufferTextureLayer(T.FRAMEBUFFER,m,z._hardwareTexture.underlyingResource,v,K);else if(z.isCube){var s;K=K??(null===(s=this.faceIndices)||void 0===s?void 0:s[a])??0,T.framebufferTexture2D(T.FRAMEBUFFER,m,T.TEXTURE_CUBE_MAP_POSITIVE_X+K,z._hardwareTexture.underlyingResource,v)}else T.framebufferTexture2D(T.FRAMEBUFFER,m,T.TEXTURE_2D,z._hardwareTexture.underlyingResource,v)}else{const T=this._context,m=T["COLOR_ATTACHMENT"+a+"_WEBGL"],p=void 0!==K?T.TEXTURE_CUBE_MAP_POSITIVE_X+K:T.TEXTURE_2D;T.framebufferTexture2D(T.FRAMEBUFFER,m,p,z._hardwareTexture.underlyingResource,v)}m._bindUnboundFramebuffer(p)}setTexture(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(z,a,K),this._bindTextureRenderTarget(z,a)}setLayerAndFaceIndices(z,a){var K;if(super.setLayerAndFaceIndices(z,a),!this.textures||!this.layerIndices||!this.faceIndices)return;const v=(null===(K=this._attachments)||void 0===K?void 0:K.length)??this.textures.length;for(let T=0;T<v;T++){const z=this.textures[T];z&&(z.is2DArray||z.is3D?this._bindTextureRenderTarget(z,T,this.layerIndices[T]):z.isCube?this._bindTextureRenderTarget(z,T,this.faceIndices[T]):this._bindTextureRenderTarget(z,T))}}setLayerAndFaceIndex(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1?arguments[1]:void 0,K=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(z,a,K),!this.textures||!this.layerIndices||!this.faceIndices)return;const v=this.textures[z];v.is2DArray||v.is3D?this._bindTextureRenderTarget(this.textures[z],z,this.layerIndices[z]):v.isCube&&this._bindTextureRenderTarget(this.textures[z],z,this.faceIndices[z])}dispose(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const a=this._context;z||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(a.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(a.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(a.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(z)}}K(11430);m.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(z,a,K){const v=new j(z,a,K,this,this._gl);return this._renderTargetWrapperCache.push(v),v},m.ThinEngine.prototype.createRenderTargetTexture=function(z,a){const K=this._createHardwareRenderTargetWrapper(!1,!1,z);let v,T,m=!0,p=!1,j=!1,s=1;void 0!==a&&"object"===typeof a&&(m=a.generateDepthBuffer??!0,p=!!a.generateStencilBuffer,j=!!a.noColorAttachment,v=a.colorAttachment,s=a.samples??1,T=a.label);const M=v||(j?null:this._createInternalTexture(z,a,!0,5)),r=z.width||z,W=z.height||z,F=this._currentFramebuffer,G=this._gl,l=G.createFramebuffer();if(this._bindUnboundFramebuffer(l),K._depthStencilBuffer=this._setupFramebufferDepthAttachments(p,m,r,W),!M||M.is2DArray||M.is3D||G.framebufferTexture2D(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,G.TEXTURE_2D,M._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(F),K.label=T??"RenderTargetWrapper",K._framebuffer=l,K._generateDepthBuffer=m,K._generateStencilBuffer=p,K.setTextures(M),v){if(K._samples=v.samples,v.samples>1){const z=v._hardwareTexture.getMSAARenderBuffer(0);K._MSAAFramebuffer=G.createFramebuffer(),this._bindUnboundFramebuffer(K._MSAAFramebuffer),G.framebufferRenderbuffer(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,G.RENDERBUFFER,z),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(K,s);return K},m.ThinEngine.prototype._createDepthStencilTexture=function(z,a,K){const m=this._gl,p=z.layers||0,j=z.depth||0;let s=m.TEXTURE_2D;0!==p?s=m.TEXTURE_2D_ARRAY:0!==j&&(s=m.TEXTURE_3D);const M=new v.b(this,12);if(M.label=a.label,!this._caps.depthTextureExtension)return T.c.Error("Depth texture is not supported by your browser or hardware."),M;const r={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...a};if(this._bindTextureDirectly(s,M,!0),this._setupDepthStencilTexture(M,z,0!==r.comparisonFunction&&r.bilinearFiltering,r.comparisonFunction,r.samples),void 0!==r.depthTextureFormat){if(15!==r.depthTextureFormat&&16!==r.depthTextureFormat&&17!==r.depthTextureFormat&&13!==r.depthTextureFormat&&14!==r.depthTextureFormat&&18!==r.depthTextureFormat)return T.c.Error(`Depth texture ${r.depthTextureFormat} format is not supported.`),M;M.format=r.depthTextureFormat}else M.format=r.generateStencil?13:16;const W=17===M.format||13===M.format||18===M.format;let F=m.UNSIGNED_INT;15===M.format?F=m.UNSIGNED_SHORT:17===M.format||13===M.format?F=m.UNSIGNED_INT_24_8:14===M.format?F=m.FLOAT:18===M.format&&(F=m.FLOAT_32_UNSIGNED_INT_24_8_REV);const G=W?m.DEPTH_STENCIL:m.DEPTH_COMPONENT,l=this._getInternalFormatFromDepthTextureFormat(M.format,!0,W);return M.is2DArray?m.texImage3D(s,0,l,M.width,M.height,p,0,G,F,null):M.is3D?m.texImage3D(s,0,l,M.width,M.height,j,0,G,F,null):m.texImage2D(s,0,l,M.width,M.height,0,G,F,null),this._bindTextureDirectly(s,null),this._internalTexturesCache.push(M),K._depthStencilBuffer&&(m.deleteRenderbuffer(K._depthStencilBuffer),K._depthStencilBuffer=null),this._bindUnboundFramebuffer(K._MSAAFramebuffer??K._framebuffer),K._generateStencilBuffer=W,K._depthStencilTextureWithStencil=W,K._depthStencilBuffer=this._setupFramebufferDepthAttachments(K._generateStencilBuffer,K._generateDepthBuffer,K.width,K.height,K.samples,M.format),this._bindUnboundFramebuffer(null),M},m.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(z,a){var K;if(this.webGLVersion<2||!z)return 1;if(z.samples===a)return a;const v=this._gl;a=Math.min(a,this.getCaps().maxMSAASamples),z._depthStencilBuffer&&(v.deleteRenderbuffer(z._depthStencilBuffer),z._depthStencilBuffer=null),z._MSAAFramebuffer&&(v.deleteFramebuffer(z._MSAAFramebuffer),z._MSAAFramebuffer=null);const T=null===(K=z.texture)||void 0===K?void 0:K._hardwareTexture;if(null===T||void 0===T||T.releaseMSAARenderBuffers(),z.texture&&a>1&&"function"===typeof v.renderbufferStorageMultisample){const K=v.createFramebuffer();if(!K)throw new Error("Unable to create multi sampled framebuffer");z._MSAAFramebuffer=K,this._bindUnboundFramebuffer(z._MSAAFramebuffer);const m=this._createRenderBuffer(z.texture.width,z.texture.height,a,-1,this._getRGBABufferInternalSizedFormat(z.texture.type,z.texture.format,z.texture._useSRGBBuffer),v.COLOR_ATTACHMENT0,!1);if(!m)throw new Error("Unable to create multi sampled framebuffer");null===T||void 0===T||T.addMSAARenderBuffer(m)}this._bindUnboundFramebuffer(z._MSAAFramebuffer??z._framebuffer),z.texture&&(z.texture.samples=a),z._samples=a;const m=z._depthStencilTexture?z._depthStencilTexture.format:void 0;return z._depthStencilBuffer=this._setupFramebufferDepthAttachments(z._generateStencilBuffer,z._generateDepthBuffer,z.width,z.height,a,m),this._bindUnboundFramebuffer(null),a},m.ThinEngine.prototype._setupDepthStencilTexture=function(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const m=a.width??a,p=a.height??a,j=a.layers||0,s=a.depth||0;z.baseWidth=m,z.baseHeight=p,z.width=m,z.height=p,z.is2DArray=j>0,z.depth=j||s,z.isReady=!0,z.samples=T,z.generateMipMaps=!1,z.samplingMode=K?2:1,z.type=0,z._comparisonFunction=v;const M=this._gl,r=this._getTextureTarget(z),W=this._getSamplingParameters(z.samplingMode,!1);M.texParameteri(r,M.TEXTURE_MAG_FILTER,W.mag),M.texParameteri(r,M.TEXTURE_MIN_FILTER,W.min),M.texParameteri(r,M.TEXTURE_WRAP_S,M.CLAMP_TO_EDGE),M.texParameteri(r,M.TEXTURE_WRAP_T,M.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===v?(M.texParameteri(r,M.TEXTURE_COMPARE_FUNC,515),M.texParameteri(r,M.TEXTURE_COMPARE_MODE,M.NONE)):(M.texParameteri(r,M.TEXTURE_COMPARE_FUNC,v),M.texParameteri(r,M.TEXTURE_COMPARE_MODE,M.COMPARE_REF_TO_TEXTURE)))}},10699:(z,a,K)=>{"use strict";K.d(a,{b:()=>B,c:()=>I,g:()=>q,j:()=>P,n:()=>J});class v{constructor(){this.children=[]}isValid(z){return!0}process(z,a){let K="";if(this.line){let M=this.line;const r=a.processor;if(r){var v,T,m,p,j,s;r.lineProcessor&&(M=r.lineProcessor(M,a.isFragment,a.processingContext));const K=(null===(v=a.processor)||void 0===v?void 0:v.attributeKeywordName)??"attribute",W=a.isFragment&&null!==(T=a.processor)&&void 0!==T&&T.varyingFragmentKeywordName?null===(m=a.processor)||void 0===m?void 0:m.varyingFragmentKeywordName:!a.isFragment&&null!==(p=a.processor)&&void 0!==p&&p.varyingVertexKeywordName?null===(j=a.processor)||void 0===j?void 0:j.varyingVertexKeywordName:"varying";if(!a.isFragment&&r.attributeProcessor&&this.line.startsWith(K))M=r.attributeProcessor(this.line,z,a.processingContext);else if(r.varyingProcessor&&(null!==(s=r.varyingCheck)&&void 0!==s&&s.call(r,this.line,a.isFragment)||!r.varyingCheck&&this.line.startsWith(W)))M=r.varyingProcessor(this.line,a.isFragment,z,a.processingContext);else if(r.uniformProcessor&&r.uniformRegexp&&r.uniformRegexp.test(this.line))a.lookForClosingBracketForUniformBuffer||(M=r.uniformProcessor(this.line,a.isFragment,z,a.processingContext));else if(r.uniformBufferProcessor&&r.uniformBufferRegexp&&r.uniformBufferRegexp.test(this.line))a.lookForClosingBracketForUniformBuffer||(M=r.uniformBufferProcessor(this.line,a.isFragment,a.processingContext),a.lookForClosingBracketForUniformBuffer=!0);else if(r.textureProcessor&&r.textureRegexp&&r.textureRegexp.test(this.line))M=r.textureProcessor(this.line,a.isFragment,z,a.processingContext);else if((r.uniformProcessor||r.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!a.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?r.uniformProcessor&&(M=r.uniformProcessor(this.line,a.isFragment,z,a.processingContext)):r.uniformBufferProcessor&&(M=r.uniformBufferProcessor(this.line,a.isFragment,a.processingContext),a.lookForClosingBracketForUniformBuffer=!0)}a.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(a.lookForClosingBracketForUniformBuffer=!1,r.endOfUniformBufferProcessor&&(M=r.endOfUniformBufferProcessor(this.line,a.isFragment,a.processingContext)))}K+=M+"\n"}return this.children.forEach((v=>{K+=v.process(z,a)})),this.additionalDefineKey&&(z[this.additionalDefineKey]=this.additionalDefineValue||"true"),K}}class T{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(z){this._lines.length=0;for(const a of z){if(!a||"\r"===a)continue;if("#"===a[0]){this._lines.push(a);continue}const z=a.trim();if(!z)continue;if(z.startsWith("//")){this._lines.push(a);continue}const K=z.indexOf(";");if(-1===K)this._lines.push(z);else if(K===z.length-1)z.length>1&&this._lines.push(z);else{const z=a.split(";");for(let a=0;a<z.length;a++){let K=z[a];K&&(K=K.trim(),K&&this._lines.push(K+(a!==z.length-1?";":"")))}}}}}class m extends v{process(z,a){for(let K=0;K<this.children.length;K++){const v=this.children[K];if(v.isValid(z))return v.process(z,a)}return""}}class p extends v{isValid(z){return this.testExpression.isTrue(z)}}class j{isTrue(z){return!0}static postfixToInfix(z){const a=[];for(const K of z)if(void 0===j._OperatorPriority[K])a.push(K);else{const z=a[a.length-1],v=a[a.length-2];a.length-=2,a.push(`(${v}${K}${z})`)}return a[a.length-1]}static infixToPostfix(z){const a=j._InfixToPostfixCache.get(z);if(a)return a.accessTime=Date.now(),a.result;if(!z.includes("&&")&&!z.includes("||")&&!z.includes(")")&&!z.includes("("))return[z];const K=[];let v=-1;const T=()=>{r=r.trim(),""!==r&&(K.push(r),r="")},m=z=>{v<j._Stack.length-1&&(j._Stack[++v]=z)},p=()=>j._Stack[v],s=()=>-1===v?"!!INVALID EXPRESSION!!":j._Stack[v--];let M=0,r="";for(;M<z.length;){const a=z.charAt(M),W=M<z.length-1?z.substring(M,2+M):"";if("("===a)r="",m(a);else if(")"===a){for(T();-1!==v&&"("!==p();)K.push(s());s()}else if(j._OperatorPriority[W]>1){for(T();-1!==v&&j._OperatorPriority[p()]>=j._OperatorPriority[W];)K.push(s());m(W),M++}else r+=a;M++}for(T();-1!==v;)"("===p()?s():K.push(s());return j._InfixToPostfixCache.size>=j.InfixToPostfixCacheLimitSize&&j.ClearCache(),j._InfixToPostfixCache.set(z,{result:K,accessTime:Date.now()}),K}static ClearCache(){const z=Array.from(j._InfixToPostfixCache.entries()).sort(((z,a)=>z[1].accessTime-a[1].accessTime));for(let a=0;a<j.InfixToPostfixCacheCleanupSize;a++)j._InfixToPostfixCache.delete(z[a][0])}}j.InfixToPostfixCacheLimitSize=5e4,j.InfixToPostfixCacheCleanupSize=25e3,j._InfixToPostfixCache=new Map,j._OperatorPriority={")":0,"(":1,"||":2,"&&":3},j._Stack=["","","","","","","","","","","","","","","","","","","",""];class s extends j{constructor(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=z,this.not=a}isTrue(z){let a=void 0!==z[this.define];return this.not&&(a=!a),a}}class M extends j{isTrue(z){return this.leftOperand.isTrue(z)||this.rightOperand.isTrue(z)}}class r extends j{isTrue(z){return this.leftOperand.isTrue(z)&&this.rightOperand.isTrue(z)}}class W extends j{constructor(z,a,K){super(),this.define=z,this.operand=a,this.testValue=K}isTrue(z){let a=z[this.define];void 0===a&&(a=this.define);let K=!1;const v=parseInt(a),T=parseInt(this.testValue);switch(this.operand){case">":K=v>T;break;case"<":K=v<T;break;case"<=":K=v<=T;break;case">=":K=v>=T;break;case"==":K=v===T;break;case"!=":K=v!==T}return K}}var F=K(10663),G=K(10702);const l=/defined\s*?\((.+?)\)/g,V=/defined\s*?\[(.+?)\]/g,c=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,C=/__decl__/,w=/light\{X\}.(\w*)/g,H=/\{X\}/g,f=[],Y=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function I(z){z.processor&&z.processor.initializeShaders&&z.processor.initializeShaders(z.processingContext)}function q(z,a,K,v){var T;null!==(T=a.processor)&&void 0!==T&&T.preProcessShaderCode&&(z=a.processor.preProcessShaderCode(z,a.isFragment)),P(z,a,(z=>{a.processCodeAfterIncludes&&(z=a.processCodeAfterIncludes(a.isFragment?"fragment":"vertex",z,a.defines));const T=function(z,a,K){let v=function(z,a){var K;if(null!==(K=a.processor)&&void 0!==K&&K.noPrecision)return z;const v=a.shouldUseHighPrecisionShader;-1===z.indexOf("precision highp float")?z=v?"precision highp float;\n"+z:"precision mediump float;\n"+z:v||(z=z.replace("precision highp float","precision mediump float"));return z}(z,a);if(!a.processor)return v;if(0===a.processor.shaderLanguage&&-1!==v.indexOf("#version 3")&&(v=v.replace("#version 300 es",""),!a.processor.parseGLES3))return v;const T=a.defines,m=X(a,K);a.processor.preProcessor&&(v=a.processor.preProcessor(v,T,m,a.isFragment,a.processingContext));v=n(v,m,a),a.processor.postProcessor&&(v=a.processor.postProcessor(v,T,a.isFragment,a.processingContext,K?{drawBuffersExtensionDisabled:!K.getCaps().drawBuffersExtension}:{}));null!==K&&void 0!==K&&K._features.needShaderCodeInlining&&(v=K.inlineShaderCode(v));return v}(z,a,v);K(T,z)}))}function B(z,a,K){return K.processor&&K.processor.finalizeShaders?K.processor.finalizeShaders(z,a,K.processingContext):{vertexCode:z,fragmentCode:a}}function x(z){const a=/defined\((.+)\)/.exec(z);if(a&&a.length)return new s(a[1].trim(),"!"===z[0]);const K=["==","!=",">=","<=","<",">"];let v="",T=0;for(v of K)if(T=z.indexOf(v),T>-1)break;if(-1===T)return new s(z);const m=z.substring(0,T).trim(),p=z.substring(T+v.length).trim();return new W(m,v,p)}function Z(z,a){const K=new p,v=z.substring(0,a);let T=z.substring(a);return T=T.substring(0,(T.indexOf("//")+1||T.length+1)-1).trim(),K.testExpression="#ifdef"===v?new s(T):"#ifndef"===v?new s(T,!0):function(z){z=z.replace(l,"defined[$1]");const a=j.infixToPostfix(z),K=[];for(const T of a)if("||"!==T&&"&&"!==T)K.push(T);else if(K.length>=2){let z=K[K.length-1],a=K[K.length-2];K.length-=2;const v="&&"==T?new r:new M;"string"===typeof z&&(z=z.replace(V,"defined($1)")),"string"===typeof a&&(a=a.replace(V,"defined($1)")),v.leftOperand="string"===typeof a?x(a):a,v.rightOperand="string"===typeof z?x(z):z,K.push(v)}let v=K[K.length-1];return"string"===typeof v&&(v=v.replace(V,"defined($1)")),"string"===typeof v?x(v):v}(T),K}function y(z,a,K){let T=z.currentLine;for(;i(z,K);){T=z.currentLine;const m=T.substring(0,5).toLowerCase();if("#else"===m){const K=new v;return a.children.push(K),void i(z,K)}if("#elif"===m){const z=Z(T,5);a.children.push(z),K=z}}}function i(z,a){for(;z.canRead;){z.lineIndex++;const K=z.currentLine;if(K.indexOf("#")>=0){const v=Y.exec(K);if(v&&v.length){switch(v[0]){case"#ifdef":{const v=new m;a.children.push(v);const T=Z(K,6);v.children.push(T),y(z,v,T);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const v=new m;a.children.push(v);const T=Z(K,7);v.children.push(T),y(z,v,T);break}case"#if":{const v=new m,T=Z(K,3);a.children.push(v),v.children.push(T),y(z,v,T);break}}continue}}const T=new v;if(T.line=K,a.children.push(T),"#"===K[0]&&"d"===K[1]){const z=K.replace(";","").split(" ");T.additionalDefineKey=z[1],3===z.length&&(T.additionalDefineValue=z[2])}}return!1}function n(z,a,K){const m=new v,p=new T;return p.lineIndex=-1,p.lines=z.split("\n"),i(p,m),m.process(a,K)}function X(z,a){var K;const v=z.defines,T={};for(const m of v){const z=m.replace("#define","").replace(";","").trim().split(" ");T[z[0]]=z.length>1?z[1]:""}return 0===(null===(K=z.processor)||void 0===K?void 0:K.shaderLanguage)&&(T.GL_ES="true"),T.__VERSION__=z.version,T[z.platformName]="true",(0,G.l)(T,null===a||void 0===a?void 0:a.isNDCHalfZRange,null===a||void 0===a?void 0:a.useReverseDepthBuffer,null===a||void 0===a?void 0:a.useExactSrgbConversions),T}function P(z,a,K){let v;for(f.length=0;null!==(v=c.exec(z));)f.push(v);let T=String(z),m=[z],p=!1;for(const j of f){let z=j[1];if(-1!==z.indexOf("__decl__")&&(z=z.replace(C,""),a.supportsUniformBuffers&&(z=z.replace("Vertex","Ubo").replace("Fragment","Ubo")),z+="Declaration"),!a.includesShadersStore[z]){const v=a.shadersRepository+"ShadersInclude/"+z+".fx";return void J.loadFile(v,(v=>{a.includesShadersStore[z]=v,P(m.join(""),a,K)}))}{let K=a.includesShadersStore[z];if(j[2]){const z=j[3].split(",");for(let a=0;a<z.length;a+=2){const v=new RegExp(z[a],"g"),T=z[a+1];K=K.replace(v,T)}}if(j[4]){const z=j[5];if(-1!==z.indexOf("..")){const v=z.split(".."),T=parseInt(v[0]);let m=parseInt(v[1]),p=K.slice(0);K="",isNaN(m)&&(m=a.indexParameters[v[1]]);for(let z=T;z<m;z++)a.supportsUniformBuffers||(p=p.replace(w,((z,a)=>a+"{X}"))),K+=p.replace(H,z.toString())+"\n"}else a.supportsUniformBuffers||(K=K.replace(w,((z,a)=>a+"{X}"))),K=K.replace(H,z)}const v=[];for(const z of m){const a=z.split(j[0]);for(let z=0;z<a.length-1;z++)v.push(a[z]),v.push(K);v.push(a[a.length-1])}m=v,p=p||K.indexOf("#include<")>=0||K.indexOf("#include <")>=0}}f.length=0,T=m.join(""),p?P(T.toString(),a,K):K(T)}const J={loadFile:(z,a,K,v,T,m)=>{throw(0,F.b)("FileTools")}}},11397:(z,a,K)=>{"use strict";K.d(a,{d:()=>v});class v{get underlyingResource(){return this._webGLTexture}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=a,!z&&(z=a.createTexture(),!z))throw new Error("Unable to create webGL texture");this.set(z)}setUsage(){}set(z){this._webGLTexture=z}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(z){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(z)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const z of this._MSAARenderBuffers)this._context.deleteRenderbuffer(z);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var z;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(z=this._MSAARenderBuffers)||void 0===z?void 0:z[a])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},10702:(z,a,K)=>{"use strict";K.d(a,{d:()=>T,h:()=>m,l:()=>j,m:()=>p,n:()=>s});var v=K(10663);K(10640);const T={};function m(z,a){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(a?a+"\n":"")+z}function p(z,a,K,m,p,j,s){const M=s||T.loadFile;if(M){return M(z,a,K,m,p,j)}throw(0,v.b)("FileTools")}function j(z,a,K,v){if(z)return a?z.IS_NDC_HALF_ZRANGE="":delete z.IS_NDC_HALF_ZRANGE,K?z.USE_REVERSE_DEPTHBUFFER="":delete z.USE_REVERSE_DEPTHBUFFER,void(v?z.USE_EXACT_SRGB_CONVERSIONS="":delete z.USE_EXACT_SRGB_CONVERSIONS);{let z="";return a&&(z+="#define IS_NDC_HALF_ZRANGE"),K&&(z&&(z+="\n"),z+="#define USE_REVERSE_DEPTHBUFFER"),v&&(z&&(z+="\n"),z+="#define USE_EXACT_SRGB_CONVERSIONS"),z}}function s(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3?arguments[3]:void 0;switch(z){case 3:{const z=(ArrayBuffer,new Int8Array(a));return v&&z.set(new Int8Array(v)),z}case 0:{const z=(ArrayBuffer,new Uint8Array(a));return v&&z.set(new Uint8Array(v)),z}case 4:{const z=a instanceof ArrayBuffer?new Int16Array(a):new Int16Array(K?a/2:a);return v&&z.set(new Int16Array(v)),z}case 5:case 8:case 9:case 10:case 2:{const z=a instanceof ArrayBuffer?new Uint16Array(a):new Uint16Array(K?a/2:a);return v&&z.set(new Uint16Array(v)),z}case 6:{const z=a instanceof ArrayBuffer?new Int32Array(a):new Int32Array(K?a/4:a);return v&&z.set(new Int32Array(v)),z}case 7:case 11:case 12:case 13:case 14:case 15:{const z=a instanceof ArrayBuffer?new Uint32Array(a):new Uint32Array(K?a/4:a);return v&&z.set(new Uint32Array(v)),z}case 1:{const z=a instanceof ArrayBuffer?new Float32Array(a):new Float32Array(K?a/4:a);return v&&z.set(new Float32Array(v)),z}}const T=(ArrayBuffer,new Uint8Array(a));return v&&T.set(new Uint8Array(v)),T}},10715:(z,a,K)=>{"use strict";K.d(a,{b:()=>H});var v=K(10680),T=K(10648),m=K(10720),p=K(10743),j=K(10658);class s{constructor(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,z&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(z){this._zOffset!==z&&(this._zOffset=z,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(z){this._zOffsetUnits!==z&&(this._zOffsetUnits=z,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(z){this._cullFace!==z&&(this._cullFace=z,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(z){this._cull!==z&&(this._cull=z,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(z){this._depthFunc!==z&&(this._depthFunc=z,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(z){this._depthMask!==z&&(this._depthMask=z,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(z){this._depthTest!==z&&(this._depthTest=z,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(z){this._frontFace!==z&&(this._frontFace=z,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(z){this.isDirty&&(this._isCullDirty&&(this.cull?z.enable(z.CULL_FACE):z.disable(z.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(z.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(z.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?z.enable(z.DEPTH_TEST):z.disable(z.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(z.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(z.enable(z.POLYGON_OFFSET_FILL),z.polygonOffset(this.zOffset,this.zOffsetUnits)):z.disable(z.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(z.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class M{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(z){this._func!==z&&(this._func=z,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(z){this._funcRef!==z&&(this._funcRef=z,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(z){this._funcMask!==z&&(this._funcMask=z,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(z){this._opStencilFail!==z&&(this._opStencilFail=z,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(z){this._opDepthFail!==z&&(this._opDepthFail=z,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(z){this._opStencilDepthPass!==z&&(this._opStencilDepthPass=z,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(z){this._mask!==z&&(this._mask=z,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(z){this._enabled!==z&&(this._enabled=z,this._isStencilTestDirty=!0)}constructor(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,z&&this.reset()}reset(){var z;this.stencilMaterial=void 0,null===(z=this.stencilGlobal)||void 0===z||z.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(z){var a;if(!z)return;const K=!this.useStencilGlobalOnly&&!(null===(a=this.stencilMaterial)||void 0===a||!a.enabled);this.enabled=K?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=K?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=K?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=K?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=K?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=K?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=K?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=K?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?z.enable(z.STENCIL_TEST):z.disable(z.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(z.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(z.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(z.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class r{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=r.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=r.KEEP,this.opDepthFail=r.KEEP,this.opStencilDepthPass=r.REPLACE}get stencilFunc(){return this.func}set stencilFunc(z){this.func=z}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(z){this.funcRef=z}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(z){this.funcMask=z}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(z){this.opStencilFail=z}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(z){this.opDepthFail=z}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(z){this.opStencilDepthPass=z}get stencilMask(){return this.mask}set stencilMask(z){this.mask=z}get stencilTest(){return this.enabled}set stencilTest(z){this.enabled=z}}r.ALWAYS=519,r.KEEP=7680,r.REPLACE=7681;class W{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(z){this._alphaBlend!==z&&(this._alphaBlend=z,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(z,a,K,v){this._blendConstants[0]===z&&this._blendConstants[1]===a&&this._blendConstants[2]===K&&this._blendConstants[3]===v||(this._blendConstants[0]=z,this._blendConstants[1]=a,this._blendConstants[2]=K,this._blendConstants[3]=v,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(z,a,K,v){this._blendFunctionParameters[0]===z&&this._blendFunctionParameters[1]===a&&this._blendFunctionParameters[2]===K&&this._blendFunctionParameters[3]===v||(this._blendFunctionParameters[0]=z,this._blendFunctionParameters[1]=a,this._blendFunctionParameters[2]=K,this._blendFunctionParameters[3]=v,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(z,a){this._blendEquationParameters[0]===z&&this._blendEquationParameters[1]===a||(this._blendEquationParameters[0]=z,this._blendEquationParameters[1]=a,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(z){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?z.enable(z.BLEND):z.disable(z.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(z.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(z.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(z.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var F=K(10663),G=K(10748),l=K(10640),V=K(10638),c=K(10702),C=K(10758);function w(z,a){if((0,l.m)()){const{requestAnimationFrame:K}=a||window;if("function"===typeof K)return K(z)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(z);return setTimeout(z,16)}class H{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(z){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(z){z!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=z,this._depthCullingState.depthFunc=z?518:515)}setColorWrite(z){z!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=z)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(z){if(z)return this.isNDCHalfZRange?z.IS_NDC_HALF_ZRANGE="":delete z.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?z.USE_REVERSE_DEPTHBUFFER="":delete z.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?z.USE_EXACT_SRGB_CONVERSIONS="":delete z.USE_EXACT_SRGB_CONVERSIONS);{let z="";return this.isNDCHalfZRange&&(z+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(z&&(z+="\n"),z+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(z&&(z+="\n"),z+="#define USE_EXACT_SRGB_CONVERSIONS"),z}}_rebuildInternalTextures(){const z=this._internalTexturesCache.slice();for(const a of z)a._rebuild()}_rebuildRenderTargetWrappers(){const z=this._renderTargetWrapperCache.slice();for(const a of z)a._rebuild()}_rebuildEffects(){for(const z in this._compiledEffects){const a=this._compiledEffects[z];a._pipelineContext=null,a._prepareEffect()}m.c.ResetCache()}_rebuildGraphicsResources(){var z;this.wipeCaches(!0),this._rebuildEffects(),null===(z=this._rebuildComputeEffects)||void 0===z||z.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){T.c.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(z){setTimeout((async()=>{this._clearEmptyResources();const a=this._depthCullingState.depthTest,K=this._depthCullingState.depthFunc,v=this._depthCullingState.depthMask,T=this._stencilState.stencilTest;await z(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=a,this._depthCullingState.depthFunc=K,this._depthCullingState.depthMask=v,this._stencilState.stencilTest=T,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(z){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(z){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const z=new Uint8Array(4),a=[z,z,z,z,z,z];this._emptyCubeTexture=this.createRawCubeTexture(a,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(z){if(!z)return this._activeRenderLoops.length=0,void this._cancelFrame();const a=this._activeRenderLoops.indexOf(z);a>=0&&(this._activeRenderLoops.splice(a,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const z=this._frameHandler;if(this._frameHandler=0,(0,l.m)()){const{cancelAnimationFrame:a}=this.getHostWindow()||window;if("function"===typeof a)return a(z)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(z);return clearTimeout(z)}}gj(){this.onBeginFrameObservable.notifyObservers(this)}hj(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let z=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(z=!1),z&&(this.gj(),this._renderViews()||this._renderFrame(),this.hj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let z=0;z<this._activeRenderLoops.length;z++){(0,this._activeRenderLoops[z])()}}_renderViews(){return!1}_queueNewFrame(z,a){return w(z,a)}runRenderLoop(z){-1===this._activeRenderLoops.indexOf(z)&&(this._activeRenderLoops.push(z),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(z){this._depthCullingState.depthTest=z}setZOffset(z){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-z:z}getZOffset(){const z=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-z:z}setZOffsetUnits(z){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-z:z}getZOffsetUnits(){const z=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-z:z}getHostWindow(){return(0,l.m)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(z){this._compatibilityMode=!0}_rebuildTextures(){for(const z of this.scenes)z._rebuildTextures();for(const z of this._virtualScenes)z._rebuildTextures()}_releaseRenderTargetWrapper(z){const a=this._renderTargetWrapperCache.indexOf(z);-1!==a&&this._renderTargetWrapperCache.splice(a,1)}get currentViewport(){return this._cachedViewport}setViewport(z,a,K){const v=a||this.getRenderWidth(),T=K||this.getRenderHeight(),m=z.x||0,p=z.y||0;this._cachedViewport=z,this._viewport(m*v,p*T,v*z.width,T*z.height)}createCanvasImage(){return document.createElement("img")}get description(){let z=this.name+this.version;return this._caps.parallelShaderCompile&&(z+=" - Parallel shader compilation"),z}_createTextureBase(z,a,K,m){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7?arguments[7]:void 0,r=arguments.length>8?arguments[8]:void 0,W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,F=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,l=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,V=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,c=arguments.length>13?arguments[13]:void 0,w=arguments.length>14?arguments[14]:void 0,f=arguments.length>15?arguments[15]:void 0;const Y="data:"===(z=z||"").substr(0,5),I="blob:"===z.substr(0,5),q=Y&&-1!==z.indexOf(";base64,"),B=F||new G.b(this,1);B!==F&&(B.label=z.substring(0,60));const x=z;!this._transformTextureUrl||q||F||W||(z=this._transformTextureUrl(z)),x!==z&&(B._originalUrl=x);const Z=z.lastIndexOf(".");let y=V||(Z>-1?z.substring(Z).toLowerCase():"");y.indexOf("?")>-1&&(y=y.split("?")[0]);const i=(0,C.e)(y,c);m&&m.addPendingData(B),B.url=z,B.generateMipMaps=!a,B.samplingMode=p,B.invertY=K,B._useSRGBBuffer=this._getUseSRGBBuffer(!!f,a),this._doNotHandleContextLost||(B._buffer=W);let n=null;j&&!F&&(n=B.onLoadedObservable.add(j)),F||this._internalTexturesCache.push(B);const X=(K,F)=>{m&&m.removePendingData(B),z===x?(n&&B.onLoadedObservable.remove(n),v.b.UseFallbackTexture&&z!==v.b.FallbackTexture&&this._createTextureBase(v.b.FallbackTexture,a,B.invertY,m,p,null,s,M,r,W,B),K=(K||"Unknown error")+(v.b.UseFallbackTexture?" - Fallback texture was used":""),B.onErrorObservable.notifyObservers({message:K,exception:F}),s&&s(K,F)):(T.c.Warn(`Failed to load ${z}, falling back to ${x}`),this._createTextureBase(x,a,B.invertY,m,p,j,s,M,r,W,B,l,V,c,w,f))};if(i){const a=async z=>{(await i).loadData(z,B,((z,a,K,v,T,j)=>{j?X("TextureLoader failed to load data"):M(B,y,m,{width:z,height:a},B.invertY,!K,v,(()=>(T(),!1)),p)}),w)};W?W instanceof ArrayBuffer?a(new Uint8Array(W)):ArrayBuffer.isView(W)?a(W):s&&s("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(z,(z=>a(new Uint8Array(z))),void 0,m?m.offlineProvider:void 0,!0,((z,a)=>{X("Unable to load "+(z&&z.responseURL,a))}))}else{const K=z=>{I&&!this._doNotHandleContextLost&&(B._buffer=z),M(B,y,m,z,B.invertY,a,!1,r,p)};!Y||q?W&&("string"===typeof W.decoding||W.close)?K(W):H._FileToolsLoadImage(z||"",K,X,m?m.offlineProvider:null,c,B.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof W||W instanceof ArrayBuffer||ArrayBuffer.isView(W)||W instanceof Blob?H._FileToolsLoadImage(W,K,X,m?m.offlineProvider:null,c,B.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):W&&K(W)}return B}_rebuildBuffers(){for(const z of this._uniformBuffers)z._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,l.g)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const z in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,z)&&(this._boundTexturesCache[z]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(z){this._name=z}static get NpmPackage(){return"babylonjs@7.33.0"}static get Version(){return"7.33.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(z){this._hardwareScalingLevel=z,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(z){this._doNotHandleContextLost=z}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(z,a,K){var T,m;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new s,this._stencilStateComposer=new M,this._stencilState=new r,this._alphaState=new W,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new V.c,this.onCanvasFocusObservable=new V.c,this.onNewSceneAddedObservable=new V.c,this.onResizeObservable=new V.c,this.onCanvasPointerOutObservable=new V.c,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new V.c,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new V.c,this.onAfterShaderCompilationObservable=new V.c,this.onBeginFrameObservable=new V.c,this.onEndFrameObservable=new V.c,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new V.c,this.onContextRestoredObservable=new V.c,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.lj=new V.c,v.b.Instances.push(this),this.startTime=j.d.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,p.b.SetMatrixPrecision(!!a.useHighPrecisionMatrix),(0,l.j)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=K??!1,a.antialias=z??a.antialias,a.deterministicLockstep=a.deterministicLockstep??!1,a.lockstepMaxSteps=a.lockstepMaxSteps??4,a.timeStep=a.timeStep??1/60,a.audioEngine=a.audioEngine??!0,a.stencil=a.stencil??!0,this._audioContext=(null===(T=a.audioEngineOptions)||void 0===T?void 0:T.audioContext)??null,this._audioDestination=(null===(m=a.audioEngineOptions)||void 0===m?void 0:m.audioDestination)??null,this.premultipliedAlpha=a.premultipliedAlpha??!0,this._doNotHandleContextLost=!!a.doNotHandleContextLost,this._isStencilEnable=!!a.stencil,this.useExactSrgbConversions=a.useExactSrgbConversions??!1;const F=(0,l.m)()&&window.devicePixelRatio||1,G=a.limitDeviceRatio||F;K=K||a.adaptToDeviceRatio||!1,this._hardwareScalingLevel=K?1/Math.min(G,F):1,this._lastDevicePixelRatio=F,this._creationOptions=a}resize(){let z,a,K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const z=(0,l.m)()&&window.devicePixelRatio||1,a=this._lastDevicePixelRatio/z;this._lastDevicePixelRatio=z,this._hardwareScalingLevel*=a}if((0,l.m)()&&(0,l.g)())if(this._renderingCanvas){const K=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};z=this._renderingCanvas.clientWidth||K.width||this._renderingCanvas.width||100,a=this._renderingCanvas.clientHeight||K.height||this._renderingCanvas.height||100}else z=window.innerWidth,a=window.innerHeight;else z=this._renderingCanvas?this._renderingCanvas.width:100,a=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(z/this._hardwareScalingLevel,a/this._hardwareScalingLevel,K)}setSize(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(z|=0,a|=0,!K&&this._renderingCanvas.width===z&&this._renderingCanvas.height===a)return!1;if(this._renderingCanvas.width=z,this._renderingCanvas.height=a,this.scenes){for(let z=0;z<this.scenes.length;z++){const a=this.scenes[z];for(let z=0;z<a.cameras.length;z++){a.cameras[z]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(z,a,K,v,T,m,p,j,s,M,r){throw(0,F.b)("engine.rawTexture")}createRawCubeTexture(z,a,K,v,T,m,p,j){throw(0,F.b)("engine.rawTexture")}createRawTexture3D(z,a,K,v,T,m,p,j,s,M,r){throw(0,F.b)("engine.rawTexture")}createRawTexture2DArray(z,a,K,v,T,m,p,j,s,M,r){throw(0,F.b)("engine.rawTexture")}_sharedInit(z){this._renderingCanvas=z}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const z=navigator.userAgent;this.hostInformation.isMobile=-1!==z.indexOf("Mobile")||-1!==z.indexOf("Mac")&&(0,l.g)()&&"ontouchend"in document},this._checkForMobile(),(0,l.m)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(z){return document.createElement("video")}_reportDrawCall(){var z;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(z=this._drawCalls)||void 0===z||z.addCount(a,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(z,a){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(z,a){return createImageBitmap(z,a)}resizeImageBitmap(z,a,K){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(z){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(z,a){if("undefined"===typeof document)return new OffscreenCanvas(z,a);const K=document.createElement("canvas");return K.width=z,K.height=a,K}createCanvas(z,a){return H._CreateCanvas(z,a)}static _FileToolsLoadImage(z,a,K,v,T,m){throw(0,F.b)("FileTools")}_loadFile(z,a,K,v,T,m){const p=(0,c.m)(z,a,K,v,T,m);return this._activeRequests.push(p),p.onCompleteObservable.add((()=>{const z=this._activeRequests.indexOf(p);-1!==z&&this._activeRequests.splice(z,1)})),p}static _FileToolsLoadFile(z,a,K,v,T,m){if(c.d.loadFile)return c.d.loadFile(z,a,K,v,T,m);throw(0,F.b)("FileTools")}dispose(){var z;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(z=this.releaseComputeEffects)||void 0===z||z.call(this),m.c.ResetCache();for(const K of this._activeRequests)K.abort();this._boundRenderFunction=null,this.lj.notifyObservers(this),this.lj.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,l.m)()&&window.removeEventListener("resize",this._checkForMobile);const a=v.b.Instances.indexOf(this);a>=0&&v.b.Instances.splice(a,1),v.b.Instances.length||(v.b.OnEnginesDisposedObservable.notifyObservers(this),v.b.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(z){throw(0,F.b)("LoadingScreen")}static MarkAllMaterialsAsDirty(z,a){for(let K=0;K<v.b.Instances.length;K++){const T=v.b.Instances[K];for(let K=0;K<T.scenes.length;K++)T.scenes[K].markAllMaterialsAsDirty(z,a)}}}H._RenderPassIdCounter=0,H._RescalePostProcessFactory=null,H.CollisionsEpsilon=.001,H.QueueNewFrame=w},11410:(z,a,K)=>{"use strict";K.d(a,{d:()=>B});var v=K(10748),T=K(10680),m=K(11377),p=K(10658);class j{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new s(z)}sampleFrame(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.d.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const a=z-this._lastFrameTimeMs;this._rollingFrameTime.add(a)}this._lastFrameTimeMs=z}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const z=this._rollingFrameTime.history(0);return 0===z?0:1e3/z}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class s{constructor(z){this._samples=new Array(z),this.reset()}add(z){let a;if(this.isSaturated()){const z=this._samples[this._pos];a=z-this.average,this.average-=a/(this._sampleCount-1),this._m2-=a*(z-this.average)}else this._sampleCount++;a=z-this.average,this.average+=a/this._sampleCount,this._m2+=a*(z-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=z,this._pos++,this._pos%=this._samples.length}history(z){if(z>=this._sampleCount||z>=this._samples.length)return 0;const a=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(a-z)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(z){const a=this._samples.length;return(z%a+a)%a}}var M=K(11388),r=K(10648),W=K(11397),F=(K(11407),K(10782));function G(z,a,K,v){let T,m=1;1===v?T=new Float32Array(a*K*4):2===v?(T=new Uint16Array(a*K*4),m=15360):T=7===v?new Uint32Array(a*K*4):new Uint8Array(a*K*4);for(let p=0;p<a;p++)for(let v=0;v<K;v++){const K=3*(v*a+p),j=4*(v*a+p);T[j+0]=z[K+0],T[j+1]=z[K+1],T[j+2]=z[K+2],T[j+3]=m}return T}function l(z){return function(a,K,T,m,p,j,s,M){let r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const F=z?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,G=z?10:11,l=new v.b(this,G);l.baseWidth=K,l.baseHeight=T,l.baseDepth=m,l.width=K,l.height=T,l.depth=m,l.format=p,l.type=W,l.generateMipMaps=j,l.samplingMode=M,z?l.is3D=!0:l.is2DArray=!0,this._doNotHandleContextLost||(l._bufferView=a),z?this.updateRawTexture3D(l,a,p,s,r,W):this.updateRawTexture2DArray(l,a,p,s,r,W),this._bindTextureDirectly(F,l,!0);const V=this._getSamplingParameters(M,j);return this._gl.texParameteri(F,this._gl.TEXTURE_MAG_FILTER,V.mag),this._gl.texParameteri(F,this._gl.TEXTURE_MIN_FILTER,V.min),j&&this._gl.generateMipmap(F),this._bindTextureDirectly(F,null),this._internalTexturesCache.push(l),l}}function V(z){return function(a,K,v,T){let m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const j=z?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,s=this._getWebGLTextureType(p),M=this._getInternalFormat(v),r=this._getRGBABufferInternalSizedFormat(p,v);this._bindTextureDirectly(j,a,!0),this._unpackFlipY(void 0===T||!!T),this._doNotHandleContextLost||(a._bufferView=K,a.format=v,a.invertY=T,a._compression=m),a.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),m&&K?this._gl.compressedTexImage3D(j,0,this.getCaps().s3tc[m],a.width,a.height,a.depth,0,K):this._gl.texImage3D(j,0,r,a.width,a.height,a.depth,0,M,s,K),a.generateMipMaps&&this._gl.generateMipmap(j),this._bindTextureDirectly(j,null),a.isReady=!0}}m.ThinEngine.prototype.updateRawTexture=function(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!z)return;const j=this._getRGBABufferInternalSizedFormat(m,K,p),s=this._getInternalFormat(K),M=this._getWebGLTextureType(m);this._bindTextureDirectly(this._gl.TEXTURE_2D,z,!0),this._unpackFlipY(void 0===v||!!v),this._doNotHandleContextLost||(z._bufferView=a,z.format=K,z.type=m,z.invertY=v,z._compression=T),z.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),T&&a?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[T],z.width,z.height,0,a):this._gl.texImage2D(this._gl.TEXTURE_2D,0,j,z.width,z.height,0,s,M,a),z.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),z.isReady=!0},m.ThinEngine.prototype.createRawTexture=function(z,a,K,T,m,p,j){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,r=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const W=new v.b(this,3);W.baseWidth=a,W.baseHeight=K,W.width=a,W.height=K,W.format=T,W.generateMipMaps=m,W.samplingMode=j,W.invertY=p,W._compression=s,W.type=M,W._useSRGBBuffer=this._getUseSRGBBuffer(r,!m),this._doNotHandleContextLost||(W._bufferView=z),this.updateRawTexture(W,z,T,p,s,M,W._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,W,!0);const F=this._getSamplingParameters(j,m);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,F.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,F.min),m&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(W),W},m.ThinEngine.prototype.createRawCubeTexture=function(z,a,K,T,m,p,j){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const M=this._gl,W=new v.b(this,8);W.isCube=!0,W.format=K,W.type=T,this._doNotHandleContextLost||(W._bufferViewArray=z);const G=this._getWebGLTextureType(T);let l=this._getInternalFormat(K);l===M.RGB&&(l=M.RGBA),G!==M.FLOAT||this._caps.textureFloatLinearFiltering?G!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?G!==M.FLOAT||this._caps.textureFloatRender?G!==M.HALF_FLOAT||this._caps.colorBufferFloat||(m=!1,r.c.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(m=!1,r.c.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(m=!1,j=1,r.c.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(m=!1,j=1,r.c.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const V=a,c=V;W.width=V,W.height=c,W.invertY=p,W._compression=s;if(!this.needPOTTextures||(0,F.i)(W.width)&&(0,F.i)(W.height)||(m=!1),z)this.updateRawCubeTexture(W,z,K,T,p,s);else{const z=this._getRGBABufferInternalSizedFormat(T),a=0;this._bindTextureDirectly(M.TEXTURE_CUBE_MAP,W,!0);for(let K=0;K<6;K++)s?M.compressedTexImage2D(M.TEXTURE_CUBE_MAP_POSITIVE_X+K,a,this.getCaps().s3tc[s],W.width,W.height,0,void 0):M.texImage2D(M.TEXTURE_CUBE_MAP_POSITIVE_X+K,a,z,W.width,W.height,0,l,G,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,W,!0),z&&m&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const C=this._getSamplingParameters(j,m);return M.texParameteri(M.TEXTURE_CUBE_MAP,M.TEXTURE_MAG_FILTER,C.mag),M.texParameteri(M.TEXTURE_CUBE_MAP,M.TEXTURE_MIN_FILTER,C.min),M.texParameteri(M.TEXTURE_CUBE_MAP,M.TEXTURE_WRAP_S,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_CUBE_MAP,M.TEXTURE_WRAP_T,M.CLAMP_TO_EDGE),this._bindTextureDirectly(M.TEXTURE_CUBE_MAP,null),W.generateMipMaps=m,W.samplingMode=j,W.isReady=!0,W},m.ThinEngine.prototype.updateRawCubeTexture=function(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;z._bufferViewArray=a,z.format=K,z.type=v,z.invertY=T,z._compression=m;const j=this._gl,s=this._getWebGLTextureType(v);let M=this._getInternalFormat(K);const r=this._getRGBABufferInternalSizedFormat(v);let W=!1;M===j.RGB&&(M=j.RGBA,W=!0),this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,z,!0),this._unpackFlipY(void 0===T||!!T),z.width%4!==0&&j.pixelStorei(j.UNPACK_ALIGNMENT,1);for(let F=0;F<6;F++){let K=a[F];m?j.compressedTexImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+F,p,this.getCaps().s3tc[m],z.width,z.height,0,K):(W&&(K=G(K,z.width,z.height,v)),j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+F,p,r,z.width,z.height,0,M,s,K))}(!this.needPOTTextures||(0,F.i)(z.width)&&(0,F.i)(z.height))&&z.generateMipMaps&&0===p&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),z.isReady=!0},m.ThinEngine.prototype.createRawCubeTextureFromUrl=function(z,a,K,v,T,m,p,j){let s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,r=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,W=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const F=this._gl,l=this.createRawCubeTexture(null,K,v,T,!m,W,r,null);null===a||void 0===a||a.addPendingData(l),l.url=z,l.isReady=!1,this._internalTexturesCache.push(l);const V=z=>{const K=l.width,m=p(z);if(m){if(j){const z=this._getWebGLTextureType(T);let a=this._getInternalFormat(v);const p=this._getRGBABufferInternalSizedFormat(T);let s=!1;a===F.RGB&&(a=F.RGBA,s=!0),this._bindTextureDirectly(F.TEXTURE_CUBE_MAP,l,!0),this._unpackFlipY(!1);const M=j(m);for(let v=0;v<M.length;v++){const m=K>>v;for(let K=0;K<6;K++){let j=M[v][K];s&&(j=G(j,m,m,T)),F.texImage2D(K,v,p,m,m,0,a,z,j)}}this._bindTextureDirectly(F.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(l,m,v,T,W);l.isReady=!0,null===a||void 0===a||a.removePendingData(l),l.onLoadedObservable.notifyObservers(l),l.onLoadedObservable.clear(),s&&s()}};return this._loadFile(z,(z=>{V(z)}),void 0,null===a||void 0===a?void 0:a.offlineProvider,!0,((z,K)=>{null===a||void 0===a||a.removePendingData(l),M&&z&&M(z.status+" "+z.statusText,K)})),l},m.ThinEngine.prototype.createRawTexture2DArray=l(!1),m.ThinEngine.prototype.createRawTexture3D=l(!0),m.ThinEngine.prototype.updateRawTexture2DArray=V(!1),m.ThinEngine.prototype.updateRawTexture3D=V(!0);var c=K(10702);m.ThinEngine.prototype._readTexturePixelsSync=function(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],j=arguments.length>7&&void 0!==arguments[7]&&arguments[7],s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const r=this._gl;if(!r)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const z=r.createFramebuffer();if(!z)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=z}var W,F;(r.bindFramebuffer(r.FRAMEBUFFER,this._dummyFramebuffer),v>-1)?r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+v,null===(W=z._hardwareTexture)||void 0===W?void 0:W.underlyingResource,T):r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null===(F=z._hardwareTexture)||void 0===F?void 0:F.underlyingResource,T);let G=void 0!==z.type?this._getWebGLTextureType(z.type):r.UNSIGNED_BYTE;if(j)m||(m=(0,c.n)(z.type,4*a*K));else if(G===r.UNSIGNED_BYTE)m||(m=new Uint8Array(4*a*K)),G=r.UNSIGNED_BYTE;else m||(m=new Float32Array(4*a*K)),G=r.FLOAT;return p&&this.flushFramebuffer(),r.readPixels(s,M,a,K,r.RGBA,G,m),r.bindFramebuffer(r.FRAMEBUFFER,this._currentFramebuffer),m},m.ThinEngine.prototype._readTexturePixels=function(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],j=arguments.length>7&&void 0!==arguments[7]&&arguments[7],s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(z,a,K,v,T,m,p,j,s,M))};K(11375);m.ThinEngine.prototype._createDepthStencilCubeTexture=function(z,a){const K=new v.b(this,12);if(K.isCube=!0,1===this.webGLVersion)return r.c.Error("Depth cube texture is not supported by WebGL 1."),K;const T={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...a},m=this._gl;this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,K,!0),this._setupDepthStencilTexture(K,z,T.bilinearFiltering,T.comparisonFunction);for(let v=0;v<6;v++)T.generateStencil?m.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,m.DEPTH24_STENCIL8,z,z,0,m.DEPTH_STENCIL,m.UNSIGNED_INT_24_8,null):m.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,m.DEPTH_COMPONENT24,z,z,0,m.DEPTH_COMPONENT,m.UNSIGNED_INT,null);return this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(K),K},m.ThinEngine.prototype._setCubeMapTextureParams=function(z,a,K){const v=this._gl;v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MIN_FILTER,a?v.LINEAR_MIPMAP_LINEAR:v.LINEAR),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),z.samplingMode=a?3:2,a&&this.getCaps().textureMaxLevel&&void 0!==K&&K>0&&(v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MAX_LEVEL,K),z._maxLodLevel=K),this._bindTextureDirectly(v.TEXTURE_CUBE_MAP,null)},m.ThinEngine.prototype.createCubeTexture=function(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]&&arguments[8],M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,W=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,G=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,l=arguments.length>13&&void 0!==arguments[13]&&arguments[13],V=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const c=this._gl;return this.createCubeTextureBase(z,a,K,!!v,T,m,p,j,s,M,W,G,(z=>this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,z,!0)),((z,a)=>{const K=this.needPOTTextures?(0,F.g)(a[0].width,this._caps.maxCubemapTextureSize):a[0].width,m=K,j=[c.TEXTURE_CUBE_MAP_POSITIVE_X,c.TEXTURE_CUBE_MAP_POSITIVE_Y,c.TEXTURE_CUBE_MAP_POSITIVE_Z,c.TEXTURE_CUBE_MAP_NEGATIVE_X,c.TEXTURE_CUBE_MAP_NEGATIVE_Y,c.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,z,!0),this._unpackFlipY(!1);const s=p?this._getInternalFormat(p,z._useSRGBBuffer):z._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:c.RGBA;let M=p?this._getInternalFormat(p):c.RGBA;z._useSRGBBuffer&&1===this.webGLVersion&&(M=s);for(let v=0;v<j.length;v++)if(a[v].width!==K||a[v].height!==m){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void r.c.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=K,this._workingCanvas.height=m,this._workingContext.drawImage(a[v],0,0,a[v].width,a[v].height,0,0,K,m),c.texImage2D(j[v],0,s,M,c.UNSIGNED_BYTE,this._workingCanvas)}else c.texImage2D(j[v],0,s,M,c.UNSIGNED_BYTE,a[v]);v||c.generateMipmap(c.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(z,!v),z.width=K,z.height=m,z.isReady=!0,p&&(z.format=p),z.onLoadedObservable.notifyObservers(z),z.onLoadedObservable.clear(),T&&T()}),!!l,V)},m.ThinEngine.prototype.generateMipMapsForCubemap=function(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(z.generateMipMaps){const K=this._gl;this._bindTextureDirectly(K.TEXTURE_CUBE_MAP,z,!0),K.generateMipmap(K.TEXTURE_CUBE_MAP),a&&this._bindTextureDirectly(K.TEXTURE_CUBE_MAP,null)}};K(11418);m.ThinEngine.prototype.setDepthStencilTexture=function(z,a,K,v){void 0!==z&&(a&&(this._boundUniforms[z]=a),K&&K.depthStencilTexture?this._setTexture(z,K,!1,!0,v):this._setTexture(z,null,void 0,void 0,v))},m.ThinEngine.prototype.createRenderTargetCubeTexture=function(z,a){const K=this._createHardwareRenderTargetWrapper(!1,!0,z),T={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...a};T.generateStencilBuffer=T.generateDepthBuffer&&T.generateStencilBuffer,(1!==T.type||this._caps.textureFloatLinearFiltering)&&(2!==T.type||this._caps.textureHalfFloatLinearFiltering)||(T.samplingMode=1);const m=this._gl,p=new v.b(this,5);this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,p,!0);const j=this._getSamplingParameters(T.samplingMode,T.generateMipMaps);1!==T.type||this._caps.textureFloat||(T.type=0,r.c.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_MAG_FILTER,j.mag),m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_MIN_FILTER,j.min),m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);for(let v=0;v<6;v++)m.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,this._getRGBABufferInternalSizedFormat(T.type,T.format),z,z,0,this._getInternalFormat(T.format),this._getWebGLTextureType(T.type),null);const s=m.createFramebuffer();return this._bindUnboundFramebuffer(s),K._depthStencilBuffer=this._setupFramebufferDepthAttachments(T.generateStencilBuffer,T.generateDepthBuffer,z,z),T.generateMipMaps&&m.generateMipmap(m.TEXTURE_CUBE_MAP),this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),K._framebuffer=s,K._generateDepthBuffer=T.generateDepthBuffer,K._generateStencilBuffer=T.generateStencilBuffer,p.width=z,p.height=z,p.isReady=!0,p.isCube=!0,p.samples=1,p.generateMipMaps=T.generateMipMaps,p.samplingMode=T.samplingMode,p.type=T.type,p.format=T.format,this._internalTexturesCache.push(p),K.setTextures(p),K};var C=K(11435),w=K(11143),H=K(11455);m.ThinEngine.prototype.createPrefilteredCubeTexture=function(z,a,K,T){let m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(z,a,null,!1,(z=>{if(!z)return void(m&&m(null));const p=z.texture;if(M?z.info.sphericalPolynomial&&(p._sphericalPolynomial=z.info.sphericalPolynomial):p._sphericalPolynomial=new C.f,p._source=9,this.getCaps().textureLOD)return void(m&&m(p));const j=this._gl,s=z.width;if(!s)return;const W=[];for(let m=0;m<3;m++){const M=1-m/2,F=T,G=Math.log2(s)*K+T,l=F+(G-F)*M,V=Math.round(Math.min(Math.max(l,0),G)),c=new v.b(this,2);if(c.type=p.type,c.format=p.format,c.width=Math.pow(2,Math.max(Math.log2(s)-V,0)),c.height=c.width,c.isCube=!0,c._cachedWrapU=0,c._cachedWrapV=0,this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,c,!0),c.samplingMode=2,j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),z.isDDS){const a=z.info,K=z.data;this._unpackFlipY(a.isCompressed),H.e.UploadDDSLevels(this,c,K,a,!0,6,V)}else r.c.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,null);const C=new w.b(a);C._isCube=!0,C._texture=c,c.isReady=!0,W.push(C)}p._lodTextureHigh=W[2],p._lodTextureMid=W[1],p._lodTextureLow=W[0],m&&m(p)}),p,j,s,M,K,T)},m.ThinEngine.prototype.createUniformBuffer=function(z,a){const K=this._gl.createBuffer();if(!K)throw new Error("Unable to create uniform buffer");const v=new M.c(K);return this.bindUniformBuffer(v),z instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,z,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(z),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),v.references=1,v},m.ThinEngine.prototype.createDynamicUniformBuffer=function(z,a){const K=this._gl.createBuffer();if(!K)throw new Error("Unable to create dynamic uniform buffer");const v=new M.c(K);return this.bindUniformBuffer(v),z instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,z,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(z),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),v.references=1,v},m.ThinEngine.prototype.updateUniformBuffer=function(z,a,K,v){this.bindUniformBuffer(z),void 0===K&&(K=0),void 0===v?a instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,K,a):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,K,new Float32Array(a)):a instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,a.subarray(K,K+v)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(a).subarray(K,K+v)),this.bindUniformBuffer(null)},m.ThinEngine.prototype.bindUniformBuffer=function(z){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,z?z.underlyingResource:null)},m.ThinEngine.prototype.bindUniformBufferBase=function(z,a,K){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,a,z?z.underlyingResource:null)},m.ThinEngine.prototype.bindUniformBlock=function(z,a,K){const v=z.program,T=this._gl.getUniformBlockIndex(v,a);4294967295!==T&&this._gl.uniformBlockBinding(v,T,K)};var f=K(10640),Y=K(10715);Y.b.prototype.displayLoadingUI=function(){if(!(0,f.m)())return;const z=this.loadingScreen;z&&z.displayLoadingUI()},Y.b.prototype.hideLoadingUI=function(){if(!(0,f.m)())return;const z=this._loadingScreen;z&&z.hideLoadingUI()},Object.defineProperty(Y.b.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=Y.b.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(z){this._loadingScreen=z},enumerable:!0,configurable:!0}),Object.defineProperty(Y.b.prototype,"loadingUIText",{set:function(z){this.loadingScreen.loadingUIText=z},enumerable:!0,configurable:!0}),Object.defineProperty(Y.b.prototype,"loadingUIBackgroundColor",{set:function(z){this.loadingScreen.loadingUIBackgroundColor=z},enumerable:!0,configurable:!0}),Y.b.prototype.getInputElement=function(){return this._renderingCanvas},Y.b.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},Y.b.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},Y.b.prototype.getAspectRatio=function(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const K=z.viewport;return this.getRenderWidth(a)*K.width/(this.getRenderHeight(a)*K.height)},Y.b.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},Y.b.prototype._verifyPointerLock=function(){var z;null===(z=this._onPointerLockChange)||void 0===z||z.call(this)},Y.b.prototype.setAlphaEquation=function(z){if(this._alphaEquation!==z){switch(z){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=z}},Y.b.prototype.getInputElement=function(){return this._renderingCanvas},Y.b.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},Y.b.prototype.setDepthFunction=function(z){this._depthCullingState.depthFunc=z},Y.b.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},Y.b.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},Y.b.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},Y.b.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},Y.b.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},Y.b.prototype.setDepthWrite=function(z){this._depthCullingState.depthMask=z},Y.b.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},Y.b.prototype.setStencilBuffer=function(z){this._stencilState.stencilTest=z},Y.b.prototype.getStencilMask=function(){return this._stencilState.stencilMask},Y.b.prototype.setStencilMask=function(z){this._stencilState.stencilMask=z},Y.b.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},Y.b.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},Y.b.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},Y.b.prototype.setStencilFunction=function(z){this._stencilState.stencilFunc=z},Y.b.prototype.setStencilFunctionReference=function(z){this._stencilState.stencilFuncRef=z},Y.b.prototype.setStencilFunctionMask=function(z){this._stencilState.stencilFuncMask=z},Y.b.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},Y.b.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},Y.b.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},Y.b.prototype.setStencilOperationFail=function(z){this._stencilState.stencilOpStencilFail=z},Y.b.prototype.setStencilOperationDepthFail=function(z){this._stencilState.stencilOpDepthFail=z},Y.b.prototype.setStencilOperationPass=function(z){this._stencilState.stencilOpStencilDepthPass=z},Y.b.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},Y.b.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},Y.b.prototype.setAlphaConstants=function(z,a,K,v){this._alphaState.setAlphaBlendConstants(z,a,K,v)},Y.b.prototype.getAlphaMode=function(){return this._alphaMode},Y.b.prototype.getAlphaEquation=function(){return this._alphaEquation},Y.b.prototype.getRenderPassNames=function(){return this._renderPassNames},Y.b.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},Y.b.prototype.createRenderPassId=function(z){const a=++Y.b._RenderPassIdCounter;return this._renderPassNames[a]=z??"NONAME",a},Y.b.prototype.releaseRenderPassId=function(z){this._renderPassNames[z]=void 0;for(let a=0;a<this.scenes.length;++a){const K=this.scenes[a];for(let a=0;a<K.meshes.length;++a){const v=K.meshes[a];if(v.Vf)for(let a=0;a<v.Vf.length;++a){v.Vf[a]._removeDrawWrapper(z)}}}};K(11430);function I(z){if(z.requestPointerLock){const a=z.requestPointerLock();a instanceof Promise?a.then((()=>{z.focus()})).catch((()=>{})):z.focus()}}var q=K(10788);K(11502);class B extends m.ThinEngine{static get NpmPackage(){return Y.b.NpmPackage}static get Version(){return Y.b.Version}static get Instances(){return T.b.Instances}static get LastCreatedEngine(){return T.b.LastCreatedEngine}static get LastCreatedScene(){return T.b.LastCreatedScene}static DefaultLoadingScreenFactory(z){return Y.b.DefaultLoadingScreenFactory(z)}get _supportsHardwareTextureRescaling(){return!!B._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(z,a,K){if(super(z,a,K,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new j,this._drawCalls=new q.d,z&&(this._features.supportRenderPasses=!0,K=this._creationOptions,z.getContext)){const a=z;this._sharedInit(a)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(z){super._sharedInit(z),function(z,a,K){z._onCanvasFocus=()=>{z.onCanvasFocusObservable.notifyObservers(z)},z._onCanvasBlur=()=>{z.onCanvasBlurObservable.notifyObservers(z)},z._onCanvasContextMenu=a=>{z.disableContextMenu&&a.preventDefault()},a.addEventListener("focus",z._onCanvasFocus),a.addEventListener("blur",z._onCanvasBlur),a.addEventListener("contextmenu",z._onCanvasContextMenu),z._onBlur=()=>{z.disablePerformanceMonitorInBackground&&z.performanceMonitor.disable(),z._windowIsBackground=!0},z._onFocus=()=>{z.disablePerformanceMonitorInBackground&&z.performanceMonitor.enable(),z._windowIsBackground=!1},z._onCanvasPointerOut=K=>{document.elementFromPoint(K.clientX,K.clientY)!==a&&z.onCanvasPointerOutObservable.notifyObservers(K)};const v=z.getHostWindow();v&&"function"===typeof v.addEventListener&&(v.addEventListener("blur",z._onBlur),v.addEventListener("focus",z._onFocus)),a.addEventListener("pointerout",z._onCanvasPointerOut),K.doNotHandleTouchAction||function(z){z&&z.setAttribute&&(z.setAttribute("touch-action","none"),z.style.touchAction="none",z.style.webkitTapHighlightColor="transparent")}(a),!Y.b.audioEngine&&K.audioEngine&&Y.b.AudioEngineFactory&&(Y.b.audioEngine=Y.b.AudioEngineFactory(z.getRenderingCanvas(),z.getAudioContext(),z.getAudioDestination())),(0,f.g)()&&(z._onFullscreenChange=()=>{z.isFullscreen=!!document.fullscreenElement,z.isFullscreen&&z._pointerLockRequested&&a&&I(a)},document.addEventListener("fullscreenchange",z._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",z._onFullscreenChange,!1),z._onPointerLockChange=()=>{z.isPointerLock=document.pointerLockElement===a},document.addEventListener("pointerlockchange",z._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",z._onPointerLockChange,!1)),z.enableOfflineSupport=void 0!==Y.b.OfflineProviderFactory,z._deterministicLockstep=!!K.deterministicLockstep,z._lockstepMaxSteps=K.lockstepMaxSteps||0,z._timeStep=K.timeStep||1/60}(this,z,this._creationOptions)}resizeImageBitmap(z,a,K){return function(z,a,K,v){const T=z.createCanvas(K,v).getContext("2d");if(!T)throw new Error("Unable to get 2d context for resizeImageBitmap");return T.drawImage(a,0,0),T.getImageData(0,0,K,v).data}(this,z,a,K)}_createImageBitmapFromSource(z,a){return function(z,a,K){return new Promise(((v,T)=>{const m=new Image;m.onload=()=>{m.decode().then((()=>{z.createImageBitmap(m,K).then((z=>{v(z)}))}))},m.onerror=()=>{T(`Error loading image ${m.src}`)},m.src=a}))}(this,z,a)}switchFullscreen(z){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(z)}enterFullscreen(z){this.isFullscreen||(this._pointerLockRequested=z,this._renderingCanvas&&function(z){const a=z.requestFullscreen||z.webkitRequestFullscreen;a&&a.call(z)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const z=document;document.exitFullscreen?document.exitFullscreen():z.webkitCancelFullScreen&&z.webkitCancelFullScreen()}()}setDitheringState(z){z?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(z){z?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(z,a,K,v){const T=this._cachedViewport;return this._cachedViewport=null,this._viewport(z,a,K,v),T}scissorClear(z,a,K,v,T){this.enableScissor(z,a,K,v),this.clear(T,!0,!0,!0),this.disableScissor()}enableScissor(z,a,K,v){const T=this._gl;T.enable(T.SCISSOR_TEST),T.scissor(z,a,K,v)}disableScissor(){const z=this._gl;z.disable(z.SCISSOR_TEST)}_loadFileAsync(z,a,K){return new Promise(((v,T)=>{this._loadFile(z,(z=>{v(z)}),void 0,a,K,((z,a)=>{T(a)}))}))}getVertexShaderSource(z){const a=this._gl.getAttachedShaders(z);return a?this._gl.getShaderSource(a[0]):null}getFragmentShaderSource(z){const a=this._gl.getAttachedShaders(z);return a?this._gl.getShaderSource(a[1]):null}set framebufferDimensionsObject(z){this._framebufferDimensionsObject=z,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const z of this.scenes)z.resetCachedMaterial(),z._rebuildGeometries();for(const z of this._virtualScenes)z.resetCachedMaterial(),z._rebuildGeometries();super._rebuildBuffers()}getFontOffset(z){return function(z){const a=document.createElement("span");a.textContent="Hg",a.style.font=z;const K=document.createElement("div");K.style.display="inline-block",K.style.width="1px",K.style.height="0px",K.style.verticalAlign="bottom";const v=document.createElement("div");v.style.whiteSpace="nowrap",v.appendChild(a),v.appendChild(K),document.body.appendChild(v);let T=0,m=0;try{m=K.getBoundingClientRect().top-a.getBoundingClientRect().top,K.style.verticalAlign="baseline",T=K.getBoundingClientRect().top-a.getBoundingClientRect().top}finally{document.body.removeChild(v)}return{ascent:T,height:m,descent:m-T}}(z)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:z}=this.customAnimationFrameRequester;z&&z(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let z=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(z=!1),z&&(this.gj(),this._renderViews()||this._renderFrame(),this.hj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&I(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}gj(){this._measureFps(),super.gj()}_deletePipelineContext(z){const a=z;a&&a.program&&a.transformFeedback&&(this.deleteTransformFeedback(a.transformFeedback),a.transformFeedback=null),super._deletePipelineContext(z)}createShaderProgram(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;T=T||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const p=super.createShaderProgram(z,a,K,v,T,m);return this.onAfterShaderCompilationObservable.notifyObservers(this),p}_createShaderProgram(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const m=v.createProgram();if(z.program=m,!m)throw new Error("Unable to create program");if(v.attachShader(m,a),v.attachShader(m,K),this.webGLVersion>1&&T){const a=this.createTransformFeedback();this.bindTransformFeedback(a),this.setTranformFeedbackVaryings(m,T),z.transformFeedback=a}return v.linkProgram(m),this.webGLVersion>1&&T&&this.bindTransformFeedback(null),z.context=v,z.vertexShader=a,z.fragmentShader=K,z.isParallelCompiled||this._finalizePipelineContext(z),m}_releaseTexture(z){super._releaseTexture(z)}_releaseRenderTargetWrapper(z){super._releaseRenderTargetWrapper(z),this.scenes.forEach((a=>{a.postProcesses.forEach((a=>{a._outputTexture===z&&(a._outputTexture=null)})),a.cameras.forEach((a=>{a._postProcesses.forEach((a=>{a&&a._outputTexture===z&&(a._outputTexture=null)}))}))}))}_rescaleTexture(z,a,K,v,T){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const m=this.createRenderTargetTexture({width:a.width,height:a.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&B._RescalePostProcessFactory&&(this._rescalePostProcess=B._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const p=()=>{this._rescalePostProcess.onApply=function(a){a._bindTexture("textureSampler",z)};let p=K;p||(p=this.scenes[this.scenes.length-1]),p.postProcessManager.directRender([this._rescalePostProcess],m,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,a,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,v,0,0,a.width,a.height,0),this.unBindFramebuffer(m),m.dispose(),T&&T()},j=this._rescalePostProcess.getEffect();j?j.executeWhenCompiled(p):this._rescalePostProcess.onEffectCreatedObservable.addOnce((z=>{z.executeWhenCompiled(p)}))}}wrapWebGLTexture(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const p=new W.d(z,this._gl),j=new v.b(this,0,!0);return j._hardwareTexture=p,j.baseWidth=T,j.baseHeight=m,j.width=T,j.height=m,j.isReady=!0,j.useMipMaps=a,this.updateTextureSamplingMode(K,j),j}_uploadImageToTexture(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const T=this._gl,m=this._getWebGLTextureType(z.type),p=this._getInternalFormat(z.format),j=this._getRGBABufferInternalSizedFormat(z.type,p),s=z.isCube?T.TEXTURE_CUBE_MAP:T.TEXTURE_2D;this._bindTextureDirectly(s,z,!0),this._unpackFlipY(z.invertY);let M=T.TEXTURE_2D;z.isCube&&(M=T.TEXTURE_CUBE_MAP_POSITIVE_X+K),T.texImage2D(M,v,j,p,m,a),this._bindTextureDirectly(s,null,!0)}updateTextureComparisonFunction(z,a){if(1===this.webGLVersion)return void r.c.Error("WebGL 1 does not support texture comparison.");const K=this._gl;z.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,z,!0),0===a?(K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_COMPARE_FUNC,515),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_COMPARE_MODE,K.NONE)):(K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_COMPARE_FUNC,a),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_COMPARE_MODE,K.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,z,!0),0===a?(K.texParameteri(K.TEXTURE_2D,K.TEXTURE_COMPARE_FUNC,515),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_COMPARE_MODE,K.NONE)):(K.texParameteri(K.TEXTURE_2D,K.TEXTURE_COMPARE_FUNC,a),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_COMPARE_MODE,K.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),z._comparisonFunction=a}createInstancesBuffer(z){const a=this._gl.createBuffer();if(!a)throw new Error("Unable to create instance buffer");const K=new M.c(a);return K.lb=z,this.bindArrayBuffer(K),this._gl.bufferData(this._gl.ARRAY_BUFFER,z,this._gl.DYNAMIC_DRAW),K.references=1,K}deleteInstancesBuffer(z){this._gl.deleteBuffer(z)}_clientWaitAsync(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const v=this._gl;return new Promise(((T,m)=>{const p=()=>{const j=v.clientWaitSync(z,a,0);j!=v.WAIT_FAILED?j!=v.TIMEOUT_EXPIRED?T():setTimeout(p,K):m()};p()}))}_readPixelsAsync(z,a,K,v,T,m,p){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const j=this._gl,s=j.createBuffer();j.bindBuffer(j.PIXEL_PACK_BUFFER,s),j.bufferData(j.PIXEL_PACK_BUFFER,p.byteLength,j.STREAM_READ),j.readPixels(z,a,K,v,T,m,0),j.bindBuffer(j.PIXEL_PACK_BUFFER,null);const M=j.fenceSync(j.SYNC_GPU_COMMANDS_COMPLETE,0);return M?(j.flush(),this._clientWaitAsync(M,0,10).then((()=>(j.deleteSync(M),j.bindBuffer(j.PIXEL_PACK_BUFFER,s),j.getBufferSubData(j.PIXEL_PACK_BUFFER,0,p),j.bindBuffer(j.PIXEL_PACK_BUFFER,null),j.deleteBuffer(s),p)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(z,a){1===T.b.Instances.length&&Y.b.audioEngine&&(Y.b.audioEngine.dispose(),Y.b.audioEngine=null);const K=z.getHostWindow();K&&"function"===typeof K.removeEventListener&&(K.removeEventListener("blur",z._onBlur),K.removeEventListener("focus",z._onFocus)),a&&(a.removeEventListener("focus",z._onCanvasFocus),a.removeEventListener("blur",z._onCanvasBlur),a.removeEventListener("pointerout",z._onCanvasPointerOut),a.removeEventListener("contextmenu",z._onCanvasContextMenu)),(0,f.g)()&&(document.removeEventListener("fullscreenchange",z._onFullscreenChange),document.removeEventListener("mozfullscreenchange",z._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",z._onFullscreenChange),document.removeEventListener("msfullscreenchange",z._onFullscreenChange),document.removeEventListener("pointerlockchange",z._onPointerLockChange),document.removeEventListener("mspointerlockchange",z._onPointerLockChange),document.removeEventListener("mozpointerlockchange",z._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",z._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}B.ALPHA_DISABLE=0,B.ALPHA_ADD=1,B.ALPHA_COMBINE=2,B.ALPHA_SUBTRACT=3,B.ALPHA_MULTIPLY=4,B.ALPHA_MAXIMIZED=5,B.ALPHA_ONEONE=6,B.ALPHA_PREMULTIPLIED=7,B.ALPHA_PREMULTIPLIED_PORTERDUFF=8,B.ALPHA_INTERPOLATE=9,B.ALPHA_SCREENMODE=10,B.DELAYLOADSTATE_NONE=0,B.DELAYLOADSTATE_LOADED=1,B.DELAYLOADSTATE_LOADING=2,B.DELAYLOADSTATE_NOTLOADED=4,B.NEVER=512,B.ALWAYS=519,B.LESS=513,B.EQUAL=514,B.LEQUAL=515,B.GREATER=516,B.GEQUAL=518,B.NOTEQUAL=517,B.KEEP=7680,B.REPLACE=7681,B.INCR=7682,B.DECR=7683,B.INVERT=5386,B.INCR_WRAP=34055,B.DECR_WRAP=34056,B.TEXTURE_CLAMP_ADDRESSMODE=0,B.TEXTURE_WRAP_ADDRESSMODE=1,B.TEXTURE_MIRROR_ADDRESSMODE=2,B.TEXTUREFORMAT_ALPHA=0,B.TEXTUREFORMAT_LUMINANCE=1,B.TEXTUREFORMAT_LUMINANCE_ALPHA=2,B.TEXTUREFORMAT_RGB=4,B.TEXTUREFORMAT_RGBA=5,B.TEXTUREFORMAT_RED=6,B.TEXTUREFORMAT_R=6,B.TEXTUREFORMAT_RG=7,B.TEXTUREFORMAT_RED_INTEGER=8,B.TEXTUREFORMAT_R_INTEGER=8,B.TEXTUREFORMAT_RG_INTEGER=9,B.TEXTUREFORMAT_RGB_INTEGER=10,B.TEXTUREFORMAT_RGBA_INTEGER=11,B.TEXTURETYPE_UNSIGNED_BYTE=0,B.TEXTURETYPE_UNSIGNED_INT=0,B.TEXTURETYPE_FLOAT=1,B.TEXTURETYPE_HALF_FLOAT=2,B.TEXTURETYPE_BYTE=3,B.TEXTURETYPE_SHORT=4,B.TEXTURETYPE_UNSIGNED_SHORT=5,B.TEXTURETYPE_INT=6,B.TEXTURETYPE_UNSIGNED_INTEGER=7,B.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,B.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,B.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,B.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,B.TEXTURETYPE_UNSIGNED_INT_24_8=12,B.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,B.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,B.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,B.TEXTURE_NEAREST_SAMPLINGMODE=1,B.TEXTURE_BILINEAR_SAMPLINGMODE=2,B.TEXTURE_TRILINEAR_SAMPLINGMODE=3,B.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,B.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,B.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,B.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,B.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,B.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,B.TEXTURE_NEAREST_LINEAR=7,B.TEXTURE_NEAREST_NEAREST=1,B.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,B.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,B.TEXTURE_LINEAR_LINEAR=2,B.TEXTURE_LINEAR_NEAREST=12,B.TEXTURE_EXPLICIT_MODE=0,B.TEXTURE_SPHERICAL_MODE=1,B.TEXTURE_PLANAR_MODE=2,B.TEXTURE_CUBIC_MODE=3,B.TEXTURE_PROJECTION_MODE=4,B.TEXTURE_SKYBOX_MODE=5,B.TEXTURE_INVCUBIC_MODE=6,B.TEXTURE_EQUIRECTANGULAR_MODE=7,B.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,B.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,B.SCALEMODE_FLOOR=1,B.SCALEMODE_NEAREST=2,B.SCALEMODE_CEILING=3},10680:(z,a,K)=>{"use strict";K.d(a,{b:()=>T});var v=K(10638);class T{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}T.Instances=[],T.OnEnginesDisposedObservable=new v.c,T._LastCreatedScene=null,T.UseFallbackTexture=!0,T.FallbackTexture=""},12423:(z,a,K)=>{"use strict";K(10648);var v=K(11410);K(10748),K(11007),K(10743),K(11425),K(11380);v.d},10743:(z,a,K)=>{"use strict";K.d(a,{b:()=>v});class v{static SetMatrixPrecision(z){if(v.MatrixTrackPrecisionChange=!1,z&&!v.MatrixUse64Bits&&v.MatrixTrackedMatrices)for(let a=0;a<v.MatrixTrackedMatrices.length;++a){const z=v.MatrixTrackedMatrices[a],K=z.Rj;z.Rj=new Array(16);for(let a=0;a<16;++a)z.Rj[a]=K[a]}v.MatrixUse64Bits=z,v.MatrixCurrentType=v.MatrixUse64Bits?Array:Float32Array,v.MatrixTrackedMatrices=null}}v.MatrixUse64Bits=!1,v.MatrixTrackPrecisionChange=!0,v.MatrixCurrentType=Float32Array,v.MatrixTrackedMatrices=[]},11425:(z,a,K)=>{"use strict";K.d(a,{e:()=>v});class v{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var z;return(null===(z=this._textures)||void 0===z?void 0:z[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(z){var a,K;if(!this._textures)return-1;const v=this._textures[z],T=(null===(a=this._layerIndices)||void 0===a?void 0:a[z])??0,m=(null===(K=this._faceIndices)||void 0===K?void 0:K[z])??0;return v.isCube?6*T+m:v.is3D?0:T}get samples(){return this._samples}setSamples(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===z&&!K)return z;const v=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,z,a):this._engine.updateRenderTargetTextureSampleCount(this,z);return this._samples=z,v}constructor(z,a,K,v,T){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=z,this._isCube=a,this._size=K,this._engine=v,this._depthStencilTexture=null,this.label=T}setTextures(z){Array.isArray(z)?this._textures=z:this._textures=z?[z]:null}setTexture(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[a]!==z&&(this._textures[a]&&K&&this._textures[a].dispose(),this._textures[a]=z)}setLayerAndFaceIndices(z,a){this._layerIndices=z,this._faceIndices=a}setLayerAndFaceIndex(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1?arguments[1]:void 0,K=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==a&&a>=0&&(this._layerIndices[z]=a),void 0!==K&&K>=0&&(this._faceIndices[z]=K)}createDepthStencilTexture(){var z;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,K=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,p=arguments.length>5?arguments[5]:void 0;return null===(z=this._depthStencilTexture)||void 0===z||z.dispose(),this._depthStencilTextureWithStencil=v,this._depthStencilTextureLabel=p,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:K,comparisonFunction:a,generateStencil:v,isCube:this._isCube,samples:T,depthTextureFormat:m,label:p},this),this._depthStencilTexture}_shareDepth(z){this.shareDepth(z)}shareDepth(z){this._depthStencilTexture&&(z._depthStencilTexture&&z._depthStencilTexture.dispose(),z._depthStencilTexture=this._depthStencilTexture,z._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(z){this.texture&&this.texture._swapAndDie(z),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let z=null;if(this._isMulti){const a=this.textures;if(a&&a.length>0){let K=!1,v=a.length,T=-1;const m=a[a.length-1]._source;14!==m&&12!==m||(K=!0,T=a[a.length-1].format,v--);const p=[],j=[],s=[],M=[],r=[],W=[],F=[],G={};for(let z=0;z<v;++z){const K=a[z];p.push(K.samplingMode),j.push(K.type),s.push(K.format);void 0!==G[K.uniqueId]?(M.push(-1),F.push(0)):(G[K.uniqueId]=z,K.is2DArray?(M.push(35866),F.push(K.depth)):K.isCube?(M.push(34067),F.push(0)):K.is3D?(M.push(32879),F.push(K.depth)):(M.push(3553),F.push(0))),this._faceIndices&&r.push(this._faceIndices[z]??0),this._layerIndices&&W.push(this._layerIndices[z]??0)}const l={samplingModes:p,generateMipMaps:a[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:K,depthTextureFormat:T,types:j,formats:s,textureCount:v,targetTypes:M,faceIndex:r,layerIndex:W,layerCounts:F,label:this.label},V={width:this.width,height:this.height,depth:this.depth};z=this._engine.createMultipleRenderTarget(V,l);for(let c=0;c<v;++c){if(-1!==M[c])continue;const K=G[a[c].uniqueId];z.setTexture(z.textures[K],c)}}}else{var a,K,v,T;const p={};if(p.generateDepthBuffer=this._generateDepthBuffer,p.generateMipMaps=(null===(a=this.texture)||void 0===a?void 0:a.generateMipMaps)??!1,p.generateStencilBuffer=this._generateStencilBuffer,p.samplingMode=null===(K=this.texture)||void 0===K?void 0:K.samplingMode,p.type=null===(v=this.texture)||void 0===v?void 0:v.type,p.format=null===(T=this.texture)||void 0===T?void 0:T.format,p.noColorAttachment=!this._textures,p.label=this.label,this.isCube)z=this._engine.createRenderTargetCubeTexture(this.width,p);else{var m;const a={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(m=this.texture)||void 0===m?void 0:m.depth:void 0};z=this._engine.createRenderTargetTexture(a,p)}z.texture&&(z.texture.isReady=!0)}return z}_swapRenderTargetWrapper(z){if(this._textures&&z._textures)for(let a=0;a<this._textures.length;++a)this._textures[a]._swapAndDie(z._textures[a],!1),z._textures[a].isReady=!0;this._depthStencilTexture&&z._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(z._depthStencilTexture),z._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const z=this._cloneRenderTargetWrapper();if(z){if(this._depthStencilTexture){const a=this._depthStencilTexture.samplingMode,K=this._depthStencilTexture.format,v=2===a||3===a||11===a;z.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,v,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,K,this._depthStencilTextureLabel)}this.samples>1&&z.setSamples(this.samples),z._swapRenderTargetWrapper(this),z.dispose()}}releaseTextures(){if(this._textures)for(let a=0;a<(null===(z=this._textures)||void 0===z?void 0:z.length);++a){var z;this._textures[a].dispose()}this._textures=null}dispose(){var z;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(z=this._depthStencilTexture)||void 0===z||z.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},10726:(z,a,K)=>{"use strict";K.d(a,{b:()=>v});class v{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?v.ShadersRepository:v.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?v.ShadersStore:v.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?v.IncludesShadersStore:v.IncludesShadersStoreWGSL}}v.ShadersRepository="src/Shaders/",v.ShadersStore={},v.IncludesShadersStore={},v.ShadersRepositoryWGSL="src/ShadersWGSL/",v.ShadersStoreWGSL={},v.IncludesShadersStoreWGSL={}},10739:(z,a,K)=>{"use strict";K.d(a,{d:()=>F,e:()=>w,g:()=>G,j:()=>l,n:()=>C,r:()=>W,v:()=>M,x:()=>r,y:()=>s,B:()=>j});class v{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.kd._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(z){z&&this.program&&z(this.program)}setEngine(z){this.kd=z}_fillEffectInformation(z,a,K,v,T,m,p,j){const s=this.kd;if(s.supportsUniformBuffers)for(const r in a)z.bindUniformBlock(r,a[r]);let M;for(this.kd.getUniforms(this,K).forEach(((z,a)=>{v[K[a]]=z})),this._uniforms=v,M=0;M<T.length;M++){null==z.getUniform(T[M])&&(T.splice(M,1),M--)}T.forEach(((z,a)=>{m[z]=a}));for(const r of s.getAttributes(this,p))j.push(r)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(z,a){const K=this._valueCache[z],v=a.updateFlag;return(void 0===K||K!==v)&&(this._valueCache[z]=v,!0)}_cacheFloat2(z,a,K){let v=this._valueCache[z];if(!v||2!==v.length)return v=[a,K],this._valueCache[z]=v,!0;let T=!1;return v[0]!==a&&(v[0]=a,T=!0),v[1]!==K&&(v[1]=K,T=!0),T}_cacheFloat3(z,a,K,v){let T=this._valueCache[z];if(!T||3!==T.length)return T=[a,K,v],this._valueCache[z]=T,!0;let m=!1;return T[0]!==a&&(T[0]=a,m=!0),T[1]!==K&&(T[1]=K,m=!0),T[2]!==v&&(T[2]=v,m=!0),m}_cacheFloat4(z,a,K,v,T){let m=this._valueCache[z];if(!m||4!==m.length)return m=[a,K,v,T],this._valueCache[z]=m,!0;let p=!1;return m[0]!==a&&(m[0]=a,p=!0),m[1]!==K&&(m[1]=K,p=!0),m[2]!==v&&(m[2]=v,p=!0),m[3]!==T&&(m[3]=T,p=!0),p}setInt(z,a){const K=this._valueCache[z];void 0!==K&&K===a||this.kd.setInt(this._uniforms[z],a)&&(this._valueCache[z]=a)}setInt2(z,a,K){this._cacheFloat2(z,a,K)&&(this.kd.setInt2(this._uniforms[z],a,K)||(this._valueCache[z]=null))}setInt3(z,a,K,v){this._cacheFloat3(z,a,K,v)&&(this.kd.setInt3(this._uniforms[z],a,K,v)||(this._valueCache[z]=null))}setInt4(z,a,K,v,T){this._cacheFloat4(z,a,K,v,T)&&(this.kd.setInt4(this._uniforms[z],a,K,v,T)||(this._valueCache[z]=null))}setIntArray(z,a){this._valueCache[z]=null,this.kd.setIntArray(this._uniforms[z],a)}setIntArray2(z,a){this._valueCache[z]=null,this.kd.setIntArray2(this._uniforms[z],a)}setIntArray3(z,a){this._valueCache[z]=null,this.kd.setIntArray3(this._uniforms[z],a)}setIntArray4(z,a){this._valueCache[z]=null,this.kd.setIntArray4(this._uniforms[z],a)}setUInt(z,a){const K=this._valueCache[z];void 0!==K&&K===a||this.kd.setUInt(this._uniforms[z],a)&&(this._valueCache[z]=a)}setUInt2(z,a,K){this._cacheFloat2(z,a,K)&&(this.kd.setUInt2(this._uniforms[z],a,K)||(this._valueCache[z]=null))}setUInt3(z,a,K,v){this._cacheFloat3(z,a,K,v)&&(this.kd.setUInt3(this._uniforms[z],a,K,v)||(this._valueCache[z]=null))}setUInt4(z,a,K,v,T){this._cacheFloat4(z,a,K,v,T)&&(this.kd.setUInt4(this._uniforms[z],a,K,v,T)||(this._valueCache[z]=null))}setUIntArray(z,a){this._valueCache[z]=null,this.kd.setUIntArray(this._uniforms[z],a)}setUIntArray2(z,a){this._valueCache[z]=null,this.kd.setUIntArray2(this._uniforms[z],a)}setUIntArray3(z,a){this._valueCache[z]=null,this.kd.setUIntArray3(this._uniforms[z],a)}setUIntArray4(z,a){this._valueCache[z]=null,this.kd.setUIntArray4(this._uniforms[z],a)}setArray(z,a){this._valueCache[z]=null,this.kd.setArray(this._uniforms[z],a)}setArray2(z,a){this._valueCache[z]=null,this.kd.setArray2(this._uniforms[z],a)}setArray3(z,a){this._valueCache[z]=null,this.kd.setArray3(this._uniforms[z],a)}setArray4(z,a){this._valueCache[z]=null,this.kd.setArray4(this._uniforms[z],a)}setMatrices(z,a){a&&(this._valueCache[z]=null,this.kd.setMatrices(this._uniforms[z],a))}setMatrix(z,a){this._cacheMatrix(z,a)&&(this.kd.setMatrices(this._uniforms[z],a.kj())||(this._valueCache[z]=null))}setMatrix3x3(z,a){this._valueCache[z]=null,this.kd.setMatrix3x3(this._uniforms[z],a)}setMatrix2x2(z,a){this._valueCache[z]=null,this.kd.setMatrix2x2(this._uniforms[z],a)}setFloat(z,a){const K=this._valueCache[z];void 0!==K&&K===a||this.kd.setFloat(this._uniforms[z],a)&&(this._valueCache[z]=a)}setVector2(z,a){this._cacheFloat2(z,a.x,a.y)&&(this.kd.setFloat2(this._uniforms[z],a.x,a.y)||(this._valueCache[z]=null))}setFloat2(z,a,K){this._cacheFloat2(z,a,K)&&(this.kd.setFloat2(this._uniforms[z],a,K)||(this._valueCache[z]=null))}setVector3(z,a){this._cacheFloat3(z,a.x,a.y,a.z)&&(this.kd.setFloat3(this._uniforms[z],a.x,a.y,a.z)||(this._valueCache[z]=null))}setFloat3(z,a,K,v){this._cacheFloat3(z,a,K,v)&&(this.kd.setFloat3(this._uniforms[z],a,K,v)||(this._valueCache[z]=null))}setVector4(z,a){this._cacheFloat4(z,a.x,a.y,a.z,a.w)&&(this.kd.setFloat4(this._uniforms[z],a.x,a.y,a.z,a.w)||(this._valueCache[z]=null))}setQuaternion(z,a){this._cacheFloat4(z,a.x,a.y,a.z,a.w)&&(this.kd.setFloat4(this._uniforms[z],a.x,a.y,a.z,a.w)||(this._valueCache[z]=null))}setFloat4(z,a,K,v,T){this._cacheFloat4(z,a,K,v,T)&&(this.kd.setFloat4(this._uniforms[z],a,K,v,T)||(this._valueCache[z]=null))}setColor3(z,a){this._cacheFloat3(z,a.r,a.g,a.b)&&(this.kd.setFloat3(this._uniforms[z],a.r,a.g,a.b)||(this._valueCache[z]=null))}setColor4(z,a,K){this._cacheFloat4(z,a.r,a.g,a.b,K)&&(this.kd.setFloat4(this._uniforms[z],a.r,a.g,a.b,K)||(this._valueCache[z]=null))}setDirectColor4(z,a){this._cacheFloat4(z,a.r,a.g,a.b,a.a)&&(this.kd.setFloat4(this._uniforms[z],a.r,a.g,a.b,a.a)||(this._valueCache[z]=null))}_getVertexShaderCode(){return this.vertexShader?this.kd._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.kd._getShaderSource(this.fragmentShader):null}}var T=K(10702);const m=new WeakMap,p={_webGLVersion:2,cachedPipelines:{}};function j(z){let a=m.get(z);if(!a){if(!z)return p;a={_webGLVersion:z.TEXTURE_BINDING_3D?2:1,_context:z,cachedPipelines:{}},m.set(z,a)}return a}function s(z){m.delete(z)}function M(z,a,K,v,T,m){const p=j(v);m||(m=p._createShaderProgramInjection??F);return m(z,c(a,"vertex",v,p._contextWasLost),c(K,"fragment",v,p._contextWasLost),v,T,p.validateShaderPrograms)}function r(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6?arguments[6]:void 0;const s=j(T);p||(p=s._createShaderProgramInjection??F);const M=s._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return p(z,V(a,"vertex",v,M,T,s._contextWasLost),V(K,"fragment",v,M,T,s._contextWasLost),T,m,s.validateShaderPrograms)}function W(z,a){const K=new v,T=j(z);return T.parallelShaderCompile&&(K.isParallelCompiled=!0),K.context=T._context,K}function F(z,a,K,v){let T=arguments.length>5?arguments[5]:void 0;const m=v.createProgram();if(z.program=m,!m)throw new Error("Unable to create program");return v.attachShader(m,a),v.attachShader(m,K),v.linkProgram(m),z.context=v,z.vertexShader=a,z.fragmentShader=K,z.isParallelCompiled||G(z,v,T),m}function G(z,a,K){const v=z.context,T=z.vertexShader,m=z.fragmentShader,p=z.program;if(!v.getProgramParameter(p,v.LINK_STATUS)){if(!a.getShaderParameter(T,a.COMPILE_STATUS)){const K=a.getShaderInfoLog(T);if(K)throw z.vertexCompilationError=K,new Error("VERTEX SHADER "+K)}if(!a.getShaderParameter(m,a.COMPILE_STATUS)){const K=a.getShaderInfoLog(m);if(K)throw z.fragmentCompilationError=K,new Error("FRAGMENT SHADER "+K)}const K=v.getProgramInfoLog(p);if(K)throw z.programLinkError=K,new Error(K)}if(K){v.validateProgram(p);if(!v.getProgramParameter(p,v.VALIDATE_STATUS)){const a=v.getProgramInfoLog(p);if(a)throw z.programValidationError=a,new Error(a)}}v.deleteShader(T),v.deleteShader(m),z.vertexShader=void 0,z.fragmentShader=void 0,z.onCompiled&&(z.onCompiled(),z.onCompiled=void 0)}function l(z,a,K,v,T,m,p,s,W){let F=arguments.length>10?arguments[10]:void 0,G=arguments.length>11?arguments[11]:void 0,l=arguments.length>12?arguments[12]:void 0;const V=j(z.context);G||(G=V.createRawShaderProgramInjection??M),l||(l=V.createShaderProgramInjection??r);const c=z;c.program=v?G(c,a,K,c.context,W):l(c,a,K,s,c.context,W),c.program.__SPECTOR_rebuildProgram=p,F()}function V(z,a,K,v,m,p){return c((0,T.h)(z,K,v),a,m,p)}function c(z,a,K,v){const T=K.createShader("vertex"===a?K.VERTEX_SHADER:K.FRAGMENT_SHADER);if(!T){let z=K.NO_ERROR,T=K.NO_ERROR;for(;(T=K.getError())!==K.NO_ERROR;)z=T;throw new Error(`Something went wrong while creating a gl ${a} shader object. gl error=${z}, gl isContextLost=${K.isContextLost()}, _contextWasLost=${v}`)}return K.shaderSource(T,z),K.compileShader(T),T}function C(z,a){a.useProgram(z)}function w(z,a){const K=z;if(!K.isParallelCompiled)return void a(z);const v=K.onCompiled;K.onCompiled=()=>{null===v||void 0===v||v(),a(z)}}},11377:(z,a,K)=>{"use strict";K.r(a),K.d(a,{ThinEngine:()=>H});var v=K(10739),T=K(11380),m=K(10648),p=K(10640);class j{constructor(){this.shaderLanguage=0}postProcessor(z,a,K,v,T){if(T.drawBuffersExtensionDisabled){const a=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;z=z.replace(a,"")}return z}}const s=/(flat\s)?\s*varying\s*.*/;class M{constructor(){this.shaderLanguage=0}attributeProcessor(z){return z.replace("attribute","in")}varyingCheck(z,a){return s.test(z)}varyingProcessor(z,a){return z.replace("varying",a?"in":"out")}postProcessor(z,a,K){const v=-1!==z.search(/#extension.+GL_EXT_draw_buffers.+require/);if(z=(z=z.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),K){const a=-1!==z.search(/layout *\(location *= *0\) *out/g);z=(z=(z=(z=(z=(z=(z=z.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(v||a?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==a.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+z}return z}}var r=K(11388),W=K(10782),F=K(10715),G=K(11397),l=K(10748),V=K(10720),c=K(10702),C=K(10730);class w{}class H extends F.b{get name(){return this._name}set name(z){this._name=z}get version(){return this._webGLVersion}static get ShadersRepository(){return V.c.ShadersRepository}static set ShadersRepository(z){V.c.ShadersRepository=z}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(z){this._framebufferDimensionsObject=z}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(z,a,K,T){if(K=K||{},super(a??K.antialias,K,T),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!z)return;let p=null;if(z.getContext){if(p=z,this._renderingCanvas=p,void 0===K.dh&&(K.dh=!1),void 0===K.xrCompatible&&(K.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const z=navigator.userAgent;for(const a of H.ExceptionList){const v=a.key,T=a.targets;if(new RegExp(v).test(z)){if(a.capture&&a.captureConstraint){const K=a.capture,v=a.captureConstraint,T=new RegExp(K).exec(z);if(T&&T.length>0){if(parseInt(T[T.length-1])>=v)continue}}for(const z of T)switch(z){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":K.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=z=>{z.preventDefault(),this._contextWasLost=!0,m.c.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},p.addEventListener("webglcontextlost",this._onContextLost,!1),p.addEventListener("webglcontextrestored",this._onContextRestored,!1),K.powerPreference=K.powerPreference||"high-performance"),this._badDesktopOS&&(K.xrCompatible=!1),!K.disableWebGL2Support)try{this._gl=p.getContext("webgl2",K)||p.getContext("experimental-webgl2",K),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(W){}if(!this._gl){if(!p)throw new Error("The provided canvas is null or undefined.");try{this._gl=p.getContext("webgl",K)||p.getContext("experimental-webgl",K)}catch(W){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=z,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const a=this._gl.getContextAttributes();a&&(K.stencil=a.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==K.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=K.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let v=0;v<this._caps.maxVertexAttribs;v++)this._currentBufferPointers[v]=new w;this._shaderProcessor=this.webGLVersion>1?new M:new j;const s=`Babylon.js v${H.Version}`;m.c.Log(s+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",s);const r=(0,v.B)(this._gl);r.validateShaderPrograms=this.validateShaderPrograms,r.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(z){return null}areAllEffectsReady(){for(const z in this._compiledEffects){if(!this._compiledEffects[z].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const z=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=z&&(this._glRenderer=this._gl.getParameter(z.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(z.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const z=this._gl.getExtension("WEBGL_draw_buffers");if(null!==z){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=z.drawBuffersWEBGL.bind(z),this._caps.maxDrawBuffers=this._gl.getParameter(z.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let a=0;a<16;a++)this._gl["COLOR_ATTACHMENT"+a+"_WEBGL"]=z["COLOR_ATTACHMENT"+a+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const z=this._gl.getExtension("WEBGL_depth_texture");null!=z&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=z.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const z=this._gl.getExtension("OES_vertex_array_object");null!=z&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=z.createVertexArrayOES.bind(z),this._gl.bindVertexArray=z.bindVertexArrayOES.bind(z),this._gl.deleteVertexArray=z.deleteVertexArrayOES.bind(z))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const z=this._gl.getExtension("ANGLE_instanced_arrays");null!=z?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=z.drawArraysInstancedANGLE.bind(z),this._gl.drawElementsInstanced=z.drawElementsInstancedANGLE.bind(z),this._gl.vertexAttribDivisor=z.vertexAttribDivisorANGLE.bind(z)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const z=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),a=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);z&&a&&(this._caps.highPrecisionShaderSupported=0!==z.precision&&0!==a.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const z=this._gl.getExtension("EXT_blend_minmax");null!=z&&(this._caps.blendMinMax=!0,this._gl.MAX=z.MAX_EXT,this._gl.MIN=z.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const z=this._gl.getExtension("EXT_sRGB");null!=z&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:z.SRGB_EXT,SRGB8:z.SRGB_ALPHA_EXT,SRGB8_ALPHA8:z.SRGB_ALPHA_EXT})}if(this._creationOptions){const z=this._creationOptions.forceSRGBBufferSupportState;void 0!==z&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&z)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let a=0;a<this._maxSimultaneousTextures;a++)this._nextFreeTextureSlots.push(a);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const z=this._workingCanvas.getContext("2d");z&&(this._workingContext=z)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const z=this.getGlInfo();return z&&z.renderer?z.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const T=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=T;let m=0;if(a&&z){let a=!0;if(this._currentRenderTarget){var p;const K=null===(p=this._currentRenderTarget.texture)||void 0===p?void 0:p.format;if(8===K||9===K||10===K||11===K){var j;const K=null===(j=this._currentRenderTarget.texture)||void 0===j?void 0:j.type;7===K||5===K?(H._TempClearColorUint32[0]=255*z.r,H._TempClearColorUint32[1]=255*z.g,H._TempClearColorUint32[2]=255*z.b,H._TempClearColorUint32[3]=255*z.a,this._gl.clearBufferuiv(this._gl.COLOR,0,H._TempClearColorUint32),a=!1):(H._TempClearColorInt32[0]=255*z.r,H._TempClearColorInt32[1]=255*z.g,H._TempClearColorInt32[2]=255*z.b,H._TempClearColorInt32[3]=255*z.a,this._gl.clearBufferiv(this._gl.COLOR,0,H._TempClearColorInt32),a=!1)}}a&&(this._gl.clearColor(z.r,z.g,z.b,void 0!==z.a?z.a:1),m|=this._gl.COLOR_BUFFER_BIT)}K&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),m|=this._gl.DEPTH_BUFFER_BIT),v&&(this._gl.clearStencil(0),m|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(m)}_viewport(z,a,K,v){z===this._viewportCached.x&&a===this._viewportCached.y&&K===this._viewportCached.z&&v===this._viewportCached.w||(this._viewportCached.x=z,this._viewportCached.y=a,this._viewportCached.z=K,this._viewportCached.w=v,this._gl.viewport(z,a,K,v))}hj(){super.hj(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0,v=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const s=z;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=z,this._bindUnboundFramebuffer(s._framebuffer);const M=this._gl;var r;if(!z.isMulti)if(z.is2DArray||z.is3D)M.framebufferTextureLayer(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,null===(r=z.texture._hardwareTexture)||void 0===r?void 0:r.underlyingResource,p,j),s._currentLOD=p;else if(z.isCube){var W;M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+a,null===(W=z.texture._hardwareTexture)||void 0===W?void 0:W.underlyingResource,p)}else if(s._currentLOD!==p){var F;M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_2D,null===(F=z.texture._hardwareTexture)||void 0===F?void 0:F.underlyingResource,p),s._currentLOD=p}const G=z._depthStencilTexture;if(G){z.is3D&&(z.texture.width===G.width&&z.texture.height===G.height&&z.texture.depth===G.depth||m.c.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const K=z._depthStencilTextureWithStencil?M.DEPTH_STENCIL_ATTACHMENT:M.DEPTH_ATTACHMENT;var l;if(z.is2DArray||z.is3D)M.framebufferTextureLayer(M.FRAMEBUFFER,K,null===(l=G._hardwareTexture)||void 0===l?void 0:l.underlyingResource,p,j);else if(z.isCube){var V;M.framebufferTexture2D(M.FRAMEBUFFER,K,M.TEXTURE_CUBE_MAP_POSITIVE_X+a,null===(V=G._hardwareTexture)||void 0===V?void 0:V.underlyingResource,p)}else{var c;M.framebufferTexture2D(M.FRAMEBUFFER,K,M.TEXTURE_2D,null===(c=G._hardwareTexture)||void 0===c?void 0:c.underlyingResource,p)}}s._MSAAFramebuffer&&this._bindUnboundFramebuffer(s._MSAAFramebuffer),this._cachedViewport&&!T?this.setViewport(this._cachedViewport,K,v):(K||(K=z.width,p&&(K/=Math.pow(2,p))),v||(v=z.height,p&&(v/=Math.pow(2,p))),this._viewport(0,0,K,v)),this.wipeCaches()}setState(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0,v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==z||K)&&(this._depthCullingState.cull=z);const j=this.cullBackFaces??T??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==j||K)&&(this._depthCullingState.cullFace=j),this.setZOffset(a),this.setZOffsetUnits(p);const s=v?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==s||K)&&(this._depthCullingState.frontFace=s),this._stencilStateComposer.stencilMaterial=m}_bindUnboundFramebuffer(z){this._currentFramebuffer!==z&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,z),this._currentFramebuffer=z)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(z){const a=this._getTextureTarget(z);this._bindTextureDirectly(a,z,!0),this._gl.generateMipmap(a),this._bindTextureDirectly(a,null)}unBindFramebuffer(z){var a;let K=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2?arguments[2]:void 0;const T=z;this._currentRenderTarget=null;const m=this._gl;if(T._MSAAFramebuffer){if(z.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(z,K,v);m.bindFramebuffer(m.READ_FRAMEBUFFER,T._MSAAFramebuffer),m.bindFramebuffer(m.DRAW_FRAMEBUFFER,T._framebuffer),m.blitFramebuffer(0,0,z.width,z.height,0,0,z.width,z.height,m.COLOR_BUFFER_BIT,m.NEAREST)}null===(a=z.texture)||void 0===a||!a.generateMipMaps||K||z.isCube||this.generateMipmaps(z.texture),v&&(T._MSAAFramebuffer&&this._bindUnboundFramebuffer(T._framebuffer),v()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(z,a,K){return this._createVertexBuffer(z,this._gl.STATIC_DRAW)}_createVertexBuffer(z,a){const K=this._gl.createBuffer();if(!K)throw new Error("Unable to create vertex buffer");const v=new r.c(K);return this.bindArrayBuffer(v),"number"!==typeof z?z instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(z),a),v.lb=4*z.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,z,a),v.lb=z.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(z),a),v.lb=z),this._resetVertexBufferBinding(),v.references=1,v}createDynamicVertexBuffer(z,a){return this._createVertexBuffer(z,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(z,a,K){const v=this._gl.createBuffer(),T=new r.c(v);if(!v)throw new Error("Unable to create index buffer");this.bindIndexBuffer(T);const m=this._normalizeIndexData(z);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,m,a?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),T.references=1,T.is32Bits=4===m.BYTES_PER_ELEMENT,T}_normalizeIndexData(z){if(2===z.BYTES_PER_ELEMENT)return z;if(this._caps.uintIndices){if(z instanceof Uint32Array)return z;for(let a=0;a<z.length;a++)if(z[a]>=65535)return new Uint32Array(z);return new Uint16Array(z)}return new Uint16Array(z)}bindArrayBuffer(z){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(z,this._gl.ARRAY_BUFFER)}bindUniformBlock(z,a,K){const v=z.program,T=this._gl.getUniformBlockIndex(v,a);this._gl.uniformBlockBinding(v,T,K)}bindIndexBuffer(z){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(z,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(z,a){(this._vaoRecordInProgress||this._currentBoundBuffer[a]!==z)&&(this._gl.bindBuffer(a,z?z.underlyingResource:null),this._currentBoundBuffer[a]=z)}updateArrayBuffer(z){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,z)}_vertexAttribPointer(z,a,K,v,T,m,p){const j=this._currentBufferPointers[a];if(!j)return;let s=!1;j.active?(j.buffer!==z&&(j.buffer=z,s=!0),j.size!==K&&(j.size=K,s=!0),j.type!==v&&(j.type=v,s=!0),j.normalized!==T&&(j.normalized=T,s=!0),j.stride!==m&&(j.stride=m,s=!0),j.offset!==p&&(j.offset=p,s=!0)):(s=!0,j.active=!0,j.index=a,j.size=K,j.type=v,j.normalized=T,j.stride=m,j.offset=p,j.buffer=z),(s||this._vaoRecordInProgress)&&(this.bindArrayBuffer(z),v===this._gl.UNSIGNED_INT||v===this._gl.INT?this._gl.vertexAttribIPointer(a,K,v,m,p):this._gl.vertexAttribPointer(a,K,v,T,m,p))}_bindIndexBufferWithCache(z){null!=z&&this._cachedIndexBuffer!==z&&(this._cachedIndexBuffer=z,this.bindIndexBuffer(z),this._uintIndicesCurrentlySet=z.is32Bits)}_bindVertexBuffersAttributes(z,a,K){const v=a.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let T=0;T<v.length;T++){const m=a.getAttributeLocation(T);if(m>=0){const a=v[T];let p=null;if(K&&(p=K[a]),p||(p=z[a]),!p)continue;this._gl.enableVertexAttribArray(m),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[m]=!0);const j=p.getBuffer();j&&(this._vertexAttribPointer(j,m,p.getSize(),p.type,p.normalized,p.byteStride,p.byteOffset),p.getIsInstanced()&&(this._gl.vertexAttribDivisor(m,p.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(m),this._currentInstanceBuffers.push(j))))}}}recordVertexArrayObject(z,a,K,v){const T=this._gl.createVertexArray();if(!T)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(T),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(z,K,v),this.bindIndexBuffer(a),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),T}bindVertexArrayObject(z,a){this._cachedVertexArrayObject!==z&&(this._cachedVertexArrayObject=z,this._gl.bindVertexArray(z),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=a&&a.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(z,a,K,v,T){if(this._cachedVertexBuffers!==z||this._cachedEffectForVertexBuffers!==T){this._cachedVertexBuffers=z,this._cachedEffectForVertexBuffers=T;const a=T.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let m=0;for(let p=0;p<a;p++)if(p<K.length){const a=T.getAttributeLocation(p);a>=0&&(this._gl.enableVertexAttribArray(a),this._vertexAttribArraysEnabled[a]=!0,this._vertexAttribPointer(z,a,K[p],this._gl.FLOAT,!1,v,m)),m+=4*K[p]}}this._bindIndexBufferWithCache(a)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(z,a,K,v){this._cachedVertexBuffers===z&&this._cachedEffectForVertexBuffers===K||(this._cachedVertexBuffers=z,this._cachedEffectForVertexBuffers=K,this._bindVertexBuffersAttributes(z,K,v)),this._bindIndexBufferWithCache(a)}unbindInstanceAttributes(){let z;for(let a=0,K=this._currentInstanceLocations.length;a<K;a++){const K=this._currentInstanceBuffers[a];z!=K&&K.references&&(z=K,this.bindArrayBuffer(K));const v=this._currentInstanceLocations[a];this._gl.vertexAttribDivisor(v,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(z){this._gl.deleteVertexArray(z)}_releaseBuffer(z){return z.references--,0===z.references&&(this._deleteBuffer(z),!0)}_deleteBuffer(z){this._gl.deleteBuffer(z.underlyingResource)}updateAndBindInstancesBuffer(z,a,K){if(this.bindArrayBuffer(z),a&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,a),void 0!==K[0].index)this.bindInstancesBuffer(z,K,!0);else for(let v=0;v<4;v++){const a=K[v];this._vertexAttribArraysEnabled[a]||(this._gl.enableVertexAttribArray(a),this._vertexAttribArraysEnabled[a]=!0),this._vertexAttribPointer(z,a,4,this._gl.FLOAT,!1,64,16*v),this._gl.vertexAttribDivisor(a,1),this._currentInstanceLocations.push(a),this._currentInstanceBuffers.push(z)}}bindInstancesBuffer(z,a){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(z);let v=0;if(K)for(let T=0;T<a.length;T++){v+=4*a[T].attributeSize}for(let T=0;T<a.length;T++){const K=a[T];void 0===K.index&&(K.index=this._currentEffect.getAttributeLocationByName(K.attributeName)),K.index<0||(this._vertexAttribArraysEnabled[K.index]||(this._gl.enableVertexAttribArray(K.index),this._vertexAttribArraysEnabled[K.index]=!0),this._vertexAttribPointer(z,K.index,K.attributeSize,K.attributeType||this._gl.FLOAT,K.normalized||!1,v,K.offset),this._gl.vertexAttribDivisor(K.index,void 0===K.divisor?1:K.divisor),this._currentInstanceLocations.push(K.index),this._currentInstanceBuffers.push(z))}}disableInstanceAttributeByName(z){if(!this._currentEffect)return;const a=this._currentEffect.getAttributeLocationByName(z);this.disableInstanceAttribute(a)}disableInstanceAttribute(z){let a,K=!1;for(;-1!==(a=this._currentInstanceLocations.indexOf(z));)this._currentInstanceLocations.splice(a,1),this._currentInstanceBuffers.splice(a,1),K=!0,a=this._currentInstanceLocations.indexOf(z);K&&(this._gl.vertexAttribDivisor(z,0),this.disableAttributeByIndex(z))}disableAttributeByIndex(z){this._gl.disableVertexAttribArray(z),this._vertexAttribArraysEnabled[z]=!1,this._currentBufferPointers[z].active=!1}draw(z,a,K,v){this.drawElementsType(z?0:1,a,K,v)}drawPointClouds(z,a,K){this.drawArraysType(2,z,a,K)}drawUnIndexed(z,a,K,v){this.drawArraysType(z?0:1,a,K,v)}drawElementsType(z,a,K,v){this.applyStates(),this._reportDrawCall();const T=this._drawMode(z),m=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,p=this._uintIndicesCurrentlySet?4:2;v?this._gl.drawElementsInstanced(T,K,m,a*p,v):this._gl.drawElements(T,K,m,a*p)}drawArraysType(z,a,K,v){this.applyStates(),this._reportDrawCall();const T=this._drawMode(z);v?this._gl.drawArraysInstanced(T,a,K,v):this._gl.drawArrays(T,a,K)}_drawMode(z){switch(z){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(z){this._compiledEffects[z._key]&&delete this._compiledEffects[z._key];const a=z.getPipelineContext();a&&this._deletePipelineContext(a)}_deletePipelineContext(z){const a=z;a&&a.program&&(a.program.__SPECTOR_rebuildProgram=null,(0,C.o)(a),this._gl.deleteProgram(a.program))}_getGlobalDefines(z){return(0,c.l)(z,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(z,a,K,T,m,p,j,s,M){let r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,W=arguments.length>10?arguments[10]:void 0;const F="string"===typeof z?z:z.vertexToken||z.vertexSource||z.vertexElement||z.vertex,G="string"===typeof z?z:z.fragmentToken||z.fragmentSource||z.fragmentElement||z.fragment,l=this._getGlobalDefines();let c=m??a.defines??"";l&&(c+=l);const C=F+"+"+G+"@"+c;if(this._compiledEffects[C]){const z=this._compiledEffects[C];return j&&z.isReady()&&j(z),z._refCount++,z}this._gl&&(0,v.B)(this._gl);const w=new V.c(z,a,K,T,this,m,p,j,s,M,C,a.shaderLanguage??r,a.extraInitializationsAsync??W);return this._compiledEffects[C]=w,w}_getShaderSource(z){return this._gl.getShaderSource(z)}createRawShaderProgram(z,a,K,T){let m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const p=(0,v.B)(this._gl);return p._contextWasLost=this._contextWasLost,p.validateShaderPrograms=this.validateShaderPrograms,(0,v.v)(z,a,K,T||this._gl,m)}createShaderProgram(z,a,K,T,m){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const j=(0,v.B)(this._gl);return j._contextWasLost=this._contextWasLost,j.validateShaderPrograms=this.validateShaderPrograms,(0,v.x)(z,a,K,T,m||this._gl,p)}inlineShaderCode(z){return z}createPipelineContext(z){if(this._gl){(0,v.B)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const a=(0,v.r)(this._gl,z);return a.kd=this,a}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(z){return(0,v.g)(z,this._gl,this.validateShaderPrograms)}_preparePipelineContext(z,a,K,T,m,p,j,s,M,r,W){const F=(0,v.B)(this._gl);return F._contextWasLost=this._contextWasLost,F.validateShaderPrograms=this.validateShaderPrograms,F._createShaderProgramInjection=this._createShaderProgram.bind(this),F.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),F.createShaderProgramInjection=this.createShaderProgram.bind(this),F.loadFileInjection=this._loadFile.bind(this),(0,v.j)(z,a,K,T,m,p,j,s,M,r,W)}_createShaderProgram(z,a,K,T){let m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,v.d)(z,a,K,T,m)}_isRenderingStateCompiled(z){const a=z;return!this._isDisposed&&!a._isDisposed&&(!!this._gl.getProgramParameter(a.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(a),!0))}_executeWhenRenderingStateIsCompiled(z,a){(0,v.e)(z,a)}getUniforms(z,a){const K=new Array,v=z;for(let T=0;T<a.length;T++)K.push(this._gl.getUniformLocation(v.program,a[T]));return K}getAttributes(z,a){const K=[],v=z;for(let m=0;m<a.length;m++)try{K.push(this._gl.getAttribLocation(v.program,a[m]))}catch(T){K.push(-1)}return K}enableEffect(z){(z=null!==z&&(0,T.e)(z)?z.effect:z)&&z!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(z),this._currentEffect=z,z.onBind&&z.onBind(z),z._onBindObservable&&z._onBindObservable.notifyObservers(z))}setInt(z,a){return!!z&&(this._gl.uniform1i(z,a),!0)}setInt2(z,a,K){return!!z&&(this._gl.uniform2i(z,a,K),!0)}setInt3(z,a,K,v){return!!z&&(this._gl.uniform3i(z,a,K,v),!0)}setInt4(z,a,K,v,T){return!!z&&(this._gl.uniform4i(z,a,K,v,T),!0)}setIntArray(z,a){return!!z&&(this._gl.uniform1iv(z,a),!0)}setIntArray2(z,a){return!(!z||a.length%2!==0)&&(this._gl.uniform2iv(z,a),!0)}setIntArray3(z,a){return!(!z||a.length%3!==0)&&(this._gl.uniform3iv(z,a),!0)}setIntArray4(z,a){return!(!z||a.length%4!==0)&&(this._gl.uniform4iv(z,a),!0)}setUInt(z,a){return!!z&&(this._gl.uniform1ui(z,a),!0)}setUInt2(z,a,K){return!!z&&(this._gl.uniform2ui(z,a,K),!0)}setUInt3(z,a,K,v){return!!z&&(this._gl.uniform3ui(z,a,K,v),!0)}setUInt4(z,a,K,v,T){return!!z&&(this._gl.uniform4ui(z,a,K,v,T),!0)}setUIntArray(z,a){return!!z&&(this._gl.uniform1uiv(z,a),!0)}setUIntArray2(z,a){return!(!z||a.length%2!==0)&&(this._gl.uniform2uiv(z,a),!0)}setUIntArray3(z,a){return!(!z||a.length%3!==0)&&(this._gl.uniform3uiv(z,a),!0)}setUIntArray4(z,a){return!(!z||a.length%4!==0)&&(this._gl.uniform4uiv(z,a),!0)}setArray(z,a){return!!z&&(!(a.length<1)&&(this._gl.uniform1fv(z,a),!0))}setArray2(z,a){return!(!z||a.length%2!==0)&&(this._gl.uniform2fv(z,a),!0)}setArray3(z,a){return!(!z||a.length%3!==0)&&(this._gl.uniform3fv(z,a),!0)}setArray4(z,a){return!(!z||a.length%4!==0)&&(this._gl.uniform4fv(z,a),!0)}setMatrices(z,a){return!!z&&(this._gl.uniformMatrix4fv(z,!1,a),!0)}setMatrix3x3(z,a){return!!z&&(this._gl.uniformMatrix3fv(z,!1,a),!0)}setMatrix2x2(z,a){return!!z&&(this._gl.uniformMatrix2fv(z,!1,a),!0)}setFloat(z,a){return!!z&&(this._gl.uniform1f(z,a),!0)}setFloat2(z,a,K){return!!z&&(this._gl.uniform2f(z,a,K),!0)}setFloat3(z,a,K,v){return!!z&&(this._gl.uniform3f(z,a,K,v),!0)}setFloat4(z,a,K,v,T){return!!z&&(this._gl.uniform4f(z,a,K,v,T),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const z=this._colorWrite;this._gl.colorMask(z,z,z,z)}}wipeCaches(z){this.preventCacheWipeBetweenFrames&&!z||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),z&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(z,a){const K=this._gl;let v=K.NEAREST,T=K.NEAREST;switch(z){case 11:v=K.LINEAR,T=a?K.LINEAR_MIPMAP_NEAREST:K.LINEAR;break;case 3:v=K.LINEAR,T=a?K.LINEAR_MIPMAP_LINEAR:K.LINEAR;break;case 8:v=K.NEAREST,T=a?K.NEAREST_MIPMAP_LINEAR:K.NEAREST;break;case 4:v=K.NEAREST,T=a?K.NEAREST_MIPMAP_NEAREST:K.NEAREST;break;case 5:v=K.NEAREST,T=a?K.LINEAR_MIPMAP_NEAREST:K.LINEAR;break;case 6:v=K.NEAREST,T=a?K.LINEAR_MIPMAP_LINEAR:K.LINEAR;break;case 7:v=K.NEAREST,T=K.LINEAR;break;case 1:v=K.NEAREST,T=K.NEAREST;break;case 9:v=K.LINEAR,T=a?K.NEAREST_MIPMAP_NEAREST:K.NEAREST;break;case 10:v=K.LINEAR,T=a?K.NEAREST_MIPMAP_LINEAR:K.NEAREST;break;case 2:v=K.LINEAR,T=K.LINEAR;break;case 12:v=K.LINEAR,T=K.NEAREST}return{min:T,mag:v}}_createTexture(){const z=this._gl.createTexture();if(!z)throw new Error("Unable to create texture");return z}_createHardwareTexture(){return new G.d(this._createTexture(),this._gl)}_createInternalTexture(z,a){let K,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,T=!1,p=0,j=3,s=5,M=!1,r=1;void 0!==a&&"object"===typeof a?(T=!!a.generateMipMaps,p=void 0===a.type?0:a.type,j=void 0===a.samplingMode?3:a.samplingMode,s=void 0===a.format?5:a.format,M=void 0!==a.useSRGBBuffer&&a.useSRGBBuffer,r=a.samples??1,K=a.label):T=!!a,M&&(M=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==p||this._caps.textureFloatLinearFiltering)&&(2!==p||this._caps.textureHalfFloatLinearFiltering)||(j=1),1!==p||this._caps.textureFloat||(p=0,m.c.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const W=this._gl,F=new l.b(this,v),G=z.width||z,V=z.height||z,c=z.depth||0,C=z.layers||0,w=this._getSamplingParameters(j,T),H=0!==C?W.TEXTURE_2D_ARRAY:0!==c?W.TEXTURE_3D:W.TEXTURE_2D,f=this._getRGBABufferInternalSizedFormat(p,s,M),Y=this._getInternalFormat(s),I=this._getWebGLTextureType(p);return this._bindTextureDirectly(H,F),0!==C?(F.is2DArray=!0,W.texImage3D(H,0,f,G,V,C,0,Y,I,null)):0!==c?(F.is3D=!0,W.texImage3D(H,0,f,G,V,c,0,Y,I,null)):W.texImage2D(H,0,f,G,V,0,Y,I,null),W.texParameteri(H,W.TEXTURE_MAG_FILTER,w.mag),W.texParameteri(H,W.TEXTURE_MIN_FILTER,w.min),W.texParameteri(H,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(H,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),T&&this._gl.generateMipmap(H),this._bindTextureDirectly(H,null),F._useSRGBBuffer=M,F.baseWidth=G,F.baseHeight=V,F.width=G,F.height=V,F.depth=C,F.isReady=!0,F.samples=r,F.generateMipMaps=T,F.samplingMode=j,F.type=p,F.format=s,F.label=K,this._internalTexturesCache.push(F),F}_getUseSRGBBuffer(z,a){return z&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||a)}createTexture(z,a,K,v){var T=this;let m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,W=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,F=arguments.length>11?arguments[11]:void 0,G=arguments.length>12?arguments[12]:void 0,V=arguments.length>13?arguments[13]:void 0,c=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(z,a,K,v,m,p,j,(function(){for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];return T._prepareWebGLTexture(...a,r)}),((z,a,K,T,m,p)=>{const j=this._gl,s=K.width===z&&K.height===a;m._creationFlags=V??0;const M=this._getTexImageParametersForCreateTexture(m.format,m._useSRGBBuffer);if(s)return j.texImage2D(j.TEXTURE_2D,0,M.internalFormat,M.format,M.type,K),!1;const r=this._caps.maxTextureSize;if(K.width>r||K.height>r||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=z,this._workingCanvas.height=a,this._workingContext.drawImage(K,0,0,K.width,K.height,0,0,z,a),j.texImage2D(j.TEXTURE_2D,0,M.internalFormat,M.format,M.type,this._workingCanvas),m.width=z,m.height=a,!1);{const z=new l.b(this,2);this._bindTextureDirectly(j.TEXTURE_2D,z,!0),j.texImage2D(j.TEXTURE_2D,0,M.internalFormat,M.format,M.type,K),this._rescaleTexture(z,m,v,M.format,(()=>{this._releaseTexture(z),this._bindTextureDirectly(j.TEXTURE_2D,m,!0),p()}))}return!0}),s,M,r,W,F,G,c)}_getTexImageParametersForCreateTexture(z,a){let K,v;return 1===this.webGLVersion?(K=this._getInternalFormat(z,a),v=K):(K=this._getInternalFormat(z,!1),v=this._getRGBABufferInternalSizedFormat(0,z,a)),{internalFormat:v,format:K,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(z,a,K,v,T){}_unpackFlipY(z){this._unpackFlipYCached!==z&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,z?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=z))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(z){return z.isCube?this._gl.TEXTURE_CUBE_MAP:z.is3D?this._gl.TEXTURE_3D:z.is2DArray||z.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=this._getTextureTarget(a),T=this._getSamplingParameters(z,a.useMipMaps||K);this._setTextureParameterInteger(v,this._gl.TEXTURE_MAG_FILTER,T.mag,a),this._setTextureParameterInteger(v,this._gl.TEXTURE_MIN_FILTER,T.min),K&&(a.generateMipMaps=!0,this._gl.generateMipmap(v)),this._bindTextureDirectly(v,null),a.samplingMode=z}updateTextureDimensions(z,a,K){}updateTextureWrappingMode(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const T=this._getTextureTarget(z);null!==a&&(this._setTextureParameterInteger(T,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(a),z),z._cachedWrapU=a),null!==K&&(this._setTextureParameterInteger(T,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(K),z),z._cachedWrapV=K),(z.is2DArray||z.is3D)&&null!==v&&(this._setTextureParameterInteger(T,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(v),z),z._cachedWrapR=v),this._bindTextureDirectly(T,null)}_uploadCompressedDataToTextureDirectly(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const j=this._gl;let s=j.TEXTURE_2D;if(z.isCube&&(s=j.TEXTURE_CUBE_MAP_POSITIVE_X+m),z._useSRGBBuffer)switch(a){case 37492:case 36196:this._caps.etc2?a=j.COMPRESSED_SRGB8_ETC2:z._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?a=j.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:z._useSRGBBuffer=!1;break;case 36492:a=j.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:a=j.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?a=j.COMPRESSED_SRGB_S3TC_DXT1_EXT:z._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?a=j.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:z._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?a=j.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:z._useSRGBBuffer=!1;break;default:z._useSRGBBuffer=!1}this._gl.compressedTexImage2D(s,p,a,K,v,0,T)}_uploadDataToTextureDirectly(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,T=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const p=this._gl,j=this._getWebGLTextureType(z.type),s=this._getInternalFormat(z.format),M=void 0===T?this._getRGBABufferInternalSizedFormat(z.type,z.format,z._useSRGBBuffer):this._getInternalFormat(T,z._useSRGBBuffer);this._unpackFlipY(z.invertY);let r=p.TEXTURE_2D;z.isCube&&(r=p.TEXTURE_CUBE_MAP_POSITIVE_X+K);const W=Math.round(Math.log(z.width)*Math.LOG2E),F=Math.round(Math.log(z.height)*Math.LOG2E),G=m?z.width:Math.pow(2,Math.max(W-v,0)),l=m?z.height:Math.pow(2,Math.max(F-v,0));p.texImage2D(r,v,M,G,l,0,s,j,a)}updateTextureData(z,a,K,v,T,m){let p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,s=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const M=this._gl,r=this._getWebGLTextureType(z.type),W=this._getInternalFormat(z.format);this._unpackFlipY(z.invertY);let F=M.TEXTURE_2D,G=M.TEXTURE_2D;z.isCube&&(G=M.TEXTURE_CUBE_MAP_POSITIVE_X+p,F=M.TEXTURE_CUBE_MAP),this._bindTextureDirectly(F,z,!0),M.texSubImage2D(G,j,K,v,T,m,W,r,a),s&&this._gl.generateMipmap(G),this._bindTextureDirectly(F,null)}_uploadArrayBufferViewToTexture(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const T=this._gl,m=z.isCube?T.TEXTURE_CUBE_MAP:T.TEXTURE_2D;this._bindTextureDirectly(m,z,!0),this._uploadDataToTextureDirectly(z,a,K,v),this._bindTextureDirectly(m,null,!0)}_prepareWebGLTextureContinuation(z,a,K,v,T){const m=this._gl;if(!m)return;const p=this._getSamplingParameters(T,!K);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,p.mag),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,p.min),K||v||m.generateMipmap(m.TEXTURE_2D),this._bindTextureDirectly(m.TEXTURE_2D,null),a&&a.removePendingData(z),z.onLoadedObservable.notifyObservers(z),z.onLoadedObservable.clear()}_prepareWebGLTexture(z,a,K,v,T,m,p,j,s,M){const r=this.getCaps().maxTextureSize,F=Math.min(r,this.needPOTTextures?(0,W.g)(v.width,r):v.width),G=Math.min(r,this.needPOTTextures?(0,W.g)(v.height,r):v.height),l=this._gl;l&&(z._hardwareTexture?(this._bindTextureDirectly(l.TEXTURE_2D,z,!0),this._unpackFlipY(void 0===T||!!T),z.baseWidth=v.width,z.baseHeight=v.height,z.width=F,z.height=G,z.isReady=!0,z.type=-1!==z.type?z.type:0,z.format=-1!==z.format?z.format:M??(".jpg"!==a||z._useSRGBBuffer?5:4),j(F,G,v,a,z,(()=>{this._prepareWebGLTextureContinuation(z,K,m,p,s)}))||this._prepareWebGLTextureContinuation(z,K,m,p,s)):K&&K.removePendingData(z))}_getInternalFormatFromDepthTextureFormat(z,a,K){const v=this._gl;if(!a)return v.STENCIL_INDEX8;let T=K?v.DEPTH_STENCIL:v.DEPTH_COMPONENT;return this.webGLVersion>1?15===z?T=v.DEPTH_COMPONENT16:16===z?T=v.DEPTH_COMPONENT24:17===z||13===z?T=K?v.DEPTH24_STENCIL8:v.DEPTH_COMPONENT24:14===z?T=v.DEPTH_COMPONENT32F:18===z&&(T=K?v.DEPTH32F_STENCIL8:v.DEPTH_COMPONENT32F):T=v.DEPTH_COMPONENT16,T}_setupFramebufferDepthAttachments(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,m=arguments.length>5?arguments[5]:void 0;const p=this._gl;m=m??(z?13:14);const j=this._getInternalFormatFromDepthTextureFormat(m,a,z);return z&&a?this._createRenderBuffer(K,v,T,p.DEPTH_STENCIL,j,p.DEPTH_STENCIL_ATTACHMENT):a?this._createRenderBuffer(K,v,T,j,j,p.DEPTH_ATTACHMENT):z?this._createRenderBuffer(K,v,T,j,j,p.STENCIL_ATTACHMENT):null}_createRenderBuffer(z,a,K,v,T,m){let p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const j=this._gl.createRenderbuffer();return this._updateRenderBuffer(j,z,a,K,v,T,m,p)}_updateRenderBuffer(z,a,K,v,T,m,p){let j=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const s=this._gl;return s.bindRenderbuffer(s.RENDERBUFFER,z),v>1&&s.renderbufferStorageMultisample?s.renderbufferStorageMultisample(s.RENDERBUFFER,v,m,a,K):s.renderbufferStorage(s.RENDERBUFFER,T,a,K),s.framebufferRenderbuffer(s.FRAMEBUFFER,p,s.RENDERBUFFER,z),j&&s.bindRenderbuffer(s.RENDERBUFFER,null),z}_releaseTexture(z){this._deleteTexture(z._hardwareTexture),this.unbindAllTextures();const a=this._internalTexturesCache.indexOf(z);-1!==a&&this._internalTexturesCache.splice(a,1),z._lodTextureHigh&&z._lodTextureHigh.dispose(),z._lodTextureMid&&z._lodTextureMid.dispose(),z._lodTextureLow&&z._lodTextureLow.dispose(),z._irradianceTexture&&z._irradianceTexture.dispose()}_deleteTexture(z){null===z||void 0===z||z.release()}_setProgram(z){this._currentProgram!==z&&((0,v.n)(z,this._gl),this._currentProgram=z)}bindSamplers(z){const a=z.getPipelineContext();this._setProgram(a.program);const K=z.getSamplers();for(let v=0;v<K.length;v++){const a=z.getUniform(K[v]);a&&(this._boundUniforms[v]=a)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=!1;const p=a&&a._associatedChannel>-1;K&&p&&(this._activeChannel=a._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==a||v){if(this._activateCurrentTexture(),a&&a.isMultiview)throw m.c.Error(["_bindTextureDirectly called with a multiview texture!",z,a]),"_bindTextureDirectly called with a multiview texture!";var j;this._gl.bindTexture(z,(null===a||void 0===a||null===(j=a._hardwareTexture)||void 0===j?void 0:j.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=a,a&&(a._associatedChannel=this._activeChannel)}else K&&(T=!0,this._activateCurrentTexture());return p&&!K&&this._bindSamplerUniformToChannel(a._associatedChannel,this._activeChannel),T}_bindTexture(z,a,K){if(void 0===z)return;a&&(a._associatedChannel=z),this._activeChannel=z;const v=a?this._getTextureTarget(a):this._gl.TEXTURE_2D;this._bindTextureDirectly(v,a)}unbindAllTextures(){for(let z=0;z<this._maxSimultaneousTextures;z++)this._activeChannel=z,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(z,a,K,v){void 0!==z&&(a&&(this._boundUniforms[z]=a),this._setTexture(z,K))}_bindSamplerUniformToChannel(z,a){const K=this._boundUniforms[z];K&&K._currentState!==a&&(this._gl.uniform1i(K,a),K._currentState=a)}_getTextureWrapMode(z){switch(z){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(z,a){let K,v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!a)return null!=this._boundTexturesCache[z]&&(this._activeChannel=z,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(a.video){this._activeChannel=z;const K=a.getInternalTexture();K&&(K._associatedChannel=z),a.update()}else if(4===a.delayLoadState)return a.delayLoad(),!1;K=T?a.depthStencilTexture:a.isReady()?a.getInternalTexture():a.isCube?this.emptyCubeTexture:a.is3D?this.emptyTexture3D:a.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!v&&K&&(K._associatedChannel=z);let m=!0;this._boundTexturesCache[z]===K&&(v||this._bindSamplerUniformToChannel(K._associatedChannel,z),m=!1),this._activeChannel=z;const p=this._getTextureTarget(K);if(m&&this._bindTextureDirectly(p,K,v),K&&!K.isMultiview){if(K.isCube&&K._cachedCoordinatesMode!==a.coordinatesMode){K._cachedCoordinatesMode=a.coordinatesMode;const z=3!==a.coordinatesMode&&5!==a.coordinatesMode?1:0;a.wrapU=z,a.wrapV=z}K._cachedWrapU!==a.wrapU&&(K._cachedWrapU=a.wrapU,this._setTextureParameterInteger(p,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(a.wrapU),K)),K._cachedWrapV!==a.wrapV&&(K._cachedWrapV=a.wrapV,this._setTextureParameterInteger(p,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(a.wrapV),K)),K.is3D&&K._cachedWrapR!==a.wrapR&&(K._cachedWrapR=a.wrapR,this._setTextureParameterInteger(p,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(a.wrapR),K)),this._setAnisotropicLevel(p,K,a.anisotropicFilteringLevel)}return!0}setTextureArray(z,a,K,v){if(void 0!==z&&a){this._textureUnits&&this._textureUnits.length===K.length||(this._textureUnits=new Int32Array(K.length));for(let a=0;a<K.length;a++){const v=K[a].getInternalTexture();v?(this._textureUnits[a]=z+a,v._associatedChannel=z+a):this._textureUnits[a]=-1}this._gl.uniform1iv(a,this._textureUnits);for(let z=0;z<K.length;z++)this._setTexture(this._textureUnits[z],K[z],!0)}}_setAnisotropicLevel(z,a,K){const v=this._caps.textureAnisotropicFilterExtension;11!==a.samplingMode&&3!==a.samplingMode&&2!==a.samplingMode&&(K=1),v&&a._cachedAnisotropicFilteringLevel!==K&&(this._setTextureParameterFloat(z,v.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(K,this._caps.maxAnisotropy),a),a._cachedAnisotropicFilteringLevel=K)}_setTextureParameterFloat(z,a,K,v){this._bindTextureDirectly(z,v,!0,!0),this._gl.texParameterf(z,a,K)}_setTextureParameterInteger(z,a,K,v){v&&this._bindTextureDirectly(z,v,!0,!0),this._gl.texParameteri(z,a,K)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let z=0;z<this._caps.maxVertexAttribs;z++)this.disableAttributeByIndex(z)}else for(let z=0,a=this._vertexAttribArraysEnabled.length;z<a;z++)z>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[z]||this.disableAttributeByIndex(z)}releaseEffects(){const z=Object.keys(this._compiledEffects);for(const a of z){this._compiledEffects[a].dispose()}this._compiledEffects={}}dispose(){var z;((0,p.m)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(z=this._gl.getExtension("WEBGL_lose_context"))||void 0===z||z.loseContext());(0,v.y)(this._gl)}attachContextLostEvent(z){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",z,!1)}attachContextRestoredEvent(z){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",z,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(z){const a=this._gl;for(;a.getError()!==a.NO_ERROR;);let K=!0;const v=a.createTexture();a.bindTexture(a.TEXTURE_2D,v),a.texImage2D(a.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(z),1,1,0,a.RGBA,this._getWebGLTextureType(z),null),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);const T=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,T),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,v,0);const m=a.checkFramebufferStatus(a.FRAMEBUFFER);if(K=K&&m===a.FRAMEBUFFER_COMPLETE,K=K&&a.getError()===a.NO_ERROR,K&&(a.clear(a.COLOR_BUFFER_BIT),K=K&&a.getError()===a.NO_ERROR),K){a.bindFramebuffer(a.FRAMEBUFFER,null);const z=a.RGBA,v=a.UNSIGNED_BYTE,T=new Uint8Array(4);a.readPixels(0,0,1,1,z,v,T),K=K&&a.getError()===a.NO_ERROR}for(a.deleteTexture(v),a.deleteFramebuffer(T),a.bindFramebuffer(a.FRAMEBUFFER,null);!K&&a.getError()!==a.NO_ERROR;);return K}_getWebGLTextureType(z){if(1===this._webGLVersion){switch(z){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(z){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=a?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(z){case 0:K=this._gl.ALPHA;break;case 1:K=this._gl.LUMINANCE;break;case 2:K=this._gl.LUMINANCE_ALPHA;break;case 6:K=this._gl.RED;break;case 7:K=this._gl.RG;break;case 4:K=a?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:K=a?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(z){case 8:K=this._gl.RED_INTEGER;break;case 9:K=this._gl.RG_INTEGER;break;case 10:K=this._gl.RGB_INTEGER;break;case 11:K=this._gl.RGBA_INTEGER}return K}_getRGBABufferInternalSizedFormat(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==a)switch(a){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return K?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(z){case 3:switch(a){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(a){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return K?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return K?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(a){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(a){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(a){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(a){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(a){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(a){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(a){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return K?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(z,a,K,v){let T=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const p=T?4:3,j=T?this._gl.RGBA:this._gl.RGB,s=new Uint8Array(v*K*p);return m&&this.flushFramebuffer(),this._gl.readPixels(z,a,K,v,j,this._gl.UNSIGNED_BYTE,s),Promise.resolve(s)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const z=F.b._CreateCanvas(1,1),a=z.getContext("webgl")||z.getContext("experimental-webgl");this._IsSupported=null!=a&&!!window.WebGLRenderingContext}catch(z){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const z=F.b._CreateCanvas(1,1),a=z.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||z.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!a}catch(z){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}H._TempClearColorUint32=new Uint32Array(4),H._TempClearColorInt32=new Int32Array(4),H.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],H._ConcatenateShader=c.h,H._IsSupported=null,H._HasMajorPerformanceCaveat=null},11029:(z,a,K)=>{"use strict";var v;K.d(a,{d:()=>T}),function(z){z[z.PointerMove=0]="PointerMove",z[z.PointerDown=1]="PointerDown",z[z.PointerUp=2]="PointerUp"}(v||(v={}));class T{}T.DOM_DELTA_PIXEL=0,T.DOM_DELTA_LINE=1,T.DOM_DELTA_PAGE=2},11026:(z,a,K)=>{"use strict";K.d(a,{c:()=>v,g:()=>m,k:()=>T});class v{}v.KEYDOWN=1,v.KEYUP=2;class T{constructor(z,a){this.type=z,this.event=a}}class m extends T{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(z){this.skipOnKeyboardObservable=z}constructor(z,a){super(z,a),this.type=z,this.event=a,this.skipOnKeyboardObservable=!1}}},11022:(z,a,K)=>{"use strict";K.d(a,{e:()=>T,i:()=>p,k:()=>j});var v=K(10941);class T{}T.POINTERDOWN=1,T.POINTERUP=2,T.POINTERMOVE=4,T.POINTERWHEEL=8,T.POINTERPICK=16,T.POINTERTAP=32,T.POINTERDOUBLETAP=64;class m{constructor(z,a){this.type=z,this.event=a}}class p extends m{constructor(z,a,K,T){super(z,a),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new v.m(K,T)}}class j extends m{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(z,a),this._pickInfo=K,this._inputManager=v}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},10623:(z,a,K)=>{"use strict";K.r(a),K.d(a,{SceneInstrumentation:()=>m});var v=K(10631),T=K(10788);class m{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(z){z!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=z,z?(this._onBeforeActiveMeshesEvaluationObserver=this.Oc.onBeforeActiveMeshesEvaluationObservable.add((()=>{v.h.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Oc.onAfterActiveMeshesEvaluationObservable.add((()=>{v.h.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Oc.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Oc.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(z){z!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=z,z?(this._onBeforeRenderTargetsRenderObserver=this.Oc.onBeforeRenderTargetsRenderObservable.add((()=>{v.h.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Oc.onAfterRenderTargetsRenderObservable.add((()=>{v.h.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Oc.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Oc.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(z){z!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=z,z?(this._onBeforeParticlesRenderingObserver=this.Oc.onBeforeParticlesRenderingObservable.add((()=>{v.h.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Oc.onAfterParticlesRenderingObservable.add((()=>{v.h.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Oc.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Oc.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(z){z!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=z,this.Oc.spriteManagers&&(z?(this._onBeforeSpritesRenderingObserver=this.Oc.onBeforeSpritesRenderingObservable.add((()=>{v.h.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Oc.onAfterSpritesRenderingObservable.add((()=>{v.h.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Oc.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Oc.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(z){z!==this._capturePhysicsTime&&this.Oc.onBeforePhysicsObservable&&(this._capturePhysicsTime=z,z?(this._onBeforePhysicsObserver=this.Oc.onBeforePhysicsObservable.add((()=>{v.h.StartPerformanceCounter("ob"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Oc.onAfterPhysicsObservable.add((()=>{v.h.EndPerformanceCounter("ob"),this._physicsTime.endMonitoring()}))):(this.Oc.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Oc.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(z){z!==this._captureAnimationsTime&&(this._captureAnimationsTime=z,z?this._onAfterAnimationsObserver=this.Oc.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Oc.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(z){this._captureFrameTime=z}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(z){this._captureInterFrameTime=z}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(z){z!==this._captureRenderTime&&(this._captureRenderTime=z,z?(this._onBeforeDrawPhaseObserver=this.Oc.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),v.h.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Oc.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),v.h.EndPerformanceCounter("Main render")}))):(this.Oc.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Oc.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(z){z!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=z,z?(this._onBeforeCameraRenderObserver=this.Oc.onBeforeCameraRenderObservable.add((z=>{this._cameraRenderTime.beginMonitoring(),v.h.StartPerformanceCounter(`Rendering camera ${z.name}`)})),this._onAfterCameraRenderObserver=this.Oc.onAfterCameraRenderObservable.add((z=>{this._cameraRenderTime.endMonitoring(!1),v.h.EndPerformanceCounter(`Rendering camera ${z.name}`)}))):(this.Oc.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Oc.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Oc.getEngine()._drawCalls}constructor(z){this.Oc=z,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new T.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new T.d,this._captureFrameTime=!1,this._frameTime=new T.d,this._captureRenderTime=!1,this._renderTime=new T.d,this._captureInterFrameTime=!1,this._interFrameTime=new T.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new T.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new T.d,this._capturePhysicsTime=!1,this._physicsTime=new T.d,this._captureAnimationsTime=!1,this._animationsTime=new T.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new T.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=z.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(v.h.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Oc.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=z.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(v.h.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.hj(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.hj(),this._captureParticlesRenderTime&&this._particlesRenderTime.hj(),this._captureSpritesRenderTime&&this._spritesRenderTime.hj(),this._captureRenderTime&&this._renderTime.hj(),this._captureCameraRenderTime&&this._cameraRenderTime.hj()}))}dispose(){this.Oc.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Oc.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Oc.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Oc.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Oc.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Oc.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Oc.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Oc.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Oc.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Oc.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Oc.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Oc.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Oc.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Oc.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Oc.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Oc.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Oc.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Oc=null}}},12004:(z,a,K)=>{"use strict";K.d(a,{b:()=>r});var v=K(10923),T=K(10927),m=K(10941),p=K(11215),j=K(11949),s=K(12011),M=K(10767);p.c.AddNodeConstructor("Light_Type_1",((z,a)=>()=>new r(z,m.o.Zero(),a)));class r extends s.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(z){this._shadowFrustumSize=z,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(z){this._shadowOrthoScale=z,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(z){this._orthoLeft=z}get orthoRight(){return this._orthoRight}set orthoRight(z){this._orthoRight=z}get orthoTop(){return this._orthoTop}set orthoTop(z){this._orthoTop=z}get orthoBottom(){return this._orthoBottom}set orthoBottom(z){this._orthoBottom=z}constructor(z,a,K){super(z,K),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=a.scale(-1),this.direction=a}getClassName(){return"pb"}getTypeID(){return j.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(z,a,K){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(z):this._setDefaultAutoExtendShadowProjectionMatrix(z,a,K)}_setDefaultFixedFrustumShadowProjectionMatrix(z){const a=this.va().activeCamera;a&&m.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:a.Yi,void 0!==this.shadowMaxZ?this.shadowMaxZ:a.maxZ,z,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(z,a,K){const v=this.va().activeCamera;if(!v)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const z=m.o.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let v=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let p=0;p<K.length;p++){const j=K[p];if(!j)continue;const s=j.getBoundingInfo().boundingBox;for(let K=0;K<s.vectorsWorld.length;K++)m.o.TransformCoordinatesToRef(s.vectorsWorld[K],a,z),z.x<this._orthoLeft&&(this._orthoLeft=z.x),z.y<this._orthoBottom&&(this._orthoBottom=z.y),z.x>this._orthoRight&&(this._orthoRight=z.x),z.y>this._orthoTop&&(this._orthoTop=z.y),this.autoCalcShadowZBounds&&(z.z<v&&(v=z.z),z.z>T&&(T=z.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=v,this._shadowMaxZ=T)}const T=this._orthoRight-this._orthoLeft,p=this._orthoTop-this._orthoBottom,j=void 0!==this.shadowMinZ?this.shadowMinZ:v.Yi,s=void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ,M=this.va().getEngine().useReverseDepthBuffer;m.b.OrthoOffCenterLHToRef(this._orthoLeft-T*this.shadowOrthoScale,this._orthoRight+T*this.shadowOrthoScale,this._orthoBottom-p*this.shadowOrthoScale,this._orthoTop+p*this.shadowOrthoScale,M?s:j,M?j:s,z,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(z,a){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,a),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,a),this)}transferToNodeMaterialEffect(z,a){return this.computeTransformedInformation()?(z.setFloat3(a,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(z.setFloat3(a,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(z){const a=this._scene.getEngine();return!a.useReverseDepthBuffer&&a.isNDCHalfZRange?0:1}getDepthMaxZ(z){const a=this._scene.getEngine();return a.useReverseDepthBuffer&&a.isNDCHalfZRange?0:1}prepareLightSpecificDefines(z,a){z["DIRLIGHT"+a]=!0}}(0,v.e)([(0,T.D)()],r.prototype,"shadowFrustumSize",null),(0,v.e)([(0,T.D)()],r.prototype,"shadowOrthoScale",null),(0,v.e)([(0,T.D)()],r.prototype,"autoUpdateExtends",void 0),(0,v.e)([(0,T.D)()],r.prototype,"autoCalcShadowZBounds",void 0),(0,v.e)([(0,T.D)("orthoLeft")],r.prototype,"_orthoLeft",void 0),(0,v.e)([(0,T.D)("orthoRight")],r.prototype,"_orthoRight",void 0),(0,v.e)([(0,T.D)("orthoTop")],r.prototype,"_orthoTop",void 0),(0,v.e)([(0,T.D)("orthoBottom")],r.prototype,"_orthoBottom",void 0),(0,M.e)("BABYLON.DirectionalLight",r)},12357:(z,a,K)=>{"use strict";K.d(a,{d:()=>r});var v=K(10923),T=K(10927),m=K(10941),p=K(10971),j=K(11215),s=K(11949),M=K(10767);j.c.AddNodeConstructor("Light_Type_3",((z,a)=>()=>new r(z,m.o.Zero(),a)));class r extends s.d{constructor(z,a,K){super(z,K),this.groundColor=new p.c(0,0,0),this.direction=a||m.o.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"rb"}setDirectionToTarget(z){return this.direction=m.o.Normalize(z.sc(m.o.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(z,a){const K=m.o.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",K.x,K.y,K.z,0,a),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.aj),a),this}transferToNodeMaterialEffect(z,a){const K=m.o.Normalize(this.direction);return z.setFloat3(a,K.x,K.y,K.z),this}Qj(){return this._worldMatrix||(this._worldMatrix=m.b.Identity()),this._worldMatrix}getTypeID(){return s.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(z,a){z["HEMILIGHT"+a]=!0}}(0,v.e)([(0,T.h)()],r.prototype,"groundColor",void 0),(0,v.e)([(0,T.B)()],r.prototype,"direction",void 0),(0,M.e)("BABYLON.HemisphericLight",r)},11949:(z,a,K)=>{"use strict";K.d(a,{d:()=>F});var v=K(10923),T=K(10927),m=K(10941),p=K(10971),j=K(11215),s=K(10991),M=K(10767),r=K(11054),W=K(10973);class F extends j.c{get range(){return this._range}set range(z){this._range=z,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(z){this._intensityMode=z,this._computePhotometricScale()}get radius(){return this._radius}set radius(z){this._radius=z,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(z){this._shadowEnabled!==z&&(this._shadowEnabled=z,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(z){this._includedOnlyMeshes=z,this._hookArrayForIncludedOnly(z)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(z){this._excludedMeshes=z,this._hookArrayForExcluded(z)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(z){this._excludeWithLayerMask=z,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(z){this._includeOnlyWithLayerMask=z,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(z){this._lightmapMode!==z&&(this._lightmapMode=z,this._markMeshesAsLightDirty())}getViewMatrix(z){return null}getProjectionMatrix(z,a){return null}constructor(z,a){super(z,a,!1),this.gh=new p.c(1,1,1),this.ih=new p.c(1,1,1),this.falloffType=F.FALLOFF_DEFAULT,this.aj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=F.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new s.c(this.va().getEngine(),void 0,void 0,z),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(z,a){return this}_bindLight(z,a,K,v){let T=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const m=z.toString();let j=!1;if(this._uniformBuffer.bindToEffect(K,"Light"+m),this._renderId!==a.getRenderId()||this._lastUseSpecular!==v||!this._uniformBuffer.useUbo){this._renderId=a.getRenderId(),this._lastUseSpecular=v;const z=this.getScaledIntensity();this.transferToEffect(K,m),this.gh.scaleToRef(z,p.f.ib[0]),this._uniformBuffer.updateColor4("vLightDiffuse",p.f.ib[0],this.range,m),v&&(this.ih.scaleToRef(z,p.f.ib[1]),this._uniformBuffer.updateColor4("vLightSpecular",p.f.ib[1],this.radius,m)),j=!0}if(this.transferTexturesToEffect(K,m),a.shadowsEnabled&&this.shadowEnabled&&T){const z=this.getShadowGenerator(a.activeCamera)??this.getShadowGenerator();z&&(z.bindShadowLight(m,K),j=!0)}j?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(z){let a="Name: "+this.name;if(a+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let K=0;K<this.animations.length;K++)a+=", animation[0]: "+this.animations[K].toString(z);return a}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Nb(z){super.Nb(z),this._resyncMeshes()}getShadowGenerator(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(z)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return m.o.Zero()}canAffectMesh(z){return!z||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(z))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(z))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&z.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&z.layerMask)))}dispose(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const z=this._shadowGenerators.values();for(let a=z.next();!0!==a.done;a=z.next()){a.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const z=this._parentContainer.lights.indexOf(this);z>-1&&this._parentContainer.lights.splice(z,1),this._parentContainer=null}for(const K of this.va().meshes)K._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(z,a)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.aj}clone(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=F.GetConstructorFromName(this.getTypeID(),z,this.va());if(!K)return null;const v=W.e.Clone(K,this);return z&&(v.name=z),a&&(v.parent=a),v.Nb(this.isEnabled()),this.onClonedObservable.notifyObservers(v),v}serialize(){const z=W.e.Serialize(this);return z.uniqueId=this.uniqueId,z.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(z),this.excludedMeshes.length>0&&(z.excludedMeshesIds=[],this.excludedMeshes.forEach((a=>{z.excludedMeshesIds.push(a.id)}))),this.includedOnlyMeshes.length>0&&(z.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((a=>{z.includedOnlyMeshesIds.push(a.id)}))),W.e.AppendSerializedAnimations(this,z),z.ranges=this.serializeAnimationRanges(),z.isEnabled=this.isEnabled(),z}static GetConstructorFromName(z,a,K){const v=j.c.Construct("Light_Type_"+z,a,K);return v||null}static Parse(z,a){const K=F.GetConstructorFromName(z.type,z.name,a);if(!K)return null;const v=W.e.Parse(K,z,a);if(z.excludedMeshesIds&&(v._excludedMeshesIds=z.excludedMeshesIds),z.includedOnlyMeshesIds&&(v._includedOnlyMeshesIds=z.includedOnlyMeshesIds),void 0!==z.parentId&&(v._waitingParentId=z.parentId),void 0!==z.parentInstanceIndex&&(v._waitingParentInstanceIndex=z.parentInstanceIndex),void 0!==z.falloffType&&(v.falloffType=z.falloffType),void 0!==z.lightmapMode&&(v.lightmapMode=z.lightmapMode),z.animations){for(let a=0;a<z.animations.length;a++){const K=z.animations[a],T=(0,M.c)("BABYLON.Animation");T&&v.animations.push(T.Parse(K))}j.c.ParseAnimationRanges(v,z,a)}return z.autoAnimate&&a.beginAnimation(v,z.autoAnimateFrom,z.autoAnimateTo,z.autoAnimateLoop,z.autoAnimateSpeed||1),void 0!==z.isEnabled&&v.Nb(z.isEnabled),v}_hookArrayForExcluded(z){var a=this;const K=z.push;z.push=function(){for(var v=arguments.length,T=new Array(v),m=0;m<v;m++)T[m]=arguments[m];const p=K.apply(z,T);for(const z of T)z._resyncLightSource(a);return p};const v=z.splice;z.splice=(a,K)=>{const T=v.apply(z,[a,K]);for(const z of T)z._resyncLightSource(this);return T};for(const T of z)T._resyncLightSource(this)}_hookArrayForIncludedOnly(z){var a=this;const K=z.push;z.push=function(){for(var v=arguments.length,T=new Array(v),m=0;m<v;m++)T[m]=arguments[m];const p=K.apply(z,T);return a._resyncMeshes(),p};const v=z.splice;z.splice=(a,K)=>{const T=v.apply(z,[a,K]);return this._resyncMeshes(),T},this._resyncMeshes()}_resyncMeshes(){for(const z of this.va().meshes)z._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const z of this.va().meshes)-1!==z.lightSources.indexOf(this)&&z._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let z=0;const a=this.getTypeID();let K=this.intensityMode;switch(K===F.INTENSITYMODE_AUTOMATIC&&(K=a===F.LIGHTTYPEID_DIRECTIONALLIGHT?F.INTENSITYMODE_ILLUMINANCE:F.INTENSITYMODE_LUMINOUSINTENSITY),a){case F.LIGHTTYPEID_POINTLIGHT:case F.LIGHTTYPEID_SPOTLIGHT:switch(K){case F.INTENSITYMODE_LUMINOUSPOWER:z=1/(4*Math.PI);break;case F.INTENSITYMODE_LUMINOUSINTENSITY:z=1;break;case F.INTENSITYMODE_LUMINANCE:z=this.radius*this.radius}break;case F.LIGHTTYPEID_DIRECTIONALLIGHT:switch(K){case F.INTENSITYMODE_ILLUMINANCE:z=1;break;case F.INTENSITYMODE_LUMINANCE:{let a=this.radius;a=Math.max(a,.001);z=2*Math.PI*(1-Math.cos(a));break}}break;case F.LIGHTTYPEID_HEMISPHERICLIGHT:z=1}return z}_reorderLightsInScene(){const z=this.va();0!=this._renderPriority&&(z.requireLightSorting=!0),this.va().sortLightsByPriority()}}F.FALLOFF_DEFAULT=r.e.FALLOFF_DEFAULT,F.FALLOFF_PHYSICAL=r.e.FALLOFF_PHYSICAL,F.FALLOFF_GLTF=r.e.FALLOFF_GLTF,F.FALLOFF_STANDARD=r.e.FALLOFF_STANDARD,F.LIGHTMAP_DEFAULT=r.e.LIGHTMAP_DEFAULT,F.LIGHTMAP_SPECULAR=r.e.LIGHTMAP_SPECULAR,F.LIGHTMAP_SHADOWSONLY=r.e.LIGHTMAP_SHADOWSONLY,F.INTENSITYMODE_AUTOMATIC=r.e.INTENSITYMODE_AUTOMATIC,F.INTENSITYMODE_LUMINOUSPOWER=r.e.INTENSITYMODE_LUMINOUSPOWER,F.INTENSITYMODE_LUMINOUSINTENSITY=r.e.INTENSITYMODE_LUMINOUSINTENSITY,F.INTENSITYMODE_ILLUMINANCE=r.e.INTENSITYMODE_ILLUMINANCE,F.INTENSITYMODE_LUMINANCE=r.e.INTENSITYMODE_LUMINANCE,F.LIGHTTYPEID_POINTLIGHT=r.e.LIGHTTYPEID_POINTLIGHT,F.LIGHTTYPEID_DIRECTIONALLIGHT=r.e.LIGHTTYPEID_DIRECTIONALLIGHT,F.LIGHTTYPEID_SPOTLIGHT=r.e.LIGHTTYPEID_SPOTLIGHT,F.LIGHTTYPEID_HEMISPHERICLIGHT=r.e.LIGHTTYPEID_HEMISPHERICLIGHT,(0,v.e)([(0,T.h)()],F.prototype,"diffuse",void 0),(0,v.e)([(0,T.h)()],F.prototype,"specular",void 0),(0,v.e)([(0,T.D)()],F.prototype,"falloffType",void 0),(0,v.e)([(0,T.D)()],F.prototype,"intensity",void 0),(0,v.e)([(0,T.D)()],F.prototype,"range",null),(0,v.e)([(0,T.D)()],F.prototype,"intensityMode",null),(0,v.e)([(0,T.D)()],F.prototype,"radius",null),(0,v.e)([(0,T.D)()],F.prototype,"_renderPriority",void 0),(0,v.e)([(0,T.d)("_reorderLightsInScene")],F.prototype,"renderPriority",void 0),(0,v.e)([(0,T.D)("shadowEnabled")],F.prototype,"_shadowEnabled",void 0),(0,v.e)([(0,T.D)("excludeWithLayerMask")],F.prototype,"_excludeWithLayerMask",void 0),(0,v.e)([(0,T.D)("includeOnlyWithLayerMask")],F.prototype,"_includeOnlyWithLayerMask",void 0),(0,v.e)([(0,T.D)("lightmapMode")],F.prototype,"_lightmapMode",void 0)},11054:(z,a,K)=>{"use strict";K.d(a,{e:()=>v});class v{static CompareLightsPriority(z,a){return z.shadowEnabled!==a.shadowEnabled?(a.shadowEnabled?1:0)-(z.shadowEnabled?1:0):a.renderPriority-z.renderPriority}}v.FALLOFF_DEFAULT=0,v.FALLOFF_PHYSICAL=1,v.FALLOFF_GLTF=2,v.FALLOFF_STANDARD=3,v.LIGHTMAP_DEFAULT=0,v.LIGHTMAP_SPECULAR=1,v.LIGHTMAP_SHADOWSONLY=2,v.INTENSITYMODE_AUTOMATIC=0,v.INTENSITYMODE_LUMINOUSPOWER=1,v.INTENSITYMODE_LUMINOUSINTENSITY=2,v.INTENSITYMODE_ILLUMINANCE=3,v.INTENSITYMODE_LUMINANCE=4,v.LIGHTTYPEID_POINTLIGHT=0,v.LIGHTTYPEID_DIRECTIONALLIGHT=1,v.LIGHTTYPEID_SPOTLIGHT=2,v.LIGHTTYPEID_HEMISPHERICLIGHT=3},12011:(z,a,K)=>{"use strict";K.d(a,{d:()=>s});var v=K(10923),T=K(10927),m=K(10941),p=K(11949),j=K(11256);class s extends p.d{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=m.b.Identity(),this._projectionMatrix=m.b.Identity()}_setPosition(z){this._position=z}get position(){return this._position}set position(z){this._setPosition(z)}_setDirection(z){this._direction=z}get direction(){return this._direction}set direction(z){this._setDirection(z)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(z){this._shadowMinZ=z,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(z){this._shadowMaxZ=z,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=m.o.Zero()),m.o.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=m.o.Zero()),m.o.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(z){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(z){return this.direction=m.o.Normalize(z.sc(this.position)),this.direction}getRotation(){this.direction.normalize();const z=m.o.Cross(this.direction,j.c.Y),a=m.o.Cross(z,this.direction);return m.o.RotationFromAxis(z,a,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=m.o.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Qj(z){return!z&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=m.b.Identity()),m.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(z){return void 0!==this.shadowMinZ?this.shadowMinZ:z.Yi}getDepthMaxZ(z){return void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ}setShadowProjectionMatrix(z,a,K){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(a,K,z):this._setDefaultShadowProjectionMatrix(z,a,K),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(z){const a=m.j.gb[0];let K=this.position;this.computeTransformedInformation()&&(K=this.transformedPosition),m.o.NormalizeToRef(this.getShadowDirection(z),a),1===Math.abs(m.o.Dot(a,m.o.Up()))&&(a.z=1e-13);const v=m.j.gb[1];return K.addToRef(a,v),m.b.LookAtLHToRef(K,v,m.o.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(z,a){return this.setShadowProjectionMatrix(this._projectionMatrix,z??this._viewMatrix,a??[]),this._projectionMatrix}}(0,v.e)([(0,T.B)()],s.prototype,"position",null),(0,v.e)([(0,T.B)()],s.prototype,"direction",null),(0,v.e)([(0,T.D)()],s.prototype,"shadowMinZ",null),(0,v.e)([(0,T.D)()],s.prototype,"shadowMaxZ",null)},11583:(z,a,K)=>{"use strict";K.d(a,{d:()=>p,g:()=>m,h:()=>j});const v={},T={};function m(z,a){v[z]=a}function p(z,a){T[z]=a}function j(z){return T[z]?T[z]:null}},11322:(z,a,K)=>{"use strict";K.d(a,{c:()=>J,f:()=>I});var v,T=K(10631),m=K(10638),p=K(10935),j=K(10680),s=K(10648),M=K(11244),r=K(10682),W=K(10684),F=K(10776),G=K(10715);!function(z){z[z.Clean=0]="Clean",z[z.Stop=1]="Stop",z[z.Sync=2]="Sync",z[z.NoSync=3]="NoSync"}(v||(v={}));const l=new m.c,V={};let c=!1;function C(){return V[".babylon"]}function w(z){const a=V[z];return a||(s.c.Warn("Unable to find a plugin to load "+z+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),C())}function H(z,a,K){let v="Unable to load from "+(z.rawData?"binary data":z.url);return a?v+=`: ${a}`:K&&(v+=`: ${K}`),v}function f(z,a,K,v,T,m,p,j,s){var M;const W="data:"===(F=z.url).substring(0,5)?F.substring(5):null;var F;if(z.rawData&&!p)throw"When using ArrayBufferView to load data the file extension must be provided.";const c=p?w(p):W?function(z){for(const a in V){const K=V[a].plugin;if(K.canDirectLoad&&K.canDirectLoad(z))return V[a]}return C()}(z.url):function(z){const a=z.indexOf("?");-1!==a&&(z=z.substring(0,a));const K=z.lastIndexOf(".");return w(z.substring(K,z.length).toLowerCase())}(z.url);if(!c)throw new Error(`No plugin or fallback for ${p??z.url}`);if(!1===(null===s||void 0===s||null===(M=s[c.plugin.name])||void 0===M?void 0:M.enabled))throw new Error(`The '${c.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(z.rawData&&!c.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(z=>{if(c.plugin.createPlugin){const a=c.plugin.createPlugin(s??{});return a instanceof Promise?(a.then(z).catch((z=>{T("Error instantiating plugin.",z)})),null):(z(a),a)}return z(c.plugin),c.plugin})((s=>{var M;if(!s)throw`The loader plugin corresponding to the '${p}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(l.notifyObservers(s),W&&(s.canDirectLoad&&s.canDirectLoad(z.url)||!(0,r.f)(z.url))){if(s.directLoad){const z=s.directLoad(a,W);z instanceof Promise?z.then((z=>{K(s,z)})).catch((z=>{T("Error in directLoad of _loadData: "+z,z)})):K(s,z)}else K(s,W);return}const F=c.isBinary,V=(z,v)=>{a.u?T("Scene has been disposed"):K(s,z,v)};let C=null,w=!1;null===(M=s.lj)||void 0===M||M.add((()=>{w=!0,C&&(C.abort(),C=null),m()}));const H=()=>{if(w)return;const K=(z,a)=>{T(null===z||void 0===z?void 0:z.statusText,a)};if(!s.loadFile&&z.rawData)throw"Plugin does not support loading ArrayBufferView.";C=s.loadFile?s.loadFile(a,z.rawData||z.file||z.url,z.rootUrl,V,v,F,K,j):a._loadFile(z.file||z.url,V,v,!0,F,K)},f=a.getEngine();let Y=f.enableOfflineSupport;if(Y){let K=!1;for(const v of a.disableOfflineSupportExceptionRules)if(v.test(z.url)){K=!0;break}Y=!K}Y&&G.b.OfflineProviderFactory?a.offlineProvider=G.b.OfflineProviderFactory(z.url,H,f.disableManifestCheck):H()}))}function Y(z,a){let K,v,m=null,p=null;if(a)if(a.name)K=`file:${a.name}`,v=a.name,m=a;else if(ArrayBuffer.isView(a))K="",v=(0,F.c)(),p=a;else if(a.startsWith("data:"))K=a,v="";else if(z){const m=a;if("/"===m.substring(0,1))return T.h.Error("Wrong sceneFilename parameter"),null;K=z+m,v=m}else K=a,v=T.h.GetFilename(a),z=T.h.GetFolderPath(a);else K=z,v=T.h.GetFilename(z),z=T.h.GetFolderPath(z);return{url:K,rootUrl:z,name:v,file:m,rawData:p}}function I(z){if("string"===typeof z.extensions){const a=z.extensions;V[a.toLowerCase()]={plugin:z,isBinary:!1}}else{const a=z.extensions;Object.keys(a).forEach((K=>{V[K.toLowerCase()]={plugin:z,isBinary:a[K].isBinary}}))}}function q(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:j.b.LastCreatedScene,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!v)return s.c.Error("No scene available to import mesh to"),null;const G=Y(a,K);if(!G)return null;const l={};v.addPendingData(l);const V=()=>{v.removePendingData(l)},c=(z,a)=>{const K=H(G,z,a);p?p(v,K,new W.h(K,W.e.SceneLoaderError,a)):s.c.Error(K),V()},C=m?z=>{try{m(z)}catch(a){c("Error in onProgress callback: "+a,a)}}:void 0,w=(z,a,K,m,p,j,s,M)=>{if(v.importedMeshesFiles.push(G.url),T)try{T(z,a,K,m,p,j,s,M)}catch(r){c("Error in onSuccess callback: "+r,r)}v.removePendingData(l)};return f(G,v,((a,K,T)=>{if(a.rewriteRootURL&&(G.rootUrl=a.rewriteRootURL(G.rootUrl,T)),a.importMesh){const T=[],m=[],p=[];if(!a.importMesh(z,v,K,G.rootUrl,T,m,p,c))return;v.loadingPluginName=a.name,w(T,m,p,[],[],[],[],[])}else{a.importMeshAsync(z,v,K,G.rootUrl,C,G.name).then((z=>{v.loadingPluginName=a.name,w(z.meshes,z.sj,z.skeletons,z.animationGroups,z.transformNodes,z.geometries,z.lights,z.spriteManagers)})).catch((z=>{c(z.message,z)}))}}),C,c,V,M,r,F)}function B(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.b.LastCreatedEngine,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return K?Z(z,a,new p.c(K),v,m,s,M,r,W):(T.h.Error("No engine available"),null)}function x(z,a,K,v,T,m,p){return new Promise(((j,s)=>{B(z,a,K,(z=>{j(z)}),v,((z,a,K)=>{s(K||new Error(a))}),T,m,p)}))}function Z(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.b.LastCreatedScene,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!K)return s.c.Error("No scene available to append to"),null;const G=Y(z,a);if(!G)return null;const l={};K.addPendingData(l);const V=()=>{K.removePendingData(l)};M.b.ShowLoadingScreen&&!c&&(c=!0,K.getEngine().displayLoadingUI(),K.executeWhenReady((()=>{K.getEngine().hideLoadingUI(),c=!1})));const C=(z,a)=>{const v=H(G,z,a);m?m(K,v,new W.h(v,W.e.SceneLoaderError,a)):s.c.Error(v),V()},w=T?z=>{try{T(z)}catch(a){C("Error in onProgress callback",a)}}:void 0,I=()=>{if(v)try{v(K)}catch(z){C("Error in onSuccess callback",z)}K.removePendingData(l)};return f(G,K,((z,a)=>{if(z.load){if(!z.load(K,a,G.rootUrl,C))return;K.loadingPluginName=z.name,I()}else{z.loadAsync(K,a,G.rootUrl,w,G.name).then((()=>{K.loadingPluginName=z.name,I()})).catch((z=>{C(z.message,z)}))}}),w,C,V,p,r,F)}function y(z,a,K,v,T,m,p){return new Promise(((j,s)=>{Z(z,a,K,(z=>{j(z)}),v,((z,a,K)=>{s(K||new Error(a))}),T,m,p)}))}function i(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.b.LastCreatedScene,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!K)return s.c.Error("No scene available to load asset container to"),null;const F=Y(z,a);if(!F)return null;const G={};K.addPendingData(G);const l=()=>{K.removePendingData(G)},V=(z,a)=>{const v=H(F,z,a);m?m(K,v,new W.h(v,W.e.SceneLoaderError,a)):s.c.Error(v),l()},c=T?z=>{try{T(z)}catch(a){V("Error in onProgress callback",a)}}:void 0,C=z=>{if(v)try{v(z)}catch(a){V("Error in onSuccess callback",a)}K.removePendingData(G)};return f(F,K,((z,a)=>{if(z.loadAssetContainer){const v=z.loadAssetContainer(K,a,F.rootUrl,V);if(!v)return;v.populateRootNodes(),K.loadingPluginName=z.name,C(v)}else if(z.loadAssetContainerAsync){z.loadAssetContainerAsync(K,a,F.rootUrl,c,F.name).then((a=>{a.populateRootNodes(),K.loadingPluginName=z.name,C(a)})).catch((z=>{V(z.message,z)}))}else V("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),c,V,l,p,M,r)}function n(z,a,K,v,T,m,p){return new Promise(((j,s)=>{i(z,a,K,(z=>{j(z)}),v,((z,a,K)=>{s(K||new Error(a))}),T,m,p)}))}function X(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.b.LastCreatedScene,v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,F=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",G=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!K)return void s.c.Error("No scene available to load animations to");if(v){for(const z of K.animatables)z.reset();K.stopAllAnimations(),K.animationGroups.slice().forEach((z=>{z.dispose()}));K.getNodes().forEach((z=>{z.animations&&(z.animations=[])}))}else switch(T){case 0:K.animationGroups.slice().forEach((z=>{z.dispose()}));break;case 1:K.animationGroups.forEach((z=>{z.stop()}));break;case 2:K.animationGroups.forEach((z=>{z.reset(),z.restart()}));break;case 3:break;default:return void s.c.Error("Unknown animation group loading mode value '"+T+"'")}const l=K.animatables.length;i(z,a,K,(z=>{z.mergeAnimationsTo(K,K.animatables.slice(l),m),z.dispose(),K.onAnimationFileImportedObservable.notifyObservers(K),p&&p(K)}),M,r,W,F,G)}function P(z,a,K,v,T,m,p,j,s,M){return new Promise(((r,W)=>{X(z,a,K,v,T,m,(z=>{r(z)}),p,((z,a,K)=>{W(K||new Error(a))}),j,s,M)}))}class J{static get ForceFullSceneLoadingForIncremental(){return M.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(z){M.b.ForceFullSceneLoadingForIncremental=z}static get ShowLoadingScreen(){return M.b.ShowLoadingScreen}static set ShowLoadingScreen(z){M.b.ShowLoadingScreen=z}static get loggingLevel(){return M.b.loggingLevel}static set loggingLevel(z){M.b.loggingLevel=z}static get CleanBoneMatrixWeights(){return M.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(z){M.b.CleanBoneMatrixWeights=z}static GetDefaultPlugin(){return C()}static GetPluginForExtension(z){var a;return null===(a=w(z))||void 0===a?void 0:a.plugin}static IsPluginForExtensionAvailable(z){return function(z){return!!V[z]}(z)}static RegisterPlugin(z){I(z)}static ImportMesh(z,a,K,v,T,m,p,j,s){return q(z,a,K,v,T,m,p,j,s)}static ImportMeshAsync(z,a,K,v,T,m,p){return function(z,a,K,v,T,m,p,j){return new Promise(((s,M)=>{q(z,a,K,v,((z,a,K,v,T,m,p,j)=>{s({meshes:z,sj:a,skeletons:K,animationGroups:v,transformNodes:T,geometries:m,lights:p,spriteManagers:j})}),T,((z,a,K)=>{M(K||new Error(a))}),m,p,j)}))}(z,a,K,v,T,m,p)}static Load(z,a,K,v,T,m,p,j){return B(z,a,K,v,T,m,p,j)}static LoadAsync(z,a,K,v,T,m){return x(z,a,K,v,T,m)}static Append(z,a,K,v,T,m,p,j){return Z(z,a,K,v,T,m,p,j)}static AppendAsync(z,a,K,v,T,m){return y(z,a,K,v,T,m)}static LoadAssetContainer(z,a,K,v,T,m,p,j){return i(z,a,K,v,T,m,p,j)}static LoadAssetContainerAsync(z,a,K,v,T,m){return n(z,a,K,v,T,m)}static ImportAnimations(z,a,K,v,T,m,p,j,s,M,r){X(z,a,K,v,T,m,p,j,s,M,r)}static ImportAnimationsAsync(z,a,K,v,T,m,p,j,s,M,r){return P(z,a,K,v,T,m,j,M,r)}}J.NO_LOGGING=0,J.MINIMAL_LOGGING=1,J.SUMMARY_LOGGING=2,J.DETAILED_LOGGING=3,J.OnPluginActivatedObservable=l},11244:(z,a,K)=>{"use strict";K.d(a,{b:()=>v});class v{static get ForceFullSceneLoadingForIncremental(){return v._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(z){v._ForceFullSceneLoadingForIncremental=z}static get ShowLoadingScreen(){return v._ShowLoadingScreen}static set ShowLoadingScreen(z){v._ShowLoadingScreen=z}static get loggingLevel(){return v._LoggingLevel}static set loggingLevel(z){v._LoggingLevel=z}static get CleanBoneMatrixWeights(){return v._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(z){v._CleanBoneMatrixWeights=z}}v._ForceFullSceneLoadingForIncremental=!1,v._ShowLoadingScreen=!0,v._CleanBoneMatrixWeights=!1,v._LoggingLevel=0},11922:(z,a,K)=>{"use strict";K.d(a,{e:()=>e});var v=K(10923),T=K(10927),m=K(10648),p=K(10933),j=K(11911),s=K(10935),M=K(10941),r=K(11001),W=K(11127),F=K(11181);class G extends W.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class l extends F.e{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(z,"PBRBRDF",90,new G,a),this._useEnergyConservation=l.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=l.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=l.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=l.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=l.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=l.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=l.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=l.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=z._dirtyCallbacks[16],this._enable(!0)}prepareDefines(z){z.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,z.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,z.SPHERICAL_HARMONICS=this._useSphericalHarmonics,z.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}l.DEFAULT_USE_ENERGY_CONSERVATION=!0,l.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,l.DEFAULT_USE_SPHERICAL_HARMONICS=!0,l.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsMiscDirty")],l.prototype,"useEnergyConservation",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsMiscDirty")],l.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsMiscDirty")],l.prototype,"useSphericalHarmonics",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsMiscDirty")],l.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var V=K(11056),c=K(10971),C=K(10964),w=K(11064),H=K(11130),f=K(11134),Y=K(11167),I=(K(11929),K(11174)),q=K(11114);class B extends W.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class x extends F.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(z,"PBRClearCoat",100,new B,a),this._isEnabled=!1,this.isEnabled=!1,this.aj=1,this.roughness=0,this._indexOfRefraction=x._DefaultIndexOfRefraction,this.indexOfRefraction=x._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=c.c.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=z._dirtyCallbacks[1]}isReadyForSubMesh(z,a,K){if(!this._isEnabled)return!0;const v=this._material._disableBumpMap;if(z._areTexturesDirty&&a.texturesEnabled){if(this._texture&&Y.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&Y.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(K.getCaps().standardDerivatives&&this._bumpTexture&&Y.e.ClearCoatBumpTextureEnabled&&!v&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&Y.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(z,a){this._isEnabled?(z.CLEARCOAT=!0,z.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,z.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,z._areTexturesDirty&&a.texturesEnabled&&(this._texture&&Y.e.ClearCoatTextureEnabled?(0,q._)(this._texture,z,"CLEARCOAT_TEXTURE"):z.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&Y.e.ClearCoatTextureEnabled?(0,q._)(this._textureRoughness,z,"CLEARCOAT_TEXTURE_ROUGHNESS"):z.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&Y.e.ClearCoatBumpTextureEnabled?(0,q._)(this._bumpTexture,z,"CLEARCOAT_BUMP"):z.CLEARCOAT_BUMP=!1,z.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===x._DefaultIndexOfRefraction,this._isTintEnabled?(z.CLEARCOAT_TINT=!0,this._tintTexture&&Y.e.ClearCoatTintTextureEnabled?((0,q._)(this._tintTexture,z,"CLEARCOAT_TINT_TEXTURE"),z.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):z.CLEARCOAT_TINT_TEXTURE=!1):(z.CLEARCOAT_TINT=!1,z.CLEARCOAT_TINT_TEXTURE=!1))):(z.CLEARCOAT=!1,z.CLEARCOAT_TEXTURE=!1,z.CLEARCOAT_TEXTURE_ROUGHNESS=!1,z.CLEARCOAT_BUMP=!1,z.CLEARCOAT_TINT=!1,z.CLEARCOAT_TINT_TEXTURE=!1,z.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,z.CLEARCOAT_DEFAULTIOR=!1,z.CLEARCOAT_TEXTUREDIRECTUV=0,z.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,z.CLEARCOAT_BUMPDIRECTUV=0,z.CLEARCOAT_REMAP_F0=!1,z.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,z.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(z,a,K,v){if(!this._isEnabled)return;const T=v.materialDefines,m=this._material.isFrozen,p=this._material._disableBumpMap,j=this._material._invertNormalMapX,s=this._material._invertNormalMapY;if(!z.useUbo||!m||!z.isSync){var M,r,W,F;if((this._texture||this._textureRoughness)&&Y.e.ClearCoatTextureEnabled)z.updateFloat4("vClearCoatInfos",(null===(M=this._texture)||void 0===M?void 0:M.coordinatesIndex)??0,(null===(r=this._texture)||void 0===r?void 0:r.level)??0,(null===(W=this._textureRoughness)||void 0===W?void 0:W.coordinatesIndex)??0,(null===(F=this._textureRoughness)||void 0===F?void 0:F.level)??0),this._texture&&(0,q.u)(this._texture,z,"clearCoat"),this._textureRoughness&&!T.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,q.u)(this._textureRoughness,z,"clearCoatRoughness");this._bumpTexture&&K.getCaps().standardDerivatives&&Y.e.ClearCoatTextureEnabled&&!p&&(z.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,q.u)(this._bumpTexture,z,"clearCoatBump"),a._mirroredCameraPosition?z.updateFloat2("vClearCoatTangentSpaceParams",j?1:-1,s?1:-1):z.updateFloat2("vClearCoatTangentSpaceParams",j?-1:1,s?-1:1)),this._tintTexture&&Y.e.ClearCoatTintTextureEnabled&&(z.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,q.u)(this._tintTexture,z,"clearCoatTint")),z.updateFloat2("vClearCoatParams",this.aj,this.roughness);const v=1-this._indexOfRefraction,m=1+this._indexOfRefraction,G=Math.pow(-v/m,2),l=1/this._indexOfRefraction;z.updateFloat4("vClearCoatRefractionParams",G,l,v,m),this._isTintEnabled&&(z.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),z.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}a.texturesEnabled&&(this._texture&&Y.e.ClearCoatTextureEnabled&&z.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!T.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&Y.e.ClearCoatTextureEnabled&&z.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&K.getCaps().standardDerivatives&&Y.e.ClearCoatBumpTextureEnabled&&!p&&z.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&Y.e.ClearCoatTintTextureEnabled&&z.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(z){return this._texture===z||(this._textureRoughness===z||(this._bumpTexture===z||this._tintTexture===z))}getActiveTextures(z){this._texture&&z.push(this._texture),this._textureRoughness&&z.push(this._textureRoughness),this._bumpTexture&&z.push(this._bumpTexture),this._tintTexture&&z.push(this._tintTexture)}getAnimatables(z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&z.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&z.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&z.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&z.push(this._tintTexture)}dispose(z){var a,K,v,T;z&&(null===(a=this._texture)||void 0===a||a.dispose(),null===(K=this._textureRoughness)||void 0===K||K.dispose(),null===(v=this._bumpTexture)||void 0===v||v.dispose(),null===(T=this._tintTexture)||void 0===T||T.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(z,a,K){return z.CLEARCOAT_BUMP&&a.addFallback(K++,"CLEARCOAT_BUMP"),z.CLEARCOAT_TINT&&a.addFallback(K++,"CLEARCOAT_TINT"),z.CLEARCOAT&&a.addFallback(K++,"CLEARCOAT"),K}getSamplers(z){z.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}x._DefaultIndexOfRefraction=1.5,(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"isEnabled",void 0),(0,v.e)([(0,T.D)()],x.prototype,"intensity",void 0),(0,v.e)([(0,T.D)()],x.prototype,"roughness",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"indexOfRefraction",void 0),(0,v.e)([(0,T.x)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"texture",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRoughnessFromMainTexture",void 0),(0,v.e)([(0,T.x)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"textureRoughness",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"remapF0OnInterfaceChange",void 0),(0,v.e)([(0,T.x)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"bumpTexture",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"isTintEnabled",void 0),(0,v.e)([(0,T.h)()],x.prototype,"tintColor",void 0),(0,v.e)([(0,T.D)()],x.prototype,"tintColorAtDistance",void 0),(0,v.e)([(0,T.D)()],x.prototype,"tintThickness",void 0),(0,v.e)([(0,T.x)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"tintTexture",void 0);class Z extends W.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class y extends F.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(z,"PBRIridescence",110,new Z,a),this._isEnabled=!1,this.isEnabled=!1,this.aj=1,this.minimumThickness=y._DefaultMinimumThickness,this.maximumThickness=y._DefaultMaximumThickness,this.indexOfRefraction=y._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=z._dirtyCallbacks[1]}isReadyForSubMesh(z,a){if(!this._isEnabled)return!0;if(z._areTexturesDirty&&a.texturesEnabled){if(this._texture&&Y.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&Y.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(z,a){this._isEnabled?(z.IRIDESCENCE=!0,z._areTexturesDirty&&a.texturesEnabled&&(this._texture&&Y.e.IridescenceTextureEnabled?(0,q._)(this._texture,z,"IRIDESCENCE_TEXTURE"):z.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&Y.e.IridescenceTextureEnabled?(0,q._)(this._thicknessTexture,z,"IRIDESCENCE_THICKNESS_TEXTURE"):z.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(z.IRIDESCENCE=!1,z.IRIDESCENCE_TEXTURE=!1,z.IRIDESCENCE_THICKNESS_TEXTURE=!1,z.IRIDESCENCE_TEXTUREDIRECTUV=0,z.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(z,a){if(!this._isEnabled)return;const K=this._material.isFrozen;if(!z.useUbo||!K||!z.isSync){var v,T,m,p;if((this._texture||this._thicknessTexture)&&Y.e.IridescenceTextureEnabled)z.updateFloat4("vIridescenceInfos",(null===(v=this._texture)||void 0===v?void 0:v.coordinatesIndex)??0,(null===(T=this._texture)||void 0===T?void 0:T.level)??0,(null===(m=this._thicknessTexture)||void 0===m?void 0:m.coordinatesIndex)??0,(null===(p=this._thicknessTexture)||void 0===p?void 0:p.level)??0),this._texture&&(0,q.u)(this._texture,z,"iridescence"),this._thicknessTexture&&(0,q.u)(this._thicknessTexture,z,"iridescenceThickness");z.updateFloat4("vIridescenceParams",this.aj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}a.texturesEnabled&&(this._texture&&Y.e.IridescenceTextureEnabled&&z.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&Y.e.IridescenceTextureEnabled&&z.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(z){return this._texture===z||this._thicknessTexture===z}getActiveTextures(z){this._texture&&z.push(this._texture),this._thicknessTexture&&z.push(this._thicknessTexture)}getAnimatables(z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&z.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&z.push(this._thicknessTexture)}dispose(z){var a,K;z&&(null===(a=this._texture)||void 0===a||a.dispose(),null===(K=this._thicknessTexture)||void 0===K||K.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(z,a,K){return z.IRIDESCENCE&&a.addFallback(K++,"IRIDESCENCE"),K}getSamplers(z){z.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}y._DefaultMinimumThickness=100,y._DefaultMaximumThickness=400,y._DefaultIndexOfRefraction=1.3,(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"isEnabled",void 0),(0,v.e)([(0,T.D)()],y.prototype,"intensity",void 0),(0,v.e)([(0,T.D)()],y.prototype,"minimumThickness",void 0),(0,v.e)([(0,T.D)()],y.prototype,"maximumThickness",void 0),(0,v.e)([(0,T.D)()],y.prototype,"indexOfRefraction",void 0),(0,v.e)([(0,T.x)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"texture",void 0),(0,v.e)([(0,T.x)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],y.prototype,"thicknessTexture",void 0);class i extends W.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class n extends F.e{set angle(z){this.direction.x=Math.cos(z),this.direction.y=Math.sin(z)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(z,"PBRAnisotropic",110,new i,a),this._isEnabled=!1,this.isEnabled=!1,this.aj=1,this.direction=new M.m(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=z._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=z._dirtyCallbacks[16]}isReadyForSubMesh(z,a){return!this._isEnabled||!(z._areTexturesDirty&&a.texturesEnabled&&this._texture&&Y.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(z,a,K){this._isEnabled?(z.ANISOTROPIC=this._isEnabled,this._isEnabled&&!K.isVerticesDataPresent(r.h.TangentKind)&&(z._needUVs=!0,z.MAINUV1=!0),z._areTexturesDirty&&a.texturesEnabled&&(this._texture&&Y.e.AnisotropicTextureEnabled?(0,q._)(this._texture,z,"ANISOTROPIC_TEXTURE"):z.ANISOTROPIC_TEXTURE=!1),z._areMiscDirty&&(z.ANISOTROPIC_LEGACY=this._legacy)):(z.ANISOTROPIC=!1,z.ANISOTROPIC_TEXTURE=!1,z.ANISOTROPIC_TEXTUREDIRECTUV=0,z.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(z,a){if(!this._isEnabled)return;const K=this._material.isFrozen;z.useUbo&&K&&z.isSync||(this._texture&&Y.e.AnisotropicTextureEnabled&&(z.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,q.u)(this._texture,z,"anisotropy")),z.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.aj)),a.texturesEnabled&&this._texture&&Y.e.AnisotropicTextureEnabled&&z.setTexture("anisotropySampler",this._texture)}hasTexture(z){return this._texture===z}getActiveTextures(z){this._texture&&z.push(this._texture)}getAnimatables(z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&z.push(this._texture)}dispose(z){z&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(z,a,K){return z.ANISOTROPIC&&a.addFallback(K++,"ANISOTROPIC"),K}getSamplers(z){z.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(z,a,K){super.parse(z,a,K),void 0===z.legacy&&(this.legacy=!0)}}(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isEnabled",void 0),(0,v.e)([(0,T.D)()],n.prototype,"intensity",void 0),(0,v.e)([(0,T.y)()],n.prototype,"direction",void 0),(0,v.e)([(0,T.x)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"texture",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsMiscDirty")],n.prototype,"legacy",void 0);class X extends W.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class P extends F.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(z,"Sheen",120,new X,a),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.aj=1,this.color=c.c.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=z._dirtyCallbacks[1]}isReadyForSubMesh(z,a){if(!this._isEnabled)return!0;if(z._areTexturesDirty&&a.texturesEnabled){if(this._texture&&Y.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&Y.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(z,a){this._isEnabled?(z.SHEEN=!0,z.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,z.SHEEN_ROUGHNESS=null!==this._roughness,z.SHEEN_ALBEDOSCALING=this._albedoScaling,z.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,z._areTexturesDirty&&a.texturesEnabled&&(this._texture&&Y.e.SheenTextureEnabled?((0,q._)(this._texture,z,"SHEEN_TEXTURE"),z.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):z.SHEEN_TEXTURE=!1,this._textureRoughness&&Y.e.SheenTextureEnabled?(0,q._)(this._textureRoughness,z,"SHEEN_TEXTURE_ROUGHNESS"):z.SHEEN_TEXTURE_ROUGHNESS=!1)):(z.SHEEN=!1,z.SHEEN_TEXTURE=!1,z.SHEEN_TEXTURE_ROUGHNESS=!1,z.SHEEN_LINKWITHALBEDO=!1,z.SHEEN_ROUGHNESS=!1,z.SHEEN_ALBEDOSCALING=!1,z.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,z.SHEEN_GAMMATEXTURE=!1,z.SHEEN_TEXTUREDIRECTUV=0,z.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(z,a,K,v){if(!this._isEnabled)return;const T=v.materialDefines,m=this._material.isFrozen;if(!z.useUbo||!m||!z.isSync){var p,j,s,M;if((this._texture||this._textureRoughness)&&Y.e.SheenTextureEnabled)z.updateFloat4("vSheenInfos",(null===(p=this._texture)||void 0===p?void 0:p.coordinatesIndex)??0,(null===(j=this._texture)||void 0===j?void 0:j.level)??0,(null===(s=this._textureRoughness)||void 0===s?void 0:s.coordinatesIndex)??0,(null===(M=this._textureRoughness)||void 0===M?void 0:M.level)??0),this._texture&&(0,q.u)(this._texture,z,"sheen"),this._textureRoughness&&!T.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,q.u)(this._textureRoughness,z,"sheenRoughness");z.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.aj),null!==this._roughness&&z.updateFloat("vSheenRoughness",this._roughness)}a.texturesEnabled&&(this._texture&&Y.e.SheenTextureEnabled&&z.setTexture("sheenSampler",this._texture),this._textureRoughness&&!T.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&Y.e.SheenTextureEnabled&&z.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(z){return this._texture===z||this._textureRoughness===z}getActiveTextures(z){this._texture&&z.push(this._texture),this._textureRoughness&&z.push(this._textureRoughness)}getAnimatables(z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&z.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&z.push(this._textureRoughness)}dispose(z){var a,K;z&&(null===(a=this._texture)||void 0===a||a.dispose(),null===(K=this._textureRoughness)||void 0===K||K.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(z,a,K){return z.SHEEN&&a.addFallback(K++,"SHEEN"),K}getSamplers(z){z.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isEnabled",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"linkSheenWithAlbedo",void 0),(0,v.e)([(0,T.D)()],P.prototype,"intensity",void 0),(0,v.e)([(0,T.h)()],P.prototype,"color",void 0),(0,v.e)([(0,T.x)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"texture",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"useRoughnessFromMainTexture",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"roughness",void 0),(0,v.e)([(0,T.x)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"textureRoughness",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"albedoScaling",void 0);class J extends W.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class o extends F.e{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(z){this._scene.enableSubSurfaceForPrePass()&&z&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(z))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(z){this._volumeIndexOfRefraction=z>=1?z:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(z,"PBRSubSurface",130,new J,a),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=c.c.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=c.c.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=z.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=z._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=z._dirtyCallbacks[32]}isReadyForSubMesh(z,a){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(z._areTexturesDirty&&a.texturesEnabled){if(this._thicknessTexture&&Y.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&Y.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&Y.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const z=this._getRefractionTexture(a);if(z&&Y.e.RefractionTextureEnabled&&!z.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(z,a){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return z.SUBSURFACE=!1,z.SS_DISPERSION=!1,z.SS_TRANSLUCENCY=!1,z.SS_SCATTERING=!1,z.SS_REFRACTION=!1,z.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,z.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,z.SS_THICKNESSANDMASK_TEXTURE=!1,z.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,z.SS_HAS_THICKNESS=!1,z.SS_REFRACTIONINTENSITY_TEXTURE=!1,z.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,z.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,z.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,z.SS_REFRACTIONMAP_3D=!1,z.SS_REFRACTIONMAP_OPPOSITEZ=!1,z.SS_LODINREFRACTIONALPHA=!1,z.SS_GAMMAREFRACTION=!1,z.SS_RGBDREFRACTION=!1,z.SS_LINEARSPECULARREFRACTION=!1,z.SS_LINKREFRACTIONTOTRANSPARENCY=!1,z.SS_ALBEDOFORREFRACTIONTINT=!1,z.SS_ALBEDOFORTRANSLUCENCYTINT=!1,z.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,z.SS_USE_THICKNESS_AS_DEPTH=!1,z.SS_USE_GLTF_TEXTURES=!1,z.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(z.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(z._areTexturesDirty){if(z.SUBSURFACE=!0,z.SS_DISPERSION=this._isDispersionEnabled,z.SS_TRANSLUCENCY=this._isTranslucencyEnabled,z.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,z.SS_SCATTERING=this._isScatteringEnabled,z.SS_THICKNESSANDMASK_TEXTURE=!1,z.SS_REFRACTIONINTENSITY_TEXTURE=!1,z.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,z.SS_HAS_THICKNESS=!1,z.SS_USE_GLTF_TEXTURES=!1,z.SS_REFRACTION=!1,z.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,z.SS_REFRACTIONMAP_3D=!1,z.SS_GAMMAREFRACTION=!1,z.SS_RGBDREFRACTION=!1,z.SS_LINEARSPECULARREFRACTION=!1,z.SS_REFRACTIONMAP_OPPOSITEZ=!1,z.SS_LODINREFRACTIONALPHA=!1,z.SS_LINKREFRACTIONTOTRANSPARENCY=!1,z.SS_ALBEDOFORREFRACTIONTINT=!1,z.SS_ALBEDOFORTRANSLUCENCYTINT=!1,z.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,z.SS_USE_THICKNESS_AS_DEPTH=!1,z.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,z._areTexturesDirty&&a.texturesEnabled&&(this._thicknessTexture&&Y.e.ThicknessTextureEnabled&&(0,q._)(this._thicknessTexture,z,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&Y.e.RefractionIntensityTextureEnabled&&(0,q._)(this._refractionIntensityTexture,z,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&Y.e.TranslucencyIntensityTextureEnabled&&(0,q._)(this._translucencyIntensityTexture,z,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&Y.e.TranslucencyColorTextureEnabled&&(0,q._)(this._translucencyColorTexture,z,"SS_TRANSLUCENCYCOLOR_TEXTURE")),z.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,z.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,z.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,z.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&a.texturesEnabled){const K=this._getRefractionTexture(a);K&&Y.e.RefractionTextureEnabled&&(z.SS_REFRACTION=!0,z.SS_REFRACTIONMAP_3D=K.isCube,z.SS_GAMMAREFRACTION=K.gammaSpace,z.SS_RGBDREFRACTION=K.isRGBD,z.SS_LINEARSPECULARREFRACTION=K.linearSpecularLOD,z.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&K.isCube?!K.invertZ:K.invertZ,z.SS_LODINREFRACTIONALPHA=K.lodLevelInAlpha,z.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,z.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,z.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=K.isCube&&K.boundingBoxSize,z.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(z.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(z,a,K,v){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)z.updateFloat2("vThicknessParam",0,0);else{v.getRenderingMesh().getWorldMatrix().decompose(M.j.gb[0]);const a=Math.max(Math.abs(M.j.gb[0].x),Math.abs(M.j.gb[0].y),Math.abs(M.j.gb[0].z));z.updateFloat2("vThicknessParam",this.minimumThickness*a,(this.maximumThickness-this.minimumThickness)*a)}}bindForSubMesh(z,a,K,v){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const T=v.materialDefines,m=this._material.isFrozen,p=this._material.realTimeFiltering,j=T.LODBASEDMICROSFURACE,s=this._getRefractionTexture(a);if(!z.useUbo||!m||!z.isSync){if(this._thicknessTexture&&Y.e.ThicknessTextureEnabled&&(z.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,q.u)(this._thicknessTexture,z,"thickness")),this._refractionIntensityTexture&&Y.e.RefractionIntensityTextureEnabled&&T.SS_REFRACTIONINTENSITY_TEXTURE&&(z.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,q.u)(this._refractionIntensityTexture,z,"refractionIntensity")),this._translucencyColorTexture&&Y.e.TranslucencyColorTextureEnabled&&T.SS_TRANSLUCENCYCOLOR_TEXTURE&&(z.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,q.u)(this._translucencyColorTexture,z,"translucencyColor")),this._translucencyIntensityTexture&&Y.e.TranslucencyIntensityTextureEnabled&&T.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(z.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,q.u)(this._translucencyIntensityTexture,z,"translucencyIntensity")),s&&Y.e.RefractionTextureEnabled){z.Jj("refractionMatrix",s.getRefractionTextureMatrix());let a=1;s.isCube||s.depth&&(a=s.depth);const K=s.getSize().width,v=this.volumeIndexOfRefraction;if(z.updateFloat4("vRefractionInfos",s.level,1/v,a,this._invertRefractionY?-1:1),z.updateFloat4("vRefractionMicrosurfaceInfos",K,s.lodGenerationScale,s.lodGenerationOffset,1/this.indexOfRefraction),p&&z.updateFloat2("vRefractionFilteringInfo",K,Math.log2(K)),s.boundingBoxSize){const a=s;z.updateVector3("vRefractionPosition",a.boundingBoxPosition),z.updateVector3("vRefractionSize",a.boundingBoxSize)}}this._isScatteringEnabled&&z.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),z.updateColor3("vDiffusionDistance",this.diffusionDistance),z.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),z.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),z.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),z.updateFloat("dispersion",this.dispersion)}a.texturesEnabled&&(this._thicknessTexture&&Y.e.ThicknessTextureEnabled&&z.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&Y.e.RefractionIntensityTextureEnabled&&T.SS_REFRACTIONINTENSITY_TEXTURE&&z.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&Y.e.TranslucencyIntensityTextureEnabled&&T.SS_TRANSLUCENCYINTENSITY_TEXTURE&&z.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&Y.e.TranslucencyColorTextureEnabled&&T.SS_TRANSLUCENCYCOLOR_TEXTURE&&z.setTexture("translucencyColorSampler",this._translucencyColorTexture),s&&Y.e.RefractionTextureEnabled&&(j?z.setTexture("refractionSampler",s):(z.setTexture("refractionSampler",s._lodTextureMid||s),z.setTexture("refractionSamplerLow",s._lodTextureLow||s),z.setTexture("refractionSamplerHigh",s._lodTextureHigh||s))))}_getRefractionTexture(z){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?z.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(z){Y.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&z.push(this._refractionTexture)}hasTexture(z){return this._thicknessTexture===z||(this._refractionTexture===z||(this._refractionIntensityTexture===z||(this._translucencyIntensityTexture===z||this._translucencyColorTexture===z)))}hasRenderTargetTextures(){return!!(Y.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(z){this._thicknessTexture&&z.push(this._thicknessTexture),this._refractionTexture&&z.push(this._refractionTexture),this._translucencyColorTexture&&z.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&z.push(this._translucencyIntensityTexture)}getAnimatables(z){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&z.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&z.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&z.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&z.push(this._translucencyIntensityTexture)}dispose(z){z&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(z,a,K){return z.SS_SCATTERING&&a.addFallback(K++,"SS_SCATTERING"),z.SS_TRANSLUCENCY&&a.addFallback(K++,"SS_TRANSLUCENCY"),K}getSamplers(z){z.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"isRefractionEnabled",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"isTranslucencyEnabled",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"isDispersionEnabled",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markScenePrePassDirty")],o.prototype,"isScatteringEnabled",void 0),(0,v.e)([(0,T.D)()],o.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,v.e)([(0,T.D)()],o.prototype,"refractionIntensity",void 0),(0,v.e)([(0,T.D)()],o.prototype,"translucencyIntensity",void 0),(0,v.e)([(0,T.D)()],o.prototype,"useAlbedoToTintRefraction",void 0),(0,v.e)([(0,T.D)()],o.prototype,"useAlbedoToTintTranslucency",void 0),(0,v.e)([(0,T.x)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"thicknessTexture",void 0),(0,v.e)([(0,T.x)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"refractionTexture",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"indexOfRefraction",void 0),(0,v.e)([(0,T.D)()],o.prototype,"_volumeIndexOfRefraction",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"volumeIndexOfRefraction",null),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"invertRefractionY",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"linkRefractionWithTransparency",void 0),(0,v.e)([(0,T.D)()],o.prototype,"minimumThickness",void 0),(0,v.e)([(0,T.D)()],o.prototype,"maximumThickness",void 0),(0,v.e)([(0,T.D)()],o.prototype,"useThicknessAsDepth",void 0),(0,v.e)([(0,T.h)()],o.prototype,"tintColor",void 0),(0,v.e)([(0,T.D)()],o.prototype,"tintColorAtDistance",void 0),(0,v.e)([(0,T.D)()],o.prototype,"dispersion",void 0),(0,v.e)([(0,T.h)()],o.prototype,"diffusionDistance",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useMaskFromThicknessTexture",void 0),(0,v.e)([(0,T.x)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"refractionIntensityTexture",void 0),(0,v.e)([(0,T.x)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"translucencyIntensityTexture",void 0),(0,v.e)([(0,T.h)()],o.prototype,"translucencyColor",void 0),(0,v.e)([(0,T.x)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"translucencyColorTexture",void 0),(0,v.e)([(0,T.D)(),(0,T.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useGltfStyleTextures",void 0);var N=K(11176),A=K(11119),g=K(11189);const d={effect:null,subMesh:null};class t extends W.d{constructor(z){super(z),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class e extends H.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(z){this._realTimeFiltering=z,this.zg(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(z){this._realTimeFilteringQuality=z,this.zg(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(z){z!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=z||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(z,a){super(z,a,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||e.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new M.r(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=c.c.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new c.c(0,0,0),this._albedoColor=new c.c(1,1,1),this._reflectivityColor=new c.c(1,1,1),this._reflectionColor=new c.c(1,1,1),this._emissiveColor=new c.c(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=e.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new p.f(16),this._globalAmbientColor=new c.c(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new l(this),this.clearCoat=new x(this),this.iridescence=new y(this),this.anisotropy=new n(this),this.sheen=new P(this),this.subSurface=new o(this),this.detailMap=new N.c(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),Y.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,j.b)(this.va()),this.prePassConfiguration=new V.e}get hasRenderTargetTextures(){return!!(Y.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var z;return this._transparencyMode===e.PBRMATERIAL_OPAQUE||this._transparencyMode===e.PBRMATERIAL_ALPHATEST||(null===(z=this.subSurface)||void 0===z?void 0:z.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var z;return!!this._forceAlphaTest||(null===(z=this.subSurface)||void 0===z||!z.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===e.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.me&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==e.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.me||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(z,a,K){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const v=a._drawWrapper;if(v.effect&&this.isFrozen&&v._wasPreviouslyReady&&v._wasPreviouslyUsingInstances===K)return!0;a.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),a.materialDefines=new t(this._eventInfo.defineNames));const T=a.materialDefines;if(this._isReadyForSubMesh(a))return!0;const p=this.va(),j=p.getEngine();if(T._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,p.texturesEnabled)){if(this._albedoTexture&&Y.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&Y.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&Y.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const z=this._getReflectionTexture();if(z&&Y.e.ReflectionTextureEnabled){if(!z.isReadyOrNotBlocking())return!1;var s;if(z.irradianceTexture){if(!z.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!z.sphericalPolynomial&&null!==(s=z.getInternalTexture())&&void 0!==s&&s._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&Y.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&Y.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(Y.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(j.getCaps().standardDerivatives&&this._bumpTexture&&Y.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&Y.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=T,this._eventInfo.subMesh=a,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(T._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;j.getCaps().standardDerivatives||z.isVerticesDataPresent(r.h.NormalKind)||(z.createNormals(!0),m.c.Warn("PBRMaterial: Normals have been created for the mesh: "+z.name));const M=a.effect,W=T._areLightsDisposed;let F=this._prepareEffect(z,T,this.onCompiled,this.onError,K,null,a.getRenderingMesh().hasThinInstances),G=!1;if(F)if(this._onEffectCreatedObservable&&(d.effect=F,d.subMesh=a,this._onEffectCreatedObservable.notifyObservers(d)),this.allowShaderHotSwapping&&M&&!F.isReady()){if(F=M,T.markAsUnprocessed(),G=this.isFrozen,W)return T._areLightsDisposed=!0,!1}else p.resetCachedMaterial(),a.setEffect(F,T,this._materialContext);return!(!a.effect||!a.effect.isReady())&&(T._renderId=p.getRenderId(),v._wasPreviouslyReady=!G,v._wasPreviouslyUsingInstances=!!K,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(z,a){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(z,a,m,p,j),!a.isDirty)return null;a.markAsProcessed();const s=this.va().getEngine(),M=new I.d;let W=0;a.USESPHERICALINVERTEX&&M.addFallback(W++,"USESPHERICALINVERTEX"),a.FOG&&M.addFallback(W,"FOG"),a.SPECULARAA&&M.addFallback(W,"SPECULARAA"),a.POINTSIZE&&M.addFallback(W,"POINTSIZE"),a.LOGARITHMICDEPTH&&M.addFallback(W,"LOGARITHMICDEPTH"),a.PARALLAX&&M.addFallback(W,"PARALLAX"),a.PARALLAX_RHS&&M.addFallback(W,"PARALLAX_RHS"),a.PARALLAXOCCLUSION&&M.addFallback(W++,"PARALLAXOCCLUSION"),a.ENVIRONMENTBRDF&&M.addFallback(W++,"ENVIRONMENTBRDF"),a.TANGENT&&M.addFallback(W++,"TANGENT"),a.BUMP&&M.addFallback(W++,"BUMP"),W=(0,q.y)(a,M,this._maxSimultaneousLights,W++),a.SPECULARTERM&&M.addFallback(W++,"SPECULARTERM"),a.USESPHERICALFROMREFLECTIONMAP&&M.addFallback(W++,"USESPHERICALFROMREFLECTIONMAP"),a.USEIRRADIANCEMAP&&M.addFallback(W++,"USEIRRADIANCEMAP"),a.LIGHTMAP&&M.addFallback(W++,"LIGHTMAP"),a.NORMAL&&M.addFallback(W++,"NORMAL"),a.AMBIENT&&M.addFallback(W++,"AMBIENT"),a.EMISSIVE&&M.addFallback(W++,"EMISSIVE"),a.VERTEXCOLOR&&M.addFallback(W++,"VERTEXCOLOR"),a.MORPHTARGETS&&M.addFallback(W++,"MORPHTARGETS"),a.MULTIVIEW&&M.addFallback(0,"MULTIVIEW");const F=[r.h.PositionKind];a.NORMAL&&F.push(r.h.NormalKind),a.TANGENT&&F.push(r.h.TangentKind);for(let K=1;K<=6;++K)a["UV"+K]&&F.push(`uv${1===K?"":K}`);a.VERTEXCOLOR&&F.push(r.h.ColorKind),(0,q.F)(F,z,a,M),(0,q.I)(F,a),(0,q.M)(F,z,a),(0,q.C)(F,z,a);let G="pbr";const l=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],c=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],w=["Material","Scene","Mesh"],H={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:a.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=M,this._eventInfo.fallbackRank=W,this._eventInfo.defines=a,this._eventInfo.uniforms=l,this._eventInfo.attributes=F,this._eventInfo.samplers=c,this._eventInfo.uniformBuffersNames=w,this._eventInfo.customCode=void 0,this._eventInfo.mesh=z,this._eventInfo.indexParameters=H,this._callbackPluginEventGeneric(128,this._eventInfo),g.d.AddUniformsAndSamplers(l,c),V.e.AddUniforms(l),V.e.AddSamplers(c),(0,A.e)(l),C.e&&(C.e.PrepareUniforms(l,a),C.e.PrepareSamplers(c,a)),(0,q.kb)({uniformsNames:l,uniformBuffersNames:w,samplers:c,defines:a,maxSimultaneousLights:this._maxSimultaneousLights});const f={};this.customShaderNameResolve&&(G=this.customShaderNameResolve(G,l,w,c,a,F,f));const Y=a.toString(),B=s.createEffect(G,{attributes:F,uniformsNames:l,uniformBuffersNames:w,samplers:c,defines:Y,fallbacks:M,onCompiled:v,onError:T,indexParameters:H,processFinalCode:f.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:a.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([K.e(21),K.e(43)]).then(K.bind(K,13199)),Promise.all([K.e(22),K.e(44)]).then(K.bind(K,13211))]):await Promise.all([Promise.all([K.e(25),K.e(45)]).then(K.bind(K,13218)),Promise.all([K.e(27),K.e(46)]).then(K.bind(K,13230))]),this._shadersLoaded=!0}},s);return this._eventInfo.customCode=void 0,B}_prepareDefines(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,T=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const m=this.va(),p=m.getEngine();(0,q.X)(m,z,a,!0,this._maxSimultaneousLights,this._disableLighting),a._needNormals=!0,(0,q.cb)(m,a);const j=this.needAlphaBlendingForMesh(z)&&this.va().useOrderIndependentTransparency;if((0,q.hb)(m,a,this.canRenderToMRT&&!j),(0,q.fb)(m,a,j),g.d.PrepareDefines(p.currentRenderPassId,z,a),a.METALLICWORKFLOW=this.isMetallicWorkflow(),a._areTexturesDirty){a._needUVs=!1;for(let z=1;z<=6;++z)a["MAINUV"+z]=!1;if(m.texturesEnabled){a.ALBEDODIRECTUV=0,a.AMBIENTDIRECTUV=0,a.OPACITYDIRECTUV=0,a.EMISSIVEDIRECTUV=0,a.REFLECTIVITYDIRECTUV=0,a.MICROSURFACEMAPDIRECTUV=0,a.METALLIC_REFLECTANCEDIRECTUV=0,a.REFLECTANCEDIRECTUV=0,a.BUMPDIRECTUV=0,a.LIGHTMAPDIRECTUV=0,p.getCaps().textureLOD&&(a.LODBASEDMICROSFURACE=!0),this._albedoTexture&&Y.e.DiffuseTextureEnabled?((0,q._)(this._albedoTexture,a,"ALBEDO"),a.GAMMAALBEDO=this._albedoTexture.gammaSpace):a.ALBEDO=!1,this._ambientTexture&&Y.e.AmbientTextureEnabled?((0,q._)(this._ambientTexture,a,"AMBIENT"),a.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):a.AMBIENT=!1,this._opacityTexture&&Y.e.OpacityTextureEnabled?((0,q._)(this._opacityTexture,a,"OPACITY"),a.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):a.OPACITY=!1;const z=this._getReflectionTexture();if(z&&Y.e.ReflectionTextureEnabled){switch(a.REFLECTION=!0,a.GAMMAREFLECTION=z.gammaSpace,a.RGBDREFLECTION=z.isRGBD,a.LODINREFLECTIONALPHA=z.lodLevelInAlpha,a.LINEARSPECULARREFLECTION=z.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(a.NUM_SAMPLES=""+this.realTimeFilteringQuality,p._features.needTypeSuffixInShaderConstants&&(a.NUM_SAMPLES=a.NUM_SAMPLES+"u"),a.REALTIME_FILTERING=!0):a.REALTIME_FILTERING=!1,a.INVERTCUBICMAP=z.coordinatesMode===f.d.INVCUBIC_MODE,a.REFLECTIONMAP_3D=z.isCube,a.REFLECTIONMAP_OPPOSITEZ=a.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!z.invertZ:z.invertZ,a.REFLECTIONMAP_CUBIC=!1,a.REFLECTIONMAP_EXPLICIT=!1,a.REFLECTIONMAP_PLANAR=!1,a.REFLECTIONMAP_PROJECTION=!1,a.REFLECTIONMAP_SKYBOX=!1,a.REFLECTIONMAP_SPHERICAL=!1,a.REFLECTIONMAP_EQUIRECTANGULAR=!1,a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,z.coordinatesMode){case f.d.EXPLICIT_MODE:a.REFLECTIONMAP_EXPLICIT=!0;break;case f.d.PLANAR_MODE:a.REFLECTIONMAP_PLANAR=!0;break;case f.d.PROJECTION_MODE:a.REFLECTIONMAP_PROJECTION=!0;break;case f.d.SKYBOX_MODE:a.REFLECTIONMAP_SKYBOX=!0;break;case f.d.SPHERICAL_MODE:a.REFLECTIONMAP_SPHERICAL=!0;break;case f.d.EQUIRECTANGULAR_MODE:a.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case f.d.FIXED_EQUIRECTANGULAR_MODE:a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case f.d.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case f.d.CUBIC_MODE:case f.d.INVCUBIC_MODE:default:a.REFLECTIONMAP_CUBIC=!0,a.USE_LOCAL_REFLECTIONMAP_CUBIC=!!z.boundingBoxSize}z.coordinatesMode!==f.d.SKYBOX_MODE&&(z.irradianceTexture?(a.USEIRRADIANCEMAP=!0,a.USESPHERICALFROMREFLECTIONMAP=!1):z.isCube&&(a.USESPHERICALFROMREFLECTIONMAP=!0,a.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||p.getCaps().maxVaryingVectors<=8?a.USESPHERICALINVERTEX=!1:a.USESPHERICALINVERTEX=!0))}else a.REFLECTION=!1,a.REFLECTIONMAP_3D=!1,a.REFLECTIONMAP_SPHERICAL=!1,a.REFLECTIONMAP_PLANAR=!1,a.REFLECTIONMAP_CUBIC=!1,a.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,a.REFLECTIONMAP_PROJECTION=!1,a.REFLECTIONMAP_SKYBOX=!1,a.REFLECTIONMAP_EXPLICIT=!1,a.REFLECTIONMAP_EQUIRECTANGULAR=!1,a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,a.INVERTCUBICMAP=!1,a.USESPHERICALFROMREFLECTIONMAP=!1,a.USEIRRADIANCEMAP=!1,a.USESPHERICALINVERTEX=!1,a.REFLECTIONMAP_OPPOSITEZ=!1,a.LODINREFLECTIONALPHA=!1,a.GAMMAREFLECTION=!1,a.RGBDREFLECTION=!1,a.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&Y.e.LightmapTextureEnabled?((0,q._)(this._lightmapTexture,a,"LIGHTMAP"),a.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,a.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,a.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):a.LIGHTMAP=!1,this._emissiveTexture&&Y.e.EmissiveTextureEnabled?((0,q._)(this._emissiveTexture,a,"EMISSIVE"),a.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):a.EMISSIVE=!1,Y.e.SpecularTextureEnabled?(this._metallicTexture?((0,q._)(this._metallicTexture,a,"REFLECTIVITY"),a.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,a.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,a.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,a.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,a.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,q._)(this._reflectivityTexture,a,"REFLECTIVITY"),a.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,a.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,a.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):a.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(a.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,q._)(this._metallicReflectanceTexture,a,"METALLIC_REFLECTANCE"),a.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):a.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,q._)(this._reflectanceTexture,a,"REFLECTANCE"),a.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):a.REFLECTANCE=!1):(a.METALLIC_REFLECTANCE=!1,a.REFLECTANCE=!1),this._microSurfaceTexture?(0,q._)(this._microSurfaceTexture,a,"MICROSURFACEMAP"):a.MICROSURFACEMAP=!1):(a.REFLECTIVITY=!1,a.MICROSURFACEMAP=!1),p.getCaps().standardDerivatives&&this._bumpTexture&&Y.e.BumpTextureEnabled&&!this._disableBumpMap?((0,q._)(this._bumpTexture,a,"BUMP"),this._useParallax&&this._albedoTexture&&Y.e.DiffuseTextureEnabled?(a.PARALLAX=!0,a.PARALLAX_RHS=m.useRightHandedSystem,a.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):a.PARALLAX=!1,a.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(a.BUMP=!1,a.PARALLAX=!1,a.PARALLAX_RHS=!1,a.PARALLAXOCCLUSION=!1,a.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&Y.e.ReflectionTextureEnabled?(a.ENVIRONMENTBRDF=!0,a.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(a.ENVIRONMENTBRDF=!1,a.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?a.ALPHAFROMALBEDO=!0:a.ALPHAFROMALBEDO=!1}a.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===e.LIGHTFALLOFF_STANDARD?(a.USEPHYSICALLIGHTFALLOFF=!1,a.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===e.LIGHTFALLOFF_GLTF?(a.USEPHYSICALLIGHTFALLOFF=!1,a.USEGLTFLIGHTFALLOFF=!0):(a.USEPHYSICALLIGHTFALLOFF=!0,a.USEGLTFLIGHTFALLOFF=!1),a.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Rg&&this._twoSidedLighting?a.TWOSIDEDLIGHTING=!0:a.TWOSIDEDLIGHTING=!1,a.SPECULARAA=p.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(a._areTexturesDirty||a._areMiscDirty)&&(a.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,a.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,a.ALPHABLEND=this.needAlphaBlendingForMesh(z),a.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,a.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),a._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(a),a.FORCENORMALFORWARD=this._forceNormalForward,a.RADIANCEOCCLUSION=this._useRadianceOcclusion,a.HORIZONOCCLUSION=this._useHorizonOcclusion,a._areMiscDirty&&((0,q.ab)(z,m,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(z)||this._forceAlphaTest,a,this._applyDecalMapAfterDetailMap),a.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!z.isVerticesDataPresent(r.h.NormalKind),a.DEBUGMODE=this._debugMode),(0,q.T)(m,p,this,a,!!K,v,T),this._eventInfo.defines=a,this._eventInfo.mesh=z,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,q.P)(z,a,!0,!0,!0,this._transparencyMode!==e.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(z,a,K){const v={clipPlane:!1,useInstances:!1,...K};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const K=new t(this._eventInfo.defineNames),T=this._prepareEffect(z,K,void 0,void 0,v.useInstances,v.clipPlane,z.hasThinInstances);this._onEffectCreatedObservable&&(d.effect=T,d.subMesh=null,this._onEffectCreatedObservable.notifyObservers(d)),T.isReady()?a&&a(this):T.onCompileObservable.add((()=>{a&&a(this)}))})()}buildUniformLayout(){const z=this._uniformBuffer;z.addUniform("vAlbedoInfos",2),z.addUniform("vAmbientInfos",4),z.addUniform("vOpacityInfos",2),z.addUniform("vEmissiveInfos",2),z.addUniform("vLightmapInfos",2),z.addUniform("vReflectivityInfos",3),z.addUniform("vMicroSurfaceSamplerInfos",2),z.addUniform("vReflectionInfos",2),z.addUniform("vReflectionFilteringInfo",2),z.addUniform("vReflectionPosition",3),z.addUniform("vReflectionSize",3),z.addUniform("vBumpInfos",3),z.addUniform("albedoMatrix",16),z.addUniform("ambientMatrix",16),z.addUniform("opacityMatrix",16),z.addUniform("emissiveMatrix",16),z.addUniform("lightmapMatrix",16),z.addUniform("reflectivityMatrix",16),z.addUniform("microSurfaceSamplerMatrix",16),z.addUniform("bumpMatrix",16),z.addUniform("vTangentSpaceParams",2),z.addUniform("reflectionMatrix",16),z.addUniform("vReflectionColor",3),z.addUniform("vAlbedoColor",4),z.addUniform("vLightingIntensity",4),z.addUniform("vReflectionMicrosurfaceInfos",3),z.addUniform("pointSize",1),z.addUniform("vReflectivityColor",4),z.addUniform("vEmissiveColor",3),z.addUniform("vAmbientColor",3),z.addUniform("vDebugMode",2),z.addUniform("vMetallicReflectanceFactors",4),z.addUniform("vMetallicReflectanceInfos",2),z.addUniform("metallicReflectanceMatrix",16),z.addUniform("vReflectanceInfos",2),z.addUniform("reflectanceMatrix",16),z.addUniform("vSphericalL00",3),z.addUniform("vSphericalL1_1",3),z.addUniform("vSphericalL10",3),z.addUniform("vSphericalL11",3),z.addUniform("vSphericalL2_2",3),z.addUniform("vSphericalL2_1",3),z.addUniform("vSphericalL20",3),z.addUniform("vSphericalL21",3),z.addUniform("vSphericalL22",3),z.addUniform("vSphericalX",3),z.addUniform("vSphericalY",3),z.addUniform("vSphericalZ",3),z.addUniform("vSphericalXX_ZZ",3),z.addUniform("vSphericalYY_ZZ",3),z.addUniform("vSphericalZZ",3),z.addUniform("vSphericalXY",3),z.addUniform("vSphericalYZ",3),z.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(z,a,K){const v=this.va(),T=K.materialDefines;if(!T)return;const m=K.effect;if(!m)return;this._activeEffect=m,a.getMeshUniformBuffer().bindToEffect(m,"Mesh"),a.transferToEffect(z);const p=v.getEngine();this._uniformBuffer.bindToEffect(m,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,v,a,z,this.isFrozen),g.d.Bind(p.currentRenderPassId,this._activeEffect,a,z),this._eventInfo.subMesh=K,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),T.OBJECTSPACE_NORMALMAP&&(z.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const j=this._mustRebind(v,m,K,a.visibility);(0,q.e)(a,this._activeEffect,this.prePassConfiguration);let M=null;const r=this._uniformBuffer;if(j){if(this.bindViewProjection(m),M=this._getReflectionTexture(),!r.useUbo||!this.isFrozen||!r.isSync||K._drawWrapper._forceRebindOnNextCall){var W;if(v.texturesEnabled){if(this._albedoTexture&&Y.e.DiffuseTextureEnabled&&(r.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,q.u)(this._albedoTexture,r,"albedo")),this._ambientTexture&&Y.e.AmbientTextureEnabled&&(r.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,q.u)(this._ambientTexture,r,"ambient")),this._opacityTexture&&Y.e.OpacityTextureEnabled&&(r.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,q.u)(this._opacityTexture,r,"opacity")),M&&Y.e.ReflectionTextureEnabled){if(r.Jj("reflectionMatrix",M.getReflectionTextureMatrix()),r.updateFloat2("vReflectionInfos",M.level,0),M.boundingBoxSize){const z=M;r.updateVector3("vReflectionPosition",z.boundingBoxPosition),r.updateVector3("vReflectionSize",z.boundingBoxSize)}if(this.realTimeFiltering){const z=M.getSize().width;r.updateFloat2("vReflectionFilteringInfo",z,Math.log2(z))}if(!T.USEIRRADIANCEMAP){const z=M.sphericalPolynomial;if(T.USESPHERICALFROMREFLECTIONMAP&&z)if(T.SPHERICAL_HARMONICS){const a=z.preScaledHarmonics;r.updateVector3("vSphericalL00",a.l00),r.updateVector3("vSphericalL1_1",a.l1_1),r.updateVector3("vSphericalL10",a.l10),r.updateVector3("vSphericalL11",a.l11),r.updateVector3("vSphericalL2_2",a.l2_2),r.updateVector3("vSphericalL2_1",a.l2_1),r.updateVector3("vSphericalL20",a.l20),r.updateVector3("vSphericalL21",a.l21),r.updateVector3("vSphericalL22",a.l22)}else r.updateFloat3("vSphericalX",z.x.x,z.x.y,z.x.z),r.updateFloat3("vSphericalY",z.y.x,z.y.y,z.y.z),r.updateFloat3("vSphericalZ",z.z.x,z.z.y,z.z.z),r.updateFloat3("vSphericalXX_ZZ",z.xx.x-z.zz.x,z.xx.y-z.zz.y,z.xx.z-z.zz.z),r.updateFloat3("vSphericalYY_ZZ",z.yy.x-z.zz.x,z.yy.y-z.zz.y,z.yy.z-z.zz.z),r.updateFloat3("vSphericalZZ",z.zz.x,z.zz.y,z.zz.z),r.updateFloat3("vSphericalXY",z.xy.x,z.xy.y,z.xy.z),r.updateFloat3("vSphericalYZ",z.yz.x,z.yz.y,z.yz.z),r.updateFloat3("vSphericalZX",z.zx.x,z.zx.y,z.zx.z)}r.updateFloat3("vReflectionMicrosurfaceInfos",M.getSize().width,M.lodGenerationScale,M.lodGenerationOffset)}this._emissiveTexture&&Y.e.EmissiveTextureEnabled&&(r.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,q.u)(this._emissiveTexture,r,"emissive")),this._lightmapTexture&&Y.e.LightmapTextureEnabled&&(r.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,q.u)(this._lightmapTexture,r,"lightmap")),Y.e.SpecularTextureEnabled&&(this._metallicTexture?(r.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,q.u)(this._metallicTexture,r,"reflectivity")):this._reflectivityTexture&&(r.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,q.u)(this._reflectivityTexture,r,"reflectivity")),this._metallicReflectanceTexture&&(r.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,q.u)(this._metallicReflectanceTexture,r,"metallicReflectance")),this._reflectanceTexture&&T.REFLECTANCE&&(r.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,q.u)(this._reflectanceTexture,r,"reflectance")),this._microSurfaceTexture&&(r.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,q.u)(this._microSurfaceTexture,r,"microSurfaceSampler"))),this._bumpTexture&&p.getCaps().standardDerivatives&&Y.e.BumpTextureEnabled&&!this._disableBumpMap&&(r.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,q.u)(this._bumpTexture,r,"bump"),v._mirroredCameraPosition?r.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):r.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&r.updateFloat("pointSize",this.pointSize),T.METALLICWORKFLOW){var F;c.f.ib[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,c.f.ib[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,r.updateColor4("vReflectivityColor",c.f.ib[0],1);const z=(null===(F=this.subSurface)||void 0===F?void 0:F._indexOfRefraction)??1.5,a=1,K=Math.pow((z-a)/(z+a),2);this._metallicReflectanceColor.scaleToRef(K*this._metallicF0Factor,c.f.ib[0]);const v=this._metallicF0Factor;r.updateColor4("vMetallicReflectanceFactors",c.f.ib[0],v)}else r.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);r.updateColor3("vEmissiveColor",Y.e.EmissiveTextureEnabled?this._emissiveColor:c.c.BlackReadOnly),r.updateColor3("vReflectionColor",this._reflectionColor),!T.SS_REFRACTION&&null!==(W=this.subSurface)&&void 0!==W&&W._linkRefractionWithTransparency?r.updateColor4("vAlbedoColor",this._albedoColor,1):r.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*v.environmentIntensity,this._lightingInfos.w=this._specularIntensity,r.updateVector4("vLightingIntensity",this._lightingInfos),v.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),r.updateColor3("vAmbientColor",this._globalAmbientColor),r.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}v.texturesEnabled&&(this._albedoTexture&&Y.e.DiffuseTextureEnabled&&r.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&Y.e.AmbientTextureEnabled&&r.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&Y.e.OpacityTextureEnabled&&r.setTexture("opacitySampler",this._opacityTexture),M&&Y.e.ReflectionTextureEnabled&&(T.LODBASEDMICROSFURACE?r.setTexture("reflectionSampler",M):(r.setTexture("reflectionSampler",M._lodTextureMid||M),r.setTexture("reflectionSamplerLow",M._lodTextureLow||M),r.setTexture("reflectionSamplerHigh",M._lodTextureHigh||M)),T.USEIRRADIANCEMAP&&r.setTexture("irradianceSampler",M.irradianceTexture)),T.ENVIRONMENTBRDF&&r.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&Y.e.EmissiveTextureEnabled&&r.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&Y.e.LightmapTextureEnabled&&r.setTexture("lightmapSampler",this._lightmapTexture),Y.e.SpecularTextureEnabled&&(this._metallicTexture?r.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&r.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&r.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&T.REFLECTANCE&&r.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&r.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&p.getCaps().standardDerivatives&&Y.e.BumpTextureEnabled&&!this._disableBumpMap&&r.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(a)&&this.va().depthPeelingRenderer.bind(m),this._eventInfo.subMesh=K,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,A.h)(this._activeEffect,this,v),this.bindEyePosition(m)}else v.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(j||!this.isFrozen){var G;if(v.lightsEnabled&&!this._disableLighting&&(0,q.j)(v,a,this._activeEffect,T,this._maxSimultaneousLights),(v.fogEnabled&&a.applyFog&&v.fogMode!==s.c.FOGMODE_NONE||M||this.subSurface.refractionTexture||a.receiveShadows||T.PREPASS)&&this.bindView(m),(0,q.h)(v,a,this._activeEffect,!0),T.NUM_MORPH_INFLUENCERS&&(0,q.p)(a,this._activeEffect),T.BAKED_VERTEX_ANIMATION_TEXTURE)null===(G=a.bakedVertexAnimationManager)||void 0===G||G.bind(m,T.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,q.m)(T,this._activeEffect,v)}this._afterBind(a,this._activeEffect,K),r.update()}getAnimatables(){const z=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&z.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&z.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&z.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&z.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&z.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?z.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&z.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&z.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&z.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&z.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&z.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&z.push(this._microSurfaceTexture),z}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const z=super.getActiveTextures();return this._albedoTexture&&z.push(this._albedoTexture),this._ambientTexture&&z.push(this._ambientTexture),this._opacityTexture&&z.push(this._opacityTexture),this._reflectionTexture&&z.push(this._reflectionTexture),this._emissiveTexture&&z.push(this._emissiveTexture),this._reflectivityTexture&&z.push(this._reflectivityTexture),this._metallicTexture&&z.push(this._metallicTexture),this._metallicReflectanceTexture&&z.push(this._metallicReflectanceTexture),this._reflectanceTexture&&z.push(this._reflectanceTexture),this._microSurfaceTexture&&z.push(this._microSurfaceTexture),this._bumpTexture&&z.push(this._bumpTexture),this._lightmapTexture&&z.push(this._lightmapTexture),z}hasTexture(z){return!!super.hasTexture(z)||(this._albedoTexture===z||(this._ambientTexture===z||(this._opacityTexture===z||(this._reflectionTexture===z||(this._emissiveTexture===z||(this._reflectivityTexture===z||(this._metallicTexture===z||(this._metallicReflectanceTexture===z||(this._reflectanceTexture===z||(this._microSurfaceTexture===z||(this._bumpTexture===z||this._lightmapTexture===z)))))))))))}setPrePassRenderer(){var z;if(null===(z=this.subSurface)||void 0===z||!z.isScatteringEnabled)return!1;const a=this.va().enableSubSurfaceForPrePass();return a&&(a.enabled=!0),!0}dispose(z,a){var K,v,T,m,p,j,s,M,r,W,F,G;(this._breakShaderLoadedCheck=!0,a)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(K=this._albedoTexture)||void 0===K||K.dispose(),null===(v=this._ambientTexture)||void 0===v||v.dispose(),null===(T=this._opacityTexture)||void 0===T||T.dispose(),null===(m=this._reflectionTexture)||void 0===m||m.dispose(),null===(p=this._emissiveTexture)||void 0===p||p.dispose(),null===(j=this._metallicTexture)||void 0===j||j.dispose(),null===(s=this._reflectivityTexture)||void 0===s||s.dispose(),null===(M=this._bumpTexture)||void 0===M||M.dispose(),null===(r=this._lightmapTexture)||void 0===r||r.dispose(),null===(W=this._metallicReflectanceTexture)||void 0===W||W.dispose(),null===(F=this._reflectanceTexture)||void 0===F||F.dispose(),null===(G=this._microSurfaceTexture)||void 0===G||G.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(z,a)}}e.PBRMATERIAL_OPAQUE=w.b.MATERIAL_OPAQUE,e.PBRMATERIAL_ALPHATEST=w.b.MATERIAL_ALPHATEST,e.PBRMATERIAL_ALPHABLEND=w.b.MATERIAL_ALPHABLEND,e.PBRMATERIAL_ALPHATESTANDBLEND=w.b.MATERIAL_ALPHATESTANDBLEND,e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,e.LIGHTFALLOFF_PHYSICAL=0,e.LIGHTFALLOFF_GLTF=1,e.LIGHTFALLOFF_STANDARD=2,e.ForceGLSL=!1,(0,v.e)([(0,T.k)()],e.prototype,"_imageProcessingConfiguration",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsMiscDirty")],e.prototype,"debugMode",void 0)},10758:(z,a,K)=>{"use strict";K.d(a,{e:()=>p});var v=K(10648);const T=new Map;function m(z,a){(function(z){return T.delete(z)})(z)&&v.c.Warn(`Extension with the name '${name}' already exists`),T.set(z,a)}function p(z,a){"image/ktx"!==a&&"image/ktx2"!==a||(z=".ktx"),T.has(z)||(z.endsWith(".dds")&&m(".dds",(()=>K.e(12).then(K.bind(K,12601)).then((z=>new z._DDSTextureLoader)))),z.endsWith(".basis")&&m(".basis",(()=>K.e(13).then(K.bind(K,12603)).then((z=>new z._BasisTextureLoader)))),z.endsWith(".env")&&m(".env",(()=>K.e(14).then(K.bind(K,12608)).then((z=>new z._ENVTextureLoader)))),z.endsWith(".hdr")&&m(".hdr",(()=>K.e(15).then(K.bind(K,12617)).then((z=>new z._HDRTextureLoader)))),(z.endsWith(".ktx")||z.endsWith(".ktx2"))&&(m(".ktx",(()=>K.e(16).then(K.bind(K,12619)).then((z=>new z._KTXTextureLoader)))),m(".ktx2",(()=>K.e(16).then(K.bind(K,12619)).then((z=>new z._KTXTextureLoader))))),z.endsWith(".tga")&&m(".tga",(()=>K.e(17).then(K.bind(K,12622)).then((z=>new z._TGATextureLoader)))),z.endsWith(".exr")&&m(".exr",(()=>K.e(18).then(K.bind(K,12631)).then((z=>new z._ExrTextureLoader)))));const v=T.get(z);return v?Promise.resolve(v(a)):null}},11143:(z,a,K)=>{"use strict";K.d(a,{b:()=>F});var v=K(10923),T=K(10927),m=K(10638),p=K(10941),j=K(10680),s=K(10776),M=(K(10682),K(11152));class r{get wrapU(){return this._wrapU}set wrapU(z){this._wrapU=z}get wrapV(){return this._wrapV}set wrapV(z){this._wrapV=z}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(z){this._texture&&(this._texture.isCube=z)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(z){this._texture&&(this._texture.is3D=z)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(z){this._texture&&(this._texture.is2DArray=z)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(z){return void 0!==(null===z||void 0===z?void 0:z.shareDepth)}constructor(z){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=M.c.Zero(),this._cachedBaseSize=M.c.Zero(),this._initialSamplingMode=2,this._texture=r._IsRenderTargetWrapper(z)?z.texture:z,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(z){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(z,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var W=K(10973);class F extends r{set me(z){this._hasAlpha!==z&&(this._hasAlpha=z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this))))}get me(){return this._hasAlpha}set getAlphaFromRGB(z){this._getAlphaFromRGB!==z&&(this._getAlphaFromRGB=z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(z){this._coordinatesIndex!==z&&(this._coordinatesIndex=z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(z){this._coordinatesMode!==z&&(this._coordinatesMode=z,this._scene&&this._scene.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(z){this._wrapU=z}get wrapV(){return this._wrapV}set wrapV(z){this._wrapV=z}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(z){this._texture?this._texture.isCube=z:this._isCube=z}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(z){this._texture&&(this._texture.is3D=z)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(z){this._texture&&(this._texture.is2DArray=z)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(z){var a;if(this._texture){if(this._texture._gammaSpace===z)return;this._texture._gammaSpace=z}else{if(this._gammaSpace===z)return;this._gammaSpace=z}null===(a=this.va())||void 0===a||a.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(z){var a;z!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=z),null===(a=this.va())||void 0===a||a.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(z){this._texture&&(this._texture._lodGenerationOffset=z)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(z){this._texture&&(this._texture._lodGenerationScale=z)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(z){this._texture&&(this._texture._linearSpecularLOD=z)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(z){this._texture&&(this._texture._irradianceTexture=z)}get uid(){return this._uid||(this._uid=(0,s.c)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(z){this._onDisposeObserver&&this.lj.remove(this._onDisposeObserver),this._onDisposeObserver=this.lj.add(z)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=F.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.lj=new m.c,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,z?F._IsScene(z)?this._scene=z:this._engine=z:this._scene=j.b.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=a,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return p.b.IdentityReadOnly}getReflectionTextureMatrix(){return p.b.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(z){}get canRescale(){return!1}_getFromCache(z,a,K,v,T,m){const p=this._getEngine();if(!p)return null;const j=p._getUseSRGBBuffer(!!T,a),s=p.getLoadedTexturesCache();for(let M=0;M<s.length;M++){const p=s[M];if((void 0===T||j===p._useSRGBBuffer)&&(void 0===v||v===p.invertY)&&p.url===z&&p.generateMipMaps===!a&&(!K||K===p.samplingMode)&&(void 0===m||m===p.isCube))return p.incrementReferences(),p}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const z=this.va();z&&z.markAllMaterialsAsDirty(1)}readPixels(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],T=arguments.length>4&&void 0!==arguments[4]&&arguments[4],m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const M=this._getEngine();if(!M)return null;const r=this.getSize();let W=r.width,F=r.height;0!==a&&(W/=Math.pow(2,a),F/=Math.pow(2,a),W=Math.round(W),F=Math.round(F)),j=Math.min(W,j),s=Math.min(F,s);try{return this._texture.isCube?M._readTexturePixels(this._texture,j,s,z,a,K,v,T,m,p):M._readTexturePixels(this._texture,j,s,-1,a,K,v,T,m,p)}catch(G){return null}}_readPixelsSync(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],T=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const m=this.getSize();let p=m.width,j=m.height;const s=this._getEngine();if(!s)return null;0!=a&&(p/=Math.pow(2,a),j/=Math.pow(2,a),p=Math.round(p),j=Math.round(j));try{return this._texture.isCube?s._readTexturePixelsSync(this._texture,p,j,z,a,K,v,T):s._readTexturePixelsSync(this._texture,p,j,-1,a,K,v,T)}catch(M){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const z=this._scene.textures.indexOf(this);if(z>=0&&this._scene.textures.splice(z,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const z=this._parentContainer.textures.indexOf(this);z>-1&&this._parentContainer.textures.splice(z,1),this._parentContainer=null}}this.lj.notifyObservers(this),this.lj.clear(),this.metadata=null,super.dispose()}serialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!z)return null;const a=W.e.Serialize(this);return W.e.AppendSerializedAnimations(this,a),a}static WhenAllReady(z,a){let K=z.length;if(0!==K)for(let v=0;v<z.length;v++){const T=z[v];if(T.isReady())0===--K&&a();else{const z=T.onLoadObservable;z?z.addOnce((()=>{0===--K&&a()})):0===--K&&a()}}else a()}static _IsScene(z){return"Scene"===z.getClassName()}}F.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,v.e)([(0,T.D)()],F.prototype,"uniqueId",void 0),(0,v.e)([(0,T.D)()],F.prototype,"name",void 0),(0,v.e)([(0,T.D)()],F.prototype,"metadata",void 0),(0,v.e)([(0,T.D)("me")],F.prototype,"_hasAlpha",void 0),(0,v.e)([(0,T.D)("getAlphaFromRGB")],F.prototype,"_getAlphaFromRGB",void 0),(0,v.e)([(0,T.D)()],F.prototype,"level",void 0),(0,v.e)([(0,T.D)("coordinatesIndex")],F.prototype,"_coordinatesIndex",void 0),(0,v.e)([(0,T.D)()],F.prototype,"optimizeUVAllocation",void 0),(0,v.e)([(0,T.D)("coordinatesMode")],F.prototype,"_coordinatesMode",void 0),(0,v.e)([(0,T.D)()],F.prototype,"wrapU",null),(0,v.e)([(0,T.D)()],F.prototype,"wrapV",null),(0,v.e)([(0,T.D)()],F.prototype,"wrapR",void 0),(0,v.e)([(0,T.D)()],F.prototype,"anisotropicFilteringLevel",void 0),(0,v.e)([(0,T.D)()],F.prototype,"isCube",null),(0,v.e)([(0,T.D)()],F.prototype,"is3D",null),(0,v.e)([(0,T.D)()],F.prototype,"is2DArray",null),(0,v.e)([(0,T.D)()],F.prototype,"gammaSpace",null),(0,v.e)([(0,T.D)()],F.prototype,"invertZ",void 0),(0,v.e)([(0,T.D)()],F.prototype,"lodLevelInAlpha",void 0),(0,v.e)([(0,T.D)()],F.prototype,"lodGenerationOffset",null),(0,v.e)([(0,T.D)()],F.prototype,"lodGenerationScale",null),(0,v.e)([(0,T.D)()],F.prototype,"linearSpecularLOD",null),(0,v.e)([(0,T.x)()],F.prototype,"irradianceTexture",null),(0,v.e)([(0,T.D)()],F.prototype,"isRenderTarget",void 0)},11929:(z,a,K)=>{"use strict";var v=K(11460),T=K(11143);T.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(T.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=v.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((z=>{this._texture._sphericalPolynomial=z,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(z){this._texture&&(this._texture._sphericalPolynomial=z)},enumerable:!0,configurable:!0})},11978:(z,a,K)=>{"use strict";K.d(a,{c:()=>F});var v=K(10923),T=K(10927),m=K(10631),p=K(10941),j=K(11143),s=K(11134),M=K(10767),r=K(10638),W=K(10973);K(11495);class F extends j.b{set boundingBoxSize(z){if(this._boundingBoxSize&&this._boundingBoxSize.equals(z))return;this._boundingBoxSize=z;const a=this.va();a&&a.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(z){this._rotationY=z,this.setReflectionTextureMatrix(p.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(z,a,K){let v="";return z.forEach((z=>v+=z)),new F(v,a,null,K,z)}static CreateFromPrefilteredData(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const T=a.useDelayedTextureLoading;a.useDelayedTextureLoading=!1;const m=new F(z,a,null,!1,null,null,null,void 0,!0,K,v);return a.useDelayedTextureLoading=T,m}constructor(z,a){var K;let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,F=arguments.length>8&&void 0!==arguments[8]&&arguments[8],G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,l=arguments.length>10&&void 0!==arguments[10]&&arguments[10],V=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,C=arguments.length>13?arguments[13]:void 0,w=arguments.length>14?arguments[14]:void 0;super(a),this.onLoadObservable=new r.c,this.boundingBoxPosition=p.o.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new p.b,this._buffer=null,this.name=z,this.url=z,this._noMipmap=T,this.me=!1,this.isCube=!0,this._textureMatrix=p.b.Identity(),this.coordinatesMode=s.d.CUBIC_MODE;let H=null,f=null;null===v||Array.isArray(v)?(this._noMipmap=T,this._format=W,this._createPolynomials=l,H=v,this._loaderOptions=C,this._useSRGBBuffer=w,this._lodScale=V,this._lodOffset=c):(H=v.extensions??null,this._noMipmap=v.noMipmap??!1,m=v.files??null,f=v.buffer??null,this._format=v.format??5,F=v.prefiltered??!1,G=v.forcedExtension??null,this._createPolynomials=v.createPolynomials??!1,this._lodScale=v.lodScale??.8,this._lodOffset=v.lodOffset??0,this._loaderOptions=v.loaderOptions,this._useSRGBBuffer=v.useSRGBBuffer,j=v.X??null,M=v.onError??null),(z||m)&&this.updateURL(z,G,j,F,M,H,null===(K=this.va())||void 0===K?void 0:K.useDelayedTextureLoading,m,f)}getClassName(){return"CubeTexture"}updateURL(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=z),this.url=z,a&&(this._forcedExtension=a);const M=z.lastIndexOf("."),r=a||(M>-1?z.substring(M).toLowerCase():""),W=0===r.indexOf(".dds"),F=0===r.indexOf(".env"),G=0===r.indexOf(".basis");if(F?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=v,v&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),j)this._files=j;else if(G||F||W||m||(m=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,m){for(let a=0;a<m.length;a++)this._files.push(z+m[a]);this._extensions=m}this._buffer=s,p?(this.delayLoadState=4,this._delayedOnLoad=K,this._delayedOnError=T):this._loadTexture(K,T)}delayLoad(z){4===this.delayLoadState&&(z&&(this._forcedExtension=z),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(z){var a,K;if(z.updateFlag===this._textureMatrix.updateFlag)return;z.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(K=this.va())||void 0===K||K.markAllMaterialsAsDirty(1,(z=>-1!==z.getActiveTextures().indexOf(this))));if(this._textureMatrix=z,null===(a=this.va())||void 0===a||!a.useRightHandedSystem)return;const v=p.j.gb[0],T=p.j.Quaternion[0],m=p.j.gb[1];this._textureMatrix.decompose(v,T,m),T.z*=-1,T.w*=-1,p.b.ComposeToRef(v,T,m,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var z;return null!==(z=this.va())&&void 0!==z&&z.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=this.va(),v=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const T=()=>{var a;(this.onLoadObservable.notifyObservers(this),v)&&(v.dispose(),null===(a=this.va())||void 0===a||a.markAllMaterialsAsDirty(1));z&&z()},p=(z,K)=>{this._loadingError=!0,this._errorObject={message:z,exception:K},a&&a(z,K),s.d.OnTextureLoadErrorObservable.notifyObservers(this)};var j;this._texture?this._texture.isReady?m.h.SetImmediate((()=>T())):this._texture.onLoadedObservable.add((()=>T())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,K,this._lodScale,this._lodOffset,z,p,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,K,this._files,this._noMipmap,z,p,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(j=this._texture)||void 0===j||j.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(z,a,K){const v=W.e.Parse((()=>{let v=!1;return z.prefiltered&&(v=z.prefiltered),new F(K+(z.url??z.name),a,z.extensions,!1,z.files||null,null,null,void 0,v,z.forcedExtension)}),z,a);if(z.boundingBoxPosition&&(v.boundingBoxPosition=p.o.Jg(z.boundingBoxPosition)),z.boundingBoxSize&&(v.boundingBoxSize=p.o.Jg(z.boundingBoxSize)),z.animations)for(let T=0;T<z.animations.length;T++){const a=z.animations[T],K=(0,M.c)("BABYLON.Animation");K&&v.animations.push(K.Parse(a))}return v}clone(){let z=0;const a=W.e.Clone((()=>{const a=new F(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return z=a.uniqueId,a}),this);return a.uniqueId=z,a}}(0,v.e)([(0,T.D)()],F.prototype,"url",void 0),(0,v.e)([(0,T.B)()],F.prototype,"boundingBoxPosition",void 0),(0,v.e)([(0,T.B)()],F.prototype,"boundingBoxSize",null),(0,v.e)([(0,T.D)("rotationY")],F.prototype,"rotationY",null),(0,v.e)([(0,T.D)("files")],F.prototype,"_files",void 0),(0,v.e)([(0,T.D)("forcedExtension")],F.prototype,"_forcedExtension",void 0),(0,v.e)([(0,T.D)("extensions")],F.prototype,"_extensions",void 0),(0,v.e)([(0,T.o)("textureMatrix")],F.prototype,"_textureMatrix",void 0),(0,v.e)([(0,T.o)("textureMatrixRefraction")],F.prototype,"_textureMatrixRefraction",void 0),s.d._CubeTextureParser=F.Parse,(0,M.e)("BABYLON.CubeTexture",F)},12379:(z,a,K)=>{"use strict";K.d(a,{d:()=>s});var v=K(10648),T=K(11134),m=K(10782),p=K(11377),j=K(10748);p.ThinEngine.prototype.createDynamicTexture=function(z,a,K,v){const T=new j.b(this,4);return T.baseWidth=z,T.baseHeight=a,K&&(z=this.needPOTTextures?(0,m.g)(z,this._caps.maxTextureSize):z,a=this.needPOTTextures?(0,m.g)(a,this._caps.maxTextureSize):a),T.width=z,T.height=a,T.isReady=!1,T.generateMipMaps=K,T.samplingMode=v,this.updateTextureSamplingMode(v,T),this._internalTexturesCache.push(T),T},p.ThinEngine.prototype.updateDynamicTexture=function(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!z)return;const p=this._gl,j=p.TEXTURE_2D,s=this._bindTextureDirectly(j,z,!0,m);this._unpackFlipY(void 0===K?z.invertY:K),v&&p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const M=this._getWebGLTextureType(z.type),r=this._getInternalFormat(T||z.format),W=this._getRGBABufferInternalSizedFormat(z.type,r);p.texImage2D(j,0,W,r,M,a),z.generateMipMaps&&p.generateMipmap(j),s||this._bindTextureDirectly(j,null),v&&p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),T&&(z.format=T),z._dynamicTextureSource=a,z._premulAlpha=v,z.invertY=K||!1,z.isReady=!0};class s extends T.d{constructor(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,j=arguments.length>6?arguments[6]:void 0;const s=!K||K._isScene;super(null,s?K:null===K||void 0===K?void 0:K.Oc,s?!v:K,j,m,void 0,void 0,void 0,void 0,p),this.name=z,this.wrapU=T.d.CLAMP_ADDRESSMODE,this.wrapV=T.d.CLAMP_ADDRESSMODE,this._generateMipMaps=v;const M=this._getEngine();if(!M)return;if(a.getContext)this._canvas=a,this._ownCanvas=!1,this._texture=M.createDynamicTexture(this._canvas.width,this._canvas.height,v,m);else{this._canvas=M.createCanvas(1,1),this._ownCanvas=!0;const z=a;z.width||0===z.width?this._texture=M.createDynamicTexture(z.width,z.height,v,m):this._texture=M.createDynamicTexture(a,a,v,m)}const r=this.getSize();this._canvas.width!==r.width&&(this._canvas.width=r.width),this._canvas.height!==r.height&&(this._canvas.height=r.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(z){this._canvas.width=z.width,this._canvas.height=z.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(z.width,z.height,this._generateMipMaps,this.samplingMode)}scale(z){const a=this.getSize();a.width*=z,a.height*=z,this._recreate(a)}scaleTo(z,a){const K=this.getSize();K.width=z,K.height=a,this._recreate(K)}getContext(){return this._context}clear(z){const a=this.getSize();z&&(this._context.fillStyle=z),this._context.clearRect(0,0,a.width,a.height)}update(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===z||z,a,this._format||void 0,void 0,K)}drawText(z,a,K,v,T,m,p){let j=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const s=this.getSize();if(m&&(this._context.fillStyle=m,this._context.fillRect(0,0,s.width,s.height)),this._context.font=v,null===a||void 0===a){const K=this._context.measureText(z);a=(s.width-K.width)/2}if(null===K||void 0===K){const z=parseInt(v.replace(/\D/g,""));K=s.height/2+z/3.65}this._context.fillStyle=T||"",this._context.fillText(z,a,K),j&&this.update(p)}dispose(){var z,a;(super.dispose(),this._ownCanvas)&&(null===(z=this._canvas)||void 0===z||null===(a=z.remove)||void 0===a||a.call(z));this._canvas=null,this._context=null}clone(){const z=this.va();if(!z)return this;const a=this.getSize(),K=new s(this.name,a,z,this._generateMipMaps);return K.me=this.me,K.level=this.level,K.wrapU=this.wrapU,K.wrapV=this.wrapV,K}serialize(){const z=this.va();z&&!z.isReady()&&v.c.Warn("The scene must be ready before serializing the dynamic texture");const a=super.serialize();return s._IsCanvasElement(this._canvas)&&(a.base64String=this._canvas.toDataURL()),a.invertY=this._invertY,a.samplingMode=this.samplingMode,a}static _IsCanvasElement(z){return void 0!==z.toDataURL}_rebuild(){this.update()}}},10748:(z,a,K)=>{"use strict";K.d(a,{b:()=>p});var v,T=K(10638),m=K(10751);!function(z){z[z.Unknown=0]="Unknown",z[z.Url=1]="Url",z[z.Temp=2]="Temp",z[z.Raw=3]="Raw",z[z.Dynamic=4]="Dynamic",z[z.RenderTarget=5]="RenderTarget",z[z.MultiRenderTarget=6]="MultiRenderTarget",z[z.Cube=7]="Cube",z[z.CubeRaw=8]="CubeRaw",z[z.CubePrefiltered=9]="CubePrefiltered",z[z.Raw3D=10]="Raw3D",z[z.Raw2DArray=11]="Raw2DArray",z[z.DepthStencil=12]="DepthStencil",z[z.CubeRawRGBD=13]="CubeRawRGBD",z[z.Depth=14]="Depth"}(v||(v={}));class p extends m.d{get useMipMaps(){return this.generateMipMaps}set useMipMaps(z){this.generateMipMaps=z}get uniqueId(){return this._uniqueId}_setUniqueId(z){this._uniqueId=z}getEngine(){return this._engine}get source(){return this._source}constructor(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new T.c,this.onErrorObservable=new T.c,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=z,this._source=a,this._uniqueId=p._Counter++,K||(this._hardwareTexture=z._createHardwareTexture())}incrementReferences(){this._references++}updateSize(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,z,a,K),this.width=z,this.height=a,this.depth=K,this.baseWidth=z,this.baseHeight=a,this.baseDepth=K,this._size=z*a*K}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const z=this.onRebuildCallback(this),a=a=>{a._swapAndDie(this,!1),this.isReady=z.isReady};return void(z.isAsync?z.proxy.then(a):a(z.proxy))}let z;switch(this.source){case 2:case 12:case 14:break;case 1:return void(z=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(z=>{z._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:z=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),z._swapAndDie(this,!1),this.isReady=!0;break;case 10:z=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),z._swapAndDie(this,!1),this.isReady=!0;break;case 11:z=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),z._swapAndDie(this,!1),this.isReady=!0;break;case 4:z=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),z._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(z=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{z._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:z=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),z._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return z=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(z=>{z&&z._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(z._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(z){var a;let K=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(a=this._hardwareTexture)||void 0===a||a.setUsage(z._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),z._hardwareTexture=this._hardwareTexture,K&&(z._isRGBD=this._isRGBD),this._lodTextureHigh&&(z._lodTextureHigh&&z._lodTextureHigh.dispose(),z._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(z._lodTextureMid&&z._lodTextureMid.dispose(),z._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(z._lodTextureLow&&z._lodTextureLow.dispose(),z._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(z._irradianceTexture&&z._irradianceTexture.dispose(),z._irradianceTexture=this._irradianceTexture);const v=this._engine.getLoadedTexturesCache();let T=v.indexOf(this);-1!==T&&v.splice(T,1),T=v.indexOf(z),-1===T&&v.push(z)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}p._Counter=0},11401:(z,a,K)=>{"use strict";K.d(a,{c:()=>T});var v=K(11134);class T extends v.d{constructor(z,a,K,T,m){let p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,r=arguments.length>9?arguments[9]:void 0,W=arguments.length>10?arguments[10]:void 0;super(null,m,!p,j,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,r),this.format=T,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==M||(s=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==M||(s=1),this._texture=this._engine.createRawTexture(z,a,K,T,p,j,s,null,M,r??0,W??!1),this.wrapU=v.d.CLAMP_ADDRESSMODE,this.wrapV=v.d.CLAMP_ADDRESSMODE)}update(z){this._getEngine().updateRawTexture(this._texture,z,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const z=new T(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return z._texture=this._texture,this._texture.incrementReferences(),z}static CreateLuminanceTexture(z,a,K,v){return new T(z,a,K,1,v,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(z,a,K,v){return new T(z,a,K,2,v,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(z,a,K,v){return new T(z,a,K,0,v,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(z,a,K,v){return new T(z,a,K,4,v,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(z,a,K,v){return new T(z,a,K,5,v,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(z,a,K,v){return new T(z,a,K,5,v,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(z,a,K,m){let p=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:v.d.TRILINEAR_SAMPLINGMODE;return new T(z,a,K,6,m,p,j,s,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(z,a,K,m){let p=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:v.d.TRILINEAR_SAMPLINGMODE;return new T(z,a,K,6,m,p,j,s,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11791:(z,a,K)=>{"use strict";K.d(a,{d:()=>T});var v=K(11134);class T extends v.d{get depth(){return this._depth}constructor(z,a,K,T,m,p){let j=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:v.d.TRILINEAR_SAMPLINGMODE,r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,W=arguments.length>10?arguments[10]:void 0;super(null,p,!j,s),this.format=m,this._texture=p.getEngine().createRawTexture2DArray(z,a,K,T,m,j,s,M,null,r,W),this._depth=T,this.is2DArray=!0}update(z){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,z,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(z,a,K,v,m){return new T(z,a,K,v,5,m,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11475:(z,a,K)=>{"use strict";K.d(a,{b:()=>F});var v=K(10638),T=K(10941),m=K(11134),p=K(11009),j=K(11011),s=K(10951),M=K(10782),r=K(10720),W=K(10648);r.c.prototype.setDepthStencilTexture=function(z,a){this._engine.setDepthStencilTexture(this._samplers[z],this._uniforms[z],a,z)};class F extends m.d{get renderList(){return this._renderList}set renderList(z){this._renderList!==z&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),z&&(this._unObserveRenderList=(0,s.j)(z,this._renderListHasChanged)),this._renderList=z)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(z){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(z)}set onBeforeRender(z){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(z)}set onAfterRender(z){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(z)}set onClear(z){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(z)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(z,a){let K;K=Array.isArray(z)?z:[z];for(let v=0;v<K.length;++v)for(let z=0;z<this._renderPassIds.length;++z)K[v].setMaterialForRenderPass(this._renderPassIds[z],void 0!==a?Array.isArray(a)?a[z]:a:void 0)}get isMulti(){var z;return(null===(z=this._renderTarget)||void 0===z?void 0:z.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(z){if(this._boundingBoxSize&&this._boundingBoxSize.equals(z))return;this._boundingBoxSize=z;const a=this.va();a&&a.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var z;return(null===(z=this._renderTarget)||void 0===z?void 0:z._depthStencilTexture)??null}constructor(z,a,K){let p,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,W=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:m.d.TRILINEAR_SAMPLINGMODE,G=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],l=arguments.length>9&&void 0!==arguments[9]&&arguments[9],V=arguments.length>10&&void 0!==arguments[10]&&arguments[10],c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,C=arguments.length>12&&void 0!==arguments[12]&&arguments[12],w=arguments.length>13?arguments[13]:void 0,H=arguments.length>14?arguments[14]:void 0,f=arguments.length>15&&void 0!==arguments[15]&&arguments[15],Y=arguments.length>16&&void 0!==arguments[16]&&arguments[16],I=!0;if("object"===typeof s){const z=s;s=!!z.generateMipMaps,M=z.doNotChangeAspectRatio??!0,r=z.type??0,W=!!z.isCube,F=z.samplingMode??m.d.TRILINEAR_SAMPLINGMODE,G=z.generateDepthBuffer??!0,l=!!z.generateStencilBuffer,V=!!z.isMulti,c=z.format??5,C=!!z.delayAllocation,w=z.samples,H=z.creationFlags,f=!!z.noColorAttachment,Y=!!z.useSRGBBuffer,p=z.colorAttachment,I=z.gammaSpace??I}if(super(null,K,!s,void 0,F,void 0,void 0,void 0,void 0,c),this._unObserveRenderList=null,this._renderListHasChanged=(z,a)=>{const K=this._renderList?this._renderList.length:0;var v;(0===a&&K>0||0===K)&&(null===(v=this.va())||void 0===v||v.meshes.forEach((z=>{z._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new v.c,this.onAfterUnbindObservable=new v.c,this.onBeforeRenderObservable=new v.c,this.onAfterRenderObservable=new v.c,this.onClearObservable=new v.c,this.onResizeObservable=new v.c,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=T.o.Zero(),this._dumpToolsLoading=!1,!(K=this.va()))return;const q=this.va().getEngine();this._gammaSpace=I,this._coordinatesMode=m.d.PROJECTION_MODE,this.renderList=[],this.name=z,this.isRenderTarget=!0,this._initialSizeParameter=a,this._renderPassIds=[],this._isCubeData=W,this._processSizeParameter(a),this.renderPassId=this._renderPassIds[0],this._resizeObserver=q.onResizeObservable.add((()=>{})),this._generateMipMaps=!!s,this._doNotChangeAspectRatio=M,this._renderingManager=new j.e(K),this._renderingManager._useSceneAutoClearSetup=!0,V||(this._renderTargetOptions={generateMipMaps:s,type:r,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:G,generateStencilBuffer:l,samples:w,creationFlags:H,noColorAttachment:f,useSRGBBuffer:Y,colorAttachment:p,label:this.name},this.samplingMode===m.d.NEAREST_SAMPLINGMODE&&(this.wrapU=m.d.CLAMP_ADDRESSMODE,this.wrapV=m.d.CLAMP_ADDRESSMODE),C||(W?(this._renderTarget=K.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=m.d.INVCUBIC_MODE,this._textureMatrix=T.b.Identity()):this._renderTarget=K.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==w&&(this.samples=w)))}createDepthStencilTexture(){var z;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,K=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,p=arguments.length>5?arguments[5]:void 0;null===(z=this._renderTarget)||void 0===z||z.createDepthStencilTexture(a,K,v,T,m,p)}_releaseRenderPassId(){if(this._scene){const z=this._scene.getEngine();for(let a=0;a<this._renderPassIds.length;++a)z.releaseRenderPassId(this._renderPassIds[a])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const z=this._scene.getEngine(),a=this._isCubeData?6:this.getRenderLayers()||1;for(let K=0;K<a;++K)this._renderPassIds[K]=z.createRenderPassId(`RenderTargetTexture - ${this.name}#${K}`)}_processSizeParameter(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(z.ratio){this._sizeRatio=z.ratio;const a=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(a.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(a.getRenderHeight(),this._sizeRatio)}}else this._size=z;a&&this._createRenderPassId()}get samples(){var z;return(null===(z=this._renderTarget)||void 0===z?void 0:z.samples)??this._samples}set samples(z){this._renderTarget&&(this._samples=this._renderTarget.setSamples(z))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(z){this._refreshRate=z,this.resetRefreshCounter()}addPostProcess(z){if(!this._postProcessManager){const z=this.va();if(!z)return;this._postProcessManager=new p.d(z),this._postProcesses=new Array}this._postProcesses.push(z),this._postProcesses[0].Vi=!1}clearPostProcesses(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(z)for(const z of this._postProcesses)z.dispose();this._postProcesses=[]}}removePostProcess(z){if(!this._postProcesses)return;const a=this._postProcesses.indexOf(z);-1!==a&&(this._postProcesses.splice(a,1),this._postProcesses.length>0&&(this._postProcesses[0].Vi=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const z=this._size.layers;if(z)return z;const a=this._size.depth;return a||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(z){const a=Math.max(1,this.getRenderSize()*z);this.resize(a)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(z){var a;const K=this.isCube;null===(a=this._renderTarget)||void 0===a||a.dispose(),this._renderTarget=null;const v=this.va();v&&(this._processSizeParameter(z,!1),this._renderTarget=K?v.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):v.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(z,a)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(K.bind(K,11969)).then((z=>this._dumpTools=z))),this._render(!1,!1,!0)}_render(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=this.va();if(!v)return K;const T=v.getEngine();if(void 0!==this.useCameraPostProcesses&&(z=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let z=0;z<this._waitingRenderList.length;z++){const a=this._waitingRenderList[z],K=v.getMeshById(a);K&&this.renderList.push(K)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const z=this.va();if(!z)return K;const a=z.meshes;for(let K=0;K<a.length;K++){const z=a[K];this.renderListPredicate(z)&&this.renderList.push(z)}}const m=T.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const p=this.activeCamera??v.activeCamera,j=v.activeCamera;p&&(p!==v.activeCamera&&(v.setTransformMatrix(p.getViewMatrix(),p.getProjectionMatrix(!0)),v.activeCamera=p),T.setViewport(p.rigParent?p.rigParent.viewport:p.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let s=K;if(K){v.getViewMatrix()||v.updateTransformMatrix();const z=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let m=0;m<z&&s;m++){let z=null;const a=this.renderList?this.renderList:v.getActiveMeshes().data,p=this.renderList?this.renderList.length:v.getActiveMeshes().length;T.currentRenderPassId=this._renderPassIds[m],this.onBeforeRenderObservable.notifyObservers(m),this.getCustomRenderList&&(z=this.getCustomRenderList(m,a,p)),z||(z=a),this._doNotChangeAspectRatio||v.updateTransformMatrix(!0);for(let v=0;v<z.length&&s;++v){const a=z[v];if(a.isEnabled()&&!a.isBlocked&&a.isVisible&&a.Vf)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(a,this.refreshRate,K)){s=!1;continue}}else if(!a.isReady(!0)){s=!1;continue}}this.onAfterRenderObservable.notifyObservers(m),(this.is2DArray||this.is3D||this.isCube)&&(v.incrementRenderId(),v.resetCachedMaterial())}const a=this.particleSystemList||v.sj;for(const K of a)K.isReady()||(s=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let M=0;M<6;M++)this._renderToTarget(M,z,a,void 0,p),v.incrementRenderId(),v.resetCachedMaterial();else this._renderToTarget(0,z,a,void 0,p);else for(let M=0;M<this.getRenderLayers();M++)this._renderToTarget(0,z,a,M,p),v.incrementRenderId(),v.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),T.currentRenderPassId=m,v.activeCamera=j,j&&(this.activeCamera&&this.activeCamera!==v.activeCamera&&v.setTransformMatrix(j.getViewMatrix(),j.getProjectionMatrix(!0)),T.setViewport(j.viewport)),v.resetCachedMaterial(),s}_bestReflectionRenderTargetDimension(z,a){const K=z*a,v=(0,M.n)(K+16384/(128+K));return Math.min((0,M.e)(z),v)}_prepareRenderingManager(z,a,K,v){const T=this.va();if(!T)return;this._renderingManager.reset();const m=T.getRenderId();for(let j=0;j<a;j++){const a=z[j];if(a&&!a.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(a,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!a.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!a._internalAbstractMeshDataInfo._currentLODIsUpToDate&&K&&(a._internalAbstractMeshDataInfo._currentLOD=T.customLODSelector?T.customLODSelector(a,K):a.getLOD(K),a._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!a._internalAbstractMeshDataInfo._currentLOD)continue;let z,p=a._internalAbstractMeshDataInfo._currentLOD;if(p!==a&&0!==p.billboardMode&&p.Qj(),p._preActivateForIntermediateRendering(m),z=!(!v||!K)&&0===(a.layerMask&K.layerMask),a.isEnabled()&&a.isVisible&&a.Vf&&!z){if(p!==a&&p._activate(m,!0),a._activate(m,!0)&&a.Vf.length){a.isAnInstance?a._internalAbstractMeshDataInfo._actAsRegularMesh&&(p=a):p._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,p._internalAbstractMeshDataInfo._isActiveIntermediate=!0,T._prepareSkeleton(p);for(let z=0;z<p.Vf.length;z++){const a=p.Vf[z];this._renderingManager.dispatch(a,p)}}a._postActivate()}}}const p=this.particleSystemList||T.sj;for(let j=0;j<p.length;j++){const z=p[j],a=z.j;z.isStarted()&&a&&(!a.position||a.isEnabled())&&this._renderingManager.dispatchParticles(z)}}_bindFrameBuffer(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const K=this.va();if(!K)return;const v=K.getEngine();this._renderTarget&&v.bindFramebuffer(this._renderTarget,this.isCube?z:void 0,void 0,void 0,this.ignoreCameraViewport,0,a)}_unbindFrameBuffer(z,a){this._renderTarget&&z.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(a)}))}_prepareFrame(z,a,K,v){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):v&&z.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(a,K)}_renderToTarget(z,a,K){var v,T;let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const j=this.va();if(!j)return;const s=j.getEngine();this._prepareFrame(j,z,m,a),null===(v=s._debugPushGroup)||void 0===v||v.call(s,`render to face #${z} layer #${m}`,2),this.is2DArray||this.is3D?(s.currentRenderPassId=this._renderPassIds[m],this.onBeforeRenderObservable.notifyObservers(m)):(s.currentRenderPassId=this._renderPassIds[z],this.onBeforeRenderObservable.notifyObservers(z));if(s.snapshotRendering&&1===s.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(s):this.skipInitialClear||s.clear(this.clearColor||j.clearColor,!0,!0,!0);else{var M;let v=null;const T=this.renderList?this.renderList:j.getActiveMeshes().data,r=this.renderList?this.renderList.length:j.getActiveMeshes().length;this.getCustomRenderList&&(v=this.getCustomRenderList(this.is2DArray||this.is3D?m:z,T,r)),v?this._prepareRenderingManager(v,v.length,p,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(T,r,p,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),v=T);for(const a of j._beforeRenderTargetClearStage)a.action(this,z,m);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(s):this.skipInitialClear||s.clear(this.clearColor||j.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||j.updateTransformMatrix(!0);for(const a of j._beforeRenderTargetDrawStage)a.action(this,z,m);this._renderingManager.render(this.customRenderFunction,v,this.renderParticles,this.renderSprites);for(const a of j._afterRenderTargetDrawStage)a.action(this,z,m);const F=(null===(M=this._texture)||void 0===M?void 0:M.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,z,this._postProcesses,this.ignoreCameraViewport):a&&j.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,z);for(const a of j._afterRenderTargetPostProcessStage)a.action(this,z,m);this._texture&&(this._texture.generateMipMaps=F),this._doNotChangeAspectRatio||j.updateTransformMatrix(!0),K&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),s):W.c.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(T=s._debugPopGroup)||void 0===T||T.call(s,2),this._unbindFrameBuffer(s,z),this._texture&&this.isCube&&5===z&&s.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(z,a,K,v)}setRenderingAutoClearDepthStencil(z,a){this._renderingManager.setRenderingAutoClearDepthStencil(z,a),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const z=this.getSize(),a=new F(this.name,z,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return a.me=this.me,a.level=this.level,a.coordinatesMode=this.coordinatesMode,this.renderList&&(a.renderList=this.renderList.slice(0)),a}serialize(){if(!this.name)return null;const z=super.serialize();if(z.renderTargetSize=this.getRenderSize(),z.renderList=[],this.renderList)for(let a=0;a<this.renderList.length;a++)z.renderList.push(this.renderList[a].id);return z}disposeFramebufferObjects(){var z;null===(z=this._renderTarget)||void 0===z||z.dispose(!0)}releaseInternalTexture(){var z;null===(z=this._renderTarget)||void 0===z||z.releaseTextures(),this._texture=null}dispose(){var z;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const a=this.va();if(!a)return;let K=a.customRenderTargets.indexOf(this);K>=0&&a.customRenderTargets.splice(K,1);for(const v of a.cameras)K=v.customRenderTargets.indexOf(this),K>=0&&v.customRenderTargets.splice(K,1);null===(z=this._renderTarget)||void 0===z||z.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===F.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=F.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}F.REFRESHRATE_RENDER_ONCE=0,F.REFRESHRATE_RENDER_ONEVERYFRAME=1,F.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,m.d._CreateRenderTargetTexture=(z,a,K,v,T)=>new F(z,a,K,v)},11134:(z,a,K)=>{"use strict";K.d(a,{d:()=>H});var v=K(10923),T=K(10927),m=K(10638),p=K(10941),j=K(11143),s=K(10767),M=K(10663),r=K(10706),W=K(10764),F=K(11038),G=K(10690);function l(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=a.width,T=a.height;if(z instanceof Float32Array){let a=z.byteLength/z.BYTES_PER_ELEMENT;const K=new Uint8Array(a);for(;--a>=0;){let v=z[a];v<0?v=0:v>1&&(v=1),K[a]=255*v}z=K}const m=document.createElement("canvas");m.width=v,m.height=T;const p=m.getContext("2d");if(!p)return null;const j=p.createImageData(v,T);if(j.data.set(z),p.putImageData(j,0,0),K){const z=document.createElement("canvas");z.width=v,z.height=T;const a=z.getContext("2d");return a?(a.translate(0,T),a.scale(1,-1),a.drawImage(m,0,0),z.toDataURL("image/png")):null}return m.toDataURL("image/png")}function V(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const v=z.getInternalTexture();if(!v)return null;const T=z._readPixelsSync(a,K);return T?l(T,z.getSize(),v.invertY):null}async function c(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const v=z.getInternalTexture();if(!v)return null;const T=await z.readPixels(a,K);return T?l(T,z.getSize(),v.invertY):null}var C=K(11161),w=K(10973);class H extends j.b{static _CreateVideoTexture(z,a,K){arguments.length>5&&void 0!==arguments[5]||H.TRILINEAR_SAMPLINGMODE;throw(0,M.b)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(z){this._isBlocking=z}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(z,a,K,v){let T,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:H.TRILINEAR_SAMPLINGMODE,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]&&arguments[8],F=arguments.length>9?arguments[9]:void 0,G=arguments.length>10?arguments[10]:void 0,l=arguments.length>11?arguments[11]:void 0,V=arguments.length>12?arguments[12]:void 0,c=arguments.length>13?arguments[13]:void 0;super(a),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new m.c,this._isBlocking=!0,this.name=z||"",this.url=z;let w=!1,f=null,Y=!0;"object"===typeof K&&null!==K?(T=K.noMipmap??!1,v=K.invertY??!C.d,p=K.samplingMode??H.TRILINEAR_SAMPLINGMODE,j=K.X??null,s=K.onError??null,M=K.buffer??null,W=K.deleteBuffer??!1,F=K.format,G=K.mimeType,l=K.loaderOptions,V=K.creationFlags,w=K.useSRGBBuffer??!1,f=K.internalTexture??null,Y=K.gammaSpace??Y):T=!!K,this._gammaSpace=Y,this._noMipmap=T,this._invertY=void 0===v?!C.d:v,this._initialSamplingMode=p,this._buffer=M,this._deleteBuffer=W,this._mimeType=G,this._loaderOptions=l,this._creationFlags=V,this._useSRGBBuffer=w,this._forcedExtension=c,F&&(this._format=F);const I=this.va(),q=this._getEngine();if(!q)return;q.onBeforeTextureInitObservable.notifyObservers(this);const B=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),j&&j(),!this.isBlocking&&I&&I.resetCachedMaterial()},x=(z,a)=>{this._loadingError=!0,this._errorObject={message:z,exception:a},s&&s(z,a),H.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!f)return this._delayedOnLoad=B,void(this._delayedOnError=x);if(this._texture=f??this._getFromCache(this.url,T,p,this._invertY,w,this.isCube),this._texture)if(this._texture.isReady)r.b.SetImmediate((()=>B()));else{const z=this._texture.onLoadedObservable.add(B);this._texture.onErrorObservable.add((a=>{var K;x(a.message,a.exception),null===(K=this._texture)||void 0===K||K.onLoadedObservable.remove(z)}))}else if(I&&I.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=B,this._delayedOnError=x;else{try{this._texture=q.createTexture(this.url,T,this._invertY,I,p,B,x,this._buffer,void 0,this._format,this._forcedExtension,G,l,V,w)}catch(Z){throw x("error loading",Z),Z}W&&(this._buffer=null)}}updateURL(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0,v=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(z=>z.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=z),this.url=z,this._buffer=a,this._forcedExtension=v,this.delayLoadState=4,K&&(this._delayedOnLoad=K),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const z=this.va();z&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?r.b.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=z.getEngine().createTexture(this.url,this._noMipmap,this._invertY,z,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(z,a,K,v){z*=this._cachedUScale,a*=this._cachedVScale,z-=this.uRotationCenter*this._cachedUScale,a-=this.vRotationCenter*this._cachedVScale,K-=this.wRotationCenter,p.o.TransformCoordinatesFromFloatsToRef(z,a,K,this._rowGenerationMatrix,v),v.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,v.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,v.z+=this.wRotationCenter}getTextureMatrix(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*z===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*z,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=p.b.Zero(),this._rowGenerationMatrix=new p.b,this._t0=p.o.Zero(),this._t1=p.o.Zero(),this._t2=p.o.Zero()),p.b.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(p.b.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,p.j.Matrix[0]),p.b.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,p.j.Matrix[1]),p.b.ScalingToRef(this._cachedUScale,this._cachedVScale,0,p.j.Matrix[2]),p.b.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,p.j.Matrix[3]),p.j.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(p.j.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(p.j.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(p.j.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.ri(this._t0),this._t2.ri(this._t0),p.b.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const a=this.va();if(!a)return this._cachedTextureMatrix;const K=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&K!==this._cachedIdentity3x2&&a.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const z=this.va();if(!z)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==H.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===z.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=p.b.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=p.b.Zero());const a=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case H.PLANAR_MODE:p.b.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case H.PROJECTION_MODE:{p.b.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const a=z.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=a.updateFlag,a.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:p.b.IdentityToRef(this._cachedReflectionTextureMatrix)}return a&&z.markAllMaterialsAsDirty(1,(z=>z.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const z={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return w.e.Clone((()=>new H(this._texture?this._texture.url:null,this.va(),z)),this)}serialize(){var z;const a=this.name;H.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const K=super.serialize(H._SerializeInternalTextureUniqueId);if(!K)return null;var v;((H.SerializeBuffers||H.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(K.base64String=this._buffer,K.name=K.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?K.base64String="data:image/png;base64,"+(0,G.k)(this._buffer):(H.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(K.base64String=!this._engine||this._engine._features.supportSyncTextureRead?V(this):c(this))),K.invertY=this._invertY,K.samplingMode=this.samplingMode,K._creationFlags=this._creationFlags,K._useSRGBBuffer=this._useSRGBBuffer,H._SerializeInternalTextureUniqueId)&&(K.internalTextureUniqueId=null===(v=this._texture)||void 0===v?void 0:v.uniqueId);return K.internalTextureLabel=null===(z=this._texture)||void 0===z?void 0:z.label,K.noMipmap=this._noMipmap,this.name=a,K}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(z,a,K){if(z.customType){const v=W.b.Instantiate(z.customType).Parse(z,a,K);return z.samplingMode&&v.updateSamplingMode&&v._samplingMode&&v._samplingMode!==z.samplingMode&&v.updateSamplingMode(z.samplingMode),v}if(z.isCube&&!z.isRenderTarget)return H._CubeTextureParser(z,a,K);const v=void 0!==z.internalTextureUniqueId;if(!z.name&&!z.isRenderTarget&&!v)return null;let T;if(v){const K=a.getEngine().getLoadedTexturesCache();for(const a of K)if(a.uniqueId===z.internalTextureUniqueId){T=a;break}}const m=a=>{if(a&&a._texture&&(a._texture._cachedWrapU=null,a._texture._cachedWrapV=null,a._texture._cachedWrapR=null),z.samplingMode){const K=z.samplingMode;a&&a.samplingMode!==K&&a.updateSamplingMode(K)}if(a&&z.animations)for(let K=0;K<z.animations.length;K++){const v=z.animations[K],T=(0,s.c)("BABYLON.Animation");T&&a.animations.push(T.Parse(v))}a&&a._texture&&(v&&!T&&a._texture._setUniqueId(z.internalTextureUniqueId),a._texture.label=z.internalTextureLabel)};return w.e.Parse((()=>{let v=!0;if(z.noMipmap&&(v=!1),z.mirrorPlane){const K=H._CreateMirror(z.name,z.renderTargetSize,a,v);return K._waitingRenderList=z.renderList,K.mirrorPlane=F.d.Jg(z.mirrorPlane),m(K),K}if(z.isRenderTarget){let K=null;if(z.isCube){if(a.reflectionProbes)for(let v=0;v<a.reflectionProbes.length;v++){const K=a.reflectionProbes[v];if(K.name===z.name)return K.cubeTexture}}else K=H._CreateRenderTargetTexture(z.name,z.renderTargetSize,a,v,z._creationFlags??0),K._waitingRenderList=z.renderList;return m(K),K}if(z.isVideo){const T=H._CreateVideoTexture(K+(z.url||z.name),K+(z.src||z.url),a,v,z.invertY,z.samplingMode,z.settings||{});return m(T),T}{let p;if(z.base64String&&!T)p=H.CreateFromBase64String(z.base64String,z.base64String,a,!v,z.invertY,z.samplingMode,(()=>{m(p)}),z._creationFlags??0,z._useSRGBBuffer??!1),p.name=z.name;else{let j;j=z.name&&(z.name.indexOf("://")>0||z.name.startsWith("data:"))?z.name:K+z.name,z.url&&(z.url.startsWith("data:")||H.UseSerializedUrlIfAny)&&(j=z.url);const s={noMipmap:!v,invertY:z.invertY,samplingMode:z.samplingMode,X:()=>{m(p)},internalTexture:T};p=new H(j,a,s)}return p}}),z,a)}static CreateFromBase64String(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:H.TRILINEAR_SAMPLINGMODE;return new H("data:"+a,K,v,T,m,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,z,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4?arguments[4]:void 0,m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:H.TRILINEAR_SAMPLINGMODE,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,r=arguments.length>10?arguments[10]:void 0,W=arguments.length>11?arguments[11]:void 0;return"data:"!==z.substring(0,5)&&(z="data:"+z),new H(z,K,T,m,p,j,s,a,v,M,void 0,void 0,r,W)}}H.SerializeBuffers=!0,H.ForceSerializeBuffers=!1,H.OnTextureLoadErrorObservable=new m.c,H._SerializeInternalTextureUniqueId=!1,H._CubeTextureParser=(z,a,K)=>{throw(0,M.b)("CubeTexture")},H._CreateMirror=(z,a,K,v)=>{throw(0,M.b)("MirrorTexture")},H._CreateRenderTargetTexture=(z,a,K,v,T)=>{throw(0,M.b)("RenderTargetTexture")},H.NEAREST_SAMPLINGMODE=1,H.NEAREST_NEAREST_MIPLINEAR=8,H.BILINEAR_SAMPLINGMODE=2,H.LINEAR_LINEAR_MIPNEAREST=11,H.TRILINEAR_SAMPLINGMODE=3,H.LINEAR_LINEAR_MIPLINEAR=3,H.NEAREST_NEAREST_MIPNEAREST=4,H.NEAREST_LINEAR_MIPNEAREST=5,H.NEAREST_LINEAR_MIPLINEAR=6,H.NEAREST_LINEAR=7,H.NEAREST_NEAREST=1,H.LINEAR_NEAREST_MIPNEAREST=9,H.LINEAR_NEAREST_MIPLINEAR=10,H.LINEAR_LINEAR=2,H.LINEAR_NEAREST=12,H.EXPLICIT_MODE=0,H.SPHERICAL_MODE=1,H.PLANAR_MODE=2,H.CUBIC_MODE=3,H.PROJECTION_MODE=4,H.SKYBOX_MODE=5,H.INVCUBIC_MODE=6,H.EQUIRECTANGULAR_MODE=7,H.FIXED_EQUIRECTANGULAR_MODE=8,H.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,H.CLAMP_ADDRESSMODE=0,H.WRAP_ADDRESSMODE=1,H.MIRROR_ADDRESSMODE=2,H.UseSerializedUrlIfAny=!1,(0,v.e)([(0,T.D)()],H.prototype,"url",void 0),(0,v.e)([(0,T.D)()],H.prototype,"uOffset",void 0),(0,v.e)([(0,T.D)()],H.prototype,"vOffset",void 0),(0,v.e)([(0,T.D)()],H.prototype,"uScale",void 0),(0,v.e)([(0,T.D)()],H.prototype,"vScale",void 0),(0,v.e)([(0,T.D)()],H.prototype,"uAng",void 0),(0,v.e)([(0,T.D)()],H.prototype,"vAng",void 0),(0,v.e)([(0,T.D)()],H.prototype,"wAng",void 0),(0,v.e)([(0,T.D)()],H.prototype,"uRotationCenter",void 0),(0,v.e)([(0,T.D)()],H.prototype,"vRotationCenter",void 0),(0,v.e)([(0,T.D)()],H.prototype,"wRotationCenter",void 0),(0,v.e)([(0,T.D)()],H.prototype,"homogeneousRotationInUVTransform",void 0),(0,v.e)([(0,T.D)()],H.prototype,"isBlocking",null),(0,s.e)("BABYLON.Texture",H),w.e._TextureParser=H.Parse},10751:(z,a,K)=>{"use strict";K.d(a,{d:()=>v});class v{get wrapU(){return this._cachedWrapU}set wrapU(z){this._cachedWrapU=z}get wrapV(){return this._cachedWrapV}set wrapV(z){this._cachedWrapV=z}get wrapR(){return this._cachedWrapR}set wrapR(z){this._cachedWrapR=z}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(z){this._cachedAnisotropicFilteringLevel=z}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(z){this._comparisonFunction=z}get useMipMaps(){return this._useMipMaps}set useMipMaps(z){this._useMipMaps=z}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=z,this._cachedWrapV=a,this._cachedWrapR=K,this._cachedAnisotropicFilteringLevel=v,this.samplingMode=T,this._comparisonFunction=m,this}compareSampler(z){return this._cachedWrapU===z._cachedWrapU&&this._cachedWrapV===z._cachedWrapV&&this._cachedWrapR===z._cachedWrapR&&this._cachedAnisotropicFilteringLevel===z._cachedAnisotropicFilteringLevel&&this.samplingMode===z.samplingMode&&this._comparisonFunction===z._comparisonFunction&&this._useMipMaps===z._useMipMaps}}},11119:(z,a,K)=>{"use strict";function v(z){-1===z.indexOf("vClipPlane")&&z.push("vClipPlane"),-1===z.indexOf("vClipPlane2")&&z.push("vClipPlane2"),-1===z.indexOf("vClipPlane3")&&z.push("vClipPlane3"),-1===z.indexOf("vClipPlane4")&&z.push("vClipPlane4"),-1===z.indexOf("vClipPlane5")&&z.push("vClipPlane5"),-1===z.indexOf("vClipPlane6")&&z.push("vClipPlane6")}function T(z,a,K){const v=!!(z.clipPlane??a.clipPlane),T=!!(z.clipPlane2??a.clipPlane2),m=!!(z.clipPlane3??a.clipPlane3),p=!!(z.clipPlane4??a.clipPlane4),j=!!(z.clipPlane5??a.clipPlane5),s=!!(z.clipPlane6??a.clipPlane6);v&&K.push("#define CLIPPLANE"),T&&K.push("#define CLIPPLANE2"),m&&K.push("#define CLIPPLANE3"),p&&K.push("#define CLIPPLANE4"),j&&K.push("#define CLIPPLANE5"),s&&K.push("#define CLIPPLANE6")}function m(z,a,K){let v=!1;const T=!!(z.clipPlane??a.clipPlane),m=!!(z.clipPlane2??a.clipPlane2),p=!!(z.clipPlane3??a.clipPlane3),j=!!(z.clipPlane4??a.clipPlane4),s=!!(z.clipPlane5??a.clipPlane5),M=!!(z.clipPlane6??a.clipPlane6);return K.CLIPPLANE!==T&&(K.CLIPPLANE=T,v=!0),K.CLIPPLANE2!==m&&(K.CLIPPLANE2=m,v=!0),K.CLIPPLANE3!==p&&(K.CLIPPLANE3=p,v=!0),K.CLIPPLANE4!==j&&(K.CLIPPLANE4=j,v=!0),K.CLIPPLANE5!==s&&(K.CLIPPLANE5=s,v=!0),K.CLIPPLANE6!==M&&(K.CLIPPLANE6=M,v=!0),v}function p(z,a,K){let v=a.clipPlane??K.clipPlane;j(z,"vClipPlane",v),v=a.clipPlane2??K.clipPlane2,j(z,"vClipPlane2",v),v=a.clipPlane3??K.clipPlane3,j(z,"vClipPlane3",v),v=a.clipPlane4??K.clipPlane4,j(z,"vClipPlane4",v),v=a.clipPlane5??K.clipPlane5,j(z,"vClipPlane5",v),v=a.clipPlane6??K.clipPlane6,j(z,"vClipPlane6",v)}function j(z,a,K){K&&z.setFloat4(a,K.k.x,K.k.y,K.k.z,K.d)}K.d(a,{e:()=>v,h:()=>p,k:()=>m,m:()=>T})},10981:(z,a,K)=>{"use strict";function v(z){z.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}K.d(a,{c:()=>v})},11380:(z,a,K)=>{"use strict";function v(z){return void 0===z.getPipelineContext}K.d(a,{e:()=>v})},11107:(z,a,K)=>{"use strict";K.d(a,{e:()=>v});class v{static GetEffect(z){return void 0===z.getPipelineContext?z.effect:z}constructor(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=z.createDrawContext(),a&&(this.materialContext=z.createMaterialContext())}setEffect(z,a){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var v;(this.effect=z,void 0!==a&&(this.defines=a),K)&&(null===(v=this.drawContext)||void 0===v||v.reset())}dispose(){var z;null===(z=this.drawContext)||void 0===z||z.dispose()}}},10730:(z,a,K)=>{"use strict";K.d(a,{d:()=>W,h:()=>G,k:()=>M,o:()=>r});var v=K(10640),T=K(10739),m=K(10726),p=K(10648),j=K(10699),s=K(10702);function M(z,a){return(0,T.B)(a).cachedPipelines[z]}function r(z){const a=z._name,K=z.context;if(a&&K){const z=(0,T.B)(K),v=z.cachedPipelines[a];null===v||void 0===v||v.dispose(),delete z.cachedPipelines[a]}}function W(z,a,K,T,m,p,s){let M,r;const W=(0,v.m)()?null===p||void 0===p?void 0:p.getHostDocument():null;M="string"===typeof a?a:a.vertexSource?"source:"+a.vertexSource:a.vertexElement?(null===W||void 0===W?void 0:W.getElementById(a.vertexElement))||a.vertexElement:a.vertex||a,r="string"===typeof a?a:a.fragmentSource?"source:"+a.fragmentSource:a.fragmentElement?(null===W||void 0===W?void 0:W.getElementById(a.fragmentElement))||a.fragmentElement:a.fragment||a;const G=[void 0,void 0],l=()=>{if(G[0]&&G[1]){z.isFragment=!0;const[v,M]=G;(0,j.g)(M,z,((p,M)=>{s&&(s._fragmentSourceCodeBeforeMigration=M),K&&(p=K("fragment",p));const r=(0,j.b)(v,p,z);z=null;const W=function(z,a,K,v){if(K){return{vertexSourceCode:(1===v?"//":"")+"#define SHADER_NAME vertex:"+(K.vertexElement||K.vertex||K.spectorName||K)+"\n"+z,fragmentSourceCode:(1===v?"//":"")+"#define SHADER_NAME fragment:"+(K.fragmentElement||K.fragment||K.spectorName||K)+"\n"+a}}return{vertexSourceCode:z,fragmentSourceCode:a}}(r.vertexCode,r.fragmentCode,a,m);null===T||void 0===T||T(W.vertexSourceCode,W.fragmentSourceCode)}),p)}};F(M,"Vertex","",(a=>{(0,j.c)(z),(0,j.g)(a,z,((z,v)=>{s&&(s._rawVertexSourceCode=a,s._vertexSourceCodeBeforeMigration=v),K&&(z=K("vertex",z)),G[0]=z,l()}),p)}),m),F(r,"Fragment","Pixel",(z=>{s&&(s._rawFragmentSourceCode=z),G[1]=z,l()}),m)}function F(z,a,K,T,p,j){if("undefined"!==typeof HTMLElement&&z instanceof HTMLElement){return void T((0,v.c)(z))}if("source:"===z.substring(0,7))return void T(z.substring(7));if("base64:"===z.substring(0,7)){return void T(window.atob(z.substring(7)))}const M=m.b.GetShadersStore(p);if(M[z+a+"Shader"])return void T(M[z+a+"Shader"]);if(K&&M[z+K+"Shader"])return void T(M[z+K+"Shader"]);let r;if(r="."===z[0]||"/"===z[0]||z.indexOf("http")>-1?z:m.b.GetShadersRepository(p)+z,!(j=j||s.m))throw new Error("loadFileInjection is not defined");j(r+"."+a.toLowerCase()+".fx",T)}const G=(z,a,K,v)=>{try{const m=z.existingPipelineContext||a(z.shaderProcessingContext);if(m._name=z.name,z.name&&z.context){(0,T.B)(z.context).cachedPipelines[z.name]=m}return K(m,z.vertex,z.fragment,!!z.createAsRaw,"","",z.rebuildRebind,z.defines,z.transformFeedbackVaryings,"",(()=>{v(m,(()=>{var a;null===(a=z.onRenderingStateCompiled)||void 0===a||a.call(z,m)}))})),m}catch(m){throw p.c.Error("Error compiling effect"),m}}},10720:(z,a,K)=>{"use strict";K.d(a,{c:()=>j});var v=K(10638),T=K(10648),m=K(10726),p=K(10730);class j{static get ShadersRepository(){return m.b.ShadersRepository}static set ShadersRepository(z){m.b.ShadersRepository=z}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new v.c),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(z,a,K){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,F=arguments.length>9?arguments[9]:void 0,G=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",l=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,V=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new v.c,this.onErrorObservable=new v.c,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=z,this._key=G;const c=this._key.replace(/\r/g,"").replace(/\n/g,"|");let C;if(a.attributes){const z=a;if(this._engine=K,this._attributesNames=z.attributes,this._uniformsNames=z.uniformsNames.concat(z.samplers),this._samplerList=z.samplers.slice(),this.defines=z.defines,this.onError=z.onError,this.onCompiled=z.onCompiled,this._fallbacks=z.fallbacks,this._indexParameters=z.indexParameters,this._transformFeedbackVaryings=z.transformFeedbackVaryings||null,this._multiTarget=!!z.multiTarget,this._shaderLanguage=z.shaderLanguage??0,z.uniformBuffersNames){this._uniformBuffersNamesList=z.uniformBuffersNames.slice();for(let a=0;a<z.uniformBuffersNames.length;a++)this._uniformBuffersNames[z.uniformBuffersNames[a]]=a}this._processFinalCode=z.processFinalCode??null,this._processCodeAfterIncludes=z.processCodeAfterIncludes??void 0,C=z.existingPipelineContext}else this._engine=m,this.defines=null==s?"":s,this._uniformsNames=K.concat(T),this._samplerList=T?T.slice():[],this._attributesNames=a,this._uniformBuffersNamesList=[],this._shaderLanguage=l,this.onError=W,this.onCompiled=r,this._indexParameters=F,this._fallbacks=M;"WEBGL2"===this._engine.shaderPlatformName&&(C=(0,p.k)(c,this._engine._gl)??C),this._attributeLocationByName={},this.uniqueId=j._UniqueIdSeed++,C?(this._pipelineContext=C,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,V)}async _processShaderCodeAsync(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3?arguments[3]:void 0;v&&await v(),this._processingContext=K||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const T={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:z??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:m.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:m.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,p.d)(T,this.name,this._processFinalCode,((z,K)=>{this._vertexSourceCode=z,this._fragmentSourceCode=K,this._prepareEffect(a)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(z){return this._attributes[z]}getAttributeLocationByName(z){return this._attributeLocationByName[z]}getAttributesCount(){return this._attributes.length}getUniformIndex(z){return this._uniformsNames.indexOf(z)}getUniform(z){return this._uniforms[z]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(z){this.isReady()?z(this):(this.onCompileObservable.add((a=>{z(a)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(z){try{if(this._isReadyInternal())return}catch(a){return void this._processCompilationErrors(a,z)}this._isDisposed||setTimeout((()=>{this._checkIsReady(z)}),16)}get vertexSourceCode(){var z;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(z=this._pipelineContext)||void 0===z?void 0:z._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var z;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(z=this._pipelineContext)||void 0===z?void 0:z._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(z,a,K,v){this._isReady=!1,this._vertexSourceCodeOverride=z,this._fragmentSourceCodeOverride=a,this.onError=(z,a)=>{v&&v(a)},this.onCompiled=()=>{var z,a;const v=this.getEngine().scenes;if(v)for(let K=0;K<v.length;K++)v[K].markAllMaterialsAsDirty(63);null===(z=(a=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===z||z.call(a,K)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(z){if(this._pipelineContext=z,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let a=0;a<this._attributesNames.length;a++){const z=this._attributesNames[a];this._attributeLocationByName[z]=this._attributes[a]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),j.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=this._pipelineContext;this._isReady=!1;try{const K=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),v=K?null:this.defines,T=K?this._vertexSourceCodeOverride:this._vertexSourceCode,m=K?this._fragmentSourceCodeOverride:this._fragmentSourceCode,j=this._engine;this._pipelineContext=(0,p.h)({existingPipelineContext:z?a:null,vertex:T,fragment:m,context:"WEBGL2"===j.shaderPlatformName?j._gl:void 0,rebuildRebind:(z,a,K,v)=>this._rebuildProgram(z,a,K,v),defines:v,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:K,parallelShaderCompile:j._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:K=>{a&&!z&&this._engine._deletePipelineContext(a),K&&this._onRenderingStateCompiled(K)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(a)}catch(K){this._processCompilationErrors(K,a)}}_getShaderCodeAndErrorLine(z,a,K){const v=K?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let T=null;if(a&&z){const m=a.match(v);if(m&&2===m.length){const a=parseInt(m[1]),v=z.split("\n",-1);v.length>=a&&(T=`Offending line [${a}] in ${K?"fragment":"vertex"} code: ${v[a-1]}`)}}return[z,T]}_processCompilationErrors(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=z.message;const K=this._attributesNames,v=this._fallbacks;if(T.c.Error("Unable to compile effect:"),T.c.Error("Uniforms: "+this._uniformsNames.map((function(z){return" "+z}))),T.c.Error("Attributes: "+K.map((function(z){return" "+z}))),T.c.Error("Defines:\n"+this.defines),j.LogShaderCodeOnCompilationError){var m,p;let z=null,a=null,K=null;var s;if(null!==(m=this._pipelineContext)&&void 0!==m&&m._getVertexShaderCode()&&([K,z]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),K&&(T.c.Error("Vertex code:"),T.c.Error(K))),null!==(p=this._pipelineContext)&&void 0!==p&&p._getFragmentShaderCode())[K,a]=this._getShaderCodeAndErrorLine(null===(s=this._pipelineContext)||void 0===s?void 0:s._getFragmentShaderCode(),this._compilationError,!0),K&&(T.c.Error("Fragment code:"),T.c.Error(K));z&&T.c.Error(z),a&&T.c.Error(a)}T.c.Error("Error: "+this._compilationError);const M=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};a&&(this._pipelineContext=a,this._isReady=!0,M()),v?(this._pipelineContext=null,v.hasMoreFallbacks?(this._allFallbacksProcessed=!1,T.c.Error("Trying next fallback."),this.defines=v.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,M(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,a||M())}get isSupported(){return""===this._compilationError}_bindTexture(z,a){this._engine._bindTexture(this._samplers[z],a,z)}setTexture(z,a){this._engine.setTexture(this._samplers[z],this._uniforms[z],a,z)}setTextureArray(z,a){const K=z+"Ex";if(-1===this._samplerList.indexOf(K+"0")){const v=this._samplerList.indexOf(z);for(let z=1;z<a.length;z++){const a=K+(z-1).toString();this._samplerList.splice(v+z,0,a)}let T=0;for(const z of this._samplerList)this._samplers[z]=T,T+=1}this._engine.setTextureArray(this._samplers[z],this._uniforms[z],a,z)}bindUniformBuffer(z,a){const K=this._uniformBuffersNames[a];void 0===K||j._BaseCache[K]===z&&this._engine._features.useUBOBindingCache||(j._BaseCache[K]=z,this._engine.bindUniformBufferBase(z,K,a))}bindUniformBlock(z,a){this._engine.bindUniformBlock(this._pipelineContext,z,a)}setInt(z,a){return this._pipelineContext.setInt(z,a),this}setInt2(z,a,K){return this._pipelineContext.setInt2(z,a,K),this}setInt3(z,a,K,v){return this._pipelineContext.setInt3(z,a,K,v),this}setInt4(z,a,K,v,T){return this._pipelineContext.setInt4(z,a,K,v,T),this}setIntArray(z,a){return this._pipelineContext.setIntArray(z,a),this}setIntArray2(z,a){return this._pipelineContext.setIntArray2(z,a),this}setIntArray3(z,a){return this._pipelineContext.setIntArray3(z,a),this}setIntArray4(z,a){return this._pipelineContext.setIntArray4(z,a),this}setUInt(z,a){return this._pipelineContext.setUInt(z,a),this}setUInt2(z,a,K){return this._pipelineContext.setUInt2(z,a,K),this}setUInt3(z,a,K,v){return this._pipelineContext.setUInt3(z,a,K,v),this}setUInt4(z,a,K,v,T){return this._pipelineContext.setUInt4(z,a,K,v,T),this}setUIntArray(z,a){return this._pipelineContext.setUIntArray(z,a),this}setUIntArray2(z,a){return this._pipelineContext.setUIntArray2(z,a),this}setUIntArray3(z,a){return this._pipelineContext.setUIntArray3(z,a),this}setUIntArray4(z,a){return this._pipelineContext.setUIntArray4(z,a),this}setFloatArray(z,a){return this._pipelineContext.setArray(z,a),this}setFloatArray2(z,a){return this._pipelineContext.setArray2(z,a),this}setFloatArray3(z,a){return this._pipelineContext.setArray3(z,a),this}setFloatArray4(z,a){return this._pipelineContext.setArray4(z,a),this}setArray(z,a){return this._pipelineContext.setArray(z,a),this}setArray2(z,a){return this._pipelineContext.setArray2(z,a),this}setArray3(z,a){return this._pipelineContext.setArray3(z,a),this}setArray4(z,a){return this._pipelineContext.setArray4(z,a),this}setMatrices(z,a){return this._pipelineContext.setMatrices(z,a),this}setMatrix(z,a){return this._pipelineContext.setMatrix(z,a),this}setMatrix3x3(z,a){return this._pipelineContext.setMatrix3x3(z,a),this}setMatrix2x2(z,a){return this._pipelineContext.setMatrix2x2(z,a),this}setFloat(z,a){return this._pipelineContext.setFloat(z,a),this}setBool(z,a){return this._pipelineContext.setInt(z,a?1:0),this}setVector2(z,a){return this._pipelineContext.setVector2(z,a),this}setFloat2(z,a,K){return this._pipelineContext.setFloat2(z,a,K),this}setVector3(z,a){return this._pipelineContext.setVector3(z,a),this}setFloat3(z,a,K,v){return this._pipelineContext.setFloat3(z,a,K,v),this}setVector4(z,a){return this._pipelineContext.setVector4(z,a),this}setQuaternion(z,a){return this._pipelineContext.setQuaternion(z,a),this}setFloat4(z,a,K,v,T){return this._pipelineContext.setFloat4(z,a,K,v,T),this}setColor3(z,a){return this._pipelineContext.setColor3(z,a),this}setColor4(z,a,K){return this._pipelineContext.setColor4(z,a,K),this}setDirectColor4(z,a){return this._pipelineContext.setDirectColor4(z,a),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,p.o)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;a&&(m.b.GetShadersStore(v)[`${z}PixelShader`]=a),K&&(m.b.GetShadersStore(v)[`${z}VertexShader`]=K)}static ResetCache(){j._BaseCache={}}}j.LogShaderCodeOnCompilationError=!0,j.AutomaticallyClearCodeCache=!1,j._UniqueIdSeed=0,j._BaseCache={},j.ShadersStore=m.b.ShadersStore,j.IncludesShadersStore=m.b.IncludesShadersStore},11174:(z,a,K)=>{"use strict";K.d(a,{d:()=>v});class v{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(z,a){this._defines[z]||(z<this._currentRank&&(this._currentRank=z),z>this._maxRank&&(this._maxRank=z),this._defines[z]=new Array),this._defines[z].push(a)}addCPUSkinningFallback(z,a){this._mesh=a,z<this._currentRank&&(this._currentRank=z),z>this._maxRank&&(this._maxRank=z)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(z,a){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,z=z.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),a._bonesComputationForcedToCPU=!0;const K=this._mesh.va();for(let z=0;z<K.meshes.length;z++){const v=K.meshes[z];if(v.material){if(v.computeBonesUsingShaders&&0!==v.numBoneInfluencers)if(v.material.getEffect()===a)v.computeBonesUsingShaders=!1;else if(v.Vf)for(const z of v.Vf){if(z.effect===a){v.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&v.computeBonesUsingShaders&&v.numBoneInfluencers>0&&(v.computeBonesUsingShaders=!1)}}else{const a=this._defines[this._currentRank];if(a)for(let K=0;K<a.length;K++)z=z.replace("#define "+a[K],"");this._currentRank++}return z}}},11480:(z,a,K)=>{"use strict";K.d(a,{e:()=>M,i:()=>r});var v=K(11001),T=K(11223),m=K(10638),p=K(10720),j=K(11107);K(11486);const s={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class M{constructor(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;this._fullscreenViewport=new T.e(0,0,1,1);const K=a.xa??s.xa,m=a.indices??s.indices;this.kd=z,this._vertexBuffers={[v.h.PositionKind]:new v.h(z,K,v.h.PositionKind,!1,!1,2)},this._indexBuffer=z.createIndexBuffer(m),this._onContextRestoredObserver=z.onContextRestoredObservable.add((()=>{this._indexBuffer=z.createIndexBuffer(m);for(const z in this._vertexBuffers){this._vertexBuffers[z]._rebuild()}}))}setViewport(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.kd.setViewport(z)}bindBuffers(z){this.kd.bindBuffers(this._vertexBuffers,this._indexBuffer,z)}applyEffectWrapper(z){this.kd.setState(!0),this.kd.depthCullingState.depthTest=!1,this.kd.stencilState.stencilTest=!1,this.kd.enableEffect(z.drawWrapper),this.bindBuffers(z.effect),z.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.kd.depthCullingState.depthTest,this._savedStateStencilTest=this.kd.stencilState.stencilTest}restoreStates(){this.kd.depthCullingState.depthTest=this._savedStateDepthTest,this.kd.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.kd.drawElementsType(0,0,6)}_isRenderTargetTexture(z){return void 0!==z.renderTarget}render(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!z.effect.isReady())return;this.saveStates(),this.setViewport();const K=null===a?null:this._isRenderTargetTexture(a)?a.renderTarget:a;K&&this.kd.bindFramebuffer(K),this.applyEffectWrapper(z),this.draw(),K&&this.kd.unBindFramebuffer(K),this.restoreStates()}dispose(){const z=this._vertexBuffers[v.h.PositionKind];z&&(z.dispose(),delete this._vertexBuffers[v.h.PositionKind]),this._indexBuffer&&this.kd._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.kd.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class r{static RegisterShaderCodeProcessing(z,a){a?r._CustomShaderCodeProcessing[z??""]=a:delete r._CustomShaderCodeProcessing[z??""]}static _GetShaderCodeProcessing(z){return r._CustomShaderCodeProcessing[z]??r._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(z){this.options.name=z}isReady(){var z;return(null===(z=this._drawWrapper.effect)||void 0===z?void 0:z.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(z){this._drawWrapper.effect=z}constructor(z){this.alphaMode=0,this.onEffectCreatedObservable=new m.c(void 0,!0),this.onApplyObservable=new m.c,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...z,name:z.name||"effectWrapper",kd:z.kd,uniforms:z.uniforms||z.uniformNames||[],uniformNames:void 0,samplers:z.samplers||z.samplerNames||[],samplerNames:void 0,attributeNames:z.attributeNames||["position"],uniformBuffers:z.uniformBuffers||[],defines:z.defines||"",useShaderStore:z.useShaderStore||!1,vertexUrl:z.vertexUrl||z.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:z.fragmentShader||"pass",indexParameters:z.indexParameters,blockCompilation:z.blockCompilation||!1,shaderLanguage:z.shaderLanguage||0,onCompiled:z.onCompiled||void 0,extraInitializations:z.extraInitializations||void 0,extraInitializationsAsync:z.extraInitializationsAsync||void 0,useAsPostProcess:z.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),z.vertexUrl||z.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.kd.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new j.e(this.options.kd),this._webGPUReady=1===this.options.shaderLanguage;const a=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,a,this.options.extraInitializations)}_gatherImports(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(z&&this._webGPUReady?a.push(Promise.all([K.e(37).then(K.bind(K,13163))])):a.push(Promise.all([Promise.resolve().then(K.bind(K,11486))])))}_postConstructor(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0,v=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,v&&this._importPromises.push(...v);const T=this.options.kd.isWebGPU&&!r.ForceGLSL;this._gatherImports(T,this._importPromises),void 0!==K&&K(T,this._importPromises),T&&this._webGPUReady&&(this.options.shaderLanguage=1),z||this.updateEffect(a)}updateEffect(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0,j=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0;const M=r._GetShaderCodeProcessing(this.name);if(null!==M&&void 0!==M&&M.defineCustomBindings){var W,F;const v=(null===(W=a)||void 0===W?void 0:W.slice())??[];v.push(...this.options.uniforms);const T=(null===(F=K)||void 0===F?void 0:F.slice())??[];T.push(...this.options.samplers),z=M.defineCustomBindings(this.name,z,v,T),a=v,K=T}this.options.defines=z||"";const G=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let l;l=this.options.extraInitializationsAsync?async()=>{null===G||void 0===G||G(),await this.options.extraInitializationsAsync}:G,this.options.useShaderStore?this._drawWrapper.effect=this.options.kd.createEffect({vertex:j??this._shaderPath.vertex,fragment:s??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:a||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:K||this.options.samplers,defines:null!==z?z:"",fallbacks:null,onCompiled:T??this.options.onCompiled,onError:m??null,indexParameters:v||this.options.indexParameters,processCodeAfterIncludes:null!==M&&void 0!==M&&M.processCodeAfterIncludes?(z,a)=>M.processCodeAfterIncludes(this.name,z,a):null,processFinalCode:null!==M&&void 0!==M&&M.processFinalCode?(z,a)=>M.processFinalCode(this.name,z,a):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:l},this.options.kd):this._drawWrapper.effect=new p.c(this._shaderPath,this.options.attributeNames,a||this.options.uniforms,K||this.options.samplerNames,this.options.kd,z,void 0,T||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,l),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var z,a;this.options.useAsPostProcess&&(this.options.kd.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(z=r._GetShaderCodeProcessing(this.name))||void 0===z||null===(a=z.bindCustomBindings)||void 0===a||a.call(z,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}r.ForceGLSL=!1,r._CustomShaderCodeProcessing={}},10986:(z,a,K)=>{"use strict";K.d(a,{d:()=>m,h:()=>T});var v=K(10981);function T(z,a){a.EXPOSURE&&z.push("exposureLinear"),a.CONTRAST&&z.push("contrast"),a.COLORGRADING&&z.push("colorTransformSettings"),(a.VIGNETTE||a.DITHER)&&z.push("vInverseScreenSize"),a.VIGNETTE&&(z.push("vignetteSettings1"),z.push("vignetteSettings2")),a.COLORCURVES&&(0,v.c)(z),a.DITHER&&z.push("ditherIntensity")}function m(z,a){a.COLORGRADING&&z.push("txColorTransform")}},10964:(z,a,K)=>{"use strict";K.d(a,{e:()=>G});var v=K(10923),T=K(10927),m=K(10638),p=K(10971),j=K(10973),s=K(10981);class M{constructor(){this._dirty=!0,this._tempColor=new p.d(0,0,0,0),this._globalCurve=new p.d(0,0,0,0),this._highlightsCurve=new p.d(0,0,0,0),this._midtonesCurve=new p.d(0,0,0,0),this._shadowsCurve=new p.d(0,0,0,0),this._positiveCurve=new p.d(0,0,0,0),this._negativeCurve=new p.d(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(z){this._globalHue=z,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(z){this._globalDensity=z,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(z){this._globalSaturation=z,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(z){this._globalExposure=z,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(z){this._highlightsHue=z,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(z){this._highlightsDensity=z,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(z){this._highlightsSaturation=z,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(z){this._highlightsExposure=z,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(z){this._midtonesHue=z,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(z){this._midtonesDensity=z,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(z){this._midtonesSaturation=z,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(z){this._midtonesExposure=z,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(z){this._shadowsHue=z,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(z){this._shadowsDensity=z,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(z){this._shadowsSaturation=z,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(z){this._shadowsExposure=z,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";z._dirty&&(z._dirty=!1,z._getColorGradingDataToRef(z._globalHue,z._globalDensity,z._globalSaturation,z._globalExposure,z._globalCurve),z._getColorGradingDataToRef(z._highlightsHue,z._highlightsDensity,z._highlightsSaturation,z._highlightsExposure,z._tempColor),z._tempColor.multiplyToRef(z._globalCurve,z._highlightsCurve),z._getColorGradingDataToRef(z._midtonesHue,z._midtonesDensity,z._midtonesSaturation,z._midtonesExposure,z._tempColor),z._tempColor.multiplyToRef(z._globalCurve,z._midtonesCurve),z._getColorGradingDataToRef(z._shadowsHue,z._shadowsDensity,z._shadowsSaturation,z._shadowsExposure,z._tempColor),z._tempColor.multiplyToRef(z._globalCurve,z._shadowsCurve),z._highlightsCurve.subtractToRef(z._midtonesCurve,z._positiveCurve),z._midtonesCurve.subtractToRef(z._shadowsCurve,z._negativeCurve)),a&&(a.setFloat4(K,z._positiveCurve.r,z._positiveCurve.g,z._positiveCurve.b,z._positiveCurve.a),a.setFloat4(v,z._midtonesCurve.r,z._midtonesCurve.g,z._midtonesCurve.b,z._midtonesCurve.a),a.setFloat4(T,z._negativeCurve.r,z._negativeCurve.g,z._negativeCurve.b,z._negativeCurve.a))}_getColorGradingDataToRef(z,a,K,v,T){null!=z&&(z=M._Clamp(z,0,360),a=M._Clamp(a,-100,100),K=M._Clamp(K,-100,100),v=M._Clamp(v,-100,100),a=M._ApplyColorGradingSliderNonlinear(a),a*=.5,v=M._ApplyColorGradingSliderNonlinear(v),a<0&&(a*=-1,z=(z+180)%360),M._FromHSBToRef(z,a,50+.25*v,T),T.scaleToRef(2,T),T.a=1+.01*K)}static _ApplyColorGradingSliderNonlinear(z){z/=100;let a=Math.abs(z);return a=Math.pow(a,2),z<0&&(a*=-1),a*=100,a}static _FromHSBToRef(z,a,K,v){let T=M._Clamp(z,0,360);const m=M._Clamp(a/100,0,1),p=M._Clamp(K/100,0,1);if(0===m)v.r=p,v.g=p,v.b=p;else{T/=60;const z=Math.floor(T),a=T-z,K=p*(1-m),j=p*(1-m*a),s=p*(1-m*(1-a));switch(z){case 0:v.r=p,v.g=s,v.b=K;break;case 1:v.r=j,v.g=p,v.b=K;break;case 2:v.r=K,v.g=p,v.b=s;break;case 3:v.r=K,v.g=j,v.b=p;break;case 4:v.r=s,v.g=K,v.b=p;break;default:v.r=p,v.g=K,v.b=j}}v.a=1}static _Clamp(z,a,K){return Math.min(Math.max(z,a),K)}clone(){return j.e.Clone((()=>new M),this)}serialize(){return j.e.Serialize(this)}static Parse(z){return j.e.Parse((()=>new M),z,null,null)}}M.PrepareUniforms=s.c,(0,v.e)([(0,T.D)()],M.prototype,"_globalHue",void 0),(0,v.e)([(0,T.D)()],M.prototype,"_globalDensity",void 0),(0,v.e)([(0,T.D)()],M.prototype,"_globalSaturation",void 0),(0,v.e)([(0,T.D)()],M.prototype,"_globalExposure",void 0),(0,v.e)([(0,T.D)()],M.prototype,"_highlightsHue",void 0),(0,v.e)([(0,T.D)()],M.prototype,"_highlightsDensity",void 0),(0,v.e)([(0,T.D)()],M.prototype,"_highlightsSaturation",void 0),(0,v.e)([(0,T.D)()],M.prototype,"_highlightsExposure",void 0),(0,v.e)([(0,T.D)()],M.prototype,"_midtonesHue",void 0),(0,v.e)([(0,T.D)()],M.prototype,"_midtonesDensity",void 0),(0,v.e)([(0,T.D)()],M.prototype,"_midtonesSaturation",void 0),(0,v.e)([(0,T.D)()],M.prototype,"_midtonesExposure",void 0),j.e._ColorCurvesParser=M.Parse;var r=K(10782),W=K(10986),F=K(10767);class G{constructor(){this.colorCurves=new M,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=G.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new p.d(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=G.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new m.c}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(z){this._colorCurvesEnabled!==z&&(this._colorCurvesEnabled=z,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(z){this._colorGradingTexture!==z&&(this._colorGradingTexture=z,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(z){this._colorGradingEnabled!==z&&(this._colorGradingEnabled=z,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(z){this._colorGradingWithGreenDepth!==z&&(this._colorGradingWithGreenDepth=z,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(z){this._colorGradingBGR!==z&&(this._colorGradingBGR=z,this._updateParameters())}get exposure(){return this._exposure}set exposure(z){this._exposure!==z&&(this._exposure=z,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(z){this._toneMappingEnabled!==z&&(this._toneMappingEnabled=z,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(z){this._toneMappingType!==z&&(this._toneMappingType=z,this._updateParameters())}get contrast(){return this._contrast}set contrast(z){this._contrast!==z&&(this._contrast=z,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(z){this.vignetteCenterY=z}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(z){this.vignetteCenterX=z}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(z){this._vignetteBlendMode!==z&&(this._vignetteBlendMode=z,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(z){this._vignetteEnabled!==z&&(this._vignetteEnabled=z,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(z){this._ditheringEnabled!==z&&(this._ditheringEnabled=z,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(z){this._ditheringIntensity!==z&&(this._ditheringIntensity=z,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(z){this._skipFinalColorClamp!==z&&(this._skipFinalColorClamp=z,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(z){this._applyByPostProcess!==z&&(this._applyByPostProcess=z,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(z){this._isEnabled!==z&&(this._isEnabled=z,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(z){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return z.VIGNETTE=!1,z.TONEMAPPING=0,z.CONTRAST=!1,z.EXPOSURE=!1,z.COLORCURVES=!1,z.COLORGRADING=!1,z.COLORGRADING3D=!1,z.DITHER=!1,z.IMAGEPROCESSING=!1,z.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(z.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(z.VIGNETTE=this.vignetteEnabled,z.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===G._VIGNETTEMODE_MULTIPLY,z.VIGNETTEBLENDMODEOPAQUE=!z.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case G.TONEMAPPING_KHR_PBR_NEUTRAL:z.TONEMAPPING=3;break;case G.TONEMAPPING_ACES:z.TONEMAPPING=2;break;default:z.TONEMAPPING=1}else z.TONEMAPPING=0;z.CONTRAST=1!==this.contrast,z.EXPOSURE=1!==this.exposure,z.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,z.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,z.COLORGRADING?z.COLORGRADING3D=this.colorGradingTexture.is3D:z.COLORGRADING3D=!1,z.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,z.SAMPLER3DBGRMAP=this.colorGradingBGR,z.DITHER=this._ditheringEnabled,z.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,z.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,z.IMAGEPROCESSING=z.VIGNETTE||!!z.TONEMAPPING||z.CONTRAST||z.EXPOSURE||z.COLORCURVES||z.COLORGRADING||z.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(z,a){if(this._colorCurvesEnabled&&this.colorCurves&&M.Bind(this.colorCurves,z),this._vignetteEnabled||this._ditheringEnabled){const K=1/z.getEngine().getRenderWidth(),v=1/z.getEngine().getRenderHeight();if(z.setFloat2("vInverseScreenSize",K,v),this._ditheringEnabled&&z.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const T=null!=a?a:v/K;let m=Math.tan(.5*this.vignetteCameraFov),p=m*T;const j=Math.sqrt(p*m);p=(0,r.k)(p,j,this.vignetteStretch),m=(0,r.k)(m,j,this.vignetteStretch),z.setFloat4("vignetteSettings1",p,m,-p*this.vignetteCenterX,-m*this.vignetteCenterY);const s=-2*this.vignetteWeight;z.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,s)}}if(z.setFloat("exposureLinear",this.exposure),z.setFloat("contrast",this.contrast),this.colorGradingTexture){z.setTexture("txColorTransform",this.colorGradingTexture);const a=this.colorGradingTexture.getSize().height;z.setFloat4("colorTransformSettings",(a-1)/a,.5/a,a,this.colorGradingTexture.level)}}clone(){return j.e.Clone((()=>new G),this)}serialize(){return j.e.Serialize(this)}static Parse(z){const a=j.e.Parse((()=>new G),z,null,null);return void 0!==z.vignetteCentreX&&(a.vignetteCenterX=z.vignetteCentreX),void 0!==z.vignetteCentreY&&(a.vignetteCenterY=z.vignetteCentreY),a}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}G.TONEMAPPING_STANDARD=0,G.TONEMAPPING_ACES=1,G.TONEMAPPING_KHR_PBR_NEUTRAL=2,G.PrepareUniforms=W.h,G.PrepareSamplers=W.d,G._VIGNETTEMODE_MULTIPLY=0,G._VIGNETTEMODE_OPAQUE=1,(0,v.e)([(0,T.g)()],G.prototype,"colorCurves",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_colorCurvesEnabled",void 0),(0,v.e)([(0,T.x)("colorGradingTexture")],G.prototype,"_colorGradingTexture",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_colorGradingEnabled",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_colorGradingWithGreenDepth",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_colorGradingBGR",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_exposure",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_toneMappingEnabled",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_toneMappingType",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_contrast",void 0),(0,v.e)([(0,T.D)()],G.prototype,"vignetteStretch",void 0),(0,v.e)([(0,T.D)()],G.prototype,"vignetteCenterX",void 0),(0,v.e)([(0,T.D)()],G.prototype,"vignetteCenterY",void 0),(0,v.e)([(0,T.D)()],G.prototype,"vignetteWeight",void 0),(0,v.e)([(0,T.i)()],G.prototype,"vignetteColor",void 0),(0,v.e)([(0,T.D)()],G.prototype,"vignetteCameraFov",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_vignetteBlendMode",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_vignetteEnabled",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_ditheringEnabled",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_ditheringIntensity",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_skipFinalColorClamp",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_applyByPostProcess",void 0),(0,v.e)([(0,T.D)()],G.prototype,"_isEnabled",void 0),j.e._ImageProcessingConfigurationParser=G.Parse,(0,F.e)("BABYLON.ImageProcessingConfiguration",G)},11176:(z,a,K)=>{"use strict";K.d(a,{c:()=>W});var v=K(10923),T=K(11064),m=K(10927),p=K(11167),j=K(11127),s=K(11181),M=K(11114);class r extends j.d{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class W extends s.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(z,"DetailMap",140,new r,a),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=T.b.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=z._dirtyCallbacks[1]}isReadyForSubMesh(z,a,K){return!this._isEnabled||!(z._areTexturesDirty&&a.texturesEnabled&&K.getCaps().standardDerivatives&&this._texture&&p.e.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(z,a){if(this._isEnabled){z.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const K=a.getEngine();z._areTexturesDirty&&(K.getCaps().standardDerivatives&&this._texture&&p.e.DetailTextureEnabled&&this._isEnabled?((0,M._)(this._texture,z,"DETAIL"),z.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):z.DETAIL=!1)}else z.DETAIL=!1}bindForSubMesh(z,a){if(!this._isEnabled)return;const K=this._material.isFrozen;z.useUbo&&K&&z.isSync||this._texture&&p.e.DetailTextureEnabled&&(z.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,M.u)(this._texture,z,"detail")),a.texturesEnabled&&this._texture&&p.e.DetailTextureEnabled&&z.setTexture("detailSampler",this._texture)}hasTexture(z){return this._texture===z}getActiveTextures(z){this._texture&&z.push(this._texture)}getAnimatables(z){this._texture&&this._texture.animations&&this._texture.animations.length>0&&z.push(this._texture)}dispose(z){var a;z&&(null===(a=this._texture)||void 0===a||a.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(z){z.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,v.e)([(0,m.x)("detailTexture"),(0,m.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"texture",void 0),(0,v.e)([(0,m.D)()],W.prototype,"diffuseBlendLevel",void 0),(0,v.e)([(0,m.D)()],W.prototype,"roughnessBlendLevel",void 0),(0,v.e)([(0,m.D)()],W.prototype,"bumpLevel",void 0),(0,v.e)([(0,m.D)(),(0,m.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"normalBlendMethod",void 0),(0,v.e)([(0,m.D)(),(0,m.d)("_markAllSubMeshesAsTexturesDirty")],W.prototype,"isEnabled",void 0)},11064:(z,a,K)=>{"use strict";K.d(a,{b:()=>c});var v=K(10923),T=K(10927),m=K(10631),p=K(10638),j=K(10680),s=K(11066),M=K(10991),r=K(10648),W=K(11038),F=K(11107),G=K(10973);class l{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(z){this._func=z}get funcRef(){return this._funcRef}set funcRef(z){this._funcRef=z}get funcMask(){return this._funcMask}set funcMask(z){this._funcMask=z}get opStencilFail(){return this._opStencilFail}set opStencilFail(z){this._opStencilFail=z}get opDepthFail(){return this._opDepthFail}set opDepthFail(z){this._opDepthFail=z}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(z){this._opStencilDepthPass=z}get mask(){return this._mask}set mask(z){this._mask=z}get enabled(){return this._enabled}set enabled(z){this._enabled=z}getClassName(){return"MaterialStencilState"}copyTo(z){G.e.Clone((()=>z),this)}serialize(){return G.e.Serialize(this)}parse(z,a,K){G.e.Parse((()=>this),z,a,K)}}(0,v.e)([(0,T.D)()],l.prototype,"func",null),(0,v.e)([(0,T.D)()],l.prototype,"funcRef",null),(0,v.e)([(0,T.D)()],l.prototype,"funcMask",null),(0,v.e)([(0,T.D)()],l.prototype,"opStencilFail",null),(0,v.e)([(0,T.D)()],l.prototype,"opDepthFail",null),(0,v.e)([(0,T.D)()],l.prototype,"opStencilDepthPass",null),(0,v.e)([(0,T.D)()],l.prototype,"mask",null),(0,v.e)([(0,T.D)()],l.prototype,"enabled",null);var V=K(11114);class c{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(z){if(this._alpha===z)return;const a=this._alpha;this._alpha=z,1!==a&&1!==z||this.zg(c.MiscDirtyFlag+c.PrePassDirtyFlag)}get alpha(){return this._alpha}set Rg(z){this._backFaceCulling!==z&&(this._backFaceCulling=z,this.zg(c.TextureDirtyFlag))}get Rg(){return this._backFaceCulling}set cullBackFaces(z){this._cullBackFaces!==z&&(this._cullBackFaces=z,this.zg(c.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(z){this._blockDirtyMechanism!==z&&(this._blockDirtyMechanism=z,z||this.fj())}atomicMaterialsUpdate(z){this.blockDirtyMechanism=!0;try{z(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(z){this._onDisposeObserver&&this.lj.remove(this._onDisposeObserver),this._onDisposeObserver=this.lj.add(z)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new p.c),this._onBindObservable}set onBind(z){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(z)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new p.c),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new p.c),this._onEffectCreatedObservable}set alphaMode(z){this._alphaMode!==z&&(this._alphaMode=z,this.zg(c.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(z){this._needDepthPrePass!==z&&(this._needDepthPrePass=z,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(z){this._fogEnabled!==z&&(this._fogEnabled=z,this.zg(c.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case c.WireFrameFillMode:case c.LineListDrawMode:case c.LineLoopDrawMode:case c.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(z){this.fillMode=z?c.WireFrameFillMode:c.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case c.PointFillMode:case c.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(z){this.fillMode=z?c.PointFillMode:c.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(z){this._fillMode!==z&&(this._fillMode=z,this.zg(c.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(z){const a=this.va().getEngine().getCaps().fragmentDepthSupported;z&&!a&&r.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=z&&a,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(z){this._drawWrapper=z}constructor(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.lj=new p.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new l,this._useUBO=!1,this._fillMode=c.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=z;const T=a||j.b.LastCreatedScene;T&&(this._scene=T,this._dirtyCallbacks={},this._forceGLSL=v,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=z||m.h.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new F.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new M.c(this._scene.getEngine(),void 0,void 0,z),this._useUBO=this.va().getEngine().supportsUniformBuffers,this._createUniformBuffer(),K||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),c.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var z;const a=this.va().getEngine();null===(z=this._uniformBuffer)||void 0===z||z.dispose(),a.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new M.c(a,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new M.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(z){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.fj(),this.checkReadyOnlyOnce=!0}unfreeze(){this.fj(),this.checkReadyOnlyOnce=!1}isReady(z,a){return!0}isReadyForSubMesh(z,a,K){const v=a.materialDefines;return!!v&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=v,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}va(){return this._scene}_getEffectiveOrientation(z){return null!==this.sideOrientation?this.sideOrientation:z.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(z){this._transparencyMode!==z&&(this._transparencyMode=z,this._forceAlphaTest=z===c.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===c.MATERIAL_OPAQUE||this._transparencyMode===c.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(z){return z.visibility<1||!this._disableAlphaBlending&&(z.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(z){return!this.needAlphaBlendingForMesh(z)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}fj(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=this.va().meshes;for(const K of a)if(K.Vf)for(const a of K.Vf)if(a.Ha()===this)for(const K of a._drawWrappers)K&&this._materialContext===K.materialContext&&(K._wasPreviouslyReady=!1,K._wasPreviouslyUsingInstances=null,K._forceRebindOnNextCall=z);z&&this.zg(c.AllDirtyFlag)}_preBind(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=this._scene.getEngine(),v=(null==a?this.sideOrientation:a)===c.ClockWiseSideOrientation;return K.enableEffect(z||this._getDrawWrapper()),K.setState(this.Rg,this.zOffset,!1,v,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),v}bind(z,a){}buildUniformLayout(){const z=this._uniformBuffer;this._eventInfo.ubo=z,this._callbackPluginEventGeneric(8,this._eventInfo),z.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(z,a,K){const v=K._drawWrapper;this._eventInfo.subMesh=K,this._callbackPluginEventBindForSubMesh(this._eventInfo),v._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(z){}bindView(z){this._useUBO?this._needToBindSceneUbo=!0:z.setMatrix("view",this.va().getViewMatrix())}bindViewProjection(z){this._useUBO?this._needToBindSceneUbo=!0:(z.setMatrix("viewProjection",this.va().getTransformMatrix()),z.setMatrix("projection",this.va().getProjectionMatrix()))}bindEyePosition(z,a){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(z,a)}_afterBind(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&a&&(this._needToBindSceneUbo=!1,(0,V.r)(a,this.va().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=z?z.visibility:1,this._onBindObservable&&z&&this._onBindObservable.notifyObservers(z),this.disableDepthWrite){const z=this._scene.getEngine();this._cachedDepthWriteState=z.getDepthWrite(),z.setDepthWrite(!1)}if(this.disableColorWrite){const z=this._scene.getEngine();this._cachedColorWriteState=z.getColorWrite(),z.setColorWrite(!1)}if(0!==this.depthFunction){const z=this._scene.getEngine();this._cachedDepthFunctionState=z.getDepthFunction()||0,z.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(z){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=z,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(z){return null}_clonePlugins(z,a){const K={};if(this._serializePlugins(K),c._ParsePlugins(K,z,this._scene,a),this.pluginManager)for(const v of this.pluginManager._plugins){const a=z.pluginManager.getPlugin(v.name);a&&v.copyTo(a)}}getBindedMeshes(){if(this.meshMap){const z=[];for(const a in this.meshMap){const K=this.meshMap[a];K&&z.push(K)}return z}return this._scene.meshes.filter((z=>z.material===this))}forceCompilation(z,a,K,v){const T={clipPlane:!1,useInstances:!1,...K},m=this.va(),p=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const j=()=>{if(!this._scene||!this._scene.getEngine())return;const K=m.clipPlane;if(T.clipPlane&&(m.clipPlane=new W.d(0,0,0,1)),this._storeEffectOnSubMeshes){let K=!0,m=null;if(z.Vf){const a=new s.e(0,0,0,0,0,z,void 0,!1,!1);a.materialDefines&&(a.materialDefines._renderId=-1),this.isReadyForSubMesh(z,a,T.useInstances)||(a.effect&&a.effect.getCompilationError()&&a.effect.allFallbacksProcessed()?m=a.effect.getCompilationError():(K=!1,setTimeout(j,16)))}K&&(this.allowShaderHotSwapping=p,m&&v&&v(m),a&&a(this))}else this.isReady()?(this.allowShaderHotSwapping=p,a&&a(this)):setTimeout(j,16);T.clipPlane&&(m.clipPlane=K)};j()}forceCompilationAsync(z,a){return new Promise(((K,v)=>{this.forceCompilation(z,(()=>{K()}),a,(z=>{v(z)}))}))}zg(z){this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(c._DirtyCallbackArray.length=0,z&c.TextureDirtyFlag&&c._DirtyCallbackArray.push(c._TextureDirtyCallBack),z&c.LightDirtyFlag&&c._DirtyCallbackArray.push(c._LightsDirtyCallBack),z&c.FresnelDirtyFlag&&c._DirtyCallbackArray.push(c._FresnelDirtyCallBack),z&c.AttributesDirtyFlag&&c._DirtyCallbackArray.push(c._AttributeDirtyCallBack),z&c.MiscDirtyFlag&&c._DirtyCallbackArray.push(c._MiscDirtyCallBack),z&c.PrePassDirtyFlag&&c._DirtyCallbackArray.push(c._PrePassDirtyCallBack),c._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(c._RunDirtyCallBacks),this.va().resetCachedMaterial())}resetDrawCache(){const z=this.va().meshes;for(const a of z)if(a.Vf)for(const z of a.Vf)z.Ha()===this&&z.resetDrawCache()}_markAllSubMeshesAsDirty(z){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const a=this.va().meshes;for(const K of a)if(K.Vf)for(const a of K.Vf)if(a.Ha(!1)===this)for(const K of a._drawWrappers)K&&K.defines&&K.defines.markAllAsDirty&&this._materialContext===K.materialContext&&z(K.defines)}_markScenePrePassDirty(){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const z=this.va().enablePrePassRenderer();z&&z.zg()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(c._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(c._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(c._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(c._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(c._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(c._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(c._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(c._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(c._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(c._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const z=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.lj.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(z)}))}}setPrePassRenderer(z){return!1}dispose(z,a,K){const v=this.va();if(v.stopAnimation(this),v.freeProcessedMaterials(),v.removeMaterial(this),this._eventInfo.forceDisposeTextures=a,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const z=this._parentContainer.materials.indexOf(this);z>-1&&this._parentContainer.materials.splice(z,1),this._parentContainer=null}if(!0!==K)if(this.meshMap)for(const T in this.meshMap){const a=this.meshMap[T];a&&(a.material=null,this.releaseVertexArrayObject(a,z))}else{const a=v.meshes;for(const K of a)K.material!==this||K.sourceMesh||(K.material=null,this.releaseVertexArrayObject(K,z))}this._uniformBuffer.dispose(),z&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.lj.notifyObservers(this),this.lj.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(z,a){const K=z.Fj;if(K)if(this._storeEffectOnSubMeshes){if(z.Vf)for(const v of z.Vf)K._releaseVertexArrayObject(v.effect),a&&v.effect&&v.effect.dispose()}else K._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const z=G.e.Serialize(this);return z.stencil=this.stencil.serialize(),z.uniqueId=this.uniqueId,this._serializePlugins(z),z}_serializePlugins(z){if(z.plugins={},this.pluginManager)for(const a of this.pluginManager._plugins)z.plugins[a.getClassName()]=a.serialize()}static Parse(z,a,K){if(z.customType){if("BABYLON.PBRMaterial"===z.customType&&z.overloadedAlbedo&&(z.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return r.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else z.customType="BABYLON.StandardMaterial";const v=m.h.Instantiate(z.customType).Parse(z,a,K);return v._loadedUniqueId=z.uniqueId,v}static _ParsePlugins(z,a,K,v){if(z.plugins)for(const j in z.plugins){var T,p;const s=z.plugins[j];let M=null===(T=a.pluginManager)||void 0===T?void 0:T.getPlugin(s.name);if(!M){const z=m.h.Instantiate("BABYLON."+j);z&&(M=new z(a))}null===(p=M)||void 0===p||p.parse(s,K,v)}}}c.TriangleFillMode=0,c.WireFrameFillMode=1,c.PointFillMode=2,c.PointListDrawMode=3,c.LineListDrawMode=4,c.LineLoopDrawMode=5,c.LineStripDrawMode=6,c.TriangleStripDrawMode=7,c.TriangleFanDrawMode=8,c.ClockWiseSideOrientation=0,c.CounterClockWiseSideOrientation=1,c.TextureDirtyFlag=1,c.LightDirtyFlag=2,c.FresnelDirtyFlag=4,c.AttributesDirtyFlag=8,c.MiscDirtyFlag=16,c.PrePassDirtyFlag=32,c.AllDirtyFlag=63,c.MATERIAL_OPAQUE=0,c.MATERIAL_ALPHATEST=1,c.MATERIAL_ALPHABLEND=2,c.MATERIAL_ALPHATESTANDBLEND=3,c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,c.MATERIAL_NORMALBLENDMETHOD_RNM=1,c.OnEventObservable=new p.c,c._AllDirtyCallBack=z=>z.markAllAsDirty(),c._ImageProcessingDirtyCallBack=z=>z.markAsImageProcessingDirty(),c._TextureDirtyCallBack=z=>z.markAsTexturesDirty(),c._FresnelDirtyCallBack=z=>z.markAsFresnelDirty(),c._MiscDirtyCallBack=z=>z.markAsMiscDirty(),c._PrePassDirtyCallBack=z=>z.markAsPrePassDirty(),c._LightsDirtyCallBack=z=>z.markAsLightDirty(),c._AttributeDirtyCallBack=z=>z.markAsAttributesDirty(),c._FresnelAndMiscDirtyCallBack=z=>{c._FresnelDirtyCallBack(z),c._MiscDirtyCallBack(z)},c._TextureAndMiscDirtyCallBack=z=>{c._TextureDirtyCallBack(z),c._MiscDirtyCallBack(z)},c._DirtyCallbackArray=[],c._RunDirtyCallBacks=z=>{for(const a of c._DirtyCallbackArray)a(z)},(0,v.e)([(0,T.D)()],c.prototype,"id",void 0),(0,v.e)([(0,T.D)()],c.prototype,"uniqueId",void 0),(0,v.e)([(0,T.D)()],c.prototype,"name",void 0),(0,v.e)([(0,T.D)()],c.prototype,"metadata",void 0),(0,v.e)([(0,T.D)()],c.prototype,"checkReadyOnEveryCall",void 0),(0,v.e)([(0,T.D)()],c.prototype,"checkReadyOnlyOnce",void 0),(0,v.e)([(0,T.D)()],c.prototype,"state",void 0),(0,v.e)([(0,T.D)("alpha")],c.prototype,"_alpha",void 0),(0,v.e)([(0,T.D)("Rg")],c.prototype,"_backFaceCulling",void 0),(0,v.e)([(0,T.D)("cullBackFaces")],c.prototype,"_cullBackFaces",void 0),(0,v.e)([(0,T.D)()],c.prototype,"sideOrientation",void 0),(0,v.e)([(0,T.D)("alphaMode")],c.prototype,"_alphaMode",void 0),(0,v.e)([(0,T.D)()],c.prototype,"_needDepthPrePass",void 0),(0,v.e)([(0,T.D)()],c.prototype,"disableDepthWrite",void 0),(0,v.e)([(0,T.D)()],c.prototype,"disableColorWrite",void 0),(0,v.e)([(0,T.D)()],c.prototype,"forceDepthWrite",void 0),(0,v.e)([(0,T.D)()],c.prototype,"depthFunction",void 0),(0,v.e)([(0,T.D)()],c.prototype,"separateCullingPass",void 0),(0,v.e)([(0,T.D)("fogEnabled")],c.prototype,"_fogEnabled",void 0),(0,v.e)([(0,T.D)()],c.prototype,"pointSize",void 0),(0,v.e)([(0,T.D)()],c.prototype,"zOffset",void 0),(0,v.e)([(0,T.D)()],c.prototype,"zOffsetUnits",void 0),(0,v.e)([(0,T.D)()],c.prototype,"pointsCloud",null),(0,v.e)([(0,T.D)()],c.prototype,"fillMode",null),(0,v.e)([(0,T.D)()],c.prototype,"useLogarithmicDepth",null),(0,v.e)([(0,T.D)()],c.prototype,"transparencyMode",null)},11127:(z,a,K)=>{"use strict";K.d(a,{d:()=>v});class v{constructor(z){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=z,z)for(const a in z)Object.prototype.hasOwnProperty.call(z,a)&&this._setDefaultValue(a)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||z,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const z of Object.keys(this))"_"!==z[0]&&this._keys.push(z);if(this._externalProperties)for(const z in this._externalProperties)-1===this._keys.indexOf(z)&&this._keys.push(z)}isEqual(z){if(this._keys.length!==z._keys.length)return!1;for(let a=0;a<this._keys.length;a++){const K=this._keys[a];if(this[K]!==z[K])return!1}return!0}cloneTo(z){this._keys.length!==z._keys.length&&(z._keys=this._keys.slice(0));for(let a=0;a<this._keys.length;a++){const K=this._keys[a];z[K]=this[K]}}reset(){this._keys.forEach((z=>this._setDefaultValue(z)))}_setDefaultValue(z){var a,K,v,T;const m=(null===(a=this._externalProperties)||void 0===a||null===(K=a[z])||void 0===K?void 0:K.type)??typeof this[z],p=null===(v=this._externalProperties)||void 0===v||null===(T=v[z])||void 0===T?void 0:T.default;switch(m){case"number":this[z]=p??0;break;case"string":this[z]=p??"";break;default:this[z]=p??!1}}toString(){let z="";for(let a=0;a<this._keys.length;a++){const K=this._keys[a],v=this[K];switch(typeof v){case"number":case"string":z+="#define "+K+" "+v+"\n";break;default:v&&(z+="#define "+K+"\n")}}return z}}},11167:(z,a,K)=>{"use strict";K.d(a,{e:()=>T});var v=K(10715);class T{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(z){this._DiffuseTextureEnabled!==z&&(this._DiffuseTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(z){this._DetailTextureEnabled!==z&&(this._DetailTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(z){this._DecalMapEnabled!==z&&(this._DecalMapEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(z){this._AmbientTextureEnabled!==z&&(this._AmbientTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(z){this._OpacityTextureEnabled!==z&&(this._OpacityTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(z){this._ReflectionTextureEnabled!==z&&(this._ReflectionTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(z){this._EmissiveTextureEnabled!==z&&(this._EmissiveTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(z){this._SpecularTextureEnabled!==z&&(this._SpecularTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(z){this._BumpTextureEnabled!==z&&(this._BumpTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(z){this._LightmapTextureEnabled!==z&&(this._LightmapTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(z){this._RefractionTextureEnabled!==z&&(this._RefractionTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(z){this._ColorGradingTextureEnabled!==z&&(this._ColorGradingTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(z){this._FresnelEnabled!==z&&(this._FresnelEnabled=z,v.b.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(z){this._ClearCoatTextureEnabled!==z&&(this._ClearCoatTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(z){this._ClearCoatBumpTextureEnabled!==z&&(this._ClearCoatBumpTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(z){this._ClearCoatTintTextureEnabled!==z&&(this._ClearCoatTintTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(z){this._SheenTextureEnabled!==z&&(this._SheenTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(z){this._AnisotropicTextureEnabled!==z&&(this._AnisotropicTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(z){this._ThicknessTextureEnabled!==z&&(this._ThicknessTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(z){this._RefractionIntensityTextureEnabled!==z&&(this._RefractionIntensityTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(z){this._TranslucencyIntensityTextureEnabled!==z&&(this._TranslucencyIntensityTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(z){this._TranslucencyColorTextureEnabled!==z&&(this._TranslucencyColorTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(z){this._IridescenceTextureEnabled!==z&&(this._IridescenceTextureEnabled=z,v.b.MarkAllMaterialsAsDirty(1))}}T._DiffuseTextureEnabled=!0,T._DetailTextureEnabled=!0,T._DecalMapEnabled=!0,T._AmbientTextureEnabled=!0,T._OpacityTextureEnabled=!0,T._ReflectionTextureEnabled=!0,T._EmissiveTextureEnabled=!0,T._SpecularTextureEnabled=!0,T._BumpTextureEnabled=!0,T._LightmapTextureEnabled=!0,T._RefractionTextureEnabled=!0,T._ColorGradingTextureEnabled=!0,T._FresnelEnabled=!0,T._ClearCoatTextureEnabled=!0,T._ClearCoatBumpTextureEnabled=!0,T._ClearCoatTintTextureEnabled=!0,T._SheenTextureEnabled=!0,T._AnisotropicTextureEnabled=!0,T._ThicknessTextureEnabled=!0,T._RefractionIntensityTextureEnabled=!0,T._TranslucencyIntensityTextureEnabled=!0,T._TranslucencyColorTextureEnabled=!0,T._IridescenceTextureEnabled=!0},11114:(z,a,K)=>{"use strict";K.d(a,{C:()=>C,F:()=>Y,I:()=>I,M:()=>W,P:()=>i,T:()=>y,X:()=>x,_:()=>V,ab:()=>B,cb:()=>n,e:()=>w,fb:()=>X,h:()=>r,hb:()=>P,j:()=>f,kb:()=>o,m:()=>M,nb:()=>F,p:()=>G,r:()=>l,u:()=>c,y:()=>q});var v=K(10648),T=K(10971),m=K(10680),p=K(11054),j=K(11119);const s=T.c.Black();function M(z,a,K){if(!z||z.LOGARITHMICDEPTH||z.indexOf&&z.indexOf("LOGARITHMICDEPTH")>=0){const z=K.activeCamera;1===z.mode&&v.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),a.setFloat("logarithmicDepthConstant",2/(Math.log(z.maxZ+1)/Math.LN2))}}function r(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];K&&z.fogEnabled&&(!a||a.applyFog)&&0!==z.fogMode&&(K.setFloat4("vFogInfos",z.fogMode,z.fogStart,z.fogEnd,z.fogDensity),v?(z.fogColor.toLinearSpaceToRef(s,z.getEngine().useExactSrgbConversions),K.setColor3("vFogColor",s)):K.setColor3("vFogColor",z.fogColor))}function W(z,a,K){const T=K.NUM_MORPH_INFLUENCERS;if(T>0&&m.b.LastCreatedEngine){const p=m.b.LastCreatedEngine.getCaps().maxVertexAttribs,j=a.morphTargetManager;if(null!==j&&void 0!==j&&j.isUsingTextureForTargets)return;const s=j&&j.supportsNormals&&K.NORMAL,M=j&&j.supportsTangents&&K.TANGENT,r=j&&j.supportsUVs&&K.UV1;for(let K=0;K<T;K++)z.push("position"+K),s&&z.push("normal"+K),M&&z.push("tangent"+K),r&&z.push("uv_"+K),z.length>p&&v.c.Error("Cannot add more vertex attributes for mesh "+a.name)}}function F(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];z.push("world0"),z.push("world1"),z.push("world2"),z.push("world3"),a&&(z.push("previousWorld0"),z.push("previousWorld1"),z.push("previousWorld2"),z.push("previousWorld3"))}function G(z,a){const K=z.morphTargetManager;z&&K&&a.setFloatArray("morphTargetInfluences",K.influences)}function l(z,a){a.bindToEffect(z,"Scene")}function V(z,a,K){a._needUVs=!0,a[K]=!0,z.optimizeUVAllocation&&z.getTextureMatrix().isIdentityAs3x2()?(a[K+"DIRECTUV"]=z.coordinatesIndex+1,a["MAINUV"+(z.coordinatesIndex+1)]=!0):a[K+"DIRECTUV"]=0}function c(z,a,K){const v=z.getTextureMatrix();a.Jj(K+"Matrix",v)}function C(z,a,K){K.BAKED_VERTEX_ANIMATION_TEXTURE&&K.INSTANCES&&z.push("bakedVertexAnimationSettingsInstanced")}function w(z,a,K){var v;if(a&&z&&(z.computeBonesUsingShaders&&a._bonesComputationForcedToCPU&&(z.computeBonesUsingShaders=!1),z.useBones&&z.computeBonesUsingShaders&&z.skeleton)){const T=z.skeleton;if(T.isUsingTextureForMatrices&&a.getUniformIndex("boneTextureWidth")>-1){const K=T.getTransformMatrixTexture(z);a.setTexture("boneSampler",K),a.setFloat("boneTextureWidth",4*(T.bones.length+1))}else{const m=T.getTransformMatrices(z);m&&(a.setMatrices("mBones",m),K&&z.va().prePassRenderer&&z.va().prePassRenderer.getIndex(2)&&(K.previousBones[z.uniqueId]||(K.previousBones[z.uniqueId]=m.slice()),a.setMatrices("mPreviousBones",K.previousBones[z.uniqueId]),v=m,K.previousBones[z.uniqueId].set(v)))}}}function H(z,a,K,v,T){let m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];z._bindLight(a,K,v,T,m)}function f(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const m=Math.min(a.lightSources.length,T);for(let p=0;p<m;p++){H(a.lightSources[p],p,z,K,"boolean"===typeof v?v:v.SPECULARTERM,a.receiveShadows)}}function Y(z,a,K,v){K.NUM_BONE_INFLUENCERS>0&&(v.addCPUSkinningFallback(0,a),z.push("matricesIndices"),z.push("matricesWeights"),K.NUM_BONE_INFLUENCERS>4&&(z.push("matricesIndicesExtra"),z.push("matricesWeightsExtra")))}function I(z,a){(a.INSTANCES||a.THIN_INSTANCES)&&F(z,!!a.PREPASS_VELOCITY),a.INSTANCESCOLOR&&z.push("instanceColor")}function q(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,T=0;for(let m=0;m<K&&z["LIGHT"+m];m++)m>0&&(T=v+m,a.addFallback(T,"LIGHT"+m)),z.SHADOWS||(z["SHADOW"+m]&&a.addFallback(v,"SHADOW"+m),z["SHADOWPCF"+m]&&a.addFallback(v,"SHADOWPCF"+m),z["SHADOWPCSS"+m]&&a.addFallback(v,"SHADOWPCSS"+m),z["SHADOWPOISSON"+m]&&a.addFallback(v,"SHADOWPOISSON"+m),z["SHADOWESM"+m]&&a.addFallback(v,"SHADOWESM"+m),z["SHADOWCLOSEESM"+m]&&a.addFallback(v,"SHADOWCLOSEESM"+m));return T++}function B(z,a,K,v,T,m,p){let j=arguments.length>7&&void 0!==arguments[7]&&arguments[7];p._areMiscDirty&&(p.LOGARITHMICDEPTH=K,p.POINTSIZE=v,p.FOG=T&&function(z,a){return a.fogEnabled&&z.applyFog&&0!==a.fogMode}(z,a),p.NONUNIFORMSCALING=z.nonUniformScaling,p.ALPHATEST=m,p.DECAL_AFTER_DETAIL=j)}function x(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!K._areLightsDirty)return K._needNormals;let p=0;const j={needNormals:K._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(z.lightsEnabled&&!m)for(const M of a.lightSources)if(Z(z,a,M,p,K,v,j),p++,p===T)break;K.SPECULARTERM=j.specularEnabled,K.SHADOWS=j.shadowEnabled;for(let M=p;M<T;M++)void 0!==K["LIGHT"+M]&&(K["LIGHT"+M]=!1,K["HEMILIGHT"+M]=!1,K["POINTLIGHT"+M]=!1,K["DIRLIGHT"+M]=!1,K["SPOTLIGHT"+M]=!1,K["SHADOW"+M]=!1,K["SHADOWCSM"+M]=!1,K["SHADOWCSMDEBUG"+M]=!1,K["SHADOWCSMNUM_CASCADES"+M]=!1,K["SHADOWCSMUSESHADOWMAXZ"+M]=!1,K["SHADOWCSMNOBLEND"+M]=!1,K["SHADOWCSM_RIGHTHANDED"+M]=!1,K["SHADOWPCF"+M]=!1,K["SHADOWPCSS"+M]=!1,K["SHADOWPOISSON"+M]=!1,K["SHADOWESM"+M]=!1,K["SHADOWCLOSEESM"+M]=!1,K["SHADOWCUBE"+M]=!1,K["SHADOWLOWQUALITY"+M]=!1,K["SHADOWMEDIUMQUALITY"+M]=!1);const s=z.getEngine().getCaps();return void 0===K.SHADOWFLOAT&&(j.needRebuild=!0),K.SHADOWFLOAT=j.shadowEnabled&&(s.textureFloatRender&&s.textureFloatLinearFiltering||s.textureHalfFloatRender&&s.textureHalfFloatLinearFiltering),K.LIGHTMAPEXCLUDED=j.lightmapMode,j.needRebuild&&K.rebuild(),j.needNormals}function Z(z,a,K,v,T,m,j){switch(j.needNormals=!0,void 0===T["LIGHT"+v]&&(j.needRebuild=!0),T["LIGHT"+v]=!0,T["SPOTLIGHT"+v]=!1,T["HEMILIGHT"+v]=!1,T["POINTLIGHT"+v]=!1,T["DIRLIGHT"+v]=!1,K.prepareLightSpecificDefines(T,v),T["LIGHT_FALLOFF_PHYSICAL"+v]=!1,T["LIGHT_FALLOFF_GLTF"+v]=!1,T["LIGHT_FALLOFF_STANDARD"+v]=!1,K.falloffType){case p.e.FALLOFF_GLTF:T["LIGHT_FALLOFF_GLTF"+v]=!0;break;case p.e.FALLOFF_PHYSICAL:T["LIGHT_FALLOFF_PHYSICAL"+v]=!0;break;case p.e.FALLOFF_STANDARD:T["LIGHT_FALLOFF_STANDARD"+v]=!0}if(m&&!K.ih.equalsFloats(0,0,0)&&(j.specularEnabled=!0),T["SHADOW"+v]=!1,T["SHADOWCSM"+v]=!1,T["SHADOWCSMDEBUG"+v]=!1,T["SHADOWCSMNUM_CASCADES"+v]=!1,T["SHADOWCSMUSESHADOWMAXZ"+v]=!1,T["SHADOWCSMNOBLEND"+v]=!1,T["SHADOWCSM_RIGHTHANDED"+v]=!1,T["SHADOWPCF"+v]=!1,T["SHADOWPCSS"+v]=!1,T["SHADOWPOISSON"+v]=!1,T["SHADOWESM"+v]=!1,T["SHADOWCLOSEESM"+v]=!1,T["SHADOWCUBE"+v]=!1,T["SHADOWLOWQUALITY"+v]=!1,T["SHADOWMEDIUMQUALITY"+v]=!1,a&&a.receiveShadows&&z.shadowsEnabled&&K.shadowEnabled){const a=K.getShadowGenerator(z.activeCamera)??K.getShadowGenerator();if(a){const z=a.getShadowMap();z&&z.renderList&&z.renderList.length>0&&(j.shadowEnabled=!0,a.prepareDefines(T,v))}}K.lightmapMode!=p.e.LIGHTMAP_DEFAULT?(j.lightmapMode=!0,T["LIGHTMAPEXCLUDED"+v]=!0,T["LIGHTMAPNOSPECULAR"+v]=K.lightmapMode==p.e.LIGHTMAP_SHADOWSONLY):(T["LIGHTMAPEXCLUDED"+v]=!1,T["LIGHTMAPNOSPECULAR"+v]=!1)}function y(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=function(z,a){let K=!1;if(z.activeCamera){const v=a.CAMERA_ORTHOGRAPHIC?1:0,T=a.CAMERA_PERSPECTIVE?1:0,m=1===z.activeCamera.mode?1:0,p=0===z.activeCamera.mode?1:0;(v^m||T^p)&&(a.CAMERA_ORTHOGRAPHIC=1===m,a.CAMERA_PERSPECTIVE=1===p,K=!0)}return K}(z,v);!1!==m&&(s=(0,j.k)(K,z,v)),v.DEPTHPREPASS!==!a.getColorWrite()&&(v.DEPTHPREPASS=!v.DEPTHPREPASS,s=!0),v.INSTANCES!==T&&(v.INSTANCES=T,s=!0),v.THIN_INSTANCES!==p&&(v.THIN_INSTANCES=p,s=!0),s&&v.markAsUnprocessed()}function i(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]&&arguments[4],m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!a._areAttributesDirty&&a._needNormals===a._normals&&a._needUVs===a._uvs)return!1;a._normals=a._needNormals,a._uvs=a._needUVs,a.NORMAL=a._needNormals&&z.isVerticesDataPresent("normal"),a._needNormals&&z.isVerticesDataPresent("tangent")&&(a.TANGENT=!0);for(let j=1;j<=6;++j)a["UV"+j]=!!a._needUVs&&z.isVerticesDataPresent(`uv${1===j?"":j}`);if(K){const K=z.useVertexColors&&z.isVerticesDataPresent("color");a.VERTEXCOLOR=K,a.VERTEXALPHA=z.hasVertexAlpha&&K&&m}return z.isVerticesDataPresent("instanceColor")&&(z.hasInstances||z.hasThinInstances)&&(a.INSTANCESCOLOR=!0),v&&function(z,a){if(z.useBones&&z.computeBonesUsingShaders&&z.skeleton){a.NUM_BONE_INFLUENCERS=z.numBoneInfluencers;const K=void 0!==a.BONETEXTURE;if(z.skeleton.isUsingTextureForMatrices&&K)a.BONETEXTURE=!0;else{a.BonesPerMesh=z.skeleton.bones.length+1,a.BONETEXTURE=!K&&void 0;const v=z.va().prePassRenderer;if(v&&v.enabled){const K=-1===v.excludedSkinnedMesh.indexOf(z);a.BONES_VELOCITY_ENABLED=K}}}else a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,void 0!==a.BONETEXTURE&&(a.BONETEXTURE=!1)}(z,a),T&&function(z,a){const K=z.morphTargetManager;K?(a.MORPHTARGETS_UV=K.supportsUVs&&a.UV1,a.MORPHTARGETS_TANGENT=K.supportsTangents&&a.TANGENT,a.MORPHTARGETS_NORMAL=K.supportsNormals&&a.NORMAL,a.NUM_MORPH_INFLUENCERS=K.numMaxInfluencers||K.numInfluencers,a.MORPHTARGETS=a.NUM_MORPH_INFLUENCERS>0,a.MORPHTARGETS_TEXTURE=K.isUsingTextureForTargets):(a.MORPHTARGETS_UV=!1,a.MORPHTARGETS_TANGENT=!1,a.MORPHTARGETS_NORMAL=!1,a.MORPHTARGETS=!1,a.NUM_MORPH_INFLUENCERS=0)}(z,a),p&&function(z,a){const K=z.bakedVertexAnimationManager;a.BAKED_VERTEX_ANIMATION_TEXTURE=!(!K||!K.isEnabled)}(z,a),!0}function n(z,a){if(z.activeCamera){const K=a.MULTIVIEW;a.MULTIVIEW=null!==z.activeCamera.outputRenderTarget&&z.activeCamera.outputRenderTarget.getViewCount()>1,a.MULTIVIEW!=K&&a.markAsUnprocessed()}}function X(z,a,K){const v=a.ORDER_INDEPENDENT_TRANSPARENCY,T=a.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;a.ORDER_INDEPENDENT_TRANSPARENCY=z.useOrderIndependentTransparency&&K,a.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!z.getEngine().getCaps().textureFloatLinearFiltering,v===a.ORDER_INDEPENDENT_TRANSPARENCY&&T===a.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||a.markAsUnprocessed()}function P(z,a,K){const v=a.PREPASS;if(!a._arePrePassDirty)return;const T=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(z.prePassRenderer&&z.prePassRenderer.enabled&&K){a.PREPASS=!0,a.SCENE_MRT_COUNT=z.prePassRenderer.mrtCount,a.PREPASS_NORMAL_WORLDSPACE=z.prePassRenderer.generateNormalsInWorldSpace,a.PREPASS_COLOR=!0,a.PREPASS_COLOR_INDEX=0;for(let K=0;K<T.length;K++){const v=z.prePassRenderer.getIndex(T[K].type);-1!==v?(a[T[K].define]=!0,a[T[K].index]=v):a[T[K].define]=!1}}else{a.PREPASS=!1;for(let z=0;z<T.length;z++)a[T[z].define]=!1}a.PREPASS!=v&&(a.markAsUnprocessed(),a.markAsImageProcessingDirty())}function J(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];T&&T.push("Light"+z),m||(a.push("vLightData"+z,"vLightDiffuse"+z,"vLightSpecular"+z,"vLightDirection"+z,"vLightFalloff"+z,"vLightGround"+z,"lightMatrix"+z,"shadowsInfo"+z,"depthValues"+z),K.push("shadowTexture"+z),K.push("depthTexture"+z),a.push("viewFrustumZ"+z,"cascadeBlendFactor"+z,"lightSizeUVCorrection"+z,"depthCorrection"+z,"penumbraDarkness"+z,"frustumLengths"+z),v&&(K.push("projectionLightTexture"+z),a.push("textureProjectionMatrix"+z)))}function o(z,a,K){let v,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,m=null;if(z.uniformsNames){const p=z;v=p.uniformsNames,m=p.uniformBuffersNames,a=p.samplers,K=p.defines,T=p.maxSimultaneousLights||0}else v=z,a||(a=[]);for(let p=0;p<T&&K["LIGHT"+p];p++)J(p,v,a,K["PROJECTEDLIGHTTEXTURE"+p],m);K.NUM_MORPH_INFLUENCERS&&(v.push("morphTargetInfluences"),v.push("morphTargetCount")),K.BAKED_VERTEX_ANIMATION_TEXTURE&&(v.push("bakedVertexAnimationSettings"),v.push("bakedVertexAnimationTextureSizeInverted"),v.push("bakedVertexAnimationTime"),a.push("bakedVertexAnimationTexture"))}},11189:(z,a,K)=>{"use strict";K.d(a,{d:()=>m});var v,T=K(10941);!function(z){z[z.Zero=0]="Zero",z[z.One=1]="One",z[z.MaxViewZ=2]="MaxViewZ"}(v||(v={}));class m{static CreateConfiguration(z){return m._Configurations[z]={defines:{},previousWorldMatrices:{},previousViewProjection:T.b.Zero(),currentViewProjection:T.b.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},m._Configurations[z]}static DeleteConfiguration(z){delete m._Configurations[z]}static GetConfiguration(z){return m._Configurations[z]}static AddUniformsAndSamplers(z,a){z.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(z,a){for(const K of a)if(K.Vf)for(const a of K.Vf)a._removeDrawWrapper(z)}static PrepareDefines(z,a,K){if(!K._arePrePassDirty)return;const v=m._Configurations[z];if(!v)return;K.PREPASS=!0,K.PREPASS_COLOR=!1,K.PREPASS_COLOR_INDEX=-1;let T=0;for(let p=0;p<m.GeometryTextureDescriptions.length;p++){const z=m.GeometryTextureDescriptions[p],a=z.define,j=z.defineIndex,s=v.defines[j];void 0!==s?(K[a]=!0,K[j]=s,T++):(K[a]=!1,delete K[j])}K.SCENE_MRT_COUNT=T,K.BONES_VELOCITY_ENABLED=a.useBones&&a.computeBonesUsingShaders&&a.skeleton&&!a.skeleton.isUsingTextureForMatrices&&-1===v.excludedSkinnedMesh.indexOf(a)}static Bind(z,a,K,v){const T=m._Configurations[z];if(T&&(void 0!==T.defines.PREPASS_VELOCITY_INDEX||void 0!==T.defines.PREPASS_VELOCITY_LINEAR_INDEX)){T.previousWorldMatrices[K.uniqueId]||(T.previousWorldMatrices[K.uniqueId]=v.clone());const z=K.va();T.previousViewProjection||(T.previousViewProjection=z.getTransformMatrix().clone(),T.currentViewProjection=z.getTransformMatrix().clone());const m=z.getEngine();if(T.currentViewProjection.updateFlag!==z.getTransformMatrix().updateFlag?(T.lastUpdateFrameId=m.frameId,T.previousViewProjection.p(T.currentViewProjection),T.currentViewProjection.p(z.getTransformMatrix())):T.lastUpdateFrameId!==m.frameId&&(T.lastUpdateFrameId=m.frameId,T.previousViewProjection.p(T.currentViewProjection)),a.setMatrix("previousWorld",T.previousWorldMatrices[K.uniqueId]),a.setMatrix("previousViewProjection",T.previousViewProjection),T.previousWorldMatrices[K.uniqueId]=v.clone(),K.useBones&&K.computeBonesUsingShaders&&K.skeleton){const z=K.skeleton;if(!z.isUsingTextureForMatrices||-1===a.getUniformIndex("boneTextureWidth")){const v=z.getTransformMatrices(K);v&&(T.previousBones[K.uniqueId]||(T.previousBones[K.uniqueId]=v.slice()),a.setMatrices("mPreviousBones",T.previousBones[K.uniqueId]),T.previousBones[K.uniqueId].set(v))}}}}}m.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],m._Configurations={}},11181:(z,a,K)=>{"use strict";K.d(a,{e:()=>C});var v=K(10923),T=K(10927),m=K(11064),p=K(10680),j=K(10699),s=K(10726);const M=new RegExp("^([gimus]+)!");class r{constructor(z){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=z,this._scene=z.va(),this._engine=this._scene.getEngine()}_addPlugin(z){for(let v=0;v<this._plugins.length;++v)if(this._plugins[v].name===z.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!z.isCompatible(this._material.shaderLanguage))throw`The plugin "${z.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const a=z.getClassName();r._MaterialPluginClassToMainDefine[a]||(r._MaterialPluginClassToMainDefine[a]="MATERIALPLUGIN_"+ ++r._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(z,a)=>this._handlePluginEvent(z,a),this._plugins.push(z),this._plugins.sort(((z,a)=>z.priority-a.priority)),this._codeInjectionPoints={};const K={};K[r._MaterialPluginClassToMainDefine[a]]={type:"boolean",default:!0};for(const v of this._plugins)v.collectDefines(K),this._collectPointNames("vertex",v.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",v.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=K,!0}_activatePlugin(z){-1===this._activePlugins.indexOf(z)&&(this._activePlugins.push(z),this._activePlugins.sort(((z,a)=>z.priority-a.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),z.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(z),this._activePluginsForExtraEvents.sort(((z,a)=>z.priority-a.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(z){for(let a=0;a<this._plugins.length;++a)if(this._plugins[a].name===z)return this._plugins[a];return null}_handlePluginEventIsReadyForSubMesh(z){let a=!0;for(const K of this._activePlugins)a=a&&K.isReadyForSubMesh(z.defines,this._scene,this._engine,z.subMesh);z.isReadyForSubMesh=a}_handlePluginEventPrepareDefinesBeforeAttributes(z){for(const a of this._activePlugins)a.prepareDefinesBeforeAttributes(z.defines,this._scene,z.mesh)}_handlePluginEventPrepareDefines(z){for(const a of this._activePlugins)a.prepareDefines(z.defines,this._scene,z.mesh)}_handlePluginEventHardBindForSubMesh(z){for(const a of this._activePluginsForExtraEvents)a.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,z.subMesh)}_handlePluginEventBindForSubMesh(z){for(const a of this._activePlugins)a.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,z.subMesh)}_handlePluginEventHasRenderTargetTextures(z){let a=!1;for(const K of this._activePluginsForExtraEvents)if(a=K.hasRenderTargetTextures(),a)break;z.hasRenderTargetTextures=a}_handlePluginEventFillRenderTargetTextures(z){for(const a of this._activePluginsForExtraEvents)a.fillRenderTargetTextures(z.renderTargets)}_handlePluginEvent(z,a){switch(z){case 512:{const z=a;for(const a of this._activePlugins)a.getActiveTextures(z.activeTextures);break}case 256:{const z=a;for(const a of this._activePlugins)a.getAnimatables(z.animatables);break}case 1024:{const z=a;let K=!1;for(const a of this._activePlugins)if(K=a.hasTexture(z.texture),K)break;z.hasTexture=K;break}case 2:{const z=a;for(const a of this._plugins)a.dispose(z.forceDisposeTextures);break}case 4:a.defineNames=this._defineNamesFromPlugins;break;case 128:{const z=a;for(const a of this._activePlugins)z.fallbackRank=a.addFallbacks(z.defines,z.fallbacks,z.fallbackRank),a.getAttributes(z.attributes,this._scene,z.mesh);this._uniformList.length>0&&z.uniforms.push(...this._uniformList),this._samplerList.length>0&&z.samplers.push(...this._samplerList),this._uboList.length>0&&z.uniformBuffersNames.push(...this._uboList),z.customCode=this._injectCustomCode(z,z.customCode);break}case 8:{const z=a;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const K=1===this._material.shaderLanguage;for(const a of this._plugins){const v=a.getUniforms(this._material.shaderLanguage);if(v){if(v.ubo)for(const a of v.ubo){if(a.size&&a.type){const v=a.arraySize??0;if(z.ubo.addUniform(a.name,a.size,v),K){let z;switch(a.type){case"mat4":z="mat4x4f";break;case"float":z="f32";break;default:z=`${a.type}f`}this._uboDeclaration+=`uniform ${a.name}: ${z}${v>0?`[${v}]`:""};\n`}else this._uboDeclaration+=`${a.type} ${a.name}${v>0?`[${v}]`:""};\n`}this._uniformList.push(a.name)}v.vertex&&(this._vertexDeclaration+=v.vertex+"\n"),v.fragment&&(this._fragmentDeclaration+=v.fragment+"\n")}a.getSamplers(this._samplerList),a.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(z,a){if(a)for(const K in a)this._codeInjectionPoints[z]||(this._codeInjectionPoints[z]={}),this._codeInjectionPoints[z][K]=!0}_injectCustomCode(z,a){return(K,v)=>{var T;a&&(v=a(K,v)),this._uboDeclaration&&(v=v.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(v=v.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(v=v.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const m=null===(T=this._codeInjectionPoints)||void 0===T?void 0:T[K];if(!m)return v;let p=null;for(let a in m){let T="";for(const v of this._activePlugins){var r;let m=null===(r=v.getCustomCode(K,this._material.shaderLanguage))||void 0===r?void 0:r[a];if(m){if(v.resolveIncludes){if(null===p){const a=0;p={defines:[],indexParameters:z.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:s.b.GetShadersRepository(a),includesShadersStore:s.b.GetIncludesShadersStore(a),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}p.isFragment="fragment"===K,(0,j.j)(m,p,(z=>m=z))}T+=m+"\n"}}if(T.length>0)if("!"===a.charAt(0)){a=a.substring(1);let z="g";if("!"===a.charAt(0))z="",a=a.substring(1);else{const K=M.exec(a);K&&K.length>=2&&(z=K[1],a=a.substring(z.length+1))}z.indexOf("g")<0&&(z+="g");const K=v,m=new RegExp(a,z);let p=m.exec(K);for(;null!==p;){let z=T;for(let a=0;a<p.length;++a)z=z.replace("$"+a,p[a]);v=v.replace(p[0],z),p=m.exec(K)}}else{const z="#define "+a;v=v.replace(z,"\n"+T+"\n"+z)}}return v}}}r._MaterialPluginClassToMainDefine={},r._MaterialPluginCounter=0,p.b.OnEnginesDisposedObservable.add((()=>{l()}));const W=[];let F=!1,G=null;function l(){W.length=0,F=!1,m.b.OnEventObservable.remove(G),G=null}var V=K(10973),c=K(10767);class C{isCompatible(z){return 0===z}_enable(z){z&&this._pluginManager._activatePlugin(this)}constructor(z,a,K,v){let T=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=z,this.name=a,this.priority=K,this.resolveIncludes=p,z.pluginManager||(z.pluginManager=new r(z),z.lj.add((()=>{z.pluginManager=void 0}))),this._pluginDefineNames=v,this._pluginManager=z.pluginManager,T&&this._pluginManager._addPlugin(this),m&&this._enable(!0),this.markAllDefinesAsDirty=z._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(z,a,K,v){return!0}hardBindForSubMesh(z,a,K,v){}bindForSubMesh(z,a,K,v){}dispose(z){}getCustomCode(z){return null}collectDefines(z){if(this._pluginDefineNames)for(const a of Object.keys(this._pluginDefineNames)){if("_"===a[0])continue;const K=typeof this._pluginDefineNames[a];z[a]={type:"number"===K?"number":"string"===K?"string":"boolean"===K?"boolean":"object",default:this._pluginDefineNames[a]}}}prepareDefinesBeforeAttributes(z,a,K){}prepareDefines(z,a,K){}hasTexture(z){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(z){}getActiveTextures(z){}getAnimatables(z){}addFallbacks(z,a,K){return K}getSamplers(z){}getAttributes(z,a,K){}getUniformBuffersNames(z){}getUniforms(){return{}}copyTo(z){V.e.Clone((()=>z),this)}serialize(){return V.e.Serialize(this)}parse(z,a,K){V.e.Parse((()=>this),z,a,K)}}(0,v.e)([(0,T.D)()],C.prototype,"name",void 0),(0,v.e)([(0,T.D)()],C.prototype,"priority",void 0),(0,v.e)([(0,T.D)()],C.prototype,"resolveIncludes",void 0),(0,v.e)([(0,T.D)()],C.prototype,"registerForExtraEvents",void 0),(0,c.e)("BABYLON.MaterialPluginBase",C)},11264:(z,a,K)=>{"use strict";K.d(a,{e:()=>p});var v=K(11064),T=K(10937),m=K(10767);class p extends v.b{get Wf(){return this._subMaterials}set Wf(z){this._subMaterials=z,this._hookArray(z)}getChildren(){return this.Wf}constructor(z,a){super(z,a,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.Wf=[],this._storeEffectOnSubMeshes=!0}_hookArray(z){var a=this;const K=z.push;z.push=function(){for(var v=arguments.length,T=new Array(v),m=0;m<v;m++)T[m]=arguments[m];const p=K.apply(z,T);return a._markAllSubMeshesAsTexturesDirty(),p};const v=z.splice;z.splice=(a,K)=>{const T=v.apply(z,[a,K]);return this._markAllSubMeshesAsTexturesDirty(),T}}getSubMaterial(z){return z<0||z>=this.Wf.length?this.va().defaultMaterial:this.Wf[z]}getActiveTextures(){return super.getActiveTextures().concat(...this.Wf.map((z=>z?z.getActiveTextures():[])))}hasTexture(z){if(super.hasTexture(z))return!0;for(let K=0;K<this.Wf.length;K++){var a;if(null!==(a=this.Wf[K])&&void 0!==a&&a.hasTexture(z))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(z,a,K){for(let v=0;v<this.Wf.length;v++){const T=this.Wf[v];if(T){if(T._storeEffectOnSubMeshes){if(!T.isReadyForSubMesh(z,a,K))return!1;continue}if(!T.isReady(z))return!1}}return!0}clone(z,a){const K=new p(z,this.va());for(let v=0;v<this.Wf.length;v++){let T=null;const m=this.Wf[v];T=a&&m?m.clone(z+"-"+m.name):this.Wf[v],K.Wf.push(T)}return K}serialize(){const z={};z.name=this.name,z.id=this.id,z.uniqueId=this.uniqueId,T.d&&(z.tags=T.d.GetTags(this)),z.materialsUniqueIds=[],z.materials=[];for(let a=0;a<this.Wf.length;a++){const K=this.Wf[a];K?(z.materialsUniqueIds.push(K.uniqueId),z.materials.push(K.id)):(z.materialsUniqueIds.push(null),z.materials.push(null))}return z}dispose(z,a,K){const v=this.va();if(!v)return;if(K)for(let m=0;m<this.Wf.length;m++){const K=this.Wf[m];K&&K.dispose(z,a)}const T=v.multiMaterials.indexOf(this);T>=0&&v.multiMaterials.splice(T,1),super.dispose(z,a)}static ParseMultiMaterial(z,a){const K=new p(z.name,a);return K.id=z.id,K._loadedUniqueId=z.uniqueId,T.d&&T.d.AddTagsTo(K,z.tags),z.materialsUniqueIds?K._waitingSubMaterialsUniqueIds=z.materialsUniqueIds:z.materials.forEach((z=>K.Wf.push(a.getLastMaterialById(z)))),K}}(0,m.e)("BABYLON.MultiMaterial",p)},11056:(z,a,K)=>{"use strict";K.d(a,{e:()=>v});class v{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(z){z.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(z){}bindForSubMesh(z,a,K,v,T){if(a.prePassRenderer&&a.prePassRenderer.enabled&&a.prePassRenderer.currentRTisSceneRT&&(-1!==a.prePassRenderer.getIndex(2)||-1!==a.prePassRenderer.getIndex(11))){this.previousWorldMatrices[K.uniqueId]||(this.previousWorldMatrices[K.uniqueId]=v.clone()),this.previousViewProjection||(this.previousViewProjection=a.getTransformMatrix().clone(),this.currentViewProjection=a.getTransformMatrix().clone());const T=a.getEngine();this.currentViewProjection.updateFlag!==a.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=T.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(a.getTransformMatrix())):this._lastUpdateFrameId!==T.frameId&&(this._lastUpdateFrameId=T.frameId,this.previousViewProjection.p(this.currentViewProjection)),z.setMatrix("previousWorld",this.previousWorldMatrices[K.uniqueId]),z.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[K.uniqueId]=v.clone()}}}},11130:(z,a,K)=>{"use strict";K.d(a,{c:()=>m});var v=K(10941),T=K(11064);class m extends T.b{constructor(z,a){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(z,a,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new v.b,this._storeEffectOnSubMeshes=K}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(z,a){return!!z&&(!this._storeEffectOnSubMeshes||(!z.Vf||0===z.Vf.length||this.isReadyForSubMesh(z,z.Vf[0],a)))}_isReadyForSubMesh(z){const a=z.materialDefines;return!(this.checkReadyOnEveryCall||!z.effect||!a||a._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(z){this._activeEffect.setMatrix("world",z)}bindOnlyNormalMatrix(z){this._activeEffect.setMatrix("normalMatrix",z)}bind(z,a){a&&this.bindForSubMesh(z,a,a.Vf[0])}_afterBind(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0;super._afterBind(z,a,K),this.va()._cachedEffect=a,K?K._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return K._drawWrapper._forceRebindOnNextCall||z.isCachedMaterialInvalid(this,a,v)}dispose(z,a,K){this._activeEffect=void 0,super.dispose(z,a,K)}}},10920:(z,a,K)=>{"use strict";K.d(a,{e:()=>Z});var v=K(10923),T=K(10927),m=K(10933),p=K(10935),j=K(10941),s=K(10971),M=K(11001),r=K(11056),W=K(10964),F=K(11064),G=K(11127),l=K(11130),V=K(11134),c=K(10767),C=K(11167),w=K(11174),H=K(11176),f=K(11119),Y=K(11114),I=K(10973),q=K(11189);const B={effect:null,subMesh:null};class x extends G.d{constructor(z){super(z),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(z){const a=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const K of a)this[K]=K===z}}class Z extends l.c{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(z){this._attachImageProcessingConfiguration(z),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(z){z!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=z||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(z){this.imageProcessingConfiguration.colorCurvesEnabled=z}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(z){this.imageProcessingConfiguration.colorGradingEnabled=z}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(z){this._imageProcessingConfiguration.toneMappingEnabled=z}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(z){this._imageProcessingConfiguration.exposure=z}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(z){this._imageProcessingConfiguration.contrast=z}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(z){this._imageProcessingConfiguration.colorGradingTexture=z}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(z){this._imageProcessingConfiguration.colorCurves=z}get canRenderToMRT(){return!0}constructor(z,a){super(z,a,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||Z.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new s.c(0,0,0),this.diffuseColor=new s.c(1,1,1),this.specularColor=new s.c(1,1,1),this.emissiveColor=new s.c(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new m.f(16),this._worldViewProjectionMatrix=j.b.Zero(),this._globalAmbientColor=new s.c(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new H.c(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new r.e,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),Z.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),Z.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(Z.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(Z.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"sb"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===F.b.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.me&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==F.b.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.me||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(z,a){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const T=a._drawWrapper;if(T.effect&&this.isFrozen&&T._wasPreviouslyReady&&T._wasPreviouslyUsingInstances===v)return!0;a.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),a.materialDefines=new x(this._eventInfo.defineNames));const m=this.va(),p=a.materialDefines;if(this._isReadyForSubMesh(a))return!0;const j=m.getEngine();p._needNormals=(0,Y.X)(m,z,p,!0,this._maxSimultaneousLights,this._disableLighting),(0,Y.cb)(m,p);const s=this.needAlphaBlendingForMesh(z)&&this.va().useOrderIndependentTransparency;if((0,Y.hb)(m,p,this.canRenderToMRT&&!s),(0,Y.fb)(m,p,s),q.d.PrepareDefines(j.currentRenderPassId,z,p),p._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,p._needUVs=!1;for(let z=1;z<=6;++z)p["MAINUV"+z]=!1;if(m.texturesEnabled){if(p.DIFFUSEDIRECTUV=0,p.BUMPDIRECTUV=0,p.AMBIENTDIRECTUV=0,p.OPACITYDIRECTUV=0,p.EMISSIVEDIRECTUV=0,p.SPECULARDIRECTUV=0,p.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&Z.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,Y._)(this._diffuseTexture,p,"DIFFUSE")}else p.DIFFUSE=!1;if(this._ambientTexture&&Z.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,Y._)(this._ambientTexture,p,"AMBIENT")}else p.AMBIENT=!1;if(this._opacityTexture&&Z.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,Y._)(this._opacityTexture,p,"OPACITY"),p.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else p.OPACITY=!1;if(this._reflectionTexture&&Z.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(p._needNormals=!0,p.REFLECTION=!0,p.ROUGHNESS=this._roughness>0,p.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,p.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===V.d.INVCUBIC_MODE,p.REFLECTIONMAP_3D=this._reflectionTexture.isCube,p.REFLECTIONMAP_OPPOSITEZ=p.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,p.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case V.d.EXPLICIT_MODE:p.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case V.d.PLANAR_MODE:p.setReflectionMode("REFLECTIONMAP_PLANAR");break;case V.d.PROJECTION_MODE:p.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case V.d.SKYBOX_MODE:p.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case V.d.SPHERICAL_MODE:p.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case V.d.EQUIRECTANGULAR_MODE:p.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case V.d.FIXED_EQUIRECTANGULAR_MODE:p.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case V.d.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:p.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case V.d.CUBIC_MODE:case V.d.INVCUBIC_MODE:default:p.setReflectionMode("REFLECTIONMAP_CUBIC")}p.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else p.REFLECTION=!1,p.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&Z.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,Y._)(this._emissiveTexture,p,"EMISSIVE")}else p.EMISSIVE=!1;if(this._lightmapTexture&&Z.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,Y._)(this._lightmapTexture,p,"LIGHTMAP"),p.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,p.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else p.LIGHTMAP=!1;if(this._specularTexture&&Z.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,Y._)(this._specularTexture,p,"SPECULAR"),p.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else p.SPECULAR=!1;if(m.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&Z.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,Y._)(this._bumpTexture,p,"BUMP"),p.PARALLAX=this._useParallax,p.PARALLAX_RHS=m.useRightHandedSystem,p.PARALLAXOCCLUSION=this._useParallaxOcclusion,p.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else p.BUMP=!1,p.PARALLAX=!1,p.PARALLAX_RHS=!1,p.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&Z.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;p._needUVs=!0,p.REFRACTION=!0,p.REFRACTIONMAP_3D=this._refractionTexture.isCube,p.RGBDREFRACTION=this._refractionTexture.isRGBD,p.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else p.REFRACTION=!1;p.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else p.DIFFUSE=!1,p.AMBIENT=!1,p.OPACITY=!1,p.REFLECTION=!1,p.EMISSIVE=!1,p.LIGHTMAP=!1,p.BUMP=!1,p.REFRACTION=!1;p.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),p.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,p.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,p.SPECULAROVERALPHA=this._useSpecularOverAlpha,p.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,p.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,p.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(z)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=p,this._eventInfo.subMesh=a,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(p._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(p),p.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,p.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}p._areFresnelDirty&&(Z.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(p.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,p.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,p.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,p.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,p.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,p.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,p._needNormals=!0,p.FRESNEL=!0):p.FRESNEL=!1),(0,Y.ab)(z,m,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(z)||this._forceAlphaTest,p,this._applyDecalMapAfterDetailMap),(0,Y.T)(m,j,this,p,v,null,a.getRenderingMesh().hasThinInstances),this._eventInfo.defines=p,this._eventInfo.mesh=z,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,Y.P)(z,p,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let F=!1;if(p.isDirty){const v=p._areLightsDisposed;p.markAsProcessed();const T=new w.d;p.REFLECTION&&T.addFallback(0,"REFLECTION"),p.SPECULAR&&T.addFallback(0,"SPECULAR"),p.BUMP&&T.addFallback(0,"BUMP"),p.PARALLAX&&T.addFallback(1,"PARALLAX"),p.PARALLAX_RHS&&T.addFallback(1,"PARALLAX_RHS"),p.PARALLAXOCCLUSION&&T.addFallback(0,"PARALLAXOCCLUSION"),p.SPECULAROVERALPHA&&T.addFallback(0,"SPECULAROVERALPHA"),p.FOG&&T.addFallback(1,"FOG"),p.POINTSIZE&&T.addFallback(0,"POINTSIZE"),p.LOGARITHMICDEPTH&&T.addFallback(0,"LOGARITHMICDEPTH"),(0,Y.y)(p,T,this._maxSimultaneousLights),p.SPECULARTERM&&T.addFallback(0,"SPECULARTERM"),p.DIFFUSEFRESNEL&&T.addFallback(1,"DIFFUSEFRESNEL"),p.OPACITYFRESNEL&&T.addFallback(2,"OPACITYFRESNEL"),p.REFLECTIONFRESNEL&&T.addFallback(3,"REFLECTIONFRESNEL"),p.EMISSIVEFRESNEL&&T.addFallback(4,"EMISSIVEFRESNEL"),p.FRESNEL&&T.addFallback(4,"FRESNEL"),p.MULTIVIEW&&T.addFallback(0,"MULTIVIEW");const s=[M.h.PositionKind];p.NORMAL&&s.push(M.h.NormalKind),p.TANGENT&&s.push(M.h.TangentKind);for(let z=1;z<=6;++z)p["UV"+z]&&s.push(`uv${1===z?"":z}`);p.VERTEXCOLOR&&s.push(M.h.ColorKind),(0,Y.F)(s,z,p,T),(0,Y.I)(s,p),(0,Y.M)(s,z,p),(0,Y.C)(s,z,p);let G="default";const l=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],V=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],c=["Material","Scene","Mesh"],C={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:p.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=T,this._eventInfo.fallbackRank=0,this._eventInfo.defines=p,this._eventInfo.uniforms=l,this._eventInfo.attributes=s,this._eventInfo.samplers=V,this._eventInfo.uniformBuffersNames=c,this._eventInfo.customCode=void 0,this._eventInfo.mesh=z,this._eventInfo.indexParameters=C,this._callbackPluginEventGeneric(128,this._eventInfo),q.d.AddUniformsAndSamplers(l,V),r.e.AddUniforms(l),r.e.AddSamplers(V),W.e&&(W.e.PrepareUniforms(l,p),W.e.PrepareSamplers(V,p)),(0,Y.kb)({uniformsNames:l,uniformBuffersNames:c,samplers:V,defines:p,maxSimultaneousLights:this._maxSimultaneousLights}),(0,f.e)(l);const H={};this.customShaderNameResolve&&(G=this.customShaderNameResolve(G,l,c,V,p,s,H));const I=p.toString(),x=a.effect;let Z=m.getEngine().createEffect(G,{attributes:s,uniformsNames:l,uniformBuffersNames:c,samplers:V,defines:I,fallbacks:T,onCompiled:this.onCompiled,onError:this.onError,indexParameters:C,processFinalCode:H.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:p.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([K.e(21),K.e(19)]).then(K.bind(K,12637)),Promise.all([K.e(22),K.e(20)]).then(K.bind(K,12786))]):await Promise.all([Promise.all([K.e(25),K.e(24)]).then(K.bind(K,12864)),Promise.all([K.e(27),K.e(26)]).then(K.bind(K,13032))]),this._shadersLoaded=!0}},j);if(this._eventInfo.customCode=void 0,Z)if(this._onEffectCreatedObservable&&(B.effect=Z,B.subMesh=a,this._onEffectCreatedObservable.notifyObservers(B)),this.allowShaderHotSwapping&&x&&!Z.isReady()){if(Z=x,p.markAsUnprocessed(),F=this.isFrozen,v)return p._areLightsDisposed=!0,!1}else m.resetCachedMaterial(),a.setEffect(Z,p,this._materialContext)}return!(!a.effect||!a.effect.isReady())&&(p._renderId=m.getRenderId(),T._wasPreviouslyReady=!F,T._wasPreviouslyUsingInstances=v,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const z=this._uniformBuffer;z.addUniform("diffuseLeftColor",4),z.addUniform("diffuseRightColor",4),z.addUniform("opacityParts",4),z.addUniform("reflectionLeftColor",4),z.addUniform("reflectionRightColor",4),z.addUniform("refractionLeftColor",4),z.addUniform("refractionRightColor",4),z.addUniform("emissiveLeftColor",4),z.addUniform("emissiveRightColor",4),z.addUniform("vDiffuseInfos",2),z.addUniform("vAmbientInfos",2),z.addUniform("vOpacityInfos",2),z.addUniform("vReflectionInfos",2),z.addUniform("vReflectionPosition",3),z.addUniform("vReflectionSize",3),z.addUniform("vEmissiveInfos",2),z.addUniform("vLightmapInfos",2),z.addUniform("vSpecularInfos",2),z.addUniform("vBumpInfos",3),z.addUniform("diffuseMatrix",16),z.addUniform("ambientMatrix",16),z.addUniform("opacityMatrix",16),z.addUniform("reflectionMatrix",16),z.addUniform("emissiveMatrix",16),z.addUniform("lightmapMatrix",16),z.addUniform("specularMatrix",16),z.addUniform("bumpMatrix",16),z.addUniform("vTangentSpaceParams",2),z.addUniform("pointSize",1),z.addUniform("alphaCutOff",1),z.addUniform("refractionMatrix",16),z.addUniform("vRefractionInfos",4),z.addUniform("vRefractionPosition",3),z.addUniform("vRefractionSize",3),z.addUniform("vSpecularColor",4),z.addUniform("vEmissiveColor",3),z.addUniform("vDiffuseColor",4),z.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(z,a,K){const v=this.va(),T=K.materialDefines;if(!T)return;const m=K.effect;if(!m)return;this._activeEffect=m,a.getMeshUniformBuffer().bindToEffect(m,"Mesh"),a.transferToEffect(z),this._uniformBuffer.bindToEffect(m,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,v,a,z,this.isFrozen),q.d.Bind(v.getEngine().currentRenderPassId,this._activeEffect,a,z),this._eventInfo.subMesh=K,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),T.OBJECTSPACE_NORMALMAP&&(z.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const j=this._mustRebind(v,m,K,a.visibility);(0,Y.e)(a,m);const M=this._uniformBuffer;if(j){if(this.bindViewProjection(m),!M.useUbo||!this.isFrozen||!M.isSync||K._drawWrapper._forceRebindOnNextCall){if(Z.FresnelEnabled&&T.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(M.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),M.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&M.updateColor4("opacityParts",new s.c(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(M.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),M.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(M.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),M.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(M.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),M.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),v.texturesEnabled){if(this._diffuseTexture&&Z.DiffuseTextureEnabled&&(M.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,Y.u)(this._diffuseTexture,M,"diffuse")),this._ambientTexture&&Z.AmbientTextureEnabled&&(M.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,Y.u)(this._ambientTexture,M,"ambient")),this._opacityTexture&&Z.OpacityTextureEnabled&&(M.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,Y.u)(this._opacityTexture,M,"opacity")),this._hasAlphaChannel()&&M.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&Z.ReflectionTextureEnabled&&(M.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),M.Jj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const z=this._reflectionTexture;M.updateVector3("vReflectionPosition",z.boundingBoxPosition),M.updateVector3("vReflectionSize",z.boundingBoxSize)}if(this._emissiveTexture&&Z.EmissiveTextureEnabled&&(M.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,Y.u)(this._emissiveTexture,M,"emissive")),this._lightmapTexture&&Z.LightmapTextureEnabled&&(M.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,Y.u)(this._lightmapTexture,M,"lightmap")),this._specularTexture&&Z.SpecularTextureEnabled&&(M.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,Y.u)(this._specularTexture,M,"specular")),this._bumpTexture&&v.getEngine().getCaps().standardDerivatives&&Z.BumpTextureEnabled&&(M.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,Y.u)(this._bumpTexture,M,"bump"),v._mirroredCameraPosition?M.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):M.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&Z.RefractionTextureEnabled){let z=1;if(this._refractionTexture.isCube||(M.Jj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(z=this._refractionTexture.depth)),M.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,z,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const z=this._refractionTexture;M.updateVector3("vRefractionPosition",z.boundingBoxPosition),M.updateVector3("vRefractionSize",z.boundingBoxSize)}}}this.pointsCloud&&M.updateFloat("pointSize",this.pointSize),M.updateColor4("vSpecularColor",this.specularColor,this.specularPower),M.updateColor3("vEmissiveColor",Z.EmissiveTextureEnabled?this.emissiveColor:s.c.BlackReadOnly),M.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),v.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),M.updateColor3("vAmbientColor",this._globalAmbientColor)}v.texturesEnabled&&(this._diffuseTexture&&Z.DiffuseTextureEnabled&&m.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&Z.AmbientTextureEnabled&&m.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&Z.OpacityTextureEnabled&&m.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&Z.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?m.setTexture("reflectionCubeSampler",this._reflectionTexture):m.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&Z.EmissiveTextureEnabled&&m.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&Z.LightmapTextureEnabled&&m.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&Z.SpecularTextureEnabled&&m.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&v.getEngine().getCaps().standardDerivatives&&Z.BumpTextureEnabled&&m.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&Z.RefractionTextureEnabled&&(this._refractionTexture.isCube?m.setTexture("refractionCubeSampler",this._refractionTexture):m.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(a)&&this.va().depthPeelingRenderer.bind(m),this._eventInfo.subMesh=K,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,f.h)(m,this,v),this.bindEyePosition(m)}else v.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(j||!this.isFrozen){var r;if(v.lightsEnabled&&!this._disableLighting&&(0,Y.j)(v,a,m,T,this._maxSimultaneousLights),(v.fogEnabled&&a.applyFog&&v.fogMode!==p.c.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||a.receiveShadows||T.PREPASS)&&this.bindView(m),(0,Y.h)(v,a,m),T.NUM_MORPH_INFLUENCERS&&(0,Y.p)(a,m),T.BAKED_VERTEX_ANIMATION_TEXTURE)null===(r=a.bakedVertexAnimationManager)||void 0===r||r.bind(m,T.INSTANCES);this.useLogarithmicDepth&&(0,Y.m)(T,m,v),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(a,this._activeEffect,K),M.update()}getAnimatables(){const z=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&z.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&z.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&z.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&z.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&z.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&z.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&z.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&z.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&z.push(this._refractionTexture),z}getActiveTextures(){const z=super.getActiveTextures();return this._diffuseTexture&&z.push(this._diffuseTexture),this._ambientTexture&&z.push(this._ambientTexture),this._opacityTexture&&z.push(this._opacityTexture),this._reflectionTexture&&z.push(this._reflectionTexture),this._emissiveTexture&&z.push(this._emissiveTexture),this._specularTexture&&z.push(this._specularTexture),this._bumpTexture&&z.push(this._bumpTexture),this._lightmapTexture&&z.push(this._lightmapTexture),this._refractionTexture&&z.push(this._refractionTexture),z}hasTexture(z){return!!super.hasTexture(z)||(this._diffuseTexture===z||(this._ambientTexture===z||(this._opacityTexture===z||(this._reflectionTexture===z||(this._emissiveTexture===z||(this._specularTexture===z||(this._bumpTexture===z||(this._lightmapTexture===z||this._refractionTexture===z))))))))}dispose(z,a){var K,v,T,m,p,j,s,M,r;a&&(null===(K=this._diffuseTexture)||void 0===K||K.dispose(),null===(v=this._ambientTexture)||void 0===v||v.dispose(),null===(T=this._opacityTexture)||void 0===T||T.dispose(),null===(m=this._reflectionTexture)||void 0===m||m.dispose(),null===(p=this._emissiveTexture)||void 0===p||p.dispose(),null===(j=this._specularTexture)||void 0===j||j.dispose(),null===(s=this._bumpTexture)||void 0===s||s.dispose(),null===(M=this._lightmapTexture)||void 0===M||M.dispose(),null===(r=this._refractionTexture)||void 0===r||r.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(z,a)}clone(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const v=I.e.Clone((()=>new Z(z,this.va())),this,{cloneTexturesOnlyOnce:a});return v.name=z,v.id=z,this.stencil.copyTo(v.stencil),this._clonePlugins(v,K),v}static Parse(z,a,K){const v=I.e.Parse((()=>new Z(z.name,a)),z,a,K);return z.stencil&&v.stencil.parse(z.stencil,a,K),F.b._ParsePlugins(z,v,a,K),v}static get DiffuseTextureEnabled(){return C.e.DiffuseTextureEnabled}static set DiffuseTextureEnabled(z){C.e.DiffuseTextureEnabled=z}static get DetailTextureEnabled(){return C.e.DetailTextureEnabled}static set DetailTextureEnabled(z){C.e.DetailTextureEnabled=z}static get AmbientTextureEnabled(){return C.e.AmbientTextureEnabled}static set AmbientTextureEnabled(z){C.e.AmbientTextureEnabled=z}static get OpacityTextureEnabled(){return C.e.OpacityTextureEnabled}static set OpacityTextureEnabled(z){C.e.OpacityTextureEnabled=z}static get ReflectionTextureEnabled(){return C.e.ReflectionTextureEnabled}static set ReflectionTextureEnabled(z){C.e.ReflectionTextureEnabled=z}static get EmissiveTextureEnabled(){return C.e.EmissiveTextureEnabled}static set EmissiveTextureEnabled(z){C.e.EmissiveTextureEnabled=z}static get SpecularTextureEnabled(){return C.e.SpecularTextureEnabled}static set SpecularTextureEnabled(z){C.e.SpecularTextureEnabled=z}static get BumpTextureEnabled(){return C.e.BumpTextureEnabled}static set BumpTextureEnabled(z){C.e.BumpTextureEnabled=z}static get LightmapTextureEnabled(){return C.e.LightmapTextureEnabled}static set LightmapTextureEnabled(z){C.e.LightmapTextureEnabled=z}static get RefractionTextureEnabled(){return C.e.RefractionTextureEnabled}static set RefractionTextureEnabled(z){C.e.RefractionTextureEnabled=z}static get ColorGradingTextureEnabled(){return C.e.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(z){C.e.ColorGradingTextureEnabled=z}static get FresnelEnabled(){return C.e.FresnelEnabled}static set FresnelEnabled(z){C.e.FresnelEnabled=z}}Z.ForceGLSL=!1,(0,v.e)([(0,T.x)("diffuseTexture")],Z.prototype,"_diffuseTexture",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],Z.prototype,"diffuseTexture",void 0),(0,v.e)([(0,T.x)("ambientTexture")],Z.prototype,"_ambientTexture",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"ambientTexture",void 0),(0,v.e)([(0,T.x)("opacityTexture")],Z.prototype,"_opacityTexture",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],Z.prototype,"opacityTexture",void 0),(0,v.e)([(0,T.x)("reflectionTexture")],Z.prototype,"_reflectionTexture",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"reflectionTexture",void 0),(0,v.e)([(0,T.x)("emissiveTexture")],Z.prototype,"_emissiveTexture",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"emissiveTexture",void 0),(0,v.e)([(0,T.x)("specularTexture")],Z.prototype,"_specularTexture",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"specularTexture",void 0),(0,v.e)([(0,T.x)("bumpTexture")],Z.prototype,"_bumpTexture",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"bumpTexture",void 0),(0,v.e)([(0,T.x)("lightmapTexture")],Z.prototype,"_lightmapTexture",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"lightmapTexture",void 0),(0,v.e)([(0,T.x)("refractionTexture")],Z.prototype,"_refractionTexture",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"refractionTexture",void 0),(0,v.e)([(0,T.h)("ambient")],Z.prototype,"ambientColor",void 0),(0,v.e)([(0,T.h)("diffuse")],Z.prototype,"diffuseColor",void 0),(0,v.e)([(0,T.h)("specular")],Z.prototype,"specularColor",void 0),(0,v.e)([(0,T.h)("emissive")],Z.prototype,"emissiveColor",void 0),(0,v.e)([(0,T.D)()],Z.prototype,"specularPower",void 0),(0,v.e)([(0,T.D)("useAlphaFromDiffuseTexture")],Z.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],Z.prototype,"useAlphaFromDiffuseTexture",void 0),(0,v.e)([(0,T.D)("useEmissiveAsIllumination")],Z.prototype,"_useEmissiveAsIllumination",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useEmissiveAsIllumination",void 0),(0,v.e)([(0,T.D)("linkEmissiveWithDiffuse")],Z.prototype,"_linkEmissiveWithDiffuse",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"linkEmissiveWithDiffuse",void 0),(0,v.e)([(0,T.D)("useSpecularOverAlpha")],Z.prototype,"_useSpecularOverAlpha",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useSpecularOverAlpha",void 0),(0,v.e)([(0,T.D)("useReflectionOverAlpha")],Z.prototype,"_useReflectionOverAlpha",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useReflectionOverAlpha",void 0),(0,v.e)([(0,T.D)("disableLighting")],Z.prototype,"_disableLighting",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsLightsDirty")],Z.prototype,"disableLighting",void 0),(0,v.e)([(0,T.D)("useObjectSpaceNormalMap")],Z.prototype,"_useObjectSpaceNormalMap",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useObjectSpaceNormalMap",void 0),(0,v.e)([(0,T.D)("useParallax")],Z.prototype,"_useParallax",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useParallax",void 0),(0,v.e)([(0,T.D)("useParallaxOcclusion")],Z.prototype,"_useParallaxOcclusion",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useParallaxOcclusion",void 0),(0,v.e)([(0,T.D)()],Z.prototype,"parallaxScaleBias",void 0),(0,v.e)([(0,T.D)("roughness")],Z.prototype,"_roughness",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"roughness",void 0),(0,v.e)([(0,T.D)()],Z.prototype,"indexOfRefraction",void 0),(0,v.e)([(0,T.D)()],Z.prototype,"invertRefractionY",void 0),(0,v.e)([(0,T.D)()],Z.prototype,"alphaCutOff",void 0),(0,v.e)([(0,T.D)("useLightmapAsShadowmap")],Z.prototype,"_useLightmapAsShadowmap",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useLightmapAsShadowmap",void 0),(0,v.e)([(0,T.j)("diffuseFresnelParameters")],Z.prototype,"_diffuseFresnelParameters",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsFresnelDirty")],Z.prototype,"diffuseFresnelParameters",void 0),(0,v.e)([(0,T.j)("opacityFresnelParameters")],Z.prototype,"_opacityFresnelParameters",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsFresnelAndMiscDirty")],Z.prototype,"opacityFresnelParameters",void 0),(0,v.e)([(0,T.j)("reflectionFresnelParameters")],Z.prototype,"_reflectionFresnelParameters",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsFresnelDirty")],Z.prototype,"reflectionFresnelParameters",void 0),(0,v.e)([(0,T.j)("refractionFresnelParameters")],Z.prototype,"_refractionFresnelParameters",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsFresnelDirty")],Z.prototype,"refractionFresnelParameters",void 0),(0,v.e)([(0,T.j)("emissiveFresnelParameters")],Z.prototype,"_emissiveFresnelParameters",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsFresnelDirty")],Z.prototype,"emissiveFresnelParameters",void 0),(0,v.e)([(0,T.D)("useReflectionFresnelFromSpecular")],Z.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsFresnelDirty")],Z.prototype,"useReflectionFresnelFromSpecular",void 0),(0,v.e)([(0,T.D)("useGlossinessFromSpecularMapAlpha")],Z.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,v.e)([(0,T.D)("maxSimultaneousLights")],Z.prototype,"_maxSimultaneousLights",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsLightsDirty")],Z.prototype,"maxSimultaneousLights",void 0),(0,v.e)([(0,T.D)("invertNormalMapX")],Z.prototype,"_invertNormalMapX",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"invertNormalMapX",void 0),(0,v.e)([(0,T.D)("invertNormalMapY")],Z.prototype,"_invertNormalMapY",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"invertNormalMapY",void 0),(0,v.e)([(0,T.D)("twoSidedLighting")],Z.prototype,"_twoSidedLighting",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"twoSidedLighting",void 0),(0,v.e)([(0,T.D)("applyDecalMapAfterDetailMap")],Z.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,v.e)([(0,T.d)("_markAllSubMeshesAsMiscDirty")],Z.prototype,"applyDecalMapAfterDetailMap",void 0),(0,c.e)("BABYLON.StandardMaterial",Z),p.c.DefaultMaterialFactory=z=>new Z("default material",z)},10991:(z,a,K)=>{"use strict";K.d(a,{c:()=>m});var v=K(10648),T=K(10631);class m{constructor(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=z,this._noUBO=!z.supportsUniformBuffers||T,this._dynamic=K,this._name=v??"no-name",this._data=a||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.Jj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.Jj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(z){let a;if(a=z<=2?z:4,this._uniformLocationPointer%a!==0){const z=this._uniformLocationPointer;this._uniformLocationPointer+=a-this._uniformLocationPointer%a;const K=this._uniformLocationPointer-z;for(let a=0;a<K;a++)this._data.push(0)}}addUniform(z,a){let K,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[z]){if(v>0){if(a instanceof Array)throw"addUniform should not be use with Array in UBO: "+z;if(this._fillAlignment(4),this._uniformArraySizes[z]={strideSize:a,arraySize:v},16==a)a*=v;else{a=a*v+(4-a)*v}K=[];for(let z=0;z<a;z++)K.push(0)}else{if(a instanceof Array)K=a,a=K.length;else{K=[];for(let z=0;z<a;z++)K.push(0)}this._fillAlignment(a)}this._uniformSizes[z]=a,this._uniformLocations[z]=this._uniformLocationPointer,this._uniformLocationPointer+=a;for(let z=0;z<a;z++)this._data.push(K[z]);this._needSync=!0}}addMatrix(z,a){this.addUniform(z,Array.prototype.slice.call(a.kj()))}addFloat2(z,a,K){const v=[a,K];this.addUniform(z,v)}addFloat3(z,a,K,v){const T=[a,K,v];this.addUniform(z,T)}addColor3(z,a){const K=[a.r,a.g,a.b];this.addUniform(z,K)}addColor4(z,a,K){const v=[a.r,a.g,a.b,K];this.addUniform(z,v)}addVector3(z,a){const K=[a.x,a.y,a.z];this.addUniform(z,K)}addMatrix3x3(z){this.addUniform(z,12)}addMatrix2x2(z){this.addUniform(z,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const z=[];let a=0;for(const K in this._uniformLocations)if(z.push(K),10===++a)break;return z.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(z,a){for(let K=0;K<z.length;++K)if(z[K]!==a[K])return!1;return!0}_copyBuffer(z,a){for(let K=0;K<z.length;++K)a[K]=z[K]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(m._UpdatedUbosInFrame[this._name]||(m._UpdatedUbosInFrame[this._name]=0),m._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(z,a,K){this._checkNewFrame();let T=this._uniformLocations[z];if(void 0===T){if(this._buffer)return void v.c.Error("Cannot add an uniform after UBO has been created. uniformName="+z);this.addUniform(z,K),T=this._uniformLocations[z]}if(this._buffer||this.create(),this._dynamic)for(let v=0;v<K;v++)this._bufferData[T+v]=a[v];else{let z=!1;for(let v=0;v<K;v++)(16===K&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[T+v]!==Math.fround(a[v]))&&(z=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[T+v]=a[v]);this._needSync=this._needSync||z}}updateUniformArray(z,a,K){this._checkNewFrame();const m=this._uniformLocations[z];if(void 0===m)return void v.c.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const p=this._uniformArraySizes[z];if(this._dynamic)for(let v=0;v<K;v++)this._bufferData[m+v]=a[v];else{let z=!1,v=0,j=0;for(let s=0;s<K;s++)if(this._bufferData[m+4*j+v]!==T.h.FloatRound(a[s])&&(z=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[m+4*j+v]=a[s]),v++,v===p.strideSize){for(;v<4;v++)this._bufferData[m+4*j+v]=0;v=0,j++}this._needSync=this._needSync||z}}_cacheMatrix(z,a){this._checkNewFrame();const K=this._valueCache[z],v=a.updateFlag;return(void 0===K||K!==v)&&(this._valueCache[z]=v,!0)}_updateMatrix3x3ForUniform(z,a){for(let K=0;K<3;K++)m._TempBuffer[4*K]=a[3*K],m._TempBuffer[4*K+1]=a[3*K+1],m._TempBuffer[4*K+2]=a[3*K+2],m._TempBuffer[4*K+3]=0;this.updateUniform(z,m._TempBuffer,12)}_updateMatrix3x3ForEffect(z,a){this._currentEffect.setMatrix3x3(z,a)}_updateMatrix2x2ForEffect(z,a){this._currentEffect.setMatrix2x2(z,a)}_updateMatrix2x2ForUniform(z,a){for(let K=0;K<2;K++)m._TempBuffer[4*K]=a[2*K],m._TempBuffer[4*K+1]=a[2*K+1],m._TempBuffer[4*K+2]=0,m._TempBuffer[4*K+3]=0;this.updateUniform(z,m._TempBuffer,8)}_updateFloatForEffect(z,a){this._currentEffect.setFloat(z,a)}_updateFloatForUniform(z,a){m._TempBuffer[0]=a,this.updateUniform(z,m._TempBuffer,1)}_updateFloat2ForEffect(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(z+v,a,K)}_updateFloat2ForUniform(z,a,K){m._TempBuffer[0]=a,m._TempBuffer[1]=K,this.updateUniform(z,m._TempBuffer,2)}_updateFloat3ForEffect(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(z+T,a,K,v)}_updateFloat3ForUniform(z,a,K,v){m._TempBuffer[0]=a,m._TempBuffer[1]=K,m._TempBuffer[2]=v,this.updateUniform(z,m._TempBuffer,3)}_updateFloat4ForEffect(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(z+m,a,K,v,T)}_updateFloat4ForUniform(z,a,K,v,T){m._TempBuffer[0]=a,m._TempBuffer[1]=K,m._TempBuffer[2]=v,m._TempBuffer[3]=T,this.updateUniform(z,m._TempBuffer,4)}_updateFloatArrayForEffect(z,a){this._currentEffect.setFloatArray(z,a)}_updateFloatArrayForUniform(z,a){this.updateUniformArray(z,a,a.length)}_updateArrayForEffect(z,a){this._currentEffect.setArray(z,a)}_updateArrayForUniform(z,a){this.updateUniformArray(z,a,a.length)}_updateIntArrayForEffect(z,a){this._currentEffect.setIntArray(z,a)}_updateIntArrayForUniform(z,a){m._TempBufferInt32View.set(a),this.updateUniformArray(z,m._TempBuffer,a.length)}_updateUIntArrayForEffect(z,a){this._currentEffect.setUIntArray(z,a)}_updateUIntArrayForUniform(z,a){m._TempBufferUInt32View.set(a),this.updateUniformArray(z,m._TempBuffer,a.length)}_updateMatrixForEffect(z,a){this._currentEffect.setMatrix(z,a)}_updateMatrixForUniform(z,a){this._cacheMatrix(z,a)&&this.updateUniform(z,a.kj(),16)}_updateMatricesForEffect(z,a){this._currentEffect.setMatrices(z,a)}_updateMatricesForUniform(z,a){this.updateUniform(z,a,a.length)}_updateVector3ForEffect(z,a){this._currentEffect.setVector3(z,a)}_updateVector3ForUniform(z,a){m._TempBuffer[0]=a.x,m._TempBuffer[1]=a.y,m._TempBuffer[2]=a.z,this.updateUniform(z,m._TempBuffer,3)}_updateVector4ForEffect(z,a){this._currentEffect.setVector4(z,a)}_updateVector4ForUniform(z,a){m._TempBuffer[0]=a.x,m._TempBuffer[1]=a.y,m._TempBuffer[2]=a.z,m._TempBuffer[3]=a.w,this.updateUniform(z,m._TempBuffer,4)}_updateColor3ForEffect(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(z+K,a)}_updateColor3ForUniform(z,a){m._TempBuffer[0]=a.r,m._TempBuffer[1]=a.g,m._TempBuffer[2]=a.b,this.updateUniform(z,m._TempBuffer,3)}_updateColor4ForEffect(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(z+v,a,K)}_updateDirectColor4ForEffect(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(z+K,a)}_updateColor4ForUniform(z,a,K){m._TempBuffer[0]=a.r,m._TempBuffer[1]=a.g,m._TempBuffer[2]=a.b,m._TempBuffer[3]=K,this.updateUniform(z,m._TempBuffer,4)}_updateDirectColor4ForUniform(z,a){m._TempBuffer[0]=a.r,m._TempBuffer[1]=a.g,m._TempBuffer[2]=a.b,m._TempBuffer[3]=a.a,this.updateUniform(z,m._TempBuffer,4)}_updateIntForEffect(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(z+K,a)}_updateIntForUniform(z,a){m._TempBufferInt32View[0]=a,this.updateUniform(z,m._TempBuffer,1)}_updateInt2ForEffect(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(z+v,a,K)}_updateInt2ForUniform(z,a,K){m._TempBufferInt32View[0]=a,m._TempBufferInt32View[1]=K,this.updateUniform(z,m._TempBuffer,2)}_updateInt3ForEffect(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(z+T,a,K,v)}_updateInt3ForUniform(z,a,K,v){m._TempBufferInt32View[0]=a,m._TempBufferInt32View[1]=K,m._TempBufferInt32View[2]=v,this.updateUniform(z,m._TempBuffer,3)}_updateInt4ForEffect(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(z+m,a,K,v,T)}_updateInt4ForUniform(z,a,K,v,T){m._TempBufferInt32View[0]=a,m._TempBufferInt32View[1]=K,m._TempBufferInt32View[2]=v,m._TempBufferInt32View[3]=T,this.updateUniform(z,m._TempBuffer,4)}_updateUIntForEffect(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(z+K,a)}_updateUIntForUniform(z,a){m._TempBufferUInt32View[0]=a,this.updateUniform(z,m._TempBuffer,1)}_updateUInt2ForEffect(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(z+v,a,K)}_updateUInt2ForUniform(z,a,K){m._TempBufferUInt32View[0]=a,m._TempBufferUInt32View[1]=K,this.updateUniform(z,m._TempBuffer,2)}_updateUInt3ForEffect(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(z+T,a,K,v)}_updateUInt3ForUniform(z,a,K,v){m._TempBufferUInt32View[0]=a,m._TempBufferUInt32View[1]=K,m._TempBufferUInt32View[2]=v,this.updateUniform(z,m._TempBuffer,3)}_updateUInt4ForEffect(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(z+m,a,K,v,T)}_updateUInt4ForUniform(z,a,K,v,T){m._TempBufferUInt32View[0]=a,m._TempBufferUInt32View[1]=K,m._TempBufferUInt32View[2]=v,m._TempBufferUInt32View[3]=T,this.updateUniform(z,m._TempBuffer,4)}setTexture(z,a){this._currentEffect.setTexture(z,a)}setTextureArray(z,a){this._currentEffect.setTextureArray(z,a)}bindTexture(z,a){this._currentEffect._bindTexture(z,a)}updateUniformDirectly(z,a){this.updateUniform(z,a,a.length),this.update()}bindToEffect(z,a){this._currentEffect=z,this._currentEffectName=a}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(z){if(!this._buffers)return this._buffer===z;for(let a=0;a<this._buffers.length;++a){if(this._buffers[a][0]===z)return this._bufferIndex=a,this._buffer=z,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const z=this._engine._uniformBuffers,a=z.indexOf(this);if(-1!==a&&(z[a]=z[z.length-1],z.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let K=0;K<this._buffers.length;++K){const z=this._buffers[K][0];this._engine._releaseBuffer(z)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}m._UpdatedUbosInFrame={},m._MAX_UNIFORM_SIZE=256,m._TempBuffer=new Float32Array(m._MAX_UNIFORM_SIZE),m._TempBufferInt32View=new Int32Array(m._TempBuffer.buffer),m._TempBufferUInt32View=new Uint32Array(m._TempBuffer.buffer)},11256:(z,a,K)=>{"use strict";K.d(a,{c:()=>p,e:()=>v});var v,T,m=K(10941);!function(z){z[z.LOCAL=0]="LOCAL",z[z.WORLD=1]="WORLD",z[z.BONE=2]="BONE"}(v||(v={}));class p{}p.X=new m.o(1,0,0),p.Y=new m.o(0,1,0),p.Z=new m.o(0,0,1),function(z){z[z.X=0]="X",z[z.Y=1]="Y",z[z.Z=2]="Z"}(T||(T={}))},10971:(z,a,K)=>{"use strict";K.d(a,{c:()=>W,d:()=>F,f:()=>G});var v=K(10951),T=K(10767),m=K(10946),p=K(10959);function j(z){return Math.pow(z,m.p)}function s(z){return z<=.04045?.0773993808*z:Math.pow(.947867299*(z+.055),2.4)}function M(z){return Math.pow(z,m.m)}function r(z){return z<=.0031308?12.92*z:1.055*Math.pow(z,.41666)-.055}class W{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=z,this.g=a,this.b=K}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"ib"}getHashCode(){let z=255*this.r|0;return z=397*z^255*this.g,z=397*z^255*this.b,z}toArray(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return z[a]=this.r,z[a+1]=this.g,z[a+2]=this.b,this}vc(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return W.FromArrayToRef(z,a,this),this}toColor4(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new F(this.r,this.g,this.b,z)}kj(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(z){return new W(this.r*z.r,this.g*z.g,this.b*z.b)}multiplyToRef(z,a){return a.r=this.r*z.r,a.g=this.g*z.g,a.b=this.b*z.b,a}multiplyInPlace(z){return this.r*=z.r,this.g*=z.g,this.b*=z.b,this}multiplyByFloats(z,a,K){return new W(this.r*z,this.g*a,this.b*K)}divide(z){throw new ReferenceError("Can not divide a color")}divideToRef(z,a){throw new ReferenceError("Can not divide a color")}divideInPlace(z){throw new ReferenceError("Can not divide a color")}minimizeInPlace(z){return this.minimizeInPlaceFromFloats(z.r,z.g,z.b)}maximizeInPlace(z){return this.maximizeInPlaceFromFloats(z.r,z.g,z.b)}minimizeInPlaceFromFloats(z,a,K){return this.r=Math.min(z,this.r),this.g=Math.min(a,this.g),this.b=Math.min(K,this.b),this}maximizeInPlaceFromFloats(z,a,K){return this.r=Math.max(z,this.r),this.g=Math.max(a,this.g),this.b=Math.max(K,this.b),this}floorToRef(z){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(z){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(z){return z&&this.r===z.r&&this.g===z.g&&this.b===z.b}equalsFloats(z,a,K){return this.equalsToFloats(z,a,K)}equalsToFloats(z,a,K){return this.r===z&&this.g===a&&this.b===K}equalsWithEpsilon(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.e;return(0,p.y)(this.r,z.r,a)&&(0,p.y)(this.g,z.g,a)&&(0,p.y)(this.b,z.b,a)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(z){throw new ReferenceError("Can not negate a color")}scale(z){return new W(this.r*z,this.g*z,this.b*z)}scaleInPlace(z){return this.r*=z,this.g*=z,this.b*=z,this}scaleToRef(z,a){return a.r=this.r*z,a.g=this.g*z,a.b=this.b*z,a}scaleAndAddToRef(z,a){return a.r+=this.r*z,a.g+=this.g*z,a.b+=this.b*z,a}clampToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2?arguments[2]:void 0;return K.r=(0,p.e)(this.r,z,a),K.g=(0,p.e)(this.g,z,a),K.b=(0,p.e)(this.b,z,a),K}add(z){return new W(this.r+z.r,this.g+z.g,this.b+z.b)}addInPlace(z){return this.r+=z.r,this.g+=z.g,this.b+=z.b,this}addInPlaceFromFloats(z,a,K){return this.r+=z,this.g+=a,this.b+=K,this}addToRef(z,a){return a.r=this.r+z.r,a.g=this.g+z.g,a.b=this.b+z.b,a}sc(z){return new W(this.r-z.r,this.g-z.g,this.b-z.b)}subtractToRef(z,a){return a.r=this.r-z.r,a.g=this.g-z.g,a.b=this.b-z.b,a}ri(z){return this.r-=z.r,this.g-=z.g,this.b-=z.b,this}subtractFromFloats(z,a,K){return new W(this.r-z,this.g-a,this.b-K)}subtractFromFloatsToRef(z,a,K,v){return v.r=this.r-z,v.g=this.g-a,v.b=this.b-K,v}clone(){return new W(this.r,this.g,this.b)}p(z){return this.r=z.r,this.g=z.g,this.b=z.b,this}Xd(z,a,K){return this.r=z,this.g=a,this.b=K,this}set(z,a,K){return this.Xd(z,a,K)}Vd(z){return this.r=this.g=this.b=z,this}toHexString(){const z=Math.round(255*this.r),a=Math.round(255*this.g),K=Math.round(255*this.b);return"#"+(0,p.w)(z)+(0,p.w)(a)+(0,p.w)(K)}fromHexString(z){return"#"!==z.substring(0,1)||7!==z.length||(this.r=parseInt(z.substring(1,3),16)/255,this.g=parseInt(z.substring(3,5),16)/255,this.b=parseInt(z.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new W)}toHSVToRef(z){const a=this.r,K=this.g,v=this.b,T=Math.max(a,K,v),m=Math.min(a,K,v);let p=0,j=0;const s=T,M=T-m;return 0!==T&&(j=M/T),T!=m&&(T==a?(p=(K-v)/M,K<v&&(p+=6)):T==K?p=(v-a)/M+2:T==v&&(p=(a-K)/M+4),p*=60),z.r=p,z.g=j,z.b=s,z}toLinearSpace(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=new W;return this.toLinearSpaceToRef(a,z),a}toLinearSpaceToRef(z){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(z.r=s(this.r),z.g=s(this.g),z.b=s(this.b)):(z.r=j(this.r),z.g=j(this.g),z.b=j(this.b)),this}toGammaSpace(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=new W;return this.toGammaSpaceToRef(a,z),a}toGammaSpaceToRef(z){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(z.r=r(this.r),z.g=r(this.g),z.b=r(this.b)):(z.r=M(this.r),z.g=M(this.g),z.b=M(this.b)),this}static HSVtoRGBToRef(z,a,K,v){const T=K*a,m=z/60,p=T*(1-Math.abs(m%2-1));let j=0,s=0,M=0;m>=0&&m<=1?(j=T,s=p):m>=1&&m<=2?(j=p,s=T):m>=2&&m<=3?(s=T,M=p):m>=3&&m<=4?(s=p,M=T):m>=4&&m<=5?(j=p,M=T):m>=5&&m<=6&&(j=T,M=p);const r=K-T;return v.r=j+r,v.g=s+r,v.b=M+r,v}static FromHSV(z,a,K){const v=new W(0,0,0);return W.HSVtoRGBToRef(z,a,K,v),v}static FromHexString(z){return new W(0,0,0).fromHexString(z)}static Jg(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new W(z[a],z[a+1],z[a+2])}static FromArrayToRef(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;K.r=z[a],K.g=z[a+1],K.b=z[a+2]}static FromInts(z,a,K){return new W(z/255,a/255,K/255)}static Lerp(z,a,K){const v=new W(0,0,0);return W.LerpToRef(z,a,K,v),v}static LerpToRef(z,a,K,v){v.r=z.r+(a.r-z.r)*K,v.g=z.g+(a.g-z.g)*K,v.b=z.b+(a.b-z.b)*K}static Hermite(z,a,K,v,T){const m=T*T,p=T*m,j=2*p-3*m+1,s=-2*p+3*m,M=p-2*m+T,r=p-m,F=z.r*j+K.r*s+a.r*M+v.r*r,G=z.g*j+K.g*s+a.g*M+v.g*r,l=z.b*j+K.b*s+a.b*M+v.b*r;return new W(F,G,l)}static Hermite1stDerivative(z,a,K,v,T){const m=W.Black();return this.Hermite1stDerivativeToRef(z,a,K,v,T,m),m}static Hermite1stDerivativeToRef(z,a,K,v,T,m){const p=T*T;m.r=6*(p-T)*z.r+(3*p-4*T+1)*a.r+6*(-p+T)*K.r+(3*p-2*T)*v.r,m.g=6*(p-T)*z.g+(3*p-4*T+1)*a.g+6*(-p+T)*K.g+(3*p-2*T)*v.g,m.b=6*(p-T)*z.b+(3*p-4*T+1)*a.b+6*(-p+T)*K.b+(3*p-2*T)*v.b}static Red(){return new W(1,0,0)}static Green(){return new W(0,1,0)}static Blue(){return new W(0,0,1)}static Black(){return new W(0,0,0)}static get BlackReadOnly(){return W._BlackReadOnly}static White(){return new W(1,1,1)}static Purple(){return new W(.5,0,.5)}static Magenta(){return new W(1,0,1)}static Yellow(){return new W(1,1,0)}static Gray(){return new W(.5,.5,.5)}static Teal(){return new W(0,1,1)}static Random(){return new W(Math.random(),Math.random(),Math.random())}}W._BlackReadOnly=W.Black(),Object.defineProperties(W.prototype,{dimension:{value:[3]},rank:{value:1}});class F{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=z,this.g=a,this.b=K,this.a=v}kj(){return[this.r,this.g,this.b,this.a]}toArray(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return z[a]=this.r,z[a+1]=this.g,z[a+2]=this.b,z[a+3]=this.a,this}vc(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=z[a],this.g=z[a+1],this.b=z[a+2],this.a=z[a+3],this}equals(z){return z&&this.r===z.r&&this.g===z.g&&this.b===z.b&&this.a===z.a}add(z){return new F(this.r+z.r,this.g+z.g,this.b+z.b,this.a+z.a)}addToRef(z,a){return a.r=this.r+z.r,a.g=this.g+z.g,a.b=this.b+z.b,a.a=this.a+z.a,a}addInPlace(z){return this.r+=z.r,this.g+=z.g,this.b+=z.b,this.a+=z.a,this}addInPlaceFromFloats(z,a,K,v){return this.r+=z,this.g+=a,this.b+=K,this.a+=v,this}sc(z){return new F(this.r-z.r,this.g-z.g,this.b-z.b,this.a-z.a)}subtractToRef(z,a){return a.r=this.r-z.r,a.g=this.g-z.g,a.b=this.b-z.b,a.a=this.a-z.a,a}ri(z){return this.r-=z.r,this.g-=z.g,this.b-=z.b,this.a-=z.a,this}subtractFromFloats(z,a,K,v){return new F(this.r-z,this.g-a,this.b-K,this.a-v)}subtractFromFloatsToRef(z,a,K,v,T){return T.r=this.r-z,T.g=this.g-a,T.b=this.b-K,T.a=this.a-v,T}scale(z){return new F(this.r*z,this.g*z,this.b*z,this.a*z)}scaleInPlace(z){return this.r*=z,this.g*=z,this.b*=z,this.a*=z,this}scaleToRef(z,a){return a.r=this.r*z,a.g=this.g*z,a.b=this.b*z,a.a=this.a*z,a}scaleAndAddToRef(z,a){return a.r+=this.r*z,a.g+=this.g*z,a.b+=this.b*z,a.a+=this.a*z,a}clampToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2?arguments[2]:void 0;return K.r=(0,p.e)(this.r,z,a),K.g=(0,p.e)(this.g,z,a),K.b=(0,p.e)(this.b,z,a),K.a=(0,p.e)(this.a,z,a),K}multiply(z){return new F(this.r*z.r,this.g*z.g,this.b*z.b,this.a*z.a)}multiplyToRef(z,a){return a.r=this.r*z.r,a.g=this.g*z.g,a.b=this.b*z.b,a.a=this.a*z.a,a}multiplyInPlace(z){return this.r*=z.r,this.g*=z.g,this.b*=z.b,this.a*=z.a,this}multiplyByFloats(z,a,K,v){return new F(this.r*z,this.g*a,this.b*K,this.a*v)}divide(z){throw new ReferenceError("Can not divide a color")}divideToRef(z,a){throw new ReferenceError("Can not divide a color")}divideInPlace(z){throw new ReferenceError("Can not divide a color")}minimizeInPlace(z){return this.r=Math.min(this.r,z.r),this.g=Math.min(this.g,z.g),this.b=Math.min(this.b,z.b),this.a=Math.min(this.a,z.a),this}maximizeInPlace(z){return this.r=Math.max(this.r,z.r),this.g=Math.max(this.g,z.g),this.b=Math.max(this.b,z.b),this.a=Math.max(this.a,z.a),this}minimizeInPlaceFromFloats(z,a,K,v){return this.r=Math.min(z,this.r),this.g=Math.min(a,this.g),this.b=Math.min(K,this.b),this.a=Math.min(v,this.a),this}maximizeInPlaceFromFloats(z,a,K,v){return this.r=Math.max(z,this.r),this.g=Math.max(a,this.g),this.b=Math.max(K,this.b),this.a=Math.max(v,this.a),this}floorToRef(z){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(z){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(z){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.e;return(0,p.y)(this.r,z.r,a)&&(0,p.y)(this.g,z.g,a)&&(0,p.y)(this.b,z.b,a)&&(0,p.y)(this.a,z.a,a)}equalsToFloats(z,a,K,v){return this.r===z&&this.g===a&&this.b===K&&this.a===v}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"tb"}getHashCode(){let z=255*this.r|0;return z=397*z^255*this.g,z=397*z^255*this.b,z=397*z^255*this.a,z}clone(){return(new F).p(this)}p(z){return this.r=z.r,this.g=z.g,this.b=z.b,this.a=z.a,this}Xd(z,a,K,v){return this.r=z,this.g=a,this.b=K,this.a=v,this}set(z,a,K,v){return this.Xd(z,a,K,v)}Vd(z){return this.r=this.g=this.b=this.a=z,this}toHexString(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=Math.round(255*this.r),K=Math.round(255*this.g),v=Math.round(255*this.b);if(z)return"#"+(0,p.w)(a)+(0,p.w)(K)+(0,p.w)(v);const T=Math.round(255*this.a);return"#"+(0,p.w)(a)+(0,p.w)(K)+(0,p.w)(v)+(0,p.w)(T)}fromHexString(z){return"#"!==z.substring(0,1)||9!==z.length&&7!==z.length||(this.r=parseInt(z.substring(1,3),16)/255,this.g=parseInt(z.substring(3,5),16)/255,this.b=parseInt(z.substring(5,7),16)/255,9===z.length&&(this.a=parseInt(z.substring(7,9),16)/255)),this}toLinearSpace(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=new F;return this.toLinearSpaceToRef(a,z),a}toLinearSpaceToRef(z){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(z.r=s(this.r),z.g=s(this.g),z.b=s(this.b)):(z.r=j(this.r),z.g=j(this.g),z.b=j(this.b)),z.a=this.a,this}toGammaSpace(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=new F;return this.toGammaSpaceToRef(a,z),a}toGammaSpaceToRef(z){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(z.r=r(this.r),z.g=r(this.g),z.b=r(this.b)):(z.r=M(this.r),z.g=M(this.g),z.b=M(this.b)),z.a=this.a,this}static FromHexString(z){return"#"!==z.substring(0,1)||9!==z.length&&7!==z.length?new F(0,0,0,0):new F(0,0,0,1).fromHexString(z)}static Lerp(z,a,K){return F.LerpToRef(z,a,K,new F)}static LerpToRef(z,a,K,v){return v.r=z.r+(a.r-z.r)*K,v.g=z.g+(a.g-z.g)*K,v.b=z.b+(a.b-z.b)*K,v.a=z.a+(a.a-z.a)*K,v}static Hermite(z,a,K,v,T){const m=T*T,p=T*m,j=2*p-3*m+1,s=-2*p+3*m,M=p-2*m+T,r=p-m,W=z.r*j+K.r*s+a.r*M+v.r*r,G=z.g*j+K.g*s+a.g*M+v.g*r,l=z.b*j+K.b*s+a.b*M+v.b*r,V=z.a*j+K.a*s+a.a*M+v.a*r;return new F(W,G,l,V)}static Hermite1stDerivative(z,a,K,v,T){const m=new F;return this.Hermite1stDerivativeToRef(z,a,K,v,T,m),m}static Hermite1stDerivativeToRef(z,a,K,v,T,m){const p=T*T;m.r=6*(p-T)*z.r+(3*p-4*T+1)*a.r+6*(-p+T)*K.r+(3*p-2*T)*v.r,m.g=6*(p-T)*z.g+(3*p-4*T+1)*a.g+6*(-p+T)*K.g+(3*p-2*T)*v.g,m.b=6*(p-T)*z.b+(3*p-4*T+1)*a.b+6*(-p+T)*K.b+(3*p-2*T)*v.b,m.a=6*(p-T)*z.a+(3*p-4*T+1)*a.a+6*(-p+T)*K.a+(3*p-2*T)*v.a}static FromColor3(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new F(z.r,z.g,z.b,a)}static Jg(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new F(z[a],z[a+1],z[a+2],z[a+3])}static FromArrayToRef(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;K.r=z[a],K.g=z[a+1],K.b=z[a+2],K.a=z[a+3]}static FromInts(z,a,K,v){return new F(z/255,a/255,K/255,v/255)}static CheckColors4(z,a){if(z.length===3*a){const a=[];for(let K=0;K<z.length;K+=3){const v=K/3*4;a[v]=z[K],a[v+1]=z[K+1],a[v+2]=z[K+2],a[v+3]=1}return a}return z}}Object.defineProperties(F.prototype,{dimension:{value:[4]},rank:{value:1}});class G{}G.ib=(0,v.d)(3,W.Black),G.tb=(0,v.d)(3,(()=>new F(0,0,0,0))),(0,T.e)("BABYLON.Color3",W),(0,T.e)("BABYLON.Color4",F)},10946:(z,a,K)=>{"use strict";K.d(a,{e:()=>p,i:()=>m,m:()=>v,p:()=>T});const v=1/2.2,T=2.2,m=(1+Math.sqrt(5))/2,p=.001},11036:(z,a,K)=>{"use strict";K.d(a,{b:()=>T});var v=K(11038);class T{static GetPlanes(z){const a=[];for(let K=0;K<6;K++)a.push(new v.d(0,0,0,0));return T.GetPlanesToRef(z,a),a}static GetNearPlaneToRef(z,a){const K=z.m;a.k.x=K[3]+K[2],a.k.y=K[7]+K[6],a.k.z=K[11]+K[10],a.d=K[15]+K[14],a.normalize()}static GetFarPlaneToRef(z,a){const K=z.m;a.k.x=K[3]-K[2],a.k.y=K[7]-K[6],a.k.z=K[11]-K[10],a.d=K[15]-K[14],a.normalize()}static GetLeftPlaneToRef(z,a){const K=z.m;a.k.x=K[3]+K[0],a.k.y=K[7]+K[4],a.k.z=K[11]+K[8],a.d=K[15]+K[12],a.normalize()}static GetRightPlaneToRef(z,a){const K=z.m;a.k.x=K[3]-K[0],a.k.y=K[7]-K[4],a.k.z=K[11]-K[8],a.d=K[15]-K[12],a.normalize()}static GetTopPlaneToRef(z,a){const K=z.m;a.k.x=K[3]-K[1],a.k.y=K[7]-K[5],a.k.z=K[11]-K[9],a.d=K[15]-K[13],a.normalize()}static GetBottomPlaneToRef(z,a){const K=z.m;a.k.x=K[3]+K[1],a.k.y=K[7]+K[5],a.k.z=K[11]+K[9],a.d=K[15]+K[13],a.normalize()}static GetPlanesToRef(z,a){T.GetNearPlaneToRef(z,a[0]),T.GetFarPlaneToRef(z,a[1]),T.GetLeftPlaneToRef(z,a[2]),T.GetRightPlaneToRef(z,a[3]),T.GetTopPlaneToRef(z,a[4]),T.GetBottomPlaneToRef(z,a[5])}static IsPointInFrustum(z,a){for(let K=0;K<6;K++)if(a[K].dotCoordinate(z)<0)return!1;return!0}}},11099:(z,a,K)=>{"use strict";K.d(a,{e:()=>j,i:()=>s});var v=K(10923),T=K(10941),m=K(10927);class p{static extractMinAndMaxIndexed(z,a,K,v,T,m){for(let p=K;p<K+v;p++){const K=3*a[p],v=z[K],j=z[K+1],s=z[K+2];T.minimizeInPlaceFromFloats(v,j,s),m.maximizeInPlaceFromFloats(v,j,s)}}static extractMinAndMax(z,a,K,v,T,m){for(let p=a,j=a*v;p<a+K;p++,j+=v){const a=z[j],K=z[j+1],v=z[j+2];T.minimizeInPlaceFromFloats(a,K,v),m.maximizeInPlaceFromFloats(a,K,v)}}}function j(z,a,K,v){let m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const j=new T.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new T.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return p.extractMinAndMaxIndexed(z,a,K,v,j,s),m&&(j.x-=j.x*m.x+m.y,j.y-=j.y*m.x+m.y,j.z-=j.z*m.x+m.y,s.x+=s.x*m.x+m.y,s.y+=s.y*m.x+m.y,s.z+=s.z*m.x+m.y),{minimum:j,maximum:s}}function s(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4?arguments[4]:void 0;const j=new T.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new T.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return m||(m=3),p.extractMinAndMax(z,a,K,m,j,s),v&&(j.x-=j.x*v.x+v.y,j.y-=j.y*v.x+v.y,j.z-=j.z*v.x+v.y,s.x+=s.x*v.x+v.y,s.y+=s.y*v.x+v.y,s.z+=s.z*v.x+v.y),{minimum:j,maximum:s}}(0,v.e)([m.e.filter((function(){for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];let[v,T]=a;return!Array.isArray(v)&&!Array.isArray(T)}))],p,"extractMinAndMaxIndexed",null),(0,v.e)([m.e.filter((function(){for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];let[v]=a;return!Array.isArray(v)}))],p,"extractMinAndMax",null)},11442:(z,a,K)=>{"use strict";K.d(a,{b:()=>v.j});K(11256),K(10971),K(10946),K(11036),K(11446),K(11038),K(11152);var v=K(10941);K(11223)},11446:(z,a,K)=>{"use strict";K.d(a,{c:()=>j,f:()=>r,h:()=>W});var v,T=K(10959),m=K(10941),p=K(10946);!function(z){z[z.CW=0]="CW",z[z.CCW=1]="CCW"}(v||(v={}));class j{static Interpolate(z,a,K,v,T){const m=1-3*v+3*a,p=3*v-6*a,j=3*a;let s=z;for(let M=0;M<5;M++){const a=s*s;s-=(m*(a*s)+p*a+j*s-z)*(1/(3*m*a+2*p*s+j)),s=Math.min(1,Math.max(0,s))}return 3*Math.pow(1-s,2)*s*K+3*(1-s)*Math.pow(s,2)*T+Math.pow(s,3)}}class s{constructor(z){this._radians=z,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(z,a){const K=a.sc(z),v=Math.atan2(K.y,K.x);return new s(v)}static BetweenTwoVectors(z,a){let K=z.lengthSquared()*a.lengthSquared();if(0===K)return new s(Math.PI/2);K=Math.sqrt(K);let v=z.dot(a)/K;v=(0,T.e)(v,-1,1);const m=Math.acos(v);return new s(m)}static FromRadians(z){return new s(z)}static FromDegrees(z){return new s(z*Math.PI/180)}}class M{constructor(z,a,K){this.startPoint=z,this.midPoint=a,this.endPoint=K;const v=Math.pow(a.x,2)+Math.pow(a.y,2),T=(Math.pow(z.x,2)+Math.pow(z.y,2)-v)/2,p=(v-Math.pow(K.x,2)-Math.pow(K.y,2))/2,j=(z.x-a.x)*(a.y-K.y)-(a.x-K.x)*(z.y-a.y);this.centerPoint=new m.m((T*(a.y-K.y)-p*(z.y-a.y))/j,((z.x-a.x)*p-(a.x-K.x)*T)/j),this.radius=this.centerPoint.sc(this.startPoint).length(),this.startAngle=s.BetweenTwoPoints(this.centerPoint,this.startPoint);const M=this.startAngle.degrees();let r=s.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),W=s.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();r-M>180&&(r-=360),r-M<-180&&(r+=360),W-r>180&&(W-=360),W-r<-180&&(W+=360),this.orientation=r-M<0?0:1,this.angle=s.FromDegrees(0===this.orientation?M-W:W-M)}}class r{constructor(z,a){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new m.m(z,a))}addLineTo(z,a){if(this.closed)return this;const K=new m.m(z,a),v=this._points[this._points.length-1];return this._points.push(K),this._length+=K.sc(v).length(),this}addArcTo(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const p=this._points[this._points.length-1],j=new m.m(z,a),s=new m.m(K,v),r=new M(p,j,s);let W=r.angle.radians()/T;0===r.orientation&&(W*=-1);let F=r.startAngle.radians()+W;for(let m=0;m<T;m++){const z=Math.cos(F)*r.radius+r.centerPoint.x,a=Math.sin(F)*r.radius+r.centerPoint.y;this.addLineTo(z,a),F+=W}return this}addQuadraticCurveTo(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const m=(z,a,K,v)=>(1-z)*(1-z)*a+2*z*(1-z)*K+z*z*v,p=this._points[this._points.length-1];for(let j=0;j<=T;j++){const s=j/T,M=m(s,p.x,z,K),r=m(s,p.y,a,v);this.addLineTo(M,r)}return this}addBezierCurveTo(z,a,K,v,T,m){let p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const j=(z,a,K,v,T)=>(1-z)*(1-z)*(1-z)*a+3*z*(1-z)*(1-z)*K+3*z*z*(1-z)*v+z*z*z*T,s=this._points[this._points.length-1];for(let M=0;M<=p;M++){const r=M/p,W=j(r,s.x,z,K,T),F=j(r,s.y,a,v,m);this.addLineTo(W,F)}return this}isPointInside(z){let a=!1;const K=this._points.length;for(let v=K-1,T=0;T<K;v=T++){let K=this._points[v],m=this._points[T],p=m.x-K.x,j=m.y-K.y;if(Math.abs(j)>Number.EPSILON){if(j<0&&(K=this._points[T],p=-p,m=this._points[v],j=-j),z.y<K.y||z.y>m.y)continue;if(z.y===K.y&&z.x===K.x)return!0;{const v=j*(z.x-K.x)-p*(z.y-K.y);if(0===v)return!0;if(v<0)continue;a=!a}}else{if(z.y!==K.y)continue;if(m.x<=z.x&&z.x<=K.x||K.x<=z.x&&z.x<=m.x)return!0}}return a}close(){return this.closed=!0,this}length(){let z=this._length;if(this.closed){const a=this._points[this._points.length-1];z+=this._points[0].sc(a).length()}return z}area(){const z=this._points.length;let a=0;for(let K=z-1,v=0;v<z;K=v++)a+=this._points[K].x*this._points[v].y-this._points[v].x*this._points[K].y;return.5*a}getPoints(){return this._points}getPointAtLengthPosition(z){if(z<0||z>1)return m.m.Zero();const a=z*this.length();let K=0;for(let v=0;v<this._points.length;v++){const z=(v+1)%this._points.length,T=this._points[v],p=this._points[z].sc(T),j=p.length()+K;if(a>=K&&a<=j){const z=p.normalize(),v=a-K;return new m.m(T.x+z.x*v,T.y+z.y*v)}K=j}return m.m.Zero()}static StartingAt(z,a){return new r(z,a)}}class W{constructor(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0,v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=z,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:m.o.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:m.b.Identity()};for(let T=0;T<z.length;T++)this._curve[T]=z[T].clone();this._raw=K||!1,this._alignTangentsWithPath=v,this._compute(a,v)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(z){return this._updatePointAtData(z).point}getTangentAt(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(z,a),a?m.o.TransformCoordinates(m.o.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(z,a),a?m.o.TransformCoordinates(m.o.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(z,a),a?m.o.TransformCoordinates(m.o.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(z){return this.length()*z}getPreviousPointIndexAt(z){return this._updatePointAtData(z),this._pointAtData.previousPointArrayIndex}getSubPositionAt(z){return this._updatePointAtData(z),this._pointAtData.subPosition}getClosestPositionTo(z){let a=Number.MAX_VALUE,K=0;for(let v=0;v<this._curve.length-1;v++){const T=this._curve[v+0],p=this._curve[v+1].sc(T).normalize(),j=this._distances[v+1]-this._distances[v+0],s=Math.min(Math.max(m.o.Dot(p,z.sc(T).normalize()),0)*m.o.Distance(T,z)/j,1),M=m.o.Distance(T.add(p.scale(s*j)),z);M<a&&(a=M,K=(this._distances[v+0]+j*s)/this.length())}return K}slice(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(z<0&&(z=1- -1*z%1),a<0&&(a=1- -1*a%1),z>a){const K=z;z=a,a=K}const K=this.getCurve(),v=this.getPointAt(z);let T=this.getPreviousPointIndexAt(z);const m=this.getPointAt(a),p=this.getPreviousPointIndexAt(a)+1,j=[];return 0!==z&&(T++,j.push(v)),j.push(...K.slice(T,p)),1===a&&1!==z||j.push(m),new W(j,this.getNormalAt(z),this._raw,this._alignTangentsWithPath)}update(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let v=0;v<z.length;v++)this._curve[v].x=z[v].x,this._curve[v].y=z[v].y,this._curve[v].z=z[v].z;return this._compute(a,K),this}_compute(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const K=this._curve.length;if(K<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[K-1]=this._curve[K-1].sc(this._curve[K-2]),this._raw||this._tangents[K-1].normalize();const v=this._tangents[0],T=this._normalVector(v,z);let p,j,s,M,r;this._normals[0]=T,this._raw||this._normals[0].normalize(),this._binormals[0]=m.o.Cross(v,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let W=1;W<K;W++)p=this._getLastNonNullVector(W),W<K-1&&(j=this._getFirstNonNullVector(W),this._tangents[W]=a?j:p.add(j),this._tangents[W].normalize()),this._distances[W]=this._distances[W-1]+this._curve[W].sc(this._curve[W-1]).length(),s=this._tangents[W],r=this._binormals[W-1],this._normals[W]=m.o.Cross(r,s),this._raw||(0===this._normals[W].length()?(M=this._normals[W-1],this._normals[W]=M.clone()):this._normals[W].normalize()),this._binormals[W]=m.o.Cross(s,this._normals[W]),this._raw||this._binormals[W].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(z){let a=1,K=this._curve[z+a].sc(this._curve[z]);for(;0===K.length()&&z+a+1<this._curve.length;)a++,K=this._curve[z+a].sc(this._curve[z]);return K}_getLastNonNullVector(z){let a=1,K=this._curve[z].sc(this._curve[z-a]);for(;0===K.length()&&z>a+1;)a++,K=this._curve[z].sc(this._curve[z-a]);return K}_normalVector(z,a){let K,v=z.length();if(0===v&&(v=1),void 0===a||null===a){let a;a=(0,T.y)(Math.abs(z.y)/v,1,p.e)?(0,T.y)(Math.abs(z.x)/v,1,p.e)?(0,T.y)(Math.abs(z.z)/v,1,p.e)?m.o.Zero():new m.o(0,0,1):new m.o(1,0,0):new m.o(0,-1,0),K=m.o.Cross(z,a)}else K=m.o.Cross(z,a),m.o.CrossToRef(K,z,K);return K.normalize(),K}_updatePointAtData(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===z)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=z;const K=this.getPoints();if(z<=0)return this._setPointAtData(0,0,K[0],0,a);if(z>=1)return this._setPointAtData(1,1,K[K.length-1],K.length-1,a);let v,T=K[0],p=0;const j=z*this.length();for(let s=1;s<K.length;s++){v=K[s];const M=m.o.Distance(T,v);if(p+=M,p===j)return this._setPointAtData(z,1,v,s,a);if(p>j){const K=(p-j)/M,m=T.sc(v),r=v.add(m.scaleInPlace(K));return this._setPointAtData(z,1-K,r,s-1,a)}T=v}return this._pointAtData}_setPointAtData(z,a,K,v,T){return this._pointAtData.point=K,this._pointAtData.position=z,this._pointAtData.subPosition=a,this._pointAtData.previousPointArrayIndex=v,this._pointAtData.interpolateReady=T,T&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=m.b.Identity();const z=this._pointAtData.previousPointArrayIndex;if(z!==this._tangents.length-1){const a=z+1,K=this._tangents[z].clone(),v=this._normals[z].clone(),T=this._binormals[z].clone(),p=this._tangents[a].clone(),j=this._normals[a].clone(),s=this._binormals[a].clone(),M=m.f.RotationQuaternionFromAxis(v,T,K),r=m.f.RotationQuaternionFromAxis(j,s,p);m.f.Slerp(M,r,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},11038:(z,a,K)=>{"use strict";K.d(a,{d:()=>T});var v=K(10941);class T{constructor(z,a,K,T){this.k=new v.o(z,a,K),this.d=T}kj(){return[this.k.x,this.k.y,this.k.z,this.d]}clone(){return new T(this.k.x,this.k.y,this.k.z,this.d)}getClassName(){return"Plane"}getHashCode(){let z=this.k.getHashCode();return z=397*z^this.d,z}normalize(){const z=Math.sqrt(this.k.x*this.k.x+this.k.y*this.k.y+this.k.z*this.k.z);let a=0;return 0!==z&&(a=1/z),this.k.x*=a,this.k.y*=a,this.k.z*=a,this.d*=a,this}transform(z){const a=T._TmpMatrix;z.invertToRef(a);const K=a.m,v=this.k.x,m=this.k.y,p=this.k.z,j=this.d,s=v*K[0]+m*K[1]+p*K[2]+j*K[3],M=v*K[4]+m*K[5]+p*K[6]+j*K[7],r=v*K[8]+m*K[9]+p*K[10]+j*K[11],W=v*K[12]+m*K[13]+p*K[14]+j*K[15];return new T(s,M,r,W)}dotCoordinate(z){return this.k.x*z.x+this.k.y*z.y+this.k.z*z.z+this.d}copyFromPoints(z,a,K){const v=a.x-z.x,T=a.y-z.y,m=a.z-z.z,p=K.x-z.x,j=K.y-z.y,s=K.z-z.z,M=T*s-m*j,r=m*p-v*s,W=v*j-T*p,F=Math.sqrt(M*M+r*r+W*W);let G;return G=0!==F?1/F:0,this.k.x=M*G,this.k.y=r*G,this.k.z=W*G,this.d=-(this.k.x*z.x+this.k.y*z.y+this.k.z*z.z),this}isFrontFacingTo(z,a){return v.o.Dot(this.k,z)<=a}signedDistanceTo(z){return v.o.Dot(z,this.k)+this.d}static Jg(z){return new T(z[0],z[1],z[2],z[3])}static FromPoints(z,a,K){const v=new T(0,0,0,0);return v.copyFromPoints(z,a,K),v}static FromPositionAndNormal(z,a){const K=new T(0,0,0,0);return this.FromPositionAndNormalToRef(z,a,K)}static FromPositionAndNormalToRef(z,a,K){return K.k.p(a),K.k.normalize(),K.d=-z.dot(K.k),K}static SignedDistanceToPlaneFromPositionAndNormal(z,a,K){const T=-(a.x*z.x+a.y*z.y+a.z*z.z);return v.o.Dot(K,a)+T}}T._TmpMatrix=v.b.Identity()},10959:(z,a,K)=>{"use strict";function v(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(z-a)<=K}function T(z,a){return z===a?z:Math.random()*(a-z)+z}function m(z,a,K){return z+(a-z)*K}function p(z,a,K,v,T){const m=T*T,p=T*m;return z*(2*p-3*m+1)+K*(-2*p+3*m)+a*(p-2*m+T)+v*(p-m)}function j(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(K,Math.max(a,z))}function s(z){return z-=2*Math.PI*Math.floor((z+Math.PI)/(2*Math.PI))}function M(z){const a=z.toString(16);return z<=15?("0"+a).toUpperCase():a.toUpperCase()}function r(z){if(Math.log2)return Math.floor(Math.log2(z));if(z<0)return NaN;if(0===z)return-1/0;let a=0;if(z<1){for(;z<1;)a++,z*=2;a=-a}else if(z>1)for(;z>1;)a++,z=Math.floor(z/2);return a}function W(z,a){const K=z%a;return 0===K?a:W(a,K)}K.d(a,{e:()=>j,h:()=>p,k:()=>W,o:()=>r,q:()=>m,t:()=>s,v:()=>T,w:()=>M,y:()=>v})},11152:(z,a,K)=>{"use strict";K.d(a,{c:()=>v});class v{constructor(z,a){this.width=z,this.height=a}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let z=0|this.width;return z=397*z^this.height,z}p(z){this.width=z.width,this.height=z.height}Xd(z,a){return this.width=z,this.height=a,this}set(z,a){return this.Xd(z,a)}multiplyByFloats(z,a){return new v(this.width*z,this.height*a)}clone(){return new v(this.width,this.height)}equals(z){return!!z&&(this.width===z.width&&this.height===z.height)}get surface(){return this.width*this.height}static Zero(){return new v(0,0)}add(z){return new v(this.width+z.width,this.height+z.height)}sc(z){return new v(this.width-z.width,this.height-z.height)}scale(z){return new v(this.width*z,this.height*z)}static Lerp(z,a,K){const T=z.width+(a.width-z.width)*K,m=z.height+(a.height-z.height)*K;return new v(T,m)}}},10941:(z,a,K)=>{"use strict";K.d(a,{b:()=>l,f:()=>G,j:()=>c,m:()=>r,o:()=>W,r:()=>F});var v=K(10946),T=K(10951),m=K(10767),p=K(10743),j=K(10680),s=K(10959);const M=z=>parseInt(z.toString().replace(/\W/g,""));class r{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=z,this.y=a}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let z=M(this.x);return z=397*z^M(this.y),z}toArray(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return z[a]=this.x,z[a+1]=this.y,this}vc(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return r.FromArrayToRef(z,a,this),this}kj(){return[this.x,this.y]}p(z){return this.x=z.x,this.y=z.y,this}Xd(z,a){return this.x=z,this.y=a,this}set(z,a){return this.Xd(z,a)}Vd(z){return this.Xd(z,z)}add(z){return new r(this.x+z.x,this.y+z.y)}addToRef(z,a){return a.x=this.x+z.x,a.y=this.y+z.y,a}addInPlace(z){return this.x+=z.x,this.y+=z.y,this}addInPlaceFromFloats(z,a){return this.x+=z,this.y+=a,this}addVector3(z){return new r(this.x+z.x,this.y+z.y)}sc(z){return new r(this.x-z.x,this.y-z.y)}subtractToRef(z,a){return a.x=this.x-z.x,a.y=this.y-z.y,a}ri(z){return this.x-=z.x,this.y-=z.y,this}multiplyInPlace(z){return this.x*=z.x,this.y*=z.y,this}multiply(z){return new r(this.x*z.x,this.y*z.y)}multiplyToRef(z,a){return a.x=this.x*z.x,a.y=this.y*z.y,a}multiplyByFloats(z,a){return new r(this.x*z,this.y*a)}divide(z){return new r(this.x/z.x,this.y/z.y)}divideToRef(z,a){return a.x=this.x/z.x,a.y=this.y/z.y,a}divideInPlace(z){return this.x=this.x/z.x,this.y=this.y/z.y,this}minimizeInPlace(z){return this.minimizeInPlaceFromFloats(z.x,z.y)}maximizeInPlace(z){return this.maximizeInPlaceFromFloats(z.x,z.y)}minimizeInPlaceFromFloats(z,a){return this.x=Math.min(z,this.x),this.y=Math.min(a,this.y),this}maximizeInPlaceFromFloats(z,a){return this.x=Math.max(z,this.x),this.y=Math.max(a,this.y),this}subtractFromFloats(z,a){return new r(this.x-z,this.y-a)}subtractFromFloatsToRef(z,a,K){return K.x=this.x-z,K.y=this.y-a,K}negate(){return new r(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(z){return z.x=-this.x,z.y=-this.y,z}scaleInPlace(z){return this.x*=z,this.y*=z,this}scale(z){return new r(this.x*z,this.y*z)}scaleToRef(z,a){return a.x=this.x*z,a.y=this.y*z,a}scaleAndAddToRef(z,a){return a.x+=this.x*z,a.y+=this.y*z,a}equals(z){return z&&this.x===z.x&&this.y===z.y}equalsWithEpsilon(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.e;return z&&(0,s.y)(this.x,z.x,a)&&(0,s.y)(this.y,z.y,a)}equalsToFloats(z,a){return this.x===z&&this.y===a}floor(){return new r(Math.floor(this.x),Math.floor(this.y))}floorToRef(z){return z.x=Math.floor(this.x),z.y=Math.floor(this.y),z}fract(){return new r(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(z){return z.x=this.x-Math.floor(this.x),z.y=this.y-Math.floor(this.y),z}rotateToRef(z,a){const K=Math.cos(z),v=Math.sin(z),T=K*this.x-v*this.y,m=v*this.x+K*this.y;return a.x=T,a.y=m,a}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(z){return 0===z||1===z?this:this.scaleInPlace(1/z)}normalizeToNew(){const z=new r;return this.normalizeToRef(z),z}normalizeToRef(z){const a=this.length();return 0===a&&(z.x=this.x,z.y=this.y),this.scaleToRef(1/a,z)}clone(){return new r(this.x,this.y)}dot(z){return this.x*z.x+this.y*z.y}static Zero(){return new r(0,0)}static One(){return new r(1,1)}static Random(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new r((0,s.v)(z,a),(0,s.v)(z,a))}static RandomToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Xd((0,s.v)(z,a),(0,s.v)(z,a))}static get ZeroReadOnly(){return r._ZeroReadOnly}static Jg(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new r(z[a],z[a+1])}static FromArrayToRef(z,a,K){return K.x=z[a],K.y=z[a+1],K}static FromFloatsToRef(z,a,K){return K.Xd(z,a),K}static CatmullRom(z,a,K,v,T){const m=T*T,p=T*m,j=.5*(2*a.x+(-z.x+K.x)*T+(2*z.x-5*a.x+4*K.x-v.x)*m+(-z.x+3*a.x-3*K.x+v.x)*p),s=.5*(2*a.y+(-z.y+K.y)*T+(2*z.y-5*a.y+4*K.y-v.y)*m+(-z.y+3*a.y-3*K.y+v.y)*p);return new r(j,s)}static ClampToRef(z,a,K,v){return v.x=(0,s.e)(z.x,a.x,K.x),v.y=(0,s.e)(z.y,a.y,K.y),v}static Clamp(z,a,K){const v=(0,s.e)(z.x,a.x,K.x),T=(0,s.e)(z.y,a.y,K.y);return new r(v,T)}static Hermite(z,a,K,v,T){const m=T*T,p=T*m,j=2*p-3*m+1,s=-2*p+3*m,M=p-2*m+T,W=p-m,F=z.x*j+K.x*s+a.x*M+v.x*W,G=z.y*j+K.y*s+a.y*M+v.y*W;return new r(F,G)}static Hermite1stDerivative(z,a,K,v,T){return this.Hermite1stDerivativeToRef(z,a,K,v,T,new r)}static Hermite1stDerivativeToRef(z,a,K,v,T,m){const p=T*T;return m.x=6*(p-T)*z.x+(3*p-4*T+1)*a.x+6*(-p+T)*K.x+(3*p-2*T)*v.x,m.y=6*(p-T)*z.y+(3*p-4*T+1)*a.y+6*(-p+T)*K.y+(3*p-2*T)*v.y,m}static Lerp(z,a,K){return r.LerpToRef(z,a,K,new r)}static LerpToRef(z,a,K,v){return v.x=z.x+(a.x-z.x)*K,v.y=z.y+(a.y-z.y)*K,v}static Dot(z,a){return z.x*a.x+z.y*a.y}static Normalize(z){return r.NormalizeToRef(z,new r)}static NormalizeToRef(z,a){return z.normalizeToRef(a),a}static Minimize(z,a){const K=z.x<a.x?z.x:a.x,v=z.y<a.y?z.y:a.y;return new r(K,v)}static Maximize(z,a){const K=z.x>a.x?z.x:a.x,v=z.y>a.y?z.y:a.y;return new r(K,v)}static Transform(z,a){return r.TransformToRef(z,a,new r)}static TransformToRef(z,a,K){const v=a.m,T=z.x*v[0]+z.y*v[4]+v[12],m=z.x*v[1]+z.y*v[5]+v[13];return K.x=T,K.y=m,K}static PointInTriangle(z,a,K,v){const T=.5*(-K.y*v.x+a.y*(-K.x+v.x)+a.x*(K.y-v.y)+K.x*v.y),m=T<0?-1:1,p=(a.y*v.x-a.x*v.y+(v.y-a.y)*z.x+(a.x-v.x)*z.y)*m,j=(a.x*K.y-a.y*K.x+(a.y-K.y)*z.x+(K.x-a.x)*z.y)*m;return p>0&&j>0&&p+j<2*T*m}static Distance(z,a){return Math.sqrt(r.DistanceSquared(z,a))}static DistanceSquared(z,a){const K=z.x-a.x,v=z.y-a.y;return K*K+v*v}static Center(z,a){return r.CenterToRef(z,a,new r)}static CenterToRef(z,a,K){return K.Xd((z.x+a.x)/2,(z.y+a.y)/2)}static DistanceOfPointFromSegment(z,a,K){const v=r.DistanceSquared(a,K);if(0===v)return r.Distance(z,a);const T=K.sc(a),m=Math.max(0,Math.min(1,r.Dot(z.sc(a),T)/v)),p=a.add(T.multiplyByFloats(m,m));return r.Distance(z,p)}}r._ZeroReadOnly=r.Zero(),Object.defineProperties(r.prototype,{dimension:{value:[2]},rank:{value:1}});class W{get x(){return this._x}set x(z){this._x=z,this._isDirty=!0}get y(){return this._y}set y(z){this._y=z,this._isDirty=!0}get z(){return this._z}set z(z){this._z=z,this._isDirty=!0}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=z,this._y=a,this._z=K}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"gb"}getHashCode(){let z=M(this._x);return z=397*z^M(this._y),z=397*z^M(this._z),z}kj(){return[this._x,this._y,this._z]}toArray(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return z[a]=this._x,z[a+1]=this._y,z[a+2]=this._z,this}vc(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return W.FromArrayToRef(z,a,this),this}toQuaternion(){return G.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(z){return this._x+=z._x,this._y+=z._y,this._z+=z._z,this._isDirty=!0,this}addInPlaceFromFloats(z,a,K){return this._x+=z,this._y+=a,this._z+=K,this._isDirty=!0,this}add(z){return new W(this._x+z._x,this._y+z._y,this._z+z._z)}addToRef(z,a){return a._x=this._x+z._x,a._y=this._y+z._y,a._z=this._z+z._z,a._isDirty=!0,a}ri(z){return this._x-=z._x,this._y-=z._y,this._z-=z._z,this._isDirty=!0,this}sc(z){return new W(this._x-z._x,this._y-z._y,this._z-z._z)}subtractToRef(z,a){return this.subtractFromFloatsToRef(z._x,z._y,z._z,a)}subtractFromFloats(z,a,K){return new W(this._x-z,this._y-a,this._z-K)}subtractFromFloatsToRef(z,a,K,v){return v._x=this._x-z,v._y=this._y-a,v._z=this._z-K,v._isDirty=!0,v}negate(){return new W(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(z){return z._x=-1*this._x,z._y=-1*this._y,z._z=-1*this._z,z._isDirty=!0,z}scaleInPlace(z){return this._x*=z,this._y*=z,this._z*=z,this._isDirty=!0,this}scale(z){return new W(this._x*z,this._y*z,this._z*z)}scaleToRef(z,a){return a._x=this._x*z,a._y=this._y*z,a._z=this._z*z,a._isDirty=!0,a}getNormalToRef(z){const a=this.length();let K=Math.acos(this.y/a);const v=Math.atan2(this.z,this.x);K>Math.PI/2?K-=Math.PI/2:K+=Math.PI/2;const T=a*Math.sin(K)*Math.cos(v),m=a*Math.cos(K),p=a*Math.sin(K)*Math.sin(v);return z.set(T,m,p),z}applyRotationQuaternionToRef(z,a){const K=this._x,v=this._y,T=this._z,m=z._x,p=z._y,j=z._z,s=z._w,M=2*(p*T-j*v),r=2*(j*K-m*T),W=2*(m*v-p*K);return a._x=K+s*M+p*W-j*r,a._y=v+s*r+j*M-m*W,a._z=T+s*W+m*r-p*M,a._isDirty=!0,a}applyRotationQuaternionInPlace(z){return this.applyRotationQuaternionToRef(z,this)}applyRotationQuaternion(z){return this.applyRotationQuaternionToRef(z,new W)}scaleAndAddToRef(z,a){return a._x+=this._x*z,a._y+=this._y*z,a._z+=this._z*z,a._isDirty=!0,a}projectOnPlane(z,a){return this.projectOnPlaneToRef(z,a,new W)}projectOnPlaneToRef(z,a,K){const v=z.k,T=z.d,m=V.gb[0];this.subtractToRef(a,m),m.normalize();const p=W.Dot(m,v);if(Math.abs(p)<1e-10)K.Vd(1/0);else{const z=-(W.Dot(a,v)+T)/p,j=m.scaleInPlace(z);a.addToRef(j,K)}return K}equals(z){return z&&this._x===z._x&&this._y===z._y&&this._z===z._z}equalsWithEpsilon(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.e;return z&&(0,s.y)(this._x,z._x,a)&&(0,s.y)(this._y,z._y,a)&&(0,s.y)(this._z,z._z,a)}equalsToFloats(z,a,K){return this._x===z&&this._y===a&&this._z===K}multiplyInPlace(z){return this._x*=z._x,this._y*=z._y,this._z*=z._z,this._isDirty=!0,this}multiply(z){return this.multiplyByFloats(z._x,z._y,z._z)}multiplyToRef(z,a){return a._x=this._x*z._x,a._y=this._y*z._y,a._z=this._z*z._z,a._isDirty=!0,a}multiplyByFloats(z,a,K){return new W(this._x*z,this._y*a,this._z*K)}divide(z){return new W(this._x/z._x,this._y/z._y,this._z/z._z)}divideToRef(z,a){return a._x=this._x/z._x,a._y=this._y/z._y,a._z=this._z/z._z,a._isDirty=!0,a}divideInPlace(z){return this._x=this._x/z._x,this._y=this._y/z._y,this._z=this._z/z._z,this._isDirty=!0,this}minimizeInPlace(z){return this.minimizeInPlaceFromFloats(z._x,z._y,z._z)}maximizeInPlace(z){return this.maximizeInPlaceFromFloats(z._x,z._y,z._z)}minimizeInPlaceFromFloats(z,a,K){return z<this._x&&(this.x=z),a<this._y&&(this.y=a),K<this._z&&(this.z=K),this}maximizeInPlaceFromFloats(z,a,K){return z>this._x&&(this.x=z),a>this._y&&(this.y=a),K>this._z&&(this.z=K),this}isNonUniformWithinEpsilon(z){const a=Math.abs(this._x),K=Math.abs(this._y);if(!(0,s.y)(a,K,z))return!0;const v=Math.abs(this._z);return!(0,s.y)(a,v,z)||!(0,s.y)(K,v,z)}get isNonUniform(){const z=Math.abs(this._x);if(z!==Math.abs(this._y))return!0;return z!==Math.abs(this._z)}floorToRef(z){return z._x=Math.floor(this._x),z._y=Math.floor(this._y),z._z=Math.floor(this._z),z._isDirty=!0,z}floor(){return new W(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(z){return z._x=this.x-Math.floor(this._x),z._y=this.y-Math.floor(this._y),z._z=this.z-Math.floor(this._z),z._isDirty=!0,z}fract(){return new W(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(z){if("xyz"===(z=z.toLowerCase()))return this;const a=V.gb[0].p(this);return this.x=a[z[0]],this.y=a[z[1]],this.z=a[z[2]],this}rotateByQuaternionToRef(z,a){return z.toRotationMatrix(V.Matrix[0]),W.TransformCoordinatesToRef(this,V.Matrix[0],a),a}rotateByQuaternionAroundPointToRef(z,a,K){return this.subtractToRef(a,V.gb[0]),V.gb[0].rotateByQuaternionToRef(z,V.gb[0]),a.addToRef(V.gb[0],K),K}cross(z){return W.CrossToRef(this,z,new W)}normalizeFromLength(z){return 0===z||1===z?this:this.scaleInPlace(1/z)}normalizeToNew(){return this.normalizeToRef(new W)}normalizeToRef(z){const a=this.length();return 0===a||1===a?(z._x=this._x,z._y=this._y,z._z=this._z,z._isDirty=!0,z):this.scaleToRef(1/a,z)}clone(){return new W(this._x,this._y,this._z)}p(z){return this.Xd(z._x,z._y,z._z)}Xd(z,a,K){return this._x=z,this._y=a,this._z=K,this._isDirty=!0,this}set(z,a,K){return this.Xd(z,a,K)}Vd(z){return this._x=this._y=this._z=z,this._isDirty=!0,this}static GetClipFactor(z,a,K,v){const T=W.Dot(z,K);return(T-v)/(T-W.Dot(a,K))}static GetAngleBetweenVectors(z,a,K){const v=z.normalizeToRef(V.gb[1]),T=a.normalizeToRef(V.gb[2]);let m=W.Dot(v,T);m=(0,s.e)(m,-1,1);const p=Math.acos(m),j=V.gb[3];return W.CrossToRef(v,T,j),W.Dot(j,K)>0?isNaN(p)?0:p:isNaN(p)?-Math.PI:-Math.acos(m)}static GetAngleBetweenVectorsOnPlane(z,a,K){V.gb[0].p(z);const v=V.gb[0];V.gb[1].p(a);const T=V.gb[1];V.gb[2].p(K);const m=V.gb[2],p=V.gb[3],j=V.gb[4];v.normalize(),T.normalize(),m.normalize(),W.CrossToRef(m,v,p),W.CrossToRef(p,m,j);const M=Math.atan2(W.Dot(T,p),W.Dot(T,j));return(0,s.t)(M)}static PitchYawRollToMoveBetweenPointsToRef(z,a,K){const v=c.gb[0];return a.subtractToRef(z,v),K._y=Math.atan2(v.x,v.z)||0,K._x=Math.atan2(Math.sqrt(v.x**2+v.z**2),v.y)||0,K._z=0,K._isDirty=!0,K}static PitchYawRollToMoveBetweenPoints(z,a){const K=W.Zero();return W.PitchYawRollToMoveBetweenPointsToRef(z,a,K)}static SlerpToRef(z,a,K,T){K=(0,s.e)(K,0,1);const m=V.gb[0],p=V.gb[1];m.p(z);const j=m.length();m.normalizeFromLength(j),p.p(a);const M=p.length();p.normalizeFromLength(M);const r=W.Dot(m,p);let F,G;if(r<1-v.e){const z=Math.acos(r),a=1/Math.sin(z);F=Math.sin((1-K)*z)*a,G=Math.sin(K*z)*a}else F=1-K,G=K;return m.scaleInPlace(F),p.scaleInPlace(G),T.p(m).addInPlace(p),T.scaleInPlace((0,s.q)(j,M,K)),T}static SmoothToRef(z,a,K,v,T){return W.SlerpToRef(z,a,0===v?1:K/v,T),T}static Jg(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new W(z[a],z[a+1],z[a+2])}static FromFloatArray(z,a){return W.Jg(z,a)}static FromArrayToRef(z,a,K){return K._x=z[a],K._y=z[a+1],K._z=z[a+2],K._isDirty=!0,K}static FromFloatArrayToRef(z,a,K){return W.FromArrayToRef(z,a,K)}static FromFloatsToRef(z,a,K,v){return v.Xd(z,a,K),v}static Zero(){return new W(0,0,0)}static One(){return new W(1,1,1)}static Up(){return new W(0,1,0)}static get UpReadOnly(){return W._UpReadOnly}static get DownReadOnly(){return W._DownReadOnly}static get RightReadOnly(){return W._RightReadOnly}static get LeftReadOnly(){return W._LeftReadOnly}static get LeftHandedForwardReadOnly(){return W._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return W._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return W._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return W._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return W._ZeroReadOnly}static get OneReadOnly(){return W._OneReadOnly}static Down(){return new W(0,-1,0)}static Forward(){return new W(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new W(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new W(1,0,0)}static Left(){return new W(-1,0,0)}static Random(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new W((0,s.v)(z,a),(0,s.v)(z,a),(0,s.v)(z,a))}static RandomToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Xd((0,s.v)(z,a),(0,s.v)(z,a),(0,s.v)(z,a))}static TransformCoordinates(z,a){const K=W.Zero();return W.TransformCoordinatesToRef(z,a,K),K}static TransformCoordinatesToRef(z,a,K){return W.TransformCoordinatesFromFloatsToRef(z._x,z._y,z._z,a,K),K}static TransformCoordinatesFromFloatsToRef(z,a,K,v,T){const m=v.m,p=z*m[0]+a*m[4]+K*m[8]+m[12],j=z*m[1]+a*m[5]+K*m[9]+m[13],s=z*m[2]+a*m[6]+K*m[10]+m[14],M=1/(z*m[3]+a*m[7]+K*m[11]+m[15]);return T._x=p*M,T._y=j*M,T._z=s*M,T._isDirty=!0,T}static TransformNormal(z,a){const K=W.Zero();return W.TransformNormalToRef(z,a,K),K}static TransformNormalToRef(z,a,K){return this.TransformNormalFromFloatsToRef(z._x,z._y,z._z,a,K),K}static TransformNormalFromFloatsToRef(z,a,K,v,T){const m=v.m;return T._x=z*m[0]+a*m[4]+K*m[8],T._y=z*m[1]+a*m[5]+K*m[9],T._z=z*m[2]+a*m[6]+K*m[10],T._isDirty=!0,T}static CatmullRom(z,a,K,v,T){const m=T*T,p=T*m,j=.5*(2*a._x+(-z._x+K._x)*T+(2*z._x-5*a._x+4*K._x-v._x)*m+(-z._x+3*a._x-3*K._x+v._x)*p),s=.5*(2*a._y+(-z._y+K._y)*T+(2*z._y-5*a._y+4*K._y-v._y)*m+(-z._y+3*a._y-3*K._y+v._y)*p),M=.5*(2*a._z+(-z._z+K._z)*T+(2*z._z-5*a._z+4*K._z-v._z)*m+(-z._z+3*a._z-3*K._z+v._z)*p);return new W(j,s,M)}static Clamp(z,a,K){const v=new W;return W.ClampToRef(z,a,K,v),v}static ClampToRef(z,a,K,v){let T=z._x;T=T>K._x?K._x:T,T=T<a._x?a._x:T;let m=z._y;m=m>K._y?K._y:m,m=m<a._y?a._y:m;let p=z._z;return p=p>K._z?K._z:p,p=p<a._z?a._z:p,v.Xd(T,m,p),v}static CheckExtends(z,a,K){a.minimizeInPlace(z),K.maximizeInPlace(z)}static Hermite(z,a,K,v,T){const m=T*T,p=T*m,j=2*p-3*m+1,s=-2*p+3*m,M=p-2*m+T,r=p-m,F=z._x*j+K._x*s+a._x*M+v._x*r,G=z._y*j+K._y*s+a._y*M+v._y*r,l=z._z*j+K._z*s+a._z*M+v._z*r;return new W(F,G,l)}static Hermite1stDerivative(z,a,K,v,T){const m=new W;return this.Hermite1stDerivativeToRef(z,a,K,v,T,m),m}static Hermite1stDerivativeToRef(z,a,K,v,T,m){const p=T*T;return m._x=6*(p-T)*z._x+(3*p-4*T+1)*a._x+6*(-p+T)*K._x+(3*p-2*T)*v._x,m._y=6*(p-T)*z._y+(3*p-4*T+1)*a._y+6*(-p+T)*K._y+(3*p-2*T)*v._y,m._z=6*(p-T)*z._z+(3*p-4*T+1)*a._z+6*(-p+T)*K._z+(3*p-2*T)*v._z,m._isDirty=!0,m}static Lerp(z,a,K){const v=new W(0,0,0);return W.LerpToRef(z,a,K,v),v}static LerpToRef(z,a,K,v){return v._x=z._x+(a._x-z._x)*K,v._y=z._y+(a._y-z._y)*K,v._z=z._z+(a._z-z._z)*K,v._isDirty=!0,v}static Dot(z,a){return z._x*a._x+z._y*a._y+z._z*a._z}dot(z){return this._x*z._x+this._y*z._y+this._z*z._z}static Cross(z,a){const K=new W;return W.CrossToRef(z,a,K),K}static CrossToRef(z,a,K){const v=z._y*a._z-z._z*a._y,T=z._z*a._x-z._x*a._z,m=z._x*a._y-z._y*a._x;return K.Xd(v,T,m),K}static Normalize(z){const a=W.Zero();return W.NormalizeToRef(z,a),a}static NormalizeToRef(z,a){return z.normalizeToRef(a),a}static Project(z,a,K,v){const T=new W;return W.ProjectToRef(z,a,K,v,T),T}static ProjectToRef(z,a,K,v,T){var m;const p=v.width,s=v.height,M=v.x,r=v.y,F=V.Matrix[1],G=null===(m=j.b.LastCreatedEngine)||void 0===m?void 0:m.isNDCHalfZRange,c=G?1:.5,C=G?0:.5;l.FromValuesToRef(p/2,0,0,0,0,-s/2,0,0,0,0,c,0,M+p/2,s/2+r,C,1,F);const w=V.Matrix[0];return a.multiplyToRef(K,w),w.multiplyToRef(F,w),W.TransformCoordinatesToRef(z,w,T),T}static Reflect(z,a){return this.ReflectToRef(z,a,new W)}static ReflectToRef(z,a,K){const v=c.gb[0];return v.p(a).scaleInPlace(2*W.Dot(z,a)),K.p(z).ri(v)}static _UnprojectFromInvertedMatrixToRef(z,a,K){W.TransformCoordinatesToRef(z,a,K);const v=a.m,T=z._x*v[3]+z._y*v[7]+z._z*v[11]+v[15];return(0,s.y)(T,1)&&K.scaleInPlace(1/T),K}static UnprojectFromTransform(z,a,K,v,T){return this.Unproject(z,a,K,v,T,l.IdentityReadOnly)}static Unproject(z,a,K,v,T,m){const p=new W;return W.UnprojectToRef(z,a,K,v,T,m,p),p}static UnprojectToRef(z,a,K,v,T,m,p){return W.UnprojectFloatsToRef(z._x,z._y,z._z,a,K,v,T,m,p),p}static UnprojectFloatsToRef(z,a,K,v,T,m,p,s,M){var r;const F=V.Matrix[0];m.multiplyToRef(p,F),F.multiplyToRef(s,F),F.invert();const G=V.gb[0];return G.x=z/v*2-1,G.y=-(a/T*2-1),null!==(r=j.b.LastCreatedEngine)&&void 0!==r&&r.isNDCHalfZRange?G.z=K:G.z=2*K-1,W._UnprojectFromInvertedMatrixToRef(G,F,M),M}static Minimize(z,a){const K=new W;return K.p(z),K.minimizeInPlace(a),K}static Maximize(z,a){const K=new W;return K.p(z),K.maximizeInPlace(a),K}static Distance(z,a){return Math.sqrt(W.DistanceSquared(z,a))}static DistanceSquared(z,a){const K=z._x-a._x,v=z._y-a._y,T=z._z-a._z;return K*K+v*v+T*T}static ProjectOnTriangleToRef(z,a,K,T,m){const p=V.gb[0],j=V.gb[1],M=V.gb[2],r=V.gb[3],F=V.gb[4];K.subtractToRef(a,p),T.subtractToRef(a,j),T.subtractToRef(K,M);const G=p.length(),l=j.length(),c=M.length();if(G<v.e||l<v.e||c<v.e)return m.p(a),W.Distance(z,a);z.subtractToRef(a,F),W.CrossToRef(p,j,r);const C=r.length();if(C<v.e)return m.p(a),W.Distance(z,a);r.normalizeFromLength(C);let w=F.length();if(w<v.e)return m.p(a),0;F.normalizeFromLength(w);const H=W.Dot(r,F),f=V.gb[5],Y=V.gb[6];f.p(r).scaleInPlace(-w*H),Y.p(z).addInPlace(f);const I=V.gb[4],q=V.gb[5],B=V.gb[7],x=V.gb[8];I.p(p).scaleInPlace(1/G),x.p(j).scaleInPlace(1/l),I.addInPlace(x).scaleInPlace(-1),q.p(p).scaleInPlace(-1/G),x.p(M).scaleInPlace(1/c),q.addInPlace(x).scaleInPlace(-1),B.p(M).scaleInPlace(-1/c),x.p(j).scaleInPlace(-1/l),B.addInPlace(x).scaleInPlace(-1);const Z=V.gb[9];let y;Z.p(Y).ri(a),W.CrossToRef(I,Z,x),y=W.Dot(x,r);const i=y;Z.p(Y).ri(K),W.CrossToRef(q,Z,x),y=W.Dot(x,r);const n=y;Z.p(Y).ri(T),W.CrossToRef(B,Z,x),y=W.Dot(x,r);const X=y,P=V.gb[10];let J,o;i>0&&n<0?(P.p(p),J=a,o=K):n>0&&X<0?(P.p(M),J=K,o=T):(P.p(j).scaleInPlace(-1),J=T,o=a);const N=V.gb[9],A=V.gb[4];J.subtractToRef(Y,x),o.subtractToRef(Y,N),W.CrossToRef(x,N,A);if(!(W.Dot(A,r)<0))return m.p(Y),Math.abs(w*H);const g=V.gb[5];W.CrossToRef(P,A,g),g.normalize();const d=V.gb[9];d.p(J).ri(Y);const t=d.length();if(t<v.e)return m.p(J),W.Distance(z,J);d.normalizeFromLength(t);const e=W.Dot(g,d),L=V.gb[7];L.p(Y).addInPlace(g.scaleInPlace(t*e)),x.p(L).ri(J),w=P.length(),P.normalizeFromLength(w);let E=W.Dot(x,P)/Math.max(w,v.e);return E=(0,s.e)(E,0,1),L.p(J).addInPlace(P.scaleInPlace(E*w)),m.p(L),W.Distance(z,L)}static Center(z,a){return W.CenterToRef(z,a,W.Zero())}static CenterToRef(z,a,K){return K.Xd((z._x+a._x)/2,(z._y+a._y)/2,(z._z+a._z)/2)}static RotationFromAxis(z,a,K){const v=new W;return W.RotationFromAxisToRef(z,a,K,v),v}static RotationFromAxisToRef(z,a,K,v){const T=V.Quaternion[0];return G.RotationQuaternionFromAxisToRef(z,a,K,T),T.toEulerAnglesToRef(v),v}}W._UpReadOnly=W.Up(),W._DownReadOnly=W.Down(),W._LeftHandedForwardReadOnly=W.Forward(!1),W._RightHandedForwardReadOnly=W.Forward(!0),W._LeftHandedBackwardReadOnly=W.Backward(!1),W._RightHandedBackwardReadOnly=W.Backward(!0),W._RightReadOnly=W.Right(),W._LeftReadOnly=W.Left(),W._ZeroReadOnly=W.Zero(),W._OneReadOnly=W.One(),Object.defineProperties(W.prototype,{dimension:{value:[3]},rank:{value:1}});class F{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=z,this.y=a,this.z=K,this.w=v}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let z=M(this.x);return z=397*z^M(this.y),z=397*z^M(this.z),z=397*z^M(this.w),z}kj(){return[this.x,this.y,this.z,this.w]}toArray(z,a){return void 0===a&&(a=0),z[a]=this.x,z[a+1]=this.y,z[a+2]=this.z,z[a+3]=this.w,this}vc(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return F.FromArrayToRef(z,a,this),this}addInPlace(z){return this.x+=z.x,this.y+=z.y,this.z+=z.z,this.w+=z.w,this}addInPlaceFromFloats(z,a,K,v){return this.x+=z,this.y+=a,this.z+=K,this.w+=v,this}add(z){return new F(this.x+z.x,this.y+z.y,this.z+z.z,this.w+z.w)}addToRef(z,a){return a.x=this.x+z.x,a.y=this.y+z.y,a.z=this.z+z.z,a.w=this.w+z.w,a}ri(z){return this.x-=z.x,this.y-=z.y,this.z-=z.z,this.w-=z.w,this}sc(z){return new F(this.x-z.x,this.y-z.y,this.z-z.z,this.w-z.w)}subtractToRef(z,a){return a.x=this.x-z.x,a.y=this.y-z.y,a.z=this.z-z.z,a.w=this.w-z.w,a}subtractFromFloats(z,a,K,v){return new F(this.x-z,this.y-a,this.z-K,this.w-v)}subtractFromFloatsToRef(z,a,K,v,T){return T.x=this.x-z,T.y=this.y-a,T.z=this.z-K,T.w=this.w-v,T}negate(){return new F(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(z){return z.x=-this.x,z.y=-this.y,z.z=-this.z,z.w=-this.w,z}scaleInPlace(z){return this.x*=z,this.y*=z,this.z*=z,this.w*=z,this}scale(z){return new F(this.x*z,this.y*z,this.z*z,this.w*z)}scaleToRef(z,a){return a.x=this.x*z,a.y=this.y*z,a.z=this.z*z,a.w=this.w*z,a}scaleAndAddToRef(z,a){return a.x+=this.x*z,a.y+=this.y*z,a.z+=this.z*z,a.w+=this.w*z,a}equals(z){return z&&this.x===z.x&&this.y===z.y&&this.z===z.z&&this.w===z.w}equalsWithEpsilon(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.e;return z&&(0,s.y)(this.x,z.x,a)&&(0,s.y)(this.y,z.y,a)&&(0,s.y)(this.z,z.z,a)&&(0,s.y)(this.w,z.w,a)}equalsToFloats(z,a,K,v){return this.x===z&&this.y===a&&this.z===K&&this.w===v}multiplyInPlace(z){return this.x*=z.x,this.y*=z.y,this.z*=z.z,this.w*=z.w,this}multiply(z){return new F(this.x*z.x,this.y*z.y,this.z*z.z,this.w*z.w)}multiplyToRef(z,a){return a.x=this.x*z.x,a.y=this.y*z.y,a.z=this.z*z.z,a.w=this.w*z.w,a}multiplyByFloats(z,a,K,v){return new F(this.x*z,this.y*a,this.z*K,this.w*v)}divide(z){return new F(this.x/z.x,this.y/z.y,this.z/z.z,this.w/z.w)}divideToRef(z,a){return a.x=this.x/z.x,a.y=this.y/z.y,a.z=this.z/z.z,a.w=this.w/z.w,a}divideInPlace(z){return this.divideToRef(z,this)}minimizeInPlace(z){return z.x<this.x&&(this.x=z.x),z.y<this.y&&(this.y=z.y),z.z<this.z&&(this.z=z.z),z.w<this.w&&(this.w=z.w),this}maximizeInPlace(z){return z.x>this.x&&(this.x=z.x),z.y>this.y&&(this.y=z.y),z.z>this.z&&(this.z=z.z),z.w>this.w&&(this.w=z.w),this}minimizeInPlaceFromFloats(z,a,K,v){return this.x=Math.min(z,this.x),this.y=Math.min(a,this.y),this.z=Math.min(K,this.z),this.w=Math.min(v,this.w),this}maximizeInPlaceFromFloats(z,a,K,v){return this.x=Math.max(z,this.x),this.y=Math.max(a,this.y),this.z=Math.max(K,this.z),this.w=Math.max(v,this.w),this}floorToRef(z){return z.x=Math.floor(this.x),z.y=Math.floor(this.y),z.z=Math.floor(this.z),z.w=Math.floor(this.w),z}floor(){return new F(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(z){return z.x=this.x-Math.floor(this.x),z.y=this.y-Math.floor(this.y),z.z=this.z-Math.floor(this.z),z.w=this.w-Math.floor(this.w),z}fract(){return new F(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(z){return 0===z||1===z?this:this.scaleInPlace(1/z)}normalizeToNew(){return this.normalizeToRef(new F)}normalizeToRef(z){const a=this.length();return 0===a||1===a?(z.x=this.x,z.y=this.y,z.z=this.z,z.w=this.w,z):this.scaleToRef(1/a,z)}toVector3(){return new W(this.x,this.y,this.z)}clone(){return new F(this.x,this.y,this.z,this.w)}p(z){return this.x=z.x,this.y=z.y,this.z=z.z,this.w=z.w,this}Xd(z,a,K,v){return this.x=z,this.y=a,this.z=K,this.w=v,this}set(z,a,K,v){return this.Xd(z,a,K,v)}Vd(z){return this.x=this.y=this.z=this.w=z,this}dot(z){return this.x*z.x+this.y*z.y+this.z*z.z+this.w*z.w}static Jg(z,a){return a||(a=0),new F(z[a],z[a+1],z[a+2],z[a+3])}static FromArrayToRef(z,a,K){return K.x=z[a],K.y=z[a+1],K.z=z[a+2],K.w=z[a+3],K}static FromFloatArrayToRef(z,a,K){return F.FromArrayToRef(z,a,K),K}static FromFloatsToRef(z,a,K,v,T){return T.x=z,T.y=a,T.z=K,T.w=v,T}static Zero(){return new F(0,0,0,0)}static One(){return new F(1,1,1,1)}static Random(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new F((0,s.v)(z,a),(0,s.v)(z,a),(0,s.v)(z,a),(0,s.v)(z,a))}static RandomToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2?arguments[2]:void 0;return K.x=(0,s.v)(z,a),K.y=(0,s.v)(z,a),K.z=(0,s.v)(z,a),K.w=(0,s.v)(z,a),K}static Clamp(z,a,K){return F.ClampToRef(z,a,K,new F)}static ClampToRef(z,a,K,v){return v.x=(0,s.e)(z.x,a.x,K.x),v.y=(0,s.e)(z.y,a.y,K.y),v.z=(0,s.e)(z.z,a.z,K.z),v.w=(0,s.e)(z.w,a.w,K.w),v}static CheckExtends(z,a,K){a.minimizeInPlace(z),K.maximizeInPlace(z)}static get ZeroReadOnly(){return F._ZeroReadOnly}static Normalize(z){return F.NormalizeToRef(z,new F)}static NormalizeToRef(z,a){return z.normalizeToRef(a),a}static Minimize(z,a){const K=new F;return K.p(z),K.minimizeInPlace(a),K}static Maximize(z,a){const K=new F;return K.p(z),K.maximizeInPlace(a),K}static Distance(z,a){return Math.sqrt(F.DistanceSquared(z,a))}static DistanceSquared(z,a){const K=z.x-a.x,v=z.y-a.y,T=z.z-a.z,m=z.w-a.w;return K*K+v*v+T*T+m*m}static Center(z,a){return F.CenterToRef(z,a,new F)}static CenterToRef(z,a,K){return K.x=(z.x+a.x)/2,K.y=(z.y+a.y)/2,K.z=(z.z+a.z)/2,K.w=(z.w+a.w)/2,K}static TransformCoordinates(z,a){return F.TransformCoordinatesToRef(z,a,new F)}static TransformCoordinatesToRef(z,a,K){return F.TransformCoordinatesFromFloatsToRef(z._x,z._y,z._z,a,K),K}static TransformCoordinatesFromFloatsToRef(z,a,K,v,T){const m=v.m,p=z*m[0]+a*m[4]+K*m[8]+m[12],j=z*m[1]+a*m[5]+K*m[9]+m[13],s=z*m[2]+a*m[6]+K*m[10]+m[14],M=z*m[3]+a*m[7]+K*m[11]+m[15];return T.x=p,T.y=j,T.z=s,T.w=M,T}static TransformNormal(z,a){return F.TransformNormalToRef(z,a,new F)}static TransformNormalToRef(z,a,K){const v=a.m,T=z.x*v[0]+z.y*v[4]+z.z*v[8],m=z.x*v[1]+z.y*v[5]+z.z*v[9],p=z.x*v[2]+z.y*v[6]+z.z*v[10];return K.x=T,K.y=m,K.z=p,K.w=z.w,K}static TransformNormalFromFloatsToRef(z,a,K,v,T,m){const p=T.m;return m.x=z*p[0]+a*p[4]+K*p[8],m.y=z*p[1]+a*p[5]+K*p[9],m.z=z*p[2]+a*p[6]+K*p[10],m.w=v,m}static FromVector3(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new F(z._x,z._y,z._z,a)}static Dot(z,a){return z.x*a.x+z.y*a.y+z.z*a.z+z.w*a.w}}F._ZeroReadOnly=F.Zero(),Object.defineProperties(F.prototype,{dimension:{value:[4]},rank:{value:1}});class G{get x(){return this._x}set x(z){this._x=z,this._isDirty=!0}get y(){return this._y}set y(z){this._y=z,this._isDirty=!0}get z(){return this._z}set z(z){this._z=z,this._isDirty=!0}get w(){return this._w}set w(z){this._w=z,this._isDirty=!0}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=z,this._y=a,this._z=K,this._w=v}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let z=M(this._x);return z=397*z^M(this._y),z=397*z^M(this._z),z=397*z^M(this._w),z}kj(){return[this._x,this._y,this._z,this._w]}toArray(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return z[a]=this._x,z[a+1]=this._y,z[a+2]=this._z,z[a+3]=this._w,this}vc(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return G.FromArrayToRef(z,a,this)}equals(z){return z&&this._x===z._x&&this._y===z._y&&this._z===z._z&&this._w===z._w}equalsWithEpsilon(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.e;return z&&(0,s.y)(this._x,z._x,a)&&(0,s.y)(this._y,z._y,a)&&(0,s.y)(this._z,z._z,a)&&(0,s.y)(this._w,z._w,a)}clone(){return new G(this._x,this._y,this._z,this._w)}p(z){return this._x=z._x,this._y=z._y,this._z=z._z,this._w=z._w,this._isDirty=!0,this}Xd(z,a,K,v){return this._x=z,this._y=a,this._z=K,this._w=v,this._isDirty=!0,this}set(z,a,K,v){return this.Xd(z,a,K,v)}Vd(z){return this.Xd(z,z,z,z)}add(z){return new G(this._x+z._x,this._y+z._y,this._z+z._z,this._w+z._w)}addInPlace(z){return this._x+=z._x,this._y+=z._y,this._z+=z._z,this._w+=z._w,this._isDirty=!0,this}addToRef(z,a){return a._x=this._x+z._x,a._y=this._y+z._y,a._z=this._z+z._z,a._w=this._w+z._w,a._isDirty=!0,a}addInPlaceFromFloats(z,a,K,v){return this._x+=z,this._y+=a,this._z+=K,this._w+=v,this._isDirty=!0,this}subtractToRef(z,a){return a._x=this._x-z._x,a._y=this._y-z._y,a._z=this._z-z._z,a._w=this._w-z._w,a._isDirty=!0,a}subtractFromFloats(z,a,K,v){return this.subtractFromFloatsToRef(z,a,K,v,new G)}subtractFromFloatsToRef(z,a,K,v,T){return T._x=this._x-z,T._y=this._y-a,T._z=this._z-K,T._w=this._w-v,T._isDirty=!0,T}sc(z){return new G(this._x-z._x,this._y-z._y,this._z-z._z,this._w-z._w)}ri(z){return this._x-=z._x,this._y-=z._y,this._z-=z._z,this._w-=z._w,this._isDirty=!0,this}scale(z){return new G(this._x*z,this._y*z,this._z*z,this._w*z)}scaleToRef(z,a){return a._x=this._x*z,a._y=this._y*z,a._z=this._z*z,a._w=this._w*z,a._isDirty=!0,a}scaleInPlace(z){return this._x*=z,this._y*=z,this._z*=z,this._w*=z,this._isDirty=!0,this}scaleAndAddToRef(z,a){return a._x+=this._x*z,a._y+=this._y*z,a._z+=this._z*z,a._w+=this._w*z,a._isDirty=!0,a}multiply(z){const a=new G(0,0,0,1);return this.multiplyToRef(z,a),a}multiplyToRef(z,a){const K=this._x*z._w+this._y*z._z-this._z*z._y+this._w*z._x,v=-this._x*z._z+this._y*z._w+this._z*z._x+this._w*z._y,T=this._x*z._y-this._y*z._x+this._z*z._w+this._w*z._z,m=-this._x*z._x-this._y*z._y-this._z*z._z+this._w*z._w;return a.Xd(K,v,T,m),a}multiplyInPlace(z){return this.multiplyToRef(z,this)}multiplyByFloats(z,a,K,v){return this._x*=z,this._y*=a,this._z*=K,this._w*=v,this._isDirty=!0,this}divide(z){throw new ReferenceError("Can not divide a quaternion")}divideToRef(z,a){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(z){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new G)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(z){return z._x=-this._x,z._y=-this._y,z._z=-this._z,z._w=-this._w,z._isDirty=!0,z}equalsToFloats(z,a,K,v){return this._x===z&&this._y===a&&this._z===K&&this._w===v}floorToRef(z){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(z){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(z){return z.Xd(-this._x,-this._y,-this._z,this._w),z}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new G(-this._x,-this._y,-this._z,this._w)}invert(){const z=this.conjugate(),a=this.lengthSquared();return 0==a||1==a||z.scaleInPlace(1/a),z}invertInPlace(){this.conjugateInPlace();const z=this.lengthSquared();return 0==z||1==z||this.scaleInPlace(1/z),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(z){return 0===z||1===z?this:this.scaleInPlace(1/z)}normalizeToNew(){const z=new G(0,0,0,1);return this.normalizeToRef(z),z}normalizeToRef(z){const a=this.length();return 0===a||1===a?z.Xd(this._x,this._y,this._z,this._w):this.scaleToRef(1/a,z)}toEulerAngles(){const z=W.Zero();return this.toEulerAnglesToRef(z),z}toEulerAnglesToRef(z){const a=this._z,K=this._x,v=this._y,T=this._w,m=v*a-K*T,p=.4999999;if(m<-p)z._y=2*Math.atan2(v,T),z._x=Math.PI/2,z._z=0,z._isDirty=!0;else if(m>p)z._y=2*Math.atan2(v,T),z._x=-Math.PI/2,z._z=0,z._isDirty=!0;else{const p=T*T,j=a*a,s=K*K,M=v*v;z._z=Math.atan2(2*(K*v+a*T),-j-s+M+p),z._x=Math.asin(-2*m),z._y=Math.atan2(2*(a*K+v*T),j-s-M+p),z._isDirty=!0}return z}toAlphaBetaGammaToRef(z){const a=this._z,K=this._x,v=this._y,T=this._w,m=Math.sqrt(K*K+v*v),p=Math.sqrt(a*a+T*T),j=2*Math.atan2(m,p),s=2*Math.atan2(a,T),M=2*Math.atan2(v,K),r=(s+M)/2,W=(s-M)/2;return z.set(W,j,r),z}toRotationMatrix(z){return l.FromQuaternionToRef(this,z),z}fromRotationMatrix(z){return G.FromRotationMatrixToRef(z,this),this}dot(z){return this._x*z._x+this._y*z._y+this._z*z._z+this._w*z._w}static FromRotationMatrix(z){const a=new G;return G.FromRotationMatrixToRef(z,a),a}static FromRotationMatrixToRef(z,a){const K=z.m,v=K[0],T=K[4],m=K[8],p=K[1],j=K[5],s=K[9],M=K[2],r=K[6],W=K[10],F=v+j+W;let G;return F>0?(G=.5/Math.sqrt(F+1),a._w=.25/G,a._x=(r-s)*G,a._y=(m-M)*G,a._z=(p-T)*G,a._isDirty=!0):v>j&&v>W?(G=2*Math.sqrt(1+v-j-W),a._w=(r-s)/G,a._x=.25*G,a._y=(T+p)/G,a._z=(m+M)/G,a._isDirty=!0):j>W?(G=2*Math.sqrt(1+j-v-W),a._w=(m-M)/G,a._x=(T+p)/G,a._y=.25*G,a._z=(s+r)/G,a._isDirty=!0):(G=2*Math.sqrt(1+W-v-j),a._w=(p-T)/G,a._x=(m+M)/G,a._y=(s+r)/G,a._z=.25*G,a._isDirty=!0),a}static Dot(z,a){return z._x*a._x+z._y*a._y+z._z*a._z+z._w*a._w}static AreClose(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const v=G.Dot(z,a);return 1-v*v<=K}static SmoothToRef(z,a,K,v,T){let m=0===v?1:K/v;return m=(0,s.e)(m,0,1),G.SlerpToRef(z,a,m,T),T}static Zero(){return new G(0,0,0,0)}static Inverse(z){return new G(-z._x,-z._y,-z._z,z._w)}static InverseToRef(z,a){return a.set(-z._x,-z._y,-z._z,z._w),a}static Identity(){return new G(0,0,0,1)}static IsIdentity(z){return z&&0===z._x&&0===z._y&&0===z._z&&1===z._w}static RotationAxis(z,a){return G.RotationAxisToRef(z,a,new G)}static RotationAxisToRef(z,a,K){K._w=Math.cos(a/2);const v=Math.sin(a/2)/z.length();return K._x=z._x*v,K._y=z._y*v,K._z=z._z*v,K._isDirty=!0,K}static Jg(z,a){return a||(a=0),new G(z[a],z[a+1],z[a+2],z[a+3])}static FromArrayToRef(z,a,K){return K._x=z[a],K._y=z[a+1],K._z=z[a+2],K._w=z[a+3],K._isDirty=!0,K}static FromFloatsToRef(z,a,K,v,T){return T.Xd(z,a,K,v),T}static FromEulerAngles(z,a,K){const v=new G;return G.RotationYawPitchRollToRef(a,z,K,v),v}static FromEulerAnglesToRef(z,a,K,v){return G.RotationYawPitchRollToRef(a,z,K,v),v}static FromEulerVector(z){const a=new G;return G.RotationYawPitchRollToRef(z._y,z._x,z._z,a),a}static FromEulerVectorToRef(z,a){return G.RotationYawPitchRollToRef(z._y,z._x,z._z,a),a}static FromUnitVectorsToRef(z,a,K){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.e;const m=W.Dot(z,a)+1;return m<T?Math.abs(z.x)>Math.abs(z.z)?K.set(-z.y,z.x,0,0):K.set(0,-z.z,z.y,0):(W.CrossToRef(z,a,c.gb[0]),K.set(c.gb[0].x,c.gb[0].y,c.gb[0].z,m)),K.normalize()}static RotationYawPitchRoll(z,a,K){const v=new G;return G.RotationYawPitchRollToRef(z,a,K,v),v}static RotationYawPitchRollToRef(z,a,K,v){const T=.5*K,m=.5*a,p=.5*z,j=Math.sin(T),s=Math.cos(T),M=Math.sin(m),r=Math.cos(m),W=Math.sin(p),F=Math.cos(p);return v._x=F*M*s+W*r*j,v._y=W*r*s-F*M*j,v._z=F*r*j-W*M*s,v._w=F*r*s+W*M*j,v._isDirty=!0,v}static RotationAlphaBetaGamma(z,a,K){const v=new G;return G.RotationAlphaBetaGammaToRef(z,a,K,v),v}static RotationAlphaBetaGammaToRef(z,a,K,v){const T=.5*(K+z),m=.5*(K-z),p=.5*a;return v._x=Math.cos(m)*Math.sin(p),v._y=Math.sin(m)*Math.sin(p),v._z=Math.sin(T)*Math.cos(p),v._w=Math.cos(T)*Math.cos(p),v._isDirty=!0,v}static RotationQuaternionFromAxis(z,a,K){const v=new G(0,0,0,0);return G.RotationQuaternionFromAxisToRef(z,a,K,v),v}static RotationQuaternionFromAxisToRef(z,a,K,v){const T=V.Matrix[0];return z=z.normalizeToRef(V.gb[0]),a=a.normalizeToRef(V.gb[1]),K=K.normalizeToRef(V.gb[2]),l.FromXYZAxesToRef(z,a,K,T),G.FromRotationMatrixToRef(T,v),v}static FromLookDirectionLH(z,a){const K=new G;return G.FromLookDirectionLHToRef(z,a,K),K}static FromLookDirectionLHToRef(z,a,K){const v=V.Matrix[0];return l.LookDirectionLHToRef(z,a,v),G.FromRotationMatrixToRef(v,K),K}static FromLookDirectionRH(z,a){const K=new G;return G.FromLookDirectionRHToRef(z,a,K),K}static FromLookDirectionRHToRef(z,a,K){const v=V.Matrix[0];return l.LookDirectionRHToRef(z,a,v),G.FromRotationMatrixToRef(v,K)}static Slerp(z,a,K){const v=G.Identity();return G.SlerpToRef(z,a,K,v),v}static SlerpToRef(z,a,K,v){let T,m,p=z._x*a._x+z._y*a._y+z._z*a._z+z._w*a._w,j=!1;if(p<0&&(j=!0,p=-p),p>.999999)m=1-K,T=j?-K:K;else{const z=Math.acos(p),a=1/Math.sin(z);m=Math.sin((1-K)*z)*a,T=j?-Math.sin(K*z)*a:Math.sin(K*z)*a}return v._x=m*z._x+T*a._x,v._y=m*z._y+T*a._y,v._z=m*z._z+T*a._z,v._w=m*z._w+T*a._w,v._isDirty=!0,v}static Hermite(z,a,K,v,T){const m=T*T,p=T*m,j=2*p-3*m+1,s=-2*p+3*m,M=p-2*m+T,r=p-m,W=z._x*j+K._x*s+a._x*M+v._x*r,F=z._y*j+K._y*s+a._y*M+v._y*r,l=z._z*j+K._z*s+a._z*M+v._z*r,V=z._w*j+K._w*s+a._w*M+v._w*r;return new G(W,F,l,V)}static Hermite1stDerivative(z,a,K,v,T){const m=new G;return this.Hermite1stDerivativeToRef(z,a,K,v,T,m),m}static Hermite1stDerivativeToRef(z,a,K,v,T,m){const p=T*T;return m._x=6*(p-T)*z._x+(3*p-4*T+1)*a._x+6*(-p+T)*K._x+(3*p-2*T)*v._x,m._y=6*(p-T)*z._y+(3*p-4*T+1)*a._y+6*(-p+T)*K._y+(3*p-2*T)*v._y,m._z=6*(p-T)*z._z+(3*p-4*T+1)*a._z+6*(-p+T)*K._z+(3*p-2*T)*v._z,m._w=6*(p-T)*z._w+(3*p-4*T+1)*a._w+6*(-p+T)*K._w+(3*p-2*T)*v._w,m._isDirty=!0,m}static Normalize(z){const a=G.Zero();return G.NormalizeToRef(z,a),a}static NormalizeToRef(z,a){return z.normalizeToRef(a),a}static Clamp(z,a,K){const v=new G;return G.ClampToRef(z,a,K,v),v}static ClampToRef(z,a,K,v){return v.Xd((0,s.e)(z.x,a.x,K.x),(0,s.e)(z.y,a.y,K.y),(0,s.e)(z.z,a.z,K.z),(0,s.e)(z.w,a.w,K.w))}static Random(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new G((0,s.v)(z,a),(0,s.v)(z,a),(0,s.v)(z,a),(0,s.v)(z,a))}static RandomToRef(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Xd((0,s.v)(z,a),(0,s.v)(z,a),(0,s.v)(z,a),(0,s.v)(z,a))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(z,a){return Math.sqrt(G.DistanceSquared(z,a))}static DistanceSquared(z,a){const K=z.x-a.x,v=z.y-a.y,T=z.z-a.z,m=z.w-a.w;return K*K+v*v+T*T+m*m}static Center(z,a){return G.CenterToRef(z,a,G.Zero())}static CenterToRef(z,a,K){return K.Xd((z.x+a.x)/2,(z.y+a.y)/2,(z.z+a.z)/2,(z.w+a.w)/2)}}Object.defineProperties(G.prototype,{dimension:{value:[4]},rank:{value:1}});class l{static get Use64Bits(){return p.b.MatrixUse64Bits}get m(){return this.Rj}markAsUpdated(){this.updateFlag=l._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=z,this._isIdentity3x2=z||K,this._isIdentityDirty=!this._isIdentity&&a,this._isIdentity3x2Dirty=!this._isIdentity3x2&&v}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,p.b.MatrixTrackPrecisionChange&&p.b.MatrixTrackedMatrices.push(this),this.Rj=new p.b.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const z=this.Rj;this._isIdentity=1===z[0]&&0===z[1]&&0===z[2]&&0===z[3]&&0===z[4]&&1===z[5]&&0===z[6]&&0===z[7]&&0===z[8]&&0===z[9]&&1===z[10]&&0===z[11]&&0===z[12]&&0===z[13]&&0===z[14]&&1===z[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.Rj[0]||1!==this.Rj[5]||1!==this.Rj[15]||0!==this.Rj[1]||0!==this.Rj[2]||0!==this.Rj[3]||0!==this.Rj[4]||0!==this.Rj[6]||0!==this.Rj[7]||0!==this.Rj[8]||0!==this.Rj[9]||0!==this.Rj[10]||0!==this.Rj[11]||0!==this.Rj[12]||0!==this.Rj[13]||0!==this.Rj[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const z=this.Rj,a=z[0],K=z[1],v=z[2],T=z[3],m=z[4],p=z[5],j=z[6],s=z[7],M=z[8],r=z[9],W=z[10],F=z[11],G=z[12],l=z[13],V=z[14],c=z[15],C=W*c-V*F,w=r*c-l*F,H=r*V-l*W,f=M*c-G*F,Y=M*V-W*G,I=M*l-G*r;return a*+(p*C-j*w+s*H)+K*-(m*C-j*f+s*Y)+v*+(m*w-p*f+s*I)+T*-(m*H-p*Y+j*I)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!z)return this.Rj;const K=this.Rj;for(let v=0;v<16;v++)z[a+v]=K[v];return this}kj(){return this.Rj}vc(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return l.FromArrayToRef(z,a,this)}Xd(){for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];return l.FromArrayToRef(a,0,this)}set(){const z=this.Rj;for(let a=0;a<16;a++)z[a]=a<0||arguments.length<=a?void 0:arguments[a];return this.markAsUpdated(),this}Vd(z){const a=this.Rj;for(let K=0;K<16;K++)a[K]=z;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return l.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(z){const a=new l;return this.addToRef(z,a),a}addToRef(z,a){const K=this.Rj,v=a.Rj,T=z.m;for(let m=0;m<16;m++)v[m]=K[m]+T[m];return a.markAsUpdated(),a}addToSelf(z){const a=this.Rj,K=z.m;return a[0]+=K[0],a[1]+=K[1],a[2]+=K[2],a[3]+=K[3],a[4]+=K[4],a[5]+=K[5],a[6]+=K[6],a[7]+=K[7],a[8]+=K[8],a[9]+=K[9],a[10]+=K[10],a[11]+=K[11],a[12]+=K[12],a[13]+=K[13],a[14]+=K[14],a[15]+=K[15],this.markAsUpdated(),this}addInPlace(z){const a=this.Rj,K=z.m;for(let v=0;v<16;v++)a[v]+=K[v];return this.markAsUpdated(),this}addInPlaceFromFloats(){const z=this.Rj;for(let a=0;a<16;a++)z[a]+=a<0||arguments.length<=a?void 0:arguments[a];return this.markAsUpdated(),this}sc(z){const a=this.Rj,K=z.m;for(let v=0;v<16;v++)a[v]-=K[v];return this.markAsUpdated(),this}subtractToRef(z,a){const K=this.Rj,v=z.m,T=a.Rj;for(let m=0;m<16;m++)T[m]=K[m]-v[m];return a.markAsUpdated(),a}ri(z){const a=this.Rj,K=z.m;for(let v=0;v<16;v++)a[v]-=K[v];return this.markAsUpdated(),this}subtractFromFloats(){for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];return this.subtractFromFloatsToRef(...a,new l)}subtractFromFloatsToRef(){for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];const v=a.pop(),T=this.Rj,m=v.Rj,p=a;for(let j=0;j<16;j++)m[j]=T[j]-p[j];return v.markAsUpdated(),v}invertToRef(z){if(!0===this._isIdentity)return l.IdentityToRef(z),z;const a=this.Rj,K=a[0],v=a[1],T=a[2],m=a[3],p=a[4],j=a[5],s=a[6],M=a[7],r=a[8],W=a[9],F=a[10],G=a[11],V=a[12],c=a[13],C=a[14],w=a[15],H=F*w-C*G,f=W*w-c*G,Y=W*C-c*F,I=r*w-V*G,q=r*C-F*V,B=r*c-V*W,x=+(j*H-s*f+M*Y),Z=-(p*H-s*I+M*q),y=+(p*f-j*I+M*B),i=-(p*Y-j*q+s*B),n=K*x+v*Z+T*y+m*i;if(0===n)return z.p(this),z;const X=1/n,P=s*w-C*M,J=j*w-c*M,o=j*C-c*s,N=p*w-V*M,A=p*C-V*s,g=p*c-V*j,d=s*G-F*M,t=j*G-W*M,e=j*F-W*s,L=p*G-r*M,E=p*F-r*s,b=p*W-r*j,D=-(v*H-T*f+m*Y),u=+(K*H-T*I+m*q),U=-(K*f-v*I+m*B),R=+(K*Y-v*q+T*B),k=+(v*P-T*J+m*o),h=-(K*P-T*N+m*A),S=+(K*J-v*N+m*g),Q=-(K*o-v*A+T*g),O=-(v*d-T*t+m*e),zz=+(K*d-T*L+m*E),az=-(K*t-v*L+m*b),Kz=+(K*e-v*E+T*b);return l.FromValuesToRef(x*X,D*X,k*X,O*X,Z*X,u*X,h*X,zz*X,y*X,U*X,S*X,az*X,i*X,R*X,Q*X,Kz*X,z),z}addAtIndex(z,a){return this.Rj[z]+=a,this.markAsUpdated(),this}multiplyAtIndex(z,a){return this.Rj[z]*=a,this.markAsUpdated(),this}setTranslationFromFloats(z,a,K){return this.Rj[12]=z,this.Rj[13]=a,this.Rj[14]=K,this.markAsUpdated(),this}addTranslationFromFloats(z,a,K){return this.Rj[12]+=z,this.Rj[13]+=a,this.Rj[14]+=K,this.markAsUpdated(),this}setTranslation(z){return this.setTranslationFromFloats(z._x,z._y,z._z)}getTranslation(){return new W(this.Rj[12],this.Rj[13],this.Rj[14])}getTranslationToRef(z){return z.x=this.Rj[12],z.y=this.Rj[13],z.z=this.Rj[14],z}removeRotationAndScaling(){const z=this.m;return l.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,z[12],z[13],z[14],z[15],this),this._updateIdentityStatus(0===z[12]&&0===z[13]&&0===z[14]&&1===z[15]),this}p(z){z.copyToArray(this.Rj);const a=z;return this.updateFlag=a.updateFlag,this._updateIdentityStatus(a._isIdentity,a._isIdentityDirty,a._isIdentity3x2,a._isIdentity3x2Dirty),this}copyToArray(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const K=this.Rj;return z[a]=K[0],z[a+1]=K[1],z[a+2]=K[2],z[a+3]=K[3],z[a+4]=K[4],z[a+5]=K[5],z[a+6]=K[6],z[a+7]=K[7],z[a+8]=K[8],z[a+9]=K[9],z[a+10]=K[10],z[a+11]=K[11],z[a+12]=K[12],z[a+13]=K[13],z[a+14]=K[14],z[a+15]=K[15],this}multiply(z){const a=new l;return this.multiplyToRef(z,a),a}multiplyInPlace(z){const a=this.Rj,K=z.m;for(let v=0;v<16;v++)a[v]*=K[v];return this.markAsUpdated(),this}multiplyByFloats(){const z=this.Rj;for(let a=0;a<16;a++)z[a]*=a<0||arguments.length<=a?void 0:arguments[a];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];const v=a.pop(),T=this.Rj,m=v.Rj,p=a;for(let j=0;j<16;j++)m[j]=T[j]*p[j];return v.markAsUpdated(),v}multiplyToRef(z,a){return this._isIdentity?(a.p(z),a):z._isIdentity?(a.p(this),a):(this.multiplyToArray(z,a.Rj,0),a.markAsUpdated(),a)}multiplyToArray(z,a,K){const v=this.Rj,T=z.m,m=v[0],p=v[1],j=v[2],s=v[3],M=v[4],r=v[5],W=v[6],F=v[7],G=v[8],l=v[9],V=v[10],c=v[11],C=v[12],w=v[13],H=v[14],f=v[15],Y=T[0],I=T[1],q=T[2],B=T[3],x=T[4],Z=T[5],y=T[6],i=T[7],n=T[8],X=T[9],P=T[10],J=T[11],o=T[12],N=T[13],A=T[14],g=T[15];return a[K]=m*Y+p*x+j*n+s*o,a[K+1]=m*I+p*Z+j*X+s*N,a[K+2]=m*q+p*y+j*P+s*A,a[K+3]=m*B+p*i+j*J+s*g,a[K+4]=M*Y+r*x+W*n+F*o,a[K+5]=M*I+r*Z+W*X+F*N,a[K+6]=M*q+r*y+W*P+F*A,a[K+7]=M*B+r*i+W*J+F*g,a[K+8]=G*Y+l*x+V*n+c*o,a[K+9]=G*I+l*Z+V*X+c*N,a[K+10]=G*q+l*y+V*P+c*A,a[K+11]=G*B+l*i+V*J+c*g,a[K+12]=C*Y+w*x+H*n+f*o,a[K+13]=C*I+w*Z+H*X+f*N,a[K+14]=C*q+w*y+H*P+f*A,a[K+15]=C*B+w*i+H*J+f*g,this}divide(z){return this.divideToRef(z,new l)}divideToRef(z,a){const K=this.Rj,v=z.m,T=a.Rj;for(let m=0;m<16;m++)T[m]=K[m]/v[m];return a.markAsUpdated(),a}divideInPlace(z){const a=this.Rj,K=z.m;for(let v=0;v<16;v++)a[v]/=K[v];return this.markAsUpdated(),this}minimizeInPlace(z){const a=this.Rj,K=z.m;for(let v=0;v<16;v++)a[v]=Math.min(a[v],K[v]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const z=this.Rj;for(let a=0;a<16;a++)z[a]=Math.min(z[a],a<0||arguments.length<=a?void 0:arguments[a]);return this.markAsUpdated(),this}maximizeInPlace(z){const a=this.Rj,K=z.m;for(let v=0;v<16;v++)a[v]=Math.min(a[v],K[v]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const z=this.Rj;for(let a=0;a<16;a++)z[a]=Math.min(z[a],a<0||arguments.length<=a?void 0:arguments[a]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new l)}negateInPlace(){const z=this.Rj;for(let a=0;a<16;a++)z[a]=-z[a];return this.markAsUpdated(),this}negateToRef(z){const a=this.Rj,K=z.Rj;for(let v=0;v<16;v++)K[v]=-a[v];return z.markAsUpdated(),z}equals(z){const a=z;if(!a)return!1;if((this._isIdentity||a._isIdentity)&&!this._isIdentityDirty&&!a._isIdentityDirty)return this._isIdentity&&a._isIdentity;const K=this.m,v=a.m;return K[0]===v[0]&&K[1]===v[1]&&K[2]===v[2]&&K[3]===v[3]&&K[4]===v[4]&&K[5]===v[5]&&K[6]===v[6]&&K[7]===v[7]&&K[8]===v[8]&&K[9]===v[9]&&K[10]===v[10]&&K[11]===v[11]&&K[12]===v[12]&&K[13]===v[13]&&K[14]===v[14]&&K[15]===v[15]}equalsWithEpsilon(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const K=this.Rj,v=z.m;for(let T=0;T<16;T++)if(!(0,s.y)(K[T],v[T],a))return!1;return!0}equalsToFloats(){const z=this.Rj;for(let a=0;a<16;a++)if(z[a]!=(a<0||arguments.length<=a?void 0:arguments[a]))return!1;return!0}floor(){return this.floorToRef(new l)}floorToRef(z){const a=this.Rj,K=z.Rj;for(let v=0;v<16;v++)K[v]=Math.floor(a[v]);return z.markAsUpdated(),z}fract(){return this.fractToRef(new l)}fractToRef(z){const a=this.Rj,K=z.Rj;for(let v=0;v<16;v++)K[v]=a[v]-Math.floor(a[v]);return z.markAsUpdated(),z}clone(){const z=new l;return z.p(this),z}getClassName(){return"Matrix"}getHashCode(){let z=M(this.Rj[0]);for(let a=1;a<16;a++)z=397*z^M(this.Rj[a]);return z}decomposeToTransformNode(z){return z.rotationQuaternion=z.rotationQuaternion||new G,this.decompose(z.Yd,z.rotationQuaternion,z.position)}decompose(z,a,K,v){let T=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return K&&K.Vd(0),z&&z.Vd(1),a&&a.Xd(0,0,0,1),!0;const m=this.Rj;if(K&&K.Xd(m[12],m[13],m[14]),(z=z||V.gb[0]).x=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),z.y=Math.sqrt(m[4]*m[4]+m[5]*m[5]+m[6]*m[6]),z.z=Math.sqrt(m[8]*m[8]+m[9]*m[9]+m[10]*m[10]),v){const a=(T?v.absoluteScaling.x:v.Yd.x)<0?-1:1,K=(T?v.absoluteScaling.y:v.Yd.y)<0?-1:1,m=(T?v.absoluteScaling.z:v.Yd.z)<0?-1:1;z.x*=a,z.y*=K,z.z*=m}else this.determinant()<=0&&(z.y*=-1);if(0===z._x||0===z._y||0===z._z)return a&&a.Xd(0,0,0,1),!1;if(a){const K=1/z._x,v=1/z._y,T=1/z._z;l.FromValuesToRef(m[0]*K,m[1]*K,m[2]*K,0,m[4]*v,m[5]*v,m[6]*v,0,m[8]*T,m[9]*T,m[10]*T,0,0,0,0,1,V.Matrix[0]),G.FromRotationMatrixToRef(V.Matrix[0],a)}return!0}getRow(z){if(z<0||z>3)return null;const a=4*z;return new F(this.Rj[a+0],this.Rj[a+1],this.Rj[a+2],this.Rj[a+3])}getRowToRef(z,a){if(z>=0&&z<=3){const K=4*z;a.x=this.Rj[K+0],a.y=this.Rj[K+1],a.z=this.Rj[K+2],a.w=this.Rj[K+3]}return a}setRow(z,a){return this.setRowFromFloats(z,a.x,a.y,a.z,a.w)}transpose(){const z=new l;return l.TransposeToRef(this,z),z}transposeToRef(z){return l.TransposeToRef(this,z),z}setRowFromFloats(z,a,K,v,T){if(z<0||z>3)return this;const m=4*z;return this.Rj[m+0]=a,this.Rj[m+1]=K,this.Rj[m+2]=v,this.Rj[m+3]=T,this.markAsUpdated(),this}scale(z){const a=new l;return this.scaleToRef(z,a),a}scaleToRef(z,a){for(let K=0;K<16;K++)a.Rj[K]=this.Rj[K]*z;return a.markAsUpdated(),a}scaleAndAddToRef(z,a){for(let K=0;K<16;K++)a.Rj[K]+=this.Rj[K]*z;return a.markAsUpdated(),a}scaleInPlace(z){const a=this.Rj;for(let K=0;K<16;K++)a[K]*=z;return this.markAsUpdated(),this}toNormalMatrix(z){const a=V.Matrix[0];this.invertToRef(a),a.transposeToRef(z);const K=z.Rj;return l.FromValuesToRef(K[0],K[1],K[2],0,K[4],K[5],K[6],0,K[8],K[9],K[10],0,0,0,0,1,z),z}getRotationMatrix(){const z=new l;return this.getRotationMatrixToRef(z),z}getRotationMatrixToRef(z){const a=V.gb[0];if(!this.decompose(a))return l.IdentityToRef(z),z;const K=this.Rj,v=1/a._x,T=1/a._y,m=1/a._z;return l.FromValuesToRef(K[0]*v,K[1]*v,K[2]*v,0,K[4]*T,K[5]*T,K[6]*T,0,K[8]*m,K[9]*m,K[10]*m,0,0,0,0,1,z),z}toggleModelMatrixHandInPlace(){const z=this.Rj;return z[2]*=-1,z[6]*=-1,z[8]*=-1,z[9]*=-1,z[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const z=this.Rj;return z[8]*=-1,z[9]*=-1,z[10]*=-1,z[11]*=-1,this.markAsUpdated(),this}static Jg(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const K=new l;return l.FromArrayToRef(z,a,K),K}static FromArrayToRef(z,a,K){for(let v=0;v<16;v++)K.Rj[v]=z[v+a];return K.markAsUpdated(),K}static FromFloat32ArrayToRefScaled(z,a,K,v){return v.Rj[0]=z[0+a]*K,v.Rj[1]=z[1+a]*K,v.Rj[2]=z[2+a]*K,v.Rj[3]=z[3+a]*K,v.Rj[4]=z[4+a]*K,v.Rj[5]=z[5+a]*K,v.Rj[6]=z[6+a]*K,v.Rj[7]=z[7+a]*K,v.Rj[8]=z[8+a]*K,v.Rj[9]=z[9+a]*K,v.Rj[10]=z[10+a]*K,v.Rj[11]=z[11+a]*K,v.Rj[12]=z[12+a]*K,v.Rj[13]=z[13+a]*K,v.Rj[14]=z[14+a]*K,v.Rj[15]=z[15+a]*K,v.markAsUpdated(),v}static get IdentityReadOnly(){return l._IdentityReadOnly}static FromValuesToRef(z,a,K,v,T,m,p,j,s,M,r,W,F,G,l,V,c){const C=c.Rj;C[0]=z,C[1]=a,C[2]=K,C[3]=v,C[4]=T,C[5]=m,C[6]=p,C[7]=j,C[8]=s,C[9]=M,C[10]=r,C[11]=W,C[12]=F,C[13]=G,C[14]=l,C[15]=V,c.markAsUpdated()}static FromValues(z,a,K,v,T,m,p,j,s,M,r,W,F,G,V,c){const C=new l,w=C.Rj;return w[0]=z,w[1]=a,w[2]=K,w[3]=v,w[4]=T,w[5]=m,w[6]=p,w[7]=j,w[8]=s,w[9]=M,w[10]=r,w[11]=W,w[12]=F,w[13]=G,w[14]=V,w[15]=c,C.markAsUpdated(),C}static Compose(z,a,K){const v=new l;return l.ComposeToRef(z,a,K,v),v}static ComposeToRef(z,a,K,v){const T=v.Rj,m=a._x,p=a._y,j=a._z,s=a._w,M=m+m,r=p+p,W=j+j,F=m*M,G=m*r,l=m*W,V=p*r,c=p*W,C=j*W,w=s*M,H=s*r,f=s*W,Y=z._x,I=z._y,q=z._z;return T[0]=(1-(V+C))*Y,T[1]=(G+f)*Y,T[2]=(l-H)*Y,T[3]=0,T[4]=(G-f)*I,T[5]=(1-(F+C))*I,T[6]=(c+w)*I,T[7]=0,T[8]=(l+H)*q,T[9]=(c-w)*q,T[10]=(1-(F+V))*q,T[11]=0,T[12]=K._x,T[13]=K._y,T[14]=K._z,T[15]=1,v.markAsUpdated(),v}static Identity(){const z=l.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return z._updateIdentityStatus(!0),z}static IdentityToRef(z){return l.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,z),z._updateIdentityStatus(!0),z}static Zero(){const z=l.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return z._updateIdentityStatus(!1),z}static RotationX(z){const a=new l;return l.RotationXToRef(z,a),a}static Invert(z){const a=new l;return z.invertToRef(a),a}static RotationXToRef(z,a){const K=Math.sin(z),v=Math.cos(z);return l.FromValuesToRef(1,0,0,0,0,v,K,0,0,-K,v,0,0,0,0,1,a),a._updateIdentityStatus(1===v&&0===K),a}static RotationY(z){const a=new l;return l.RotationYToRef(z,a),a}static RotationYToRef(z,a){const K=Math.sin(z),v=Math.cos(z);return l.FromValuesToRef(v,0,-K,0,0,1,0,0,K,0,v,0,0,0,0,1,a),a._updateIdentityStatus(1===v&&0===K),a}static RotationZ(z){const a=new l;return l.RotationZToRef(z,a),a}static RotationZToRef(z,a){const K=Math.sin(z),v=Math.cos(z);return l.FromValuesToRef(v,K,0,0,-K,v,0,0,0,0,1,0,0,0,0,1,a),a._updateIdentityStatus(1===v&&0===K),a}static RotationAxis(z,a){const K=new l;return l.RotationAxisToRef(z,a,K),K}static RotationAxisToRef(z,a,K){const v=Math.sin(-a),T=Math.cos(-a),m=1-T;z=z.normalizeToRef(V.gb[0]);const p=K.Rj;return p[0]=z._x*z._x*m+T,p[1]=z._x*z._y*m-z._z*v,p[2]=z._x*z._z*m+z._y*v,p[3]=0,p[4]=z._y*z._x*m+z._z*v,p[5]=z._y*z._y*m+T,p[6]=z._y*z._z*m-z._x*v,p[7]=0,p[8]=z._z*z._x*m-z._y*v,p[9]=z._z*z._y*m+z._x*v,p[10]=z._z*z._z*m+T,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,K.markAsUpdated(),K}static RotationAlignToRef(z,a,K){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const m=W.Dot(a,z),p=K.Rj;if(m<-1+v.e)p[0]=-1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=T?1:-1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=T?-1:1,p[11]=0;else{const K=W.Cross(a,z),v=1/(1+m);p[0]=K._x*K._x*v+m,p[1]=K._y*K._x*v-K._z,p[2]=K._z*K._x*v+K._y,p[3]=0,p[4]=K._x*K._y*v+K._z,p[5]=K._y*K._y*v+m,p[6]=K._z*K._y*v-K._x,p[7]=0,p[8]=K._x*K._z*v-K._y,p[9]=K._y*K._z*v+K._x,p[10]=K._z*K._z*v+m,p[11]=0}return p[12]=0,p[13]=0,p[14]=0,p[15]=1,K.markAsUpdated(),K}static RotationYawPitchRoll(z,a,K){const v=new l;return l.RotationYawPitchRollToRef(z,a,K,v),v}static RotationYawPitchRollToRef(z,a,K,v){return G.RotationYawPitchRollToRef(z,a,K,V.Quaternion[0]),V.Quaternion[0].toRotationMatrix(v),v}static Scaling(z,a,K){const v=new l;return l.ScalingToRef(z,a,K,v),v}static ScalingToRef(z,a,K,v){return l.FromValuesToRef(z,0,0,0,0,a,0,0,0,0,K,0,0,0,0,1,v),v._updateIdentityStatus(1===z&&1===a&&1===K),v}static Translation(z,a,K){const v=new l;return l.TranslationToRef(z,a,K,v),v}static TranslationToRef(z,a,K,v){return l.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,z,a,K,1,v),v._updateIdentityStatus(0===z&&0===a&&0===K),v}static Lerp(z,a,K){const v=new l;return l.LerpToRef(z,a,K,v),v}static LerpToRef(z,a,K,v){const T=v.Rj,m=z.m,p=a.m;for(let j=0;j<16;j++)T[j]=m[j]*(1-K)+p[j]*K;return v.markAsUpdated(),v}static DecomposeLerp(z,a,K){const v=new l;return l.DecomposeLerpToRef(z,a,K,v),v}static DecomposeLerpToRef(z,a,K,v){const T=V.gb[0],m=V.Quaternion[0],p=V.gb[1];z.decompose(T,m,p);const j=V.gb[2],s=V.Quaternion[1],M=V.gb[3];a.decompose(j,s,M);const r=V.gb[4];W.LerpToRef(T,j,K,r);const F=V.Quaternion[2];G.SlerpToRef(m,s,K,F);const c=V.gb[5];return W.LerpToRef(p,M,K,c),l.ComposeToRef(r,F,c,v),v}static LookAtLH(z,a,K){const v=new l;return l.LookAtLHToRef(z,a,K,v),v}static LookAtLHToRef(z,a,K,v){const T=V.gb[0],m=V.gb[1],p=V.gb[2];a.subtractToRef(z,p),p.normalize(),W.CrossToRef(K,p,T);const j=T.lengthSquared();0===j?T.x=1:T.normalizeFromLength(Math.sqrt(j)),W.CrossToRef(p,T,m),m.normalize();const s=-W.Dot(T,z),M=-W.Dot(m,z),r=-W.Dot(p,z);return l.FromValuesToRef(T._x,m._x,p._x,0,T._y,m._y,p._y,0,T._z,m._z,p._z,0,s,M,r,1,v),v}static LookAtRH(z,a,K){const v=new l;return l.LookAtRHToRef(z,a,K,v),v}static LookAtRHToRef(z,a,K,v){const T=V.gb[0],m=V.gb[1],p=V.gb[2];z.subtractToRef(a,p),p.normalize(),W.CrossToRef(K,p,T);const j=T.lengthSquared();0===j?T.x=1:T.normalizeFromLength(Math.sqrt(j)),W.CrossToRef(p,T,m),m.normalize();const s=-W.Dot(T,z),M=-W.Dot(m,z),r=-W.Dot(p,z);return l.FromValuesToRef(T._x,m._x,p._x,0,T._y,m._y,p._y,0,T._z,m._z,p._z,0,s,M,r,1,v),v}static LookDirectionLH(z,a){const K=new l;return l.LookDirectionLHToRef(z,a,K),K}static LookDirectionLHToRef(z,a,K){const v=V.gb[0];v.p(z),v.scaleInPlace(-1);const T=V.gb[1];return W.CrossToRef(a,v,T),l.FromValuesToRef(T._x,T._y,T._z,0,a._x,a._y,a._z,0,v._x,v._y,v._z,0,0,0,0,1,K),K}static LookDirectionRH(z,a){const K=new l;return l.LookDirectionRHToRef(z,a,K),K}static LookDirectionRHToRef(z,a,K){const v=V.gb[2];return W.CrossToRef(a,z,v),l.FromValuesToRef(v._x,v._y,v._z,0,a._x,a._y,a._z,0,z._x,z._y,z._z,0,0,0,0,1,K),K}static OrthoLH(z,a,K,v,T){const m=new l;return l.OrthoLHToRef(z,a,K,v,m,T),m}static OrthoLHToRef(z,a,K,v,T,m){const p=2/z,j=2/a,s=2/(v-K),M=-(v+K)/(v-K);return l.FromValuesToRef(p,0,0,0,0,j,0,0,0,0,s,0,0,0,M,1,T),m&&T.multiplyToRef(C,T),T._updateIdentityStatus(1===p&&1===j&&1===s&&0===M),T}static OrthoOffCenterLH(z,a,K,v,T,m,p){const j=new l;return l.OrthoOffCenterLHToRef(z,a,K,v,T,m,j,p),j}static OrthoOffCenterLHToRef(z,a,K,v,T,m,p,j){const s=2/(a-z),M=2/(v-K),r=2/(m-T),W=-(m+T)/(m-T),F=(z+a)/(z-a),G=(v+K)/(K-v);return l.FromValuesToRef(s,0,0,0,0,M,0,0,0,0,r,0,F,G,W,1,p),j&&p.multiplyToRef(C,p),p.markAsUpdated(),p}static ObliqueOffCenterLHToRef(z,a,K,v,T,m,p,j,s,M,r){const W=-p*Math.cos(j),F=-p*Math.sin(j);return l.TranslationToRef(0,0,-s,V.Matrix[1]),l.FromValuesToRef(1,0,0,0,0,1,0,0,W,F,1,0,0,0,0,1,V.Matrix[0]),V.Matrix[1].multiplyToRef(V.Matrix[0],V.Matrix[0]),l.TranslationToRef(0,0,s,V.Matrix[1]),V.Matrix[0].multiplyToRef(V.Matrix[1],V.Matrix[0]),l.OrthoOffCenterLHToRef(z,a,K,v,T,m,M,r),V.Matrix[0].multiplyToRef(M,M),M}static OrthoOffCenterRH(z,a,K,v,T,m,p){const j=new l;return l.OrthoOffCenterRHToRef(z,a,K,v,T,m,j,p),j}static OrthoOffCenterRHToRef(z,a,K,v,T,m,p,j){return l.OrthoOffCenterLHToRef(z,a,K,v,T,m,p,j),p.Rj[10]*=-1,p}static ObliqueOffCenterRHToRef(z,a,K,v,T,m,p,j,s,M,r){const W=p*Math.cos(j),F=p*Math.sin(j);return l.TranslationToRef(0,0,s,V.Matrix[1]),l.FromValuesToRef(1,0,0,0,0,1,0,0,W,F,1,0,0,0,0,1,V.Matrix[0]),V.Matrix[1].multiplyToRef(V.Matrix[0],V.Matrix[0]),l.TranslationToRef(0,0,-s,V.Matrix[1]),V.Matrix[0].multiplyToRef(V.Matrix[1],V.Matrix[0]),l.OrthoOffCenterRHToRef(z,a,K,v,T,m,M,r),V.Matrix[0].multiplyToRef(M,M),M}static PerspectiveLH(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const p=new l,j=2*K/z,s=2*K/a,M=(v+K)/(v-K),r=-2*v*K/(v-K),W=Math.tan(m);return l.FromValuesToRef(j,0,0,0,0,s,0,W,0,0,M,1,0,0,r,0,p),T&&p.multiplyToRef(C,p),p._updateIdentityStatus(!1),p}static PerspectiveFovLH(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const j=new l;return l.PerspectiveFovLHToRef(z,a,K,v,j,!0,T,m,p),j}static PerspectiveFovLHToRef(z,a,K,v,T){let m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,s=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const M=K,r=v,W=1/Math.tan(.5*z),F=m?W/a:W,G=m?W:W*a,V=s&&0===M?-1:0!==r?(r+M)/(r-M):1,c=s&&0===M?2*r:0!==r?-2*r*M/(r-M):-2*M,w=Math.tan(j);return l.FromValuesToRef(F,0,0,0,0,G,0,w,0,0,V,1,0,0,c,0,T),p&&T.multiplyToRef(C,T),T._updateIdentityStatus(!1),T}static PerspectiveFovReverseLHToRef(z,a,K,v,T){let m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const s=1/Math.tan(.5*z),M=m?s/a:s,r=m?s:s*a,W=Math.tan(j);return l.FromValuesToRef(M,0,0,0,0,r,0,W,0,0,-K,1,0,0,1,0,T),p&&T.multiplyToRef(C,T),T._updateIdentityStatus(!1),T}static PerspectiveFovRH(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const j=new l;return l.PerspectiveFovRHToRef(z,a,K,v,j,!0,T,m,p),j}static PerspectiveFovRHToRef(z,a,K,v,T){let m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,s=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const M=K,r=v,W=1/Math.tan(.5*z),F=m?W/a:W,G=m?W:W*a,V=s&&0===M?1:0!==r?-(r+M)/(r-M):-1,c=s&&0===M?2*r:0!==r?-2*r*M/(r-M):-2*M,w=Math.tan(j);return l.FromValuesToRef(F,0,0,0,0,G,0,w,0,0,V,-1,0,0,c,0,T),p&&T.multiplyToRef(C,T),T._updateIdentityStatus(!1),T}static PerspectiveFovReverseRHToRef(z,a,K,v,T){let m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=arguments.length>6?arguments[6]:void 0,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const s=1/Math.tan(.5*z),M=m?s/a:s,r=m?s:s*a,W=Math.tan(j);return l.FromValuesToRef(M,0,0,0,0,r,0,W,0,0,-K,-1,0,0,-1,0,T),p&&T.multiplyToRef(C,T),T._updateIdentityStatus(!1),T}static GetFinalMatrix(z,a,K,v,T,m){const p=z.width,j=z.height,s=z.x,M=z.y,r=l.FromValues(p/2,0,0,0,0,-j/2,0,0,0,0,m-T,0,s+p/2,j/2+M,T,1),W=new l;return a.multiplyToRef(K,W),W.multiplyToRef(v,W),W.multiplyToRef(r,W)}static GetAsMatrix2x2(z){const a=z.m,K=[a[0],a[1],a[4],a[5]];return p.b.MatrixUse64Bits?K:new Float32Array(K)}static GetAsMatrix3x3(z){const a=z.m,K=[a[0],a[1],a[2],a[4],a[5],a[6],a[8],a[9],a[10]];return p.b.MatrixUse64Bits?K:new Float32Array(K)}static Transpose(z){const a=new l;return l.TransposeToRef(z,a),a}static TransposeToRef(z,a){const K=z.m,v=K[0],T=K[4],m=K[8],p=K[12],j=K[1],s=K[5],M=K[9],r=K[13],W=K[2],F=K[6],G=K[10],l=K[14],V=K[3],c=K[7],C=K[11],w=K[15],H=a.Rj;return H[0]=v,H[1]=T,H[2]=m,H[3]=p,H[4]=j,H[5]=s,H[6]=M,H[7]=r,H[8]=W,H[9]=F,H[10]=G,H[11]=l,H[12]=V,H[13]=c,H[14]=C,H[15]=w,a.markAsUpdated(),a._updateIdentityStatus(z._isIdentity,z._isIdentityDirty),a}static Reflection(z){const a=new l;return l.ReflectionToRef(z,a),a}static ReflectionToRef(z,a){z.normalize();const K=z.k.x,v=z.k.y,T=z.k.z,m=-2*K,p=-2*v,j=-2*T;return l.FromValuesToRef(m*K+1,p*K,j*K,0,m*v,p*v+1,j*v,0,m*T,p*T,j*T+1,0,m*z.d,p*z.d,j*z.d,1,a),a}static FromXYZAxesToRef(z,a,K,v){return l.FromValuesToRef(z._x,z._y,z._z,0,a._x,a._y,a._z,0,K._x,K._y,K._z,0,0,0,0,1,v),v}static FromQuaternionToRef(z,a){const K=z._x*z._x,v=z._y*z._y,T=z._z*z._z,m=z._x*z._y,p=z._z*z._w,j=z._z*z._x,s=z._y*z._w,M=z._y*z._z,r=z._x*z._w;return a.Rj[0]=1-2*(v+T),a.Rj[1]=2*(m+p),a.Rj[2]=2*(j-s),a.Rj[3]=0,a.Rj[4]=2*(m-p),a.Rj[5]=1-2*(T+K),a.Rj[6]=2*(M+r),a.Rj[7]=0,a.Rj[8]=2*(j+s),a.Rj[9]=2*(M-r),a.Rj[10]=1-2*(v+K),a.Rj[11]=0,a.Rj[12]=0,a.Rj[13]=0,a.Rj[14]=0,a.Rj[15]=1,a.markAsUpdated(),a}}l._UpdateFlagSeed=0,l._IdentityReadOnly=l.Identity(),Object.defineProperties(l.prototype,{dimension:{value:[4,4]},rank:{value:2}});class V{}V.gb=(0,T.g)(11,W.Zero),V.Matrix=(0,T.g)(2,l.Identity),V.Quaternion=(0,T.g)(3,G.Zero);class c{}c.Vector2=(0,T.g)(3,r.Zero),c.gb=(0,T.g)(13,W.Zero),c.Vector4=(0,T.g)(3,F.Zero),c.Quaternion=(0,T.g)(3,G.Zero),c.Matrix=(0,T.g)(8,l.Identity),(0,m.e)("BABYLON.Vector2",r),(0,m.e)("BABYLON.Vector3",W),(0,m.e)("BABYLON.Vector4",F),(0,m.e)("BABYLON.Matrix",l);const C=l.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11223:(z,a,K)=>{"use strict";K.d(a,{e:()=>v});class v{constructor(z,a,K,v){this.x=z,this.y=a,this.width=K,this.height=v}toGlobal(z,a){return new v(this.x*z,this.y*a,this.width*z,this.height*a)}toGlobalToRef(z,a,K){return K.x=this.x*z,K.y=this.y*a,K.width=this.width*z,K.height=this.height*a,this}clone(){return new v(this.x,this.y,this.width,this.height)}}},11435:(z,a,K)=>{"use strict";K.d(a,{e:()=>M,f:()=>r});var v=K(10941),T=K(11442);const m=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],p=[()=>1,z=>z.y,z=>z.z,z=>z.x,z=>z.x*z.y,z=>z.y*z.z,z=>3*z.z*z.z-1,z=>z.x*z.z,z=>z.x*z.x-z.y*z.y],j=(z,a)=>m[z]*p[z](a),s=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class M{constructor(){this.preScaled=!1,this.l00=v.o.Zero(),this.l1_1=v.o.Zero(),this.l10=v.o.Zero(),this.l11=v.o.Zero(),this.l2_2=v.o.Zero(),this.l2_1=v.o.Zero(),this.l20=v.o.Zero(),this.l21=v.o.Zero(),this.l22=v.o.Zero()}addLight(z,a,K){T.b.gb[0].set(a.r,a.g,a.b);const v=T.b.gb[0],m=T.b.gb[1];v.scaleToRef(K,m),m.scaleToRef(j(0,z),T.b.gb[2]),this.l00.addInPlace(T.b.gb[2]),m.scaleToRef(j(1,z),T.b.gb[2]),this.l1_1.addInPlace(T.b.gb[2]),m.scaleToRef(j(2,z),T.b.gb[2]),this.l10.addInPlace(T.b.gb[2]),m.scaleToRef(j(3,z),T.b.gb[2]),this.l11.addInPlace(T.b.gb[2]),m.scaleToRef(j(4,z),T.b.gb[2]),this.l2_2.addInPlace(T.b.gb[2]),m.scaleToRef(j(5,z),T.b.gb[2]),this.l2_1.addInPlace(T.b.gb[2]),m.scaleToRef(j(6,z),T.b.gb[2]),this.l20.addInPlace(T.b.gb[2]),m.scaleToRef(j(7,z),T.b.gb[2]),this.l21.addInPlace(T.b.gb[2]),m.scaleToRef(j(8,z),T.b.gb[2]),this.l22.addInPlace(T.b.gb[2])}scaleInPlace(z){this.l00.scaleInPlace(z),this.l1_1.scaleInPlace(z),this.l10.scaleInPlace(z),this.l11.scaleInPlace(z),this.l2_2.scaleInPlace(z),this.l2_1.scaleInPlace(z),this.l20.scaleInPlace(z),this.l21.scaleInPlace(z),this.l22.scaleInPlace(z)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(s[0]),this.l1_1.scaleInPlace(s[1]),this.l10.scaleInPlace(s[2]),this.l11.scaleInPlace(s[3]),this.l2_2.scaleInPlace(s[4]),this.l2_1.scaleInPlace(s[5]),this.l20.scaleInPlace(s[6]),this.l21.scaleInPlace(s[7]),this.l22.scaleInPlace(s[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(m[0]),this.l1_1.scaleInPlace(m[1]),this.l10.scaleInPlace(m[2]),this.l11.scaleInPlace(m[3]),this.l2_2.scaleInPlace(m[4]),this.l2_1.scaleInPlace(m[5]),this.l20.scaleInPlace(m[6]),this.l21.scaleInPlace(m[7]),this.l22.scaleInPlace(m[8])}updateFromArray(z){return v.o.FromArrayToRef(z[0],0,this.l00),v.o.FromArrayToRef(z[1],0,this.l1_1),v.o.FromArrayToRef(z[2],0,this.l10),v.o.FromArrayToRef(z[3],0,this.l11),v.o.FromArrayToRef(z[4],0,this.l2_2),v.o.FromArrayToRef(z[5],0,this.l2_1),v.o.FromArrayToRef(z[6],0,this.l20),v.o.FromArrayToRef(z[7],0,this.l21),v.o.FromArrayToRef(z[8],0,this.l22),this}updateFromFloatsArray(z){return v.o.FromFloatsToRef(z[0],z[1],z[2],this.l00),v.o.FromFloatsToRef(z[3],z[4],z[5],this.l1_1),v.o.FromFloatsToRef(z[6],z[7],z[8],this.l10),v.o.FromFloatsToRef(z[9],z[10],z[11],this.l11),v.o.FromFloatsToRef(z[12],z[13],z[14],this.l2_2),v.o.FromFloatsToRef(z[15],z[16],z[17],this.l2_1),v.o.FromFloatsToRef(z[18],z[19],z[20],this.l20),v.o.FromFloatsToRef(z[21],z[22],z[23],this.l21),v.o.FromFloatsToRef(z[24],z[25],z[26],this.l22),this}static Jg(z){return(new M).updateFromArray(z)}static FromPolynomial(z){const a=new M;return a.l00=z.xx.scale(.376127).add(z.yy.scale(.376127)).add(z.zz.scale(.376126)),a.l1_1=z.y.scale(.977204),a.l10=z.z.scale(.977204),a.l11=z.x.scale(.977204),a.l2_2=z.xy.scale(1.16538),a.l2_1=z.yz.scale(1.16538),a.l20=z.zz.scale(1.34567).sc(z.xx.scale(.672834)).sc(z.yy.scale(.672834)),a.l21=z.zx.scale(1.16538),a.l22=z.xx.scale(1.16538).sc(z.yy.scale(1.16538)),a.l1_1.scaleInPlace(-1),a.l11.scaleInPlace(-1),a.l2_1.scaleInPlace(-1),a.l21.scaleInPlace(-1),a.scaleInPlace(Math.PI),a}}class r{constructor(){this.x=v.o.Zero(),this.y=v.o.Zero(),this.z=v.o.Zero(),this.xx=v.o.Zero(),this.yy=v.o.Zero(),this.zz=v.o.Zero(),this.xy=v.o.Zero(),this.yz=v.o.Zero(),this.zx=v.o.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=M.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(z){T.b.gb[0].Xd(z.r,z.g,z.b);const a=T.b.gb[0];this.xx.addInPlace(a),this.yy.addInPlace(a),this.zz.addInPlace(a)}scaleInPlace(z){this.x.scaleInPlace(z),this.y.scaleInPlace(z),this.z.scaleInPlace(z),this.xx.scaleInPlace(z),this.yy.scaleInPlace(z),this.zz.scaleInPlace(z),this.yz.scaleInPlace(z),this.zx.scaleInPlace(z),this.xy.scaleInPlace(z)}updateFromHarmonics(z){return this._harmonics=z,this.x.p(z.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(z.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(z.l10),this.z.scaleInPlace(1.02333),this.xx.p(z.l00),T.b.gb[0].p(z.l20).scaleInPlace(.247708),T.b.gb[1].p(z.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).ri(T.b.gb[0]).addInPlace(T.b.gb[1]),this.yy.p(z.l00),this.yy.scaleInPlace(.886277).ri(T.b.gb[0]).ri(T.b.gb[1]),this.zz.p(z.l00),T.b.gb[0].p(z.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(T.b.gb[0]),this.yz.p(z.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(z.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(z.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(z){return(new r).updateFromHarmonics(z)}static Jg(z){const a=new r;return v.o.FromArrayToRef(z[0],0,a.x),v.o.FromArrayToRef(z[1],0,a.y),v.o.FromArrayToRef(z[2],0,a.z),v.o.FromArrayToRef(z[3],0,a.xx),v.o.FromArrayToRef(z[4],0,a.yy),v.o.FromArrayToRef(z[5],0,a.zz),v.o.FromArrayToRef(z[6],0,a.yz),v.o.FromArrayToRef(z[7],0,a.zx),v.o.FromArrayToRef(z[8],0,a.xy),a}}},11268:(z,a,K)=>{"use strict";K.d(a,{c:()=>M});var v=K(10941),T=K(10971),m=K(11194),p=K(11230),j=K(11161);K(11276);function s(z){let a=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const K=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],m=[];let s=[];const M=z.width||z.size||1,r=z.height||z.size||1,W=z.depth||z.size||1,F=z.wrap||!1;let G=void 0===z.topBaseAt?1:z.topBaseAt,l=void 0===z.bottomBaseAt?0:z.bottomBaseAt;G=(G+4)%4,l=(l+4)%4;let V=[2,0,3,1][G],c=[2,0,1,3][l],C=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(F){a=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],C=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let z=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],K=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const v=[17,18,19,16],T=[22,23,20,21];for(;V>0;)z.unshift(z.pop()),v.unshift(v.pop()),V--;for(;c>0;)K.unshift(K.pop()),T.unshift(T.pop()),c--;z=z.flat(),K=K.flat(),C=C.concat(z).concat(K),a.push(v[0],v[2],v[3],v[0],v[1],v[2]),a.push(T[0],T[2],T[3],T[0],T[1],T[2])}const w=[M/2,r/2,W/2];s=C.reduce(((z,a,K)=>z.concat(a*w[K%3])),[]);const H=0===z.sideOrientation?0:z.sideOrientation||p.b.DEFAULTSIDE,f=z.faceUV||new Array(6),Y=z.faceColors,I=[];for(let p=0;p<6;p++)void 0===f[p]&&(f[p]=new v.r(0,0,1,1)),Y&&void 0===Y[p]&&(Y[p]=new T.d(1,1,1,1));for(let v=0;v<6;v++)if(m.push(f[v].z,j.d?1-f[v].w:f[v].w),m.push(f[v].x,j.d?1-f[v].w:f[v].w),m.push(f[v].x,j.d?1-f[v].y:f[v].y),m.push(f[v].z,j.d?1-f[v].y:f[v].y),Y)for(let z=0;z<4;z++)I.push(Y[v].r,Y[v].g,Y[v].b,Y[v].a);p.b._ComputeSides(H,s,a,K,m,z.frontUVs,z.backUVs);const q=new p.b;if(q.indices=a,q.xa=s,q.ya=K,q.Aa=m,Y){const z=H===p.b.DOUBLESIDE?I.concat(I):I;q.za=z}return q}function M(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new m.c(z,K);a.sideOrientation=m.c._GetDefaultSideOrientation(a.sideOrientation),v._originalBuilderSideOrientation=a.sideOrientation;return s(a).Ca(v,a.updatable),v}p.b.CreateBox=s,m.c.CreateBox=function(z,a){return M(z,{size:a,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11591:(z,a,K)=>{"use strict";K.d(a,{e:()=>j});var v=K(11194),T=K(11230),m=K(11161);function p(z){const a=[],K=[],v=[],p=[],j=z.radius||.5,s=z.tessellation||64,M=z.arc&&(z.arc<=0||z.arc>1)?1:z.arc||1,r=0===z.sideOrientation?0:z.sideOrientation||T.b.DEFAULTSIDE;a.push(0,0,0),p.push(.5,.5);const W=2*Math.PI*M,F=1===M?W/s:W/(s-1);let G=0;for(let T=0;T<s;T++){const z=Math.cos(G),K=Math.sin(G),v=(z+1)/2,T=(1-K)/2;a.push(j*z,j*K,0),p.push(v,m.d?1-T:T),G+=F}1===M&&(a.push(a[3],a[4],a[5]),p.push(p[2],m.d?1-p[3]:p[3]));const l=a.length/3;for(let T=1;T<l-1;T++)K.push(T+1,0,T);T.b.ComputeNormals(a,K,v),T.b._ComputeSides(r,a,K,v,p,z.frontUVs,z.backUVs);const V=new T.b;return V.indices=K,V.xa=a,V.ya=v,V.Aa=p,V}function j(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new v.c(z,K);a.sideOrientation=v.c._GetDefaultSideOrientation(a.sideOrientation),T._originalBuilderSideOrientation=a.sideOrientation;return p(a).Ca(T,a.updatable),T}T.b.CreateDisc=p,v.c.CreateDisc=function(z,a,K){return j(z,{radius:a,tessellation:K,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11276:(z,a,K)=>{"use strict";K.d(a,{g:()=>c,e:()=>w,h:()=>C});var v=K(10941),T=K(10971),m=K(11194),p=K(11230),j=K(11001);m.c._GroundMeshParser=(z,a)=>s.Parse(z,a);class s extends m.c{constructor(z,a){super(z,a),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=z,this._subdivisionsY=z,this.subdivide(z);const K=this;K.createOrUpdateSubmeshesOctree&&K.createOrUpdateSubmeshesOctree(a)}getHeightAtCoordinates(z,a){const K=this.getWorldMatrix(),T=v.j.Matrix[5];K.invertToRef(T);const m=v.j.gb[8];if(v.o.TransformCoordinatesFromFloatsToRef(z,0,a,T,m),z=m.x,a=m.z,z<this._minX||z>=this._maxX||a<=this._minZ||a>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const p=this._getFacetAt(z,a),j=-(p.x*z+p.z*a+p.w)/p.y;return v.o.TransformCoordinatesFromFloatsToRef(0,j,0,K,m),m.y}getNormalAtCoordinates(z,a){const K=new v.o(0,1,0);return this.getNormalAtCoordinatesToRef(z,a,K),K}getNormalAtCoordinatesToRef(z,a,K){const T=this.getWorldMatrix(),m=v.j.Matrix[5];T.invertToRef(m);const p=v.j.gb[8];if(v.o.TransformCoordinatesFromFloatsToRef(z,0,a,m,p),z=p.x,a=p.z,z<this._minX||z>this._maxX||a<this._minZ||a>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const j=this._getFacetAt(z,a);return v.o.TransformNormalFromFloatsToRef(j.x,j.y,j.z,T,K),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(z,a){const K=Math.floor((z+this._maxX)*this._subdivisionsX/this._width),v=Math.floor(-(a+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),T=this._heightQuads[v*this._subdivisionsX+K];let m;return m=a<T.slope.x*z+T.slope.y?T.facet1:T.facet2,m}_initHeightQuads(){const z=this._subdivisionsX,a=this._subdivisionsY;this._heightQuads=new Array;for(let K=0;K<a;K++)for(let a=0;a<z;a++){const T={slope:v.m.Zero(),facet1:new v.r(0,0,0,0),facet2:new v.r(0,0,0,0)};this._heightQuads[K*z+a]=T}return this}_computeHeightQuads(){const z=this.getVerticesData(j.h.PositionKind);if(!z)return this;const a=v.j.gb[3],K=v.j.gb[2],T=v.j.gb[1],m=v.j.gb[0],p=v.j.gb[4],s=v.j.gb[5],M=v.j.gb[6],r=v.j.gb[7],W=v.j.gb[8];let F=0,G=0,l=0,V=0,c=0,C=0,w=0;const H=this._subdivisionsX,f=this._subdivisionsY;for(let j=0;j<f;j++)for(let f=0;f<H;f++){F=3*f,G=j*(H+1)*3,l=(j+1)*(H+1)*3,a.x=z[G+F],a.y=z[G+F+1],a.z=z[G+F+2],K.x=z[G+F+3],K.y=z[G+F+4],K.z=z[G+F+5],T.x=z[l+F],T.y=z[l+F+1],T.z=z[l+F+2],m.x=z[l+F+3],m.y=z[l+F+4],m.z=z[l+F+5],V=(m.z-a.z)/(m.x-a.x),c=a.z-V*a.x,K.subtractToRef(a,p),T.subtractToRef(a,s),m.subtractToRef(a,M),v.o.CrossToRef(M,s,r),v.o.CrossToRef(p,M,W),r.normalize(),W.normalize(),C=-(r.x*a.x+r.y*a.y+r.z*a.z),w=-(W.x*K.x+W.y*K.y+W.z*K.z);const Y=this._heightQuads[j*H+f];Y.slope.Xd(V,c),Y.facet1.Xd(r.x,r.y,r.z,C),Y.facet2.Xd(W.x,W.y,W.z,w)}return this}serialize(z){super.serialize(z),z.subdivisionsX=this._subdivisionsX,z.subdivisionsY=this._subdivisionsY,z.minX=this._minX,z.maxX=this._maxX,z.Yi=this._minZ,z.maxZ=this._maxZ,z.width=this._width,z.height=this._height}static Parse(z,a){const K=new s(z.name,a);return K._subdivisionsX=z.subdivisionsX||1,K._subdivisionsY=z.subdivisionsY||1,K._minX=z.minX,K._maxX=z.maxX,K._minZ=z.Yi,K._maxZ=z.maxZ,K._width=z.width,K._height=z.height,K}}var M=K(10631),r=K(10680),W=K(10946),F=K(11161);function G(z){const a=[],K=[],T=[],m=[];let j,s;const M=z.width||z.size||1,r=z.height||z.size||1,W=0|(z.subdivisionsX||z.subdivisions||1),G=0|(z.subdivisionsY||z.subdivisions||1);for(j=0;j<=G;j++)for(s=0;s<=W;s++){const z=new v.o(s*M/W-M/2,0,(G-j)*r/G-r/2),a=new v.o(0,1,0);K.push(z.x,z.y,z.z),T.push(a.x,a.y,a.z),m.push(s/W,F.d?j/G:1-j/G)}for(j=0;j<G;j++)for(s=0;s<W;s++)a.push(s+1+(j+1)*(W+1)),a.push(s+1+j*(W+1)),a.push(s+j*(W+1)),a.push(s+(j+1)*(W+1)),a.push(s+1+(j+1)*(W+1)),a.push(s+j*(W+1));const l=new p.b;return l.indices=a,l.xa=K,l.ya=T,l.Aa=m,l}function l(z){const a=void 0!==z.xmin&&null!==z.xmin?z.xmin:-1,K=void 0!==z.zmin&&null!==z.zmin?z.zmin:-1,T=void 0!==z.xmax&&null!==z.xmax?z.xmax:1,m=void 0!==z.zmax&&null!==z.zmax?z.zmax:1,j=z.subdivisions||{w:1,h:1},s=z.precision||{w:1,h:1},M=[],r=[],W=[],F=[];let G,l,V,c;j.h=j.h<1?1:j.h,j.w=j.w<1?1:j.w,s.w=s.w<1?1:s.w,s.h=s.h<1?1:s.h;const C=(T-a)/j.w,w=(m-K)/j.h;function H(z,a,K,T){const m=r.length/3,p=s.w+1;for(G=0;G<s.h;G++)for(l=0;l<s.w;l++){const z=[m+l+G*p,m+(l+1)+G*p,m+(l+1)+(G+1)*p,m+l+(G+1)*p];M.push(z[1]),M.push(z[2]),M.push(z[3]),M.push(z[0]),M.push(z[1]),M.push(z[3])}const j=v.o.Zero(),V=new v.o(0,1,0);for(G=0;G<=s.h;G++)for(j.z=G*(T-a)/s.h+a,l=0;l<=s.w;l++)j.x=l*(K-z)/s.w+z,j.y=0,r.push(j.x,j.y,j.z),W.push(V.x,V.y,V.z),F.push(l/s.w,G/s.h)}for(V=0;V<j.h;V++)for(c=0;c<j.w;c++)H(a+c*C,K+V*w,a+(c+1)*C,K+(V+1)*w);const f=new p.b;return f.indices=M,f.xa=r,f.ya=W,f.Aa=F,f}function V(z){const a=[],K=[],m=[],j=[];let s,M;const r=z.colorFilter||new T.c(.3,.59,.11),F=z.alphaFilter||0;let G=!1;if(z.minHeight>z.maxHeight){G=!0;const a=z.maxHeight;z.maxHeight=z.minHeight,z.minHeight=a}for(s=0;s<=z.subdivisions;s++)for(M=0;M<=z.subdivisions;M++){const a=new v.o(M*z.width/z.subdivisions-z.width/2,0,(z.subdivisions-s)*z.height/z.subdivisions-z.height/2),T=4*(((a.x+z.width/2)/z.width*(z.bufferWidth-1)|0)+((1-(a.z+z.height/2)/z.height)*(z.bufferHeight-1)|0)*z.bufferWidth);let p=z.buffer[T]/255,l=z.buffer[T+1]/255,V=z.buffer[T+2]/255;const c=z.buffer[T+3]/255;G&&(p=1-p,l=1-l,V=1-V);const C=p*r.r+l*r.g+V*r.b;a.y=c>=F?z.minHeight+(z.maxHeight-z.minHeight)*C:z.minHeight-W.e,z.heightBuffer&&(z.heightBuffer[s*(z.subdivisions+1)+M]=a.y),K.push(a.x,a.y,a.z),m.push(0,0,0),j.push(M/z.subdivisions,1-s/z.subdivisions)}for(s=0;s<z.subdivisions;s++)for(M=0;M<z.subdivisions;M++){const v=M+1+(s+1)*(z.subdivisions+1),T=M+1+s*(z.subdivisions+1),m=M+s*(z.subdivisions+1),p=M+(s+1)*(z.subdivisions+1),j=K[3*v+1]>=z.minHeight,r=K[3*T+1]>=z.minHeight,W=K[3*m+1]>=z.minHeight;j&&r&&W&&(a.push(v),a.push(T),a.push(m));K[3*p+1]>=z.minHeight&&j&&W&&(a.push(p),a.push(v),a.push(m))}p.b.ComputeNormals(K,a,m);const l=new p.b;return l.indices=a,l.xa=K,l.ya=m,l.Aa=j,l}function c(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const K=new s(z,arguments.length>2?arguments[2]:void 0);K._setReady(!1),K._subdivisionsX=a.subdivisionsX||a.subdivisions||1,K._subdivisionsY=a.subdivisionsY||a.subdivisions||1,K._width=a.width||1,K._height=a.height||1,K._maxX=K._width/2,K._maxZ=K._height/2,K._minX=-K._maxX,K._minZ=-K._maxZ;return G(a).Ca(K,a.updatable),K._setReady(!0),K}function C(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new m.c(z,K);return l(a).Ca(v,a.updatable),v}function w(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const m=K.width||10,p=K.height||10,j=K.subdivisions||1,W=K.minHeight||0,F=K.maxHeight||1,G=K.colorFilter||new T.c(.3,.59,.11),l=K.alphaFilter||0,c=K.updatable,C=K.onReady;v=v||r.b.LastCreatedScene;const w=new s(z,v);let H;w._subdivisionsX=j,w._subdivisionsY=j,w._width=m,w._height=p,w._maxX=w._width/2,w._maxZ=w._height/2,w._minX=-w._maxX,w._minZ=-w._maxZ,w._setReady(!1),K.passHeightBufferInCallback&&(H=new Float32Array((j+1)*(j+1)));const f=(z,a,K)=>{V({width:m,height:p,subdivisions:j,minHeight:W,maxHeight:F,colorFilter:G,buffer:z,bufferWidth:a,bufferHeight:K,alphaFilter:l,heightBuffer:H}).Ca(w,c),C&&C(w,H),w._setReady(!0)};if("string"===typeof a){const z=z=>{var a;const K=z.width,T=z.height;if(v.u)return;const m=null===(a=v)||void 0===a?void 0:a.getEngine().resizeImageBitmap(z,K,T);f(m,K,T)};M.h.LoadImage(a,z,K.onError?K.onError:()=>{},v.offlineProvider)}else f(a.data,a.width,a.height);return w}p.b.CreateGround=G,p.b.CreateTiledGround=l,p.b.CreateGroundFromHeightMap=V,m.c.CreateGround=(z,a,K,v,T,m)=>c(z,{width:a,height:K,subdivisions:v,updatable:m},T),m.c.CreateTiledGround=(z,a,K,v,T,m,p,j,s)=>C(z,{xmin:a,zmin:K,xmax:v,zmax:T,subdivisions:m,precision:p,updatable:s},j),m.c.CreateGroundFromHeightMap=(z,a,K,v,T,m,p,j,s,M,r)=>w(z,a,{width:K,height:v,subdivisions:T,minHeight:m,maxHeight:p,updatable:s,onReady:M,alphaFilter:r},j)},12370:(z,a,K)=>{"use strict";K.d(a,{c:()=>n,f:()=>y,j:()=>i});var v=K(10941),T=K(11194),m=K(11230),p=K(10971),j=K(11001),s=K(11944),M=K(11064),r=K(10973),W=K(10935),F=K(11134),G=K(10767),l=K(11174),V=K(10672),c=K(11130),C=K(10680),w=K(11119),H=K(11114);const f={effect:null,subMesh:null};class Y extends c.c{constructor(z,a,K){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(z,a,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new v.b,this._cachedWorldViewProjectionMatrix=new v.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=K,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","k","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...T}}get shaderPath(){return this._shaderPath}set shaderPath(z){this._shaderPath=z}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(z){-1===this._options.uniforms.indexOf(z)&&this._options.uniforms.push(z)}setTexture(z,a){return-1===this._options.samplers.indexOf(z)&&this._options.samplers.push(z),this._textures[z]=a,this}removeTexture(z){delete this._textures[z]}setTextureArray(z,a){return-1===this._options.samplers.indexOf(z)&&this._options.samplers.push(z),this._checkUniform(z),this._textureArrays[z]=a,this}setExternalTexture(z,a){return-1===this._options.externalTextures.indexOf(z)&&this._options.externalTextures.push(z),this._externalTextures[z]=a,this}setFloat(z,a){return this._checkUniform(z),this._floats[z]=a,this}setInt(z,a){return this._checkUniform(z),this._ints[z]=a,this}setUInt(z,a){return this._checkUniform(z),this._uints[z]=a,this}setFloats(z,a){return this._checkUniform(z),this._floatsArrays[z]=a,this}setColor3(z,a){return this._checkUniform(z),this._colors3[z]=a,this}setColor3Array(z,a){return this._checkUniform(z),this._colors3Arrays[z]=a.reduce(((z,a)=>(a.toArray(z,z.length),z)),[]),this}setColor4(z,a){return this._checkUniform(z),this._colors4[z]=a,this}setColor4Array(z,a){return this._checkUniform(z),this._colors4Arrays[z]=a.reduce(((z,a)=>(a.toArray(z,z.length),z)),[]),this}setVector2(z,a){return this._checkUniform(z),this._vectors2[z]=a,this}setVector3(z,a){return this._checkUniform(z),this._vectors3[z]=a,this}setVector4(z,a){return this._checkUniform(z),this._vectors4[z]=a,this}setQuaternion(z,a){return this._checkUniform(z),this._quaternions[z]=a,this}setQuaternionArray(z,a){return this._checkUniform(z),this._quaternionsArrays[z]=a.reduce(((z,a)=>(a.toArray(z,z.length),z)),[]),this}setMatrix(z,a){return this._checkUniform(z),this._matrices[z]=a,this}setMatrices(z,a){this._checkUniform(z);const K=new Float32Array(16*a.length);for(let v=0;v<a.length;v++){a[v].copyToArray(K,16*v)}return this._matrixArrays[z]=K,this}setMatrix3x3(z,a){return this._checkUniform(z),this._matrices3x3[z]=a,this}setMatrix2x2(z,a){return this._checkUniform(z),this._matrices2x2[z]=a,this}setArray2(z,a){return this._checkUniform(z),this._vectors2Arrays[z]=a,this}setArray3(z,a){return this._checkUniform(z),this._vectors3Arrays[z]=a,this}setArray4(z,a){return this._checkUniform(z),this._vectors4Arrays[z]=a,this}setUniformBuffer(z,a){return-1===this._options.uniformBuffers.indexOf(z)&&this._options.uniformBuffers.push(z),this._uniformBuffers[z]=a,this}setTextureSampler(z,a){return-1===this._options.samplerObjects.indexOf(z)&&this._options.samplerObjects.push(z),this._textureSamplers[z]=a,this}setStorageBuffer(z,a){return-1===this._options.storageBuffers.indexOf(z)&&this._options.storageBuffers.push(z),this._storageBuffers[z]=a,this}setDefine(z,a){const K=z.trimEnd()+" ",v=this.options.defines.findIndex((a=>a===z||a.startsWith(K)));return v>=0&&this.options.defines.splice(v,1),("boolean"!==typeof a||a)&&this.options.defines.push(K+a),this}isReadyForSubMesh(z,a,K){return this.isReady(z,K,a)}isReady(z,a,K){var v;const T=K&&this._storeEffectOnSubMeshes;if(this.isFrozen){const z=T?K._drawWrapper:this._drawWrapper;if(z.effect&&z._wasPreviouslyReady&&z._wasPreviouslyUsingInstances===a)return!0}const m=this.va(),p=m.getEngine(),s=[],M=[],r=new l.d;let F=this._shaderPath,G=this._options.uniforms,V=this._options.uniformBuffers,c=this._options.samplers;p.getCaps().multiview&&m.activeCamera&&m.activeCamera.outputRenderTarget&&m.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,s.push("#define MULTIVIEW"),-1!==G.indexOf("viewProjection")&&-1===G.indexOf("viewProjectionR")&&G.push("viewProjectionR"));for(let j=0;j<this._options.defines.length;j++){const z=0===this._options.defines[j].indexOf("#define")?this._options.defines[j]:`#define ${this._options.defines[j]}`;s.push(z)}for(let j=0;j<this._options.attributes.length;j++)M.push(this._options.attributes[j]);if(z&&z.isVerticesDataPresent(j.h.ColorKind)&&(-1===M.indexOf(j.h.ColorKind)&&M.push(j.h.ColorKind),s.push("#define VERTEXCOLOR")),a&&(s.push("#define INSTANCES"),(0,H.nb)(M,this._materialHelperNeedsPreviousMatrices),null!==z&&void 0!==z&&z.hasThinInstances&&(s.push("#define THIN_INSTANCES"),z&&z.isVerticesDataPresent(j.h.ColorInstanceKind)&&(M.push(j.h.ColorInstanceKind),s.push("#define INSTANCESCOLOR")))),z&&z.useBones&&z.computeBonesUsingShaders&&z.skeleton){M.push(j.h.MatricesIndicesKind),M.push(j.h.MatricesWeightsKind),z.numBoneInfluencers>4&&(M.push(j.h.MatricesIndicesExtraKind),M.push(j.h.MatricesWeightsExtraKind));const a=z.skeleton;s.push("#define NUM_BONE_INFLUENCERS "+z.numBoneInfluencers),r.addCPUSkinningFallback(0,z),a.isUsingTextureForMatrices?(s.push("#define BONETEXTURE"),-1===G.indexOf("boneTextureWidth")&&G.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(s.push("#define BonesPerMesh "+(a.bones.length+1)),-1===G.indexOf("mBones")&&G.push("mBones"))}else s.push("#define NUM_BONE_INFLUENCERS 0");let C=0;const Y=z?z.morphTargetManager:null;if(Y){const z=Y.supportsUVs&&-1!==s.indexOf("#define UV1"),a=Y.supportsTangents&&-1!==s.indexOf("#define TANGENT"),K=Y.supportsNormals&&-1!==s.indexOf("#define NORMAL");C=Y.numMaxInfluencers||Y.numInfluencers,z&&s.push("#define MORPHTARGETS_UV"),a&&s.push("#define MORPHTARGETS_TANGENT"),K&&s.push("#define MORPHTARGETS_NORMAL"),C>0&&s.push("#define MORPHTARGETS"),Y.isUsingTextureForTargets&&(s.push("#define MORPHTARGETS_TEXTURE"),-1===G.indexOf("morphTargetTextureIndices")&&G.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),s.push("#define NUM_MORPH_INFLUENCERS "+C);for(let v=0;v<C;v++)M.push(j.h.PositionKind+v),K&&M.push(j.h.NormalKind+v),a&&M.push(j.h.TangentKind+v),z&&M.push(j.h.UVKind+"_"+v);C>0&&(G=G.slice(),G.push("morphTargetInfluences"),G.push("morphTargetCount"),G.push("morphTargetTextureInfo"),G.push("morphTargetTextureIndices"))}else s.push("#define NUM_MORPH_INFLUENCERS 0");if(z){const a=z.bakedVertexAnimationManager;a&&a.isEnabled&&(s.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===G.indexOf("bakedVertexAnimationSettings")&&G.push("bakedVertexAnimationSettings"),-1===G.indexOf("bakedVertexAnimationTextureSizeInverted")&&G.push("bakedVertexAnimationTextureSizeInverted"),-1===G.indexOf("bakedVertexAnimationTime")&&G.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,H.C)(M,z,s)}for(const j in this._textures)if(!this._textures[j].isReady())return!1;z&&this._shouldTurnAlphaTestOn(z)&&s.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,w.e)(G),(0,w.m)(this,m,s)),m.fogEnabled&&null!==z&&void 0!==z&&z.applyFog&&m.fogMode!==W.c.FOGMODE_NONE&&(s.push("#define FOG"),-1===G.indexOf("view")&&G.push("view"),-1===G.indexOf("vFogInfos")&&G.push("vFogInfos"),-1===G.indexOf("vFogColor")&&G.push("vFogColor")),this._useLogarithmicDepth&&(s.push("#define LOGARITHMICDEPTH"),-1===G.indexOf("logarithmicDepthConstant")&&G.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(G=G.slice(),V=V.slice(),c=c.slice(),F=this.customShaderNameResolve(this.name,G,V,c,s,M));const I=T?K._getDrawWrapper(void 0,!0):this._drawWrapper,q=(null===I||void 0===I?void 0:I.effect)??null,B=(null===I||void 0===I?void 0:I.defines)??null,x=s.join("\n");let Z=q;return B!==x&&(Z=p.createEffect(F,{attributes:M,uniformsNames:G,uniformBuffersNames:V,samplers:c,defines:x,fallbacks:r,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:C},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},p),T?K.setEffect(Z,x,this._materialContext):I&&I.setEffect(Z,x),this._onEffectCreatedObservable&&(f.effect=Z,f.subMesh=K??(null===z||void 0===z?void 0:z.Vf[0])??null,this._onEffectCreatedObservable.notifyObservers(f))),I._wasPreviouslyUsingInstances=!!a,!((null===(v=Z)||void 0===v||!v.isReady())??1)&&(q!==Z&&m.resetCachedMaterial(),I._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(z,a){const K=this.va(),v=a??this.getEffect();v&&(-1!==this._options.uniforms.indexOf("world")&&v.setMatrix("world",z),-1!==this._options.uniforms.indexOf("worldView")&&(z.multiplyToRef(K.getViewMatrix(),this._cachedWorldViewMatrix),v.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(z.multiplyToRef(K.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),v.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&v.setMatrix("view",K.getViewMatrix()))}bindForSubMesh(z,a,K){var v;this.bind(z,a,null===(v=K._drawWrapperOverride)||void 0===v?void 0:v.effect,K)}bind(z,a,K,v){const T=v&&this._storeEffectOnSubMeshes,m=K??(T?v.effect:this.getEffect());if(!m)return;const p=this.va();this._activeEffect=m,this.bindOnlyWorldMatrix(z,K);const j=this._options.uniformBuffers;let s=!1;if(m&&j&&j.length>0&&p.getEngine().supportsUniformBuffers)for(let W=0;W<j.length;++W){switch(j[W]){case"Mesh":a&&(a.getMeshUniformBuffer().bindToEffect(m,"Mesh"),a.transferToEffect(z));break;case"Scene":(0,H.r)(m,p.getSceneUniformBuffer()),p.finalizeSceneUbo(),s=!0}}const M=a&&T?this._mustRebind(p,m,v,a.visibility):p.getCachedMaterial()!==this;if(m&&M){let z;for(z in s||-1===this._options.uniforms.indexOf("view")||m.setMatrix("view",p.getViewMatrix()),s||-1===this._options.uniforms.indexOf("projection")||m.setMatrix("projection",p.getProjectionMatrix()),s||-1===this._options.uniforms.indexOf("viewProjection")||(m.setMatrix("viewProjection",p.getTransformMatrix()),this._multiview&&m.setMatrix("viewProjectionR",p._transformMatrixR)),p.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&m.setVector3("cameraPosition",p.activeCamera.globalPosition),(0,H.e)(a,m),(0,w.h)(m,this,p),this._useLogarithmicDepth&&(0,H.m)(T?v.materialDefines:m.defines,m,p),a&&(0,H.h)(p,a,m),this._textures)m.setTexture(z,this._textures[z]);for(z in this._textureArrays)m.setTextureArray(z,this._textureArrays[z]);for(z in this._ints)m.setInt(z,this._ints[z]);for(z in this._uints)m.setUInt(z,this._uints[z]);for(z in this._floats)m.setFloat(z,this._floats[z]);for(z in this._floatsArrays)m.setArray(z,this._floatsArrays[z]);for(z in this._colors3)m.setColor3(z,this._colors3[z]);for(z in this._colors3Arrays)m.setArray3(z,this._colors3Arrays[z]);for(z in this._colors4){const a=this._colors4[z];m.setFloat4(z,a.r,a.g,a.b,a.a)}for(z in this._colors4Arrays)m.setArray4(z,this._colors4Arrays[z]);for(z in this._vectors2)m.setVector2(z,this._vectors2[z]);for(z in this._vectors3)m.setVector3(z,this._vectors3[z]);for(z in this._vectors4)m.setVector4(z,this._vectors4[z]);for(z in this._quaternions)m.setQuaternion(z,this._quaternions[z]);for(z in this._matrices)m.setMatrix(z,this._matrices[z]);for(z in this._matrixArrays)m.setMatrices(z,this._matrixArrays[z]);for(z in this._matrices3x3)m.setMatrix3x3(z,this._matrices3x3[z]);for(z in this._matrices2x2)m.setMatrix2x2(z,this._matrices2x2[z]);for(z in this._vectors2Arrays)m.setArray2(z,this._vectors2Arrays[z]);for(z in this._vectors3Arrays)m.setArray3(z,this._vectors3Arrays[z]);for(z in this._vectors4Arrays)m.setArray4(z,this._vectors4Arrays[z]);for(z in this._quaternionsArrays)m.setArray4(z,this._quaternionsArrays[z]);for(z in this._uniformBuffers){const a=this._uniformBuffers[z].getBuffer();a&&m.bindUniformBuffer(a,z)}const K=p.getEngine(),j=K.setExternalTexture;if(j)for(z in this._externalTextures)j.call(K,z,this._externalTextures[z]);const M=K.setTextureSampler;if(M)for(z in this._textureSamplers)M.call(K,z,this._textureSamplers[z]);const r=K.setStorageBuffer;if(r)for(z in this._storageBuffers)r.call(K,z,this._storageBuffers[z])}if(m&&a&&(M||!this.isFrozen)){const z=a.morphTargetManager;z&&z.numInfluencers>0&&(0,H.p)(a,m);const K=a.bakedVertexAnimationManager;if(K&&K.isEnabled){var r;const z=T?v._drawWrapper:this._drawWrapper;null===(r=a.bakedVertexAnimationManager)||void 0===r||r.bind(m,!!z._wasPreviouslyUsingInstances)}}this._afterBind(a,m,v)}getActiveTextures(){const z=super.getActiveTextures();for(const a in this._textures)z.push(this._textures[a]);for(const a in this._textureArrays){const K=this._textureArrays[a];for(let a=0;a<K.length;a++)z.push(K[a])}return z}hasTexture(z){if(super.hasTexture(z))return!0;for(const a in this._textures)if(this._textures[a]===z)return!0;for(const a in this._textureArrays){const K=this._textureArrays[a];for(let a=0;a<K.length;a++)if(K[a]===z)return!0}return!1}clone(z){const a=r.e.Clone((()=>new Y(z,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);a.name=z,a.id=z,"object"===typeof a._shaderPath&&(a._shaderPath={...a._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((z=>{const a=this._options[z];Array.isArray(a)&&(this._options[z]=a.slice(0))})),this.stencil.copyTo(a.stencil);for(const K in this._textures)a.setTexture(K,this._textures[K]);for(const K in this._textureArrays)a.setTextureArray(K,this._textureArrays[K]);for(const K in this._externalTextures)a.setExternalTexture(K,this._externalTextures[K]);for(const K in this._ints)a.setInt(K,this._ints[K]);for(const K in this._uints)a.setUInt(K,this._uints[K]);for(const K in this._floats)a.setFloat(K,this._floats[K]);for(const K in this._floatsArrays)a.setFloats(K,this._floatsArrays[K]);for(const K in this._colors3)a.setColor3(K,this._colors3[K]);for(const K in this._colors3Arrays)a._colors3Arrays[K]=this._colors3Arrays[K];for(const K in this._colors4)a.setColor4(K,this._colors4[K]);for(const K in this._colors4Arrays)a._colors4Arrays[K]=this._colors4Arrays[K];for(const K in this._vectors2)a.setVector2(K,this._vectors2[K]);for(const K in this._vectors3)a.setVector3(K,this._vectors3[K]);for(const K in this._vectors4)a.setVector4(K,this._vectors4[K]);for(const K in this._quaternions)a.setQuaternion(K,this._quaternions[K]);for(const K in this._quaternionsArrays)a._quaternionsArrays[K]=this._quaternionsArrays[K];for(const K in this._matrices)a.setMatrix(K,this._matrices[K]);for(const K in this._matrixArrays)a._matrixArrays[K]=this._matrixArrays[K].slice();for(const K in this._matrices3x3)a.setMatrix3x3(K,this._matrices3x3[K]);for(const K in this._matrices2x2)a.setMatrix2x2(K,this._matrices2x2[K]);for(const K in this._vectors2Arrays)a.setArray2(K,this._vectors2Arrays[K]);for(const K in this._vectors3Arrays)a.setArray3(K,this._vectors3Arrays[K]);for(const K in this._vectors4Arrays)a.setArray4(K,this._vectors4Arrays[K]);for(const K in this._uniformBuffers)a.setUniformBuffer(K,this._uniformBuffers[K]);for(const K in this._textureSamplers)a.setTextureSampler(K,this._textureSamplers[K]);for(const K in this._storageBuffers)a.setStorageBuffer(K,this._storageBuffers[K]);return a}dispose(z,a,K){if(a){let z;for(z in this._textures)this._textures[z].dispose();for(z in this._textureArrays){const a=this._textureArrays[z];for(let z=0;z<a.length;z++)a[z].dispose()}}this._textures={},super.dispose(z,a,K)}serialize(){const z=r.e.Serialize(this);let a;for(a in z.customType="BABYLON.ShaderMaterial",z.uniqueId=this.uniqueId,z.options=this._options,z.shaderPath=this._shaderPath,z.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,z.stencil=this.stencil.serialize(),z.textures={},this._textures)z.textures[a]=this._textures[a].serialize();for(a in z.textureArrays={},this._textureArrays){z.textureArrays[a]=[];const K=this._textureArrays[a];for(let v=0;v<K.length;v++)z.textureArrays[a].push(K[v].serialize())}for(a in z.ints={},this._ints)z.ints[a]=this._ints[a];for(a in z.uints={},this._uints)z.uints[a]=this._uints[a];for(a in z.floats={},this._floats)z.floats[a]=this._floats[a];for(a in z.floatsArrays={},this._floatsArrays)z.floatsArrays[a]=this._floatsArrays[a];for(a in z.colors3={},this._colors3)z.colors3[a]=this._colors3[a].kj();for(a in z.colors3Arrays={},this._colors3Arrays)z.colors3Arrays[a]=this._colors3Arrays[a];for(a in z.colors4={},this._colors4)z.colors4[a]=this._colors4[a].kj();for(a in z.colors4Arrays={},this._colors4Arrays)z.colors4Arrays[a]=this._colors4Arrays[a];for(a in z.vectors2={},this._vectors2)z.vectors2[a]=this._vectors2[a].kj();for(a in z.vectors3={},this._vectors3)z.vectors3[a]=this._vectors3[a].kj();for(a in z.vectors4={},this._vectors4)z.vectors4[a]=this._vectors4[a].kj();for(a in z.quaternions={},this._quaternions)z.quaternions[a]=this._quaternions[a].kj();for(a in z.matrices={},this._matrices)z.matrices[a]=this._matrices[a].kj();for(a in z.matrixArray={},this._matrixArrays)z.matrixArray[a]=this._matrixArrays[a];for(a in z.matrices3x3={},this._matrices3x3)z.matrices3x3[a]=this._matrices3x3[a];for(a in z.matrices2x2={},this._matrices2x2)z.matrices2x2[a]=this._matrices2x2[a];for(a in z.vectors2Arrays={},this._vectors2Arrays)z.vectors2Arrays[a]=this._vectors2Arrays[a];for(a in z.vectors3Arrays={},this._vectors3Arrays)z.vectors3Arrays[a]=this._vectors3Arrays[a];for(a in z.vectors4Arrays={},this._vectors4Arrays)z.vectors4Arrays[a]=this._vectors4Arrays[a];for(a in z.quaternionsArrays={},this._quaternionsArrays)z.quaternionsArrays[a]=this._quaternionsArrays[a];return z}static Parse(z,a,K){const T=r.e.Parse((()=>new Y(z.name,a,z.shaderPath,z.options,z.storeEffectOnSubMeshes)),z,a,K);let m;for(m in z.stencil&&T.stencil.parse(z.stencil,a,K),z.textures)T.setTexture(m,F.d.Parse(z.textures[m],a,K));for(m in z.textureArrays){const v=z.textureArrays[m],p=[];for(let z=0;z<v.length;z++)p.push(F.d.Parse(v[z],a,K));T.setTextureArray(m,p)}for(m in z.ints)T.setInt(m,z.ints[m]);for(m in z.uints)T.setUInt(m,z.uints[m]);for(m in z.floats)T.setFloat(m,z.floats[m]);for(m in z.floatsArrays)T.setFloats(m,z.floatsArrays[m]);for(m in z.colors3)T.setColor3(m,p.c.Jg(z.colors3[m]));for(m in z.colors3Arrays){const a=z.colors3Arrays[m].reduce(((z,a,K)=>(K%3===0?z.push([a]):z[z.length-1].push(a),z)),[]).map((z=>p.c.Jg(z)));T.setColor3Array(m,a)}for(m in z.colors4)T.setColor4(m,p.d.Jg(z.colors4[m]));for(m in z.colors4Arrays){const a=z.colors4Arrays[m].reduce(((z,a,K)=>(K%4===0?z.push([a]):z[z.length-1].push(a),z)),[]).map((z=>p.d.Jg(z)));T.setColor4Array(m,a)}for(m in z.vectors2)T.setVector2(m,v.m.Jg(z.vectors2[m]));for(m in z.vectors3)T.setVector3(m,v.o.Jg(z.vectors3[m]));for(m in z.vectors4)T.setVector4(m,v.r.Jg(z.vectors4[m]));for(m in z.quaternions)T.setQuaternion(m,v.f.Jg(z.quaternions[m]));for(m in z.matrices)T.setMatrix(m,v.b.Jg(z.matrices[m]));for(m in z.matrixArray)T._matrixArrays[m]=new Float32Array(z.matrixArray[m]);for(m in z.matrices3x3)T.setMatrix3x3(m,z.matrices3x3[m]);for(m in z.matrices2x2)T.setMatrix2x2(m,z.matrices2x2[m]);for(m in z.vectors2Arrays)T.setArray2(m,z.vectors2Arrays[m]);for(m in z.vectors3Arrays)T.setArray3(m,z.vectors3Arrays[m]);for(m in z.vectors4Arrays)T.setArray4(m,z.vectors4Arrays[m]);for(m in z.quaternionsArrays)T.setArray4(m,z.quaternionsArrays[m]);return T}static ParseFromFileAsync(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((T,m)=>{const p=new V.b;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){const a=JSON.parse(p.responseText),m=this.Parse(a,K||C.b.LastCreatedScene,v);z&&(m.name=z),T(m)}else m("Unable to load the ShaderMaterial")})),p.open("GET",a),p.send()}))}static ParseFromSnippetAsync(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((v,T)=>{const m=new V.b;m.addEventListener("readystatechange",(()=>{if(4==m.readyState)if(200==m.status){const T=JSON.parse(JSON.parse(m.responseText).jsonPayload),p=JSON.parse(T.shaderMaterial),j=this.Parse(p,a||C.b.LastCreatedScene,K);j.snippetId=z,v(j)}else T("Unable to load the snippet "+z)})),m.open("GET",this.SnippetUrl+"/"+z.replace(/#/g,"/")),m.send()}))}}Y.SnippetUrl="https://snippet.babylonjs.com",Y.CreateFromSnippetAsync=Y.ParseFromSnippetAsync,(0,G.e)("BABYLON.ShaderMaterial",Y),T.c._LinesMeshParser=(z,a)=>I.Parse(z,a);class I extends T.c{_isShaderMaterial(z){return"ShaderMaterial"===z.getClassName()}constructor(z){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>5?arguments[5]:void 0,T=arguments.length>6?arguments[6]:void 0,m=arguments.length>7?arguments[7]:void 0;super(z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a,arguments.length>4?arguments[4]:void 0),this.useVertexColor=v,this.useVertexAlpha=T,this.color=new p.c(1,1,1),this.alpha=1,this._shaderLanguage=0,a&&(this.color=a.color.clone(),this.alpha=a.alpha,this.useVertexColor=a.useVertexColor,this.useVertexAlpha=a.useVertexAlpha),this.intersectionThreshold=.1;const s={attributes:[j.h.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===T?s.needAlphaBlending=!1:s.defines.push("#define VERTEXALPHA"),v?(s.defines.push("#define VERTEXCOLOR"),s.attributes.push(j.h.ColorKind)):(s.uniforms.push("color"),this._color4=new p.d),m)this.material=m;else{this.va().getEngine().isWebGPU&&!I.ForceGLSL&&(this._shaderLanguage=1),s.shaderLanguage=this._shaderLanguage,s.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([K.e(23).then(K.bind(K,13239)),K.e(47).then(K.bind(K,13245))]):await Promise.all([K.e(28).then(K.bind(K,13253)),K.e(48).then(K.bind(K,13260))])},this.material=new Y("colorShader",this.va(),"color",s,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(z){this._lineMaterial=z,this._lineMaterial.fillMode=M.b.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(z){}_bind(z,a){if(!this._geometry)return this;const K=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(a,K):this._geometry._bind(a,K,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:z,g:a,b:K}=this.color;this._color4.set(z,a,K,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(z,a,K){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const v=this.va().getEngine();return this._unIndexed?v.drawArraysType(M.b.LineListDrawMode,z.verticesStart,z.verticesCount,K):v.drawElementsType(M.b.LineListDrawMode,z.indexStart,z.indexCount,K),this}dispose(z){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(z)}clone(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0;return new I(z,this.va(),a,this,K)}createInstance(z){const a=new q(z,this);if(this.instancedBuffers){a.instancedBuffers={};for(const z in this.instancedBuffers)a.instancedBuffers[z]=this.instancedBuffers[z]}return a}serialize(z){super.serialize(z),z.color=this.color.kj(),z.alpha=this.alpha}static Parse(z,a){const K=new I(z.name,a);return K.color=p.c.Jg(z.color),K.alpha=z.alpha,K}}I.ForceGLSL=!1;class q extends s.e{constructor(z,a){super(z,a),this.intersectionThreshold=a.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var B=K(10648);function x(z){const a=[],K=[],v=z.lines,T=z.za,p=[];let j=0;for(let m=0;m<v.length;m++){const z=v[m];for(let v=0;v<z.length;v++){const{x:s,y:M,z:r}=z[v];if(K.push(s,M,r),T){const z=T[m],{r:a,g:K,b:j,a:s}=z[v];p.push(a,K,j,s)}v>0&&(a.push(j-1),a.push(j)),j++}}const s=new m.b;return s.indices=a,s.xa=K,T&&(s.za=p),s}function Z(z){const a=z.dashSize||3,K=z.gapSize||1,T=z.dashNb||200,p=z.points,j=[],s=[],M=v.o.Zero();let r=0,W=0,F=0,G=0,l=0,V=0,c=0;for(c=0;c<p.length-1;c++)p[c+1].subtractToRef(p[c],M),r+=M.length();for(F=r/T,G=a*F/(a+K),c=0;c<p.length-1;c++){p[c+1].subtractToRef(p[c],M),W=Math.floor(M.length()/F),M.normalize();for(let z=0;z<W;z++)l=F*z,j.push(p[c].x+l*M.x,p[c].y+l*M.y,p[c].z+l*M.z),j.push(p[c].x+(l+G)*M.x,p[c].y+(l+G)*M.y,p[c].z+(l+G)*M.z),s.push(V,V+1),V+=2}const C=new m.b;return C.xa=j,C.indices=s,C}function y(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=a.instance,T=a.lines,m=a.za;if(v){const z=v.getVerticesData(j.h.PositionKind);let a,K;m&&(a=v.getVerticesData(j.h.ColorKind));let p=0,s=0;for(let v=0;v<T.length;v++){const j=T[v];for(let T=0;T<j.length;T++)z[p]=j[T].x,z[p+1]=j[T].y,z[p+2]=j[T].z,m&&a&&(K=m[v],a[s]=K[T].r,a[s+1]=K[T].g,a[s+2]=K[T].b,a[s+3]=K[T].a,s+=4),p+=3}return v.updateVerticesData(j.h.PositionKind,z,!1,!1),m&&a&&v.updateVerticesData(j.h.ColorKind,a,!1,!1),v.refreshBoundingInfo(),v}const p=new I(z,K,null,void 0,void 0,!!m,a.useVertexAlpha,a.material);return x(a).Ca(p,a.updatable),p}function i(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=a.za?[a.za]:null;return y(z,{lines:[a.points],updatable:a.updatable,instance:a.instance,za:v,useVertexAlpha:a.useVertexAlpha,material:a.material},K)}function n(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=a.points,p=a.instance,j=a.gapSize||1,s=a.dashSize||3;if(p){const z=z=>{const a=v.o.Zero(),K=z.length/6;let T=0,j=0,s=0,M=0,r=0,W=0,F=0,G=0;for(F=0;F<m.length-1;F++)m[F+1].subtractToRef(m[F],a),T+=a.length();s=T/K;const l=p._creationDataStorage.dashSize;for(M=l*s/(l+p._creationDataStorage.gapSize),F=0;F<m.length-1;F++)for(m[F+1].subtractToRef(m[F],a),j=Math.floor(a.length()/s),a.normalize(),G=0;G<j&&W<z.length;)r=s*G,z[W]=m[F].x+r*a.x,z[W+1]=m[F].y+r*a.y,z[W+2]=m[F].z+r*a.z,z[W+3]=m[F].x+(r+M)*a.x,z[W+4]=m[F].y+(r+M)*a.y,z[W+5]=m[F].z+(r+M)*a.z,W+=6,G++;for(;W<z.length;)z[W]=m[F].x,z[W+1]=m[F].y,z[W+2]=m[F].z,W+=3};return(a.dashNb||a.dashSize||a.gapSize||a.useVertexAlpha||a.material)&&B.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),p.updateMeshPositions(z,!1),p}const M=new I(z,K,null,void 0,void 0,void 0,a.useVertexAlpha,a.material);return Z(a).Ca(M,a.updatable),M._creationDataStorage=new T.g,M._creationDataStorage.dashSize=s,M._creationDataStorage.gapSize=j,M}m.b.CreateLineSystem=x,m.b.CreateDashedLines=Z,T.c.ub=function(z,a){return i(z,{points:a,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},T.c.CreateDashedLines=function(z,a,K,v,T){return n(z,{points:a,dashSize:K,gapSize:v,dashNb:T,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11326:(z,a,K)=>{"use strict";K.d(a,{b:()=>j,f:()=>s});var v=K(11194),T=K(11230),m=K(11161);function p(z){const a=[],K=[],v=[],p=[],j=z.width||z.size||1,s=z.height||z.size||1,M=0===z.sideOrientation?0:z.sideOrientation||T.b.DEFAULTSIDE,r=j/2,W=s/2;K.push(-r,-W,0),v.push(0,0,-1),p.push(0,m.d?1:0),K.push(r,-W,0),v.push(0,0,-1),p.push(1,m.d?1:0),K.push(r,W,0),v.push(0,0,-1),p.push(1,m.d?0:1),K.push(-r,W,0),v.push(0,0,-1),p.push(0,m.d?0:1),a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),T.b._ComputeSides(M,K,a,v,p,z.frontUVs,z.backUVs);const F=new T.b;return F.indices=a,F.xa=K,F.ya=v,F.Aa=p,F}function j(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new v.c(z,K);a.sideOrientation=v.c._GetDefaultSideOrientation(a.sideOrientation),T._originalBuilderSideOrientation=a.sideOrientation;return p(a).Ca(T,a.updatable),a.sourcePlane&&(T.translate(a.sourcePlane.k,-a.sourcePlane.d),T.setDirection(a.sourcePlane.k.scale(-1))),T}const s={Xf:j};T.b.Xf=p,v.c.Xf=(z,a,K,v,T)=>j(z,{size:a,width:a,height:a,sideOrientation:T,updatable:v},K)},11578:(z,a,K)=>{"use strict";K.d(a,{b:()=>s});var v=K(10941),T=K(11194),m=K(11230),p=K(11161);function j(z){const a=0|(z.segments||32),K=z.diameterX||z.diameter||1,T=z.diameterY||z.diameter||1,j=z.diameterZ||z.diameter||1,s=z.arc&&(z.arc<=0||z.arc>1)?1:z.arc||1,M=z.slice&&z.slice<=0?1:z.slice||1,r=0===z.sideOrientation?0:z.sideOrientation||m.b.DEFAULTSIDE,W=!!z.dedupTopBottomIndices,F=new v.o(K/2,T/2,j/2),G=2+a,l=2*G,V=[],c=[],C=[],w=[];for(let m=0;m<=G;m++){const z=m/G,a=z*Math.PI*M;for(let K=0;K<=l;K++){const T=K/l,m=T*Math.PI*2*s,j=v.b.RotationZ(-a),M=v.b.RotationY(m),r=v.o.TransformCoordinates(v.o.Up(),j),W=v.o.TransformCoordinates(r,M),G=W.multiply(F),V=W.divide(F).normalize();c.push(G.x,G.y,G.z),C.push(V.x,V.y,V.z),w.push(T,p.d?1-z:z)}if(m>0){const z=c.length/3;for(let a=z-2*(l+1);a+l+2<z;a++)W?(m>1&&(V.push(a),V.push(a+1),V.push(a+l+1)),(m<G||M<1)&&(V.push(a+l+1),V.push(a+1),V.push(a+l+2))):(V.push(a),V.push(a+1),V.push(a+l+1),V.push(a+l+1),V.push(a+1),V.push(a+l+2))}}m.b._ComputeSides(r,c,V,C,w,z.frontUVs,z.backUVs);const H=new m.b;return H.indices=V,H.xa=c,H.ya=C,H.Aa=w,H}function s(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new T.c(z,K);a.sideOrientation=T.c._GetDefaultSideOrientation(a.sideOrientation),v._originalBuilderSideOrientation=a.sideOrientation;return j(a).Ca(v,a.updatable),v}m.b.CreateSphere=j,T.c.CreateSphere=(z,a,K,v,T,m)=>s(z,{segments:a,diameterX:K,diameterY:K,diameterZ:K,sideOrientation:m,updatable:T},v)},11991:(z,a,K)=>{"use strict";K.d(a,{b:()=>W});var v=K(10631),T=K(11998),m=K(11236),p=K(11001),j=K(11230),s=K(10648);function M(z,a,K,v,T){let m=null,p=null,j=null;try{let s;m=new z.Decoder,p=new z.DecoderBuffer,p.Init(a,a.byteLength);const M=m.GetEncodedGeometryType(p);switch(M){case z.TRIANGULAR_MESH:{const a=new z.Mesh;if(s=m.DecodeBufferToMesh(p,a),!s.ok()||0===a.ptr)throw new Error(s.error_msg());const K=3*a.num_faces(),T=4*K,M=z._malloc(T);try{m.GetTrianglesUInt32Array(a,T,M);const p=new Uint32Array(K);p.set(new Uint32Array(z.HEAPF32.buffer,M,K)),v(p)}finally{z._free(M)}j=a;break}case z.POINT_CLOUD:{const a=new z.PointCloud;if(s=m.DecodeBufferToPointCloud(p,a),!s.ok()||!a.ptr)throw new Error(s.error_msg());j=a;break}default:throw new Error(`Invalid geometry type ${M}`)}const r=j.num_points(),W=(a,K,v,m)=>{const p=m.data_type(),j=m.num_components(),s=m.normalized(),M=m.byte_stride(),W=m.byte_offset(),F={[z.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:z.HEAPF32},[z.DT_INT8]:{typedArrayConstructor:Int8Array,heap:z.HEAP8},[z.DT_INT16]:{typedArrayConstructor:Int16Array,heap:z.HEAP16},[z.DT_INT32]:{typedArrayConstructor:Int32Array,heap:z.HEAP32},[z.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:z.HEAPU8},[z.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:z.HEAPU16},[z.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:z.HEAPU32}}[p];if(!F)throw new Error(`Invalid data type ${p}`);const G=r*j,l=G*F.typedArrayConstructor.BYTES_PER_ELEMENT,V=z._malloc(l);try{a.GetAttributeDataArrayForAllPoints(K,m,p,l,V);const z=new F.typedArrayConstructor(F.heap.buffer,V,G);T(v,z.slice(),j,W,M,s)}finally{z._free(V)}};if(K)for(const z in K){const a=K[z],v=m.GetAttributeByUniqueId(j,a);W(m,j,z,v)}else{const a={position:z.POSITION,k:z.NORMAL,color:z.COLOR,uv:z.TEX_COORD};for(const z in a){const K=m.GetAttributeId(j,a[z]);if(-1!==K){const a=m.GetAttribute(j,K);W(m,j,z,a)}}}return r}finally{j&&z.destroy(j),p&&z.destroy(p),m&&z.destroy(m)}}function r(){let z;onmessage=a=>{const K=a.data;switch(K.id){case"init":{const a=K.decoder;a.url&&importScripts(a.url);const v=a.wasmBinary?{wasmBinary:a.wasmBinary}:{};z=DracoDecoderModule(v),postMessage({id:"initDone"});break}case"decodeMesh":if(!z)throw new Error("Draco decoder module is not available");z.then((z=>{const a=M(z,K.dataView,K.attributes,(z=>{postMessage({id:"indices",data:z},[z.buffer])}),((z,a,K,v,T,m)=>{postMessage({id:"attribute",kind:z,data:a,size:K,byteOffset:v,byteStride:T,normalized:m},[a.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:a})}))}}}class W{static get DecoderAvailable(){const z=W.Configuration.decoder;return!!(z.wasmUrl&&z.wasmBinaryUrl&&"object"===typeof WebAssembly||z.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return W._Default||(W._Default=new W),W._Default}static ResetDefault(z){W._Default&&(z||W._Default.dispose(),W._Default=null)}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W.DefaultNumWorkers;const a=W.Configuration.decoder;if(a.workerPool||"object"===typeof z&&z.workerPool)this._workerPoolPromise=Promise.resolve(a.workerPool||z.workerPool);else{const K=a.wasmBinary||"object"===typeof z&&z.wasmBinary,m="number"===typeof z?z:z.numWorkers,p=m&&"function"===typeof Worker&&"function"===typeof URL,j=p||!p&&!a.jsModule,s=a.wasmUrl&&a.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:j?v.h.GetBabylonScriptURL(a.wasmUrl,!0):"",wasmBinaryPromise:K?Promise.resolve(K):v.h.LoadFileAsync(v.h.GetBabylonScriptURL(a.wasmBinaryUrl,!0))}:{url:j?v.h.GetBabylonScriptURL(a.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};p?this._workerPoolPromise=s.wasmBinaryPromise.then((z=>{const a=`${M}(${r})()`,K=URL.createObjectURL(new Blob([a],{type:"application/javascript"}));return new T.c(m,(()=>function(z,a,K){return new Promise(((v,T)=>{const m=a=>{z.removeEventListener("error",m),z.removeEventListener("message",p),T(a)},p=a=>{"initDone"===a.data.id&&(z.removeEventListener("error",m),z.removeEventListener("message",p),v(z))};if(z.addEventListener("error",m),z.addEventListener("message",p),a){const v=a.slice(0);z.postMessage({id:"init",decoder:{url:K,wasmBinary:v}},[v])}else z.postMessage({id:"init",decoder:{url:K}})}))}(new Worker(K),z,s.url)))})):this._decoderModulePromise=s.wasmBinaryPromise.then((async z=>{if("undefined"===typeof DracoDecoderModule&&!a.jsModule){if(!s.url)throw new Error("Draco decoder module is not available");await v.h.LoadBabylonScriptAsync(s.url)}return await(K=z,T=a.jsModule,new Promise((z=>{(T||DracoDecoderModule)({wasmBinary:K}).then((a=>{z({module:a})}))})));var K,T}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((z=>{z.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(z,a,K){const v=z instanceof ArrayBuffer?new Int8Array(z):new Int8Array(z.buffer,z.byteOffset,z.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((z=>new Promise(((T,m)=>{z.push(((z,p)=>{let j=null;const M=[],r=a=>{z.removeEventListener("error",r),z.removeEventListener("message",W),m(a),p()},W=a=>{const v=a.data;switch(v.id){case"decodeMeshDone":z.removeEventListener("error",r),z.removeEventListener("message",W),T({indices:j,attributes:M,totalVertices:v.totalVertices}),p();break;case"indices":j=v.data;break;case"attribute":M.push({kind:v.kind,data:v.data,size:v.size,byteOffset:v.byteOffset,byteStride:v.byteStride,normalized:(m=v.kind,F=v.normalized,K&&void 0!==K[m]?(F!==K[m]&&s.c.Warn(`Normalized flag from Draco data (${F}) does not match normalized flag from glTF accessor (${K[m]}). Using flag from glTF accessor.`),K[m]):F)})}var m,F};z.addEventListener("error",r),z.addEventListener("message",W);const F=v.slice();z.postMessage({id:"decodeMesh",dataView:F,attributes:a},[F.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((z=>{let K=null;const T=[],m=M(z.module,v,a,(z=>{K=z}),((z,a,K,v,m,p)=>{T.push({kind:z,data:a,size:K,byteOffset:v,byteStride:m,normalized:p})}));return{indices:K,attributes:T,totalVertices:m}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(z,a,K,v){const T=await this.decodeMeshToMeshDataAsync(K,v),j=new m.b(z,a);T.indices&&j.setIndices(T.indices);for(const m of T.attributes)j.setVerticesBuffer(new p.h(a.getEngine(),m.data,m.kind,!1,void 0,m.byteStride,void 0,m.byteOffset,m.size,void 0,m.normalized,!0),T.totalVertices);return j}async _decodeMeshToGeometryForGltfAsync(z,a,K,v,T){const j=await this.decodeMeshToMeshDataAsync(K,v,T),s=new m.b(z,a);j.indices&&s.setIndices(j.indices);for(const m of j.attributes)s.setVerticesBuffer(new p.h(a.getEngine(),m.data,m.kind,!1,void 0,m.byteStride,void 0,m.byteOffset,m.size,void 0,m.normalized,!0),j.totalVertices);return s}async decodeMeshAsync(z,a){const K=await this.decodeMeshToMeshDataAsync(z,a),v=new j.b;K.indices&&(v.indices=K.indices);for(const T of K.attributes){const z=p.h.GetFloatData(T.data,T.size,p.h.GetDataType(T.data),T.byteOffset,T.byteStride,T.normalized,K.totalVertices);v.set(z,T.kind)}return v}}W.Configuration={decoder:{wasmUrl:`${v.h._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${v.h._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${v.h._DefaultCdnUrl}/draco_decoder_gltf.js`}},W.DefaultNumWorkers=W.GetDefaultNumWorkers(),W._Default=null},11388:(z,a,K)=>{"use strict";K.d(a,{c:()=>T});var v=K(11007);class T extends v.b{constructor(z){super(),this._buffer=z}get underlyingResource(){return this._buffer}}},11249:(z,a,K)=>{"use strict";K.d(a,{e:()=>q});var v=K(10923),T=K(10638),m=K(10941),p=K(11001),j=K(11230),s=K(11252),M=K(10995),r=K(11077),W=K(10991);class F{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new m.o(0,0,0),this._diffPositionForCollisions=new m.o(0,0,0),this._collisionResponse=!0}}var G=K(10663),l=K(11099),V=K(10971),c=K(10946),C=K(11256),w=K(10767),H=K(10927),f=K(10715);class Y{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=m.o.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class I{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new Y,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new F,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class q extends s.d{static get BILLBOARDMODE_NONE(){return s.d.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return s.d.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return s.d.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return s.d.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return s.d.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return s.d.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(z){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=z}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(z){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=z}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(z){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=z}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(z){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=z}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(z){this._internalAbstractMeshDataInfo._collisionRetryCount=z}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(z){this._internalAbstractMeshDataInfo._morphTargetManager!==z&&(this._internalAbstractMeshDataInfo._morphTargetManager=z,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(z){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==z&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=z,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(z){return!!super._updateNonUniformScalingState(z)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(z){this._internalAbstractMeshDataInfo._rawBoundingInfo=z}set Kk(z){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(z)}set onCollisionPositionChange(z){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(z)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(z){if(this._internalAbstractMeshDataInfo._visibility===z)return;const a=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=z,(1===a&&1!==z||1!==a&&1===z)&&this._markSubMeshesAsDirty((z=>{z.markAsMiscDirty(),z.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(z){this._internalAbstractMeshDataInfo._inheritVisibility=z}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let z=this._parentNode;for(;z;){const a=z.isVisible;if("undefined"!==typeof a)return a;z=z.parent}}return this._isVisible}set isVisible(z){this._isVisible=z}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(z){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=z}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(z){this._internalAbstractMeshDataInfo._renderingGroupId=z}get material(){return this._internalAbstractMeshDataInfo._material}set material(z){this._setMaterial(z)}_setMaterial(z){this._internalAbstractMeshDataInfo._material!==z&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=z,z&&z.meshMap&&(z.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.Vf&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(z){var a;return null===(a=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===a?void 0:a[z]}setMaterialForRenderPass(z,a){this.resetDrawCache(z),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[z]=a}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(z){this._internalAbstractMeshDataInfo._receiveShadows!==z&&(this._internalAbstractMeshDataInfo._receiveShadows=z,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(z){this._internalAbstractMeshDataInfo._hasVertexAlpha!==z&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=z,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(z){this._internalAbstractMeshDataInfo._useVertexColors!==z&&(this._internalAbstractMeshDataInfo._useVertexColors=z,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(z){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==z&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=z,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(z){this._internalAbstractMeshDataInfo._numBoneInfluencers!==z&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=z,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(z){this._internalAbstractMeshDataInfo._applyFog!==z&&(this._internalAbstractMeshDataInfo._applyFog=z,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(z){this._internalAbstractMeshDataInfo._enableDistantPicking=z}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(z){z!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=z,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(z){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(z)?-1:z}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(z){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=z}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(z){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(z)?-1:z}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(z){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=z}get lightSources(){return this._lightSources}set skeleton(z){const a=this._internalAbstractMeshDataInfo._skeleton;a&&a.needInitialSkinMatrix&&a._unregisterMeshWithPoseMatrix(this),z&&z.needInitialSkinMatrix&&z._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=z,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(z){var a;let K=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(z,K,!1),a=this,this._internalAbstractMeshDataInfo=new I,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Fi=q.Gi,this.onCollideObservable=new T.c,this.onCollisionPositionChangeObservable=new T.c,this.onMaterialChangedObservable=new T.c,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Hb=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=V.c.Red(),this.outlineWidth=.02,this.overlayColor=V.c.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.wb=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new m.o(.5,1,.5),this.ellipsoidOffset=new m.o(0,0,0),this.edgesWidth=1,this.edgesColor=new V.d(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,wc:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new T.c,this._onCollisionPositionChange=function(z,K){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;K.subtractToRef(a._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,a._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),a._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>f.b.CollisionsEpsilon&&a.position.addInPlace(a._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),v&&a.onCollideObservable.notifyObservers(v),a.onCollisionPositionChangeObservable.notifyObservers(a.position)},K=this.va(),K.mi(this),this._resyncLightSources(),this._uniformBuffer=new W.c(this.va().getEngine(),void 0,void 0,z,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),K.performancePriority){case 2:this.Da=!0;case 1:this.wb=!0,this.Hb=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(z){const a=this._uniformBuffer;a.Jj("world",z),a.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),a.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(z){let a="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");a+=", # of submeshes: "+(this.Vf?this.Vf.length:0);const K=this._internalAbstractMeshDataInfo._skeleton;return K&&(a+=", skeleton: "+K.name),z&&(a+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],a+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.wc?"YES":"NO")),a}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==s.d.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(a||this.actionManager.isRecursive)){if(!z)return this.actionManager;if(this.actionManager.hasSpecificTrigger(z))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(z,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.Vf){for(const z of this.Vf)z._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const z of this.va().lights)z.isEnabled()&&z.canAffectMesh(this)&&this._lightSources.push(z);this._markSubMeshesAsLightDirty()}_resyncLightSource(z){const a=z.isEnabled()&&z.canAffectMesh(this),K=this._lightSources.indexOf(z);let v=!1;if(-1===K){if(!a)return;this._lightSources.push(z)}else{if(a)return;v=!0,this._lightSources.splice(K,1)}this._markSubMeshesAsLightDirty(v)}_unBindEffect(){for(const z of this.Vf)z.setEffect(null)}_removeLightSource(z,a){const K=this._lightSources.indexOf(z);-1!==K&&(this._lightSources.splice(K,1),this._markSubMeshesAsLightDirty(a))}_markSubMeshesAsDirty(z){if(this.Vf)for(const a of this.Vf)for(let K=0;K<a._drawWrappers.length;++K){const v=a._drawWrappers[K];v&&v.defines&&v.defines.markAllAsDirty&&z(v.defines)}}_markSubMeshesAsLightDirty(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((a=>a.markAsLightDirty(z)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((z=>z.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((z=>z.markAsMiscDirty()))}zg(z){return this._currentRenderId=Number.MAX_VALUE,super.zg(z),this._isDirty=!0,this}resetDrawCache(z){if(this.Vf)for(const a of this.Vf)a.resetDrawCache(z)}get isBlocked(){return!1}getLOD(z){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Rf(){return null}getVerticesData(z){return null}Ga(z,a,K,v){return this}updateVerticesData(z,a,K,v){return this}setIndices(z,a){return this}isVerticesDataPresent(z){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(z){return this._boundingInfo=z,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(z,a,K){return this._boundingInfo=new r.e(z,a,K),this._boundingInfo}normalizeToUnitCube(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(z,a,K)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(p.h.MatricesIndicesKind)&&this.isVerticesDataPresent(p.h.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(z){}_activate(z,a){return this._renderId=z,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===s.d.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(z,a,K){return this.position.addInPlace(this.calcMovePOV(z,a,K)),this}calcMovePOV(z,a,K){const v=new m.b;(this.rotationQuaternion?this.rotationQuaternion:m.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(v);const T=m.o.Zero(),p=this.definedFacingForward?-1:1;return m.o.TransformCoordinatesFromFloatsToRef(z*p,a,K*p,v,T),T}rotatePOV(z,a,K){return this.rotation.addInPlace(this.calcRotatePOV(z,a,K)),this}calcRotatePOV(z,a,K){const v=this.definedFacingForward?1:-1;return new m.o(z*v,a,K*v)}Fa(z,a){if(z){const K=(0,l.i)(z,0,this.getTotalVertices(),a);this._boundingInfo?this._boundingInfo.reConstruct(K.minimum,K.maximum):this._boundingInfo=new r.e(K.minimum,K.maximum)}if(this.Vf)for(let K=0;K<this.Vf.length;K++)this.Vf[K].refreshBoundingInfo(z);this.Ea()}_refreshBoundingInfoDirect(z){if(this._boundingInfo?this._boundingInfo.reConstruct(z.minimum,z.maximum):this._boundingInfo=new r.e(z.minimum,z.maximum),this.Vf)for(let a=0;a<this.Vf.length;a++)this.Vf[a].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(z,a,K,v,T,j,s){!function(z,a,K,v,T,j,s){const M=m.j.gb[0],r=m.j.Matrix[0],W=m.j.Matrix[1],F=a===p.h.NormalKind?m.o.TransformNormalFromFloatsToRef:m.o.TransformCoordinatesFromFloatsToRef;for(let p=0,G=0;p<z.length;p+=3,G+=4){let a,l;for(r.reset(),a=0;a<4;a++)l=T[G+a],l>0&&(m.b.FromFloat32ArrayToRefScaled(K,Math.floor(16*v[G+a]),l,W),r.addToSelf(W));if(j&&s)for(a=0;a<4;a++)l=s[G+a],l>0&&(m.b.FromFloat32ArrayToRefScaled(K,Math.floor(16*j[G+a]),l,W),r.addToSelf(W));F(z[p],z[p+1],z[p+2],r,M),M.toArray(z,p)}}(z,a,K,v,T,j,s)}_getData(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.h.PositionKind;const v=z.cache,T=z=>{if(v){const a=v._vertexData||(v._vertexData={});return a[z]||this.copyVerticesData(z,a),a[z]}return this.getVerticesData(z)};if(a||(a=T(K)),!a)return null;if(v?(v._outputData?v._outputData.set(a):v._outputData=new Float32Array(a),a=v._outputData):(z.applyMorph&&this.morphTargetManager||z.applySkeleton&&this.skeleton)&&(a=a.slice()),z.applyMorph&&this.morphTargetManager&&function(z,a,K){let v=null;switch(a){case p.h.PositionKind:v=z=>z.getPositions();break;case p.h.NormalKind:v=z=>z.getNormals();break;case p.h.TangentKind:v=z=>z.getTangents();break;case p.h.UVKind:v=z=>z.getUVs();break;default:return}for(let T=0;T<z.length;T++){let a=z[T];for(let m=0;m<K.numTargets;m++){const p=K.getTarget(m),j=p.influence;if(0!==j){const K=v(p);K&&(a+=(K[T]-z[T])*j)}}z[T]=a}}(a,K,this.morphTargetManager),z.applySkeleton&&this.skeleton){const z=T(p.h.MatricesIndicesKind),v=T(p.h.MatricesWeightsKind);if(v&&z){const m=this.numBoneInfluencers>4,j=m?T(p.h.MatricesIndicesExtraKind):null,s=m?T(p.h.MatricesWeightsExtraKind):null,M=this.skeleton.getTransformMatrices(this);q._ApplySkeleton(a,K,M,z,v,j,s)}}if(!1!==z.updatePositionsArray&&K===p.h.PositionKind){const z=this._internalAbstractMeshDataInfo._positions||[],K=z.length;if(z.length=a.length/3,K<z.length)for(let a=K;a<z.length;a++)z[a]=new m.o;for(let v=0,T=0;v<z.length;v++,T+=3)z[v].Xd(a[T],a[T+1],a[T+2]);this._internalAbstractMeshDataInfo._positions=z}return a}getNormalsData(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:z,applyMorph:a,updatePositionsArray:!1},null,p.h.NormalKind)}Bd(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:z,applyMorph:a,updatePositionsArray:!1},K,p.h.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new r.e(m.o.Zero(),m.o.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(z){if(!this.Vf)return this;const a=this.Vf.length;for(let K=0;K<a;K++){const v=this.Vf[K];(a>1||!v.IsGlobal)&&v.updateBoundingInfo(z)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(z){return this.getBoundingInfo().isInFrustum(z,this.Fi)}isCompletelyInFrustum(z){return this.getBoundingInfo().isCompletelyInFrustum(z)}intersectsMesh(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2?arguments[2]:void 0;const v=this.getBoundingInfo(),T=z.getBoundingInfo();if(v.intersects(T,a))return!0;if(K)for(const m of this.getChildMeshes())if(m.intersectsMesh(z,a,!0))return!0;return!1}intersectsPoint(z){return this.getBoundingInfo().intersectsPoint(z)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(z){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=z}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(z){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const a=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=a.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,a.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,z,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(z,a,K){var v;if(this._generatePointsArray(),!this._positions)return this;if(!z._lastColliderWorldVertices||!z._lastColliderTransformMatrix.equals(a)){z._lastColliderTransformMatrix=a.clone(),z._lastColliderWorldVertices=[],z._trianglePlanes=[];const K=z.verticesStart,v=z.verticesStart+z.verticesCount;for(let T=K;T<v;T++)z._lastColliderWorldVertices.push(m.o.TransformCoordinates(this._positions[T],a))}return K._collide(z._trianglePlanes,z._lastColliderWorldVertices,this.Rf(),z.indexStart,z.indexStart+z.indexCount,z.verticesStart,!!z.Ha(),this,this._shouldConvertRHS(),7===(null===(v=z.Ha())||void 0===v?void 0:v.fillMode)),this}_processCollisionsForSubMeshes(z,a){const K=this._scene.getCollidingSubMeshCandidates(this,z),v=K.length;for(let T=0;T<v;T++){const m=K.data[T];v>1&&!m._checkCollision(z)||this._collideForSubMesh(m,a,z)}return this}_shouldConvertRHS(){return!1}_checkCollision(z){if(!this.getBoundingInfo()._checkCollision(z))return this;const a=m.j.Matrix[0],K=m.j.Matrix[1];return m.b.ScalingToRef(1/z._radius.x,1/z._radius.y,1/z._radius.z,a),this.worldMatrixFromCache.multiplyToRef(a,K),this._processCollisionsForSubMeshes(z,K),this}_generatePointsArray(){return!1}intersects(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const j=new M.d,s=this.getClassName(),r="InstancedLinesMesh"===s||"LinesMesh"===s||"GreasedLineMesh"===s?this.intersectionThreshold:0,W=this.getBoundingInfo();if(!this.Vf)return j;if(!p&&(!z.intersectsSphere(W.boundingSphere,r)||!z.intersectsBox(W.boundingBox,r)))return j;if(v)return j.hit=!p,j.pickedMesh=p?null:this,j.distance=p?0:m.o.Distance(z.origin,W.boundingSphere.center),j.subMeshId=0,j;if(!this._generatePointsArray())return j;let F=null;const G=this._scene.getIntersectingSubMeshCandidates(this,z),l=G.length;let V=!1;for(let m=0;m<l;m++){const z=G.data[m].Ha();if(z&&(7==z.fillMode||0==z.fillMode||1==z.fillMode||2==z.fillMode||4==z.fillMode)){V=!0;break}}if(!V)return j.hit=!0,j.pickedMesh=this,j.distance=m.o.Distance(z.origin,W.boundingSphere.center),j.subMeshId=-1,j;for(let m=0;m<l;m++){const v=G.data[m];if(l>1&&!p&&!v.canIntersects(z))continue;const T=v.intersects(z,this._positions,this.Rf(),a,K);if(T&&(a||!F||T.distance<F.distance)&&(F=T,F.subMeshId=m,a))break}if(F){const a=T??this.getWorldMatrix(),K=m.j.gb[0],v=m.j.gb[1];m.o.TransformCoordinatesToRef(z.origin,a,K),z.direction.scaleToRef(F.distance,v);const p=m.o.TransformNormal(v,a).addInPlace(K);return j.hit=!0,j.distance=m.o.Distance(K,p),j.pickedPoint=p,j.pickedMesh=this,j.bu=F.bu||0,j.bv=F.bv||0,j.subMeshFaceId=F.faceId,j.faceId=F.faceId+G.data[F.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),j.subMeshId=F.subMeshId,j}return j}clone(z,a,K){return null}releaseSubMeshes(){if(this.Vf)for(;this.Vf.length;)this.Vf[0].dispose();else this.Vf=[];return this}dispose(z){let a,K=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const v=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),v.freeActiveMeshes(),v.freeRenderingGroups(),v.renderingManager.maintainStateBetweenFrames&&v.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((z=>z!==this&&z.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),a=0;a<this._intersectionsInProgress.length;a++){const z=this._intersectionsInProgress[a],K=z._intersectionsInProgress.indexOf(this);z._intersectionsInProgress.splice(K,1)}this._intersectionsInProgress.length=0;v.lights.forEach((z=>{let a=z.includedOnlyMeshes.indexOf(this);-1!==a&&z.includedOnlyMeshes.splice(a,1),a=z.excludedMeshes.indexOf(this),-1!==a&&z.excludedMeshes.splice(a,1);const K=z.getShadowGenerators();if(K){const z=K.values();for(let K=z.next();!0!==K.done;K=z.next()){const z=K.value.getShadowMap();z&&z.renderList&&(a=z.renderList.indexOf(this),-1!==a&&z.renderList.splice(a,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const T=v.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,T.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),T.wipeCaches(),v.Bc(this),this._parentContainer){const z=this._parentContainer.meshes.indexOf(this);z>-1&&this._parentContainer.meshes.splice(z,1),this._parentContainer=null}if(K&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!z)for(a=0;a<v.sj.length;a++)v.sj[a].j===this&&(v.sj[a].dispose(),a--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(z,K)}_initFacetData(){const z=this._internalAbstractMeshDataInfo._facetData;z.facetNormals||(z.facetNormals=[]),z.facetPositions||(z.facetPositions=[]),z.facetPartitioning||(z.facetPartitioning=new Array),z.facetNb=this.Rf().length/3|0,z.partitioningSubdivisions=z.partitioningSubdivisions?z.partitioningSubdivisions:10,z.partitioningBBoxRatio=z.partitioningBBoxRatio?z.partitioningBBoxRatio:1.01;for(let a=0;a<z.facetNb;a++)z.facetNormals[a]=m.o.Zero(),z.facetPositions[a]=m.o.Zero();return z.facetDataEnabled=!0,this}updateFacetData(){const z=this._internalAbstractMeshDataInfo._facetData;z.facetDataEnabled||this._initFacetData();const a=this.getVerticesData(p.h.PositionKind),K=this.Rf(),v=this.getVerticesData(p.h.NormalKind),T=this.getBoundingInfo();if(z.facetDepthSort&&!z.facetDepthSortEnabled){if(z.facetDepthSortEnabled=!0,K instanceof Uint16Array)z.depthSortedIndices=new Uint16Array(K);else if(K instanceof Uint32Array)z.depthSortedIndices=new Uint32Array(K);else{let a=!1;for(let z=0;z<K.length;z++)if(K[z]>65535){a=!0;break}z.depthSortedIndices=a?new Uint32Array(K):new Uint16Array(K)}if(z.facetDepthSortFunction=function(z,a){return a.sqDistance-z.sqDistance},!z.facetDepthSortFrom){const a=this.va().activeCamera;z.facetDepthSortFrom=a?a.position:m.o.Zero()}z.depthSortedFacets=[];for(let a=0;a<z.facetNb;a++){const K={ind:3*a,sqDistance:0};z.depthSortedFacets.push(K)}z.invertedMatrix=m.b.Identity(),z.facetDepthSortOrigin=m.o.Zero()}z.bbSize.x=T.maximum.x-T.minimum.x>c.e?T.maximum.x-T.minimum.x:c.e,z.bbSize.y=T.maximum.y-T.minimum.y>c.e?T.maximum.y-T.minimum.y:c.e,z.bbSize.z=T.maximum.z-T.minimum.z>c.e?T.maximum.z-T.minimum.z:c.e;let s=z.bbSize.x>z.bbSize.y?z.bbSize.x:z.bbSize.y;if(s=s>z.bbSize.z?s:z.bbSize.z,z.subDiv.max=z.partitioningSubdivisions,z.subDiv.X=Math.floor(z.subDiv.max*z.bbSize.x/s),z.subDiv.Y=Math.floor(z.subDiv.max*z.bbSize.y/s),z.subDiv.Z=Math.floor(z.subDiv.max*z.bbSize.z/s),z.subDiv.X=z.subDiv.X<1?1:z.subDiv.X,z.subDiv.Y=z.subDiv.Y<1?1:z.subDiv.Y,z.subDiv.Z=z.subDiv.Z<1?1:z.subDiv.Z,z.facetParameters.facetNormals=this.getFacetLocalNormals(),z.facetParameters.facetPositions=this.getFacetLocalPositions(),z.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),z.facetParameters.bInfo=T,z.facetParameters.bbSize=z.bbSize,z.facetParameters.subDiv=z.subDiv,z.facetParameters.ratio=this.partitioningBBoxRatio,z.facetParameters.depthSort=z.facetDepthSort,z.facetDepthSort&&z.facetDepthSortEnabled&&(this.Qj(!0),this._worldMatrix.invertToRef(z.invertedMatrix),m.o.TransformCoordinatesToRef(z.facetDepthSortFrom,z.invertedMatrix,z.facetDepthSortOrigin),z.facetParameters.distanceTo=z.facetDepthSortOrigin),z.facetParameters.depthSortedFacets=z.depthSortedFacets,v&&j.b.ComputeNormals(a,K,v,z.facetParameters),z.facetDepthSort&&z.facetDepthSortEnabled){z.depthSortedFacets.sort(z.facetDepthSortFunction);const a=z.depthSortedIndices.length/3|0;for(let v=0;v<a;v++){const a=z.depthSortedFacets[v].ind;z.depthSortedIndices[3*v]=K[a],z.depthSortedIndices[3*v+1]=K[a+1],z.depthSortedIndices[3*v+2]=K[a+2]}this.updateIndices(z.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const z=this._internalAbstractMeshDataInfo._facetData;return z.facetNormals||this.updateFacetData(),z.facetNormals}getFacetLocalPositions(){const z=this._internalAbstractMeshDataInfo._facetData;return z.facetPositions||this.updateFacetData(),z.facetPositions}getFacetLocalPartitioning(){const z=this._internalAbstractMeshDataInfo._facetData;return z.facetPartitioning||this.updateFacetData(),z.facetPartitioning}getFacetPosition(z){const a=m.o.Zero();return this.getFacetPositionToRef(z,a),a}getFacetPositionToRef(z,a){const K=this.getFacetLocalPositions()[z],v=this.getWorldMatrix();return m.o.TransformCoordinatesToRef(K,v,a),this}getFacetNormal(z){const a=m.o.Zero();return this.getFacetNormalToRef(z,a),a}getFacetNormalToRef(z,a){const K=this.getFacetLocalNormals()[z];return m.o.TransformNormalToRef(K,this.getWorldMatrix(),a),this}getFacetsAtLocalCoordinates(z,a,K){const v=this.getBoundingInfo(),T=this._internalAbstractMeshDataInfo._facetData,m=Math.floor((z-v.minimum.x*T.partitioningBBoxRatio)*T.subDiv.X*T.partitioningBBoxRatio/T.bbSize.x),p=Math.floor((a-v.minimum.y*T.partitioningBBoxRatio)*T.subDiv.Y*T.partitioningBBoxRatio/T.bbSize.y),j=Math.floor((K-v.minimum.z*T.partitioningBBoxRatio)*T.subDiv.Z*T.partitioningBBoxRatio/T.bbSize.z);return m<0||m>T.subDiv.max||p<0||p>T.subDiv.max||j<0||j>T.subDiv.max?null:T.facetPartitioning[m+T.subDiv.max*p+T.subDiv.max*T.subDiv.max*j]}getClosestFacetAtCoordinates(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const j=this.getWorldMatrix(),s=m.j.Matrix[5];j.invertToRef(s);const M=m.j.gb[8];m.o.TransformCoordinatesFromFloatsToRef(z,a,K,s,M);const r=this.getClosestFacetAtLocalCoordinates(M.x,M.y,M.z,v,T,p);return v&&m.o.TransformCoordinatesFromFloatsToRef(v.x,v.y,v.z,j,v),r}getClosestFacetAtLocalCoordinates(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]&&arguments[4],m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=null,j=0,s=0,M=0,r=0,W=0,F=0,G=0,l=0;const V=this.getFacetLocalPositions(),c=this.getFacetLocalNormals(),C=this.getFacetsAtLocalCoordinates(z,a,K);if(!C)return null;let w,H,f,Y=Number.MAX_VALUE,I=Y;for(let q=0;q<C.length;q++)w=C[q],H=c[w],f=V[w],r=(z-f.x)*H.x+(a-f.y)*H.y+(K-f.z)*H.z,(!T||T&&m&&r>=0||T&&!m&&r<=0)&&(r=H.x*f.x+H.y*f.y+H.z*f.z,W=-(H.x*z+H.y*a+H.z*K-r)/(H.x*H.x+H.y*H.y+H.z*H.z),F=z+H.x*W,G=a+H.y*W,l=K+H.z*W,j=F-z,s=G-a,M=l-K,I=j*j+s*s+M*M,I<Y&&(Y=I,p=w,v&&(v.x=F,v.y=G,v.z=l)));return p}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const z=this._internalAbstractMeshDataInfo._facetData;return z.facetDataEnabled&&(z.facetDataEnabled=!1,z.facetPositions=[],z.facetNormals=[],z.facetPartitioning=new Array,z.facetParameters=null,z.depthSortedIndices=new Uint32Array(0)),this}updateIndices(z,a){return this}createNormals(z){const a=this.getVerticesData(p.h.PositionKind),K=this.Rf();let v;return v=this.isVerticesDataPresent(p.h.NormalKind)?this.getVerticesData(p.h.NormalKind):[],j.b.ComputeNormals(a,K,v,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(p.h.NormalKind,v,z),this}alignWithNormal(z,a){a||(a=C.c.Y);const K=m.j.gb[0],v=m.j.gb[1];return m.o.CrossToRef(a,z,v),m.o.CrossToRef(z,v,K),this.rotationQuaternion?m.f.RotationQuaternionFromAxisToRef(K,z,v,this.rotationQuaternion):m.o.RotationFromAxisToRef(K,z,v,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,G.b)("EdgesRenderer")}enableEdgesRendering(z,a,K){throw(0,G.b)("EdgesRenderer")}tj(){return this._scene.sj.filter((z=>z.j===this))}}q.OCCLUSION_TYPE_NONE=0,q.OCCLUSION_TYPE_OPTIMISTIC=1,q.OCCLUSION_TYPE_STRICT=2,q.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,q.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,q.CULLINGSTRATEGY_STANDARD=0,q.Gi=1,q.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,q.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,v.e)([H.e.filter((function(){for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];let[v,T,m,p,j]=a;return!Array.isArray(v)&&!Array.isArray(T)&&!Array.isArray(m)&&!Array.isArray(p)&&!Array.isArray(j)}))],q,"_ApplySkeleton",null),(0,w.e)("BABYLON.AbstractMesh",q)},11236:(z,a,K)=>{"use strict";K.d(a,{b:()=>c});var v=K(10941),T=K(10971),m=K(11230),p=K(11001),j=K(11066),s=K(11244),M=K(11077),r=K(10631),W=K(10937),F=K(11099),G=K(10680),l=K(11161),V=K(10648);class c{get boundingBias(){return this._boundingBias}set boundingBias(z){this._boundingBias?this._boundingBias.p(z):this._boundingBias=z.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(z){const a=new c(c.RandomId(),z.va());return a.Ca(z),a}get meshes(){return this._meshes}constructor(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=a||G.b.LastCreatedScene,this._scene&&(this.id=z,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=v,K?this.setAllVerticesData(K,v):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),T&&(this.Ca(T),T.Qj(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let z=0;z<this._meshes.length;z++)if(!this._meshes[z].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const z=new Set;for(const a in this._vertexBuffers)z.add(this._vertexBuffers[a].getWrapperBuffer());z.forEach((z=>{z._rebuild()}))}setAllVerticesData(z,a){z.applyToGeometry(this,a),this._notifyUpdate()}Ga(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3?arguments[3]:void 0;K&&Array.isArray(a)&&(a=new Float32Array(a));const T=new p.h(this._engine,a,z,{updatable:K,postponeInternalCreation:0===this._meshes.length,stride:v,label:"Geometry_"+this.id+"_"+z});this.setVerticesBuffer(T)}removeVerticesData(z){this._vertexBuffers[z]&&(this._vertexBuffers[z].dispose(),delete this._vertexBuffers[z]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const T=z.getKind();this._vertexBuffers[T]&&K&&this._vertexBuffers[T].dispose(),z._buffer&&z._buffer._increaseReferences(),this._vertexBuffers[T]=z;const m=this._meshes,j=m.length;if(T===p.h.PositionKind){this._totalVertices=a??z._maxVerticesCount,this._updateExtend(z.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const K=this._extend&&this._extend.minimum||new v.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),T=this._extend&&this._extend.maximum||new v.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let z=0;z<j;z++){const a=m[z];a.buildBoundingInfo(K,T),a._createGlobalSubMesh(a.isUnIndexed),a.Qj(!0),a.synchronizeInstances()}}this._notifyUpdate(T)}updateVerticesDataDirectly(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const T=this.getVertexBuffer(z);T&&(T.updateDirectly(a,K,v),this._notifyUpdate(z))}updateVerticesData(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=this.getVertexBuffer(z);v&&(v.update(a),z===p.h.PositionKind&&this.Ea(K,a),this._notifyUpdate(z))}Ea(z,a){if(z&&this._updateExtend(a),this._resetPointsArrayCache(),z){const z=this._meshes;for(const a of z){a.hasBoundingInfo?a.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):a.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const z=a.Vf;for(const a of z)a.refreshBoundingInfo()}}}_bind(z,a,K,v){if(!z)return;void 0===a&&(a=this._indexBuffer);const T=this.getVertexBuffers();if(!T)return;if(a!=this._indexBuffer||!this._vertexArrayObjects&&!v)return void this._engine.bindBuffers(T,a,z,K);const m=v||this._vertexArrayObjects,p=this._engine;m[z.key]||(m[z.key]=p.recordVertexArrayObject(T,a,z,K)),p.bindVertexArrayObject(m[z.key],a)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(z,a,K){const v=this.getVertexBuffer(z);return v?v.getFloatData(this._totalVertices,K||a&&1!==this._meshes.length):null}copyVerticesData(z,a){const K=this.getVertexBuffer(z);if(!K)return;a[z]||(a[z]=new Float32Array(this._totalVertices*K.getSize()));const v=K.getData();v&&function(z,a,K,v,T,m,j,s){const M=a*p.h.GetTypeByteLength(K),r=j*a;if(s.length!==r)throw new Error("Output length is not valid");if(K===p.h.FLOAT&&T===M)if(z instanceof Array){const a=v/4;s.set(z,a)}else if(z instanceof ArrayBuffer){const a=new Float32Array(z,v,r);s.set(a)}else{const a=z.byteOffset+v;if(a%4)return V.c.Warn("CopyFloatData: copied misaligned data."),void s.set(new Float32Array(z.buffer.slice(a,a+4*r)));const K=new Float32Array(z.buffer,a,r);s.set(K)}else p.h.ForEach(z,v,T,a,K,r,m,((z,a)=>s[a]=z))}(v,K.getSize(),K.type,K.byteOffset,K.byteStride,K.normalized,this._totalVertices,a[z])}isVertexBufferUpdatable(z){const a=this._vertexBuffers[z];return!!a&&a.isUpdatable()}getVertexBuffer(z){return this.isReady()?this._vertexBuffers[z]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(z){return this._vertexBuffers?void 0!==this._vertexBuffers[z]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(z)}getVerticesDataKinds(){const z=[];let a;if(!this._vertexBuffers&&this._delayInfo)for(a in this._delayInfo)z.push(a);else for(a in this._vertexBuffers)z.push(a);return z}updateIndices(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const v=z.length!==this._indices.length;if(K||(this._indices=z.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,z,a),v)for(const z of this._meshes)z._createGlobalSubMesh(!0)}else this.setIndices(z,null,!0)}setIndexBuffer(z,a,K){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=z,this._totalVertices=a,this._totalIndices=K,z.is32Bits||(z.is32Bits=this._totalIndices>65535);for(const v of this._meshes)v._createGlobalSubMesh(!0),v.synchronizeInstances();this._notifyUpdate()}setIndices(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=z,this._indexBufferIsUpdatable=K,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,K,"Geometry_"+this.id+"_IndexBuffer")),void 0!=a&&(this._totalVertices=a);for(const T of this._meshes)T._createGlobalSubMesh(!v),T.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Rf(z,a){if(!this.isReady())return null;const K=this._indices;return a||z&&1!==this._meshes.length?K.slice():K}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;z&&this._vertexArrayObjects&&this._vertexArrayObjects[z.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[z.key]),delete this._vertexArrayObjects[z.key])}releaseForMesh(z,a){const K=this._meshes,v=K.indexOf(z);-1!==v&&(K.splice(v,1),this._vertexArrayObjects&&z._invalidateInstanceVertexArrayObject(),z._geometry=null,0===K.length&&a&&this.dispose())}Ca(z){if(z._geometry===this)return;const a=z._geometry;a&&a.releaseForMesh(z),this._vertexArrayObjects&&z._invalidateInstanceVertexArrayObject();const K=this._meshes;z._geometry=this,z._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),K.push(z),this.isReady()?this._applyToMesh(z):this._boundingInfo&&z.setBoundingInfo(this._boundingInfo)}_updateExtend(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!z&&(z=this.getVerticesData(p.h.PositionKind),!z))return;this._extend=(0,F.i)(z,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(z){const a=this._meshes.length;for(const K in this._vertexBuffers)1===a&&this._vertexBuffers[K].create(),K===p.h.PositionKind&&(this._extend||this._updateExtend(),z.buildBoundingInfo(this._extend.minimum,this._extend.maximum),z._createGlobalSubMesh(z.isUnIndexed),z.Ea());1===a&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),z._syncGeometryWithMorphTargetManager(),z.synchronizeInstances()}_notifyUpdate(z){this.onGeometryUpdated&&this.onGeometryUpdated(this,z),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const a of this._meshes)a._markSubMeshesAsAttributesDirty()}load(z,a){2!==this.delayLoadState&&(this.isReady()?a&&a():(this.delayLoadState=2,this._queueLoad(z,a)))}_queueLoad(z,a){this.delayLoadingFile&&(z.addPendingData(this),z._loadFile(this.delayLoadingFile,(K=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(K),this),this.delayLoadState=1,this._delayInfo=[],z.removePendingData(this);const v=this._meshes,T=v.length;for(let z=0;z<T;z++)this._applyToMesh(v[z]);a&&a()}),void 0,!0))}toLeftHanded(){const z=this.Rf(!1);if(null!=z&&z.length>0){for(let a=0;a<z.length;a+=3){const K=z[a+0];z[a+0]=z[a+2],z[a+2]=K}this.setIndices(z)}const a=this.getVerticesData(p.h.PositionKind,!1);if(null!=a&&a.length>0){for(let z=0;z<a.length;z+=3)a[z+2]=-a[z+2];this.Ga(p.h.PositionKind,a,!1)}const K=this.getVerticesData(p.h.NormalKind,!1);if(null!=K&&K.length>0){for(let z=0;z<K.length;z+=3)K[z+2]=-K[z+2];this.Ga(p.h.NormalKind,K,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const z=this.getVerticesData(p.h.PositionKind);if(!z||0===z.length)return!1;for(let a=3*this._positionsCache.length,K=this._positionsCache.length;a<z.length;a+=3,++K)this._positionsCache[K]=v.o.Jg(z,a);for(let a=0,K=0;a<z.length;a+=3,++K)this._positionsCache[K].set(z[0+a],z[1+a],z[2+a]);return this._positionsCache.length=z.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const K in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[K]);this._vertexArrayObjects={};const z=this._meshes,a=z.length;for(let K=0;K<a;K++)z[K]._invalidateInstanceVertexArrayObject()}}dispose(){const z=this._meshes,a=z.length;let K;for(K=0;K<a;K++)this.releaseForMesh(z[K]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const v in this._vertexBuffers)this._vertexBuffers[v].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const z=this._parentContainer.geometries.indexOf(this);z>-1&&this._parentContainer.geometries.splice(z,1),this._parentContainer=null}this._isDisposed=!0}i(z){const a=new m.b;a.indices=[];const K=this.Rf();if(K)for(let m=0;m<K.length;m++)a.indices.push(K[m]);let v,T=!1,p=!1;for(v in this._vertexBuffers){const z=this.getVerticesData(v);if(z&&(z instanceof Float32Array?a.set(new Float32Array(z),v):a.set(z.slice(0),v),!p)){const z=this.getVertexBuffer(v);z&&(T=z.isUpdatable(),p=!T)}}const j=new c(z,this._scene,a,T);for(v in j.delayLoadState=this.delayLoadState,j.delayLoadingFile=this.delayLoadingFile,j._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)j._delayInfo=j._delayInfo||[],j._delayInfo.push(v);return j._boundingInfo=new M.e(this._extend.minimum,this._extend.maximum),j}serialize(){const z={};return z.id=this.id,z.uniqueId=this.uniqueId,z.updatable=this._updatable,W.d&&W.d.HasTags(this)&&(z.tags=W.d.GetTags(this)),z}_toNumberArray(z){return Array.isArray(z)?z:Array.prototype.slice.call(z)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const z in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,z)&&(this._vertexBuffers[z]._buffer._data=null)}serializeVerticeData(){const z=this.serialize();return this.isVerticesDataPresent(p.h.PositionKind)&&(z.xa=this._toNumberArray(this.getVerticesData(p.h.PositionKind)),this.isVertexBufferUpdatable(p.h.PositionKind)&&(z.xa._updatable=!0)),this.isVerticesDataPresent(p.h.NormalKind)&&(z.ya=this._toNumberArray(this.getVerticesData(p.h.NormalKind)),this.isVertexBufferUpdatable(p.h.NormalKind)&&(z.ya._updatable=!0)),this.isVerticesDataPresent(p.h.TangentKind)&&(z.tangents=this._toNumberArray(this.getVerticesData(p.h.TangentKind)),this.isVertexBufferUpdatable(p.h.TangentKind)&&(z.tangents._updatable=!0)),this.isVerticesDataPresent(p.h.UVKind)&&(z.Aa=this._toNumberArray(this.getVerticesData(p.h.UVKind)),this.isVertexBufferUpdatable(p.h.UVKind)&&(z.Aa._updatable=!0)),this.isVerticesDataPresent(p.h.UV2Kind)&&(z.uvs2=this._toNumberArray(this.getVerticesData(p.h.UV2Kind)),this.isVertexBufferUpdatable(p.h.UV2Kind)&&(z.uvs2._updatable=!0)),this.isVerticesDataPresent(p.h.UV3Kind)&&(z.uvs3=this._toNumberArray(this.getVerticesData(p.h.UV3Kind)),this.isVertexBufferUpdatable(p.h.UV3Kind)&&(z.uvs3._updatable=!0)),this.isVerticesDataPresent(p.h.UV4Kind)&&(z.uvs4=this._toNumberArray(this.getVerticesData(p.h.UV4Kind)),this.isVertexBufferUpdatable(p.h.UV4Kind)&&(z.uvs4._updatable=!0)),this.isVerticesDataPresent(p.h.UV5Kind)&&(z.uvs5=this._toNumberArray(this.getVerticesData(p.h.UV5Kind)),this.isVertexBufferUpdatable(p.h.UV5Kind)&&(z.uvs5._updatable=!0)),this.isVerticesDataPresent(p.h.UV6Kind)&&(z.uvs6=this._toNumberArray(this.getVerticesData(p.h.UV6Kind)),this.isVertexBufferUpdatable(p.h.UV6Kind)&&(z.uvs6._updatable=!0)),this.isVerticesDataPresent(p.h.ColorKind)&&(z.za=this._toNumberArray(this.getVerticesData(p.h.ColorKind)),this.isVertexBufferUpdatable(p.h.ColorKind)&&(z.za._updatable=!0)),this.isVerticesDataPresent(p.h.MatricesIndicesKind)&&(z.matricesIndices=this._toNumberArray(this.getVerticesData(p.h.MatricesIndicesKind)),z.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(p.h.MatricesIndicesKind)&&(z.matricesIndices._updatable=!0)),this.isVerticesDataPresent(p.h.MatricesWeightsKind)&&(z.matricesWeights=this._toNumberArray(this.getVerticesData(p.h.MatricesWeightsKind)),this.isVertexBufferUpdatable(p.h.MatricesWeightsKind)&&(z.matricesWeights._updatable=!0)),z.indices=this._toNumberArray(this.Rf()),z}static ExtractFromMesh(z,a){const K=z._geometry;return K?K.i(a):null}static RandomId(){return r.h.RandomId()}static _GetGeometryByLoadedUniqueId(z,a){for(let K=0;K<a.geometries.length;K++)if(a.geometries[K]._loadedUniqueId===z)return a.geometries[K];return null}static _ImportGeometry(z,a){const K=a.va(),v=z.geometryUniqueId,m=z.geometryId;if(v||m){const z=v?this._GetGeometryByLoadedUniqueId(v,K):K.getGeometryById(m);z&&z.Ca(a)}else if(z instanceof ArrayBuffer){const K=a._binaryInfo;if(K.positionsAttrDesc&&K.positionsAttrDesc.count>0){const v=new Float32Array(z,K.positionsAttrDesc.offset,K.positionsAttrDesc.count);a.Ga(p.h.PositionKind,v,!1)}if(K.normalsAttrDesc&&K.normalsAttrDesc.count>0){const v=new Float32Array(z,K.normalsAttrDesc.offset,K.normalsAttrDesc.count);a.Ga(p.h.NormalKind,v,!1)}if(K.tangetsAttrDesc&&K.tangetsAttrDesc.count>0){const v=new Float32Array(z,K.tangetsAttrDesc.offset,K.tangetsAttrDesc.count);a.Ga(p.h.TangentKind,v,!1)}if(K.uvsAttrDesc&&K.uvsAttrDesc.count>0){const v=new Float32Array(z,K.uvsAttrDesc.offset,K.uvsAttrDesc.count);if(l.d)for(let z=1;z<v.length;z+=2)v[z]=1-v[z];a.Ga(p.h.UVKind,v,!1)}if(K.uvs2AttrDesc&&K.uvs2AttrDesc.count>0){const v=new Float32Array(z,K.uvs2AttrDesc.offset,K.uvs2AttrDesc.count);if(l.d)for(let z=1;z<v.length;z+=2)v[z]=1-v[z];a.Ga(p.h.UV2Kind,v,!1)}if(K.uvs3AttrDesc&&K.uvs3AttrDesc.count>0){const v=new Float32Array(z,K.uvs3AttrDesc.offset,K.uvs3AttrDesc.count);if(l.d)for(let z=1;z<v.length;z+=2)v[z]=1-v[z];a.Ga(p.h.UV3Kind,v,!1)}if(K.uvs4AttrDesc&&K.uvs4AttrDesc.count>0){const v=new Float32Array(z,K.uvs4AttrDesc.offset,K.uvs4AttrDesc.count);if(l.d)for(let z=1;z<v.length;z+=2)v[z]=1-v[z];a.Ga(p.h.UV4Kind,v,!1)}if(K.uvs5AttrDesc&&K.uvs5AttrDesc.count>0){const v=new Float32Array(z,K.uvs5AttrDesc.offset,K.uvs5AttrDesc.count);if(l.d)for(let z=1;z<v.length;z+=2)v[z]=1-v[z];a.Ga(p.h.UV5Kind,v,!1)}if(K.uvs6AttrDesc&&K.uvs6AttrDesc.count>0){const v=new Float32Array(z,K.uvs6AttrDesc.offset,K.uvs6AttrDesc.count);if(l.d)for(let z=1;z<v.length;z+=2)v[z]=1-v[z];a.Ga(p.h.UV6Kind,v,!1)}if(K.colorsAttrDesc&&K.colorsAttrDesc.count>0){const v=new Float32Array(z,K.colorsAttrDesc.offset,K.colorsAttrDesc.count);a.Ga(p.h.ColorKind,v,!1,K.colorsAttrDesc.stride)}if(K.matricesIndicesAttrDesc&&K.matricesIndicesAttrDesc.count>0){const v=new Int32Array(z,K.matricesIndicesAttrDesc.offset,K.matricesIndicesAttrDesc.count),T=[];for(let z=0;z<v.length;z++){const a=v[z];T.push(255&a),T.push((65280&a)>>8),T.push((16711680&a)>>16),T.push(a>>24&255)}a.Ga(p.h.MatricesIndicesKind,T,!1)}if(K.matricesIndicesExtraAttrDesc&&K.matricesIndicesExtraAttrDesc.count>0){const v=new Int32Array(z,K.matricesIndicesExtraAttrDesc.offset,K.matricesIndicesExtraAttrDesc.count),T=[];for(let z=0;z<v.length;z++){const a=v[z];T.push(255&a),T.push((65280&a)>>8),T.push((16711680&a)>>16),T.push(a>>24&255)}a.Ga(p.h.MatricesIndicesExtraKind,T,!1)}if(K.matricesWeightsAttrDesc&&K.matricesWeightsAttrDesc.count>0){const v=new Float32Array(z,K.matricesWeightsAttrDesc.offset,K.matricesWeightsAttrDesc.count);a.Ga(p.h.MatricesWeightsKind,v,!1)}if(K.indicesAttrDesc&&K.indicesAttrDesc.count>0){const v=new Int32Array(z,K.indicesAttrDesc.offset,K.indicesAttrDesc.count);a.setIndices(v,null)}if(K.subMeshesAttrDesc&&K.subMeshesAttrDesc.count>0){const v=new Int32Array(z,K.subMeshesAttrDesc.offset,5*K.subMeshesAttrDesc.count);a.Vf=[];for(let z=0;z<K.subMeshesAttrDesc.count;z++){const K=v[5*z+0],T=v[5*z+1],m=v[5*z+2],p=v[5*z+3],s=v[5*z+4];j.e.AddToMesh(K,T,m,p,s,a)}}}else if(z.xa&&z.ya&&z.indices){if(a.Ga(p.h.PositionKind,z.xa,z.xa._updatable),a.Ga(p.h.NormalKind,z.ya,z.ya._updatable),z.tangents&&a.Ga(p.h.TangentKind,z.tangents,z.tangents._updatable),z.Aa&&a.Ga(p.h.UVKind,z.Aa,z.Aa._updatable),z.uvs2&&a.Ga(p.h.UV2Kind,z.uvs2,z.uvs2._updatable),z.uvs3&&a.Ga(p.h.UV3Kind,z.uvs3,z.uvs3._updatable),z.uvs4&&a.Ga(p.h.UV4Kind,z.uvs4,z.uvs4._updatable),z.uvs5&&a.Ga(p.h.UV5Kind,z.uvs5,z.uvs5._updatable),z.uvs6&&a.Ga(p.h.UV6Kind,z.uvs6,z.uvs6._updatable),z.za&&a.Ga(p.h.ColorKind,T.d.CheckColors4(z.za,z.xa.length/3),z.za._updatable),z.matricesIndices)if(z.matricesIndices._isExpanded)delete z.matricesIndices._isExpanded,a.Ga(p.h.MatricesIndicesKind,z.matricesIndices,z.matricesIndices._updatable);else{const K=[];for(let a=0;a<z.matricesIndices.length;a++){const v=z.matricesIndices[a];K.push(255&v),K.push((65280&v)>>8),K.push((16711680&v)>>16),K.push(v>>24&255)}a.Ga(p.h.MatricesIndicesKind,K,z.matricesIndices._updatable)}if(z.matricesIndicesExtra)if(z.matricesIndicesExtra._isExpanded)delete z.matricesIndices._isExpanded,a.Ga(p.h.MatricesIndicesExtraKind,z.matricesIndicesExtra,z.matricesIndicesExtra._updatable);else{const K=[];for(let a=0;a<z.matricesIndicesExtra.length;a++){const v=z.matricesIndicesExtra[a];K.push(255&v),K.push((65280&v)>>8),K.push((16711680&v)>>16),K.push(v>>24&255)}a.Ga(p.h.MatricesIndicesExtraKind,K,z.matricesIndicesExtra._updatable)}z.matricesWeights&&(c._CleanMatricesWeights(z,a),a.Ga(p.h.MatricesWeightsKind,z.matricesWeights,z.matricesWeights._updatable)),z.matricesWeightsExtra&&a.Ga(p.h.MatricesWeightsExtraKind,z.matricesWeightsExtra,z.matricesWeights._updatable),a.setIndices(z.indices,null)}if(z.Vf){a.Vf=[];for(let K=0;K<z.Vf.length;K++){const v=z.Vf[K];j.e.AddToMesh(v.materialIndex,v.verticesStart,v.verticesCount,v.indexStart,v.indexCount,a)}}a._shouldGenerateFlatShading&&(a.convertToFlatShadedMesh(),a._shouldGenerateFlatShading=!1),a.Qj(!0),K.onMeshImportedObservable.notifyObservers(a)}static _CleanMatricesWeights(z,a){const K=.001;if(!s.b.CleanBoneMatrixWeights)return;let v=0;if(!(z.skeletonId>-1))return;{const K=a.va().getLastSkeletonById(z.skeletonId);if(!K)return;v=K.bones.length}const T=a.getVerticesData(p.h.MatricesIndicesKind),m=a.getVerticesData(p.h.MatricesIndicesExtraKind),j=z.matricesWeights,M=z.matricesWeightsExtra,r=z.numBoneInfluencer,W=j.length;for(let p=0;p<W;p+=4){let z=0,a=-1;for(let v=0;v<4;v++){const T=j[p+v];z+=T,T<K&&a<0&&(a=v)}if(M)for(let v=0;v<4;v++){const T=M[p+v];z+=T,T<K&&a<0&&(a=v+4)}if((a<0||a>r-1)&&(a=r-1),z>K){const a=1/z;for(let z=0;z<4;z++)j[p+z]*=a;if(M)for(let z=0;z<4;z++)M[p+z]*=a}else a>=4?(M[p+a-4]=1-z,m[p+a-4]=v):(j[p+a]=1-z,T[p+a]=v)}a.Ga(p.h.MatricesIndicesKind,T),z.matricesWeightsExtra&&a.Ga(p.h.MatricesIndicesExtraKind,m)}static Parse(z,a,K){const T=new c(z.id,a,void 0,z.updatable);return T._loadedUniqueId=z.uniqueId,W.d&&W.d.AddTagsTo(T,z.tags),z.delayLoadingFile?(T.delayLoadState=4,T.delayLoadingFile=K+z.delayLoadingFile,T._boundingInfo=new M.e(v.o.Jg(z.boundingBoxMinimum),v.o.Jg(z.boundingBoxMaximum)),T._delayInfo=[],z.hasUVs&&T._delayInfo.push(p.h.UVKind),z.hasUVs2&&T._delayInfo.push(p.h.UV2Kind),z.hasUVs3&&T._delayInfo.push(p.h.UV3Kind),z.hasUVs4&&T._delayInfo.push(p.h.UV4Kind),z.hasUVs5&&T._delayInfo.push(p.h.UV5Kind),z.hasUVs6&&T._delayInfo.push(p.h.UV6Kind),z.hasColors&&T._delayInfo.push(p.h.ColorKind),z.hasMatricesIndices&&T._delayInfo.push(p.h.MatricesIndicesKind),z.hasMatricesWeights&&T._delayInfo.push(p.h.MatricesWeightsKind),T._delayLoadingFunction=m.b.ImportVertexData):m.b.ImportVertexData(z,T),a.pushGeometry(T,!0),T}}},11944:(z,a,K)=>{"use strict";K.d(a,{e:()=>F});var v=K(10941),T=K(10648),m=K(11249),p=K(11194),j=K(10653),s=K(11252),M=K(11001),r=K(10631),W=K(10767);p.c._instancedMeshFactory=(z,a)=>{const K=new F(z,a);if(a.instancedBuffers){K.instancedBuffers={};for(const z in a.instancedBuffers)K.instancedBuffers[z]=a.instancedBuffers[z]}return K};class F extends m.e{constructor(z,a){super(z,a.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,a.Ij(this),this._sourceMesh=a,this._unIndexed=a._unIndexed,this.position.p(a.position),this.rotation.p(a.rotation),this.Yd.p(a.Yd),a.rotationQuaternion&&(this.rotationQuaternion=a.rotationQuaternion.clone()),this.animations=a.animations.slice();for(const K of a.getAnimationRanges())null!=K&&this.createAnimationRange(K.name,K.from,K.to);this.infiniteDistance=a.infiniteDistance,this.setPivotMatrix(a.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(z){var a;(null===(a=this._sourceMesh)||void 0===a?void 0:a.receiveShadows)!==z&&r.h.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(z){var a;(null===(a=this._sourceMesh)||void 0===a?void 0:a.material)!==z&&r.h.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(z){var a;(null===(a=this._sourceMesh)||void 0===a?void 0:a.visibility)!==z&&r.h.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(z){var a;(null===(a=this._sourceMesh)||void 0===a?void 0:a.skeleton)!==z&&r.h.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(z){this._sourceMesh&&z!==this._sourceMesh.renderingGroupId&&T.c.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(z){return this._sourceMesh.createInstance(z)}isReady(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(z,!0)}getVerticesData(z,a,K){return this._sourceMesh.getVerticesData(z,a,K)}copyVerticesData(z,a){this._sourceMesh.copyVerticesData(z,a)}Ga(z,a,K,v){return this.sourceMesh&&this.sourceMesh.Ga(z,a,K,v),this.sourceMesh}updateVerticesData(z,a,K,v){return this.sourceMesh&&this.sourceMesh.updateVerticesData(z,a,K,v),this.sourceMesh}setIndices(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(z,a),this.sourceMesh}isVerticesDataPresent(z){return this._sourceMesh.isVerticesDataPresent(z)}Rf(){return this._sourceMesh.Rf()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let z,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],K=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;z="object"===typeof a?a:{applySkeleton:a,applyMorph:K};const v=this._sourceMesh.Fj?this._sourceMesh.Fj.boundingBias:null;return this.Fa(this._sourceMesh._getData(z,null,M.h.PositionKind),v),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(z,a){if(super._activate(z,a),this._sourceMesh.Vf||T.c.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,z),a){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==s.d.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new v.b);const z=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,v.j.gb[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Qj(!0)),this._currentLOD.position.p(v.j.gb[7]),this._currentLOD._masterMesh=z,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(z){if(!z)return this;const a=this.sourceMesh.getLODLevels();if(a&&0!==a.length){const a=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(z,a.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(z){return this.sourceMesh._preActivateForIntermediateRendering(z)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.Vf)for(let z=0;z<this._sourceMesh.Vf.length;z++)this._sourceMesh.Vf[z].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0;const v=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(z);if(j.b.DeepCopy(this,v,["name","Vf","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","rj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),a&&(v.parent=a),!K)for(let T=0;T<this.va().meshes.length;T++){const z=this.va().meshes[T];z.parent===this&&z.clone(z.name,v)}return v.Qj(!0),this.onClonedObservable.notifyObservers(v),v}dispose(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Hj(this),super.dispose(z,a)}_serializeAsParent(z){super._serializeAsParent(z),z.parentId=this._sourceMesh.uniqueId,z.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1?arguments[1]:void 0,K=arguments.length>2?arguments[2]:void 0;const v=this.clone("Clone of "+(this.name||this.id),z||this.parent,!0,a&&a.newSourcedMesh);v&&K&&K(this,v);for(const T of this.getChildTransformNodes(!0))T.instantiateHierarchy(v,a,K);return v}}p.c.prototype.registerInstancedBuffer=function(z,a){var K,v;if(null===(K=this._userInstancedBuffersStorage)||void 0===K||null===(v=K.vertexBuffers[z])||void 0===v||v.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const z of this.instances)z.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[z]=null,this._userInstancedBuffersStorage.strides[z]=a,this._userInstancedBuffersStorage.sizes[z]=32*a,this._userInstancedBuffersStorage.data[z]=new Float32Array(this._userInstancedBuffersStorage.sizes[z]),this._userInstancedBuffersStorage.vertexBuffers[z]=new M.h(this.getEngine(),this._userInstancedBuffersStorage.data[z],z,!0,!1,a,!0);for(const T of this.instances)T.instancedBuffers[z]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},p.c.prototype._processInstancedBuffers=function(z,a){const K=z?z.length:0;for(const v in this.instancedBuffers){let T=this._userInstancedBuffersStorage.sizes[v];const m=this._userInstancedBuffersStorage.strides[v],p=(K+1)*m;for(;T<p;)T*=2;this._userInstancedBuffersStorage.data[v].length!=T&&(this._userInstancedBuffersStorage.data[v]=new Float32Array(T),this._userInstancedBuffersStorage.sizes[v]=T,this._userInstancedBuffersStorage.vertexBuffers[v]&&(this._userInstancedBuffersStorage.vertexBuffers[v].dispose(),this._userInstancedBuffersStorage.vertexBuffers[v]=null));const j=this._userInstancedBuffersStorage.data[v];let s=0;if(a){const z=this.instancedBuffers[v];z.toArray?z.toArray(j,s):z.copyToArray?z.copyToArray(j,s):j[s]=z,s+=m}for(let a=0;a<K;a++){const K=z[a].instancedBuffers[v];K.toArray?K.toArray(j,s):K.copyToArray?K.copyToArray(j,s):j[s]=K,s+=m}this._userInstancedBuffersStorage.vertexBuffers[v]?this._userInstancedBuffersStorage.vertexBuffers[v].updateDirectly(j,0):(this._userInstancedBuffersStorage.vertexBuffers[v]=new M.h(this.getEngine(),this._userInstancedBuffersStorage.data[v],v,!0,!1,m,!0),this._invalidateInstanceVertexArrayObject())}},p.c.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const z in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[z]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},p.c.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const z in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[z]&&this._userInstancedBuffersStorage.vertexBuffers[z].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,W.e)("BABYLON.InstancedMesh",F)},11194:(z,a,K)=>{"use strict";K.d(a,{c:()=>P,g:()=>Z});var v=K(10638),T=K(10631),m=K(10653),p=K(10937),j=K(11202),s=K(11207),M=K(10941),r=K(10971),W=K(11215),F=K(11001),G=K(11230),l=K(11236),V=K(11249),c=K(11066),C=K(11064),w=K(11264),H=K(11244),f=K(10973),Y=K(10648),I=K(10767),q=K(10663),B=K(11019);class x{constructor(z,a){this.distanceOrScreenCoverage=z,this.mesh=a}}class Z{}class y{constructor(){this.visibleInstances={},this.batchCache=new i,this.batchCacheReplacementModeInFrozenMode=new i,this.instancesBufferSize=2048}}class i{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class n{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class X{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class P extends V.e{static _GetDefaultSideOrientation(z){return z||P.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(z){this._internalMeshDataInfo._useLODScreenCoverage=z,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(z){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==z&&(z&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(F.h.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(F.h.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=z,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new v.c),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new v.c),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new v.c),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new v.c),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new v.c),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(z){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(z)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(z){this._internalMeshDataInfo._forcedInstanceCount=z}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(z){this._internalMeshDataInfo._sideOrientation=z,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===z||!this._scene.useRightHandedSystem&&0===z}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(z){this.sideOrientation=z,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(z){this._internalMeshDataInfo._overrideRenderingFillMode=z}get material(){return this._internalAbstractMeshDataInfo._material}set material(z){z&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(z.sideOrientation=null),this._setMaterial(z)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(z){this._unIndexed!==z&&(this._unIndexed=z,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(z){this._instanceDataStorage.manualUpdate=z}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(z){this._instanceDataStorage.previousManualUpdate=z}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(z){this._instanceDataStorage.forceMatrixUpdates=z}_copySource(z,a){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const v=this.va();if(z._geometry&&z._geometry.Ca(this),m.b.DeepCopy(z,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Fj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","rj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=z,v.useClonedMeshMap&&(z._internalMeshDataInfo.meshMap||(z._internalMeshDataInfo.meshMap={}),z._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=z._originalBuilderSideOrientation,this._creationDataStorage=z._creationDataStorage,z._ranges){const a=z._ranges;for(const z in a)Object.prototype.hasOwnProperty.call(a,z)&&a[z]&&this.createAnimationRange(z,a[z].from,a[z].to)}if(z.metadata&&z.metadata.clone?this.metadata=z.metadata.clone():this.metadata=z.metadata,this._internalMetadata=z._internalMetadata,p.d&&p.d.HasTags(z)&&p.d.AddTagsTo(this,p.d.GetTags(z,!0)),this.Nb(z.isEnabled(!1)),this.parent=z.parent,this.setPivotMatrix(z.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+z.id,this.material=z.material,!a){const a=z.getDescendants(!0);for(let z=0;z<a.length;z++){const K=a[z];K.clone&&K.clone(this.name+"."+K.name,this)}}if(z.morphTargetManager&&(this.morphTargetManager=z.morphTargetManager),v.getPhysicsEngine){const a=v.getPhysicsEngine();if(K&&a)if(1===a.getPluginVersion()){const K=a.getImpostorForPhysicsObject(z);K&&(this.physicsImpostor=K.clone(this))}else 2===a.getPluginVersion()&&z.physicsBody&&z.physicsBody.clone(this)}for(let T=0;T<v.sj.length;T++){const a=v.sj[T];a.j===z&&a.clone(a.name,this)}this.skeleton=z.skeleton,this.refreshBoundingInfo(!0,!0),this.Qj(!0)}constructor(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4?arguments[4]:void 0,p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(z,a),this._internalMeshDataInfo=new X,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new y,this._thinInstanceDataStorage=new n,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=P.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,a=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(z,a,K)=>{z&&K&&(this._uniformBuffer?this.transferToEffect(a):K.bindOnlyWorldMatrix(a))},T&&this._copySource(T,m,p),null!==K&&(this.parent=K),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=z=>{z.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new v.c(this._internalMeshDataInfo._onMeshReadyObserverAdded),T&&T.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1?arguments[1]:void 0,K=arguments.length>2?arguments[2]:void 0;const v=0===this.getTotalVertices()||a&&a.doNotInstantiate&&(!0===a.doNotInstantiate||a.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),z||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));v.parent=z||this.parent,v.position=this.position.clone(),v.Yd=this.Yd.clone(),this.rotationQuaternion?v.rotationQuaternion=this.rotationQuaternion.clone():v.rotation=this.rotation.clone(),K&&K(this,v);for(const T of this.getChildTransformNodes(!0))"InstancedMesh"===T.getClassName()&&"Mesh"===v.getClassName()&&T.sourceMesh===this?T.instantiateHierarchy(v,{doNotInstantiate:a&&a.doNotInstantiate||!1,newSourcedMesh:v},K):T.instantiateHierarchy(v,a,K);return v}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(z){let a=super.toString(z);if(a+=", n vertices: "+this.getTotalVertices(),a+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let K=0;K<this.animations.length;K++)a+=", animation[0]: "+this.animations[K].toString(z);if(z)if(this._geometry){const z=this.Rf(),K=this.getVerticesData(F.h.PositionKind);K&&z&&(a+=", flat shading: "+(K.length/3===z.length?"YES":"NO"))}else a+=", flat shading: UNKNOWN";return a}_unBindEffect(){super._unBindEffect();for(const z of this.instances)z._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const z=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((a,K)=>a.distanceOrScreenCoverage<K.distanceOrScreenCoverage?z:a.distanceOrScreenCoverage>K.distanceOrScreenCoverage?-z:0))}addLODLevel(z,a){if(a&&a._masterMesh)return Y.c.Warn("You cannot use a mesh as LOD level twice"),this;const K=new x(z,a);return this._internalMeshDataInfo._LODLevels.push(K),a&&(a._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(z){const a=this._internalMeshDataInfo;for(let K=0;K<a._LODLevels.length;K++){const v=a._LODLevels[K];if(v.distanceOrScreenCoverage===z)return v.mesh}return null}removeLODLevel(z){const a=this._internalMeshDataInfo;for(let K=0;K<a._LODLevels.length;K++)a._LODLevels[K].mesh===z&&(a._LODLevels.splice(K,1),z&&(z._masterMesh=null));return this._sortLODLevels(),this}getLOD(z,a){const K=this._internalMeshDataInfo;if(!K._LODLevels||0===K._LODLevels.length)return this;const v=a||this.getBoundingInfo().boundingSphere,T=z.mode===s.d.ORTHOGRAPHIC_CAMERA?z.Yi:v.centerWorld.sc(z.globalPosition).length();let m=T,p=1;if(K._useLODScreenCoverage){const a=z.screenArea;let K=v.radiusWorld*z.Yi/T;K=K*K*Math.PI,m=K/a,p=-1}if(p*K._LODLevels[K._LODLevels.length-1].distanceOrScreenCoverage>p*m)return this.onLODLevelSelection&&this.onLODLevelSelection(m,this,this),this;for(let j=0;j<K._LODLevels.length;j++){const z=K._LODLevels[j];if(p*z.distanceOrScreenCoverage<p*m){if(z.mesh){if(4===z.mesh.delayLoadState)return z.mesh._checkDelayState(),this;if(2===z.mesh.delayLoadState)return this;z.mesh._preActivate(),z.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(m,this,z.mesh),z.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(m,this,this),this}get Fj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(z,a,K,v){var T,m;if(!this._geometry)return null;let p=v||null===(T=this._userInstancedBuffersStorage)||void 0===T||null===(m=T.vertexBuffers[z])||void 0===m?void 0:m.getFloatData(this.instances.length+1,K||a&&1!==this._geometry.meshes.length);return p||(p=this._geometry.getVerticesData(z,a,K)),p}copyVerticesData(z,a){this._geometry&&this._geometry.copyVerticesData(z,a)}getVertexBuffer(z,a){var K;return this._geometry?(a||null===(K=this._userInstancedBuffersStorage)||void 0===K?void 0:K.vertexBuffers[z])??this._geometry.getVertexBuffer(z):null}isVerticesDataPresent(z,a){var K;return this._geometry?!a&&void 0!==(null===(K=this._userInstancedBuffersStorage)||void 0===K?void 0:K.vertexBuffers[z])||this._geometry.isVerticesDataPresent(z):!!this._delayInfo&&-1!==this._delayInfo.indexOf(z)}isVertexBufferUpdatable(z,a){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(z);if(!a){var K;const a=null===(K=this._userInstancedBuffersStorage)||void 0===K?void 0:K.vertexBuffers[z];if(a)return a.isUpdatable()}return this._geometry.isVertexBufferUpdatable(z)}getVerticesDataKinds(z){if(!this._geometry){const z=[];return this._delayInfo&&this._delayInfo.forEach((function(a){z.push(a)})),z}const a=this._geometry.getVerticesDataKinds();if(!z&&this._userInstancedBuffersStorage)for(const K in this._userInstancedBuffersStorage.vertexBuffers)-1===a.indexOf(K)&&a.push(K);return a}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Rf(z,a){return this._geometry?this._geometry.Rf(z,a):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(z))return!1;if(!this.Vf||0===this.Vf.length)return!0;if(!z)return!0;const K=this.getEngine(),v=this.va(),T=a||K.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Qj();const m=this.material||v.defaultMaterial;if(m)if(m._storeEffectOnSubMeshes)for(const F of this.Vf){const z=F.Ha();if(z)if(z._storeEffectOnSubMeshes){if(!z.isReadyForSubMesh(this,F,T))return!1}else if(!z.isReady(this,T))return!1}else if(!m.isReady(this,T))return!1;const p=K.currentRenderPassId;for(const F of this.lightSources){const z=F.getShadowGenerators();if(!z)continue;const a=z.values();for(let v=a.next();!0!==v.done;v=a.next()){var j,s,M,r;const z=v.value;if(z&&(null===(j=z.getShadowMap())||void 0===j||!j.renderList||null!==(s=z.getShadowMap())&&void 0!==s&&s.renderList&&-1!==(null===(M=z.getShadowMap())||void 0===M||null===(r=M.renderList)||void 0===r?void 0:r.indexOf(this)))){const a=z.getShadowMap().renderPassIds??[K.currentRenderPassId];for(let v=0;v<a.length;++v){K.currentRenderPassId=a[v];for(const a of this.Vf){var W;if(!z.isReady(a,T,(null===(W=a.Ha())||void 0===W?void 0:W.needAlphaBlendingForMesh(this))??!1))return K.currentRenderPassId=p,!1}}K.currentRenderPassId=p}}}for(const F of this._internalMeshDataInfo._LODLevels)if(F.mesh&&!F.mesh.isReady(T))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Fh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(z){this._instanceDataStorage.overridenInstanceCount=z}_preActivate(){const z=this._internalMeshDataInfo,a=this.va().getRenderId();return z._preActivateId===a||(z._preActivateId=a,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(z){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=z),this}_registerInstanceForRenderId(z,a){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:a,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[a]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=a,this._instanceDataStorage.visibleInstances[a]=new Array),this._instanceDataStorage.visibleInstances[a].push(z),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let z,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],K=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;z="object"===typeof a?a:{applySkeleton:a,applyMorph:K};const v=this.Fj?this.Fj.boundingBias:null;return this.Fa(this._getData(z,null,F.h.PositionKind),v),this}_createGlobalSubMesh(z){const a=this.getTotalVertices();if(!a||!this.Rf())return null;if(this.Vf&&this.Vf.length>0){const K=this.Rf();if(!K)return null;const v=K.length;let T=!1;if(z)T=!0;else for(const z of this.Vf){if(z.indexStart+z.indexCount>v){T=!0;break}if(z.verticesStart+z.verticesCount>a){T=!0;break}}if(!T)return this.Vf[0]}return this.releaseSubMeshes(),new c.e(0,0,a,0,this.getTotalIndices(),this)}subdivide(z){if(z<1)return;const a=this.getTotalIndices();let K=a/z|0,v=0;for(;K%3!==0;)K++;this.releaseSubMeshes();for(let T=0;T<z&&!(v>=a);T++)c.e.CreateFromIndices(0,v,T===z-1?a-v:K,this,void 0,!1),v+=K;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(z,a,K,v);else{const v=new G.b;v.set(a,z);const T=this.va();new l.b(l.b.RandomId(),T,v,K,this)}return this}removeVerticesData(z){this._geometry&&this._geometry.removeVerticesData(z)}markVerticesDataAsUpdatable(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const K=this.getVertexBuffer(z);K&&K.isUpdatable()!==a&&this.Ga(z,this.getVerticesData(z),a)}setVerticesBuffer(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=l.b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(z,null,a),this}updateVerticesData(z,a,K,v){return this._geometry?(v?(this.makeGeometryUnique(),this.updateVerticesData(z,a,K,!1)):this._geometry.updateVerticesData(z,a,K),this):this}updateMeshPositions(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const K=this.getVerticesData(F.h.PositionKind);if(!K)return this;if(z(K),this.updateVerticesData(F.h.PositionKind,K,!1,!1),a){const z=this.Rf(),a=this.getVerticesData(F.h.NormalKind);if(!a)return this;G.b.ComputeNormals(K,z,a),this.updateVerticesData(F.h.NormalKind,a,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const z=this._geometry,a=this._geometry.i(l.b.RandomId());return z.releaseForMesh(this,!0),a.Ca(this),this}setIndexBuffer(z,a,K){let v=this._geometry;v||(v=new l.b(l.b.RandomId(),this.va(),void 0,void 0,this)),v.setIndexBuffer(z,a,K)}setIndices(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(z,a,K,v);else{const a=new G.b;a.indices=z;const v=this.va();new l.b(l.b.RandomId(),v,a,K,this)}return this}updateIndices(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(z,a,K),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(z,a,K){let v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const T=this.va().getEngine();let m;if(this._unIndexed)if(this._getRenderingFillMode(K)===C.b.WireFrameFillMode)m=z._getLinesIndexBuffer(this.Rf(),T);else m=null;else switch(this._getRenderingFillMode(K)){case C.b.PointFillMode:m=null;break;case C.b.WireFrameFillMode:m=z._getLinesIndexBuffer(this.Rf(),T);break;default:case C.b.TriangleFillMode:m=this._geometry.getIndexBuffer()}return this._bindDirect(a,m,v)}_bindDirect(z,a){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(z),K&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(z,a,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(z,a),this):this}_draw(z,a,K){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const v=this.va().getEngine();return this._unIndexed&&a!==C.b.WireFrameFillMode||a==C.b.PointFillMode?v.drawArraysType(a,z.verticesStart,z.verticesCount,this.forcedInstanceCount||K):a==C.b.WireFrameFillMode?v.drawElementsType(a,0,z._linesIndexCount,this.forcedInstanceCount||K):v.drawElementsType(a,z.indexStart,z.indexCount,this.forcedInstanceCount||K),this}registerBeforeRender(z){return this.onBeforeRenderObservable.add(z),this}unregisterBeforeRender(z){return this.onBeforeRenderObservable.removeCallback(z),this}registerAfterRender(z){return this.onAfterRenderObservable.add(z),this}unregisterAfterRender(z){return this.onAfterRenderObservable.removeCallback(z),this}_getInstancesRenderList(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(a)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[z]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[z]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const K=this.va(),v=K._isInIntermediateRendering(),T=v?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,m=this._instanceDataStorage.batchCache;if(m.mustReturn=!1,m.renderSelf[z]=a||!T&&this.isEnabled()&&this.isVisible,m.visibleInstances[z]=null,this._instanceDataStorage.visibleInstances&&!a){const a=this._instanceDataStorage.visibleInstances,T=K.getRenderId(),p=v?a.intermediateDefaultRenderId:a.defaultRenderId;m.visibleInstances[z]=a[T],!m.visibleInstances[z]&&p&&(m.visibleInstances[z]=a[p])}return m.hardwareInstancedRendering[z]=!a&&this._instanceDataStorage.hardwareInstancedRendering&&null!==m.visibleInstances[z]&&void 0!==m.visibleInstances[z],this._instanceDataStorage.previousBatch=m,m}_renderWithInstances(z,a,K,v,T){const m=K.visibleInstances[z._id],p=m?m.length:0,j=this._instanceDataStorage,s=j.instancesBufferSize;let r=j.instancesBuffer,W=j.instancesPreviousBuffer;const G=16*(p+1)*4;for(;j.instancesBufferSize<G;)j.instancesBufferSize*=2;j.instancesData&&s==j.instancesBufferSize||(j.instancesData=new Float32Array(j.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!j.instancesPreviousData||s!=j.instancesBufferSize)&&(j.instancesPreviousData=new Float32Array(j.instancesBufferSize/4));let l=0,V=0;const c=K.renderSelf[z._id],C=!r||s!==j.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!j.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||j.isFrozen&&!C)V=(c?1:0)+p;else{const a=this.getWorldMatrix();if(c&&(this._scene.needsPreviousWorldMatrices&&(j.masterMeshPreviousWorldMatrix?(j.masterMeshPreviousWorldMatrix.copyToArray(j.instancesPreviousData,l),j.masterMeshPreviousWorldMatrix.p(a)):(j.masterMeshPreviousWorldMatrix=a.clone(),j.masterMeshPreviousWorldMatrix.copyToArray(j.instancesPreviousData,l))),a.copyToArray(j.instancesData,l),l+=16,V++),m){var w;if(P.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(w=z.Ha())&&void 0!==w&&w.needAlphaBlendingForMesh(z.getRenderingMesh())){const z=this._scene.activeCamera.globalPosition;for(let a=0;a<m.length;a++){const K=m[a];K._distanceToCamera=M.o.Distance(K.getBoundingInfo().boundingSphere.centerWorld,z)}m.sort(((z,a)=>z._distanceToCamera>a._distanceToCamera?-1:z._distanceToCamera<a._distanceToCamera?1:0))}for(let z=0;z<m.length;z++){const a=m[z],K=a.getWorldMatrix();K.copyToArray(j.instancesData,l),this._scene.needsPreviousWorldMatrices&&(a._previousWorldMatrix?(a._previousWorldMatrix.copyToArray(j.instancesPreviousData,l),a._previousWorldMatrix.p(K)):(a._previousWorldMatrix=K.clone(),a._previousWorldMatrix.copyToArray(j.instancesPreviousData,l))),l+=16,V++}}}return C?(r&&r.dispose(),W&&W.dispose(),r=new F.e(T,j.instancesData,!0,16,!1,!0),j.instancesBuffer=r,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=r.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=r.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=r.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=r.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(W=new F.e(T,j.instancesPreviousData,!0,16,!1,!0),j.instancesPreviousBuffer=W,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=W.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=W.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=W.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=W.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(r.updateDirectly(j.instancesData,0,V),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||W.updateDirectly(j.instancesPreviousData,0,V)),this._processInstancedBuffers(m,c),this.va()._activeIndices.addCount(z.indexCount*V,!1),T._currentDrawContext&&(T._currentDrawContext.useInstancing=!0),this._bind(z,v,a),this._draw(z,a,V),!this._scene.needsPreviousWorldMatrices||C||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||W.updateDirectly(j.instancesData,0,V),T.unbindInstanceAttributes(),this}_renderWithThinInstances(z,a,K,v){var T;const m=(null===(T=this._thinInstanceDataStorage)||void 0===T?void 0:T.instancesCount)??0;this.va()._activeIndices.addCount(z.indexCount*m,!1),v._currentDrawContext&&(v._currentDrawContext.useInstancing=!0),this._bind(z,K,a),this._draw(z,a,m),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,m):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),v.unbindInstanceAttributes()}_processInstancedBuffers(z,a){}_processRendering(z,a,K,v,T,m,p,j){const s=this.va(),M=s.getEngine();if(v=this._getRenderingFillMode(v),m&&a.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(a,v,K,M),this;if(m)this._renderWithInstances(a,v,T,K,M);else{M._currentDrawContext&&(M._currentDrawContext.useInstancing=!1);let K=0;T.renderSelf[a._id]&&(p&&p(!1,z.getWorldMatrix(),j),K++,this._draw(a,v,this._instanceDataStorage.overridenInstanceCount));const m=T.visibleInstances[a._id];if(m){const z=m.length;K+=z;for(let K=0;K<z;K++){const z=m[K].getWorldMatrix();p&&p(!0,z,j),this._draw(a,v)}}s._activeIndices.addCount(a.indexCount*K,!1)}return this}_rebuild(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(z&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const a in this._userInstancedBuffersStorage.vertexBuffers){const K=this._userInstancedBuffersStorage.vertexBuffers[a];K&&(z&&K.dispose(),this._userInstancedBuffersStorage.vertexBuffers[a]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(z)}_freeze(){if(this.Vf){for(let z=0;z<this.Vf.length;z++)this._getInstancesRenderList(z);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(z,a,K,v){let T=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const m=this._scene.getEngine(),p=m.currentRenderPassId;if(void 0!==z&&(m.currentRenderPassId=z),v)(!T||T&&v.isInFrustum(this._scene._frustumPlanes))&&this.render(v,!!a,K);else for(let j=0;j<this.Vf.length;j++){const z=this.Vf[j];(!T||T&&z.isInFrustum(this._scene._frustumPlanes))&&this.render(z,!!a,K)}return void 0!==z&&(m.currentRenderPassId=p),this}directRender(){if(!this.Vf)return this;for(const z of this.Vf)this.render(z,!1);return this}render(z,a,K){var v,T,m;const p=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const j=(null===(v=p.activeCameras)||void 0===v?void 0:v.length)??0;if((j>1&&p.activeCamera===p.activeCameras[0]||j<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const s=this._getInstancesRenderList(z._id,!!K);if(s.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const M=p.getEngine();let r=0,W=null;this.ignoreCameraMaxZ&&p.activeCamera&&!p._isInIntermediateRendering()&&(r=p.activeCamera.maxZ,W=p.activeCamera,p.activeCamera.maxZ=0,p.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const F=z.getRenderingMesh(),G=s.hardwareInstancedRendering[z._id]||F.hasThinInstances||!!this._userInstancedBuffersStorage&&!z.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,l=this._instanceDataStorage,V=z.Ha();if(!V)return W&&(W.maxZ=r,p.updateTransformMatrix(!0)),this;if(l.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===V){if(V._storeEffectOnSubMeshes&&(null===(T=z._drawWrapper)||void 0===T||!T._wasPreviouslyReady)||!V._storeEffectOnSubMeshes&&!V._getDrawWrapper()._wasPreviouslyReady)return W&&(W.maxZ=r,p.updateTransformMatrix(!0)),this}else{if(V._storeEffectOnSubMeshes){if(!V.isReadyForSubMesh(this,z,G))return W&&(W.maxZ=r,p.updateTransformMatrix(!0)),this}else if(!V.isReady(this,G))return W&&(W.maxZ=r,p.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=V}let c;a&&M.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),c=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?z._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const w=(null===(m=c)||void 0===m?void 0:m.effect)??null;for(const C of p._beforeRenderingMeshStage)C.action(this,z,s,w);if(!c||!w)return W&&(W.maxZ=r,p.updateTransformMatrix(!0)),this;const H=K||this;let f;if(l.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Rg&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)f=l.sideOrientation;else{const z=H._getWorldMatrixDeterminant();f=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),z<0&&(f=f===C.b.ClockWiseSideOrientation?C.b.CounterClockWiseSideOrientation:C.b.ClockWiseSideOrientation),l.sideOrientation=f}const Y=this._internalMeshDataInfo._effectiveMaterial._preBind(c,f);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&M.setDepthWrite(!0);const I=this._internalMeshDataInfo._effectiveMaterial,q=I.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),G||this._bind(z,w,q,!1);const B=H.getWorldMatrix();I._storeEffectOnSubMeshes?I.bindForSubMesh(B,this,z):I.bind(B,this),!I.Rg&&I.separateCullingPass&&(M.setState(!0,I.zOffset,!1,!Y,I.cullBackFaces,I.stencil,I.zOffsetUnits),this._processRendering(this,z,w,q,s,G,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),M.setState(!0,I.zOffset,!1,Y,I.cullBackFaces,I.stencil,I.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(z)),this._processRendering(this,z,w,q,s,G,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const C of p._afterRenderingMeshStage)C.action(this,z,s,w);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),W&&(W.maxZ=r,p.updateTransformMatrix(!0)),2!==p.performancePriority||l.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(F.h.MatricesWeightsKind)&&(this.isVerticesDataPresent(F.h.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const z=this.getVerticesData(F.h.MatricesWeightsKind),a=z.length;for(let K=0;K<a;K+=4){const a=z[K]+z[K+1]+z[K+2]+z[K+3];if(0===a)z[K]=1;else{const v=1/a;z[K]*=v,z[K+1]*=v,z[K+2]*=v,z[K+3]*=v}}this.Ga(F.h.MatricesWeightsKind,z)}_normalizeSkinWeightsAndExtra(){const z=this.getVerticesData(F.h.MatricesWeightsExtraKind),a=this.getVerticesData(F.h.MatricesWeightsKind),K=a.length;for(let v=0;v<K;v+=4){let K=a[v]+a[v+1]+a[v+2]+a[v+3];if(K+=z[v]+z[v+1]+z[v+2]+z[v+3],0===K)a[v]=1;else{const T=1/K;a[v]*=T,a[v+1]*=T,a[v+2]*=T,a[v+3]*=T,z[v]*=T,z[v+1]*=T,z[v+2]*=T,z[v+3]*=T}}this.Ga(F.h.MatricesWeightsKind,a),this.Ga(F.h.MatricesWeightsKind,z)}validateSkinning(){const z=this.getVerticesData(F.h.MatricesWeightsExtraKind),a=this.getVerticesData(F.h.MatricesWeightsKind);if(null===a||null==this.skeleton)return{skinned:!1,valid:!0,nm:"not skinned"};const K=a.length;let v=0,T=0,m=0,p=0;const j=null===z?4:8,s=[];for(let F=0;F<=j;F++)s[F]=0;for(let F=0;F<K;F+=4){let K=a[F],M=K,r=0===M?0:1;for(let T=1;T<j;T++){const m=T<4?a[F+T]:z[F+T-4];m>K&&v++,0!==m&&r++,M+=m,K=m}if(s[r]++,r>m&&(m=r),0===M)T++;else{const K=1/M;let v=0;for(let T=0;T<j;T++)v+=T<4?Math.abs(a[F+T]-a[F+T]*K):Math.abs(z[F+T-4]-z[F+T-4]*K);v>.001&&p++}}const M=this.skeleton.bones.length,r=this.getVerticesData(F.h.MatricesIndicesKind),W=this.getVerticesData(F.h.MatricesIndicesExtraKind);let G=0;for(let F=0;F<K;F+=4)for(let z=0;z<j;z++){const a=z<4?r[F+z]:W[F+z-4];(a>=M||a<0)&&G++}return{skinned:!0,valid:0===T&&0===p&&0===G,nm:"Number of Weights = "+K/4+"\nMaximum influences = "+m+"\nMissing Weights = "+T+"\nNot Sorted = "+v+"\nNot Normalized = "+p+"\nWeightCounts = ["+s+"]\nNumber of bones = "+M+"\nBad Bone Indices = "+G}}_checkDelayState(){const z=this.va();return this._geometry?this._geometry.load(z):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(z)),this}_queueLoad(z){z.addPendingData(this);const a=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return T.h.LoadFile(this.delayLoadingFile,(a=>{a instanceof ArrayBuffer?this._delayLoadingFunction(a,this):this._delayLoadingFunction(JSON.parse(a),this),this.instances.forEach((z=>{z.refreshBoundingInfo(),z._syncSubMeshes()})),this.delayLoadState=1,z.removePendingData(this)}),(()=>{}),z.offlineProvider,a),this}isInFrustum(z){return 2!==this.delayLoadState&&(!!super.isInFrustum(z)&&(this._checkDelayState(),!0))}setMaterialById(z){const a=this.va().materials;let K;for(K=a.length-1;K>-1;K--)if(a[K].id===z)return this.material=a[K],this;const v=this.va().multiMaterials;for(K=v.length-1;K>-1;K--)if(v[K].id===z)return this.material=v[K],this;return this}getAnimatables(){const z=[];return this.material&&z.push(this.material),this.skeleton&&z.push(this.skeleton),z}bakeTransformIntoVertices(z){if(!this.isVerticesDataPresent(F.h.PositionKind))return this;const a=this.Vf.splice(0);this._resetPointsArrayCache();let K=this.getVerticesData(F.h.PositionKind);const v=M.o.Zero();let T;for(T=0;T<K.length;T+=3)M.o.TransformCoordinatesFromFloatsToRef(K[T],K[T+1],K[T+2],z,v).toArray(K,T);if(this.Ga(F.h.PositionKind,K,this.getVertexBuffer(F.h.PositionKind).isUpdatable()),this.isVerticesDataPresent(F.h.NormalKind)){for(K=this.getVerticesData(F.h.NormalKind),T=0;T<K.length;T+=3)M.o.TransformNormalFromFloatsToRef(K[T],K[T+1],K[T+2],z,v).normalize().toArray(K,T);this.Ga(F.h.NormalKind,K,this.getVertexBuffer(F.h.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(F.h.TangentKind)){for(K=this.getVerticesData(F.h.TangentKind),T=0;T<K.length;T+=4)M.o.TransformNormalFromFloatsToRef(K[T],K[T+1],K[T+2],z,v).normalize().toArray(K,T);this.Ga(F.h.TangentKind,K,this.getVertexBuffer(F.h.TangentKind).isUpdatable())}return z.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.Vf=a,this}bakeCurrentTransformIntoVertices(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Qj(!0)),this.resetLocalMatrix(z),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0,K=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new P(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),z,this,a,K)}dispose(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const K=this._internalMeshDataInfo;if(K._onBeforeDrawObservable&&K._onBeforeDrawObservable.clear(),K._onBeforeBindObservable&&K._onBeforeBindObservable.clear(),K._onBeforeRenderObservable&&K._onBeforeRenderObservable.clear(),K._onAfterRenderObservable&&K._onAfterRenderObservable.clear(),K._onBetweenPassObservable&&K._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(K.meshMap)for(const z in K.meshMap){const a=K.meshMap[z];a&&(a._internalMeshDataInfo._source=null,K.meshMap[z]=void 0)}K._source&&K._source._internalMeshDataInfo.meshMap&&(K._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const z=this.va().meshes;for(const a of z){const z=a;z._internalMeshDataInfo&&z._internalMeshDataInfo._source&&z._internalMeshDataInfo._source===this&&(z._internalMeshDataInfo._source=null)}}K._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(z,a)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(z,a,K,v,m,p){let j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7?arguments[7]:void 0;const M=this.va();return T.h.LoadImage(z,(z=>{const T=z.width,s=z.height,M=this.getEngine().createCanvas(T,s).getContext("2d");M.drawImage(z,0,0);const r=M.getImageData(0,0,T,s).data;this.applyDisplacementMapFromBuffer(r,T,s,a,K,m,p,j),v&&v(this)}),s||(()=>{}),M.offlineProvider),this}applyDisplacementMapFromBuffer(z,a,K,v,T,m,p){let j=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(F.h.PositionKind)||!this.isVerticesDataPresent(F.h.NormalKind)||!this.isVerticesDataPresent(F.h.UVKind))return Y.c.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const s=this.getVerticesData(F.h.PositionKind,!0,!0),r=this.getVerticesData(F.h.NormalKind),W=this.getVerticesData(F.h.UVKind);let l=M.o.Zero();const V=M.o.Zero(),c=M.m.Zero();m=m||M.m.Zero(),p=p||new M.m(1,1);for(let F=0;F<s.length;F+=3){M.o.FromArrayToRef(s,F,l),M.o.FromArrayToRef(r,F,V),M.m.FromArrayToRef(W,F/3*2,c);const j=4*((Math.abs(c.x*p.x+m.x%1)*(a-1)%a|0)+(Math.abs(c.y*p.y+m.y%1)*(K-1)%K|0)*a),G=.3*(z[j]/255)+.59*(z[j+1]/255)+.11*(z[j+2]/255);V.normalize(),V.scaleInPlace(v+(T-v)*G),l=l.add(V),l.toArray(s,F)}return G.b.ComputeNormals(s,this.Rf(),r),j?(this.Ga(F.h.PositionKind,s),this.Ga(F.h.NormalKind,r),this.Ga(F.h.UVKind,W)):(this.updateVerticesData(F.h.PositionKind,s),this.updateVerticesData(F.h.NormalKind,r)),this}_getFlattenedNormals(z,a){const K=new Float32Array(3*z.length);let v=0;const T=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let m=0;m<z.length;m+=3){const p=M.o.Jg(a,3*z[m]),j=M.o.Jg(a,3*z[m+1]),s=M.o.Jg(a,3*z[m+2]),r=p.sc(j),W=s.sc(j),F=M.o.Normalize(M.o.Cross(r,W));T&&F.scaleInPlace(-1);for(let z=0;z<3;z++)K[v++]=F.x,K[v++]=F.y,K[v++]=F.z}return K}_convertToUnIndexedMesh(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=this.getVerticesDataKinds().filter((z=>{var a;return!(null!==(a=this.getVertexBuffer(z))&&void 0!==a&&a.getIsInstanced())})),K=this.Rf(),v={},T=(z,a)=>{const v=new Float32Array(K.length*a);let T=0;for(let m=0;m<K.length;m++)for(let p=0;p<a;p++)v[T++]=z[K[m]*a+p];return v},m=this.getBoundingInfo(),p=this.Fj?this.Vf.slice(0):[];for(const j of a)v[j]=this.getVerticesData(j);for(const j of a){const a=this.getVertexBuffer(j),m=a.getSize();if(z&&j===F.h.NormalKind){const z=this._getFlattenedNormals(K,v[F.h.PositionKind]);this.Ga(F.h.NormalKind,z,a.isUpdatable(),m)}else this.Ga(j,T(v[j],m),a.isUpdatable(),m)}if(this.morphTargetManager){for(let a=0;a<this.morphTargetManager.numTargets;a++){const v=this.morphTargetManager.getTarget(a),m=v.getPositions();v.setPositions(T(m,3));const p=v.getNormals();p&&v.setNormals(z?this._getFlattenedNormals(K,m):T(p,3));const j=v.getTangents();j&&v.setTangents(T(j,3));const s=v.getUVs();s&&v.setUVs(T(s,2))}this.morphTargetManager.synchronize()}for(let j=0;j<K.length;j++)K[j]=j;this.setIndices(K),this._unIndexed=!0,this.releaseSubMeshes();for(const j of p){const z=j.getBoundingInfo();c.e.AddToMesh(j.materialIndex,j.indexStart,j.indexCount,j.indexStart,j.indexCount,this).setBoundingInfo(z)}return this.setBoundingInfo(m),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=G.b.ExtractFromMesh(this);let K;if(z&&this.isVerticesDataPresent(F.h.NormalKind)&&a.ya){for(K=0;K<a.ya.length;K++)a.ya[K]*=-1;this.Ga(F.h.NormalKind,a.ya,this.isVertexBufferUpdatable(F.h.NormalKind))}if(a.indices){let z;for(K=0;K<a.indices.length;K+=3)z=a.indices[K+1],a.indices[K+1]=a.indices[K+2],a.indices[K+2]=z;this.setIndices(a.indices,null,this.isVertexBufferUpdatable(F.h.PositionKind),!0)}return this}increaseVertices(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const a=G.b.ExtractFromMesh(this),K=a.indices&&!Array.isArray(a.indices)&&Array.from?Array.from(a.indices):a.indices,v=a.xa&&!Array.isArray(a.xa)&&Array.from?Array.from(a.xa):a.xa,T=a.Aa&&!Array.isArray(a.Aa)&&Array.from?Array.from(a.Aa):a.Aa,m=a.ya&&!Array.isArray(a.ya)&&Array.from?Array.from(a.ya):a.ya;if(K&&v){a.indices=K,a.xa=v,T&&(a.Aa=T),m&&(a.ya=m);const p=z+1,j=new Array;for(let z=0;z<p+1;z++)j[z]=new Array;let s,r;const W=new M.o(0,0,0),G=new M.o(0,0,0),l=new M.m(0,0),V=new Array,c=new Array,C=new Array;let w,H,f,Y=v.length;T&&(H=T.length),m&&(f=m.length);for(let z=0;z<K.length;z+=3){c[0]=K[z],c[1]=K[z+1],c[2]=K[z+2];for(let z=0;z<3;z++)if(s=c[z],r=c[(z+1)%3],void 0===C[s]&&void 0===C[r]?(C[s]=new Array,C[r]=new Array):(void 0===C[s]&&(C[s]=new Array),void 0===C[r]&&(C[r]=new Array)),void 0===C[s][r]&&void 0===C[r][s]){C[s][r]=[],W.x=(v[3*r]-v[3*s])/p,W.y=(v[3*r+1]-v[3*s+1])/p,W.z=(v[3*r+2]-v[3*s+2])/p,m&&(G.x=(m[3*r]-m[3*s])/p,G.y=(m[3*r+1]-m[3*s+1])/p,G.z=(m[3*r+2]-m[3*s+2])/p),T&&(l.x=(T[2*r]-T[2*s])/p,l.y=(T[2*r+1]-T[2*s+1])/p),C[s][r].push(s);for(let z=1;z<p;z++)C[s][r].push(v.length/3),v[Y++]=v[3*s]+z*W.x,v[Y++]=v[3*s+1]+z*W.y,v[Y++]=v[3*s+2]+z*W.z,m&&(m[f++]=m[3*s]+z*G.x,m[f++]=m[3*s+1]+z*G.y,m[f++]=m[3*s+2]+z*G.z),T&&(T[H++]=T[2*s]+z*l.x,T[H++]=T[2*s+1]+z*l.y);C[s][r].push(r),C[r][s]=new Array,w=C[s][r].length;for(let z=0;z<w;z++)C[r][s][z]=C[s][r][w-1-z]}j[0][0]=K[z],j[1][0]=C[K[z]][K[z+1]][1],j[1][1]=C[K[z]][K[z+2]][1];for(let a=2;a<p;a++){j[a][0]=C[K[z]][K[z+1]][a],j[a][a]=C[K[z]][K[z+2]][a],W.x=(v[3*j[a][a]]-v[3*j[a][0]])/a,W.y=(v[3*j[a][a]+1]-v[3*j[a][0]+1])/a,W.z=(v[3*j[a][a]+2]-v[3*j[a][0]+2])/a,m&&(G.x=(m[3*j[a][a]]-m[3*j[a][0]])/a,G.y=(m[3*j[a][a]+1]-m[3*j[a][0]+1])/a,G.z=(m[3*j[a][a]+2]-m[3*j[a][0]+2])/a),T&&(l.x=(T[2*j[a][a]]-T[2*j[a][0]])/a,l.y=(T[2*j[a][a]+1]-T[2*j[a][0]+1])/a);for(let z=1;z<a;z++)j[a][z]=v.length/3,v[Y++]=v[3*j[a][0]]+z*W.x,v[Y++]=v[3*j[a][0]+1]+z*W.y,v[Y++]=v[3*j[a][0]+2]+z*W.z,m&&(m[f++]=m[3*j[a][0]]+z*G.x,m[f++]=m[3*j[a][0]+1]+z*G.y,m[f++]=m[3*j[a][0]+2]+z*G.z),T&&(T[H++]=T[2*j[a][0]]+z*l.x,T[H++]=T[2*j[a][0]+1]+z*l.y)}j[p]=C[K[z+1]][K[z+2]],V.push(j[0][0],j[1][0],j[1][1]);for(let z=1;z<p;z++){let a;for(a=0;a<z;a++)V.push(j[z][a],j[z+1][a],j[z+1][a+1]),V.push(j[z][a],j[z+1][a+1],j[z][a+1]);V.push(j[z][a],j[z+1][a],j[z+1][a+1])}}a.indices=V,a.Ca(this,this.isVertexBufferUpdatable(F.h.PositionKind))}else Y.c.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const z=G.b.ExtractFromMesh(this),a=z.Aa,K=z.indices,v=z.xa,T=z.za,m=z.matricesIndices,p=z.matricesWeights,j=z.matricesIndicesExtra,s=z.matricesWeightsExtra;if(void 0===K||void 0===v||null===K||null===v)Y.c.Warn("VertexData contains empty entries");else{const M=new Array,r=new Array,W=new Array,l=new Array,V=new Array,c=new Array,C=new Array,w=new Array;let H=new Array,f=0;const Y={};let I,q;for(let z=0;z<K.length;z+=3){q=[K[z],K[z+1],K[z+2]],H=[];for(let z=0;z<3;z++){H[z]="";for(let a=0;a<3;a++)Math.abs(v[3*q[z]+a])<1e-8&&(v[3*q[z]+a]=0),H[z]+=v[3*q[z]+a]+"|"}if(H[0]!=H[1]&&H[0]!=H[2]&&H[1]!=H[2])for(let z=0;z<3;z++){if(I=Y[H[z]],void 0===I){Y[H[z]]=f,I=f++;for(let a=0;a<3;a++)M.push(v[3*q[z]+a]);if(null!==T&&void 0!==T)for(let a=0;a<4;a++)l.push(T[4*q[z]+a]);if(null!==a&&void 0!==a)for(let K=0;K<2;K++)W.push(a[2*q[z]+K]);if(null!==m&&void 0!==m)for(let a=0;a<4;a++)V.push(m[4*q[z]+a]);if(null!==p&&void 0!==p)for(let a=0;a<4;a++)c.push(p[4*q[z]+a]);if(null!==j&&void 0!==j)for(let a=0;a<4;a++)C.push(j[4*q[z]+a]);if(null!==s&&void 0!==s)for(let a=0;a<4;a++)w.push(s[4*q[z]+a])}r.push(I)}}const B=new Array;G.b.ComputeNormals(M,r,B),z.xa=M,z.indices=r,z.ya=B,null!==a&&void 0!==a&&(z.Aa=W),null!==T&&void 0!==T&&(z.za=l),null!==m&&void 0!==m&&(z.matricesIndices=V),null!==p&&void 0!==p&&(z.matricesWeights=c),null!==j&&void 0!==j&&(z.matricesIndicesExtra=C),null!==p&&void 0!==p&&(z.matricesWeightsExtra=w),z.Ca(this,this.isVertexBufferUpdatable(F.h.PositionKind))}}static _instancedMeshFactory(z,a){throw(0,q.b)("InstancedMesh")}static _PhysicsImpostorParser(z,a,K){throw(0,q.b)("PhysicsImpostor")}createInstance(z){const a=P._instancedMeshFactory(z,this);return a.parent=this.parent,a}synchronizeInstances(){for(let z=0;z<this.instances.length;z++){this.instances[z]._syncSubMeshes()}return this}optimizeIndices(z){const a=this.Rf(),K=this.getVerticesData(F.h.PositionKind);if(!K||!a)return this;const v=[];for(let T=0;T<K.length;T+=3)v.push(M.o.Jg(K,T));const m=[];return T.d.SyncAsyncForLoop(v.length,40,(z=>{const a=v.length-1-z,K=v[a];for(let T=0;T<a;++T){const z=v[T];if(K.equals(z)){m[a]=T;break}}}),(()=>{for(let z=0;z<a.length;++z)a[z]=m[a[z]]||a[z];const K=this.Vf.slice(0);this.setIndices(a),this.Vf=K,z&&z(this)})),this}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};z.name=this.name,z.id=this.id,z.uniqueId=this.uniqueId,z.type=this.getClassName(),p.d&&p.d.HasTags(this)&&(z.tags=p.d.GetTags(this)),z.position=this.position.kj(),this.rotationQuaternion?z.rotationQuaternion=this.rotationQuaternion.kj():this.rotation&&(z.rotation=this.rotation.kj()),z.Yd=this.Yd.kj(),this._postMultiplyPivotMatrix?z.pivotMatrix=this.getPivotMatrix().kj():z.localMatrix=this.getPivotMatrix().kj(),z.isEnabled=this.isEnabled(!1),z.isVisible=this.isVisible,z.infiniteDistance=this.infiniteDistance,z.pickable=this.Hb,z.receiveShadows=this.receiveShadows,z.billboardMode=this.billboardMode,z.visibility=this.visibility,z.wb=this.wb,z.checkCollisions=this.checkCollisions,z.ellipsoid=this.ellipsoid.kj(),z.ellipsoidOffset=this.ellipsoidOffset.kj(),z.Da=this.Da,z.isBlocker=this.isBlocker,z.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(z),z.isUnIndexed=this.isUnIndexed;const a=this._geometry;if(a&&this.Vf){z.geometryUniqueId=a.uniqueId,z.geometryId=a.id,z.Vf=[];for(let a=0;a<this.Vf.length;a++){const K=this.Vf[a];z.Vf.push({materialIndex:K.materialIndex,verticesStart:K.verticesStart,verticesCount:K.verticesCount,indexStart:K.indexStart,indexCount:K.indexCount})}}if(this.material?this.material.doNotSerialize||(z.materialUniqueId=this.material.uniqueId,z.materialId=this.material.id):(this.material=null,z.materialUniqueId=this._scene.defaultMaterial.uniqueId,z.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(z.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(z.skeletonId=this.skeleton.id,z.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(B.b.NAME_PHYSICSENGINE)){const a=this.getPhysicsImpostor();a&&(z.physicsMass=a.getParam("mass"),z.physicsFriction=a.getParam("friction"),z.physicsRestitution=a.getParam("mass"),z.physicsImpostor=a.type)}this.metadata&&(z.metadata=this.metadata),z.instances=[];for(let K=0;K<this.instances.length;K++){const a=this.instances[K];if(a.doNotSerialize)continue;const v={name:a.name,id:a.id,isEnabled:a.isEnabled(!1),isVisible:a.isVisible,Hb:a.Hb,checkCollisions:a.checkCollisions,position:a.position.kj(),Yd:a.Yd.kj()};if(a.parent&&a.parent._serializeAsParent(v),a.rotationQuaternion?v.rotationQuaternion=a.rotationQuaternion.kj():a.rotation&&(v.rotation=a.rotation.kj()),this.va()._getComponent(B.b.NAME_PHYSICSENGINE)){const z=a.getPhysicsImpostor();z&&(v.physicsMass=z.getParam("mass"),v.physicsFriction=z.getParam("friction"),v.physicsRestitution=z.getParam("mass"),v.physicsImpostor=z.type)}a.metadata&&(v.metadata=a.metadata),a.actionManager&&(v.actions=a.actionManager.serialize(a.name)),z.instances.push(v),f.e.AppendSerializedAnimations(a,v),v.ranges=a.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(z.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const a={data:{},sizes:{},strides:{}};for(const z in this._userThinInstanceBuffersStorage.data)a.data[z]=Array.from(this._userThinInstanceBuffersStorage.data[z]),a.sizes[z]=this._userThinInstanceBuffersStorage.sizes[z],a.strides[z]=this._userThinInstanceBuffersStorage.strides[z];z.thinInstances.userThinInstance=a}return f.e.AppendSerializedAnimations(this,z),z.ranges=this.serializeAnimationRanges(),z.layerMask=this.layerMask,z.alphaIndex=this.alphaIndex,z.hasVertexAlpha=this.hasVertexAlpha,z.overlayAlpha=this.overlayAlpha,z.overlayColor=this.overlayColor.kj(),z.renderOverlay=this.renderOverlay,z.applyFog=this.applyFog,this.actionManager&&(z.actions=this.actionManager.serialize(this.name)),z}_syncGeometryWithMorphTargetManager(){if(!this.Fj)return;this._markSubMeshesAsAttributesDirty();const z=this._internalAbstractMeshDataInfo._morphTargetManager;if(z&&z.vertexCount){if(z.vertexCount!==this.getTotalVertices())return Y.c.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(z.isUsingTextureForTargets)return;for(let a=0;a<z.numInfluencers;a++){const K=z.getActiveTarget(a),v=K.getPositions();if(!v)return void Y.c.Error("Invalid morph target. Target must have positions.");this.Fj.Ga(F.h.PositionKind+a,v,!1,3);const T=K.getNormals();T&&this.Fj.Ga(F.h.NormalKind+a,T,!1,3);const m=K.getTangents();m&&this.Fj.Ga(F.h.TangentKind+a,m,!1,3);const p=K.getUVs();p&&this.Fj.Ga(F.h.UVKind+"_"+a,p,!1,2)}}else{let z=0;for(;this.Fj.isVerticesDataPresent(F.h.PositionKind+z);)this.Fj.removeVerticesData(F.h.PositionKind+z),this.Fj.isVerticesDataPresent(F.h.NormalKind+z)&&this.Fj.removeVerticesData(F.h.NormalKind+z),this.Fj.isVerticesDataPresent(F.h.TangentKind+z)&&this.Fj.removeVerticesData(F.h.TangentKind+z),this.Fj.isVerticesDataPresent(F.h.UVKind+z)&&this.Fj.removeVerticesData(F.h.UVKind+"_"+z),z++}}static Parse(z,a,K){let v;if(v=z.type&&"LinesMesh"===z.type?P._LinesMeshParser(z,a):z.type&&"GroundMesh"===z.type?P._GroundMeshParser(z,a):z.type&&"GoldbergMesh"===z.type?P._GoldbergMeshParser(z,a):z.type&&"GreasedLineMesh"===z.type?P._GreasedLineMeshParser(z,a):z.type&&"TrailMesh"===z.type?P._TrailMeshParser(z,a):new P(z.name,a),v.id=z.id,v._waitingParsedUniqueId=z.uniqueId,p.d&&p.d.AddTagsTo(v,z.tags),v.position=M.o.Jg(z.position),void 0!==z.metadata&&(v.metadata=z.metadata),z.rotationQuaternion?v.rotationQuaternion=M.f.Jg(z.rotationQuaternion):z.rotation&&(v.rotation=M.o.Jg(z.rotation)),v.Yd=M.o.Jg(z.Yd),z.localMatrix?v.setPreTransformMatrix(M.b.Jg(z.localMatrix)):z.pivotMatrix&&v.setPivotMatrix(M.b.Jg(z.pivotMatrix)),v.Nb(z.isEnabled),v.isVisible=z.isVisible,v.infiniteDistance=z.infiniteDistance,v.wb=!!z.wb,v.showBoundingBox=z.showBoundingBox,v.showSubMeshesBoundingBox=z.showSubMeshesBoundingBox,void 0!==z.applyFog&&(v.applyFog=z.applyFog),void 0!==z.pickable&&(v.Hb=z.pickable),void 0!==z.alphaIndex&&(v.alphaIndex=z.alphaIndex),v.receiveShadows=z.receiveShadows,void 0!==z.billboardMode&&(v.billboardMode=z.billboardMode),void 0!==z.visibility&&(v.visibility=z.visibility),v.checkCollisions=z.checkCollisions,v.Da=!!z.Da,z.ellipsoid&&(v.ellipsoid=M.o.Jg(z.ellipsoid)),z.ellipsoidOffset&&(v.ellipsoidOffset=M.o.Jg(z.ellipsoidOffset)),null!=z.overrideMaterialSideOrientation&&(v.sideOrientation=z.overrideMaterialSideOrientation),void 0!==z.sideOrientation&&(v.sideOrientation=z.sideOrientation),void 0!==z.isBlocker&&(v.isBlocker=z.isBlocker),v._shouldGenerateFlatShading=z.useFlatShading,z.wc&&(v._waitingData.wc=z.wc),void 0!==z.parentId&&(v._waitingParentId=z.parentId),void 0!==z.parentInstanceIndex&&(v._waitingParentInstanceIndex=z.parentInstanceIndex),void 0!==z.actions&&(v._waitingData.actions=z.actions),void 0!==z.overlayAlpha&&(v.overlayAlpha=z.overlayAlpha),void 0!==z.overlayColor&&(v.overlayColor=r.c.Jg(z.overlayColor)),void 0!==z.renderOverlay&&(v.renderOverlay=z.renderOverlay),v.isUnIndexed=!!z.isUnIndexed,v.hasVertexAlpha=z.hasVertexAlpha,z.delayLoadingFile?(v.delayLoadState=4,v.delayLoadingFile=K+z.delayLoadingFile,v.buildBoundingInfo(M.o.Jg(z.boundingBoxMinimum),M.o.Jg(z.boundingBoxMaximum)),z._binaryInfo&&(v._binaryInfo=z._binaryInfo),v._delayInfo=[],z.hasUVs&&v._delayInfo.push(F.h.UVKind),z.hasUVs2&&v._delayInfo.push(F.h.UV2Kind),z.hasUVs3&&v._delayInfo.push(F.h.UV3Kind),z.hasUVs4&&v._delayInfo.push(F.h.UV4Kind),z.hasUVs5&&v._delayInfo.push(F.h.UV5Kind),z.hasUVs6&&v._delayInfo.push(F.h.UV6Kind),z.hasColors&&v._delayInfo.push(F.h.ColorKind),z.hasMatricesIndices&&v._delayInfo.push(F.h.MatricesIndicesKind),z.hasMatricesWeights&&v._delayInfo.push(F.h.MatricesWeightsKind),v._delayLoadingFunction=l.b._ImportGeometry,H.b.ForceFullSceneLoadingForIncremental&&v._checkDelayState()):l.b._ImportGeometry(z,v),z.materialUniqueId?v._waitingMaterialId=z.materialUniqueId:z.materialId&&(v._waitingMaterialId=z.materialId),z.morphTargetManagerId>-1&&(v._waitingMorphTargetManagerId=z.morphTargetManagerId),void 0!==z.skeletonId&&null!==z.skeletonId&&(v.skeleton=a.getLastSkeletonById(z.skeletonId),z.numBoneInfluencers&&(v.numBoneInfluencers=z.numBoneInfluencers)),z.animations){for(let a=0;a<z.animations.length;a++){const K=z.animations[a],T=(0,I.c)("BABYLON.Animation");T&&v.animations.push(T.Parse(K))}W.c.ParseAnimationRanges(v,z,a)}if(z.autoAnimate&&a.beginAnimation(v,z.autoAnimateFrom,z.autoAnimateTo,z.autoAnimateLoop,z.autoAnimateSpeed||1),z.layerMask&&!isNaN(z.layerMask)?v.layerMask=Math.abs(parseInt(z.layerMask)):v.layerMask=268435455,z.physicsImpostor&&(v.physicsImpostor=P._PhysicsImpostorParser(a,v,z)),z.lodMeshIds&&(v._waitingData.lods={ids:z.lodMeshIds,distances:z.lodDistances?z.lodDistances:null,coverages:z.lodCoverages?z.lodCoverages:null}),z.instances)for(let T=0;T<z.instances.length;T++){const K=z.instances[T],m=v.createInstance(K.name);if(K.id&&(m.id=K.id),p.d&&(K.tags?p.d.AddTagsTo(m,K.tags):p.d.AddTagsTo(m,z.tags)),m.position=M.o.Jg(K.position),void 0!==K.metadata&&(m.metadata=K.metadata),void 0!==K.parentId&&(m._waitingParentId=K.parentId),void 0!==K.parentInstanceIndex&&(m._waitingParentInstanceIndex=K.parentInstanceIndex),void 0!==K.isEnabled&&null!==K.isEnabled&&m.Nb(K.isEnabled),void 0!==K.isVisible&&null!==K.isVisible&&(m.isVisible=K.isVisible),void 0!==K.Hb&&null!==K.Hb&&(m.Hb=K.Hb),K.rotationQuaternion?m.rotationQuaternion=M.f.Jg(K.rotationQuaternion):K.rotation&&(m.rotation=M.o.Jg(K.rotation)),m.Yd=M.o.Jg(K.Yd),void 0!=K.checkCollisions&&null!=K.checkCollisions&&(m.checkCollisions=K.checkCollisions),void 0!=K.pickable&&null!=K.pickable&&(m.Hb=K.pickable),void 0!=K.showBoundingBox&&null!=K.showBoundingBox&&(m.showBoundingBox=K.showBoundingBox),void 0!=K.showSubMeshesBoundingBox&&null!=K.showSubMeshesBoundingBox&&(m.showSubMeshesBoundingBox=K.showSubMeshesBoundingBox),void 0!=K.alphaIndex&&null!=K.showSubMeshesBoundingBox&&(m.alphaIndex=K.alphaIndex),K.physicsImpostor&&(m.physicsImpostor=P._PhysicsImpostorParser(a,m,K)),void 0!==K.actions&&(m._waitingData.actions=K.actions),K.animations){for(let z=0;z<K.animations.length;z++){const a=K.animations[z],v=(0,I.c)("BABYLON.Animation");v&&m.animations.push(v.Parse(a))}W.c.ParseAnimationRanges(m,K,a),K.autoAnimate&&a.beginAnimation(m,K.autoAnimateFrom,K.autoAnimateTo,K.autoAnimateLoop,K.autoAnimateSpeed||1)}}if(z.thinInstances){const a=z.thinInstances;if(v.thinInstanceEnablePicking=!!a.enablePicking,a.matrixData?(v.Yb("matrix",new Float32Array(a.matrixData),16,!1),v._thinInstanceDataStorage.matrixBufferSize=a.matrixBufferSize,v._thinInstanceDataStorage.instancesCount=a.instancesCount):v._thinInstanceDataStorage.matrixBufferSize=a.matrixBufferSize,z.thinInstances.userThinInstance){const a=z.thinInstances.userThinInstance;for(const z in a.data)v.Yb(z,new Float32Array(a.data[z]),a.strides[z],!1),v._userThinInstanceBuffersStorage.sizes[z]=a.sizes[z]}}return v}setPositionsForCPUSkinning(){const z=this._internalMeshDataInfo;if(!z._sourcePositions){const a=this.getVerticesData(F.h.PositionKind);if(!a)return z._sourcePositions;z._sourcePositions=new Float32Array(a),this.isVertexBufferUpdatable(F.h.PositionKind)||this.Ga(F.h.PositionKind,a,!0)}return z._sourcePositions}setNormalsForCPUSkinning(){const z=this._internalMeshDataInfo;if(!z._sourceNormals){const a=this.getVerticesData(F.h.NormalKind);if(!a)return z._sourceNormals;z._sourceNormals=new Float32Array(a),this.isVertexBufferUpdatable(F.h.NormalKind)||this.Ga(F.h.NormalKind,a,!0)}return z._sourceNormals}applySkeleton(z){if(!this.Fj)return this;if(this.Fj._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.Fj._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(F.h.PositionKind))return this;if(!this.isVerticesDataPresent(F.h.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(F.h.MatricesWeightsKind))return this;const a=this.isVerticesDataPresent(F.h.NormalKind),K=this._internalMeshDataInfo;if(!K._sourcePositions){const z=this.Vf.slice();this.setPositionsForCPUSkinning(),this.Vf=z}a&&!K._sourceNormals&&this.setNormalsForCPUSkinning();let v=this.getVerticesData(F.h.PositionKind);if(!v)return this;v instanceof Float32Array||(v=new Float32Array(v));let T=this.getVerticesData(F.h.NormalKind);if(a){if(!T)return this;T instanceof Float32Array||(T=new Float32Array(T))}const m=this.getVerticesData(F.h.MatricesIndicesKind),p=this.getVerticesData(F.h.MatricesWeightsKind);if(!p||!m)return this;const j=this.numBoneInfluencers>4,s=j?this.getVerticesData(F.h.MatricesIndicesExtraKind):null,r=j?this.getVerticesData(F.h.MatricesWeightsExtraKind):null,W=z.getTransformMatrices(this),G=M.o.Zero(),l=new M.b,V=new M.b;let c,C=0;for(let F=0;F<v.length;F+=3,C+=4){let z;for(c=0;c<4;c++)z=p[C+c],z>0&&(M.b.FromFloat32ArrayToRefScaled(W,Math.floor(16*m[C+c]),z,V),l.addToSelf(V));if(j)for(c=0;c<4;c++)z=r[C+c],z>0&&(M.b.FromFloat32ArrayToRefScaled(W,Math.floor(16*s[C+c]),z,V),l.addToSelf(V));M.o.TransformCoordinatesFromFloatsToRef(K._sourcePositions[F],K._sourcePositions[F+1],K._sourcePositions[F+2],l,G),G.toArray(v,F),a&&(M.o.TransformNormalFromFloatsToRef(K._sourceNormals[F],K._sourceNormals[F+1],K._sourceNormals[F+2],l,G),G.toArray(T,F)),l.reset()}return this.updateVerticesData(F.h.PositionKind,v),a&&this.updateVerticesData(F.h.NormalKind,T),this}static MinMax(z){let a=null,K=null;return z.forEach((function(z){const v=z.getBoundingInfo().boundingBox;a&&K?(a.minimizeInPlace(v.minimumWorld),K.maximizeInPlace(v.maximumWorld)):(a=v.minimumWorld,K=v.maximumWorld)})),a&&K?{min:a,max:K}:{min:M.o.Zero(),max:M.o.Zero()}}static Center(z){const a=z instanceof Array?P.MinMax(z):z;return M.o.Center(a.min,a.max)}static MergeMeshes(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],K=arguments.length>2?arguments[2]:void 0,v=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0;return(0,j.j)(P._MergeMeshesCoroutine(z,a,K,v,T,m,!1))}static MergeMeshesAsync(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],K=arguments.length>2?arguments[2]:void 0,v=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0;return(0,j.f)(P._MergeMeshesCoroutine(z,a,K,v,T,m,!0),(0,j.c)())}static*_MergeMeshesCoroutine(z){let a,K=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],v=arguments.length>2?arguments[2]:void 0,T=arguments.length>3?arguments[3]:void 0,m=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0,j=arguments.length>6?arguments[6]:void 0;if(0===(z=z.filter(Boolean)).length)return null;if(!v){let K=0;for(a=0;a<z.length;a++)if(K+=z[a].getTotalVertices(),K>=65536)return Y.c.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}p&&(m=!1);const s=new Array,M=new Array,r=new Array,W=z[0].sideOrientation;for(a=0;a<z.length;a++){const K=z[a];if(K.isAnInstance)return Y.c.Warn("Cannot merge instance meshes."),null;if(W!==K.sideOrientation)return Y.c.Warn("Cannot merge meshes with different sideOrientation values."),null;if(m&&r.push(K.getTotalIndices()),p)if(K.material){const z=K.material;if(z instanceof w.e){for(let a=0;a<z.Wf.length;a++)s.indexOf(z.Wf[a])<0&&s.push(z.Wf[a]);for(let a=0;a<K.Vf.length;a++)M.push(s.indexOf(z.Wf[K.Vf[a].materialIndex])),r.push(K.Vf[a].indexCount)}else{s.indexOf(z)<0&&s.push(z);for(let a=0;a<K.Vf.length;a++)M.push(s.indexOf(z)),r.push(K.Vf[a].indexCount)}}else for(let z=0;z<K.Vf.length;z++)M.push(0),r.push(K.Vf[z].indexCount)}const F=z[0],l=z=>{const a=z.Qj(!0);return{vertexData:G.b.ExtractFromMesh(z,!1,!1),transform:a}},{vertexData:V,transform:C}=l(F);j&&(yield);const H=new Array(z.length-1);for(let G=1;G<z.length;G++)H[G-1]=l(z[G]),j&&(yield);const f=V._mergeCoroutine(C,H,v,j,!K);let I=f.next();for(;!I.done;)j&&(yield),I=f.next();const q=I.value;T||(T=new P(F.name+"_merged",F.va()));const B=q._applyToCoroutine(T,void 0,j);let x=B.next();for(;!x.done;)j&&(yield),x=B.next();if(T.checkCollisions=F.checkCollisions,T.sideOrientation=F.sideOrientation,K)for(a=0;a<z.length;a++)z[a].dispose();if(m||p){T.releaseSubMeshes(),a=0;let z=0;for(;a<r.length;)c.e.CreateFromIndices(0,z,r[a],T,void 0,!1),z+=r[a],a++;for(const a of T.Vf)a.refreshBoundingInfo();T.Qj(!0)}if(p){const z=new w.e(F.name+"_merged",F.va());z.Wf=s;for(let a=0;a<T.Vf.length;a++)T.Vf[a].materialIndex=M[a];T.material=z}else T.material=F.material;return T}Ij(z){z._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(z)}Hj(z){const a=z._indexInSourceMeshInstanceArray;if(-1!=a){if(a!==this.instances.length-1){const z=this.instances[this.instances.length-1];this.instances[a]=z,z._indexInSourceMeshInstanceArray=a}z._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===C.b.CounterClockWiseSideOrientation}_getRenderingFillMode(z){const a=this.va();return a.forcePointsCloud?C.b.PointFillMode:a.forceWireframe?C.b.WireFrameFillMode:this.overrideRenderingFillMode??z}setMaterialByID(z){return this.setMaterialById(z)}static CreateRibbon(z,a,K,v,T,m,p,j,s){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(z,a,K,v,T,m){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(z,a,K,v,T){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(z,a,K,v,T,m){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(z,a,K,v){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(z,a,K,v,T,m,p,j,s){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(z,a,K,v,T,m,p){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(z,a,K,v,T,m,p,j,s,M){throw new Error("Import MeshBuilder to populate this function")}static ub(z,a,K,v,T){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(z,a,K,v,T,m,p,j){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(z,a,K,v,T,m,p){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(z,a,K,v,T,m,p,j){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(z,a,K,v,T,m,p,j,s,M){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(z,a,K,v,T,m,p,j,s,M,r,W){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(z,a,K,v,T,m,p){throw new Error("Import MeshBuilder to populate this function")}static Xf(z,a,K,v,T){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(z,a,K,v,T,m){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(z,a,K,v,T,m,p,j,s){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(z,a,K,v,T,m,p,j,s,M,r){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(z,a,K,v,T,m,p,j,s,M){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(z,a,K){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(z,a,K){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(z,a,K,v,T,m){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(z,a,K){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(z){throw new Error("Import MeshBuilder to populate this function")}}P.FRONTSIDE=G.b.FRONTSIDE,P.BACKSIDE=G.b.BACKSIDE,P.DOUBLESIDE=G.b.DOUBLESIDE,P.DEFAULTSIDE=G.b.DEFAULTSIDE,P.NO_CAP=0,P.CAP_START=1,P.CAP_END=2,P.CAP_ALL=3,P.NO_FLIP=0,P.FLIP_TILE=1,P.ROTATE_TILE=2,P.FLIP_ROW=3,P.ROTATE_ROW=4,P.FLIP_N_ROTATE_TILE=5,P.FLIP_N_ROTATE_ROW=6,P.CENTER=0,P.LEFT=1,P.RIGHT=2,P.TOP=3,P.BOTTOM=4,P.INSTANCEDMESH_SORT_TRANSPARENT=!1,P._GroundMeshParser=(z,a)=>{throw(0,q.b)("GroundMesh")},P._GoldbergMeshParser=(z,a)=>{throw(0,q.b)("GoldbergMesh")},P._LinesMeshParser=(z,a)=>{throw(0,q.b)("LinesMesh")},P._GreasedLineMeshParser=(z,a)=>{throw(0,q.b)("GreasedLineMesh")},P._GreasedLineRibbonMeshParser=(z,a)=>{throw(0,q.b)("GreasedLineRibbonMesh")},P._TrailMeshParser=(z,a)=>{throw(0,q.b)("TrailMesh")},(0,I.e)("BABYLON.Mesh",P)},11230:(z,a,K)=>{"use strict";K.d(a,{b:()=>l});var v=K(10923),T=K(10941),m=K(11001),p=K(10663),j=K(10971),s=K(10648),M=K(10927),r=K(11202),W=K(10684),F=K(11066);class G{}class l{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,r.d)(this._applyToCoroutine.bind(this)),this.uniqueId=l._UniqueIDGenerator,l._UniqueIDGenerator++}set(z,a){switch(z.length||s.c.Warn(`Setting vertex data kind '${a}' with an empty array`),a){case m.h.PositionKind:this.xa=z;break;case m.h.NormalKind:this.ya=z;break;case m.h.TangentKind:this.tangents=z;break;case m.h.UVKind:this.Aa=z;break;case m.h.UV2Kind:this.uvs2=z;break;case m.h.UV3Kind:this.uvs3=z;break;case m.h.UV4Kind:this.uvs4=z;break;case m.h.UV5Kind:this.uvs5=z;break;case m.h.UV6Kind:this.uvs6=z;break;case m.h.ColorKind:this.za=z;break;case m.h.MatricesIndicesKind:this.matricesIndices=z;break;case m.h.MatricesWeightsKind:this.matricesWeights=z;break;case m.h.MatricesIndicesExtraKind:this.matricesIndicesExtra=z;break;case m.h.MatricesWeightsExtraKind:this.matricesWeightsExtra=z}}Ca(z,a){return this._applyTo(z,a,!1),this}applyToGeometry(z,a){return this._applyTo(z,a,!1),this}updateMesh(z){return this._update(z),this}updateGeometry(z){return this._update(z),this}*_applyToCoroutine(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2?arguments[2]:void 0;if(this.xa&&(z.Ga(m.h.PositionKind,this.xa,a),K&&(yield)),this.ya&&(z.Ga(m.h.NormalKind,this.ya,a),K&&(yield)),this.tangents&&(z.Ga(m.h.TangentKind,this.tangents,a),K&&(yield)),this.Aa&&(z.Ga(m.h.UVKind,this.Aa,a),K&&(yield)),this.uvs2&&(z.Ga(m.h.UV2Kind,this.uvs2,a),K&&(yield)),this.uvs3&&(z.Ga(m.h.UV3Kind,this.uvs3,a),K&&(yield)),this.uvs4&&(z.Ga(m.h.UV4Kind,this.uvs4,a),K&&(yield)),this.uvs5&&(z.Ga(m.h.UV5Kind,this.uvs5,a),K&&(yield)),this.uvs6&&(z.Ga(m.h.UV6Kind,this.uvs6,a),K&&(yield)),this.za&&(z.Ga(m.h.ColorKind,this.za,a),this.hasVertexAlpha&&void 0!==z.hasVertexAlpha&&(z.hasVertexAlpha=!0),K&&(yield)),this.matricesIndices&&(z.Ga(m.h.MatricesIndicesKind,this.matricesIndices,a),K&&(yield)),this.matricesWeights&&(z.Ga(m.h.MatricesWeightsKind,this.matricesWeights,a),K&&(yield)),this.matricesIndicesExtra&&(z.Ga(m.h.MatricesIndicesExtraKind,this.matricesIndicesExtra,a),K&&(yield)),this.matricesWeightsExtra&&(z.Ga(m.h.MatricesWeightsExtraKind,this.matricesWeightsExtra,a),K&&(yield)),this.indices?(z.setIndices(this.indices,null,a),K&&(yield)):z.setIndices([],null),z.Vf&&this.materialInfos&&this.materialInfos.length>1){const a=z;a.Vf=[];for(const z of this.materialInfos)new F.e(z.materialIndex,z.verticesStart,z.verticesCount,z.indexStart,z.indexCount,a)}return this}_update(z,a,K){return this.xa&&z.updateVerticesData(m.h.PositionKind,this.xa,a,K),this.ya&&z.updateVerticesData(m.h.NormalKind,this.ya,a,K),this.tangents&&z.updateVerticesData(m.h.TangentKind,this.tangents,a,K),this.Aa&&z.updateVerticesData(m.h.UVKind,this.Aa,a,K),this.uvs2&&z.updateVerticesData(m.h.UV2Kind,this.uvs2,a,K),this.uvs3&&z.updateVerticesData(m.h.UV3Kind,this.uvs3,a,K),this.uvs4&&z.updateVerticesData(m.h.UV4Kind,this.uvs4,a,K),this.uvs5&&z.updateVerticesData(m.h.UV5Kind,this.uvs5,a,K),this.uvs6&&z.updateVerticesData(m.h.UV6Kind,this.uvs6,a,K),this.za&&z.updateVerticesData(m.h.ColorKind,this.za,a,K),this.matricesIndices&&z.updateVerticesData(m.h.MatricesIndicesKind,this.matricesIndices,a,K),this.matricesWeights&&z.updateVerticesData(m.h.MatricesWeightsKind,this.matricesWeights,a,K),this.matricesIndicesExtra&&z.updateVerticesData(m.h.MatricesIndicesExtraKind,this.matricesIndicesExtra,a,K),this.matricesWeightsExtra&&z.updateVerticesData(m.h.MatricesWeightsExtraKind,this.matricesWeightsExtra,a,K),this.indices&&z.setIndices(this.indices,null),this}static _TransformVector3Coordinates(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.length;const m=T.j.gb[0],p=T.j.gb[1];for(let j=K;j<K+v;j+=3)T.o.FromArrayToRef(z,j,m),T.o.TransformCoordinatesToRef(m,a,p),z[j]=p.x,z[j+1]=p.y,z[j+2]=p.z}static _TransformVector3Normals(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.length;const m=T.j.gb[0],p=T.j.gb[1];for(let j=K;j<K+v;j+=3)T.o.FromArrayToRef(z,j,m),T.o.TransformNormalToRef(m,a,p),z[j]=p.x,z[j+1]=p.y,z[j+2]=p.z}static _TransformVector4Normals(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.length;const m=T.j.Vector4[0],p=T.j.Vector4[1];for(let j=K;j<K+v;j+=4)T.r.FromArrayToRef(z,j,m),T.r.TransformNormalToRef(m,a,p),z[j]=p.x,z[j+1]=p.y,z[j+2]=p.z,z[j+3]=p.w}static _FlipFaces(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.length;for(let v=a;v<a+K;v+=3){const a=z[v+1];z[v+1]=z[v+2],z[v+2]=a}}transform(z){const a=z.determinant()<0;return this.xa&&l._TransformVector3Coordinates(this.xa,z),this.ya&&l._TransformVector3Normals(this.ya,z),this.tangents&&l._TransformVector4Normals(this.tangents,z),a&&this.indices&&l._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const z=[];for(const a of this.materialInfos){const K=new l;if(this.xa&&(K.xa=this.xa.slice(3*a.verticesStart,3*(a.verticesCount+a.verticesStart))),this.ya&&(K.ya=this.ya.slice(3*a.verticesStart,3*(a.verticesCount+a.verticesStart))),this.tangents&&(K.tangents=this.tangents.slice(4*a.verticesStart,4*(a.verticesCount+a.verticesStart))),this.za&&(K.za=this.za.slice(4*a.verticesStart,4*(a.verticesCount+a.verticesStart))),this.Aa&&(K.Aa=this.Aa.slice(2*a.verticesStart,2*(a.verticesCount+a.verticesStart))),this.uvs2&&(K.uvs2=this.uvs2.slice(2*a.verticesStart,2*(a.verticesCount+a.verticesStart))),this.uvs3&&(K.uvs3=this.uvs3.slice(2*a.verticesStart,2*(a.verticesCount+a.verticesStart))),this.uvs4&&(K.uvs4=this.uvs4.slice(2*a.verticesStart,2*(a.verticesCount+a.verticesStart))),this.uvs5&&(K.uvs5=this.uvs5.slice(2*a.verticesStart,2*(a.verticesCount+a.verticesStart))),this.uvs6&&(K.uvs6=this.uvs6.slice(2*a.verticesStart,2*(a.verticesCount+a.verticesStart))),this.matricesIndices&&(K.matricesIndices=this.matricesIndices.slice(4*a.verticesStart,4*(a.verticesCount+a.verticesStart))),this.matricesIndicesExtra&&(K.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*a.verticesStart,4*(a.verticesCount+a.verticesStart))),this.matricesWeights&&(K.matricesWeights=this.matricesWeights.slice(4*a.verticesStart,4*(a.verticesCount+a.verticesStart))),this.matricesWeightsExtra&&(K.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*a.verticesStart,4*(a.verticesCount+a.verticesStart))),this.indices){K.indices=[];for(let z=a.indexStart;z<a.indexStart+a.indexCount;z++)K.indices.push(this.indices[z]-a.verticesStart)}const v=new G;v.indexStart=0,v.indexCount=K.indices?K.indices.length:0,v.materialIndex=a.materialIndex,v.verticesStart=0,v.verticesCount=(K.xa?K.xa.length:0)/3,K.materialInfos=[v],z.push(K)}return z}merge(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const m=Array.isArray(z)?z.map((z=>({vertexData:z}))):[{vertexData:z}];return(0,r.j)(this._mergeCoroutine(void 0,m,a,!1,K,v,T))}*_mergeCoroutine(z,a){var K,v;let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],p=arguments.length>3?arguments[3]:void 0,j=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],M=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let r=a.map((z=>z.vertexData)),W=this;if(M)for(const m of r)m&&(m._validate(),!this.ya&&m.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&m.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&m.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&m.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&m.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&m.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&m.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&m.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&m.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&m.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&m.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&m.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&m.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const m of r)if(m)if(M)this.ya&&!m.ya&&(m.ya=new Float32Array(m.xa.length)),this.tangents&&!m.tangents&&(m.tangents=new Float32Array(m.xa.length/3*4)),this.Aa&&!m.Aa&&(m.Aa=new Float32Array(m.xa.length/3*2)),this.uvs2&&!m.uvs2&&(m.uvs2=new Float32Array(m.xa.length/3*2)),this.uvs3&&!m.uvs3&&(m.uvs3=new Float32Array(m.xa.length/3*2)),this.uvs4&&!m.uvs4&&(m.uvs4=new Float32Array(m.xa.length/3*2)),this.uvs5&&!m.uvs5&&(m.uvs5=new Float32Array(m.xa.length/3*2)),this.uvs6&&!m.uvs6&&(m.uvs6=new Float32Array(m.xa.length/3*2)),this.za&&!m.za&&(m.za=new Float32Array(m.xa.length/3*4),m.za.fill(1)),this.matricesIndices&&!m.matricesIndices&&(m.matricesIndices=new Float32Array(m.xa.length/3*4)),this.matricesWeights&&!m.matricesWeights&&(m.matricesWeights=new Float32Array(m.xa.length/3*4)),this.matricesIndicesExtra&&!m.matricesIndicesExtra&&(m.matricesIndicesExtra=new Float32Array(m.xa.length/3*4)),this.matricesWeightsExtra&&!m.matricesWeightsExtra&&(m.matricesWeightsExtra=new Float32Array(m.xa.length/3*4));else if(m._validate(),!this.ya!==!m.ya||!this.tangents!==!m.tangents||!this.Aa!==!m.Aa||!this.uvs2!==!m.uvs2||!this.uvs3!==!m.uvs3||!this.uvs4!==!m.uvs4||!this.uvs5!==!m.uvs5||!this.uvs6!==!m.uvs6||!this.za!==!m.za||!this.matricesIndices!==!m.matricesIndices||!this.matricesWeights!==!m.matricesWeights||!this.matricesIndicesExtra!==!m.matricesIndicesExtra||!this.matricesWeightsExtra!==!m.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(s){let K=0,v=0,T=0;const m=[];let p=null;const j=[];for(const a of this.splitBasedOnMaterialID())j.push({vertexData:a,transform:z});for(const z of a)if(z.vertexData)for(const a of z.vertexData.splitBasedOnMaterialID())j.push({vertexData:a,transform:z.transform});j.sort(((z,a)=>{const K=z.vertexData.materialInfos?z.vertexData.materialInfos[0].materialIndex:0,v=a.vertexData.materialInfos?a.vertexData.materialInfos[0].materialIndex:0;return K>v?1:K===v?0:-1}));for(const z of j){const a=z.vertexData;if(K=a.materialInfos?a.materialInfos[0].materialIndex:0,p&&p.materialIndex===K)p.indexCount+=a.indices.length,p.verticesCount+=a.xa.length/3;else{const z=new G;z.materialIndex=K,z.indexStart=v,z.indexCount=a.indices.length,z.verticesStart=T,z.verticesCount=a.xa.length/3,m.push(z),p=z}v+=a.indices.length,T+=a.xa.length/3}const s=j.splice(0,1)[0];W=s.vertexData,z=s.transform,r=j.map((z=>z.vertexData)),a=j,this.materialInfos=m}const F=r.reduce(((z,a)=>{var K;return z+((null===(K=a.indices)||void 0===K?void 0:K.length)??0)}),(null===(K=W.indices)||void 0===K?void 0:K.length)??0);let V=j||r.some((z=>z.indices===W.indices))?null===(v=W.indices)||void 0===v?void 0:v.slice():W.indices;if(F>0){var c;let K=(null===(c=V)||void 0===c?void 0:c.length)??0;if(V||(V=new Array(F)),V.length!==F){if(Array.isArray(V))V.length=F;else{const z=T||V instanceof Uint32Array?new Uint32Array(F):new Uint16Array(F);z.set(V),V=z}z&&z.determinant()<0&&l._FlipFaces(V,0,K)}let v=W.xa?W.xa.length/3:0;for(const{vertexData:z,transform:T}of a)if(z.indices){for(let a=0;a<z.indices.length;a++)V[K+a]=z.indices[a]+v;T&&T.determinant()<0&&l._FlipFaces(V,K,z.indices.length),v+=z.xa.length/3,K+=z.indices.length,p&&(yield)}}return this.indices=V,this.xa=l._MergeElement(m.h.PositionKind,W.xa,z,a.map((z=>[z.vertexData.xa,z.transform]))),p&&(yield),W.ya&&(this.ya=l._MergeElement(m.h.NormalKind,W.ya,z,a.map((z=>[z.vertexData.ya,z.transform]))),p&&(yield)),W.tangents&&(this.tangents=l._MergeElement(m.h.TangentKind,W.tangents,z,a.map((z=>[z.vertexData.tangents,z.transform]))),p&&(yield)),W.Aa&&(this.Aa=l._MergeElement(m.h.UVKind,W.Aa,z,a.map((z=>[z.vertexData.Aa,z.transform]))),p&&(yield)),W.uvs2&&(this.uvs2=l._MergeElement(m.h.UV2Kind,W.uvs2,z,a.map((z=>[z.vertexData.uvs2,z.transform]))),p&&(yield)),W.uvs3&&(this.uvs3=l._MergeElement(m.h.UV3Kind,W.uvs3,z,a.map((z=>[z.vertexData.uvs3,z.transform]))),p&&(yield)),W.uvs4&&(this.uvs4=l._MergeElement(m.h.UV4Kind,W.uvs4,z,a.map((z=>[z.vertexData.uvs4,z.transform]))),p&&(yield)),W.uvs5&&(this.uvs5=l._MergeElement(m.h.UV5Kind,W.uvs5,z,a.map((z=>[z.vertexData.uvs5,z.transform]))),p&&(yield)),W.uvs6&&(this.uvs6=l._MergeElement(m.h.UV6Kind,W.uvs6,z,a.map((z=>[z.vertexData.uvs6,z.transform]))),p&&(yield)),W.za&&(this.za=l._MergeElement(m.h.ColorKind,W.za,z,a.map((z=>[z.vertexData.za,z.transform]))),(void 0!==W.hasVertexAlpha||a.some((z=>void 0!==z.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=W.hasVertexAlpha||a.some((z=>z.vertexData.hasVertexAlpha))),p&&(yield)),W.matricesIndices&&(this.matricesIndices=l._MergeElement(m.h.MatricesIndicesKind,W.matricesIndices,z,a.map((z=>[z.vertexData.matricesIndices,z.transform]))),p&&(yield)),W.matricesWeights&&(this.matricesWeights=l._MergeElement(m.h.MatricesWeightsKind,W.matricesWeights,z,a.map((z=>[z.vertexData.matricesWeights,z.transform]))),p&&(yield)),W.matricesIndicesExtra&&(this.matricesIndicesExtra=l._MergeElement(m.h.MatricesIndicesExtraKind,W.matricesIndicesExtra,z,a.map((z=>[z.vertexData.matricesIndicesExtra,z.transform]))),p&&(yield)),W.matricesWeightsExtra&&(this.matricesWeightsExtra=l._MergeElement(m.h.MatricesWeightsExtraKind,W.matricesWeightsExtra,z,a.map((z=>[z.vertexData.matricesWeightsExtra,z.transform])))),this}static _MergeElement(z,a,K,v){const T=v.filter((z=>null!==z[0]&&void 0!==z[0]));if(!a&&0==T.length)return a;if(!a)return this._MergeElement(z,T[0][0],T[0][1],T.slice(1));const p=T.reduce(((z,a)=>z+a[0].length),a.length),j=z===m.h.PositionKind?l._TransformVector3Coordinates:z===m.h.NormalKind?l._TransformVector3Normals:z===m.h.TangentKind?l._TransformVector4Normals:()=>{};if(a instanceof Float32Array){const z=new Float32Array(p);z.set(a),K&&j(z,K,0,a.length);let v=a.length;for(const[a,K]of T)z.set(a,v),K&&j(z,K,v,a.length),v+=a.length;return z}{const z=new Array(p);for(let K=0;K<a.length;K++)z[K]=a[K];K&&j(z,K,0,a.length);let v=a.length;for(const[a,K]of T){for(let K=0;K<a.length;K++)z[v+K]=a[K];K&&j(z,K,v,a.length),v+=a.length}return z}}_validate(){if(!this.xa)throw new W.h("Positions are required",W.e.MeshInvalidPositionsError);const z=(z,a)=>{const K=m.h.DeduceStride(z);if(a.length%K!==0)throw new Error("The "+z+"s array count must be a multiple of "+K);return a.length/K},a=z(m.h.PositionKind,this.xa),K=(K,v)=>{const T=z(K,v);if(T!==a)throw new Error("The "+K+"s element count ("+T+") does not match the positions count ("+a+")")};this.ya&&K(m.h.NormalKind,this.ya),this.tangents&&K(m.h.TangentKind,this.tangents),this.Aa&&K(m.h.UVKind,this.Aa),this.uvs2&&K(m.h.UV2Kind,this.uvs2),this.uvs3&&K(m.h.UV3Kind,this.uvs3),this.uvs4&&K(m.h.UV4Kind,this.uvs4),this.uvs5&&K(m.h.UV5Kind,this.uvs5),this.uvs6&&K(m.h.UV6Kind,this.uvs6),this.za&&K(m.h.ColorKind,this.za),this.matricesIndices&&K(m.h.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&K(m.h.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&K(m.h.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&K(m.h.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const z=this.serialize();return l.Parse(z)}serialize(){const z={};if(this.xa&&(z.xa=Array.from(this.xa)),this.ya&&(z.ya=Array.from(this.ya)),this.tangents&&(z.tangents=Array.from(this.tangents)),this.Aa&&(z.Aa=Array.from(this.Aa)),this.uvs2&&(z.uvs2=Array.from(this.uvs2)),this.uvs3&&(z.uvs3=Array.from(this.uvs3)),this.uvs4&&(z.uvs4=Array.from(this.uvs4)),this.uvs5&&(z.uvs5=Array.from(this.uvs5)),this.uvs6&&(z.uvs6=Array.from(this.uvs6)),this.za&&(z.za=Array.from(this.za),z.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(z.matricesIndices=Array.from(this.matricesIndices),z.matricesIndices._isExpanded=!0),this.matricesWeights&&(z.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(z.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),z.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(z.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),z.indices=Array.from(this.indices),this.materialInfos){z.materialInfos=[];for(const a of this.materialInfos){const K={indexStart:a.indexStart,indexCount:a.indexCount,materialIndex:a.materialIndex,verticesStart:a.verticesStart,verticesCount:a.verticesCount};z.materialInfos.push(K)}}return z}static ExtractFromMesh(z,a,K){return l._ExtractFrom(z,a,K)}static ExtractFromGeometry(z,a,K){return l._ExtractFrom(z,a,K)}static _ExtractFrom(z,a,K){const v=new l;if(z.isVerticesDataPresent(m.h.PositionKind)&&(v.xa=z.getVerticesData(m.h.PositionKind,a,K)),z.isVerticesDataPresent(m.h.NormalKind)&&(v.ya=z.getVerticesData(m.h.NormalKind,a,K)),z.isVerticesDataPresent(m.h.TangentKind)&&(v.tangents=z.getVerticesData(m.h.TangentKind,a,K)),z.isVerticesDataPresent(m.h.UVKind)&&(v.Aa=z.getVerticesData(m.h.UVKind,a,K)),z.isVerticesDataPresent(m.h.UV2Kind)&&(v.uvs2=z.getVerticesData(m.h.UV2Kind,a,K)),z.isVerticesDataPresent(m.h.UV3Kind)&&(v.uvs3=z.getVerticesData(m.h.UV3Kind,a,K)),z.isVerticesDataPresent(m.h.UV4Kind)&&(v.uvs4=z.getVerticesData(m.h.UV4Kind,a,K)),z.isVerticesDataPresent(m.h.UV5Kind)&&(v.uvs5=z.getVerticesData(m.h.UV5Kind,a,K)),z.isVerticesDataPresent(m.h.UV6Kind)&&(v.uvs6=z.getVerticesData(m.h.UV6Kind,a,K)),z.isVerticesDataPresent(m.h.ColorKind)){const T=z.Fj||z,p=T.getVertexBuffer(m.h.ColorKind),j=T.getVerticesData(m.h.ColorKind,a,K);if(3===p.getSize()){const z=new Float32Array(4*j.length/3);for(let a=0,K=0;a<j.length;a+=3,K+=4)z[K]=j[a],z[K+1]=j[a+1],z[K+2]=j[a+2],z[K+3]=1;v.za=z}else{if(4!==p.getSize())throw new Error(`Unexpected number of color components: ${p.getSize()}`);v.za=j}}return z.isVerticesDataPresent(m.h.MatricesIndicesKind)&&(v.matricesIndices=z.getVerticesData(m.h.MatricesIndicesKind,a,K)),z.isVerticesDataPresent(m.h.MatricesWeightsKind)&&(v.matricesWeights=z.getVerticesData(m.h.MatricesWeightsKind,a,K)),z.isVerticesDataPresent(m.h.MatricesIndicesExtraKind)&&(v.matricesIndicesExtra=z.getVerticesData(m.h.MatricesIndicesExtraKind,a,K)),z.isVerticesDataPresent(m.h.MatricesWeightsExtraKind)&&(v.matricesWeightsExtra=z.getVerticesData(m.h.MatricesWeightsExtraKind,a,K)),v.indices=z.Rf(a,K),v}static CreateRibbon(z){throw(0,p.b)("ribbonBuilder")}static CreateBox(z){throw(0,p.b)("boxBuilder")}static CreateTiledBox(z){throw(0,p.b)("tiledBoxBuilder")}static CreateTiledPlane(z){throw(0,p.b)("tiledPlaneBuilder")}static CreateSphere(z){throw(0,p.b)("sphereBuilder")}static CreateCylinder(z){throw(0,p.b)("cylinderBuilder")}static CreateTorus(z){throw(0,p.b)("torusBuilder")}static CreateLineSystem(z){throw(0,p.b)("linesBuilder")}static CreateDashedLines(z){throw(0,p.b)("linesBuilder")}static CreateGround(z){throw(0,p.b)("groundBuilder")}static CreateTiledGround(z){throw(0,p.b)("groundBuilder")}static CreateGroundFromHeightMap(z){throw(0,p.b)("groundBuilder")}static Xf(z){throw(0,p.b)("planeBuilder")}static CreateDisc(z){throw(0,p.b)("discBuilder")}static CreatePolygon(z,a,K,v,T,m,j){throw(0,p.b)("polygonBuilder")}static CreateIcoSphere(z){throw(0,p.b)("icoSphereBuilder")}static CreatePolyhedron(z){throw(0,p.b)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||T.o.Up();throw(0,p.b)("capsuleBuilder")}static CreateTorusKnot(z){throw(0,p.b)("torusKnotBuilder")}static ComputeNormals(z,a,K,v){let m=0,p=0,j=0,s=0,M=0,r=0,W=0,F=0,G=0,l=0,V=0,c=0,C=0,w=0,H=0,f=0,Y=0,I=0,q=0,B=0,x=!1,Z=!1,y=!1,i=!1,n=1,X=0,P=null;v&&(x=!!v.facetNormals,Z=!!v.facetPositions,y=!!v.facetPartitioning,n=!0===v.useRightHandedSystem?-1:1,X=v.ratio||0,i=!!v.depthSort,P=v.distanceTo,i&&void 0===P&&(P=T.o.Zero()));let J=0,o=0,N=0,A=0;for(y&&v&&v.bbSize&&(J=v.subDiv.X*X/v.bbSize.x,o=v.subDiv.Y*X/v.bbSize.y,N=v.subDiv.Z*X/v.bbSize.z,A=v.subDiv.max*v.subDiv.max,v.facetPartitioning.length=0),m=0;m<z.length;m++)K[m]=0;const g=a.length/3|0;for(m=0;m<g;m++){if(c=3*a[3*m],C=c+1,w=c+2,H=3*a[3*m+1],f=H+1,Y=H+2,I=3*a[3*m+2],q=I+1,B=I+2,p=z[c]-z[H],j=z[C]-z[f],s=z[w]-z[Y],M=z[I]-z[H],r=z[q]-z[f],W=z[B]-z[Y],F=n*(j*W-s*r),G=n*(s*M-p*W),l=n*(p*r-j*M),V=Math.sqrt(F*F+G*G+l*l),V=0===V?1:V,F/=V,G/=V,l/=V,x&&v&&(v.facetNormals[m].x=F,v.facetNormals[m].y=G,v.facetNormals[m].z=l),Z&&v&&(v.facetPositions[m].x=(z[c]+z[H]+z[I])/3,v.facetPositions[m].y=(z[C]+z[f]+z[q])/3,v.facetPositions[m].z=(z[w]+z[Y]+z[B])/3),y&&v){const a=Math.floor((v.facetPositions[m].x-v.bInfo.minimum.x*X)*J),K=Math.floor((v.facetPositions[m].y-v.bInfo.minimum.y*X)*o),T=Math.floor((v.facetPositions[m].z-v.bInfo.minimum.z*X)*N),p=Math.floor((z[c]-v.bInfo.minimum.x*X)*J),j=Math.floor((z[C]-v.bInfo.minimum.y*X)*o),s=Math.floor((z[w]-v.bInfo.minimum.z*X)*N),M=Math.floor((z[H]-v.bInfo.minimum.x*X)*J),r=Math.floor((z[f]-v.bInfo.minimum.y*X)*o),W=Math.floor((z[Y]-v.bInfo.minimum.z*X)*N),F=Math.floor((z[I]-v.bInfo.minimum.x*X)*J),G=Math.floor((z[q]-v.bInfo.minimum.y*X)*o),l=Math.floor((z[B]-v.bInfo.minimum.z*X)*N),V=p+v.subDiv.max*j+A*s,x=M+v.subDiv.max*r+A*W,Z=F+v.subDiv.max*G+A*l,y=a+v.subDiv.max*K+A*T;v.facetPartitioning[y]=v.facetPartitioning[y]?v.facetPartitioning[y]:new Array,v.facetPartitioning[V]=v.facetPartitioning[V]?v.facetPartitioning[V]:new Array,v.facetPartitioning[x]=v.facetPartitioning[x]?v.facetPartitioning[x]:new Array,v.facetPartitioning[Z]=v.facetPartitioning[Z]?v.facetPartitioning[Z]:new Array,v.facetPartitioning[V].push(m),x!=V&&v.facetPartitioning[x].push(m),Z!=x&&Z!=V&&v.facetPartitioning[Z].push(m),y!=V&&y!=x&&y!=Z&&v.facetPartitioning[y].push(m)}if(i&&v&&v.facetPositions){const z=v.depthSortedFacets[m];z.ind=3*m,z.sqDistance=T.o.DistanceSquared(v.facetPositions[m],P)}K[c]+=F,K[C]+=G,K[w]+=l,K[H]+=F,K[f]+=G,K[Y]+=l,K[I]+=F,K[q]+=G,K[B]+=l}for(m=0;m<K.length/3;m++)F=K[3*m],G=K[3*m+1],l=K[3*m+2],V=Math.sqrt(F*F+G*G+l*l),V=0===V?1:V,F/=V,G/=V,l/=V,K[3*m]=F,K[3*m+1]=G,K[3*m+2]=l}static _ComputeSides(z,a,K,v,m,p,j){const s=K.length,M=v.length;let r,W;switch(z=z||l.DEFAULTSIDE){case l.FRONTSIDE:break;case l.BACKSIDE:for(r=0;r<s;r+=3){const z=K[r];K[r]=K[r+2],K[r+2]=z}for(W=0;W<M;W++)v[W]=-v[W];break;case l.DOUBLESIDE:{const z=a.length,F=z/3;for(let K=0;K<z;K++)a[z+K]=a[K];for(r=0;r<s;r+=3)K[r+s]=K[r+2]+F,K[r+1+s]=K[r+1]+F,K[r+2+s]=K[r]+F;for(W=0;W<M;W++)v[M+W]=-v[W];const G=m.length;let l=0;for(l=0;l<G;l++)m[l+G]=m[l];for(p=p||new T.r(0,0,1,1),j=j||new T.r(0,0,1,1),l=0,r=0;r<G/2;r++)m[l]=p.x+(p.z-p.x)*m[l],m[l+1]=p.y+(p.w-p.y)*m[l+1],m[l+G]=j.x+(j.z-j.x)*m[l+G],m[l+G+1]=j.y+(j.w-j.y)*m[l+G+1],l+=2;break}}}static Parse(z){const a=new l,K=z.xa;K&&a.set(K,m.h.PositionKind);const v=z.ya;v&&a.set(v,m.h.NormalKind);const T=z.tangents;T&&a.set(T,m.h.TangentKind);const p=z.Aa;p&&a.set(p,m.h.UVKind);const s=z.uvs2;s&&a.set(s,m.h.UV2Kind);const M=z.uvs3;M&&a.set(M,m.h.UV3Kind);const r=z.uvs4;r&&a.set(r,m.h.UV4Kind);const W=z.uvs5;W&&a.set(W,m.h.UV5Kind);const F=z.uvs6;F&&a.set(F,m.h.UV6Kind);const V=z.za;V&&(a.set(j.d.CheckColors4(V,K.length/3),m.h.ColorKind),void 0!==z.hasVertexAlpha&&(a.hasVertexAlpha=z.hasVertexAlpha));const c=z.matricesIndices;c&&a.set(c,m.h.MatricesIndicesKind);const C=z.matricesWeights;C&&a.set(C,m.h.MatricesWeightsKind);const w=z.indices;w&&(a.indices=w);const H=z.materialInfos;if(H){a.materialInfos=[];for(const z of H){const K=new G;K.indexCount=z.indexCount,K.indexStart=z.indexStart,K.verticesCount=z.verticesCount,K.verticesStart=z.verticesStart,K.materialIndex=z.materialIndex,a.materialInfos.push(K)}}return a}static ImportVertexData(z,a){const K=l.Parse(z);a.setAllVerticesData(K,z.updatable)}}l.FRONTSIDE=0,l.BACKSIDE=1,l.DOUBLESIDE=2,l.DEFAULTSIDE=0,l._UniqueIDGenerator=0,(0,v.e)([M.e.filter((function(){for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];let[v]=a;return!Array.isArray(v)}))],l,"_TransformVector3Coordinates",null),(0,v.e)([M.e.filter((function(){for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];let[v]=a;return!Array.isArray(v)}))],l,"_TransformVector3Normals",null),(0,v.e)([M.e.filter((function(){for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];let[v]=a;return!Array.isArray(v)}))],l,"_TransformVector4Normals",null),(0,v.e)([M.e.filter((function(){for(var z=arguments.length,a=new Array(z),K=0;K<z;K++)a[K]=arguments[K];let[v]=a;return!Array.isArray(v)}))],l,"_FlipFaces",null)},12365:(z,a,K)=>{"use strict";K.d(a,{e:()=>Vz});var v=K(10941),T=K(11194),m=K(11001),p=K(11230),j=K(11161);function s(z){let a=z.pathArray;const K=z.closeArray||!1,v=z.closePath||!1,T=z.invertUV||!1,s=Math.floor(a[0].length/2);let M=z.offset||s;M=M>s?s:Math.floor(M);const r=0===z.sideOrientation?0:z.sideOrientation||p.b.DEFAULTSIDE,W=z.Aa,F=z.za,G=[],l=[],V=[],c=[],C=[],w=[],H=[],f=[];let Y;const I=[],q=[];let B,x,Z;if(a.length<2){const z=[],K=[];for(x=0;x<a[0].length-M;x++)z.push(a[0][x]),K.push(a[0][x+M]);a=[z,K]}let y=0;const i=v?1:0,n=K?1:0;let X,P,J,o,N,A;for(Y=a[0].length,B=0;B<a.length+n;B++){for(H[B]=0,C[B]=[0],X=B===a.length?a[0]:a[B],P=X.length,Y=Y<P?Y:P,Z=0;Z<P;)G.push(X[Z].x,X[Z].y,X[Z].z),Z>0&&(J=X[Z].sc(X[Z-1]).length(),o=J+H[B],C[B].push(o),H[B]=o),Z++;v&&(Z--,G.push(X[0].x,X[0].y,X[0].z),J=X[Z].sc(X[0]).length(),o=J+H[B],C[B].push(o),H[B]=o),I[B]=P+i,q[B]=y,y+=P+i}let g,d,t=null,e=null;for(x=0;x<Y+i;x++)for(f[x]=0,w[x]=[0],B=0;B<a.length-1+n;B++)N=a[B],A=B===a.length-1?a[0]:a[B+1],x===Y?(t=N[0],e=A[0]):(t=N[x],e=A[x]),J=e.sc(t).length(),o=J+f[x],w[x].push(o),f[x]=o;if(W)for(B=0;B<W.length;B++)c.push(W[B].x,j.d?1-W[B].y:W[B].y);else for(B=0;B<a.length+n;B++)for(x=0;x<Y+i;x++)g=0!=H[B]?C[B][x]/H[B]:0,d=0!=f[x]?w[x][B]/f[x]:0,T?c.push(d,g):c.push(g,j.d?1-d:d);B=0;let L=0,E=I[B]-1,b=I[B+1]-1,D=E<b?E:b,u=q[1]-q[0];const U=I.length-1;for(;L<=D&&B<U;)l.push(L,L+u,L+1),l.push(L+u+1,L+1,L+u),L+=1,L===D&&(B++,u=q[B+1]-q[B],E=I[B]-1,b=I[B+1]-1,L=q[B],D=E<b?E+L:b+L);if(p.b.ComputeNormals(G,l,V),v){let z=0,K=0;for(B=0;B<a.length;B++){z=3*q[B],K=B+1<a.length?3*(q[B+1]-1):V.length-3,V[z]=.5*(V[z]+V[K]),V[z+1]=.5*(V[z+1]+V[K+1]),V[z+2]=.5*(V[z+2]+V[K+2]);const v=Math.sqrt(V[z]*V[z]+V[z+1]*V[z+1]+V[z+2]*V[z+2]);V[z]/=v,V[z+1]/=v,V[z+2]/=v,V[K]=V[z],V[K+1]=V[z+1],V[K+2]=V[z+2]}}if(K){let z=3*q[0],K=3*q[a.length];for(x=0;x<Y+i;x++){V[z]=.5*(V[z]+V[K]),V[z+1]=.5*(V[z+1]+V[K+1]),V[z+2]=.5*(V[z+2]+V[K+2]);const a=Math.sqrt(V[z]*V[z]+V[z+1]*V[z+1]+V[z+2]*V[z+2]);V[z]/=a,V[z+1]/=a,V[z+2]/=a,V[K]=V[z],V[K+1]=V[z+1],V[K+2]=V[z+2],z+=3,K+=3}}p.b._ComputeSides(r,G,l,V,c,z.frontUVs,z.backUVs);let R=null;if(F){R=new Float32Array(4*F.length);for(let z=0;z<F.length;z++)R[4*z]=F[z].r,R[4*z+1]=F[z].g,R[4*z+2]=F[z].b,R[4*z+3]=F[z].a}const k=new p.b,h=new Float32Array(G),S=new Float32Array(V),Q=new Float32Array(c);return k.indices=l,k.xa=h,k.ya=S,k.Aa=Q,R&&k.set(R,m.h.ColorKind),v&&(k._idx=q),k}function M(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=a.pathArray,r=a.closeArray,W=a.closePath,F=T.c._GetDefaultSideOrientation(a.sideOrientation),G=a.instance,l=a.updatable;if(G){const z=v.j.gb[0].Vd(Number.MAX_VALUE),K=v.j.gb[1].Vd(-Number.MAX_VALUE),s=a=>{let v=M[0].length;const m=G;let p=0;const j=m._originalBuilderSideOrientation===T.c.DOUBLESIDE?2:1;for(let T=1;T<=j;++T)for(let j=0;j<M.length;++j){const T=M[j],s=T.length;v=v<s?v:s;for(let m=0;m<v;++m){const v=T[m];a[p]=v.x,a[p+1]=v.y,a[p+2]=v.z,z.minimizeInPlaceFromFloats(v.x,v.y,v.z),K.maximizeInPlaceFromFloats(v.x,v.y,v.z),p+=3}if(m._creationDataStorage&&m._creationDataStorage.closePath){const z=T[0];a[p]=z.x,a[p+1]=z.y,a[p+2]=z.z,p+=3}}},r=G.getVerticesData(m.h.PositionKind);if(s(r),G.hasBoundingInfo?G.getBoundingInfo().reConstruct(z,K,G._worldMatrix):G.buildBoundingInfo(z,K,G._worldMatrix),G.updateVerticesData(m.h.PositionKind,r,!1,!1),a.za){const z=G.getVerticesData(m.h.ColorKind);for(let K=0,v=0;K<a.za.length;K++,v+=4){const T=a.za[K];z[v]=T.r,z[v+1]=T.g,z[v+2]=T.b,z[v+3]=T.a}G.updateVerticesData(m.h.ColorKind,z,!1,!1)}if(a.Aa){const z=G.getVerticesData(m.h.UVKind);for(let K=0;K<a.Aa.length;K++)z[2*K]=a.Aa[K].x,z[2*K+1]=j.d?1-a.Aa[K].y:a.Aa[K].y;G.updateVerticesData(m.h.UVKind,z,!1,!1)}if(!G.areNormalsFrozen||G.isFacetDataEnabled){const z=G.Rf(),a=G.getVerticesData(m.h.NormalKind),K=G.isFacetDataEnabled?G.getFacetDataParameters():null;if(p.b.ComputeNormals(r,z,a,K),G._creationDataStorage&&G._creationDataStorage.closePath){let z=0,K=0;for(let v=0;v<M.length;v++)z=3*G._creationDataStorage.idx[v],K=v+1<M.length?3*(G._creationDataStorage.idx[v+1]-1):a.length-3,a[z]=.5*(a[z]+a[K]),a[z+1]=.5*(a[z+1]+a[K+1]),a[z+2]=.5*(a[z+2]+a[K+2]),a[K]=a[z],a[K+1]=a[z+1],a[K+2]=a[z+2]}G.areNormalsFrozen||G.updateVerticesData(m.h.NormalKind,a,!1,!1)}return G}{const v=new T.c(z,K);v._originalBuilderSideOrientation=F,v._creationDataStorage=new T.g;const m=s(a);return W&&(v._creationDataStorage.idx=m._idx),v._creationDataStorage.closePath=W,v._creationDataStorage.closeArray=r,m.Ca(v,l),v}}p.b.CreateRibbon=s,T.c.CreateRibbon=function(z,a){return M(z,{pathArray:a,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var r=K(11591),W=K(11268),F=K(10971);function G(z){const a=z.pattern||T.c.NO_FLIP,K=z.tileWidth||z.tileSize||1,v=z.tileHeight||z.tileSize||1,m=z.alignHorizontal||0,j=z.alignVertical||0,s=z.width||z.size||1,M=Math.floor(s/K);let r=s-M*K;const W=z.height||z.size||1,F=Math.floor(W/v);let G=W-F*v;const l=K*M/2,V=v*F/2;let c=0,C=0,w=0,H=0,f=0,Y=0;if(r>0||G>0){switch(w=-l,H=-V,f=l,Y=V,m){case T.c.CENTER:r/=2,w-=r,f+=r;break;case T.c.LEFT:f+=r,c=-r/2;break;case T.c.RIGHT:w-=r,c=r/2}switch(j){case T.c.CENTER:G/=2,H-=G,Y+=G;break;case T.c.BOTTOM:Y+=G,C=-G/2;break;case T.c.TOP:H-=G,C=G/2}}const I=[],q=[],B=[];B[0]=[0,0,1,0,1,1,0,1],B[1]=[0,0,1,0,1,1,0,1],a!==T.c.ROTATE_TILE&&a!==T.c.ROTATE_ROW||(B[1]=[1,1,0,1,0,0,1,0]),a!==T.c.FLIP_TILE&&a!==T.c.FLIP_ROW||(B[1]=[1,0,0,0,0,1,1,1]),a!==T.c.FLIP_N_ROTATE_TILE&&a!==T.c.FLIP_N_ROTATE_ROW||(B[1]=[0,1,1,1,1,0,0,0]);let x=[];const Z=[],y=[];let i=0;for(let p=0;p<F;p++)for(let z=0;z<M;z++)I.push(z*K-l+c,p*v-V+C,0),I.push((z+1)*K-l+c,p*v-V+C,0),I.push((z+1)*K-l+c,(p+1)*v-V+C,0),I.push(z*K-l+c,(p+1)*v-V+C,0),y.push(i,i+1,i+3,i+1,i+2,i+3),x=a===T.c.FLIP_TILE||a===T.c.ROTATE_TILE||a===T.c.FLIP_N_ROTATE_TILE?x.concat(B[(z%2+p%2)%2]):a===T.c.FLIP_ROW||a===T.c.ROTATE_ROW||a===T.c.FLIP_N_ROTATE_ROW?x.concat(B[p%2]):x.concat(B[0]),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),i+=4;if(r>0||G>0){const z=G>0&&(j===T.c.CENTER||j===T.c.TOP),p=G>0&&(j===T.c.CENTER||j===T.c.BOTTOM),s=r>0&&(m===T.c.CENTER||m===T.c.RIGHT),W=r>0&&(m===T.c.CENTER||m===T.c.LEFT);let B,n,X,P,J=[];if(z&&s&&(I.push(w+c,H+C,0),I.push(-l+c,H+C,0),I.push(-l+c,H+G+C,0),I.push(w+c,H+G+C,0),y.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,B=1-r/K,n=1-G/v,X=1,P=1,J=[B,n,X,n,X,P,B,P],a===T.c.ROTATE_ROW&&(J=[1-B,1-n,1-X,1-n,1-X,1-P,1-B,1-P]),a===T.c.FLIP_ROW&&(J=[1-B,n,1-X,n,1-X,P,1-B,P]),a===T.c.FLIP_N_ROTATE_ROW&&(J=[B,1-n,X,1-n,X,1-P,B,1-P]),x=x.concat(J),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),z&&W&&(I.push(l+c,H+C,0),I.push(f+c,H+C,0),I.push(f+c,H+G+C,0),I.push(l+c,H+G+C,0),y.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,B=0,n=1-G/v,X=r/K,P=1,J=[B,n,X,n,X,P,B,P],(a===T.c.ROTATE_ROW||a===T.c.ROTATE_TILE&&M%2===0)&&(J=[1-B,1-n,1-X,1-n,1-X,1-P,1-B,1-P]),(a===T.c.FLIP_ROW||a===T.c.FLIP_TILE&&M%2===0)&&(J=[1-B,n,1-X,n,1-X,P,1-B,P]),(a===T.c.FLIP_N_ROTATE_ROW||a===T.c.FLIP_N_ROTATE_TILE&&M%2===0)&&(J=[B,1-n,X,1-n,X,1-P,B,1-P]),x=x.concat(J),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),p&&s&&(I.push(w+c,V+C,0),I.push(-l+c,V+C,0),I.push(-l+c,Y+C,0),I.push(w+c,Y+C,0),y.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,B=1-r/K,n=0,X=1,P=G/v,J=[B,n,X,n,X,P,B,P],(a===T.c.ROTATE_ROW&&F%2===1||a===T.c.ROTATE_TILE&&F%1===0)&&(J=[1-B,1-n,1-X,1-n,1-X,1-P,1-B,1-P]),(a===T.c.FLIP_ROW&&F%2===1||a===T.c.FLIP_TILE&&F%2===0)&&(J=[1-B,n,1-X,n,1-X,P,1-B,P]),(a===T.c.FLIP_N_ROTATE_ROW&&F%2===1||a===T.c.FLIP_N_ROTATE_TILE&&F%2===0)&&(J=[B,1-n,X,1-n,X,1-P,B,1-P]),x=x.concat(J),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),p&&W&&(I.push(l+c,V+C,0),I.push(f+c,V+C,0),I.push(f+c,Y+C,0),I.push(l+c,Y+C,0),y.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,B=0,n=0,X=r/K,P=G/v,J=[B,n,X,n,X,P,B,P],(a===T.c.ROTATE_ROW&&F%2===1||a===T.c.ROTATE_TILE&&(F+M)%2===1)&&(J=[1-B,1-n,1-X,1-n,1-X,1-P,1-B,1-P]),(a===T.c.FLIP_ROW&&F%2===1||a===T.c.FLIP_TILE&&(F+M)%2===1)&&(J=[1-B,n,1-X,n,1-X,P,1-B,P]),(a===T.c.FLIP_N_ROTATE_ROW&&F%2===1||a===T.c.FLIP_N_ROTATE_TILE&&(F+M)%2===1)&&(J=[B,1-n,X,1-n,X,1-P,B,1-P]),x=x.concat(J),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),z){const z=[];B=0,n=1-G/v,X=1,P=1,z[0]=[B,n,X,n,X,P,B,P],z[1]=[B,n,X,n,X,P,B,P],a!==T.c.ROTATE_TILE&&a!==T.c.ROTATE_ROW||(z[1]=[1-B,1-n,1-X,1-n,1-X,1-P,1-B,1-P]),a!==T.c.FLIP_TILE&&a!==T.c.FLIP_ROW||(z[1]=[1-B,n,1-X,n,1-X,P,1-B,P]),a!==T.c.FLIP_N_ROTATE_TILE&&a!==T.c.FLIP_N_ROTATE_ROW||(z[1]=[B,1-n,X,1-n,X,1-P,B,1-P]);for(let v=0;v<M;v++)I.push(v*K-l+c,H+C,0),I.push((v+1)*K-l+c,H+C,0),I.push((v+1)*K-l+c,H+G+C,0),I.push(v*K-l+c,H+G+C,0),y.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,x=a===T.c.FLIP_TILE||a===T.c.ROTATE_TILE||a===T.c.FLIP_N_ROTATE_TILE?x.concat(z[(v+1)%2]):a===T.c.FLIP_ROW||a===T.c.ROTATE_ROW||a===T.c.FLIP_N_ROTATE_ROW?x.concat(z[1]):x.concat(z[0]),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(p){const z=[];B=0,n=0,X=1,P=G/v,z[0]=[B,n,X,n,X,P,B,P],z[1]=[B,n,X,n,X,P,B,P],a!==T.c.ROTATE_TILE&&a!==T.c.ROTATE_ROW||(z[1]=[1-B,1-n,1-X,1-n,1-X,1-P,1-B,1-P]),a!==T.c.FLIP_TILE&&a!==T.c.FLIP_ROW||(z[1]=[1-B,n,1-X,n,1-X,P,1-B,P]),a!==T.c.FLIP_N_ROTATE_TILE&&a!==T.c.FLIP_N_ROTATE_ROW||(z[1]=[B,1-n,X,1-n,X,1-P,B,1-P]);for(let v=0;v<M;v++)I.push(v*K-l+c,Y-G+C,0),I.push((v+1)*K-l+c,Y-G+C,0),I.push((v+1)*K-l+c,Y+C,0),I.push(v*K-l+c,Y+C,0),y.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,x=a===T.c.FLIP_TILE||a===T.c.ROTATE_TILE||a===T.c.FLIP_N_ROTATE_TILE?x.concat(z[(v+F)%2]):a===T.c.FLIP_ROW||a===T.c.ROTATE_ROW||a===T.c.FLIP_N_ROTATE_ROW?x.concat(z[F%2]):x.concat(z[0]),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(s){const z=[];B=1-r/K,n=0,X=1,P=1,z[0]=[B,n,X,n,X,P,B,P],z[1]=[B,n,X,n,X,P,B,P],a!==T.c.ROTATE_TILE&&a!==T.c.ROTATE_ROW||(z[1]=[1-B,1-n,1-X,1-n,1-X,1-P,1-B,1-P]),a!==T.c.FLIP_TILE&&a!==T.c.FLIP_ROW||(z[1]=[1-B,n,1-X,n,1-X,P,1-B,P]),a!==T.c.FLIP_N_ROTATE_TILE&&a!==T.c.FLIP_N_ROTATE_ROW||(z[1]=[B,1-n,X,1-n,X,1-P,B,1-P]);for(let K=0;K<F;K++)I.push(w+c,K*v-V+C,0),I.push(w+r+c,K*v-V+C,0),I.push(w+r+c,(K+1)*v-V+C,0),I.push(w+c,(K+1)*v-V+C,0),y.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,x=a===T.c.FLIP_TILE||a===T.c.ROTATE_TILE||a===T.c.FLIP_N_ROTATE_TILE?x.concat(z[(K+1)%2]):a===T.c.FLIP_ROW||a===T.c.ROTATE_ROW||a===T.c.FLIP_N_ROTATE_ROW?x.concat(z[K%2]):x.concat(z[0]),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(W){const z=[];B=0,n=0,X=r/v,P=1,z[0]=[B,n,X,n,X,P,B,P],z[1]=[B,n,X,n,X,P,B,P],a!==T.c.ROTATE_TILE&&a!==T.c.ROTATE_ROW||(z[1]=[1-B,1-n,1-X,1-n,1-X,1-P,1-B,1-P]),a!==T.c.FLIP_TILE&&a!==T.c.FLIP_ROW||(z[1]=[1-B,n,1-X,n,1-X,P,1-B,P]),a!==T.c.FLIP_N_ROTATE_TILE&&a!==T.c.FLIP_N_ROTATE_ROW||(z[1]=[B,1-n,X,1-n,X,1-P,B,1-P]);for(let K=0;K<F;K++)I.push(f-r+c,K*v-V+C,0),I.push(f+c,K*v-V+C,0),I.push(f+c,(K+1)*v-V+C,0),I.push(f-r+c,(K+1)*v-V+C,0),y.push(i,i+1,i+3,i+1,i+2,i+3),i+=4,x=a===T.c.FLIP_TILE||a===T.c.ROTATE_TILE||a===T.c.FLIP_N_ROTATE_TILE?x.concat(z[(K+M)%2]):a===T.c.FLIP_ROW||a===T.c.ROTATE_ROW||a===T.c.FLIP_N_ROTATE_ROW?x.concat(z[K%2]):x.concat(z[0]),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const n=0===z.sideOrientation?0:z.sideOrientation||p.b.DEFAULTSIDE;p.b._ComputeSides(n,I,y,q,x,z.frontUVs,z.backUVs);const X=new p.b;X.indices=y,X.xa=I,X.ya=q,X.Aa=x;const P=n===p.b.DOUBLESIDE?Z.concat(Z):Z;return X.za=P,X}function l(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new T.c(z,K);a.sideOrientation=T.c._GetDefaultSideOrientation(a.sideOrientation),v._originalBuilderSideOrientation=a.sideOrientation;return G(a).Ca(v,a.updatable),v}function V(z){const a=z.faceUV||new Array(6),K=z.faceColors,m=z.pattern||T.c.NO_FLIP,s=z.width||z.size||1,M=z.height||z.size||1,r=z.depth||z.size||1,W=z.tileWidth||z.tileSize||1,l=z.tileHeight||z.tileSize||1,V=z.alignHorizontal||0,c=z.alignVertical||0,C=0===z.sideOrientation?0:z.sideOrientation||p.b.DEFAULTSIDE;for(let T=0;T<6;T++)void 0===a[T]&&(a[T]=new v.r(0,0,1,1)),K&&void 0===K[T]&&(K[T]=new F.d(1,1,1,1));const w=s/2,H=M/2,f=r/2,Y=[];for(let v=0;v<2;v++)Y[v]=G({pattern:m,tileWidth:W,tileHeight:l,width:s,height:M,alignVertical:c,alignHorizontal:V,sideOrientation:C});for(let v=2;v<4;v++)Y[v]=G({pattern:m,tileWidth:W,tileHeight:l,width:r,height:M,alignVertical:c,alignHorizontal:V,sideOrientation:C});let I=c;c===T.c.BOTTOM?I=T.c.TOP:c===T.c.TOP&&(I=T.c.BOTTOM);for(let v=4;v<6;v++)Y[v]=G({pattern:m,tileWidth:W,tileHeight:l,width:s,height:r,alignVertical:I,alignHorizontal:V,sideOrientation:C});let q=[],B=[],x=[],Z=[];const y=[],i=[],n=[],X=[];let P=0,J=0;for(let T=0;T<6;T++){const z=Y[T].xa.length;i[T]=[],n[T]=[];for(let a=0;a<z/3;a++)i[T].push(new v.o(Y[T].xa[3*a],Y[T].xa[3*a+1],Y[T].xa[3*a+2])),n[T].push(new v.o(Y[T].ya[3*a],Y[T].ya[3*a+1],Y[T].ya[3*a+2]));P=Y[T].Aa.length,X[T]=[];for(let K=0;K<P;K+=2)X[T][K]=a[T].x+(a[T].z-a[T].x)*Y[T].Aa[K],X[T][K+1]=a[T].y+(a[T].w-a[T].y)*Y[T].Aa[K+1],j.d&&(X[T][K+1]=1-X[T][K+1]);if(x=x.concat(X[T]),Z=Z.concat(Y[T].indices.map((z=>z+J))),J+=i[T].length,K)for(let a=0;a<4;a++)y.push(K[T].r,K[T].g,K[T].b,K[T].a)}const o=new v.o(0,0,f),N=v.b.RotationY(Math.PI);q=i[0].map((z=>v.o.TransformNormal(z,N).add(o))).map((z=>[z.x,z.y,z.z])).reduce(((z,a)=>z.concat(a)),[]),B=n[0].map((z=>v.o.TransformNormal(z,N))).map((z=>[z.x,z.y,z.z])).reduce(((z,a)=>z.concat(a)),[]),q=q.concat(i[1].map((z=>z.sc(o))).map((z=>[z.x,z.y,z.z])).reduce(((z,a)=>z.concat(a)),[])),B=B.concat(n[1].map((z=>[z.x,z.y,z.z])).reduce(((z,a)=>z.concat(a)),[]));const A=new v.o(w,0,0),g=v.b.RotationY(-Math.PI/2);q=q.concat(i[2].map((z=>v.o.TransformNormal(z,g).add(A))).map((z=>[z.x,z.y,z.z])).reduce(((z,a)=>z.concat(a)),[])),B=B.concat(n[2].map((z=>v.o.TransformNormal(z,g))).map((z=>[z.x,z.y,z.z])).reduce(((z,a)=>z.concat(a)),[]));const d=v.b.RotationY(Math.PI/2);q=q.concat(i[3].map((z=>v.o.TransformNormal(z,d).sc(A))).map((z=>[z.x,z.y,z.z])).reduce(((z,a)=>z.concat(a)),[])),B=B.concat(n[3].map((z=>v.o.TransformNormal(z,d))).map((z=>[z.x,z.y,z.z])).reduce(((z,a)=>z.concat(a)),[]));const t=new v.o(0,H,0),e=v.b.RotationX(Math.PI/2);q=q.concat(i[4].map((z=>v.o.TransformNormal(z,e).add(t))).map((z=>[z.x,z.y,z.z])).reduce(((z,a)=>z.concat(a)),[])),B=B.concat(n[4].map((z=>v.o.TransformNormal(z,e))).map((z=>[z.x,z.y,z.z])).reduce(((z,a)=>z.concat(a)),[]));const L=v.b.RotationX(-Math.PI/2);q=q.concat(i[5].map((z=>v.o.TransformNormal(z,L).sc(t))).map((z=>[z.x,z.y,z.z])).reduce(((z,a)=>z.concat(a)),[])),B=B.concat(n[5].map((z=>v.o.TransformNormal(z,L))).map((z=>[z.x,z.y,z.z])).reduce(((z,a)=>z.concat(a)),[])),p.b._ComputeSides(C,q,Z,B,x);const E=new p.b;if(E.indices=Z,E.xa=q,E.ya=B,E.Aa=x,K){const z=C===p.b.DOUBLESIDE?y.concat(y):y;E.za=z}return E}function c(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new T.c(z,K);a.sideOrientation=T.c._GetDefaultSideOrientation(a.sideOrientation),v._originalBuilderSideOrientation=a.sideOrientation;return V(a).Ca(v,a.updatable),v}p.b.CreateTiledPlane=G;p.b.CreateTiledBox=V;var C=K(11578),w=K(10935),H=K(11256);function f(z){const a=z.height||2;let K=0===z.diameterTop?0:z.diameterTop||z.diameter||1,m=0===z.diameterBottom?0:z.diameterBottom||z.diameter||1;K=K||1e-5,m=m||1e-5;const s=0|(z.tessellation||24),M=0|(z.subdivisions||1),r=!!z.hasRings,W=!!z.enclose,G=0===z.cap?0:z.cap||T.c.CAP_ALL,l=z.arc&&(z.arc<=0||z.arc>1)?1:z.arc||1,V=0===z.sideOrientation?0:z.sideOrientation||p.b.DEFAULTSIDE,c=z.faceUV||new Array(3),C=z.faceColors,w=2+(1+(1!==l&&W?2:0))*(r?M:1);let f;for(f=0;f<w;f++)C&&void 0===C[f]&&(C[f]=new F.d(1,1,1,1));for(f=0;f<w;f++)c&&void 0===c[f]&&(c[f]=new v.r(0,0,1,1));const Y=[],I=[],q=[],B=[],x=[],Z=2*Math.PI*l/s;let y,i,n;const X=(m-K)/2/a,P=v.o.Zero(),J=v.o.Zero(),o=v.o.Zero(),N=v.o.Zero(),A=v.o.Zero(),g=H.c.Y;let d,t,e,L=1,E=1,b=0,D=0;for(d=0;d<=M;d++)for(i=d/M,n=(i*(K-m)+m)/2,L=r&&0!==d&&d!==M?2:1,e=0;e<L;e++){for(r&&(E+=e),W&&(E+=2*e),t=0;t<=s;t++)y=t*Z,P.x=Math.cos(-y)*n,P.y=-a/2+i*a,P.z=Math.sin(-y)*n,0===K&&d===M?(J.x=q[q.length-3*(s+1)],J.y=q[q.length-3*(s+1)+1],J.z=q[q.length-3*(s+1)+2]):(J.x=P.x,J.z=P.z,J.y=Math.sqrt(J.x*J.x+J.z*J.z)*X,J.normalize()),0===t&&(o.p(P),N.p(J)),I.push(P.x,P.y,P.z),q.push(J.x,J.y,J.z),D=r?b!==E?c[E].y:c[E].w:c[E].y+(c[E].w-c[E].y)*i,B.push(c[E].x+(c[E].z-c[E].x)*t/s,j.d?1-D:D),C&&x.push(C[E].r,C[E].g,C[E].b,C[E].a);1!==l&&W&&(I.push(P.x,P.y,P.z),I.push(0,P.y,0),I.push(0,P.y,0),I.push(o.x,o.y,o.z),v.o.CrossToRef(g,J,A),A.normalize(),q.push(A.x,A.y,A.z,A.x,A.y,A.z),v.o.CrossToRef(N,g,A),A.normalize(),q.push(A.x,A.y,A.z,A.x,A.y,A.z),D=r?b!==E?c[E+1].y:c[E+1].w:c[E+1].y+(c[E+1].w-c[E+1].y)*i,B.push(c[E+1].x,j.d?1-D:D),B.push(c[E+1].z,j.d?1-D:D),D=r?b!==E?c[E+2].y:c[E+2].w:c[E+2].y+(c[E+2].w-c[E+2].y)*i,B.push(c[E+2].x,j.d?1-D:D),B.push(c[E+2].z,j.d?1-D:D),C&&(x.push(C[E+1].r,C[E+1].g,C[E+1].b,C[E+1].a),x.push(C[E+1].r,C[E+1].g,C[E+1].b,C[E+1].a),x.push(C[E+2].r,C[E+2].g,C[E+2].b,C[E+2].a),x.push(C[E+2].r,C[E+2].g,C[E+2].b,C[E+2].a))),b!==E&&(b=E)}const u=1!==l&&W?s+4:s;for(d=0,E=0;E<M;E++){let z=0,a=0,K=0,v=0;for(t=0;t<s;t++)z=d*(u+1)+t,a=(d+1)*(u+1)+t,K=d*(u+1)+(t+1),v=(d+1)*(u+1)+(t+1),Y.push(z,a,K),Y.push(v,K,a);1!==l&&W&&(Y.push(z+2,a+2,K+2),Y.push(v+2,K+2,a+2),Y.push(z+4,a+4,K+4),Y.push(v+4,K+4,a+4)),d=r?d+2:d+1}const U=z=>{const T=z?K/2:m/2;if(0===T)return;let p,M,r;const W=z?c[w-1]:c[0];let F=null;C&&(F=z?C[w-1]:C[0]);const G=I.length/3,V=z?a/2:-a/2,H=new v.o(0,V,0);I.push(H.x,H.y,H.z),q.push(0,z?1:-1,0);const f=W.y+.5*(W.w-W.y);B.push(W.x+.5*(W.z-W.x),j.d?1-f:f),F&&x.push(F.r,F.g,F.b,F.a);const Z=new v.m(.5,.5);for(r=0;r<=s;r++){p=2*Math.PI*r*l/s;const a=Math.cos(-p),K=Math.sin(-p);M=new v.o(a*T,V,K*T);const m=new v.m(a*Z.x+.5,K*Z.y+.5);I.push(M.x,M.y,M.z),q.push(0,z?1:-1,0);const G=W.y+(W.w-W.y)*m.y;B.push(W.x+(W.z-W.x)*m.x,j.d?1-G:G),F&&x.push(F.r,F.g,F.b,F.a)}for(r=0;r<s;r++)z?(Y.push(G),Y.push(G+(r+2)),Y.push(G+(r+1))):(Y.push(G),Y.push(G+(r+1)),Y.push(G+(r+2)))};G!==T.c.CAP_START&&G!==T.c.CAP_ALL||U(!1),G!==T.c.CAP_END&&G!==T.c.CAP_ALL||U(!0),p.b._ComputeSides(V,I,Y,q,B,z.frontUVs,z.backUVs);const R=new p.b;return R.indices=Y,R.xa=I,R.ya=q,R.Aa=B,C&&(R.za=x),R}function Y(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2?arguments[2]:void 0;const v=new T.c(z,K);a.sideOrientation=T.c._GetDefaultSideOrientation(a.sideOrientation),v._originalBuilderSideOrientation=a.sideOrientation;return f(a).Ca(v,a.updatable),v}function I(z){const a=[],K=[],T=[],m=[],s=z.diameter||1,M=z.thickness||.5,r=0|(z.tessellation||16),W=0===z.sideOrientation?0:z.sideOrientation||p.b.DEFAULTSIDE,F=r+1;for(let p=0;p<=r;p++){const z=p/r,W=p*Math.PI*2/r-Math.PI/2,G=v.b.Translation(s/2,0,0).multiply(v.b.RotationY(W));for(let s=0;s<=r;s++){const W=1-s/r,l=s*Math.PI*2/r+Math.PI,V=Math.cos(l),c=Math.sin(l);let C=new v.o(V,c,0),w=C.scale(M/2);const H=new v.m(z,W);w=v.o.TransformCoordinates(w,G),C=v.o.TransformNormal(C,G),K.push(w.x,w.y,w.z),T.push(C.x,C.y,C.z),m.push(H.x,j.d?1-H.y:H.y);const f=(p+1)%F,Y=(s+1)%F;a.push(p*F+s),a.push(p*F+Y),a.push(f*F+s),a.push(p*F+Y),a.push(f*F+Y),a.push(f*F+s)}}p.b._ComputeSides(W,K,a,T,m,z.frontUVs,z.backUVs);const G=new p.b;return G.indices=a,G.xa=K,G.ya=T,G.Aa=m,G}function q(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2?arguments[2]:void 0;const v=new T.c(z,K);a.sideOrientation=T.c._GetDefaultSideOrientation(a.sideOrientation),v._originalBuilderSideOrientation=a.sideOrientation;return I(a).Ca(v,a.updatable),v}p.b.CreateCylinder=f,T.c.CreateCylinder=(z,a,K,v,m,p,j,s,M)=>{void 0!==j&&j instanceof w.c||(void 0!==j&&(M=s||T.c.DEFAULTSIDE,s=j),j=p,p=1);return Y(z,{height:a,diameterTop:K,diameterBottom:v,tessellation:m,subdivisions:p,sideOrientation:M,updatable:s},j)};function B(z){const a=[],K=[],T=[],m=[],s=z.radius||2,M=z.tube||.5,r=z.radialSegments||32,W=z.tubularSegments||32,F=z.p||2,G=z.q||3,l=0===z.sideOrientation?0:z.sideOrientation||p.b.DEFAULTSIDE,V=z=>{const a=Math.cos(z),K=Math.sin(z),T=G/F*z,m=Math.cos(T),p=s*(2+m)*.5*a,j=s*(2+m)*K*.5,M=s*Math.sin(T)*.5;return new v.o(p,j,M)};let c,C;for(c=0;c<=r;c++){const z=c%r/r*2*F*Math.PI,a=V(z),T=V(z+.01),p=T.sc(a);let s=T.add(a);const G=v.o.Cross(p,s);for(s=v.o.Cross(G,p),G.normalize(),s.normalize(),C=0;C<W;C++){const z=C%W/W*2*Math.PI,v=-M*Math.cos(z),T=M*Math.sin(z);K.push(a.x+v*s.x+T*G.x),K.push(a.y+v*s.y+T*G.y),K.push(a.z+v*s.z+T*G.z),m.push(c/r),m.push(j.d?1-C/W:C/W)}}for(c=0;c<r;c++)for(C=0;C<W;C++){const z=(C+1)%W,K=c*W+C,v=(c+1)*W+C,T=(c+1)*W+z,m=c*W+z;a.push(m),a.push(v),a.push(K),a.push(m),a.push(T),a.push(v)}p.b.ComputeNormals(K,a,T),p.b._ComputeSides(l,K,a,T,m,z.frontUVs,z.backUVs);const w=new p.b;return w.indices=a,w.xa=K,w.ya=T,w.Aa=m,w}function x(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2?arguments[2]:void 0;const v=new T.c(z,K);a.sideOrientation=T.c._GetDefaultSideOrientation(a.sideOrientation),v._originalBuilderSideOrientation=a.sideOrientation;return B(a).Ca(v,a.updatable),v}p.b.CreateTorus=I,T.c.CreateTorus=(z,a,K,v,T,m,p)=>q(z,{diameter:a,thickness:K,tessellation:v,sideOrientation:p,updatable:m},T);p.b.CreateTorusKnot=B,T.c.CreateTorusKnot=(z,a,K,v,T,m,p,j,s,M)=>x(z,{radius:a,tube:K,radialSegments:v,tubularSegments:T,p:m,q:p,sideOrientation:M,updatable:s},j);var Z=K(12370),y=K(10648),i=K(11446),n=K(10946),X=K(10680);class P extends v.m{constructor(z,a){super(z.x,z.y),this.index=a}}class J{constructor(){this.elements=[]}add(z){const a=[];return z.forEach((z=>{const K=new P(z,this.elements.length);a.push(K),this.elements.push(K)})),a}computeBounds(){const z=new v.m(this.elements[0].x,this.elements[0].y),a=new v.m(this.elements[0].x,this.elements[0].y);return this.elements.forEach((K=>{K.x<z.x?z.x=K.x:K.x>a.x&&(a.x=K.x),K.y<z.y?z.y=K.y:K.y>a.y&&(a.y=K.y)})),{min:z,max:a,width:a.x-z.x,height:a.y-z.y}}}class o{_addToepoint(z){for(const a of z)this._epoints.push(a.x,a.y)}constructor(z,a,K){let v,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new J,this._outlinepoints=new J,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=T,this._name=z,this._scene=K||X.b.LastCreatedScene,v=a instanceof i.f?a.getPoints():a,this._addToepoint(v),this._points.add(v),this._outlinepoints.add(v),"undefined"===typeof this.bjsEarcut&&y.c.Warn("Earcut was not found, the polygon will not be built.")}addHole(z){this._points.add(z);const a=new J;return a.add(z),this._holes.push(a),this._eholes.push(this._epoints.length/2),this._addToepoint(z),this}build(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const v=new T.c(this._name,this._scene),p=this.buildVertexData(a,K);return v.Ga(m.h.PositionKind,p.xa,z),v.Ga(m.h.NormalKind,p.ya,z),v.Ga(m.h.UVKind,p.Aa,z),v.setIndices(p.indices),v}buildVertexData(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const K=new p.b,v=[],T=[],m=[],j=this._points.computeBounds();this._points.elements.forEach((z=>{v.push(0,1,0),T.push(z.x,0,z.y),m.push((z.x-j.min.x)/j.width,(z.y-j.min.y)/j.height)}));const s=[],M=this.bjsEarcut(this._epoints,this._eholes,2);for(let p=0;p<M.length;p++)s.push(M[p]);if(z>0){const K=T.length/3;this._points.elements.forEach((a=>{v.push(0,-1,0),T.push(a.x,-z,a.y),m.push(1-(a.x-j.min.x)/j.width,1-(a.y-j.min.y)/j.height)}));const p=s.length;for(let z=0;z<p;z+=3){const a=s[z+0],v=s[z+1],T=s[z+2];s.push(T+K),s.push(v+K),s.push(a+K)}this._addSide(T,v,m,s,j,this._outlinepoints,z,!1,a),this._holes.forEach((K=>{this._addSide(T,v,m,s,j,K,z,!0,a)}))}return K.indices=s,K.xa=T,K.ya=v,K.Aa=m,K}_addSide(z,a,K,T,m,p,j,s,M){let r=z.length/3,W=0;for(let F=0;F<p.elements.length;F++){const G=p.elements[F],l=p.elements[(F+1)%p.elements.length];z.push(G.x,0,G.y),z.push(G.x,-j,G.y),z.push(l.x,0,l.y),z.push(l.x,-j,l.y);const V=p.elements[(F+p.elements.length-1)%p.elements.length],c=p.elements[(F+2)%p.elements.length];let C=new v.o(-(l.y-G.y),0,l.x-G.x),w=new v.o(-(G.y-V.y),0,G.x-V.x),H=new v.o(-(c.y-l.y),0,c.x-l.x);s||(C=C.scale(-1),w=w.scale(-1),H=H.scale(-1));const f=C.normalizeToNew();let Y=w.normalizeToNew(),I=H.normalizeToNew();const q=v.o.Dot(Y,f);Y=q>M?q<n.e-1?new v.o(G.x,0,G.y).sc(new v.o(l.x,0,l.y)).normalize():w.add(C).normalize():f;const B=v.o.Dot(H,C);I=B>M?B<n.e-1?new v.o(l.x,0,l.y).sc(new v.o(G.x,0,G.y)).normalize():H.add(C).normalize():f,K.push(W/m.width,0),K.push(W/m.width,1),W+=C.length(),K.push(W/m.width,0),K.push(W/m.width,1),a.push(Y.x,Y.y,Y.z),a.push(Y.x,Y.y,Y.z),a.push(I.x,I.y,I.z),a.push(I.x,I.y,I.z),s?(T.push(r),T.push(r+2),T.push(r+1),T.push(r+1),T.push(r+2),T.push(r+3)):(T.push(r),T.push(r+1),T.push(r+2),T.push(r+1),T.push(r+3),T.push(r+2)),r+=4}}}function N(z,a,K,T,s,M,r){const W=K||new Array(3),G=T,l=[],V=r||!1;for(let m=0;m<3;m++)void 0===W[m]&&(W[m]=new v.r(0,0,1,1)),G&&void 0===G[m]&&(G[m]=new F.d(1,1,1,1));const c=z.getVerticesData(m.h.PositionKind),C=z.getVerticesData(m.h.NormalKind),w=z.getVerticesData(m.h.UVKind),H=z.Rf(),f=c.length/9;let Y=0,I=0,q=0,B=0,x=0;const Z=[0];if(V)for(let v=f;v<c.length/3;v+=4)I=c[3*(v+2)]-c[3*v],q=c[3*(v+2)+2]-c[3*v+2],B=Math.sqrt(I*I+q*q),x+=B,Z.push(x);let y=0,i=0;for(let v=0;v<C.length;v+=3)Math.abs(C[v+1])<.001&&(i=1),Math.abs(C[v+1]-1)<.001&&(i=0),Math.abs(C[v+1]+1)<.001&&(i=2),y=v/3,1===i?(Y=y-f,w[2*y]=Y%4<1.5?V?W[i].x+(W[i].z-W[i].x)*Z[Math.floor(Y/4)]/x:W[i].x:V?W[i].x+(W[i].z-W[i].x)*Z[Math.floor(Y/4)+1]/x:W[i].z,w[2*y+1]=Y%2===0?j.d?1-W[i].w:W[i].w:j.d?1-W[i].y:W[i].y):(w[2*y]=(1-w[2*y])*W[i].x+w[2*y]*W[i].z,w[2*y+1]=(1-w[2*y+1])*W[i].y+w[2*y+1]*W[i].w,j.d&&(w[2*y+1]=1-w[2*y+1])),G&&l.push(G[i].r,G[i].g,G[i].b,G[i].a);p.b._ComputeSides(a,c,H,C,w,s,M);const n=new p.b;if(n.indices=H,n.xa=c,n.ya=C,n.Aa=w,G){const z=a===p.b.DOUBLESIDE?l.concat(l):l;n.za=z}return n}function A(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;a.sideOrientation=T.c._GetDefaultSideOrientation(a.sideOrientation);const p=a.shape,j=a.holes||[],s=a.depth||0,M=a.smoothingThreshold||2,r=[];let W=[];for(let T=0;T<p.length;T++)r[T]=new v.m(p[T].x,p[T].z);r[0].equalsWithEpsilon(r[r.length-1],1e-8)&&r.pop();const F=new o(z,r,K||X.b.LastCreatedScene,m);for(let T=0;T<j.length;T++){W=[];for(let z=0;z<j[T].length;z++)W.push(new v.m(j[T][z].x,j[T][z].z));F.addHole(W)}const G=F.build(!1,s,M);G._originalBuilderSideOrientation=a.sideOrientation;return N(G,a.sideOrientation,a.faceUV,a.faceColors,a.frontUVs,a.backUVs,a.wrap).Ca(G,a.updatable),G}function g(z,a){return A(z,a,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function d(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=a.path,m=a.shape,p=a.scale||1,j=a.rotation||0,s=0===a.cap?0:a.cap||T.c.NO_CAP,M=a.updatable,r=T.c._GetDefaultSideOrientation(a.sideOrientation),W=a.instance||null,F=a.invertUV||!1,G=a.closeShape||!1;return e(z,m,v,p,j,null,null,a.closePath||!1,G,s,!1,K,!!M,r,W,F,a.frontUVs||null,a.backUVs||null,a.firstNormal||null,!!a.adjustFrame)}function t(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=a.path,m=a.shape,p=a.scaleFunction||(()=>1),j=a.rotationFunction||(()=>0),s=a.closePath||a.ribbonCloseArray||!1,M=a.closeShape||a.ribbonClosePath||!1,r=0===a.cap?0:a.cap||T.c.NO_CAP,W=a.updatable,F=a.firstNormal||null,G=a.adjustFrame||!1;return e(z,m,v,null,null,p,j,s,M,r,!0,K,!!W,T.c._GetDefaultSideOrientation(a.sideOrientation),a.instance||null,a.invertUV||!1,a.frontUVs||null,a.backUVs||null,F,G)}function e(z,a,K,m,p,j,s,r,W,F,G,l,V,c,C,w,H,f,Y,I){const q=(z,a,K,m,p,j,s,M,r,W,F)=>{const G=K.getTangents(),l=K.getNormals(),V=K.getBinormals(),c=K.getDistances();if(F)for(let T=0;T<G.length;T++)if(0==G[T].x&&0==G[T].y&&0==G[T].z&&G[T].p(G[T-1]),0==l[T].x&&0==l[T].y&&0==l[T].z&&l[T].p(l[T-1]),0==V[T].x&&0==V[T].y&&0==V[T].z&&V[T].p(V[T-1]),T>0){let z=G[T-1];v.o.Dot(z,G[T])<0&&G[T].scaleInPlace(-1),z=l[T-1],v.o.Dot(z,l[T])<0&&l[T].scaleInPlace(-1),z=V[T-1],v.o.Dot(z,V[T])<0&&V[T].scaleInPlace(-1)}let C=0;const w=W&&M?M:()=>null!==j?j:0,H=W&&s?s:()=>null!==p?p:1;let f=r===T.c.NO_CAP||r===T.c.CAP_END?0:2;const Y=v.j.Matrix[0];for(let T=0;T<a.length;T++){const K=[],p=w(T,c[T]),j=H(T,c[T]);v.b.RotationAxisToRef(G[T],C,Y);for(let m=0;m<z.length;m++){const p=G[T].scale(z[m].z).add(l[T].scale(z[m].x)).add(V[T].scale(z[m].y)),s=v.o.Zero();v.o.TransformCoordinatesToRef(p,Y,s),s.scaleInPlace(j).addInPlace(a[T]),K[m]=s}m[f]=K,C+=p,f++}const I=z=>{const a=Array(),K=v.o.Zero();let T;for(T=0;T<z.length;T++)K.addInPlace(z[T]);for(K.scaleInPlace(1/z.length),T=0;T<z.length;T++)a.push(K);return a};switch(r){case T.c.NO_CAP:break;case T.c.CAP_START:m[0]=I(m[2]),m[1]=m[2];break;case T.c.CAP_END:m[f]=m[f-1],m[f+1]=I(m[f-1]);break;case T.c.CAP_ALL:m[0]=I(m[2]),m[1]=m[2],m[f]=m[f-1],m[f+1]=I(m[f-1])}return m};let B,x;if(C){const z=C._creationDataStorage;return B=Y?z.path3D.update(K,Y):z.path3D.update(K),x=q(a,K,z.path3D,z.pathArray,m,p,j,s,z.cap,G,I),C=M("",{pathArray:x,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:C},l||void 0)}B=Y?new i.h(K,Y):new i.h(K);x=q(a,K,B,new Array,m,p,j,s,F=F<0||F>3?0:F,G,I);const Z=M(z,{pathArray:x,closeArray:r,closePath:W,updatable:V,sideOrientation:c,invertUV:w,frontUVs:H||void 0,backUVs:f||void 0},l);return Z._creationDataStorage.pathArray=x,Z._creationDataStorage.path3D=B,Z._creationDataStorage.cap=F,Z}p.b.CreatePolygon=N,T.c.CreatePolygon=function(z,a,K,v,T,m){return A(z,{shape:a,holes:v,updatable:T,sideOrientation:m},K,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},T.c.ExtrudePolygon=function(z,a,K,v,T,m,p){return g(z,{shape:a,holes:T,depth:K,updatable:m,sideOrientation:p},v,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function L(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=a.arc?a.arc<=0||a.arc>1?1:a.arc:1,p=void 0===a.closed||a.closed,j=a.shape,s=a.radius||1,r=a.tessellation||64,W=a.clip||0,F=a.updatable,G=T.c._GetDefaultSideOrientation(a.sideOrientation),l=a.cap||T.c.NO_CAP,V=2*Math.PI,c=[],C=a.invertUV||!1;let w=0,H=0;const f=V/r*m;let Y,I;for(w=0;w<=r-W;w++){for(I=[],l!=T.c.CAP_START&&l!=T.c.CAP_ALL||(I.push(new v.o(0,j[0].y,0)),I.push(new v.o(Math.cos(w*f)*j[0].x*s,j[0].y,Math.sin(w*f)*j[0].x*s))),H=0;H<j.length;H++)Y=new v.o(Math.cos(w*f)*j[H].x*s,j[H].y,Math.sin(w*f)*j[H].x*s),I.push(Y);l!=T.c.CAP_END&&l!=T.c.CAP_ALL||(I.push(new v.o(Math.cos(w*f)*j[j.length-1].x*s,j[j.length-1].y,Math.sin(w*f)*j[j.length-1].x*s)),I.push(new v.o(0,j[j.length-1].y,0))),c.push(I)}return M(z,{pathArray:c,closeArray:p,sideOrientation:G,updatable:F,invertUV:C,frontUVs:a.frontUVs,backUVs:a.backUVs},K)}T.c.ExtrudeShape=function(z,a,K,v,m,p){let j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7?arguments[7]:void 0,M=arguments.length>8?arguments[8]:void 0,r=arguments.length>9?arguments[9]:void 0;return d(z,{shape:a,path:K,scale:v,rotation:m,cap:0===p?0:p||T.c.NO_CAP,sideOrientation:M,instance:r,updatable:s},j)},T.c.ExtrudeShapeCustom=(z,a,K,v,m,p,j,s,M,r,W,F)=>t(z,{shape:a,path:K,scaleFunction:v,rotationFunction:m,ribbonCloseArray:p,ribbonClosePath:j,cap:0===s?0:s||T.c.NO_CAP,sideOrientation:W,instance:F,updatable:r},M);T.c.CreateLathe=(z,a,K,v,T,m,p)=>L(z,{shape:a,radius:K,tessellation:v,sideOrientation:p,updatable:m},T);var E=K(11326),b=K(11276);function D(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=a.path;let p=a.instance,j=1;void 0!==a.radius?j=a.radius:p&&(j=p._creationDataStorage.radius);const s=a.tessellation||64,r=a.radiusFunction||null;let W=a.cap||T.c.NO_CAP;const F=a.invertUV||!1,G=a.updatable,l=T.c._GetDefaultSideOrientation(a.sideOrientation);a.arc=a.arc&&(a.arc<=0||a.arc>1)?1:a.arc||1;const V=(z,a,K,m,p,j,s,M)=>{const r=a.getTangents(),W=a.getNormals(),F=a.getDistances(),G=2*Math.PI/p*M,l=j||(()=>m);let V,c,C,w;const H=v.j.Matrix[0];let f=s===T.c.NO_CAP||s===T.c.CAP_END?0:2;for(let T=0;T<z.length;T++){c=l(T,F[T]),V=Array(),C=W[T];for(let a=0;a<p;a++)v.b.RotationAxisToRef(r[T],G*a,H),w=V[a]?V[a]:v.o.Zero(),v.o.TransformCoordinatesToRef(C,H,w),w.scaleInPlace(c).addInPlace(z[T]),V[a]=w;K[f]=V,f++}const Y=(a,K)=>{const v=Array();for(let T=0;T<a;T++)v.push(z[K]);return v};switch(s){case T.c.NO_CAP:break;case T.c.CAP_START:K[0]=Y(p,0),K[1]=K[2].slice(0);break;case T.c.CAP_END:K[f]=K[f-1].slice(0),K[f+1]=Y(p,z.length-1);break;case T.c.CAP_ALL:K[0]=Y(p,0),K[1]=K[2].slice(0),K[f]=K[f-1].slice(0),K[f+1]=Y(p,z.length-1)}return K};let c,C;if(p){const z=p._creationDataStorage,K=a.arc||z.arc;return c=z.path3D.update(m),C=V(m,c,z.pathArray,j,z.tessellation,r,z.cap,K),p=M("",{pathArray:C,instance:p}),z.path3D=c,z.pathArray=C,z.arc=K,z.radius=j,p}c=new i.h(m);W=W<0||W>3?0:W,C=V(m,c,new Array,j,s,r,W,a.arc);const w=M(z,{pathArray:C,closePath:!0,closeArray:!1,updatable:G,sideOrientation:l,invertUV:F,frontUVs:a.frontUVs,backUVs:a.backUVs},K);return w._creationDataStorage.pathArray=C,w._creationDataStorage.path3D=c,w._creationDataStorage.tessellation=s,w._creationDataStorage.cap=W,w._creationDataStorage.arc=a.arc,w._creationDataStorage.radius=j,w}function u(z){const a=[];a[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},a[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},a[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},a[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},a[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},a[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},a[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},a[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},a[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},a[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},a[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},a[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},a[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},a[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},a[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const K=z.type&&(z.type<0||z.type>=a.length)?0:z.type||0,T=z.size,m=z.sizeX||T||1,s=z.sizeY||T||1,M=z.sizeZ||T||1,r=z.custom||a[K],W=r.face.length,G=z.faceUV||new Array(W),l=z.faceColors,V=void 0===z.flat||z.flat,c=0===z.sideOrientation?0:z.sideOrientation||p.b.DEFAULTSIDE,C=[],w=[],H=[],f=[],Y=[];let I=0,q=0;const B=[];let x,Z,y,i,n,X,P=0,J=0;if(V)for(J=0;J<W;J++)l&&void 0===l[J]&&(l[J]=new F.d(1,1,1,1)),G&&void 0===G[J]&&(G[J]=new v.r(0,0,1,1));if(V)for(J=0;J<W;J++){const z=r.face[J].length;for(y=2*Math.PI/z,i=.5*Math.tan(y/2),n=.5,P=0;P<z;P++)C.push(r.vertex[r.face[J][P]][0]*m,r.vertex[r.face[J][P]][1]*s,r.vertex[r.face[J][P]][2]*M),B.push(I),I++,x=G[J].x+(G[J].z-G[J].x)*(.5+i),Z=G[J].y+(G[J].w-G[J].y)*(n-.5),f.push(x,j.d?1-Z:Z),X=i*Math.cos(y)-n*Math.sin(y),n=i*Math.sin(y)+n*Math.cos(y),i=X,l&&Y.push(l[J].r,l[J].g,l[J].b,l[J].a);for(P=0;P<z-2;P++)w.push(B[0+q],B[P+2+q],B[P+1+q]);q+=z}else{for(P=0;P<r.vertex.length;P++)C.push(r.vertex[P][0]*m,r.vertex[P][1]*s,r.vertex[P][2]*M),f.push(0,j.d?1:0);for(J=0;J<W;J++)for(P=0;P<r.face[J].length-2;P++)w.push(r.face[J][0],r.face[J][P+2],r.face[J][P+1])}p.b.ComputeNormals(C,w,H),p.b._ComputeSides(c,C,w,H,f,z.frontUVs,z.backUVs);const o=new p.b;return o.xa=C,o.indices=w,o.ya=H,o.Aa=f,l&&V&&(o.za=Y),o}function U(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new T.c(z,K);a.sideOrientation=T.c._GetDefaultSideOrientation(a.sideOrientation),v._originalBuilderSideOrientation=a.sideOrientation;return u(a).Ca(v,a.updatable),v}T.c.CreateTube=(z,a,K,v,T,m,p,j,s,M)=>D(z,{path:a,radius:K,tessellation:v,radiusFunction:T,arc:1,cap:m,updatable:j,sideOrientation:s,instance:M},p);function R(z){const a=z.sideOrientation||p.b.DEFAULTSIDE,K=z.radius||1,T=void 0===z.flat||z.flat,m=0|(z.subdivisions||4),s=z.radiusX||K,M=z.radiusY||K,r=z.radiusZ||K,W=(1+Math.sqrt(5))/2,F=[-1,W,-0,1,W,0,-1,-W,0,1,-W,0,0,-1,-W,0,1,-W,0,-1,W,0,1,W,W,0,1,W,0,-1,-W,0,1,-W,0,-1],G=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],l=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],V=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],c=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],C=[],w=[],H=[],f=[];let Y=0;const I=new Array(3),q=new Array(3);let B;for(B=0;B<3;B++)I[B]=v.o.Zero(),q[B]=v.m.Zero();for(let p=0;p<20;p++){for(B=0;B<3;B++){const z=G[3*p+B];I[B].Xd(F[3*l[z]],F[3*l[z]+1],F[3*l[z]+2]),I[B].normalize(),q[B].Xd(.134765625*V[2*z]+.05859375+-.0390625*c[p],.2333984375*V[2*z+1]+.025390625+.01953125*c[p])}const z=(z,a,K,p)=>{const W=v.o.Lerp(I[0],I[2],a/m),F=v.o.Lerp(I[1],I[2],a/m),G=m===a?I[2]:v.o.Lerp(W,F,z/(m-a));let l;if(G.normalize(),T){const z=v.o.Lerp(I[0],I[2],p/m),a=v.o.Lerp(I[1],I[2],p/m);l=v.o.Lerp(z,a,K/(m-p))}else l=new v.o(G.x,G.y,G.z);l.x/=s,l.y/=M,l.z/=r,l.normalize();const V=v.m.Lerp(q[0],q[2],a/m),c=v.m.Lerp(q[1],q[2],a/m),B=m===a?q[2]:v.m.Lerp(V,c,z/(m-a));w.push(G.x*s,G.y*M,G.z*r),H.push(l.x,l.y,l.z),f.push(B.x,j.d?1-B.y:B.y),C.push(Y),Y++};for(let a=0;a<m;a++)for(let K=0;K+a<m;K++)z(K,a,K+1/3,a+1/3),z(K+1,a,K+1/3,a+1/3),z(K,a+1,K+1/3,a+1/3),K+a+1<m&&(z(K+1,a,K+2/3,a+2/3),z(K+1,a+1,K+2/3,a+2/3),z(K,a+1,K+2/3,a+2/3))}p.b._ComputeSides(a,w,C,H,f,z.frontUVs,z.backUVs);const x=new p.b;return x.indices=C,x.xa=w,x.ya=H,x.Aa=f,x}function k(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new T.c(z,K);a.sideOrientation=T.c._GetDefaultSideOrientation(a.sideOrientation),v._originalBuilderSideOrientation=a.sideOrientation;return R(a).Ca(v,a.updatable),v}p.b.CreatePolyhedron=u,T.c.CreatePolyhedron=(z,a,K)=>U(z,a,K);p.b.CreateIcoSphere=R,T.c.CreateIcoSphere=(z,a,K)=>k(z,a,K);var h=K(10959);const S=new v.o(1,0,0),Q=new v.o(-1,0,0),O=new v.o(0,1,0),zz=new v.o(0,-1,0),az=new v.o(0,0,1),Kz=new v.o(0,0,-1);class vz{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v.o.Zero(),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.o.Up(),K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.m.Zero(),T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=z,this.k=a,this.uv=K,this.vertexIdx=T,this.vertexIdxForBones=m,this.localPositionOverride=p,this.localNormalOverride=j,this.matrixIndicesOverride=s,this.matrixWeightsOverride=M}clone(){var z,a,K,v;return new vz(this.position.clone(),this.k.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(z=this.localPositionOverride)||void 0===z?void 0:z.slice(),null===(a=this.localNormalOverride)||void 0===a?void 0:a.slice(),null===(K=this.matrixIndicesOverride)||void 0===K?void 0:K.slice(),null===(v=this.matrixWeightsOverride)||void 0===v?void 0:v.slice())}}function Tz(z,a,K){var s,M,r,W;const F=!!a.skeleton,G=K.localMode||F,l=a.Rf(),V=F?a.Bd(!0,!0):a.getVerticesData(m.h.PositionKind),c=F?a.getNormalsData(!0,!0):a.getVerticesData(m.h.NormalKind),C=G?F?a.getVerticesData(m.h.PositionKind):V:null,w=G?F?a.getVerticesData(m.h.NormalKind):c:null,H=a.getVerticesData(m.h.UVKind),f=F?a.getVerticesData(m.h.MatricesIndicesKind):null,Y=F?a.getVerticesData(m.h.MatricesWeightsKind):null,I=F?a.getVerticesData(m.h.MatricesIndicesExtraKind):null,q=F?a.getVerticesData(m.h.MatricesWeightsExtraKind):null,B=K.position||v.o.Zero();let x=K.k||v.o.Up();const Z=K.size||v.o.One(),y=K.angle||0;if(!x){const z=new v.o(0,0,1),K=a.va().activeCamera,T=v.o.TransformCoordinates(z,K.getWorldMatrix());x=K.globalPosition.sc(T)}const i=-Math.atan2(x.z,x.x)-Math.PI/2,n=Math.sqrt(x.x*x.x+x.z*x.z),X=Math.atan2(x.y,n),P=new p.b;P.indices=[],P.xa=[],P.ya=[],P.Aa=[],P.matricesIndices=F?[]:null,P.matricesWeights=F?[]:null,P.matricesIndicesExtra=I?[]:null,P.matricesWeightsExtra=q?[]:null;let J=0;const o=(z,a)=>{const T=new vz;if(!l||!V||!c)return T;const m=l[z];if(T.vertexIdx=3*m,T.vertexIdxForBones=4*m,T.position=new v.o(V[3*m],V[3*m+1],V[3*m+2]),v.o.TransformCoordinatesToRef(T.position,a,T.position),T.k=new v.o(c[3*m],c[3*m+1],c[3*m+2]),v.o.TransformNormalToRef(T.k,a,T.k),K.captureUVS&&H){const z=H[2*m+1];T.uv=new v.m(H[2*m],j.d?1-z:z)}return T},N=[0,0,0,0],A=(z,a)=>{if(0===z.length)return z;const K=.5*Math.abs(v.o.Dot(Z,a)),T=(z,a,K,v)=>{for(let T=0;T<v;++T)if(z[K+T]===a)return K+T;return-1},m=(z,m)=>{const p=v.o.GetClipFactor(z.position,m.position,a,K);let j=N,s=N;if(f&&Y){const a=z.matrixIndicesOverride?0:z.vertexIdxForBones,K=z.matrixIndicesOverride??f,v=z.matrixWeightsOverride??Y,M=m.matrixIndicesOverride?0:m.vertexIdxForBones,r=m.matrixIndicesOverride??f,W=m.matrixWeightsOverride??Y;j=[0,0,0,0],s=[0,0,0,0];let F=0;for(let z=0;z<4;++z)if(v[a+z]>0){const m=T(r,K[a+z],M,4);j[F]=K[a+z],s[F]=(0,h.q)(v[a+z],m>=0?W[m]:0,p),F++}for(let z=0;z<4&&F<4;++z){const v=r[M+z];-1===T(K,v,a,4)&&(j[F]=v,s[F]=(0,h.q)(0,W[M+z],p),F++)}const G=s[0]+s[1]+s[2]+s[3];s[0]/=G,s[1]/=G,s[2]/=G,s[3]/=G}const M=z.localPositionOverride?z.localPositionOverride[0]:(null===C||void 0===C?void 0:C[z.vertexIdx])??0,r=z.localPositionOverride?z.localPositionOverride[1]:(null===C||void 0===C?void 0:C[z.vertexIdx+1])??0,W=z.localPositionOverride?z.localPositionOverride[2]:(null===C||void 0===C?void 0:C[z.vertexIdx+2])??0,F=m.localPositionOverride?m.localPositionOverride[0]:(null===C||void 0===C?void 0:C[m.vertexIdx])??0,G=m.localPositionOverride?m.localPositionOverride[1]:(null===C||void 0===C?void 0:C[m.vertexIdx+1])??0,l=m.localPositionOverride?m.localPositionOverride[2]:(null===C||void 0===C?void 0:C[m.vertexIdx+2])??0,V=z.localNormalOverride?z.localNormalOverride[0]:(null===w||void 0===w?void 0:w[z.vertexIdx])??0,c=z.localNormalOverride?z.localNormalOverride[1]:(null===w||void 0===w?void 0:w[z.vertexIdx+1])??0,H=z.localNormalOverride?z.localNormalOverride[2]:(null===w||void 0===w?void 0:w[z.vertexIdx+2])??0,I=V+((m.localNormalOverride?m.localNormalOverride[0]:(null===w||void 0===w?void 0:w[m.vertexIdx])??0)-V)*p,q=c+((m.localNormalOverride?m.localNormalOverride[1]:(null===w||void 0===w?void 0:w[m.vertexIdx+1])??0)-c)*p,B=H+((m.localNormalOverride?m.localNormalOverride[2]:(null===w||void 0===w?void 0:w[m.vertexIdx+2])??0)-H)*p,x=Math.sqrt(I*I+q*q+B*B);return new vz(v.o.Lerp(z.position,m.position,p),v.o.Lerp(z.k,m.k,p).normalize(),v.m.Lerp(z.uv,m.uv,p),-1,-1,C?[M+(F-M)*p,r+(G-r)*p,W+(l-W)*p]:null,w?[I/x,q/x,B/x]:null,j,s)};let p=null;z.length>3&&(p=[]);for(let j=0;j<z.length;j+=3){let T=0,s=null,M=null,r=null,W=null;const F=v.o.Dot(z[j].position,a)-K>0,G=v.o.Dot(z[j+1].position,a)-K>0,l=v.o.Dot(z[j+2].position,a)-K>0;switch(T=(F?1:0)+(G?1:0)+(l?1:0),T){case 0:z.length>3?(p.push(z[j]),p.push(z[j+1]),p.push(z[j+2])):p=z;break;case 1:if(p=p??new Array,F&&(s=z[j+1],M=z[j+2],r=m(z[j],s),W=m(z[j],M)),G){s=z[j],M=z[j+2],r=m(z[j+1],s),W=m(z[j+1],M),p.push(r),p.push(M.clone()),p.push(s.clone()),p.push(M.clone()),p.push(r.clone()),p.push(W);break}l&&(s=z[j],M=z[j+1],r=m(z[j+2],s),W=m(z[j+2],M)),s&&M&&r&&W&&(p.push(s.clone()),p.push(M.clone()),p.push(r),p.push(W),p.push(r.clone()),p.push(M.clone()));break;case 2:p=p??new Array,F||(s=z[j].clone(),M=m(s,z[j+1]),r=m(s,z[j+2]),p.push(s),p.push(M),p.push(r)),G||(s=z[j+1].clone(),M=m(s,z[j+2]),r=m(s,z[j]),p.push(s),p.push(M),p.push(r)),l||(s=z[j+2].clone(),M=m(s,z[j]),r=m(s,z[j+1]),p.push(s),p.push(M),p.push(r))}}return p},g=a instanceof T.c?a:null,d=null===g||void 0===g?void 0:g._thinInstanceDataStorage.matrixData,t=(null===g||void 0===g?void 0:g._b)||1,e=v.j.Matrix[0];e.p(v.b.IdentityReadOnly);for(let T=0;T<t;++T){if(null!==g&&void 0!==g&&g.hasThinInstances&&d){const z=16*T;e.setRowFromFloats(0,d[z+0],d[z+1],d[z+2],d[z+3]),e.setRowFromFloats(1,d[z+4],d[z+5],d[z+6],d[z+7]),e.setRowFromFloats(2,d[z+8],d[z+9],d[z+10],d[z+11]),e.setRowFromFloats(3,d[z+12],d[z+13],d[z+14],d[z+15])}const z=v.b.RotationYawPitchRoll(i,X,y).multiply(v.b.Translation(B.x,B.y,B.z)),m=v.b.Invert(z),p=a.getWorldMatrix(),s=e.multiply(p).multiply(m),M=new Array(3);for(let a=0;a<l.length;a+=3){let z=M;if(z[0]=o(a,s),z[1]=o(a+1,s),z[2]=o(a+2,s),!(K.cullBackFaces&&-z[0].k.z<=0&&-z[1].k.z<=0&&-z[2].k.z<=0)&&(z=A(z,S),z&&(z=A(z,Q),z&&(z=A(z,O),z&&(z=A(z,zz),z&&(z=A(z,az),z&&(z=A(z,Kz),z)))))))for(let a=0;a<z.length;a++){const v=z[a];if(P.indices.push(J),G?(v.localPositionOverride?(P.xa[3*J]=v.localPositionOverride[0],P.xa[3*J+1]=v.localPositionOverride[1],P.xa[3*J+2]=v.localPositionOverride[2]):C&&(P.xa[3*J]=C[v.vertexIdx],P.xa[3*J+1]=C[v.vertexIdx+1],P.xa[3*J+2]=C[v.vertexIdx+2]),v.localNormalOverride?(P.ya[3*J]=v.localNormalOverride[0],P.ya[3*J+1]=v.localNormalOverride[1],P.ya[3*J+2]=v.localNormalOverride[2]):w&&(P.ya[3*J]=w[v.vertexIdx],P.ya[3*J+1]=w[v.vertexIdx+1],P.ya[3*J+2]=w[v.vertexIdx+2])):(v.position.toArray(P.xa,3*J),v.k.toArray(P.ya,3*J)),P.matricesIndices&&P.matricesWeights&&(v.matrixIndicesOverride?(P.matricesIndices[4*J]=v.matrixIndicesOverride[0],P.matricesIndices[4*J+1]=v.matrixIndicesOverride[1],P.matricesIndices[4*J+2]=v.matrixIndicesOverride[2],P.matricesIndices[4*J+3]=v.matrixIndicesOverride[3]):(f&&(P.matricesIndices[4*J]=f[v.vertexIdxForBones],P.matricesIndices[4*J+1]=f[v.vertexIdxForBones+1],P.matricesIndices[4*J+2]=f[v.vertexIdxForBones+2],P.matricesIndices[4*J+3]=f[v.vertexIdxForBones+3]),I&&P.matricesIndicesExtra&&(P.matricesIndicesExtra[4*J]=I[v.vertexIdxForBones],P.matricesIndicesExtra[4*J+1]=I[v.vertexIdxForBones+1],P.matricesIndicesExtra[4*J+2]=I[v.vertexIdxForBones+2],P.matricesIndicesExtra[4*J+3]=I[v.vertexIdxForBones+3])),v.matrixWeightsOverride?(P.matricesWeights[4*J]=v.matrixWeightsOverride[0],P.matricesWeights[4*J+1]=v.matrixWeightsOverride[1],P.matricesWeights[4*J+2]=v.matrixWeightsOverride[2],P.matricesWeights[4*J+3]=v.matrixWeightsOverride[3]):(Y&&(P.matricesWeights[4*J]=Y[v.vertexIdxForBones],P.matricesWeights[4*J+1]=Y[v.vertexIdxForBones+1],P.matricesWeights[4*J+2]=Y[v.vertexIdxForBones+2],P.matricesWeights[4*J+3]=Y[v.vertexIdxForBones+3]),q&&P.matricesWeightsExtra&&(P.matricesWeightsExtra[4*J]=q[v.vertexIdxForBones],P.matricesWeightsExtra[4*J+1]=q[v.vertexIdxForBones+1],P.matricesWeightsExtra[4*J+2]=q[v.vertexIdxForBones+2],P.matricesWeightsExtra[4*J+3]=q[v.vertexIdxForBones+3]))),K.captureUVS)v.uv.toArray(P.Aa,2*J);else{P.Aa.push(.5+v.position.x/Z.x);const z=.5+v.position.y/Z.y;P.Aa.push(j.d?1-z:z)}J++}}}0===P.indices.length&&(P.indices=null),0===P.xa.length&&(P.xa=null),0===P.ya.length&&(P.ya=null),0===P.Aa.length&&(P.Aa=null),0===(null===(s=P.matricesIndices)||void 0===s?void 0:s.length)&&(P.matricesIndices=null),0===(null===(M=P.matricesWeights)||void 0===M?void 0:M.length)&&(P.matricesWeights=null),0===(null===(r=P.matricesIndicesExtra)||void 0===r?void 0:r.length)&&(P.matricesIndicesExtra=null),0===(null===(W=P.matricesWeightsExtra)||void 0===W?void 0:W.length)&&(P.matricesWeightsExtra=null);const L=new T.c(z,a.va());return P.Ca(L),G?(L.skeleton=a.skeleton,L.parent=a):(L.position=B.clone(),L.rotation=new v.o(X,i,y)),L.Qj(!0),L.refreshBoundingInfo(!0,!0),L}function mz(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const a=0|Math.max(z.subdivisions?z.subdivisions:2,1),K=0|Math.max(z.tessellation?z.tessellation:16,3),T=Math.max(z.height?z.height:1,0),m=Math.max(z.radius?z.radius:.25,0),s=0|Math.max(z.capSubdivisions?z.capSubdivisions:6,1),M=K,r=a,W=Math.max(z.radiusTop?z.radiusTop:m,0),F=Math.max(z.radiusBottom?z.radiusBottom:m,0),G=T-(W+F),l=2*Math.PI,V=Math.max(z.topCapSubdivisions?z.topCapSubdivisions:s,1),c=Math.max(z.bottomCapSubdivisions?z.bottomCapSubdivisions:s,1),C=Math.acos((F-W)/T);let w=[];const H=[],f=[],Y=[];let I=0;const q=[],B=.5*G,x=.5*Math.PI;let Z,y;const i=v.o.Zero(),n=v.o.Zero(),X=Math.cos(C),P=Math.sin(C),J=new v.m(W*P,B+W*X).sc(new v.m(F*P,F*X-B)).length(),o=W*C+J+F*(x-C);let N=0;for(y=0;y<=V;y++){const z=[],a=x-C*(y/V);N+=W*C/V;const K=Math.cos(a),v=Math.sin(a),T=K*W;for(Z=0;Z<=M;Z++){const a=Z/M,m=a*l+0,p=Math.sin(m),s=Math.cos(m);n.x=T*p,n.y=B+v*W,n.z=T*s,H.push(n.x,n.y,n.z),i.set(K*p,v,K*s),f.push(i.x,i.y,i.z),Y.push(a,j.d?N/o:1-N/o),z.push(I),I++}q.push(z)}const A=T-W-F+X*W-X*F,g=P*(F-W)/A;for(y=1;y<=r;y++){const z=[];N+=J/r;const a=P*(y*(F-W)/r+W);for(Z=0;Z<=M;Z++){const K=Z/M,v=K*l+0,T=Math.sin(v),m=Math.cos(v);n.x=a*T,n.y=B+X*W-y*A/r,n.z=a*m,H.push(n.x,n.y,n.z),i.set(T,g,m).normalize(),f.push(i.x,i.y,i.z),Y.push(K,j.d?N/o:1-N/o),z.push(I),I++}q.push(z)}for(y=1;y<=c;y++){const z=[],a=x-C-(Math.PI-C)*(y/c);N+=F*C/c;const K=Math.cos(a),v=Math.sin(a),T=K*F;for(Z=0;Z<=M;Z++){const a=Z/M,m=a*l+0,p=Math.sin(m),s=Math.cos(m);n.x=T*p,n.y=v*F-B,n.z=T*s,H.push(n.x,n.y,n.z),i.set(K*p,v,K*s),f.push(i.x,i.y,i.z),Y.push(a,j.d?N/o:1-N/o),z.push(I),I++}q.push(z)}for(Z=0;Z<M;Z++)for(y=0;y<V+r+c;y++){const z=q[y][Z],a=q[y+1][Z],K=q[y+1][Z+1],v=q[y][Z+1];w.push(z),w.push(a),w.push(v),w.push(a),w.push(K),w.push(v)}if(w=w.reverse(),z.orientation&&!z.orientation.equals(v.o.Up())){const a=new v.b;z.orientation.clone().scale(.5*Math.PI).cross(v.o.Up()).toQuaternion().toRotationMatrix(a);const K=v.o.Zero();for(let z=0;z<H.length;z+=3)K.set(H[z],H[z+1],H[z+2]),v.o.TransformCoordinatesToRef(K.clone(),a,K),H[z]=K.x,H[z+1]=K.y,H[z+2]=K.z}const d=new p.b;return d.xa=H,d.ya=f,d.Aa=Y,d.indices=w,d}function pz(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:v.o.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=new T.c(z,K);return mz(a).Ca(m,a.updatable),m}T.c.CreateDecal=(z,a,K,v,T,m)=>Tz(z,a,{position:K,k:v,size:T,angle:m});T.c.CreateCapsule=(z,a,K)=>pz(z,a,K),p.b.CreateCapsule=mz;class jz{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=z,this.y=a,z!==Math.floor(z)&&(z=Math.floor(z),y.c.Warn("x is not an integer, floor(x) used")),a!==Math.floor(a)&&(a=Math.floor(a),y.c.Warn("y is not an integer, floor(y) used"))}clone(){return new jz(this.x,this.y)}rotate60About(z){const a=this.x;return this.x=z.x+z.y-this.y,this.y=a+this.y-z.x,this}rotateNeg60About(z){const a=this.x;return this.x=a+this.y-z.y,this.y=z.x+z.y-a,this}rotate120(z,a){z!==Math.floor(z)&&(z=Math.floor(z),y.c.Warn("m not an integer only floor(m) used")),a!==Math.floor(a)&&(a=Math.floor(a),y.c.Warn("n not an integer only floor(n) used"));const K=this.x;return this.x=z-K-this.y,this.y=a+K,this}rotateNeg120(z,a){z!==Math.floor(z)&&(z=Math.floor(z),y.c.Warn("m is not an integer, floor(m) used")),a!==Math.floor(a)&&(a=Math.floor(a),y.c.Warn("n is not an integer,   floor(n) used"));const K=this.x;return this.x=this.y-a,this.y=z+a-K-this.y,this}toCartesianOrigin(z,a){const K=v.o.Zero();return K.x=z.x+2*this.x*a+this.y*a,K.y=z.y+Math.sqrt(3)*this.y*a,K}static Zero(){return new jz(0,0)}}class sz{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Mz("icosahedron","Regular",[[0,n.i,-1],[-n.i,1,0],[-1,0,-n.i],[1,0,-n.i],[n.i,1,0],[0,n.i,1],[-1,0,n.i],[-n.i,-1,0],[0,-n.i,-1],[n.i,-1,0],[1,0,n.i],[0,-n.i,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let z=12;const a={},K=this.m,v=this.n;let T,m,p,j,s,M=K,r=1,W=0;0!==v&&(M=(0,h.k)(K,v)),r=K/M,W=v/M;const F=jz.Zero(),G=new jz(K,v),l=new jz(-v,K+v),V=jz.Zero(),c=jz.Zero(),C=jz.Zero();let w,H,f,Y,I=[];const q=[],B=this.vertByDist,x=(K,v,T,m)=>{w=K+"|"+T,H=v+"|"+m,w in a||H in a?w in a&&!(H in a)?a[H]=a[w]:H in a&&!(w in a)&&(a[w]=a[H]):(a[w]=z,a[H]=z,z++),B[T][0]>2?q[a[w]]=[-B[T][0],B[T][1],a[w]]:q[a[w]]=[I[B[T][0]],B[T][1],a[w]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let Z=0;Z<20;Z++){if(I=this.IDATA.face[Z],p=I[2],j=I[1],s=I[0],f=F.x+"|"+F.y,w=Z+"|"+f,w in a||(a[w]=p,q[p]=[I[B[f][0]],B[f][1]]),f=G.x+"|"+G.y,w=Z+"|"+f,w in a||(a[w]=j,q[j]=[I[B[f][0]],B[f][1]]),f=l.x+"|"+l.y,w=Z+"|"+f,w in a||(a[w]=s,q[s]=[I[B[f][0]],B[f][1]]),T=this.IDATA.edgematch[Z][0],m=this.IDATA.edgematch[Z][1],"B"===m)for(let z=1;z<M;z++)c.x=K-z*(r+W),c.y=v+z*r,C.x=-z*W,C.y=z*(r+W),f=c.x+"|"+c.y,Y=C.x+"|"+C.y,x(Z,T,f,Y);if("O"===m)for(let z=1;z<M;z++)C.x=-z*W,C.y=z*(r+W),V.x=z*r,V.y=z*W,f=C.x+"|"+C.y,Y=V.x+"|"+V.y,x(Z,T,f,Y);if(T=this.IDATA.edgematch[Z][2],m=this.IDATA.edgematch[Z][3],m&&"A"===m)for(let z=1;z<M;z++)V.x=z*r,V.y=z*W,c.x=K-(M-z)*(r+W),c.y=v+(M-z)*r,f=V.x+"|"+V.y,Y=c.x+"|"+c.y,x(Z,T,f,Y);for(let K=0;K<this.vertices.length;K++)f=this.vertices[K].x+"|"+this.vertices[K].y,w=Z+"|"+f,w in a||(a[w]=z++,B[f][0]>2?q[a[w]]=[-B[f][0],B[f][1],a[w]]:q[a[w]]=[I[B[f][0]],B[f][1],a[w]])}this.closestTo=q,this.vecToidx=a}calcCoeffs(){const z=this.m,a=this.n,K=Math.sqrt(3)/3,v=z*z+a*a+z*a;this.coau=(z+a)/v,this.cobu=-a/v,this.coav=-K*(z-a)/v,this.cobv=K*(2*z+a)/v}createInnerFacets(){const z=this.m,a=this.n;for(let K=0;K<a+z+1;K++)for(let z=this.min[K];z<this.max[K]+1;z++)z<this.max[K]&&z<this.max[K+1]+1&&this.innerFacets.push(["|"+z+"|"+K,"|"+z+"|"+(K+1),"|"+(z+1)+"|"+K]),K>0&&z<this.max[K-1]&&z+1<this.max[K]+1&&this.innerFacets.push(["|"+z+"|"+K,"|"+(z+1)+"|"+K,"|"+(z+1)+"|"+(K-1)])}edgeVecsABOB(){const z=this.m,a=this.n,K=new jz(-a,z+a);for(let v=1;v<z+a;v++){const z=new jz(this.min[v],v),a=new jz(this.min[v-1],v-1),T=new jz(this.min[v+1],v+1),m=z.clone(),p=a.clone(),j=T.clone();m.rotate60About(K),p.rotate60About(K),j.rotate60About(K);const s=new jz(this.max[m.y],m.y),M=new jz(this.max[m.y-1],m.y-1),r=new jz(this.max[m.y-1]-1,m.y-1);m.x===s.x&&m.y===s.y||(m.x!==M.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([z,M,r]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([z,r,s])):m.y===j.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([z,a,M]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([z,M,T])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([z,a,M]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([z,M,s])))}}mapABOBtoOBOA(){const z=new jz(0,0);for(let a=0;a<this.isoVecsABOB.length;a++){const K=[];for(let v=0;v<3;v++)z.x=this.isoVecsABOB[a][v].x,z.y=this.isoVecsABOB[a][v].y,0===this.vertexTypes[a][v]&&z.rotateNeg120(this.m,this.n),K.push(z.clone());this.isoVecsOBOA.push(K)}}mapABOBtoBAOA(){const z=new jz(0,0);for(let a=0;a<this.isoVecsABOB.length;a++){const K=[];for(let v=0;v<3;v++)z.x=this.isoVecsABOB[a][v].x,z.y=this.isoVecsABOB[a][v].y,1===this.vertexTypes[a][v]&&z.rotate120(this.m,this.n),K.push(z.clone());this.isoVecsBAOA.push(K)}}MapToFace(z,a){const K=this.IDATA.face[z],T=K[2],m=K[1],p=K[0],j=v.o.Jg(this.IDATA.vertex[T]),s=v.o.Jg(this.IDATA.vertex[m]),M=v.o.Jg(this.IDATA.vertex[p]),r=s.sc(j),W=M.sc(j),F=r.scale(this.coau).add(W.scale(this.cobu)),G=r.scale(this.coav).add(W.scale(this.cobv)),l=[];let V,c=v.j.gb[0];for(let v=0;v<this.cartesian.length;v++)c=F.scale(this.cartesian[v].x).add(G.scale(this.cartesian[v].y)).add(j),l[v]=[c.x,c.y,c.z],V=z+"|"+this.vertices[v].x+"|"+this.vertices[v].y,a.vertex[this.vecToidx[V]]=[c.x,c.y,c.z]}build(z,a){const K=[],v=jz.Zero(),T=new jz(z,a),m=new jz(-a,z+a);K.push(v,T,m);for(let f=a;f<z+1;f++)for(let a=0;a<z+1-f;a++)K.push(new jz(a,f));if(a>0){const v=(0,h.k)(z,a),T=z/v,m=a/v;for(let j=1;j<v;j++)K.push(new jz(j*T,j*m)),K.push(new jz(-j*m,j*(T+m))),K.push(new jz(z-j*(T+m),a+j*T));const p=z/a;for(let j=1;j<a;j++)for(let v=0;v<j*p;v++)K.push(new jz(v,j)),K.push(new jz(v,j).rotate120(z,a)),K.push(new jz(v,j).rotateNeg120(z,a))}K.sort(((z,a)=>z.x-a.x)),K.sort(((z,a)=>z.y-a.y));const p=new Array(z+a+1),j=new Array(z+a+1);for(let f=0;f<p.length;f++)p[f]=1/0,j[f]=-1/0;let s=0,M=0;const r=K.length;for(let f=0;f<r;f++)M=K[f].x,s=K[f].y,p[s]=Math.min(M,p[s]),j[s]=Math.max(M,j[s]);const W=(K,v)=>{const T=K.clone();return"A"===v&&T.rotateNeg120(z,a),"B"===v&&T.rotate120(z,a),T.x<0?T.y:T.x+T.y},F=[],G=[],l=[],V=[],c={},C=[];let w=-1,H=-1;for(let f=0;f<r;f++)F[f]=K[f].toCartesianOrigin(new jz(0,0),.5),G[f]=W(K[f],"O"),l[f]=W(K[f],"A"),V[f]=W(K[f],"B"),G[f]===l[f]&&l[f]===V[f]?(w=3,H=G[f]):G[f]===l[f]?(w=4,H=G[f]):l[f]===V[f]?(w=5,H=l[f]):V[f]===G[f]&&(w=6,H=G[f]),G[f]<l[f]&&G[f]<V[f]&&(w=2,H=G[f]),l[f]<G[f]&&l[f]<V[f]&&(w=1,H=l[f]),V[f]<l[f]&&V[f]<G[f]&&(w=0,H=V[f]),C.push([w,H,K[f].x,K[f].y]);C.sort(((z,a)=>z[2]-a[2])),C.sort(((z,a)=>z[3]-a[3])),C.sort(((z,a)=>z[1]-a[1])),C.sort(((z,a)=>z[0]-a[0]));for(let f=0;f<C.length;f++)c[C[f][2]+"|"+C[f][3]]=[C[f][0],C[f][1],f];return this.m=z,this.n=a,this.vertices=K,this.vertByDist=c,this.cartesian=F,this.min=p,this.max=j,this}}class Mz{constructor(z,a,K,v){this.name=z,this.category=a,this.vertex=K,this.face=v}}class rz extends Mz{innerToData(z,a){for(let K=0;K<a.innerFacets.length;K++)this.face.push(a.innerFacets[K].map((K=>a.vecToidx[z+K])))}mapABOBtoDATA(z,a){const K=a.IDATA.edgematch[z][0];for(let v=0;v<a.isoVecsABOB.length;v++){const T=[];for(let m=0;m<3;m++)0===a.vertexTypes[v][m]?T.push(z+"|"+a.isoVecsABOB[v][m].x+"|"+a.isoVecsABOB[v][m].y):T.push(K+"|"+a.isoVecsABOB[v][m].x+"|"+a.isoVecsABOB[v][m].y);this.face.push([a.vecToidx[T[0]],a.vecToidx[T[1]],a.vecToidx[T[2]]])}}mapOBOAtoDATA(z,a){const K=a.IDATA.edgematch[z][0];for(let v=0;v<a.isoVecsOBOA.length;v++){const T=[];for(let m=0;m<3;m++)1===a.vertexTypes[v][m]?T.push(z+"|"+a.isoVecsOBOA[v][m].x+"|"+a.isoVecsOBOA[v][m].y):T.push(K+"|"+a.isoVecsOBOA[v][m].x+"|"+a.isoVecsOBOA[v][m].y);this.face.push([a.vecToidx[T[0]],a.vecToidx[T[1]],a.vecToidx[T[2]]])}}mapBAOAtoDATA(z,a){const K=a.IDATA.edgematch[z][2];for(let v=0;v<a.isoVecsBAOA.length;v++){const T=[];for(let m=0;m<3;m++)1===a.vertexTypes[v][m]?T.push(z+"|"+a.isoVecsBAOA[v][m].x+"|"+a.isoVecsBAOA[v][m].y):T.push(K+"|"+a.isoVecsBAOA[v][m].x+"|"+a.isoVecsBAOA[v][m].y);this.face.push([a.vecToidx[T[0]],a.vecToidx[T[1]],a.vecToidx[T[2]]])}}orderData(z){const a=[];for(let m=0;m<13;m++)a[m]=[];const K=z.closestTo;for(let m=0;m<K.length;m++)K[m][0]>-1?K[m][1]>0&&a[K[m][0]].push([m,K[m][1]]):a[12].push([m,K[m][0]]);const v=[];for(let m=0;m<12;m++)v[m]=m;let T=12;for(let m=0;m<12;m++){a[m].sort(((z,a)=>z[1]-a[1]));for(let z=0;z<a[m].length;z++)v[a[m][z][0]]=T++}for(let m=0;m<a[12].length;m++)v[a[12][m][0]]=T++;for(let m=0;m<this.vertex.length;m++)this.vertex[m].push(v[m]);this.vertex.sort(((z,a)=>z[3]-a[3]));for(let m=0;m<this.vertex.length;m++)this.vertex[m].pop();for(let m=0;m<this.face.length;m++)for(let z=0;z<this.face[m].length;z++)this.face[m][z]=v[this.face[m][z]];this.sharedNodes=a[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(z,a){const K=[],v=[];let T=a.pop();v.push(T);let m=this.face[T].indexOf(z);m=(m+2)%3;let p=this.face[T][m];K.push(p);let j=0;for(;a.length>0;)T=a[j],this.face[T].indexOf(p)>-1?(m=(this.face[T].indexOf(p)+1)%3,p=this.face[T][m],K.push(p),v.push(T),a.splice(j,1),j=0):j++;return this.adjacentFaces.push(K),v}toGoldbergPolyhedronData(){const z=new Mz("GeoDual","Goldberg",[],[]);z.name="GD dual";const a=this.vertex.length,K=new Array(a);for(let s=0;s<a;s++)K[s]=[];for(let s=0;s<this.face.length;s++)for(let z=0;z<3;z++)K[this.face[s][z]].push(s);let v=0,T=0,m=0,p=[],j=[];this.adjacentFaces=[];for(let s=0;s<K.length;s++)z.face[s]=this.setOrder(s,K[s].concat([])),K[s].forEach((a=>{v=0,T=0,m=0,p=this.face[a];for(let z=0;z<3;z++)j=this.vertex[p[z]],v+=j[0],T+=j[1],m+=j[2];z.vertex[a]=[v/3,T/3,m/3]}));return z}static BuildGeodesicData(z){const a=new rz("Geodesic-m-n","Geodesic",[[0,n.i,-1],[-n.i,1,0],[-1,0,-n.i],[1,0,-n.i],[n.i,1,0],[0,n.i,1],[-1,0,n.i],[-n.i,-1,0],[0,-n.i,-1],[n.i,-1,0],[1,0,n.i],[0,-n.i,1]],[]);z.setIndices(),z.calcCoeffs(),z.createInnerFacets(),z.edgeVecsABOB(),z.mapABOBtoOBOA(),z.mapABOBtoBAOA();for(let K=0;K<z.IDATA.face.length;K++)z.MapToFace(K,a),a.innerToData(K,z),"B"===z.IDATA.edgematch[K][1]&&a.mapABOBtoDATA(K,z),"O"===z.IDATA.edgematch[K][1]&&a.mapOBOAtoDATA(K,z),"A"===z.IDATA.edgematch[K][3]&&a.mapBAOAtoDATA(K,z);a.orderData(z);return a.vertex=a.vertex.map((function(z){const a=z[0],K=z[1],v=z[2],T=Math.sqrt(a*a+K*K+v*v);return z[0]*=1/T,z[1]*=1/T,z[2]*=1/T,z})),a}}T.c._GoldbergMeshParser=(z,a)=>Wz.Parse(z,a);class Wz extends T.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(z,a){return void 0===a?(z>this.goldbergData.nbUnsharedFaces-1&&(y.c.Warn("Maximum number of unshared faces used"),z=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+z):(z>11&&(y.c.Warn("Last pole used"),z=11),a>this.goldbergData.nbFacesAtPole-1&&(y.c.Warn("Maximum number of faces at a pole used"),a=this.goldbergData.nbFacesAtPole-1),12+z*this.goldbergData.nbFacesAtPole+a)}_changeGoldbergFaceColors(z){for(let K=0;K<z.length;K++){const a=z[K][0],v=z[K][1],T=z[K][2];for(let z=a;z<v+1;z++)this.goldbergData.faceColors[z]=T}const a=[];for(let K=0;K<12;K++)for(let z=0;z<5;z++)a.push(this.goldbergData.faceColors[K].r,this.goldbergData.faceColors[K].g,this.goldbergData.faceColors[K].b,this.goldbergData.faceColors[K].a);for(let K=12;K<this.goldbergData.faceColors.length;K++)for(let z=0;z<6;z++)a.push(this.goldbergData.faceColors[K].r,this.goldbergData.faceColors[K].g,this.goldbergData.faceColors[K].b,this.goldbergData.faceColors[K].a);return a}setGoldbergFaceColors(z){const a=this._changeGoldbergFaceColors(z);this.Ga(m.h.ColorKind,a)}updateGoldbergFaceColors(z){const a=this._changeGoldbergFaceColors(z);this.updateVerticesData(m.h.ColorKind,a)}_changeGoldbergFaceUVs(z){const a=this.getVerticesData(m.h.UVKind);for(let K=0;K<z.length;K++){const v=z[K][0],T=z[K][1],m=z[K][2],p=z[K][3],j=z[K][4],s=[],M=[];let r,W;for(let z=0;z<5;z++)r=m.x+p*Math.cos(j+z*Math.PI/2.5),W=m.y+p*Math.sin(j+z*Math.PI/2.5),r<0&&(r=0),r>1&&(r=1),s.push(r,W);for(let z=0;z<6;z++)r=m.x+p*Math.cos(j+z*Math.PI/3),W=m.y+p*Math.sin(j+z*Math.PI/3),r<0&&(r=0),r>1&&(r=1),M.push(r,W);for(let z=v;z<Math.min(12,T+1);z++)for(let K=0;K<5;K++)a[10*z+2*K]=s[2*K],a[10*z+2*K+1]=s[2*K+1];for(let z=Math.max(12,v);z<T+1;z++)for(let K=0;K<6;K++)a[12*z-24+2*K]=M[2*K],a[12*z-23+2*K]=M[2*K+1]}return a}setGoldbergFaceUVs(z){const a=this._changeGoldbergFaceUVs(z);this.Ga(m.h.UVKind,a)}updateGoldbergFaceUVs(z){const a=this._changeGoldbergFaceUVs(z);this.updateVerticesData(m.h.UVKind,a)}placeOnGoldbergFaceAt(z,a,K){const T=v.o.RotationFromAxis(this.goldbergData.faceXaxis[a],this.goldbergData.faceYaxis[a],this.goldbergData.faceZaxis[a]);z.rotation=T,z.position=this.goldbergData.faceCenters[a].add(this.goldbergData.faceXaxis[a].scale(K.x)).add(this.goldbergData.faceYaxis[a].scale(K.y)).add(this.goldbergData.faceZaxis[a].scale(K.z))}serialize(z){super.serialize(z),z.type="GoldbergMesh";const a={};if(a.adjacentFaces=this.goldbergData.adjacentFaces,a.nbSharedFaces=this.goldbergData.nbSharedFaces,a.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,a.nbFaces=this.goldbergData.nbFaces,a.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){a.faceColors=[];for(const z of this.goldbergData.faceColors)a.faceColors.push(z.kj())}if(this.goldbergData.faceCenters){a.faceCenters=[];for(const z of this.goldbergData.faceCenters)a.faceCenters.push(z.kj())}if(this.goldbergData.faceZaxis){a.faceZaxis=[];for(const z of this.goldbergData.faceZaxis)a.faceZaxis.push(z.kj())}if(this.goldbergData.faceYaxis){a.faceYaxis=[];for(const z of this.goldbergData.faceYaxis)a.faceYaxis.push(z.kj())}if(this.goldbergData.faceXaxis){a.faceXaxis=[];for(const z of this.goldbergData.faceXaxis)a.faceXaxis.push(z.kj())}z.goldbergData=a}static Parse(z,a){const K=z.goldbergData;K.faceColors=K.faceColors.map((z=>F.d.Jg(z))),K.faceCenters=K.faceCenters.map((z=>v.o.Jg(z))),K.faceZaxis=K.faceZaxis.map((z=>v.o.Jg(z))),K.faceXaxis=K.faceXaxis.map((z=>v.o.Jg(z))),K.faceYaxis=K.faceYaxis.map((z=>v.o.Jg(z)));const T=new Wz(z.name,a);return T.goldbergData=K,T}}var Fz=K(11252);class Gz{constructor(z){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=z}moveTo(z,a){this._currentPath=new i.f(z,a),this._tempPaths.push(this._currentPath)}lineTo(z,a){this._currentPath.addLineTo(z,a)}quadraticCurveTo(z,a,K,v){this._currentPath.addQuadraticCurveTo(z,a,K,v,this._resolution)}bezierCurveTo(z,a,K,v,T,m){this._currentPath.addBezierCurveTo(z,a,K,v,T,m,this._resolution)}extractHoles(){for(const z of this._tempPaths)z.area()>0?this._holes.push(z):this._paths.push(z);if(!this._paths.length&&this._holes.length){const z=this._holes;this._holes=this._paths,this._paths=z}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function lz(z,a,K,v,T,m){const p=m.glyphs[z]||m.glyphs["?"];if(!p)return null;const j=new Gz(T);if(p.o){const z=p.o.split(" ");for(let T=0,m=z.length;T<m;){switch(z[T++]){case"m":{const m=parseInt(z[T++])*a+K,p=parseInt(z[T++])*a+v;j.moveTo(m,p);break}case"l":{const m=parseInt(z[T++])*a+K,p=parseInt(z[T++])*a+v;j.lineTo(m,p);break}case"q":{const m=parseInt(z[T++])*a+K,p=parseInt(z[T++])*a+v,s=parseInt(z[T++])*a+K,M=parseInt(z[T++])*a+v;j.quadraticCurveTo(s,M,m,p);break}case"b":{const m=parseInt(z[T++])*a+K,p=parseInt(z[T++])*a+v,s=parseInt(z[T++])*a+K,M=parseInt(z[T++])*a+v,r=parseInt(z[T++])*a+K,W=parseInt(z[T++])*a+v;j.bezierCurveTo(s,M,r,W,m,p);break}}}}return j.extractHoles(),{offsetX:p.ha*a,shapePath:j}}const Vz={CreateBox:W.c,CreateTiledBox:c,CreateSphere:C.b,CreateDisc:r.e,CreateIcoSphere:k,CreateRibbon:M,CreateCylinder:Y,CreateTorus:q,CreateTorusKnot:x,CreateLineSystem:Z.f,ub:Z.j,CreateDashedLines:Z.c,ExtrudeShape:d,ExtrudeShapeCustom:t,CreateLathe:L,CreateTiledPlane:l,Xf:E.b,CreateGround:b.g,CreateTiledGround:b.h,CreateGroundFromHeightMap:b.e,CreatePolygon:A,ExtrudePolygon:g,CreateTube:D,CreatePolyhedron:U,CreateGeodesic:function(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=a.m||1;v!==Math.floor(v)&&(v=Math.floor(v),y.c.Warn("m not an integer only floor(m) used"));let T=a.n||0;if(T!==Math.floor(T)&&(T=Math.floor(T),y.c.Warn("n not an integer only floor(n) used")),T>v){const z=T;T=v,v=z,y.c.Warn("n > m therefore m and n swapped")}const m=new sz;return m.build(v,T),U(z,{custom:rz.BuildGeodesicData(m),size:a.size,sizeX:a.sizeX,sizeY:a.sizeY,sizeZ:a.sizeZ,faceUV:a.faceUV,faceColors:a.faceColors,flat:a.flat,updatable:a.updatable,sideOrientation:a.sideOrientation,frontUVs:a.frontUVs,backUVs:a.backUVs},K)},CreateGoldberg:function(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=a.size,s=a.sizeX||m||1,M=a.sizeY||m||1,r=a.sizeZ||m||1;let W=a.m||1;W!==Math.floor(W)&&(W=Math.floor(W),y.c.Warn("m not an integer only floor(m) used"));let G=a.n||0;if(G!==Math.floor(G)&&(G=Math.floor(G),y.c.Warn("n not an integer only floor(n) used")),G>W){const z=G;G=W,W=z,y.c.Warn("n > m therefore m and n swapped")}const l=new sz;l.build(W,G);const V=rz.BuildGeodesicData(l),c=V.toGoldbergPolyhedronData(),C=new Wz(z,K);a.sideOrientation=T.c._GetDefaultSideOrientation(a.sideOrientation),C._originalBuilderSideOrientation=a.sideOrientation;(function(z,a){const K=z.size,T=z.sizeX||K||1,m=z.sizeY||K||1,s=z.sizeZ||K||1,M=0===z.sideOrientation?0:z.sideOrientation||p.b.DEFAULTSIDE,r=[],W=[],F=[],G=[];let l=1/0,V=-1/0,c=1/0,C=-1/0;for(let v=0;v<a.vertex.length;v++)l=Math.min(l,a.vertex[v][0]*T),V=Math.max(V,a.vertex[v][0]*T),c=Math.min(c,a.vertex[v][1]*m),C=Math.max(C,a.vertex[v][1]*m);let w=0;for(let p=0;p<a.face.length;p++){const z=a.face[p],K=v.o.Jg(a.vertex[z[0]]),M=v.o.Jg(a.vertex[z[2]]),H=v.o.Jg(a.vertex[z[1]]),f=M.sc(K),Y=H.sc(K),I=v.o.Cross(Y,f).normalize();for(let v=0;v<z.length;v++){F.push(I.x,I.y,I.z);const K=a.vertex[z[v]];r.push(K[0]*T,K[1]*m,K[2]*s);const p=(K[1]*m-c)/(C-c);G.push((K[0]*T-l)/(V-l),j.d?1-p:p)}for(let a=0;a<z.length-2;a++)W.push(w,w+a+2,w+a+1);w+=z.length}p.b._ComputeSides(M,r,W,F,G);const H=new p.b;return H.xa=r,H.indices=W,H.ya=F,H.Aa=G,H})(a,c).Ca(C,a.updatable),C.goldbergData.nbSharedFaces=V.sharedNodes,C.goldbergData.nbUnsharedFaces=V.poleNodes,C.goldbergData.adjacentFaces=V.adjacentFaces,C.goldbergData.nbFaces=C.goldbergData.nbSharedFaces+C.goldbergData.nbUnsharedFaces,C.goldbergData.nbFacesAtPole=(C.goldbergData.nbUnsharedFaces-12)/12;for(let T=0;T<V.vertex.length;T++)C.goldbergData.faceCenters.push(v.o.Jg(V.vertex[T])),C.goldbergData.faceCenters[T].x*=s,C.goldbergData.faceCenters[T].y*=M,C.goldbergData.faceCenters[T].z*=r,C.goldbergData.faceColors.push(new F.d(1,1,1,1));for(let T=0;T<c.face.length;T++){const z=c.face[T],a=v.o.Jg(c.vertex[z[0]]),K=v.o.Jg(c.vertex[z[2]]),m=v.o.Jg(c.vertex[z[1]]),p=K.sc(a),j=m.sc(a),s=v.o.Cross(j,p).normalize(),M=v.o.Cross(j,s).normalize();C.goldbergData.faceXaxis.push(j.normalize()),C.goldbergData.faceYaxis.push(s),C.goldbergData.faceZaxis.push(M)}return C},CreateDecal:Tz,CreateCapsule:pz,CreateText:function(z,a,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const s=function(z,a,K,v){const T=Array.from(z),m=a/v.resolution,p=(v.boundingBox.yMax-v.boundingBox.yMin+v.underlineThickness)*m,j=[];let s=0,M=0;for(let r=0;r<T.length;r++){const z=T[r];if("\n"===z)s=0,M-=p;else{const a=lz(z,m,s,M,K,v);a&&(s+=a.offsetX,j.push(a.shapePath))}}return j}(a,m.size||50,m.resolution||8,K),M=[];let r=0;for(const l of s){if(!l.paths.length)continue;const a=l.holes.slice();for(const K of l.paths){var W,F;const s=[],G=[],l=K.getPoints();for(const z of l)G.push(new v.o(z.x,0,z.y));const V=a.slice();for(const z of V){const T=z.getPoints();let m=!1;for(const z of T)if(K.isPointInside(z)){m=!0;break}if(!m)continue;const p=[];for(const z of T)p.push(new v.o(z.x,0,z.y));s.push(p),a.splice(a.indexOf(z),1)}if(!s.length&&a.length)for(const z of a){const a=z.getPoints(),K=[];for(const z of a)K.push(new v.o(z.x,0,z.y));s.push(K)}const c=g(z,{shape:G,holes:s.length?s:void 0,depth:m.depth||1,faceUV:m.faceUV||(null===(W=m.perLetterFaceUV)||void 0===W?void 0:W.call(m,r)),faceColors:m.faceColors||(null===(F=m.perLetterFaceColors)||void 0===F?void 0:F.call(m,r)),sideOrientation:T.c._GetDefaultSideOrientation(m.sideOrientation||T.c.DOUBLESIDE)},p,j);M.push(c),r++}}const G=T.c.MergeMeshes(M,!0,!0);if(G){const a=G.getBoundingInfo().boundingBox;G.position.x+=-(a.minimumWorld.x+a.maximumWorld.x)/2,G.position.y+=-(a.minimumWorld.y+a.maximumWorld.y)/2,G.position.z+=-(a.minimumWorld.z+a.maximumWorld.z)/2+a.extendSize.z,G.name=z;const K=new Fz.d("pivot",p);K.rotation.x=-Math.PI/2,G.parent=K,G.bakeCurrentTransformIntoVertices(),G.parent=null,K.dispose()}return G}}},11066:(z,a,K)=>{"use strict";K.d(a,{e:()=>s});var v=K(11001),T=K(11068),m=K(11077),p=K(11099),j=K(11107);class s{get materialDefines(){var z;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(z=this._getDrawWrapper())||void 0===z?void 0:z.defines}set materialDefines(z){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=z}_getDrawWrapper(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];z=z??this._engine.currentRenderPassId;let K=this._drawWrappers[z];return!K&&a&&(this._drawWrappers[z]=K=new j.e(this._mesh.va().getEngine())),K}_removeDrawWrapper(z){var a;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(a=this._drawWrappers[z])||void 0===a||a.dispose());this._drawWrappers[z]=void 0}get effect(){var z;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(z=this._getDrawWrapper())||void 0===z?void 0:z.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(z){this._mainDrawWrapperOverride=z}setEffect(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2?arguments[2]:void 0,v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const T=this._drawWrapper;T.setEffect(z,a,v),void 0!==K&&(T.materialContext=K),z||(T.defines=null,T.materialContext=void 0)}resetDrawCache(z){if(this._drawWrappers){if(void 0!==z)return void this._removeDrawWrapper(z);for(const z of this._drawWrappers)null===z||void 0===z||z.dispose()}this._drawWrappers=[]}static AddToMesh(z,a,K,v,T,m,p){return new s(z,a,K,v,T,m,p,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(z,a,K,v,T,m,p){let j=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],s=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=z,this.verticesStart=a,this.verticesCount=K,this.indexStart=v,this.indexCount=T,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=m,this._renderingMesh=p||m,s&&m.Vf.push(this),this._engine=this._mesh.va().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=m.Vf.length-1,j&&(this.refreshBoundingInfo(),m.Qj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(z){return this._boundingInfo=z,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const z=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return z||this._renderingMesh}Ha(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const a=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!a)return z?this._mesh.va().defaultMaterial:null;if(this._isMultiMaterial(a)){const z=a.getSubMaterial(this.materialIndex);return this._currentMaterial!==z&&(this._currentMaterial=z,this.resetDrawCache()),z}return a}_isMultiMaterial(z){return void 0!==z.getSubMaterial}refreshBoundingInfo(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Fj)return this;if(z||(z=this._renderingMesh.getVerticesData(v.h.PositionKind)),!z)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const a=this._renderingMesh.Rf();let K;if(0===this.indexStart&&this.indexCount===a.length){const z=this._renderingMesh.getBoundingInfo();K={minimum:z.minimum.clone(),maximum:z.maximum.clone()}}else K=(0,p.e)(z,a,this.indexStart,this.indexCount,this._renderingMesh.Fj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(K.minimum,K.maximum):this._boundingInfo=new m.e(K.minimum,K.maximum),this}_checkCollision(z){return this.getBoundingInfo()._checkCollision(z)}updateBoundingInfo(z){let a=this.getBoundingInfo();return a||(this.refreshBoundingInfo(),a=this.getBoundingInfo()),a&&a.update(z),this}isInFrustum(z){const a=this.getBoundingInfo();return!!a&&a.isInFrustum(z,this._mesh.Fi)}isCompletelyInFrustum(z){const a=this.getBoundingInfo();return!!a&&a.isCompletelyInFrustum(z)}render(z){return this._renderingMesh.render(this,z,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(z,a){if(!this._linesIndexBuffer){const K=[];for(let a=this.indexStart;a<this.indexStart+this.indexCount;a+=3)K.push(z[a],z[a+1],z[a+1],z[a+2],z[a+2],z[a]);this._linesIndexBuffer=a.createIndexBuffer(K),this._linesIndexCount=K.length}return this._linesIndexBuffer}canIntersects(z){const a=this.getBoundingInfo();return!!a&&z.intersectsBox(a.boundingBox)}intersects(z,a,K,v,T){const m=this.Ha();if(!m)return null;let p=3,j=!1;switch(m.fillMode){case 3:case 5:case 6:case 8:return null;case 7:p=1,j=!0}return 4===m.fillMode?K.length?this._intersectLines(z,a,K,this._mesh.intersectionThreshold,v):this._intersectUnIndexedLines(z,a,K,this._mesh.intersectionThreshold,v):!K.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(z,a,K,v,T):this._intersectTriangles(z,a,K,p,j,v,T)}_intersectLines(z,a,K,v,m){let p=null;for(let j=this.indexStart;j<this.indexStart+this.indexCount;j+=2){const s=a[K[j]],M=a[K[j+1]],r=z.intersectionSegment(s,M,v);if(!(r<0)&&((m||!p||r<p.distance)&&(p=new T.c(null,null,r),p.faceId=j/2,m)))break}return p}_intersectUnIndexedLines(z,a,K,v,m){let p=null;for(let j=this.verticesStart;j<this.verticesStart+this.verticesCount;j+=2){const K=a[j],s=a[j+1],M=z.intersectionSegment(K,s,v);if(!(M<0)&&((m||!p||M<p.distance)&&(p=new T.c(null,null,M),p.faceId=j/2,m)))break}return p}_intersectTriangles(z,a,K,v,T,m,p){let j=null,s=-1;for(let M=this.indexStart;M<this.indexStart+this.indexCount-(3-v);M+=v){s++;const v=K[M],r=K[M+1],W=K[M+2];if(T&&4294967295===W){M+=2;continue}const F=a[v],G=a[r],l=a[W];if(!F||!G||!l)continue;if(p&&!p(F,G,l,z,v,r,W))continue;const V=z.intersectsTriangle(F,G,l);if(V){if(V.distance<0)continue;if((m||!j||V.distance<j.distance)&&(j=V,j.faceId=s,m))break}}return j}_intersectUnIndexedTriangles(z,a,K,v,T){let m=null;for(let p=this.verticesStart;p<this.verticesStart+this.verticesCount;p+=3){const K=a[p],j=a[p+1],s=a[p+2];if(T&&!T(K,j,s,z,-1,-1,-1))continue;const M=z.intersectsTriangle(K,j,s);if(M){if(M.distance<0)continue;if((v||!m||M.distance<m.distance)&&(m=M,m.faceId=p/3,v))break}}return m}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(z,a){const K=new s(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,z,a,!1);if(!this.IsGlobal){const z=this.getBoundingInfo();if(!z)return K;K._boundingInfo=new m.e(z.minimum,z.maximum)}return K}dispose(){this._linesIndexBuffer&&(this._mesh.va().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const z=this._mesh.Vf.indexOf(this);this._mesh.Vf.splice(z,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(z,a,K,v,T){let m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],p=Number.MAX_VALUE,j=-Number.MAX_VALUE;const M=(T||v).Rf();for(let s=a;s<a+K;s++){const z=M[s];z<p&&(p=z),z>j&&(j=z)}return new s(z,p,j-p+1,a,K,v,T,m)}}},11984:(z,a,K)=>{"use strict";var v=K(11194),T=K(11001),m=K(10941),p=K(10648),j=K(11077);v.c.prototype.thinInstanceAdd=function(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return p.c.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(z)?z.length:1);const K=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(z))for(let v=0;v<z.length;++v)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,z[v],v===z.length-1&&a);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,z,a);return K},v.c.prototype.thinInstanceAddSelf=function(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(m.b.IdentityReadOnly,z)},v.c.prototype.thinInstanceRegisterAttribute=function(z,a){z===T.h.ColorKind&&(z=T.h.ColorInstanceKind),this.removeVerticesData(z),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[z]=a,this._userThinInstanceBuffersStorage.sizes[z]=a*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[z]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[z]),this._userThinInstanceBuffersStorage.vertexBuffers[z]=new T.h(this.getEngine(),this._userThinInstanceBuffersStorage.data[z],z,!0,!1,a,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[z])},v.c.prototype.thinInstanceSetMatrixAt=function(z,a){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||z>=this._thinInstanceDataStorage.instancesCount)return!1;const v=this._thinInstanceDataStorage.matrixData;return a.copyToArray(v,16*z),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[z]=a),K&&(this.dc("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},v.c.prototype.thinInstanceSetAttributeAt=function(z,a,K){let v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return z===T.h.ColorKind&&(z=T.h.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[z]||a>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(z,0),this._userThinInstanceBuffersStorage.data[z].set(K,a*this._userThinInstanceBuffersStorage.strides[z]),v&&this.dc(z),!0)},Object.defineProperty(v.c.prototype,"_b",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(z){var a;const K=this._thinInstanceDataStorage.matrixData??(null===(a=this.source)||void 0===a?void 0:a._thinInstanceDataStorage.matrixData);z<=(K?K.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=z)},enumerable:!0,configurable:!0}),v.c.prototype._thinInstanceCreateMatrixBuffer=function(z,a){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const v=new T.e(this.getEngine(),a,!K,16,!1,!0);for(let T=0;T<4;T++)this.setVerticesBuffer(v.createVertexBuffer(z+T,4*T,4));return v},v.c.prototype.Yb=function(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var m;if(K=K||16,"matrix"===z)null===(m=this._thinInstanceDataStorage.matrixBuffer)||void 0===m||m.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=a?a.length:32*K,this._thinInstanceDataStorage.matrixData=a,this._thinInstanceDataStorage.worldMatrices=null,null!==a?(this._thinInstanceDataStorage.instancesCount=a.length/K,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",a,v),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===z){var p;null===(p=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===p||p.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=a,null!==a&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",a,v))}else{var j;if(z===T.h.ColorKind&&(z=T.h.ColorInstanceKind),null===a)null!==(j=this._userThinInstanceBuffersStorage)&&void 0!==j&&j.data[z]&&(this.removeVerticesData(z),delete this._userThinInstanceBuffersStorage.data[z],delete this._userThinInstanceBuffersStorage.strides[z],delete this._userThinInstanceBuffersStorage.sizes[z],delete this._userThinInstanceBuffersStorage.vertexBuffers[z]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[z]=a,this._userThinInstanceBuffersStorage.strides[z]=K,this._userThinInstanceBuffersStorage.sizes[z]=a.length,this._userThinInstanceBuffersStorage.vertexBuffers[z]=new T.h(this.getEngine(),a,z,!v,!1,K,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[z])}},v.c.prototype.dc=function(z){var a;if("matrix"===z)this.Oj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(z),null===(a=this._thinInstanceDataStorage.matrixBuffer)||void 0===a||a.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===z){var K;this.Oj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(z),null===(K=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===K||K.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var v;z===T.h.ColorKind&&(z=T.h.ColorInstanceKind),null!==(v=this._userThinInstanceBuffersStorage)&&void 0!==v&&v.vertexBuffers[z]&&(this.Oj&&!this._userThinInstanceBuffersStorage.vertexBuffers[z].isUpdatable()&&this._thinInstanceRecreateBuffer(z),this._userThinInstanceBuffersStorage.vertexBuffers[z].updateDirectly(this._userThinInstanceBuffersStorage.data[z],0))}},v.c.prototype.thinInstancePartialBufferUpdate=function(z,a,K){var v;"matrix"===z?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(a,K):(z===T.h.ColorKind&&(z=T.h.ColorInstanceKind),null!==(v=this._userThinInstanceBuffersStorage)&&void 0!==v&&v.vertexBuffers[z]&&this._userThinInstanceBuffersStorage.vertexBuffers[z].updateDirectly(a,K))},v.c.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const z=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let a=0;a<this._thinInstanceDataStorage.instancesCount;++a)this._thinInstanceDataStorage.worldMatrices[a]=m.b.Jg(z,16*a)}return this._thinInstanceDataStorage.worldMatrices},v.c.prototype.thinInstanceRefreshBoundingInfo=function(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const v=this._thinInstanceDataStorage.boundingVectors;if(z||!this.rawBoundingInfo){v.length=0,this.refreshBoundingInfo(a,K);const z=this.getBoundingInfo();this.rawBoundingInfo=new j.e(z.minimum,z.maximum)}const T=this.getBoundingInfo(),p=this._thinInstanceDataStorage.matrixData;if(0===v.length)for(let m=0;m<T.boundingBox.vectors.length;++m)v.push(T.boundingBox.vectors[m].clone());m.j.gb[0].Vd(Number.POSITIVE_INFINITY),m.j.gb[1].Vd(Number.NEGATIVE_INFINITY);for(let j=0;j<this._thinInstanceDataStorage.instancesCount;++j){m.b.FromArrayToRef(p,16*j,m.j.Matrix[0]);for(let z=0;z<v.length;++z)m.o.TransformCoordinatesToRef(v[z],m.j.Matrix[0],m.j.gb[2]),m.j.gb[0].minimizeInPlace(m.j.gb[2]),m.j.gb[1].maximizeInPlace(m.j.gb[2])}T.reConstruct(m.j.gb[0],m.j.gb[1]),this.Ea()},v.c.prototype._thinInstanceRecreateBuffer=function(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var K;if("matrix"===z)null===(K=this._thinInstanceDataStorage.matrixBuffer)||void 0===K||K.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,a);else if("previousMatrix"===z){var v;if(this._scene.needsPreviousWorldMatrices)null===(v=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===v||v.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,a)}else{var m;z===T.h.ColorKind&&(z=T.h.ColorInstanceKind),null===(m=this._userThinInstanceBuffersStorage.vertexBuffers[z])||void 0===m||m.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[z]=new T.h(this.getEngine(),this._userThinInstanceBuffersStorage.data[z],z,!a,!1,this._userThinInstanceBuffersStorage.strides[z],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[z])}},v.c.prototype._thinInstanceUpdateBufferSize=function(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;z===T.h.ColorKind&&(z=T.h.ColorInstanceKind);const K="matrix"===z;if(!K&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[z]))return;const v=K?16:this._userThinInstanceBuffersStorage.strides[z],m=K?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[z];let p=K?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[z];const j=(this._thinInstanceDataStorage.instancesCount+a)*v;let s=m;for(;s<j;)s*=2;if(!p||m!=s){if(p){const z=new Float32Array(s);z.set(p,0),p=z}else p=new Float32Array(s);var M,r,W;if(K){if(null===(M=this._thinInstanceDataStorage.matrixBuffer)||void 0===M||M.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",p,!1),this._thinInstanceDataStorage.matrixData=p,this._thinInstanceDataStorage.matrixBufferSize=s,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(r=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===r||r.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",p,!1)}else null===(W=this._userThinInstanceBuffersStorage.vertexBuffers[z])||void 0===W||W.dispose(),this._userThinInstanceBuffersStorage.data[z]=p,this._userThinInstanceBuffersStorage.sizes[z]=s,this._userThinInstanceBuffersStorage.vertexBuffers[z]=new T.h(this.getEngine(),p,z,!0,!1,v,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[z])}},v.c.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},v.c.prototype._disposeThinInstanceSpecificData=function(){var z;null!==(z=this._thinInstanceDataStorage)&&void 0!==z&&z.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11252:(z,a,K)=>{"use strict";K.d(a,{d:()=>W});var v=K(10923),T=K(10927),m=K(10973),p=K(10638),j=K(10941),s=K(11215),M=K(10767);const r=j.b.Compose(j.o.One(),j.f.FromEulerAngles(0,Math.PI,0),j.o.Zero());class W extends s.c{get billboardMode(){return this._billboardMode}set billboardMode(z){this._billboardMode!==z&&(this._billboardMode=z,this._cache.useBillboardPosition=0!==(this._billboardMode&W.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(z){z!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=z,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==W.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(z){this._infiniteDistance!==z&&(this._infiniteDistance=z)}constructor(z){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new j.o(0,0,1),this._up=new j.o(0,1,0),this._right=new j.o(1,0,0),this._position=j.o.Zero(),this._rotation=j.o.Zero(),this._rotationQuaternion=null,this._scaling=j.o.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=W.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Sj=j.b.Zero(),this._usePivotMatrix=!1,this._absolutePosition=j.o.Zero(),this._absoluteScaling=j.o.Zero(),this._absoluteRotationQuaternion=j.f.Identity(),this._pivotMatrix=j.b.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new p.c,this._nonUniformScaling=!1,a&&this.va().addTransformNode(this)}getClassName(){return"xb"}get position(){return this._position}set position(z){this._position=z,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(z){this._rotation=z,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Yd(){return this._scaling}set Yd(z){this._scaling=z,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(z){this._rotationQuaternion=z,z&&this._rotation.Vd(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return j.o.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return j.o.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return j.o.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(z){return this._poseMatrix?(this._poseMatrix.p(z),this):(this._poseMatrix=z.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=j.b.Identity()),this._poseMatrix}_isSynchronized(){const z=this._cache;return this._billboardMode===z.billboardMode&&this._billboardMode===W.BILLBOARDMODE_NONE&&(!z.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const z=this._cache;z.localMatrixUpdated=!1,z.billboardMode=-1,z.infiniteDistance=!1,z.useBillboardPosition=!1,z.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(z){return this.setPivotMatrix(z,!1)}setPivotMatrix(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(z),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=a,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=j.b.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1?arguments[1]:void 0,K=arguments.length>2?arguments[2]:void 0;const v=this.clone("Clone of "+(this.name||this.id),z||this.parent,!0);v&&K&&K(this,v);for(const T of this.getChildTransformNodes(!0))T.instantiateHierarchy(v,a,K);return v}wc(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return z?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Vd(0),this._rotationQuaternion=this._rotationQuaternion||j.f.Identity(),z.decompose(this._scaling,this._rotationQuaternion,this._position),this.Qj(!0)):(this._worldMatrix=z,this._absolutePosition.Xd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Qj(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Qj(!0),this}get rj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Qj(),this._absolutePosition}setAbsolutePosition(z){if(!z)return this;let a,K,v;if(void 0===z.x){if(arguments.length<3)return this;a=arguments[0],K=arguments[1],v=arguments[2]}else a=z.x,K=z.y,v=z.z;if(this.parent){const z=j.j.Matrix[0];this.parent.getWorldMatrix().invertToRef(z),j.o.TransformCoordinatesFromFloatsToRef(a,K,v,z,this.position)}else this.position.x=a,this.position.y=K,this.position.z=v;return this._absolutePosition.p(z),this}setPositionWithLocalVector(z){return this.Qj(),this.position=j.o.TransformNormal(z,this.Sj),this}getPositionExpressedInLocalSpace(){this.Qj();const z=j.j.Matrix[0];return this.Sj.invertToRef(z),j.o.TransformNormal(this.position,z)}locallyTranslate(z){return this.Qj(!0),this.position=j.o.TransformCoordinates(z,this.Sj),this}lookAt(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const m=W._LookAtVectorCache,p=0===T?this.position:this.getAbsolutePosition();if(z.subtractToRef(p,m),this.setDirection(m,a,K,v),1===T&&this.parent)if(this.rotationQuaternion){const z=j.j.Matrix[0];this.rotationQuaternion.toRotationMatrix(z);const a=j.j.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(a),a.invert(),z.multiplyToRef(a,z),this.rotationQuaternion.fromRotationMatrix(z)}else{const z=j.j.Quaternion[0];j.f.FromEulerVectorToRef(this.rotation,z);const a=j.j.Matrix[0];z.toRotationMatrix(a);const K=j.j.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(K),K.invert(),a.multiplyToRef(K,a),z.fromRotationMatrix(a),z.toEulerAnglesToRef(this.rotation)}return this}Re(z){const a=j.o.Zero();return this.getDirectionToRef(z,a),a}getDirectionToRef(z,a){return j.o.TransformNormalToRef(z,this.getWorldMatrix(),a),this}setDirection(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const T=-Math.atan2(z.z,z.x)+Math.PI/2,m=Math.sqrt(z.x*z.x+z.z*z.z),p=-Math.atan2(z.y,m);return this.rotationQuaternion?j.f.RotationYawPitchRollToRef(T+a,p+K,v,this.rotationQuaternion):(this.rotation.x=p+K,this.rotation.y=T+a,this.rotation.z=v),this}setPivotPoint(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Qj(!0);const K=this.getWorldMatrix();if(1==a){const a=j.j.Matrix[0];K.invertToRef(a),z=j.o.TransformCoordinates(z,a)}return this.setPivotMatrix(j.b.Translation(-z.x,-z.y,-z.z),!0)}getPivotPoint(){const z=j.o.Zero();return this.getPivotPointToRef(z),z}getPivotPointToRef(z){return z.x=-this._pivotMatrix.m[12],z.y=-this._pivotMatrix.m[13],z.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const z=j.o.Zero();return this.getAbsolutePivotPointToRef(z),z}getAbsolutePivotPointToRef(z){return this.getPivotPointToRef(z),j.o.TransformCoordinatesToRef(z,this.getWorldMatrix(),z),this}zg(z){if(this._isDirty)return this;if(this._children)for(const a of this._children)a.zg(z);return super.zg(z)}setParent(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!z&&!this.parent)return this;const v=j.j.Quaternion[0],T=j.j.gb[0],m=j.j.gb[1],p=j.j.Matrix[1];j.b.IdentityToRef(p);const s=j.j.Matrix[0];this.Qj(!0);let M=this.rotationQuaternion;return M||(M=W._TmpRotation,j.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,M)),j.b.ComposeToRef(this.Yd,M,this.position,s),this.parent&&s.multiplyToRef(this.parent.Qj(!0),s),z&&(z.Qj(!0).invertToRef(p),s.multiplyToRef(p,s)),s.decompose(m,v,T,a?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(v):v.toEulerAnglesToRef(this.rotation),this.Yd.p(m),this.position.p(T),this.parent=z,K&&this.setPivotMatrix(j.b.Identity()),this}addChild(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return z.setParent(this,a),this}removeChild(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return z.setParent(null,a),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(z){return this._nonUniformScaling!==z&&(this._nonUniformScaling=z,!0)}attachToBone(z,a){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=a,this.parent=z,z.getSkeleton().prepare(!0),z.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=z?this._currentParentWhenAttachingToBone:null,this):(z&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(z,a,K){let v;if(z.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Vd(0)),K&&0!==K){if(this.parent){const K=this.parent.getWorldMatrix(),v=j.j.Matrix[0];K.invertToRef(v),z=j.o.TransformNormal(z,v),K.determinant()<0&&(a*=-1)}v=j.f.RotationAxisToRef(z,a,W._RotationAxisCache),v.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else v=j.f.RotationAxisToRef(z,a,W._RotationAxisCache),this.rotationQuaternion.multiplyToRef(v,this.rotationQuaternion);return this}rotateAround(z,a,K){a.normalize(),this.rotationQuaternion||(this.rotationQuaternion=j.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Vd(0));const v=j.j.gb[0],T=j.j.gb[1],m=j.j.gb[2],p=j.j.Quaternion[0],s=j.j.Matrix[0],M=j.j.Matrix[1],r=j.j.Matrix[2],W=j.j.Matrix[3];return z.subtractToRef(this.position,v),j.b.TranslationToRef(v.x,v.y,v.z,s),j.b.TranslationToRef(-v.x,-v.y,-v.z,M),j.b.RotationAxisToRef(a,K,r),M.multiplyToRef(r,W),W.multiplyToRef(s,W),W.decompose(T,p,m),this.position.addInPlace(m),p.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(z,a,K){const v=z.scale(a);if(K&&0!==K)this.setAbsolutePosition(this.getAbsolutePosition().add(v));else{const z=this.getPositionExpressedInLocalSpace().add(v);this.setPositionWithLocalVector(z)}return this}addRotation(z,a,K){let v;this.rotationQuaternion?v=this.rotationQuaternion:(v=j.j.Quaternion[1],j.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,v));const T=j.j.Quaternion[0];return j.f.RotationYawPitchRollToRef(a,z,K,T),v.multiplyInPlace(T),this.rotationQuaternion||v.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==W.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Qj(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const K=this.va().getRenderId();if(!this._isDirty&&!z&&(this._currentRenderId===K||this.isSynchronized()))return this._currentRenderId=K,this._worldMatrix;a=a||this.va().activeCamera,this._updateCache();const v=this._cache;v.pivotMatrixUpdated=!1,v.billboardMode=this.billboardMode,v.infiniteDistance=this.infiniteDistance,v.parent=this._parentNode,this._currentRenderId=K,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const T=this._getEffectiveParent(),m=W._TmpScaling;let p,s=this._position;if(this._infiniteDistance&&!this.parent&&a){const z=a.getWorldMatrix(),K=new j.o(z.m[12],z.m[13],z.m[14]);s=W._TmpTranslation,s.Xd(this._position.x+K.x,this._position.y+K.y,this._position.z+K.z)}if(m.Xd(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,p=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(j.f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Xd(0,0,0))}}else p=W._TmpRotation,j.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,p);if(this._usePivotMatrix){const z=j.j.Matrix[1];j.b.ScalingToRef(m.x,m.y,m.z,z);const a=j.j.Matrix[0];p.toRotationMatrix(a),this._pivotMatrix.multiplyToRef(z,j.j.Matrix[4]),j.j.Matrix[4].multiplyToRef(a,this.Sj),this._postMultiplyPivotMatrix&&this.Sj.multiplyToRef(this._pivotMatrixInverse,this.Sj),this.Sj.addTranslationFromFloats(s.x,s.y,s.z)}else j.b.ComposeToRef(m,p,s,this.Sj);if(T&&T.getWorldMatrix){if(z&&T.Qj(z),v.useBillboardPath){if(this._transformToBoneReferal){const z=this.parent;z.getSkeleton().prepare(),z.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),j.j.Matrix[7])}else j.j.Matrix[7].p(T.getWorldMatrix());const z=j.j.gb[5],a=j.j.gb[6],K=j.j.Quaternion[0];j.j.Matrix[7].decompose(a,K,z),j.b.ScalingToRef(a.x,a.y,a.z,j.j.Matrix[7]),j.j.Matrix[7].setTranslation(z),W.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(K,z),this.Sj.setTranslation(z)),this.Sj.multiplyToRef(j.j.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const z=this.parent;z.getSkeleton().prepare(),this.Sj.multiplyToRef(z.getFinalMatrix(),j.j.Matrix[6]),j.j.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Sj.multiplyToRef(T.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Sj);if(v.useBillboardPath&&a&&this.billboardMode&&!v.useBillboardPosition){const z=j.j.gb[0];if(this._worldMatrix.getTranslationToRef(z),j.j.Matrix[1].p(a.getViewMatrix()),this._scene.useRightHandedSystem&&j.j.Matrix[1].multiplyToRef(r,j.j.Matrix[1]),j.j.Matrix[1].setTranslationFromFloats(0,0,0),j.j.Matrix[1].invertToRef(j.j.Matrix[0]),(this.billboardMode&W.BILLBOARDMODE_ALL)!==W.BILLBOARDMODE_ALL){j.j.Matrix[0].decompose(void 0,j.j.Quaternion[0],void 0);const z=j.j.gb[1];j.j.Quaternion[0].toEulerAnglesToRef(z),(this.billboardMode&W.BILLBOARDMODE_X)!==W.BILLBOARDMODE_X&&(z.x=0),(this.billboardMode&W.BILLBOARDMODE_Y)!==W.BILLBOARDMODE_Y&&(z.y=0),(this.billboardMode&W.BILLBOARDMODE_Z)!==W.BILLBOARDMODE_Z&&(z.z=0),j.b.RotationYawPitchRollToRef(z.y,z.x,z.z,j.j.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(j.j.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(j.j.gb[0])}else if(v.useBillboardPath&&a&&v.useBillboardPosition){const z=j.j.gb[0];this._worldMatrix.getTranslationToRef(z);const K=a.globalPosition;this._worldMatrix.invertToRef(j.j.Matrix[1]);const v=j.j.gb[1];j.o.TransformCoordinatesToRef(K,j.j.Matrix[1],v),v.normalize();const T=-Math.atan2(v.z,v.x)+Math.PI/2,m=Math.sqrt(v.x*v.x+v.z*v.z),p=-Math.atan2(v.y,m);if(j.f.RotationYawPitchRollToRef(T,p,0,j.j.Quaternion[0]),(this.billboardMode&W.BILLBOARDMODE_ALL)!==W.BILLBOARDMODE_ALL){const z=j.j.gb[1];j.j.Quaternion[0].toEulerAnglesToRef(z),(this.billboardMode&W.BILLBOARDMODE_X)!==W.BILLBOARDMODE_X&&(z.x=0),(this.billboardMode&W.BILLBOARDMODE_Y)!==W.BILLBOARDMODE_Y&&(z.y=0),(this.billboardMode&W.BILLBOARDMODE_Z)!==W.BILLBOARDMODE_Z&&(z.z=0),j.b.RotationYawPitchRollToRef(z.y,z.x,z.z,j.j.Matrix[0])}else j.b.FromQuaternionToRef(j.j.Quaternion[0],j.j.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(j.j.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(j.j.gb[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):T&&T._nonUniformScaling?this._updateNonUniformScalingState(T._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Xd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=j.b.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Qj(),z){const z=this.getChildren();for(let a=0;a<z.length;++a){const K=z[a];if(K){K.Qj();const z=j.j.Matrix[0];K.Sj.multiplyToRef(this.Sj,z);const a=j.j.Quaternion[0];z.decompose(K.Yd,a,K.position),K.rotationQuaternion?K.rotationQuaternion.p(a):a.toEulerAnglesToRef(K.rotation)}}}this.Yd.Xd(1,1,1),this.position.Xd(0,0,0),this.rotation.Xd(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=j.f.Identity()),this._worldMatrix=j.b.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(z){return this.onAfterWorldMatrixUpdateObservable.add(z),this}unregisterAfterWorldMatrixUpdate(z){return this.onAfterWorldMatrixUpdateObservable.removeCallback(z),this}getPositionInCameraSpace(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return z||(z=this.va().activeCamera),j.o.TransformCoordinates(this.getAbsolutePosition(),z.getViewMatrix())}getDistanceToCamera(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return z||(z=this.va().activeCamera),this.getAbsolutePosition().sc(z.globalPosition).length()}clone(z,a,K){const v=m.e.Clone((()=>new W(z,this.va())),this);if(v.name=z,v.id=z,a&&(v.parent=a),!K){const a=this.getDescendants(!0);for(let K=0;K<a.length;K++){const T=a[K];T.clone&&T.clone(z+"."+T.name,v)}}return v}serialize(z){const a=m.e.Serialize(this,z);return a.type=this.getClassName(),a.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(a),a.localMatrix=this.getPivotMatrix().kj(),a.isEnabled=this.isEnabled(),m.e.AppendSerializedAnimations(this,a),a.ranges=this.serializeAnimationRanges(),a}static Parse(z,a,K){const v=m.e.Parse((()=>new W(z.name,a)),z,a,K);if(z.localMatrix?v.setPreTransformMatrix(j.b.Jg(z.localMatrix)):z.pivotMatrix&&v.setPivotMatrix(j.b.Jg(z.pivotMatrix)),v.Nb(z.isEnabled),v._waitingParsedUniqueId=z.uniqueId,void 0!==z.parentId&&(v._waitingParentId=z.parentId),void 0!==z.parentInstanceIndex&&(v._waitingParentInstanceIndex=z.parentInstanceIndex),z.animations){for(let a=0;a<z.animations.length;a++){const K=z.animations[a],T=(0,M.c)("BABYLON.Animation");T&&v.animations.push(T.Parse(K))}s.c.ParseAnimationRanges(v,z,a)}return z.autoAnimate&&a.beginAnimation(v,z.autoAnimateFrom,z.autoAnimateTo,z.autoAnimateLoop,z.autoAnimateSpeed||1),v}getChildTransformNodes(z,a){const K=[];return this._getDescendants(K,z,(z=>(!a||a(z))&&z instanceof W)),K}dispose(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const z=this._parentContainer.transformNodes.indexOf(this);z>-1&&this._parentContainer.transformNodes.splice(z,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),z){const z=this.getChildTransformNodes(!0);for(const a of z)a.parent=null,a.Qj(!0)}super.dispose(z,a)}normalizeToUnitCube(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2?arguments[2]:void 0,v=null,T=null;a&&(this.rotationQuaternion?(T=this.rotationQuaternion.clone(),this.rotationQuaternion.Xd(0,0,0,1)):this.rotation&&(v=this.rotation.clone(),this.rotation.Xd(0,0,0)));const m=this.getHierarchyBoundingVectors(z,K),p=m.max.sc(m.min),j=Math.max(p.x,p.y,p.z);if(0===j)return this;const s=1/j;return this.Yd.scaleInPlace(s),a&&(this.rotationQuaternion&&T?this.rotationQuaternion.p(T):this.rotation&&v&&this.rotation.p(v)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}W.BILLBOARDMODE_NONE=0,W.BILLBOARDMODE_X=1,W.BILLBOARDMODE_Y=2,W.BILLBOARDMODE_Z=4,W.BILLBOARDMODE_ALL=7,W.BILLBOARDMODE_USE_POSITION=128,W.BillboardUseParentOrientation=!1,W._TmpRotation=j.f.Zero(),W._TmpScaling=j.o.Zero(),W._TmpTranslation=j.o.Zero(),W._LookAtVectorCache=new j.o(0,0,0),W._RotationAxisCache=new j.f,(0,v.e)([(0,T.B)("position")],W.prototype,"_position",void 0),(0,v.e)([(0,T.B)("rotation")],W.prototype,"_rotation",void 0),(0,v.e)([(0,T.t)("rotationQuaternion")],W.prototype,"_rotationQuaternion",void 0),(0,v.e)([(0,T.B)("Yd")],W.prototype,"_scaling",void 0),(0,v.e)([(0,T.D)("billboardMode")],W.prototype,"_billboardMode",void 0),(0,v.e)([(0,T.D)()],W.prototype,"scalingDeterminant",void 0),(0,v.e)([(0,T.D)("infiniteDistance")],W.prototype,"_infiniteDistance",void 0),(0,v.e)([(0,T.D)()],W.prototype,"ignoreNonUniformScaling",void 0),(0,v.e)([(0,T.D)()],W.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11460:(z,a,K)=>{"use strict";K.d(a,{e:()=>M});var v=K(10941),T=K(10959),m=K(11435),p=K(10946),j=K(10971);class s{constructor(z,a,K,v){this.name=z,this.worldAxisForNormal=a,this.worldAxisForFileX=K,this.worldAxisForFileY=v}}class M{static ConvertCubeMapTextureToSphericalPolynomial(z){var a;if(!z.isCube)return null;null===(a=z.va())||void 0===a||a.getEngine().flushFramebuffer();const K=z.getSize().width,v=z.readPixels(0,void 0,void 0,!1),T=z.readPixels(1,void 0,void 0,!1);let m,p;z.isRenderTarget?(m=z.readPixels(3,void 0,void 0,!1),p=z.readPixels(2,void 0,void 0,!1)):(m=z.readPixels(2,void 0,void 0,!1),p=z.readPixels(3,void 0,void 0,!1));const j=z.readPixels(4,void 0,void 0,!1),s=z.readPixels(5,void 0,void 0,!1),M=z.gammaSpace;let r=0;return 1!=z.textureType&&2!=z.textureType||(r=1),new Promise((z=>{Promise.all([T,v,m,p,j,s]).then((a=>{let[v,T,m,p,j,s]=a;const W={size:K,right:T,left:v,up:m,down:p,front:j,back:s,format:5,type:r,gammaSpace:M};z(this.ConvertCubeMapToSphericalPolynomial(W))}))}))}static _AreaElement(z,a){return Math.atan2(z*a,Math.sqrt(z*z+a*a+1))}static ConvertCubeMapToSphericalPolynomial(z){const a=new m.e;let K=0;const v=2/z.size,s=v,M=.5*v,r=M-1;for(let m=0;m<6;m++){const W=this._FileFaces[m],F=z[W.name];let G=r;const l=5===z.format?4:3;for(let m=0;m<z.size;m++){let V=r;for(let s=0;s<z.size;s++){const r=W.worldAxisForFileX.scale(V).add(W.worldAxisForFileY.scale(G)).add(W.worldAxisForNormal);r.normalize();const c=this._AreaElement(V-M,G-M)-this._AreaElement(V-M,G+M)-this._AreaElement(V+M,G-M)+this._AreaElement(V+M,G+M);let C=F[m*z.size*l+s*l+0],w=F[m*z.size*l+s*l+1],H=F[m*z.size*l+s*l+2];isNaN(C)&&(C=0),isNaN(w)&&(w=0),isNaN(H)&&(H=0),0===z.type&&(C/=255,w/=255,H/=255),z.gammaSpace&&(C=Math.pow((0,T.e)(C),p.p),w=Math.pow((0,T.e)(w),p.p),H=Math.pow((0,T.e)(H),p.p));const f=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const z=Math.max(C,w,H);if(z>f){const a=f/z;C*=a,w*=a,H*=a}}else C=(0,T.e)(C,0,f),w=(0,T.e)(w,0,f),H=(0,T.e)(H,0,f);const Y=new j.c(C,w,H);a.addLight(r,Y,c),K+=c,V+=v}G+=s}}const W=6*(4*Math.PI)/6/K;return a.scaleInPlace(W),a.convertIncidentRadianceToIrradiance(),a.convertIrradianceToLambertianRadiance(),m.f.FromHarmonics(a)}}M._FileFaces=[new s("right",new v.o(1,0,0),new v.o(0,0,-1),new v.o(0,-1,0)),new s("left",new v.o(-1,0,0),new v.o(0,0,1),new v.o(0,-1,0)),new s("up",new v.o(0,1,0),new v.o(1,0,0),new v.o(0,0,1)),new s("down",new v.o(0,-1,0),new v.o(1,0,0),new v.o(0,0,-1)),new s("front",new v.o(0,0,1),new v.o(1,0,0),new v.o(0,-1,0)),new s("back",new v.o(0,0,-1),new v.o(-1,0,0),new v.o(0,-1,0))],M.MAX_HDRI_VALUE=4096,M.PRESERVE_CLAMPED_COLORS=!1},10951:(z,a,K)=>{"use strict";function v(z,a){const K=[];for(let v=0;v<z;++v)K.push(a());return K}function T(z,a){return v(z,a)}K.d(a,{d:()=>v,g:()=>T,j:()=>p});const m=["push","splice","pop","shift","unshift"];function p(z,a){const K=m.map((K=>function(z,a,K){const v=z[a];if("function"!==typeof v)return null;const T=function(){const v=z.length,m=T.previous.apply(z,arguments);return K(a,v),m};return v.next=T,T.previous=v,z[a]=T,()=>{const K=T.previous;if(!K)return;const v=T.next;v?(K.next=v,v.previous=K):(K.next=void 0,z[a]=K),T.next=void 0,T.previous=void 0}}(z,K,a)));return()=>{K.forEach((z=>{null===z||void 0===z||z()}))}}},11911:(z,a,K)=>{"use strict";K.d(a,{b:()=>p});var v=K(11134),T=K(11917);let m=0;const p=z=>{if(!z.environmentBRDFTexture){const a=z.useDelayedTextureLoading;z.useDelayedTextureLoading=!1;const K=z._blockEntityCollection;z._blockEntityCollection=!1;const p=v.d.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+m++,z,!0,!1,v.d.BILINEAR_SAMPLINGMODE);z._blockEntityCollection=K;const j=z.getEngine().getLoadedTexturesCache(),s=j.indexOf(p.getInternalTexture());-1!==s&&j.splice(s,1),p.isRGBD=!0,p.wrapU=v.d.CLAMP_ADDRESSMODE,p.wrapV=v.d.CLAMP_ADDRESSMODE,z.environmentBRDFTexture=p,z.useDelayedTextureLoading=a,T.c.ExpandRGBDTexture(p);const M=z.getEngine().onContextRestoredObservable.add((()=>{p.isRGBD=!0;const a=z.onBeforeRenderObservable.add((()=>{p.isReady()&&(z.onBeforeRenderObservable.remove(a),T.c.ExpandRGBDTexture(p))}))}));z.lj.add((()=>{z.getEngine().onContextRestoredObservable.remove(M)}))}return z.environmentBRDFTexture}},11202:(z,a,K)=>{"use strict";function v(z,a,K){try{const v=z.next();v.done?a(v):v.value?v.value.then((()=>{v.value=void 0,a(v)}),K):a(v)}catch(v){K(v)}}function T(){let z,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(K,T,m)=>{const p=performance.now();void 0===z||p-z>a?(z=p,setTimeout((()=>{v(K,T,m)}),0)):v(K,T,m)}}function m(z,a,K,v,T){const m=()=>{let p;const j=z=>{z.done?K(z.value):void 0===p?p=!0:m()};do{p=void 0,T&&T.aborted?v(new Error("Aborted")):a(z,j,v),void 0===p&&(p=!1)}while(p)};m()}function p(z,a){let K;return m(z,v,(z=>K=z),(z=>{throw z}),a),K}function j(z,a,K){return new Promise(((v,T)=>{m(z,a,v,T,K)}))}function s(z,a){return function(){return p(z(...arguments),a)}}K.d(a,{c:()=>T,d:()=>s,f:()=>j,j:()=>p})},11455:(z,a,K)=>{"use strict";K.d(a,{e:()=>l});var v=K(10959),T=K(10648),m=K(11460),p=K(11468);K(11495);const j=131072,s=131072;function M(z){return z.charCodeAt(0)+(z.charCodeAt(1)<<8)+(z.charCodeAt(2)<<16)+(z.charCodeAt(3)<<24)}const r=M("DXT1"),W=M("DXT3"),F=M("DXT5"),G=M("DX10");class l{static GetDDSInfo(z){const a=new Int32Array(z.buffer,z.byteOffset,31),K=new Int32Array(z.buffer,z.byteOffset,35);let v=1;a[2]&j&&(v=Math.max(1,a[7]));const T=a[21],m=T===G?K[32]:0;let p=0;switch(T){case 113:p=2;break;case 116:p=1;break;case G:if(10===m){p=2;break}if(2===m){p=1;break}}return{width:a[4],height:a[3],mipmapCount:v,isFourCC:4===(4&a[20]),isRGB:64===(64&a[20]),isLuminance:(a[20]&s)===s,isCube:512===(512&a[28]),isCompressed:T===r||T===W||T===F,dxgiFormat:m,textureType:p}}static _GetHalfFloatAsFloatRGBAArrayBuffer(z,a,K,v,T,m){const j=new Float32Array(v),s=new Uint16Array(T,K);let M=0;for(let r=0;r<a;r++)for(let a=0;a<z;a++){const K=4*(a+r*z);j[M]=(0,p.f)(s[K]),j[M+1]=(0,p.f)(s[K+1]),j[M+2]=(0,p.f)(s[K+2]),l.StoreLODInAlphaChannel?j[M+3]=m:j[M+3]=(0,p.f)(s[K+3]),M+=4}return j}static _GetHalfFloatRGBAArrayBuffer(z,a,K,v,T,m){if(l.StoreLODInAlphaChannel){const j=new Uint16Array(v),s=new Uint16Array(T,K);let M=0;for(let K=0;K<a;K++)for(let a=0;a<z;a++){const v=4*(a+K*z);j[M]=s[v],j[M+1]=s[v+1],j[M+2]=s[v+2],j[M+3]=(0,p.h)(m),M+=4}return j}return new Uint16Array(T,K,v)}static _GetFloatRGBAArrayBuffer(z,a,K,v,T,m){if(l.StoreLODInAlphaChannel){const p=new Float32Array(v),j=new Float32Array(T,K);let s=0;for(let K=0;K<a;K++)for(let a=0;a<z;a++){const v=4*(a+K*z);p[s]=j[v],p[s+1]=j[v+1],p[s+2]=j[v+2],p[s+3]=m,s+=4}return p}return new Float32Array(T,K,v)}static _GetFloatAsHalfFloatRGBAArrayBuffer(z,a,K,v,T,m){const j=new Uint16Array(v),s=new Float32Array(T,K);let M=0;for(let r=0;r<a;r++)for(let a=0;a<z;a++)j[M]=(0,p.h)(s[M]),j[M+1]=(0,p.h)(s[M+1]),j[M+2]=(0,p.h)(s[M+2]),l.StoreLODInAlphaChannel?j[M+3]=(0,p.h)(m):j[M+3]=(0,p.h)(s[M+3]),M+=4;return j}static _GetFloatAsUIntRGBAArrayBuffer(z,a,K,T,m,p){const j=new Uint8Array(T),s=new Float32Array(m,K);let M=0;for(let r=0;r<a;r++)for(let a=0;a<z;a++){const K=4*(a+r*z);j[M]=255*(0,v.e)(s[K]),j[M+1]=255*(0,v.e)(s[K+1]),j[M+2]=255*(0,v.e)(s[K+2]),l.StoreLODInAlphaChannel?j[M+3]=p:j[M+3]=255*(0,v.e)(s[K+3]),M+=4}return j}static _GetHalfFloatAsUIntRGBAArrayBuffer(z,a,K,T,m,j){const s=new Uint8Array(T),M=new Uint16Array(m,K);let r=0;for(let W=0;W<a;W++)for(let a=0;a<z;a++){const K=4*(a+W*z);s[r]=255*(0,v.e)((0,p.f)(M[K])),s[r+1]=255*(0,v.e)((0,p.f)(M[K+1])),s[r+2]=255*(0,v.e)((0,p.f)(M[K+2])),l.StoreLODInAlphaChannel?s[r+3]=j:s[r+3]=255*(0,v.e)((0,p.f)(M[K+3])),r+=4}return s}static _GetRGBAArrayBuffer(z,a,K,v,T,m,p,j,s){const M=new Uint8Array(v),r=new Uint8Array(T,K);let W=0;for(let F=0;F<a;F++)for(let a=0;a<z;a++){const K=4*(a+F*z);M[W]=r[K+m],M[W+1]=r[K+p],M[W+2]=r[K+j],M[W+3]=r[K+s],W+=4}return M}static _ExtractLongWordOrder(z){return 0===z||255===z||-16777216===z?0:1+l._ExtractLongWordOrder(z>>8)}static _GetRGBArrayBuffer(z,a,K,v,T,m,p,j){const s=new Uint8Array(v),M=new Uint8Array(T,K);let r=0;for(let W=0;W<a;W++)for(let a=0;a<z;a++){const K=3*(a+W*z);s[r]=M[K+m],s[r+1]=M[K+p],s[r+2]=M[K+j],r+=3}return s}static _GetLuminanceArrayBuffer(z,a,K,v,T){const m=new Uint8Array(v),p=new Uint8Array(T,K);let j=0;for(let s=0;s<a;s++)for(let a=0;a<z;a++){const K=a+s*z;m[j]=p[K],j++}return m}static UploadDDSLevels(z,a,K,v,p,s){let M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,V=arguments.length>7?arguments[7]:void 0,c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],C=null;v.sphericalPolynomial&&(C=[]);const w=!!z.getCaps().s3tc;a.generateMipMaps=p;const H=new Int32Array(K.buffer,K.byteOffset,31);let f,Y,I,q,B,x,Z,y=0,i=0,n=1;if(542327876!==H[0])return void T.c.Error("Invalid magic number in DDS header");if(!v.isFourCC&&!v.isRGB&&!v.isLuminance)return void T.c.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(v.isCompressed&&!w)return void T.c.Error("Compressed textures are not supported on this platform.");let X=H[22];q=H[1]+4;let P=!1;if(v.isFourCC)switch(f=H[21],f){case r:n=8,i=33777;break;case W:n=16,i=33778;break;case F:n=16,i=33779;break;case 113:P=!0,X=64;break;case 116:P=!0,X=128;break;case G:{q+=20;let z=!1;switch(v.dxgiFormat){case 10:P=!0,X=64,z=!0;break;case 2:P=!0,X=128,z=!0;break;case 88:v.isRGB=!0,v.isFourCC=!1,X=32,z=!0}if(z)break}default:return void T.c.Error(["Unsupported FourCC code:",(J=f,String.fromCharCode(255&J,J>>8&255,J>>16&255,J>>24&255))])}var J;const o=l._ExtractLongWordOrder(H[23]),N=l._ExtractLongWordOrder(H[24]),A=l._ExtractLongWordOrder(H[25]),g=l._ExtractLongWordOrder(H[26]);P&&(i=z._getRGBABufferInternalSizedFormat(v.textureType)),x=1,H[2]&j&&!1!==p&&(x=Math.max(1,H[7]));const d=V||0,t=z.getCaps();for(let T=d;T<s;T++){for(Y=H[4],I=H[3],Z=0;Z<x;++Z){if(-1===M||M===Z){const m=-1===M?Z:0;if(!v.isCompressed&&v.isFourCC){a.format=5,y=Y*I*4;let v=null;if(z._badOS||z._badDesktopOS||!t.textureHalfFloat&&!t.textureFloat)128===X?(v=l._GetFloatAsUIntRGBAArrayBuffer(Y,I,K.byteOffset+q,y,K.buffer,m),C&&0==m&&C.push(l._GetFloatRGBAArrayBuffer(Y,I,K.byteOffset+q,y,K.buffer,m))):64===X&&(v=l._GetHalfFloatAsUIntRGBAArrayBuffer(Y,I,K.byteOffset+q,y,K.buffer,m),C&&0==m&&C.push(l._GetHalfFloatAsFloatRGBAArrayBuffer(Y,I,K.byteOffset+q,y,K.buffer,m))),a.type=0;else{const z=t.textureFloat&&(c&&t.textureFloatLinearFiltering||!c),T=t.textureHalfFloat&&(c&&t.textureHalfFloatLinearFiltering||!c),p=(128===X||64===X&&!T)&&z?1:(64===X||128===X&&!z)&&T?2:0;let j,s=null;if(128===X)switch(p){case 1:j=l._GetFloatRGBAArrayBuffer,s=null;break;case 2:j=l._GetFloatAsHalfFloatRGBAArrayBuffer,s=l._GetFloatRGBAArrayBuffer;break;case 0:j=l._GetFloatAsUIntRGBAArrayBuffer,s=l._GetFloatRGBAArrayBuffer}else switch(p){case 1:j=l._GetHalfFloatAsFloatRGBAArrayBuffer,s=null;break;case 2:j=l._GetHalfFloatRGBAArrayBuffer,s=l._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:j=l._GetHalfFloatAsUIntRGBAArrayBuffer,s=l._GetHalfFloatAsFloatRGBAArrayBuffer}a.type=p,v=j(Y,I,K.byteOffset+q,y,K.buffer,m),C&&0==m&&C.push(s?s(Y,I,K.byteOffset+q,y,K.buffer,m):v)}v&&z._uploadDataToTextureDirectly(a,v,T,m)}else if(v.isRGB)a.type=0,24===X?(a.format=4,y=Y*I*3,B=l._GetRGBArrayBuffer(Y,I,K.byteOffset+q,y,K.buffer,o,N,A),z._uploadDataToTextureDirectly(a,B,T,m)):(a.format=5,y=Y*I*4,B=l._GetRGBAArrayBuffer(Y,I,K.byteOffset+q,y,K.buffer,o,N,A,g),z._uploadDataToTextureDirectly(a,B,T,m));else if(v.isLuminance){const v=z._getUnpackAlignement(),p=Y;y=Math.floor((Y+v-1)/v)*v*(I-1)+p,B=l._GetLuminanceArrayBuffer(Y,I,K.byteOffset+q,y,K.buffer),a.format=1,a.type=0,z._uploadDataToTextureDirectly(a,B,T,m)}else y=Math.max(4,Y)/4*Math.max(4,I)/4*n,B=new Uint8Array(K.buffer,K.byteOffset+q,y),a.type=0,z._uploadCompressedDataToTextureDirectly(a,i,Y,I,B,T,m)}q+=X?Y*I*(X/8):y,Y*=.5,I*=.5,Y=Math.max(1,Y),I=Math.max(1,I)}if(void 0!==V)break}C&&C.length>0?v.sphericalPolynomial=m.e.ConvertCubeMapToSphericalPolynomial({size:H[4],right:C[0],left:C[1],up:C[2],down:C[3],front:C[4],back:C[5],format:5,type:1,gammaSpace:!1}):v.sphericalPolynomial=void 0}}l.StoreLODInAlphaChannel=!1},10931:(z,a,K)=>{"use strict";K.d(a,{b:()=>m,f:()=>p});const v={},T={};function m(z){const a=z.getClassName();return T[a]||(T[a]={}),T[a]}function p(z){const a=z.getClassName();if(v[a])return v[a];v[a]={};const K=v[a];let m=z,p=a;for(;p;){const z=T[p];for(const T in z)K[T]=z[T];let a,v=!1;do{if(a=Object.getPrototypeOf(m),!a.getClassName){v=!0;break}if(a.getClassName()!==p)break;m=a}while(a);if(v)break;p=a.getClassName(),m=a}return K}},10927:(z,a,K)=>{"use strict";K.d(a,{B:()=>W,D:()=>p,d:()=>m,e:()=>w,g:()=>G,h:()=>s,i:()=>l,j:()=>M,k:()=>V,o:()=>C,p:()=>F,t:()=>c,x:()=>j,y:()=>r});var v=K(10931);function T(z,a){return(K,T)=>{const m=(0,v.b)(K);m[T]||(m[T]={type:z,sourceName:a})}}function m(z){return function(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(K,v)=>{const T=a||"_"+v;Object.defineProperty(K,v,{get:function(){return this[T]},set:function(a){"function"===typeof this.equals&&this.equals(a)||this[T]!==a&&(this[T]=a,K[z].apply(this))},enumerable:!0,configurable:!0})}}(z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function p(z){return T(0,z)}function j(z){return T(1,z)}function s(z){return T(2,z)}function M(z){return T(3,z)}function r(z){return T(4,z)}function W(z){return T(5,z)}function F(z){return T(6,z)}function G(z){return T(7,z)}function l(z){return T(8,z)}function V(z){return T(9,z)}function c(z){return T(10,z)}function C(z){return T(12,z)}function w(z,a,K,v){const T=K.value;K.value=function(){let K=T;if("undefined"!==typeof _native&&_native[a]){const z=_native[a];K=v?function(){return v(...arguments)?z(...arguments):T(...arguments)}:z}return z[a]=K,K(...arguments)}}w.filter=function(z){return(a,K,v)=>w(a,K,v,z)}},10973:(z,a,K)=>{"use strict";K.d(a,{e:()=>M});var v=K(10663),T=K(10937),m=K(10971),p=K(10941),j=K(10931);const s=function(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const m=z();T.d&&T.d.HasTags(a)&&T.d.AddTagsTo(m,T.d.GetTags(a,!0));const p=(0,j.f)(m),s={};for(const T in p){const z=p[T],j=a[T],r=z.type;if(void 0!==j&&null!==j&&("uniqueId"!==T||M.AllowLoadingUniqueId))switch(r){case 0:case 6:case 11:m[T]=j;break;case 1:v.cloneTexturesOnlyOnce&&s[j.uniqueId]?m[T]=s[j.uniqueId]:(m[T]=K||j.isRenderTarget?j:j.clone(),s[j.uniqueId]=m[T]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:m[T]=K?j:j.clone()}}return m};class M{static AppendSerializedAnimations(z,a){if(z.animations){a.animations=[];for(let K=0;K<z.animations.length;K++){const v=z.animations[K];a.animations.push(v.serialize())}}}static Serialize(z,a){a||(a={}),T.d&&(a.tags=T.d.GetTags(z));const K=(0,j.f)(z);for(const v in K){const T=K[v],m=T.sourceName||v,p=T.type,j=z[v];if(void 0!==j&&null!==j&&("uniqueId"!==v||M.AllowLoadingUniqueId))switch(p){case 0:a[m]=j;break;case 1:case 3:case 7:case 9:a[m]=j.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:a[m]=j.kj();break;case 6:case 11:a[m]=j.id}}return a}static ParseProperties(z,a,K,v){v||(v="");const T=(0,j.f)(a);for(const j in T){const s=T[j],r=z[s.sourceName||j],W=s.type;if(void 0!==r&&null!==r&&("uniqueId"!==j||M.AllowLoadingUniqueId)){const z=a;switch(W){case 0:z[j]=r;break;case 1:K&&(z[j]=M._TextureParser(r,K,v));break;case 2:z[j]=m.c.Jg(r);break;case 3:z[j]=M._FresnelParametersParser(r);break;case 4:z[j]=p.m.Jg(r);break;case 5:z[j]=p.o.Jg(r);break;case 6:K&&(z[j]=K.getLastMeshById(r));break;case 7:z[j]=M._ColorCurvesParser(r);break;case 8:z[j]=m.d.Jg(r);break;case 9:z[j]=M._ImageProcessingConfigurationParser(r);break;case 10:z[j]=p.f.Jg(r);break;case 11:K&&(z[j]=K.getCameraById(r));break;case 12:z[j]=p.b.Jg(r)}}}}static Parse(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const m=z();return T.d&&T.d.AddTagsTo(m,a.tags),M.ParseProperties(a,m,K,v),m}static Clone(z,a){return s(z,a,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(z,a){return s(z,a,!0)}}M.AllowLoadingUniqueId=!1,M._ImageProcessingConfigurationParser=z=>{throw(0,v.b)("ImageProcessingConfiguration")},M._FresnelParametersParser=z=>{throw(0,v.b)("FresnelParameters")},M._ColorCurvesParser=z=>{throw(0,v.b)("ColorCurves")},M._TextureParser=(z,a,K)=>{throw(0,v.b)("Texture")}},10653:(z,a,K)=>{"use strict";K.d(a,{b:()=>m});var v=K(10648);const T=(z,a,K)=>z?z.getClassName&&"Mesh"===z.getClassName()?null:!z.getClassName||"SubMesh"!==z.getClassName()&&"PhysicsBody"!==z.getClassName()?z.clone?z.clone():Array.isArray(z)?z.slice():K&&"object"===typeof z?{...z}:null:z.clone(a):null;class m{static DeepCopy(z,a,K,m){let p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const j=function(z){const a=[];do{Object.getOwnPropertyNames(z).forEach((function(z){-1===a.indexOf(z)&&a.push(z)}))}while(z=Object.getPrototypeOf(z));return a}(z);for(const M of j){if("_"===M[0]&&(!m||-1===m.indexOf(M)))continue;if(M.endsWith("Observable"))continue;if(K&&-1!==K.indexOf(M))continue;const j=z[M],r=typeof j;if("function"!==r)try{if("object"===r)if(j instanceof Uint8Array)a[M]=Uint8Array.from(j);else if(j instanceof Array){if(a[M]=[],j.length>0)if("object"==typeof j[0])for(let z=0;z<j.length;z++){const K=T(j[z],a,p);-1===a[M].indexOf(K)&&a[M].push(K)}else a[M]=j.slice(0)}else a[M]=T(j,a,p);else a[M]=j}catch(s){v.c.Warn(s.message)}}}}},10663:(z,a,K)=>{"use strict";K.d(a,{b:()=>T});const v={};function T(z){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!v[z])return v[z]=!0,`${z} needs to be imported before as it contains a side-effect required by your code.`}},10640:(z,a,K)=>{"use strict";function v(){return"undefined"!==typeof window}function T(){return"undefined"!==typeof navigator}function m(){return"undefined"!==typeof document}function p(z){let a="",K=z.firstChild;for(;K;)3===K.nodeType&&(a+=K.textContent),K=K.nextSibling;return a}K.d(a,{c:()=>p,g:()=>m,j:()=>T,m:()=>v})},11969:(z,a,K)=>{"use strict";K.r(a),K.d(a,{Dispose:()=>F,DumpData:()=>W,DumpDataAsync:()=>r,DumpFramebuffer:()=>M,DumpTools:()=>G});var v=K(11480),T=K(10631),m=K(10959),p=K(10680);let j,s=null;async function M(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",m=arguments.length>5?arguments[5]:void 0,p=arguments.length>6?arguments[6]:void 0;const j=await K.readPixels(0,0,z,a);W(z,a,new Uint8Array(j.buffer),v,T,m,!0,void 0,p)}function r(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",T=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7?arguments[7]:void 0;return new Promise((s=>{W(z,a,K,(z=>s(z)),v,T,m,p,j)}))}function W(z,a,M,r){let W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",G=arguments.length>5?arguments[5]:void 0,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8?arguments[8]:void 0;(async function(){return s||(s=new Promise(((z,a)=>{let T,m=null;const s={dh:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(K.bind(K,11377)).then((M=>{let{ThinEngine:r}=M;try{T=new OffscreenCanvas(100,100),m=new r(T,!1,s)}catch(G){T=document.createElement("canvas"),m=new r(T,!1,s)}p.b.Instances.pop(),p.b.OnEnginesDisposedObservable.add((z=>{m&&z!==m&&!m.u&&0===p.b.Instances.length&&F()})),m.getCaps().parallelShaderCompile=void 0;const W=new v.e(m);K.e(34).then(K.bind(K,13149)).then((K=>{let{passPixelShader:p}=K;if(!m)return void a("Engine is not defined");const s=new v.i({kd:m,name:p.name,fragmentShader:p.shader,samplerNames:["textureSampler"]});j={canvas:T,kd:m,renderer:W,wrapper:s},z(j)}))})).catch(a)}))),await s})().then((K=>{if(K.kd.setSize(z,a,!0),M instanceof Float32Array){const z=new Uint8Array(M.length);let a=M.length;for(;a--;){const K=M[a];z[a]=Math.round(255*(0,m.e)(K))}M=z}const v=K.kd.createRawTexture(M,z,a,5,!1,!l,1);K.renderer.setViewport(),K.renderer.applyEffectWrapper(K.wrapper),K.wrapper.effect._bindTexture("textureSampler",v),K.renderer.draw(),V?T.h.ToBlob(K.canvas,(z=>{const a=new FileReader;a.onload=z=>{const a=z.target.result;r&&r(a)},a.readAsArrayBuffer(z)}),W,c):T.h.EncodeScreenshotCanvasData(K.canvas,r,W,G,c),v.dispose()}))}function F(){var z;j?(j.wrapper.dispose(),j.renderer.dispose(),j.kd.dispose()):null===(z=s)||void 0===z||z.then((z=>{z.wrapper.dispose(),z.renderer.dispose(),z.kd.dispose()}));s=null,j=null}const G={DumpData:W,DumpDataAsync:r,DumpFramebuffer:M,Dispose:F};T.h.DumpData=W,T.h.DumpDataAsync=r,T.h.DumpFramebuffer=M},11960:(z,a,K)=>{"use strict";K.d(a,{c:()=>l,e:()=>C,g:()=>f,k:()=>Y});var v=K(10631),T=K(10941),m=K(10959),p=K(11435),j=K(10748),s=K(11143),M=(K(10935),K(11477)),r=K(10648);K(11917),K(11929),K(11969);const W="image/png",F=2,G=[134,22,135,150,246,214,150,54];function l(z){const a=new DataView(z.buffer,z.byteOffset,z.byteLength);let K=0;for(let p=0;p<G.length;p++)if(a.getUint8(K++)!==G[p])return r.c.Error("Not a babylon environment map"),null;let v="",T=0;for(;T=a.getUint8(K++);)v+=String.fromCharCode(T);let m=JSON.parse(v);return m=V(m),m.ih&&(m.ih.specularDataPosition=K,m.ih.lodGenerationScale=m.ih.lodGenerationScale||.8),m}function V(z){if(z.version>F)throw new Error(`Unsupported babylon environment map version "${z.version}". Latest supported version is "${F}".`);return 2===z.version?z:z={...z,version:2,imageType:W}}function c(z,a){const K=(a=V(a)).ih;let v=Math.log2(a.width);if(v=Math.round(v)+1,K.mipmaps.length!==6*v)throw new Error(`Unsupported specular mipmaps number "${K.mipmaps.length}"`);const T=new Array(v);for(let m=0;m<v;m++){T[m]=new Array(6);for(let a=0;a<6;a++){const v=K.mipmaps[6*m+a];T[m][a]=new Uint8Array(z.buffer,z.byteOffset+K.specularDataPosition+v.position,v.length)}}return T}function C(z,a,K){const v=(K=V(K)).ih;if(!v)return Promise.resolve();z._lodGenerationScale=v.lodGenerationScale;return H(z,c(a,K),K.imageType)}function w(z,a,K,v,T,m,p,j,s,M,r){return new Promise(((W,F)=>{if(K){const K=a.createTexture(null,!0,!0,null,1,null,(z=>{F(z)}),z);null===v||void 0===v||v.onEffectCreatedObservable.addOnce((j=>{j.executeWhenCompiled((()=>{v.externalTextureSamplerBinding=!0,v.onApply=v=>{v._bindTexture("textureSampler",K),v.setFloat2("scale",1,a._features.needsInvertingBitmap&&z instanceof ImageBitmap?-1:1)},a.scenes.length&&(a.scenes[0].postProcessManager.directRender([v],M,!0,m,p),a.restoreDefaultFramebuffer(),K.dispose(),URL.revokeObjectURL(T),W())}))}))}else{if(a._uploadImageToTexture(r,z,m,p),j){const K=s[p];K&&a._uploadImageToTexture(K._texture,z,m,0)}W()}}))}async function H(z,a){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W;if(!v.h.IsExponentOfTwo(z.width))throw new Error("Texture size must be a power of two");const p=(0,m.o)(z.width)+1,r=z.getEngine();let F=!1,G=!1,l=null,V=null,c=null;const C=r.getCaps();z.format=5,z.type=0,z.generateMipMaps=!0,z._cachedAnisotropicFilteringLevel=null,r.updateTextureSamplingMode(3,z),C.textureLOD?r._features.supportRenderAndCopyToLodForFloatTextures?C.textureHalfFloatRender&&C.textureHalfFloatLinearFiltering?(F=!0,z.type=2):C.textureFloatRender&&C.textureFloatLinearFiltering&&(F=!0,z.type=1):F=!1:(F=!1,G=!0,c={});let H=0;if(F)r.isWebGPU?(H=1,await K.e(39).then(K.bind(K,13172))):await K.e(41).then(K.bind(K,13184)),l=new M.e("rgbdDecode","rgbdDecode",null,null,1,null,3,r,!1,void 0,z.type,void 0,null,!1,void 0,H),z._isRGBD=!1,z.invertY=!1,V=r.createRenderTargetCubeTexture(z.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:z.type,format:5});else if(z._isRGBD=!0,z.invertY=!0,G){const a=3,K=z._lodGenerationScale,v=z._lodGenerationOffset;for(let T=0;T<a;T++){const m=(p-1)*K+v,M=v+(m-v)*(1-T/(a-1)),W=Math.round(Math.min(Math.max(M,0),m)),F=new j.b(r,2);F.isCube=!0,F.invertY=!0,F.generateMipMaps=!1,r.updateTextureSamplingMode(2,F);const G=new s.b(null);switch(G._isCube=!0,G._texture=F,c[W]=G,T){case 0:z._lodTextureLow=G;break;case 1:z._lodTextureMid=G;break;case 2:z._lodTextureHigh=G}}}const f=[];for(let K=0;K<a.length;K++)for(let v=0;v<6;v++){const m=a[K][v],p=new Blob([m],{type:T}),j=URL.createObjectURL(p);let s;if(r._features.forceBitmapOverHTMLImageElement)s=r.createImageBitmap(p,{premultiplyAlpha:"none"}).then((a=>w(a,r,F,l,j,v,K,G,c,V,z)));else{const a=new Image;a.src=j,s=new Promise(((T,m)=>{a.onload=()=>{w(a,r,F,l,j,v,K,G,c,V,z).then((()=>T())).catch((z=>{m(z)}))},a.onerror=z=>{m(z)}}))}f.push(s)}if(a.length<p){let K;const v=Math.pow(2,p-1-a.length),T=v*v*4;switch(z.type){case 0:K=new Uint8Array(T);break;case 2:K=new Uint16Array(T);break;case 1:K=new Float32Array(T)}for(let m=a.length;m<p;m++)for(let a=0;a<6;a++)r._uploadArrayBufferViewToTexture(z,K,a,m)}return Promise.all(f).then((()=>{V&&(r._releaseTexture(z),V._swapAndDie(z)),l&&l.dispose(),G&&(z._lodTextureHigh&&z._lodTextureHigh._texture&&(z._lodTextureHigh._texture.isReady=!0),z._lodTextureMid&&z._lodTextureMid._texture&&(z._lodTextureMid._texture.isReady=!0),z._lodTextureLow&&z._lodTextureLow._texture&&(z._lodTextureLow._texture.isReady=!0))}))}function f(z,a){const K=(a=V(a)).irradiance;if(!K)return;const v=new p.f;T.o.FromArrayToRef(K.x,0,v.x),T.o.FromArrayToRef(K.y,0,v.y),T.o.FromArrayToRef(K.z,0,v.z),T.o.FromArrayToRef(K.xx,0,v.xx),T.o.FromArrayToRef(K.yy,0,v.yy),T.o.FromArrayToRef(K.zz,0,v.zz),T.o.FromArrayToRef(K.yz,0,v.yz),T.o.FromArrayToRef(K.zx,0,v.zx),T.o.FromArrayToRef(K.xy,0,v.xy),z._sphericalPolynomial=v}function Y(z,a,K,v,T){const m=H(z.getEngine().createRawCubeTexture(null,z.width,z.format,z.type,z.generateMipMaps,z.invertY,z.samplingMode,z._compression),a).then((()=>z));return z.onRebuildCallback=z=>({proxy:m,isReady:!0,isAsync:!0}),z._source=13,z._bufferViewArrayArray=a,z._lodGenerationScale=v,z._lodGenerationOffset=T,z._sphericalPolynomial=K,H(z,a).then((()=>(z.isReady=!0,z)))}},10684:(z,a,K)=>{"use strict";K.d(a,{b:()=>v,e:()=>T,h:()=>m});class v extends Error{}v._setPrototypeOf=Object.setPrototypeOf||((z,a)=>(z.__proto__=a,z));const T={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class m extends v{constructor(z,a,K){super(z),this.errorCode=a,this.innerError=K,this.name="RuntimeError",v._setPrototypeOf(this,m.prototype)}}},10682:(z,a,K)=>{"use strict";K.d(a,{b:()=>n,e:()=>H,f:()=>y,n:()=>B,j:()=>c,p:()=>I,r:()=>q,u:()=>x,y:()=>f});var v=K(10672),T=K(10640),m=K(10638);class p{}p.FilesToLoad={};var j=K(10684),s=K(10690),M=K(10699),r=K(10680),W=K(10648),F=K(10706),G=K(10702),l=K(10715);const V=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class c extends j.h{constructor(z,a){super(z,j.e.LoadFileError),this.name="LoadFileError",j.b._setPrototypeOf(this,c.prototype),a instanceof v.b?this.request=a:this.file=a}}class C extends j.h{constructor(z,a){super(z,j.e.RequestFileError),this.request=a,this.name="RequestFileError",j.b._setPrototypeOf(this,C.prototype)}}class w extends j.h{constructor(z,a){super(z,j.e.ReadFileError),this.file=a,this.name="ReadFileError",j.b._setPrototypeOf(this,w.prototype)}}const H={DefaultRetryStrategy:class{static ExponentialBackoff(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(K,v,T)=>0!==v.status||T>=z||-1!==K.indexOf("file:")?-1:Math.pow(2,T)*a}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:z=>z,ScriptBaseUrl:"",ScriptPreprocessUrl:z=>z,CleanUrl:z=>z=z.replace(/#/gm,"%23")},f=(z,a)=>{if((!z||0!==z.indexOf("data:"))&&H.CorsBehavior)if("string"===typeof H.CorsBehavior||H.CorsBehavior instanceof String)a.crossOrigin=H.CorsBehavior;else{const K=H.CorsBehavior(z);K&&(a.crossOrigin=K)}},Y={getRequiredSize:null},I=function(z,a,K,T){let m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",j=arguments.length>5?arguments[5]:void 0;const M=r.b.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===M||void 0===M||!M._features.forceBitmapOverHTMLImageElement))return K("LoadImage is only supported in web or BabylonNative environments."),null;let W,F=!1;z instanceof ArrayBuffer||ArrayBuffer.isView(z)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(W=URL.createObjectURL(new Blob([z],{type:m})),F=!0):W=`data:${m};base64,`+(0,s.k)(z):z instanceof Blob?(W=URL.createObjectURL(z),F=!0):(W=H.CleanUrl(z),W=H.PreprocessUrl(W));const G=a=>{if(K){const v=W||z.toString();K(`Error while trying to load image: ${0===v.indexOf("http")||v.length<=128?v:v.slice(0,128)+"..."}`,a)}};if(null!==M&&void 0!==M&&M._features.forceBitmapOverHTMLImageElement)return B(W,(v=>{M.createImageBitmap(new Blob([v],{type:m}),{premultiplyAlpha:"none",...j}).then((z=>{a(z),F&&URL.revokeObjectURL(W)})).catch((a=>{K&&K("Error while trying to load image: "+z,a)}))}),void 0,T||void 0,!0,((z,a)=>{G(a)})),null;const l=new Image;if(Y.getRequiredSize){const a=Y.getRequiredSize(z);a.width&&(l.width=a.width),a.height&&(l.height=a.height)}f(W,l);const V=[],c=()=>{V.forEach((z=>{z.target.removeEventListener(z.name,z.handler)})),V.length=0};V.push({target:l,name:"load",handler:()=>{c(),a(l),F&&l.src&&URL.revokeObjectURL(l.src)}}),V.push({target:l,name:"error",handler:z=>{c(),G(z),F&&l.src&&URL.revokeObjectURL(l.src)}}),V.push({target:document,name:"securitypolicyviolation",handler:z=>{if(z.blockedURI!==l.src||"nm"===z.disposition)return;c();const a=new Error(`CSP violation of policy ${z.effectiveDirective} ${z.blockedURI}. Current policy is ${z.originalPolicy}`);r.b.UseFallbackTexture=!1,G(a),F&&l.src&&URL.revokeObjectURL(l.src),l.src=""}}),V.forEach((z=>{z.target.addEventListener(z.name,z.handler)}));const C="blob:"===W.substring(0,5),w="data:"===W.substring(0,5),I=()=>{C||w||!v.b.IsCustomRequestAvailable?l.src=W:B(W,((z,a,K)=>{const v=new Blob([z],{type:!m&&K?K:m}),T=URL.createObjectURL(v);F=!0,l.src=T}),void 0,T||void 0,!0,((z,a)=>{G(a)}))},q=()=>{T&&T.loadImage(W,l)};if(!C&&!w&&T&&T.enableTexturesOffline)T.open(q,I);else{if(-1!==W.indexOf("file:")){const z=decodeURIComponent(W.substring(5).toLowerCase());if(p.FilesToLoad[z]&&"undefined"!==typeof URL){try{let a;try{a=URL.createObjectURL(p.FilesToLoad[z])}catch(x){a=URL.createObjectURL(p.FilesToLoad[z])}l.src=a,F=!0}catch(Z){l.src=""}return l}}I()}return l},q=(z,a,K,v,T)=>{const p=new FileReader,j={onCompleteObservable:new m.c,abort:()=>p.abort()};return p.onloadend=()=>j.onCompleteObservable.notifyObservers(j),T&&(p.onerror=()=>{T(new w(`Unable to read ${z.name}`,z))}),p.onload=z=>{a(z.target.result)},K&&(p.onprogress=K),v?p.readAsArrayBuffer(z):p.readAsText(z),j},B=(z,a,K,v,T,s,M)=>{if(z.name)return q(z,a,K,T,s?z=>{s(void 0,z)}:void 0);const r=z;if(-1!==r.indexOf("file:")){let z=decodeURIComponent(r.substring(5).toLowerCase());0===z.indexOf("./")&&(z=z.substring(2));const v=p.FilesToLoad[z];if(v)return q(v,a,K,T,s?z=>s(void 0,new c(z.message,z.file)):void 0)}const{match:G,type:l}=i(r);if(G){const z={onCompleteObservable:new m.c,abort:()=>()=>{}};try{const z=T?n(r):X(r);a(z,void 0,l)}catch(j){s?s(void 0,j):W.c.Error(j.message||"Failed to parse the Data URL")}return F.b.SetImmediate((()=>{z.onCompleteObservable.notifyObservers(z)})),z}return x(r,((z,K)=>{a(z,null===K||void 0===K?void 0:K.responseURL,null===K||void 0===K?void 0:K.getResponseHeader("content-type"))}),K,v,T,s?z=>{s(z.request,new c(z.message,z.request))}:void 0,M)},x=(z,a,K,p,j,s,M)=>{z=H.CleanUrl(z),z=H.PreprocessUrl(z);const r=H.BaseUrl+z;let F=!1;const G={onCompleteObservable:new m.c,abort:()=>F=!0},l=()=>{let z,m=new v.b,p=null;const l=()=>{m&&(K&&m.removeEventListener("progress",K),z&&m.removeEventListener("readystatechange",z),m.removeEventListener("loadend",V))};let V=()=>{l(),G.onCompleteObservable.notifyObservers(G),G.onCompleteObservable.clear(),K=void 0,z=null,V=null,s=void 0,M=void 0,a=void 0};G.abort=()=>{F=!0,V&&V(),m&&m.readyState!==(XMLHttpRequest.DONE||4)&&m.abort(),null!==p&&(clearTimeout(p),p=null),m=null};const c=z=>{const a=z.message||"Unknown error";s&&m?s(new C(a,m)):W.c.Error(a)},w=W=>{if(m){if(m.open("GET",r),M)try{M(m)}catch(G){return void c(G)}j&&(m.responseType="arraybuffer"),K&&m.addEventListener("progress",K),V&&m.addEventListener("loadend",V),z=()=>{if(!F&&m&&m.readyState===(XMLHttpRequest.DONE||4)){if(z&&m.removeEventListener("readystatechange",z),m.status>=200&&m.status<300||0===m.status&&(!(0,T.m)()||Z())){try{a&&a(j?m.response:m.responseText,m)}catch(G){c(G)}return}const K=H.DefaultRetryStrategy;if(K){const z=K(r,m,W);if(-1!==z)return l(),m=new v.b,void(p=setTimeout((()=>w(W+1)),z))}const M=new C("Error status: "+m.status+" "+m.statusText+" - Unable to load "+r,m);s&&s(M)}},m.addEventListener("readystatechange",z),m.send()}};w(0)};if(p&&p.enableSceneOffline){const v=z=>{z&&z.status>400?s&&s(z):l()},T=()=>{p&&p.loadFile(H.BaseUrl+z,(z=>{!F&&a&&a(z),G.onCompleteObservable.notifyObservers(G)}),K?z=>{!F&&K&&K(z)}:void 0,v,j)};p.open(T,v)}else l();return G},Z=()=>"undefined"!==typeof location&&"file:"===location.protocol,y=z=>V.test(z),i=z=>{const a=V.exec(z);if(null===a||0===a.length)return{match:!1,type:""};return{match:!0,type:a[0].replace("data:","").replace("base64,","")}};function n(z){return(0,s.c)(z.split(",")[1])}const X=z=>(0,s.g)(z.split(",")[1]);let P;l.b._FileToolsLoadImage=I,G.d.loadFile=B,M.n.loadFile=B;((z,a,K,v,T,m,p,j,s,M)=>{P={DecodeBase64UrlToBinary:z,DecodeBase64UrlToString:a,DefaultRetryStrategy:K.DefaultRetryStrategy,BaseUrl:K.BaseUrl,CorsBehavior:K.CorsBehavior,PreprocessUrl:K.PreprocessUrl,IsBase64DataUrl:v,IsFileURL:T,LoadFile:m,LoadImage:p,ReadFile:j,RequestFile:s,SetCorsBehavior:M},Object.defineProperty(P,"DefaultRetryStrategy",{get:function(){return K.DefaultRetryStrategy},set:function(z){K.DefaultRetryStrategy=z}}),Object.defineProperty(P,"BaseUrl",{get:function(){return K.BaseUrl},set:function(z){K.BaseUrl=z}}),Object.defineProperty(P,"PreprocessUrl",{get:function(){return K.PreprocessUrl},set:function(z){K.PreprocessUrl=z}}),Object.defineProperty(P,"CorsBehavior",{get:function(){return K.CorsBehavior},set:function(z){K.CorsBehavior=z}})})(n,X,H,y,Z,B,I,q,x,f)},10776:(z,a,K)=>{"use strict";function v(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(z=>{const a=16*Math.random()|0;return("x"===z?a:3&a|8).toString(16)}))}K.d(a,{c:()=>v})},10764:(z,a,K)=>{"use strict";K.d(a,{b:()=>m});var v=K(10648),T=K(10767);class m{static Instantiate(z){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[z])return this.RegisteredExternalClasses[z];const a=(0,T.c)(z);if(a)return a;v.c.Warn(z+" not found, you may have missed an import.");const K=z.split(".");let m=window||this;for(let v=0,T=K.length;v<T;v++)m=m[K[v]];return"function"!==typeof m?null:m}}m.RegisteredExternalClasses={}},10648:(z,a,K)=>{"use strict";K.d(a,{c:()=>v});class v{static _CheckLimit(z,a){let K=v._LogLimitOutputs[z];return K?K.current++:(K={limit:a,current:1},v._LogLimitOutputs[z]=K),K.current<=K.limit}static _GenerateLimitMessage(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const K=v._LogLimitOutputs[z];if(!K||!v.MessageLimitReached)return;const T=this._Levels[a];K.current===K.limit&&v[T.name](v.MessageLimitReached.replace(/%LIMIT%/g,""+K.limit).replace(/%TYPE%/g,T.name??""))}static _AddLogEntry(z){v._LogCache=z+v._LogCache,v.OnNewCacheEntry&&v.OnNewCacheEntry(z)}static _FormatMessage(z){const a=z=>z<10?"0"+z:""+z,K=new Date;return"["+a(K.getHours())+":"+a(K.getMinutes())+":"+a(K.getSeconds())+"]: "+z}static _LogDisabled(z,a){}static _LogEnabled(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1?arguments[1]:void 0,K=arguments.length>2?arguments[2]:void 0;const T=Array.isArray(a)?a[0]:a;if(void 0!==K&&!v._CheckLimit(T,K))return;const m=v._FormatMessage(T),p=this._Levels[z],j=Array.isArray(a)?a.slice(1):[];p.logFunc&&p.logFunc("BJS - "+m,...j);const s=`<div style='color:${p.color}'>${m}</div><br>`;v._AddLogEntry(s),v._GenerateLimitMessage(T,z)}static get LogCache(){return v._LogCache}static ClearLogCache(){v._LogCache="",v._LogLimitOutputs={},v.errorsCount=0}static set LogLevels(z){v.Log=v._LogDisabled,v.Warn=v._LogDisabled,v.Error=v._LogDisabled,[v.MessageLogLevel,v.WarningLogLevel,v.ErrorLogLevel].forEach((a=>{if((z&a)===a){const z=this._Levels[a];v[z.name]=v._LogEnabled.bind(v,a)}}))}}v.NoneLogLevel=0,v.MessageLogLevel=1,v.WarningLogLevel=2,v.ErrorLogLevel=4,v.AllLogLevel=7,v.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",v._LogCache="",v._LogLimitOutputs={},v._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],v.errorsCount=0,v.Log=v._LogEnabled.bind(v,v.MessageLogLevel),v.Warn=v._LogEnabled.bind(v,v.WarningLogLevel),v.Error=v._LogEnabled.bind(v,v.ErrorLogLevel)},10638:(z,a,K)=>{"use strict";K.d(a,{c:()=>m});class v{constructor(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2?arguments[2]:void 0,v=arguments.length>3?arguments[3]:void 0;this.initialize(z,a,K,v)}initialize(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2?arguments[2]:void 0,v=arguments.length>3?arguments[3]:void 0;return this.mask=z,this.skipNextObservers=a,this.target=K,this.currentTarget=v,this}}class T{constructor(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=z,this.mask=a,this.scope=K,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class m{static FromPromise(z,a){const K=new m;return z.then((z=>{K.notifyObservers(z)})).catch((z=>{if(!a)throw z;a.notifyObservers(z)})),K}get observers(){return this._observers}constructor(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=a,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new v(0),z&&(this._onObserverAdded=z)}add(z){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],K=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!z)return null;const v=new T(z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return v.unregisterOnNextCall=K,a?this._observers.unshift(v):this._observers.push(v),this._onObserverAdded&&this._onObserverAdded(v),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(v,this._lastNotifiedValue),v._remove=()=>{this.remove(v)},v}addOnce(z){return this.add(z,void 0,void 0,void 0,!0)}remove(z){if(!z)return!1;z._remove=null;return-1!==this._observers.indexOf(z)&&(this._deferUnregister(z),!0)}removeCallback(z,a){for(let K=0;K<this._observers.length;K++){const v=this._observers[K];if(!v._willBeUnregistered&&(v.callback===z&&(!a||a===v.scope)))return this._deferUnregister(v),!0}return!1}_deferUnregister(z){z._willBeUnregistered||(this._numObserversMarkedAsDeleted++,z.unregisterOnNextCall=!1,z._willBeUnregistered=!0,setTimeout((()=>{this._remove(z)}),0))}_remove(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!z)return!1;const K=this._observers.indexOf(z);return-1!==K&&(a&&this._numObserversMarkedAsDeleted--,this._observers.splice(K,1),!0)}makeObserverTopPriority(z){this._remove(z,!1),this._observers.unshift(z)}makeObserverBottomPriority(z){this._remove(z,!1),this._observers.push(z)}notifyObservers(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,K=arguments.length>2?arguments[2]:void 0,v=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=z),!this._observers.length)return!0;const m=this._eventState;m.mask=a,m.target=K,m.currentTarget=v,m.skipNextObservers=!1,m.lastReturnValue=z,m.userInfo=T;for(const p of this._observers)if(!p._willBeUnregistered&&(p.mask&a&&(p.unregisterOnNextCall&&this._deferUnregister(p),p.scope?m.lastReturnValue=p.callback.apply(p.scope,[z,m]):m.lastReturnValue=p.callback(z,m)),m.skipNextObservers))return!1;return!0}notifyObserver(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=a),z._willBeUnregistered)return;const v=this._eventState;v.mask=K,v.skipNextObservers=!1,z.unregisterOnNextCall&&this._deferUnregister(z),z.callback(a,v)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const z=this._observers.pop();z&&(z._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const z=new m;return z._observers=this._observers.slice(0),z}hasSpecificMask(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const a of this._observers)if(a.mask&z||a.mask===z)return!0;return!1}}},10788:(z,a,K)=>{"use strict";K.d(a,{d:()=>T});var v=K(10658);class T{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(z,a){T.Enabled&&(this._current+=z,a&&this._fetchResult())}beginMonitoring(){T.Enabled&&(this._startMonitoringTime=v.d.Now)}endMonitoring(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!T.Enabled)return;z&&this.fetchNewFrame();const a=v.d.Now;this._current=a-this._startMonitoringTime,z&&this._fetchResult()}hj(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const z=v.d.Now;z-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=z,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}T.Enabled=!0},10658:(z,a,K)=>{"use strict";K.d(a,{d:()=>T});var v=K(10640);class T{static get Now(){return(0,v.m)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},11917:(z,a,K)=>{"use strict";K.d(a,{c:()=>m});var v=K(11477),T=K(11468);class m{static ExpandRGBDTexture(z){const a=z._texture;if(!a||!z.isRGBD)return;const T=a.getEngine(),m=T.getCaps(),p=a.isReady;let j=!1;m.textureHalfFloatRender&&m.textureHalfFloatLinearFiltering?(j=!0,a.type=2):m.textureFloatRender&&m.textureFloatLinearFiltering&&(j=!0,a.type=1),j&&(a.isReady=!1,a._isRGBD=!1,a.invertY=!1);const s=async()=>{const m=T.isWebGPU,p=m?1:0;a.isReady=!1,m?await Promise.all([K.e(39).then(K.bind(K,13172)),K.e(40).then(K.bind(K,13181))]):await Promise.all([K.e(41).then(K.bind(K,13184)),K.e(42).then(K.bind(K,13191))]);const j=new v.e("rgbdDecode","rgbdDecode",null,null,1,null,3,T,!1,void 0,a.type,void 0,null,!1,void 0,p);j.externalTextureSamplerBinding=!0;const s=T.createRenderTargetTexture(a.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:a.samplingMode,type:a.type,format:5});j.onEffectCreatedObservable.addOnce((K=>{K.executeWhenCompiled((()=>{j.onApply=z=>{z._bindTexture("textureSampler",a),z.setFloat2("scale",1,1)},z.va().postProcessManager.directRender([j],s,!0),T.restoreDefaultFramebuffer(),T._releaseTexture(a),j&&j.dispose(),s._swapAndDie(a),a.isReady=!0}))}))};j&&(p?s():z.onLoadObservable.addOnce(s))}static EncodeTextureToRGBD(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,T.c)("rgbdEncode",z,a,K,1,5)}}},10933:(z,a,K)=>{"use strict";K.d(a,{e:()=>T,f:()=>v});class v{constructor(z){this.length=0,this.data=new Array(z),this._id=v._GlobalId++}push(z){this.data[this.length++]=z,this.length>this.data.length&&(this.data.length*=2)}forEach(z){for(let a=0;a<this.length;a++)z(this.data[a])}sort(z){this.data.sort(z)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(z){if(0!==z.length){this.length+z.length>this.data.length&&(this.data.length=2*(this.length+z.length));for(let a=0;a<z.length;a++)this.data[this.length++]=(z.data||z)[a]}}indexOf(z){const a=this.data.indexOf(z);return a>=this.length?-1:a}contains(z){return-1!==this.indexOf(z)}}v._GlobalId=0;class T extends v{constructor(){super(...arguments),this._duplicateId=0}push(z){super.push(z),z.__smartArrayFlags||(z.__smartArrayFlags={}),z.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(z){return(!z.__smartArrayFlags||z.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(z),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(z){if(0!==z.length){this.length+z.length>this.data.length&&(this.data.length=2*(this.length+z.length));for(let a=0;a<z.length;a++){const K=(z.data||z)[a];this.pushNoDuplicate(K)}}}}},10690:(z,a,K)=>{"use strict";K.d(a,{c:()=>p,g:()=>m,h:()=>v,k:()=>T});const v=z=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(z);let a="";for(let K=0;K<z.byteLength;K++)a+=String.fromCharCode(z[K]);return a},T=z=>{const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let K,v,T,m,p,j,s,M="",r=0;const W=ArrayBuffer.isView(z)?new Uint8Array(z.buffer,z.byteOffset,z.byteLength):new Uint8Array(z);for(;r<W.length;)K=W[r++],v=r<W.length?W[r++]:Number.NaN,T=r<W.length?W[r++]:Number.NaN,m=K>>2,p=(3&K)<<4|v>>4,j=(15&v)<<2|T>>6,s=63&T,isNaN(v)?j=s=64:isNaN(T)&&(s=64),M+=a.charAt(m)+a.charAt(p)+a.charAt(j)+a.charAt(s);return M},m=z=>atob(z),p=z=>{const a=m(z),K=a.length,v=new Uint8Array(new ArrayBuffer(K));for(let T=0;T<K;T++)v[T]=a.charCodeAt(T);return v.buffer}},10937:(z,a,K)=>{"use strict";K.d(a,{d:()=>T});class v{static Eval(z,a){return"true"===(z=z.match(/\([^()]*\)/g)?z.replace(/\([^()]*\)/g,(z=>(z=z.slice(1,z.length-1),v._HandleParenthesisContent(z,a)))):v._HandleParenthesisContent(z,a))||"false"!==z&&v.Eval(z,a)}static _HandleParenthesisContent(z,a){let K;a=a||(z=>"true"===z);const T=z.split("||");for(const m in T)if(Object.prototype.hasOwnProperty.call(T,m)){let z=v._SimplifyNegation(T[m].trim());const p=z.split("&&");if(p.length>1)for(let T=0;T<p.length;++T){const m=v._SimplifyNegation(p[T].trim());if(K="true"!==m&&"false"!==m?"!"===m[0]?!a(m.substring(1)):a(m):"true"===m,!K){z="false";break}}if(K||"true"===z){K=!0;break}K="true"!==z&&"false"!==z?"!"===z[0]?!a(z.substring(1)):a(z):"true"===z}return K?"true":"false"}static _SimplifyNegation(z){return"!true"===(z=(z=z.replace(/^[\s!]+/,(z=>(z=z.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?z="false":"!false"===z&&(z="true"),z}}class T{static EnableFor(z){z._tags=z._tags||{},z.hasTags=()=>T.HasTags(z),z.addTags=a=>T.AddTagsTo(z,a),z.removeTags=a=>T.RemoveTagsFrom(z,a),z.matchesTagsQuery=a=>T.MatchesQuery(z,a)}static DisableFor(z){delete z._tags,delete z.hasTags,delete z.addTags,delete z.removeTags,delete z.matchesTagsQuery}static HasTags(z){if(!z._tags)return!1;const a=z._tags;for(const K in a)if(Object.prototype.hasOwnProperty.call(a,K))return!0;return!1}static GetTags(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!z._tags)return null;if(a){const a=[];for(const K in z._tags)Object.prototype.hasOwnProperty.call(z._tags,K)&&!0===z._tags[K]&&a.push(K);return a.join(" ")}return z._tags}static AddTagsTo(z,a){if(!a)return;if("string"!==typeof a)return;a.split(" ").forEach((function(a){T._AddTagTo(z,a)}))}static _AddTagTo(z,a){""!==(a=a.trim())&&"true"!==a&&"false"!==a&&(a.match(/[\s]/)||a.match(/^([!]|([|]|[&]){2})/)||(T.EnableFor(z),z._tags[a]=!0))}static RemoveTagsFrom(z,a){if(!T.HasTags(z))return;const K=a.split(" ");for(const v in K)T._RemoveTagFrom(z,K[v])}static _RemoveTagFrom(z,a){delete z._tags[a]}static MatchesQuery(z,a){return void 0===a||(""===a?T.HasTags(z):v.Eval(a,(a=>T.HasTags(z)&&z._tags[a])))}}},11468:(z,a,K)=>{"use strict";K.d(a,{c:()=>s,f:()=>F,h:()=>W});K(11134),K(11475);var v=K(11477),T=K(10715),m=K(10767),p=K(10973);class j extends v.e{getClassName(){return"PassPostProcess"}constructor(z,a){super(z,"pass",null,null,a,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(z,a){z?(this._webGPUReady=!0,a.push(Promise.all([K.e(33).then(K.bind(K,13146))]))):a.push(Promise.all([K.e(34).then(K.bind(K,13149))])),super._gatherImports(z,a)}static _Parse(z,a,K,v){return p.e.Parse((()=>new j(z.name,z.options,a,z.renderTargetSamplingMode,z._engine,z.reusable)),z,K,v)}}(0,m.e)("BABYLON.PassPostProcess",j);v.e;function s(z,a,K,T,m,p,j,s){const M=a.getEngine();return a.isReady=!1,m=m??a.samplingMode,T=T??a.type,p=p??a.format,j=j??a.width,s=s??a.height,-1===T&&(T=0),new Promise((r=>{const W=new v.e("postprocess",z,null,null,1,null,m,M,!1,void 0,T,void 0,null,!1,p);W.externalTextureSamplerBinding=!0;const F=M.createRenderTargetTexture({width:j,height:s},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:m,type:T,format:p});W.onEffectCreatedObservable.addOnce((z=>{z.executeWhenCompiled((()=>{W.onApply=z=>{z._bindTexture("textureSampler",a),z.setFloat2("scale",1,1)},K.postProcessManager.directRender([W],F,!0),M.restoreDefaultFramebuffer(),M._releaseTexture(a),W&&W.dispose(),F._swapAndDie(a),a.type=T,a.format=5,a.isReady=!0,r(a)}))}))}))}let M,r;function W(z){M||(M=new Float32Array(1),r=new Int32Array(M.buffer)),M[0]=z;const a=r[0];let K=a>>16&32768,v=a>>12&2047;const T=a>>23&255;return T<103?K:T>142?(K|=31744,K|=(255==T?0:1)&&8388607&a,K):T<113?(v|=2048,K|=(v>>114-T)+(v>>113-T&1),K):(K|=T-112<<10|v>>1,K+=1&v,K)}function F(z){const a=(32768&z)>>15,K=(31744&z)>>10,v=1023&z;return 0===K?(a?-1:1)*Math.pow(2,-14)*(v/Math.pow(2,10)):31==K?v?NaN:1/0*(a?-1:1):(a?-1:1)*Math.pow(2,K-15)*(1+v/Math.pow(2,10))}T.b._RescalePostProcessFactory=z=>new j("rescale",1,null,2,z,!1,0)},10706:(z,a,K)=>{"use strict";K.d(a,{b:()=>T});var v=K(10640);class T{static SetImmediate(z){(0,v.m)()&&window.setImmediate?window.setImmediate(z):setTimeout(z,1)}}},10782:(z,a,K)=>{"use strict";function v(z){let a=1;do{a*=2}while(a<z);return a===z}function T(z,a,K){return z*(1-K)+a*K}function m(z){const a=p(z),K=j(z);return a-z>z-K?K:a}function p(z){return z--,z|=z>>1,z|=z>>2,z|=z>>4,z|=z>>8,z|=z>>16,++z}function j(z){return z|=z>>1,z|=z>>2,z|=z>>4,z|=z>>8,(z|=z>>16)-(z>>1)}function s(z,a){let K;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:K=j(z);break;case 2:K=m(z);break;default:K=p(z)}return Math.min(K,a)}K.d(a,{e:()=>j,g:()=>s,i:()=>v,k:()=>T,n:()=>m})},10631:(z,a,K)=>{"use strict";K.d(a,{d:()=>C,h:()=>c});var v=K(10638),T=K(10640),m=K(10648),p=K(10653),j=K(10658),s=K(10663),M=K(10672),r=K(10680),W=K(10682),F=K(10706),G=K(10764),l=K(10776),V=K(10782);class c{static get BaseUrl(){return W.e.BaseUrl}static set BaseUrl(z){W.e.BaseUrl=z}static get CleanUrl(){return W.e.CleanUrl}static set CleanUrl(z){W.e.CleanUrl=z}static IsAbsoluteUrl(z){return 0===z.indexOf("//")||-1!==z.indexOf("://")&&(-1!==z.indexOf(".")&&(-1!==z.indexOf("/")&&(!(z.indexOf(":")>z.indexOf("/"))&&(z.indexOf("://")<z.indexOf(".")||(0===z.indexOf("data:")||0===z.indexOf("blob:"))))))}static set ScriptBaseUrl(z){W.e.ScriptBaseUrl=z}static get ScriptBaseUrl(){return W.e.ScriptBaseUrl}static set ScriptPreprocessUrl(z){W.e.ScriptPreprocessUrl=z}static get ScriptPreprocessUrl(){return W.e.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return W.e.DefaultRetryStrategy}static set DefaultRetryStrategy(z){W.e.DefaultRetryStrategy=z}static get CorsBehavior(){return W.e.CorsBehavior}static set CorsBehavior(z){W.e.CorsBehavior=z}static get UseFallbackTexture(){return r.b.UseFallbackTexture}static set UseFallbackTexture(z){r.b.UseFallbackTexture=z}static get RegisteredExternalClasses(){return G.b.RegisteredExternalClasses}static set RegisteredExternalClasses(z){G.b.RegisteredExternalClasses=z}static get fallbackTexture(){return r.b.FallbackTexture}static set fallbackTexture(z){r.b.FallbackTexture=z}static FetchToRef(z,a,K,v,T,m){const p=4*((Math.abs(z)*K%K|0)+(Math.abs(a)*v%v|0)*K);m.r=T[p]/255,m.g=T[p+1]/255,m.b=T[p+2]/255,m.a=T[p+3]/255}static Mix(z,a,K){return 0}static Instantiate(z){return G.b.Instantiate(z)}static SetImmediate(z){F.b.SetImmediate(z)}static IsExponentOfTwo(z){return!0}static FloatRound(z){return Math.fround(z)}static GetFilename(z){const a=z.lastIndexOf("/");return a<0?z:z.substring(a+1)}static GetFolderPath(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const K=z.lastIndexOf("/");return K<0?a?z:"":z.substring(0,K+1)}static ToDegrees(z){return 180*z/Math.PI}static ToRadians(z){return z*Math.PI/180}static SmoothAngleChange(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const v=this.ToRadians(z),T=this.ToRadians(a);return this.ToDegrees(Math.atan2((1-K)*Math.sin(T)+K*Math.sin(v),(1-K)*Math.cos(T)+K*Math.cos(v)))}static MakeArray(z,a){return!0===a||void 0!==z&&null!=z?Array.isArray(z)?z:[z]:null}static GetPointerPrefix(z){return(0,T.m)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(z,a){(0,W.y)(z,a)}static SetReferrerPolicyBehavior(z,a){a.referrerPolicy=z}static get PreprocessUrl(){return W.e.PreprocessUrl}static set PreprocessUrl(z){W.e.PreprocessUrl=z}static LoadImage(z,a,K,v,T,m){return(0,W.p)(z,a,K,v,T,m)}static LoadFile(z,a,K,v,T,m){return(0,W.n)(z,a,K,v,T,m)}static LoadFileAsync(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((K,v)=>{(0,W.n)(z,(z=>{K(z)}),void 0,void 0,a,((z,a)=>{v(a)}))}))}static GetBabylonScriptURL(z,a){if(!z)return"";if(c.ScriptBaseUrl&&z.startsWith(c._DefaultCdnUrl)){const a="/"===c.ScriptBaseUrl[c.ScriptBaseUrl.length-1]?c.ScriptBaseUrl.substring(0,c.ScriptBaseUrl.length-1):c.ScriptBaseUrl;z=z.replace(c._DefaultCdnUrl,a)}return z=c.ScriptPreprocessUrl(z),a&&(z=c.GetAbsoluteUrl(z)),z}static LoadBabylonScript(z,a,K,v){z=c.GetBabylonScriptURL(z),c.LoadScript(z,a,K)}static LoadBabylonScriptAsync(z){return z=c.GetBabylonScriptURL(z),c.LoadScriptAsync(z)}static LoadScript(z,a,K,v){let m=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(z),a&&a()}catch(s){null===K||void 0===K||K(`Unable to load script '${z}' in worker`,s)}return}if(!(0,T.m)())return void(null===K||void 0===K||K(`Cannot load script '${z}' outside of a window or a worker`));const p=document.getElementsByTagName("head")[0],j=document.createElement("script");m?(j.setAttribute("type","module"),j.innerText=z):(j.setAttribute("type","text/javascript"),j.setAttribute("src",z)),v&&(j.id=v),j.onload=()=>{a&&a()},j.onerror=a=>{K&&K(`Unable to load script '${z}'`,a)},p.appendChild(j)}static LoadScriptAsync(z,a){return new Promise(((K,v)=>{this.LoadScript(z,(()=>{K()}),((z,a)=>{v(a||new Error(z))}),a)}))}static ReadFileAsDataURL(z,a,K){const T=new FileReader,m={onCompleteObservable:new v.c,abort:()=>T.abort()};return T.onloadend=()=>{m.onCompleteObservable.notifyObservers(m)},T.onload=z=>{a(z.target.result)},T.onprogress=K,T.readAsDataURL(z),m}static ReadFile(z,a,K,v,T){return(0,W.r)(z,a,K,v,T)}static FileAsURL(z){const a=new Blob([z]);return window.URL.createObjectURL(a)}static Format(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return z.toFixed(a)}static DeepCopy(z,a,K,v){p.b.DeepCopy(z,a,K,v)}static IsEmpty(z){for(const a in z)if(Object.prototype.hasOwnProperty.call(z,a))return!1;return!0}static RegisterTopRootEvents(z,a){for(let v=0;v<a.length;v++){const T=a[v];z.addEventListener(T.name,T.handler,!1);try{window.parent&&window.parent.addEventListener(T.name,T.handler,!1)}catch(K){}}}static UnregisterTopRootEvents(z,a){for(let v=0;v<a.length;v++){const T=a[v];z.removeEventListener(T.name,T.handler);try{z.parent&&z.parent.removeEventListener(T.name,T.handler)}catch(K){}}}static async DumpFramebuffer(z,a,K,v){throw(0,s.b)("DumpTools")}static DumpData(z,a,K,v){throw(0,s.b)("DumpTools")}static DumpDataAsync(z,a,K){throw(0,s.b)("DumpTools")}static _IsOffScreenCanvas(z){return void 0!==z.convertToBlob}static ToBlob(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",v=arguments.length>3?arguments[3]:void 0;c._IsOffScreenCanvas(z)||z.toBlob||(z.toBlob=function(z,a,K){setTimeout((()=>{const v=atob(this.toDataURL(a,K).split(",")[1]),T=v.length,m=new Uint8Array(T);for(let z=0;z<T;z++)m[z]=v.charCodeAt(z);z(new Blob([m]))}))}),c._IsOffScreenCanvas(z)?z.convertToBlob({type:K,quality:v}).then((z=>a(z))):z.toBlob((function(z){a(z)}),K,v)}static DownloadBlob(z,a){if("download"in document.createElement("a")){if(!a){const z=new Date;a="screenshot_"+((z.getFullYear()+"-"+(z.getMonth()+1)).slice(2)+"-"+z.getDate()+"_"+z.getHours()+"-"+("0"+z.getMinutes()).slice(-2))+".png"}c.Download(z,a)}else if(z&&"undefined"!==typeof URL){const a=URL.createObjectURL(z),K=window.open("");if(!K)return;const v=K.document.createElement("img");v.onload=function(){URL.revokeObjectURL(a)},v.src=a,K.document.body.appendChild(v)}}static EncodeScreenshotCanvasData(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",v=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0;if("string"!==typeof v&&a){if(a){if(c._IsOffScreenCanvas(z))return void z.convertToBlob({type:K,quality:T}).then((z=>{const K=new FileReader;K.readAsDataURL(z),K.onloadend=()=>{const z=K.result;a(z)}}));const v=z.toDataURL(K,T);a(v)}}else this.ToBlob(z,(function(z){z&&c.DownloadBlob(z,v),a&&a("")}),K,T)}static Download(z,a){if("undefined"===typeof URL)return;const K=window.URL.createObjectURL(z),v=document.createElement("a");document.body.appendChild(v),v.style.display="none",v.href=K,v.download=a,v.addEventListener("click",(()=>{v.parentElement&&v.parentElement.removeChild(v)})),v.click(),window.URL.revokeObjectURL(K)}static BackCompatCameraNoPreventDefault(z){return"boolean"===typeof z[0]?z[0]:"boolean"===typeof z[1]&&z[1]}static CreateScreenshot(z,a,K,v){throw(0,s.b)("ScreenshotTools")}static CreateScreenshotAsync(z,a,K){throw(0,s.b)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(z,a,K,v){throw(0,s.b)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(z,a,K){throw(0,s.b)("ScreenshotTools")}static RandomId(){return(0,l.c)()}static IsBase64(z){return(0,W.f)(z)}static DecodeBase64(z){return(0,W.b)(z)}static get errorsCount(){return m.c.errorsCount}static Log(z){m.c.Log(z)}static Warn(z){m.c.Warn(z)}static Error(z){m.c.Error(z)}static get LogCache(){return m.c.LogCache}static ClearLogCache(){m.c.ClearLogCache()}static set LogLevels(z){m.c.LogLevels=z}static set PerformanceLogLevel(z){return(z&c.PerformanceUserMarkLogLevel)===c.PerformanceUserMarkLogLevel?(c.StartPerformanceCounter=c._StartUserMark,void(c.EndPerformanceCounter=c._EndUserMark)):(z&c.PerformanceConsoleLogLevel)===c.PerformanceConsoleLogLevel?(c.StartPerformanceCounter=c._StartPerformanceConsole,void(c.EndPerformanceCounter=c._EndPerformanceConsole)):(c.StartPerformanceCounter=c._StartPerformanceCounterDisabled,void(c.EndPerformanceCounter=c._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(z,a){}static _EndPerformanceCounterDisabled(z,a){}static _StartUserMark(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!c._Performance){if(!(0,T.m)())return;c._Performance=window.performance}a&&c._Performance.mark&&c._Performance.mark(z+"-Begin")}static _EndUserMark(z){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&c._Performance.mark&&(c._Performance.mark(z+"-End"),c._Performance.measure(z,z+"-Begin",z+"-End"))}static _StartPerformanceConsole(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];a&&(c._StartUserMark(z,a),console.time&&console.time(z))}static _EndPerformanceConsole(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];a&&(c._EndUserMark(z,a),console.timeEnd(z))}static get Now(){return j.d.Now}static GetClassName(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=null;if(!a&&z.getClassName)K=z.getClassName();else{if(z instanceof Object){K=(a?z:Object.getPrototypeOf(z)).constructor.__bjsclassName__}K||(K=typeof z)}return K}static First(z,a){for(const K of z)if(a(K))return K;return null}static getFullClassName(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=null,v=null;if(!a&&z.getClassName)K=z.getClassName();else{if(z instanceof Object){const T=a?z:Object.getPrototypeOf(z);K=T.constructor.__bjsclassName__,v=T.constructor.__bjsmoduleName__}K||(K=typeof z)}return K?(null!=v?v+".":"")+K:null}static DelayAsync(z){return new Promise((a=>{setTimeout((()=>{a()}),z)}))}static IsSafari(){return!!(0,T.j)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}c.UseCustomRequestHeaders=!1,c.CustomRequestHeaders=M.b.CustomRequestHeaders,c.GetDOMTextContent=T.c,c._DefaultCdnUrl="https://cdn.babylonjs.com",c.GetAbsoluteUrl="object"===typeof document?z=>{const a=document.createElement("a");return a.href=z,a.href}:"function"===typeof URL&&"object"===typeof location?z=>new URL(z,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},c.NoneLogLevel=m.c.NoneLogLevel,c.MessageLogLevel=m.c.MessageLogLevel,c.WarningLogLevel=m.c.WarningLogLevel,c.ErrorLogLevel=m.c.ErrorLogLevel,c.AllLogLevel=m.c.AllLogLevel,c.IsWindowObjectExist=T.m,c.PerformanceNoneLogLevel=0,c.PerformanceUserMarkLogLevel=1,c.PerformanceConsoleLogLevel=2,c.StartPerformanceCounter=c._StartPerformanceCounterDisabled,c.EndPerformanceCounter=c._EndPerformanceCounterDisabled;class C{constructor(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=z,this.index=v-1,this._done=!1,this._fn=a,this._successCallback=K}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(z,a,K){const v=new C(z,a,K,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return v.executeNext(),v}static SyncAsyncForLoop(z,a,K,v,T){let m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return C.Run(Math.ceil(z/a),(v=>{T&&T()?v.breakLoop():setTimeout((()=>{for(let m=0;m<a;++m){const p=v.index*a+m;if(p>=z)break;if(K(p),T&&T()){v.breakLoop();break}}v.executeNext()}),m)}),v)}}c.Mix=V.k,c.IsExponentOfTwo=V.i,r.b.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},10767:(z,a,K)=>{"use strict";K.d(a,{c:()=>m,e:()=>T});const v={};function T(z,a){v[z]=a}function m(z){return v[z]}},11046:(z,a,K)=>{"use strict";K.d(a,{d:()=>v});class v{static get UniqueId(){const z=this._UniqueIdCounter;return this._UniqueIdCounter++,z}}v._UniqueIdCounter=1},10672:(z,a,K)=>{"use strict";K.d(a,{b:()=>v});class v{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(v.CustomRequestHeaders).length>0||v.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const z in v.CustomRequestHeaders){const a=v.CustomRequestHeaders[z];a&&this._xhr.setRequestHeader(z,a)}}_shouldSkipRequestModifications(z){return v.SkipRequestModificationForBabylonCDN&&(z.includes("preview.babylonjs.com")||z.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(z){this._xhr.onprogress=z}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(z){this._xhr.responseType=z}get timeout(){return this._xhr.timeout}set timeout(z){this._xhr.timeout=z}addEventListener(z,a,K){this._xhr.addEventListener(z,a,K)}removeEventListener(z,a,K){this._xhr.removeEventListener(z,a,K)}abort(){this._xhr.abort()}send(z){v.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(z)}open(z,a){for(const K of v.CustomRequestModifiers){if(this._shouldSkipRequestModifications(a))return;K(this._xhr,a)}a=(a=a.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=a,this._xhr.open(z,a,!0)}setRequestHeader(z,a){this._xhr.setRequestHeader(z,a)}getResponseHeader(z){return this._xhr.getResponseHeader(z)}}v.CustomRequestHeaders={},v.CustomRequestModifiers=new Array,v.SkipRequestModificationForBabylonCDN=!0},11998:(z,a,K)=>{"use strict";K.d(a,{c:()=>T});class v{constructor(z){this._pendingActions=new Array,this._workerInfos=z.map((z=>({workerPromise:Promise.resolve(z),idle:!0})))}dispose(){for(const z of this._workerInfos)z.workerPromise.then((z=>{z.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(z){this._executeOnIdleWorker(z)||this._pendingActions.push(z)}_executeOnIdleWorker(z){for(const a of this._workerInfos)if(a.idle)return this._execute(a,z),!0;return!1}_execute(z,a){z.idle=!1,z.workerPromise.then((K=>{a(K,(()=>{const a=this._pendingActions.shift();a?this._execute(z,a):z.idle=!0}))}))}}class T extends v{constructor(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.DefaultOptions;super([]),this._maxWorkers=z,this._createWorkerAsync=a,this._options=K}push(z){if(!this._executeOnIdleWorker(z))if(this._workerInfos.length<this._maxWorkers){const a={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(a),this._execute(a,z)}else this._pendingActions.push(z)}_execute(z,a){z.timeoutId&&(clearTimeout(z.timeoutId),delete z.timeoutId),super._execute(z,((K,v)=>{a(K,(()=>{v(),z.idle&&(z.timeoutId=setTimeout((()=>{z.workerPromise.then((z=>{z.terminate()}));const a=this._workerInfos.indexOf(z);-1!==a&&this._workerInfos.splice(a,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}T.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11368:(z,a,K)=>{"use strict";K.d(a,{e:()=>Cz});var v=K(10941),T=K(11127);class m extends T.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var p=K(10971),j=(K(11375),K(10767));class s{get noiseTexture(){return this._noiseTexture}set noiseTexture(z){this._noiseTexture!==z&&(this._noiseTexture=z,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(z){this._isAnimationSheetEnabled!=z&&(this._isAnimationSheetEnabled=z,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(z){this._useLogarithmicDepth=z&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:v.o.Zero()}set direction1(z){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=z)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:v.o.Zero()}set direction2(z){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=z)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:v.o.Zero()}set minEmitBox(z){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=z)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:v.o.Zero()}set maxEmitBox(z){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=z)}get billboardMode(){return this._billboardMode}set billboardMode(z){this._billboardMode!==z&&(this._billboardMode=z,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(z){this._isBillboardBased!==z&&(this._isBillboardBased=z,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(z){this._attachImageProcessingConfiguration(z)}_attachImageProcessingConfiguration(z){z!==this._imageProcessingConfiguration&&(!z&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=z)}_reset(){}_removeGradientAndTexture(z,a,K){if(!a)return this;let v=0;for(const T of a){if(T.gradient===z){a.splice(v,1);break}v++}return K&&K.dispose(),this}constructor(z){this.animations=[],this.renderingGroupId=0,this.j=v.o.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new v.o(10,10,10),this.onAnimationEnd=null,this.blendMode=s.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new v.m(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Pf=new v.o(0,0,0),this._useLogarithmicDepth=!1,this.gravity=v.o.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new p.d(1,1,1,1),this.color2=new p.d(1,1,1,1),this.colorDead=new p.d(0,0,0,1),this.textureMask=new p.d(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new m,this.id=z,this.name=z}createPointEmitter(z,a){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new v.o(0,1,0),arguments.length>2&&void 0!==arguments[2]||new v.o(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new v.o(0,1,0),arguments.length>4&&void 0!==arguments[4]||new v.o(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new v.o(0,1,0),arguments.length>3&&void 0!==arguments[3]||new v.o(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(z,a,K,v){throw new Error("Method not implemented.")}}s.BLENDMODE_ONEONE=0,s.BLENDMODE_STANDARD=1,s.BLENDMODE_ADD=2,s.BLENDMODE_MULTIPLY=3,s.BLENDMODE_MULTIPLYADD=4,(0,j.e)("BABYLON.BaseParticleSystem",s);var M=K(10959),r=K(10653);class W{constructor(){this.direction1=new v.o(0,1,0),this.direction2=new v.o(0,1,0),this.minEmitBox=new v.o(-.5,-.5,-.5),this.maxEmitBox=new v.o(.5,.5,.5)}startDirectionFunction(z,a,K,T){const m=(0,M.v)(this.direction1.x,this.direction2.x),p=(0,M.v)(this.direction1.y,this.direction2.y),j=(0,M.v)(this.direction1.z,this.direction2.z);if(T)return a.x=m,a.y=p,void(a.z=j);v.o.TransformNormalFromFloatsToRef(m,p,j,z,a)}startPositionFunction(z,a,K,T){const m=(0,M.v)(this.minEmitBox.x,this.maxEmitBox.x),p=(0,M.v)(this.minEmitBox.y,this.maxEmitBox.y),j=(0,M.v)(this.minEmitBox.z,this.maxEmitBox.z);if(T)return a.x=m,a.y=p,void(a.z=j);v.o.TransformCoordinatesFromFloatsToRef(m,p,j,z,a)}clone(){const z=new W;return r.b.DeepCopy(this,z),z}applyToShader(z){z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2),z.setVector3("minEmitBox",this.minEmitBox),z.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(z){z.addUniform("direction1",3),z.addUniform("direction2",3),z.addUniform("minEmitBox",3),z.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.direction1=this.direction1.kj(),z.direction2=this.direction2.kj(),z.minEmitBox=this.minEmitBox.kj(),z.maxEmitBox=this.maxEmitBox.kj(),z}parse(z){v.o.FromArrayToRef(z.direction1,0,this.direction1),v.o.FromArrayToRef(z.direction2,0,this.direction2),v.o.FromArrayToRef(z.minEmitBox,0,this.minEmitBox),v.o.FromArrayToRef(z.maxEmitBox,0,this.maxEmitBox)}}class F{get radius(){return this._radius}set radius(z){this._radius=z,this._buildHeight()}get angle(){return this._angle}set angle(z){this._angle=z,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=K,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=a,this.radius=z}startDirectionFunction(z,a,K,T){T?v.j.gb[0].p(K.Td).normalize():K.position.subtractToRef(z.getTranslation(),v.j.gb[0]).normalize();const m=(0,M.v)(0,this.directionRandomizer),p=(0,M.v)(0,this.directionRandomizer),j=(0,M.v)(0,this.directionRandomizer);a.x=v.j.gb[0].x+m,a.y=v.j.gb[0].y+p,a.z=v.j.gb[0].z+j,a.normalize()}startPositionFunction(z,a,K,T){const m=(0,M.v)(0,2*Math.PI);let p;this.emitFromSpawnPointOnly?p=1e-4:(p=(0,M.v)(0,this.heightRange),p=1-p*p);let j=this._radius-(0,M.v)(0,this._radius*this.radiusRange);j*=p;const s=j*Math.sin(m),r=j*Math.cos(m),W=p*this._height;if(T)return a.x=s,a.y=W,void(a.z=r);v.o.TransformCoordinatesFromFloatsToRef(s,W,r,z,a)}clone(){const z=new F(this._radius,this._angle,this.directionRandomizer);return r.b.DeepCopy(this,z),z}applyToShader(z){z.setFloat2("radius",this._radius,this.radiusRange),z.setFloat("coneAngle",this._angle),z.setFloat2("height",this._height,this.heightRange),z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(z){z.addUniform("radius",2),z.addUniform("coneAngle",1),z.addUniform("height",2),z.addUniform("directionRandomizer",1)}getEffectDefines(){let z="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(z+="\n#define CONEEMITTERSPAWNPOINT"),z}getClassName(){return"ConeParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.radius=this._radius,z.angle=this._angle,z.directionRandomizer=this.directionRandomizer,z.radiusRange=this.radiusRange,z.heightRange=this.heightRange,z.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,z}parse(z){this.radius=z.radius,this.angle=z.angle,this.directionRandomizer=z.directionRandomizer,this.radiusRange=void 0!==z.radiusRange?z.radiusRange:1,this.heightRange=void 0!==z.radiusRange?z.heightRange:1,this.emitFromSpawnPointOnly=void 0!==z.emitFromSpawnPointOnly&&z.emitFromSpawnPointOnly}}class G extends F{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0),T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0);super(z,a),this.direction1=K,this.direction2=T}startDirectionFunction(z,a){const K=(0,M.v)(this.direction1.x,this.direction2.x),T=(0,M.v)(this.direction1.y,this.direction2.y),m=(0,M.v)(this.direction1.z,this.direction2.z);v.o.TransformNormalFromFloatsToRef(K,T,m,z,a)}clone(){const z=new G(this.radius,this.angle,this.direction1,this.direction2);return r.b.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("radiusRange",this.radiusRange),z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("radiusRange",1),z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const z=super.serialize();return z.direction1=this.direction1.kj(),z.direction2=this.direction2.kj(),z}parse(z){super.parse(z),this.direction1.p(z.direction1),this.direction2.p(z.direction2)}}class l{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=z,this.height=a,this.radiusRange=K,this.directionRandomizer=T,this._tempVector=v.o.Zero()}startDirectionFunction(z,a,K,T,m){K.position.subtractToRef(z.getTranslation(),this._tempVector),this._tempVector.normalize(),v.o.TransformNormalToRef(this._tempVector,m,this._tempVector);const p=(0,M.v)(-this.directionRandomizer/2,this.directionRandomizer/2);let j=Math.atan2(this._tempVector.x,this._tempVector.z);j+=(0,M.v)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=p,this._tempVector.x=Math.sin(j),this._tempVector.z=Math.cos(j),this._tempVector.normalize(),T?a.p(this._tempVector):v.o.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,z,a)}startPositionFunction(z,a,K,T){const m=(0,M.v)(-this.height/2,this.height/2),p=(0,M.v)(0,2*Math.PI),j=(0,M.v)((1-this.radiusRange)*(1-this.radiusRange),1),s=Math.sqrt(j)*this.radius,r=s*Math.cos(p),W=s*Math.sin(p);T?a.Xd(r,m,W):v.o.TransformCoordinatesFromFloatsToRef(r,m,W,z,a)}clone(){const z=new l(this.radius,this.directionRandomizer);return r.b.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("height",this.height),z.setFloat("radiusRange",this.radiusRange),z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("height",1),z.addUniform("radiusRange",1),z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.radius=this.radius,z.height=this.height,z.radiusRange=this.radiusRange,z.directionRandomizer=this.directionRandomizer,z}parse(z){this.radius=z.radius,this.height=z.height,this.radiusRange=z.radiusRange,this.directionRandomizer=z.directionRandomizer}}class V extends l{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0),m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new v.o(0,1,0);super(z,a,K),this.direction1=T,this.direction2=m}startDirectionFunction(z,a,K,T){const m=(0,M.v)(this.direction1.x,this.direction2.x),p=(0,M.v)(this.direction1.y,this.direction2.y),j=(0,M.v)(this.direction1.z,this.direction2.z);T?a.Xd(m,p,j):v.o.TransformNormalFromFloatsToRef(m,p,j,z,a)}clone(){const z=new V(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return r.b.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("height",this.height),z.setFloat("radiusRange",this.radiusRange),z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("height",1),z.addUniform("radiusRange",1),z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const z=super.serialize();return z.direction1=this.direction1.kj(),z.direction2=this.direction2.kj(),z}parse(z){super.parse(z),v.o.FromArrayToRef(z.direction1,0,this.direction1),v.o.FromArrayToRef(z.direction2,0,this.direction2)}}class c{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=z,this.radiusRange=a,this.directionRandomizer=K}startDirectionFunction(z,a,K,T){const m=K.position.sc(z.getTranslation()).normalize(),p=(0,M.v)(0,this.directionRandomizer),j=(0,M.v)(0,this.directionRandomizer),s=(0,M.v)(0,this.directionRandomizer);m.x+=p,m.y+=j,m.z+=s,m.normalize(),T?a.p(m):v.o.TransformNormalFromFloatsToRef(m.x,m.y,m.z,z,a)}startPositionFunction(z,a,K,T){const m=this.radius-(0,M.v)(0,this.radius*this.radiusRange),p=(0,M.v)(0,1),j=(0,M.v)(0,2*Math.PI),s=Math.acos(2*p-1),r=m*Math.cos(j)*Math.sin(s),W=m*Math.cos(s),F=m*Math.sin(j)*Math.sin(s);T?a.Xd(r,Math.abs(W),F):v.o.TransformCoordinatesFromFloatsToRef(r,Math.abs(W),F,z,a)}clone(){const z=new c(this.radius,this.directionRandomizer);return r.b.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("radiusRange",this.radiusRange),z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("radiusRange",1),z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.radius=this.radius,z.radiusRange=this.radiusRange,z.directionRandomizer=this.directionRandomizer,z}parse(z){this.radius=z.radius,this.radiusRange=z.radiusRange,this.directionRandomizer=z.directionRandomizer}}class C{constructor(){this.direction1=new v.o(0,1,0),this.direction2=new v.o(0,1,0)}startDirectionFunction(z,a,K,T){const m=(0,M.v)(this.direction1.x,this.direction2.x),p=(0,M.v)(this.direction1.y,this.direction2.y),j=(0,M.v)(this.direction1.z,this.direction2.z);T?a.Xd(m,p,j):v.o.TransformNormalFromFloatsToRef(m,p,j,z,a)}startPositionFunction(z,a,K,T){T?a.Xd(0,0,0):v.o.TransformCoordinatesFromFloatsToRef(0,0,0,z,a)}clone(){const z=new C;return r.b.DeepCopy(this,z),z}applyToShader(z){z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.direction1=this.direction1.kj(),z.direction2=this.direction2.kj(),z}parse(z){v.o.FromArrayToRef(z.direction1,0,this.direction1),v.o.FromArrayToRef(z.direction2,0,this.direction2)}}class w{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=z,this.radiusRange=a,this.directionRandomizer=K}startDirectionFunction(z,a,K,T){const m=K.position.sc(z.getTranslation()).normalize(),p=(0,M.v)(0,this.directionRandomizer),j=(0,M.v)(0,this.directionRandomizer),s=(0,M.v)(0,this.directionRandomizer);m.x+=p,m.y+=j,m.z+=s,m.normalize(),T?a.p(m):v.o.TransformNormalFromFloatsToRef(m.x,m.y,m.z,z,a)}startPositionFunction(z,a,K,T){const m=this.radius-(0,M.v)(0,this.radius*this.radiusRange),p=(0,M.v)(0,1),j=(0,M.v)(0,2*Math.PI),s=Math.acos(2*p-1),r=m*Math.cos(j)*Math.sin(s),W=m*Math.cos(s),F=m*Math.sin(j)*Math.sin(s);T?a.Xd(r,W,F):v.o.TransformCoordinatesFromFloatsToRef(r,W,F,z,a)}clone(){const z=new w(this.radius,this.directionRandomizer);return r.b.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("radiusRange",this.radiusRange),z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("radiusRange",1),z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.radius=this.radius,z.radiusRange=this.radiusRange,z.directionRandomizer=this.directionRandomizer,z}parse(z){this.radius=z.radius,this.radiusRange=z.radiusRange,this.directionRandomizer=z.directionRandomizer}}class H extends w{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v.o(0,1,0),K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0);super(z),this.direction1=a,this.direction2=K}startDirectionFunction(z,a){const K=(0,M.v)(this.direction1.x,this.direction2.x),T=(0,M.v)(this.direction1.y,this.direction2.y),m=(0,M.v)(this.direction1.z,this.direction2.z);v.o.TransformNormalFromFloatsToRef(K,T,m,z,a)}clone(){const z=new H(this.radius,this.direction1,this.direction2);return r.b.DeepCopy(this,z),z}applyToShader(z){z.setFloat("radius",this.radius),z.setFloat("radiusRange",this.radiusRange),z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("radius",1),z.addUniform("radiusRange",1),z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const z=super.serialize();return z.direction1=this.direction1.kj(),z.direction2=this.direction2.kj(),z}parse(z){super.parse(z),this.direction1.p(z.direction1),this.direction2.p(z.direction2)}}class f{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(z,a,K,T){const m=v.j.gb[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,K,m);const z=v.j.gb[1];m.subtractToRef(K.position,z),z.scaleToRef(1/K.lifeTime,m)}else m.set(0,0,0);T?a.p(m):v.o.TransformNormalToRef(m,z,a)}startPositionFunction(z,a,K,T){const m=v.j.gb[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,K,m):m.set(0,0,0),T?a.p(m):v.o.TransformCoordinatesToRef(m,z,a)}clone(){const z=new f;return r.b.DeepCopy(this,z),z}applyToShader(z){}buildUniformLayout(z){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const z={};return z.type=this.getClassName(),z.particlePositionGenerator=this.particlePositionGenerator,z.particleDestinationGenerator=this.particleDestinationGenerator,z}parse(z){z.particlePositionGenerator&&(this.particlePositionGenerator=z.particlePositionGenerator),z.particleDestinationGenerator&&(this.particleDestinationGenerator=z.particleDestinationGenerator)}}var Y=K(11001);class I{get mesh(){return this._mesh}set mesh(z){this._mesh!==z&&(this._mesh=z,z?(this._indices=z.Rf(),this._positions=z.getVerticesData(Y.h.PositionKind),this._normals=z.getVerticesData(Y.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=v.o.Zero(),this._mesh=null,this.direction1=new v.o(0,1,0),this.direction2=new v.o(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=z}startDirectionFunction(z,a,K,T){if(this.useMeshNormalsForDirection&&this._normals)return void v.o.TransformNormalToRef(this._storedNormal,z,a);const m=(0,M.v)(this.direction1.x,this.direction2.x),p=(0,M.v)(this.direction1.y,this.direction2.y),j=(0,M.v)(this.direction1.z,this.direction2.z);T?a.Xd(m,p,j):v.o.TransformNormalFromFloatsToRef(m,p,j,z,a)}startPositionFunction(z,a,K,T){if(!this._indices||!this._positions)return;const m=3*Math.random()*(this._indices.length/3)|0,p=Math.random(),j=Math.random()*(1-p),s=1-p-j,M=this._indices[m],r=this._indices[m+1],W=this._indices[m+2],F=v.j.gb[0],G=v.j.gb[1],l=v.j.gb[2],V=v.j.gb[3];v.o.FromArrayToRef(this._positions,3*M,F),v.o.FromArrayToRef(this._positions,3*r,G),v.o.FromArrayToRef(this._positions,3*W,l),V.x=p*F.x+j*G.x+s*l.x,V.y=p*F.y+j*G.y+s*l.y,V.z=p*F.z+j*G.z+s*l.z,T?a.Xd(V.x,V.y,V.z):v.o.TransformCoordinatesFromFloatsToRef(V.x,V.y,V.z,z,a),this.useMeshNormalsForDirection&&this._normals&&(v.o.FromArrayToRef(this._normals,3*M,F),v.o.FromArrayToRef(this._normals,3*r,G),v.o.FromArrayToRef(this._normals,3*W,l),this._storedNormal.x=p*F.x+j*G.x+s*l.x,this._storedNormal.y=p*F.y+j*G.y+s*l.y,this._storedNormal.z=p*F.z+j*G.z+s*l.z)}clone(){const z=new I(this.mesh);return r.b.DeepCopy(this,z),z}applyToShader(z){z.setVector3("direction1",this.direction1),z.setVector3("direction2",this.direction2)}buildUniformLayout(z){z.addUniform("direction1",3),z.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var z;const a={};return a.type=this.getClassName(),a.direction1=this.direction1.kj(),a.direction2=this.direction2.kj(),a.meshId=null===(z=this.mesh)||void 0===z?void 0:z.id,a.useMeshNormalsForDirection=this.useMeshNormalsForDirection,a}parse(z,a){v.o.FromArrayToRef(z.direction1,0,this.direction1),v.o.FromArrayToRef(z.direction2,0,this.direction2),z.meshId&&a&&(this.mesh=a.getLastMeshById(z.meshId)),this.useMeshNormalsForDirection=z.useMeshNormalsForDirection}}var q=K(10720);class B{_isUbo(z){return void 0!==z.addUniform}constructor(z){this._isUbo(z)?(this.setMatrix3x3=z.updateMatrix3x3.bind(z),this.setMatrix2x2=z.updateMatrix2x2.bind(z),this.setFloat=z.updateFloat.bind(z),this.setFloat2=z.updateFloat2.bind(z),this.setFloat3=z.updateFloat3.bind(z),this.setFloat4=z.updateFloat4.bind(z),this.setFloatArray=z.updateFloatArray.bind(z),this.setArray=z.updateArray.bind(z),this.setIntArray=z.updateIntArray.bind(z),this.setMatrix=z.Jj.bind(z),this.setMatrices=z.updateMatrices.bind(z),this.setVector3=z.updateVector3.bind(z),this.setVector4=z.updateVector4.bind(z),this.setColor3=z.updateColor3.bind(z),this.setColor4=z.updateColor4.bind(z),this.setDirectColor4=z.updateDirectColor4.bind(z),this.setInt=z.updateInt.bind(z),this.setInt2=z.updateInt2.bind(z),this.setInt3=z.updateInt3.bind(z),this.setInt4=z.updateInt4.bind(z)):(this.setMatrix3x3=z.setMatrix3x3.bind(z),this.setMatrix2x2=z.setMatrix2x2.bind(z),this.setFloat=z.setFloat.bind(z),this.setFloat2=z.setFloat2.bind(z),this.setFloat3=z.setFloat3.bind(z),this.setFloat4=z.setFloat4.bind(z),this.setFloatArray=z.setFloatArray.bind(z),this.setArray=z.setArray.bind(z),this.setIntArray=z.setIntArray.bind(z),this.setMatrix=z.setMatrix.bind(z),this.setMatrices=z.setMatrices.bind(z),this.setVector3=z.setVector3.bind(z),this.setVector4=z.setVector4.bind(z),this.setColor3=z.setColor3.bind(z),this.setColor4=z.setColor4.bind(z),this.setDirectColor4=z.setDirectColor4.bind(z),this.setInt=z.setInt.bind(z),this.setInt2=z.setInt2.bind(z),this.setInt3=z.setInt3.bind(z),this.setInt4=z.setInt4.bind(z))}}var x=K(10726);const Z="gpuUpdateParticlesPixelShader",y="#version 300 es\nvoid main() {discard;}\n";x.b.ShadersStore[Z]=y;const i="gpuUpdateParticlesVertexShader",n="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";x.b.ShadersStore[i]=n;(0,j.e)("BABYLON.WebGL2ParticleSystem",class{constructor(z,a){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=z,this._engine=a,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var z;return(null===(z=this._updateEffect)||void 0===z?void 0:z.isReady())??!1}createUpdateBuffer(z){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof f&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=z,this._updateEffect=new q.c("gpuUpdateParticles",this._updateEffectOptions,this._engine),new B(this._updateEffect)}createVertexBuffers(z,a){this._updateVAO.push(this._createUpdateVAO(z)),this._renderVAO.push(this._engine.recordVertexArrayObject(a,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=a}createParticleBuffer(z){return z}bindDrawBuffers(z,a,K){K?this._engine.bindBuffers(this._renderVertexBuffers,K,a):this._engine.bindVertexArrayObject(this._renderVAO[z],null)}preUpdateParticleBuffer(){const z=this._engine;if(this._engine.enableEffect(this._updateEffect),!z.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(z,a,K){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[z],null);const v=this._engine;v.bindTransformFeedbackBuffer(a.getBuffer()),v.setRasterizerState(!1),v.beginTransformFeedback(!0),v.drawArraysType(3,0,K),v.endTransformFeedback(),v.setRasterizerState(!0),v.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let z=0;z<this._updateVAO.length;z++)this._engine.releaseVertexArrayObject(this._updateVAO[z]);this._updateVAO.length=0;for(let z=0;z<this._renderVAO.length;z++)this._engine.releaseVertexArrayObject(this._renderVAO[z]);this._renderVAO.length=0}_createUpdateVAO(z){const a={};a.position=z.createVertexBuffer("position",0,3);let K=3;a.age=z.createVertexBuffer("age",K,1),K+=1,a.size=z.createVertexBuffer("size",K,3),K+=3,a.life=z.createVertexBuffer("life",K,1),K+=1,a.seed=z.createVertexBuffer("seed",K,4),K+=4,a.direction=z.createVertexBuffer("direction",K,3),K+=3,this._parent.particleEmitterType instanceof f&&(a.initialPosition=z.createVertexBuffer("initialPosition",K,3),K+=3),this._parent._colorGradientsTexture||(a.color=z.createVertexBuffer("color",K,4),K+=4),this._parent._isBillboardBased||(a.initialDirection=z.createVertexBuffer("initialDirection",K,3),K+=3),this._parent.noiseTexture&&(a.noiseCoordinates1=z.createVertexBuffer("noiseCoordinates1",K,3),K+=3,a.noiseCoordinates2=z.createVertexBuffer("noiseCoordinates2",K,3),K+=3),this._parent._angularSpeedGradientsTexture?(a.angle=z.createVertexBuffer("angle",K,1),K+=1):(a.angle=z.createVertexBuffer("angle",K,2),K+=2),this._parent._isAnimationSheetEnabled&&(a.cellIndex=z.createVertexBuffer("cellIndex",K,1),K+=1,this._parent.spriteRandomStartCell&&(a.cellStartOffset=z.createVertexBuffer("cellStartOffset",K,1),K+=1));const v=this._engine.recordVertexArrayObject(a,null,this._updateEffect);return this._engine.bindArrayBuffer(null),v}});class X{constructor(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,v=arguments.length>3?arguments[3]:void 0;this._engine=z,this._label=v,this._engine._storageBuffers.push(this),this._create(a,K)}_create(z,a){this._bufferSize=z,this._creationFlags=a,this._buffer=this._engine.createStorageBuffer(z,a,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(z,a,K){this._buffer&&this._engine.updateStorageBuffer(this._buffer,z,a,K)}read(z,a,K,v){return this._engine.readFromStorageBuffer(this._buffer,z,a,K,v)}dispose(){const z=this._engine._storageBuffers,a=z.indexOf(this);-1!==a&&(z[a]=z[z.length-1],z.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var P=K(10923),J=K(10927),o=K(10973),N=K(11134),A=K(11046),g=K(10648),d=K(10751),t=K(10788);class e{constructor(){this._gpuTimeInFrameId=-1,this.counter=new t.d}_addDuration(z,a){z<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==z?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(a,!1),this._gpuTimeInFrameId=z):this.counter.addCount(a,!1))}}class L{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=z,this._engine=a,this.uniqueId=A.d.UniqueId,a.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new e),this._engine.getCaps().supportComputeShaders?v.bindingsMapping?(this._context=a.createComputeContext(),this._shaderPath=K,this._options={bindingsMapping:{},defines:[],...v}):g.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):g.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(z,a){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const v=this._bindings[z];this._bindings[z]={type:K?0:4,object:a,indexInGroupEntries:null===v||void 0===v?void 0:v.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!v||v.object!==a||v.type!==this._bindings[z].type)}setStorageTexture(z,a){const K=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!K||K.object!==a),this._bindings[z]={type:1,object:a,indexInGroupEntries:null===K||void 0===K?void 0:K.indexInGroupEntries}}setExternalTexture(z,a){const K=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!K||K.object!==a),this._bindings[z]={type:6,object:a,indexInGroupEntries:null===K||void 0===K?void 0:K.indexInGroupEntries}}setVideoTexture(z,a){return!!a.externalTexture&&(this.setExternalTexture(z,a.externalTexture),!0)}setUniformBuffer(z,a){const K=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!K||K.object!==a),this._bindings[z]={type:L._BufferIsDataBuffer(a)?7:2,object:a,indexInGroupEntries:null===K||void 0===K?void 0:K.indexInGroupEntries}}setStorageBuffer(z,a){const K=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!K||K.object!==a),this._bindings[z]={type:L._BufferIsDataBuffer(a)?7:3,object:a,indexInGroupEntries:null===K||void 0===K?void 0:K.indexInGroupEntries}}setTextureSampler(z,a){const K=this._bindings[z];this._contextIsDirty||(this._contextIsDirty=!K||!a.compareSampler(K.object)),this._bindings[z]={type:5,object:a,indexInGroupEntries:null===K||void 0===K?void 0:K.indexInGroupEntries}}isReady(){let z=this._effect;for(const T in this._bindings){const z=this._bindings[T],a=z.type,K=z.object;switch(a){case 0:case 4:case 1:if(!K.isReady())return!1;break;case 6:if(!K.isReady())return!1;break}}const a=[],K=this._shaderPath;if(this._options.defines)for(let T=0;T<this._options.defines.length;T++)a.push(this._options.defines[T]);const v=a.join("\n");return this._cachedDefines!==v&&(this._cachedDefines=v,z=this._engine.createComputeEffect(K,{defines:v,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=z),!!z.isReady()}dispatch(z,a,K){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,z,a,K,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const K=L._BufferIsDataBuffer(z)?z:z.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,K,a,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const a in this._bindings){const K=this._bindings[a];if(!this._options.bindingsMapping[a])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+a+"'");switch(K.type){case 0:{const v=this._samplers[a],T=K.object;var z;if(!v||!T._texture||!v.compareSampler(T._texture))this._samplers[a]=(new d.d).setParameters(T.wrapU,T.wrapV,T.wrapR,T.anisotropicFilteringLevel,T._texture.samplingMode,null===(z=T._texture)||void 0===z?void 0:z._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const z=K.object;z.getBuffer()!==K.buffer&&(K.buffer=z.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((T=>{const m=()=>{this.dispatch(z,a,K)?T():setTimeout(m,v)};m()}))}serialize(){const z=o.e.Serialize(this);z.options=this._options,z.shaderPath=this._shaderPath,z.zj={},z.textures={};for(const a in this._bindings){const K=this._bindings[a],v=K.object;switch(K.type){case 0:case 4:case 1:{const T=v.serialize();T&&(z.textures[a]=T,z.zj[a]={type:K.type});break}}}return z}static Parse(z,a,K){const v=o.e.Parse((()=>new L(z.name,a.getEngine(),z.shaderPath,z.options)),z,a,K);for(const T in z.textures){const m=z.zj[T],p=N.d.Parse(z.textures[T],a,K);0===m.type?v.setTexture(T,p):4===m.type?v.setTexture(T,p,!1):v.setStorageTexture(T,p)}return v}static _BufferIsDataBuffer(z){return void 0!==z.underlyingResource}}(0,P.e)([(0,J.D)()],L.prototype,"name",void 0),(0,P.e)([(0,J.D)()],L.prototype,"fastMode",void 0),(0,j.e)("BABYLON.ComputeShader",L);var E=K(10991);const b="gpuUpdateParticlesComputeShader",D="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";x.b.ShadersStoreWGSL[b]=D;(0,j.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(z,a){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=z,this._engine=a}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var z;return(null===(z=this._updateComputeShader)||void 0===z?void 0:z.isReady())??!1}createUpdateBuffer(z){var a;const K={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(K.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(K.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(K.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(K.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(K.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(K.noiseTexture={group:1,binding:11}),this._updateComputeShader=new L("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:K,defines:z.split("\n")}),null===(a=this._simParamsComputeShader)||void 0===a||a.dispose(),this._simParamsComputeShader=new E.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new B(this._simParamsComputeShader)}createVertexBuffers(z,a){this._renderVertexBuffers.push(a)}createParticleBuffer(z){const a=new X(this._engine,4*z.length,11,"ComputeShaderParticleSystemBuffer");return a.update(z),this._bufferComputeShader.push(a),a.getBuffer()}bindDrawBuffers(z,a,K){this._engine.bindBuffers(this._renderVertexBuffers[z],K,a)}preUpdateParticleBuffer(){}updateParticleBuffer(z,a,K){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[z]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^z]),this._updateComputeShader.dispatch(Math.ceil(K/64))}releaseBuffers(){var z;for(let a=0;a<this._bufferComputeShader.length;++a)this._bufferComputeShader[a].dispose();this._bufferComputeShader.length=0,null===(z=this._simParamsComputeShader)||void 0===z||z.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class u{constructor(z,a,K){this.gradient=z,this.color1=a,this.color2=K}getColorToRef(z){this.color2?p.d.LerpToRef(this.color1,this.color2,Math.random(),z):z.p(this.color1)}}class U{constructor(z,a){this.gradient=z,this.color=a}}class R{constructor(z,a,K){this.gradient=z,this.factor1=a,this.factor2=K}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class k{static GetCurrentGradient(z,a,K){if(a[0].gradient>z)return void K(a[0],a[0],1);for(let T=0;T<a.length-1;T++){const v=a[T],m=a[T+1];if(z>=v.gradient&&z<=m.gradient){return void K(v,m,(z-v.gradient)/(m.gradient-v.gradient))}}const v=a.length-1;K(a[v],a[v],1)}}var h=K(10638),S=K(11401),Q=K(10680);class O{constructor(z){this.particleSystem=z,this.position=v.o.Zero(),this.direction=v.o.Zero(),this.color=new p.d(0,0,0,0),this.colorStep=new p.d(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new v.m(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new p.d(0,0,0,0),this._currentColor2=new p.d(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=O._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let z=this.age,a=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===a?(a=1,z=this._randomCellOffset):z+=this._randomCellOffset);const K=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let v;v=this._initialSpriteCellLoop?(0,M.e)(z*a%this.lifeTime/this.lifeTime):(0,M.e)(z*a/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+v*K|0}_inheritParticleInfoToSubEmitter(z){if(z.particleSystem.j.position){const a=z.particleSystem.j;if(a.position.p(this.position),z.inheritDirection){const z=v.j.gb[0];this.direction.normalizeToRef(z),a.setDirection(z,0,Math.PI/2)}}else{z.particleSystem.j.p(this.position)}this.direction.scaleToRef(z.inheritedVelocityAmount/2,v.j.gb[0]),z.particleSystem._inheritedVelocityOffset.p(v.j.gb[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((z=>{this._inheritParticleInfoToSubEmitter(z)}))}_reset(){this.age=0,this.id=O._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(z){z.position.p(this.position),this._initialDirection?z._initialDirection?z._initialDirection.p(this._initialDirection):z._initialDirection=this._initialDirection.clone():z._initialDirection=null,z.direction.p(this.direction),this.Td&&(z.Td?z.Td.p(this.Td):z.Td=this.Td.clone()),z.color.p(this.color),z.colorStep.p(this.colorStep),z.lifeTime=this.lifeTime,z.age=this.age,z._randomCellOffset=this._randomCellOffset,z.size=this.size,z.scale.p(this.scale),z.angle=this.angle,z.angularSpeed=this.angularSpeed,z.particleSystem=this.particleSystem,z.cellIndex=this.cellIndex,z.id=this.id,z._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(z._currentColorGradient=this._currentColorGradient,z._currentColor1.p(this._currentColor1),z._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(z._currentSizeGradient=this._currentSizeGradient,z._currentSize1=this._currentSize1,z._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(z._currentAngularSpeedGradient=this._currentAngularSpeedGradient,z._currentAngularSpeed1=this._currentAngularSpeed1,z._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(z._currentVelocityGradient=this._currentVelocityGradient,z._currentVelocity1=this._currentVelocity1,z._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(z._currentLimitVelocityGradient=this._currentLimitVelocityGradient,z._currentLimitVelocity1=this._currentLimitVelocity1,z._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(z._currentDragGradient=this._currentDragGradient,z._currentDrag1=this._currentDrag1,z._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(z._initialStartSpriteCellID=this._initialStartSpriteCellID,z._initialEndSpriteCellID=this._initialEndSpriteCellID,z._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(z.remapData&&this.remapData?z.remapData.p(this.remapData):z.remapData=new v.r(0,0,0,0)),this._randomNoiseCoordinates1&&(z._randomNoiseCoordinates1?(z._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),z._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(z._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),z._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}O._Count=0;var zz=K(11107),az=(K(11407),K(11119)),Kz=K(11114),vz=K(10986);class Tz extends s{set onDispose(z){this._onDisposeObserver&&this.lj.remove(this._onDisposeObserver),this._onDisposeObserver=this.lj.add(z)}get useRampGradients(){return this._useRampGradients}set useRampGradients(z){this._useRampGradients!==z&&(this._useRampGradients=z,this._resetEffect())}get particles(){return this.uj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.uj.length}getClassName(){return"zb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var z;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(z=this._customWrappers[a])||void 0===z?void 0:z.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[z]??this._customWrappers[0]}setCustomEffect(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[a]=new zz.e(this._engine),this._customWrappers[a].effect=z,this._customWrappers[a].drawContext&&(this._customWrappers[a].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new h.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(z,a,K){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]&&arguments[4],j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(z),this._emitterInverseWorldMatrix=v.b.Identity(),this._inheritedVelocityOffset=new v.o,this.lj=new h.c,this.onStoppedObservable=new h.c,this.uj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new p.d(0,0,0,0),this._colorDiff=new p.d(0,0,0,0),this._scaledDirection=v.o.Zero(),this._scaledGravity=v.o.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=z=>{},this.recycleParticle=z=>{const a=this.uj.pop();a!==z&&a.copyTo(z),this._stockParticles.push(a)},this._createParticle=()=>{let z;return 0!==this._stockParticles.length?(z=this._stockParticles.pop(),z._reset()):z=new O(this),this._prepareParticle(z),z},this._shadersLoaded=!1,this._capacity=a,this._epsilon=j,this._isAnimationSheetEnabled=m,K&&"Scene"!==K.getClassName()?(this._engine=K,this.defaultProjectionMatrix=v.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=K||Q.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.sj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new zz.e(this._engine)},this._customWrappers[0].effect=T,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new W;let s=null;this.updateFunction=z=>{let a=null;var K;this.noiseTexture&&(a=this.noiseTexture.getSize(),null===(K=this.noiseTexture.getContent())||void 0===K||K.then((z=>{s=z})));const T=z===this.uj;for(let m=0;m<z.length;m++){const K=z[m];let j=this._scaledUpdateSpeed;const r=K.age;if(K.age+=j,K.age>K.lifeTime){const z=K.age-r;j=(K.lifeTime-r)*j/z,K.age=K.lifeTime}const W=K.age/K.lifeTime;this._colorGradients&&this._colorGradients.length>0?k.GetCurrentGradient(W,this._colorGradients,((z,a,v)=>{z!==K._currentColorGradient&&(K._currentColor1.p(K._currentColor2),a.getColorToRef(K._currentColor2),K._currentColorGradient=z),p.d.LerpToRef(K._currentColor1,K._currentColor2,v,K.color)})):(K.colorStep.scaleToRef(j,this._scaledColorStep),K.color.addInPlace(this._scaledColorStep),K.color.a<0&&(K.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&k.GetCurrentGradient(W,this._angularSpeedGradients,((z,a,v)=>{z!==K._currentAngularSpeedGradient&&(K._currentAngularSpeed1=K._currentAngularSpeed2,K._currentAngularSpeed2=a.getFactor(),K._currentAngularSpeedGradient=z),K.angularSpeed=(0,M.q)(K._currentAngularSpeed1,K._currentAngularSpeed2,v)})),K.angle+=K.angularSpeed*j;let F=j;if(this._velocityGradients&&this._velocityGradients.length>0&&k.GetCurrentGradient(W,this._velocityGradients,((z,a,v)=>{z!==K._currentVelocityGradient&&(K._currentVelocity1=K._currentVelocity2,K._currentVelocity2=a.getFactor(),K._currentVelocityGradient=z),F*=(0,M.q)(K._currentVelocity1,K._currentVelocity2,v)})),K.direction.scaleToRef(F,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&k.GetCurrentGradient(W,this._limitVelocityGradients,((z,a,v)=>{z!==K._currentLimitVelocityGradient&&(K._currentLimitVelocity1=K._currentLimitVelocity2,K._currentLimitVelocity2=a.getFactor(),K._currentLimitVelocityGradient=z);const T=(0,M.q)(K._currentLimitVelocity1,K._currentLimitVelocity2,v);K.direction.length()>T&&K.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&k.GetCurrentGradient(W,this._dragGradients,((z,a,v)=>{z!==K._currentDragGradient&&(K._currentDrag1=K._currentDrag2,K._currentDrag2=a.getFactor(),K._currentDragGradient=z);const T=(0,M.q)(K._currentDrag1,K._currentDrag2,v);this._scaledDirection.scaleInPlace(1-T)})),this.isLocal&&K.Td?(K.Td.addInPlace(this._scaledDirection),v.o.TransformCoordinatesToRef(K.Td,this._emitterWorldMatrix,K.position)):K.position.addInPlace(this._scaledDirection),s&&a&&K._randomNoiseCoordinates1){const z=this._fetchR(K._randomNoiseCoordinates1.x,K._randomNoiseCoordinates1.y,a.width,a.height,s),T=this._fetchR(K._randomNoiseCoordinates1.z,K._randomNoiseCoordinates2.x,a.width,a.height,s),m=this._fetchR(K._randomNoiseCoordinates2.y,K._randomNoiseCoordinates2.z,a.width,a.height,s),p=v.j.gb[0],M=v.j.gb[1];p.Xd((2*z-1)*this.noiseStrength.x,(2*T-1)*this.noiseStrength.y,(2*m-1)*this.noiseStrength.z),p.scaleToRef(j,M),K.direction.addInPlace(M)}this.gravity.scaleToRef(j,this._scaledGravity),K.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&k.GetCurrentGradient(W,this._sizeGradients,((z,a,v)=>{z!==K._currentSizeGradient&&(K._currentSize1=K._currentSize2,K._currentSize2=a.getFactor(),K._currentSizeGradient=z),K.size=(0,M.q)(K._currentSize1,K._currentSize2,v)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&k.GetCurrentGradient(W,this._colorRemapGradients,((z,a,v)=>{const T=(0,M.q)(z.factor1,a.factor1,v),m=(0,M.q)(z.factor2,a.factor2,v);K.remapData.x=T,K.remapData.y=m-T})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&k.GetCurrentGradient(W,this._alphaRemapGradients,((z,a,v)=>{const T=(0,M.q)(z.factor1,a.factor1,v),m=(0,M.q)(z.factor2,a.factor2,v);K.remapData.z=T,K.remapData.w=m-T}))),this._isAnimationSheetEnabled&&K.updateCellIndex(),K._inheritParticleInfoToSubEmitters(),K.age>=K.lifeTime&&(this._emitFromParticle(K),K._attachedSubEmitters&&(K._attachedSubEmitters.forEach((z=>{z.particleSystem.disposeOnStop=!0,z.particleSystem.stop()})),K._attachedSubEmitters=null),this.recycleParticle(K),T&&m--)}}}serialize(z){throw new Error("Method not implemented.")}clone(z,a){throw new Error("Method not implemented.")}_addFactorGradient(z,a,K,v){const T=new R(a,K,v);z.push(T),z.sort(((z,a)=>z.gradient<a.gradient?-1:z.gradient>a.gradient?1:0))}_removeFactorGradient(z,a){if(!z)return;let K=0;for(const v of z){if(v.gradient===a){z.splice(K,1);break}K++}}addLifeTimeGradient(z,a,K){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,z,a,K),this}removeLifeTimeGradient(z){return this._removeFactorGradient(this._lifeTimeGradients,z),this}addSizeGradient(z,a,K){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,z,a,K),this}removeSizeGradient(z){return this._removeFactorGradient(this._sizeGradients,z),this}addColorRemapGradient(z,a,K){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,z,a,K),this}removeColorRemapGradient(z){return this._removeFactorGradient(this._colorRemapGradients,z),this}addAlphaRemapGradient(z,a,K){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,z,a,K),this}removeAlphaRemapGradient(z){return this._removeFactorGradient(this._alphaRemapGradients,z),this}addAngularSpeedGradient(z,a,K){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,z,a,K),this}removeAngularSpeedGradient(z){return this._removeFactorGradient(this._angularSpeedGradients,z),this}addVelocityGradient(z,a,K){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,z,a,K),this}removeVelocityGradient(z){return this._removeFactorGradient(this._velocityGradients,z),this}addLimitVelocityGradient(z,a,K){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,z,a,K),this}removeLimitVelocityGradient(z){return this._removeFactorGradient(this._limitVelocityGradients,z),this}addDragGradient(z,a,K){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,z,a,K),this}removeDragGradient(z){return this._removeFactorGradient(this._dragGradients,z),this}addEmitRateGradient(z,a,K){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,z,a,K),this}removeEmitRateGradient(z){return this._removeFactorGradient(this._emitRateGradients,z),this}addStartSizeGradient(z,a,K){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,z,a,K),this}removeStartSizeGradient(z){return this._removeFactorGradient(this._startSizeGradients,z),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const z=new Uint8Array(4*this._rawTextureWidth),a=p.f.ib[0];for(let K=0;K<this._rawTextureWidth;K++){const v=K/this._rawTextureWidth;k.GetCurrentGradient(v,this._rampGradients,((v,T,m)=>{p.c.LerpToRef(v.color,T.color,m,a),z[4*K]=255*a.r,z[4*K+1]=255*a.g,z[4*K+2]=255*a.b,z[4*K+3]=255}))}this._rampGradientsTexture=S.c.CreateRGBATexture(z,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((z,a)=>z.gradient<a.gradient?-1:z.gradient>a.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(z,a){this._rampGradients||(this._rampGradients=[]);const K=new U(z,a);return this._rampGradients.push(K),this._syncRampGradientTexture(),this}removeRampGradient(z){return this._removeGradientAndTexture(z,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(z,a,K){this._colorGradients||(this._colorGradients=[]);const v=new u(z,a,K);return this._colorGradients.push(v),this._colorGradients.sort(((z,a)=>z.gradient<a.gradient?-1:z.gradient>a.gradient?1:0)),this}removeColorGradient(z){if(!this._colorGradients)return this;let a=0;for(const K of this._colorGradients){if(K.gradient===z){this._colorGradients.splice(a,1);break}a++}return this}resetDrawCache(){for(const z of this._drawWrappers)if(z)for(const a of z)null===a||void 0===a||a.dispose();this._drawWrappers=[]}_fetchR(z,a,K,v,T){return T[4*(((z=.5*Math.abs(z)+.5)*K%K|0)+((a=.5*Math.abs(a)+.5)*v%v|0)*K)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const z=this._engine,a=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*a),this._vertexBuffer=new Y.e(z,this._vertexData,!0,a);let K=0;const v=this._vertexBuffer.createVertexBuffer(Y.h.PositionKind,K,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Y.h.PositionKind]=v,K+=3;const T=this._vertexBuffer.createVertexBuffer(Y.h.ColorKind,K,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Y.h.ColorKind]=T,K+=4;const m=this._vertexBuffer.createVertexBuffer("angle",K,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=m,K+=1;const p=this._vertexBuffer.createVertexBuffer("size",K,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=p,K+=2,this._isAnimationSheetEnabled){const z=this._vertexBuffer.createVertexBuffer("cellIndex",K,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=z,K+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const z=this._vertexBuffer.createVertexBuffer("direction",K,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=z,K+=3}if(this._useRampGradients){const z=this._vertexBuffer.createVertexBuffer("remapData",K,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=z,K+=4}let j;if(this._useInstancing){const a=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new Y.e(z,a,!1,2),j=this._spriteBuffer.createVertexBuffer("offset",0,2)}else j=this._vertexBuffer.createVertexBuffer("offset",K,2,this._vertexBufferSize,this._useInstancing),K+=2;this._vertexBuffers.offset=j,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const z=[],a=[];let K=0;for(let v=0;v<this._capacity;v++)z.push(K),z.push(K+1),z.push(K+2),z.push(K),z.push(K+2),z.push(K+3),a.push(K,K+1,K+1,K+2,K+2,K+3,K+3,K,K,K+3),K+=4;this._indexBuffer=this._engine.createIndexBuffer(z),this._linesIndexBuffer=this._engine.createIndexBuffer(a)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(z)setTimeout((()=>{this.start(0)}),z);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var a;-1!==(null===(a=this.j)||void 0===a?void 0:a.getClassName().indexOf("Mesh"))&&this.j.Qj(!0);const z=this.noiseTexture;if(z&&z.onGeneratedObservable)z.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let a=0;a<this.preWarmCycles;a++)this.animate(!0),z.render()}))}));else for(let a=0;a<this.preWarmCycles;a++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(z))}_postStop(z){}reset(){this._stockParticles.length=0,this.uj.length=0}_appendParticleVertex(z,a,K,T){let m=z*this._vertexBufferSize;if(this._vertexData[m++]=a.position.x+this.Pf.x,this._vertexData[m++]=a.position.y+this.Pf.y,this._vertexData[m++]=a.position.z+this.Pf.z,this._vertexData[m++]=a.color.r,this._vertexData[m++]=a.color.g,this._vertexData[m++]=a.color.b,this._vertexData[m++]=a.color.a,this._vertexData[m++]=a.angle,this._vertexData[m++]=a.scale.x*a.size,this._vertexData[m++]=a.scale.y*a.size,this._isAnimationSheetEnabled&&(this._vertexData[m++]=a.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[m++]=a.direction.x,this._vertexData[m++]=a.direction.y,this._vertexData[m++]=a.direction.z);else if(a._initialDirection){let z=a._initialDirection;this.isLocal&&(v.o.TransformNormalToRef(z,this._emitterWorldMatrix,v.j.gb[0]),z=v.j.gb[0]),0===z.x&&0===z.z&&(z.x=.001),this._vertexData[m++]=z.x,this._vertexData[m++]=z.y,this._vertexData[m++]=z.z}else{let z=a.direction;this.isLocal&&(v.o.TransformNormalToRef(z,this._emitterWorldMatrix,v.j.gb[0]),z=v.j.gb[0]),0===z.x&&0===z.z&&(z.x=.001),this._vertexData[m++]=z.x,this._vertexData[m++]=z.y,this._vertexData[m++]=z.z}this._useRampGradients&&a.remapData&&(this._vertexData[m++]=a.remapData.x,this._vertexData[m++]=a.remapData.y,this._vertexData[m++]=a.remapData.z,this._vertexData[m++]=a.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===K?K=this._epsilon:1===K&&(K=1-this._epsilon),0===T?T=this._epsilon:1===T&&(T=1-this._epsilon)),this._vertexData[m++]=K,this._vertexData[m++]=T)}_prepareParticle(z){}_update(z){if(this._alive=this.uj.length>0,this.j.position){const z=this.j;this._emitterWorldMatrix=z.getWorldMatrix()}else{const z=this.j;this._emitterWorldMatrix=v.b.Translation(z.x,z.y,z.z)}let a;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.uj);for(let K=0;K<z&&this.uj.length!==this._capacity;K++){if(a=this._createParticle(),this.uj.push(a),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const z=(0,M.e)(this._actualFrame/this.targetStopDuration);k.GetCurrentGradient(z,this._lifeTimeGradients,((K,v)=>{const T=K,m=v,p=T.getFactor(),j=m.getFactor(),s=(z-T.gradient)/(m.gradient-T.gradient);a.lifeTime=(0,M.q)(p,j,s)}))}else a.lifeTime=(0,M.v)(this.minLifeTime,this.maxLifeTime);const z=(0,M.v)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,a.position,a,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,a.position,a,this.isLocal),this.isLocal&&(a.Td?a.Td.p(a.position):a.Td=a.position.clone(),v.o.TransformCoordinatesToRef(a.Td,this._emitterWorldMatrix,a.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,a.direction,a,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,a.direction,a,this.isLocal,this._emitterInverseWorldMatrix),0===z?a._initialDirection?a._initialDirection.p(a.direction):a._initialDirection=a.direction.clone():a._initialDirection=null,a.direction.scaleInPlace(z),this._sizeGradients&&0!==this._sizeGradients.length?(a._currentSizeGradient=this._sizeGradients[0],a._currentSize1=a._currentSizeGradient.getFactor(),a.size=a._currentSize1,this._sizeGradients.length>1?a._currentSize2=this._sizeGradients[1].getFactor():a._currentSize2=a._currentSize1):a.size=(0,M.v)(this.minSize,this.maxSize),a.scale.Xd((0,M.v)(this.minScaleX,this.maxScaleX),(0,M.v)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const z=this._actualFrame/this.targetStopDuration;k.GetCurrentGradient(z,this._startSizeGradients,((z,K,v)=>{z!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=K.getFactor(),this._currentStartSizeGradient=z);const T=(0,M.q)(this._currentStartSize1,this._currentStartSize2,v);a.scale.scaleInPlace(T)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(a._currentAngularSpeedGradient=this._angularSpeedGradients[0],a.angularSpeed=a._currentAngularSpeedGradient.getFactor(),a._currentAngularSpeed1=a.angularSpeed,this._angularSpeedGradients.length>1?a._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():a._currentAngularSpeed2=a._currentAngularSpeed1):a.angularSpeed=(0,M.v)(this.minAngularSpeed,this.maxAngularSpeed),a.angle=(0,M.v)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(a._currentVelocityGradient=this._velocityGradients[0],a._currentVelocity1=a._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?a._currentVelocity2=this._velocityGradients[1].getFactor():a._currentVelocity2=a._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(a._currentLimitVelocityGradient=this._limitVelocityGradients[0],a._currentLimitVelocity1=a._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?a._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():a._currentLimitVelocity2=a._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(a._currentDragGradient=this._dragGradients[0],a._currentDrag1=a._currentDragGradient.getFactor(),this._dragGradients.length>1?a._currentDrag2=this._dragGradients[1].getFactor():a._currentDrag2=a._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)a._currentColorGradient=this._colorGradients[0],a._currentColorGradient.getColorToRef(a.color),a._currentColor1.p(a.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(a._currentColor2):a._currentColor2.p(a.color);else{const z=(0,M.v)(0,1);p.d.LerpToRef(this.color1,this.color2,z,a.color),this.colorDead.subtractToRef(a.color,this._colorDiff),this._colorDiff.scaleToRef(1/a.lifeTime,a.colorStep)}this._isAnimationSheetEnabled&&(a._initialStartSpriteCellID=this.startSpriteCellID,a._initialEndSpriteCellID=this.endSpriteCellID,a._initialSpriteCellLoop=this.spriteCellLoop),a.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(a.remapData=new v.r(0,1,0,1)),this.noiseTexture&&(a._randomNoiseCoordinates1?(a._randomNoiseCoordinates1.Xd(Math.random(),Math.random(),Math.random()),a._randomNoiseCoordinates2.Xd(Math.random(),Math.random(),Math.random())):(a._randomNoiseCoordinates1=new v.o(Math.random(),Math.random(),Math.random()),a._randomNoiseCoordinates2=new v.o(Math.random(),Math.random(),Math.random()))),a._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=[Y.h.PositionKind,Y.h.ColorKind,"angle","offset","size"];return z&&v.push("cellIndex"),a||v.push("direction"),K&&v.push("remapData"),v}static _GetEffectCreationOptions(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,az.e)(v),z&&v.push("particlesInfos"),a&&v.push("logarithmicDepthConstant"),K&&(v.push("vFogInfos"),v.push("vFogColor")),v}fillDefines(z,a){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,az.m)(this,this._scene,z),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&z.push("#define FOG")),this._isAnimationSheetEnabled&&z.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&z.push("#define LOGARITHMICDEPTH"),a===s.BLENDMODE_MULTIPLY&&z.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&z.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(z.push("#define BILLBOARD"),this.billboardMode){case 2:z.push("#define BILLBOARDY");break;case 8:case 9:z.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&z.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:z.push("#define BILLBOARDMODE_ALL")}K&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),z.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(z,a,K){a.push(...Tz._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),z.push(...Tz._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),K.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,vz.h)(z,this._imageProcessingConfigurationDefines),(0,vz.d)(K,this._imageProcessingConfigurationDefines))}_getWrapper(z){const a=this._getCustomDrawWrapper(z);if(null!==a&&void 0!==a&&a.effect)return a;const K=[];this.fillDefines(K,z);const v=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let T=this._drawWrappers[v];T||(T=this._drawWrappers[v]=[]);let m=T[z];m||(m=new zz.e(this._engine),m.drawContext&&(m.drawContext.useInstancing=this._useInstancing),T[z]=m);const p=K.join("\n");if(m.defines!==p){const z=[],a=[],K=[];this.fillUniformsAttributesAndSamplerNames(a,z,K),m.setEffect(this._engine.createEffect("particles",z,a,K,p,void 0,void 0,void 0,void 0,this._shaderLanguage),p)}return m}animate(){var z;let a,K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!K&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(K?this.preWarmStepOffset:(null===(z=this._scene)||void 0===z?void 0:z.getAnimationRatio())||1),this.manualEmitCount>-1)a=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let z=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const a=this._actualFrame/this.targetStopDuration;k.GetCurrentGradient(a,this._emitRateGradients,((a,K,v)=>{a!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=K.getFactor(),this._currentEmitRateGradient=a),z=(0,M.q)(this._currentEmitRate1,this._currentEmitRate2,v)}))}a=z*this._scaledUpdateSpeed|0,this._newPartsExcess+=z*this._scaledUpdateSpeed-a}if(this._newPartsExcess>1&&(a+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?a=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(a),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!K){let z=0;for(let a=0;a<this.uj.length;a++){const K=this.uj[a];this._appendParticleVertices(z,K),z+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.uj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(z,a){this._appendParticleVertex(z++,a,0,0),this._useInstancing||(this._appendParticleVertex(z++,a,1,0),this._appendParticleVertex(z++,a,1,1),this._appendParticleVertex(z++,a,0,1))}rebuild(){var z;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(z=this._spriteBuffer)||void 0===z||z._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Tz.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(K.bind(K,11688)),Promise.resolve().then(K.bind(K,11624))])):await Promise.all([Promise.resolve().then(K.bind(K,11615)),Promise.resolve().then(K.bind(K,11606))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==s.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(s.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(s.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(z){const a=this._getWrapper(z),K=a.effect,T=this._engine;T.enableEffect(a);const m=this.defaultViewMatrix??this._scene.getViewMatrix();if(K.setTexture("diffuseSampler",this.particleTexture),K.setMatrix("view",m),K.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const z=this.particleTexture.getBaseSize();K.setFloat3("particlesInfos",this.spriteCellWidth/z.width,this.spriteCellHeight/z.height,this.spriteCellWidth/z.width)}if(K.setVector2("translationPivot",this.translationPivot),K.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const z=this._scene.activeCamera;K.setVector3("eyePosition",z.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),K.setTexture("rampSampler",this._rampGradientsTexture));const p=K.defines;var j,M,r,W,F,G;(this._scene&&((0,az.h)(K,this,this._scene),this.applyFog&&(0,Kz.h)(this._scene,void 0,K)),p.indexOf("#define BILLBOARDMODE_ALL")>=0&&(m.invertToRef(v.j.Matrix[0]),K.setMatrix("invView",v.j.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?T.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,K):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,K)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?T.bindBuffers(this._vertexBuffers,null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?this._linesIndexBuffer:this._indexBuffer,K):T.bindBuffers(this._vertexBuffers,null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?this._linesIndexBufferUseInstancing:null,K);switch(this.useLogarithmicDepth&&this._scene&&(0,Kz.m)(p,K,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(K),z){case s.BLENDMODE_ADD:T.setAlphaMode(1);break;case s.BLENDMODE_ONEONE:T.setAlphaMode(6);break;case s.BLENDMODE_STANDARD:T.setAlphaMode(2);break;case s.BLENDMODE_MULTIPLY:T.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(K),this._useInstancing)?null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?T.drawElementsType(6,0,10,this.uj.length):T.drawArraysType(7,0,4,this.uj.length):null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?T.drawElementsType(1,0,10*this.uj.length):T.drawElementsType(0,0,6*this.uj.length);return this.uj.length}render(){if(!this.isReady()||!this.uj.length)return 0;const z=this._engine;z.setState&&(z.setState(!1),this.forceDepthWrite&&z.setDepthWrite(!0));let a=0;return a=this.blendMode===s.BLENDMODE_MULTIPLYADD?this._render(s.BLENDMODE_MULTIPLY)+this._render(s.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),a}_onDispose(){}dispose(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(a,K),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const z=this._scene.sj.indexOf(this);z>-1&&this._scene.sj.splice(z,1),this._scene._activeParticleSystems.dispose()}this.lj.notifyObservers(this),this.lj.clear(),this.onStoppedObservable.clear(),this.reset()}}Tz.ForceGLSL=!1;var mz,pz=K(10663);!function(z){z[z.ATTACHED=0]="ATTACHED",z[z.END=1]="END"}(mz||(mz={}));class jz{constructor(z){if(this.particleSystem=z,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!z.j||!z.j.dispose){const a=(0,j.c)("BABYLON.AbstractMesh");z.j=new a("SubemitterSystemEmitter",z.va()),z._disposeEmitterOnDispose=!0}}clone(){let z=this.particleSystem.j;if(z){if(z instanceof v.o)z=z.clone();else if(-1!==z.getClassName().indexOf("Mesh")){z=new((0,j.c)("BABYLON.Mesh"))("",z.va()),z.isVisible=!1}}else z=new v.o;const a=new jz(this.particleSystem.clone(this.particleSystem.name,z));return a.particleSystem.name+="Clone",a.type=this.type,a.inheritDirection=this.inheritDirection,a.inheritedVelocityAmount=this.inheritedVelocityAmount,a.particleSystem._disposeEmitterOnDispose=!0,a.particleSystem.disposeOnStop=!0,a}serialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={};return a.type=this.type,a.inheritDirection=this.inheritDirection,a.inheritedVelocityAmount=this.inheritedVelocityAmount,a.particleSystem=this.particleSystem.serialize(z),a}static _ParseParticleSystem(z,a,K){throw(0,pz.b)("ParseParticle")}static Parse(z,a,K){const v=z.particleSystem,T=new jz(jz._ParseParticleSystem(v,a,K,!0));return T.type=z.type,T.inheritDirection=z.inheritDirection,T.inheritedVelocityAmount=z.inheritedVelocityAmount,T.particleSystem._isSubEmitter=!0,T}dispose(){this.particleSystem.dispose()}}var sz=K(10715);function Mz(z,a){const K=new C;return K.direction1=z,K.direction2=a,K}function rz(){return new c(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Wz(){return new w(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Fz(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v.o(0,1,0),K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0);return new H(z,a,K)}function Gz(){return new l(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function lz(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0),m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new v.o(0,1,0);return new V(z,a,K,T,m)}function Vz(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new F(z,a)}function cz(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0),T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0);return new G(z,a,K,T)}class Cz extends Tz{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=z=>{if(!this._subEmitters||0===this._subEmitters.length)return;const a=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[a].forEach((a=>{if(1===a.type){const K=a.clone();z._inheritParticleInfoToSubEmitter(K),K.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(K.particleSystem),K.particleSystem.start()}}))}}createPointEmitter(z,a){const K=Mz(z,a);return this.particleEmitterType=K,K}createHemisphericEmitter(){const z=rz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=z,z}createSphereEmitter(){const z=Wz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=z,z}createDirectedSphereEmitter(){const z=Fz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v.o(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0));return this.particleEmitterType=z,z}createCylinderEmitter(){const z=Gz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=z,z}createDirectedCylinderEmitter(){const z=lz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new v.o(0,1,0));return this.particleEmitterType=z,z}createConeEmitter(){const z=Vz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=z,z}createDirectedConeEmitter(){const z=cz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0));return this.particleEmitterType=z,z}createBoxEmitter(z,a,K,v){const T=new W;return this.particleEmitterType=T,this.direction1=z,this.direction2=a,this.minEmitBox=K,this.maxEmitBox=v,T}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((z=>{z instanceof Cz?this._subEmitters.push([new jz(z)]):z instanceof jz?this._subEmitters.push([z]):z instanceof Array&&this._subEmitters.push(z)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((z=>{z.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const z=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==z&&this._rootParticleSystem.activeSubSystems.splice(z,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(z){z&&this._stopSubEmitters()}_prepareParticle(z){if(this._subEmitters&&this._subEmitters.length>0){const a=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];z._attachedSubEmitters=[],a.forEach((a=>{if(0===a.type){const K=a.clone();z._attachedSubEmitters.push(K),K.particleSystem.start()}}))}}_onDispose(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var K;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),z)&&(null===(K=this.particles)||void 0===K||K.forEach((z=>{if(z._attachedSubEmitters)for(let a=z._attachedSubEmitters.length-1;a>=0;a-=1)z._attachedSubEmitters[a].dispose()})));if(a&&this.activeSubSystems)for(let v=this.activeSubSystems.length-1;v>=0;v-=1)this.activeSubSystems[v].dispose();if(this._subEmitters&&this._subEmitters.length){for(let z=0;z<this._subEmitters.length;z++)for(const a of this._subEmitters[z])a.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(z,a,K,T){let m;m=K instanceof sz.b?null:K;const s=(0,j.c)("BABYLON.Texture");if(s&&m&&(z.texture?a.particleTexture=s.Parse(z.texture,m,T):z.textureName&&(a.particleTexture=new s(T+z.textureName,m,!1,void 0===z.invertY||z.invertY),a.particleTexture.name=z.textureName)),z.emitterId||0===z.emitterId||void 0!==z.j?z.emitterId&&m?a.j=m.getLastMeshById(z.emitterId):a.j=v.o.Jg(z.j):a.j=v.o.Zero(),a.isLocal=!!z.isLocal,void 0!==z.renderingGroupId&&(a.renderingGroupId=z.renderingGroupId),void 0!==z.isBillboardBased&&(a.isBillboardBased=z.isBillboardBased),void 0!==z.billboardMode&&(a.billboardMode=z.billboardMode),void 0!==z.useLogarithmicDepth&&(a.useLogarithmicDepth=z.useLogarithmicDepth),z.animations){for(let K=0;K<z.animations.length;K++){const v=z.animations[K],T=(0,j.c)("BABYLON.Animation");T&&a.animations.push(T.Parse(v))}a.beginAnimationOnStart=z.beginAnimationOnStart,a.beginAnimationFrom=z.beginAnimationFrom,a.beginAnimationTo=z.beginAnimationTo,a.beginAnimationLoop=z.beginAnimationLoop}if(z.autoAnimate&&m&&m.beginAnimation(a,z.autoAnimateFrom,z.autoAnimateTo,z.autoAnimateLoop,z.autoAnimateSpeed||1),a.startDelay=0|z.startDelay,a.minAngularSpeed=z.minAngularSpeed,a.maxAngularSpeed=z.maxAngularSpeed,a.minSize=z.minSize,a.maxSize=z.maxSize,z.minScaleX&&(a.minScaleX=z.minScaleX,a.maxScaleX=z.maxScaleX,a.minScaleY=z.minScaleY,a.maxScaleY=z.maxScaleY),void 0!==z.preWarmCycles&&(a.preWarmCycles=z.preWarmCycles,a.preWarmStepOffset=z.preWarmStepOffset),void 0!==z.minInitialRotation&&(a.minInitialRotation=z.minInitialRotation,a.maxInitialRotation=z.maxInitialRotation),a.minLifeTime=z.minLifeTime,a.maxLifeTime=z.maxLifeTime,a.minEmitPower=z.minEmitPower,a.maxEmitPower=z.maxEmitPower,a.emitRate=z.emitRate,a.gravity=v.o.Jg(z.gravity),z.noiseStrength&&(a.noiseStrength=v.o.Jg(z.noiseStrength)),a.color1=p.d.Jg(z.color1),a.color2=p.d.Jg(z.color2),a.colorDead=p.d.Jg(z.colorDead),a.updateSpeed=z.updateSpeed,a.targetStopDuration=z.targetStopDuration,a.blendMode=z.blendMode,z.colorGradients)for(const v of z.colorGradients)a.addColorGradient(v.gradient,p.d.Jg(v.color1),v.color2?p.d.Jg(v.color2):void 0);if(z.rampGradients){for(const K of z.rampGradients)a.addRampGradient(K.gradient,p.c.Jg(K.color));a.useRampGradients=z.useRampGradients}if(z.colorRemapGradients)for(const v of z.colorRemapGradients)a.addColorRemapGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(z.alphaRemapGradients)for(const v of z.alphaRemapGradients)a.addAlphaRemapGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(z.sizeGradients)for(const v of z.sizeGradients)a.addSizeGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(z.angularSpeedGradients)for(const v of z.angularSpeedGradients)a.addAngularSpeedGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(z.velocityGradients)for(const v of z.velocityGradients)a.addVelocityGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(z.dragGradients)for(const v of z.dragGradients)a.addDragGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(z.emitRateGradients)for(const v of z.emitRateGradients)a.addEmitRateGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(z.startSizeGradients)for(const v of z.startSizeGradients)a.addStartSizeGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(z.lifeTimeGradients)for(const v of z.lifeTimeGradients)a.addLifeTimeGradient(v.gradient,void 0!==v.factor1?v.factor1:v.factor,v.factor2);if(z.limitVelocityGradients){for(const K of z.limitVelocityGradients)a.addLimitVelocityGradient(K.gradient,void 0!==K.factor1?K.factor1:K.factor,K.factor2);a.limitVelocityDamping=z.limitVelocityDamping}if(z.noiseTexture&&m){const K=(0,j.c)("BABYLON.ProceduralTexture");a.noiseTexture=K.Parse(z.noiseTexture,m,T)}let M;if(z.particleEmitterType){switch(z.particleEmitterType.type){case"SphereParticleEmitter":M=new w;break;case"SphereDirectedParticleEmitter":M=new H;break;case"ConeEmitter":case"ConeParticleEmitter":M=new F;break;case"ConeDirectedParticleEmitter":M=new G;break;case"CylinderParticleEmitter":M=new l;break;case"CylinderDirectedParticleEmitter":M=new V;break;case"HemisphericParticleEmitter":M=new c;break;case"PointParticleEmitter":M=new C;break;case"MeshParticleEmitter":M=new I;break;case"CustomParticleEmitter":M=new f;break;default:M=new W}M.parse(z.particleEmitterType,m)}else M=new W,M.parse(z,m);a.particleEmitterType=M,a.startSpriteCellID=z.startSpriteCellID,a.endSpriteCellID=z.endSpriteCellID,a.spriteCellLoop=z.spriteCellLoop??!0,a.spriteCellWidth=z.spriteCellWidth,a.spriteCellHeight=z.spriteCellHeight,a.spriteCellChangeSpeed=z.spriteCellChangeSpeed,a.spriteRandomStartCell=z.spriteRandomStartCell,a.disposeOnStop=z.disposeOnStop??!1,a.manualEmitCount=z.manualEmitCount??-1}static Parse(z,a,K){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],m=arguments.length>4?arguments[4]:void 0;const j=z.name;let s,M,r=null,W=null;if(a instanceof sz.b?s=a:(M=a,s=M.getEngine()),z.customShader&&s.createEffectForParticles){W=z.customShader;const a=W.shaderOptions.defines.length>0?W.shaderOptions.defines.join("\n"):"";r=s.createEffectForParticles(W.shaderPath.fragmentElement,W.shaderOptions.uniforms,W.shaderOptions.samplers,a)}const F=new Cz(j,m||z.lb,a,r,z.isAnimationSheetEnabled);if(F.customShader=W,F._rootUrl=K,z.id&&(F.id=z.id),z.subEmitters){F.subEmitters=[];for(const v of z.subEmitters){const z=[];for(const T of v)z.push(jz.Parse(T,a,K));F.subEmitters.push(z)}}return Cz._Parse(z,F,a,K),z.textureMask&&(F.textureMask=p.d.Jg(z.textureMask)),z.Pf&&(F.Pf=v.o.Jg(z.Pf)),z.preventAutoStart&&(F.preventAutoStart=z.preventAutoStart),T||F.preventAutoStart||F.start(),F}serialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={};if(Cz._Serialize(a,this,z),a.textureMask=this.textureMask.kj(),a.customShader=this.customShader,a.preventAutoStart=this.preventAutoStart,a.Pf=this.Pf.kj(),this.subEmitters){a.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const K of this._subEmitters){const v=[];for(const a of K)v.push(a.serialize(z));a.subEmitters.push(v)}}return a}static _Serialize(z,a,K){if(z.name=a.name,z.id=a.id,z.lb=a.getCapacity(),z.disposeOnStop=a.disposeOnStop,z.manualEmitCount=a.manualEmitCount,a.j.position){const K=a.j;z.emitterId=K.id}else{const K=a.j;z.j=K.kj()}a.particleEmitterType&&(z.particleEmitterType=a.particleEmitterType.serialize()),a.particleTexture&&(K?z.texture=a.particleTexture.serialize():(z.textureName=a.particleTexture.name,z.invertY=!!a.particleTexture._invertY)),z.isLocal=a.isLocal,o.e.AppendSerializedAnimations(a,z),z.beginAnimationOnStart=a.beginAnimationOnStart,z.beginAnimationFrom=a.beginAnimationFrom,z.beginAnimationTo=a.beginAnimationTo,z.beginAnimationLoop=a.beginAnimationLoop,z.startDelay=a.startDelay,z.renderingGroupId=a.renderingGroupId,z.isBillboardBased=a.isBillboardBased,z.billboardMode=a.billboardMode,z.minAngularSpeed=a.minAngularSpeed,z.maxAngularSpeed=a.maxAngularSpeed,z.minSize=a.minSize,z.maxSize=a.maxSize,z.minScaleX=a.minScaleX,z.maxScaleX=a.maxScaleX,z.minScaleY=a.minScaleY,z.maxScaleY=a.maxScaleY,z.minEmitPower=a.minEmitPower,z.maxEmitPower=a.maxEmitPower,z.minLifeTime=a.minLifeTime,z.maxLifeTime=a.maxLifeTime,z.emitRate=a.emitRate,z.gravity=a.gravity.kj(),z.noiseStrength=a.noiseStrength.kj(),z.color1=a.color1.kj(),z.color2=a.color2.kj(),z.colorDead=a.colorDead.kj(),z.updateSpeed=a.updateSpeed,z.targetStopDuration=a.targetStopDuration,z.blendMode=a.blendMode,z.preWarmCycles=a.preWarmCycles,z.preWarmStepOffset=a.preWarmStepOffset,z.minInitialRotation=a.minInitialRotation,z.maxInitialRotation=a.maxInitialRotation,z.startSpriteCellID=a.startSpriteCellID,z.spriteCellLoop=a.spriteCellLoop,z.endSpriteCellID=a.endSpriteCellID,z.spriteCellChangeSpeed=a.spriteCellChangeSpeed,z.spriteCellWidth=a.spriteCellWidth,z.spriteCellHeight=a.spriteCellHeight,z.spriteRandomStartCell=a.spriteRandomStartCell,z.isAnimationSheetEnabled=a.isAnimationSheetEnabled,z.useLogarithmicDepth=a.useLogarithmicDepth;const v=a.getColorGradients();if(v){z.colorGradients=[];for(const a of v){const K={gradient:a.gradient,color1:a.color1.kj()};a.color2?K.color2=a.color2.kj():K.color2=a.color1.kj(),z.colorGradients.push(K)}}const T=a.getRampGradients();if(T){z.rampGradients=[];for(const a of T){const K={gradient:a.gradient,color:a.color.kj()};z.rampGradients.push(K)}z.useRampGradients=a.useRampGradients}const m=a.getColorRemapGradients();if(m){z.colorRemapGradients=[];for(const a of m){const K={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?K.factor2=a.factor2:K.factor2=a.factor1,z.colorRemapGradients.push(K)}}const p=a.getAlphaRemapGradients();if(p){z.alphaRemapGradients=[];for(const a of p){const K={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?K.factor2=a.factor2:K.factor2=a.factor1,z.alphaRemapGradients.push(K)}}const j=a.getSizeGradients();if(j){z.sizeGradients=[];for(const a of j){const K={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?K.factor2=a.factor2:K.factor2=a.factor1,z.sizeGradients.push(K)}}const s=a.getAngularSpeedGradients();if(s){z.angularSpeedGradients=[];for(const a of s){const K={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?K.factor2=a.factor2:K.factor2=a.factor1,z.angularSpeedGradients.push(K)}}const M=a.getVelocityGradients();if(M){z.velocityGradients=[];for(const a of M){const K={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?K.factor2=a.factor2:K.factor2=a.factor1,z.velocityGradients.push(K)}}const r=a.getDragGradients();if(r){z.dragGradients=[];for(const a of r){const K={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?K.factor2=a.factor2:K.factor2=a.factor1,z.dragGradients.push(K)}}const W=a.getEmitRateGradients();if(W){z.emitRateGradients=[];for(const a of W){const K={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?K.factor2=a.factor2:K.factor2=a.factor1,z.emitRateGradients.push(K)}}const F=a.getStartSizeGradients();if(F){z.startSizeGradients=[];for(const a of F){const K={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?K.factor2=a.factor2:K.factor2=a.factor1,z.startSizeGradients.push(K)}}const G=a.getLifeTimeGradients();if(G){z.lifeTimeGradients=[];for(const a of G){const K={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?K.factor2=a.factor2:K.factor2=a.factor1,z.lifeTimeGradients.push(K)}}const l=a.getLimitVelocityGradients();if(l){z.limitVelocityGradients=[];for(const a of l){const K={gradient:a.gradient,factor1:a.factor1};void 0!==a.factor2?K.factor2=a.factor2:K.factor2=a.factor1,z.limitVelocityGradients.push(K)}z.limitVelocityDamping=a.limitVelocityDamping}a.noiseTexture&&(z.noiseTexture=a.noiseTexture.serialize())}clone(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v={...this._customWrappers};let T=null;const m=this._engine;if(m.createEffectForParticles&&null!=this.customShader){T=this.customShader;const z=T.shaderOptions.defines.length>0?T.shaderOptions.defines.join("\n"):"",a=m.createEffectForParticles(T.shaderPath.fragmentElement,T.shaderOptions.uniforms,T.shaderOptions.samplers,z);v[0]?v[0].effect=a:this.setCustomEffect(a,0)}const p=this.serialize(K),j=Cz.Parse(p,this._scene||this._engine,this._rootUrl);return j.name=z,j.customShader=T,j._customWrappers=v,void 0===a&&(a=this.j),this.noiseTexture&&(j.noiseTexture=this.noiseTexture.clone()),j.j=a,this.preventAutoStart||j.start(),j}}Cz.BILLBOARDMODE_Y=2,Cz.BILLBOARDMODE_ALL=7,Cz.BILLBOARDMODE_STRETCHED=8,Cz.BILLBOARDMODE_STRETCHED_LOCAL=9,jz._ParseParticleSystem=Cz.Parse;var wz=K(10964),Hz=K(10935),fz=K(11410);fz.d.prototype.createTransformFeedback=function(){const z=this._gl.createTransformFeedback();if(!z)throw new Error("Unable to create Transform Feedback");return z},fz.d.prototype.deleteTransformFeedback=function(z){this._gl.deleteTransformFeedback(z)},fz.d.prototype.bindTransformFeedback=function(z){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,z)},fz.d.prototype.beginTransformFeedback=function(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(z?this._gl.POINTS:this._gl.TRIANGLES)},fz.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},fz.d.prototype.setTranformFeedbackVaryings=function(z,a){this._gl.transformFeedbackVaryings(z,a,this._gl.INTERLEAVED_ATTRIBS)},fz.d.prototype.bindTransformFeedbackBuffer=function(z){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,z?z.underlyingResource:null)},fz.d.prototype.readTransformFeedbackBuffer=function(z){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,z)};const Yz="clipPlaneFragmentDeclaration2",Iz="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";x.b.IncludesShadersStore[Yz]=Iz;K(11508),K(11513),K(11522),K(11530),K(11536),K(11539),K(11544),K(11548);const qz="gpuRenderParticlesPixelShader",Bz="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";x.b.ShadersStore[qz]=Bz;const xz="clipPlaneVertexDeclaration2",Zz="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";x.b.IncludesShadersStore[xz]=Zz;K(11550),K(11559),K(11561),K(11570);const yz="gpuRenderParticlesVertexShader",iz="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";x.b.ShadersStore[yz]=iz;class nz extends s{static get IsSupported(){if(!Q.b.LastCreatedEngine)return!1;const z=Q.b.LastCreatedEngine.getCaps();return z.supportTransformFeedbacks||z.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(z){this._maxActiveParticleCount=Math.min(z,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(z){this.maxActiveParticleCount=z}createPointEmitter(z,a){const K=Mz(z,a);return this.particleEmitterType=K,K}createHemisphericEmitter(){const z=rz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=z,z}createSphereEmitter(){const z=Wz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=z,z}createDirectedSphereEmitter(){const z=Fz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v.o(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0));return this.particleEmitterType=z,z}createCylinderEmitter(){const z=Gz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=z,z}createDirectedCylinderEmitter(){const z=lz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new v.o(0,1,0));return this.particleEmitterType=z,z}createConeEmitter(){const z=Vz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=z,z}createDirectedConeEmitter(){const z=cz(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new v.o(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new v.o(0,1,0));return this.particleEmitterType=z,z}createBoxEmitter(z,a,K,v){const T=new W;return this.particleEmitterType=T,this.direction1=z,this.direction2=a,this.minEmitBox=K,this.maxEmitBox=v,T}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Cz.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Cz.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Cz.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";z?setTimeout((()=>{this.start(0)}),z):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var z;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(z=this._customWrappers[a])||void 0===z?void 0:z.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[z]??this._customWrappers[0]}setCustomEffect(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[a]=new zz.e(this._engine),this._customWrappers[a].effect=z}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new h.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(z,a,K){return super._removeGradientAndTexture(z,a,K),this._releaseBuffers(),this}addColorGradient(z,a){this._colorGradients||(this._colorGradients=[]);const K=new u(z,a);return this._colorGradients.push(K),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(z&&this._colorGradients.sort(((z,a)=>z.gradient<a.gradient?-1:z.gradient>a.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(z){return this._removeGradientAndTexture(z,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const a in this._drawWrappers){var z;null===(z=this._drawWrappers[a].drawContext)||void 0===z||z.reset()}}_addFactorGradient(z,a,K){const v=new R(a,K);z.push(v),this._releaseBuffers()}addSizeGradient(z,a){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,z,a),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(z){return this._removeGradientAndTexture(z,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(z,a){if(!z)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&z.sort(((z,a)=>z.gradient<a.gradient?-1:z.gradient>a.gradient?1:0));const K=this;K[a]&&(K[a].dispose(),K[a]=null)}addAngularSpeedGradient(z,a){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,z,a),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(z){return this._removeGradientAndTexture(z,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(z,a){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,z,a),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(z){return this._removeGradientAndTexture(z,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(z,a){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,z,a),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(z){return this._removeGradientAndTexture(z,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(z,a){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,z,a),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(z){return this._removeGradientAndTexture(z,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(z){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(z,a,K){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(z),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.lj=new h.c,this.onStoppedObservable=new h.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,K&&"Scene"!==K.getClassName()?(this._engine=K,this.defaultProjectionMatrix=v.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=K||Q.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.sj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,j.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,j.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,j.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,j.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new zz.e(this._engine)},this._customWrappers[0].effect=T,this._drawWrappers={0:new zz.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(a=a??{}).randomTextureSize||delete a.randomTextureSize;const p={lb:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...a},s=a;isFinite(s)&&(p.lb=s),this._capacity=p.lb,this._maxActiveParticleCount=p.lb,this._currentActiveCount=0,this._isAnimationSheetEnabled=m,this.particleEmitterType=new W;const M=Math.min(this._engine.getCaps().maxTextureSize,p.randomTextureSize);let r=[];for(let v=0;v<M;++v)r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random());this._randomTexture=new S.c(new Float32Array(r),M,1,5,K,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,r=[];for(let v=0;v<M;++v)r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random());this._randomTexture2=new S.c(new Float32Array(r),M,1,5,K,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=M}_reset(){this._releaseBuffers()}_createVertexBuffers(z,a,K){const v={};v.position=a.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let T=3;v.age=a.createVertexBuffer("age",T,1,this._attributesStrideSize,!0),T+=1,v.size=a.createVertexBuffer("size",T,3,this._attributesStrideSize,!0),T+=3,v.life=a.createVertexBuffer("life",T,1,this._attributesStrideSize,!0),T+=1,T+=4,this.billboardMode===Cz.BILLBOARDMODE_STRETCHED&&(v.direction=a.createVertexBuffer("direction",T,3,this._attributesStrideSize,!0)),T+=3,this._platform.alignDataInBuffer&&(T+=1),this.particleEmitterType instanceof f&&(T+=3,this._platform.alignDataInBuffer&&(T+=1)),this._colorGradientsTexture||(v.color=a.createVertexBuffer("color",T,4,this._attributesStrideSize,!0),T+=4),this._isBillboardBased||(v.initialDirection=a.createVertexBuffer("initialDirection",T,3,this._attributesStrideSize,!0),T+=3,this._platform.alignDataInBuffer&&(T+=1)),this.noiseTexture&&(v.noiseCoordinates1=a.createVertexBuffer("noiseCoordinates1",T,3,this._attributesStrideSize,!0),T+=3,this._platform.alignDataInBuffer&&(T+=1),v.noiseCoordinates2=a.createVertexBuffer("noiseCoordinates2",T,3,this._attributesStrideSize,!0),T+=3,this._platform.alignDataInBuffer&&(T+=1)),v.angle=a.createVertexBuffer("angle",T,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?T++:T+=2,this._isAnimationSheetEnabled&&(v.cellIndex=a.createVertexBuffer("cellIndex",T,1,this._attributesStrideSize,!0),T+=1,this.spriteRandomStartCell&&(v.cellStartOffset=a.createVertexBuffer("cellStartOffset",T,1,this._attributesStrideSize,!0),T+=1)),v.offset=K.createVertexBuffer("offset",0,2),v.uv=K.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(v),this._platform.createVertexBuffers(z,v),this.resetDrawCache()}_initialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!z)return;const a=this._engine,K=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof f&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const T=this.particleEmitterType instanceof f,m=v.j.gb[0];let p=0;for(let v=0;v<this._capacity;v++)if(K.push(0),K.push(0),K.push(0),K.push(0),K.push(0),K.push(0),K.push(0),K.push(0),K.push(Math.random()),K.push(Math.random()),K.push(Math.random()),K.push(Math.random()),T?(this.particleEmitterType.particleDestinationGenerator(v,null,m),K.push(m.x),K.push(m.y),K.push(m.z)):(K.push(0),K.push(0),K.push(0)),this._platform.alignDataInBuffer&&K.push(0),p+=16,T&&(this.particleEmitterType.particlePositionGenerator(v,null,m),K.push(m.x),K.push(m.y),K.push(m.z),this._platform.alignDataInBuffer&&K.push(0),p+=4),this._colorGradientsTexture||(K.push(0),K.push(0),K.push(0),K.push(0),p+=4),this.isBillboardBased||(K.push(0),K.push(0),K.push(0),this._platform.alignDataInBuffer&&K.push(0),p+=4),this.noiseTexture&&(K.push(Math.random()),K.push(Math.random()),K.push(Math.random()),this._platform.alignDataInBuffer&&K.push(0),K.push(Math.random()),K.push(Math.random()),K.push(Math.random()),this._platform.alignDataInBuffer&&K.push(0),p+=8),K.push(0),p+=1,this._angularSpeedGradientsTexture||(K.push(0),p+=1),this._isAnimationSheetEnabled&&(K.push(0),p+=1,this.spriteRandomStartCell&&(K.push(0),p+=1)),this._platform.alignDataInBuffer){let z=3-(p+3&3);for(p+=z;z-- >0;)K.push(0)}const j=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),s=this._platform.createParticleBuffer(K),M=this._platform.createParticleBuffer(K);this._buffer0=new Y.e(a,s,!1,this._attributesStrideSize),this._buffer1=new Y.e(a,M,!1,this._attributesStrideSize),this._spriteBuffer=new Y.e(a,j,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let z=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(z+="\n#define BILLBOARD"),this._colorGradientsTexture&&(z+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(z+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(z+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(z+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(z+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(z+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(z+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(z+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(z+="\n#define NOISE"),this.isLocal&&(z+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===z||(this._cachedUpdateDefines=z,this._updateBuffer=this._platform.createUpdateBuffer(z)),this._platform.isUpdateBufferReady()}_getWrapper(z){const a=this._getCustomDrawWrapper(z);if(null!==a&&void 0!==a&&a.effect)return a;const K=[];this.fillDefines(K,z);let v=this._drawWrappers[z];v||(v=new zz.e(this._engine),v.drawContext&&(v.drawContext.useInstancing=!0),this._drawWrappers[z]=v);const T=K.join("\n");if(v.defines!==T){const z=[],a=[],K=[];this.fillUniformsAttributesAndSamplerNames(a,z,K),v.setEffect(this._engine.createEffect("gpuRenderParticles",z,a,K,T),T)}return v}static _GetAttributeNamesOrOptions(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const T=[Y.h.PositionKind,"age","life","size","angle"];return z||T.push(Y.h.ColorKind),a&&T.push("cellIndex"),K||T.push("initialDirection"),v&&T.push("direction"),T.push("offset",Y.h.UVKind),T}static _GetEffectCreationOptions(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=["emitterWM","Pf","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,az.e)(v),z&&v.push("sheetInfos"),a&&v.push("logarithmicDepthConstant"),K&&(v.push("vFogInfos"),v.push("vFogColor")),v}fillDefines(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,az.m)(this,this._scene,z),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Hz.c.FOGMODE_NONE&&z.push("#define FOG")),a===Cz.BLENDMODE_MULTIPLY&&z.push("#define BLENDMULTIPLYMODE"),this.isLocal&&z.push("#define LOCAL"),this.useLogarithmicDepth&&z.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(z.push("#define BILLBOARD"),this.billboardMode){case Cz.BILLBOARDMODE_Y:z.push("#define BILLBOARDY");break;case Cz.BILLBOARDMODE_STRETCHED:z.push("#define BILLBOARDSTRETCHED");break;case Cz.BILLBOARDMODE_ALL:z.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&z.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&z.push("#define ANIMATESHEET"),K&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),z.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(z,a,K){a.push(...nz._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Cz.BILLBOARDMODE_STRETCHED)),z.push(...nz._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),K.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(wz.e.PrepareUniforms(z,this._imageProcessingConfigurationDefines),wz.e.PrepareSamplers(K,this._imageProcessingConfigurationDefines))}animate(){var z;let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(a?this.preWarmStepOffset:(null===(z=this._scene)||void 0===z?void 0:z.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(z,a){const K=this[a];if(!z||!z.length||K)return;const v=new Float32Array(this._rawTextureWidth);for(let T=0;T<this._rawTextureWidth;T++){const a=T/this._rawTextureWidth;k.GetCurrentGradient(a,z,((z,a,K)=>{v[T]=(0,M.q)(z.factor1,a.factor1,K)}))}this[a]=S.c.CreateRTexture(v,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[a].name=a.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const z=new Uint8Array(4*this._rawTextureWidth),a=p.f.tb[0];for(let K=0;K<this._rawTextureWidth;K++){const v=K/this._rawTextureWidth;k.GetCurrentGradient(v,this._colorGradients,((v,T,m)=>{p.d.LerpToRef(v.color1,T.color1,m,a),z[4*K]=255*a.r,z[4*K+1]=255*a.g,z[4*K+2]=255*a.b,z[4*K+3]=255*a.a}))}this._colorGradientsTexture=S.c.CreateRGBATexture(z,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(z,a){var K,T,m,p;const j=this._getWrapper(z),s=j.effect;this._engine.enableEffect(j);const M=(null===(K=this._scene)||void 0===K?void 0:K.getViewMatrix())||v.b.IdentityReadOnly;if(s.setMatrix("view",M),s.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),s.setTexture("diffuseSampler",this.particleTexture),s.setVector2("translationPivot",this.translationPivot),s.setVector3("Pf",this.Pf),this.isLocal&&s.setMatrix("emitterWM",a),this._colorGradientsTexture?s.setTexture("colorGradientSampler",this._colorGradientsTexture):s.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const z=this.particleTexture.getBaseSize();s.setFloat3("sheetInfos",this.spriteCellWidth/z.width,this.spriteCellHeight/z.height,z.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const z=this._scene.activeCamera;s.setVector3("eyePosition",z.globalPosition)}const r=s.defines;if(this._scene&&((0,az.h)(s,this,this._scene),this.applyFog&&(0,Kz.h)(this._scene,void 0,s)),r.indexOf("#define BILLBOARDMODE_ALL")>=0){const z=M.clone();z.invert(),s.setMatrix("invView",z)}switch(this.useLogarithmicDepth&&this._scene&&(0,Kz.m)(r,s,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(s),z){case Cz.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case Cz.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case Cz.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case Cz.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,s,null!==(T=this._scene)&&void 0!==T&&T.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(s),null!==(m=this._scene)&&void 0!==m&&m.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(p=this._scene)&&void 0!==p&&p.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(z){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!z)if(this.j.position){z=this.j.getWorldMatrix()}else{const a=this.j;z=v.j.Matrix[0],v.b.TranslationToRef(a.x,a.y,a.z,z)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",z),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const a=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=a}render(){let z,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],K=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!a&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let z=0;z<this.preWarmCycles;z++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const z=0|this._accumulatedCount;this._accumulatedCount-=z,this._currentActiveCount+=z}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){z=this.j.getWorldMatrix()}else{const a=this.j;z=v.j.Matrix[0],v.b.TranslationToRef(a.x,a.y,a.z,z)}const T=this._engine;this.updateInAnimate||this._update(z);let m=0;return a||K||(T.setState(!1),this.forceDepthWrite&&T.setDepthWrite(!0),m=this.blendMode===Cz.BLENDMODE_MULTIPLYADD?this._render(Cz.BLENDMODE_MULTIPLY,z)+this._render(Cz.BLENDMODE_ADD,z):this._render(this.blendMode,z),this._engine.setAlphaMode(0)),m}rebuild(){const z=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(z,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,z()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const a in this._drawWrappers){this._drawWrappers[a].dispose()}if(this._drawWrappers={},this._scene){const z=this._scene.sj.indexOf(this);z>-1&&this._scene.sj.splice(z,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let a=0;a<this._renderVertexBuffers.length;++a){const z=this._renderVertexBuffers[a];for(const a in z)z[a].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.lj.notifyObservers(this),this.lj.clear()}clone(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v={...this._customWrappers};let T=null;const m=this._engine;if(m.createEffectForParticles&&null!=this.customShader){T=this.customShader;const z=T.shaderOptions.defines.length>0?T.shaderOptions.defines.join("\n"):"";v[0]=m.createEffectForParticles(T.shaderPath.fragmentElement,T.shaderOptions.uniforms,T.shaderOptions.samplers,z,void 0,void 0,void 0,this)}const p=this.serialize(K),j=nz.Parse(p,this._scene||this._engine,this._rootUrl);return j.name=z,j.customShader=T,j._customWrappers=v,void 0===a&&(a=this.j),this.noiseTexture&&(j.noiseTexture=this.noiseTexture.clone()),j.j=a,j}serialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={};return Cz._Serialize(a,this,z),a.activeParticleCount=this.activeParticleCount,a.randomTextureSize=this._randomTextureSize,a.customShader=this.customShader,a}static Parse(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4?arguments[4]:void 0;const m=z.name;let p,j;a instanceof sz.b?p=a:(j=a,p=j.getEngine());const s=new nz(m,{lb:T||z.lb,randomTextureSize:z.randomTextureSize},a,null,z.isAnimationSheetEnabled);if(s._rootUrl=K,z.customShader&&p.createEffectForParticles){const a=z.customShader,K=a.shaderOptions.defines.length>0?a.shaderOptions.defines.join("\n"):"",v=p.createEffectForParticles(a.shaderPath.fragmentElement,a.shaderOptions.uniforms,a.shaderOptions.samplers,K,void 0,void 0,void 0,s);s.setCustomEffect(v,0),s.customShader=a}return z.id&&(s.id=z.id),z.activeParticleCount&&(s.activeParticleCount=z.activeParticleCount),Cz._Parse(z,s,a,K),z.preventAutoStart&&(s.preventAutoStart=z.preventAutoStart),v||s.preventAutoStart||s.start(),s}}var Xz=K(10631),Pz=K(11578),Jz=K(10920);class oz{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(z){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const a of this.systems)a.j=z;this._emitterNode=z}setEmitterAsSphere(z,a,K){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:z,renderingGroupId:a};const v=(0,Pz.b)("emitterSphere",{diameter:z.diameter,segments:z.segments},K);v.renderingGroupId=a;const T=new Jz.e("emitterSphereMaterial",K);T.emissiveColor=z.color,v.material=T;for(const m of this.systems)m.j=v;this._emitterNode=v}start(z){for(const a of this.systems)z&&(a.j=z),a.start()}dispose(){for(const z of this.systems)z.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a={systems:[]};for(const K of this.systems)a.systems.push(K.serialize(z));return this._emitterNode&&(a.j=this._emitterCreationOptions),a}static Parse(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3?arguments[3]:void 0;const T=new oz,m=this.BaseAssetsUrl+"/textures/";a=a||Q.b.LastCreatedScene;for(const p of z.systems)T.systems.push(K?nz.Parse(p,a,m,!0,v):Cz.Parse(p,a,m,!0,v));if(z.j){const K=z.j.options;if("Sphere"===z.j.kind)T.setEmitterAsSphere({diameter:K.diameter,segments:K.segments,color:p.c.Jg(K.color)},z.j.renderingGroupId,a)}return T}}oz.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Nz=K(10672);class Az{static CreateDefault(z){let a,K=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,v=arguments.length>2?arguments[2]:void 0;return a=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new nz("default system",{lb:K},v):new Cz("default system",K,v),a.j=z,a.particleTexture=new N.d("https://assets.babylonjs.com/textures/flare.png",a.va()),a.createConeEmitter(.1,Math.PI/4),a.color1=new p.d(1,1,1,1),a.color2=new p.d(1,1,1,1),a.colorDead=new p.d(1,1,1,0),a.minSize=.1,a.maxSize=.1,a.minEmitPower=2,a.maxEmitPower=2,a.updateSpeed=1/60,a.emitRate=30,a}static CreateAsync(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3?arguments[3]:void 0;a||(a=Q.b.LastCreatedScene);const T={};return a.addPendingData(T),new Promise(((m,p)=>{if(K&&!nz.IsSupported)return a.removePendingData(T),p("Particle system with GPU is not supported.");Xz.h.LoadFile(`${Az.BaseAssetsUrl}/systems/${z}.json`,(z=>{a.removePendingData(T);const p=JSON.parse(z.toString());return m(oz.Parse(p,a,K,v))}),void 0,void 0,void 0,(()=>(a.removePendingData(T),p(`An error occurred with the creation of your particle system. Check if your type '${z}' exists.`))))}))}static ExportSet(z){const a=new oz;for(const K of z)a.systems.push(K);return a}static ParseFromFileAsync(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",m=arguments.length>5?arguments[5]:void 0;return new Promise(((p,j)=>{const s=new Nz.b;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const a=JSON.parse(s.responseText);let j;j=v?nz.Parse(a,K,T,!1,m):Cz.Parse(a,K,T,!1,m),z&&(j.name=z),p(j)}else j("Unable to load the particle system")})),s.open("GET",a),s.send()}))}static ParseFromSnippetAsync(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",T=arguments.length>4?arguments[4]:void 0;if("_BLANK"===z){const z=this.CreateDefault(null);return z.start(),Promise.resolve(z)}return new Promise(((m,p)=>{const j=new Nz.b;j.addEventListener("readystatechange",(()=>{if(4==j.readyState)if(200==j.status){const p=JSON.parse(JSON.parse(j.responseText).jsonPayload),s=JSON.parse(p.particleSystem);let M;M=K?nz.Parse(s,a,v,!1,T):Cz.Parse(s,a,v,!1,T),M.snippetId=z,m(M)}else p("Unable to load the snippet "+z)})),j.open("GET",this.SnippetUrl+"/"+z.replace(/#/g,"/")),j.send()}))}}Az.BaseAssetsUrl=oz.BaseAssetsUrl,Az.SnippetUrl="https://snippet.babylonjs.com",Az.CreateFromSnippetAsync=Az.ParseFromSnippetAsync;var gz=K(11194),dz=K(11019),tz=K(11583);(0,tz.g)(dz.b.NAME_PARTICLESYSTEM,((z,a,K,v)=>{const T=(0,tz.h)(dz.b.NAME_PARTICLESYSTEM);if(T&&void 0!==z.sj&&null!==z.sj)for(let m=0,p=z.sj.length;m<p;m++){const p=z.sj[m];K.sj.push(T(p,a,v))}})),(0,tz.d)(dz.b.NAME_PARTICLESYSTEM,((z,a,K)=>{if(z.activeParticleCount){return nz.Parse(z,a,K)}return Cz.Parse(z,a,K)})),sz.b.prototype.createEffectForParticles=function(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",m=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0,j=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,r=[],W=[];const F=[];return s?s.fillUniformsAttributesAndSamplerNames(W,r,F):(r=Cz._GetAttributeNamesOrOptions(),W=Cz._GetEffectCreationOptions()),-1===T.indexOf(" BILLBOARD")&&(T+="\n#define BILLBOARD\n"),null!==s&&void 0!==s&&s.isAnimationSheetEnabled&&-1===T.indexOf(" ANIMATESHEET")&&(T+="\n#define ANIMATESHEET\n"),-1===v.indexOf("diffuseSampler")&&v.push("diffuseSampler"),this.createEffect({vertex:(null===s||void 0===s?void 0:s.vertexShaderName)??"particles",fragmentElement:z},r,W.concat(a),F.concat(v),T,m,p,j,void 0,M,(async()=>{0===M?await Promise.resolve().then(K.bind(K,11615)):await Promise.resolve().then(K.bind(K,11688))}))},gz.c.prototype.getEmittedParticleSystems=function(){const z=[];for(let a=0;a<this.va().sj.length;a++){const K=this.va().sj[a];K.j===this&&z.push(K)}return z},gz.c.prototype.getHierarchyEmittedParticleSystems=function(){const z=[],a=this.getDescendants();a.push(this);for(let K=0;K<this.va().sj.length;K++){const v=this.va().sj[K],T=v.j;T.position&&-1!==a.indexOf(T)&&z.push(v)}return z};K(11077),K(11092),K(11249);K(11230),K(11591),K(11256),K(11066),K(11264);K(11442);var ez;K(11599),K(11143);!function(z){z[z.Color=2]="Color",z[z.UV=1]="UV",z[z.Random=0]="Random",z[z.Stated=3]="Stated"}(ez||(ez={}));K(11606),K(11615),K(11624),K(11688)},11477:(z,a,K)=>{"use strict";K.d(a,{e:()=>l});var v=K(10923),T=K(10933),m=K(10638),p=K(10941),j=K(10720),s=K(10927),M=K(10973),r=K(10767),W=K(10715),F=K(10782),G=K(11480);W.b.prototype.setTextureFromPostProcess=function(z,a,K){var v;let T=null;a&&(a._forcedOutputTexture?T=a._forcedOutputTexture:a._textures.data[a._currentRenderTextureInd]&&(T=a._textures.data[a._currentRenderTextureInd])),this._bindTexture(z,(null===(v=T)||void 0===v?void 0:v.texture)??null,K)},W.b.prototype.setTextureFromPostProcessOutput=function(z,a,K){var v;this._bindTexture(z,(null===a||void 0===a||null===(v=a._outputTexture)||void 0===v?void 0:v.texture)??null,K)},j.c.prototype.setTextureFromPostProcess=function(z,a){this._engine.setTextureFromPostProcess(this._samplers[z],a,z)},j.c.prototype.setTextureFromPostProcessOutput=function(z,a){this._engine.setTextureFromPostProcessOutput(this._samplers[z],a,z)};class l{static get ForceGLSL(){return G.i.ForceGLSL}static set ForceGLSL(z){G.i.ForceGLSL=z}static RegisterShaderCodeProcessing(z,a){G.i.RegisterShaderCodeProcessing(z,a)}get name(){return this._effectWrapper.name}set name(z){this._effectWrapper.name=z}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(z){this._effectWrapper.alphaMode=z}get samples(){return this._samples}set samples(z){this._samples=Math.min(z,this._engine.getCaps().maxMSAASamples),this._textures.forEach((z=>{z.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(z){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),z&&(this._onActivateObserver=this.onActivateObservable.add(z))}set onSizeChanged(z){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(z)}set onApply(z){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(z)}set onBeforeRender(z){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(z)}set onAfterRender(z){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(z)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(z){this._forcedOutputTexture=z}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.Xd(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(z,a,K,v,j,s){var M;let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,W=arguments.length>7?arguments[7]:void 0,F=arguments.length>8?arguments[8]:void 0,V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,C=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",w=arguments.length>12?arguments[12]:void 0,H=arguments.length>13&&void 0!==arguments[13]&&arguments[13],f=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,Y=arguments.length>15?arguments[15]:void 0,I=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Vi=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new T.f(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new p.m(1,1),this._texelSize=p.m.Zero(),this.onActivateObservable=new m.c,this.onSizeChangedObservable=new m.c,this.onApplyObservable=new m.c,this.onBeforeRenderObservable=new m.c,this.onAfterRenderObservable=new m.c;let q,B=1,x=null;if(K&&!Array.isArray(K)){const z=K;K=z.uniforms??null,v=z.samplers??null,B=z.size??1,s=z.camera??null,r=z.samplingMode??1,W=z.kd,F=z.reusable,V=Array.isArray(z.defines)?z.defines.join("\n"):z.defines??null,c=z.textureType??0,C=z.vertexUrl??"postprocess",w=z.indexParameters,H=z.blockCompilation??!1,f=z.textureFormat??5,Y=z.shaderLanguage??0,x=z.uniformBuffers??null,I=z.extraInitializations,q=z.effectWrapper}else j&&(B="number"===typeof j?j:{width:j.width,height:j.height});const Z=!!q;if(this._effectWrapper=q??new G.i({name:z,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:a,kd:W||(null===(M=s)||void 0===M?void 0:M.va().getEngine()),uniforms:K,samplers:v,uniformBuffers:x,defines:V,vertexUrl:C,indexParameters:w,blockCompilation:H,shaderLanguage:Y,extraInitializations:I}),this.name=z,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=s?(this._camera=s,this._scene=s.va(),s.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):W&&(this._engine=W,this._engine.postProcesses.push(this)),this._options=B,this.renderTargetSamplingMode=r||1,this._reusable=F||!1,this._textureType=c,this._textureFormat=f,this._shaderLanguage=Y||0,this._samplers=v||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=a,this._vertexUrl=C,this._parameters=K||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=x||[],this._indexParameters=w,!Z){this._webGPUReady=1===this._shaderLanguage;const z=[];this._gatherImports(this._engine.isWebGPU&&!l.ForceGLSL,z),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(H,V,I,z)}}_gatherImports(){let z=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?z.push(Promise.all([K.e(37).then(K.bind(K,13163))])):z.push(Promise.all([Promise.resolve().then(K.bind(K,11486))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(z){return this._disposeTextures(),this._shareOutputWithPostProcess=z,this}useOwnOutput(){0==this._textures.length&&(this._textures=new T.f(2)),this._shareOutputWithPostProcess=null}updateEffect(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0,p=arguments.length>6?arguments[6]:void 0,j=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(z,a,K,v,T,m,p,j),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let T=0;T<this._textureCache.length;T++)if(this._textureCache[T].texture.width===z.width&&this._textureCache[T].texture.height===z.height&&this._textureCache[T].postProcessChannel===K&&this._textureCache[T].texture._generateDepthBuffer===a.generateDepthBuffer&&this._textureCache[T].texture.samples===a.samples)return this._textureCache[T].texture;const v=this._engine.createRenderTargetTexture(z,a);return this._textureCache.push({texture:v,postProcessChannel:K,lastUsedRenderId:-1}),v}_flushTextureCache(){const z=this._renderId;for(let a=this._textureCache.length-1;a>=0;a--)if(z-this._textureCache[a].lastUsedRenderId>100){let z=!1;for(let K=0;K<this._textures.length;K++)if(this._textures.data[K]===this._textureCache[a].texture){z=!0;break}z||(this._textureCache[a].texture.dispose(),this._textureCache.splice(a,1))}}resize(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],T=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=z,this.height=a;let m=null;if(K)for(let s=0;s<K._postProcesses.length;s++)if(null!==K._postProcesses[s]){m=K._postProcesses[s];break}const p={width:this.width,height:this.height},j={generateMipMaps:v,generateDepthBuffer:T||m===this,generateStencilBuffer:(T||m===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(p,j,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(p,j,1)),this._texelSize.Xd(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let z;if(this._shareOutputWithPostProcess)z=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)z=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let a;z=this.inputTexture;for(let K=0;K<this._textureCache.length;K++)if(this._textureCache[K].texture===z){a=this._textureCache[K];break}a&&(a.lastUsedRenderId=this._renderId)}return z}activate(z){var a,K;let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0;const m=(z=z||this._camera).va(),p=m.getEngine(),j=p.getCaps().maxTextureSize,s=(v?v.width:this._engine.getRenderWidth(!0))*this._options|0,M=(v?v.height:this._engine.getRenderHeight(!0))*this._options|0;let r=this._options.width||s,W=this._options.height||M;const G=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let l=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const z=p.currentViewport;z&&(r*=z.width,W*=z.height)}(G||this.alwaysForcePOT)&&(this._options.width||(r=p.needPOTTextures?(0,F.g)(r,j,this.scaleMode):r),this._options.height||(W=p.needPOTTextures?(0,F.g)(W,j,this.scaleMode):W)),this.width===r&&this.height===W&&(l=this._getTarget())||this.resize(r,W,z,G,T),this._textures.forEach((z=>{z.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(z,this.samples)})),this._flushTextureCache(),this._renderId++}return l||(l=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.Xd(s/r,M/W),this._engine.bindFramebuffer(l,0,s,M,this.forceFullscreenViewport)):(this._scaleRatio.Xd(1,1),this._engine.bindFramebuffer(l,0,void 0,void 0,this.forceFullscreenViewport)),null===(a=(K=this._engine)._debugInsertMarker)||void 0===a||a.call(K,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(z),this.Vi&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:m.clearColor,m._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),l}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let z;var a;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),z=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(a=z)||void 0===a?void 0:a.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let z=this._textureCache.length-1;z>=0;z--)this._textureCache[z].texture.dispose();this._textureCache.length=0}setPrePassRenderer(z){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=z.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(z){let a;if(z=z||this._camera,this._disposeTextures(),this._scene&&(a=this._scene.postProcesses.indexOf(this),-1!==a&&this._scene.postProcesses.splice(a,1)),this._parentContainer){const z=this._parentContainer.postProcesses.indexOf(this);z>-1&&this._parentContainer.postProcesses.splice(z,1),this._parentContainer=null}if(a=this._engine.postProcesses.indexOf(this),-1!==a&&this._engine.postProcesses.splice(a,1),z){if(z.detachPostProcess(this),a=z._postProcesses.indexOf(this),0===a&&z._postProcesses.length>0){const z=this._camera._getFirstPostProcess();z&&z.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const z=M.e.Serialize(this),a=this.getCamera()||this._scene&&this._scene.activeCamera;return z.customType="BABYLON."+this.getClassName(),z.cameraId=a?a.id:null,z.reusable=this._reusable,z.textureType=this._textureType,z.fragmentUrl=this._fragmentUrl,z.parameters=this._parameters,z.samplers=this._samplers,z.uniformBuffers=this._uniformBuffers,z.options=this._options,z.defines=this._postProcessDefines,z.textureFormat=this._textureFormat,z.vertexUrl=this._vertexUrl,z.indexParameters=this._indexParameters,z}clone(){const z=this.serialize();z._engine=this._engine,z.cameraId=null;const a=l.Parse(z,this._scene,"");return a?(a.onActivateObservable=this.onActivateObservable.clone(),a.onSizeChangedObservable=this.onSizeChangedObservable.clone(),a.onApplyObservable=this.onApplyObservable.clone(),a.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),a.onAfterRenderObservable=this.onAfterRenderObservable.clone(),a._prePassEffectConfiguration=this._prePassEffectConfiguration,a):null}static Parse(z,a,K){const v=(0,r.c)(z.customType);if(!v||!v._Parse)return null;const T=a?a.getCameraById(z.cameraId):null;return v._Parse(z,T,a,K)}static _Parse(z,a,K,v){return M.e.Parse((()=>new l(z.name,z.fragmentUrl,z.parameters,z.samplers,z.options,a,z.renderTargetSamplingMode,z._engine,z.reusable,z.defines,z.textureType,z.vertexUrl,z.indexParameters,!1,z.textureFormat)),z,K,v)}}(0,v.e)([(0,s.D)()],l.prototype,"uniqueId",void 0),(0,v.e)([(0,s.D)()],l.prototype,"name",null),(0,v.e)([(0,s.D)()],l.prototype,"width",void 0),(0,v.e)([(0,s.D)()],l.prototype,"height",void 0),(0,v.e)([(0,s.D)()],l.prototype,"renderTargetSamplingMode",void 0),(0,v.e)([(0,s.i)()],l.prototype,"clearColor",void 0),(0,v.e)([(0,s.D)()],l.prototype,"Vi",void 0),(0,v.e)([(0,s.D)()],l.prototype,"forceAutoClearInAlphaMode",void 0),(0,v.e)([(0,s.D)()],l.prototype,"alphaMode",null),(0,v.e)([(0,s.D)()],l.prototype,"alphaConstants",void 0),(0,v.e)([(0,s.D)()],l.prototype,"enablePixelPerfectMode",void 0),(0,v.e)([(0,s.D)()],l.prototype,"forceFullscreenViewport",void 0),(0,v.e)([(0,s.D)()],l.prototype,"scaleMode",void 0),(0,v.e)([(0,s.D)()],l.prototype,"alwaysForcePOT",void 0),(0,v.e)([(0,s.D)("samples")],l.prototype,"_samples",void 0),(0,v.e)([(0,s.D)()],l.prototype,"adaptScaleToCurrentViewport",void 0),(0,r.e)("BABYLON.PostProcess",l)},11009:(z,a,K)=>{"use strict";K.d(a,{d:()=>m});var v=K(11001),T=K(10638);class m{constructor(z){this._vertexBuffers={},this.onBeforeRenderObservable=new T.c,this._scene=z}_prepareBuffers(){if(this._vertexBuffers[v.h.PositionKind])return;const z=[];z.push(1,1),z.push(-1,1),z.push(-1,-1),z.push(1,-1),this._vertexBuffers[v.h.PositionKind]=new v.h(this._scene.getEngine(),z,v.h.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const z=[];z.push(0),z.push(1),z.push(2),z.push(0),z.push(2),z.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(z)}_rebuild(){const z=this._vertexBuffers[v.h.PositionKind];z&&(z._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=this._scene.activeCamera;return!!K&&(a=a||K._postProcesses.filter((z=>null!=z)),!(!a||0===a.length||!this._scene.postProcessesEnabled)&&(a[0].activate(K,z,null!==a&&void 0!==a),!0))}directRender(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const p=this._scene.getEngine();for(let s=0;s<z.length;s++){var j;if(s<z.length-1)z[s+1].activate(this._scene.activeCamera,null===a||void 0===a?void 0:a.texture);else a?p.bindFramebuffer(a,v,void 0,void 0,K,T):m||p.restoreDefaultFramebuffer(),null===(j=p._debugInsertMarker)||void 0===j||j.call(p,`post process ${z[s].name} output`);const M=z[s],r=M.apply();r&&(M.onBeforeRenderObservable.notifyObservers(r),this._prepareBuffers(),p.bindBuffers(this._vertexBuffers,this._indexBuffer,r),p.drawElementsType(0,0,6),M.onAfterRenderObservable.notifyObservers(r))}p.setDepthBuffer(!0),p.setDepthWrite(!0)}_finalizeFrame(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const m=this._scene.activeCamera;if(!m)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(v=v||m._postProcesses.filter((z=>null!=z))).length||!this._scene.postProcessesEnabled)return;const p=this._scene.getEngine();for(let s=0,M=v.length;s<M;s++){const r=v[s];var j;if(s<M-1)r._outputTexture=v[s+1].activate(m,null===a||void 0===a?void 0:a.texture);else a?(p.bindFramebuffer(a,K,void 0,void 0,T),r._outputTexture=a):(p.restoreDefaultFramebuffer(),r._outputTexture=null),null===(j=p._debugInsertMarker)||void 0===j||j.call(p,`post process ${v[s].name} output`);if(z)break;const W=r.apply();W&&(r.onBeforeRenderObservable.notifyObservers(W),this._prepareBuffers(),p.bindBuffers(this._vertexBuffers,this._indexBuffer,W),p.drawElementsType(0,0,6),r.onAfterRenderObservable.notifyObservers(W))}p.setDepthBuffer(!0),p.setDepthWrite(!0),p.setAlphaMode(0)}dispose(){const z=this._vertexBuffers[v.h.PositionKind];z&&(z.dispose(),this._vertexBuffers[v.h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11011:(z,a,K)=>{"use strict";K.d(a,{e:()=>j});var v=K(10933),T=K(10941);class m{set opaqueSortCompareFn(z){this._opaqueSortCompareFn=z||m.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(z){this._alphaTestSortCompareFn=z||m.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(z){this._transparentSortCompareFn=z||m.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=z,this._opaqueSubMeshes=new v.f(256),this._transparentSubMeshes=new v.f(256),this._alphaTestSubMeshes=new v.f(256),this._depthOnlySubMeshes=new v.f(256),this._particleSystems=new v.f(256),this._spriteManagers=new v.f(256),this._empty=!0,this._edgesRenderers=new v.e(16),this._scene=a,this.opaqueSortCompareFn=K,this.alphaTestSortCompareFn=T,this.transparentSortCompareFn=m}render(z,a,K,v){if(z)return void z(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const T=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(T.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),T.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const m=T.getStencilBuffer();if(T.setStencilBuffer(!1),a&&this._renderSprites(),K&&this._renderParticles(v),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(T.setStencilBuffer(m),this._scene.useOrderIndependentTransparency){const z=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);z.length&&this._renderTransparent(z)}else this._renderTransparent(this._transparentSubMeshes);T.setAlphaMode(0)}if(T.setStencilBuffer(!1),this._edgesRenderers.length){for(let z=0;z<this._edgesRenderers.length;z++)this._edgesRenderers.data[z].render();T.setAlphaMode(0)}T.setStencilBuffer(m)}_renderOpaqueSorted(z){m._RenderSorted(z,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(z){m._RenderSorted(z,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(z){m._RenderSorted(z,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(z,a,K,v){let p,j=0;const s=K?K.globalPosition:m._ZeroVector;if(v)for(;j<z.length;j++)p=z.data[j],p._alphaIndex=p.getMesh().alphaIndex,p._distanceToCamera=T.o.Distance(p.getBoundingInfo().boundingSphere.centerWorld,s);const M=z.length===z.data.length?z.data:z.data.slice(0,z.length);a&&M.sort(a);const r=M[0].getMesh().va();for(j=0;j<M.length;j++)if(p=M[j],!r._activeMeshesFrozenButKeepClipping||p.isInFrustum(r._frustumPlanes)){if(v){const z=p.Ha();if(z&&z.needDepthPrePass){const a=z.va().getEngine();a.setColorWrite(!1),a.setAlphaMode(0),p.render(!1),a.setColorWrite(!0)}}p.render(v)}}static defaultTransparentSortCompare(z,a){return z._alphaIndex>a._alphaIndex?1:z._alphaIndex<a._alphaIndex?-1:m.backToFrontSortCompare(z,a)}static backToFrontSortCompare(z,a){return z._distanceToCamera<a._distanceToCamera?1:z._distanceToCamera>a._distanceToCamera?-1:0}static frontToBackSortCompare(z,a){return z._distanceToCamera<a._distanceToCamera?-1:z._distanceToCamera>a._distanceToCamera?1:0}static PainterSortCompare(z,a){const K=z.getMesh(),v=a.getMesh();return K.material&&v.material?K.material.uniqueId-v.material.uniqueId:K.uniqueId-v.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(z,a,K){void 0===a&&(a=z.getMesh()),void 0===K&&(K=z.Ha()),null!==K&&void 0!==K&&(K.needAlphaBlendingForMesh(a)?this._transparentSubMeshes.push(z):K.needAlphaTesting()?(K.needDepthPrePass&&this._depthOnlySubMeshes.push(z),this._alphaTestSubMeshes.push(z)):(K.needDepthPrePass&&this._depthOnlySubMeshes.push(z),this._opaqueSubMeshes.push(z)),a._renderingGroup=this,a._edgesRenderer&&a.isEnabled()&&a.isVisible&&a._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(a._edgesRenderer),this._empty=!1)}dispatchSprites(z){this._spriteManagers.push(z),this._empty=!1}dispatchParticles(z){this._particleSystems.push(z),this._empty=!1}_renderParticles(z){if(0===this._particleSystems.length)return;const a=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let K=0;K<this._particleSystems.length;K++){const v=this._particleSystems.data[K];if(0===(a&&a.layerMask&v.layerMask))continue;const T=v.j;T.position&&z&&-1===z.indexOf(T)||this._scene._activeParticles.addCount(v.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const z=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let a=0;a<this._spriteManagers.length;a++){const K=this._spriteManagers.data[a];0!==(z&&z.layerMask&K.layerMask)&&K.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}m._ZeroVector=T.o.Zero();class p{}class j{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(z){z!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=z,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const z of this._scene.meshes)if(z.Vf)for(const a of z.Vf)a._wasDispatched=!1;if(this._scene.spriteManagers)for(const z of this._scene.spriteManagers)z._wasDispatched=!1;for(const z of this._scene.sj)z._wasDispatched=!1}constructor(z){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new p,this._maintainStateBetweenFrames=!1,this._scene=z;for(let a=j.MIN_RENDERINGGROUPS;a<j.MAX_RENDERINGGROUPS;a++)this._autoClearDepthStencil[a]={Vi:!0,depth:!0,stencil:!0}}getRenderingGroup(z){const a=z||0;return this._prepareRenderingGroup(a),this._renderingGroups[a]}_clearDepthStencilBuffer(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,z,a),this._depthStencilBufferAlreadyCleaned=!0)}render(z,a,K,v){const T=this._renderingGroupInfo;if(T.Oc=this._scene,T.camera=this._scene.activeCamera,this._scene.spriteManagers&&v)for(let m=0;m<this._scene.spriteManagers.length;m++){const z=this._scene.spriteManagers[m];this.dispatchSprites(z)}for(let m=j.MIN_RENDERINGGROUPS;m<j.MAX_RENDERINGGROUPS;m++){this._depthStencilBufferAlreadyCleaned=m===j.MIN_RENDERINGGROUPS;const p=this._renderingGroups[m];if(!p||p._empty)continue;const s=1<<m;if(T.renderingGroupId=m,this._scene.onBeforeRenderingGroupObservable.notifyObservers(T,s),j.AUTOCLEAR){const z=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(m):this._autoClearDepthStencil[m];z&&z.Vi&&this._clearDepthStencilBuffer(z.depth,z.stencil)}for(const z of this._scene._beforeRenderingGroupDrawStage)z.action(m);p.render(z,v,K,a);for(const z of this._scene._afterRenderingGroupDrawStage)z.action(m);this._scene.onAfterRenderingGroupObservable.notifyObservers(T,s)}}reset(){if(!this.maintainStateBetweenFrames)for(let z=j.MIN_RENDERINGGROUPS;z<j.MAX_RENDERINGGROUPS;z++){const a=this._renderingGroups[z];a&&a.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let z=j.MIN_RENDERINGGROUPS;z<j.MAX_RENDERINGGROUPS;z++){const a=this._renderingGroups[z];a&&a.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let z=j.MIN_RENDERINGGROUPS;z<j.MAX_RENDERINGGROUPS;z++){const a=this._renderingGroups[z];a&&a.dispose()}}_prepareRenderingGroup(z){void 0===this._renderingGroups[z]&&(this._renderingGroups[z]=new m(z,this._scene,this._customOpaqueSortCompareFn[z],this._customAlphaTestSortCompareFn[z],this._customTransparentSortCompareFn[z]))}dispatchSprites(z){this.maintainStateBetweenFrames&&z._wasDispatched||(z._wasDispatched=!0,this.getRenderingGroup(z.renderingGroupId).dispatchSprites(z))}dispatchParticles(z){this.maintainStateBetweenFrames&&z._wasDispatched||(z._wasDispatched=!0,this.getRenderingGroup(z.renderingGroupId).dispatchParticles(z))}dispatch(z,a,K){void 0===a&&(a=z.getMesh()),this.maintainStateBetweenFrames&&z._wasDispatched||(z._wasDispatched=!0,this.getRenderingGroup(a.renderingGroupId).dispatch(z,a,K))}setRenderingOrder(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[z]=a,this._customAlphaTestSortCompareFn[z]=K,this._customTransparentSortCompareFn[z]=v,this._renderingGroups[z]){const a=this._renderingGroups[z];a.opaqueSortCompareFn=this._customOpaqueSortCompareFn[z],a.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[z],a.transparentSortCompareFn=this._customTransparentSortCompareFn[z]}}setRenderingAutoClearDepthStencil(z,a){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[z]={Vi:a,depth:K,stencil:v}}getAutoClearDepthStencilSetup(z){return this._autoClearDepthStencil[z]}}j.MAX_RENDERINGGROUPS=4,j.MIN_RENDERINGGROUPS=0,j.AUTOCLEAR=!0},11670:(z,a,K)=>{"use strict";const v="clipPlaneFragment",T="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";K(10726).b.IncludesShadersStoreWGSL[v]=T},11626:(z,a,K)=>{"use strict";const v="clipPlaneFragmentDeclaration",T="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";K(10726).b.IncludesShadersStoreWGSL[v]=T},11709:(z,a,K)=>{"use strict";const v="clipPlaneVertex",T="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";K(10726).b.IncludesShadersStoreWGSL[v]=T},11694:(z,a,K)=>{"use strict";const v="clipPlaneVertexDeclaration",T="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";K(10726).b.IncludesShadersStoreWGSL[v]=T},11680:(z,a,K)=>{"use strict";const v="fogFragment",T="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";K(10726).b.IncludesShadersStoreWGSL[v]=T},11661:(z,a,K)=>{"use strict";const v="fogFragmentDeclaration",T="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";K(10726).b.IncludesShadersStoreWGSL[v]=T},11718:(z,a,K)=>{"use strict";const v="fogVertex",T="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";K(10726).b.IncludesShadersStoreWGSL[v]=T},11701:(z,a,K)=>{"use strict";const v="fogVertexDeclaration",T="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";K(10726).b.IncludesShadersStoreWGSL[v]=T},11647:(z,a,K)=>{"use strict";const v="helperFunctions",T="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";K(10726).b.IncludesShadersStoreWGSL[v]=T},11629:(z,a,K)=>{"use strict";const v="imageProcessingDeclaration",T="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";K(10726).b.IncludesShadersStoreWGSL[v]=T},11655:(z,a,K)=>{"use strict";const v="imageProcessingFunctions",T="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";K(10726).b.IncludesShadersStoreWGSL[v]=T},11638:(z,a,K)=>{"use strict";const v="logDepthDeclaration",T="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";K(10726).b.IncludesShadersStoreWGSL[v]=T},11678:(z,a,K)=>{"use strict";const v="logDepthFragment",T="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";K(10726).b.IncludesShadersStoreWGSL[v]=T},11723:(z,a,K)=>{"use strict";const v="logDepthVertex",T="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";K(10726).b.IncludesShadersStoreWGSL[v]=T},11624:(z,a,K)=>{"use strict";K.r(a),K.d(a,{particlesPixelShaderWGSL:()=>p});var v=K(10726);K(11626),K(11629),K(11638),K(11647),K(11655),K(11661),K(11670),K(11678),K(11680);const T="particlesPixelShader",m="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";v.b.ShadersStoreWGSL[T]=m;const p={name:T,shader:m}},11688:(z,a,K)=>{"use strict";K.r(a),K.d(a,{particlesVertexShaderWGSL:()=>p});var v=K(10726);K(11694),K(11701),K(11638),K(11709),K(11718),K(11723);const T="particlesVertexShader",m="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";v.b.ShadersStoreWGSL[T]=m;const p={name:T,shader:m}},11539:(z,a,K)=>{"use strict";const v="clipPlaneFragment",T="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";K(10726).b.IncludesShadersStore[v]=T},11613:(z,a,K)=>{"use strict";const v="clipPlaneFragmentDeclaration",T="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";K(10726).b.IncludesShadersStore[v]=T},11559:(z,a,K)=>{"use strict";const v="clipPlaneVertex",T="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";K(10726).b.IncludesShadersStore[v]=T},11618:(z,a,K)=>{"use strict";const v="clipPlaneVertexDeclaration",T="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";K(10726).b.IncludesShadersStore[v]=T},11548:(z,a,K)=>{"use strict";const v="fogFragment",T="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";K(10726).b.IncludesShadersStore[v]=T},11536:(z,a,K)=>{"use strict";const v="fogFragmentDeclaration",T="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";K(10726).b.IncludesShadersStore[v]=T},11561:(z,a,K)=>{"use strict";const v="fogVertex",T="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";K(10726).b.IncludesShadersStore[v]=T},11550:(z,a,K)=>{"use strict";const v="fogVertexDeclaration",T="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";K(10726).b.IncludesShadersStore[v]=T},11522:(z,a,K)=>{"use strict";const v="helperFunctions",T="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";K(10726).b.IncludesShadersStore[v]=T},11508:(z,a,K)=>{"use strict";const v="imageProcessingDeclaration",T="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";K(10726).b.IncludesShadersStore[v]=T},11530:(z,a,K)=>{"use strict";const v="imageProcessingFunctions",T="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";K(10726).b.IncludesShadersStore[v]=T},11513:(z,a,K)=>{"use strict";const v="logDepthDeclaration",T="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";K(10726).b.IncludesShadersStore[v]=T},11544:(z,a,K)=>{"use strict";const v="logDepthFragment",T="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";K(10726).b.IncludesShadersStore[v]=T},11570:(z,a,K)=>{"use strict";const v="logDepthVertex",T="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";K(10726).b.IncludesShadersStore[v]=T},11606:(z,a,K)=>{"use strict";K.r(a),K.d(a,{particlesPixelShader:()=>p});var v=K(10726);K(11613),K(11508),K(11513),K(11522),K(11530),K(11536),K(11539),K(11544),K(11548);const T="particlesPixelShader",m="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";v.b.ShadersStore[T]=m;const p={name:T,shader:m}},11615:(z,a,K)=>{"use strict";K.r(a),K.d(a,{particlesVertexShader:()=>p});var v=K(10726);K(11618),K(11550),K(11513),K(11559),K(11561),K(11570);const T="particlesVertexShader",m="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";v.b.ShadersStore[T]=m;const p={name:T,shader:m}},11486:(z,a,K)=>{"use strict";K.r(a),K.d(a,{postprocessVertexShader:()=>m});const v="postprocessVertexShader",T="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";K(10726).b.ShadersStore[v]=T;const m={name:v,shader:T}},11031:(z,a,K)=>{"use strict";K.d(a,{c:()=>v});class v{}v._IsPickingAvailable=!1},11215:(z,a,K)=>{"use strict";K.d(a,{c:()=>W});var v=K(10923),T=K(10941),m=K(10927),p=K(10638),j=K(10680),s=K(10663),M=K(10973);class r{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new p.c,this._onClonedObservable=new p.c}}class W{static AddNodeConstructor(z,a){this._NodeConstructors[z]=a}static Construct(z,a,K,v){const T=this._NodeConstructors[z];return T?T(a,K,v):null}set accessibilityTag(z){this._accessibilityTag=z,this.onAccessibilityTagChangedObservable.notifyObservers(z)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(z){this._nodeDataStorage._doNotSerialize=z}u(){return this._nodeDataStorage._isDisposed}set parent(z){if(this._parentNode===z)return;const a=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const a=this._parentNode._children.indexOf(this);-1!==a&&this._parentNode._children.splice(a,1),z||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=z,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),a||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(z){z.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const z=this._scene.rootNodes,a=z.length-1;z[this._nodeDataStorage._sceneRootNodesIndex]=z[a],z[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(z){this._animationPropertiesOverride=z}getClassName(){return"Node"}set onDispose(z){this._onDisposeObserver&&this.lj.remove(this._onDisposeObserver),this._onDisposeObserver=this.lj.add(z)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new r,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new p.c,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=T.b.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.lj=new p.c,this._onDisposeObserver=null,this._behaviors=new Array,this.name=z,this.id=z,this._scene=a||j.b.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),K&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(z)||(z.init(),this._scene.isLoading&&!a?this._scene.onDataLoadedObservable.addOnce((()=>{z.attach(this)})):z.attach(this),this._behaviors.push(z)),this}removeBehavior(z){const a=this._behaviors.indexOf(z);return-1===a||(this._behaviors[a].detach(),this._behaviors.splice(a,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(z){for(const a of this._behaviors)if(a.name===z)return a;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Qj(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(z){!z&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(z){return this.parent?this.parent._getActionManagerForTrigger(z,!1):null}_updateCache(z){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}zg(z){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((z=>{z._syncParentEnabledState()}))}Nb(z){this._nodeDataStorage._isEnabled!==z&&(this._nodeDataStorage._isEnabled=z,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(z))}isDescendantOf(z){return!!this.parent&&(this.parent===z||this.parent.isDescendantOf(z))}_getDescendants(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2?arguments[2]:void 0;if(this._children)for(let v=0;v<this._children.length;v++){const T=this._children[v];K&&!K(T)||z.push(T),a||T._getDescendants(z,!1,K)}}getDescendants(z,a){const K=[];return this._getDescendants(K,z,a),K}getChildMeshes(z,a){const K=[];return this._getDescendants(K,z,(z=>(!a||a(z))&&void 0!==z.Fi)),K}getChildren(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(a,z)}_setReady(z){z!==this._nodeDataStorage._isReady&&(z?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(z){for(let a=0;a<this.animations.length;a++){const K=this.animations[a];if(K.name===z)return K}return null}createAnimationRange(z,a,K){if(!this._ranges[z]){this._ranges[z]=W._AnimationRangeFactory(z,a,K);for(let v=0,T=this.animations.length;v<T;v++)this.animations[v]&&this.animations[v].createRange(z,a,K)}}deleteAnimationRange(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let K=0,v=this.animations.length;K<v;K++)this.animations[K]&&this.animations[K].deleteRange(z,a);this._ranges[z]=null}getAnimationRange(z){return this._ranges[z]||null}clone(z,a,K){const v=M.e.Clone((()=>new W(z,this.va())),this);if(a&&(v.parent=a),!K){const a=this.getDescendants(!0);for(let K=0;K<a.length;K++){const T=a[K];T.clone(z+"."+T.name,v)}}return v}getAnimationRanges(){const z=[];let a;for(a in this._ranges)z.push(this._ranges[a]);return z}beginAnimation(z,a,K,v){const T=this.getAnimationRange(z);return T?this._scene.beginAnimation(this,T.from,T.to,a,K,v):null}serializeAnimationRanges(){const z=[];for(const a in this._ranges){const K=this._ranges[a];if(!K)continue;const v={};v.name=a,v.from=K.from,v.to=K.to,z.push(v)}return z}Qj(z){return this._worldMatrix||(this._worldMatrix=T.b.Identity()),this._worldMatrix}dispose(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!z){const K=this.getDescendants(!0);for(const v of K)v.dispose(z,a)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.lj.notifyObservers(this),this.lj.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const K of this._behaviors)K.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(z,a,K){if(a.ranges)for(let v=0;v<a.ranges.length;v++){const K=a.ranges[v];z.createAnimationRange(K.name,K.from,K.to)}}getHierarchyBoundingVectors(){let z,a,K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Qj(!0);const m=this;if(m.getBoundingInfo&&m.Vf){const K=m.getBoundingInfo();z=K.boundingBox.minimumWorld.clone(),a=K.boundingBox.maximumWorld.clone()}else z=new T.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new T.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(K){const K=this.getDescendants(!1);for(const m of K){const K=m;if(K.Qj(!0),v&&!v(K))continue;if(!K.getBoundingInfo||0===K.getTotalVertices())continue;const p=K.getBoundingInfo().boundingBox,j=p.minimumWorld,s=p.maximumWorld;T.o.CheckExtends(j,z,a),T.o.CheckExtends(s,z,a)}}return{min:z,max:a}}}W._AnimationRangeFactory=(z,a,K)=>{throw(0,s.b)("AnimationRange")},W._NodeConstructors={},(0,v.e)([(0,m.D)()],W.prototype,"name",void 0),(0,v.e)([(0,m.D)()],W.prototype,"id",void 0),(0,v.e)([(0,m.D)()],W.prototype,"uniqueId",void 0),(0,v.e)([(0,m.D)()],W.prototype,"state",void 0),(0,v.e)([(0,m.D)()],W.prototype,"metadata",void 0)},10935:(z,a,K)=>{"use strict";K.d(a,{c:()=>zz});var v=K(10631),T=K(10658),m=K(10638),p=K(10933);class j{constructor(){this._count=0,this._data={}}p(z){this.clear(),z.forEach(((z,a)=>this.add(z,a)))}get(z){const a=this._data[z];if(void 0!==a)return a}getOrAddWithFactory(z,a){let K=this.get(z);return void 0!==K||(K=a(z),K&&this.add(z,K)),K}getOrAdd(z,a){const K=this.get(z);return void 0!==K?K:(this.add(z,a),a)}contains(z){return void 0!==this._data[z]}add(z,a){return void 0===this._data[z]&&(this._data[z]=a,++this._count,!0)}set(z,a){return void 0!==this._data[z]&&(this._data[z]=a,!0)}getAndRemove(z){const a=this.get(z);return void 0!==a?(delete this._data[z],--this._count,a):null}remove(z){return!!this.contains(z)&&(delete this._data[z],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(z){for(const a in this._data){z(a,this._data[a])}}first(z){for(const a in this._data){const K=z(a,this._data[a]);if(K)return K}return null}}var s=K(10937),M=K(10941),r=K(10964),W=K(10991),F=K(10995);class G{constructor(z,a,K,v,T,m){this.source=z,this.pointerX=a,this.pointerY=K,this.meshUnderPointer=v,this.sourceEvent=T,this.additionalData=m}static CreateNew(z,a,K){const v=z.va();return new G(z,v.pointerX,v.pointerY,v.meshUnderPointer||z,a,K)}static CreateNewFromSprite(z,a,K,v){return new G(z,a.pointerX,a.pointerY,a.meshUnderPointer,K,v)}static CreateNewFromScene(z,a){return new G(null,z.pointerX,z.pointerY,z.meshUnderPointer,a)}static CreateNewFromPrimitive(z,a,K,v){return new G(z,a.x,a.y,null,K,v)}}var l=K(11009),V=K(11011),c=K(11019),C=K(10640),w=K(10680),H=K(10663),f=K(11022);class Y{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const z in Y.Triggers)if(Object.prototype.hasOwnProperty.call(Y.Triggers,z))return!0;return!1}static get HasPickTriggers(){for(const z in Y.Triggers)if(Object.prototype.hasOwnProperty.call(Y.Triggers,z)){const a=parseInt(z);if(a>=1&&a<=7)return!0}return!1}static HasSpecificTrigger(z){for(const a in Y.Triggers)if(Object.prototype.hasOwnProperty.call(Y.Triggers,a)){if(parseInt(a)===z)return!0}return!1}}Y.Triggers={};var I,q,B,x,Z,y,i,n=K(11026);!function(z){z[z.Generic=0]="Generic",z[z.Keyboard=1]="Keyboard",z[z.Mouse=2]="Mouse",z[z.Touch=3]="Touch",z[z.DualShock=4]="DualShock",z[z.Xbox=5]="Xbox",z[z.Switch=6]="Switch",z[z.DualSense=7]="DualSense"}(I||(I={})),function(z){z[z.Horizontal=0]="Horizontal",z[z.Vertical=1]="Vertical",z[z.LeftClick=2]="LeftClick",z[z.MiddleClick=3]="MiddleClick",z[z.RightClick=4]="RightClick",z[z.BrowserBack=5]="BrowserBack",z[z.BrowserForward=6]="BrowserForward",z[z.MouseWheelX=7]="MouseWheelX",z[z.MouseWheelY=8]="MouseWheelY",z[z.MouseWheelZ=9]="MouseWheelZ",z[z.Move=12]="Move"}(q||(q={})),function(z){z[z.Horizontal=0]="Horizontal",z[z.Vertical=1]="Vertical",z[z.LeftClick=2]="LeftClick",z[z.MiddleClick=3]="MiddleClick",z[z.RightClick=4]="RightClick",z[z.BrowserBack=5]="BrowserBack",z[z.BrowserForward=6]="BrowserForward",z[z.MouseWheelX=7]="MouseWheelX",z[z.MouseWheelY=8]="MouseWheelY",z[z.MouseWheelZ=9]="MouseWheelZ",z[z.DeltaHorizontal=10]="DeltaHorizontal",z[z.DeltaVertical=11]="DeltaVertical"}(B||(B={})),function(z){z[z.Cross=0]="Cross",z[z.Circle=1]="Circle",z[z.Square=2]="Square",z[z.Triangle=3]="Triangle",z[z.L1=4]="L1",z[z.R1=5]="R1",z[z.L2=6]="L2",z[z.R2=7]="R2",z[z.Share=8]="Share",z[z.Options=9]="Options",z[z.L3=10]="L3",z[z.R3=11]="R3",z[z.DPadUp=12]="DPadUp",z[z.DPadDown=13]="DPadDown",z[z.DPadLeft=14]="DPadLeft",z[z.DPadRight=15]="DPadRight",z[z.Home=16]="Home",z[z.TouchPad=17]="TouchPad",z[z.LStickXAxis=18]="LStickXAxis",z[z.LStickYAxis=19]="LStickYAxis",z[z.RStickXAxis=20]="RStickXAxis",z[z.RStickYAxis=21]="RStickYAxis"}(x||(x={})),function(z){z[z.Cross=0]="Cross",z[z.Circle=1]="Circle",z[z.Square=2]="Square",z[z.Triangle=3]="Triangle",z[z.L1=4]="L1",z[z.R1=5]="R1",z[z.L2=6]="L2",z[z.R2=7]="R2",z[z.Create=8]="Create",z[z.Options=9]="Options",z[z.L3=10]="L3",z[z.R3=11]="R3",z[z.DPadUp=12]="DPadUp",z[z.DPadDown=13]="DPadDown",z[z.DPadLeft=14]="DPadLeft",z[z.DPadRight=15]="DPadRight",z[z.Home=16]="Home",z[z.TouchPad=17]="TouchPad",z[z.LStickXAxis=18]="LStickXAxis",z[z.LStickYAxis=19]="LStickYAxis",z[z.RStickXAxis=20]="RStickXAxis",z[z.RStickYAxis=21]="RStickYAxis"}(Z||(Z={})),function(z){z[z.A=0]="A",z[z.B=1]="B",z[z.X=2]="X",z[z.Y=3]="Y",z[z.LB=4]="LB",z[z.RB=5]="RB",z[z.LT=6]="LT",z[z.RT=7]="RT",z[z.Back=8]="Back",z[z.Start=9]="Start",z[z.LS=10]="LS",z[z.RS=11]="RS",z[z.DPadUp=12]="DPadUp",z[z.DPadDown=13]="DPadDown",z[z.DPadLeft=14]="DPadLeft",z[z.DPadRight=15]="DPadRight",z[z.Home=16]="Home",z[z.LStickXAxis=17]="LStickXAxis",z[z.LStickYAxis=18]="LStickYAxis",z[z.RStickXAxis=19]="RStickXAxis",z[z.RStickYAxis=20]="RStickYAxis"}(y||(y={})),function(z){z[z.B=0]="B",z[z.A=1]="A",z[z.Y=2]="Y",z[z.X=3]="X",z[z.L=4]="L",z[z.R=5]="R",z[z.ZL=6]="ZL",z[z.ZR=7]="ZR",z[z.Minus=8]="Minus",z[z.Plus=9]="Plus",z[z.LS=10]="LS",z[z.RS=11]="RS",z[z.DPadUp=12]="DPadUp",z[z.DPadDown=13]="DPadDown",z[z.DPadLeft=14]="DPadLeft",z[z.DPadRight=15]="DPadRight",z[z.Home=16]="Home",z[z.Capture=17]="Capture",z[z.LStickXAxis=18]="LStickXAxis",z[z.LStickYAxis=19]="LStickYAxis",z[z.RStickXAxis=20]="RStickXAxis",z[z.RStickYAxis=21]="RStickYAxis"}(i||(i={}));var X=K(11029);class P{static CreateDeviceEvent(z,a,K,v,T,m,p){switch(z){case I.Keyboard:return this._CreateKeyboardEvent(K,v,T,m);case I.Mouse:if(K===q.MouseWheelX||K===q.MouseWheelY||K===q.MouseWheelZ)return this._CreateWheelEvent(z,a,K,v,T,m);case I.Touch:return this._CreatePointerEvent(z,a,K,v,T,m,p);default:throw`Unable to generate event for device ${I[z]}`}}static _CreatePointerEvent(z,a,K,v,T,m,p){const j=this._CreateMouseEvent(z,a,K,v,T,m);z===I.Mouse?(j.deviceType=I.Mouse,j.pointerId=1,j.pointerType="mouse"):(j.deviceType=I.Touch,j.pointerId=p??a,j.pointerType="touch");let s=0;return s+=T.pollInput(z,a,q.LeftClick),s+=2*T.pollInput(z,a,q.RightClick),s+=4*T.pollInput(z,a,q.MiddleClick),j.buttons=s,K===q.Move?j.type="pointermove":K>=q.LeftClick&&K<=q.RightClick&&(j.type=1===v?"pointerdown":"pointerup",j.button=K-2),j}static _CreateWheelEvent(z,a,K,v,T,m){const p=this._CreateMouseEvent(z,a,K,v,T,m);switch(p.pointerId=1,p.type="wheel",p.deltaMode=X.d.DOM_DELTA_PIXEL,p.deltaX=0,p.deltaY=0,p.deltaZ=0,K){case q.MouseWheelX:p.deltaX=v;break;case q.MouseWheelY:p.deltaY=v;break;case q.MouseWheelZ:p.deltaZ=v}return p}static _CreateMouseEvent(z,a,K,v,T,m){const p=this._CreateEvent(m),j=T.pollInput(z,a,q.Horizontal),s=T.pollInput(z,a,q.Vertical);return m?(p.movementX=0,p.movementY=0,p.offsetX=p.movementX-m.getBoundingClientRect().x,p.offsetY=p.movementY-m.getBoundingClientRect().y):(p.movementX=T.pollInput(z,a,10),p.movementY=T.pollInput(z,a,11),p.offsetX=0,p.offsetY=0),this._CheckNonCharacterKeys(p,T),p.clientX=j,p.clientY=s,p.x=j,p.y=s,p.deviceType=z,p.deviceSlot=a,p.inputIndex=K,p}static _CreateKeyboardEvent(z,a,K,v){const T=this._CreateEvent(v);return this._CheckNonCharacterKeys(T,K),T.deviceType=I.Keyboard,T.deviceSlot=0,T.inputIndex=z,T.type=1===a?"keydown":"keyup",T.key=String.fromCharCode(z),T.keyCode=z,T}static _CheckNonCharacterKeys(z,a){const K=a.isDeviceAvailable(I.Keyboard),v=K&&1===a.pollInput(I.Keyboard,0,18),T=K&&1===a.pollInput(I.Keyboard,0,17),m=K&&(1===a.pollInput(I.Keyboard,0,91)||1===a.pollInput(I.Keyboard,0,92)||1===a.pollInput(I.Keyboard,0,93)),p=K&&1===a.pollInput(I.Keyboard,0,16);z.altKey=v,z.ctrlKey=T,z.metaKey=m,z.shiftKey=p}static _CreateEvent(z){const a={preventDefault:()=>{}};return a.target=z,a}}class J{constructor(z,a,K){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(z,a,((z,a,v,T)=>{const m=P.CreateDeviceEvent(z,a,v,T,this);K(z,a,m)})):this._createDummyNativeInput()}pollInput(z,a,K){return this._nativeInput.pollInput(z,a,K)}isDeviceAvailable(z){return z===I.Mouse||z===I.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const o=Object.keys(q).length/2;class N{constructor(z,a,K,T){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=v.h.IsSafari(),this._usingMacOS=(0,C.j)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=z=>{},this._keyboardUpEvent=z=>{},this._keyboardBlurEvent=z=>{},this._pointerMoveEvent=z=>{},this._pointerDownEvent=z=>{},this._pointerUpEvent=z=>{},this._pointerCancelEvent=z=>{},this._pointerWheelEvent=z=>{},this._pointerBlurEvent=z=>{},this._pointerMacOSChromeOutEvent=z=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,C.j)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,C.j)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=z=>{},this._gamepadDisconnectedEvent=z=>{},this._eventPrefix=v.h.GetPointerPrefix(z),this._engine=z,this._onDeviceConnected=a,this._onDeviceDisconnected=K,this._onInputChanged=T,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(z,a,K){const T=this._inputs[z][a];if(!T)throw`Unable to find device ${I[z]}`;z>=I.DualShock&&z<=I.DualSense&&this._updateDevice(z,a,K);const m=T[K];if(void 0===m)throw`Unable to find input ${K} for device ${I[z]} in slot ${a}`;return K===q.Move&&v.h.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),m}isDeviceAvailable(z){return void 0!==this._inputs[z]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const z=null===this||void 0===this?void 0:this._engine.getInputElement();if(z&&(!this._eventsAttached||this._elementToAttachTo!==z)){if(this._disableEvents(),this._inputs)for(const z of this._inputs)if(z)for(const a in z){const K=z[+a];if(K)for(let z=0;z<K.length;z++)K[z]=0}this._elementToAttachTo=z,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const z=navigator.getGamepads();for(const a of z)a&&this._addGamePad(a)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(I.Mouse,0,0,0)}_addGamePad(z){const a=this._getGamepadDeviceType(z.id),K=z.index;this._gamepads=this._gamepads||new Array(z.index+1),this._registerDevice(a,K,z.buttons.length+z.axes.length),this._gamepads[K]=a}_addPointerDevice(z,a,K,v){this._pointerActive||(this._pointerActive=!0),this._registerDevice(z,a,o);const T=this._inputs[z][a];T[0]=K,T[1]=v}_registerDevice(z,a,K){if(void 0===a)throw`Unable to register device ${I[z]} to undefined slot.`;if(this._inputs[z]||(this._inputs[z]={}),!this._inputs[z][a]){const v=new Array(K);v.fill(0),this._inputs[z][a]=v,this._onDeviceConnected(z,a)}}_unregisterDevice(z,a){this._inputs[z][a]&&(delete this._inputs[z][a],this._onDeviceDisconnected(z,a))}_handleKeyActions(){this._keyboardDownEvent=z=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(I.Keyboard,0,255));const a=this._inputs[I.Keyboard][0];if(a){a[z.keyCode]=1;const K=z;K.inputIndex=z.keyCode,this._usingMacOS&&z.metaKey&&"Meta"!==z.key&&(this._metaKeys.includes(z.keyCode)||this._metaKeys.push(z.keyCode)),this._onInputChanged(I.Keyboard,0,K)}},this._keyboardUpEvent=z=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(I.Keyboard,0,255));const a=this._inputs[I.Keyboard][0];if(a){a[z.keyCode]=0;const K=z;if(K.inputIndex=z.keyCode,this._usingMacOS&&"Meta"===z.key&&this._metaKeys.length>0){for(const z of this._metaKeys){const K=P.CreateDeviceEvent(I.Keyboard,0,z,0,this,this._elementToAttachTo);a[z]=0,this._onInputChanged(I.Keyboard,0,K)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(I.Keyboard,0,K)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const z=this._inputs[I.Keyboard][0];for(let a=0;a<z.length;a++)if(0!==z[a]){z[a]=0;const K=P.CreateDeviceEvent(I.Keyboard,0,a,0,this,this._elementToAttachTo);this._onInputChanged(I.Keyboard,0,K)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,C.j)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let v=0;v<this._maxTouchPoints;v++)this._activeTouchIds[v]=-1;this._pointerMoveEvent=z=>{const a=this._getPointerType(z);let K=a===I.Mouse?0:this._activeTouchIds.indexOf(z.pointerId);if(a===I.Touch&&-1===K){const T=this._activeTouchIds.indexOf(-1);if(!(T>=0))return void v.h.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);K=T,this._activeTouchIds[T]=z.pointerId,this._onDeviceConnected(a,K)}this._inputs[a]||(this._inputs[a]={}),this._inputs[a][K]||this._addPointerDevice(a,K,z.clientX,z.clientY);const T=this._inputs[a][K];if(T){const v=z;v.inputIndex=q.Move,T[q.Horizontal]=z.clientX,T[q.Vertical]=z.clientY,a===I.Touch&&0===T[q.LeftClick]&&(T[q.LeftClick]=1),void 0===z.pointerId&&(z.pointerId=this._mouseId),this._onInputChanged(a,K,v),this._usingSafari||-1===z.button||(v.inputIndex=z.button+2,T[z.button+2]=T[z.button+2]?0:1,this._onInputChanged(a,K,v))}},this._pointerDownEvent=z=>{const a=this._getPointerType(z);let K=a===I.Mouse?0:z.pointerId;if(a===I.Touch){let a=this._activeTouchIds.indexOf(z.pointerId);if(-1===a&&(a=this._activeTouchIds.indexOf(-1)),!(a>=0))return void v.h.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);K=a,this._activeTouchIds[a]=z.pointerId}this._inputs[a]||(this._inputs[a]={}),this._inputs[a][K]?a===I.Touch&&this._onDeviceConnected(a,K):this._addPointerDevice(a,K,z.clientX,z.clientY);const T=this._inputs[a][K];if(T){const v=T[q.Horizontal],p=T[q.Vertical];if(a===I.Mouse){if(void 0===z.pointerId&&(z.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(m){}}else if(z.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(z.pointerId)}catch(m){}T[q.Horizontal]=z.clientX,T[q.Vertical]=z.clientY,T[z.button+2]=1;const j=z;j.inputIndex=z.button+2,this._onInputChanged(a,K,j),v===z.clientX&&p===z.clientY||(j.inputIndex=q.Move,this._onInputChanged(a,K,j))}},this._pointerUpEvent=z=>{var a;const K=this._getPointerType(z),v=K===I.Mouse?0:this._activeTouchIds.indexOf(z.pointerId);if(K===I.Touch){if(-1===v)return;this._activeTouchIds[v]=-1}const T=null===(a=this._inputs[K])||void 0===a?void 0:a[v];if(T&&0!==T[z.button+2]){var m,p,j,s;const a=T[q.Horizontal],M=T[q.Vertical];T[q.Horizontal]=z.clientX,T[q.Vertical]=z.clientY,T[z.button+2]=0;const r=z;void 0===z.pointerId&&(z.pointerId=this._mouseId),a===z.clientX&&M===z.clientY||(r.inputIndex=q.Move,this._onInputChanged(K,v,r)),r.inputIndex=z.button+2,K===I.Mouse&&this._mouseId>=0&&null!==(m=(p=this._elementToAttachTo).hasPointerCapture)&&void 0!==m&&m.call(p,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):z.pointerId&&null!==(j=(s=this._elementToAttachTo).hasPointerCapture)&&void 0!==j&&j.call(s,z.pointerId)&&this._elementToAttachTo.releasePointerCapture(z.pointerId),this._onInputChanged(K,v,r),K===I.Touch&&this._onDeviceDisconnected(K,v)}},this._pointerCancelEvent=z=>{if("mouse"===z.pointerType){var a,K;const z=this._inputs[I.Mouse][0];this._mouseId>=0&&null!==(a=(K=this._elementToAttachTo).hasPointerCapture)&&void 0!==a&&a.call(K,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let a=q.LeftClick;a<=q.BrowserForward;a++)if(1===z[a]){z[a]=0;const K=P.CreateDeviceEvent(I.Mouse,0,a,0,this,this._elementToAttachTo);this._onInputChanged(I.Mouse,0,K)}}else{var v,T;const a=this._activeTouchIds.indexOf(z.pointerId);if(-1===a)return;null!==(v=(T=this._elementToAttachTo).hasPointerCapture)&&void 0!==v&&v.call(T,z.pointerId)&&this._elementToAttachTo.releasePointerCapture(z.pointerId),this._inputs[I.Touch][a][q.LeftClick]=0;const K=P.CreateDeviceEvent(I.Touch,a,q.LeftClick,0,this,this._elementToAttachTo,z.pointerId);this._onInputChanged(I.Touch,a,K),this._activeTouchIds[a]=-1,this._onDeviceDisconnected(I.Touch,a)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let z=!1;const a=function(){};try{const K=Object.defineProperty({},"passive",{get:function(){z=!0}});this._elementToAttachTo.addEventListener("test",a,K),this._elementToAttachTo.removeEventListener("test",a,K)}catch(K){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(I.Mouse)){var z,a;const K=this._inputs[I.Mouse][0];this._mouseId>=0&&null!==(z=(a=this._elementToAttachTo).hasPointerCapture)&&void 0!==z&&z.call(a,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let z=q.LeftClick;z<=q.BrowserForward;z++)if(1===K[z]){K[z]=0;const a=P.CreateDeviceEvent(I.Mouse,0,z,0,this,this._elementToAttachTo);this._onInputChanged(I.Mouse,0,a)}}if(this.isDeviceAvailable(I.Touch)){const z=this._inputs[I.Touch];for(let a=0;a<this._activeTouchIds.length;a++){var K,v,T;const m=this._activeTouchIds[a];if(null!==(K=(v=this._elementToAttachTo).hasPointerCapture)&&void 0!==K&&K.call(v,m)&&this._elementToAttachTo.releasePointerCapture(m),-1!==m&&1===(null===(T=z[a])||void 0===T?void 0:T[q.LeftClick])){z[a][q.LeftClick]=0;const K=P.CreateDeviceEvent(I.Touch,a,q.LeftClick,0,this,this._elementToAttachTo,m);this._onInputChanged(I.Touch,a,K),this._activeTouchIds[a]=-1,this._onDeviceDisconnected(I.Touch,a)}}}},this._pointerWheelEvent=z=>{const a=I.Mouse;this._inputs[a]||(this._inputs[a]=[]),this._inputs[a][0]||(this._pointerActive=!0,this._registerDevice(a,0,o));const K=this._inputs[a][0];if(K){K[q.MouseWheelX]=z.deltaX||0,K[q.MouseWheelY]=z.deltaY||z.wheelDelta||0,K[q.MouseWheelZ]=z.deltaZ||0;const v=z;void 0===z.pointerId&&(z.pointerId=this._mouseId),0!==K[q.MouseWheelX]&&(v.inputIndex=q.MouseWheelX,this._onInputChanged(a,0,v)),0!==K[q.MouseWheelY]&&(v.inputIndex=q.MouseWheelY,this._onInputChanged(a,0,v)),0!==K[q.MouseWheelZ]&&(v.inputIndex=q.MouseWheelZ,this._onInputChanged(a,0,v))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=z=>{z.buttons>1&&this._pointerCancelEvent(z)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!z&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(I.Mouse)){const z=this._inputs[I.Mouse][0];z[q.MouseWheelX]=0,z[q.MouseWheelY]=0,z[q.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=z=>{this._addGamePad(z.gamepad)},this._gamepadDisconnectedEvent=z=>{if(this._gamepads){const a=this._getGamepadDeviceType(z.gamepad.id),K=z.gamepad.index;this._unregisterDevice(a,K),delete this._gamepads[K]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(z,a,K){const v=navigator.getGamepads()[a];if(v&&z===this._gamepads[a]){const T=this._inputs[z][a];K>=v.buttons.length?T[K]=v.axes[K-v.buttons.length].valueOf():T[K]=v.buttons[K].value}}_getGamepadDeviceType(z){return-1!==z.indexOf("054c")?-1!==z.indexOf("0ce6")?I.DualSense:I.DualShock:-1!==z.indexOf("Xbox One")||-1!==z.search("Xbox 360")||-1!==z.search("xinput")?I.Xbox:-1!==z.indexOf("057e")?I.Switch:I.Generic}_getPointerType(z){let a=I.Mouse;return("touch"===z.pointerType||"pen"===z.pointerType||z.touches)&&(a=I.Touch),a}}class A{constructor(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=a,this.deviceSlot=K,this.onInputChangedObservable=new m.c,this._deviceInputSystem=z}getInput(z){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,z)}}class g{constructor(z){this._registeredManagers=new Array,this._refCount=0,this.registerManager=z=>{for(let a=0;a<this._devices.length;a++){const K=this._devices[a];for(const v in K){const K=+v;z._addDevice(new A(this._deviceInputSystem,a,K))}}this._registeredManagers.push(z)},this.unregisterManager=z=>{const a=this._registeredManagers.indexOf(z);a>-1&&this._registeredManagers.splice(a,1)};const a=Object.keys(I).length/2;this._devices=new Array(a);const K=(z,a)=>{this._devices[z]||(this._devices[z]=new Array),this._devices[z][a]||(this._devices[z][a]=a);for(const K of this._registeredManagers){const v=new A(this._deviceInputSystem,z,a);K._addDevice(v)}},v=(z,a)=>{var K;null!==(K=this._devices[z])&&void 0!==K&&K[a]&&delete this._devices[z][a];for(const v of this._registeredManagers)v._removeDevice(z,a)},T=(z,a,K)=>{if(K)for(const v of this._registeredManagers)v._onInputChanged(z,a,K)};"undefined"!==typeof _native?this._deviceInputSystem=new J(K,v,T):this._deviceInputSystem=new N(z,K,v,T)}dispose(){this._deviceInputSystem.dispose()}}class d{getDeviceSource(z,a){if(void 0===a){if(void 0===this._firstDevice[z])return null;a=this._firstDevice[z]}return this._devices[z]&&void 0!==this._devices[z][a]?this._devices[z][a]:null}getDeviceSources(z){return this._devices[z]?this._devices[z].filter((z=>!!z)):[]}constructor(z){const a=Object.keys(I).length/2;this._devices=new Array(a),this._firstDevice=new Array(a),this._engine=z,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new g(z)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new m.c((z=>{for(const a of this._devices)if(a)for(const K of a)K&&this.onDeviceConnectedObservable.notifyObserver(z,K)})),this.onDeviceDisconnectedObservable=new m.c,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=z.lj.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.lj.remove(this._onDisposeObserver)}_addDevice(z){this._devices[z.deviceType]||(this._devices[z.deviceType]=new Array),this._devices[z.deviceType][z.deviceSlot]||(this._devices[z.deviceType][z.deviceSlot]=z,this._updateFirstDevices(z.deviceType)),this.onDeviceConnectedObservable.notifyObservers(z)}_removeDevice(z,a){var K,v;const T=null===(K=this._devices[z])||void 0===K?void 0:K[a];this.onDeviceDisconnectedObservable.notifyObservers(T),null!==(v=this._devices[z])&&void 0!==v&&v[a]&&delete this._devices[z][a],this._updateFirstDevices(z)}_onInputChanged(z,a,K){var v,T;null===(v=this._devices[z])||void 0===v||null===(T=v[a])||void 0===T||T.onInputChangedObservable.notifyObservers(K)}_updateFirstDevices(z){switch(z){case I.Keyboard:case I.Mouse:this._firstDevice[z]=0;break;case I.Touch:case I.DualSense:case I.DualShock:case I.Xbox:case I.Switch:case I.Generic:{delete this._firstDevice[z];const a=this._devices[z];if(a)for(let K=0;K<a.length;K++)if(a[K]){this._firstDevice[z]=K;break}break}}}}var t=K(11031);class e{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(z){this._singleClick=z}set doubleClick(z){this._doubleClick=z}set hasSwiped(z){this._hasSwiped=z}set ignore(z){this._ignore=z}}class L{constructor(z){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new M.m(0,0),this._previousStartingPointerPosition=new M.m(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=z||w.b.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(z){return this._meshUnderPointerId[z]||null}get unTranslatedPointer(){return new M.m(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(z){this._pointerX=z}get pointerY(){return this._pointerY}set pointerY(z){this._pointerY=z}_updatePointerPosition(z){const a=this._scene.getEngine().getInputElementClientRect();a&&(this._pointerX=z.clientX-a.left,this._pointerY=z.clientY-a.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(z,a){const K=this._scene,v=K.getEngine(),T=v.getInputElement();T&&(T.tabIndex=v.canvasTabIndex,K.doNotHandleCursors||(T.style.cursor=K.defaultCursor)),this._setCursorAndPointerOverMesh(z,a,K);for(const s of K._pointerMoveStage){var m;const K=!(null===(m=z=z||this._pickMove(a))||void 0===m||!m.pickedMesh);z=s.action(this._unTranslatedPointerX,this._unTranslatedPointerY,z,K,T)}const p=a.inputIndex>=q.MouseWheelX&&a.inputIndex<=q.MouseWheelZ?f.e.POINTERWHEEL:f.e.POINTERMOVE;let j;K.onPointerMove&&(z=z||this._pickMove(a),K.onPointerMove(a,z,p)),z?(j=new f.k(p,a,z),this._setRayOnPointerInfo(z,a)):(j=new f.k(p,a,null,this),this._movePointerInfo=j),K.onPointerObservable.hasObservers()&&K.onPointerObservable.notifyObservers(j,p)}_setRayOnPointerInfo(z,a){const K=this._scene;z&&t.c._IsPickingAvailable&&(z.ray||(z.ray=K.createPickingRay(a.offsetX,a.offsetY,M.b.Identity(),K.activeCamera)))}_addCameraPointerObserver(z,a){return this._cameraObserverCount++,this._scene.onPointerObservable.add(z,a)}_removeCameraPointerObserver(z){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(z)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(z,a,K){const v=this._scene,T=new f.i(K,a,this._unTranslatedPointerX,this._unTranslatedPointerY);return z&&(T.originalPickingInfo=z,T.ray=z.ray,"xr-near"===a.pointerType&&z.originMesh&&(T.nearInteractionPickingInfo=z)),v.onPrePointerObservable.notifyObservers(T,K),!!T.skipOnPointerObservable}_pickMove(z){const a=this._scene,K=a.jc(this._unTranslatedPointerX,this._unTranslatedPointerY,a.pointerMovePredicate,a.pointerMoveFastCheck,a.cameraToUseForPointers,a.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(K,z,a),K}_setCursorAndPointerOverMesh(z,a,K){const v=K.getEngine().getInputElement();if(null!==z&&void 0!==z&&z.pickedMesh){if(this.setPointerOverMesh(z.pickedMesh,a.pointerId,z,a),!K.doNotHandleCursors&&v&&this._pointerOverMesh){const z=this._pointerOverMesh._getActionManagerForTrigger();z&&z.hasPointerTriggers&&(v.style.cursor=z.hoverCursor||K.hoverCursor)}}else this.setPointerOverMesh(null,a.pointerId,z,a)}simulatePointerMove(z,a){const K=new PointerEvent("pointermove",a);K.inputIndex=q.Move,this._checkPrePointerObservable(z,K,f.e.POINTERMOVE)||this._processPointerMove(z,K)}simulatePointerDown(z,a){const K=new PointerEvent("pointerdown",a);K.inputIndex=K.button+2,this._checkPrePointerObservable(z,K,f.e.POINTERDOWN)||this._processPointerDown(z,K)}_processPointerDown(z,a){var K;const v=this._scene;if(null!==(K=z)&&void 0!==K&&K.pickedMesh){this._pickedDownMesh=z.pickedMesh;const K=z.pickedMesh._getActionManagerForTrigger();if(K){if(K.hasPickTriggers)switch(K.processTrigger(5,G.CreateNew(z.pickedMesh,a,z)),a.button){case 0:K.processTrigger(2,G.CreateNew(z.pickedMesh,a,z));break;case 1:K.processTrigger(4,G.CreateNew(z.pickedMesh,a,z));break;case 2:K.processTrigger(3,G.CreateNew(z.pickedMesh,a,z))}K.hasSpecificTrigger(8)&&window.setTimeout((()=>{const z=v.jc(this._unTranslatedPointerX,this._unTranslatedPointerY,(z=>z.Hb&&z.isVisible&&z.isReady()&&z.actionManager&&z.actionManager.hasSpecificTrigger(8)&&z===this._pickedDownMesh),!1,v.cameraToUseForPointers);null!==z&&void 0!==z&&z.pickedMesh&&K&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>L.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,K.processTrigger(8,G.CreateNew(z.pickedMesh,a)))}),L.LongPressDelay)}}else for(const p of v._pointerDownStage)z=p.action(this._unTranslatedPointerX,this._unTranslatedPointerY,z,a,!1);let T;const m=f.e.POINTERDOWN;z?(v.onPointerDown&&v.onPointerDown(a,z,m),T=new f.k(m,a,z),this._setRayOnPointerInfo(z,a)):T=new f.k(m,a,null,this),v.onPointerObservable.hasObservers()&&v.onPointerObservable.notifyObservers(T,m)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(z,a,K){const v=new PointerEvent("pointerup",a);v.inputIndex=q.Move;const T=new e;K?T.doubleClick=!0:T.singleClick=!0,this._checkPrePointerObservable(z,v,f.e.POINTERUP)||this._processPointerUp(z,v,T)}_processPointerUp(z,a,K){var v;const T=this._scene;if(null!==(v=z)&&void 0!==v&&v.pickedMesh){if(this._pickedUpMesh=z.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(T.onPointerPick&&T.onPointerPick(a,z),K.singleClick&&!K.ignore&&T.onPointerObservable.observers.length>this._cameraObserverCount)){const K=f.e.POINTERPICK,v=new f.k(K,a,z);this._setRayOnPointerInfo(z,a),T.onPointerObservable.notifyObservers(v,K)}const v=z.pickedMesh._getActionManagerForTrigger();if(v&&!K.ignore){v.processTrigger(7,G.CreateNew(z.pickedMesh,a,z)),!K.hasSwiped&&K.singleClick&&v.processTrigger(1,G.CreateNew(z.pickedMesh,a,z));const T=z.pickedMesh._getActionManagerForTrigger(6);K.doubleClick&&T&&T.processTrigger(6,G.CreateNew(z.pickedMesh,a,z))}}else if(!K.ignore)for(const m of T._pointerUpStage)z=m.action(this._unTranslatedPointerX,this._unTranslatedPointerY,z,a,K.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const z=this._pickedDownMesh._getActionManagerForTrigger(16);z&&z.processTrigger(16,G.CreateNew(this._pickedDownMesh,a))}if(!K.ignore){const v=new f.k(f.e.POINTERUP,a,z);if(this._setRayOnPointerInfo(z,a),T.onPointerObservable.notifyObservers(v,f.e.POINTERUP),T.onPointerUp&&T.onPointerUp(a,z,f.e.POINTERUP),!K.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let v=0;if(K.singleClick?v=f.e.POINTERTAP:K.doubleClick&&(v=f.e.POINTERDOUBLETAP),v){const K=new f.k(v,a,z);T.onPointerObservable.hasObservers()&&T.onPointerObservable.hasSpecificMask(v)&&T.onPointerObservable.notifyObservers(K,v)}}}}isPointerCaptured(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[z]}attachControl(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const T=this._scene,m=T.getEngine();v||(v=m.getInputElement()),this._alreadyAttached&&this.Ui(),v&&(this._alreadyAttachedTo=v),this._deviceSourceManager=new d(m),this._initActionManager=z=>{if(!this._meshPickProceed){const a=T.skipPointerUpPicking||0===T._registeredActions&&!this._checkForPicking()&&!T.onPointerUp?null:T.jc(this._unTranslatedPointerX,this._unTranslatedPointerY,T.pointerUpPredicate,T.pointerUpFastCheck,T.cameraToUseForPointers,T.pointerUpTrianglePredicate);this._currentPickResult=a,a&&(z=a.hit&&a.pickedMesh?a.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return z},this._delayedSimpleClick=(z,a,K)=>{if((Date.now()-this._previousStartingPointerTime>L.DoubleClickDelay&&!this._doubleClickOccured||z!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,a.singleClick=!0,a.ignore=!1,this._delayedClicks[z])){const a=this._delayedClicks[z].evt,K=f.e.POINTERTAP,v=new f.k(K,a,this._currentPickResult);T.onPointerObservable.hasObservers()&&T.onPointerObservable.hasSpecificMask(K)&&T.onPointerObservable.notifyObservers(v,K),this._delayedClicks[z]=null}},this._initClickEvent=(z,a,K,v)=>{const T=new e;this._currentPickResult=null;let m=null,p=z.hasSpecificMask(f.e.POINTERPICK)||a.hasSpecificMask(f.e.POINTERPICK)||z.hasSpecificMask(f.e.POINTERTAP)||a.hasSpecificMask(f.e.POINTERTAP)||z.hasSpecificMask(f.e.POINTERDOUBLETAP)||a.hasSpecificMask(f.e.POINTERDOUBLETAP);!p&&Y&&(m=this._initActionManager(m,T),m&&(p=m.hasPickTriggers));let j=!1;if(p){const p=K.button;if(T.hasSwiped=this._isPointerSwiping(),!T.hasSwiped){let r=!L.ExclusiveDoubleClickMode;if(r||(r=!z.hasSpecificMask(f.e.POINTERDOUBLETAP)&&!a.hasSpecificMask(f.e.POINTERDOUBLETAP),r&&!Y.HasSpecificTrigger(6)&&(m=this._initActionManager(m,T),m&&(r=!m.hasSpecificTrigger(6)))),r)(Date.now()-this._previousStartingPointerTime>L.DoubleClickDelay||p!==this._previousButtonPressed)&&(T.singleClick=!0,v(T,this._currentPickResult),j=!0);else{const z={evt:K,clickInfo:T,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,p,T,v),L.DoubleClickDelay)};this._delayedClicks[p]=z}let W=z.hasSpecificMask(f.e.POINTERDOUBLETAP)||a.hasSpecificMask(f.e.POINTERDOUBLETAP);if(!W&&Y.HasSpecificTrigger(6)&&(m=this._initActionManager(m,T),m&&(W=m.hasSpecificTrigger(6))),W)if(p===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<L.DoubleClickDelay&&!this._doubleClickOccured){if(T.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=p,L.ExclusiveDoubleClickMode){var s;if(this._delayedClicks[p])clearTimeout(null===(s=this._delayedClicks[p])||void 0===s?void 0:s.timeoutId),this._delayedClicks[p]=null;v(T,this._previousPickResult)}else v(T,this._currentPickResult);else{var M;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,T.doubleClick=!0,T.ignore=!1,L.ExclusiveDoubleClickMode&&this._delayedClicks[p])clearTimeout(null===(M=this._delayedClicks[p])||void 0===M?void 0:M.timeoutId),this._delayedClicks[p]=null;v(T,this._currentPickResult)}j=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=p}}j||v(T,this._currentPickResult)},this._onPointerMove=z=>{if(this._updatePointerPosition(z),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>L.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>L.DragMovementThreshold),m.isPointerLock&&m._verifyPointerLock(),this._checkPrePointerObservable(null,z,z.inputIndex>=q.MouseWheelX&&z.inputIndex<=q.MouseWheelZ?f.e.POINTERWHEEL:f.e.POINTERMOVE))return;if(!T.cameraToUseForPointers&&!T.activeCamera)return;if(T.bj)return void this._processPointerMove(new F.d,z);T.pointerMovePredicate||(T.pointerMovePredicate=z=>z.Hb&&z.isVisible&&z.isReady()&&z.isEnabled()&&(z.enablePointerMoveEvents||T.constantlyUpdateMeshUnderPointer||null!==z._getActionManagerForTrigger())&&(!T.cameraToUseForPointers||0!==(T.cameraToUseForPointers.layerMask&z.layerMask)));const a=T._registeredActions>0||T.constantlyUpdateMeshUnderPointer?this._pickMove(z):null;this._processPointerMove(a,z)},this._onPointerDown=z=>{const a=this._activePointerIds.indexOf(-1);if(-1===a?this._activePointerIds.push(z.pointerId):this._activePointerIds[a]=z.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,L.ExclusiveDoubleClickMode)for(let v=0;v<this._delayedClicks.length;v++)if(this._delayedClicks[v])if(z.button===v){var K;clearTimeout(null===(K=this._delayedClicks[v])||void 0===K?void 0:K.timeoutId)}else{const z=this._delayedClicks[v].clickInfo;this._doubleClickOccured=!1,z.singleClick=!0,z.ignore=!1;const a=this._delayedClicks[v].evt,K=f.e.POINTERTAP,m=new f.k(K,a,this._currentPickResult);T.onPointerObservable.hasObservers()&&T.onPointerObservable.hasSpecificMask(K)&&T.onPointerObservable.notifyObservers(m,K),this._delayedClicks[v]=null}if(this._updatePointerPosition(z),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=z.button),T.preventDefaultOnPointerDown&&v&&(z.preventDefault(),v.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,z,f.e.POINTERDOWN))return;if(!T.cameraToUseForPointers&&!T.activeCamera)return;let m;this._pointerCaptures[z.pointerId]=!0,T.pointerDownPredicate||(T.pointerDownPredicate=z=>z.Hb&&z.isVisible&&z.isReady()&&z.isEnabled()&&(!T.cameraToUseForPointers||0!==(T.cameraToUseForPointers.layerMask&z.layerMask))),this._pickedDownMesh=null,m=T.skipPointerDownPicking||0===T._registeredActions&&!this._checkForPicking()&&!T.onPointerDown?new F.d:T.jc(this._unTranslatedPointerX,this._unTranslatedPointerY,T.pointerDownPredicate,T.pointerDownFastCheck,T.cameraToUseForPointers,T.pointerDownTrianglePredicate),this._processPointerDown(m,z)},this._onPointerUp=z=>{const a=this._activePointerIds.indexOf(z.pointerId);-1!==a&&(this._activePointerIds[a]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(z),T.preventDefaultOnPointerUp&&v&&(z.preventDefault(),v.focus()),this._initClickEvent(T.onPrePointerObservable,T.onPointerObservable,z,((a,K)=>{if(T.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!a.ignore)){if(this._checkPrePointerObservable(null,z,f.e.POINTERUP))return this._swipeButtonPressed===z.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===z.buttons&&(this._pointerCaptures[z.pointerId]=!1));a.hasSwiped||(a.singleClick&&T.onPrePointerObservable.hasSpecificMask(f.e.POINTERTAP)&&this._checkPrePointerObservable(null,z,f.e.POINTERTAP)&&(this._skipPointerTap=!0),a.doubleClick&&T.onPrePointerObservable.hasSpecificMask(f.e.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,z,f.e.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[z.pointerId]?(0===z.buttons&&(this._pointerCaptures[z.pointerId]=!1),(T.cameraToUseForPointers||T.activeCamera)&&(T.pointerUpPredicate||(T.pointerUpPredicate=z=>z.Hb&&z.isVisible&&z.isReady()&&z.isEnabled()&&(!T.cameraToUseForPointers||0!==(T.cameraToUseForPointers.layerMask&z.layerMask))),!this._meshPickProceed&&(Y&&Y.HasTriggers||this._checkForPicking()||T.onPointerUp)&&this._initActionManager(null,a),K||(K=this._currentPickResult),this._processPointerUp(K,z,a),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===z.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===z.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=z=>{const a=n.c.KEYDOWN;if(T.onPreKeyboardObservable.hasObservers()){const K=new n.g(a,z);if(T.onPreKeyboardObservable.notifyObservers(K,a),K.skipOnKeyboardObservable)return}if(T.onKeyboardObservable.hasObservers()){const K=new n.k(a,z);T.onKeyboardObservable.notifyObservers(K,a)}T.actionManager&&T.actionManager.processTrigger(14,G.CreateNewFromScene(T,z))},this._onKeyUp=z=>{const a=n.c.KEYUP;if(T.onPreKeyboardObservable.hasObservers()){const K=new n.g(a,z);if(T.onPreKeyboardObservable.notifyObservers(K,a),K.skipOnKeyboardObservable)return}if(T.onKeyboardObservable.hasObservers()){const K=new n.k(a,z);T.onKeyboardObservable.notifyObservers(K,a)}T.actionManager&&T.actionManager.processTrigger(15,G.CreateNewFromScene(T,z))},this._deviceSourceManager.onDeviceConnectedObservable.add((v=>{v.deviceType===I.Mouse?v.onInputChangedObservable.add((T=>{this._originMouseEvent=T,T.inputIndex===q.LeftClick||T.inputIndex===q.MiddleClick||T.inputIndex===q.RightClick||T.inputIndex===q.BrowserBack||T.inputIndex===q.BrowserForward?a&&1===v.getInput(T.inputIndex)?this._onPointerDown(T):z&&0===v.getInput(T.inputIndex)&&this._onPointerUp(T):K&&(T.inputIndex===q.Move?this._onPointerMove(T):T.inputIndex!==q.MouseWheelX&&T.inputIndex!==q.MouseWheelY&&T.inputIndex!==q.MouseWheelZ||this._onPointerMove(T))})):v.deviceType===I.Touch?v.onInputChangedObservable.add((T=>{T.inputIndex===q.LeftClick&&(a&&1===v.getInput(T.inputIndex)?(this._onPointerDown(T),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):z&&0===v.getInput(T.inputIndex)&&(this._onPointerUp(T),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),K&&T.inputIndex===q.Move&&this._onPointerMove(T)})):v.deviceType===I.Keyboard&&v.onInputChangedObservable.add((z=>{"keydown"===z.type?this._onKeyDown(z):"keyup"===z.type&&this._onKeyUp(z)}))})),this._alreadyAttached=!0}Ui(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0,v=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[a]===z&&(!z||!z._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const T=this._meshUnderPointerId[a];let m;T&&(m=T._getActionManagerForTrigger(10),m&&m.processTrigger(10,G.CreateNew(T,v,{pointerId:a}))),z?(this._meshUnderPointerId[a]=z,this._pointerOverMesh=z,m=z._getActionManagerForTrigger(9),m&&m.processTrigger(9,G.CreateNew(z,v,{pointerId:a,pickResult:K}))):(delete this._meshUnderPointerId[a],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(z){this._pointerOverMesh===z&&(this._pointerOverMesh=null),this._pickedDownMesh===z&&(this._pickedDownMesh=null),this._pickedUpMesh===z&&(this._pickedUpMesh=null);for(const a in this._meshUnderPointerId)this._meshUnderPointerId[a]===z&&delete this._meshUnderPointerId[a]}}L.DragMovementThreshold=10,L.LongPressDelay=500,L.DoubleClickDelay=300,L.ExclusiveDoubleClickMode=!1;var E=K(10788),b=K(10971),D=K(11036),u=K(11046),U=K(10682),R=K(11054),k=K(10951);class h{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.bj=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var S,Q=K(10648),O=K(10767);!function(z){z[z.BackwardCompatible=0]="BackwardCompatible",z[z.Intermediate=1]="Intermediate",z[z.Aggressive=2]="Aggressive"}(S||(S={}));class zz{static DefaultMaterialFactory(z){throw(0,H.b)("sb")}static CollisionCoordinatorFactory(){throw(0,H.b)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(z){z!==this._clearColor&&(this._clearColor=z,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(z){if(z!==this._performancePriority){switch(this._performancePriority=z,z){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.bj=!1,this.Vi=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.bj=!0,this.Vi=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.bj=!0,this.Vi=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(z)}}set forceWireframe(z){this._forceWireframe!==z&&(this._forceWireframe=z,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(z){this._skipFrustumClipping!==z&&(this._skipFrustumClipping=z)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(z){this._forcePointsCloud!==z&&(this._forcePointsCloud=z,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(z){this._environmentTexture!==z&&(this._environmentTexture=z,this.markAllMaterialsAsDirty(1))}getNodes(){let z=[];return z=z.concat(this.meshes),z=z.concat(this.lights),z=z.concat(this.cameras),z=z.concat(this.transformNodes),this.skeletons.forEach((a=>z=z.concat(a.bones))),z}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(z){this._animationPropertiesOverride=z}set onDispose(z){this._onDisposeObserver&&this.lj.remove(this._onDisposeObserver),this._onDisposeObserver=this.lj.add(z)}set beforeRender(z){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),z&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(z))}set afterRender(z){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),z&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(z))}set beforeCameraRender(z){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(z)}set afterCameraRender(z){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(z)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(z){this._pointerPickingConfiguration.pointerDownPredicate=z}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(z){this._pointerPickingConfiguration.pointerUpPredicate=z}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(z){this._pointerPickingConfiguration.pointerMovePredicate=z}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(z){this._pointerPickingConfiguration.pointerDownFastCheck=z}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(z){this._pointerPickingConfiguration.pointerUpFastCheck=z}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(z){this._pointerPickingConfiguration.pointerMoveFastCheck=z}get bj(){return this._pointerPickingConfiguration.bj}set bj(z){this._pointerPickingConfiguration.bj=z}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(z){this._pointerPickingConfiguration.skipPointerDownPicking=z}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(z){this._pointerPickingConfiguration.skipPointerUpPicking=z}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return L.DragMovementThreshold}static set DragMovementThreshold(z){L.DragMovementThreshold=z}static get LongPressDelay(){return L.LongPressDelay}static set LongPressDelay(z){L.LongPressDelay=z}static get DoubleClickDelay(){return L.DoubleClickDelay}static set DoubleClickDelay(z){L.DoubleClickDelay=z}static get ExclusiveDoubleClickMode(){return L.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(z){L.ExclusiveDoubleClickMode=z}bindEyePosition(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,T=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return M.j.Vector4[0].set(v.x,v.y,v.z,T?-1:1),z&&(K?z.setFloat3(a,M.j.Vector4[0].x,M.j.Vector4[0].y,M.j.Vector4[0].z):z.setVector4(a,M.j.Vector4[0])),M.j.Vector4[0]}finalizeSceneUbo(){const z=this.getSceneUniformBuffer(),a=this.bindEyePosition(null);return z.updateFloat4("vEyePosition",a.x,a.y,a.z,a.w),z.update(),z}set useRightHandedSystem(z){this._useRightHandedSystem!==z&&(this._useRightHandedSystem=z,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(z){this._currentStepId=z}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(z){this._fogEnabled!==z&&(this._fogEnabled=z,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(z){this._fogMode!==z&&(this._fogMode=z,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(z){this._shadowsEnabled!==z&&(this._shadowsEnabled=z,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(z){this._lightsEnabled!==z&&(this._lightsEnabled=z,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(z){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),z&&(this._unObserveActiveCameras=(0,k.j)(z,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=z}get activeCamera(){return this._activeCamera}set activeCamera(z){z!==this._activeCamera&&(this._activeCamera=z,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this.xi||(this.xi=zz.DefaultMaterialFactory(this)),this.xi}set defaultMaterial(z){this.xi=z}set texturesEnabled(z){this._texturesEnabled!==z&&(this._texturesEnabled=z,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(z){if(this._frameGraph)return this._frameGraph=z,void(z||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=z,z&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(z){this._skeletonsEnabled!==z&&(this._skeletonsEnabled=z,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=zz.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const z of this._transientComponents)z.register();this._transientComponents.length=0}}o(z){this._components.push(z),this._transientComponents.push(z);const a=z;a.addFromContainer&&a.serialize&&this._serializableComponents.push(a)}_getComponent(z){for(const a of this._components)if(a.name===z)return a;return null}constructor(z,a){this._inputManager=new L(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Vi=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new b.d(.2,.2,.3,1),this.onClearColorChangedObservable=new m.c,this.ambientColor=new b.c(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new m.c,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.sj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.bk=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.lj=new m.c,this._onDisposeObserver=null,this.onBeforeRenderObservable=new m.c,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new m.c,this.onAfterRenderCameraObservable=new m.c,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new m.c,this.onAfterAnimationsObservable=new m.c,this.onBeforeDrawPhaseObservable=new m.c,this.onAfterDrawPhaseObservable=new m.c,this.onReadyObservable=new m.c,this.onBeforeCameraRenderObservable=new m.c,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new m.c,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new m.c,this.onAfterActiveMeshesEvaluationObservable=new m.c,this.onBeforeParticlesRenderingObservable=new m.c,this.onAfterParticlesRenderingObservable=new m.c,this.onDataLoadedObservable=new m.c,this.onNewCameraAddedObservable=new m.c,this.onCameraRemovedObservable=new m.c,this.onNewLightAddedObservable=new m.c,this.onLightRemovedObservable=new m.c,this.onNewGeometryAddedObservable=new m.c,this.onGeometryRemovedObservable=new m.c,this.onNewTransformNodeAddedObservable=new m.c,this.onTransformNodeRemovedObservable=new m.c,this.onNewMeshAddedObservable=new m.c,this.onMeshRemovedObservable=new m.c,this.onNewSkeletonAddedObservable=new m.c,this.onSkeletonRemovedObservable=new m.c,this.onNewMaterialAddedObservable=new m.c,this.onNewMultiMaterialAddedObservable=new m.c,this.onMaterialRemovedObservable=new m.c,this.onMultiMaterialRemovedObservable=new m.c,this.onNewTextureAddedObservable=new m.c,this.onTextureRemovedObservable=new m.c,this.onBeforeRenderTargetsRenderObservable=new m.c,this.onAfterRenderTargetsRenderObservable=new m.c,this.onBeforeStepObservable=new m.c,this.onAfterStepObservable=new m.c,this.onActiveCameraChanged=new m.c,this.onActiveCamerasChanged=new m.c,this.onBeforeRenderingGroupObservable=new m.c,this.onAfterRenderingGroupObservable=new m.c,this.onMeshImportedObservable=new m.c,this.onAnimationFileImportedObservable=new m.c,this._registeredForLateAnimationBindings=new p.e(256),this._pointerPickingConfiguration=new h,this.onPrePointerObservable=new m.c,this.onPointerObservable=new m.c,this.onPreKeyboardObservable=new m.c,this.onKeyboardObservable=new m.c,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=zz.FOGMODE_NONE,this.fogColor=new b.c(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new M.o(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new p.e(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new E.d,this._activeIndices=new E.d,this._activeParticles=new E.d,this._activeBones=new E.d,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new p.f(256),this._processedMaterials=new p.f(256),this._renderTargets=new p.e(256),this._materialsRenderTargets=new p.e(256),this._activeParticleSystems=new p.f(256),this._activeSkeletons=new p.e(32),this._softwareSkinnedMeshes=new p.e(32),this._activeAnimatables=new Array,this._transformMatrix=M.b.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=c.d.Create(),this._beforeClearStage=c.d.Create(),this._beforeRenderTargetClearStage=c.d.Create(),this._gatherRenderTargetsStage=c.d.Create(),this._gatherActiveCameraRenderTargetsStage=c.d.Create(),this._isReadyForMeshStage=c.d.Create(),this._beforeEvaluateActiveMeshStage=c.d.Create(),this._evaluateSubMeshStage=c.d.Create(),this._preActiveMeshStage=c.d.Create(),this._cameraDrawRenderTargetStage=c.d.Create(),this._beforeCameraDrawStage=c.d.Create(),this._beforeRenderTargetDrawStage=c.d.Create(),this._beforeRenderingGroupDrawStage=c.d.Create(),this._beforeRenderingMeshStage=c.d.Create(),this._afterRenderingMeshStage=c.d.Create(),this._afterRenderingGroupDrawStage=c.d.Create(),this._afterCameraDrawStage=c.d.Create(),this._afterCameraPostProcessStage=c.d.Create(),this._afterRenderTargetDrawStage=c.d.Create(),this._afterRenderTargetPostProcessStage=c.d.Create(),this._afterRenderStage=c.d.Create(),this._pointerMoveStage=c.d.Create(),this._pointerDownStage=c.d.Create(),this._pointerUpStage=c.d.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const K={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...a};z=this._engine=z||w.b.LastCreatedEngine,K.virtual?z._virtualScenes.push(this):(w.b._LastCreatedScene=this,z.scenes.push(this)),this._uid=null,this._renderingManager=new V.e(this),l.d&&(this.postProcessManager=new l.d(this)),(0,C.m)()&&this.attachControl(),this._createUbo(),r.e&&(this._imageProcessingConfiguration=new r.e),this.setDefaultCandidateProviders(),K.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=K.useMaterialMeshMap,this.useClonedMeshMap=K.useClonedMeshMap,a&&a.virtual||z.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(z){return this._defaultSubMeshCandidates.data=z.Vf,this._defaultSubMeshCandidates.length=z.Vf.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=z=>this._getDefaultSubMeshCandidates(z),this.getIntersectingSubMeshCandidates=(z,a)=>this._getDefaultSubMeshCandidates(z),this.getCollidingSubMeshCandidates=(z,a)=>this._getDefaultSubMeshCandidates(z)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(z){this._inputManager.pointerX=z}get pointerY(){return this._inputManager.pointerY}set pointerY(z){this._inputManager.pointerY=z}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==a||this._cachedMaterial!==z||this._cachedVisibility!==K}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(z,a){return this._inputManager.simulatePointerMove(z,a),this}simulatePointerDown(z,a){return this._inputManager.simulatePointerDown(z,a),this}simulatePointerUp(z,a,K){return this._inputManager.simulatePointerUp(z,a,K),this}isPointerCaptured(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(z)}attachControl(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(z,a,K)}Ui(){this._inputManager.Ui()}isReady(){var z,a;let K,v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const T=this.getEngine(),m=T.currentRenderPassId;T.currentRenderPassId=(null===(z=this.activeCamera)||void 0===z?void 0:z.renderPassId)??m;let p=!0;for(this._pendingData.length>0&&(p=!1),null===(a=this.prePassRenderer)||void 0===a||a.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&p&&(p=this.depthPeelingRenderer.isReady()),v&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),K=0;K<this.meshes.length;K++){const z=this.meshes[K];if(!z.Vf||0===z.Vf.length)continue;if(!z.isReady(!0)){p=!1;continue}const a=z.hasThinInstances||"InstancedMesh"===z.getClassName()||"InstancedLinesMesh"===z.getClassName()||T.getCaps().instancedArrays&&z.instances.length>0;for(const K of this._isReadyForMeshStage)K.action(z,a)||(p=!1);if(!v)continue;const m=z.material||this.defaultMaterial;if(m)if(m._storeEffectOnSubMeshes)for(const K of z.Vf){const z=K.Ha();z&&z.hasRenderTargetTextures&&null!=z.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(z)&&(this._processedMaterials.push(z),this._materialsRenderTargets.concatWithNoDuplicate(z.getRenderTargetTextures()))}else m.hasRenderTargetTextures&&null!=m.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(m)&&(this._processedMaterials.push(m),this._materialsRenderTargets.concatWithNoDuplicate(m.getRenderTargetTextures()))}if(v)for(K=0;K<this._materialsRenderTargets.length;++K){this._materialsRenderTargets.data[K].isReadyForRendering()||(p=!1)}for(K=0;K<this.geometries.length;K++){2===this.geometries[K].delayLoadState&&(p=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const j of this.activeCameras)j.isReady(!0)||(p=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(p=!1));for(const j of this.sj)j.isReady()||(p=!1);if(this.layers)for(const j of this.layers)j.isReady()||(p=!1);return T.areAllEffectsReady()||(p=!1),T.currentRenderPassId=m,p}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(z){this.onBeforeRenderObservable.add(z)}unregisterBeforeRender(z){this.onBeforeRenderObservable.removeCallback(z)}registerAfterRender(z){this.onAfterRenderObservable.add(z)}unregisterAfterRender(z){this.onAfterRenderObservable.removeCallback(z)}_executeOnceBeforeRender(z){const a=()=>{z(),setTimeout((()=>{this.unregisterBeforeRender(a)}))};this.registerBeforeRender(a)}executeOnceBeforeRender(z,a){void 0!==a?setTimeout((()=>{this._executeOnceBeforeRender(z)}),a):this._executeOnceBeforeRender(z)}addPendingData(z){this._pendingData.push(z)}removePendingData(z){const a=this.isLoading,K=this._pendingData.indexOf(z);-1!==K&&this._pendingData.splice(K,1),a&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(z),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(a)}whenReadyAsync(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((a=>{this.executeWhenReady((()=>{a()}),z)}))}_checkIsReady(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(z)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(z)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=T.d.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(z,a,K,v){K||v||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===z.updateFlag&&this._projectionUpdateFlag===a.updateFlag||(this._viewUpdateFlag=z.updateFlag,this._projectionUpdateFlag=a.updateFlag,this._viewMatrix=z,this._projectionMatrix=a,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?D.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=D.b.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(K,v):this._sceneUbo.useUbo&&(this._sceneUbo.Jj("viewProjection",this._transformMatrix),this._sceneUbo.Jj("view",this._viewMatrix),this._sceneUbo.Jj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(z){const a=new W.c(this._engine,void 0,!1,z??"Oc");return a.addUniform("viewProjection",16),a.addUniform("view",16),a.addUniform("projection",16),a.addUniform("vEyePosition",4),a}setSceneUniformBuffer(z){this._sceneUbo=z,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return u.d.UniqueId}mi(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(z),z._resyncLightSources(),z.parent||z._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(z),a&&z.getChildMeshes().forEach((z=>{this.mi(z)})))}Bc(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const K=this.meshes.indexOf(z);return-1!==K&&(this.meshes.splice(K,1),z.parent||z._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(z),this.onMeshRemovedObservable.notifyObservers(z),a&&z.getChildMeshes().forEach((z=>{this.Bc(z)})),K}addTransformNode(z){this._blockEntityCollection||z.va()===this&&-1!==z._indexInSceneTransformNodesArray||(z._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(z),z.parent||z._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(z))}removeTransformNode(z){const a=z._indexInSceneTransformNodesArray;if(-1!==a){if(a!==this.transformNodes.length-1){const z=this.transformNodes[this.transformNodes.length-1];this.transformNodes[a]=z,z._indexInSceneTransformNodesArray=a}z._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),z.parent||z._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(z),a}removeSkeleton(z){const a=this.skeletons.indexOf(z);return-1!==a&&(this.skeletons.splice(a,1),this.onSkeletonRemovedObservable.notifyObservers(z),this._executeActiveContainerCleanup(this._activeSkeletons)),a}removeMorphTargetManager(z){const a=this.morphTargetManagers.indexOf(z);return-1!==a&&this.morphTargetManagers.splice(a,1),a}removeLight(z){const a=this.lights.indexOf(z);if(-1!==a){for(const a of this.meshes)a._removeLightSource(z,!1);this.lights.splice(a,1),this.sortLightsByPriority(),z.parent||z._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(z),a}removeCamera(z){const a=this.cameras.indexOf(z);if(-1!==a&&(this.cameras.splice(a,1),z.parent||z._removeFromSceneRootNodes()),this.activeCameras){const a=this.activeCameras.indexOf(z);-1!==a&&this.activeCameras.splice(a,1)}return this.activeCamera===z&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(z),a}removeParticleSystem(z){const a=this.sj.indexOf(z);return-1!==a&&(this.sj.splice(a,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),a}removeAnimation(z){const a=this.animations.indexOf(z);return-1!==a&&this.animations.splice(a,1),a}stopAnimation(z,a,K){}removeAnimationGroup(z){const a=this.animationGroups.indexOf(z);return-1!==a&&this.animationGroups.splice(a,1),a}removeMultiMaterial(z){const a=this.multiMaterials.indexOf(z);return-1!==a&&this.multiMaterials.splice(a,1),this.onMultiMaterialRemovedObservable.notifyObservers(z),a}removeMaterial(z){const a=z._indexInSceneMaterialArray;if(-1!==a&&a<this.materials.length){if(a!==this.materials.length-1){const z=this.materials[this.materials.length-1];this.materials[a]=z,z._indexInSceneMaterialArray=a}z._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(z),a}removeActionManager(z){const a=this.actionManagers.indexOf(z);return-1!==a&&this.actionManagers.splice(a,1),a}removeTexture(z){const a=this.textures.indexOf(z);return-1!==a&&this.textures.splice(a,1),this.onTextureRemovedObservable.notifyObservers(z),a}addLight(z){if(!this._blockEntityCollection){this.lights.push(z),this.sortLightsByPriority(),z.parent||z._addToSceneRootNodes();for(const a of this.meshes)-1===a.lightSources.indexOf(z)&&(a.lightSources.push(z),a._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(z)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(R.e.CompareLightsPriority)}addCamera(z){this._blockEntityCollection||(this.cameras.push(z),this.onNewCameraAddedObservable.notifyObservers(z),z.parent||z._addToSceneRootNodes())}addSkeleton(z){this._blockEntityCollection||(this.skeletons.push(z),this.onNewSkeletonAddedObservable.notifyObservers(z))}addParticleSystem(z){this._blockEntityCollection||this.sj.push(z)}addAnimation(z){this._blockEntityCollection||this.animations.push(z)}addAnimationGroup(z){this._blockEntityCollection||this.animationGroups.push(z)}addMultiMaterial(z){this._blockEntityCollection||(this.multiMaterials.push(z),this.onNewMultiMaterialAddedObservable.notifyObservers(z))}addMaterial(z){this._blockEntityCollection||z.va()===this&&-1!==z._indexInSceneMaterialArray||(z._indexInSceneMaterialArray=this.materials.length,this.materials.push(z),this.onNewMaterialAddedObservable.notifyObservers(z))}addMorphTargetManager(z){this._blockEntityCollection||this.morphTargetManagers.push(z)}addGeometry(z){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[z.uniqueId]=this.geometries.length),this.geometries.push(z))}addActionManager(z){this.actionManagers.push(z)}addTexture(z){this._blockEntityCollection||(this.textures.push(z),this.onNewTextureAddedObservable.notifyObservers(z))}switchActiveCamera(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Ui(),this.activeCamera=z,a&&z.attachControl())}setActiveCameraById(z){const a=this.getCameraById(z);return a?(this.activeCamera=a,a):null}setActiveCameraByName(z){const a=this.getCameraByName(z);return a?(this.activeCamera=a,a):null}getAnimationGroupByName(z){for(let a=0;a<this.animationGroups.length;a++)if(this.animationGroups[a].name===z)return this.animationGroups[a];return null}_getMaterial(z,a){for(let K=0;K<this.materials.length;K++){const z=this.materials[K];if(a(z))return z}if(z)for(let K=0;K<this.multiMaterials.length;K++){const z=this.multiMaterials[K];if(a(z))return z}return null}getMaterialByUniqueID(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(a,(a=>a.uniqueId===z))}getMaterialById(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(a,(a=>a.id===z))}getMaterialByName(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(a,(a=>a.name===z))}getLastMaterialById(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let K=this.materials.length-1;K>=0;K--)if(this.materials[K].id===z)return this.materials[K];if(a)for(let K=this.multiMaterials.length-1;K>=0;K--)if(this.multiMaterials[K].id===z)return this.multiMaterials[K];return null}getTextureByUniqueId(z){for(let a=0;a<this.textures.length;a++)if(this.textures[a].uniqueId===z)return this.textures[a];return null}getTextureByName(z){for(let a=0;a<this.textures.length;a++)if(this.textures[a].name===z)return this.textures[a];return null}getCameraById(z){for(let a=0;a<this.cameras.length;a++)if(this.cameras[a].id===z)return this.cameras[a];return null}getCameraByUniqueId(z){for(let a=0;a<this.cameras.length;a++)if(this.cameras[a].uniqueId===z)return this.cameras[a];return null}getCameraByName(z){for(let a=0;a<this.cameras.length;a++)if(this.cameras[a].name===z)return this.cameras[a];return null}getBoneById(z){for(let a=0;a<this.skeletons.length;a++){const K=this.skeletons[a];for(let a=0;a<K.bones.length;a++)if(K.bones[a].id===z)return K.bones[a]}return null}getBoneByName(z){for(let a=0;a<this.skeletons.length;a++){const K=this.skeletons[a];for(let a=0;a<K.bones.length;a++)if(K.bones[a].name===z)return K.bones[a]}return null}getLightByName(z){for(let a=0;a<this.lights.length;a++)if(this.lights[a].name===z)return this.lights[a];return null}getLightById(z){for(let a=0;a<this.lights.length;a++)if(this.lights[a].id===z)return this.lights[a];return null}getLightByUniqueId(z){for(let a=0;a<this.lights.length;a++)if(this.lights[a].uniqueId===z)return this.lights[a];return null}getParticleSystemById(z){for(let a=0;a<this.sj.length;a++)if(this.sj[a].id===z)return this.sj[a];return null}getGeometryById(z){for(let a=0;a<this.geometries.length;a++)if(this.geometries[a].id===z)return this.geometries[a];return null}_getGeometryByUniqueId(z){if(this._geometriesByUniqueId){const a=this._geometriesByUniqueId[z];if(void 0!==a)return this.geometries[a]}else for(let a=0;a<this.geometries.length;a++)if(this.geometries[a].uniqueId===z)return this.geometries[a];return null}pushGeometry(z,a){return!(!a&&this._getGeometryByUniqueId(z.uniqueId))&&(this.addGeometry(z),this.onNewGeometryAddedObservable.notifyObservers(z),!0)}removeGeometry(z){let a;if(this._geometriesByUniqueId){if(a=this._geometriesByUniqueId[z.uniqueId],void 0===a)return!1}else if(a=this.geometries.indexOf(z),a<0)return!1;if(a!==this.geometries.length-1){const z=this.geometries[this.geometries.length-1];z&&(this.geometries[a]=z,this._geometriesByUniqueId&&(this._geometriesByUniqueId[z.uniqueId]=a))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[z.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(z),!0}getGeometries(){return this.geometries}getMeshById(z){for(let a=0;a<this.meshes.length;a++)if(this.meshes[a].id===z)return this.meshes[a];return null}getMeshesById(z){return this.meshes.filter((function(a){return a.id===z}))}getTransformNodeById(z){for(let a=0;a<this.transformNodes.length;a++)if(this.transformNodes[a].id===z)return this.transformNodes[a];return null}getTransformNodeByUniqueId(z){for(let a=0;a<this.transformNodes.length;a++)if(this.transformNodes[a].uniqueId===z)return this.transformNodes[a];return null}getTransformNodesById(z){return this.transformNodes.filter((function(a){return a.id===z}))}getMeshByUniqueId(z){for(let a=0;a<this.meshes.length;a++)if(this.meshes[a].uniqueId===z)return this.meshes[a];return null}getLastMeshById(z){for(let a=this.meshes.length-1;a>=0;a--)if(this.meshes[a].id===z)return this.meshes[a];return null}getLastTransformNodeById(z){for(let a=this.transformNodes.length-1;a>=0;a--)if(this.transformNodes[a].id===z)return this.transformNodes[a];return null}getLastEntryById(z){let a;for(a=this.meshes.length-1;a>=0;a--)if(this.meshes[a].id===z)return this.meshes[a];for(a=this.transformNodes.length-1;a>=0;a--)if(this.transformNodes[a].id===z)return this.transformNodes[a];for(a=this.cameras.length-1;a>=0;a--)if(this.cameras[a].id===z)return this.cameras[a];for(a=this.lights.length-1;a>=0;a--)if(this.lights[a].id===z)return this.lights[a];return null}getNodeById(z){const a=this.getMeshById(z);if(a)return a;const K=this.getTransformNodeById(z);if(K)return K;const v=this.getLightById(z);if(v)return v;const T=this.getCameraById(z);if(T)return T;const m=this.getBoneById(z);return m||null}getNodeByName(z){const a=this.getMeshByName(z);if(a)return a;const K=this.getTransformNodeByName(z);if(K)return K;const v=this.getLightByName(z);if(v)return v;const T=this.getCameraByName(z);if(T)return T;const m=this.getBoneByName(z);return m||null}getMeshByName(z){for(let a=0;a<this.meshes.length;a++)if(this.meshes[a].name===z)return this.meshes[a];return null}getTransformNodeByName(z){for(let a=0;a<this.transformNodes.length;a++)if(this.transformNodes[a].name===z)return this.transformNodes[a];return null}getLastSkeletonById(z){for(let a=this.skeletons.length-1;a>=0;a--)if(this.skeletons[a].id===z)return this.skeletons[a];return null}getSkeletonByUniqueId(z){for(let a=0;a<this.skeletons.length;a++)if(this.skeletons[a].uniqueId===z)return this.skeletons[a];return null}getSkeletonById(z){for(let a=0;a<this.skeletons.length;a++)if(this.skeletons[a].id===z)return this.skeletons[a];return null}getSkeletonByName(z){for(let a=0;a<this.skeletons.length;a++)if(this.skeletons[a].name===z)return this.skeletons[a];return null}getMorphTargetManagerById(z){for(let a=0;a<this.morphTargetManagers.length;a++)if(this.morphTargetManagers[a].uniqueId===z)return this.morphTargetManagers[a];return null}getMorphTargetById(z){for(let a=0;a<this.morphTargetManagers.length;++a){const K=this.morphTargetManagers[a];for(let a=0;a<K.numTargets;++a){const v=K.getTarget(a);if(v.id===z)return v}}return null}getMorphTargetByName(z){for(let a=0;a<this.morphTargetManagers.length;++a){const K=this.morphTargetManagers[a];for(let a=0;a<K.numTargets;++a){const v=K.getTarget(a);if(v.name===z)return v}}return null}getPostProcessByName(z){for(let a=0;a<this.postProcesses.length;++a){const K=this.postProcesses[a];if(K.name===z)return K}return null}isActiveMesh(z){return-1!==this._activeMeshes.indexOf(z)}get uid(){return this._uid||(this._uid=v.h.RandomId()),this._uid}addExternalData(z,a){return this._externalData||(this._externalData=new j),this._externalData.add(z,a)}getExternalData(z){return this._externalData?this._externalData.get(z):null}getOrAddExternalDataWithFactory(z,a){return this._externalData||(this._externalData=new j),this._externalData.getOrAddWithFactory(z,a)}removeExternalData(z){return this._externalData.remove(z)}_evaluateSubMesh(z,a,K,v){if(v||z.isInFrustum(this._frustumPlanes)){for(const v of this._evaluateSubMeshStage)v.action(a,z);const K=z.Ha();null!==K&&void 0!==K&&(K.hasRenderTargetTextures&&null!=K.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(K)&&(this._processedMaterials.push(K),this._materialsRenderTargets.concatWithNoDuplicate(K.getRenderTargetTextures())),this._renderingManager.dispatch(z,a,K))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(z){this._preventFreeActiveMeshesAndRenderingGroups!==z&&(z&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=z)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let z=0;z<this.activeCameras.length;z++){const a=this.activeCameras[z];a&&a._activeMeshes&&a._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let z=0;z<this.textures.length;z++){const a=this.textures[z];a&&a.renderList&&a.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1?arguments[1]:void 0,K=arguments.length>2?arguments[2]:void 0,v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],T=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=T,this._skipEvaluateActiveMeshesCompletely=z,v)for(let z=0;z<this._activeMeshes.length;z++)this._activeMeshes.data[z]._freeze();a&&a()}else K&&K("No active camera found")})),this}unfreezeActiveMeshes(){for(let z=0;z<this.meshes.length;z++){const a=this.meshes[z];a._internalAbstractMeshDataInfo&&(a._internalAbstractMeshDataInfo._isActive=!1)}for(let z=0;z<this._activeMeshes.length;z++)this._activeMeshes.data[z]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(z){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>z.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var z;if(this._activeMeshes.length>0)null===(z=this.activeCamera)||void 0===z||z._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const z=this._activeMeshes.length;for(let a=0;a<z;a++){this._activeMeshes.data[a].Qj()}}if(this._activeParticleSystems){const z=this._activeParticleSystems.length;for(let a=0;a<z;a++)this._activeParticleSystems.data[a].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const v of this._beforeEvaluateActiveMeshStage)v.action();const a=this.getActiveMeshCandidates(),K=a.length;for(let v=0;v<K;v++){const z=a.data[v];if(z._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,z.isBlocked)continue;if(this._totalVertices.addCount(z.getTotalVertices(),!1),!z.isReady()||!z.isEnabled()||z.Yd.hasAZeroComponent)continue;z.Qj(),z.actionManager&&z.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(z);let K=this.customLODSelector?this.customLODSelector(z,this.activeCamera):z.getLOD(this.activeCamera);if(z._internalAbstractMeshDataInfo._currentLOD=K,z._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==K&&null!==K&&(K!==z&&0!==K.billboardMode&&K.Qj(),z._preActivate(),z.isVisible&&z.visibility>0&&0!==(z.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||z.wb||z.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(z),this.activeCamera._activeMeshes.push(z),K!==z&&K._activate(this._renderId,!1);for(const a of this._preActiveMeshStage)a.action(z);z._activate(this._renderId,!1)&&(z.isAnInstance?z._internalAbstractMeshDataInfo._actAsRegularMesh&&(K=z):K._internalAbstractMeshDataInfo._onlyForInstances=!1,K._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(z,K)),z._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let z=0;z<this.sj.length;z++){const a=this.sj[z];if(!a.isStarted()||!a.j)continue;const K=a.j;K.position&&!K.isEnabled()||(this._activeParticleSystems.push(a),a.animate(),this._renderingManager.dispatchParticles(a))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(z){this._skeletonsEnabled&&z.skeleton&&(this._activeSkeletons.pushNoDuplicate(z.skeleton)&&(z.skeleton.prepare(),this._activeBones.addCount(z.skeleton.bones.length,!1)),z.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(z)&&this.frameGraph&&z.applySkeleton(z.skeleton))}_activeMesh(z,a){this._prepareSkeleton(a);let K=z.hasInstances||z.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||a.wb;if(a&&a.Vf&&a.Vf.length>0){const v=this.getActiveSubMeshCandidates(a),T=v.length;K=K||1===T;for(let m=0;m<T;m++){const T=v.data[m];this._evaluateSubMesh(T,a,z,K)}}}updateTransformMatrix(z){const a=this.activeCamera;if(a)if(a._renderingMultiview){const K=a._rigCameras[0],v=a._rigCameras[1];this.setTransformMatrix(K.getViewMatrix(),K.getProjectionMatrix(z),v.getViewMatrix(),v.getProjectionMatrix(z))}else this.setTransformMatrix(a.getViewMatrix(),a.getProjectionMatrix(z))}_bindFrameBuffer(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];z&&z._multiviewTexture?z._multiviewTexture._bindFrameBuffer():z&&z.outputRenderTarget?z.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),a&&this._clearFrameBuffer(z)}_clearFrameBuffer(z){if(z&&z._multiviewTexture);else if(z&&z.outputRenderTarget&&!z._renderingMultiview){const a=z.outputRenderTarget;a.onClearObservable.hasObservers()?a.onClearObservable.notifyObservers(this._engine):a.skipInitialClear||z.isRightCamera||(this.Vi&&this._engine.clear(a.clearColor||this._clearColor,!a._cleared,!0,!0),a._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(z,a){var K;let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(z&&z._skipRendering)return;const m=this._engine;if(this._activeCamera=z,!this.activeCamera)throw new Error("Active camera not set");if(m.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&T){let a=!0;z._renderingMultiview&&z.outputRenderTarget&&(a=z.outputRenderTarget.skipInitialClear,this.Vi&&(this._defaultFrameBufferCleared=!1,z.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),z._renderingMultiview&&z.outputRenderTarget&&(z.outputRenderTarget.skipInitialClear=a)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let v=0;v<this._softwareSkinnedMeshes.length;v++){const z=this._softwareSkinnedMeshes.data[v];z.applySkeleton(z.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),z.customRenderTargets&&z.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(z.customRenderTargets),a&&a.customRenderTargets&&a.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(a.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const v of this._gatherActiveCameraRenderTargetsStage)v.action(this._renderTargets);let p=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){v.h.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let z=0;z<this._renderTargets.length;z++){const a=this._renderTargets.data[z];if(a._shouldRender()){this._renderId++;const z=a.activeCamera&&a.activeCamera!==this.activeCamera;a.render(z,this.dumpNextRenderTargets),p=!0}}v.h.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const z of this._cameraDrawRenderTargetStage)p=z.action(this.activeCamera)||p;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(K=z.outputRenderTarget)||void 0===K?void 0:K.renderPassId)??z.renderPassId??0,p&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||z._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const v of this._beforeCameraDrawStage)v.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),m.snapshotRendering&&1===m.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const v of this._afterCameraDrawStage)v.action(this.activeCamera);if(this.postProcessManager&&!z._multiviewTexture){const a=z.outputRenderTarget?z.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(z.isIntermediate,a)}for(const v of this._afterCameraPostProcessStage)v.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===z.cameraRigMode||z._renderingMultiview)return z._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(z,void 0,a),void this.onAfterRenderCameraObservable.notifyObservers(z);if(z._useMultiviewToSingleView)this._renderMultiviewToSingleView(z);else{this.onBeforeCameraRenderObservable.notifyObservers(z);for(let a=0;a<z._rigCameras.length;a++)this._renderForCamera(z._rigCameras[a],z)}this._activeCamera=z,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(z)}_checkIntersections(){for(let z=0;z<this._meshesForIntersections.length;z++){const a=this._meshesForIntersections.data[z];if(a.actionManager)for(let z=0;a.actionManager&&z<a.actionManager.actions.length;z++){const K=a.actionManager.actions[z];if(12===K.trigger||13===K.trigger){const z=K.getTriggerParameter(),v=z.mesh?z.mesh:z,T=v.intersectsMesh(a,z.usePreciseIntersection),m=a._intersectionsInProgress.indexOf(v);T&&-1===m?12===K.trigger?(K._executeCurrent(G.CreateNew(a,void 0,v)),a._intersectionsInProgress.push(v)):13===K.trigger&&a._intersectionsInProgress.push(v):!T&&m>-1&&(13===K.trigger&&K._executeCurrent(G.CreateNew(a,void 0,v)),a.actionManager.hasSpecificTrigger(13,(z=>{const a=z.mesh?z.mesh:z;return v===a}))&&13!==K.trigger||a._intersectionsInProgress.splice(m,1))}}}}_advancePhysicsEngineStep(z){}_animate(z){}animate(){if(this._engine.isDeterministicLockStep()){let z=Math.max(zz.MinDeltaTime,Math.min(this._engine.getDeltaTime(),zz.MaxDeltaTime))+this._timeAccumulator;const a=this._engine.getTimeStep(),K=1e3/a/1e3;let v=0;const T=this._engine.getLockstepMaxSteps();let m=Math.floor(z/a);for(m=Math.min(m,T);z>0&&v<m;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=a*K,this._animate(a),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(a),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,v++,z-=a;this._timeAccumulator=z<0?0:z}else{const z=this.useConstantAnimationDeltaTime?16:Math.max(zz.MinDeltaTime,Math.min(this._engine.getDeltaTime(),zz.MaxDeltaTime));this._animationRatio=.06*z,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(z)}}_clear(){(this.autoClearDepthAndStencil||this.Vi)&&this._engine.clear(this._clearColor,this.Vi||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(z){var a;if(null===z||void 0===z||!z.outputRenderTarget||null!==z&&void 0!==z&&z.isRigCamera||(z.outputRenderTarget._cleared=!1),null!==z&&void 0!==z&&null!==(a=z.rigCameras)&&void 0!==a&&a.length)for(let K=0;K<z.rigCameras.length;++K){const a=z.rigCameras[K].outputRenderTarget;a&&(a._cleared=!1)}}resetDrawCache(z){if(this.meshes)for(const a of this.meshes)a.resetDrawCache(z)}_renderWithFrameGraph(){var z;let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),a)for(const T of this.cameras)if(T.update(),0!==T.cameraRigMode)for(let z=0;z<T._rigCameras.length;z++)T._rigCameras[z].update();for(const T of this._beforeClearStage)T.action();const K=this.getActiveMeshCandidates(),v=K.length;for(let T=0;T<v;T++){const z=K.data[T];z.isBlocked||(this._totalVertices.addCount(z.getTotalVertices(),!1),z.isReady()&&z.isEnabled()&&!z.Yd.hasAZeroComponent&&(z.Qj(),z.actionManager&&z.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(z)))}if(this.particlesEnabled)for(let T=0;T<this.sj.length;T++){const z=this.sj[T];if(!z.isStarted()||!z.j)continue;const a=z.j;a.position&&!a.isEnabled()||(this._activeParticleSystems.push(z),z.animate())}null===(z=this.frameGraph)||void 0===z||z.execute()}render(){var z;let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],K=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(z=this.activeCameras)&&void 0!==z&&z.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),K||this.animate();for(const z of this._beforeCameraUpdateStage)z.action();if(a)if(this.activeCameras&&this.activeCameras.length>0)for(let z=0;z<this.activeCameras.length;z++){const a=this.activeCameras[z];if(a.update(),0!==a.cameraRigMode)for(let z=0;z<a._rigCameras.length;z++)a._rigCameras[z].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let z=0;z<this.activeCamera._rigCameras.length;z++)this.activeCamera._rigCameras[z].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(a,K);else{var T;const z=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const a=null!==(T=this.activeCameras)&&void 0!==T&&T.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){v.h.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let K=0;K<this.customRenderTargets.length;K++){const v=this.customRenderTargets[K];if(v._shouldRender()){if(this._renderId++,this.activeCamera=v.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");z.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),v.render(a!==this.activeCamera,this.dumpNextRenderTargets)}}v.h.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(null===a||void 0===a?void 0:a.renderPassId)??0,this.activeCamera=a,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const K of this._beforeClearStage)K.action();this._clearFrameBuffer(this.activeCamera);for(const K of this._gatherRenderTargetsStage)K.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let K=0;K<this.activeCameras.length;K++)this._processSubCameras(this.activeCameras[K],K>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const z of this._afterRenderStage)z.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let z=0;z<this._toBeDisposed.length;z++){const a=this._toBeDisposed[z];a&&a.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let z=0;z<this.materials.length;z++)this.materials[z].freeze()}unfreezeMaterials(){for(let z=0;z<this.materials.length;z++)this.materials[z].unfreeze()}dispose(){if(this.u)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((z=>{z.onAnimationEndObservable.clear(),z.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const z=this._activeRequests.slice();for(const T of z)T.abort();this._activeRequests.length=0;try{this.lj.notifyObservers(this)}catch(v){Q.c.Error("An error occurred while calling onDisposeObservable!",v)}this.Ui();if(this._engine.getInputElement())for(let T=0;T<this.cameras.length;T++)this.cameras[T].Ui();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(z=>z.dispose(!0))),this._disposeList(this.transformNodes,(z=>z.dispose(!0)));const a=this.cameras;this._disposeList(a),this.xi&&this.xi.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.sj),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let K=this._engine.scenes.indexOf(this);K>-1&&this._engine.scenes.splice(K,1),w.b._LastCreatedScene===this&&(this._engine.scenes.length>0?w.b._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:w.b._LastCreatedScene=null),K=this._engine._virtualScenes.indexOf(this),K>-1&&this._engine._virtualScenes.splice(K,1),this._engine.wipeCaches(!0),this.lj.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this._isDisposed=!0}_disposeList(z,a){const K=z.slice(0);a=a??(z=>z.dispose());for(const v of K)a(v);z.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let z=0;z<this.meshes.length;z++){const a=this.meshes[z].Fj;a&&a.clearCachedData()}}cleanCachedTextureBuffer(){for(const z of this.textures){z._buffer&&(z._buffer=null)}}getWorldExtends(z){const a=new M.o(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),K=new M.o(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return z=z||(()=>!0),this.meshes.filter(z).forEach((z=>{if(z.Qj(!0),!z.Vf||0===z.Vf.length||z.infiniteDistance)return;const v=z.getBoundingInfo(),T=v.boundingBox.minimumWorld,m=v.boundingBox.maximumWorld;M.o.CheckExtends(T,a,K),M.o.CheckExtends(m,a,K)})),{min:a,max:K}}createPickingRay(z,a,K,v){throw(0,H.b)("Ray")}createPickingRayToRef(z,a,K,v,T){throw(0,H.b)("Ray")}createPickingRayInCameraSpace(z,a,K){throw(0,H.b)("Ray")}createPickingRayInCameraSpaceToRef(z,a,K,v){throw(0,H.b)("Ray")}jc(z,a,K,v,T,m){const p=(0,H.b)("Ray",!0);return p&&Q.c.Warn(p),new F.d}pickWithBoundingInfo(z,a,K,v,T){const m=(0,H.b)("Ray",!0);return m&&Q.c.Warn(m),new F.d}pickWithRay(z,a,K,v){throw(0,H.b)("Ray")}multiPick(z,a,K,v,T){throw(0,H.b)("Ray")}multiPickWithRay(z,a,K){throw(0,H.b)("Ray")}setPointerOverMesh(z,a,K){this._inputManager.setPointerOverMesh(z,a,K)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const z of this.geometries)z._rebuild();for(const z of this.meshes)z._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const z of this._components)z.rebuild();for(const z of this.sj)z.rebuild();if(this.spriteManagers)for(const z of this.spriteManagers)z.rebuild()}_rebuildTextures(){for(const z of this.textures)z._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(z,a,K){if(void 0===a)return z;const v=[];for(const T in z){const m=z[T];s.d&&s.d.MatchesQuery(m,a)&&(!K||K(m))&&v.push(m)}return v}getMeshesByTags(z,a){return this._getByTags(this.meshes,z,a)}getCamerasByTags(z,a){return this._getByTags(this.cameras,z,a)}getLightsByTags(z,a){return this._getByTags(this.lights,z,a)}getMaterialByTags(z,a){return this._getByTags(this.materials,z,a).concat(this._getByTags(this.multiMaterials,z,a))}getTransformNodesByTags(z,a){return this._getByTags(this.transformNodes,z,a)}setRenderingOrder(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(z,a,K,v)}setRenderingAutoClearDepthStencil(z,a){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(z,a,K,v)}getAutoClearDepthStencilSetup(z){return this._renderingManager.getAutoClearDepthStencilSetup(z)}_forceBlockMaterialDirtyMechanism(z){this._blockMaterialDirtyMechanism=z}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(z){this._blockMaterialDirtyMechanism!==z&&(this._blockMaterialDirtyMechanism=z,z||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(z,a){if(!this._blockMaterialDirtyMechanism)for(const K of this.materials)a&&!a(K)||K.zg(z)}_loadFile(z,a,K,v,T,m,p){const j=(0,U.n)(z,a,K,v?this.offlineProvider:void 0,T,m,p);return this._activeRequests.push(j),j.onCompleteObservable.add((z=>{this._activeRequests.splice(this._activeRequests.indexOf(z),1)})),j}_loadFileAsync(z,a,K,v,T){return new Promise(((m,p)=>{this._loadFile(z,(z=>{m(z)}),a,K,v,((z,a)=>{p(a)}),T)}))}_requestFile(z,a,K,v,T,m,p){const j=(0,U.u)(z,a,K,v?this.offlineProvider:void 0,T,m,p);return this._activeRequests.push(j),j.onCompleteObservable.add((z=>{this._activeRequests.splice(this._activeRequests.indexOf(z),1)})),j}_requestFileAsync(z,a,K,v,T){return new Promise(((m,p)=>{this._requestFile(z,(z=>{m(z)}),a,K,v,(z=>{p(z)}),T)}))}_readFile(z,a,K,v,T){const m=(0,U.r)(z,a,K,v,T);return this._activeRequests.push(m),m.onCompleteObservable.add((z=>{this._activeRequests.splice(this._activeRequests.indexOf(z),1)})),m}_readFileAsync(z,a,K){return new Promise(((v,T)=>{this._readFile(z,(z=>{v(z)}),a,K,(z=>{T(z)}))}))}getPerfCollector(){throw(0,H.b)("performanceViewerSceneExtension")}setActiveCameraByID(z){return this.setActiveCameraById(z)}getMaterialByID(z){return this.getMaterialById(z)}getLastMaterialByID(z){return this.getLastMaterialById(z)}getTextureByUniqueID(z){return this.getTextureByUniqueId(z)}getCameraByID(z){return this.getCameraById(z)}getCameraByUniqueID(z){return this.getCameraByUniqueId(z)}getBoneByID(z){return this.getBoneById(z)}getLightByID(z){return this.getLightById(z)}getLightByUniqueID(z){return this.getLightByUniqueId(z)}getParticleSystemByID(z){return this.getParticleSystemById(z)}getGeometryByID(z){return this.getGeometryById(z)}getMeshByID(z){return this.getMeshById(z)}getMeshByUniqueID(z){return this.getMeshByUniqueId(z)}getLastMeshByID(z){return this.getLastMeshById(z)}getMeshesByID(z){return this.getMeshesById(z)}getTransformNodeByID(z){return this.getTransformNodeById(z)}getTransformNodeByUniqueID(z){return this.getTransformNodeByUniqueId(z)}getTransformNodesByID(z){return this.getTransformNodesById(z)}getNodeByID(z){return this.getNodeById(z)}getLastEntryByID(z){return this.getLastEntryById(z)}getLastSkeletonByID(z){return this.getLastSkeletonById(z)}}zz.FOGMODE_NONE=0,zz.FOGMODE_EXP=1,zz.FOGMODE_EXP2=2,zz.FOGMODE_LINEAR=3,zz.MinDeltaTime=1,zz.MaxDeltaTime=1e3,(0,O.e)("BABYLON.Scene",zz)},11019:(z,a,K)=>{"use strict";K.d(a,{b:()=>v,d:()=>T});class v{}v.NAME_EFFECTLAYER="EffectLayer",v.NAME_LAYER="Layer",v.NAME_LENSFLARESYSTEM="LensFlareSystem",v.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",v.NAME_PARTICLESYSTEM="zb",v.NAME_GAMEPAD="Gamepad",v.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",v.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",v.NAME_PREPASSRENDERER="PrePassRenderer",v.NAME_DEPTHRENDERER="DepthRenderer",v.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",v.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",v.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",v.NAME_SPRITE="Sprite",v.NAME_SUBSURFACE="SubSurface",v.NAME_OUTLINERENDERER="Outline",v.NAME_PROCEDURALTEXTURE="ProceduralTexture",v.NAME_SHADOWGENERATOR="ShadowGenerator",v.NAME_OCTREE="Bb",v.NAME_PHYSICSENGINE="PhysicsEngine",v.NAME_AUDIO="Audio",v.NAME_FLUIDRENDERER="FluidRenderer",v.STEP_ISREADYFORMESH_EFFECTLAYER=0,v.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,v.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,v.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,v.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,v.STEP_BEFORECAMERADRAW_PREPASS=0,v.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,v.STEP_BEFORECAMERADRAW_LAYER=2,v.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,v.STEP_BEFORERENDERTARGETDRAW_LAYER=1,v.STEP_BEFORERENDERINGMESH_PREPASS=0,v.STEP_BEFORERENDERINGMESH_OUTLINE=1,v.STEP_AFTERRENDERINGMESH_PREPASS=0,v.STEP_AFTERRENDERINGMESH_OUTLINE=1,v.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,v.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,v.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,v.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,v.STEP_BEFORECLEAR_PREPASS=1,v.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,v.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,v.STEP_AFTERRENDERTARGETDRAW_LAYER=1,v.STEP_AFTERCAMERADRAW_PREPASS=0,v.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,v.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,v.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,v.STEP_AFTERCAMERADRAW_LAYER=4,v.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,v.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,v.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,v.STEP_AFTERRENDER_AUDIO=0,v.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,v.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,v.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,v.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,v.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,v.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,v.STEP_POINTERMOVE_SPRITE=0,v.STEP_POINTERDOWN_SPRITE=0,v.STEP_POINTERUP_SPRITE=0;class T extends Array{constructor(z){super(...z)}static Create(){return Object.create(T.prototype)}registerStep(z,a,K){let v=0,T=Number.MAX_VALUE;for(;v<this.length;v++){if(T=this[v].index,z<T)break}this.splice(v,0,{index:z,component:a,action:K.bind(a)})}clear(){this.length=0}}},10923:(z,a,K)=>{"use strict";K.d(a,{e:()=>v});function v(z,a,K,v){var T,m=arguments.length,p=m<3?a:null===v?v=Object.getOwnPropertyDescriptor(a,K):v;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)p=Reflect.decorate(z,a,K,v);else for(var j=z.length-1;j>=0;j--)(T=z[j])&&(p=(m<3?T(p):m>3?T(a,K,p):T(a,K))||p);return m>3&&p&&Object.defineProperty(a,K,p),p}Object.create;Object.create},11873:(z,a,K)=>{"use strict";class v{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((z,a)=>{this._resolve=z,this._reject=a}))}}var T=K(10941),m=K(10971),p=K(10631),j=K(11207),s=K(11880),M=K(11894),r=K(10638),W=K(11401),F=K(11900),G=K(11907),l=K(10680),V=K(10648),c=K(10653);class C{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(z){this._useTextureToStoreBoneMatrices=z,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(z){this._animationPropertiesOverride=z}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(z,a,K){this.name=z,this.id=a,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=T.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new r.c,this.bones=[],this._scene=K||l.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const v=this._scene.getEngine().getCaps();this._canUseTextureForBones=v.textureFloat&&v.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((z=>!z.getParent()))}getTransformMatrices(z){if(this.needInitialSkinMatrix){if(!z)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return z._bonesTransformMatrices||this.prepare(!0),z._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(z){return this.needInitialSkinMatrix&&z._transformMatrixTexture?z._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(z){let a=`Name: ${this.name}, nBones: ${this.bones.length}`;if(a+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,z){a+=", Ranges: {";let z=!0;for(const K in this._ranges)z&&(a+=", ",z=!1),a+=K;a+="}"}return a}getBoneIndexByName(z){for(let a=0,K=this.bones.length;a<K;a++)if(this.bones[a].name===z)return a;return-1}createAnimationRange(z,a,K){if(!this._ranges[z]){this._ranges[z]=new G.d(z,a,K);for(let v=0,T=this.bones.length;v<T;v++)this.bones[v].animations[0]&&this.bones[v].animations[0].createRange(z,a,K)}}deleteAnimationRange(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let K=0,v=this.bones.length;K<v;K++)this.bones[K].animations[0]&&this.bones[K].animations[0].deleteRange(z,a);this._ranges[z]=null}getAnimationRange(z){return this._ranges[z]||null}getAnimationRanges(){const z=[];let a;for(a in this._ranges)z.push(this._ranges[a]);return z}copyAnimationRange(z,a){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[a]||!z.getAnimationRange(a))return!1;let v=!0;const T=this._getHighestAnimationFrame()+1,m={},p=z.bones;let j,s;for(s=0,j=p.length;s<j;s++)m[p[s].name]=p[s];this.bones.length!==p.length&&(V.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${p.length}`),v=!1);const M=K&&this.dimensionsAtRest&&z.dimensionsAtRest?this.dimensionsAtRest.divide(z.dimensionsAtRest):null;for(s=0,j=this.bones.length;s<j;s++){const z=this.bones[s].name,p=m[z];p?v=v&&this.bones[s].copyAnimationRange(p,a,T,K,M):(V.c.Warn("copyAnimationRange: not same rig, missing source bone "+z),v=!1)}const r=z.getAnimationRange(a);return r&&(this._ranges[a]=new G.d(a,r.from+T,r.to+T)),v}returnToRest(){for(const z of this.bones)-1!==z._index&&z.returnToRest()}_getHighestAnimationFrame(){let z=0;for(let a=0,K=this.bones.length;a<K;a++)if(this.bones[a].animations[0]){const K=this.bones[a].animations[0].getHighestFrame();z<K&&(z=K)}return z}beginAnimation(z,a,K,v){const T=this.getAnimationRange(z);return T?this._scene.beginAnimation(this,T.from,T.to,a,K,v):null}static MakeAnimationAdditive(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2?arguments[2]:void 0;const v=z.getAnimationRange(K);if(!v)return null;const T=z._scene.getAllAnimatablesByTarget(z);let m=null;for(let j=0;j<T.length;j++){const z=T[j];if(z.fromFrame===(null===v||void 0===v?void 0:v.from)&&z.toFrame===(null===v||void 0===v?void 0:v.to)){m=z;break}}const p=z.getAnimatables();for(let j=0;j<p.length;j++){const z=p[j].animations;if(z)for(let v=0;v<z.length;v++)F.e.MakeAnimationAdditive(z[v],a,K)}return m&&(m.isAdditive=!0),z}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(z){this._meshesWithPoseMatrix.push(z)}_unregisterMeshWithPoseMatrix(z){const a=this._meshesWithPoseMatrix.indexOf(z);a>-1&&this._meshesWithPoseMatrix.splice(a,1)}_computeTransformMatrices(z,a){this.onBeforeComputeObservable.notifyObservers(this);for(let K=0;K<this.bones.length;K++){const v=this.bones[K];v._childUpdateId++;const T=v.getParent();if(T?v.getLocalMatrix().multiplyToRef(T.getFinalMatrix(),v.getFinalMatrix()):a?v.getLocalMatrix().multiplyToRef(a,v.getFinalMatrix()):v.getFinalMatrix().p(v.getLocalMatrix()),-1!==v._index){const a=null===v._index?K:v._index;v.getAbsoluteInverseBindMatrix().multiplyToArray(v.getFinalMatrix(),z,16*a)}}this._identity.copyToArray(z,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const z=this.va().getRenderId();if(this._currentRenderId===z)return;this._currentRenderId=z}if(this._numBonesWithLinkedTransformNode>0)for(const z of this.bones)if(z._linkedTransformNode){const a=z._linkedTransformNode;z.position=a.position,a.rotationQuaternion?z.rotationQuaternion=a.rotationQuaternion:z.rotation=a.rotation,z.Yd=a.Yd}if(this.needInitialSkinMatrix)for(const z of this._meshesWithPoseMatrix){const a=z.getPoseMatrix();let K=this._isDirty;if(z._bonesTransformMatrices&&z._bonesTransformMatrices.length===16*(this.bones.length+1)||(z._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),K=!0),K){if(this._synchronizedWithMesh!==z){this._synchronizedWithMesh=z;for(const z of this.bones)if(!z.getParent()){z.getBindMatrix().multiplyToRef(a,T.j.Matrix[1]),z._updateAbsoluteBindMatrices(T.j.Matrix[1])}if(this.isUsingTextureForMatrices){const a=4*(this.bones.length+1);z._transformMatrixTexture&&z._transformMatrixTexture.getSize().width===a||(z._transformMatrixTexture&&z._transformMatrixTexture.dispose(),z._transformMatrixTexture=W.c.CreateRGBATexture(z._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(z._bonesTransformMatrices,a),this.isUsingTextureForMatrices&&z._transformMatrixTexture&&z._transformMatrixTexture.update(z._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=W.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let z=0;z<this.bones.length;z++)this._animatables.push(this.bones[z])}return this._animatables}clone(z,a){const K=new C(z,a||z,this._scene);K.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let v=0;v<this.bones.length;v++){const z=this.bones[v];let a=null;const T=z.getParent();if(T){const z=this.bones.indexOf(T);a=K.bones[z]}const m=new M.b(z.name,K,a,z.getBindMatrix().clone(),z.getRestMatrix().clone());m._index=z._index,z._linkedTransformNode&&m.linkTransformNode(z._linkedTransformNode),c.b.DeepCopy(z.animations,m.animations)}if(this._ranges){K._ranges={};for(const z in this._ranges){const a=this._ranges[z];a&&(K._ranges[z]=a.clone())}}return this._isDirty=!0,K.prepare(!0),K}enableBlending(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((a=>{a.animations.forEach((a=>{a.enableBlending=!0,a.blendingSpeed=z}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const z=this._parentContainer.skeletons.indexOf(this);z>-1&&this._parentContainer.skeletons.splice(z,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const z={};z.name=this.name,z.id=this.id,this.dimensionsAtRest&&(z.dimensionsAtRest=this.dimensionsAtRest.kj()),z.bones=[],z.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let K=0;K<this.bones.length;K++){var a;const v=this.bones[K],T=v.getParent(),m={parentBoneIndex:T?this.bones.indexOf(T):-1,index:v.getIndex(),name:v.name,id:v.id,matrix:v.getBindMatrix().kj(),rest:v.getRestMatrix().kj(),linkedTransformNodeId:null===(a=v.getTransformNode())||void 0===a?void 0:a.id};z.bones.push(m),v.length&&(m.length=v.length),v.metadata&&(m.metadata=v.metadata),v.animations&&v.animations.length>0&&(m.animation=v.animations[0].serialize()),z.ranges=[];for(const a in this._ranges){const K=this._ranges[a];if(!K)continue;const v={};v.name=a,v.from=K.from,v.to=K.to,z.ranges.push(v)}}return z}static Parse(z,a){const K=new C(z.name,z.id,a);let v;for(z.dimensionsAtRest&&(K.dimensionsAtRest=T.o.Jg(z.dimensionsAtRest)),K.needInitialSkinMatrix=z.needInitialSkinMatrix,v=0;v<z.bones.length;v++){const a=z.bones[v],m=z.bones[v].index;let p=null;a.parentBoneIndex>-1&&(p=K.bones[a.parentBoneIndex]);const j=a.rest?T.b.Jg(a.rest):null,s=new M.b(a.name,K,p,T.b.Jg(a.matrix),j,null,m);void 0!==a.id&&null!==a.id&&(s.id=a.id),a.length&&(s.length=a.length),a.metadata&&(s.metadata=a.metadata),a.animation&&s.animations.push(F.e.Parse(a.animation)),void 0!==a.linkedTransformNodeId&&null!==a.linkedTransformNodeId&&(K._hasWaitingData=!0,s._waitingTransformNodeId=a.linkedTransformNodeId)}if(z.ranges)for(v=0;v<z.ranges.length;v++){const a=z.ranges[v];K.createAnimationRange(a.name,a.from,a.to)}return K}computeAbsoluteMatrices(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||z)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(z)}getPoseMatrix(){let z=null;return this._meshesWithPoseMatrix.length>0&&(z=this._meshesWithPoseMatrix[0].getPoseMatrix()),z}sortBones(){const z=[],a=new Array(this.bones.length);for(let K=0;K<this.bones.length;K++)this._sortBones(K,z,a);this.bones=z}_sortBones(z,a,K){if(K[z])return;K[z]=!0;const v=this.bones[z];if(!v)return;void 0===v._index&&(v._index=z);const T=v.getParent();T&&this._sortBones(this.bones.indexOf(T),a,K),a.push(v)}setCurrentPoseAsRest(){this.bones.forEach((z=>{z.setCurrentPoseAsRest()}))}}var w=K(11064),H=K(10923),f=K(10927),Y=K(11911),I=K(11922),q=K(10767),B=K(10973);class x extends I.e{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(z){this.subSurface.refractionTexture=z,z?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(z){this.subSurface.indexOfRefraction=z}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(z){this.subSurface.invertRefractionY=z}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(z){this.subSurface.linkRefractionWithTransparency=z,z&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===I.e.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(z){z!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=z?I.e.LIGHTFALLOFF_PHYSICAL:I.e.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===I.e.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(z){z!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=z?I.e.LIGHTFALLOFF_GLTF:I.e.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(z){this._attachImageProcessingConfiguration(z),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(z){this.imageProcessingConfiguration.colorCurvesEnabled=z}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(z){this.imageProcessingConfiguration.colorGradingEnabled=z}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(z){this._imageProcessingConfiguration.toneMappingEnabled=z}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(z){this._imageProcessingConfiguration.exposure=z}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(z){this._imageProcessingConfiguration.contrast=z}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(z){this._imageProcessingConfiguration.colorGradingTexture=z}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(z){this._imageProcessingConfiguration.colorCurves=z}constructor(z,a){super(z,a,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=x.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=m.c.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new m.c(0,0,0),this.albedoColor=new m.c(1,1,1),this.reflectivityColor=new m.c(1,1,1),this.reflectionColor=new m.c(1,1,1),this.emissiveColor=new m.c(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,Y.b)(this.va())}getClassName(){return"PBRMaterial"}clone(z){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const v=B.e.Clone((()=>new x(z,this.va())),this,{cloneTexturesOnlyOnce:a});return v.id=z,v.name=z,this.stencil.copyTo(v.stencil),this._clonePlugins(v,K),v}serialize(){const z=super.serialize();return z.customType="BABYLON.PBRMaterial",z}static Parse(z,a,K){const v=B.e.Parse((()=>new x(z.name,a)),z,a,K);return z.stencil&&v.stencil.parse(z.stencil,a,K),w.b._ParsePlugins(z,v,a,K),z.clearCoat&&v.clearCoat.parse(z.clearCoat,a,K),z.anisotropy&&v.anisotropy.parse(z.anisotropy,a,K),z.brdf&&v.brdf.parse(z.brdf,a,K),z.sheen&&v.sheen.parse(z.sheen,a,K),z.subSurface&&v.subSurface.parse(z.subSurface,a,K),z.iridescence&&v.iridescence.parse(z.iridescence,a,K),v}}x.PBRMATERIAL_OPAQUE=I.e.PBRMATERIAL_OPAQUE,x.PBRMATERIAL_ALPHATEST=I.e.PBRMATERIAL_ALPHATEST,x.PBRMATERIAL_ALPHABLEND=I.e.PBRMATERIAL_ALPHABLEND,x.PBRMATERIAL_ALPHATESTANDBLEND=I.e.PBRMATERIAL_ALPHATESTANDBLEND,x.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=I.e.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"directIntensity",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"emissiveIntensity",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"environmentIntensity",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"specularIntensity",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"disableBumpMap",void 0),(0,H.e)([(0,f.x)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"albedoTexture",void 0),(0,H.e)([(0,f.x)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientTexture",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientTextureStrength",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,H.e)([(0,f.x)(),(0,f.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"opacityTexture",void 0),(0,H.e)([(0,f.x)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectionTexture",void 0),(0,H.e)([(0,f.x)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"emissiveTexture",void 0),(0,H.e)([(0,f.x)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectivityTexture",void 0),(0,H.e)([(0,f.x)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicTexture",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallic",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"roughness",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicF0Factor",void 0),(0,H.e)([(0,f.h)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicReflectanceColor",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,H.e)([(0,f.x)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"metallicReflectanceTexture",void 0),(0,H.e)([(0,f.x)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectanceTexture",void 0),(0,H.e)([(0,f.x)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"microSurfaceTexture",void 0),(0,H.e)([(0,f.x)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"bumpTexture",void 0),(0,H.e)([(0,f.x)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty",null)],x.prototype,"lightmapTexture",void 0),(0,H.e)([(0,f.h)("ambient"),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"ambientColor",void 0),(0,H.e)([(0,f.h)("albedo"),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"albedoColor",void 0),(0,H.e)([(0,f.h)("reflectivity"),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectivityColor",void 0),(0,H.e)([(0,f.h)("reflection"),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"reflectionColor",void 0),(0,H.e)([(0,f.h)("emissive"),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"emissiveColor",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"microSurface",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useLightmapAsShadowmap",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"useAlphaFromAlbedoTexture",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"forceAlphaTest",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],x.prototype,"alphaCutOff",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useSpecularOverAlpha",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAmbientInGrayScale",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,H.e)([(0,f.D)()],x.prototype,"usePhysicalLightFalloff",null),(0,H.e)([(0,f.D)()],x.prototype,"useGLTFLightFalloff",null),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRadianceOverAlpha",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useObjectSpaceNormalMap",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useParallax",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useParallaxOcclusion",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"parallaxScaleBias",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsLightsDirty")],x.prototype,"disableLighting",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"forceIrradianceInFragment",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsLightsDirty")],x.prototype,"maxSimultaneousLights",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"invertNormalMapX",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"invertNormalMapY",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"twoSidedLighting",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useAlphaFresnel",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useLinearAlphaFresnel",void 0),(0,H.e)([(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"environmentBRDFTexture",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"forceNormalForward",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"enableSpecularAntiAliasing",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useHorizonOcclusion",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"useRadianceOcclusion",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsMiscDirty")],x.prototype,"unlit",void 0),(0,H.e)([(0,f.D)(),(0,f.d)("_markAllSubMeshesAsMiscDirty")],x.prototype,"applyDecalMapAfterDetailMap",void 0),(0,q.e)("BABYLON.PBRMaterial",x);var Z=K(11134),y=K(11252),i=K(11001),n=K(11236),X=K(11249),P=K(11194);class J{get influence(){return this._influence}set influence(z){if(this._influence===z)return;const a=this._influence;this._influence=z,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===a||0===z)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(z){this._animationPropertiesOverride=z}constructor(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=z,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new r.c,this._onDataLayoutChanged=new r.c,this._animationPropertiesOverride=null,this.id=z,this._scene=K||l.b.LastCreatedScene,this.influence=a,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(z){const a=this.hasPositions;this._positions=z,a!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(z){const a=this.hasNormals;this._normals=z,a!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(z){const a=this.hasTangents;this._tangents=z,a!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(z){const a=this.hasUVs;this._uvs=z,a!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const z=B.e.Clone((()=>new J(this.name,this.influence,this._scene)),this);return z._positions=this._positions,z._normals=this._normals,z._tangents=this._tangents,z._uvs=this._uvs,z}serialize(){const z={};return z.name=this.name,z.influence=this.influence,z.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(z.id=this.id),this.hasNormals&&(z.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(z.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(z.Aa=Array.prototype.slice.call(this.getUVs())),B.e.AppendSerializedAnimations(this,z),z}getClassName(){return"MorphTarget"}static Parse(z,a){const K=new J(z.name,z.influence);if(K.setPositions(z.xa),null!=z.id&&(K.id=z.id),z.ya&&K.setNormals(z.ya),z.tangents&&K.setTangents(z.tangents),z.Aa&&K.setUVs(z.Aa),z.animations){for(let a=0;a<z.animations.length;a++){const v=z.animations[a],T=(0,q.c)("BABYLON.Animation");T&&K.animations.push(T.Parse(v))}z.autoAnimate&&a&&a.beginAnimation(K,z.autoAnimateFrom,z.autoAnimateTo,z.autoAnimateLoop,z.autoAnimateSpeed||1)}return K}static FromMesh(z,a,K){a||(a=z.name);const v=new J(a,K,z.va());return v.setPositions(z.getVerticesData(i.h.PositionKind)),z.isVerticesDataPresent(i.h.NormalKind)&&v.setNormals(z.getVerticesData(i.h.NormalKind)),z.isVerticesDataPresent(i.h.TangentKind)&&v.setTangents(z.getVerticesData(i.h.TangentKind)),z.isVerticesDataPresent(i.h.UVKind)&&v.setUVs(z.getVerticesData(i.h.UVKind)),v}}(0,H.e)([(0,f.D)()],J.prototype,"id",void 0);var o=K(10933),N=K(11791);class A{set areUpdatesFrozen(z){z?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new o.f(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,z||(z=l.b.LastCreatedScene),this._scene=z,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const z=this._scene.getEngine().getCaps();this._canUseTextureForTargets=z.canUseGLVertexID&&z.textureFloat&&z.maxVertexTextureImageUnits>0&&z.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(z){this._numMaxInfluencers!==z&&(this._numMaxInfluencers=z,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(z){this._useTextureToStoreTargets=z}get isUsingTextureForTargets(){var z;return A.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(z=this._scene)&&void 0!==z&&z.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(z){return this._activeTargets.data[z]}getTarget(z){return this._targets[z]}getTargetByName(z){for(const a of this._targets)if(a.name===z)return a;return null}addTarget(z){this._targets.push(z),this._targetInfluenceChangedObservers.push(z.onInfluenceChanged.add((z=>{this._syncActiveTargets(z)}))),this._targetDataLayoutChangedObservers.push(z._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(z){const a=this._targets.indexOf(z);a>=0&&(this._targets.splice(a,1),z.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(a,1)[0]),z._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(a,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(z)}_bind(z){z.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),z.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),z.setTexture("morphTargets",this._targetStoreTexture),z.setInt("morphTargetCount",this.numInfluencers)}clone(){const z=new A(this._scene);for(const a of this._targets)z.addTarget(a.clone());return z.enableNormalMorphing=this.enableNormalMorphing,z.enableTangentMorphing=this.enableTangentMorphing,z.enableUVMorphing=this.enableUVMorphing,z}serialize(){const z={};z.id=this.uniqueId,z.targets=[];for(const a of this._targets)z.targets.push(a.serialize());return z}_syncActiveTargets(z){if(this.areUpdatesFrozen)return;let a=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let K=-1;for(const v of this._targets){if(K++,0===v.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=A.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(v),this._morphTargetTextureIndices[a]=K,this._tempInfluences[a++]=v.influence,this._supportsNormals=this._supportsNormals&&v.hasNormals,this._supportsTangents=this._supportsTangents&&v.hasTangents,this._supportsUVs=this._supportsUVs&&v.hasUVs;const z=v.getPositions();if(z){const a=z.length/3;if(0===this._vertexCount)this._vertexCount=a;else if(this._vertexCount!==a)return void V.c.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==a&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,a)),this._influences&&this._influences.length===a||(this._influences=new Float32Array(a));for(let v=0;v<a;v++)this._influences[v]=this._tempInfluences[v];z&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const z=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>z&&(this._textureHeight=Math.ceil(this._textureWidth/z),this._textureWidth=z);let a=!0;if(this._targetStoreTexture){const z=this._targetStoreTexture.getSize();z.width===this._textureWidth&&z.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(a=!1)}if(a){this._targetStoreTexture&&this._targetStoreTexture.dispose();const z=this._targets.length,a=new Float32Array(z*this._textureWidth*this._textureHeight*4);let K=0;for(let v=0;v<z;v++){const z=this._targets[v],T=z.getPositions(),m=z.getNormals(),p=z.getUVs(),j=z.getTangents();if(!T)return void(0===v&&V.c.Error("Invalid morph target. Target must have positions."));K=v*this._textureWidth*this._textureHeight*4;for(let v=0;v<this._vertexCount;v++)a[K]=T[3*v],a[K+1]=T[3*v+1],a[K+2]=T[3*v+2],K+=4,this._supportsNormals&&m&&(a[K]=m[3*v],a[K+1]=m[3*v+1],a[K+2]=m[3*v+2],K+=4),this._supportsUVs&&p&&(a[K]=p[2*v],a[K+1]=p[2*v+1],K+=4),this._supportsTangents&&j&&(a[K]=j[3*v],a[K+1]=j[3*v+1],a[K+2]=j[3*v+2],K+=4)}this._targetStoreTexture=N.d.CreateRGBATexture(a,this._textureWidth,this._textureHeight,z,this._scene,!1,!1,1,1)}}for(const z of this._scene.meshes)z.morphTargetManager===this&&z._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const z=this._parentContainer.morphTargetManagers.indexOf(this);z>-1&&this._parentContainer.morphTargetManagers.splice(z,1),this._parentContainer=null}for(const z of this._targets)this._scene.stopAnimation(z)}}static Parse(z,a){const K=new A(a);for(const v of z.targets)K.addTarget(J.Parse(v,a));return K}}A.EnableTextureStorage=!0,A.MaxActiveMorphTargetsInVertexAttributeMode=8;var g=K(11937),d=K(10682),t=K(11077);function e(z,a,K,v){return T.o.Jg(a,K).scaleInPlace(v)}class L{constructor(z,a,K,v){this.type=z,this.name=a,this.getValue=K,this.getStride=v}_buildAnimation(z,a,K){const v=new F.e(z,this.name,a,this.type);return v.setKeys(K),v}}class E extends L{buildAnimations(z,a,K,v,T){T(z._babylonTransformNode,this._buildAnimation(a,K,v))}}const b={translation:[new E(F.e.ANIMATIONTYPE_VECTOR3,"position",e,(()=>3))],rotation:[new E(F.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(z,a,K,v){return T.f.Jg(a,K).scaleInPlace(v)}),(()=>4))],scale:[new E(F.e.ANIMATIONTYPE_VECTOR3,"Yd",e,(()=>3))],weights:[new class extends L{buildAnimations(z,a,K,v,T){if(z._numMorphTargets)for(let m=0;m<z._numMorphTargets;m++){const p=new F.e(`${a}_${m}`,this.name,K,this.type);if(p.setKeys(v.map((z=>({frame:z.frame,inTangent:z.inTangent?z.inTangent[m]:void 0,value:z.value[m],outTangent:z.outTangent?z.outTangent[m]:void 0,interpolation:z.interpolation})))),z._primitiveBabylonMeshes)for(const a of z._primitiveBabylonMeshes)if(a.morphTargetManager){const z=a.morphTargetManager.getTarget(m),K=p.clone();z.animations.push(K),T(z,K)}}}}(F.e.ANIMATIONTYPE_FLOAT,"influence",(function(z,a,K,v){const T=new Array(z._numMorphTargets);for(let m=0;m<T.length;m++)T[m]=a[K++]*v;return T}),(z=>z._numMorphTargets))]},D=new Map,u=D;function U(z,a,K){R(z)&&V.c.Warn(`Extension with the name '${z}' already exists`),D.set(z,{isGLTFExtension:a,factory:K})}function R(z){return D.delete(z)}function k(){const z=z=>z&&"object"===typeof z;for(var a=arguments.length,K=new Array(a),v=0;v<a;v++)K[v]=arguments[v];return K.reduce(((a,K)=>(Object.keys(K).forEach((v=>{const T=a[v],m=K[v];Array.isArray(T)&&Array.isArray(m)?a[v]=T.concat(...m):z(T)&&z(m)?a[v]=k(T,m):a[v]=m})),a)),{})}class h{static Get(z,a,K){if(!a||void 0==K||!a[K])throw new Error(`${z}: Failed to find index (${K})`);return a[K]}static TryGet(z,a){return z&&void 0!=a&&z[a]?z[a]:null}static Assign(z){if(z)for(let a=0;a<z.length;a++)z[a].index=a}}class S{static RegisterExtension(z,a){U(z,!1,a)}static UnregisterExtension(z){return R(z)}get Qi(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(z){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=z}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((z=>z.dispose&&z.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(z,a,K,v,T,m){let p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=a,this._assetContainer=K,this._loadData(v);let m=null;if(z){const a={};if(this._gltf.nodes)for(const z of this._gltf.nodes)z.name&&(a[z.name]=z.index);m=(z instanceof Array?z:[z]).map((z=>{const K=a[z];if(void 0===K)throw new Error(`Failed to find node '${z}'`);return K}))}return this._loadAsync(T,p,m,(()=>({meshes:this._getMeshes(),sj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=z,this._loadData(a),this._loadAsync(K,T,null,(()=>{})))))}_loadAsync(z,a,K,v){return Promise.resolve().then((async()=>{this._rootUrl=z,this._uniqueRootUrl=!z.startsWith("file:")&&a?z:`${z}${Date.now()}/`,this._fileName=a,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const T=`${g.j[g.j.LOADING]} => ${g.j[g.j.READY]}`,m=`${g.j[g.j.LOADING]} => ${g.j[g.j.COMPLETE]}`;this._parent._startPerformanceCounter(T),this._parent._startPerformanceCounter(m),this._parent._setState(g.j.LOADING),this._extensionsOnLoading();const j=new Array;if(!this.parent.loadOnlyMaterials)if(K)j.push(this.loadSceneAsync("/nodes",{nodes:K,index:-1}));else if(void 0!=this._gltf.Oc||this._gltf.scenes&&this._gltf.scenes[0]){const z=h.Get("/scene",this._gltf.scenes,this._gltf.Oc||0);j.push(this.loadSceneAsync(`/scenes/${z.index}`,z))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let z=0;z<this._gltf.materials.length;++z){const a=this._gltf.materials[z],K="/materials/"+z,v=w.b.TriangleFillMode;j.push(this._loadMaterialAsync(K,a,null,v,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&j.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&j.push(this._compileShadowGeneratorsAsync());return Promise.all(j).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Nb(!0),this._extensionsOnReady(),this._parent._setState(g.j.READY),this._startAnimations(),v()))).then((z=>(this._parent._endPerformanceCounter(T),p.h.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(m),this._parent._setState(g.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(z=>{this._parent.onErrorObservable.notifyObservers(z),this._parent.onErrorObservable.clear(),this.dispose()}))})),z)))})).catch((z=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(z),this._parent.onErrorObservable.clear(),this.dispose()),z}))}_loadData(z){if(this._gltf=z.json,this._setupData(),z.bin){const a=this._gltf.buffers;if(a&&a[0]&&!a[0].uri){const K=a[0];(K.byteLength<z.bin.byteLength-3||K.byteLength>z.bin.byteLength)&&V.c.Warn(`Binary buffer length (${K.byteLength}) from JSON does not match chunk length (${z.bin.byteLength})`),this._bin=z.bin}else V.c.Warn("Unexpected BIN chunk")}}_setupData(){if(h.Assign(this._gltf.accessors),h.Assign(this._gltf.animations),h.Assign(this._gltf.buffers),h.Assign(this._gltf.bufferViews),h.Assign(this._gltf.cameras),h.Assign(this._gltf.images),h.Assign(this._gltf.materials),h.Assign(this._gltf.meshes),h.Assign(this._gltf.nodes),h.Assign(this._gltf.samplers),h.Assign(this._gltf.scenes),h.Assign(this._gltf.skins),h.Assign(this._gltf.textures),this._gltf.nodes){const z={};for(const K of this._gltf.nodes)if(K.children)for(const a of K.children)z[a]=K.index;const a=this._createRootNode();for(const K of this._gltf.nodes){const v=z[K.index];K.parent=void 0===v?a:this._gltf.nodes[v]}}}async _loadExtensionsAsync(){const z=[];if(u.forEach(((a,K)=>{var v;!1===(null===(v=this.parent.extensionOptions[K])||void 0===v?void 0:v.enabled)?a.isGLTFExtension&&this.isExtensionUsed(K)&&V.c.Warn(`Extension ${K} is used but has been explicitly disabled.`):a.isGLTFExtension&&!this.isExtensionUsed(K)||z.push((async()=>{const z=await a.factory(this);return z.name!==K&&V.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${z.name} !== ${K}`),this._parent.onExtensionLoadedObservable.notifyObservers(z),z})())})),this._extensions.push(...await Promise.all(z)),this._extensions.sort(((z,a)=>(z.order||Number.MAX_VALUE)-(a.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const K of this._gltf.extensionsRequired){if(!this._extensions.some((z=>z.name===K&&z.enabled))){var a;if(!1===(null===(a=this.parent.extensionOptions[K])||void 0===a?void 0:a.enabled))throw new Error(`Required extension ${K} is disabled`);throw new Error(`Required extension ${K} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const z=new P.c("__root__",this._babylonScene);this._rootBabylonMesh=z,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Nb(!1);const a={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case g.g.AUTO:this._babylonScene.useRightHandedSystem||(a.rotation=[0,1,0,0],a.scale=[1,1,-1],S._LoadTransform(a,this._rootBabylonMesh));break;case g.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(z),a}loadSceneAsync(z,a){const K=this._extensionsLoadSceneAsync(z,a);if(K)return K;const v=new Array;if(this.logOpen(`${z} ${a.name||""}`),a.nodes)for(const T of a.nodes){const a=h.Get(`${z}/nodes/${T}`,this._gltf.nodes,T);v.push(this.loadNodeAsync(`/nodes/${a.index}`,a,(z=>{z.parent=this._rootBabylonMesh})))}for(const T of this._postSceneLoadActions)T();return v.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(v).then((()=>{}))}_forEachPrimitive(z,a){if(z._primitiveBabylonMeshes)for(const K of z._primitiveBabylonMeshes)a(K)}_getGeometries(){const z=[],a=this._gltf.nodes;if(a)for(const K of a)this._forEachPrimitive(K,(a=>{const K=a.Fj;K&&-1===z.indexOf(K)&&z.push(K)}));return z}_getMeshes(){const z=[];this._rootBabylonMesh instanceof X.e&&z.push(this._rootBabylonMesh);const a=this._gltf.nodes;if(a)for(const K of a)this._forEachPrimitive(K,(a=>{z.push(a)}));return z}_getTransformNodes(){const z=[],a=this._gltf.nodes;if(a)for(const K of a)K._babylonTransformNode&&"xb"===K._babylonTransformNode.getClassName()&&z.push(K._babylonTransformNode),K._babylonTransformNodeForSkin&&z.push(K._babylonTransformNodeForSkin);return z}_getSkeletons(){const z=[],a=this._gltf.skins;if(a)for(const K of a)K._data&&z.push(K._data.babylonSkeleton);return z}_getAnimationGroups(){const z=[],a=this._gltf.animations;if(a)for(const K of a)K._babylonAnimationGroup&&z.push(K._babylonAnimationGroup);return z}_startAnimations(){switch(this._parent.animationStartMode){case g.e.NONE:break;case g.e.FIRST:{const z=this._getAnimationGroups();0!==z.length&&z[0].start(!0);break}case g.e.ALL:{const z=this._getAnimationGroups();for(const a of z)a.start(!0);break}default:return void V.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const v=this._extensionsLoadNodeAsync(z,a,K);if(v)return v;if(a._babylonTransformNode)throw new Error(`${z}: Invalid recursive node hierarchy`);const T=new Array;this.logOpen(`${z} ${a.name||""}`);const m=v=>{if(S.AddPointerMetadata(v,z),S._LoadTransform(a,v),void 0!=a.camera){const K=h.Get(`${z}/camera`,this._gltf.cameras,a.camera);T.push(this.loadCameraAsync(`/cameras/${K.index}`,K,(z=>{z.parent=v})))}if(a.children)for(const K of a.children){const a=h.Get(`${z}/children/${K}`,this._gltf.nodes,K);T.push(this.loadNodeAsync(`/nodes/${a.index}`,a,(z=>{z.parent=v})))}K(v)},p=void 0!=a.mesh,j=this._parent.loadSkins&&void 0!=a.skin;if(!p||j){const z=a.name||`node${a.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new y.d(z,this._babylonScene);K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==a.mesh?a._babylonTransformNode=K:a._babylonTransformNodeForSkin=K,m(K)}if(p)if(j){const K=h.Get(`${z}/mesh`,this._gltf.meshes,a.mesh);T.push(this._loadMeshAsync(`/meshes/${K.index}`,a,K,(K=>{const v=a._babylonTransformNodeForSkin;K.metadata=k(v.metadata,K.metadata||{});const m=h.Get(`${z}/skin`,this._gltf.skins,a.skin);T.push(this._loadSkinAsync(`/skins/${m.index}`,a,m,(z=>{this._forEachPrimitive(a,(a=>{a.skeleton=z})),this._postSceneLoadActions.push((()=>{if(void 0!=m.skeleton){const z=h.Get(`/skins/${m.index}/skeleton`,this._gltf.nodes,m.skeleton).parent;a.index===z.index?K.parent=v.parent:K.parent=z._babylonTransformNode}else K.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:v,skinnedNode:K})}))})))})))}else{const K=h.Get(`${z}/mesh`,this._gltf.meshes,a.mesh);T.push(this._loadMeshAsync(`/meshes/${K.index}`,a,K,m))}return this.logClose(),Promise.all(T).then((()=>(this._forEachPrimitive(a,(z=>{z.Fj&&z.Fj.useBoundingInfoFromGeometry?z.Ea():z.refreshBoundingInfo(!0,!0)})),a._babylonTransformNode)))}_loadMeshAsync(z,a,K,v){const T=K.primitives;if(!T||!T.length)throw new Error(`${z}: Primitives are missing`);void 0==T[0].index&&h.Assign(T);const m=new Array;this.logOpen(`${z} ${K.name||""}`);const p=a.name||`node${a.index}`;if(1===T.length){const v=K.primitives[0];m.push(this._loadMeshPrimitiveAsync(`${z}/primitives/${v.index}`,p,a,K,v,(z=>{a._babylonTransformNode=z,a._primitiveBabylonMeshes=[z]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,a._babylonTransformNode=new y.d(p,this._babylonScene),a._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a._primitiveBabylonMeshes=[];for(const v of T)m.push(this._loadMeshPrimitiveAsync(`${z}/primitives/${v.index}`,`${p}_primitive${v.index}`,a,K,v,(z=>{z.parent=a._babylonTransformNode,a._primitiveBabylonMeshes.push(z)})))}return v(a._babylonTransformNode),this.logClose(),Promise.all(m).then((()=>a._babylonTransformNode))}_loadMeshPrimitiveAsync(z,a,K,v,T,m){const p=this._extensionsLoadMeshPrimitiveAsync(z,a,K,v,T,m);if(p)return p;this.logOpen(`${z}`);const j=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==K.skin&&!v.primitives[0].targets;let s,M;if(j&&T._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,s=T._instanceData.babylonSourceMesh.createInstance(a),s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M=T._instanceData.promise;else{const m=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new P.c(a,this._babylonScene);p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.sideOrientation=this._babylonScene.useRightHandedSystem?w.b.CounterClockWiseSideOrientation:w.b.ClockWiseSideOrientation,this._createMorphTargets(z,K,v,T,p),m.push(this._loadVertexDataAsync(z,T,p).then((a=>this._loadMorphTargetsAsync(z,T,p,a).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,a.Ca(p),a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const r=S._GetDrawMode(z,T.mode);if(void 0==T.material){let z=this._defaultBabylonMaterialData[r];z||(z=this._createDefaultMaterial("__GLTFLoader._default",r),this._parent.onMaterialLoadedObservable.notifyObservers(z),this._defaultBabylonMaterialData[r]=z),p.material=z}else if(!this.parent.skipMaterials){const a=h.Get(`${z}/material`,this._gltf.materials,T.material);m.push(this._loadMaterialAsync(`/materials/${a.index}`,a,p,r,(z=>{p.material=z})))}M=Promise.all(m),j&&(T._instanceData={babylonSourceMesh:p,promise:M}),s=p}return S.AddPointerMetadata(s,z),this._parent.onMeshLoadedObservable.notifyObservers(s),m(s),this.logClose(),M.then((()=>s))}_loadVertexDataAsync(z,a,K){const v=this._extensionsLoadVertexDataAsync(z,a,K);if(v)return v;const m=a.attributes;if(!m)throw new Error(`${z}: Attributes are missing`);const p=new Array,j=new n.b(K.name,this._babylonScene);if(void 0==a.indices)K.isUnIndexed=!0;else{const K=h.Get(`${z}/indices`,this._gltf.accessors,a.indices);p.push(this._loadIndicesAccessorAsync(`/accessors/${K.index}`,K).then((z=>{j.setIndices(z)})))}const s=(a,v,s)=>{if(void 0==m[a])return;K._delayInfo=K._delayInfo||[],-1===K._delayInfo.indexOf(v)&&K._delayInfo.push(v);const M=h.Get(`${z}/attributes/${a}`,this._gltf.accessors,m[a]);p.push(this._loadVertexAccessorAsync(`/accessors/${M.index}`,M,v).then((z=>{if(z.getKind()===i.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!K.skeleton&&M.min&&M.max){const z=T.j.gb[0].Xd(...M.min),a=T.j.gb[1].Xd(...M.max);if(M.normalized&&5126!==M.componentType){let K=1;switch(M.componentType){case 5120:K=127;break;case 5121:K=255;break;case 5122:K=32767;break;case 5123:K=65535}const v=1/K;z.scaleInPlace(v),a.scaleInPlace(v)}j._boundingInfo=new t.e(z,a),j.useBoundingInfoFromGeometry=!0}j.setVerticesBuffer(z,M.count)}))),v==i.h.MatricesIndicesExtraKind&&(K.numBoneInfluencers=8),s&&s(M)};return s("POSITION",i.h.PositionKind),s("NORMAL",i.h.NormalKind),s("TANGENT",i.h.TangentKind),s("TEXCOORD_0",i.h.UVKind),s("TEXCOORD_1",i.h.UV2Kind),s("TEXCOORD_2",i.h.UV3Kind),s("TEXCOORD_3",i.h.UV4Kind),s("TEXCOORD_4",i.h.UV5Kind),s("TEXCOORD_5",i.h.UV6Kind),s("JOINTS_0",i.h.MatricesIndicesKind),s("WEIGHTS_0",i.h.MatricesWeightsKind),s("JOINTS_1",i.h.MatricesIndicesExtraKind),s("WEIGHTS_1",i.h.MatricesWeightsExtraKind),s("COLOR_0",i.h.ColorKind,(z=>{"VEC4"===z.type&&(K.hasVertexAlpha=!0)})),Promise.all(p).then((()=>j))}_createMorphTargets(z,a,K,v,T){if(!v.targets||!this._parent.loadMorphTargets)return;if(void 0==a._numMorphTargets)a._numMorphTargets=v.targets.length;else if(v.targets.length!==a._numMorphTargets)throw new Error(`${z}: Primitives do not have the same number of targets`);const m=K.extras?K.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,T.morphTargetManager=new A(this._babylonScene),T.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T.morphTargetManager.areUpdatesFrozen=!0;for(let p=0;p<v.targets.length;p++){const z=a.weights?a.weights[p]:K.weights?K.weights[p]:0,v=m?m[p]:`morphTarget${p}`;T.morphTargetManager.addTarget(new J(v,z,T.va()))}}_loadMorphTargetsAsync(z,a,K,v){if(!a.targets||!this._parent.loadMorphTargets)return Promise.resolve();const T=new Array,m=K.morphTargetManager;for(let p=0;p<m.numTargets;p++){const K=m.getTarget(p);T.push(this._loadMorphTargetVertexDataAsync(`${z}/targets/${p}`,v,a.targets[p],K))}return Promise.all(T).then((()=>{m.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(z,a,K,v){const T=new Array,m=(v,m,p)=>{if(void 0==K[v])return;const j=a.getVertexBuffer(m);if(!j)return;const s=h.Get(`${z}/${v}`,this._gltf.accessors,K[v]);T.push(this._loadFloatAccessorAsync(`/accessors/${s.index}`,s).then((z=>{p(j,z)})))};return m("POSITION",i.h.PositionKind,((z,a)=>{const K=new Float32Array(a.length);z.forEach(a.length,((z,v)=>{K[v]=a[v]+z})),v.setPositions(K)})),m("NORMAL",i.h.NormalKind,((z,a)=>{const K=new Float32Array(a.length);z.forEach(K.length,((z,v)=>{K[v]=a[v]+z})),v.setNormals(K)})),m("TANGENT",i.h.TangentKind,((z,a)=>{const K=new Float32Array(a.length/3*4);let T=0;z.forEach(a.length/3*4,((z,v)=>{(v+1)%4!==0&&(K[T]=a[T]+z,T++)})),v.setTangents(K)})),Promise.all(T).then((()=>{}))}static _LoadTransform(z,a){if(void 0!=z.skin)return;let K=T.o.Zero(),v=T.f.Identity(),m=T.o.One();if(z.matrix){T.b.Jg(z.matrix).decompose(m,v,K)}else z.translation&&(K=T.o.Jg(z.translation)),z.rotation&&(v=T.f.Jg(z.rotation)),z.scale&&(m=T.o.Jg(z.scale));a.position=K,a.rotationQuaternion=v,a.Yd=m}_loadSkinAsync(z,a,K,v){if(!this._parent.loadSkins)return Promise.resolve();const T=this._extensionsLoadSkinAsync(z,a,K);if(T)return T;if(K._data)return v(K._data.babylonSkeleton),K._data.promise;const m=`skeleton${K.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new C(K.name||m,m,this._babylonScene);p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(z,K,p);const j=this._loadSkinInverseBindMatricesDataAsync(z,K).then((z=>{this._updateBoneMatrices(p,z)}));return K._data={babylonSkeleton:p,promise:j},v(p),j}_loadBones(z,a,K){if(void 0==a.skeleton||this._parent.alwaysComputeSkeletonRootNode){const K=this._findSkeletonRootNode(`${z}/joints`,a.joints);if(K)if(void 0===a.skeleton)a.skeleton=K.index;else{const v=(z,a)=>{for(;a.parent;a=a.parent)if(a.parent===z)return!0;return!1},T=h.Get(`${z}/skeleton`,this._gltf.nodes,a.skeleton);T===K||v(T,K)||(V.c.Warn(`${z}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),a.skeleton=K.index)}else V.c.Warn(`${z}: Failed to find common root`)}const v={};for(const T of a.joints){const m=h.Get(`${z}/joints/${T}`,this._gltf.nodes,T);this._loadBone(m,a,K,v)}}_findSkeletonRootNode(z,a){if(0===a.length)return null;const K={};for(const T of a){const a=[];let v=h.Get(`${z}/${T}`,this._gltf.nodes,T);for(;-1!==v.index;)a.unshift(v),v=v.parent;K[T]=a}let v=null;for(let T=0;;++T){let z=K[a[0]];if(T>=z.length)return v;const m=z[T];for(let p=1;p<a.length;++p)if(z=K[a[p]],T>=z.length||m!==z[T])return v;v=m}}_loadBone(z,a,K,v){z._isJoint=!0;let T=v[z.index];if(T)return T;let m=null;z.index!==a.skeleton&&(z.parent&&-1!==z.parent.index?m=this._loadBone(z.parent,a,K,v):void 0!==a.skeleton&&V.c.Warn(`/skins/${a.index}/skeleton: Skeleton node is not a common root`));const p=a.joints.indexOf(z.index);return T=new M.b(z.name||`joint${z.index}`,K,m,this._getNodeMatrix(z),null,null,p),v[z.index]=T,this._postSceneLoadActions.push((()=>{T.linkTransformNode(z._babylonTransformNode)})),T}_loadSkinInverseBindMatricesDataAsync(z,a){if(void 0==a.inverseBindMatrices)return Promise.resolve(null);const K=h.Get(`${z}/inverseBindMatrices`,this._gltf.accessors,a.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${K.index}`,K)}_updateBoneMatrices(z,a){for(const K of z.bones){const z=T.b.Identity(),v=K._index;a&&-1!==v&&(T.b.FromArrayToRef(a,16*v,z),z.invertToRef(z));const m=K.getParent();m&&z.multiplyToRef(m.getAbsoluteInverseBindMatrix(),z),K.Jj(z,!1,!1),K._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(z){return z.matrix?T.b.Jg(z.matrix):T.b.Compose(z.scale?T.o.Jg(z.scale):T.o.One(),z.rotation?T.f.Jg(z.rotation):T.f.Identity(),z.translation?T.o.Jg(z.translation):T.o.Zero())}loadCameraAsync(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const v=this._extensionsLoadCameraAsync(z,a,K);if(v)return v;const m=new Array;this.logOpen(`${z} ${a.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const p=new s.b(a.name||`camera${a.index}`,T.o.Zero(),this._babylonScene,!1);switch(p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.ignoreParentScaling=!0,a._babylonCamera=p,p.rotation.set(0,Math.PI,0),a.type){case"perspective":{const K=a.perspective;if(!K)throw new Error(`${z}: Camera perspective properties are missing`);p.fov=K.yfov,p.Yi=K.znear,p.maxZ=K.zfar||0;break}case"orthographic":if(!a.orthographic)throw new Error(`${z}: Camera orthographic properties are missing`);p.mode=j.d.ORTHOGRAPHIC_CAMERA,p.orthoLeft=-a.orthographic.xmag,p.orthoRight=a.orthographic.xmag,p.orthoBottom=-a.orthographic.ymag,p.orthoTop=a.orthographic.ymag,p.Yi=a.orthographic.znear,p.maxZ=a.orthographic.zfar;break;default:throw new Error(`${z}: Invalid camera type (${a.type})`)}return S.AddPointerMetadata(p,z),this._parent.onCameraLoadedObservable.notifyObservers(p),K(p),this.logClose(),Promise.all(m).then((()=>p))}_loadAnimationsAsync(){const z=this._gltf.animations;if(!z)return Promise.resolve();const a=new Array;for(let K=0;K<z.length;K++){const v=z[K];a.push(this.loadAnimationAsync(`/animations/${v.index}`,v).then((z=>{0===z.targetedAnimations.length&&z.dispose()})))}return Promise.all(a).then((()=>{}))}loadAnimationAsync(z,a){const v=this._extensionsLoadAnimationAsync(z,a);return v||K.e(38).then(K.bind(K,13165)).then((K=>{let{AnimationGroup:v}=K;this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new v(a.name||`animation${a.index}`,this._babylonScene);T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a._babylonAnimationGroup=T;const m=new Array;h.Assign(a.channels),h.Assign(a.samplers);for(const p of a.channels)m.push(this._loadAnimationChannelAsync(`${z}/channels/${p.index}`,z,a,p,((z,a)=>{z.animations=z.animations||[],z.animations.push(a),T.addTargetedAnimation(a,z)})));return Promise.all(m).then((()=>(T.normalize(0),T)))}))}_loadAnimationChannelAsync(z,a,K,v,T){const m=this._extensionsLoadAnimationChannelAsync(z,a,K,v,T);if(m)return m;if(void 0==v.target.node)return Promise.resolve();const p=h.Get(`${z}/target/node`,this._gltf.nodes,v.target.node),j=v.target.path,s="weights"===j;if(s&&!p._numMorphTargets||!s&&!p._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!s&&!p._isJoint)return Promise.resolve();let M;switch(j){case"translation":M=b.translation;break;case"rotation":M=b.rotation;break;case"scale":M=b.scale;break;case"weights":M=b.weights;break;default:throw new Error(`${z}/target/path: Invalid value (${v.target.path})`)}const r={object:p,info:M};return this._loadAnimationChannelFromTargetInfoAsync(z,a,K,v,r,T)}_loadAnimationChannelFromTargetInfoAsync(z,a,K,v,T,m){const p=this.parent.targetFps,j=1/p,s=h.Get(`${z}/sampler`,K.samplers,v.sampler);return this._loadAnimationSamplerAsync(`${a}/samplers/${v.sampler}`,s).then((z=>{let a=0;const s=T.object,M=T.info;for(const T of M){const M=T.getStride(s),r=z.input,W=z.output,F=new Array(r.length);let G=0;switch(z.interpolation){case"STEP":for(let z=0;z<r.length;z++){const a=T.getValue(s,W,G,1);G+=M,F[z]={frame:r[z]*p,value:a,interpolation:1}}break;case"CUBICSPLINE":for(let z=0;z<r.length;z++){const a=T.getValue(s,W,G,j);G+=M;const K=T.getValue(s,W,G,1);G+=M;const v=T.getValue(s,W,G,j);G+=M,F[z]={frame:r[z]*p,inTangent:a,value:K,outTangent:v}}break;case"LINEAR":for(let z=0;z<r.length;z++){const a=T.getValue(s,W,G,1);G+=M,F[z]={frame:r[z]*p,value:a}}}if(G>0){const z=`${K.name||`animation${K.index}`}_channel${v.index}_${a}`;T.buildAnimations(s,z,p,F,((z,K)=>{++a,m(z,K)}))}}}))}_loadAnimationSamplerAsync(z,a){if(a._data)return a._data;const K=a.interpolation||"LINEAR";switch(K){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${z}/interpolation: Invalid value (${a.interpolation})`)}const v=h.Get(`${z}/input`,this._gltf.accessors,a.input),T=h.Get(`${z}/output`,this._gltf.accessors,a.output);return a._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${v.index}`,v),this._loadFloatAccessorAsync(`/accessors/${T.index}`,T)]).then((z=>{let[a,v]=z;return{input:a,interpolation:K,output:v}})),a._data}loadBufferAsync(z,a,K,v){const T=this._extensionsLoadBufferAsync(z,a,K,v);if(T)return T;if(!a._data)if(a.uri)a._data=this.loadUriAsync(`${z}/uri`,a,a.uri);else{if(!this._bin)throw new Error(`${z}: Uri is missing or the binary glTF is missing its binary chunk`);a._data=this._bin.readAsync(0,a.byteLength)}return a._data.then((a=>{try{return new Uint8Array(a.buffer,a.byteOffset+K,v)}catch(T){throw new Error(`${z}: ${T.message}`)}}))}loadBufferViewAsync(z,a){const K=this._extensionsLoadBufferViewAsync(z,a);if(K)return K;if(a._data)return a._data;const v=h.Get(`${z}/buffer`,this._gltf.buffers,a.buffer);return a._data=this.loadBufferAsync(`/buffers/${v.index}`,v,a.byteOffset||0,a.byteLength),a._data}_loadAccessorAsync(z,a,K){if(a._data)return a._data;const v=S._GetNumComponents(z,a.type),T=v*i.h.GetTypeByteLength(a.componentType),m=v*a.count;if(void 0==a.bufferView)a._data=Promise.resolve(new K(m));else{const p=h.Get(`${z}/bufferView`,this._gltf.bufferViews,a.bufferView);a._data=this.loadBufferViewAsync(`/bufferViews/${p.index}`,p).then((j=>{if(5126!==a.componentType||a.normalized||p.byteStride&&p.byteStride!==T){const z=new K(m);return i.h.ForEach(j,a.byteOffset||0,p.byteStride||T,v,a.componentType,z.length,a.normalized||!1,((a,K)=>{z[K]=a})),z}return S._GetTypedArray(z,a.componentType,j,a.byteOffset,m)}))}if(a.sparse){const m=a.sparse;a._data=a._data.then((p=>{const j=p,s=h.Get(`${z}/sparse/indices/bufferView`,this._gltf.bufferViews,m.indices.bufferView),M=h.Get(`${z}/sparse/values/bufferView`,this._gltf.bufferViews,m.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${s.index}`,s),this.loadBufferViewAsync(`/bufferViews/${M.index}`,M)]).then((p=>{let[s,M]=p;const r=S._GetTypedArray(`${z}/sparse/indices`,m.indices.componentType,s,m.indices.byteOffset,m.count),W=v*m.count;let F;if(5126!==a.componentType||a.normalized){const p=S._GetTypedArray(`${z}/sparse/values`,a.componentType,M,m.values.byteOffset,W);F=new K(W),i.h.ForEach(p,0,T,v,a.componentType,F.length,a.normalized||!1,((z,a)=>{F[a]=z}))}else F=S._GetTypedArray(`${z}/sparse/values`,a.componentType,M,m.values.byteOffset,W);let G=0;for(let z=0;z<r.length;z++){let a=r[z]*v;for(let z=0;z<v;z++)j[a++]=F[G++]}return j}))}))}return a._data}_loadFloatAccessorAsync(z,a){return this._loadAccessorAsync(z,a,Float32Array)}_loadIndicesAccessorAsync(z,a){if("SCALAR"!==a.type)throw new Error(`${z}/type: Invalid value ${a.type}`);if(5121!==a.componentType&&5123!==a.componentType&&5125!==a.componentType)throw new Error(`${z}/componentType: Invalid value ${a.componentType}`);if(a._data)return a._data;if(a.sparse){const K=S._GetTypedArrayConstructor(`${z}/componentType`,a.componentType);a._data=this._loadAccessorAsync(z,a,K)}else{const K=h.Get(`${z}/bufferView`,this._gltf.bufferViews,a.bufferView);a._data=this.loadBufferViewAsync(`/bufferViews/${K.index}`,K).then((K=>S._GetTypedArray(z,a.componentType,K,a.byteOffset,a.count)))}return a._data}_loadVertexBufferViewAsync(z){if(z._babylonBuffer)return z._babylonBuffer;const a=this._babylonScene.getEngine();return z._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${z.index}`,z).then((z=>new i.e(a,z,!1))),z._babylonBuffer}_loadVertexAccessorAsync(z,a,K){var v;if(null!==(v=a._babylonVertexBuffer)&&void 0!==v&&v[K])return a._babylonVertexBuffer[K];a._babylonVertexBuffer||(a._babylonVertexBuffer={});const T=this._babylonScene.getEngine();if(a.sparse||void 0==a.bufferView)a._babylonVertexBuffer[K]=this._loadFloatAccessorAsync(z,a).then((z=>new i.h(T,z,K,!1)));else{const v=h.Get(`${z}/bufferView`,this._gltf.bufferViews,a.bufferView);a._babylonVertexBuffer[K]=this._loadVertexBufferViewAsync(v).then((m=>{const p=S._GetNumComponents(z,a.type);return new i.h(T,m,K,!1,void 0,v.byteStride,void 0,a.byteOffset,p,a.componentType,a.normalized,!0,void 0,!0)}))}return a._babylonVertexBuffer[K]}_loadMaterialMetallicRoughnessPropertiesAsync(z,a,K){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);const v=new Array;return a&&(a.baseColorFactor?(K.albedoColor=m.c.Jg(a.baseColorFactor),K.alpha=a.baseColorFactor[3]):K.albedoColor=m.c.White(),K.metallic=void 0==a.metallicFactor?1:a.metallicFactor,K.roughness=void 0==a.roughnessFactor?1:a.roughnessFactor,a.baseColorTexture&&v.push(this.loadTextureInfoAsync(`${z}/baseColorTexture`,a.baseColorTexture,(z=>{z.name=`${K.name} (Base Color)`,K.albedoTexture=z}))),a.metallicRoughnessTexture&&(a.metallicRoughnessTexture.nonColorData=!0,v.push(this.loadTextureInfoAsync(`${z}/metallicRoughnessTexture`,a.metallicRoughnessTexture,(z=>{z.name=`${K.name} (Metallic Roughness)`,K.metallicTexture=z}))),K.useMetallnessFromMetallicTextureBlue=!0,K.useRoughnessFromMetallicTextureGreen=!0,K.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(v).then((()=>{}))}_loadMaterialAsync(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const m=this._extensionsLoadMaterialAsync(z,a,K,v,T);if(m)return m;a._data=a._data||{};let p=a._data[v];if(!p){this.logOpen(`${z} ${a.name||""}`);const K=this.createMaterial(z,a,v);p={babylonMaterial:K,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(z,a,K)},a._data[v]=p,S.AddPointerMetadata(K,z),this._parent.onMaterialLoadedObservable.notifyObservers(K),this.logClose()}return K&&(p.babylonMeshes.push(K),K.lj.addOnce((()=>{const z=p.babylonMeshes.indexOf(K);-1!==z&&p.babylonMeshes.splice(z,1)}))),T(p.babylonMaterial),p.promise.then((()=>p.babylonMaterial))}_createDefaultMaterial(z,a){this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new x(z,this._babylonScene);return K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,K.fillMode=a,K.enableSpecularAntiAliasing=!0,K.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,K.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,K.transparencyMode=x.PBRMATERIAL_OPAQUE,K.metallic=1,K.roughness=1,K}createMaterial(z,a,K){const v=this._extensionsCreateMaterial(z,a,K);if(v)return v;const T=a.name||`material${a.index}`;return this._createDefaultMaterial(T,K)}loadMaterialPropertiesAsync(z,a,K){const v=this._extensionsLoadMaterialPropertiesAsync(z,a,K);if(v)return v;const T=new Array;return T.push(this.loadMaterialBasePropertiesAsync(z,a,K)),a.pbrMetallicRoughness&&T.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${z}/pbrMetallicRoughness`,a.pbrMetallicRoughness,K)),this.loadMaterialAlphaProperties(z,a,K),Promise.all(T).then((()=>{}))}loadMaterialBasePropertiesAsync(z,a,K){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);const v=new Array;return K.emissiveColor=a.emissiveFactor?m.c.Jg(a.emissiveFactor):new m.c(0,0,0),a.doubleSided&&(K.Rg=!1,K.twoSidedLighting=!0),a.normalTexture&&(a.normalTexture.nonColorData=!0,v.push(this.loadTextureInfoAsync(`${z}/normalTexture`,a.normalTexture,(z=>{z.name=`${K.name} (Normal)`,K.bumpTexture=z}))),K.invertNormalMapX=!this._babylonScene.useRightHandedSystem,K.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=a.normalTexture.scale&&K.bumpTexture&&(K.bumpTexture.level=a.normalTexture.scale),K.forceIrradianceInFragment=!0),a.occlusionTexture&&(a.occlusionTexture.nonColorData=!0,v.push(this.loadTextureInfoAsync(`${z}/occlusionTexture`,a.occlusionTexture,(z=>{z.name=`${K.name} (Occlusion)`,K.ambientTexture=z}))),K.useAmbientInGrayScale=!0,void 0!=a.occlusionTexture.strength&&(K.ambientTextureStrength=a.occlusionTexture.strength)),a.emissiveTexture&&v.push(this.loadTextureInfoAsync(`${z}/emissiveTexture`,a.emissiveTexture,(z=>{z.name=`${K.name} (Emissive)`,K.emissiveTexture=z}))),Promise.all(v).then((()=>{}))}loadMaterialAlphaProperties(z,a,K){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);switch(a.alphaMode||"OPAQUE"){case"OPAQUE":K.transparencyMode=x.PBRMATERIAL_OPAQUE,K.alpha=1;break;case"MASK":K.transparencyMode=x.PBRMATERIAL_ALPHATEST,K.alphaCutOff=void 0==a.alphaCutoff?.5:a.alphaCutoff,K.albedoTexture&&(K.albedoTexture.me=!0);break;case"BLEND":K.transparencyMode=x.PBRMATERIAL_ALPHABLEND,K.albedoTexture&&(K.albedoTexture.me=!0,K.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${z}/alphaMode: Invalid value (${a.alphaMode})`)}}loadTextureInfoAsync(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const v=this._extensionsLoadTextureInfoAsync(z,a,K);if(v)return v;if(this.logOpen(`${z}`),a.texCoord>=6)throw new Error(`${z}/texCoord: Invalid value (${a.texCoord})`);const T=h.Get(`${z}/index`,this._gltf.textures,a.index);T._textureInfo=a;const m=this._loadTextureAsync(`/textures/${a.index}`,T,(v=>{v.coordinatesIndex=a.texCoord||0,S.AddPointerMetadata(v,z),this._parent.onTextureLoadedObservable.notifyObservers(v),K(v)}));return this.logClose(),m}_loadTextureAsync(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const v=this._extensionsLoadTextureAsync(z,a,K);if(v)return v;this.logOpen(`${z} ${a.name||""}`);const T=void 0==a.sampler?S.DefaultSampler:h.Get(`${z}/sampler`,this._gltf.samplers,a.sampler),m=h.Get(`${z}/source`,this._gltf.images,a.source),p=this._createTextureAsync(z,T,m,K,void 0,!a._textureInfo.nonColorData);return this.logClose(),p}_createTextureAsync(z,a,K){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},m=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0;const j=this._loadSampler(`/samplers/${a.index}`,a),s=new Array,M=new v;this._babylonScene._blockEntityCollection=!!this._assetContainer;const r={noMipmap:j.noMipMaps,invertY:!1,samplingMode:j.samplingMode,X:()=>{this._disposed||M.resolve()},onError:(a,K)=>{this._disposed||M.reject(new Error(`${z}: ${K&&K.message?K.message:a||"Failed to load texture"}`))},mimeType:K.mimeType,loaderOptions:m,useSRGBBuffer:!!p&&this._parent.useSRGBBuffers},W=new Z.d(null,this._babylonScene,r);return W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s.push(M.promise),s.push(this.loadImageAsync(`/images/${K.index}`,K).then((z=>{const a=K.uri||`${this._fileName}#image${K.index}`,v=`data:${this._uniqueRootUrl}${a}`;W.updateURL(v,z);const T=W.getInternalTexture();T&&(T.label=K.name)}))),W.wrapU=j.wrapU,W.wrapV=j.wrapV,T(W),this._parent.useGltfTextureNames&&(W.name=K.name||K.uri||`image${K.index}`),Promise.all(s).then((()=>W))}_loadSampler(z,a){return a._data||(a._data={noMipMaps:9728===a.minFilter||9729===a.minFilter,samplingMode:S._GetTextureSamplingMode(z,a),wrapU:S._GetTextureWrapMode(`${z}/wrapS`,a.wrapS),wrapV:S._GetTextureWrapMode(`${z}/wrapT`,a.wrapT)}),a._data}loadImageAsync(z,a){if(!a._data){if(this.logOpen(`${z} ${a.name||""}`),a.uri)a._data=this.loadUriAsync(`${z}/uri`,a,a.uri);else{const K=h.Get(`${z}/bufferView`,this._gltf.bufferViews,a.bufferView);a._data=this.loadBufferViewAsync(`/bufferViews/${K.index}`,K)}this.logClose()}return a._data}loadUriAsync(z,a,K){const v=this._extensionsLoadUriAsync(z,a,K);if(v)return v;if(!S._ValidateUri(K))throw new Error(`${z}: '${K}' is invalid`);if((0,d.f)(K)){const a=new Uint8Array((0,d.b)(K));return this.log(`${z}: Decoded ${K.substring(0,64)}... (${a.length} bytes)`),Promise.resolve(a)}return this.log(`${z}: Loading ${K}`),this._parent.preprocessUrlAsync(this._rootUrl+K).then((a=>new Promise(((v,T)=>{this._parent._loadFile(this._babylonScene,a,(a=>{this._disposed||(this.log(`${z}: Loaded ${K} (${a.byteLength} bytes)`),v(new Uint8Array(a)))}),!0,(a=>{T(new d.j(`${z}: Failed to load '${K}'${a?": "+a.status+" "+a.statusText:""}`,a))}))}))))}static AddPointerMetadata(z,a){z.metadata=z.metadata||{};const K=z._internalMetadata=z._internalMetadata||{},v=K.Qi=K.Qi||{};(v.pointers=v.pointers||[]).push(a)}static _GetTextureWrapMode(z,a){switch(a=void 0==a?10497:a){case 33071:return Z.d.CLAMP_ADDRESSMODE;case 33648:return Z.d.MIRROR_ADDRESSMODE;case 10497:return Z.d.WRAP_ADDRESSMODE;default:return V.c.Warn(`${z}: Invalid value (${a})`),Z.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(z,a){const K=void 0==a.magFilter?9729:a.magFilter,v=void 0==a.minFilter?9987:a.minFilter;if(9729===K)switch(v){case 9728:return Z.d.LINEAR_NEAREST;case 9729:return Z.d.LINEAR_LINEAR;case 9984:return Z.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return Z.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return Z.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return Z.d.LINEAR_LINEAR_MIPLINEAR;default:return V.c.Warn(`${z}/minFilter: Invalid value (${v})`),Z.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==K&&V.c.Warn(`${z}/magFilter: Invalid value (${K})`),v){case 9728:return Z.d.NEAREST_NEAREST;case 9729:return Z.d.NEAREST_LINEAR;case 9984:return Z.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return Z.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return Z.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return Z.d.NEAREST_LINEAR_MIPLINEAR;default:return V.c.Warn(`${z}/minFilter: Invalid value (${v})`),Z.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(z,a){switch(a){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${z}: Invalid component type ${a}`)}}static _GetTypedArray(z,a,K,v,T){const m=K.buffer;v=K.byteOffset+(v||0);const p=S._GetTypedArrayConstructor(`${z}/componentType`,a),j=i.h.GetTypeByteLength(a);return v%j!==0?(V.c.Warn(`${z}: Copying buffer as byte offset (${v}) is not a multiple of component type byte length (${j})`),new p(m.slice(v,v+T*j),0)):new p(m,v,T)}static _GetNumComponents(z,a){switch(a){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${z}: Invalid type (${a})`)}static _ValidateUri(z){return p.h.IsBase64(z)||-1===z.indexOf("..")}static _GetDrawMode(z,a){switch(void 0==a&&(a=4),a){case 0:return w.b.PointListDrawMode;case 1:return w.b.LineListDrawMode;case 2:return w.b.LineLoopDrawMode;case 3:return w.b.LineStripDrawMode;case 4:return w.b.TriangleFillMode;case 5:return w.b.TriangleStripDrawMode;case 6:return w.b.TriangleFanDrawMode}throw new Error(`${z}: Invalid mesh primitive mode (${a})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const z=new Array;if(this._gltf.materials)for(const a of this._gltf.materials)if(a._data)for(const K in a._data){const v=a._data[K];for(const a of v.babylonMeshes){a.Qj(!0);const K=v.babylonMaterial;z.push(K.forceCompilationAsync(a)),z.push(K.forceCompilationAsync(a,{useInstances:!0})),this._parent.useClipPlane&&(z.push(K.forceCompilationAsync(a,{clipPlane:!0})),z.push(K.forceCompilationAsync(a,{clipPlane:!0,useInstances:!0})))}}return Promise.all(z).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const z=new Array,a=this._babylonScene.lights;for(const K of a){const a=K.getShadowGenerator();a&&z.push(a.forceCompilationAsync())}return Promise.all(z).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(z){for(const a of this._extensions)a.enabled&&z(a)}_applyExtensions(z,a,K){for(const v of this._extensions)if(v.enabled){const T=`${v.name}.${a}`,m=z;m._activeLoaderExtensionFunctions=m._activeLoaderExtensionFunctions||{};const p=m._activeLoaderExtensionFunctions;if(!p[T]){p[T]=!0;try{const z=K(v);if(z)return z}finally{delete p[T]}}}return null}_extensionsOnLoading(){this._forEachExtensions((z=>z.onLoading&&z.onLoading()))}_extensionsOnReady(){this._forEachExtensions((z=>z.onReady&&z.onReady()))}_extensionsLoadSceneAsync(z,a){return this._applyExtensions(a,"loadScene",(K=>K.loadSceneAsync&&K.loadSceneAsync(z,a)))}_extensionsLoadNodeAsync(z,a,K){return this._applyExtensions(a,"loadNode",(v=>v.loadNodeAsync&&v.loadNodeAsync(z,a,K)))}_extensionsLoadCameraAsync(z,a,K){return this._applyExtensions(a,"loadCamera",(v=>v.loadCameraAsync&&v.loadCameraAsync(z,a,K)))}_extensionsLoadVertexDataAsync(z,a,K){return this._applyExtensions(a,"loadVertexData",(v=>v._loadVertexDataAsync&&v._loadVertexDataAsync(z,a,K)))}_extensionsLoadMeshPrimitiveAsync(z,a,K,v,T,m){return this._applyExtensions(T,"loadMeshPrimitive",(p=>p._loadMeshPrimitiveAsync&&p._loadMeshPrimitiveAsync(z,a,K,v,T,m)))}_extensionsLoadMaterialAsync(z,a,K,v,T){return this._applyExtensions(a,"loadMaterial",(m=>m._loadMaterialAsync&&m._loadMaterialAsync(z,a,K,v,T)))}_extensionsCreateMaterial(z,a,K){return this._applyExtensions(a,"createMaterial",(v=>v.createMaterial&&v.createMaterial(z,a,K)))}_extensionsLoadMaterialPropertiesAsync(z,a,K){return this._applyExtensions(a,"loadMaterialProperties",(v=>v.loadMaterialPropertiesAsync&&v.loadMaterialPropertiesAsync(z,a,K)))}_extensionsLoadTextureInfoAsync(z,a,K){return this._applyExtensions(a,"loadTextureInfo",(v=>v.loadTextureInfoAsync&&v.loadTextureInfoAsync(z,a,K)))}_extensionsLoadTextureAsync(z,a,K){return this._applyExtensions(a,"loadTexture",(v=>v._loadTextureAsync&&v._loadTextureAsync(z,a,K)))}_extensionsLoadAnimationAsync(z,a){return this._applyExtensions(a,"loadAnimation",(K=>K.loadAnimationAsync&&K.loadAnimationAsync(z,a)))}_extensionsLoadAnimationChannelAsync(z,a,K,v,T){return this._applyExtensions(K,"loadAnimationChannel",(m=>m._loadAnimationChannelAsync&&m._loadAnimationChannelAsync(z,a,K,v,T)))}_extensionsLoadSkinAsync(z,a,K){return this._applyExtensions(K,"loadSkin",(v=>v._loadSkinAsync&&v._loadSkinAsync(z,a,K)))}_extensionsLoadUriAsync(z,a,K){return this._applyExtensions(a,"loadUri",(v=>v._loadUriAsync&&v._loadUriAsync(z,a,K)))}_extensionsLoadBufferViewAsync(z,a){return this._applyExtensions(a,"loadBufferView",(K=>K.loadBufferViewAsync&&K.loadBufferViewAsync(z,a)))}_extensionsLoadBufferAsync(z,a,K,v){return this._applyExtensions(a,"loadBuffer",(T=>T.loadBufferAsync&&T.loadBufferAsync(z,a,K,v)))}static LoadExtensionAsync(z,a,K,v){if(!a.extensions)return null;const T=a.extensions[K];return T?v(`${z}/extensions/${K}`,T):null}static LoadExtraAsync(z,a,K,v){if(!a.extras)return null;const T=a.extras[K];return T?v(`${z}/extras/${K}`,T):null}isExtensionUsed(z){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(z)}logOpen(z){this._parent._logOpen(z)}logClose(){this._parent._logClose()}log(z){this._parent._log(z)}startPerformanceCounter(z){this._parent._startPerformanceCounter(z)}endPerformanceCounter(z){this._parent._endPerformanceCounter(z)}}S.DefaultSampler={index:-1},g.c._CreateGLTF2Loader=z=>new S(z);var Q=K(11435),O=K(11960),zz=K(11978);class az extends zz.c{constructor(z,a,K){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",z),this._texture=z.getEngine().createRawCubeTexture(a,K,v,T,m,p,j,s)}update(z,a,K,v){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,z,a,K,v,T)}updateRGBDAsync(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,O.k)(this._texture,z,a,K,v).then((()=>{}))}clone(){return B.e.Clone((()=>{const z=this.va(),a=this._texture,K=new az(z,a._bufferViewArray,a.width,a.format,a.type,a.generateMipMaps,a.invertY,a.samplingMode,a._compression);return 13===a.source&&K.updateRGBDAsync(a._bufferViewArrayArray,a._sphericalPolynomial,a._lodGenerationScale,a._lodGenerationOffset),K}),this)}}const Kz="EXT_lights_image_based";class vz{constructor(z){this.name=Kz,this._loader=z,this.enabled=this._loader.isExtensionUsed(Kz)}dispose(){this._loader=null,delete this._lights}onLoading(){const z=this._loader.Qi.extensions;if(z&&z[this.name]){const a=z[this.name];this._lights=a.lights}}loadSceneAsync(z,a){return S.LoadExtensionAsync(z,a,this.name,((K,v)=>{this._loader._allMaterialsDirtyRequired=!0;const T=new Array;T.push(this._loader.loadSceneAsync(z,a)),this._loader.logOpen(`${K}`);const m=h.Get(`${K}/light`,this._lights,v.fb);return T.push(this._loadLightAsync(`/extensions/${this.name}/lights/${v.fb}`,m).then((z=>{this._loader.babylonScene.environmentTexture=z}))),this._loader.logClose(),Promise.all(T).then((()=>{}))}))}_loadLightAsync(z,a){if(!a._loaded){const K=new Array;this._loader.logOpen(`${z}`);const v=new Array(a.specularImages.length);for(let T=0;T<a.specularImages.length;T++){const m=a.specularImages[T];v[T]=new Array(m.length);for(let a=0;a<m.length;a++){const p=`${z}/specularImages/${T}/${a}`;this._loader.logOpen(`${p}`);const j=m[a],s=h.Get(p,this._loader.Qi.images,j);K.push(this._loader.loadImageAsync(`/images/${j}`,s).then((z=>{v[T][a]=z}))),this._loader.logClose()}}this._loader.logClose(),a._loaded=Promise.all(K).then((()=>{const K=new az(this._loader.babylonScene,null,a.specularImageSize);if(K.name=a.name||"environment",a._babylonTexture=K,void 0!=a.aj&&(K.level=a.aj),a.rotation){let z=T.f.Jg(a.rotation);this._loader.babylonScene.useRightHandedSystem||(z=T.f.Inverse(z)),T.b.FromQuaternionToRef(z,K.getReflectionTextureMatrix())}if(!a.irradianceCoefficients)throw new Error(`${z}: Irradiance coefficients are missing`);const m=Q.e.Jg(a.irradianceCoefficients);m.scaleInPlace(a.aj),m.convertIrradianceToLambertianRadiance();const p=Q.f.FromHarmonics(m),j=(v.length-1)/Math.log2(a.specularImageSize);return K.updateRGBDAsync(v,p,j)}))}return a._loaded.then((()=>a._babylonTexture))}}R(Kz),U(Kz,!0,(z=>new vz(z)));K(11984);const Tz="EXT_mesh_gpu_instancing";class mz{constructor(z){this.name=Tz,this._loader=z,this.enabled=this._loader.isExtensionUsed(Tz)}dispose(){this._loader=null}loadNodeAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((z,v)=>{this._loader._disableInstancedMesh++;const m=this._loader.loadNodeAsync(`/nodes/${a.index}`,a,K);if(this._loader._disableInstancedMesh--,!a._primitiveBabylonMeshes)return m;const p=new Array;let j=0;const s=a=>{if(void 0==v.attributes[a])return void p.push(Promise.resolve(null));const K=h.Get(`${z}/attributes/${a}`,this._loader.Qi.accessors,v.attributes[a]);if(p.push(this._loader._loadFloatAccessorAsync(`/accessors/${K.bufferView}`,K)),0===j)j=K.count;else if(j!==K.count)throw new Error(`${z}/attributes: Instance buffer accessors do not have the same count.`)};return s("TRANSLATION"),s("ROTATION"),s("SCALE"),m.then((z=>Promise.all(p).then((K=>{let[v,m,p]=K;const s=new Float32Array(16*j);T.j.gb[0].Xd(0,0,0),T.j.Quaternion[0].Xd(0,0,0,1),T.j.gb[1].Xd(1,1,1);for(let z=0;z<j;++z)v&&T.o.FromArrayToRef(v,3*z,T.j.gb[0]),m&&T.f.FromArrayToRef(m,4*z,T.j.Quaternion[0]),p&&T.o.FromArrayToRef(p,3*z,T.j.gb[1]),T.b.ComposeToRef(T.j.gb[1],T.j.Quaternion[0],T.j.gb[0],T.j.Matrix[0]),T.j.Matrix[0].copyToArray(s,16*z);for(const z of a._primitiveBabylonMeshes)z.Yb("matrix",s,16,!0);return z}))))}))}}R(Tz),U(Tz,!0,(z=>new mz(z)));class pz{static get Default(){return pz._Default||(pz._Default=new pz),pz._Default}constructor(){const z=pz.Configuration.decoder;this._decoderModulePromise=p.h.LoadBabylonScriptAsync(z.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(z,a,K,v,T){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const m=await MeshoptDecoder.decodeGltfBufferAsync(a,K,z,v,T);return MeshoptDecoder.useWorkers(0),m}))}}pz.Configuration={decoder:{url:`${p.h._DefaultCdnUrl}/meshopt_decoder.js`}},pz._Default=null;const jz="EXT_meshopt_compression";class sz{constructor(z){this.name=jz,this.enabled=z.isExtensionUsed(jz),this._loader=z}dispose(){this._loader=null}loadBufferViewAsync(z,a){return S.LoadExtensionAsync(z,a,this.name,((K,v)=>{const T=a;if(T._meshOptData)return T._meshOptData;const m=h.Get(`${z}/buffer`,this._loader.Qi.buffers,v.buffer);return T._meshOptData=this._loader.loadBufferAsync(`/buffers/${m.index}`,m,v.byteOffset||0,v.byteLength).then((z=>pz.Default.decodeGltfBufferAsync(z,v.count,v.byteStride,v.mode,v.filter))),T._meshOptData}))}}R(jz),U(jz,!0,(z=>new sz(z)));const Mz="EXT_texture_webp";class rz{constructor(z){this.name=Mz,this._loader=z,this.enabled=z.isExtensionUsed(Mz)}dispose(){this._loader=null}_loadTextureAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{const m=void 0==a.sampler?S.DefaultSampler:h.Get(`${z}/sampler`,this._loader.Qi.samplers,a.sampler),p=h.Get(`${v}/source`,this._loader.Qi.images,T.source);return this._loader._createTextureAsync(z,m,p,(z=>{K(z)}),void 0,!a._textureInfo.nonColorData)}))}}R(Mz),U(Mz,!0,(z=>new rz(z)));const Wz="EXT_texture_avif";class Fz{constructor(z){this.name=Wz,this._loader=z,this.enabled=z.isExtensionUsed(Wz)}dispose(){this._loader=null}_loadTextureAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{const m=void 0==a.sampler?S.DefaultSampler:h.Get(`${z}/sampler`,this._loader.Qi.samplers,a.sampler),p=h.Get(`${v}/source`,this._loader.Qi.images,T.source);return this._loader._createTextureAsync(z,m,p,(z=>{K(z)}),void 0,!a._textureInfo.nonColorData)}))}}R(Wz),U(Wz,!0,(z=>new Fz(z)));var Gz=K(11991);const lz="KHR_draco_mesh_compression";class Vz{constructor(z){this.name=lz,this.useNormalizedFlagFromAccessor=!0,this._loader=z,this.enabled=Gz.b.DecoderAvailable&&this._loader.isExtensionUsed(lz)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{if(void 0!=a.mode&&4!==a.mode&&5!==a.mode)throw new Error(`${z}: Unsupported mode ${a.mode}`);const m={},p={},j=(z,v)=>{const j=T.attributes[z];if(void 0!=j&&(K._delayInfo=K._delayInfo||[],-1===K._delayInfo.indexOf(v)&&K._delayInfo.push(v),m[v]=j,this.useNormalizedFlagFromAccessor)){const K=h.TryGet(this._loader.Qi.accessors,a.attributes[z]);K&&(p[v]=K.normalized||!1)}};j("POSITION",i.h.PositionKind),j("NORMAL",i.h.NormalKind),j("TANGENT",i.h.TangentKind),j("TEXCOORD_0",i.h.UVKind),j("TEXCOORD_1",i.h.UV2Kind),j("TEXCOORD_2",i.h.UV3Kind),j("TEXCOORD_3",i.h.UV4Kind),j("TEXCOORD_4",i.h.UV5Kind),j("TEXCOORD_5",i.h.UV6Kind),j("JOINTS_0",i.h.MatricesIndicesKind),j("WEIGHTS_0",i.h.MatricesWeightsKind),j("COLOR_0",i.h.ColorKind);const s=h.Get(v,this._loader.Qi.bufferViews,T.bufferView);return s._dracoBabylonGeometry||(s._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${s.index}`,s).then((a=>(this.dracoCompression||Gz.b.Default)._decodeMeshToGeometryForGltfAsync(K.name,this._loader.babylonScene,a,m,p).catch((a=>{throw new Error(`${z}: ${a.message}`)}))))),s._dracoBabylonGeometry}))}}R(lz),U(lz,!0,(z=>new Vz(z)));var cz=K(12004),Cz=K(11215),wz=K(11949),Hz=K(12011);Cz.c.AddNodeConstructor("Light_Type_0",((z,a)=>()=>new fz(z,T.o.Zero(),a)));class fz extends Hz.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(z){this._shadowAngle=z,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(z){const a=this.needCube();if(this._direction=z,this.needCube()!==a&&this._shadowGenerators){const z=this._shadowGenerators.values();for(let a=z.next();!0!==a.done;a=z.next()){a.value.recreateShadowMap()}}}constructor(z,a,K){super(z,K),this._shadowAngle=Math.PI/2,this.position=a}getClassName(){return"PointLight"}getTypeID(){return wz.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(z){if(this.direction)return super.getShadowDirection(z);switch(z){case 0:return new T.o(1,0,0);case 1:return new T.o(-1,0,0);case 2:return new T.o(0,-1,0);case 3:return new T.o(0,1,0);case 4:return new T.o(0,0,1);case 5:return new T.o(0,0,-1)}return T.o.Zero()}_setDefaultShadowProjectionMatrix(z,a,K){const v=this.va().activeCamera;if(!v)return;const m=void 0!==this.shadowMinZ?this.shadowMinZ:v.Yi,p=void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ,j=this.va().getEngine().useReverseDepthBuffer;T.b.PerspectiveFovLHToRef(this.shadowAngle,1,j?p:m,j?m:p,z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,j)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(z,a){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,a):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,a),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,a),this}transferToNodeMaterialEffect(z,a){return this.computeTransformedInformation()?z.setFloat3(a,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):z.setFloat3(a,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(z,a){z["POINTLIGHT"+a]=!0}}(0,H.e)([(0,f.D)()],fz.prototype,"shadowAngle",null),(0,q.e)("BABYLON.PointLight",fz),Cz.c.AddNodeConstructor("Light_Type_2",((z,a)=>()=>new Yz(z,T.o.Zero(),T.o.Zero(),0,0,a)));class Yz extends Hz.d{get angle(){return this._angle}set angle(z){this._angle=z,this._cosHalfAngle=Math.cos(.5*z),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(z){this._innerAngle=z,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(z){this._shadowAngleScale=z,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(z){this._projectionTextureLightNear=z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(z){this._projectionTextureLightFar=z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(z){this._projectionTextureUpDirection=z,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(z){this._projectionTexture!==z&&(this._projectionTexture=z,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Yz._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Yz._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(z){return void 0!==z.onGeneratedObservable}static _IsTexture(z){return void 0!==z.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(z){this._projectionTextureProjectionLightMatrix=z,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(z,a,K,v,m,p){super(z,p),this._innerAngle=0,this._projectionTextureMatrix=T.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=T.o.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=T.o.Zero(),this._projectionTextureViewLightMatrix=T.b.Zero(),this._projectionTextureProjectionLightMatrix=T.b.Zero(),this._projectionTextureScalingMatrix=T.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=a,this.direction=K,this.angle=v,this.exponent=m}getClassName(){return"SpotLight"}getTypeID(){return wz.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(z){super._setDirection(z),this._projectionTextureViewLightDirty=!0}_setPosition(z){super._setPosition(z),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(z,a,K){const v=this.va().activeCamera;if(!v)return;this._shadowAngleScale=this._shadowAngleScale||1;const m=this._shadowAngleScale*this._angle,p=void 0!==this.shadowMinZ?this.shadowMinZ:v.Yi,j=void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ,s=this.va().getEngine().useReverseDepthBuffer;T.b.PerspectiveFovLHToRef(m,1,s?j:p,s?p:j,z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,s)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),T.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const z=this.projectionTextureLightFar,a=this.projectionTextureLightNear,K=z/(z-a),v=-K*a,m=1/Math.tan(this._angle/2);T.b.FromValuesToRef(m/1,0,0,0,0,m,0,0,0,0,K,1,0,0,v,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof Z.d){const z=this._projectionTexture.uScale/2,a=this._projectionTexture.vScale/2;T.b.FromValuesToRef(z,0,0,0,0,a,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(z,a){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),z.setMatrix("textureProjectionMatrix"+a,this._projectionTextureMatrix),z.setTexture("projectionLightTexture"+a,this.projectionTexture)),this}transferToEffect(z,a){let K;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,a),K=T.o.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,a),K=T.o.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",K.x,K.y,K.z,this._cosHalfAngle,a),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,a),this}transferToNodeMaterialEffect(z,a){let K;return K=this.computeTransformedInformation()?T.o.Normalize(this.transformedDirection):T.o.Normalize(this.direction),this.va().useRightHandedSystem?z.setFloat3(a,-K.x,-K.y,-K.z):z.setFloat3(a,K.x,K.y,K.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(z){const a=this._scene.getEngine(),K=void 0!==this.shadowMinZ?this.shadowMinZ:z.Yi;return a.useReverseDepthBuffer&&a.isNDCHalfZRange?K:this._scene.getEngine().isNDCHalfZRange?0:K}getDepthMaxZ(z){const a=this._scene.getEngine(),K=void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ;return a.useReverseDepthBuffer&&a.isNDCHalfZRange?0:K}prepareLightSpecificDefines(z,a){z["SPOTLIGHT"+a]=!0,z["PROJECTEDLIGHTTEXTURE"+a]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,H.e)([(0,f.D)()],Yz.prototype,"angle",null),(0,H.e)([(0,f.D)()],Yz.prototype,"innerAngle",null),(0,H.e)([(0,f.D)()],Yz.prototype,"shadowAngleScale",null),(0,H.e)([(0,f.D)()],Yz.prototype,"exponent",void 0),(0,H.e)([(0,f.D)()],Yz.prototype,"projectionTextureLightNear",null),(0,H.e)([(0,f.D)()],Yz.prototype,"projectionTextureLightFar",null),(0,H.e)([(0,f.D)()],Yz.prototype,"projectionTextureUpDirection",null),(0,H.e)([(0,f.x)("projectedLightTexture")],Yz.prototype,"_projectionTexture",void 0),(0,q.e)("BABYLON.SpotLight",Yz);const Iz="KHR_lights_punctual";class qz{constructor(z){this.name=Iz,this._loader=z,this.enabled=this._loader.isExtensionUsed(Iz)}dispose(){this._loader=null,delete this._lights}onLoading(){const z=this._loader.Qi.extensions;if(z&&z[this.name]){const a=z[this.name];this._lights=a.lights,h.Assign(this._lights)}}loadNodeAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,p)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(z,a,(z=>{let a;const j=h.Get(v,this._lights,p.fb),s=j.name||z.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,j.type){case"directional":{const z=new cz.b(s,T.o.Backward(),this._loader.babylonScene);z.position.Vd(0),a=z;break}case"point":a=new fz(s,T.o.Zero(),this._loader.babylonScene);break;case"spot":{const z=new Yz(s,T.o.Zero(),T.o.Backward(),0,1,this._loader.babylonScene);z.angle=2*(j.spot&&j.spot.outerConeAngle||Math.PI/4),z.innerAngle=2*(j.spot&&j.spot.innerConeAngle||0),a=z;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${v}: Invalid light type (${j.type})`)}a._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,j._babylonLight=a,a.falloffType=wz.d.FALLOFF_GLTF,a.gh=j.color?m.c.Jg(j.color):m.c.White(),a.aj=void 0==j.aj?1:j.aj,a.range=void 0==j.range?Number.MAX_VALUE:j.range,a.parent=z,this._loader._babylonLights.push(a),S.AddPointerMetadata(a,v),K(z)})))))}}R(Iz),U(Iz,!0,(z=>new qz(z)));const Bz="KHR_materials_pbrSpecularGlossiness";class xz{constructor(z){this.name=Bz,this.order=200,this._loader=z,this.enabled=this._loader.isExtensionUsed(Bz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{const m=new Array;return m.push(this._loader.loadMaterialBasePropertiesAsync(z,a,K)),m.push(this._loadSpecularGlossinessPropertiesAsync(v,T,K)),this._loader.loadMaterialAlphaProperties(z,a,K),Promise.all(m).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(z,a,K){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);const v=new Array;return K.metallic=null,K.roughness=null,a.diffuseFactor?(K.albedoColor=m.c.Jg(a.diffuseFactor),K.alpha=a.diffuseFactor[3]):K.albedoColor=m.c.White(),K.reflectivityColor=a.specularFactor?m.c.Jg(a.specularFactor):m.c.White(),K.microSurface=void 0==a.glossinessFactor?1:a.glossinessFactor,a.diffuseTexture&&v.push(this._loader.loadTextureInfoAsync(`${z}/diffuseTexture`,a.diffuseTexture,(z=>{z.name=`${K.name} (Diffuse)`,K.albedoTexture=z}))),a.specularGlossinessTexture&&(v.push(this._loader.loadTextureInfoAsync(`${z}/specularGlossinessTexture`,a.specularGlossinessTexture,(z=>{z.name=`${K.name} (Specular Glossiness)`,K.reflectivityTexture=z,K.reflectivityTexture.me=!0}))),K.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(v).then((()=>{}))}}R(Bz),U(Bz,!0,(z=>new xz(z)));const Zz="KHR_materials_unlit";class yz{constructor(z){this.name=Zz,this.order=210,this._loader=z,this.enabled=this._loader.isExtensionUsed(Zz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,(()=>this._loadUnlitPropertiesAsync(z,a,K)))}_loadUnlitPropertiesAsync(z,a,K){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);const v=new Array;K.unlit=!0;const T=a.pbrMetallicRoughness;return T&&(T.baseColorFactor?(K.albedoColor=m.c.Jg(T.baseColorFactor),K.alpha=T.baseColorFactor[3]):K.albedoColor=m.c.White(),T.baseColorTexture&&v.push(this._loader.loadTextureInfoAsync(`${z}/baseColorTexture`,T.baseColorTexture,(z=>{z.name=`${K.name} (Base Color)`,K.albedoTexture=z})))),a.doubleSided&&(K.Rg=!1,K.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(z,a,K),Promise.all(v).then((()=>{}))}}R(Zz),U(Zz,!0,(z=>new yz(z)));const iz="KHR_materials_clearcoat";class nz{constructor(z){this.name=iz,this.order=190,this._loader=z,this.enabled=this._loader.isExtensionUsed(iz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(z,a,K)),m.push(this._loadClearCoatPropertiesAsync(v,T,K)),Promise.all(m).then((()=>{}))}))}_loadClearCoatPropertiesAsync(z,a,K){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);const v=new Array;return K.clearCoat.isEnabled=!0,K.clearCoat.useRoughnessFromMainTexture=!1,K.clearCoat.remapF0OnInterfaceChange=!1,void 0!=a.clearcoatFactor?K.clearCoat.aj=a.clearcoatFactor:K.clearCoat.aj=0,a.clearcoatTexture&&v.push(this._loader.loadTextureInfoAsync(`${z}/clearcoatTexture`,a.clearcoatTexture,(z=>{z.name=`${K.name} (ClearCoat)`,K.clearCoat.texture=z}))),void 0!=a.clearcoatRoughnessFactor?K.clearCoat.roughness=a.clearcoatRoughnessFactor:K.clearCoat.roughness=0,a.clearcoatRoughnessTexture&&(a.clearcoatRoughnessTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${z}/clearcoatRoughnessTexture`,a.clearcoatRoughnessTexture,(z=>{z.name=`${K.name} (ClearCoat Roughness)`,K.clearCoat.textureRoughness=z})))),a.clearcoatNormalTexture&&(a.clearcoatNormalTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${z}/clearcoatNormalTexture`,a.clearcoatNormalTexture,(z=>{z.name=`${K.name} (ClearCoat Normal)`,K.clearCoat.bumpTexture=z}))),K.invertNormalMapX=!K.va().useRightHandedSystem,K.invertNormalMapY=K.va().useRightHandedSystem,void 0!=a.clearcoatNormalTexture.scale&&(K.clearCoat.bumpTexture.level=a.clearcoatNormalTexture.scale)),Promise.all(v).then((()=>{}))}}R(iz),U(iz,!0,(z=>new nz(z)));const Xz="KHR_materials_iridescence";class Pz{constructor(z){this.name=Xz,this.order=195,this._loader=z,this.enabled=this._loader.isExtensionUsed(Xz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(z,a,K)),m.push(this._loadIridescencePropertiesAsync(v,T,K)),Promise.all(m).then((()=>{}))}))}_loadIridescencePropertiesAsync(z,a,K){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);const v=new Array;return K.iridescence.isEnabled=!0,K.iridescence.aj=a.iridescenceFactor??0,K.iridescence.indexOfRefraction=a.iridescenceIor??a.iridescenceIOR??1.3,K.iridescence.minimumThickness=a.iridescenceThicknessMinimum??100,K.iridescence.maximumThickness=a.iridescenceThicknessMaximum??400,a.iridescenceTexture&&v.push(this._loader.loadTextureInfoAsync(`${z}/iridescenceTexture`,a.iridescenceTexture,(z=>{z.name=`${K.name} (Iridescence)`,K.iridescence.texture=z}))),a.iridescenceThicknessTexture&&v.push(this._loader.loadTextureInfoAsync(`${z}/iridescenceThicknessTexture`,a.iridescenceThicknessTexture,(z=>{z.name=`${K.name} (Iridescence Thickness)`,K.iridescence.thicknessTexture=z}))),Promise.all(v).then((()=>{}))}}R(Xz),U(Xz,!0,(z=>new Pz(z)));const Jz="KHR_materials_anisotropy";class oz{constructor(z){this.name=Jz,this.order=195,this._loader=z,this.enabled=this._loader.isExtensionUsed(Jz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(z,a,K)),m.push(this._loadIridescencePropertiesAsync(v,T,K)),Promise.all(m).then((()=>{}))}))}_loadIridescencePropertiesAsync(z,a,K){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);const v=new Array;return K.anisotropy.isEnabled=!0,K.anisotropy.aj=a.anisotropyStrength??0,K.anisotropy.angle=a.anisotropyRotation??0,a.anisotropyTexture&&(a.anisotropyTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${z}/anisotropyTexture`,a.anisotropyTexture,(z=>{z.name=`${K.name} (Anisotropy Intensity)`,K.anisotropy.texture=z})))),Promise.all(v).then((()=>{}))}}R(Jz),U(Jz,!0,(z=>new oz(z)));const Nz="KHR_materials_emissive_strength";class Az{constructor(z){this.name=Nz,this.order=170,this._loader=z,this.enabled=this._loader.isExtensionUsed(Nz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>this._loader.loadMaterialPropertiesAsync(z,a,K).then((()=>{this._loadEmissiveProperties(v,T,K)}))))}_loadEmissiveProperties(z,a,K){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);void 0!==a.emissiveStrength&&(K.emissiveIntensity=a.emissiveStrength)}}R(Nz),U(Nz,!0,(z=>new Az(z)));const gz="KHR_materials_sheen";class dz{constructor(z){this.name=gz,this.order=190,this._loader=z,this.enabled=this._loader.isExtensionUsed(gz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(z,a,K)),m.push(this._loadSheenPropertiesAsync(v,T,K)),Promise.all(m).then((()=>{}))}))}_loadSheenPropertiesAsync(z,a,K){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);const v=new Array;return K.sheen.isEnabled=!0,K.sheen.aj=1,void 0!=a.sheenColorFactor?K.sheen.color=m.c.Jg(a.sheenColorFactor):K.sheen.color=m.c.Black(),a.sheenColorTexture&&v.push(this._loader.loadTextureInfoAsync(`${z}/sheenColorTexture`,a.sheenColorTexture,(z=>{z.name=`${K.name} (Sheen Color)`,K.sheen.texture=z}))),void 0!==a.sheenRoughnessFactor?K.sheen.roughness=a.sheenRoughnessFactor:K.sheen.roughness=0,a.sheenRoughnessTexture&&(a.sheenRoughnessTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${z}/sheenRoughnessTexture`,a.sheenRoughnessTexture,(z=>{z.name=`${K.name} (Sheen Roughness)`,K.sheen.textureRoughness=z})))),K.sheen.albedoScaling=!0,K.sheen.useRoughnessFromMainTexture=!1,Promise.all(v).then((()=>{}))}}R(gz),U(gz,!0,(z=>new dz(z)));const tz="KHR_materials_specular";class ez{constructor(z){this.name=tz,this.order=190,this._loader=z,this.enabled=this._loader.isExtensionUsed(tz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(z,a,K)),m.push(this._loadSpecularPropertiesAsync(v,T,K)),Promise.all(m).then((()=>{}))}))}_loadSpecularPropertiesAsync(z,a,K){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);const v=new Array;return void 0!==a.specularFactor&&(K.metallicF0Factor=a.specularFactor),void 0!==a.specularColorFactor&&(K.metallicReflectanceColor=m.c.Jg(a.specularColorFactor)),a.specularTexture&&(a.specularTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${z}/specularTexture`,a.specularTexture,(z=>{z.name=`${K.name} (Specular)`,K.metallicReflectanceTexture=z,K.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),a.specularColorTexture&&v.push(this._loader.loadTextureInfoAsync(`${z}/specularColorTexture`,a.specularColorTexture,(z=>{z.name=`${K.name} (Specular Color)`,K.reflectanceTexture=z}))),Promise.all(v).then((()=>{}))}}R(tz),U(tz,!0,(z=>new ez(z)));const Lz="KHR_materials_ior";class Ez{constructor(z){this.name=Lz,this.order=180,this._loader=z,this.enabled=this._loader.isExtensionUsed(Lz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(z,a,K)),m.push(this._loadIorPropertiesAsync(v,T,K)),Promise.all(m).then((()=>{}))}))}_loadIorPropertiesAsync(z,a,K){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);return void 0!==a.ior?K.indexOfRefraction=a.ior:K.indexOfRefraction=Ez._DEFAULT_IOR,Promise.resolve()}}Ez._DEFAULT_IOR=1.5,R(Lz),U(Lz,!0,(z=>new Ez(z)));const bz="KHR_materials_variants";class Dz{constructor(z){this.name=bz,this._loader=z,this.enabled=this._loader.isExtensionUsed(bz)}dispose(){this._loader=null}static GetAvailableVariants(z){const a=this._GetExtensionMetadata(z);return a?Object.keys(a.variants):[]}getAvailableVariants(z){return Dz.GetAvailableVariants(z)}static SelectVariant(z,a){const K=this._GetExtensionMetadata(z);if(!K)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${bz} extension`);const v=z=>{const a=K.variants[z];if(a)for(const K of a)K.mesh.material=K.material};if(a instanceof Array)for(const T of a)v(T);else v(a);K.lastSelected=a}selectVariant(z,a){Dz.SelectVariant(z,a)}static Reset(z){const a=this._GetExtensionMetadata(z);if(!a)throw new Error(`Cannot reset on a glTF mesh that does not have the ${bz} extension`);for(const K of a.original)K.mesh.material=K.material;a.lastSelected=null}reset(z){Dz.Reset(z)}static GetLastSelectedVariant(z){const a=this._GetExtensionMetadata(z);if(!a)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${bz} extension`);return a.lastSelected}getLastSelectedVariant(z){return Dz.GetLastSelectedVariant(z)}static _GetExtensionMetadata(z){var a,K;return(null===z||void 0===z||null===(a=z._internalMetadata)||void 0===a||null===(K=a.Qi)||void 0===K?void 0:K[bz])||null}onLoading(){const z=this._loader.Qi.extensions;if(z&&z[this.name]){const a=z[this.name];this._variants=a.variants}}_loadMeshPrimitiveAsync(z,a,K,v,T,m){return S.LoadExtensionAsync(z,T,this.name,((p,j)=>{const s=new Array;return s.push(this._loader._loadMeshPrimitiveAsync(z,a,K,v,T,(a=>{if(m(a),a instanceof P.c){const K=S._GetDrawMode(z,T.mode),v=this._loader.rootBabylonMesh,m=v?v._internalMetadata=v._internalMetadata||{}:{},M=m.Qi=m.Qi||{},r=M[bz]=M[bz]||{lastSelected:null,original:[],variants:{}};r.original.push({mesh:a,material:a.material});for(let z=0;z<j.mappings.length;++z){const T=j.mappings[z],m=h.Get(`${p}/mappings/${z}/material`,this._loader.Qi.materials,T.material);s.push(this._loader._loadMaterialAsync(`#/materials/${T.material}`,m,a,K,(z=>{for(let K=0;K<T.variants.length;++K){const m=T.variants[K],p=h.Get(`/extensions/${bz}/variants/${m}`,this._variants,m);r.variants[p.name]=r.variants[p.name]||[],r.variants[p.name].push({mesh:a,material:z}),a.onClonedObservable.add((z=>{const K=z;let T=null,m=K;do{if(m=m.parent,!m)return;T=Dz._GetExtensionMetadata(m)}while(null===T);if(v&&T===Dz._GetExtensionMetadata(v)){m._internalMetadata={};for(const z in v._internalMetadata)m._internalMetadata[z]=v._internalMetadata[z];m._internalMetadata.Qi=[];for(const z in v._internalMetadata.Qi)m._internalMetadata.Qi[z]=v._internalMetadata.Qi[z];m._internalMetadata.Qi[bz]={lastSelected:null,original:[],variants:{}};for(const z of T.original)m._internalMetadata.Qi[bz].original.push({mesh:z.mesh,material:z.material});for(const z in T.variants)if(Object.prototype.hasOwnProperty.call(T.variants,z)){m._internalMetadata.Qi[bz].variants[z]=[];for(const a of T.variants[z])m._internalMetadata.Qi[bz].variants[z].push({mesh:a.mesh,material:a.material})}T=m._internalMetadata.Qi[bz]}for(const v of T.original)v.mesh===a&&(v.mesh=K);for(const v of T.variants[p.name])v.mesh===a&&(v.mesh=K)}))}})))}}}))),Promise.all(s).then((z=>{let[a]=z;return a}))}))}}R(bz),U(bz,!0,(z=>new Dz(z)));var uz=K(11475);class Uz{}Uz.AUTOSAMPLERSUFFIX="Sampler",Uz.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",Uz.ALPHA_DISABLE=0,Uz.ALPHA_ADD=1,Uz.ALPHA_COMBINE=2,Uz.ALPHA_SUBTRACT=3,Uz.ALPHA_MULTIPLY=4,Uz.ALPHA_MAXIMIZED=5,Uz.ALPHA_ONEONE=6,Uz.ALPHA_PREMULTIPLIED=7,Uz.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Uz.ALPHA_INTERPOLATE=9,Uz.ALPHA_SCREENMODE=10,Uz.ALPHA_ONEONE_ONEONE=11,Uz.ALPHA_ALPHATOCOLOR=12,Uz.ALPHA_REVERSEONEMINUS=13,Uz.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,Uz.ALPHA_ONEONE_ONEZERO=15,Uz.ALPHA_EXCLUSION=16,Uz.ALPHA_LAYER_ACCUMULATE=17,Uz.ALPHA_EQUATION_ADD=0,Uz.ALPHA_EQUATION_SUBSTRACT=1,Uz.ALPHA_EQUATION_REVERSE_SUBTRACT=2,Uz.ALPHA_EQUATION_MAX=3,Uz.ALPHA_EQUATION_MIN=4,Uz.ALPHA_EQUATION_DARKEN=5,Uz.DELAYLOADSTATE_NONE=0,Uz.DELAYLOADSTATE_LOADED=1,Uz.DELAYLOADSTATE_LOADING=2,Uz.DELAYLOADSTATE_NOTLOADED=4,Uz.NEVER=512,Uz.ALWAYS=519,Uz.LESS=513,Uz.EQUAL=514,Uz.LEQUAL=515,Uz.GREATER=516,Uz.GEQUAL=518,Uz.NOTEQUAL=517,Uz.KEEP=7680,Uz.ZERO=0,Uz.REPLACE=7681,Uz.INCR=7682,Uz.DECR=7683,Uz.INVERT=5386,Uz.INCR_WRAP=34055,Uz.DECR_WRAP=34056,Uz.TEXTURE_CLAMP_ADDRESSMODE=0,Uz.TEXTURE_WRAP_ADDRESSMODE=1,Uz.TEXTURE_MIRROR_ADDRESSMODE=2,Uz.TEXTURE_CREATIONFLAG_STORAGE=1,Uz.TEXTUREFORMAT_ALPHA=0,Uz.TEXTUREFORMAT_LUMINANCE=1,Uz.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Uz.TEXTUREFORMAT_RGB=4,Uz.TEXTUREFORMAT_RGBA=5,Uz.TEXTUREFORMAT_RED=6,Uz.TEXTUREFORMAT_R=6,Uz.TEXTUREFORMAT_RG=7,Uz.TEXTUREFORMAT_RED_INTEGER=8,Uz.TEXTUREFORMAT_R_INTEGER=8,Uz.TEXTUREFORMAT_RG_INTEGER=9,Uz.TEXTUREFORMAT_RGB_INTEGER=10,Uz.TEXTUREFORMAT_RGBA_INTEGER=11,Uz.TEXTUREFORMAT_BGRA=12,Uz.TEXTUREFORMAT_DEPTH24_STENCIL8=13,Uz.TEXTUREFORMAT_DEPTH32_FLOAT=14,Uz.TEXTUREFORMAT_DEPTH16=15,Uz.TEXTUREFORMAT_DEPTH24=16,Uz.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,Uz.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,Uz.TEXTUREFORMAT_STENCIL8=19,Uz.TEXTUREFORMAT_UNDEFINED=4294967295,Uz.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,Uz.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,Uz.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,Uz.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,Uz.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,Uz.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,Uz.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,Uz.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,Uz.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,Uz.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,Uz.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,Uz.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,Uz.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,Uz.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,Uz.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,Uz.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,Uz.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,Uz.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,Uz.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,Uz.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,Uz.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,Uz.TEXTURETYPE_UNSIGNED_BYTE=0,Uz.TEXTURETYPE_UNSIGNED_INT=0,Uz.TEXTURETYPE_FLOAT=1,Uz.TEXTURETYPE_HALF_FLOAT=2,Uz.TEXTURETYPE_BYTE=3,Uz.TEXTURETYPE_SHORT=4,Uz.TEXTURETYPE_UNSIGNED_SHORT=5,Uz.TEXTURETYPE_INT=6,Uz.TEXTURETYPE_UNSIGNED_INTEGER=7,Uz.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Uz.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Uz.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Uz.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Uz.TEXTURETYPE_UNSIGNED_INT_24_8=12,Uz.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Uz.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Uz.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Uz.TEXTURETYPE_UNDEFINED=16,Uz.TEXTURE_2D=3553,Uz.TEXTURE_2D_ARRAY=35866,Uz.TEXTURE_CUBE_MAP=34067,Uz.TEXTURE_CUBE_MAP_ARRAY=3735928559,Uz.TEXTURE_3D=32879,Uz.TEXTURE_NEAREST_SAMPLINGMODE=1,Uz.TEXTURE_NEAREST_NEAREST=1,Uz.TEXTURE_BILINEAR_SAMPLINGMODE=2,Uz.TEXTURE_LINEAR_LINEAR=2,Uz.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Uz.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Uz.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Uz.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Uz.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Uz.TEXTURE_NEAREST_LINEAR=7,Uz.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Uz.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Uz.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Uz.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Uz.TEXTURE_LINEAR_NEAREST=12,Uz.TEXTURE_EXPLICIT_MODE=0,Uz.TEXTURE_SPHERICAL_MODE=1,Uz.TEXTURE_PLANAR_MODE=2,Uz.TEXTURE_CUBIC_MODE=3,Uz.TEXTURE_PROJECTION_MODE=4,Uz.TEXTURE_SKYBOX_MODE=5,Uz.TEXTURE_INVCUBIC_MODE=6,Uz.TEXTURE_EQUIRECTANGULAR_MODE=7,Uz.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Uz.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Uz.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,Uz.TEXTURE_FILTERING_QUALITY_HIGH=64,Uz.TEXTURE_FILTERING_QUALITY_MEDIUM=16,Uz.TEXTURE_FILTERING_QUALITY_LOW=8,Uz.SCALEMODE_FLOOR=1,Uz.SCALEMODE_NEAREST=2,Uz.SCALEMODE_CEILING=3,Uz.MATERIAL_TextureDirtyFlag=1,Uz.MATERIAL_LightDirtyFlag=2,Uz.MATERIAL_FresnelDirtyFlag=4,Uz.MATERIAL_AttributesDirtyFlag=8,Uz.MATERIAL_MiscDirtyFlag=16,Uz.MATERIAL_PrePassDirtyFlag=32,Uz.MATERIAL_AllDirtyFlag=63,Uz.MATERIAL_TriangleFillMode=0,Uz.MATERIAL_WireFrameFillMode=1,Uz.MATERIAL_PointFillMode=2,Uz.MATERIAL_PointListDrawMode=3,Uz.MATERIAL_LineListDrawMode=4,Uz.MATERIAL_LineLoopDrawMode=5,Uz.MATERIAL_LineStripDrawMode=6,Uz.MATERIAL_TriangleStripDrawMode=7,Uz.MATERIAL_TriangleFanDrawMode=8,Uz.MATERIAL_ClockWiseSideOrientation=0,Uz.MATERIAL_CounterClockWiseSideOrientation=1,Uz.ACTION_NothingTrigger=0,Uz.ACTION_OnPickTrigger=1,Uz.ACTION_OnLeftPickTrigger=2,Uz.ACTION_OnRightPickTrigger=3,Uz.ACTION_OnCenterPickTrigger=4,Uz.ACTION_OnPickDownTrigger=5,Uz.ACTION_OnDoublePickTrigger=6,Uz.ACTION_OnPickUpTrigger=7,Uz.ACTION_OnPickOutTrigger=16,Uz.ACTION_OnLongPressTrigger=8,Uz.ACTION_OnPointerOverTrigger=9,Uz.ACTION_OnPointerOutTrigger=10,Uz.ACTION_OnEveryFrameTrigger=11,Uz.ACTION_OnIntersectionEnterTrigger=12,Uz.ACTION_OnIntersectionExitTrigger=13,Uz.ACTION_OnKeyDownTrigger=14,Uz.ACTION_OnKeyUpTrigger=15,Uz.PARTICLES_BILLBOARDMODE_Y=2,Uz.PARTICLES_BILLBOARDMODE_ALL=7,Uz.PARTICLES_BILLBOARDMODE_STRETCHED=8,Uz.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,Uz.MESHES_CULLINGSTRATEGY_STANDARD=0,Uz.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,Uz.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,Uz.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,Uz.SCENELOADER_NO_LOGGING=0,Uz.SCENELOADER_MINIMAL_LOGGING=1,Uz.SCENELOADER_SUMMARY_LOGGING=2,Uz.SCENELOADER_DETAILED_LOGGING=3,Uz.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,Uz.PREPASS_POSITION_TEXTURE_TYPE=1,Uz.PREPASS_VELOCITY_TEXTURE_TYPE=2,Uz.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,Uz.PREPASS_COLOR_TEXTURE_TYPE=4,Uz.PREPASS_DEPTH_TEXTURE_TYPE=5,Uz.PREPASS_NORMAL_TEXTURE_TYPE=6,Uz.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,Uz.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,Uz.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,Uz.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,Uz.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,Uz.PREPASS_ALBEDO_TEXTURE_TYPE=12,Uz.BUFFER_CREATIONFLAG_READ=1,Uz.BUFFER_CREATIONFLAG_WRITE=2,Uz.BUFFER_CREATIONFLAG_READWRITE=3,Uz.BUFFER_CREATIONFLAG_UNIFORM=4,Uz.BUFFER_CREATIONFLAG_VERTEX=8,Uz.BUFFER_CREATIONFLAG_INDEX=16,Uz.BUFFER_CREATIONFLAG_STORAGE=32,Uz.BUFFER_CREATIONFLAG_INDIRECT=64,Uz.RENDERPASS_MAIN=0,Uz.INPUT_ALT_KEY=18,Uz.INPUT_CTRL_KEY=17,Uz.INPUT_META_KEY1=91,Uz.INPUT_META_KEY2=92,Uz.INPUT_META_KEY3=93,Uz.INPUT_SHIFT_KEY=16,Uz.SNAPSHOTRENDERING_STANDARD=0,Uz.SNAPSHOTRENDERING_FAST=1,Uz.PERSPECTIVE_CAMERA=0,Uz.ORTHOGRAPHIC_CAMERA=1,Uz.FOVMODE_VERTICAL_FIXED=0,Uz.FOVMODE_HORIZONTAL_FIXED=1,Uz.RIG_MODE_NONE=0,Uz.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,Uz.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,Uz.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,Uz.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,Uz.RIG_MODE_STEREOSCOPIC_INTERLACED=14,Uz.RIG_MODE_VR=20,Uz.RIG_MODE_CUSTOM=22,Uz.MAX_SUPPORTED_UV_SETS=6,Uz.GL_ALPHA_EQUATION_ADD=32774,Uz.GL_ALPHA_EQUATION_MIN=32775,Uz.GL_ALPHA_EQUATION_MAX=32776,Uz.GL_ALPHA_EQUATION_SUBTRACT=32778,Uz.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,Uz.GL_ALPHA_FUNCTION_SRC=768,Uz.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,Uz.GL_ALPHA_FUNCTION_SRC_ALPHA=770,Uz.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,Uz.GL_ALPHA_FUNCTION_DST_ALPHA=772,Uz.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,Uz.GL_ALPHA_FUNCTION_DST_COLOR=774,Uz.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,Uz.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,Uz.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,Uz.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,Uz.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,Uz.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,Uz.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,Uz.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,Uz.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,Uz.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,Uz.SnippetUrl="https://snippet.babylonjs.com",Uz.FOGMODE_NONE=0,Uz.FOGMODE_EXP=1,Uz.FOGMODE_EXP2=2,Uz.FOGMODE_LINEAR=3,Uz.BYTE=5120,Uz.UNSIGNED_BYTE=5121,Uz.SHORT=5122,Uz.UNSIGNED_SHORT=5123,Uz.INT=5124,Uz.UNSIGNED_INT=5125,Uz.FLOAT=5126,Uz.PositionKind="position",Uz.NormalKind="k",Uz.TangentKind="tangent",Uz.UVKind="uv",Uz.UV2Kind="uv2",Uz.UV3Kind="uv3",Uz.UV4Kind="uv4",Uz.UV5Kind="uv5",Uz.UV6Kind="uv6",Uz.ColorKind="color",Uz.ColorInstanceKind="instanceColor",Uz.MatricesIndicesKind="matricesIndices",Uz.MatricesWeightsKind="matricesWeights",Uz.MatricesIndicesExtraKind="matricesIndicesExtra",Uz.MatricesWeightsExtraKind="matricesWeightsExtra";class Rz{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Uz.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(z,a){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Rz._GetDefaultOptions(),...z},this._scene=a,this._scene._transmissionHelper=this,this.onErrorObservable=new r.c,this._scene.lj.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(z){if(!Object.keys(z).filter((a=>this._options[a]!==z[a])).length)return;const a={...this._options,...z},K=this._options;this._options=a,a.renderSize===K.renderSize&&a.renderTargetTextureType===K.renderTargetTextureType&&a.generateMipmaps===K.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=a.samples,this._opaqueRenderTarget.lodGenerationScale=a.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=a.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(z){return!!z&&!!(z instanceof x&&z.subSurface.isRefractionEnabled)}_addMesh(z){this._materialObservers[z.uniqueId]=z.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),p.h.SetImmediate((()=>{this._shouldRenderAsTransmission(z.material)?(z.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(z)&&this._transparentMeshesCache.push(z)):-1===this._opaqueMeshesCache.indexOf(z)&&this._opaqueMeshesCache.push(z)}))}_removeMesh(z){z.onMaterialChangedObservable.remove(this._materialObservers[z.uniqueId]),delete this._materialObservers[z.uniqueId];let a=this._transparentMeshesCache.indexOf(z);-1!==a&&this._transparentMeshesCache.splice(a,1),a=this._opaqueMeshesCache.indexOf(z),-1!==a&&this._opaqueMeshesCache.splice(a,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(z){const a=this._transparentMeshesCache.indexOf(z),K=this._opaqueMeshesCache.indexOf(z);this._shouldRenderAsTransmission(z.material)?(z.material instanceof x&&(z.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==K?(this._opaqueMeshesCache.splice(K,1),this._transparentMeshesCache.push(z)):-1===a&&this._transparentMeshesCache.push(z)):-1!==a?(this._transparentMeshesCache.splice(a,1),this._opaqueMeshesCache.push(z)):-1===K&&this._opaqueMeshesCache.push(z)}_isRenderTargetValid(){var z;return null!==(null===(z=this._opaqueRenderTarget)||void 0===z?void 0:z.getInternalTexture())}_setupRenderTargets(){var z;let a,K;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new uz.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(z=this._options.clearColor)||void 0===z?void 0:z.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((z=>{K=this._scene.environmentIntensity,this._scene.environmentIntensity=1,a=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?z.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(z.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=K,this._scene.imageProcessingConfiguration._applyByPostProcess=a})),this._transparentMeshesCache.forEach((z=>{this._shouldRenderAsTransmission(z.material)&&(z.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const kz="KHR_materials_transmission";class hz{constructor(z){this.name=kz,this.order=175,this._loader=z,this.enabled=this._loader.isExtensionUsed(kz),this.enabled&&(z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(z,a,K)),m.push(this._loadTransparentPropertiesAsync(v,a,K,T)),Promise.all(m).then((()=>{}))}))}_loadTransparentPropertiesAsync(z,a,K,v){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);const T=K;if(T.subSurface.isRefractionEnabled=!0,T.subSurface.volumeIndexOfRefraction=1,T.subSurface.useAlbedoToTintRefraction=!0,void 0===v.transmissionFactor)return T.subSurface.refractionIntensity=0,T.subSurface.isRefractionEnabled=!1,Promise.resolve();{var m;T.subSurface.refractionIntensity=v.transmissionFactor;const z=T.va();if(T.subSurface.refractionIntensity&&!z._transmissionHelper)new Rz({},T.va());else if(T.subSurface.refractionIntensity&&(null===(m=z._transmissionHelper)||void 0===m||!m._isRenderTargetValid())){var p;null===(p=z._transmissionHelper)||void 0===p||p._setupRenderTargets()}}return T.subSurface.minimumThickness=0,T.subSurface.maximumThickness=0,v.transmissionTexture?(v.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${z}/transmissionTexture`,v.transmissionTexture,void 0).then((z=>{z.name=`${K.name} (Transmission)`,T.subSurface.refractionIntensityTexture=z,T.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}R(kz),U(kz,!0,(z=>new hz(z)));const Sz="KHR_materials_diffuse_transmission";class Qz{constructor(z){this.name=Sz,this.order=174,this._loader=z,this.enabled=this._loader.isExtensionUsed(Sz),this.enabled&&(z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(z,a,K)),m.push(this._loadTranslucentPropertiesAsync(v,a,K,T)),Promise.all(m).then((()=>{}))}))}_loadTranslucentPropertiesAsync(z,a,K,v){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);const T=K;if(T.subSurface.isTranslucencyEnabled=!0,T.subSurface.volumeIndexOfRefraction=1,T.subSurface.minimumThickness=0,T.subSurface.maximumThickness=0,T.subSurface.useAlbedoToTintTranslucency=!1,void 0===v.diffuseTransmissionFactor)return T.subSurface.translucencyIntensity=0,T.subSurface.isTranslucencyEnabled=!1,Promise.resolve();T.subSurface.translucencyIntensity=v.diffuseTransmissionFactor;const p=new Array;return T.subSurface.useGltfStyleTextures=!0,v.diffuseTransmissionTexture&&(v.diffuseTransmissionTexture.nonColorData=!0,p.push(this._loader.loadTextureInfoAsync(`${z}/diffuseTransmissionTexture`,v.diffuseTransmissionTexture).then((z=>{z.name=`${K.name} (Diffuse Transmission)`,T.subSurface.translucencyIntensityTexture=z})))),void 0!==v.diffuseTransmissionColorFactor?T.subSurface.translucencyColor=m.c.Jg(v.diffuseTransmissionColorFactor):T.subSurface.translucencyColor=m.c.White(),v.diffuseTransmissionColorTexture&&p.push(this._loader.loadTextureInfoAsync(`${z}/diffuseTransmissionColorTexture`,v.diffuseTransmissionColorTexture).then((z=>{z.name=`${K.name} (Diffuse Transmission Color)`,T.subSurface.translucencyColorTexture=z}))),Promise.all(p).then((()=>{}))}}R(Sz),U(Sz,!0,(z=>new Qz(z)));const Oz="KHR_materials_volume";class za{constructor(z){this.name=Oz,this.order=173,this._loader=z,this.enabled=this._loader.isExtensionUsed(Oz),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(z,a,K)),m.push(this._loadVolumePropertiesAsync(v,a,K,T)),Promise.all(m).then((()=>{}))}))}_loadVolumePropertiesAsync(z,a,K,v){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);if(!K.subSurface.isRefractionEnabled&&!K.subSurface.isTranslucencyEnabled||!v.thicknessFactor)return Promise.resolve();K.subSurface.volumeIndexOfRefraction=K.indexOfRefraction;const T=void 0!==v.attenuationDistance?v.attenuationDistance:Number.MAX_VALUE;return K.subSurface.tintColorAtDistance=T,void 0!==v.attenuationColor&&3==v.attenuationColor.length&&K.subSurface.tintColor.Xd(v.attenuationColor[0],v.attenuationColor[1],v.attenuationColor[2]),K.subSurface.minimumThickness=0,K.subSurface.maximumThickness=v.thicknessFactor,K.subSurface.useThicknessAsDepth=!0,v.thicknessTexture?(v.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${z}/thicknessTexture`,v.thicknessTexture).then((z=>{z.name=`${K.name} (Thickness)`,K.subSurface.thicknessTexture=z,K.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}R(Oz),U(Oz,!0,(z=>new za(z)));const aa="KHR_materials_dispersion";class Ka{constructor(z){this.name=aa,this.order=174,this._loader=z,this.enabled=this._loader.isExtensionUsed(aa)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(z,a,K)),m.push(this._loadDispersionPropertiesAsync(v,a,K,T)),Promise.all(m).then((()=>{}))}))}_loadDispersionPropertiesAsync(z,a,K,v){if(!(K instanceof x))throw new Error(`${z}: Material type not supported`);return K.subSurface.isRefractionEnabled&&v.dispersion?(K.subSurface.isDispersionEnabled=!0,K.subSurface.dispersion=v.dispersion,Promise.resolve()):Promise.resolve()}}R(aa),U(aa,!0,(z=>new Ka(z)));const va="KHR_mesh_quantization";class Ta{constructor(z){this.name=va,this.enabled=z.isExtensionUsed(va)}dispose(){}}R(va),U(va,!0,(z=>new Ta(z)));const ma="KHR_texture_basisu";class pa{constructor(z){this.name=ma,this._loader=z,this.enabled=z.isExtensionUsed(ma)}dispose(){this._loader=null}_loadTextureAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>{const m=void 0==a.sampler?S.DefaultSampler:h.Get(`${z}/sampler`,this._loader.Qi.samplers,a.sampler),p=h.Get(`${v}/source`,this._loader.Qi.images,T.source);return this._loader._createTextureAsync(z,m,p,(z=>{K(z)}),a._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!a._textureInfo.nonColorData)}))}}R(ma),U(ma,!0,(z=>new pa(z)));const ja="KHR_texture_transform";class sa{constructor(z){this.name=ja,this._loader=z,this.enabled=this._loader.isExtensionUsed(ja)}dispose(){this._loader=null}loadTextureInfoAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((v,T)=>this._loader.loadTextureInfoAsync(z,a,(z=>{if(!(z instanceof Z.d))throw new Error(`${v}: Texture type not supported`);T.offset&&(z.uOffset=T.offset[0],z.vOffset=T.offset[1]),z.uRotationCenter=0,z.vRotationCenter=0,T.rotation&&(z.wAng=-T.rotation),T.scale&&(z.uScale=T.scale[0],z.vScale=T.scale[1]),void 0!=T.texCoord&&(z.coordinatesIndex=T.texCoord),K(z)}))))}}R(ja),U(ja,!0,(z=>new sa(z)));const Ma="KHR_xmp_json_ld";class ra{constructor(z){this.name=Ma,this.order=100,this._loader=z,this.enabled=this._loader.isExtensionUsed(Ma)}dispose(){this._loader=null}onLoading(){var z,a,K;if(null===this._loader.rootBabylonMesh)return;const v=null===(z=this._loader.Qi.extensions)||void 0===z?void 0:z.KHR_xmp_json_ld,T=null===(a=this._loader.Qi.asset)||void 0===a||null===(K=a.extensions)||void 0===K?void 0:K.KHR_xmp_json_ld;if(v&&T){const z=+T.packet;v.packets&&z<v.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=v.packets[z])}}}function Wa(z,a,K,v){return m.c.Jg(a,K).scale(v)}function Fa(z,a,K,v){return a[K]*v}function Ga(z,a,K,v){return-a[K]*v}function la(z,a,K,v){return a[K+1]*v}function Va(z,a,K,v){return a[K]*v*2}function ca(z){return{scale:[new wa(F.e.ANIMATIONTYPE_FLOAT,`${z}.uScale`,Fa,(()=>2)),new wa(F.e.ANIMATIONTYPE_FLOAT,`${z}.vScale`,la,(()=>2))],offset:[new wa(F.e.ANIMATIONTYPE_FLOAT,`${z}.uOffset`,Fa,(()=>2)),new wa(F.e.ANIMATIONTYPE_FLOAT,`${z}.vOffset`,la,(()=>2))],rotation:[new wa(F.e.ANIMATIONTYPE_FLOAT,`${z}.wAng`,Ga,(()=>1))]}}R(Ma),U(Ma,!0,(z=>new ra(z)));class Ca extends L{buildAnimations(z,a,K,v,T){T(z._babylonCamera,this._buildAnimation(a,K,v))}}class wa extends L{buildAnimations(z,a,K,v,T){for(const m in z._data)T(z._data[m].babylonMaterial,this._buildAnimation(a,K,v))}}class Ha extends L{buildAnimations(z,a,K,v,T){T(z._babylonLight,this._buildAnimation(a,K,v))}}const fa={__array__:{__target__:!0,...b}},Ya={__array__:{__target__:!0,orthographic:{xmag:[new Ca(F.e.ANIMATIONTYPE_FLOAT,"orthoLeft",Ga,(()=>1)),new Ca(F.e.ANIMATIONTYPE_FLOAT,"orthoRight",la,(()=>1))],ymag:[new Ca(F.e.ANIMATIONTYPE_FLOAT,"orthoBottom",Ga,(()=>1)),new Ca(F.e.ANIMATIONTYPE_FLOAT,"orthoTop",la,(()=>1))],zfar:[new Ca(F.e.ANIMATIONTYPE_FLOAT,"maxZ",Fa,(()=>1))],znear:[new Ca(F.e.ANIMATIONTYPE_FLOAT,"Yi",Fa,(()=>1))]},perspective:{yfov:[new Ca(F.e.ANIMATIONTYPE_FLOAT,"fov",Fa,(()=>1))],zfar:[new Ca(F.e.ANIMATIONTYPE_FLOAT,"maxZ",Fa,(()=>1))],znear:[new Ca(F.e.ANIMATIONTYPE_FLOAT,"Yi",Fa,(()=>1))]}}},Ia={nodes:fa,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new wa(F.e.ANIMATIONTYPE_COLOR3,"albedoColor",Wa,(()=>4)),new wa(F.e.ANIMATIONTYPE_FLOAT,"alpha",(function(z,a,K,v){return a[K+3]*v}),(()=>4))],metallicFactor:[new wa(F.e.ANIMATIONTYPE_FLOAT,"metallic",Fa,(()=>1))],roughnessFactor:[new wa(F.e.ANIMATIONTYPE_FLOAT,"roughness",Fa,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:ca("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:ca("metallicTexture")}}},emissiveFactor:[new wa(F.e.ANIMATIONTYPE_COLOR3,"emissiveColor",Wa,(()=>3))],normalTexture:{scale:[new wa(F.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Fa,(()=>1))],extensions:{KHR_texture_transform:ca("bumpTexture")}},occlusionTexture:{strength:[new wa(F.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Fa,(()=>1))],extensions:{KHR_texture_transform:ca("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:ca("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new wa(F.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Fa,(()=>1))],anisotropyRotation:[new wa(F.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Fa,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:ca("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new wa(F.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Fa,(()=>1))],clearcoatRoughnessFactor:[new wa(F.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Fa,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:ca("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new wa(F.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Fa,(()=>1))],extensions:{KHR_texture_transform:ca("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:ca("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new wa(F.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Fa,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new wa(F.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Fa,(()=>1))]},KHR_materials_ior:{ior:[new wa(F.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Fa,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new wa(F.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Fa,(()=>1))],iridescenceIor:[new wa(F.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Fa,(()=>1))],iridescenceThicknessMinimum:[new wa(F.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Fa,(()=>1))],iridescenceThicknessMaximum:[new wa(F.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Fa,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:ca("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:ca("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new wa(F.e.ANIMATIONTYPE_COLOR3,"sheen.color",Wa,(()=>3))],sheenRoughnessFactor:[new wa(F.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",Fa,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:ca("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:ca("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new wa(F.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Fa,(()=>1))],specularColorFactor:[new wa(F.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Wa,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:ca("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:ca("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new wa(F.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Fa,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:ca("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new wa(F.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Wa,(()=>3))],attenuationDistance:[new wa(F.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Fa,(()=>1))],thicknessFactor:[new wa(F.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Fa,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:ca("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new wa(F.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Fa,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:ca("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new wa(F.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Wa,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:ca("subSurface.translucencyColorTexture")}}}}}},cameras:Ya,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new Ha(F.e.ANIMATIONTYPE_COLOR3,"diffuse",Wa,(()=>3))],aj:[new Ha(F.e.ANIMATIONTYPE_FLOAT,"intensity",Fa,(()=>1))],range:[new Ha(F.e.ANIMATIONTYPE_FLOAT,"range",Fa,(()=>1))],spot:{innerConeAngle:[new Ha(F.e.ANIMATIONTYPE_FLOAT,"innerAngle",Va,(()=>1))],outerConeAngle:[new Ha(F.e.ANIMATIONTYPE_FLOAT,"angle",Va,(()=>1))]}}}}}};class qa{constructor(z,a){this._gltf=z,this._infoTree=a}convert(z){let a,K=this._gltf,v=this._infoTree;if(!z.startsWith("/"))throw new Error("Path must start with a /");const T=z.split("/");T.shift();for(const m of T){if(v.__array__)v=v.__array__;else if(v=v[m],!v)throw new Error(`Path ${z} is invalid`);if(void 0===K)throw new Error(`Path ${z} is invalid`);K=K[m],v.__target__&&(a=K)}return{object:a,info:v}}}const Ba="KHR_animation_pointer";class xa extends qa{constructor(z){super(z,Ia)}}class Za{constructor(z){this.name=Ba,this._loader=z,this._pathToObjectConverter=new xa(this._loader.Qi)}get enabled(){return this._loader.isExtensionUsed(Ba)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(z,a,K,v,T){var m;const p=null===(m=v.target.extensions)||void 0===m?void 0:m.KHR_animation_pointer;if(!p||!this._pathToObjectConverter)return null;"pointer"!==v.target.path&&V.c.Warn(`${z}/target/path: Value (${v.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=v.target.node&&V.c.Warn(`${z}/target/node: Value (${v.target.node}) must not be present when using the ${this.name} extension`);const j=`${z}/extensions/${this.name}`,s=p.pointer;if(!s)throw new Error(`${j}: Pointer is missing`);try{const m=this._pathToObjectConverter.convert(s);return this._loader._loadAnimationChannelFromTargetInfoAsync(z,a,K,v,m,T)}catch(M){return V.c.Warn(`${j}/pointer: Invalid pointer (${s}) skipped`),null}}}R(Ba),U(Ba,!0,(z=>new Za(z)));class ya{constructor(z,a,K){this.frame=z,this.action=a,this.onlyOnce=K,this.isDone=!1}_clone(){return new ya(this.frame,this.action,this.onlyOnce)}}var ia=K(10663),na=K(10715);class Xa{get loop(){return this._loop}set loop(z){z!==this._loop&&(this._loop=z,this.updateOptions({loop:z}))}get currentTime(){var z;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(z=na.b.audioEngine)&&void 0!==z&&z.audioContext&&(this.isPlaying||this.isPaused)){const z=this.isPaused?0:na.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+z}return 0}get spatialSound(){return this._spatialSound}set spatialSound(z){if(z==this._spatialSound)return;const a=this.isPlaying;this.pause(),z?(this._spatialSound=z,this._updateSpatialParameters()):this._disableSpatialSound(),a&&this.play()}constructor(z,a,K){var v;let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new r.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=T.o.Zero(),this._localDirection=new T.o(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=z,K=K||l.b.LastCreatedScene)if(this._scene=K,Xa._SceneComponentInitialization(K),this._readyToPlayCallback=m,this._customAttenuationFunction=(z,a,K,v,T)=>a<K?z*(1-a/K):0,j&&(this.autoplay=j.autoplay||!1,this._loop=j.loop||!1,void 0!==j.volume&&(this._volume=j.volume),this._spatialSound=j.spatialSound??!1,this.maxDistance=j.maxDistance??100,this.useCustomAttenuation=j.useCustomAttenuation??!1,this.rolloffFactor=j.rolloffFactor||1,this.refDistance=j.refDistance||1,this.distanceModel=j.distanceModel||"linear",this._playbackRate=j.playbackRate||1,this._streaming=j.streaming??!1,this._length=j.length,this._offset=j.offset),null!==(v=na.b.audioEngine)&&void 0!==v&&v.canUseWebAudio&&na.b.audioEngine.audioContext){this._soundGain=na.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let z=!0;if(a)try{"string"===typeof a?(this._urlType="String",this._url=a):a instanceof ArrayBuffer?this._urlType="ArrayBuffer":a instanceof HTMLMediaElement?this._urlType="MediaElement":a instanceof MediaStream?this._urlType="MediaStream":a instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(a)&&(this._urlType="Array");let K=[],v=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=na.b.audioEngine.audioContext.createMediaElementSource(a),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=na.b.audioEngine.audioContext.createMediaStreamSource(a),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":a.byteLength>0&&(v=!0,this._soundLoaded(a));break;case"AudioBuffer":this._audioBufferLoaded(a);break;case"String":K.push(a);case"Array":0===K.length&&(K=a);for(let z=0;z<K.length;z++){const a=K[z];if(v=j&&j.skipCodecCheck||-1!==a.indexOf(".mp3",a.length-4)&&na.b.audioEngine.isMP3supported||-1!==a.indexOf(".ogg",a.length-4)&&na.b.audioEngine.isOGGsupported||-1!==a.indexOf(".wav",a.length-4)||-1!==a.indexOf(".m4a",a.length-4)||-1!==a.indexOf(".mp4",a.length-4)||-1!==a.indexOf("blob:"),v){this._streaming?(this._htmlAudioElement=new Audio(a),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,p.h.SetCorsBehavior(a,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(a,(z=>{this._soundLoaded(z)}),void 0,!0,!0,(z=>{z&&V.c.Error("XHR "+z.status+" error on: "+a+"."),V.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:z=!1}z?v||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):V.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(s){V.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),na.b.audioEngine&&!na.b.audioEngine.WarnedWebAudioUnsupported&&(V.c.Error("Web Audio is not supported by your browser."),na.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var z;null!==(z=na.b.audioEngine)&&void 0!==z&&z.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(z){var a;null!==(a=na.b.audioEngine)&&void 0!==a&&a.audioContext&&(this._audioBuffer=z,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(z){var a;null!==(a=na.b.audioEngine)&&void 0!==a&&a.audioContext&&na.b.audioEngine.audioContext.decodeAudioData(z,(z=>{this._audioBufferLoaded(z)}),(z=>{V.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+z)}))}setAudioBuffer(z){var a;null!==(a=na.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&(this._audioBuffer=z,this._isReadyToPlay=!0)}updateOptions(z){z&&(this.loop=z.loop??this.loop,this.maxDistance=z.maxDistance??this.maxDistance,this.useCustomAttenuation=z.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=z.rolloffFactor??this.rolloffFactor,this.refDistance=z.refDistance??this.refDistance,this.distanceModel=z.distanceModel??this.distanceModel,this._playbackRate=z.playbackRate??this._playbackRate,this._length=z.length??void 0,this.spatialSound=z.spatialSound??this._spatialSound,this._setOffset(z.offset??void 0),this.setVolume(z.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var z;null!==(z=na.b.audioEngine)&&void 0!==z&&z.canUseWebAudio&&na.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??na.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var z;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(z=this._soundPanner)||void 0===z||z.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var z;null!==(z=na.b.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(z){var a;null!==(a=na.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(z),this._isOutputConnected=!0)}setDirectionalCone(z,a,K){a<z?V.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=z,this._coneOuterAngle=a,this._coneOuterGain=K,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(z){if(z!=this._coneInnerAngle){var a;if(this._coneOuterAngle<z)return void V.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=z,null!==(a=na.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(z){if(z!=this._coneOuterAngle){var a;if(z<this._coneInnerAngle)return void V.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=z,null!==(a=na.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(z){var a;z.equals(this._position)||(this._position.p(z),null!==(a=na.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(z){var a;this._localDirection=z,null!==(a=na.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const z=this._connectedTransformNode.getWorldMatrix(),a=T.o.TransformNormal(this._localDirection,z);a.normalize(),this._soundPanner.orientationX.value=a.x,this._soundPanner.orientationY.value=a.y,this._soundPanner.orientationZ.value=a.z}updateDistanceFromListener(){var z;if(null!==(z=na.b.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const z=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.sc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,z,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(z){this._customAttenuationFunction=z}play(z,a,K){var v;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(v=na.b.audioEngine)&&void 0!==v&&v.audioContext)try{var T,m;this._clearTimeoutsAndObservers();let v=z?(null===(T=na.b.audioEngine)||void 0===T?void 0:T.audioContext.currentTime)+z:null===(m=na.b.audioEngine)||void 0===m?void 0:m.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=na.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const z=()=>{var K;if(null!==(K=na.b.audioEngine)&&void 0!==K&&K.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=a??0;const K=this._htmlAudioElement.play();void 0!==K&&K.catch((()=>{var a,K;(null===(a=na.b.audioEngine)||void 0===a||a.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(K=na.b.audioEngine)||void 0===K?void 0:K.onAudioUnlockedObservable.addOnce((()=>{z()})))}))}else{var v;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(v=na.b.audioEngine)||void 0===v?void 0:v.onAudioUnlockedObservable.addOnce((()=>{z()}))}};z()}}else{var p;const T=()=>{var T;if(null!==(T=na.b.audioEngine)&&void 0!==T&&T.audioContext){var m;if(K=K||this._length,void 0!==a&&this._setOffset(a),this._soundSource){const z=this._soundSource;z.onended=()=>{z.disconnect()}}if(this._soundSource=null===(m=na.b.audioEngine)||void 0===m?void 0:m.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var p;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==a&&(this._soundSource.loopStart=a),void 0!==K&&(this._soundSource.loopEnd=(0|a)+K),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},v=z?(null===(p=na.b.audioEngine)||void 0===p?void 0:p.audioContext.currentTime)+z:na.b.audioEngine.audioContext.currentTime;const T=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(v,T,this.loop?void 0:K)}}};"suspended"===(null===(p=na.b.audioEngine)||void 0===p?void 0:p.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var z;"suspended"===(null===(z=na.b.audioEngine)||void 0===z?void 0:z.audioContext.state)?(na.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=na.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{T()})))):T()}),500):T()}this._startTime=v,this.isPlaying=!0,this.isPaused=!1}catch(j){V.c.Error("Error while trying to play audio: "+this.name+", "+j.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(z){var a;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var K;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(K=this._streamingSource)||void 0===K||K.disconnect();this.isPlaying=!1}else if(null!==(a=na.b.audioEngine)&&void 0!==a&&a.audioContext&&this._soundSource){const a=z?na.b.audioEngine.audioContext.currentTime+z:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(a)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var z;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var a;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(a=this._streamingSource)||void 0===a||a.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(z=na.b.audioEngine)&&void 0!==z&&z.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=na.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(z,a){var K;null!==(K=na.b.audioEngine)&&void 0!==K&&K.canUseWebAudio&&this._soundGain&&(a&&na.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(na.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,na.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(z,na.b.audioEngine.audioContext.currentTime+a)):this._soundGain.gain.value=z),this._volume=z}setPlaybackRate(z){this._playbackRate=z,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(z){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=z,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=z=>this._onRegisterAfterWorldMatrixUpdate(z),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(z){var a;if(z.getBoundingInfo){const a=z.getBoundingInfo();this.setPosition(a.boundingSphere.centerWorld)}else this.setPosition(z.absolutePosition);null!==(a=na.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const z=()=>{this._isReadyToPlay?(K._audioBuffer=this.getAudioBuffer(),K._isReadyToPlay=!0,K.autoplay&&K.play(0,this._offset,this._length)):setTimeout(z,300)},a={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},K=new Xa(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,a);return this.useCustomAttenuation&&K.setAttenuationFunction(this._customAttenuationFunction),K.setPosition(this._position),K.setPlaybackRate(this._playbackRate),z(),K}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const z={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(z.connectedMeshId=this._connectedTransformNode.id),z.position=this._position.kj(),z.refDistance=this.refDistance,z.distanceModel=this.distanceModel,z.isDirectional=this._isDirectional,z.localDirectionToMesh=this._localDirection.kj(),z.coneInnerAngle=this._coneInnerAngle,z.coneOuterAngle=this._coneOuterAngle,z.coneOuterGain=this._coneOuterGain),z}static Parse(z,a,K,v){const m=z.name;let p;p=z.url?K+z.url:K+m;const j={autoplay:z.autoplay,loop:z.loop,volume:z.volume,spatialSound:z.spatialSound,maxDistance:z.maxDistance,rolloffFactor:z.rolloffFactor,refDistance:z.refDistance,distanceModel:z.distanceModel,playbackRate:z.playbackRate};let s;if(v){const z=()=>{v._isReadyToPlay?(s._audioBuffer=v.getAudioBuffer(),s._isReadyToPlay=!0,s.autoplay&&s.play(0,s._offset,s._length)):setTimeout(z,300)};s=new Xa(m,new ArrayBuffer(0),a,null,j),z()}else s=new Xa(m,p,a,(()=>{a.removePendingData(s)}),j),a.addPendingData(s);if(z.position){const a=T.o.Jg(z.position);s.setPosition(a)}if(z.isDirectional&&(s.setDirectionalCone(z.coneInnerAngle||360,z.coneOuterAngle||360,z.coneOuterGain||0),z.localDirectionToMesh)){const a=T.o.Jg(z.localDirectionToMesh);s.setLocalDirectionToMesh(a)}if(z.connectedMeshId){const K=a.getMeshById(z.connectedMeshId);K&&s.attachToMesh(K)}return z.metadata&&(s.metadata=z.metadata),s}_setOffset(z){this._offset!==z&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=z)}_clearTimeoutsAndObservers(){var z;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(z=na.b.audioEngine)||void 0===z||z.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Xa._SceneComponentInitialization=z=>{throw(0,ia.b)("AudioSceneComponent")},(0,q.e)("BABYLON.Sound",Xa);class Pa{constructor(z,a,K){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],a.length!==K.length)throw new Error("Sounds length does not equal weights length");this.loop=z,this._weights=K;let v=0;for(const m of K)v+=m;const T=v>0?1/v:0;for(let m=0;m<this._weights.length;m++)this._weights[m]*=T;this._sounds=a;for(const m of this._sounds)m.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(z){if(z!==this._coneInnerAngle){if(this._coneOuterAngle<z)return void V.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=z;for(const a of this._sounds)a.directionalConeInnerAngle=z}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(z){if(z!==this._coneOuterAngle){if(z<this._coneInnerAngle)return void V.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=z;for(const a of this._sounds)a.directionalConeOuterAngle=z}}get volume(){return this._volume}set volume(z){if(z!==this._volume)for(const a of this._sounds)a.setVolume(z)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(z){if(!this.isPaused){this.stop();const z=Math.random();let a=0;for(let K=0;K<this._weights.length;K++)if(a+=this._weights[K],z<=a){this._currentIndex=K;break}}const a=this._sounds[this._currentIndex??0];a.isReady()?a.play(0,this.isPaused?void 0:z):a.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Ja{constructor(z){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(z=z||l.b.LastCreatedScene)&&(this._scene=z,this.soundCollection=[],this._options=a,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var z;null!==(z=na.b.audioEngine)&&void 0!==z&&z.canUseWebAudio&&na.b.audioEngine.audioContext&&(this._outputAudioNode=na.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(na.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(na.b.audioEngine&&na.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(z){var a;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(a=na.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._outputAudioNode&&z.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==z.soundTrackId&&(-1===z.soundTrackId?this._scene.mainSoundTrack.removeSound(z):this._scene.soundTracks&&this._scene.soundTracks[z.soundTrackId].removeSound(z)),this.soundCollection.push(z),z.soundTrackId=this.id}removeSound(z){const a=this.soundCollection.indexOf(z);-1!==a&&this.soundCollection.splice(a,1)}setVolume(z){var a;null!==(a=na.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=z)}switchPanningModelToHRTF(){var z;if(null!==(z=na.b.audioEngine)&&void 0!==z&&z.canUseWebAudio)for(let a=0;a<this.soundCollection.length;a++)this.soundCollection[a].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var z;if(null!==(z=na.b.audioEngine)&&void 0!==z&&z.canUseWebAudio)for(let a=0;a<this.soundCollection.length;a++)this.soundCollection[a].switchPanningModelToEqualPower()}connectToAnalyser(z){var a;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=z,null!==(a=na.b.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,na.b.audioEngine.masterGain))}}var oa=K(11019),Na=K(10935),Aa=(K(11502),K(10658));(0,K(11583).g)(oa.b.NAME_AUDIO,((z,a,K,v)=>{let T,m=[];if(K.bk=K.bk||[],void 0!==z.bk&&null!==z.bk)for(let j=0,s=z.bk.length;j<s;j++){var p;const s=z.bk[j];null!==(p=na.b.audioEngine)&&void 0!==p&&p.canUseWebAudio?(s.url||(s.url=s.name),m[s.url]?K.bk.push(Xa.Parse(s,a,v,m[s.url])):(T=Xa.Parse(s,a,v),m[s.url]=T,K.bk.push(T))):K.bk.push(new Xa(s.name,null,a))}m=[]})),Object.defineProperty(Na.c.prototype,"mainSoundTrack",{get:function(){let z=this._getComponent(oa.b.NAME_AUDIO);return z||(z=new ga(this),this.o(z)),this._mainSoundTrack||(this._mainSoundTrack=new Ja(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Na.c.prototype.getSoundByName=function(z){let a;for(a=0;a<this.mainSoundTrack.soundCollection.length;a++)if(this.mainSoundTrack.soundCollection[a].name===z)return this.mainSoundTrack.soundCollection[a];if(this.soundTracks)for(let K=0;K<this.soundTracks.length;K++)for(a=0;a<this.soundTracks[K].soundCollection.length;a++)if(this.soundTracks[K].soundCollection[a].name===z)return this.soundTracks[K].soundCollection[a];return null},Object.defineProperty(Na.c.prototype,"audioEnabled",{get:function(){let z=this._getComponent(oa.b.NAME_AUDIO);return z||(z=new ga(this),this.o(z)),z.audioEnabled},set:function(z){let a=this._getComponent(oa.b.NAME_AUDIO);a||(a=new ga(this),this.o(a)),z?a.enableAudio():a.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Na.c.prototype,"headphone",{get:function(){let z=this._getComponent(oa.b.NAME_AUDIO);return z||(z=new ga(this),this.o(z)),z.headphone},set:function(z){let a=this._getComponent(oa.b.NAME_AUDIO);a||(a=new ga(this),this.o(a)),z?a.switchAudioModeForHeadphones():a.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Na.c.prototype,"audioListenerPositionProvider",{get:function(){let z=this._getComponent(oa.b.NAME_AUDIO);return z||(z=new ga(this),this.o(z)),z.audioListenerPositionProvider},set:function(z){let a=this._getComponent(oa.b.NAME_AUDIO);if(a||(a=new ga(this),this.o(a)),z&&"function"!==typeof z)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");a.audioListenerPositionProvider=z},enumerable:!0,configurable:!0}),Object.defineProperty(Na.c.prototype,"audioListenerRotationProvider",{get:function(){let z=this._getComponent(oa.b.NAME_AUDIO);return z||(z=new ga(this),this.o(z)),z.audioListenerRotationProvider},set:function(z){let a=this._getComponent(oa.b.NAME_AUDIO);if(a||(a=new ga(this),this.o(a)),z&&"function"!==typeof z)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");a.audioListenerRotationProvider=z},enumerable:!0,configurable:!0}),Object.defineProperty(Na.c.prototype,"audioPositioningRefreshRate",{get:function(){let z=this._getComponent(oa.b.NAME_AUDIO);return z||(z=new ga(this),this.o(z)),z.audioPositioningRefreshRate},set:function(z){let a=this._getComponent(oa.b.NAME_AUDIO);a||(a=new ga(this),this.o(a)),a.audioPositioningRefreshRate=z},enumerable:!0,configurable:!0});class ga{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(z){this.name=oa.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new T.o,this._cachedCameraPosition=new T.o,this._lastCheck=0,this._invertMatrixTemp=new T.b,this._cameraDirectionTemp=new T.o,(z=z||l.b.LastCreatedScene)&&(this.Oc=z,z.soundTracks=[],z.bk=[])}register(){this.Oc._afterRenderStage.registerStep(oa.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(z){if(z.bk=[],this.Oc.soundTracks)for(let a=0;a<this.Oc.soundTracks.length;a++){const K=this.Oc.soundTracks[a];for(let a=0;a<K.soundCollection.length;a++)z.bk.push(K.soundCollection[a].serialize())}}addFromContainer(z){z.bk&&z.bk.forEach((z=>{z.play(),z.autoplay=!0,this.Oc.mainSoundTrack.addSound(z)}))}removeFromContainer(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];z.bk&&z.bk.forEach((z=>{z.stop(),z.autoplay=!1,this.Oc.mainSoundTrack.removeSound(z),a&&z.dispose()}))}dispose(){const z=this.Oc;if(z._mainSoundTrack&&z.mainSoundTrack.dispose(),z.soundTracks)for(let a=0;a<z.soundTracks.length;a++)z.soundTracks[a].dispose()}disableAudio(){const z=this.Oc;let a;for(this._audioEnabled=!1,na.b.audioEngine&&na.b.audioEngine.audioContext&&na.b.audioEngine.audioContext.suspend(),a=0;a<z.mainSoundTrack.soundCollection.length;a++)z.mainSoundTrack.soundCollection[a].pause();if(z.soundTracks)for(a=0;a<z.soundTracks.length;a++)for(let K=0;K<z.soundTracks[a].soundCollection.length;K++)z.soundTracks[a].soundCollection[K].pause()}enableAudio(){const z=this.Oc;let a;for(this._audioEnabled=!0,na.b.audioEngine&&na.b.audioEngine.audioContext&&na.b.audioEngine.audioContext.resume(),a=0;a<z.mainSoundTrack.soundCollection.length;a++)z.mainSoundTrack.soundCollection[a].isPaused&&z.mainSoundTrack.soundCollection[a].play();if(z.soundTracks)for(a=0;a<z.soundTracks.length;a++)for(let K=0;K<z.soundTracks[a].soundCollection.length;K++)z.soundTracks[a].soundCollection[K].isPaused&&z.soundTracks[a].soundCollection[K].play()}switchAudioModeForHeadphones(){const z=this.Oc;if(this._headphone=!0,z.mainSoundTrack.switchPanningModelToHRTF(),z.soundTracks)for(let a=0;a<z.soundTracks.length;a++)z.soundTracks[a].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const z=this.Oc;if(this._headphone=!1,z.mainSoundTrack.switchPanningModelToEqualPower(),z.soundTracks)for(let a=0;a<z.soundTracks.length;a++)z.soundTracks[a].switchPanningModelToEqualPower()}_afterRender(){const z=Aa.d.Now;if(this._lastCheck&&z-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=z;const a=this.Oc;if(!this._audioEnabled||!a._mainSoundTrack||!a.soundTracks||0===a._mainSoundTrack.soundCollection.length&&1===a.soundTracks.length)return;const K=na.b.audioEngine;if(K&&K.audioContext){let z,v=a.activeCamera;if(a.activeCameras&&a.activeCameras.length>0&&(v=a.activeCameras[0]),this.audioListenerPositionProvider){const z=this.audioListenerPositionProvider();K.audioContext.listener.setPosition(z.x||0,z.y||0,z.z||0)}else v?this._cachedCameraPosition.equals(v.globalPosition)||(this._cachedCameraPosition.p(v.globalPosition),K.audioContext.listener.setPosition(v.globalPosition.x,v.globalPosition.y,v.globalPosition.z)):K.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const z=this.audioListenerRotationProvider();K.audioContext.listener.setOrientation(z.x||0,z.y||0,z.z||0,0,1,0)}else v?(v.rigCameras&&v.rigCameras.length>0&&(v=v.rigCameras[0]),v.getViewMatrix().invertToRef(this._invertMatrixTemp),T.o.TransformNormalToRef(ga._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),K.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):K.audioContext.listener.setOrientation(0,0,0,0,1,0);for(z=0;z<a.mainSoundTrack.soundCollection.length;z++){const K=a.mainSoundTrack.soundCollection[z];K.useCustomAttenuation&&K.updateDistanceFromListener()}if(a.soundTracks)for(z=0;z<a.soundTracks.length;z++)for(let K=0;K<a.soundTracks[z].soundCollection.length;K++){const v=a.soundTracks[z].soundCollection[K];v.useCustomAttenuation&&v.updateDistanceFromListener()}}}}ga._CameraDirection=new T.o(0,0,-1),Xa._SceneComponentInitialization=z=>{let a=z._getComponent(oa.b.NAME_AUDIO);a||(a=new ga(z),z.o(a))};const da="MSFT_audio_emitter";class ta{constructor(z){this.name=da,this._loader=z,this.enabled=this._loader.isExtensionUsed(da)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const z=this._loader.Qi.extensions;if(z&&z[this.name]){const a=z[this.name];this._clips=a.clips,this._emitters=a.emitters,h.Assign(this._clips),h.Assign(this._emitters)}}loadSceneAsync(z,a){return S.LoadExtensionAsync(z,a,this.name,((K,v)=>{const T=new Array;T.push(this._loader.loadSceneAsync(z,a));for(const z of v.emitters){const a=h.Get(`${K}/emitters`,this._emitters,z);if(void 0!=a.refDistance||void 0!=a.maxDistance||void 0!=a.rolloffFactor||void 0!=a.distanceModel||void 0!=a.innerAngle||void 0!=a.outerAngle)throw new Error(`${K}: Direction or Distance properties are not allowed on emitters attached to a scene`);T.push(this._loadEmitterAsync(`${K}/emitters/${a.index}`,a))}return Promise.all(T).then((()=>{}))}))}loadNodeAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((z,v)=>{const m=new Array;return this._loader.loadNodeAsync(z,a,(a=>{for(const K of v.emitters){const v=h.Get(`${z}/emitters`,this._emitters,K);m.push(this._loadEmitterAsync(`${z}/emitters/${v.index}`,v).then((()=>{for(const z of v._babylonSounds)z.attachToMesh(a),void 0==v.innerAngle&&void 0==v.outerAngle||(z.setLocalDirectionToMesh(T.o.Forward()),z.setDirectionalCone(2*p.h.ToDegrees(void 0==v.innerAngle?Math.PI:v.innerAngle),2*p.h.ToDegrees(void 0==v.outerAngle?Math.PI:v.outerAngle),0))})))}K(a)})).then((z=>Promise.all(m).then((()=>z))))}))}loadAnimationAsync(z,a){return S.LoadExtensionAsync(z,a,this.name,((K,v)=>this._loader.loadAnimationAsync(z,a).then((T=>{const m=new Array;h.Assign(v.events);for(const p of v.events)m.push(this._loadAnimationEventAsync(`${K}/events/${p.index}`,z,a,p,T));return Promise.all(m).then((()=>T))}))))}_loadClipAsync(z,a){if(a._objectURL)return a._objectURL;let K;if(a.uri)K=this._loader.loadUriAsync(z,a,a.uri);else{const v=h.Get(`${z}/bufferView`,this._loader.Qi.bufferViews,a.bufferView);K=this._loader.loadBufferViewAsync(`/bufferViews/${v.index}`,v)}return a._objectURL=K.then((z=>URL.createObjectURL(new Blob([z],{type:a.mimeType})))),a._objectURL}_loadEmitterAsync(z,a){if(a._babylonSounds=a._babylonSounds||[],!a._babylonData){const z=new Array,K=a.name||`emitter${a.index}`,v={loop:!1,autoplay:!1,volume:void 0==a.volume?1:a.volume};for(let m=0;m<a.clips.length;m++){const T=`/extensions/${this.name}/clips`,p=h.Get(T,this._clips,a.clips[m].clip);z.push(this._loadClipAsync(`${T}/${a.clips[m].clip}`,p).then((z=>{const T=a._babylonSounds[m]=new Xa(K,z,this._loader.babylonScene,null,v);T.refDistance=a.refDistance||1,T.maxDistance=a.maxDistance||256,T.rolloffFactor=a.rolloffFactor||1,T.distanceModel=a.distanceModel||"exponential"})))}const T=Promise.all(z).then((()=>{const z=a.clips.map((z=>z.weight||1)),K=new Pa(a.loop||!1,a._babylonSounds,z);a.innerAngle&&(K.directionalConeInnerAngle=2*p.h.ToDegrees(a.innerAngle)),a.outerAngle&&(K.directionalConeOuterAngle=2*p.h.ToDegrees(a.outerAngle)),a.volume&&(K.volume=a.volume),a._babylonData.sound=K}));a._babylonData={loaded:T}}return a._babylonData.loaded}_getEventAction(z,a,K,v,T){switch(K){case"play":return z=>{const K=(T||0)+(z-v);a.play(K)};case"stop":return()=>{a.stop()};case"pause":return()=>{a.pause()};default:throw new Error(`${z}: Unsupported action ${K}`)}}_loadAnimationEventAsync(z,a,K,v,T){if(0==T.targetedAnimations.length)return Promise.resolve();const m=T.targetedAnimations[0],p=v.j,j=h.Get(`/extensions/${this.name}/emitters`,this._emitters,p);return this._loadEmitterAsync(z,j).then((()=>{const a=j._babylonData.sound;if(a){const K=new ya(v.time,this._getEventAction(z,a,v.action,v.time,v.startOffset));m.animation.addEvent(K),T.onAnimationGroupEndObservable.add((()=>{a.stop()})),T.onAnimationGroupPauseObservable.add((()=>{a.pause()}))}}))}}R(da),U(da,!0,(z=>new ta(z)));const ea="MSFT_lod";class La{constructor(z){var a;this.name=ea,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new r.c,this.onMaterialLODsLoadedObservable=new r.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=z,this.maxLODsToLoad=(null===(a=this._loader.parent.extensionOptions[ea])||void 0===a?void 0:a.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(ea)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let z=0;z<this._nodePromiseLODs.length;z++){const a=Promise.all(this._nodePromiseLODs[z]).then((()=>{0!==z&&(this._loader.endPerformanceCounter(`Node LOD ${z}`),this._loader.log(`Loaded node LOD ${z}`)),this.onNodeLODsLoadedObservable.notifyObservers(z),z!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${z+1}`),this._loadBufferLOD(this._nodeBufferLODs,z+1),this._nodeSignalLODs[z]&&this._nodeSignalLODs[z].resolve())}));this._loader._completePromises.push(a)}for(let z=0;z<this._materialPromiseLODs.length;z++){const a=Promise.all(this._materialPromiseLODs[z]).then((()=>{0!==z&&(this._loader.endPerformanceCounter(`Material LOD ${z}`),this._loader.log(`Loaded material LOD ${z}`)),this.onMaterialLODsLoadedObservable.notifyObservers(z),z!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${z+1}`),this._loadBufferLOD(this._materialBufferLODs,z+1),this._materialSignalLODs[z]&&this._materialSignalLODs[z].resolve())}));this._loader._completePromises.push(a)}}loadSceneAsync(z,a){const K=this._loader.loadSceneAsync(z,a);return this._loadBufferLOD(this._bufferLODs,0),K}loadNodeAsync(z,a,K){return S.LoadExtensionAsync(z,a,this.name,((z,T)=>{let m;const p=this._getLODs(z,a,this._loader.Qi.nodes,T.ids);this._loader.logOpen(`${z}`);for(let a=0;a<p.length;a++){const z=p[a];0!==a&&(this._nodeIndexLOD=a,this._nodeSignalLODs[a]=this._nodeSignalLODs[a]||new v);const T=z=>{K(z),z.Nb(!1)},j=this._loader.loadNodeAsync(`/nodes/${z.index}`,z,T).then((z=>{if(0!==a){const z=p[a-1];z._babylonTransformNode&&(this._disposeTransformNode(z._babylonTransformNode),delete z._babylonTransformNode)}return z.Nb(!0),z}));this._nodePromiseLODs[a]=this._nodePromiseLODs[a]||[],0===a?m=j:(this._nodeIndexLOD=null,this._nodePromiseLODs[a].push(j))}return this._loader.logClose(),m}))}_loadMaterialAsync(z,a,K,v,T){return this._nodeIndexLOD?null:S.LoadExtensionAsync(z,a,this.name,((z,m)=>{let p;const j=this._getLODs(z,a,this._loader.Qi.materials,m.ids);this._loader.logOpen(`${z}`);for(let a=0;a<j.length;a++){const z=j[a];0!==a&&(this._materialIndexLOD=a);const m=this._loader._loadMaterialAsync(`/materials/${z.index}`,z,K,v,(z=>{0===a&&T(z)})).then((z=>{if(0!==a){T(z);const K=j[a-1]._data;K[v]&&(this._disposeMaterials([K[v].babylonMaterial]),delete K[v])}return z}));this._materialPromiseLODs[a]=this._materialPromiseLODs[a]||[],0===a?p=m:(this._materialIndexLOD=null,this._materialPromiseLODs[a].push(m))}return this._loader.logClose(),p}))}_loadUriAsync(z,a,K){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const T=this._nodeIndexLOD-1;return this._nodeSignalLODs[T]=this._nodeSignalLODs[T]||new v,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(z,a,K)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const T=this._materialIndexLOD-1;return this._materialSignalLODs[T]=this._materialSignalLODs[T]||new v,this._materialSignalLODs[T].promise.then((()=>this._loader.loadUriAsync(z,a,K)))}return null}loadBufferAsync(z,a,K,T){if(this._loader.parent.useRangeRequests&&!a.uri){if(!this._loader.bin)throw new Error(`${z}: Uri is missing or the binary glTF is missing its binary chunk`);const a=(z,a)=>{const m=K,p=m+T-1;let j=z[a];return j?(j.start=Math.min(j.start,m),j.end=Math.max(j.end,p)):(j={start:m,end:p,loaded:new v},z[a]=j),j.loaded.promise.then((z=>new Uint8Array(z.buffer,z.byteOffset+K-j.start,T)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?a(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?a(this._materialBufferLODs,this._materialIndexLOD):a(this._bufferLODs,0)}return null}_loadBufferLOD(z,a){const K=z[a];K&&(this._loader.log(`Loading buffer range [${K.start}-${K.end}]`),this._loader.bin.readAsync(K.start,K.end-K.start+1).then((z=>{K.loaded.resolve(z)}),(z=>{K.loaded.reject(z)})))}_getLODs(z,a,K,v){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const T=[];for(let m=v.length-1;m>=0;m--)if(T.push(h.Get(`${z}/ids/${v[m]}`,K,v[m])),T.length===this.maxLODsToLoad)return T;return T.push(a),T}_disposeTransformNode(z){const a=[],K=z.material;K&&a.push(K);for(const T of z.getChildMeshes())T.material&&a.push(T.material);z.dispose();const v=a.filter((z=>this._loader.babylonScene.meshes.every((a=>a.material!=z))));this._disposeMaterials(v)}_disposeMaterials(z){const a={};for(const K of z){for(const z of K.getActiveTextures())a[z.uniqueId]=z;K.dispose()}for(const K in a)for(const z of this._loader.babylonScene.materials)z.hasTexture(a[K])&&delete a[K];for(const K in a)a[K].dispose()}}R(ea),U(ea,!0,(z=>new La(z)));const Ea="MSFT_minecraftMesh";class ba{constructor(z){this.name=Ea,this._loader=z,this.enabled=this._loader.isExtensionUsed(Ea)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtraAsync(z,a,this.name,((v,T)=>{if(T){if(!(K instanceof x))throw new Error(`${v}: Material type not supported`);const T=this._loader.loadMaterialPropertiesAsync(z,a,K);return K.needAlphaBlending()&&(K.forceDepthWrite=!0,K.separateCullingPass=!0),K.Rg=K.forceDepthWrite,K.twoSidedLighting=!0,T}return null}))}}R(Ea),U(Ea,!0,(z=>new ba(z)));const Da="MSFT_sRGBFactors";class ua{constructor(z){this.name=Da,this._loader=z,this.enabled=this._loader.isExtensionUsed(Da)}dispose(){this._loader=null}loadMaterialPropertiesAsync(z,a,K){return S.LoadExtraAsync(z,a,this.name,((v,T)=>{if(T){if(!(K instanceof x))throw new Error(`${v}: Material type not supported`);const T=this._loader.loadMaterialPropertiesAsync(z,a,K),m=K.va().getEngine().useExactSrgbConversions;return K.albedoTexture||K.albedoColor.toLinearSpaceToRef(K.albedoColor,m),K.reflectivityTexture||K.reflectivityColor.toLinearSpaceToRef(K.reflectivityColor,m),T}return null}))}}R(Da),U(Da,!0,(z=>new ua(z)));var Ua,Ra=K(10776);!function(z){z[z.Input=0]="Input",z[z.Output=1]="Output"}(Ua||(Ua={}));class ka{constructor(z,a,K){this._ownerBlock=K,this._connectedPoint=[],this.uniqueId=(0,Ra.c)(),this.connectedPointIds=[],this.name=z,this._connectionType=a}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(z){if(this._connectionType===z._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||z._isSingularConnection()&&z._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(z),z._connectedPoint.push(this)}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};z.uniqueId=this.uniqueId,z.name=this.name,z._connectionType=this._connectionType,z.connectedPointIds=[],z.className=this.getClassName();for(const a of this._connectedPoint)z.connectedPointIds.push(a.uniqueId)}getClassName(){return"FGConnection"}deserialize(z){this.uniqueId=z.uniqueId,this.name=z.name,this._connectionType=z._connectionType,this.connectedPointIds=z.connectedPointIds}static Parse(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;const K=new(p.h.Instantiate(z.className))(z.name,z._connectionType,a);return K.deserialize(z),K}}class ha{constructor(z){this.value=this._toInt(z)}_toInt(z){return 0|z}add(z){return new ha(this.value+z.value)}sc(z){return new ha(this.value-z.value)}multiply(z){return new ha(Math.imul(this.value,z.value))}divide(z){return new ha(this.value/z.value)}getClassName(){return ha.ClassName}equals(z){return this.value===z.value}static Parse(z){return new ha(z.value)}}ha.ClassName="FlowGraphInteger",(0,q.e)("FlowGraphInteger",ha);class Sa{constructor(z,a){this.typeName=z,this.defaultValue=a}serialize(z){z.typeName=this.typeName,z.defaultValue=this.defaultValue}static Parse(z){return new Sa(z.typeName,z.defaultValue)}}const Qa=new Sa("any",void 0),Oa=(new Sa("string",""),new Sa("number",0)),zK=new Sa("boolean",!1),aK=new Sa("Vector2",T.m.Zero()),KK=new Sa("gb",T.o.Zero()),vK=(new Sa("Vector4",T.r.Zero()),new Sa("Matrix",T.b.Identity())),TK=(new Sa("ib",m.c.Black()),new Sa("tb",new m.d(0,0,0,0)),new Sa("Quaternion",T.f.Identity()),new Sa("FlowGraphInteger",new ha(0)));class mK extends ka{constructor(z,a,K,v){super(z,a,K),this.richType=v}_isSingularConnection(){return 0===this.connectionType}setValue(z,a){a._setConnectionValue(this,z)}connectTo(z){super.connectTo(z)}_getValueOrDefault(z){return z._hasConnectionValue(this)?z._getConnectionValue(this):this.richType.defaultValue}getValue(z){return 1===this.connectionType?(z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(z),this._getValueOrDefault(z)):this.isConnected()?this._connectedPoint[0].getValue(z):this._getValueOrDefault(z)}getClassName(){return"FGDataConnection"}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(z),z.richType={},this.richType.serialize(z.richType)}static Parse(z,a){const K=ka.Parse(z,a);return K.richType=Sa.Parse(z.richType),K}}function pK(z){return"Mesh"===z||"AbstractMesh"===z||"GroundMesh"===z||"InstanceMesh"===z||"LinesMesh"===z||"GoldbergMesh"===z||"GreasedLineMesh"===z||"TrailMesh"===z}function jK(z){return"Vector2"===z||"gb"===z||"Vector4"===z||"Quaternion"===z||"ib"===z||"tb"===z}function sK(z,a,K){var v;const T=(null===a||void 0===a||null===(v=a.getClassName)||void 0===v?void 0:v.call(a))??"";pK(T)?K[z]={name:a.name,className:T}:jK(T)?K[z]={value:a.kj(),className:T}:K[z]=a}function MK(z,a,K){const v=a[z];let p;const j=null===v||void 0===v?void 0:v.className;return p=pK(j)?K.getMeshByName(v.name):jK(j)?function(z,a){if("Vector2"===z)return T.m.Jg(a);if("gb"===z)return T.o.Jg(a);if("Vector4"===z)return T.r.Jg(a);if("Quaternion"===z)return T.f.Jg(a);if("ib"===z)return new m.c(a[0],a[1],a[2]);if("tb"===z)return new m.d(a[0],a[1],a[2],a[3]);throw new Error(`Unknown vector class name ${z}`)}(j,v.value):"Matrix"===j?T.b.Jg(v.value):j===ha.ClassName?ha.Parse(v):v&&void 0!==v.value?v.value:v,p}(0,q.e)("FGDataConnection",mK);class rK{constructor(z){var a;this.config=z,this.uniqueId=(0,Ra.c)(),this.name=(null===(a=this.config)||void 0===a?void 0:a.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(z){}registerDataInput(z,a){const K=new mK(z,0,this,a);return this.dataInputs.push(K),K}registerDataOutput(z,a){const K=new mK(z,1,this,a);return this.dataOutputs.push(K),K}getDataInput(z){return this.dataInputs.find((a=>a.name===z))}getDataOutput(z){return this.dataOutputs.find((a=>a.name===z))}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};z.uniqueId=this.uniqueId,z.config={},this.config&&(z.config.name=this.config.name),z.dataInputs=[],z.dataOutputs=[],z.className=this.getClassName();for(const a of this.dataInputs){const K={};a.serialize(K),z.dataInputs.push(K)}for(const a of this.dataOutputs){const K={};a.serialize(K),z.dataOutputs.push(K)}}getClassName(){return"FGBlock"}static Parse(z,a){const K=p.h.Instantiate(z.className),v={},T=a.valueParseFunction??MK;if(z.config)for(const p in z.config)v[p]=T(p,z.config,a.Oc);var m;("FGSetPropertyBlock"===(m=z.className)||"FGGetPropertyBlock"===m||"FGPlayAnimationBlock"===m||"FGMeshPickEventBlock"===m)&&(v.pathConverter=a.pathConverter);const j=new K(v);j.uniqueId=z.uniqueId;for(let p=0;p<z.dataInputs.length;p++){const a=j.getDataInput(z.dataInputs[p].name);if(!a)throw new Error("Could not find data input with name "+z.dataInputs[p].name+" in block "+z.className);a.deserialize(z.dataInputs[p])}for(let p=0;p<z.dataOutputs.length;p++){const a=j.getDataOutput(z.dataOutputs[p].name);if(!a)throw new Error("Could not find data output with name "+z.dataOutputs[p].name+" in block "+z.className);a.deserialize(z.dataOutputs[p])}return j.metadata=z.metadata,j.deserialize&&j.deserialize(z),j}}class WK extends ka{_isSingularConnection(){return 1===this.connectionType}_activateSignal(z){var a;0===this.connectionType?(z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(z,this),z._increaseExecutionId()):null===(a=this._connectedPoint[0])||void 0===a||a._activateSignal(z)}}(0,q.e)("FlowGraphSignalConnection",WK);class FK extends rK{constructor(z){super(z),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(z){const a=new WK(z,0,this);return this.signalInputs.push(a),a}_registerSignalOutput(z){const a=new WK(z,1,this);return this.signalOutputs.push(a),a}getSignalInput(z){return this.signalInputs.find((a=>a.name===z))}getSignalOutput(z){return this.signalOutputs.find((a=>a.name===z))}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(z),z.signalInputs=[],z.signalOutputs=[];for(const a of this.signalInputs){const K={};a.serialize(K),z.signalInputs.push(K)}for(const a of this.signalOutputs){const K={};a.serialize(K),z.signalOutputs.push(K)}}deserialize(z){for(let a=0;a<z.signalInputs.length;a++){const K=this.getSignalInput(z.signalInputs[a].name);if(!K)throw new Error("Could not find signal input with name "+z.signalInputs[a].name+" in block "+z.className);K.deserialize(z.signalInputs[a])}for(let a=0;a<z.signalOutputs.length;a++){const K=this.getSignalOutput(z.signalOutputs[a].name);if(!K)throw new Error("Could not find signal output with name "+z.signalOutputs[a].name+" in block "+z.className);K.deserialize(z.signalOutputs[a])}}getClassName(){return"FGExecutionBlock"}}class GK extends FK{constructor(z){super(z),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(z){this._preparePendingTasks(z),z._addPendingBlock(this)}}class lK extends GK{_execute(z){z._notifyExecuteNode(this),this.out._activateSignal(z)}}class VK{constructor(z){this.uniqueId=(0,Ra.c)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new r.c,this._configuration=z}hasVariable(z){return z in this._userVariables}setVariable(z,a){this._userVariables[z]=a}getVariable(z){return this._userVariables[z]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(z,a){return`${z.uniqueId}_${a}`}_setExecutionVariable(z,a,K){this._executionVariables[this._getUniqueIdPrefixedName(z,a)]=K}_getExecutionVariable(z,a,K){return this._hasExecutionVariable(z,a)?this._executionVariables[this._getUniqueIdPrefixedName(z,a)]:K}_deleteExecutionVariable(z,a){delete this._executionVariables[this._getUniqueIdPrefixedName(z,a)]}_hasExecutionVariable(z,a){return this._getUniqueIdPrefixedName(z,a)in this._executionVariables}_hasConnectionValue(z){return z.uniqueId in this._connectionValues}_setConnectionValue(z,a){this._connectionValues[z.uniqueId]=a}_getConnectionValue(z){return this._connectionValues[z.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(z){this._pendingBlocks.push(z)}_removePendingBlock(z){const a=this._pendingBlocks.indexOf(z);-1!==a&&this._pendingBlocks.splice(a,1)}_clearPendingBlocks(){for(const z of this._pendingBlocks)z._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(z){this.onNodeExecutedObservable.notifyObservers(z)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sK;z.uniqueId=this.uniqueId,z._userVariables={};for(const K in this._userVariables)a(K,this._userVariables[K],z._userVariables);z._connectionValues={};for(const K in this._connectionValues)a(K,this._connectionValues[K],z._connectionValues)}getClassName(){return"FGContext"}static Parse(z,a){const K=a.graph.createContext(),v=a.valueParseFunction??MK;K.uniqueId=z.uniqueId;for(const T in z._userVariables){const a=v(T,z._userVariables,K._configuration.Oc);K._userVariables[T]=a}for(const T in z._connectionValues){const a=v(T,z._connectionValues,K._configuration.Oc);K._connectionValues[T]=a}return K}}(0,H.e)([(0,f.D)()],VK.prototype,"uniqueId",void 0);var cK,CK,wK=K(11022);function HK(z,a){return!(!z.parent||z.parent!==a&&!HK(z.parent,a))}class fK extends lK{constructor(z){super(z),this.config=z}_getReferencedMesh(){const z=this.config.pathConverter.convert(this.config.path),a=z.info.getObject(z.object);if(!a||!(a instanceof X.e))throw new Error("Mesh pick event block requires a valid mesh");return a}_preparePendingTasks(z){let a=z._getExecutionVariable(this,"meshPickObserver");if(!a){const K=this._getReferencedMesh();z._setExecutionVariable(this,"mesh",K),a=K.va().onPointerObservable.add((a=>{var v,T,m;a.type===wK.e.POINTERPICK&&null!==(v=a.pickInfo)&&void 0!==v&&v.pickedMesh&&((null===(T=a.pickInfo)||void 0===T?void 0:T.pickedMesh)===K||HK(null===(m=a.pickInfo)||void 0===m?void 0:m.pickedMesh,K))&&this._execute(z)}));const v=K.lj.add((()=>this._onDispose));z._setExecutionVariable(this,"meshPickObserver",a),z._setExecutionVariable(this,"meshDisposeObserver",v)}}_onDispose(z){this._cancelPendingTasks(z),z._removePendingBlock(this)}_cancelPendingTasks(z){const a=z._getExecutionVariable(this,"mesh"),K=z._getExecutionVariable(this,"meshPickObserver"),v=z._getExecutionVariable(this,"meshDisposeObserver");a.va().onPointerObservable.remove(K),a.lj.remove(v),z._deleteExecutionVariable(this,"mesh"),z._deleteExecutionVariable(this,"meshPickObserver"),z._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return fK.ClassName}serialize(z){super.serialize(z),z.config.path=this.config.path}}fK.ClassName="FGMeshPickEventBlock",(0,q.e)(fK.ClassName,fK),function(z){z[z.Stopped=0]="Stopped",z[z.Started=1]="Started"}(cK||(cK={}));class YK{constructor(z){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=z.Oc,this._coordinator=z.coordinator,this._sceneDisposeObserver=this._scene.lj.add((()=>this.dispose()))}createContext(){const z=new VK({Oc:this._scene,coordinator:this._coordinator});return this._executionContexts.push(z),z}getContext(z){return this._executionContexts[z]}addEventBlock(z){this._eventBlocks.push(z)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const z of this._executionContexts){const a=this._getContextualOrder();for(const K of a)K._startPendingTasks(z)}}}_getContextualOrder(){const z=[];for(const a of this._eventBlocks)if(a.getClassName()===fK.ClassName){const K=a._getReferencedMesh();let v=0;for(;v<z.length;v++){const a=z[v]._getReferencedMesh();if(K&&a&&HK(K,a))break}z.splice(v,0,a)}else z.push(a);return z}dispose(){if(0!==this.state){this.state=0;for(const z of this._executionContexts)z._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.lj.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(z){const a=[],K=new Set;for(const v of this._eventBlocks)a.push(v),K.add(v.uniqueId);for(;a.length>0;){const v=a.pop();z(v);for(const z of v.dataInputs)for(const v of z._connectedPoint)K.has(v._ownerBlock.uniqueId)||(a.push(v._ownerBlock),K.add(v._ownerBlock.uniqueId));if(v instanceof FK)for(const z of v.signalOutputs)for(const v of z._connectedPoint)K.has(v._ownerBlock.uniqueId)||(a.push(v._ownerBlock),K.add(v._ownerBlock.uniqueId))}}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;z.allBlocks=[],this.visitAllBlocks((a=>{const K={};a.serialize(K),z.allBlocks.push(K)})),z.executionContexts=[];for(const K of this._executionContexts){const v={};K.serialize(v,a),z.executionContexts.push(v)}}static GetDataOutConnectionByUniqueId(z,a){for(const K of z)for(const z of K.dataOutputs)if(z.uniqueId===a)return z;throw new Error("Could not find data out connection with unique id "+a)}static GetSignalInConnectionByUniqueId(z,a){for(const K of z)if(K instanceof FK)for(const z of K.signalInputs)if(z.uniqueId===a)return z;throw new Error("Could not find signal in connection with unique id "+a)}static Parse(z,a){const K=a.coordinator.createGraph(),v=[],T=a.valueParseFunction??MK;for(const m of z.allBlocks){const z=rK.Parse(m,{Oc:a.coordinator.config.Oc,pathConverter:a.pathConverter,valueParseFunction:T});v.push(z),z instanceof lK&&K.addEventBlock(z)}for(const m of v){for(const z of m.dataInputs)for(const a of z.connectedPointIds){const K=YK.GetDataOutConnectionByUniqueId(v,a);z.connectTo(K)}if(m instanceof FK)for(const z of m.signalOutputs)for(const a of z.connectedPointIds){const K=YK.GetSignalInConnectionByUniqueId(v,a);z.connectTo(K)}}for(const m of z.executionContexts)VK.Parse(m,{graph:K,valueParseFunction:T});return K}}class IK{constructor(z){this.config=z,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Oc.lj.add((()=>{this.dispose()}));(IK.SceneCoordinators.get(this.config.Oc)??[]).push(this)}createGraph(){const z=new YK({Oc:this.config.Oc,coordinator:this});return this._flowGraphs.push(z),z}removeGraph(z){const a=this._flowGraphs.indexOf(z);-1!==a&&(z.dispose(),this._flowGraphs.splice(a,1))}start(){this._flowGraphs.forEach((z=>z.start()))}dispose(){this._flowGraphs.forEach((z=>z.dispose())),this._flowGraphs.length=0;const z=IK.SceneCoordinators.get(this.config.Oc)??[],a=z.indexOf(this);-1!==a&&z.splice(a,1)}serialize(z,a){z._flowGraphs=[],this._flowGraphs.forEach((K=>{const v={};K.serialize(v,a),z._flowGraphs.push(v)}))}static Parse(z,a){var K;const v=a.valueParseFunction??MK,T=new IK({Oc:a.Oc});return null===(K=z._flowGraphs)||void 0===K||K.forEach((z=>{YK.Parse(z,{coordinator:T,valueParseFunction:v,pathConverter:a.pathConverter})})),T}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(z){let a=this._customEventsMap.get(z);return a||(a=new r.c,this._customEventsMap.set(z,a)),a}notifyCustomEvent(z,a){const K=this._customEventsMap.get(z);K&&K.notifyObservers(a)}}IK.SceneCoordinators=new Map;class qK extends lK{_preparePendingTasks(z){if(!z._getExecutionVariable(this,"sceneReadyObserver")){const a=z.configuration.Oc.onReadyObservable.add((()=>{this._execute(z)}));z._setExecutionVariable(this,"sceneReadyObserver",a)}}_cancelPendingTasks(z){const a=z._getExecutionVariable(this,"sceneReadyObserver");z.configuration.Oc.onReadyObservable.remove(a),z._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return qK.ClassName}}qK.ClassName="FGSceneReadyEventBlock",(0,q.e)("FGSceneReadyEventBlock",qK);class BK extends lK{_preparePendingTasks(z){if(!z._getExecutionVariable(this,"sceneBeforeRender")){const a=z.configuration.Oc.onBeforeRenderObservable.add((()=>{this._execute(z)}));z._setExecutionVariable(this,"sceneBeforeRender",a)}}_cancelPendingTasks(z){const a=z._getExecutionVariable(this,"sceneBeforeRender");z.configuration.Oc.onBeforeRenderObservable.remove(a),z._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return BK.ClassName}}BK.ClassName="FGSceneTickEventBlock",(0,q.e)(BK.ClassName,BK);class xK extends FK{constructor(z){super(z),this.out=this._registerSignalOutput("out")}}class ZK extends xK{constructor(z){super(z),this.message=this.registerDataInput("message",Qa)}_execute(z){const a=this.message.getValue(z);V.c.Log(a),this.out._activateSignal(z)}getClassName(){return ZK.ClassName}}ZK.ClassName="FGConsoleLogBlock",(0,q.e)(ZK.ClassName,ZK),function(z){z[z.INIT=0]="INIT",z[z.STARTED=1]="STARTED",z[z.ENDED=2]="ENDED"}(CK||(CK={}));class yK{constructor(z){this.onEachCountObservable=new r.c,this.onTimerAbortedObservable=new r.c,this.onTimerEndedObservable=new r.c,this.onStateChangedObservable=new r.c,this._observer=null,this._breakOnNextTick=!1,this._tick=z=>{const a=Date.now();this._timer=a-this._startTime;const K={startTime:this._startTime,currentTime:a,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:z},v=this._breakOnNextTick||this._breakCondition(K);v||this._timer>=this._timeToEnd?this._stop(K,v):this.onEachCountObservable.notifyObservers(K)},this._setState(0),this._contextObservable=z.contextObservable,this._observableParameters=z.observableParameters??{},this._breakCondition=z.breakCondition??(()=>!1),this._timeToEnd=z.timeout,z.onEnded&&this.onTimerEndedObservable.add(z.onEnded),z.$h&&this.onEachCountObservable.add(z.$h),z.onAborted&&this.onTimerAbortedObservable.add(z.onAborted)}set breakCondition(z){this._breakCondition=z}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=z,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(z){this._state=z,this.onStateChangedObservable.notifyObservers(this._state)}_stop(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),a?this.onTimerAbortedObservable.notifyObservers(z):this.onTimerEndedObservable.notifyObservers(z)}}class iK extends GK{constructor(z){super(z),this.timeout=this.registerDataInput("timeout",Oa)}_preparePendingTasks(z){const a=this.timeout.getValue(z);if(void 0!==a&&a>=0){const K=z._getExecutionVariable(this,"runningTimers")||[],v=z.configuration.Oc,T=new yK({timeout:a,contextObservable:v.onBeforeRenderObservable,onEnded:()=>this._onEnded(T,z)});T.start(),K.push(T),z._setExecutionVariable(this,"runningTimers",K)}}_execute(z){this._startPendingTasks(z),this.out._activateSignal(z)}_onEnded(z,a){const K=a._getExecutionVariable(this,"runningTimers")||[],v=K.indexOf(z);-1!==v?K.splice(v,1):p.h.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),a._removePendingBlock(this),this.done._activateSignal(a)}_cancelPendingTasks(z){const a=z._getExecutionVariable(this,"runningTimers")||[];for(const K of a)K.dispose();z._deleteExecutionVariable(this,"runningTimers")}getClassName(){return iK.ClassName}}iK.ClassName="FGTimerBlock",(0,q.e)("FGTimerBlock",iK);class nK extends xK{constructor(z){super(z),this.config=z;for(let a=0;a<this.config.eventData.length;a++){const z=this.config.eventData[a];this.registerDataInput(z,Qa)}}_execute(z){const a=this.config.eventId,K=this.dataInputs.map((a=>a.getValue(z)));z.configuration.coordinator.notifyCustomEvent(a,K),this.out._activateSignal(z)}getClassName(){return nK.ClassName}}nK.ClassName="FGSendCustomEventBlock",(0,q.e)("FGSendCustomEventBlock",nK);class XK extends lK{constructor(z){super(z),this.config=z;for(let a=0;a<this.config.eventData.length;a++){const z=this.config.eventData[a];this.registerDataOutput(z,Qa)}}_preparePendingTasks(z){const a=z.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=a.add((a=>{for(let K=0;K<a.length;K++)this.dataOutputs[K].setValue(a[K],z);this._execute(z)}))}_cancelPendingTasks(z){const a=z.configuration.coordinator.getCustomEventObservable(this.config.eventId);a?a.remove(this._eventObserver):p.h.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return XK.ClassName}serialize(z){super.serialize(z),z.eventId=this.config.eventId,z.eventData=this.config.eventData}}XK.ClassName="FGReceiveCustomEventBlock",(0,q.e)(XK.ClassName,XK);class PK extends FK{constructor(z){super(z),this.config=z,this.outFlows=[];for(let a=0;a<this.config.numberOutputFlows;a++)this.outFlows.push(this._registerSignalOutput(`${a}`))}_execute(z){for(let a=0;a<this.config.numberOutputFlows;a++)this.outFlows[a]._activateSignal(z)}getClassName(){return PK.ClassName}}PK.ClassName="FGSequenceBlock",(0,q.e)(PK.ClassName,PK);const JK=new RegExp(/\{(\w+)\}/g);class oK{constructor(z,a){this.path=z,this.ownerBlock=a,this.templatedInputs=[];let K=JK.exec(z);for(;K;){const[,v]=K;this.templatedInputs.push(a.registerDataInput(v,TK)),K=JK.exec(z)}}getAccessor(z,a){let K=this.path;for(const v of this.templatedInputs){const z=v.getValue(a).value;K=K.replace(`{${v.name}}`,z.toString())}return z.convert(K)}}class NK extends rK{constructor(z){super(z),this.config=z,this.value=this.registerDataOutput("value",Qa),this.templateComponent=new oK(z.path,this)}_updateOutputs(z){const a=this.templateComponent.getAccessor(this.config.pathConverter,z),K=a.info.get(a.object);this.value.setValue(K,z)}getClassName(){return NK.ClassName}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(z),z.config.path=this.config.path}}NK.ClassName="FGGetPropertyBlock",(0,q.e)(NK.ClassName,NK);class AK extends xK{constructor(z){super(z),this.config=z,this.a=this.registerDataInput("a",Qa),this.templateComponent=new oK(z.path,this)}_execute(z){const a=this.a.getValue(z),K=this.templateComponent.getAccessor(this.config.pathConverter,z);K.info.set(a,K.object),this.out._activateSignal(z)}serialize(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(z),z.config.path=this.config.path}getClassName(){return AK.ClassName}}AK.ClassName="FGSetPropertyBlock",(0,q.e)("FGSetPropertyBlock",AK);const gK="cachedOperationValue",dK="cachedExecutionId";class tK extends rK{constructor(z,a){super(a),this.value=this.registerDataOutput("value",z)}_updateOutputs(z){const a=z._getExecutionVariable(this,dK),K=z._getExecutionVariable(this,gK);if(void 0!==K&&a===z.executionId)this.value.setValue(K,z);else{const a=this._doOperation(z);z._setExecutionVariable(this,gK,a),z._setExecutionVariable(this,dK,z.executionId),this.value.setValue(a,z)}}}class eK extends tK{constructor(z,a,K,v,T,m){super(K,m),this._operation=v,this._className=T,this.a=this.registerDataInput("a",z),this.b=this.registerDataInput("b",a)}_doOperation(z){return this._operation(this.a.getValue(z),this.b.getValue(z))}getClassName(){return this._className}}class LK extends tK{constructor(z,a,K,v){super(z,v),this._operation=a,this._className=K}_doOperation(z){return this._operation()}getClassName(){return this._className}}class EK extends tK{constructor(z,a,K,v,T){super(a,T),this._operation=K,this._className=v,this.a=this.registerDataInput("a",z)}_doOperation(z){return this._operation(this.a.getValue(z))}getClassName(){return this._className}}class bK extends tK{constructor(z,a,K,v,T,m,p){super(v,p),this._operation=T,this._className=m,this.a=this.registerDataInput("a",z),this.b=this.registerDataInput("b",a),this.c=this.registerDataInput("c",K)}_doOperation(z){return this._operation(this.a.getValue(z),this.b.getValue(z),this.c.getValue(z))}getClassName(){return this._className}}function DK(z){return z.getClassName?z.getClassName():""}function uK(z,a){return"Vector2"===z&&"Vector2"===a||"gb"===z&&"gb"===a||"Vector4"===z&&"Vector4"===a}function UK(z,a){return"Matrix"===z&&"Matrix"===a}function RK(z,a){return"FlowGraphInteger"===z&&"FlowGraphInteger"===a}class kK extends eK{constructor(z){super(Qa,Qa,Qa,((z,a)=>this._polymorphicAdd(z,a)),kK.ClassName,z)}_polymorphicAdd(z,a){const K=DK(z),v=DK(a);return uK(K,v)||UK(K,v)||RK(K,v)?z.add(a):z+a}}kK.ClassName="FGAddBlock",(0,q.e)(kK.ClassName,kK);class hK extends eK{constructor(z){super(Qa,Qa,Qa,((z,a)=>this._polymorphicAdd(z,a)),hK.ClassName,z)}_polymorphicAdd(z,a){const K=DK(z),v=DK(a);return uK(K,v)||RK(K,v)?z.sc(a):UK(K,v)?z.add(a.scale(-1)):z-a}}hK.ClassName="FGSubBlock",(0,q.e)(hK.ClassName,hK);class SK extends eK{constructor(z){super(Qa,Qa,Qa,((z,a)=>this._polymorphicMultiply(z,a)),SK.ClassName,z)}_polymorphicMultiply(z,a){const K=DK(z),v=DK(a);return uK(K,v)||RK(K,v)?z.multiply(a):UK(K,v)?T.b.FromValues(z.m[0]*a.m[0],z.m[4]*a.m[4],z.m[8]*a.m[8],z.m[12]*a.m[12],z.m[1]*a.m[1],z.m[5]*a.m[5],z.m[9]*a.m[9],z.m[13]*a.m[13],z.m[2]*a.m[2],z.m[6]*a.m[6],z.m[10]*a.m[10],z.m[14]*a.m[14],z.m[3]*a.m[3],z.m[7]*a.m[7],z.m[11]*a.m[11],z.m[15]*a.m[15]):z*a}}SK.ClassName="FGMultiplyBlock",(0,q.e)(SK.ClassName,SK);class QK extends eK{constructor(z){super(Qa,Qa,Qa,((z,a)=>this._polymorphicDivide(z,a)),QK.ClassName,z)}_polymorphicDivide(z,a){const K=DK(z),v=DK(a);return uK(K,v)||RK(K,v)?z.divide(a):UK(K,v)?T.b.FromValues(z.m[0]/a.m[0],z.m[4]/a.m[4],z.m[8]/a.m[8],z.m[12]/a.m[12],z.m[1]/a.m[1],z.m[5]/a.m[5],z.m[9]/a.m[9],z.m[13]/a.m[13],z.m[2]/a.m[2],z.m[6]/a.m[6],z.m[10]/a.m[10],z.m[14]/a.m[14],z.m[3]/a.m[3],z.m[7]/a.m[7],z.m[11]/a.m[11],z.m[15]/a.m[15]):z/a}}QK.ClassName="FGDivideBlock",(0,q.e)(QK.ClassName,QK);class OK extends LK{constructor(z){super(Oa,(()=>Math.random()),OK.ClassName,z)}}OK.ClassName="FGRandomBlock",(0,q.e)(OK.ClassName,OK);class zv extends eK{constructor(z){super(Qa,Qa,Oa,((z,a)=>this._polymorphicDot(z,a)),zv.ClassName,z)}_polymorphicDot(z,a){switch(DK(z)){case"Vector2":return T.m.Dot(z,a);case"gb":return T.o.Dot(z,a);case"Vector4":return T.r.Dot(z,a);default:throw new Error(`Cannot get dot product of ${z} and ${a}`)}}}zv.ClassName="FGDotBlock",(0,q.e)(zv.ClassName,zv);class av extends LK{constructor(z){super(Oa,(()=>Math.E),av.ClassName,z)}}av.ClassName="FGEBlock",(0,q.e)(av.ClassName,av);class Kv extends LK{constructor(z){super(Oa,(()=>Math.PI),Kv.ClassName,z)}}Kv.ClassName="FGPIBlock",(0,q.e)(Kv.ClassName,Kv);class vv extends LK{constructor(z){super(Oa,(()=>Number.POSITIVE_INFINITY),vv.ClassName,z)}}vv.ClassName="FGInfBlock",(0,q.e)(vv.ClassName,vv);class Tv extends LK{constructor(z){super(Oa,(()=>Number.NaN),Tv.ClassName,z)}}function mv(z,a){switch(DK(z)){case"FlowGraphInteger":return new ha(a(z.value));case"Vector2":return new T.m(a(z.x),a(z.y));case"gb":return new T.o(a(z.x),a(z.y),a(z.z));case"Vector4":return new T.r(a(z.x),a(z.y),a(z.z),a(z.w));case"Matrix":return T.b.FromValues(a(z.m[0]),a(z.m[4]),a(z.m[8]),a(z.m[12]),a(z.m[1]),a(z.m[5]),a(z.m[9]),a(z.m[13]),a(z.m[2]),a(z.m[6]),a(z.m[10]),a(z.m[14]),a(z.m[3]),a(z.m[7]),a(z.m[11]),a(z.m[15]));default:return a(z)}}Tv.ClassName="FGNaNBlock",(0,q.e)(Tv.ClassName,Tv);class pv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicAbs(z)),pv.ClassName,z)}_polymorphicAbs(z){return mv(z,Math.abs)}}pv.ClassName="FGAbsBlock",(0,q.e)(pv.ClassName,pv);class jv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicSign(z)),jv.ClassName,z)}_polymorphicSign(z){return mv(z,Math.sign)}}jv.ClassName="FGSignBlock",(0,q.e)(jv.ClassName,jv);class sv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicTrunc(z)),sv.ClassName,z)}_polymorphicTrunc(z){return mv(z,Math.trunc)}}sv.ClassName="FGTruncBlock",(0,q.e)(sv.ClassName,sv);class Mv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicFloor(z)),Mv.ClassName,z)}_polymorphicFloor(z){return mv(z,Math.floor)}}Mv.ClassName="FGFloorBlock",(0,q.e)(Mv.ClassName,Mv);class rv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicCeiling(z)),rv.ClassName,z)}_polymorphicCeiling(z){return mv(z,Math.ceil)}}rv.ClassName="FGCeilBlock",(0,q.e)(rv.ClassName,rv);class Wv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicFract(z)),Wv.ClassName,z)}_polymorphicFract(z){return mv(z,(z=>z-Math.floor(z)))}}Wv.ClassName="FGFractBlock",(0,q.e)(Wv.ClassName,Wv);class Fv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicNeg(z)),Fv.ClassName,z)}_polymorphicNeg(z){return mv(z,(z=>-z))}}function Gv(z,a,K){switch(DK(z)){case"FlowGraphInteger":return new ha(K(z.value,a.value));case"Vector2":return new T.m(K(z.x,a.x),K(z.y,a.y));case"gb":return new T.o(K(z.x,a.x),K(z.y,a.y),K(z.z,a.z));case"Vector4":return new T.r(K(z.x,a.x),K(z.y,a.y),K(z.z,a.z),K(z.w,a.w));case"Matrix":return T.b.FromValues(K(z.m[0],a.m[0]),K(z.m[4],a.m[4]),K(z.m[8],a.m[8]),K(z.m[12],a.m[12]),K(z.m[1],a.m[1]),K(z.m[5],a.m[5]),K(z.m[9],a.m[9]),K(z.m[13],a.m[13]),K(z.m[2],a.m[2]),K(z.m[6],a.m[6]),K(z.m[10],a.m[10]),K(z.m[14],a.m[14]),K(z.m[3],a.m[3]),K(z.m[7],a.m[7]),K(z.m[11],a.m[11]),K(z.m[15],a.m[15]));default:return K(z,a)}}Fv.ClassName="FGNegBlock",(0,q.e)(Fv.ClassName,Fv);class lv extends eK{constructor(z){super(Qa,Qa,Qa,((z,a)=>this._polymorphicRemainder(z,a)),lv.ClassName,z)}_polymorphicRemainder(z,a){return Gv(z,a,((z,a)=>z%a))}}lv.ClassName="FGRemainderBlock",(0,q.e)(lv.ClassName,lv);class Vv extends eK{constructor(z){super(Qa,Qa,Qa,((z,a)=>this._polymorphicMin(z,a)),Vv.ClassName,z)}_polymorphicMin(z,a){return Gv(z,a,Math.min)}}Vv.ClassName="FGMinBlock",(0,q.e)(Vv.ClassName,Vv);class cv extends eK{constructor(z){super(Qa,Qa,Qa,((z,a)=>this._polymorphicMax(z,a)),cv.ClassName,z)}_polymorphicMax(z,a){return Gv(z,a,Math.max)}}function Cv(z,a,K){return Math.min(Math.max(z,Math.min(a,K)),Math.max(a,K))}function wv(z,a,K,v){switch(DK(z)){case"FlowGraphInteger":return new ha(v(z.value,a.value,K.value));case"Vector2":return new T.m(v(z.x,a.x,K.x),v(z.y,a.y,K.y));case"gb":return new T.o(v(z.x,a.x,K.x),v(z.y,a.y,K.y),v(z.z,a.z,K.z));case"Vector4":return new T.r(v(z.x,a.x,K.x),v(z.y,a.y,K.y),v(z.z,a.z,K.z),v(z.w,a.w,K.w));case"Matrix":return T.b.FromValues(v(z.m[0],a.m[0],K.m[0]),v(z.m[4],a.m[4],K.m[4]),v(z.m[8],a.m[8],K.m[8]),v(z.m[12],a.m[12],K.m[12]),v(z.m[1],a.m[1],K.m[1]),v(z.m[5],a.m[5],K.m[5]),v(z.m[9],a.m[9],K.m[9]),v(z.m[13],a.m[13],K.m[13]),v(z.m[2],a.m[2],K.m[2]),v(z.m[6],a.m[6],K.m[6]),v(z.m[10],a.m[10],K.m[10]),v(z.m[14],a.m[14],K.m[14]),v(z.m[3],a.m[3],K.m[3]),v(z.m[7],a.m[7],K.m[7]),v(z.m[11],a.m[11],K.m[11]),v(z.m[15],a.m[15],K.m[15]));default:return v(z,a,K)}}cv.ClassName="FGMaxBlock",(0,q.e)(cv.ClassName,cv);class Hv extends bK{constructor(z){super(Qa,Qa,Qa,Qa,((z,a,K)=>this._polymorphicClamp(z,a,K)),Hv.ClassName,z)}_polymorphicClamp(z,a,K){return wv(z,a,K,Cv)}}function fv(z){return Math.min(Math.max(z,0),1)}Hv.ClassName="FGClampBlock",(0,q.e)(Hv.ClassName,Hv);class Yv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicSaturate(z)),Yv.ClassName,z)}_polymorphicSaturate(z){return mv(z,fv)}}Yv.ClassName="FGSaturateBlock",(0,q.e)(Yv.ClassName,Yv);class Iv extends bK{constructor(z){super(Qa,Qa,Qa,Qa,((z,a,K)=>this._polymorphicInterpolate(z,a,K)),Iv.ClassName,z)}_interpolate(z,a,K){return(1-K)*z+K*a}_polymorphicInterpolate(z,a,K){return wv(z,a,K,this._interpolate)}}Iv.ClassName="FGInterpolateBlock",(0,q.e)(Iv.ClassName,Iv);class qv extends eK{constructor(z){super(Qa,Qa,zK,((z,a)=>this._polymorphicEq(z,a)),qv.ClassName,z)}_polymorphicEq(z,a){const K=DK(z),v=DK(a);return uK(K,v)||UK(K,v)||RK(K,v)?z.equals(a):z===a}}function Bv(z,a,K){const v=DK(z);if(v===DK(a)){if(""===v)return K(z,a);if("FlowGraphInteger"===v)return K(z.value,a.value);throw new Error(`Cannot compare ${z} and ${a}`)}throw new Error(`${z} and ${a} are of different types.`)}qv.ClassName="FGEqBlock",(0,q.e)(qv.ClassName,qv);class xv extends eK{constructor(z){super(Qa,Qa,zK,((z,a)=>this._polymorphicLessThan(z,a)),xv.ClassName,z)}_polymorphicLessThan(z,a){return Bv(z,a,((z,a)=>z<a))}}xv.ClassName="FGLessThanBlock",(0,q.e)(xv.ClassName,xv);class Zv extends eK{constructor(z){super(Qa,Qa,zK,((z,a)=>this._polymorphicLessThanOrEqual(z,a)),Zv.ClassName,z)}_polymorphicLessThanOrEqual(z,a){return Bv(z,a,((z,a)=>z<=a))}}Zv.ClassName="FGLessThanOrEqualBlock";class yv extends eK{constructor(z){super(Qa,Qa,zK,((z,a)=>this._polymorphicGreaterThan(z,a)),yv.ClassName,z)}_polymorphicGreaterThan(z,a){return Bv(z,a,((z,a)=>z>a))}}yv.ClassName="FGGreaterThanBlock",(0,q.e)(yv.ClassName,yv);class iv extends eK{constructor(z){super(Qa,Qa,zK,((z,a)=>this._polymorphicGreaterThanOrEqual(z,a)),iv.ClassName,z)}_polymorphicGreaterThanOrEqual(z,a){return Bv(z,a,((z,a)=>z>=a))}}iv.ClassName="FGGreaterThanOrEqualBlock",(0,q.e)(iv.ClassName,iv);class nv extends EK{constructor(z){super(Qa,zK,(z=>this._polymorphicIsNan(z)),nv.ClassName,z)}_polymorphicIsNan(z){const a=DK(z);if(""===a)return isNaN(z);if("FlowGraphInteger"===a)return isNaN(z.value);throw new Error(`Cannot get NaN of ${z}`)}}nv.ClassName="FGIsNanBlock",(0,q.e)(nv.ClassName,nv);class Xv extends EK{constructor(z){super(Qa,zK,(z=>this._polymorphicIsInf(z)),Xv.ClassName,z)}_polymorphicIsInf(z){const a=DK(z);if(""===a)return!isFinite(z);if("FlowGraphInteger"===a)return!isFinite(z.value);throw new Error(`Cannot get isInf of ${z}`)}}Xv.ClassName="FGIsInfBlock";class Pv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicDegToRad(z)),Pv.ClassName,z)}_degToRad(z){return z*Math.PI/180}_polymorphicDegToRad(z){return mv(z,this._degToRad)}}Pv.ClassName="FGDegToRadBlock",(0,q.e)(Pv.ClassName,Pv);class Jv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicRadToDeg(z)),Jv.ClassName,z)}_radToDeg(z){return 180*z/Math.PI}_polymorphicRadToDeg(z){return mv(z,this._radToDeg)}}Jv.ClassName="FGRadToDegBlock",(0,q.e)(Jv.ClassName,Jv);class ov extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicSin(z)),ov.ClassName,z)}_polymorphicSin(z){return mv(z,Math.sin)}}ov.ClassName="FGSinBlock",(0,q.e)(ov.ClassName,ov);class Nv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicCos(z)),Nv.ClassName,z)}_polymorphicCos(z){return mv(z,Math.cos)}}Nv.ClassName="FGCosBlock",(0,q.e)(Nv.ClassName,Nv);class Av extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicTan(z)),Av.ClassName,z)}_polymorphicTan(z){return mv(z,Math.tan)}}Av.ClassName="FGTanBlock",(0,q.e)(Av.ClassName,Av);class gv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicAsin(z)),gv.ClassName,z)}_polymorphicAsin(z){return mv(z,Math.asin)}}gv.ClassName="FGAsinBlock",(0,q.e)(gv.ClassName,gv);class dv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicAcos(z)),dv.ClassName,z)}_polymorphicAcos(z){return mv(z,Math.acos)}}dv.ClassName="FGAcosBlock",(0,q.e)(dv.ClassName,dv);class tv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicAtan(z)),tv.ClassName,z)}_polymorphicAtan(z){return mv(z,Math.atan)}}tv.ClassName="FGAtanBlock",(0,q.e)(tv.ClassName,tv);class ev extends eK{constructor(z){super(Qa,Qa,Qa,((z,a)=>this._polymorphicAtan2(z,a)),ev.ClassName,z)}_polymorphicAtan2(z,a){return Gv(z,a,Math.atan2)}}ev.ClassName="FGAtan2Block",(0,q.e)(ev.ClassName,ev);class Lv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicSinh(z)),Lv.ClassName,z)}_polymorphicSinh(z){return mv(z,Math.sinh)}}Lv.ClassName="FGSinhBlock",(0,q.e)(Lv.ClassName,Lv);class Ev extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicCosh(z)),Ev.ClassName,z)}_polymorphicCosh(z){return mv(z,Math.cosh)}}Ev.ClassName="FGCoshBlock",(0,q.e)(Ev.ClassName,Ev);class bv extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicTanh(z)),bv.ClassName,z)}_polymorphicTanh(z){return mv(z,Math.tanh)}}bv.ClassName="FGTanhBlock",(0,q.e)(bv.ClassName,bv);class Dv extends EK{constructor(z){super(Qa,Oa,(z=>this._polymorphicAsinh(z)),Dv.ClassName,z)}_polymorphicAsinh(z){return mv(z,Math.asinh)}}Dv.ClassName="FGAsinhBlock",(0,q.e)(Dv.ClassName,Dv);class uv extends EK{constructor(z){super(Qa,Oa,(z=>this._polymorphicAcosh(z)),uv.ClassName,z)}_polymorphicAcosh(z){return mv(z,Math.acosh)}}uv.ClassName="FGAcoshBlock",(0,q.e)(uv.ClassName,uv);class Uv extends EK{constructor(z){super(Qa,Oa,(z=>this._polymorphicAtanh(z)),Uv.ClassName,z)}_polymorphicAtanh(z){return mv(z,Math.atanh)}}Uv.ClassName="FGAtanhBlock",(0,q.e)(Uv.ClassName,Uv);class Rv extends EK{constructor(z){super(Qa,Oa,(z=>this._polymorphicExp(z)),Rv.ClassName,z)}_polymorphicExp(z){return mv(z,Math.exp)}}Rv.ClassName="FGExpBlock",(0,q.e)(Rv.ClassName,Rv);class kv extends EK{constructor(z){super(Qa,Oa,(z=>this._polymorphicLog(z)),kv.ClassName,z)}_polymorphicLog(z){return mv(z,Math.log)}}kv.ClassName="FGLogBlock",(0,q.e)(kv.ClassName,kv);class hv extends EK{constructor(z){super(Qa,Oa,(z=>this._polymorphicLog2(z)),hv.ClassName,z)}_polymorphicLog2(z){return mv(z,Math.log2)}}hv.ClassName="FGLog2Block",(0,q.e)(hv.ClassName,hv);class Sv extends EK{constructor(z){super(Qa,Oa,(z=>this._polymorphicLog10(z)),Sv.ClassName,z)}_polymorphicLog10(z){return mv(z,Math.log10)}}Sv.ClassName="FGLog10Block",(0,q.e)(Sv.ClassName,Sv);class Qv extends EK{constructor(z){super(Qa,Oa,(z=>this._polymorphicSqrt(z)),Qv.ClassName,z)}_polymorphicSqrt(z){return mv(z,Math.sqrt)}}Qv.ClassName="FGSqrtBlock",(0,q.e)(Qv.ClassName,Qv);class Ov extends EK{constructor(z){super(Qa,Oa,(z=>this._polymorphicCubeRoot(z)),Ov.ClassName,z)}_polymorphicCubeRoot(z){return mv(z,Math.cbrt)}}Ov.ClassName="FGCubeRootBlock",(0,q.e)(Ov.ClassName,Ov);class zT extends eK{constructor(z){super(Qa,Oa,Oa,((z,a)=>this._polymorphicPow(z,a)),zT.ClassName,z)}_polymorphicPow(z,a){return Gv(z,a,Math.pow)}}zT.ClassName="FGPowBlock",(0,q.e)(zT.ClassName,zT);class aT extends EK{constructor(z){super(Qa,Oa,(z=>this._polymorphicLength(z)),aT.ClassName,z)}_polymorphicLength(z){switch(DK(z)){case"Vector2":case"gb":case"Vector4":return z.length();default:throw new Error(`Cannot compute length of value ${z}`)}}}aT.ClassName="FGLengthBlock",(0,q.e)(aT.ClassName,aT);class KT extends EK{constructor(z){super(Qa,Qa,(z=>this._polymorphicNormalize(z)),KT.ClassName,z)}_polymorphicNormalize(z){switch(DK(z)){case"Vector2":case"gb":case"Vector4":return z.normalize();default:throw new Error(`Cannot normalize value ${z}`)}}}KT.ClassName="FGNormalizeBlock",(0,q.e)(KT.ClassName,KT);class vT extends eK{constructor(z){super(KK,KK,KK,((z,a)=>T.o.Cross(z,a)),vT.ClassName,z)}}vT.ClassName="FGCrossBlock",(0,q.e)(vT.ClassName,vT);class TT extends eK{constructor(z){super(aK,Oa,aK,((z,a)=>T.m.Transform(z,T.b.RotationZ(a))),TT.ClassName,z)}}TT.ClassName="FGRotate2DBlock",(0,q.e)(TT.ClassName,TT);class mT extends bK{constructor(z){super(KK,KK,Oa,KK,((z,a,K)=>T.o.TransformCoordinates(z,T.b.RotationAxis(a,K))),mT.ClassName,z)}}mT.ClassName="FGRotate3DBlock",(0,q.e)(mT.ClassName,mT);class pT extends EK{constructor(z){super(vK,vK,(z=>T.b.Transpose(z)),pT.ClassName,z)}}pT.ClassName="FGTransposeBlock",(0,q.e)(pT.ClassName,pT);class jT extends EK{constructor(z){super(vK,Oa,(z=>z.determinant()),jT.ClassName,z)}}jT.ClassName="FGDeterminantBlock",(0,q.e)(jT.ClassName,jT);class sT extends EK{constructor(z){super(vK,vK,(z=>T.b.Invert(z)),sT.ClassName,z)}}sT.ClassName="FGInvertMatrixBlock",(0,q.e)(sT.ClassName,sT);class MT extends eK{constructor(z){super(vK,vK,vK,((z,a)=>a.multiply(z)),MT.ClassName,z)}}MT.ClassName="FGMatMulBlock",(0,q.e)(MT.ClassName,MT);class rT extends EK{constructor(z){super(TK,TK,(z=>new ha(~z.value)),rT.ClassName,z)}}rT.ClassName="FGBitwiseNotBlock",(0,q.e)(rT.ClassName,rT);class WT extends eK{constructor(z){super(TK,TK,TK,((z,a)=>new ha(z.value&a.value)),WT.ClassName,z)}}WT.ClassName="FGBitwiseAndBlock",(0,q.e)(WT.ClassName,WT);class FT extends eK{constructor(z){super(TK,TK,TK,((z,a)=>new ha(z.value|a.value)),FT.ClassName,z)}}FT.ClassName="FGBitwiseOrBlock",(0,q.e)(FT.ClassName,FT);class GT extends eK{constructor(z){super(TK,TK,TK,((z,a)=>new ha(z.value^a.value)),GT.ClassName,z)}}GT.ClassName="FGBitwiseXorBlock",(0,q.e)(GT.ClassName,GT);class lT extends eK{constructor(z){super(TK,TK,TK,((z,a)=>new ha(z.value<<a.value)),lT.ClassName,z)}}lT.ClassName="FGBitwiseLeftShiftBlock",(0,q.e)(lT.ClassName,lT);class VT extends eK{constructor(z){super(TK,TK,TK,((z,a)=>new ha(z.value>>a.value)),VT.ClassName,z)}}VT.ClassName="FGBitwiseRightShiftBlock",(0,q.e)(VT.ClassName,VT);class cT extends EK{constructor(z){super(TK,TK,(z=>new ha(Math.clz32(z.value))),cT.ClassName,z)}}cT.ClassName="FGCountLeadingZerosBlock",(0,q.e)(cT.ClassName,cT);class CT extends EK{constructor(z){super(TK,TK,(z=>new ha(z.value?31-Math.clz32(z.value&-z.value):32)),CT.ClassName,z)}}CT.ClassName="FGCountTrailingZerosBlock",(0,q.e)(CT.ClassName,CT);class wT extends EK{constructor(z){super(TK,TK,(z=>new ha(function(z){let a=0;for(;z;)a+=1&z,z>>=1;return a}(z.value))),wT.ClassName,z)}}wT.ClassName="FGCountOneBitsBlock",(0,q.e)(wT.ClassName,wT);class HT extends xK{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new ha(0)};super(z),this.config=z,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",TK),this.value=this.registerDataOutput("value",TK)}_execute(z,a){if(a===this.reset)this.value.setValue(this.config.startIndex,z);else{const a=this.value.getValue(z);a.value<this.n.getValue(z).value&&(this.value.setValue(new ha(a.value+1),z),this.out._activateSignal(z))}}getClassName(){return HT.ClassName}}HT.ClassName="FGDoNBlock",(0,q.e)(HT.ClassName,HT);class fT extends rK{constructor(z){super(z),this.config=z,this.output=this.registerDataOutput(z.variableName,Qa)}_updateOutputs(z){const a=this.config.variableName;z.hasVariable(a)&&this.output.setValue(z.getVariable(a),z)}getClassName(){return fT.ClassName}serialize(z){super.serialize(z),z.config.variableName=this.config.variableName}}fT.ClassName="FGGetVariableBlock",(0,q.e)(fT.ClassName,fT);class YT extends xK{constructor(z){super(z),this.config=z,this.input=this.registerDataInput(z.variableName,Qa)}_execute(z){const a=this.config.variableName,K=this.input.getValue(z);z.setVariable(a,K),this.out._activateSignal(z)}getClassName(){return YT.ClassName}}YT.ClassName="FGSetVariableBlock",(0,q.e)(YT.ClassName,YT);class IT extends xK{constructor(z){super(z),this.config=z,this.condition=this.registerDataInput("condition",zK),this.loopBody=this._registerSignalOutput("loopBody")}_execute(z,a){var K;let v=this.condition.getValue(z);for(null!==(K=this.config)&&void 0!==K&&K.isDo&&!v&&this.loopBody._activateSignal(z);v;)this.loopBody._activateSignal(z),v=this.condition.getValue(z);this.out._activateSignal(z)}getClassName(){return IT.ClassName}serialize(z){var a;super.serialize(z),z.isDo=null===(a=this.config)||void 0===a?void 0:a.isDo}}IT.ClassName="FGWhileLoopBlock",(0,q.e)(IT.ClassName,IT);const qT={"lifecycle/onStart":qK.ClassName,"lifecycle/onTick":BK.ClassName,log:ZK.ClassName,"flow/delay":iK.ClassName,"customEvent/send":nK.ClassName,"customEvent/receive":XK.ClassName,"flow/sequence":PK.ClassName,"world/get":NK.ClassName,"world/set":AK.ClassName,"flow/doN":HT.ClassName,"variable/get":fT.ClassName,"variable/set":YT.ClassName,"flow/whileLoop":IT.ClassName,"math/random":OK.ClassName,"math/e":av.ClassName,"math/pi":Kv.ClassName,"math/inf":vv.ClassName,"math/nan":Tv.ClassName,"math/abs":pv.ClassName,"math/sign":jv.ClassName,"math/trunc":sv.ClassName,"math/floor":Mv.ClassName,"math/ceil":rv.ClassName,"math/fract":Wv.ClassName,"math/neg":Fv.ClassName,"math/add":kK.ClassName,"math/sub":hK.ClassName,"math/mul":SK.ClassName,"math/div":QK.ClassName,"math/rem":lv.ClassName,"math/min":Vv.ClassName,"math/max":cv.ClassName,"math/clamp":Hv.ClassName,"math/saturate":Yv.ClassName,"math/mix":Iv.ClassName,"math/eq":qv.ClassName,"math/lt":xv.ClassName,"math/le":Zv.ClassName,"math/gt":yv.ClassName,"math/ge":iv.ClassName,"math/isnan":nv.ClassName,"math/isinf":Xv.ClassName,"math/rad":Pv.ClassName,"math/deg":Jv.ClassName,"math/sin":ov.ClassName,"math/cos":Nv.ClassName,"math/tan":Av.ClassName,"math/asin":gv.ClassName,"math/acos":dv.ClassName,"math/atan":tv.ClassName,"math/atan2":ev.ClassName,"math/sinh":Lv.ClassName,"math/cosh":Ev.ClassName,"math/tanh":bv.ClassName,"math/asinh":Dv.ClassName,"math/acosh":uv.ClassName,"math/atanh":Uv.ClassName,"math/exp":Rv.ClassName,"math/log":kv.ClassName,"math/log2":hv.ClassName,"math/log10":Sv.ClassName,"math/sqrt":Qv.ClassName,"math/cbrt":Ov.ClassName,"math/pow":zT.ClassName,"math/length":aT.ClassName,"math/normalize":KT.ClassName,"math/dot":zv.ClassName,"math/cross":vT.ClassName,"math/rotate2d":TT.ClassName,"math/rotate3d":mT.ClassName,"math/transpose":pT.ClassName,"math/determinant":jT.ClassName,"math/inverse":sT.ClassName,"math/matmul":MT.ClassName,"math/not":rT.ClassName,"math/and":WT.ClassName,"math/or":FT.ClassName,"math/xor":GT.ClassName,"math/asr":VT.ClassName,"math/lsl":lT.ClassName,"math/clz":cT.ClassName,"math/ctz":CT.ClassName,"math/popcnt":wT.ClassName},BT={float2:"Vector2",float3:"gb",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function xT(z,a,K){if(void 0!==z.type){const v=a.types&&a.types[z.type];if(!v)throw new Error(`${K}: Unknown type: ${z.type}`);const T=v.signature;if(!T)throw new Error(`${K}: Type ${z.type} has no signature`);const m=BT[T];return{value:z.value,className:m}}return z.value}function ZT(z,a,K){const v=qT[a.type];if(!v)throw new Error(`/extensions/KHR_interactivity/nodes/${z}: Unknown block type: ${a.type}`);const T=z.toString(),m=function(z,a,K){const v={},T=z.configuration??[];for(const m of T)if("customEvent"===m.id){const z=a.customEvents&&a.customEvents[m.value];if(!z)throw new Error(`/extensions/KHR_interactivity/nodes/${K}: Unknown custom event: ${m.value}`);v.eventId=z.id,v.eventData=z.values.map((z=>z.id))}else if("variable"===m.id){const z=a.variables&&a.variables[m.value];if(!z)throw new Error(`/extensions/KHR_interactivity/nodes/${K}: Unknown variable: ${m.value}`);v.variableName=z.id}else if("path"===m.id){const z=m.value;v.path=z}else v[m.id]=xT(m,a,`/extensions/KHR_interactivity/nodes/${K}`);return v}(a,K,T);return{className:v,config:m,uniqueId:T,metadata:a.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class yT extends qa{constructor(z){super(z,nT)}}const iT={__array__:{__target__:!0,translation:{type:"gb",get:z=>z._babylonTransformNode.position,set:(z,a)=>{a._babylonTransformNode.position=z},getObject:z=>z._babylonTransformNode}}},nT={nodes:iT},XT="KHR_interactivity";class PT{constructor(z){this._loader=z,this.name=XT,this.enabled=this._loader.isExtensionUsed(XT),this._pathConverter=new yT(this._loader.Qi)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var z;if(!this._loader.babylonScene||!this._pathConverter)return;const a=this._loader.babylonScene,K=function(z){const a={uniqueId:(0,Ra.c)(),_userVariables:{},_connectionValues:{}},K=[a],v=[];for(let m=0;m<z.nodes.length;m++){const a=ZT(m,z.nodes[m],z);v.push(a)}for(let m=0;m<z.nodes.length;m++){const K=z.nodes[m],T=v[m],p=K.flows??[];for(const z of p){const a=z.id,K={uniqueId:(0,Ra.c)(),name:a,_connectionType:1,connectedPointIds:[]};T.signalOutputs.push(K);const p=z.node,j=z.socket,s=v[p];if(!s)throw new Error(`/extensions/KHR_interactivity/nodes/${m}: Could not find node with id ${p} that connects its input with with node ${m}'s output ${a}`);let M=s.signalInputs.find((z=>z.name===j));M||(M={uniqueId:(0,Ra.c)(),name:j,_connectionType:0,connectedPointIds:[]},s.signalInputs.push(M)),M.connectedPointIds.push(K.uniqueId),K.connectedPointIds.push(M.uniqueId)}const j=K.values??[];for(const s of j){const K=s.id,p={uniqueId:(0,Ra.c)(),name:K,_connectionType:0,connectedPointIds:[]};if(T.dataInputs.push(p),void 0!==s.value){const K=xT(s,z,`/extensions/KHR_interactivity/nodes/${m}`);a._connectionValues[p.uniqueId]=K}else{if(void 0===s.node||void 0===s.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${m}: Invalid socket ${K} in node ${m}`);{const z=s.node,a=s.socket,T=v[z];if(!T)throw new Error(`/extensions/KHR_interactivity/nodes/${m}: Could not find node with id ${z} that connects its output with node${m}'s input ${K}`);let j=T.dataOutputs.find((z=>z.name===a));j||(j={uniqueId:(0,Ra.c)(),name:a,_connectionType:1,connectedPointIds:[]},T.dataOutputs.push(j)),p.connectedPointIds.push(j.uniqueId),j.connectedPointIds.push(p.uniqueId)}}}}const T=z.variables??[];for(let m=0;m<T.length;m++){const K=T[m],v=K.id;a._userVariables[v]=xT(K,z,`/extensions/KHR_interactivity/variables/${m}`)}return{allBlocks:v,executionContexts:K}}(null===(z=this._loader.Qi.extensions)||void 0===z?void 0:z.KHR_interactivity),v=new IK({Oc:a});YK.Parse(K,{coordinator:v,pathConverter:this._pathConverter}),v.start()}}R(XT),U(XT,!0,(z=>new PT(z)));const JT="KHR_node_visibility";class oT{constructor(z){this.name=JT,this._loader=z,this.enabled=z.isExtensionUsed(JT)}async onReady(){var z;null===(z=this._loader.Qi.nodes)||void 0===z||z.forEach((z=>{var a,K,v,T;(null===(a=z._primitiveBabylonMeshes)||void 0===a||a.forEach((z=>{z.inheritVisibility=!0})),null!==(K=z.extensions)&&void 0!==K&&K.KHR_node_visibility)&&(!1===(null===(v=z.extensions)||void 0===v?void 0:v.KHR_node_visibility.visible)&&(z._babylonTransformNode&&(z._babylonTransformNode.isVisible=!1),null===(T=z._primitiveBabylonMeshes)||void 0===T||T.forEach((z=>{z.isVisible=!1}))))}))}dispose(){this._loader=null}}R(JT),U(JT,!0,(z=>new oT(z)));const NT="ExtrasAsMetadata";class AT{_assignExtras(z,a){if(a.extras&&Object.keys(a.extras).length>0){const K=z.metadata=z.metadata||{};(K.Qi=K.Qi||{}).extras=a.extras}}constructor(z){this.name=NT,this.enabled=!0,this._loader=z}dispose(){this._loader=null}loadNodeAsync(z,a,K){return this._loader.loadNodeAsync(z,a,(z=>{this._assignExtras(z,a),K(z)}))}loadCameraAsync(z,a,K){return this._loader.loadCameraAsync(z,a,(z=>{this._assignExtras(z,a),K(z)}))}createMaterial(z,a,K){const v=this._loader.createMaterial(z,a,K);return this._assignExtras(v,a),v}}R(NT),U(NT,!1,(z=>new AT(z)))},11937:(z,a,K)=>{"use strict";K.d(a,{c:()=>X,e:()=>B,g:()=>q,j:()=>x});var v=K(10638),T=K(10631),m=K(11322),p=K(11194),j=K(11252),s=K(11249),M=K(10648),r=K(10680),W=K(11944),F=K(11949),G=K(11207);class l{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.sj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.bk=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(z){this._environmentTexture=z}getNodes(){let z=[];return z=z.concat(this.meshes),z=z.concat(this.lights),z=z.concat(this.cameras),z=z.concat(this.transformNodes),this.skeletons.forEach((a=>z=z.concat(a.bones))),z}}class V extends l{}class c{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((z=>{z.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((z=>{z.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((z=>{z.dispose()})),this.animationGroups.length=0}}class C extends l{constructor(z){super(),this._wasAddedToScene=!1,(z=z||r.b.LastCreatedScene)&&(this.Oc=z,this.proceduralTextures=[],z.lj.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=z.getEngine().onContextRestoredObservable.add((()=>{for(const z of this.geometries)z._rebuild();for(const z of this.meshes)z._rebuild();for(const z of this.sj)z.rebuild();for(const z of this.textures)z._rebuild()})))}_topologicalSort(z){const a=new Map;for(const p of z)a.set(p.uniqueId,p);const K={dependsOn:new Map,dependedBy:new Map};for(const p of z){const z=p.uniqueId;K.dependsOn.set(z,new Set),K.dependedBy.set(z,new Set)}for(const p of z){const z=p.uniqueId,v=K.dependsOn.get(z);if(p instanceof W.e){const T=p.sourceMesh;a.has(T.uniqueId)&&(v.add(T.uniqueId),K.dependedBy.get(T.uniqueId).add(z))}const T=K.dependedBy.get(z);for(const m of p.getDescendants()){const v=m.uniqueId;if(a.has(v)){T.add(v);K.dependsOn.get(v).add(z)}}}const v=[],T=[];for(const p of z){const z=p.uniqueId;0===K.dependsOn.get(z).size&&(T.push(p),a.delete(z))}const m=T;for(;m.length>0;){const z=m.shift();v.push(z);const T=K.dependedBy.get(z.uniqueId);for(const v of Array.from(T.values())){const T=K.dependsOn.get(v);T.delete(z.uniqueId),0===T.size&&a.get(v)&&(m.push(a.get(v)),a.delete(v))}}return a.size>0&&(M.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),a.forEach((z=>M.c.Error(z.name)))),v}_addNodeAndDescendantsToList(z,a,K,v){if(K&&(!v||v(K))&&!a.has(K.uniqueId)){z.push(K),a.add(K.uniqueId);for(const T of K.getDescendants(!0))this._addNodeAndDescendantsToList(z,a,T,v)}}_isNodeInContainer(z){return z instanceof s.e&&-1!==this.meshes.indexOf(z)||(z instanceof j.d&&-1!==this.transformNodes.indexOf(z)||(z instanceof F.d&&-1!==this.lights.indexOf(z)||z instanceof G.d&&-1!==this.cameras.indexOf(z)))}_isValidHierarchy(){for(const z of this.meshes)if(z.parent&&!this._isNodeInContainer(z.parent))return M.c.Warn(`Node ${z.name} has a parent that is not in the container.`),!1;for(const z of this.transformNodes)if(z.parent&&!this._isNodeInContainer(z.parent))return M.c.Warn(`Node ${z.name} has a parent that is not in the container.`),!1;for(const z of this.lights)if(z.parent&&!this._isNodeInContainer(z.parent))return M.c.Warn(`Node ${z.name} has a parent that is not in the container.`),!1;for(const z of this.cameras)if(z.parent&&!this._isNodeInContainer(z.parent))return M.c.Warn(`Node ${z.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(z){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],K=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||T.h.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const v={},m={},j=new c,s=[],M=[],r={doNotInstantiate:!0,...K},W=[],F=new Set;for(const T of this.transformNodes)null===T.parent&&this._addNodeAndDescendantsToList(W,F,T,r.predicate);for(const T of this.meshes)null===T.parent&&this._addNodeAndDescendantsToList(W,F,T,r.predicate);const G=this._topologicalSort(W),l=(K,T)=>{if(((a,K)=>{if(v[a.uniqueId]=K.uniqueId,m[K.uniqueId]=K,z&&(K.name=z(a.name)),K instanceof p.c){const z=K;if(z.morphTargetManager){const K=a.morphTargetManager;z.morphTargetManager=K.clone();for(let a=0;a<K.numTargets;a++){const T=K.getTarget(a),p=z.morphTargetManager.getTarget(a);v[T.uniqueId]=p.uniqueId,m[p.uniqueId]=p}}}})(K,T),K.parent){const z=v[K.parent.uniqueId],a=m[z];T.parent=a||K.parent}if(T.position&&K.position&&T.position.p(K.position),T.rotationQuaternion&&K.rotationQuaternion&&T.rotationQuaternion.p(K.rotationQuaternion),T.rotation&&K.rotation&&T.rotation.p(K.rotation),T.Yd&&K.Yd&&T.Yd.p(K.Yd),T.material){const p=T;if(p.material)if(a){const a=K.material;if(-1===M.indexOf(a)){let K=a.clone(z?z(a.name):"Clone of "+a.name);if(M.push(a),v[a.uniqueId]=K.uniqueId,m[K.uniqueId]=K,"MultiMaterial"===a.getClassName()){const T=a;for(const a of T.Wf)a&&(K=a.clone(z?z(a.name):"Clone of "+a.name),M.push(a),v[a.uniqueId]=K.uniqueId,m[K.uniqueId]=K);T.Wf=T.Wf.map((z=>z&&m[v[z.uniqueId]]))}}"InstancedMesh"!==p.getClassName()&&(p.material=m[v[a.uniqueId]])}else"MultiMaterial"===p.material.getClassName()?-1===this.Oc.multiMaterials.indexOf(p.material)&&this.Oc.addMultiMaterial(p.material):-1===this.Oc.materials.indexOf(p.material)&&this.Oc.addMaterial(p.material)}null===T.parent&&j.rootNodes.push(T)};return G.forEach((z=>{if("InstancedMesh"===z.getClassName()){const a=z,K=a.sourceMesh,T=v[K.uniqueId],p=("number"===typeof T?m[T]:K).createInstance(a.name);l(a,p)}else{let a=!0;"xb"===z.getClassName()||"Node"===z.getClassName()||z.skeleton||!z.getTotalVertices||0===z.getTotalVertices()?a=!1:r.doNotInstantiate&&(a="function"===typeof r.doNotInstantiate?!r.doNotInstantiate(z):!r.doNotInstantiate);const K=a?z.createInstance(`instance of ${z.name}`):z.clone(`Clone of ${z.name}`,null,!0);if(!K)throw new Error(`Could not clone or instantiate node on Asset Container ${z.name}`);l(z,K)}})),this.skeletons.forEach((a=>{if(r.predicate&&!r.predicate(a))return;const K=a.clone(z?z(a.name):"Clone of "+a.name);for(const z of this.meshes)if(z.skeleton===a&&!z.isAnInstance){const a=m[v[z.uniqueId]];if(!a||a.isAnInstance)continue;if(a.skeleton=K,-1!==s.indexOf(K))continue;s.push(K);for(const z of K.bones)z._linkedTransformNode&&(z._linkedTransformNode=m[v[z._linkedTransformNode.uniqueId]])}j.skeletons.push(K)})),this.animationGroups.forEach((a=>{if(r.predicate&&!r.predicate(a))return;const K=a.clone(z?z(a.name):"Clone of "+a.name,(z=>m[v[z.uniqueId]]||z));j.animationGroups.push(K)})),j}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||T.h.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Oc.environmentTexture=this.environmentTexture);for(const z of this.Oc._serializableComponents)z.addFromContainer(this);this.Oc.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const a=[];this.cameras.forEach((K=>{z&&!z(K)||(this.Oc.addCamera(K),a.push(K))})),this.lights.forEach((K=>{z&&!z(K)||(this.Oc.addLight(K),a.push(K))})),this.meshes.forEach((K=>{z&&!z(K)||(this.Oc.mi(K),a.push(K))})),this.skeletons.forEach((a=>{z&&!z(a)||this.Oc.addSkeleton(a)})),this.animations.forEach((a=>{z&&!z(a)||this.Oc.addAnimation(a)})),this.animationGroups.forEach((a=>{z&&!z(a)||this.Oc.addAnimationGroup(a)})),this.multiMaterials.forEach((a=>{z&&!z(a)||this.Oc.addMultiMaterial(a)})),this.materials.forEach((a=>{z&&!z(a)||this.Oc.addMaterial(a)})),this.morphTargetManagers.forEach((a=>{z&&!z(a)||this.Oc.addMorphTargetManager(a)})),this.geometries.forEach((a=>{z&&!z(a)||this.Oc.addGeometry(a)})),this.transformNodes.forEach((K=>{z&&!z(K)||(this.Oc.addTransformNode(K),a.push(K))})),this.actionManagers.forEach((a=>{z&&!z(a)||this.Oc.addActionManager(a)})),this.textures.forEach((a=>{z&&!z(a)||this.Oc.addTexture(a)})),this.reflectionProbes.forEach((a=>{z&&!z(a)||this.Oc.addReflectionProbe(a)}));for(const K of a)K.parent&&-1===this.Oc.getNodes().indexOf(K.parent)&&(K.setParent?K.setParent(null):K.parent=null)}removeAllFromScene(){this._isValidHierarchy()||T.h.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Oc.environmentTexture&&(this.Oc.environmentTexture=null);for(const z of this.Oc._serializableComponents)z.removeFromContainer(this)}removeFromScene(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((a=>{z&&!z(a)||this.Oc.removeCamera(a)})),this.lights.forEach((a=>{z&&!z(a)||this.Oc.removeLight(a)})),this.meshes.forEach((a=>{z&&!z(a)||this.Oc.Bc(a,!0)})),this.skeletons.forEach((a=>{z&&!z(a)||this.Oc.removeSkeleton(a)})),this.animations.forEach((a=>{z&&!z(a)||this.Oc.removeAnimation(a)})),this.animationGroups.forEach((a=>{z&&!z(a)||this.Oc.removeAnimationGroup(a)})),this.multiMaterials.forEach((a=>{z&&!z(a)||this.Oc.removeMultiMaterial(a)})),this.materials.forEach((a=>{z&&!z(a)||this.Oc.removeMaterial(a)})),this.morphTargetManagers.forEach((a=>{z&&!z(a)||this.Oc.removeMorphTargetManager(a)})),this.geometries.forEach((a=>{z&&!z(a)||this.Oc.removeGeometry(a)})),this.transformNodes.forEach((a=>{z&&!z(a)||this.Oc.removeTransformNode(a)})),this.actionManagers.forEach((a=>{z&&!z(a)||this.Oc.removeActionManager(a)})),this.textures.forEach((a=>{z&&!z(a)||this.Oc.removeTexture(a)})),this.reflectionProbes.forEach((a=>{z&&!z(a)||this.Oc.removeReflectionProbe(a)}))}dispose(){this.cameras.slice(0).forEach((z=>{z.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((z=>{z.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((z=>{z.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((z=>{z.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((z=>{z.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((z=>{z.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((z=>{z.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((z=>{z.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((z=>{z.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((z=>{z.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((z=>{z.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((z=>{z.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((z=>{z.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const z of this.Oc._serializableComponents)z.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Oc.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(z,a,K){if(z&&a)for(const v of z){let z=!0;if(K)for(const a of K)if(v===a){z=!1;break}z&&(a.push(v),v._parentContainer=this)}}moveAllFromScene(z){this._wasAddedToScene=!1,void 0===z&&(z=new V);for(const a in this)Object.prototype.hasOwnProperty.call(this,a)&&(this[a]=this[a]||("_environmentTexture"===a?null:[]),this._moveAssets(this.Oc[a],this[a],z[a]));this.environmentTexture=this.Oc.environmentTexture,this.removeAllFromScene()}createRootMesh(){const z=new p.c("assetContainerRootMesh",this.Oc);return this.meshes.forEach((a=>{a.parent||z.addChild(a)})),this.meshes.unshift(z),z}mergeAnimationsTo(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.b.LastCreatedScene,a=arguments.length>1?arguments[1]:void 0,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!z)return M.c.Error("No scene available to merge animations to"),[];const v=K||(a=>{let K=null;const v=a.animations.length?a.animations[0].targetProperty:"",T=a.name.split(".").join("").split("_primitive")[0];switch(v){case"position":case"rotationQuaternion":K=z.getTransformNodeByName(a.name)||z.getTransformNodeByName(T);break;case"influence":K=z.getMorphTargetByName(a.name)||z.getMorphTargetByName(T);break;default:K=z.getNodeByName(a.name)||z.getNodeByName(T)}return K});this.getNodes().forEach((z=>{const a=v(z);if(null!==a){for(const K of z.animations){const z=a.animations.filter((z=>z.targetProperty===K.targetProperty));for(const K of z){const z=a.animations.indexOf(K,0);z>-1&&a.animations.splice(z,1)}}a.animations=a.animations.concat(z.animations)}}));const T=[];return this.animationGroups.slice().forEach((z=>{T.push(z.clone(z.name,v)),z.animatables.forEach((z=>{z.stop()}))})),a.forEach((a=>{const K=v(a.target);K&&(z.beginAnimation(K,a.fromFrame,a.toFrame,a.loopAnimation,a.speedRatio,a.onAnimationEnd?a.onAnimationEnd:void 0,void 0,!0,void 0,a.onAnimationLoop?a.onAnimationLoop:void 0),z.stopAnimation(a.target))})),T}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((z=>{z.parent||-1!==this.rootNodes.indexOf(z)||this.rootNodes.push(z)})),this.transformNodes.forEach((z=>{z.parent||-1!==this.rootNodes.indexOf(z)||this.rootNodes.push(z)})),this.lights.forEach((z=>{z.parent||-1!==this.rootNodes.indexOf(z)||this.rootNodes.push(z)})),this.cameras.forEach((z=>{z.parent||-1!==this.rootNodes.indexOf(z)||this.rootNodes.push(z)}))}addAllAssetsToContainer(z){if(!z)return;const a=[],K=new Set;for(a.push(z);a.length>0;){const z=a.pop();if(z instanceof p.c?(z.Fj&&-1===this.geometries.indexOf(z.Fj)&&this.geometries.push(z.Fj),this.meshes.push(z)):z instanceof j.d?this.transformNodes.push(z):z instanceof F.d?this.lights.push(z):z instanceof G.d&&this.cameras.push(z),z instanceof s.e){if(z.material&&-1===this.materials.indexOf(z.material)){this.materials.push(z.material);for(const a of z.material.getActiveTextures())-1===this.textures.indexOf(a)&&this.textures.push(a)}z.skeleton&&-1===this.skeletons.indexOf(z.skeleton)&&this.skeletons.push(z.skeleton),z.morphTargetManager&&-1===this.morphTargetManagers.indexOf(z.morphTargetManager)&&this.morphTargetManagers.push(z.morphTargetManager)}for(const v of z.getChildren())K.has(v)||a.push(v);K.add(z)}this.populateRootNodes()}}var w=K(10690);class H{constructor(z){this.byteOffset=0,this.buffer=z}loadAsync(z){return this.buffer.readAsync(this.byteOffset,z).then((z=>{this._dataView=new DataView(z.buffer,z.byteOffset,z.byteLength),this._dataByteOffset=0}))}readUint32(){const z=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,z}readUint8Array(z){const a=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,z);return this._dataByteOffset+=z,this.byteOffset+=z,a}readString(z){return(0,w.h)(this.readUint8Array(z))}skipBytes(z){this._dataByteOffset+=z,this.byteOffset+=z}}var f=K(11954);const Y="Z2xURg",I={name:"Qi",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:z=>-1!==z.indexOf("asset")&&-1!==z.indexOf("version")||z.startsWith("data:base64,"+Y)||z.startsWith("data:;base64,"+Y)||z.startsWith("data:application/octet-stream;base64,"+Y)||z.startsWith("data:model/gltf-binary;base64,"+Y)};var q,B,x,Z=K(10682),y=K(10684);function i(z,a,K){try{return Promise.resolve(new Uint8Array(z,a,K))}catch(v){return Promise.reject(v)}}!function(z){z[z.AUTO=0]="AUTO",z[z.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(q||(q={})),function(z){z[z.NONE=0]="NONE",z[z.FIRST=1]="FIRST",z[z.ALL=2]="ALL"}(B||(B={})),function(z){z[z.LOADING=0]="LOADING",z[z.READY=1]="READY",z[z.COMPLETE=2]="COMPLETE"}(x||(x={}));class n{constructor(){this.coordinateSystemMode=q.AUTO,this.animationStartMode=B.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=z=>Promise.resolve(z),this.extensionOptions={}}p(z){z&&(this.onParsed=z.onParsed,this.coordinateSystemMode=z.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=z.animationStartMode??this.animationStartMode,this.loadNodeAnimations=z.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=z.loadSkins??this.loadSkins,this.loadMorphTargets=z.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=z.compileMaterials??this.compileMaterials,this.useClipPlane=z.useClipPlane??this.useClipPlane,this.compileShadowGenerators=z.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=z.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=z.useRangeRequests??this.useRangeRequests,this.createInstances=z.createInstances??this.createInstances,this.alwaysComputeBoundingBox=z.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=z.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=z.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=z.skipMaterials??this.skipMaterials,this.useSRGBBuffers=z.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=z.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=z.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=z.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=z.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=z.customRootNode,this.onMeshLoaded=z.onMeshLoaded,this.onSkinLoaded=z.onSkinLoaded,this.onTextureLoaded=z.onTextureLoaded,this.onMaterialLoaded=z.onMaterialLoaded,this.onCameraLoaded=z.onCameraLoaded,this.extensionOptions=z.extensionOptions??this.extensionOptions)}}class X extends n{constructor(z){super(),this.onParsedObservable=new v.c,this.onMeshLoadedObservable=new v.c,this.onSkinLoadedObservable=new v.c,this.onTextureLoadedObservable=new v.c,this.onMaterialLoadedObservable=new v.c,this.onCameraLoadedObservable=new v.c,this.onCompleteObservable=new v.c,this.onErrorObservable=new v.c,this.lj=new v.c,this.onExtensionLoadedObservable=new v.c,this.validate=!1,this.onValidatedObservable=new v.c,this._loader=null,this._state=null,this._requests=new Array,this.name=I.name,this.extensions=I.extensions,this.onLoaderStateChangedObservable=new v.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(z)}set onParsed(z){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),z&&(this._onParsedObserver=this.onParsedObservable.add(z))}set onMeshLoaded(z){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),z&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(z))}set onSkinLoaded(z){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),z&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((a=>z(a.node,a.skinnedNode))))}set onTextureLoaded(z){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),z&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(z))}set onMaterialLoaded(z){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),z&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(z))}set onCameraLoaded(z){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),z&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(z))}set onComplete(z){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(z)}set onError(z){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(z)}set onDispose(z){this._onDisposeObserver&&this.lj.remove(this._onDisposeObserver),this._onDisposeObserver=this.lj.add(z)}set onExtensionLoaded(z){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(z)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(z){this._loggingEnabled!==z&&(this._loggingEnabled=z,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(z){this._capturePerformanceCounters!==z&&(this._capturePerformanceCounters=z,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(z){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(z)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const z of this._requests)z.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=z=>Promise.resolve(z),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.lj.notifyObservers(void 0),this.lj.clear()}loadFile(z,a,K,m,p,j,s,r){if(ArrayBuffer.isView(a))return this._loadBinary(z,a,K,m,s,r),null;this._progressCallback=p;const W=a.name||T.h.GetFilename(a);if(j){if(this.useRangeRequests){this.validate&&M.c.Warn("glTF validation is not supported when range requests are enabled");const K={abort:()=>{},onCompleteObservable:new v.c},T={readAsync:(K,v)=>new Promise(((T,m)=>{this._loadFile(z,a,(z=>{T(new Uint8Array(z))}),!0,(z=>{m(z)}),(z=>{z.setRequestHeader("Range",`bytes=${K}-${K+v-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new H(T)).then((z=>{K.onCompleteObservable.notifyObservers(K),m(z)}),s?z=>s(void 0,z):void 0),K}return this._loadFile(z,a,(a=>{this._validate(z,new Uint8Array(a,0,a.byteLength),K,W),this._unpackBinaryAsync(new H({readAsync:(z,K)=>i(a,z,K),byteLength:a.byteLength})).then((z=>{m(z)}),s?z=>s(void 0,z):void 0)}),!0,s)}return this._loadFile(z,a,(a=>{try{this._validate(z,a,K,W),m({json:this._parseJson(a)})}catch{s&&s()}}),!1,s)}_loadBinary(z,a,K,v,T,m){this._validate(z,new Uint8Array(a.buffer,a.byteOffset,a.byteLength),K,m),this._unpackBinaryAsync(new H({readAsync:(z,K)=>function(z,a,K){try{if(a<0||a>=z.byteLength)throw new RangeError("Offset is out of range.");if(a+K>z.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(z.buffer,z.byteOffset+a,K))}catch(v){return Promise.reject(v)}}(a,z,K),byteLength:a.byteLength})).then((z=>{v(z)}),T?z=>T(void 0,z):void 0)}importMeshAsync(z,a,K,v,T,m){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(K),this.onParsedObservable.clear(),this._log(`Loading ${m||""}`),this._loader=this._getLoader(K),this._loader.importMeshAsync(z,a,null,K,v,T,m))))}loadAsync(z,a,K,v,T){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(a),this.onParsedObservable.clear(),this._log(`Loading ${T||""}`),this._loader=this._getLoader(a),this._loader.loadAsync(z,a,K,v,T))))}loadAssetContainerAsync(z,a,K,v,T){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(a),this.onParsedObservable.clear(),this._log(`Loading ${T||""}`),this._loader=this._getLoader(a);const m=new C(z),p=[];this.onMaterialLoadedObservable.add((z=>{p.push(z)}));const j=[];this.onTextureLoadedObservable.add((z=>{j.push(z)}));const s=[];this.onCameraLoadedObservable.add((z=>{s.push(z)}));const M=[];return this.onMeshLoadedObservable.add((z=>{z.morphTargetManager&&M.push(z.morphTargetManager)})),this._loader.importMeshAsync(null,z,m,a,K,v,T).then((z=>(Array.prototype.push.apply(m.geometries,z.geometries),Array.prototype.push.apply(m.meshes,z.meshes),Array.prototype.push.apply(m.sj,z.sj),Array.prototype.push.apply(m.skeletons,z.skeletons),Array.prototype.push.apply(m.animationGroups,z.animationGroups),Array.prototype.push.apply(m.materials,p),Array.prototype.push.apply(m.textures,j),Array.prototype.push.apply(m.lights,z.lights),Array.prototype.push.apply(m.transformNodes,z.transformNodes),Array.prototype.push.apply(m.cameras,s),Array.prototype.push.apply(m.morphTargetManagers,M),m)))}))}canDirectLoad(z){return I.canDirectLoad(z)}directLoad(z,a){if(a.startsWith("base64,"+Y)||a.startsWith(";base64,"+Y)||a.startsWith("application/octet-stream;base64,"+Y)||a.startsWith("model/gltf-binary;base64,"+Y)){const K=(0,Z.b)(a);return this._validate(z,new Uint8Array(K,0,K.byteLength)),this._unpackBinaryAsync(new H({readAsync:(z,a)=>i(K,z,a),byteLength:K.byteLength}))}return this._validate(z,a),Promise.resolve({json:this._parseJson(a)})}createPlugin(z){return new X(z[I.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((z,a)=>{this.onCompleteObservable.addOnce((()=>{z()})),this.onErrorObservable.addOnce((z=>{a(z)}))}))}_setState(z){this._state!==z&&(this._state=z,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(x[this._state]))}_loadFile(z,a,K,v,T,m){const p=z._loadFile(a,K,(z=>{this._onProgress(z,p)}),!0,v,T,m);return p.onCompleteObservable.add((()=>{p._lengthComputable=!0,p._total=p._loaded})),this._requests.push(p),p}_onProgress(z,a){if(!this._progressCallback)return;a._lengthComputable=z.lengthComputable,a._loaded=z.loaded,a._total=z.total;let K=!0,v=0,T=0;for(const m of this._requests){if(void 0===m._lengthComputable||void 0===m._loaded||void 0===m._total)return;K=K&&m._lengthComputable,v+=m._loaded,T+=m._total}this._progressCallback({lengthComputable:K,loaded:v,total:K?T:0})}_validate(z,a){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),f.d.ValidateAsync(a,K,v,(a=>this.preprocessUrlAsync(K+a).then((a=>z._loadFileAsync(a,void 0,!0,!0).then((z=>new Uint8Array(z,0,z.byteLength))))))).then((z=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(z),this.onValidatedObservable.clear()}),(z=>{this._endPerformanceCounter("Validate JSON"),T.h.Warn(`Failed to validate: ${z.message}`),this.onValidatedObservable.clear()})))}_getLoader(z){const a=z.json.asset||{};this._log(`Asset version: ${a.version}`),a.minVersion&&this._log(`Asset minimum version: ${a.minVersion}`),a.generator&&this._log(`Asset generator: ${a.generator}`);const K=X._parseVersion(a.version);if(!K)throw new Error("Invalid version: "+a.version);if(void 0!==a.minVersion){const z=X._parseVersion(a.minVersion);if(!z)throw new Error("Invalid minimum version: "+a.minVersion);if(X._compareVersion(z,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+a.minVersion)}const v={1:X._CreateGLTF1Loader,2:X._CreateGLTF2Loader}[K.major];if(!v)throw new Error("Unsupported version: "+a.version);return v(this)}_parseJson(z){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${z.length}`);const a=JSON.parse(z);return this._endPerformanceCounter("Parse JSON"),a}_unpackBinaryAsync(z){return this._startPerformanceCounter("Unpack Binary"),z.loadAsync(20).then((()=>{const a=z.readUint32();if(1179937895!==a)throw new y.h("Unexpected magic: "+a,y.e.GLTFLoaderUnexpectedMagicError);const K=z.readUint32();this.loggingEnabled&&this._log(`Binary version: ${K}`);const v=z.readUint32();let T;switch(this.useRangeRequests||v===z.buffer.byteLength||M.c.Warn(`Length in header does not match actual data length: ${v} != ${z.buffer.byteLength}`),K){case 1:T=this._unpackBinaryV1Async(z,v);break;case 2:T=this._unpackBinaryV2Async(z,v);break;default:throw new Error("Unsupported version: "+K)}return this._endPerformanceCounter("Unpack Binary"),T}))}_unpackBinaryV1Async(z,a){const K=z.readUint32(),v=z.readUint32();if(0!==v)throw new Error(`Unexpected content format: ${v}`);const T=a-z.byteOffset,m={json:this._parseJson(z.readString(K)),bin:null};if(0!==T){const a=z.byteOffset;m.bin={readAsync:(K,v)=>z.buffer.readAsync(a+K,v),byteLength:T}}return Promise.resolve(m)}_unpackBinaryV2Async(z,a){const K=1313821514,v=5130562,T=z.readUint32();if(z.readUint32()!==K)throw new Error("First chunk format is not JSON");return z.byteOffset+T===a?z.loadAsync(T).then((()=>({json:this._parseJson(z.readString(T)),bin:null}))):z.loadAsync(T+8).then((()=>{const m={json:this._parseJson(z.readString(T)),bin:null},p=()=>{const T=z.readUint32();switch(z.readUint32()){case K:throw new Error("Unexpected JSON chunk");case v:{const a=z.byteOffset;m.bin={readAsync:(K,v)=>z.buffer.readAsync(a+K,v),byteLength:T},z.skipBytes(T);break}default:z.skipBytes(T)}return z.byteOffset!==a?z.loadAsync(8).then(p):Promise.resolve(m)};return p()}))}static _parseVersion(z){if("1.0"===z||"1.0.1"===z)return{major:1,minor:0};const a=(z+"").match(/^(\d+)\.(\d+)/);return a?{major:parseInt(a[1]),minor:parseInt(a[2])}:null}static _compareVersion(z,a){return z.major>a.major?1:z.major<a.major?-1:z.minor>a.minor?1:z.minor<a.minor?-1:0}_logOpen(z){this._log(z),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(z){const a=X._logSpaces.substring(0,2*this._logIndentLevel);M.c.Log(`${a}${z}`)}_logDisabled(z){}_startPerformanceCounterEnabled(z){T.h.StartPerformanceCounter(z)}_startPerformanceCounterDisabled(z){}_endPerformanceCounterEnabled(z){T.h.EndPerformanceCounter(z)}_endPerformanceCounterDisabled(z){}}X.IncrementalLoading=!0,X.HomogeneousCoordinates=!1,X._logSpaces="                                ",(0,m.f)(new X)},11954:(z,a,K)=>{"use strict";K.d(a,{d:()=>p});var v=K(10631);function T(z,a,K,v){const T={externalResourceFunction:v};return K&&(T.uri="file:"===a?K:a+K),ArrayBuffer.isView(z)?GLTFValidator.validateBytes(z,T):GLTFValidator.validateString(z,T)}function m(){const z=[];onmessage=a=>{const K=a.data;switch(K.id){case"init":importScripts(K.url);break;case"validate":T(K.data,K.rootUrl,K.fileName,(a=>new Promise(((K,v)=>{const T=z.length;z.push({resolve:K,reject:v}),postMessage({id:"getExternalResource",index:T,uri:a})})))).then((z=>{postMessage({id:"validate.resolve",value:z})}),(z=>{postMessage({id:"validate.reject",reason:z})}));break;case"getExternalResource.resolve":z[K.index].resolve(K.value);break;case"getExternalResource.reject":z[K.index].reject(K.reason)}}}class p{static ValidateAsync(z,a,K,p){return"function"===typeof Worker?new Promise(((j,s)=>{const M=`${T}(${m})()`,r=URL.createObjectURL(new Blob([M],{type:"application/javascript"})),W=new Worker(r),F=z=>{W.removeEventListener("error",F),W.removeEventListener("message",G),s(z)},G=z=>{const a=z.data;switch(a.id){case"getExternalResource":p(a.uri).then((z=>{W.postMessage({id:"getExternalResource.resolve",index:a.index,value:z},[z.buffer])}),(z=>{W.postMessage({id:"getExternalResource.reject",index:a.index,reason:z})}));break;case"validate.resolve":W.removeEventListener("error",F),W.removeEventListener("message",G),j(a.value),W.terminate();break;case"validate.reject":W.removeEventListener("error",F),W.removeEventListener("message",G),s(a.reason),W.terminate()}};if(W.addEventListener("error",F),W.addEventListener("message",G),W.postMessage({id:"init",url:v.h.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(z)){const v=z.slice();W.postMessage({id:"validate",data:v,rootUrl:a,fileName:K},[v.buffer])}else W.postMessage({id:"validate",data:z,rootUrl:a,fileName:K})})):(this._LoadScriptPromise||(this._LoadScriptPromise=v.h.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>T(z,a,K,p))))}}p.Configuration={url:`${v.h._DefaultCdnUrl}/gltf_validator.js`}},12383:(z,a,K)=>{"use strict";K.d(a,{e:()=>q});var v=K(10923),T=K(10927),m=K(10973),p=K(10941),j=K(11127),s=K(11130),M=K(11001),r=K(10935),W=K(10767),F=K(10726);K(11613),K(11513),K(11536),K(11522),K(11539),K(11544),K(11548);const G="imageProcessingCompatibility",l="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";F.b.IncludesShadersStore[G]=l;const V="skyPixelShader",c="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";F.b.ShadersStore[V]=c;K(11618),K(11550),K(11559),K(11570),K(11561);const C="skyVertexShader",w="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";F.b.ShadersStore[C]=w;var H=K(11174),f=K(11119),Y=K(11114);class I extends j.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class q extends s.c{constructor(z,a){super(z,a),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new p.o(0,100,0),this.useSunPosition=!1,this.cameraOffset=p.o.Zero(),this.up=p.o.Up(),this.dithering=!1,this._cameraPosition=p.o.Zero(),this._skyOrientation=new p.f}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(z,a){const K=a._drawWrapper;if(this.isFrozen&&K.effect&&K._wasPreviouslyReady)return!0;a.materialDefines||(a.materialDefines=new I);const v=a.materialDefines,T=this.va();if(this._isReadyForSubMesh(a))return!0;if((0,Y.ab)(z,T,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,v),(0,Y.P)(z,v,!0,!1),v.IMAGEPROCESSINGPOSTPROCESS!==T.imageProcessingConfiguration.applyByPostProcess&&v.markAsMiscDirty(),v.DITHER!==this.dithering&&v.markAsMiscDirty(),v.isDirty){v.markAsProcessed(),T.resetCachedMaterial();const z=new H.d;v.FOG&&z.addFallback(1,"FOG"),v.IMAGEPROCESSINGPOSTPROCESS=T.imageProcessingConfiguration.applyByPostProcess,v.DITHER=this.dithering;const K=[M.h.PositionKind];v.VERTEXCOLOR&&K.push(M.h.ColorKind);const m="sky",p=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,f.e)(p);const j=v.toString();a.setEffect(T.getEngine().createEffect(m,K,p,[],j,z,this.onCompiled,this.onError),v,this._materialContext)}return!(!a.effect||!a.effect.isReady())&&(v._renderId=T.getRenderId(),K._wasPreviouslyReady=!0,!0)}bindForSubMesh(z,a,K){const v=this.va(),T=K.materialDefines;if(!T)return;const m=K.effect;if(!m)return;this._activeEffect=m,this.bindOnlyWorldMatrix(z),this._activeEffect.setMatrix("viewProjection",v.getTransformMatrix()),this._mustRebind(v,m,K)&&((0,f.h)(m,this,v),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,Y.m)(T,m,v)),v.fogEnabled&&a.applyFog&&v.fogMode!==r.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",v.getViewMatrix()),(0,Y.h)(v,a,this._activeEffect);const j=v.activeCamera;if(j){const z=j.getWorldMatrix();this._cameraPosition.x=z.m[12],this._cameraPosition.y=z.m[13],this._cameraPosition.z=z.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const z=Math.PI*(this.inclination-.5),a=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(a)*Math.cos(z),this.sunPosition.y=this.distance*Math.sin(-z),this.sunPosition.z=this.distance*Math.sin(a)*Math.cos(z),p.f.FromUnitVectorsToRef(p.o.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(a,this._activeEffect,K)}getAnimatables(){return[]}dispose(z){super.dispose(z)}clone(z){return m.e.Clone((()=>new q(z,this.va())),this)}serialize(){const z=super.serialize();return z.customType="BABYLON.SkyMaterial",z}getClassName(){return"SkyMaterial"}static Parse(z,a,K){return m.e.Parse((()=>new q(z.name,a)),z,a,K)}}(0,v.e)([(0,T.D)()],q.prototype,"luminance",void 0),(0,v.e)([(0,T.D)()],q.prototype,"turbidity",void 0),(0,v.e)([(0,T.D)()],q.prototype,"rayleigh",void 0),(0,v.e)([(0,T.D)()],q.prototype,"mieCoefficient",void 0),(0,v.e)([(0,T.D)()],q.prototype,"mieDirectionalG",void 0),(0,v.e)([(0,T.D)()],q.prototype,"distance",void 0),(0,v.e)([(0,T.D)()],q.prototype,"inclination",void 0),(0,v.e)([(0,T.D)()],q.prototype,"azimuth",void 0),(0,v.e)([(0,T.B)()],q.prototype,"sunPosition",void 0),(0,v.e)([(0,T.D)()],q.prototype,"useSunPosition",void 0),(0,v.e)([(0,T.B)()],q.prototype,"cameraOffset",void 0),(0,v.e)([(0,T.B)()],q.prototype,"up",void 0),(0,v.e)([(0,T.D)()],q.prototype,"dithering",void 0),(0,W.e)("BABYLON.SkyMaterial",q)},10473:(z,a,K)=>{"use strict";function v(z,a){a.headers=z.headers||{},a.statusMessage=z.statusText,a.statusCode=z.status,a.data=z.response}function T(z,a,K){return new Promise((function(T,m){K=K||{};var p,j,s,M=new XMLHttpRequest,r=K.body,W=K.headers||{};for(p in K.timeout&&(M.timeout=K.timeout),M.ontimeout=M.onerror=function(z){z.timeout="timeout"==z.type,m(z)},M.open(z,a.href||a),M.onload=function(){for(s=M.getAllResponseHeaders().trim().split(/[\r\n]+/),v(M,M);j=s.shift();)j=j.split(": "),M.headers[j.shift().toLowerCase()]=j.join(": ");if((j=M.headers["content-type"])&&~j.indexOf("application/json"))try{M.data=JSON.parse(M.data,K.reviver)}catch(z){return v(M,z),m(z)}(M.status>=400?m:T)(M)},typeof FormData<"u"&&r instanceof FormData||r&&"object"==typeof r&&(W["content-type"]="application/json",r=JSON.stringify(r)),M.withCredentials=!!K.withCredentials,W)M.setRequestHeader(p,W[p]);M.send(r)}))}K.r(a),K.d(a,{del:()=>s,get:()=>m,patch:()=>j,post:()=>p,put:()=>M,send:()=>T});var m=T.bind(T,"GET"),p=T.bind(T,"POST"),j=T.bind(T,"PATCH"),s=T.bind(T,"DELETE"),M=T.bind(T,"PUT")},12468:(z,a,K)=>{"use strict";K.d(a,{c:()=>W});const v=.5*(Math.sqrt(3)-1),T=(3-Math.sqrt(3))/6,m=1/3,p=1/6,j=(Math.sqrt(5)-1)/4,s=(5-Math.sqrt(5))/20,M=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),r=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const W=class{constructor(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const a="function"==typeof z?z:function(z){let a=0,K=0,v=0,T=1;const m=function(){let z=4022871197;return function(a){a=a.toString();for(let K=0;K<a.length;K++){z+=a.charCodeAt(K);let v=.02519603282416938*z;z=v>>>0,v-=z,v*=z,z=v>>>0,v-=z,z+=4294967296*v}return 2.3283064365386963e-10*(z>>>0)}}();a=m(" "),K=m(" "),v=m(" "),a-=m(z),a<0&&(a+=1);K-=m(z),K<0&&(K+=1);v-=m(z),v<0&&(v+=1);return function(){const z=2091639*a+2.3283064365386963e-10*T;return a=K,K=v,v=z-(T=0|z)}}(z);this.p=function(z){const a=new Uint8Array(256);for(let K=0;K<256;K++)a[K]=K;for(let K=0;K<255;K++){const v=K+~~(z()*(256-K)),T=a[K];a[K]=a[v],a[v]=T}return a}(a),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let K=0;K<512;K++)this.perm[K]=this.p[255&K],this.permMod12[K]=this.perm[K]%12}noise2D(z,a){const K=this.permMod12,m=this.perm;let p=0,j=0,s=0;const r=(z+a)*v,W=Math.floor(z+r),F=Math.floor(a+r),G=(W+F)*T,l=z-(W-G),V=a-(F-G);let c,C;l>V?(c=1,C=0):(c=0,C=1);const w=l-c+T,H=V-C+T,f=l-1+2*T,Y=V-1+2*T,I=255&W,q=255&F;let B=.5-l*l-V*V;if(B>=0){const z=3*K[I+m[q]];B*=B,p=B*B*(M[z]*l+M[z+1]*V)}let x=.5-w*w-H*H;if(x>=0){const z=3*K[I+c+m[q+C]];x*=x,j=x*x*(M[z]*w+M[z+1]*H)}let Z=.5-f*f-Y*Y;if(Z>=0){const z=3*K[I+1+m[q+1]];Z*=Z,s=Z*Z*(M[z]*f+M[z+1]*Y)}return 70*(p+j+s)}noise3D(z,a,K){const v=this.permMod12,T=this.perm;let j,s,r,W;const F=(z+a+K)*m,G=Math.floor(z+F),l=Math.floor(a+F),V=Math.floor(K+F),c=(G+l+V)*p,C=z-(G-c),w=a-(l-c),H=K-(V-c);let f,Y,I,q,B,x;C>=w?w>=H?(f=1,Y=0,I=0,q=1,B=1,x=0):C>=H?(f=1,Y=0,I=0,q=1,B=0,x=1):(f=0,Y=0,I=1,q=1,B=0,x=1):w<H?(f=0,Y=0,I=1,q=0,B=1,x=1):C<H?(f=0,Y=1,I=0,q=0,B=1,x=1):(f=0,Y=1,I=0,q=1,B=1,x=0);const Z=C-f+p,y=w-Y+p,i=H-I+p,n=C-q+2*p,X=w-B+2*p,P=H-x+2*p,J=C-1+.5,o=w-1+.5,N=H-1+.5,A=255&G,g=255&l,d=255&V;let t=.6-C*C-w*w-H*H;if(t<0)j=0;else{const z=3*v[A+T[g+T[d]]];t*=t,j=t*t*(M[z]*C+M[z+1]*w+M[z+2]*H)}let e=.6-Z*Z-y*y-i*i;if(e<0)s=0;else{const z=3*v[A+f+T[g+Y+T[d+I]]];e*=e,s=e*e*(M[z]*Z+M[z+1]*y+M[z+2]*i)}let L=.6-n*n-X*X-P*P;if(L<0)r=0;else{const z=3*v[A+q+T[g+B+T[d+x]]];L*=L,r=L*L*(M[z]*n+M[z+1]*X+M[z+2]*P)}let E=.6-J*J-o*o-N*N;if(E<0)W=0;else{const z=3*v[A+1+T[g+1+T[d+1]]];E*=E,W=E*E*(M[z]*J+M[z+1]*o+M[z+2]*N)}return 32*(j+s+r+W)}noise4D(z,a,K,v){const T=this.perm;let m,p,M,W,F;const G=(z+a+K+v)*j,l=Math.floor(z+G),V=Math.floor(a+G),c=Math.floor(K+G),C=Math.floor(v+G),w=(l+V+c+C)*s,H=z-(l-w),f=a-(V-w),Y=K-(c-w),I=v-(C-w);let q=0,B=0,x=0,Z=0;H>f?q++:B++,H>Y?q++:x++,H>I?q++:Z++,f>Y?B++:x++,f>I?B++:Z++,Y>I?x++:Z++;const y=q>=3?1:0,i=B>=3?1:0,n=x>=3?1:0,X=Z>=3?1:0,P=q>=2?1:0,J=B>=2?1:0,o=x>=2?1:0,N=Z>=2?1:0,A=q>=1?1:0,g=B>=1?1:0,d=x>=1?1:0,t=Z>=1?1:0,e=H-y+s,L=f-i+s,E=Y-n+s,b=I-X+s,D=H-P+2*s,u=f-J+2*s,U=Y-o+2*s,R=I-N+2*s,k=H-A+3*s,h=f-g+3*s,S=Y-d+3*s,Q=I-t+3*s,O=H-1+4*s,zz=f-1+4*s,az=Y-1+4*s,Kz=I-1+4*s,vz=255&l,Tz=255&V,mz=255&c,pz=255&C;let jz=.6-H*H-f*f-Y*Y-I*I;if(jz<0)m=0;else{const z=T[vz+T[Tz+T[mz+T[pz]]]]%32*4;jz*=jz,m=jz*jz*(r[z]*H+r[z+1]*f+r[z+2]*Y+r[z+3]*I)}let sz=.6-e*e-L*L-E*E-b*b;if(sz<0)p=0;else{const z=T[vz+y+T[Tz+i+T[mz+n+T[pz+X]]]]%32*4;sz*=sz,p=sz*sz*(r[z]*e+r[z+1]*L+r[z+2]*E+r[z+3]*b)}let Mz=.6-D*D-u*u-U*U-R*R;if(Mz<0)M=0;else{const z=T[vz+P+T[Tz+J+T[mz+o+T[pz+N]]]]%32*4;Mz*=Mz,M=Mz*Mz*(r[z]*D+r[z+1]*u+r[z+2]*U+r[z+3]*R)}let rz=.6-k*k-h*h-S*S-Q*Q;if(rz<0)W=0;else{const z=T[vz+A+T[Tz+g+T[mz+d+T[pz+t]]]]%32*4;rz*=rz,W=rz*rz*(r[z]*k+r[z+1]*h+r[z+2]*S+r[z+3]*Q)}let Wz=.6-O*O-zz*zz-az*az-Kz*Kz;if(Wz<0)F=0;else{const z=T[vz+1+T[Tz+1+T[mz+1+T[pz+1]]]]%32*4;Wz*=Wz,F=Wz*Wz*(r[z]*O+r[z+1]*zz+r[z+2]*az+r[z+3]*Kz)}return 27*(m+p+M+W+F)}}}}]);