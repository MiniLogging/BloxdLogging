"use strict";(self.i6szn8jgzh=self.i6szn8jgzh||[]).push([[9],{11667:(b,n,i)=>{i.d(n,{b:()=>a,d:()=>M,g:()=>j,e:()=>C,i:()=>t});class e{constructor(){this.children=[]}isValid(b){return!0}process(b,n,i){let e="";if(this.line){let i=this.line;const mb=n.processor;if(mb){var V,Q,U,Y,L,B;mb.lineProcessor&&(i=mb.lineProcessor(i,n.isFragment,n.processingContext));const e=(null===(V=n.processor)||void 0===V?void 0:V.attributeKeywordName)??"attribute",N=n.isFragment&&null!==(Q=n.processor)&&void 0!==Q&&Q.varyingFragmentKeywordName?null===(U=n.processor)||void 0===U?void 0:U.varyingFragmentKeywordName:!n.isFragment&&null!==(Y=n.processor)&&void 0!==Y&&Y.varyingVertexKeywordName?null===(L=n.processor)||void 0===L?void 0:L.varyingVertexKeywordName:"varying";if(!n.isFragment&&mb.attributeProcessor&&this.line.startsWith(e))i=mb.attributeProcessor(this.line,b,n.processingContext);else if(mb.varyingProcessor&&(null!==(B=mb.varyingCheck)&&void 0!==B&&B.call(mb,this.line,n.isFragment)||!mb.varyingCheck&&this.line.startsWith(N)))i=mb.varyingProcessor(this.line,n.isFragment,b,n.processingContext);else if(mb.uniformProcessor&&mb.uniformRegexp&&mb.uniformRegexp.test(this.line))n.lookForClosingBracketForUniformBuffer||(i=mb.uniformProcessor(this.line,n.isFragment,b,n.processingContext));else if(mb.uniformBufferProcessor&&mb.uniformBufferRegexp&&mb.uniformBufferRegexp.test(this.line))n.lookForClosingBracketForUniformBuffer||(i=mb.uniformBufferProcessor(this.line,n.isFragment,n.processingContext),n.lookForClosingBracketForUniformBuffer=!0);else if(mb.textureProcessor&&mb.textureRegexp&&mb.textureRegexp.test(this.line))i=mb.textureProcessor(this.line,n.isFragment,b,n.processingContext);else if((mb.uniformProcessor||mb.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!n.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?mb.uniformProcessor&&(i=mb.uniformProcessor(this.line,n.isFragment,b,n.processingContext)):mb.uniformBufferProcessor&&(i=mb.uniformBufferProcessor(this.line,n.isFragment,n.processingContext),n.lookForClosingBracketForUniformBuffer=!0)}n.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(n.lookForClosingBracketForUniformBuffer=!1,mb.endOfUniformBufferProcessor&&(i=mb.endOfUniformBufferProcessor(this.line,n.isFragment,n.processingContext)))}e+=i+"\n"}for(const mb of this.children)e+=mb.process(b,n,i);return this.additionalDefineKey&&(b[this.additionalDefineKey]=this.additionalDefineValue||"true",i[this.additionalDefineKey]=b[this.additionalDefineKey]),e}}class V{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(b){this._lines.length=0;for(const n of b){if(!n||"\r"===n)continue;if("#"===n[0]){this._lines.push(n);continue}const b=n.trim();if(!b)continue;if(b.startsWith("//")){this._lines.push(n);continue}const i=b.indexOf(";");if(-1===i)this._lines.push(b);else if(i===b.length-1)b.length>1&&this._lines.push(b);else{const b=n.split(";");for(let n=0;n<b.length;n++){let i=b[n];i&&(i=i.trim(),i&&this._lines.push(i+(n!==b.length-1?";":"")))}}}}}class Q extends e{process(b,n,i){for(let e=0;e<this.children.length;e++){const V=this.children[e];if(V.isValid(b))return V.process(b,n,i)}return""}}class U extends e{isValid(b){return this.testExpression.isTrue(b)}}class Y{isTrue(b){return!0}static postfixToInfix(b){const n=[];for(const i of b)if(void 0===Y._OperatorPriority[i])n.push(i);else{const b=n[n.length-1],e=n[n.length-2];n.length-=2,n.push(`(${e}${i}${b})`)}return n[n.length-1]}static infixToPostfix(b){const n=Y._InfixToPostfixCache.get(b);if(n)return n.accessTime=Date.now(),n.result;if(!b.includes("&&")&&!b.includes("||")&&!b.includes(")")&&!b.includes("("))return[b];const i=[];let e=-1;const V=()=>{mb=mb.trim(),""!==mb&&(i.push(mb),mb="")},Q=b=>{e<Y._Stack.length-1&&(Y._Stack[++e]=b)},U=()=>Y._Stack[e],L=()=>-1===e?"!!INVALID EXPRESSION!!":Y._Stack[e--];let B=0,mb="";for(;B<b.length;){const n=b.charAt(B),N=B<b.length-1?b.substring(B,2+B):"";if("("===n)mb="",Q(n);else if(")"===n){for(V();-1!==e&&"("!==U();)i.push(L());L()}else if(Y._OperatorPriority[N]>1){for(V();-1!==e&&Y._OperatorPriority[U()]>=Y._OperatorPriority[N];)i.push(L());Q(N),B++}else mb+=n;B++}for(V();-1!==e;)"("===U()?L():i.push(L());return Y._InfixToPostfixCache.size>=Y.InfixToPostfixCacheLimitSize&&Y.ClearCache(),Y._InfixToPostfixCache.set(b,{result:i,accessTime:Date.now()}),i}static ClearCache(){const b=Array.from(Y._InfixToPostfixCache.entries()).sort(((b,n)=>b[1].accessTime-n[1].accessTime));for(let n=0;n<Y.InfixToPostfixCacheCleanupSize;n++)Y._InfixToPostfixCache.delete(b[n][0])}}Y.InfixToPostfixCacheLimitSize=5e4,Y.InfixToPostfixCacheCleanupSize=25e3,Y._InfixToPostfixCache=new Map,Y._OperatorPriority={")":0,"(":1,"||":2,"&&":3},Y._Stack=["","","","","","","","","","","","","","","","","","","",""];class L extends Y{constructor(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=b,this.not=n}isTrue(b){let n=void 0!==b[this.define];return this.not&&(n=!n),n}}class B extends Y{isTrue(b){return this.leftOperand.isTrue(b)||this.rightOperand.isTrue(b)}}class mb extends Y{isTrue(b){return this.leftOperand.isTrue(b)&&this.rightOperand.isTrue(b)}}class N extends Y{constructor(b,n,i){super(),this.define=b,this.operand=n,this.testValue=i}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(b){let n=!1;const i=parseInt(void 0!=b[this.define]?b[this.define]:this.define),e=parseInt(void 0!=b[this.testValue]?b[this.testValue]:this.testValue);if(isNaN(i)||isNaN(e))return!1;switch(this.operand){case">":n=i>e;break;case"<":n=i<e;break;case"<=":n=i<=e;break;case">=":n=i>=e;break;case"==":n=i===e;break;case"!=":n=i!==e}return n}}var Z=i(11636),T=i(11672);const z=/defined\s*?\((.+?)\)/g,K=/defined\s*?\[(.+?)\]/g,I=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,O=/__decl__/,u=/light\{X\}.(\w*)/g,d=/\{X\}/g,G=[],o=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function M(b){b.processor&&b.processor.initializeShaders&&b.processor.initializeShaders(b.processingContext)}function j(b,n,i,e){var V;null!==(V=n.processor)&&void 0!==V&&V.preProcessShaderCode&&(b=n.processor.preProcessShaderCode(b,n.isFragment)),C(b,n,(b=>{n.processCodeAfterIncludes&&(b=n.processCodeAfterIncludes(n.isFragment?"fragment":"vertex",b,n.defines));const V=function(b,n,i){let e=function(b,n){var i;if(null!==(i=n.processor)&&void 0!==i&&i.noPrecision)return b;const e=n.shouldUseHighPrecisionShader;-1===b.indexOf("precision highp float")?b=e?"precision highp float;\n"+b:"precision mediump float;\n"+b:e||(b=b.replace("precision highp float","precision mediump float"));return b}(b,n);if(!n.processor)return e;if(0===n.processor.shaderLanguage&&-1!==e.indexOf("#version 3")&&(e=e.replace("#version 300 es",""),!n.processor.parseGLES3))return e;const V=n.defines,Q=E(n,i);n.processor.preProcessor&&(e=n.processor.preProcessor(e,V,Q,n.isFragment,n.processingContext));const U={};e=A(e,Q,n,U),n.processor.postProcessor&&(e=n.processor.postProcessor(e,V,n.isFragment,n.processingContext,i?{drawBuffersExtensionDisabled:!i.getCaps().drawBuffersExtension}:{},Q,U));null!==i&&void 0!==i&&i._features.needShaderCodeInlining&&(e=i.inlineShaderCode(e));return e}(b,n,e);i(V,b)}))}function a(b,n,i){return i.processor&&i.processor.finalizeShaders?i.processor.finalizeShaders(b,n,i.processingContext):{vertexCode:b,fragmentCode:n}}function D(b){const n=/defined\((.+)\)/.exec(b);if(n&&n.length)return new L(n[1].trim(),"!"===b[0]);const i=["==","!=",">=","<=","<",">"];let e="",V=0;for(e of i)if(V=b.indexOf(e),V>-1)break;if(-1===V)return new L(b);const Q=b.substring(0,V).trim(),U=b.substring(V+e.length).trim();return new N(Q,e,U)}function x(b,n){const i=new U,e=b.substring(0,n);let V=b.substring(n);return V=V.substring(0,(V.indexOf("//")+1||V.length+1)-1).trim(),i.testExpression="#ifdef"===e?new L(V):"#ifndef"===e?new L(V,!0):function(b){b=b.replace(z,"defined[$1]");const n=Y.infixToPostfix(b),i=[];for(const V of n)if("||"!==V&&"&&"!==V)i.push(V);else if(i.length>=2){let b=i[i.length-1],n=i[i.length-2];i.length-=2;const e="&&"==V?new mb:new B;"string"===typeof b&&(b=b.replace(K,"defined($1)")),"string"===typeof n&&(n=n.replace(K,"defined($1)")),e.leftOperand="string"===typeof n?D(n):n,e.rightOperand="string"===typeof b?D(b):b,i.push(e)}let e=i[i.length-1];return"string"===typeof e&&(e=e.replace(K,"defined($1)")),"string"===typeof e?D(e):e}(V),i}function y(b,n,i,V){let Q=b.currentLine;for(;s(b,i,V);){Q=b.currentLine;const U=Q.substring(0,5).toLowerCase();if("#else"===U){const i=new e;return n.children.push(i),void s(b,i,V)}if("#elif"===U){const b=x(Q,5);n.children.push(b),i=b}}}function s(b,n,i){for(;b.canRead;){b.lineIndex++;const V=b.currentLine;if(V.indexOf("#")>=0){const e=o.exec(V);if(e&&e.length){switch(e[0]){case"#ifdef":{const e=new Q;n.children.push(e);const U=x(V,6);e.children.push(U),y(b,e,U,i);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const e=new Q;n.children.push(e);const U=x(V,7);e.children.push(U),y(b,e,U,i);break}case"#if":{const e=new Q,U=x(V,3);n.children.push(e),e.children.push(U),y(b,e,U,i);break}}continue}}const U=new e;if(U.line=V,n.children.push(U),"#"===V[0]&&"d"===V[1]){const b=V.replace(";","").split(" ");U.additionalDefineKey=b[1],3===b.length&&(U.additionalDefineValue=b[2])}}return!1}function A(b,n,i,Q){const U=new e,Y=new V;return Y.lineIndex=-1,Y.lines=b.split("\n"),s(Y,U,Q),U.process(n,i,Q)}function E(b,n){var i;const e=b.defines,V={};for(const Q of e){const b=Q.replace("#define","").replace(";","").trim().split(" ");V[b[0]]=b.length>1?b[1]:""}return 0===(null===(i=b.processor)||void 0===i?void 0:i.shaderLanguage)&&(V.GL_ES="true"),V.__VERSION__=b.version,V[b.platformName]="true",(0,T.g)(V,null===n||void 0===n?void 0:n.isNDCHalfZRange,null===n||void 0===n?void 0:n.useReverseDepthBuffer,null===n||void 0===n?void 0:n.useExactSrgbConversions),V}function C(b,n,i){let e;for(G.length=0;null!==(e=I.exec(b));)G.push(e);let V=String(b),Q=[b],U=!1;for(const Y of G){let b=Y[1];if(-1!==b.indexOf("__decl__")&&(b=b.replace(O,""),n.supportsUniformBuffers&&(b=b.replace("Vertex","Ubo").replace("Fragment","Ubo")),b+="Declaration"),!n.includesShadersStore[b]){const e=n.shadersRepository+"ShadersInclude/"+b+".fx";return void t.loadFile(e,(e=>{n.includesShadersStore[b]=e,C(Q.join(""),n,i)}))}{let i=n.includesShadersStore[b];if(Y[2]){const b=Y[3].split(",");for(let n=0;n<b.length;n+=2){const e=new RegExp(b[n],"g"),V=b[n+1];i=i.replace(e,V)}}if(Y[4]){const b=Y[5];if(-1!==b.indexOf("..")){const e=b.split(".."),V=parseInt(e[0]);let Q=parseInt(e[1]),U=i.slice(0);i="",isNaN(Q)&&(Q=n.indexParameters[e[1]]);for(let b=V;b<Q;b++)n.supportsUniformBuffers||(U=U.replace(u,((b,n)=>n+"{X}"))),i+=U.replace(d,b.toString())+"\n"}else n.supportsUniformBuffers||(i=i.replace(u,((b,n)=>n+"{X}"))),i=i.replace(d,b)}const e=[];for(const b of Q){const n=b.split(Y[0]);for(let b=0;b<n.length-1;b++)e.push(n[b]),e.push(i);e.push(n[n.length-1])}Q=e,U=U||i.indexOf("#include<")>=0||i.indexOf("#include <")>=0}}G.length=0,V=Q.join(""),U?C(V.toString(),n,i):i(V)}const t={loadFile:(b,n,i,e,V,Q)=>{throw(0,Z.e)("FileTools")}}},11672:(b,n,i)=>{i.d(n,{b:()=>V,d:()=>Q,g:()=>Y,i:()=>U,m:()=>L});var e=i(11636);i(11616);const V={};function Q(b,n){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(n?n+"\n":"")+b}function U(b,n,i,Q,U,Y,L){const B=L||V.loadFile;if(B){return B(b,n,i,Q,U,Y)}throw(0,e.e)("FileTools")}function Y(b,n,i,e){if(b)return n?b.IS_NDC_HALF_ZRANGE="":delete b.IS_NDC_HALF_ZRANGE,i?b.USE_REVERSE_DEPTHBUFFER="":delete b.USE_REVERSE_DEPTHBUFFER,void(e?b.USE_EXACT_SRGB_CONVERSIONS="":delete b.USE_EXACT_SRGB_CONVERSIONS);{let b="";return n&&(b+="#define IS_NDC_HALF_ZRANGE"),i&&(b&&(b+="\n"),b+="#define USE_REVERSE_DEPTHBUFFER"),e&&(b&&(b+="\n"),b+="#define USE_EXACT_SRGB_CONVERSIONS"),b}}function L(b,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3?arguments[3]:void 0;switch(b){case 3:{const b=(ArrayBuffer,new Int8Array(n));return e&&b.set(new Int8Array(e)),b}case 0:{const b=(ArrayBuffer,new Uint8Array(n));return e&&b.set(new Uint8Array(e)),b}case 4:{const b=n instanceof ArrayBuffer?new Int16Array(n):new Int16Array(i?n/2:n);return e&&b.set(new Int16Array(e)),b}case 5:case 8:case 9:case 10:case 2:{const b=n instanceof ArrayBuffer?new Uint16Array(n):new Uint16Array(i?n/2:n);return e&&b.set(new Uint16Array(e)),b}case 6:{const b=n instanceof ArrayBuffer?new Int32Array(n):new Int32Array(i?n/4:n);return e&&b.set(new Int32Array(e)),b}case 7:case 11:case 12:case 13:case 14:case 15:{const b=n instanceof ArrayBuffer?new Uint32Array(n):new Uint32Array(i?n/4:n);return e&&b.set(new Uint32Array(e)),b}case 1:{const b=n instanceof ArrayBuffer?new Float32Array(n):new Float32Array(i?n/4:n);return e&&b.set(new Float32Array(e)),b}}const V=(ArrayBuffer,new Uint8Array(n));return e&&V.set(new Uint8Array(e)),V}},11686:(b,n,i)=>{i.d(n,{c:()=>e});class e{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?e.ShadersRepository:e.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?e.ShadersStore:e.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?e.IncludesShadersStore:e.IncludesShadersStoreWGSL}}e.ShadersRepository="src/Shaders/",e.ShadersStore={},e.IncludesShadersStore={},e.ShadersRepositoryWGSL="src/ShadersWGSL/",e.ShadersStoreWGSL={},e.IncludesShadersStoreWGSL={}},11697:(b,n,i)=>{i.d(n,{b:()=>Z,c:()=>d,g:()=>z,h:()=>T,i:()=>K,k:()=>u,m:()=>N,n:()=>B,p:()=>mb,t:()=>L,u:()=>Y});class e{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.In._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(b){b&&this.program&&b(this.program)}setEngine(b){this.In=b}_fillEffectInformation(b,n,i,e,V,Q,U,Y){const L=this.In;if(L.supportsUniformBuffers)for(const mb in n)b.bindUniformBlock(mb,n[mb]);let B;for(this.In.getUniforms(this,i).forEach(((b,n)=>{e[i[n]]=b})),this._uniforms=e,B=0;B<V.length;B++){null==b.getUniform(V[B])&&(V.splice(B,1),B--)}V.forEach(((b,n)=>{Q[b]=n}));for(const mb of L.getAttributes(this,U))Y.push(mb)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(b,n){const i=this._valueCache[b],e=n.updateFlag;return(void 0===i||i!==e)&&(this._valueCache[b]=e,!0)}_cacheFloat2(b,n,i){let e=this._valueCache[b];if(!e||2!==e.length)return e=[n,i],this._valueCache[b]=e,!0;let V=!1;return e[0]!==n&&(e[0]=n,V=!0),e[1]!==i&&(e[1]=i,V=!0),V}_cacheFloat3(b,n,i,e){let V=this._valueCache[b];if(!V||3!==V.length)return V=[n,i,e],this._valueCache[b]=V,!0;let Q=!1;return V[0]!==n&&(V[0]=n,Q=!0),V[1]!==i&&(V[1]=i,Q=!0),V[2]!==e&&(V[2]=e,Q=!0),Q}_cacheFloat4(b,n,i,e,V){let Q=this._valueCache[b];if(!Q||4!==Q.length)return Q=[n,i,e,V],this._valueCache[b]=Q,!0;let U=!1;return Q[0]!==n&&(Q[0]=n,U=!0),Q[1]!==i&&(Q[1]=i,U=!0),Q[2]!==e&&(Q[2]=e,U=!0),Q[3]!==V&&(Q[3]=V,U=!0),U}setInt(b,n){const i=this._valueCache[b];void 0!==i&&i===n||this.In.setInt(this._uniforms[b],n)&&(this._valueCache[b]=n)}setInt2(b,n,i){this._cacheFloat2(b,n,i)&&(this.In.setInt2(this._uniforms[b],n,i)||(this._valueCache[b]=null))}setInt3(b,n,i,e){this._cacheFloat3(b,n,i,e)&&(this.In.setInt3(this._uniforms[b],n,i,e)||(this._valueCache[b]=null))}setInt4(b,n,i,e,V){this._cacheFloat4(b,n,i,e,V)&&(this.In.setInt4(this._uniforms[b],n,i,e,V)||(this._valueCache[b]=null))}setIntArray(b,n){this._valueCache[b]=null,this.In.setIntArray(this._uniforms[b],n)}setIntArray2(b,n){this._valueCache[b]=null,this.In.setIntArray2(this._uniforms[b],n)}setIntArray3(b,n){this._valueCache[b]=null,this.In.setIntArray3(this._uniforms[b],n)}setIntArray4(b,n){this._valueCache[b]=null,this.In.setIntArray4(this._uniforms[b],n)}setUInt(b,n){const i=this._valueCache[b];void 0!==i&&i===n||this.In.setUInt(this._uniforms[b],n)&&(this._valueCache[b]=n)}setUInt2(b,n,i){this._cacheFloat2(b,n,i)&&(this.In.setUInt2(this._uniforms[b],n,i)||(this._valueCache[b]=null))}setUInt3(b,n,i,e){this._cacheFloat3(b,n,i,e)&&(this.In.setUInt3(this._uniforms[b],n,i,e)||(this._valueCache[b]=null))}setUInt4(b,n,i,e,V){this._cacheFloat4(b,n,i,e,V)&&(this.In.setUInt4(this._uniforms[b],n,i,e,V)||(this._valueCache[b]=null))}setUIntArray(b,n){this._valueCache[b]=null,this.In.setUIntArray(this._uniforms[b],n)}setUIntArray2(b,n){this._valueCache[b]=null,this.In.setUIntArray2(this._uniforms[b],n)}setUIntArray3(b,n){this._valueCache[b]=null,this.In.setUIntArray3(this._uniforms[b],n)}setUIntArray4(b,n){this._valueCache[b]=null,this.In.setUIntArray4(this._uniforms[b],n)}setArray(b,n){this._valueCache[b]=null,this.In.setArray(this._uniforms[b],n)}setArray2(b,n){this._valueCache[b]=null,this.In.setArray2(this._uniforms[b],n)}setArray3(b,n){this._valueCache[b]=null,this.In.setArray3(this._uniforms[b],n)}setArray4(b,n){this._valueCache[b]=null,this.In.setArray4(this._uniforms[b],n)}setMatrices(b,n){n&&(this._valueCache[b]=null,this.In.setMatrices(this._uniforms[b],n))}setMatrix(b,n){this._cacheMatrix(b,n)&&(this.In.setMatrices(this._uniforms[b],n.ye())||(this._valueCache[b]=null))}setMatrix3x3(b,n){this._valueCache[b]=null,this.In.setMatrix3x3(this._uniforms[b],n)}setMatrix2x2(b,n){this._valueCache[b]=null,this.In.setMatrix2x2(this._uniforms[b],n)}setFloat(b,n){const i=this._valueCache[b];void 0!==i&&i===n||this.In.setFloat(this._uniforms[b],n)&&(this._valueCache[b]=n)}setVector2(b,n){this._cacheFloat2(b,n.x,n.y)&&(this.In.setFloat2(this._uniforms[b],n.x,n.y)||(this._valueCache[b]=null))}setFloat2(b,n,i){this._cacheFloat2(b,n,i)&&(this.In.setFloat2(this._uniforms[b],n,i)||(this._valueCache[b]=null))}setVector3(b,n){this._cacheFloat3(b,n.x,n.y,n.z)&&(this.In.setFloat3(this._uniforms[b],n.x,n.y,n.z)||(this._valueCache[b]=null))}setFloat3(b,n,i,e){this._cacheFloat3(b,n,i,e)&&(this.In.setFloat3(this._uniforms[b],n,i,e)||(this._valueCache[b]=null))}setVector4(b,n){this._cacheFloat4(b,n.x,n.y,n.z,n.w)&&(this.In.setFloat4(this._uniforms[b],n.x,n.y,n.z,n.w)||(this._valueCache[b]=null))}setQuaternion(b,n){this._cacheFloat4(b,n.x,n.y,n.z,n.w)&&(this.In.setFloat4(this._uniforms[b],n.x,n.y,n.z,n.w)||(this._valueCache[b]=null))}setFloat4(b,n,i,e,V){this._cacheFloat4(b,n,i,e,V)&&(this.In.setFloat4(this._uniforms[b],n,i,e,V)||(this._valueCache[b]=null))}setColor3(b,n){this._cacheFloat3(b,n.r,n.g,n.b)&&(this.In.setFloat3(this._uniforms[b],n.r,n.g,n.b)||(this._valueCache[b]=null))}setColor4(b,n,i){this._cacheFloat4(b,n.r,n.g,n.b,i)&&(this.In.setFloat4(this._uniforms[b],n.r,n.g,n.b,i)||(this._valueCache[b]=null))}setDirectColor4(b,n){this._cacheFloat4(b,n.r,n.g,n.b,n.a)&&(this.In.setFloat4(this._uniforms[b],n.r,n.g,n.b,n.a)||(this._valueCache[b]=null))}_getVertexShaderCode(){return this.vertexShader?this.In._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.In._getShaderSource(this.fragmentShader):null}}var V=i(11672);const Q=new WeakMap,U={_webGLVersion:2,cachedPipelines:{}};function Y(b){let n=Q.get(b);if(!n){if(!b)return U;n={_webGLVersion:b.TEXTURE_BINDING_3D?2:1,_context:b,parallelShaderCompile:b.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},Q.set(b,n)}return n}function L(b){Q.delete(b)}function B(b,n,i,e,V,Q){const U=Y(e);Q||(Q=U._createShaderProgramInjection??Z);return Q(b,O(n,"vertex",e,U._contextWasLost),O(i,"fragment",e,U._contextWasLost),e,V,U.validateShaderPrograms)}function mb(b,n,i,e,V){let Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6?arguments[6]:void 0;const L=Y(V);U||(U=L._createShaderProgramInjection??Z);const B=L._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return U(b,I(n,"vertex",e,B,V,L._contextWasLost),I(i,"fragment",e,B,V,L._contextWasLost),V,Q,L.validateShaderPrograms)}function N(b,n){const i=new e,V=Y(b);return V.parallelShaderCompile&&!V.disableParallelShaderCompile&&(i.isParallelCompiled=!0),i.context=V._context,i}function Z(b,n,i,e){let V=arguments.length>5?arguments[5]:void 0;const Q=e.createProgram();if(b.program=Q,!Q)throw new Error("Unable to create program");return e.attachShader(Q,n),e.attachShader(Q,i),e.linkProgram(Q),b.context=e,b.vertexShader=n,b.fragmentShader=i,b.isParallelCompiled||z(b,e,V),Q}function T(b,n,i){const e=b;if(e._isDisposed)return!1;const V=Y(n);return!!(V&&V.parallelShaderCompile&&V.parallelShaderCompile.COMPLETION_STATUS_KHR&&e.program&&n.getProgramParameter(e.program,V.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(z(e,n,i),!0)}function z(b,n,i){const e=b.context,V=b.vertexShader,Q=b.fragmentShader,U=b.program;if(!e.getProgramParameter(U,e.LINK_STATUS)){if(!n.getShaderParameter(V,n.COMPILE_STATUS)){const i=n.getShaderInfoLog(V);if(i)throw b.vertexCompilationError=i,new Error("VERTEX SHADER "+i)}if(!n.getShaderParameter(Q,n.COMPILE_STATUS)){const i=n.getShaderInfoLog(Q);if(i)throw b.fragmentCompilationError=i,new Error("FRAGMENT SHADER "+i)}const i=e.getProgramInfoLog(U);if(i)throw b.programLinkError=i,new Error(i)}if(i){e.validateProgram(U);if(!e.getProgramParameter(U,e.VALIDATE_STATUS)){const n=e.getProgramInfoLog(U);if(n)throw b.programValidationError=n,new Error(n)}}e.deleteShader(V),e.deleteShader(Q),b.vertexShader=void 0,b.fragmentShader=void 0,b.onCompiled&&(b.onCompiled(),b.onCompiled=void 0)}function K(b,n,i,e,V,Q,U,L,N){let Z=arguments.length>10?arguments[10]:void 0,T=arguments.length>11?arguments[11]:void 0,z=arguments.length>12?arguments[12]:void 0;const K=Y(b.context);T||(T=K.createRawShaderProgramInjection??B),z||(z=K.createShaderProgramInjection??mb);const I=b;I.program=e?T(I,n,i,I.context,N):z(I,n,i,L,I.context,N),I.program.__SPECTOR_rebuildProgram=U,Z()}function I(b,n,i,e,Q,U){return O((0,V.d)(b,i,e),n,Q,U)}function O(b,n,i,e){const V=i.createShader("vertex"===n?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!V){let b=i.NO_ERROR,V=i.NO_ERROR;for(;(V=i.getError())!==i.NO_ERROR;)b=V;throw new Error(`Something went wrong while creating a gl ${n} shader object. gl error=${b}, gl isContextLost=${i.isContextLost()}, _contextWasLost=${e}`)}return i.shaderSource(V,b),i.compileShader(V),V}function u(b,n){n.useProgram(b)}function d(b,n){const i=b;if(!i.isParallelCompiled)return void n(b);const e=i.onCompiled;i.onCompiled=()=>{null===e||void 0===e||e(),n(b)}}},11693:(b,n,i)=>{i.d(n,{b:()=>N,d:()=>T,f:()=>B,g:()=>mb});var e=i(11616),V=i(11697),Q=i(11686),U=i(11621),Y=i(11667),L=i(11672);function B(b,n){return(0,V.u)(n).cachedPipelines[b]}function mb(b){const n=b._name,i=b.context;if(n&&i){const b=(0,V.u)(i),e=b.cachedPipelines[n];null===e||void 0===e||e.dispose(),delete b.cachedPipelines[n]}}function N(b,n,i,V,Q,U,L){let B,mb;const N=(0,e.l)()?null===U||void 0===U?void 0:U.getHostDocument():null;B="string"===typeof n?n:n.vertexSource?"source:"+n.vertexSource:n.vertexElement?(null===N||void 0===N?void 0:N.getElementById(n.vertexElement))||n.vertexElement:n.vertex||n,mb="string"===typeof n?n:n.fragmentSource?"source:"+n.fragmentSource:n.fragmentElement?(null===N||void 0===N?void 0:N.getElementById(n.fragmentElement))||n.fragmentElement:n.fragment||n;const T=[void 0,void 0],z=()=>{if(T[0]&&T[1]){b.isFragment=!0;const[e,B]=T;(0,Y.g)(B,b,((U,B)=>{L&&(L._fragmentSourceCodeBeforeMigration=B),i&&(U=i("fragment",U));const mb=(0,Y.b)(e,U,b);b=null;const N=function(b,n,i,e){if(i){return{vertexSourceCode:(1===e?"//":"")+"#define SHADER_NAME vertex:"+(i.vertexElement||i.vertex||i.spectorName||i)+"\n"+b,fragmentSourceCode:(1===e?"//":"")+"#define SHADER_NAME fragment:"+(i.fragmentElement||i.fragment||i.spectorName||i)+"\n"+n}}return{vertexSourceCode:b,fragmentSourceCode:n}}(mb.vertexCode,mb.fragmentCode,n,Q);null===V||void 0===V||V(N.vertexSourceCode,N.fragmentSourceCode)}),U)}};Z(B,"Vertex","",(n=>{(0,Y.d)(b),(0,Y.g)(n,b,((b,e)=>{L&&(L._rawVertexSourceCode=n,L._vertexSourceCodeBeforeMigration=e),i&&(b=i("vertex",b)),T[0]=b,z()}),U)}),Q),Z(mb,"Fragment","Pixel",(b=>{L&&(L._rawFragmentSourceCode=b),T[1]=b,z()}),Q)}function Z(b,n,i,V,U,Y){if("undefined"!==typeof HTMLElement&&b instanceof HTMLElement){return void V((0,e.d)(b))}if("source:"===b.substring(0,7))return void V(b.substring(7));if("base64:"===b.substring(0,7)){return void V(window.atob(b.substring(7)))}const B=Q.c.GetShadersStore(U);if(B[b+n+"Shader"])return void V(B[b+n+"Shader"]);if(i&&B[b+i+"Shader"])return void V(B[b+i+"Shader"]);let mb;if(mb="."===b[0]||"/"===b[0]||b.indexOf("http")>-1?b:Q.c.GetShadersRepository(U)+b,!(Y=Y||L.i))throw new Error("loadFileInjection is not defined");Y(mb+"."+n.toLowerCase()+".fx",V)}const T=(b,n,i,e)=>{try{const Q=b.context?(0,V.u)(b.context):null;Q&&(Q.disableParallelShaderCompile=b.disableParallelCompilation);const U=b.existingPipelineContext||n(b.shaderProcessingContext);return U._name=b.name,b.name&&Q&&(Q.cachedPipelines[b.name]=U),i(U,b.vertex,b.fragment,!!b.createAsRaw,"","",b.rebuildRebind,b.defines,b.transformFeedbackVaryings,"",(()=>{e(U,(()=>{var n;null===(n=b.onRenderingStateCompiled)||void 0===n||n.call(b,U)}))})),U}catch(Q){throw U.b.Error("Error compiling effect"),Q}}},11683:(b,n,i)=>{i.r(n),i.d(n,{Effect:()=>L});var e=i(11612),V=i(11621),Q=i(11686),U=i(11693),Y=i(11674);class L{static get ShadersRepository(){return Q.c.ShadersRepository}static set ShadersRepository(b){Q.c.ShadersRepository=b}get N(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new e.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(b,n,i){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,mb=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Z=arguments.length>9?arguments[9]:void 0,T=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,K=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new e.e,this.onErrorObservable=new e.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=b,this._key=T;const I=this._key.replace(/\r/g,"").replace(/\n/g,"|");let O;if(n.attributes){const b=n;if(this._engine=i,this._attributesNames=b.attributes,this._uniformsNames=b.uniformsNames.concat(b.samplers),this._samplerList=b.samplers.slice(),this.defines=b.defines,this.onError=b.onError,this.onCompiled=b.onCompiled,this._fallbacks=b.fallbacks,this._indexParameters=b.indexParameters,this._transformFeedbackVaryings=b.transformFeedbackVaryings||null,this._multiTarget=!!b.multiTarget,this._shaderLanguage=b.shaderLanguage??0,this._disableParallelShaderCompilation=!!b.disableParallelShaderCompilation,b.uniformBuffersNames){this._uniformBuffersNamesList=b.uniformBuffersNames.slice();for(let n=0;n<b.uniformBuffersNames.length;n++)this._uniformBuffersNames[b.uniformBuffersNames[n]]=n}this._processFinalCode=b.processFinalCode??null,this._processCodeAfterIncludes=b.processCodeAfterIncludes??void 0,K=b.extraInitializationsAsync,O=b.existingPipelineContext}else this._engine=Q,this.defines=null==Y?"":Y,this._uniformsNames=i.concat(V),this._samplerList=V?V.slice():[],this._attributesNames=n,this._uniformBuffersNamesList=[],this._shaderLanguage=z,this.onError=N,this.onCompiled=mb,this._indexParameters=Z,this._fallbacks=B;"WEBGL2"===this._engine.shaderPlatformName&&(O=(0,U.f)(I,this._engine._gl)??O),this._attributeLocationByName={},this.uniqueId=L._UniqueIdSeed++,O?(this._pipelineContext=O,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,K),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.N||this.dispose(!0)}))}async _processShaderCodeAsync(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=arguments.length>3?arguments[3]:void 0;e&&await e(),this._processingContext=i||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const V={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:b??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:Q.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:Q.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,U.b)(V,this.name,this._processFinalCode,((b,i)=>{this._vertexSourceCode=b,this._fragmentSourceCode=i,this._prepareEffect(n)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.N||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(b){return this._attributes[b]}getAttributeLocationByName(b){return this._attributeLocationByName[b]}getAttributesCount(){return this._attributes.length}getUniformIndex(b){return this._uniformsNames.indexOf(b)}getUniform(b){return this._uniforms[b]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((b=>{this.executeWhenCompiled(b)}))}executeWhenCompiled(b){this.isReady()?b(this):(this.onCompileObservable.add((n=>{b(n)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(b){(0,Y.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(n=>{this._processCompilationErrors(n,b)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var b;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(b=this._pipelineContext)||void 0===b?void 0:b._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var b;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(b=this._pipelineContext)||void 0===b?void 0:b._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(b,n,i,e){this._isReady=!1,this._vertexSourceCodeOverride=b,this._fragmentSourceCodeOverride=n,this.onError=(b,n)=>{e&&e(n)},this.onCompiled=()=>{var b,n;const e=this.getEngine().scenes;if(e)for(let i=0;i<e.length;i++)e[i].markAllMaterialsAsDirty(127);null===(b=(n=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===b||b.call(n,i)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(b){if(this._pipelineContext=b,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let n=0;n<this._attributesNames.length;n++){const b=this._attributesNames[n];this._attributeLocationByName[b]=this._attributes[n]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),L.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n=this._pipelineContext;this._isReady=!1;try{const i=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),e=i?null:this.defines,V=i?this._vertexSourceCodeOverride:this._vertexSourceCode,Q=i?this._fragmentSourceCodeOverride:this._fragmentSourceCode,Y=this._engine;this._pipelineContext=(0,U.d)({existingPipelineContext:b?n:null,vertex:V,fragment:Q,context:"WEBGL2"===Y.shaderPlatformName||"WEBGL1"===Y.shaderPlatformName?Y._gl:void 0,rebuildRebind:(b,n,i,e)=>this._rebuildProgram(b,n,i,e),defines:e,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:i,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:i=>{n&&!b&&this._engine._deletePipelineContext(n),i&&this._onRenderingStateCompiled(i)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(n)}catch(i){this._processCompilationErrors(i,n)}}_getShaderCodeAndErrorLine(b,n,i){const e=i?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let V=null;if(n&&b){const Q=n.match(e);if(Q&&2===Q.length){const n=parseInt(Q[1]),e=b.split("\n",-1);e.length>=n&&(V=`Offending line [${n}] in ${i?"fragment":"vertex"} code: ${e[n-1]}`)}}return[b,V]}_processCompilationErrors(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=b.message;const i=this._attributesNames,e=this._fallbacks;if(V.b.Error("Unable to compile effect:"),V.b.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),V.b.Error(`Attributes: ${i.join(" ")}`),V.b.Error("Defines:\n"+this.defines),L.LogShaderCodeOnCompilationError){var Q,U;let b=null,n=null,i=null;var Y;if(null!==(Q=this._pipelineContext)&&void 0!==Q&&Q._getVertexShaderCode()&&([i,b]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),i&&(V.b.Error("Vertex code:"),V.b.Error(i))),null!==(U=this._pipelineContext)&&void 0!==U&&U._getFragmentShaderCode())[i,n]=this._getShaderCodeAndErrorLine(null===(Y=this._pipelineContext)||void 0===Y?void 0:Y._getFragmentShaderCode(),this._compilationError,!0),i&&(V.b.Error("Fragment code:"),V.b.Error(i));b&&V.b.Error(b),n&&V.b.Error(n)}V.b.Error("Error: "+this._compilationError);const B=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};n&&(this._pipelineContext=n,this._isReady=!0,B()),e?(this._pipelineContext=null,e.hasMoreFallbacks?(this._allFallbacksProcessed=!1,V.b.Error("Trying next fallback."),this.defines=e.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,B(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,n||B())}get isSupported(){return""===this._compilationError}_bindTexture(b,n){this._engine._bindTexture(this._samplers[b],n,b)}setTexture(b,n){this._engine.setTexture(this._samplers[b],this._uniforms[b],n,b)}setTextureArray(b,n){const i=b+"Ex";if(-1===this._samplerList.indexOf(i+"0")){const e=this._samplerList.indexOf(b);for(let b=1;b<n.length;b++){const n=i+(b-1).toString();this._samplerList.splice(e+b,0,n)}let V=0;for(const b of this._samplerList)this._samplers[b]=V,V+=1}this._engine.setTextureArray(this._samplers[b],this._uniforms[b],n,b)}bindUniformBuffer(b,n){const i=this._uniformBuffersNames[n];void 0===i||L._BaseCache[i]===b&&this._engine._features.useUBOBindingCache||(L._BaseCache[i]=b,this._engine.bindUniformBufferBase(b,i,n))}bindUniformBlock(b,n){this._engine.bindUniformBlock(this._pipelineContext,b,n)}setInt(b,n){return this._pipelineContext.setInt(b,n),this}setInt2(b,n,i){return this._pipelineContext.setInt2(b,n,i),this}setInt3(b,n,i,e){return this._pipelineContext.setInt3(b,n,i,e),this}setInt4(b,n,i,e,V){return this._pipelineContext.setInt4(b,n,i,e,V),this}setIntArray(b,n){return this._pipelineContext.setIntArray(b,n),this}setIntArray2(b,n){return this._pipelineContext.setIntArray2(b,n),this}setIntArray3(b,n){return this._pipelineContext.setIntArray3(b,n),this}setIntArray4(b,n){return this._pipelineContext.setIntArray4(b,n),this}setUInt(b,n){return this._pipelineContext.setUInt(b,n),this}setUInt2(b,n,i){return this._pipelineContext.setUInt2(b,n,i),this}setUInt3(b,n,i,e){return this._pipelineContext.setUInt3(b,n,i,e),this}setUInt4(b,n,i,e,V){return this._pipelineContext.setUInt4(b,n,i,e,V),this}setUIntArray(b,n){return this._pipelineContext.setUIntArray(b,n),this}setUIntArray2(b,n){return this._pipelineContext.setUIntArray2(b,n),this}setUIntArray3(b,n){return this._pipelineContext.setUIntArray3(b,n),this}setUIntArray4(b,n){return this._pipelineContext.setUIntArray4(b,n),this}setFloatArray(b,n){return this._pipelineContext.setArray(b,n),this}setFloatArray2(b,n){return this._pipelineContext.setArray2(b,n),this}setFloatArray3(b,n){return this._pipelineContext.setArray3(b,n),this}setFloatArray4(b,n){return this._pipelineContext.setArray4(b,n),this}setArray(b,n){return this._pipelineContext.setArray(b,n),this}setArray2(b,n){return this._pipelineContext.setArray2(b,n),this}setArray3(b,n){return this._pipelineContext.setArray3(b,n),this}setArray4(b,n){return this._pipelineContext.setArray4(b,n),this}setMatrices(b,n){return this._pipelineContext.setMatrices(b,n),this}setMatrix(b,n){return this._pipelineContext.setMatrix(b,n),this}setMatrix3x3(b,n){return this._pipelineContext.setMatrix3x3(b,n),this}setMatrix2x2(b,n){return this._pipelineContext.setMatrix2x2(b,n),this}setFloat(b,n){return this._pipelineContext.setFloat(b,n),this}setBool(b,n){return this._pipelineContext.setInt(b,n?1:0),this}setVector2(b,n){return this._pipelineContext.setVector2(b,n),this}setFloat2(b,n,i){return this._pipelineContext.setFloat2(b,n,i),this}setVector3(b,n){return this._pipelineContext.setVector3(b,n),this}setFloat3(b,n,i,e){return this._pipelineContext.setFloat3(b,n,i,e),this}setVector4(b,n){return this._pipelineContext.setVector4(b,n),this}setQuaternion(b,n){return this._pipelineContext.setQuaternion(b,n),this}setFloat4(b,n,i,e,V){return this._pipelineContext.setFloat4(b,n,i,e,V),this}setColor3(b,n){return this._pipelineContext.setColor3(b,n),this}setColor4(b,n,i){return this._pipelineContext.setColor4(b,n,i),this}setDirectColor4(b,n){return this._pipelineContext.setDirectColor4(b,n),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(L.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,U.g)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;n&&(Q.c.GetShadersStore(e)[`${b}PixelShader`]=n),i&&(Q.c.GetShadersStore(e)[`${b}VertexShader`]=i)}static ResetCache(){L._BaseCache={}}}L.LogShaderCodeOnCompilationError=!0,L.PersistentMode=!1,L.AutomaticallyClearCodeCache=!1,L._UniqueIdSeed=0,L._BaseCache={},L.ShadersStore=Q.c.ShadersStore,L.IncludesShadersStore=Q.c.IncludesShadersStore},11636:(b,n,i)=>{i.d(n,{e:()=>V});const e={};function V(b){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!e[b])return e[b]=!0,`${b} needs to be imported before as it contains a side-effect required by your code.`}},11616:(b,n,i)=>{function e(){return"undefined"!==typeof window}function V(){return"undefined"!==typeof navigator}function Q(){return"undefined"!==typeof document}function U(b){let n="",i=b.firstChild;for(;i;)3===i.nodeType&&(n+=i.textContent),i=i.nextSibling;return n}i.d(n,{d:()=>U,h:()=>Q,k:()=>V,l:()=>e})},11621:(b,n,i)=>{i.d(n,{b:()=>e});class e{static _CheckLimit(b,n){let i=e._LogLimitOutputs[b];return i?i.current++:(i={limit:n,current:1},e._LogLimitOutputs[b]=i),i.current<=i.limit}static _GenerateLimitMessage(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const i=e._LogLimitOutputs[b];if(!i||!e.MessageLimitReached)return;const V=this._Levels[n];i.current===i.limit&&e[V.name](e.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,V.name??""))}static _AddLogEntry(b){e._LogCache=b+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(b)}static _FormatMessage(b){const n=b=>b<10?"0"+b:""+b,i=new Date;return"["+n(i.getHours())+":"+n(i.getMinutes())+":"+n(i.getSeconds())+"]: "+b}static _LogDisabled(b,n){}static _LogEnabled(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;const V=Array.isArray(n)?n[0]:n;if(void 0!==i&&!e._CheckLimit(V,i))return;const Q=e._FormatMessage(V),U=this._Levels[b],Y=Array.isArray(n)?n.slice(1):[];U.logFunc&&U.logFunc("BJS - "+Q,...Y);const L=`<div style='color:${U.color}'>${Q}</div><br>`;e._AddLogEntry(L),e._GenerateLimitMessage(V,b)}static get LogCache(){return e._LogCache}static ClearLogCache(){e._LogCache="",e._LogLimitOutputs={},e.errorsCount=0}static set LogLevels(b){e.Log=e._LogDisabled,e.Warn=e._LogDisabled,e.Error=e._LogDisabled;const n=[e.MessageLogLevel,e.WarningLogLevel,e.ErrorLogLevel];for(const i of n)if((b&i)===i){const b=this._Levels[i];e[b.name]=e._LogEnabled.bind(e,i)}}}e.NoneLogLevel=0,e.MessageLogLevel=1,e.WarningLogLevel=2,e.ErrorLogLevel=4,e.AllLogLevel=7,e.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",e._LogCache="",e._LogLimitOutputs={},e._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],e.errorsCount=0,e.Log=e._LogEnabled.bind(e,e.MessageLogLevel),e.Warn=e._LogEnabled.bind(e,e.WarningLogLevel),e.Error=e._LogEnabled.bind(e,e.ErrorLogLevel)},11612:(b,n,i)=>{i.d(n,{e:()=>U});const e="undefined"!==typeof WeakRef;class V{constructor(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,e=arguments.length>3?arguments[3]:void 0;this.initialize(b,n,i,e)}initialize(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,e=arguments.length>3?arguments[3]:void 0;return this.mask=b,this.skipNextObservers=n,this.target=i,this.currentTarget=e,this}}class Q{constructor(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=b,this.mask=n,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(b)}}class U{static FromPromise(b,n){const i=new U;return b.then((b=>{i.notifyObservers(b)})).catch((b=>{if(!n)throw b;n.notifyObservers(b)})),i}get observers(){return this._observers}constructor(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=n,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new V(0),b&&(this._onObserverAdded=b)}add(b){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!b)return null;const V=new Q(b,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);V.unregisterOnNextCall=i,n?this._observers.unshift(V):this._observers.push(V),this._onObserverAdded&&this._onObserverAdded(V),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(V,this._lastNotifiedValue);const U=e?new WeakRef(this):{deref:()=>this};return V._remove=function(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n=U.deref();n&&(b?n.remove(V):n._remove(V))},V}addOnce(b){return this.add(b,void 0,void 0,void 0,!0)}remove(b){if(!b)return!1;b._remove=null;return-1!==this._observers.indexOf(b)&&(this._deferUnregister(b),!0)}removeCallback(b,n){for(let i=0;i<this._observers.length;i++){const e=this._observers[i];if(!e._willBeUnregistered&&(e.callback===b&&(!n||n===e.scope)))return this._deferUnregister(e),!0}return!1}_deferUnregister(b){b._willBeUnregistered||(this._numObserversMarkedAsDeleted++,b.unregisterOnNextCall=!1,b._willBeUnregistered=!0,setTimeout((()=>{this._remove(b)}),0))}_remove(b){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!b)return!1;const i=this._observers.indexOf(b);return-1!==i&&(n&&this._numObserversMarkedAsDeleted--,this._observers.splice(i,1),!0)}makeObserverTopPriority(b){this._remove(b,!1),this._observers.unshift(b)}makeObserverBottomPriority(b){this._remove(b,!1),this._observers.push(b)}notifyObservers(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2?arguments[2]:void 0,e=arguments.length>3?arguments[3]:void 0,V=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=b),!this._observers.length)return!0;const Q=this._eventState;Q.mask=n,Q.target=i,Q.currentTarget=e,Q.skipNextObservers=!1,Q.lastReturnValue=b,Q.userInfo=V;for(const U of this._observers)if(!U._willBeUnregistered&&(U.mask&n&&(U.unregisterOnNextCall&&this._deferUnregister(U),U.scope?Q.lastReturnValue=U.callback.apply(U.scope,[b,Q]):Q.lastReturnValue=U.callback(b,Q)),Q.skipNextObservers))return!1;return!0}notifyObserver(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=n),b._willBeUnregistered)return;const e=this._eventState;e.mask=i,e.skipNextObservers=!1,b.unregisterOnNextCall&&this._deferUnregister(b),b.callback(n,e)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const b=this._observers.pop();b&&(b._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const b=new U;return b._observers=this._observers.slice(0),b}hasSpecificMask(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const n of this._observers)if(n.mask&b||n.mask===b)return!0;return!1}}},11674:(b,n,i)=>{i.d(n,{e:()=>V,f:()=>U});let e=[];class V{static SetImmediate(b){0===e.length&&setTimeout((()=>{const b=e;e=[];for(const n of b)n()}),1),e.push(b)}}function Q(b,n,i){try{if(b())return n(),!0}catch(e){return null===i||void 0===i||i(e),!0}return!1}const U=function(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,U=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&Q(b,n,i))return null;const Y=setInterval((()=>{Q(b,n,i)?clearInterval(Y):(V-=e,V<0&&(clearInterval(Y),null===i||void 0===i||i(new Error("Operation timed out after maximum retries. "+(U||"")),!0)))}),e);return()=>clearInterval(Y)}}}]);