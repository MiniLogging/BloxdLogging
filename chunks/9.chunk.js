"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{10997:(T,z,X)=>{X.r(z),X.d(z,{_KTXTextureLoader:()=>c});var b=X(1065);class F{constructor(T,z){if(this.data=T,this.isInvalid=!1,!F.IsValid(T))return this.isInvalid=!0,void b.e.Error("texture missing KTX identifier");const X=Uint32Array.BYTES_PER_ELEMENT,A=new DataView(this.data.buffer,this.data.byteOffset+12,13*X),u=67305985===A.getUint32(0,!0);return this.glType=A.getUint32(1*X,u),this.glTypeSize=A.getUint32(2*X,u),this.glFormat=A.getUint32(3*X,u),this.glInternalFormat=A.getUint32(4*X,u),this.glBaseInternalFormat=A.getUint32(5*X,u),this.pixelWidth=A.getUint32(6*X,u),this.pixelHeight=A.getUint32(7*X,u),this.pixelDepth=A.getUint32(8*X,u),this.numberOfArrayElements=A.getUint32(9*X,u),this.numberOfFaces=A.getUint32(10*X,u),this.numberOfMipmapLevels=A.getUint32(11*X,u),this.bytesOfKeyValueData=A.getUint32(12*X,u),0!==this.glType?(b.e.Error("only compressed formats currently supported"),void(this.isInvalid=!0)):(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0===this.pixelHeight||0!==this.pixelDepth?(b.e.Error("only 2D textures currently supported"),void(this.isInvalid=!0)):0!==this.numberOfArrayElements?(b.e.Error("texture arrays not currently supported"),void(this.isInvalid=!0)):this.numberOfFaces!==z?(b.e.Error("number of faces expected"+z+", but found "+this.numberOfFaces),void(this.isInvalid=!0)):void(this.loadType=F.COMPRESSED_2D))}uploadLevels(T,z){switch(this.loadType){case F.COMPRESSED_2D:this._upload2DCompressedLevels(T,z);case F.TEX_2D:case F.COMPRESSED_3D:case F.TEX_3D:}}_upload2DCompressedLevels(T,z){let X=F.HEADER_LEN+this.bytesOfKeyValueData,b=this.pixelWidth,A=this.pixelHeight;const u=z?this.numberOfMipmapLevels:1;for(let F=0;F<u;F++){const z=new Int32Array(this.data.buffer,this.data.byteOffset+X,1)[0];X+=4;for(let u=0;u<this.numberOfFaces;u++){const y=new Uint8Array(this.data.buffer,this.data.byteOffset+X,z);T.getEngine()._uploadCompressedDataToTextureDirectly(T,T.format,b,A,y,u,F),X+=z,X+=3-(z+3)%4}b=Math.max(1,.5*b),A=Math.max(1,.5*A)}}static IsValid(T){if(T.byteLength>=12){const z=new Uint8Array(T.buffer,T.byteOffset,12);if(171===z[0]&&75===z[1]&&84===z[2]&&88===z[3]&&32===z[4]&&49===z[5]&&49===z[6]&&187===z[7]&&13===z[8]&&10===z[9]&&26===z[10]&&10===z[11])return!0}return!1}}F.HEADER_LEN=64,F.COMPRESSED_2D=0,F.COMPRESSED_3D=1,F.TEX_2D=2,F.TEX_3D=3;var A,u,y,E=X(11005),v=X(1166);function k(T,z){const X=(null===z||void 0===z?void 0:z.jsDecoderModule)||KTX2DECODER;T&&(T.wasmUASTCToASTC&&(X.LiteTranscoder_UASTC_ASTC.WasmModuleURL=T.wasmUASTCToASTC),T.wasmUASTCToBC7&&(X.LiteTranscoder_UASTC_BC7.WasmModuleURL=T.wasmUASTCToBC7),T.wasmUASTCToRGBA_UNORM&&(X.LiteTranscoder_UASTC_RGBA_UNORM.WasmModuleURL=T.wasmUASTCToRGBA_UNORM),T.wasmUASTCToRGBA_SRGB&&(X.LiteTranscoder_UASTC_RGBA_SRGB.WasmModuleURL=T.wasmUASTCToRGBA_SRGB),T.wasmUASTCToR8_UNORM&&(X.LiteTranscoder_UASTC_R8_UNORM.WasmModuleURL=T.wasmUASTCToR8_UNORM),T.wasmUASTCToRG8_UNORM&&(X.LiteTranscoder_UASTC_RG8_UNORM.WasmModuleURL=T.wasmUASTCToRG8_UNORM),T.jsMSCTranscoder&&(X.MSCTranscoder.JSModuleURL=T.jsMSCTranscoder),T.wasmMSCTranscoder&&(X.MSCTranscoder.WasmModuleURL=T.wasmMSCTranscoder),T.wasmZSTDDecoder&&(X.ZSTDDecoder.WasmModuleURL=T.wasmZSTDDecoder)),z&&(z.wasmUASTCToASTC&&(X.LiteTranscoder_UASTC_ASTC.WasmBinary=z.wasmUASTCToASTC),z.wasmUASTCToBC7&&(X.LiteTranscoder_UASTC_BC7.WasmBinary=z.wasmUASTCToBC7),z.wasmUASTCToRGBA_UNORM&&(X.LiteTranscoder_UASTC_RGBA_UNORM.WasmBinary=z.wasmUASTCToRGBA_UNORM),z.wasmUASTCToRGBA_SRGB&&(X.LiteTranscoder_UASTC_RGBA_SRGB.WasmBinary=z.wasmUASTCToRGBA_SRGB),z.wasmUASTCToR8_UNORM&&(X.LiteTranscoder_UASTC_R8_UNORM.WasmBinary=z.wasmUASTCToR8_UNORM),z.wasmUASTCToRG8_UNORM&&(X.LiteTranscoder_UASTC_RG8_UNORM.WasmBinary=z.wasmUASTCToRG8_UNORM),z.jsMSCTranscoder&&(X.MSCTranscoder.JSModule=z.jsMSCTranscoder),z.wasmMSCTranscoder&&(X.MSCTranscoder.WasmBinary=z.wasmMSCTranscoder),z.wasmZSTDDecoder&&(X.ZSTDDecoder.WasmBinary=z.wasmZSTDDecoder))}function L(T){let z;"undefined"===typeof T&&"undefined"!==typeof KTX2DECODER&&(T=KTX2DECODER),onmessage=X=>{if(X.data)switch(X.data.action){case"init":{const b=X.data.urls;b&&(b.jsDecoderModule&&"undefined"===typeof T&&(importScripts(b.jsDecoderModule),T=KTX2DECODER),k(b)),X.data.wasmBinaries&&k(void 0,{...X.data.wasmBinaries,jsDecoderModule:T}),z=new T.KTX2Decoder,postMessage({action:"init"});break}case"setDefaultDecoderOptions":T.KTX2Decoder.DefaultDecoderOptions=X.data.options;break;case"decode":z.decode(X.data.data,X.data.caps,X.data.options).then((T=>{const z=[];for(let X=0;X<T.mipmaps.length;++X){const b=T.mipmaps[X];b&&b.data&&z.push(b.data.buffer)}postMessage({action:"decoded",success:!0,decodedData:T},z)})).catch((T=>{postMessage({action:"decoded",success:!1,msg:T})}))}}}!function(T){T[T.ETC1S=0]="ETC1S",T[T.UASTC4x4=1]="UASTC4x4"}(A||(A={})),function(T){T[T.ASTC_4X4_RGBA=0]="ASTC_4X4_RGBA",T[T.BC7_RGBA=1]="BC7_RGBA",T[T.BC3_RGBA=2]="BC3_RGBA",T[T.BC1_RGB=3]="BC1_RGB",T[T.PVRTC1_4_RGBA=4]="PVRTC1_4_RGBA",T[T.PVRTC1_4_RGB=5]="PVRTC1_4_RGB",T[T.ETC2_RGBA=6]="ETC2_RGBA",T[T.ETC1_RGB=7]="ETC1_RGB",T[T.RGBA32=8]="RGBA32",T[T.R8=9]="R8",T[T.RG8=10]="RG8"}(u||(u={})),function(T){T[T.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",T[T.COMPRESSED_RGBA_ASTC_4X4_KHR=37808]="COMPRESSED_RGBA_ASTC_4X4_KHR",T[T.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",T[T.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",T[T.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",T[T.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",T[T.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",T[T.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",T[T.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",T[T.RGBA8Format=32856]="RGBA8Format",T[T.R8Format=33321]="R8Format",T[T.RG8Format=33323]="RG8Format"}(y||(y={}));class D{static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static _Initialize(T){if(D._WorkerPoolPromise||D._DecoderModulePromise)return;const z={jsDecoderModule:v.g.GetBabylonScriptURL(this.URLConfig.jsDecoderModule,!0),wasmUASTCToASTC:v.g.GetBabylonScriptURL(this.URLConfig.wasmUASTCToASTC,!0),wasmUASTCToBC7:v.g.GetBabylonScriptURL(this.URLConfig.wasmUASTCToBC7,!0),wasmUASTCToRGBA_UNORM:v.g.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRGBA_UNORM,!0),wasmUASTCToRGBA_SRGB:v.g.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRGBA_SRGB,!0),wasmUASTCToR8_UNORM:v.g.GetBabylonScriptURL(this.URLConfig.wasmUASTCToR8_UNORM,!0),wasmUASTCToRG8_UNORM:v.g.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRG8_UNORM,!0),jsMSCTranscoder:v.g.GetBabylonScriptURL(this.URLConfig.jsMSCTranscoder,!0),wasmMSCTranscoder:v.g.GetBabylonScriptURL(this.URLConfig.wasmMSCTranscoder,!0),wasmZSTDDecoder:v.g.GetBabylonScriptURL(this.URLConfig.wasmZSTDDecoder,!0)};T&&"function"===typeof Worker&&"undefined"!==typeof URL?D._WorkerPoolPromise=new Promise((X=>{const b=`${k}(${L})()`,F=URL.createObjectURL(new Blob([b],{type:"application/javascript"}));X(new E.d(T,(()=>function(T,z,X){return new Promise(((b,F)=>{const A=z=>{T.removeEventListener("error",A),T.removeEventListener("message",u),F(z)},u=z=>{"init"===z.data.action&&(T.removeEventListener("error",A),T.removeEventListener("message",u),b(T))};T.addEventListener("error",A),T.addEventListener("message",u),T.postMessage({action:"init",urls:X,wasmBinaries:z})}))}(new Worker(F),void 0,z))))})):"undefined"===typeof D._KTX2DecoderModule?D._DecoderModulePromise=v.g.LoadBabylonScriptAsync(z.jsDecoderModule).then((()=>(D._KTX2DecoderModule=KTX2DECODER,D._KTX2DecoderModule.MSCTranscoder.UseFromWorkerThread=!1,D._KTX2DecoderModule.WASMMemoryManager.LoadBinariesFromCurrentThread=!0,k(z,D._KTX2DecoderModule),new D._KTX2DecoderModule.KTX2Decoder))):(D._KTX2DecoderModule.MSCTranscoder.UseFromWorkerThread=!1,D._KTX2DecoderModule.WASMMemoryManager.LoadBinariesFromCurrentThread=!0,D._DecoderModulePromise=Promise.resolve(new D._KTX2DecoderModule.KTX2Decoder))}constructor(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D.DefaultNumWorkers;this._engine=T;const X="object"===typeof z&&z.workerPool||D.WorkerPool;if(X)D._WorkerPoolPromise=Promise.resolve(X);else{var b;if("object"===typeof z)D._KTX2DecoderModule=null===z||void 0===z||null===(b=z.binariesAndModulesContainer)||void 0===b?void 0:b.jsDecoderModule;else"undefined"!==typeof KTX2DECODER&&(D._KTX2DecoderModule=KTX2DECODER);const T="number"===typeof z?z:z.numWorkers??D.DefaultNumWorkers;D._Initialize(T)}}_uploadAsync(T,z,X){const b=this._engine.getCaps(),F={astc:!!b.astc,bptc:!!b.bptc,s3tc:!!b.s3tc,pvrtc:!!b.pvrtc,etc2:!!b.etc2,etc1:!!b.etc1};if(D._WorkerPoolPromise)return D._WorkerPoolPromise.then((b=>new Promise(((A,u)=>{b.push(((b,y)=>{const E=T=>{b.removeEventListener("error",E),b.removeEventListener("message",v),u(T),y()},v=T=>{if("decoded"===T.data.action){if(b.removeEventListener("error",E),b.removeEventListener("message",v),T.data.success)try{this._createTexture(T.data.decodedData,z,X),A()}catch(F){u({message:F})}else u({message:T.data.msg});y()}};b.addEventListener("error",E),b.addEventListener("message",v),b.postMessage({action:"setDefaultDecoderOptions",options:D.DefaultDecoderOptions._getKTX2DecoderOptions()});const k=new Uint8Array(T.byteLength);k.set(new Uint8Array(T.buffer,T.byteOffset,T.byteLength)),b.postMessage({action:"decode",data:k,caps:F,options:X},[k.buffer])}))}))));if(D._DecoderModulePromise)return D._DecoderModulePromise.then((X=>(D.DefaultDecoderOptions.isDirty&&(D._KTX2DecoderModule.KTX2Decoder.DefaultDecoderOptions=D.DefaultDecoderOptions._getKTX2DecoderOptions()),new Promise(((F,A)=>{X.decode(T,b).then((T=>{this._createTexture(T,z),F()})).catch((T=>{A({message:T})}))})))));throw new Error("KTX2 decoder module is not available")}_createTexture(T,z,X){this._engine._bindTextureDirectly(3553,z),X&&(X.transcodedFormat=T.transcodedFormat,X.isInGammaSpace=T.isInGammaSpace,X.ld=T.ld,X.transcoderName=T.transcoderName);let b=!0;switch(T.transcodedFormat){case 32856:z.type=0,z.format=5;break;case 33321:z.type=0,z.format=6;break;case 33323:z.type=0,z.format=7;break;default:z.format=T.transcodedFormat,b=!1}if(z._gammaSpace=T.isInGammaSpace,z.generateMipMaps=T.mipmaps.length>1,T.errors)throw new Error("KTX2 container - could not transcode the data. "+T.errors);for(let F=0;F<T.mipmaps.length;++F){const X=T.mipmaps[F];if(!X||!X.data)throw new Error("KTX2 container - could not transcode one of the image");b?(z.width=X.width,z.height=X.height,this._engine._uploadDataToTextureDirectly(z,X.data,0,F,void 0,!0)):this._engine._uploadCompressedDataToTextureDirectly(z,T.transcodedFormat,X.width,X.height,X.data,0,F)}z._extension=".ktx2",z.width=T.mipmaps[0].width,z.height=T.mipmaps[0].height,z.isReady=!0,this._engine._bindTextureDirectly(3553,null)}static IsValid(T){if(T.byteLength>=12){const z=new Uint8Array(T.buffer,T.byteOffset,12);if(171===z[0]&&75===z[1]&&84===z[2]&&88===z[3]&&32===z[4]&&50===z[5]&&48===z[6]&&187===z[7]&&13===z[8]&&10===z[9]&&26===z[10]&&10===z[11])return!0}return!1}}D.URLConfig={jsDecoderModule:"https://cdn.babylonjs.com/babylon.ktx2Decoder.js",wasmUASTCToASTC:null,wasmUASTCToBC7:null,wasmUASTCToRGBA_UNORM:null,wasmUASTCToRGBA_SRGB:null,wasmUASTCToR8_UNORM:null,wasmUASTCToRG8_UNORM:null,jsMSCTranscoder:null,wasmMSCTranscoder:null,wasmZSTDDecoder:null},D.DefaultNumWorkers=D.GetDefaultNumWorkers(),D.DefaultDecoderOptions=new class{constructor(){this._isDirty=!0,this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC=!0,this._ktx2DecoderOptions={}}get isDirty(){return this._isDirty}get useRGBAIfASTCBC7NotAvailableWhenUASTC(){return this._useRGBAIfASTCBC7NotAvailableWhenUASTC}set useRGBAIfASTCBC7NotAvailableWhenUASTC(T){this._useRGBAIfASTCBC7NotAvailableWhenUASTC!==T&&(this._useRGBAIfASTCBC7NotAvailableWhenUASTC=T,this._isDirty=!0)}get useRGBAIfOnlyBC1BC3AvailableWhenUASTC(){return this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC}set useRGBAIfOnlyBC1BC3AvailableWhenUASTC(T){this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC!==T&&(this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC=T,this._isDirty=!0)}get forceRGBA(){return this._forceRGBA}set forceRGBA(T){this._forceRGBA!==T&&(this._forceRGBA=T,this._isDirty=!0)}get forceR8(){return this._forceR8}set forceR8(T){this._forceR8!==T&&(this._forceR8=T,this._isDirty=!0)}get forceRG8(){return this._forceRG8}set forceRG8(T){this._forceRG8!==T&&(this._forceRG8=T,this._isDirty=!0)}get bypassTranscoders(){return this._bypassTranscoders}set bypassTranscoders(T){this._bypassTranscoders!==T&&(this._bypassTranscoders=T,this._isDirty=!0)}_getKTX2DecoderOptions(){if(!this._isDirty)return this._ktx2DecoderOptions;this._isDirty=!1;const T={useRGBAIfASTCBC7NotAvailableWhenUASTC:this._useRGBAIfASTCBC7NotAvailableWhenUASTC,forceRGBA:this._forceRGBA,forceR8:this._forceR8,forceRG8:this._forceRG8,bypassTranscoders:this._bypassTranscoders};return this.useRGBAIfOnlyBC1BC3AvailableWhenUASTC&&(T.transcodeFormatDecisionTree={UASTC:{transcodeFormat:[u.BC1_RGB,u.BC3_RGBA],yes:{transcodeFormat:u.RGBA32,engineFormat:32856,roundToMultiple4:!1}}}),this._ktx2DecoderOptions=T,T}};class c{constructor(){this.supportCascades=!1}loadCubeData(T,z,X,b){if(Array.isArray(T))return;z._invertVScale=!z.invertY;const A=z.getEngine(),u=new F(T,6),y=u.numberOfMipmapLevels>1&&z.generateMipMaps;A._unpackFlipY(!0),u.uploadLevels(z,z.generateMipMaps),z.width=u.pixelWidth,z.height=u.pixelHeight,A._setCubeMapTextureParams(z,y,u.numberOfMipmapLevels-1),z.isReady=!0,z.onLoadedObservable.notifyObservers(z),z.onLoadedObservable.clear(),b&&b()}loadData(T,z,X,A){if(F.IsValid(T)){z._invertVScale=!z.invertY;const b=new F(T,1),A=function(T){switch(T){case 35916:return 33776;case 35918:return 33778;case 35919:return 33779;case 37493:return 37492;case 37497:return 37496;case 37495:return 37494;case 37840:return 37808;case 36493:return 36492}return null}(b.glInternalFormat);A?(z.format=A,z._useSRGBBuffer=z.getEngine()._getUseSRGBBuffer(!0,z.generateMipMaps),z._gammaSpace=!0):z.format=b.glInternalFormat,X(b.pixelWidth,b.pixelHeight,z.generateMipMaps,!0,(()=>{b.uploadLevels(z,z.generateMipMaps)}),b.isInvalid)}else if(D.IsValid(T)){new D(z.getEngine())._uploadAsync(T,z,A).then((()=>{X(z.width,z.height,z.generateMipMaps,!0,(()=>{}),!1)}),(T=>{b.e.Warn(`Failed to load KTX2 texture data: ${T.message}`),X(0,0,!1,!1,(()=>{}),!0)}))}else b.e.Error("texture missing KTX identifier"),X(0,0,!1,!1,(()=>{}),!0)}}},11005:(T,z,X)=>{X.d(z,{d:()=>F});class b{constructor(T){this._pendingActions=new Array,this._workerInfos=T.map((T=>({workerPromise:Promise.resolve(T),idle:!0})))}dispose(){for(const T of this._workerInfos)T.workerPromise.then((T=>{T.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(T){this._executeOnIdleWorker(T)||this._pendingActions.push(T)}_executeOnIdleWorker(T){for(const z of this._workerInfos)if(z.idle)return this._execute(z,T),!0;return!1}_execute(T,z){T.idle=!1,T.workerPromise.then((X=>{z(X,(()=>{const z=this._pendingActions.shift();z?this._execute(T,z):T.idle=!0}))}))}}class F extends b{constructor(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.DefaultOptions;super([]),this._maxWorkers=T,this._createWorkerAsync=z,this._options=X}push(T){if(!this._executeOnIdleWorker(T))if(this._workerInfos.length<this._maxWorkers){const z={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(z),this._execute(z,T)}else this._pendingActions.push(T)}_execute(T,z){T.timeoutId&&(clearTimeout(T.timeoutId),delete T.timeoutId),super._execute(T,((X,b)=>{z(X,(()=>{b(),T.idle&&(T.timeoutId=setTimeout((()=>{T.workerPromise.then((T=>{T.terminate()}));const z=this._workerInfos.indexOf(T);-1!==z&&this._workerInfos.splice(z,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}F.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}}}]);