"use strict";(self.yg1iw12lizp=self.yg1iw12lizp||[]).push([[9],{12464:(L,U,x)=>{x.d(U,{e:()=>d,i:()=>D,l:()=>P,k:()=>n,m:()=>N});class mL{constructor(){this.children=[]}isValid(L){return!0}process(L,U,x){let mL="";if(this.line){let x=this.line;const r=U.processor;if(r){var p,G,F,a,o,A;r.lineProcessor&&(x=r.lineProcessor(x,U.isFragment,U.processingContext));const mL=(null===(p=U.processor)||void 0===p?void 0:p.attributeKeywordName)??"attribute",h=U.isFragment&&null!==(G=U.processor)&&void 0!==G&&G.varyingFragmentKeywordName?null===(F=U.processor)||void 0===F?void 0:F.varyingFragmentKeywordName:!U.isFragment&&null!==(a=U.processor)&&void 0!==a&&a.varyingVertexKeywordName?null===(o=U.processor)||void 0===o?void 0:o.varyingVertexKeywordName:"varying";if(!U.isFragment&&r.attributeProcessor&&this.line.startsWith(mL))x=r.attributeProcessor(this.line,L,U.processingContext);else if(r.varyingProcessor&&(null!==(A=r.varyingCheck)&&void 0!==A&&A.call(r,this.line,U.isFragment)||!r.varyingCheck&&this.line.startsWith(h)))x=r.varyingProcessor(this.line,U.isFragment,L,U.processingContext);else if(r.uniformProcessor&&r.uniformRegexp&&r.uniformRegexp.test(this.line))U.lookForClosingBracketForUniformBuffer||(x=r.uniformProcessor(this.line,U.isFragment,L,U.processingContext));else if(r.uniformBufferProcessor&&r.uniformBufferRegexp&&r.uniformBufferRegexp.test(this.line))U.lookForClosingBracketForUniformBuffer||(x=r.uniformBufferProcessor(this.line,U.isFragment,U.processingContext),U.lookForClosingBracketForUniformBuffer=!0);else if(r.textureProcessor&&r.textureRegexp&&r.textureRegexp.test(this.line))x=r.textureProcessor(this.line,U.isFragment,L,U.processingContext);else if((r.uniformProcessor||r.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!U.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?r.uniformProcessor&&(x=r.uniformProcessor(this.line,U.isFragment,L,U.processingContext)):r.uniformBufferProcessor&&(x=r.uniformBufferProcessor(this.line,U.isFragment,U.processingContext),U.lookForClosingBracketForUniformBuffer=!0)}U.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(U.lookForClosingBracketForUniformBuffer=!1,r.endOfUniformBufferProcessor&&(x=r.endOfUniformBufferProcessor(this.line,U.isFragment,U.processingContext)))}mL+=x+"\n"}for(const r of this.children)mL+=r.process(L,U,x);return this.additionalDefineKey&&(L[this.additionalDefineKey]=this.additionalDefineValue||"true",x[this.additionalDefineKey]=L[this.additionalDefineKey]),mL}}class p{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(L){this._lines.length=0;for(const U of L){if(!U||"\r"===U)continue;if("#"===U[0]){this._lines.push(U);continue}const L=U.trim();if(!L)continue;if(L.startsWith("//")){this._lines.push(U);continue}const x=L.indexOf(";");if(-1===x)this._lines.push(L);else if(x===L.length-1)L.length>1&&this._lines.push(L);else{const L=U.split(";");for(let U=0;U<L.length;U++){let x=L[U];x&&(x=x.trim(),x&&this._lines.push(x+(U!==L.length-1?";":"")))}}}}}class G extends mL{process(L,U,x){for(let mL=0;mL<this.children.length;mL++){const p=this.children[mL];if(p.isValid(L))return p.process(L,U,x)}return""}}class F extends mL{isValid(L){return this.testExpression.isTrue(L)}}class a{isTrue(L){return!0}static postfixToInfix(L){const U=[];for(const x of L)if(void 0===a._OperatorPriority[x])U.push(x);else{const L=U[U.length-1],mL=U[U.length-2];U.length-=2,U.push(`(${mL}${x}${L})`)}return U[U.length-1]}static infixToPostfix(L){const U=a._InfixToPostfixCache.get(L);if(U)return U.accessTime=Date.now(),U.result;if(!L.includes("&&")&&!L.includes("||")&&!L.includes(")")&&!L.includes("("))return[L];const x=[];let mL=-1;const p=()=>{r=r.trim(),""!==r&&(x.push(r),r="")},G=L=>{mL<a._Stack.length-1&&(a._Stack[++mL]=L)},F=()=>a._Stack[mL],o=()=>-1===mL?"!!INVALID EXPRESSION!!":a._Stack[mL--];let A=0,r="";for(;A<L.length;){const U=L.charAt(A),h=A<L.length-1?L.substring(A,2+A):"";if("("===U)r="",G(U);else if(")"===U){for(p();-1!==mL&&"("!==F();)x.push(o());o()}else if(a._OperatorPriority[h]>1){for(p();-1!==mL&&a._OperatorPriority[F()]>=a._OperatorPriority[h];)x.push(o());G(h),A++}else r+=U;A++}for(p();-1!==mL;)"("===F()?o():x.push(o());return a._InfixToPostfixCache.size>=a.InfixToPostfixCacheLimitSize&&a.ClearCache(),a._InfixToPostfixCache.set(L,{result:x,accessTime:Date.now()}),x}static ClearCache(){const L=Array.from(a._InfixToPostfixCache.entries()).sort(((L,U)=>L[1].accessTime-U[1].accessTime));for(let U=0;U<a.InfixToPostfixCacheCleanupSize;U++)a._InfixToPostfixCache.delete(L[U][0])}}a.InfixToPostfixCacheLimitSize=5e4,a.InfixToPostfixCacheCleanupSize=25e3,a._InfixToPostfixCache=new Map,a._OperatorPriority={")":0,"(":1,"||":2,"&&":3},a._Stack=["","","","","","","","","","","","","","","","","","","",""];class o extends a{constructor(L){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=L,this.not=U}isTrue(L){let U=void 0!==L[this.define];return this.not&&(U=!U),U}}class A extends a{isTrue(L){return this.leftOperand.isTrue(L)||this.rightOperand.isTrue(L)}}class r extends a{isTrue(L){return this.leftOperand.isTrue(L)&&this.rightOperand.isTrue(L)}}class h extends a{constructor(L,U,x){super(),this.define=L,this.operand=U,this.testValue=x}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(L){let U=!1;const x=parseInt(void 0!=L[this.define]?L[this.define]:this.define),mL=parseInt(void 0!=L[this.testValue]?L[this.testValue]:this.testValue);if(isNaN(x)||isNaN(mL))return!1;switch(this.operand){case">":U=x>mL;break;case"<":U=x<mL;break;case"<=":U=x<=mL;break;case">=":U=x>=mL;break;case"==":U=x===mL;break;case"!=":U=x!==mL}return U}}var b=x(12426),E=x(12469);const Y=/defined\s*?\((.+?)\)/g,S=/defined\s*?\[(.+?)\]/g,V=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,H=/__decl__/,Q=/light\{X\}.(\w*)/g,q=/\{X\}/g,f=[],v=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function D(L){L.processor&&L.processor.initializeShaders&&L.processor.initializeShaders(L.processingContext)}function P(L,U,x,mL){var p;null!==(p=U.processor)&&void 0!==p&&p.preProcessShaderCode&&(L=U.processor.preProcessShaderCode(L,U.isFragment)),n(L,U,(L=>{U.processCodeAfterIncludes&&(L=U.processCodeAfterIncludes(U.isFragment?"fragment":"vertex",L,U.defines));const p=function(L,U,x){let mL=function(L,U){var x;if(null!==(x=U.processor)&&void 0!==x&&x.noPrecision)return L;const mL=U.shouldUseHighPrecisionShader;-1===L.indexOf("precision highp float")?L=mL?"precision highp float;\n"+L:"precision mediump float;\n"+L:mL||(L=L.replace("precision highp float","precision mediump float"));return L}(L,U);if(!U.processor)return mL;if(0===U.processor.shaderLanguage&&-1!==mL.indexOf("#version 3")&&(mL=mL.replace("#version 300 es",""),!U.processor.parseGLES3))return mL;const p=U.defines,G=y(U,x);U.processor.preProcessor&&(mL=U.processor.preProcessor(mL,p,G,U.isFragment,U.processingContext));const F={};mL=t(mL,G,U,F),U.processor.postProcessor&&(mL=U.processor.postProcessor(mL,p,U.isFragment,U.processingContext,x?{drawBuffersExtensionDisabled:!x.getCaps().drawBuffersExtension}:{},G,F));null!==x&&void 0!==x&&x._features.needShaderCodeInlining&&(mL=x.inlineShaderCode(mL));return mL}(L,U,mL);x(p,L)}))}function d(L,U,x){return x.processor&&x.processor.finalizeShaders?x.processor.finalizeShaders(L,U,x.processingContext):{vertexCode:L,fragmentCode:U}}function K(L){const U=/defined\((.+)\)/.exec(L);if(U&&U.length)return new o(U[1].trim(),"!"===L[0]);const x=["==","!=",">=","<=","<",">"];let mL="",p=0;for(mL of x)if(p=L.indexOf(mL),p>-1)break;if(-1===p)return new o(L);const G=L.substring(0,p).trim(),F=L.substring(p+mL.length).trim();return new h(G,mL,F)}function l(L,U){const x=new F,mL=L.substring(0,U);let p=L.substring(U);return p=p.substring(0,(p.indexOf("//")+1||p.length+1)-1).trim(),x.testExpression="#ifdef"===mL?new o(p):"#ifndef"===mL?new o(p,!0):function(L){L=L.replace(Y,"defined[$1]");const U=a.infixToPostfix(L),x=[];for(const p of U)if("||"!==p&&"&&"!==p)x.push(p);else if(x.length>=2){let L=x[x.length-1],U=x[x.length-2];x.length-=2;const mL="&&"==p?new r:new A;"string"===typeof L&&(L=L.replace(S,"defined($1)")),"string"===typeof U&&(U=U.replace(S,"defined($1)")),mL.leftOperand="string"===typeof U?K(U):U,mL.rightOperand="string"===typeof L?K(L):L,x.push(mL)}let mL=x[x.length-1];return"string"===typeof mL&&(mL=mL.replace(S,"defined($1)")),"string"===typeof mL?K(mL):mL}(p),x}function i(L,U,x,p){let G=L.currentLine;for(;X(L,x,p);){G=L.currentLine;const F=G.substring(0,5).toLowerCase();if("#else"===F){const x=new mL;return U.children.push(x),void X(L,x,p)}if("#elif"===F){const L=l(G,5);U.children.push(L),x=L}}}function X(L,U,x){for(;L.canRead;){L.lineIndex++;const p=L.currentLine;if(p.indexOf("#")>=0){const mL=v.exec(p);if(mL&&mL.length){switch(mL[0]){case"#ifdef":{const mL=new G;U.children.push(mL);const F=l(p,6);mL.children.push(F),i(L,mL,F,x);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const mL=new G;U.children.push(mL);const F=l(p,7);mL.children.push(F),i(L,mL,F,x);break}case"#if":{const mL=new G,F=l(p,3);U.children.push(mL),mL.children.push(F),i(L,mL,F,x);break}}continue}}const F=new mL;if(F.line=p,U.children.push(F),"#"===p[0]&&"d"===p[1]){const L=p.replace(";","").split(" ");F.additionalDefineKey=L[1],3===L.length&&(F.additionalDefineValue=L[2])}}return!1}function t(L,U,x,G){const F=new mL,a=new p;return a.lineIndex=-1,a.lines=L.split("\n"),X(a,F,G),F.process(U,x,G)}function y(L,U){var x;const mL=L.defines,p={};for(const G of mL){const L=G.replace("#define","").replace(";","").trim().split(" ");p[L[0]]=L.length>1?L[1]:""}return 0===(null===(x=L.processor)||void 0===x?void 0:x.shaderLanguage)&&(p.GL_ES="true"),p.__VERSION__=L.version,p[L.platformName]="true",(0,E.i)(p,null===U||void 0===U?void 0:U.isNDCHalfZRange,null===U||void 0===U?void 0:U.Ga,null===U||void 0===U?void 0:U.useExactSrgbConversions),p}function n(L,U,x){let mL;for(f.length=0;null!==(mL=V.exec(L));)f.push(mL);let p=String(L),G=[L],F=!1;for(const a of f){let L=a[1];if(-1!==L.indexOf("__decl__")&&(L=L.replace(H,""),U.supportsUniformBuffers&&(L=L.replace("Vertex","Ubo").replace("Fragment","Ubo")),L+="Declaration"),!U.includesShadersStore[L]){const mL=U.shadersRepository+"ShadersInclude/"+L+".fx";return void N.loadFile(mL,(mL=>{U.includesShadersStore[L]=mL,n(G.join(""),U,x)}))}{let x=U.includesShadersStore[L];if(a[2]){const L=a[3].split(",");for(let U=0;U<L.length;U+=2){const mL=new RegExp(L[U],"g"),p=L[U+1];x=x.replace(mL,p)}}if(a[4]){const L=a[5];if(-1!==L.indexOf("..")){const mL=L.split(".."),p=parseInt(mL[0]);let G=parseInt(mL[1]),F=x.slice(0);x="",isNaN(G)&&(G=U.indexParameters[mL[1]]);for(let L=p;L<G;L++)U.supportsUniformBuffers||(F=F.replace(Q,((L,U)=>U+"{X}"))),x+=F.replace(q,L.toString())+"\n"}else U.supportsUniformBuffers||(x=x.replace(Q,((L,U)=>U+"{X}"))),x=x.replace(q,L)}const mL=[];for(const L of G){const U=L.split(a[0]);for(let L=0;L<U.length-1;L++)mL.push(U[L]),mL.push(x);mL.push(U[U.length-1])}G=mL,F=F||x.indexOf("#include<")>=0||x.indexOf("#include <")>=0}}f.length=0,p=G.join(""),F?n(p.toString(),U,x):x(p)}const N={loadFile:(L,U,x,mL,p,G)=>{throw(0,b.c)("FileTools")}}},12469:(L,U,x)=>{x.d(U,{c:()=>p,f:()=>G,i:()=>a,m:()=>F,q:()=>o});var mL=x(12426);x(12397);const p={};function G(L,U){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(U?U+"\n":"")+L}function F(L,U,x,G,F,a,o){const A=o||p.loadFile;if(A){return A(L,U,x,G,F,a)}throw(0,mL.c)("FileTools")}function a(L,U,x,mL){if(L)return U?L.IS_NDC_HALF_ZRANGE="":delete L.IS_NDC_HALF_ZRANGE,x?L.USE_REVERSE_DEPTHBUFFER="":delete L.USE_REVERSE_DEPTHBUFFER,void(mL?L.USE_EXACT_SRGB_CONVERSIONS="":delete L.USE_EXACT_SRGB_CONVERSIONS);{let L="";return U&&(L+="#define IS_NDC_HALF_ZRANGE"),x&&(L&&(L+="\n"),L+="#define USE_REVERSE_DEPTHBUFFER"),mL&&(L&&(L+="\n"),L+="#define USE_EXACT_SRGB_CONVERSIONS"),L}}function o(L,U){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],mL=arguments.length>3?arguments[3]:void 0;switch(L){case 3:{const L=(ArrayBuffer,new Int8Array(U));return mL&&L.set(new Int8Array(mL)),L}case 0:{const L=(ArrayBuffer,new Uint8Array(U));return mL&&L.set(new Uint8Array(mL)),L}case 4:{const L=U instanceof ArrayBuffer?new Int16Array(U):new Int16Array(x?U/2:U);return mL&&L.set(new Int16Array(mL)),L}case 5:case 8:case 9:case 10:case 2:{const L=U instanceof ArrayBuffer?new Uint16Array(U):new Uint16Array(x?U/2:U);return mL&&L.set(new Uint16Array(mL)),L}case 6:{const L=U instanceof ArrayBuffer?new Int32Array(U):new Int32Array(x?U/4:U);return mL&&L.set(new Int32Array(mL)),L}case 7:case 11:case 12:case 13:case 14:case 15:{const L=U instanceof ArrayBuffer?new Uint32Array(U):new Uint32Array(x?U/4:U);return mL&&L.set(new Uint32Array(mL)),L}case 1:{const L=U instanceof ArrayBuffer?new Float32Array(U):new Float32Array(x?U/4:U);return mL&&L.set(new Float32Array(mL)),L}}const p=(ArrayBuffer,new Uint8Array(U));return mL&&p.set(new Uint8Array(mL)),p}},12496:(L,U,x)=>{x.d(U,{d:()=>mL});class mL{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?mL.ShadersRepository:mL.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?mL.ShadersStore:mL.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?mL.IncludesShadersStore:mL.IncludesShadersStoreWGSL}}mL.ShadersRepository="src/Shaders/",mL.ShadersStore={},mL.IncludesShadersStore={},mL.ShadersRepositoryWGSL="src/ShadersWGSL/",mL.ShadersStoreWGSL={},mL.IncludesShadersStoreWGSL={}},12510:(L,U,x)=>{x.d(U,{e:()=>b,h:()=>q,l:()=>Y,o:()=>E,r:()=>S,s:()=>Q,v:()=>h,z:()=>A,C:()=>r,G:()=>o,J:()=>a});class mL{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.EU._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(L){L&&this.program&&L(this.program)}setEngine(L){this.EU=L}_fillEffectInformation(L,U,x,mL,p,G,F,a){const o=this.EU;if(o.supportsUniformBuffers)for(const r in U)L.bindUniformBlock(r,U[r]);let A;for(this.EU.getUniforms(this,x).forEach(((L,U)=>{mL[x[U]]=L})),this._uniforms=mL,A=0;A<p.length;A++){null==L.getUniform(p[A])&&(p.splice(A,1),A--)}p.forEach(((L,U)=>{G[L]=U}));for(const r of o.getAttributes(this,F))a.push(r)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(L,U){const x=this._valueCache[L],mL=U.updateFlag;return(void 0===x||x!==mL)&&(this._valueCache[L]=mL,!0)}_cacheFloat2(L,U,x){let mL=this._valueCache[L];if(!mL||2!==mL.length)return mL=[U,x],this._valueCache[L]=mL,!0;let p=!1;return mL[0]!==U&&(mL[0]=U,p=!0),mL[1]!==x&&(mL[1]=x,p=!0),p}_cacheFloat3(L,U,x,mL){let p=this._valueCache[L];if(!p||3!==p.length)return p=[U,x,mL],this._valueCache[L]=p,!0;let G=!1;return p[0]!==U&&(p[0]=U,G=!0),p[1]!==x&&(p[1]=x,G=!0),p[2]!==mL&&(p[2]=mL,G=!0),G}_cacheFloat4(L,U,x,mL,p){let G=this._valueCache[L];if(!G||4!==G.length)return G=[U,x,mL,p],this._valueCache[L]=G,!0;let F=!1;return G[0]!==U&&(G[0]=U,F=!0),G[1]!==x&&(G[1]=x,F=!0),G[2]!==mL&&(G[2]=mL,F=!0),G[3]!==p&&(G[3]=p,F=!0),F}setInt(L,U){const x=this._valueCache[L];void 0!==x&&x===U||this.EU.setInt(this._uniforms[L],U)&&(this._valueCache[L]=U)}setInt2(L,U,x){this._cacheFloat2(L,U,x)&&(this.EU.setInt2(this._uniforms[L],U,x)||(this._valueCache[L]=null))}setInt3(L,U,x,mL){this._cacheFloat3(L,U,x,mL)&&(this.EU.setInt3(this._uniforms[L],U,x,mL)||(this._valueCache[L]=null))}setInt4(L,U,x,mL,p){this._cacheFloat4(L,U,x,mL,p)&&(this.EU.setInt4(this._uniforms[L],U,x,mL,p)||(this._valueCache[L]=null))}setIntArray(L,U){this._valueCache[L]=null,this.EU.setIntArray(this._uniforms[L],U)}setIntArray2(L,U){this._valueCache[L]=null,this.EU.setIntArray2(this._uniforms[L],U)}setIntArray3(L,U){this._valueCache[L]=null,this.EU.setIntArray3(this._uniforms[L],U)}setIntArray4(L,U){this._valueCache[L]=null,this.EU.setIntArray4(this._uniforms[L],U)}setUInt(L,U){const x=this._valueCache[L];void 0!==x&&x===U||this.EU.setUInt(this._uniforms[L],U)&&(this._valueCache[L]=U)}setUInt2(L,U,x){this._cacheFloat2(L,U,x)&&(this.EU.setUInt2(this._uniforms[L],U,x)||(this._valueCache[L]=null))}setUInt3(L,U,x,mL){this._cacheFloat3(L,U,x,mL)&&(this.EU.setUInt3(this._uniforms[L],U,x,mL)||(this._valueCache[L]=null))}setUInt4(L,U,x,mL,p){this._cacheFloat4(L,U,x,mL,p)&&(this.EU.setUInt4(this._uniforms[L],U,x,mL,p)||(this._valueCache[L]=null))}setUIntArray(L,U){this._valueCache[L]=null,this.EU.setUIntArray(this._uniforms[L],U)}setUIntArray2(L,U){this._valueCache[L]=null,this.EU.setUIntArray2(this._uniforms[L],U)}setUIntArray3(L,U){this._valueCache[L]=null,this.EU.setUIntArray3(this._uniforms[L],U)}setUIntArray4(L,U){this._valueCache[L]=null,this.EU.setUIntArray4(this._uniforms[L],U)}setArray(L,U){this._valueCache[L]=null,this.EU.setArray(this._uniforms[L],U)}setArray2(L,U){this._valueCache[L]=null,this.EU.setArray2(this._uniforms[L],U)}setArray3(L,U){this._valueCache[L]=null,this.EU.setArray3(this._uniforms[L],U)}setArray4(L,U){this._valueCache[L]=null,this.EU.setArray4(this._uniforms[L],U)}setMatrices(L,U){U&&(this._valueCache[L]=null,this.EU.setMatrices(this._uniforms[L],U))}setMatrix(L,U){this._cacheMatrix(L,U)&&(this.EU.setMatrices(this._uniforms[L],U.Va())||(this._valueCache[L]=null))}setMatrix3x3(L,U){this._valueCache[L]=null,this.EU.setMatrix3x3(this._uniforms[L],U)}setMatrix2x2(L,U){this._valueCache[L]=null,this.EU.setMatrix2x2(this._uniforms[L],U)}setFloat(L,U){const x=this._valueCache[L];void 0!==x&&x===U||this.EU.setFloat(this._uniforms[L],U)&&(this._valueCache[L]=U)}setVector2(L,U){this._cacheFloat2(L,U.x,U.y)&&(this.EU.setFloat2(this._uniforms[L],U.x,U.y)||(this._valueCache[L]=null))}setFloat2(L,U,x){this._cacheFloat2(L,U,x)&&(this.EU.setFloat2(this._uniforms[L],U,x)||(this._valueCache[L]=null))}setVector3(L,U){this._cacheFloat3(L,U.x,U.y,U.z)&&(this.EU.setFloat3(this._uniforms[L],U.x,U.y,U.z)||(this._valueCache[L]=null))}setFloat3(L,U,x,mL){this._cacheFloat3(L,U,x,mL)&&(this.EU.setFloat3(this._uniforms[L],U,x,mL)||(this._valueCache[L]=null))}setVector4(L,U){this._cacheFloat4(L,U.x,U.y,U.z,U.w)&&(this.EU.setFloat4(this._uniforms[L],U.x,U.y,U.z,U.w)||(this._valueCache[L]=null))}setQuaternion(L,U){this._cacheFloat4(L,U.x,U.y,U.z,U.w)&&(this.EU.setFloat4(this._uniforms[L],U.x,U.y,U.z,U.w)||(this._valueCache[L]=null))}setFloat4(L,U,x,mL,p){this._cacheFloat4(L,U,x,mL,p)&&(this.EU.setFloat4(this._uniforms[L],U,x,mL,p)||(this._valueCache[L]=null))}setColor3(L,U){this._cacheFloat3(L,U.r,U.g,U.b)&&(this.EU.setFloat3(this._uniforms[L],U.r,U.g,U.b)||(this._valueCache[L]=null))}setColor4(L,U,x){this._cacheFloat4(L,U.r,U.g,U.b,x)&&(this.EU.setFloat4(this._uniforms[L],U.r,U.g,U.b,x)||(this._valueCache[L]=null))}setDirectColor4(L,U){this._cacheFloat4(L,U.r,U.g,U.b,U.a)&&(this.EU.setFloat4(this._uniforms[L],U.r,U.g,U.b,U.a)||(this._valueCache[L]=null))}_getVertexShaderCode(){return this.vertexShader?this.EU._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.EU._getShaderSource(this.fragmentShader):null}}var p=x(12469);const G=new WeakMap,F={_webGLVersion:2,cachedPipelines:{}};function a(L){let U=G.get(L);if(!U){if(!L)return F;U={_webGLVersion:L.TEXTURE_BINDING_3D?2:1,_context:L,parallelShaderCompile:L.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},G.set(L,U)}return U}function o(L){G.delete(L)}function A(L,U,x,mL,p,G){const F=a(mL);G||(G=F._createShaderProgramInjection??b);return G(L,H(U,"vertex",mL,F._contextWasLost),H(x,"fragment",mL,F._contextWasLost),mL,p,F.validateShaderPrograms)}function r(L,U,x,mL,p){let G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6?arguments[6]:void 0;const o=a(p);F||(F=o._createShaderProgramInjection??b);const A=o._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return F(L,V(U,"vertex",mL,A,p,o._contextWasLost),V(x,"fragment",mL,A,p,o._contextWasLost),p,G,o.validateShaderPrograms)}function h(L,U){const x=new mL,p=a(L);return p.parallelShaderCompile&&!p.disableParallelShaderCompile&&(x.isParallelCompiled=!0),x.context=p._context,x}function b(L,U,x,mL){let p=arguments.length>5?arguments[5]:void 0;const G=mL.createProgram();if(L.program=G,!G)throw new Error("Unable to create program");return mL.attachShader(G,U),mL.attachShader(G,x),mL.linkProgram(G),L.context=mL,L.vertexShader=U,L.fragmentShader=x,L.isParallelCompiled||Y(L,mL,p),G}function E(L,U,x){const mL=L;if(mL._isDisposed)return!1;const p=a(U);return!!(p&&p.parallelShaderCompile&&p.parallelShaderCompile.COMPLETION_STATUS_KHR&&mL.program&&U.getProgramParameter(mL.program,p.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(Y(mL,U,x),!0)}function Y(L,U,x){const mL=L.context,p=L.vertexShader,G=L.fragmentShader,F=L.program;if(!mL.getProgramParameter(F,mL.LINK_STATUS)){if(!U.getShaderParameter(p,U.COMPILE_STATUS)){const x=U.getShaderInfoLog(p);if(x)throw L.vertexCompilationError=x,new Error("VERTEX SHADER "+x)}if(!U.getShaderParameter(G,U.COMPILE_STATUS)){const x=U.getShaderInfoLog(G);if(x)throw L.fragmentCompilationError=x,new Error("FRAGMENT SHADER "+x)}const x=mL.getProgramInfoLog(F);if(x)throw L.programLinkError=x,new Error(x)}if(x){mL.validateProgram(F);if(!mL.getProgramParameter(F,mL.VALIDATE_STATUS)){const U=mL.getProgramInfoLog(F);if(U)throw L.programValidationError=U,new Error(U)}}mL.deleteShader(p),mL.deleteShader(G),L.vertexShader=void 0,L.fragmentShader=void 0,L.onCompiled&&(L.onCompiled(),L.onCompiled=void 0)}function S(L,U,x,mL,p,G,F,o,h){let b=arguments.length>10?arguments[10]:void 0,E=arguments.length>11?arguments[11]:void 0,Y=arguments.length>12?arguments[12]:void 0;const S=a(L.context);E||(E=S.createRawShaderProgramInjection??A),Y||(Y=S.createShaderProgramInjection??r);const V=L;V.program=mL?E(V,U,x,V.context,h):Y(V,U,x,o,V.context,h),V.program.__SPECTOR_rebuildProgram=F,b()}function V(L,U,x,mL,G,F){return H((0,p.f)(L,x,mL),U,G,F)}function H(L,U,x,mL){const p=x.createShader("vertex"===U?x.VERTEX_SHADER:x.FRAGMENT_SHADER);if(!p){let L=x.NO_ERROR,p=x.NO_ERROR;for(;(p=x.getError())!==x.NO_ERROR;)L=p;throw new Error(`Something went wrong while creating a gl ${U} shader object. gl error=${L}, gl isContextLost=${x.isContextLost()}, _contextWasLost=${mL}`)}return x.shaderSource(p,L),x.compileShader(p),p}function Q(L,U){U.useProgram(L)}function q(L,U){const x=L;if(!x.isParallelCompiled)return void U(L);const mL=x.onCompiled;x.onCompiled=()=>{null===mL||void 0===mL||mL(),U(L)}}},12501:(L,U,x)=>{x.d(U,{c:()=>h,e:()=>E,g:()=>A,i:()=>r});var mL=x(12397),p=x(12510),G=x(12496),F=x(12406),a=x(12464),o=x(12469);function A(L,U){return(0,p.J)(U).cachedPipelines[L]}function r(L){const U=L._name,x=L.context;if(U&&x){const L=(0,p.J)(x),mL=L.cachedPipelines[U];null===mL||void 0===mL||mL.dispose(),delete L.cachedPipelines[U]}}function h(L,U,x,p,G,F,o){let A,r;const h=(0,mL.j)()?null===F||void 0===F?void 0:F.getHostDocument():null;A="string"===typeof U?U:U.vertexSource?"source:"+U.vertexSource:U.vertexElement?(null===h||void 0===h?void 0:h.getElementById(U.vertexElement))||U.vertexElement:U.vertex||U,r="string"===typeof U?U:U.fragmentSource?"source:"+U.fragmentSource:U.fragmentElement?(null===h||void 0===h?void 0:h.getElementById(U.fragmentElement))||U.fragmentElement:U.fragment||U;const E=[void 0,void 0],Y=()=>{if(E[0]&&E[1]){L.isFragment=!0;const[mL,A]=E;(0,a.l)(A,L,((F,A)=>{o&&(o._fragmentSourceCodeBeforeMigration=A),x&&(F=x("fragment",F));const r=(0,a.e)(mL,F,L);L=null;const h=function(L,U,x,mL){if(x){return{vertexSourceCode:(1===mL?"//":"")+"#define SHADER_NAME vertex:"+(x.vertexElement||x.vertex||x.spectorName||x)+"\n"+L,fragmentSourceCode:(1===mL?"//":"")+"#define SHADER_NAME fragment:"+(x.fragmentElement||x.fragment||x.spectorName||x)+"\n"+U}}return{vertexSourceCode:L,fragmentSourceCode:U}}(r.vertexCode,r.fragmentCode,U,G);null===p||void 0===p||p(h.vertexSourceCode,h.fragmentSourceCode)}),F)}};b(A,"Vertex","",(U=>{(0,a.i)(L),(0,a.l)(U,L,((L,mL)=>{o&&(o._rawVertexSourceCode=U,o._vertexSourceCodeBeforeMigration=mL),x&&(L=x("vertex",L)),E[0]=L,Y()}),F)}),G),b(r,"Fragment","Pixel",(L=>{o&&(o._rawFragmentSourceCode=L),E[1]=L,Y()}),G)}function b(L,U,x,p,F,a){if("undefined"!==typeof HTMLElement&&L instanceof HTMLElement){return void p((0,mL.b)(L))}if("source:"===L.substring(0,7))return void p(L.substring(7));if("base64:"===L.substring(0,7)){return void p(window.atob(L.substring(7)))}const A=G.d.GetShadersStore(F);if(A[L+U+"Shader"])return void p(A[L+U+"Shader"]);if(x&&A[L+x+"Shader"])return void p(A[L+x+"Shader"]);let r;if(r="."===L[0]||"/"===L[0]||L.indexOf("http")>-1?L:G.d.GetShadersRepository(F)+L,!(a=a||o.m))throw new Error("loadFileInjection is not defined");a(r+"."+U.toLowerCase()+".fx",p)}const E=(L,U,x,mL)=>{try{const G=L.context?(0,p.J)(L.context):null;G&&(G.disableParallelShaderCompile=L.disableParallelCompilation);const F=L.existingPipelineContext||U(L.shaderProcessingContext);return F._name=L.name,L.name&&G&&(G.cachedPipelines[L.name]=F),x(F,L.vertex,L.fragment,!!L.createAsRaw,"","",L.rebuildRebind,L.defines,L.transformFeedbackVaryings,"",(()=>{mL(F,(()=>{var U;null===(U=L.onRenderingStateCompiled)||void 0===U||U.call(L,F)}))})),F}catch(G){throw F.c.Error("Error compiling effect"),G}}},12487:(L,U,x)=>{x.r(U),x.d(U,{Effect:()=>o});var mL=x(12391),p=x(12406),G=x(12496),F=x(12501),a=x(12475);class o{static get ShadersRepository(){return G.d.ShadersRepository}static set ShadersRepository(L){G.d.ShadersRepository=L}get A(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new mL.c),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(L,U,x){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,b=arguments.length>9?arguments[9]:void 0,E=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",Y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,S=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new mL.c,this.onErrorObservable=new mL.c,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=L,this._key=E;const V=this._key.replace(/\r/g,"").replace(/\n/g,"|");let H;if(U.attributes){const L=U;if(this._engine=x,this._attributesNames=L.attributes,this._uniformsNames=L.uniformsNames.concat(L.samplers),this._samplerList=L.samplers.slice(),this.defines=L.defines,this.onError=L.onError,this.onCompiled=L.onCompiled,this._fallbacks=L.fallbacks,this._indexParameters=L.indexParameters,this._transformFeedbackVaryings=L.transformFeedbackVaryings||null,this._multiTarget=!!L.multiTarget,this._shaderLanguage=L.shaderLanguage??0,this._disableParallelShaderCompilation=!!L.disableParallelShaderCompilation,L.uniformBuffersNames){this._uniformBuffersNamesList=L.uniformBuffersNames.slice();for(let U=0;U<L.uniformBuffersNames.length;U++)this._uniformBuffersNames[L.uniformBuffersNames[U]]=U}this._processFinalCode=L.processFinalCode??null,this._processCodeAfterIncludes=L.processCodeAfterIncludes??void 0,S=L.extraInitializationsAsync,H=L.existingPipelineContext}else this._engine=G,this.defines=null==a?"":a,this._uniformsNames=x.concat(p),this._samplerList=p?p.slice():[],this._attributesNames=U,this._uniformBuffersNamesList=[],this._shaderLanguage=Y,this.onError=h,this.onCompiled=r,this._indexParameters=b,this._fallbacks=A;"WEBGL2"===this._engine.shaderPlatformName&&(H=(0,F.g)(V,this._engine._gl)??H),this._attributeLocationByName={},this.uniqueId=o._UniqueIdSeed++,H?(this._pipelineContext=H,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,S),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.A||this.dispose(!0)}))}async _processShaderCodeAsync(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,mL=arguments.length>3?arguments[3]:void 0;mL&&await mL(),this._processingContext=x||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const p={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:L??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:G.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:G.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,Ga:this._engine.Ga,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,F.c)(p,this.name,this._processFinalCode,((L,x)=>{this._vertexSourceCode=L,this._fragmentSourceCode=x,this._prepareEffect(U)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.A||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(L){return this._attributes[L]}getAttributeLocationByName(L){return this._attributeLocationByName[L]}getAttributesCount(){return this._attributes.length}getUniformIndex(L){return this._uniformsNames.indexOf(L)}getUniform(L){return this._uniforms[L]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((L=>{this.executeWhenCompiled(L)}))}executeWhenCompiled(L){this.isReady()?L(this):(this.onCompileObservable.add((U=>{L(U)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(L){(0,a.h)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(U=>{this._processCompilationErrors(U,L)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var L;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(L=this._pipelineContext)||void 0===L?void 0:L._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var L;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(L=this._pipelineContext)||void 0===L?void 0:L._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,Ga:this._engine.Ga,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(L,U,x,mL){this._isReady=!1,this._vertexSourceCodeOverride=L,this._fragmentSourceCodeOverride=U,this.onError=(L,U)=>{mL&&mL(U)},this.onCompiled=()=>{var L,U;const mL=this.getEngine().scenes;if(mL)for(let x=0;x<mL.length;x++)mL[x].markAllMaterialsAsDirty(127);null===(L=(U=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===L||L.call(U,x)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(L){if(this._pipelineContext=L,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let U=0;U<this._attributesNames.length;U++){const L=this._attributesNames[U];this._attributeLocationByName[L]=this._attributes[U]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),o.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U=this._pipelineContext;this._isReady=!1;try{const x=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),mL=x?null:this.defines,p=x?this._vertexSourceCodeOverride:this._vertexSourceCode,G=x?this._fragmentSourceCodeOverride:this._fragmentSourceCode,a=this._engine;this._pipelineContext=(0,F.e)({existingPipelineContext:L?U:null,vertex:p,fragment:G,context:"WEBGL2"===a.shaderPlatformName||"WEBGL1"===a.shaderPlatformName?a._gl:void 0,rebuildRebind:(L,U,x,mL)=>this._rebuildProgram(L,U,x,mL),defines:mL,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:x,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:x=>{U&&!L&&this._engine._deletePipelineContext(U),x&&this._onRenderingStateCompiled(x)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(U)}catch(x){this._processCompilationErrors(x,U)}}_getShaderCodeAndErrorLine(L,U,x){const mL=x?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let p=null;if(U&&L){const G=U.match(mL);if(G&&2===G.length){const U=parseInt(G[1]),mL=L.split("\n",-1);mL.length>=U&&(p=`Offending line [${U}] in ${x?"fragment":"vertex"} code: ${mL[U-1]}`)}}return[L,p]}_processCompilationErrors(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=L.message;const x=this._attributesNames,mL=this._fallbacks;if(p.c.Error("Unable to compile effect:"),p.c.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),p.c.Error(`Attributes: ${x.join(" ")}`),p.c.Error("Defines:\n"+this.defines),o.LogShaderCodeOnCompilationError){var G,F;let L=null,U=null,x=null;var a;if(null!==(G=this._pipelineContext)&&void 0!==G&&G._getVertexShaderCode()&&([x,L]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),x&&(p.c.Error("Vertex code:"),p.c.Error(x))),null!==(F=this._pipelineContext)&&void 0!==F&&F._getFragmentShaderCode())[x,U]=this._getShaderCodeAndErrorLine(null===(a=this._pipelineContext)||void 0===a?void 0:a._getFragmentShaderCode(),this._compilationError,!0),x&&(p.c.Error("Fragment code:"),p.c.Error(x));L&&p.c.Error(L),U&&p.c.Error(U)}p.c.Error("Error: "+this._compilationError);const A=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};U&&(this._pipelineContext=U,this._isReady=!0,A()),mL?(this._pipelineContext=null,mL.hasMoreFallbacks?(this._allFallbacksProcessed=!1,p.c.Error("Trying next fallback."),this.defines=mL.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,A(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,U||A())}get isSupported(){return""===this._compilationError}_bindTexture(L,U){this._engine._bindTexture(this._samplers[L],U,L)}setTexture(L,U){this._engine.setTexture(this._samplers[L],this._uniforms[L],U,L)}setTextureArray(L,U){const x=L+"Ex";if(-1===this._samplerList.indexOf(x+"0")){const mL=this._samplerList.indexOf(L);for(let L=1;L<U.length;L++){const U=x+(L-1).toString();this._samplerList.splice(mL+L,0,U)}let p=0;for(const L of this._samplerList)this._samplers[L]=p,p+=1}this._engine.setTextureArray(this._samplers[L],this._uniforms[L],U,L)}bindUniformBuffer(L,U){const x=this._uniformBuffersNames[U];void 0===x||o._BaseCache[x]===L&&this._engine._features.useUBOBindingCache||(o._BaseCache[x]=L,this._engine.bindUniformBufferBase(L,x,U))}bindUniformBlock(L,U){this._engine.bindUniformBlock(this._pipelineContext,L,U)}setInt(L,U){return this._pipelineContext.setInt(L,U),this}setInt2(L,U,x){return this._pipelineContext.setInt2(L,U,x),this}setInt3(L,U,x,mL){return this._pipelineContext.setInt3(L,U,x,mL),this}setInt4(L,U,x,mL,p){return this._pipelineContext.setInt4(L,U,x,mL,p),this}setIntArray(L,U){return this._pipelineContext.setIntArray(L,U),this}setIntArray2(L,U){return this._pipelineContext.setIntArray2(L,U),this}setIntArray3(L,U){return this._pipelineContext.setIntArray3(L,U),this}setIntArray4(L,U){return this._pipelineContext.setIntArray4(L,U),this}setUInt(L,U){return this._pipelineContext.setUInt(L,U),this}setUInt2(L,U,x){return this._pipelineContext.setUInt2(L,U,x),this}setUInt3(L,U,x,mL){return this._pipelineContext.setUInt3(L,U,x,mL),this}setUInt4(L,U,x,mL,p){return this._pipelineContext.setUInt4(L,U,x,mL,p),this}setUIntArray(L,U){return this._pipelineContext.setUIntArray(L,U),this}setUIntArray2(L,U){return this._pipelineContext.setUIntArray2(L,U),this}setUIntArray3(L,U){return this._pipelineContext.setUIntArray3(L,U),this}setUIntArray4(L,U){return this._pipelineContext.setUIntArray4(L,U),this}setFloatArray(L,U){return this._pipelineContext.setArray(L,U),this}setFloatArray2(L,U){return this._pipelineContext.setArray2(L,U),this}setFloatArray3(L,U){return this._pipelineContext.setArray3(L,U),this}setFloatArray4(L,U){return this._pipelineContext.setArray4(L,U),this}setArray(L,U){return this._pipelineContext.setArray(L,U),this}setArray2(L,U){return this._pipelineContext.setArray2(L,U),this}setArray3(L,U){return this._pipelineContext.setArray3(L,U),this}setArray4(L,U){return this._pipelineContext.setArray4(L,U),this}setMatrices(L,U){return this._pipelineContext.setMatrices(L,U),this}setMatrix(L,U){return this._pipelineContext.setMatrix(L,U),this}setMatrix3x3(L,U){return this._pipelineContext.setMatrix3x3(L,U),this}setMatrix2x2(L,U){return this._pipelineContext.setMatrix2x2(L,U),this}setFloat(L,U){return this._pipelineContext.setFloat(L,U),this}setBool(L,U){return this._pipelineContext.setInt(L,U?1:0),this}setVector2(L,U){return this._pipelineContext.setVector2(L,U),this}setFloat2(L,U,x){return this._pipelineContext.setFloat2(L,U,x),this}setVector3(L,U){return this._pipelineContext.setVector3(L,U),this}setFloat3(L,U,x,mL){return this._pipelineContext.setFloat3(L,U,x,mL),this}setVector4(L,U){return this._pipelineContext.setVector4(L,U),this}setQuaternion(L,U){return this._pipelineContext.setQuaternion(L,U),this}setFloat4(L,U,x,mL,p){return this._pipelineContext.setFloat4(L,U,x,mL,p),this}setColor3(L,U){return this._pipelineContext.setColor3(L,U),this}setColor4(L,U,x){return this._pipelineContext.setColor4(L,U,x),this}setDirectColor4(L,U){return this._pipelineContext.setDirectColor4(L,U),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(o.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,F.i)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(L,U,x){let mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;U&&(G.d.GetShadersStore(mL)[`${L}PixelShader`]=U),x&&(G.d.GetShadersStore(mL)[`${L}VertexShader`]=x)}static ResetCache(){o._BaseCache={}}}o.LogShaderCodeOnCompilationError=!0,o.PersistentMode=!1,o.AutomaticallyClearCodeCache=!1,o._UniqueIdSeed=0,o._BaseCache={},o.ShadersStore=G.d.ShadersStore,o.IncludesShadersStore=G.d.IncludesShadersStore},12426:(L,U,x)=>{x.d(U,{c:()=>p});const mL={};function p(L){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!mL[L])return mL[L]=!0,`${L} needs to be imported before as it contains a side-effect required by your code.`}},12397:(L,U,x)=>{function mL(){return"undefined"!==typeof window}function p(){return"undefined"!==typeof navigator}function G(){return"undefined"!==typeof document}function F(L){let U="",x=L.firstChild;for(;x;)3===x.nodeType&&(U+=x.textContent),x=x.nextSibling;return U}x.d(U,{b:()=>F,d:()=>G,h:()=>p,j:()=>mL})},12406:(L,U,x)=>{x.d(U,{c:()=>mL});class mL{static _CheckLimit(L,U){let x=mL._LogLimitOutputs[L];return x?x.current++:(x={limit:U,current:1},mL._LogLimitOutputs[L]=x),x.current<=x.limit}static _GenerateLimitMessage(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const x=mL._LogLimitOutputs[L];if(!x||!mL.MessageLimitReached)return;const p=this._Levels[U];x.current===x.limit&&mL[p.name](mL.MessageLimitReached.replace(/%LIMIT%/g,""+x.limit).replace(/%TYPE%/g,p.name??""))}static _AddLogEntry(L){mL._LogCache=L+mL._LogCache,mL.OnNewCacheEntry&&mL.OnNewCacheEntry(L)}static _FormatMessage(L){const U=L=>L<10?"0"+L:""+L,x=new Date;return"["+U(x.getHours())+":"+U(x.getMinutes())+":"+U(x.getSeconds())+"]: "+L}static _LogDisabled(L,U){}static _LogEnabled(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1?arguments[1]:void 0,x=arguments.length>2?arguments[2]:void 0;const p=Array.isArray(U)?U[0]:U;if(void 0!==x&&!mL._CheckLimit(p,x))return;const G=mL._FormatMessage(p),F=this._Levels[L],a=Array.isArray(U)?U.slice(1):[];F.logFunc&&F.logFunc("BJS - "+G,...a);const o=`<div style='color:${F.color}'>${G}</div><br>`;mL._AddLogEntry(o),mL._GenerateLimitMessage(p,L)}static get LogCache(){return mL._LogCache}static ClearLogCache(){mL._LogCache="",mL._LogLimitOutputs={},mL.errorsCount=0}static set LogLevels(L){mL.Log=mL._LogDisabled,mL.Warn=mL._LogDisabled,mL.Error=mL._LogDisabled;const U=[mL.MessageLogLevel,mL.WarningLogLevel,mL.ErrorLogLevel];for(const x of U)if((L&x)===x){const L=this._Levels[x];mL[L.name]=mL._LogEnabled.bind(mL,x)}}}mL.NoneLogLevel=0,mL.MessageLogLevel=1,mL.WarningLogLevel=2,mL.ErrorLogLevel=4,mL.AllLogLevel=7,mL.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",mL._LogCache="",mL._LogLimitOutputs={},mL._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],mL.errorsCount=0,mL.Log=mL._LogEnabled.bind(mL,mL.MessageLogLevel),mL.Warn=mL._LogEnabled.bind(mL,mL.WarningLogLevel),mL.Error=mL._LogEnabled.bind(mL,mL.ErrorLogLevel)},12391:(L,U,x)=>{x.d(U,{c:()=>F});const mL="undefined"!==typeof WeakRef;class p{constructor(L){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2?arguments[2]:void 0,mL=arguments.length>3?arguments[3]:void 0;this.initialize(L,U,x,mL)}initialize(L){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2?arguments[2]:void 0,mL=arguments.length>3?arguments[3]:void 0;return this.mask=L,this.skipNextObservers=U,this.target=x,this.currentTarget=mL,this}}class G{constructor(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=L,this.mask=U,this.scope=x,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(L)}}class F{static FromPromise(L,U){const x=new F;return L.then((L=>{x.notifyObservers(L)})).catch((L=>{if(!U)throw L;U.notifyObservers(L)})),x}get observers(){return this._observers}constructor(L){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=U,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new p(0),L&&(this._onObserverAdded=L)}add(L){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!L)return null;const p=new G(L,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);p.unregisterOnNextCall=x,U?this._observers.unshift(p):this._observers.push(p),this._onObserverAdded&&this._onObserverAdded(p),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(p,this._lastNotifiedValue);const F=mL?new WeakRef(this):{deref:()=>this};return p._remove=function(){let L=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U=F.deref();U&&(L?U.remove(p):U._remove(p))},p}addOnce(L){return this.add(L,void 0,void 0,void 0,!0)}remove(L){if(!L)return!1;L._remove=null;return-1!==this._observers.indexOf(L)&&(this._deferUnregister(L),!0)}removeCallback(L,U){for(let x=0;x<this._observers.length;x++){const mL=this._observers[x];if(!mL._willBeUnregistered&&(mL.callback===L&&(!U||U===mL.scope)))return this._deferUnregister(mL),!0}return!1}_deferUnregister(L){L._willBeUnregistered||(this._numObserversMarkedAsDeleted++,L.unregisterOnNextCall=!1,L._willBeUnregistered=!0,setTimeout((()=>{this._remove(L)}),0))}_remove(L){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!L)return!1;const x=this._observers.indexOf(L);return-1!==x&&(U&&this._numObserversMarkedAsDeleted--,this._observers.splice(x,1),!0)}makeObserverTopPriority(L){this._remove(L,!1),this._observers.unshift(L)}makeObserverBottomPriority(L){this._remove(L,!1),this._observers.push(L)}notifyObservers(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,x=arguments.length>2?arguments[2]:void 0,mL=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=L),!this._observers.length)return!0;const G=this._eventState;G.mask=U,G.target=x,G.currentTarget=mL,G.skipNextObservers=!1,G.lastReturnValue=L,G.userInfo=p;for(const F of this._observers)if(!F._willBeUnregistered&&(F.mask&U&&(F.unregisterOnNextCall&&this._deferUnregister(F),F.scope?G.lastReturnValue=F.callback.apply(F.scope,[L,G]):G.lastReturnValue=F.callback(L,G)),G.skipNextObservers))return!1;return!0}notifyObserver(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=U),L._willBeUnregistered)return;const mL=this._eventState;mL.mask=x,mL.skipNextObservers=!1,L.unregisterOnNextCall&&this._deferUnregister(L),L.callback(U,mL)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const L=this._observers.pop();L&&(L._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const L=new F;return L._observers=this._observers.slice(0),L}hasSpecificMask(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const U of this._observers)if(U.mask&L||U.mask===L)return!0;return!1}}},12475:(L,U,x)=>{x.d(U,{e:()=>p,h:()=>F});let mL=[];class p{static SetImmediate(L){0===mL.length&&setTimeout((()=>{const L=mL;mL=[];for(const U of L)U()}),1),mL.push(L)}}function G(L,U,x){try{if(L())return U(),!0}catch(mL){return null===x||void 0===x||x(mL),!0}return!1}const F=function(L,U,x){let mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,F=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&G(L,U,x))return null;const a=setInterval((()=>{G(L,U,x)?clearInterval(a):(p-=mL,p<0&&(clearInterval(a),null===x||void 0===x||x(new Error("Operation timed out after maximum retries. "+(F||"")),!0)))}),mL);return()=>clearInterval(a)}}}]);