"use strict";(self["686i8587bmi"]=self["686i8587bmi"]||[]).push([[9],{12641:(h,d,T)=>{T.d(d,{d:()=>E,g:()=>w,k:()=>s,j:()=>o,n:()=>u});class Y{constructor(){this.children=[]}isValid(h){return!0}process(h,d,T){let Y="";if(this.line){let T=this.line;const Z=d.processor;if(Z){var y,C,n,X,F,U;Z.lineProcessor&&(T=Z.lineProcessor(T,d.isFragment,d.processingContext));const Y=(null===(y=d.processor)||void 0===y?void 0:y.attributeKeywordName)??"attribute",S=d.isFragment&&null!==(C=d.processor)&&void 0!==C&&C.varyingFragmentKeywordName?null===(n=d.processor)||void 0===n?void 0:n.varyingFragmentKeywordName:!d.isFragment&&null!==(X=d.processor)&&void 0!==X&&X.varyingVertexKeywordName?null===(F=d.processor)||void 0===F?void 0:F.varyingVertexKeywordName:"varying";if(!d.isFragment&&Z.attributeProcessor&&this.line.startsWith(Y))T=Z.attributeProcessor(this.line,h,d.processingContext);else if(Z.varyingProcessor&&(null!==(U=Z.varyingCheck)&&void 0!==U&&U.call(Z,this.line,d.isFragment)||!Z.varyingCheck&&this.line.startsWith(S)))T=Z.varyingProcessor(this.line,d.isFragment,h,d.processingContext);else if(Z.uniformProcessor&&Z.uniformRegexp&&Z.uniformRegexp.test(this.line))d.lookForClosingBracketForUniformBuffer||(T=Z.uniformProcessor(this.line,d.isFragment,h,d.processingContext));else if(Z.uniformBufferProcessor&&Z.uniformBufferRegexp&&Z.uniformBufferRegexp.test(this.line))d.lookForClosingBracketForUniformBuffer||(T=Z.uniformBufferProcessor(this.line,d.isFragment,d.processingContext),d.lookForClosingBracketForUniformBuffer=!0);else if(Z.textureProcessor&&Z.textureRegexp&&Z.textureRegexp.test(this.line))T=Z.textureProcessor(this.line,d.isFragment,h,d.processingContext);else if((Z.uniformProcessor||Z.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!d.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?Z.uniformProcessor&&(T=Z.uniformProcessor(this.line,d.isFragment,h,d.processingContext)):Z.uniformBufferProcessor&&(T=Z.uniformBufferProcessor(this.line,d.isFragment,d.processingContext),d.lookForClosingBracketForUniformBuffer=!0)}d.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(d.lookForClosingBracketForUniformBuffer=!1,Z.endOfUniformBufferProcessor&&(T=Z.endOfUniformBufferProcessor(this.line,d.isFragment,d.processingContext)))}Y+=T+"\n"}for(const Z of this.children)Y+=Z.process(h,d,T);return this.additionalDefineKey&&(h[this.additionalDefineKey]=this.additionalDefineValue||"true",T[this.additionalDefineKey]=h[this.additionalDefineKey]),Y}}class y{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(h){this._lines.length=0;for(const d of h){if(!d||"\r"===d)continue;if("#"===d[0]){this._lines.push(d);continue}const h=d.trim();if(!h)continue;if(h.startsWith("//")){this._lines.push(d);continue}const T=h.indexOf(";");if(-1===T)this._lines.push(h);else if(T===h.length-1)h.length>1&&this._lines.push(h);else{const h=d.split(";");for(let d=0;d<h.length;d++){let T=h[d];T&&(T=T.trim(),T&&this._lines.push(T+(d!==h.length-1?";":"")))}}}}}class C extends Y{process(h,d,T){for(let Y=0;Y<this.children.length;Y++){const y=this.children[Y];if(y.isValid(h))return y.process(h,d,T)}return""}}class n extends Y{isValid(h){return this.testExpression.isTrue(h)}}class X{isTrue(h){return!0}static postfixToInfix(h){const d=[];for(const T of h)if(void 0===X._OperatorPriority[T])d.push(T);else{const h=d[d.length-1],Y=d[d.length-2];d.length-=2,d.push(`(${Y}${T}${h})`)}return d[d.length-1]}static infixToPostfix(h){const d=X._InfixToPostfixCache.get(h);if(d)return d.accessTime=Date.now(),d.result;if(!h.includes("&&")&&!h.includes("||")&&!h.includes(")")&&!h.includes("("))return[h];const T=[];let Y=-1;const y=()=>{Z=Z.trim(),""!==Z&&(T.push(Z),Z="")},C=h=>{Y<X._Stack.length-1&&(X._Stack[++Y]=h)},n=()=>X._Stack[Y],F=()=>-1===Y?"!!INVALID EXPRESSION!!":X._Stack[Y--];let U=0,Z="";for(;U<h.length;){const d=h.charAt(U),S=U<h.length-1?h.substring(U,2+U):"";if("("===d)Z="",C(d);else if(")"===d){for(y();-1!==Y&&"("!==n();)T.push(F());F()}else if(X._OperatorPriority[S]>1){for(y();-1!==Y&&X._OperatorPriority[n()]>=X._OperatorPriority[S];)T.push(F());C(S),U++}else Z+=d;U++}for(y();-1!==Y;)"("===n()?F():T.push(F());return X._InfixToPostfixCache.size>=X.InfixToPostfixCacheLimitSize&&X.ClearCache(),X._InfixToPostfixCache.set(h,{result:T,accessTime:Date.now()}),T}static ClearCache(){const h=Array.from(X._InfixToPostfixCache.entries()).sort(((h,d)=>h[1].accessTime-d[1].accessTime));for(let d=0;d<X.InfixToPostfixCacheCleanupSize;d++)X._InfixToPostfixCache.delete(h[d][0])}}X.InfixToPostfixCacheLimitSize=5e4,X.InfixToPostfixCacheCleanupSize=25e3,X._InfixToPostfixCache=new Map,X._OperatorPriority={")":0,"(":1,"||":2,"&&":3},X._Stack=["","","","","","","","","","","","","","","","","","","",""];class F extends X{constructor(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=h,this.not=d}isTrue(h){let d=void 0!==h[this.define];return this.not&&(d=!d),d}}class U extends X{isTrue(h){return this.leftOperand.isTrue(h)||this.rightOperand.isTrue(h)}}class Z extends X{isTrue(h){return this.leftOperand.isTrue(h)&&this.rightOperand.isTrue(h)}}class S extends X{constructor(h,d,T){super(),this.define=h,this.operand=d,this.testValue=T}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(h){let d=!1;const T=parseInt(void 0!=h[this.define]?h[this.define]:this.define),Y=parseInt(void 0!=h[this.testValue]?h[this.testValue]:this.testValue);if(isNaN(T)||isNaN(Y))return!1;switch(this.operand){case">":d=T>Y;break;case"<":d=T<Y;break;case"<=":d=T<=Y;break;case">=":d=T>=Y;break;case"==":d=T===Y;break;case"!=":d=T!==Y}return d}}var r=T(12617),c=T(12647);const O=/defined\s*?\((.+?)\)/g,f=/defined\s*?\[(.+?)\]/g,J=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,W=/__decl__/,L=/light\{X\}.(\w*)/g,D=/\{X\}/g,V=[],i=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function w(h){h.processor&&h.processor.initializeShaders&&h.processor.initializeShaders(h.processingContext)}function s(h,d,T,Y){var y;null!==(y=d.processor)&&void 0!==y&&y.preProcessShaderCode&&(h=d.processor.preProcessShaderCode(h,d.isFragment)),o(h,d,(h=>{d.processCodeAfterIncludes&&(h=d.processCodeAfterIncludes(d.isFragment?"fragment":"vertex",h,d.defines));const y=function(h,d,T){let Y=function(h,d){var T;if(null!==(T=d.processor)&&void 0!==T&&T.noPrecision)return h;const Y=d.shouldUseHighPrecisionShader;-1===h.indexOf("precision highp float")?h=Y?"precision highp float;\n"+h:"precision mediump float;\n"+h:Y||(h=h.replace("precision highp float","precision mediump float"));return h}(h,d);if(!d.processor)return Y;if(0===d.processor.shaderLanguage&&-1!==Y.indexOf("#version 3")&&(Y=Y.replace("#version 300 es",""),!d.processor.parseGLES3))return Y;const y=d.defines,C=k(d,T);d.processor.preProcessor&&(Y=d.processor.preProcessor(Y,y,C,d.isFragment,d.processingContext));const n={};Y=p(Y,C,d,n),d.processor.postProcessor&&(Y=d.processor.postProcessor(Y,y,d.isFragment,d.processingContext,T?{drawBuffersExtensionDisabled:!T.getCaps().drawBuffersExtension}:{},C,n));null!==T&&void 0!==T&&T._features.needShaderCodeInlining&&(Y=T.inlineShaderCode(Y));return Y}(h,d,Y);T(y,h)}))}function E(h,d,T){return T.processor&&T.processor.finalizeShaders?T.processor.finalizeShaders(h,d,T.processingContext):{vertexCode:h,fragmentCode:d}}function z(h){const d=/defined\((.+)\)/.exec(h);if(d&&d.length)return new F(d[1].trim(),"!"===h[0]);const T=["==","!=",">=","<=","<",">"];let Y="",y=0;for(Y of T)if(y=h.indexOf(Y),y>-1)break;if(-1===y)return new F(h);const C=h.substring(0,y).trim(),n=h.substring(y+Y.length).trim();return new S(C,Y,n)}function x(h,d){const T=new n,Y=h.substring(0,d);let y=h.substring(d);return y=y.substring(0,(y.indexOf("//")+1||y.length+1)-1).trim(),T.testExpression="#ifdef"===Y?new F(y):"#ifndef"===Y?new F(y,!0):function(h){h=h.replace(O,"defined[$1]");const d=X.infixToPostfix(h),T=[];for(const y of d)if("||"!==y&&"&&"!==y)T.push(y);else if(T.length>=2){let h=T[T.length-1],d=T[T.length-2];T.length-=2;const Y="&&"==y?new Z:new U;"string"===typeof h&&(h=h.replace(f,"defined($1)")),"string"===typeof d&&(d=d.replace(f,"defined($1)")),Y.leftOperand="string"===typeof d?z(d):d,Y.rightOperand="string"===typeof h?z(h):h,T.push(Y)}let Y=T[T.length-1];return"string"===typeof Y&&(Y=Y.replace(f,"defined($1)")),"string"===typeof Y?z(Y):Y}(y),T}function g(h,d,T,y){let C=h.currentLine;for(;H(h,T,y);){C=h.currentLine;const n=C.substring(0,5).toLowerCase();if("#else"===n){const T=new Y;return d.children.push(T),void H(h,T,y)}if("#elif"===n){const h=x(C,5);d.children.push(h),T=h}}}function H(h,d,T){for(;h.canRead;){h.lineIndex++;const y=h.currentLine;if(y.indexOf("#")>=0){const Y=i.exec(y);if(Y&&Y.length){switch(Y[0]){case"#ifdef":{const Y=new C;d.children.push(Y);const n=x(y,6);Y.children.push(n),g(h,Y,n,T);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const Y=new C;d.children.push(Y);const n=x(y,7);Y.children.push(n),g(h,Y,n,T);break}case"#if":{const Y=new C,n=x(y,3);d.children.push(Y),Y.children.push(n),g(h,Y,n,T);break}}continue}}const n=new Y;if(n.line=y,d.children.push(n),"#"===y[0]&&"d"===y[1]){const h=y.replace(";","").split(" ");n.additionalDefineKey=h[1],3===h.length&&(n.additionalDefineValue=h[2])}}return!1}function p(h,d,T,C){const n=new Y,X=new y;return X.lineIndex=-1,X.lines=h.split("\n"),H(X,n,C),n.process(d,T,C)}function k(h,d){var T;const Y=h.defines,y={};for(const C of Y){const h=C.replace("#define","").replace(";","").trim().split(" ");y[h[0]]=h.length>1?h[1]:""}return 0===(null===(T=h.processor)||void 0===T?void 0:T.shaderLanguage)&&(y.GL_ES="true"),y.__VERSION__=h.version,y[h.platformName]="true",(0,c.k)(y,null===d||void 0===d?void 0:d.isNDCHalfZRange,null===d||void 0===d?void 0:d.Dd,null===d||void 0===d?void 0:d.useExactSrgbConversions),y}function o(h,d,T){let Y;for(V.length=0;null!==(Y=J.exec(h));)V.push(Y);let y=String(h),C=[h],n=!1;for(const X of V){let h=X[1];if(-1!==h.indexOf("__decl__")&&(h=h.replace(W,""),d.supportsUniformBuffers&&(h=h.replace("Vertex","Ubo").replace("Fragment","Ubo")),h+="Declaration"),!d.includesShadersStore[h]){const Y=d.shadersRepository+"ShadersInclude/"+h+".fx";return void u.loadFile(Y,(Y=>{d.includesShadersStore[h]=Y,o(C.join(""),d,T)}))}{let T=d.includesShadersStore[h];if(X[2]){const h=X[3].split(",");for(let d=0;d<h.length;d+=2){const Y=new RegExp(h[d],"g"),y=h[d+1];T=T.replace(Y,y)}}if(X[4]){const h=X[5];if(-1!==h.indexOf("..")){const Y=h.split(".."),y=parseInt(Y[0]);let C=parseInt(Y[1]),n=T.slice(0);T="",isNaN(C)&&(C=d.indexParameters[Y[1]]);for(let h=y;h<C;h++)d.supportsUniformBuffers||(n=n.replace(L,((h,d)=>d+"{X}"))),T+=n.replace(D,h.toString())+"\n"}else d.supportsUniformBuffers||(T=T.replace(L,((h,d)=>d+"{X}"))),T=T.replace(D,h)}const Y=[];for(const h of C){const d=h.split(X[0]);for(let h=0;h<d.length-1;h++)Y.push(d[h]),Y.push(T);Y.push(d[d.length-1])}C=Y,n=n||T.indexOf("#include<")>=0||T.indexOf("#include <")>=0}}V.length=0,y=C.join(""),n?o(y.toString(),d,T):T(y)}const u={loadFile:(h,d,T,Y,y,C)=>{throw(0,r.e)("FileTools")}}},12647:(h,d,T)=>{T.d(d,{e:()=>y,g:()=>C,k:()=>X,o:()=>n,q:()=>F});var Y=T(12617);T(12589);const y={};function C(h,d){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(d?d+"\n":"")+h}function n(h,d,T,C,n,X,F){const U=F||y.loadFile;if(U){return U(h,d,T,C,n,X)}throw(0,Y.e)("FileTools")}function X(h,d,T,Y){if(h)return d?h.IS_NDC_HALF_ZRANGE="":delete h.IS_NDC_HALF_ZRANGE,T?h.USE_REVERSE_DEPTHBUFFER="":delete h.USE_REVERSE_DEPTHBUFFER,void(Y?h.USE_EXACT_SRGB_CONVERSIONS="":delete h.USE_EXACT_SRGB_CONVERSIONS);{let h="";return d&&(h+="#define IS_NDC_HALF_ZRANGE"),T&&(h&&(h+="\n"),h+="#define USE_REVERSE_DEPTHBUFFER"),Y&&(h&&(h+="\n"),h+="#define USE_EXACT_SRGB_CONVERSIONS"),h}}function F(h,d){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Y=arguments.length>3?arguments[3]:void 0;switch(h){case 3:{const h=(ArrayBuffer,new Int8Array(d));return Y&&h.set(new Int8Array(Y)),h}case 0:{const h=(ArrayBuffer,new Uint8Array(d));return Y&&h.set(new Uint8Array(Y)),h}case 4:{const h=d instanceof ArrayBuffer?new Int16Array(d):new Int16Array(T?d/2:d);return Y&&h.set(new Int16Array(Y)),h}case 5:case 8:case 9:case 10:case 2:{const h=d instanceof ArrayBuffer?new Uint16Array(d):new Uint16Array(T?d/2:d);return Y&&h.set(new Uint16Array(Y)),h}case 6:{const h=d instanceof ArrayBuffer?new Int32Array(d):new Int32Array(T?d/4:d);return Y&&h.set(new Int32Array(Y)),h}case 7:case 11:case 12:case 13:case 14:case 15:{const h=d instanceof ArrayBuffer?new Uint32Array(d):new Uint32Array(T?d/4:d);return Y&&h.set(new Uint32Array(Y)),h}case 1:{const h=d instanceof ArrayBuffer?new Float32Array(d):new Float32Array(T?d/4:d);return Y&&h.set(new Float32Array(Y)),h}}const y=(ArrayBuffer,new Uint8Array(d));return Y&&y.set(new Uint8Array(Y)),y}},12663:(h,d,T)=>{T.d(d,{e:()=>Y});class Y{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Y.ShadersRepository:Y.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Y.ShadersStore:Y.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Y.IncludesShadersStore:Y.IncludesShadersStoreWGSL}}Y.ShadersRepository="src/Shaders/",Y.ShadersStore={},Y.IncludesShadersStore={},Y.ShadersRepositoryWGSL="src/ShadersWGSL/",Y.ShadersStoreWGSL={},Y.IncludesShadersStoreWGSL={}},12670:(h,d,T)=>{T.d(d,{e:()=>r,g:()=>D,i:()=>O,l:()=>c,m:()=>f,p:()=>L,r:()=>S,v:()=>U,y:()=>Z,z:()=>F,D:()=>X});class Y{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Hd._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(h){h&&this.program&&h(this.program)}setEngine(h){this.Hd=h}_fillEffectInformation(h,d,T,Y,y,C,n,X){const F=this.Hd;if(F.supportsUniformBuffers)for(const Z in d)h.bindUniformBlock(Z,d[Z]);let U;for(this.Hd.getUniforms(this,T).forEach(((h,d)=>{Y[T[d]]=h})),this._uniforms=Y,U=0;U<y.length;U++){null==h.getUniform(y[U])&&(y.splice(U,1),U--)}y.forEach(((h,d)=>{C[h]=d}));for(const Z of F.getAttributes(this,n))X.push(Z)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(h,d){const T=this._valueCache[h],Y=d.updateFlag;return(void 0===T||T!==Y)&&(this._valueCache[h]=Y,!0)}_cacheFloat2(h,d,T){let Y=this._valueCache[h];if(!Y||2!==Y.length)return Y=[d,T],this._valueCache[h]=Y,!0;let y=!1;return Y[0]!==d&&(Y[0]=d,y=!0),Y[1]!==T&&(Y[1]=T,y=!0),y}_cacheFloat3(h,d,T,Y){let y=this._valueCache[h];if(!y||3!==y.length)return y=[d,T,Y],this._valueCache[h]=y,!0;let C=!1;return y[0]!==d&&(y[0]=d,C=!0),y[1]!==T&&(y[1]=T,C=!0),y[2]!==Y&&(y[2]=Y,C=!0),C}_cacheFloat4(h,d,T,Y,y){let C=this._valueCache[h];if(!C||4!==C.length)return C=[d,T,Y,y],this._valueCache[h]=C,!0;let n=!1;return C[0]!==d&&(C[0]=d,n=!0),C[1]!==T&&(C[1]=T,n=!0),C[2]!==Y&&(C[2]=Y,n=!0),C[3]!==y&&(C[3]=y,n=!0),n}setInt(h,d){const T=this._valueCache[h];void 0!==T&&T===d||this.Hd.setInt(this._uniforms[h],d)&&(this._valueCache[h]=d)}setInt2(h,d,T){this._cacheFloat2(h,d,T)&&(this.Hd.setInt2(this._uniforms[h],d,T)||(this._valueCache[h]=null))}setInt3(h,d,T,Y){this._cacheFloat3(h,d,T,Y)&&(this.Hd.setInt3(this._uniforms[h],d,T,Y)||(this._valueCache[h]=null))}setInt4(h,d,T,Y,y){this._cacheFloat4(h,d,T,Y,y)&&(this.Hd.setInt4(this._uniforms[h],d,T,Y,y)||(this._valueCache[h]=null))}setIntArray(h,d){this._valueCache[h]=null,this.Hd.setIntArray(this._uniforms[h],d)}setIntArray2(h,d){this._valueCache[h]=null,this.Hd.setIntArray2(this._uniforms[h],d)}setIntArray3(h,d){this._valueCache[h]=null,this.Hd.setIntArray3(this._uniforms[h],d)}setIntArray4(h,d){this._valueCache[h]=null,this.Hd.setIntArray4(this._uniforms[h],d)}setUInt(h,d){const T=this._valueCache[h];void 0!==T&&T===d||this.Hd.setUInt(this._uniforms[h],d)&&(this._valueCache[h]=d)}setUInt2(h,d,T){this._cacheFloat2(h,d,T)&&(this.Hd.setUInt2(this._uniforms[h],d,T)||(this._valueCache[h]=null))}setUInt3(h,d,T,Y){this._cacheFloat3(h,d,T,Y)&&(this.Hd.setUInt3(this._uniforms[h],d,T,Y)||(this._valueCache[h]=null))}setUInt4(h,d,T,Y,y){this._cacheFloat4(h,d,T,Y,y)&&(this.Hd.setUInt4(this._uniforms[h],d,T,Y,y)||(this._valueCache[h]=null))}setUIntArray(h,d){this._valueCache[h]=null,this.Hd.setUIntArray(this._uniforms[h],d)}setUIntArray2(h,d){this._valueCache[h]=null,this.Hd.setUIntArray2(this._uniforms[h],d)}setUIntArray3(h,d){this._valueCache[h]=null,this.Hd.setUIntArray3(this._uniforms[h],d)}setUIntArray4(h,d){this._valueCache[h]=null,this.Hd.setUIntArray4(this._uniforms[h],d)}setArray(h,d){this._valueCache[h]=null,this.Hd.setArray(this._uniforms[h],d)}setArray2(h,d){this._valueCache[h]=null,this.Hd.setArray2(this._uniforms[h],d)}setArray3(h,d){this._valueCache[h]=null,this.Hd.setArray3(this._uniforms[h],d)}setArray4(h,d){this._valueCache[h]=null,this.Hd.setArray4(this._uniforms[h],d)}setMatrices(h,d){d&&(this._valueCache[h]=null,this.Hd.setMatrices(this._uniforms[h],d))}setMatrix(h,d){this._cacheMatrix(h,d)&&(this.Hd.setMatrices(this._uniforms[h],d.ad())||(this._valueCache[h]=null))}setMatrix3x3(h,d){this._valueCache[h]=null,this.Hd.setMatrix3x3(this._uniforms[h],d)}setMatrix2x2(h,d){this._valueCache[h]=null,this.Hd.setMatrix2x2(this._uniforms[h],d)}setFloat(h,d){const T=this._valueCache[h];void 0!==T&&T===d||this.Hd.setFloat(this._uniforms[h],d)&&(this._valueCache[h]=d)}setVector2(h,d){this._cacheFloat2(h,d.x,d.y)&&(this.Hd.setFloat2(this._uniforms[h],d.x,d.y)||(this._valueCache[h]=null))}setFloat2(h,d,T){this._cacheFloat2(h,d,T)&&(this.Hd.setFloat2(this._uniforms[h],d,T)||(this._valueCache[h]=null))}setVector3(h,d){this._cacheFloat3(h,d.x,d.y,d.z)&&(this.Hd.setFloat3(this._uniforms[h],d.x,d.y,d.z)||(this._valueCache[h]=null))}setFloat3(h,d,T,Y){this._cacheFloat3(h,d,T,Y)&&(this.Hd.setFloat3(this._uniforms[h],d,T,Y)||(this._valueCache[h]=null))}setVector4(h,d){this._cacheFloat4(h,d.x,d.y,d.z,d.w)&&(this.Hd.setFloat4(this._uniforms[h],d.x,d.y,d.z,d.w)||(this._valueCache[h]=null))}setQuaternion(h,d){this._cacheFloat4(h,d.x,d.y,d.z,d.w)&&(this.Hd.setFloat4(this._uniforms[h],d.x,d.y,d.z,d.w)||(this._valueCache[h]=null))}setFloat4(h,d,T,Y,y){this._cacheFloat4(h,d,T,Y,y)&&(this.Hd.setFloat4(this._uniforms[h],d,T,Y,y)||(this._valueCache[h]=null))}setColor3(h,d){this._cacheFloat3(h,d.r,d.g,d.b)&&(this.Hd.setFloat3(this._uniforms[h],d.r,d.g,d.b)||(this._valueCache[h]=null))}setColor4(h,d,T){this._cacheFloat4(h,d.r,d.g,d.b,T)&&(this.Hd.setFloat4(this._uniforms[h],d.r,d.g,d.b,T)||(this._valueCache[h]=null))}setDirectColor4(h,d){this._cacheFloat4(h,d.r,d.g,d.b,d.a)&&(this.Hd.setFloat4(this._uniforms[h],d.r,d.g,d.b,d.a)||(this._valueCache[h]=null))}_getVertexShaderCode(){return this.vertexShader?this.Hd._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Hd._getShaderSource(this.fragmentShader):null}}var y=T(12647);const C=new WeakMap,n={_webGLVersion:2,cachedPipelines:{}};function X(h){let d=C.get(h);if(!d){if(!h)return n;d={_webGLVersion:h.TEXTURE_BINDING_3D?2:1,_context:h,parallelShaderCompile:h.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},C.set(h,d)}return d}function F(h){C.delete(h)}function U(h,d,T,Y,y,C){const n=X(Y);C||(C=n._createShaderProgramInjection??r);return C(h,W(d,"vertex",Y,n._contextWasLost),W(T,"fragment",Y,n._contextWasLost),Y,y,n.validateShaderPrograms)}function Z(h,d,T,Y,y){let C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6?arguments[6]:void 0;const F=X(y);n||(n=F._createShaderProgramInjection??r);const U=F._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return n(h,J(d,"vertex",Y,U,y,F._contextWasLost),J(T,"fragment",Y,U,y,F._contextWasLost),y,C,F.validateShaderPrograms)}function S(h,d){const T=new Y,y=X(h);return y.parallelShaderCompile&&!y.disableParallelShaderCompile&&(T.isParallelCompiled=!0),T.context=y._context,T}function r(h,d,T,Y){let y=arguments.length>5?arguments[5]:void 0;const C=Y.createProgram();if(h.program=C,!C)throw new Error("Unable to create program");return Y.attachShader(C,d),Y.attachShader(C,T),Y.linkProgram(C),h.context=Y,h.vertexShader=d,h.fragmentShader=T,h.isParallelCompiled||O(h,Y,y),C}function c(h,d,T){const Y=h;if(Y._isDisposed)return!1;const y=X(d);return!!(y&&y.parallelShaderCompile&&y.parallelShaderCompile.COMPLETION_STATUS_KHR&&Y.program&&d.getProgramParameter(Y.program,y.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(O(Y,d,T),!0)}function O(h,d,T){const Y=h.context,y=h.vertexShader,C=h.fragmentShader,n=h.program;if(!Y.getProgramParameter(n,Y.LINK_STATUS)){if(!d.getShaderParameter(y,d.COMPILE_STATUS)){const T=d.getShaderInfoLog(y);if(T)throw h.vertexCompilationError=T,new Error("VERTEX SHADER "+T)}if(!d.getShaderParameter(C,d.COMPILE_STATUS)){const T=d.getShaderInfoLog(C);if(T)throw h.fragmentCompilationError=T,new Error("FRAGMENT SHADER "+T)}const T=Y.getProgramInfoLog(n);if(T)throw h.programLinkError=T,new Error(T)}if(T){Y.validateProgram(n);if(!Y.getProgramParameter(n,Y.VALIDATE_STATUS)){const d=Y.getProgramInfoLog(n);if(d)throw h.programValidationError=d,new Error(d)}}Y.deleteShader(y),Y.deleteShader(C),h.vertexShader=void 0,h.fragmentShader=void 0,h.onCompiled&&(h.onCompiled(),h.onCompiled=void 0)}function f(h,d,T,Y,y,C,n,F,S){let r=arguments.length>10?arguments[10]:void 0,c=arguments.length>11?arguments[11]:void 0,O=arguments.length>12?arguments[12]:void 0;const f=X(h.context);c||(c=f.createRawShaderProgramInjection??U),O||(O=f.createShaderProgramInjection??Z);const J=h;J.program=Y?c(J,d,T,J.context,S):O(J,d,T,F,J.context,S),J.program.__SPECTOR_rebuildProgram=n,r()}function J(h,d,T,Y,C,n){return W((0,y.g)(h,T,Y),d,C,n)}function W(h,d,T,Y){const y=T.createShader("vertex"===d?T.VERTEX_SHADER:T.FRAGMENT_SHADER);if(!y){let h=T.NO_ERROR,y=T.NO_ERROR;for(;(y=T.getError())!==T.NO_ERROR;)h=y;throw new Error(`Something went wrong while creating a gl ${d} shader object. gl error=${h}, gl isContextLost=${T.isContextLost()}, _contextWasLost=${Y}`)}return T.shaderSource(y,h),T.compileShader(y),y}function L(h,d){d.useProgram(h)}function D(h,d){const T=h;if(!T.isParallelCompiled)return void d(h);const Y=T.onCompiled;T.onCompiled=()=>{null===Y||void 0===Y||Y(),d(h)}}},12667:(h,d,T)=>{T.d(d,{d:()=>S,f:()=>c,g:()=>U,h:()=>Z});var Y=T(12589),y=T(12670),C=T(12663),n=T(12596),X=T(12641),F=T(12647);function U(h,d){return(0,y.D)(d).cachedPipelines[h]}function Z(h){const d=h._name,T=h.context;if(d&&T){const h=(0,y.D)(T),Y=h.cachedPipelines[d];null===Y||void 0===Y||Y.dispose(),delete h.cachedPipelines[d]}}function S(h,d,T,y,C,n,F){let U,Z;const S=(0,Y.l)()?null===n||void 0===n?void 0:n.getHostDocument():null;U="string"===typeof d?d:d.vertexSource?"source:"+d.vertexSource:d.vertexElement?(null===S||void 0===S?void 0:S.getElementById(d.vertexElement))||d.vertexElement:d.vertex||d,Z="string"===typeof d?d:d.fragmentSource?"source:"+d.fragmentSource:d.fragmentElement?(null===S||void 0===S?void 0:S.getElementById(d.fragmentElement))||d.fragmentElement:d.fragment||d;const c=[void 0,void 0],O=()=>{if(c[0]&&c[1]){h.isFragment=!0;const[Y,U]=c;(0,X.k)(U,h,((n,U)=>{F&&(F._fragmentSourceCodeBeforeMigration=U),T&&(n=T("fragment",n));const Z=(0,X.d)(Y,n,h);h=null;const S=function(h,d,T,Y){if(T){return{vertexSourceCode:(1===Y?"//":"")+"#define SHADER_NAME vertex:"+(T.vertexElement||T.vertex||T.spectorName||T)+"\n"+h,fragmentSourceCode:(1===Y?"//":"")+"#define SHADER_NAME fragment:"+(T.fragmentElement||T.fragment||T.spectorName||T)+"\n"+d}}return{vertexSourceCode:h,fragmentSourceCode:d}}(Z.vertexCode,Z.fragmentCode,d,C);null===y||void 0===y||y(S.vertexSourceCode,S.fragmentSourceCode)}),n)}};r(U,"Vertex","",(d=>{(0,X.g)(h),(0,X.k)(d,h,((h,Y)=>{F&&(F._rawVertexSourceCode=d,F._vertexSourceCodeBeforeMigration=Y),T&&(h=T("vertex",h)),c[0]=h,O()}),n)}),C),r(Z,"Fragment","Pixel",(h=>{F&&(F._rawFragmentSourceCode=h),c[1]=h,O()}),C)}function r(h,d,T,y,n,X){if("undefined"!==typeof HTMLElement&&h instanceof HTMLElement){return void y((0,Y.d)(h))}if("source:"===h.substring(0,7))return void y(h.substring(7));if("base64:"===h.substring(0,7)){return void y(window.atob(h.substring(7)))}const U=C.e.GetShadersStore(n);if(U[h+d+"Shader"])return void y(U[h+d+"Shader"]);if(T&&U[h+T+"Shader"])return void y(U[h+T+"Shader"]);let Z;if(Z="."===h[0]||"/"===h[0]||h.indexOf("http")>-1?h:C.e.GetShadersRepository(n)+h,!(X=X||F.o))throw new Error("loadFileInjection is not defined");X(Z+"."+d.toLowerCase()+".fx",y)}const c=(h,d,T,Y)=>{try{const C=h.context?(0,y.D)(h.context):null;C&&(C.disableParallelShaderCompile=h.disableParallelCompilation);const n=h.existingPipelineContext||d(h.shaderProcessingContext);return n._name=h.name,h.name&&C&&(C.cachedPipelines[h.name]=n),T(n,h.vertex,h.fragment,!!h.createAsRaw,"","",h.rebuildRebind,h.defines,h.transformFeedbackVaryings,"",(()=>{Y(n,(()=>{var d;null===(d=h.onRenderingStateCompiled)||void 0===d||d.call(h,n)}))})),n}catch(C){throw n.c.Error("Error compiling effect"),C}}},12661:(h,d,T)=>{T.r(d),T.d(d,{Effect:()=>F});var Y=T(12583),y=T(12596),C=T(12663),n=T(12667),X=T(12651);class F{static get ShadersRepository(){return C.e.ShadersRepository}static set ShadersRepository(h){C.e.ShadersRepository=h}get U(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Y.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(h,d,T){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4?arguments[4]:void 0,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,r=arguments.length>9?arguments[9]:void 0,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,f=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new Y.e,this.onErrorObservable=new Y.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=h,this._key=c;const J=this._key.replace(/\r/g,"").replace(/\n/g,"|");let W;if(d.attributes){const h=d;if(this._engine=T,this._attributesNames=h.attributes,this._uniformsNames=h.uniformsNames.concat(h.samplers),this._samplerList=h.samplers.slice(),this.defines=h.defines,this.onError=h.onError,this.onCompiled=h.onCompiled,this._fallbacks=h.fallbacks,this._indexParameters=h.indexParameters,this._transformFeedbackVaryings=h.transformFeedbackVaryings||null,this._multiTarget=!!h.multiTarget,this._shaderLanguage=h.shaderLanguage??0,this._disableParallelShaderCompilation=!!h.disableParallelShaderCompilation,h.uniformBuffersNames){this._uniformBuffersNamesList=h.uniformBuffersNames.slice();for(let d=0;d<h.uniformBuffersNames.length;d++)this._uniformBuffersNames[h.uniformBuffersNames[d]]=d}this._processFinalCode=h.processFinalCode??null,this._processCodeAfterIncludes=h.processCodeAfterIncludes??void 0,f=h.extraInitializationsAsync,W=h.existingPipelineContext}else this._engine=C,this.defines=null==X?"":X,this._uniformsNames=T.concat(y),this._samplerList=y?y.slice():[],this._attributesNames=d,this._uniformBuffersNamesList=[],this._shaderLanguage=O,this.onError=S,this.onCompiled=Z,this._indexParameters=r,this._fallbacks=U;"WEBGL2"===this._engine.shaderPlatformName&&(W=(0,n.g)(J,this._engine._gl)??W),this._attributeLocationByName={},this.uniqueId=F._UniqueIdSeed++,W?(this._pipelineContext=W,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,f),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.U||this.dispose(!0)}))}async _processShaderCodeAsync(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Y=arguments.length>3?arguments[3]:void 0;Y&&await Y(),this._processingContext=T||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const y={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:h??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:C.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:C.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,Dd:this._engine.Dd,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,n.d)(y,this.name,this._processFinalCode,((h,T)=>{this._vertexSourceCode=h,this._fragmentSourceCode=T,this._prepareEffect(d)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.U||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(h){return this._attributes[h]}getAttributeLocationByName(h){return this._attributeLocationByName[h]}getAttributesCount(){return this._attributes.length}getUniformIndex(h){return this._uniformsNames.indexOf(h)}getUniform(h){return this._uniforms[h]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((h=>{this.executeWhenCompiled(h)}))}executeWhenCompiled(h){this.isReady()?h(this):(this.onCompileObservable.add((d=>{h(d)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(h){(0,X.d)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(d=>{this._processCompilationErrors(d,h)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var h;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(h=this._pipelineContext)||void 0===h?void 0:h._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var h;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(h=this._pipelineContext)||void 0===h?void 0:h._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,Dd:this._engine.Dd,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(h,d,T,Y){this._isReady=!1,this._vertexSourceCodeOverride=h,this._fragmentSourceCodeOverride=d,this.onError=(h,d)=>{Y&&Y(d)},this.onCompiled=()=>{var h,d;const Y=this.getEngine().scenes;if(Y)for(let T=0;T<Y.length;T++)Y[T].markAllMaterialsAsDirty(127);null===(h=(d=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===h||h.call(d,T)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(h){if(this._pipelineContext=h,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let d=0;d<this._attributesNames.length;d++){const h=this._attributesNames[d];this._attributeLocationByName[h]=this._attributes[d]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),F.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=this._pipelineContext;this._isReady=!1;try{const T=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),Y=T?null:this.defines,y=T?this._vertexSourceCodeOverride:this._vertexSourceCode,C=T?this._fragmentSourceCodeOverride:this._fragmentSourceCode,X=this._engine;this._pipelineContext=(0,n.f)({existingPipelineContext:h?d:null,vertex:y,fragment:C,context:"WEBGL2"===X.shaderPlatformName||"WEBGL1"===X.shaderPlatformName?X._gl:void 0,rebuildRebind:(h,d,T,Y)=>this._rebuildProgram(h,d,T,Y),defines:Y,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:T,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:T=>{d&&!h&&this._engine._deletePipelineContext(d),T&&this._onRenderingStateCompiled(T)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(d)}catch(T){this._processCompilationErrors(T,d)}}_getShaderCodeAndErrorLine(h,d,T){const Y=T?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let y=null;if(d&&h){const C=d.match(Y);if(C&&2===C.length){const d=parseInt(C[1]),Y=h.split("\n",-1);Y.length>=d&&(y=`Offending line [${d}] in ${T?"fragment":"vertex"} code: ${Y[d-1]}`)}}return[h,y]}_processCompilationErrors(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=h.message;const T=this._attributesNames,Y=this._fallbacks;if(y.c.Error("Unable to compile effect:"),y.c.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),y.c.Error(`Attributes: ${T.join(" ")}`),y.c.Error("Defines:\n"+this.defines),F.LogShaderCodeOnCompilationError){var C,n;let h=null,d=null,T=null;var X;if(null!==(C=this._pipelineContext)&&void 0!==C&&C._getVertexShaderCode()&&([T,h]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),T&&(y.c.Error("Vertex code:"),y.c.Error(T))),null!==(n=this._pipelineContext)&&void 0!==n&&n._getFragmentShaderCode())[T,d]=this._getShaderCodeAndErrorLine(null===(X=this._pipelineContext)||void 0===X?void 0:X._getFragmentShaderCode(),this._compilationError,!0),T&&(y.c.Error("Fragment code:"),y.c.Error(T));h&&y.c.Error(h),d&&y.c.Error(d)}y.c.Error("Error: "+this._compilationError);const U=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};d&&(this._pipelineContext=d,this._isReady=!0,U()),Y?(this._pipelineContext=null,Y.hasMoreFallbacks?(this._allFallbacksProcessed=!1,y.c.Error("Trying next fallback."),this.defines=Y.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,U(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,d||U())}get isSupported(){return""===this._compilationError}_bindTexture(h,d){this._engine._bindTexture(this._samplers[h],d,h)}setTexture(h,d){this._engine.setTexture(this._samplers[h],this._uniforms[h],d,h)}setTextureArray(h,d){const T=h+"Ex";if(-1===this._samplerList.indexOf(T+"0")){const Y=this._samplerList.indexOf(h);for(let h=1;h<d.length;h++){const d=T+(h-1).toString();this._samplerList.splice(Y+h,0,d)}let y=0;for(const h of this._samplerList)this._samplers[h]=y,y+=1}this._engine.setTextureArray(this._samplers[h],this._uniforms[h],d,h)}bindUniformBuffer(h,d){const T=this._uniformBuffersNames[d];void 0===T||F._BaseCache[T]===h&&this._engine._features.useUBOBindingCache||(F._BaseCache[T]=h,this._engine.bindUniformBufferBase(h,T,d))}bindUniformBlock(h,d){this._engine.bindUniformBlock(this._pipelineContext,h,d)}setInt(h,d){return this._pipelineContext.setInt(h,d),this}setInt2(h,d,T){return this._pipelineContext.setInt2(h,d,T),this}setInt3(h,d,T,Y){return this._pipelineContext.setInt3(h,d,T,Y),this}setInt4(h,d,T,Y,y){return this._pipelineContext.setInt4(h,d,T,Y,y),this}setIntArray(h,d){return this._pipelineContext.setIntArray(h,d),this}setIntArray2(h,d){return this._pipelineContext.setIntArray2(h,d),this}setIntArray3(h,d){return this._pipelineContext.setIntArray3(h,d),this}setIntArray4(h,d){return this._pipelineContext.setIntArray4(h,d),this}setUInt(h,d){return this._pipelineContext.setUInt(h,d),this}setUInt2(h,d,T){return this._pipelineContext.setUInt2(h,d,T),this}setUInt3(h,d,T,Y){return this._pipelineContext.setUInt3(h,d,T,Y),this}setUInt4(h,d,T,Y,y){return this._pipelineContext.setUInt4(h,d,T,Y,y),this}setUIntArray(h,d){return this._pipelineContext.setUIntArray(h,d),this}setUIntArray2(h,d){return this._pipelineContext.setUIntArray2(h,d),this}setUIntArray3(h,d){return this._pipelineContext.setUIntArray3(h,d),this}setUIntArray4(h,d){return this._pipelineContext.setUIntArray4(h,d),this}setFloatArray(h,d){return this._pipelineContext.setArray(h,d),this}setFloatArray2(h,d){return this._pipelineContext.setArray2(h,d),this}setFloatArray3(h,d){return this._pipelineContext.setArray3(h,d),this}setFloatArray4(h,d){return this._pipelineContext.setArray4(h,d),this}setArray(h,d){return this._pipelineContext.setArray(h,d),this}setArray2(h,d){return this._pipelineContext.setArray2(h,d),this}setArray3(h,d){return this._pipelineContext.setArray3(h,d),this}setArray4(h,d){return this._pipelineContext.setArray4(h,d),this}setMatrices(h,d){return this._pipelineContext.setMatrices(h,d),this}setMatrix(h,d){return this._pipelineContext.setMatrix(h,d),this}setMatrix3x3(h,d){return this._pipelineContext.setMatrix3x3(h,d),this}setMatrix2x2(h,d){return this._pipelineContext.setMatrix2x2(h,d),this}setFloat(h,d){return this._pipelineContext.setFloat(h,d),this}setBool(h,d){return this._pipelineContext.setInt(h,d?1:0),this}setVector2(h,d){return this._pipelineContext.setVector2(h,d),this}setFloat2(h,d,T){return this._pipelineContext.setFloat2(h,d,T),this}setVector3(h,d){return this._pipelineContext.setVector3(h,d),this}setFloat3(h,d,T,Y){return this._pipelineContext.setFloat3(h,d,T,Y),this}setVector4(h,d){return this._pipelineContext.setVector4(h,d),this}setQuaternion(h,d){return this._pipelineContext.setQuaternion(h,d),this}setFloat4(h,d,T,Y,y){return this._pipelineContext.setFloat4(h,d,T,Y,y),this}setColor3(h,d){return this._pipelineContext.setColor3(h,d),this}setColor4(h,d,T){return this._pipelineContext.setColor4(h,d,T),this}setDirectColor4(h,d){return this._pipelineContext.setDirectColor4(h,d),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(F.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,n.h)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;d&&(C.e.GetShadersStore(Y)[`${h}PixelShader`]=d),T&&(C.e.GetShadersStore(Y)[`${h}VertexShader`]=T)}static ResetCache(){F._BaseCache={}}}F.LogShaderCodeOnCompilationError=!0,F.PersistentMode=!1,F.AutomaticallyClearCodeCache=!1,F._UniqueIdSeed=0,F._BaseCache={},F.ShadersStore=C.e.ShadersStore,F.IncludesShadersStore=C.e.IncludesShadersStore},12617:(h,d,T)=>{T.d(d,{e:()=>y});const Y={};function y(h){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!Y[h])return Y[h]=!0,`${h} needs to be imported before as it contains a side-effect required by your code.`}},12589:(h,d,T)=>{function Y(){return"undefined"!==typeof window}function y(){return"undefined"!==typeof navigator}function C(){return"undefined"!==typeof document}function n(h){let d="",T=h.firstChild;for(;T;)3===T.nodeType&&(d+=T.textContent),T=T.nextSibling;return d}T.d(d,{d:()=>n,e:()=>C,i:()=>y,l:()=>Y})},12596:(h,d,T)=>{T.d(d,{c:()=>Y});class Y{static _CheckLimit(h,d){let T=Y._LogLimitOutputs[h];return T?T.current++:(T={limit:d,current:1},Y._LogLimitOutputs[h]=T),T.current<=T.limit}static _GenerateLimitMessage(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const T=Y._LogLimitOutputs[h];if(!T||!Y.MessageLimitReached)return;const y=this._Levels[d];T.current===T.limit&&Y[y.name](Y.MessageLimitReached.replace(/%LIMIT%/g,""+T.limit).replace(/%TYPE%/g,y.name??""))}static _AddLogEntry(h){Y._LogCache=h+Y._LogCache,Y.OnNewCacheEntry&&Y.OnNewCacheEntry(h)}static _FormatMessage(h){const d=h=>h<10?"0"+h:""+h,T=new Date;return"["+d(T.getHours())+":"+d(T.getMinutes())+":"+d(T.getSeconds())+"]: "+h}static _LogDisabled(h,d){}static _LogEnabled(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1?arguments[1]:void 0,T=arguments.length>2?arguments[2]:void 0;const y=Array.isArray(d)?d[0]:d;if(void 0!==T&&!Y._CheckLimit(y,T))return;const C=Y._FormatMessage(y),n=this._Levels[h],X=Array.isArray(d)?d.slice(1):[];n.logFunc&&n.logFunc("BJS - "+C,...X);const F=`<div style='color:${n.color}'>${C}</div><br>`;Y._AddLogEntry(F),Y._GenerateLimitMessage(y,h)}static get LogCache(){return Y._LogCache}static ClearLogCache(){Y._LogCache="",Y._LogLimitOutputs={},Y.errorsCount=0}static set LogLevels(h){Y.Log=Y._LogDisabled,Y.Warn=Y._LogDisabled,Y.Error=Y._LogDisabled;const d=[Y.MessageLogLevel,Y.WarningLogLevel,Y.ErrorLogLevel];for(const T of d)if((h&T)===T){const h=this._Levels[T];Y[h.name]=Y._LogEnabled.bind(Y,T)}}}Y.NoneLogLevel=0,Y.MessageLogLevel=1,Y.WarningLogLevel=2,Y.ErrorLogLevel=4,Y.AllLogLevel=7,Y.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",Y._LogCache="",Y._LogLimitOutputs={},Y._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],Y.errorsCount=0,Y.Log=Y._LogEnabled.bind(Y,Y.MessageLogLevel),Y.Warn=Y._LogEnabled.bind(Y,Y.WarningLogLevel),Y.Error=Y._LogEnabled.bind(Y,Y.ErrorLogLevel)},12583:(h,d,T)=>{T.d(d,{e:()=>n});const Y="undefined"!==typeof WeakRef;class y{constructor(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2?arguments[2]:void 0,Y=arguments.length>3?arguments[3]:void 0;this.initialize(h,d,T,Y)}initialize(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2?arguments[2]:void 0,Y=arguments.length>3?arguments[3]:void 0;return this.mask=h,this.skipNextObservers=d,this.target=T,this.currentTarget=Y,this}}class C{constructor(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=h,this.mask=d,this.scope=T,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(h)}}class n{static FromPromise(h,d){const T=new n;return h.then((h=>{T.notifyObservers(h)})).catch((h=>{if(!d)throw h;d.notifyObservers(h)})),T}get observers(){return this._observers}constructor(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=d,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new y(0),h&&(this._onObserverAdded=h)}add(h){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!h)return null;const y=new C(h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);y.unregisterOnNextCall=T,d?this._observers.unshift(y):this._observers.push(y),this._onObserverAdded&&this._onObserverAdded(y),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(y,this._lastNotifiedValue);const n=Y?new WeakRef(this):{deref:()=>this};return y._remove=function(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=n.deref();d&&(h?d.remove(y):d._remove(y))},y}addOnce(h){return this.add(h,void 0,void 0,void 0,!0)}remove(h){if(!h)return!1;h._remove=null;return-1!==this._observers.indexOf(h)&&(this._deferUnregister(h),!0)}removeCallback(h,d){for(let T=0;T<this._observers.length;T++){const Y=this._observers[T];if(!Y._willBeUnregistered&&(Y.callback===h&&(!d||d===Y.scope)))return this._deferUnregister(Y),!0}return!1}_deferUnregister(h){h._willBeUnregistered||(this._numObserversMarkedAsDeleted++,h.unregisterOnNextCall=!1,h._willBeUnregistered=!0,setTimeout((()=>{this._remove(h)}),0))}_remove(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!h)return!1;const T=this._observers.indexOf(h);return-1!==T&&(d&&this._numObserversMarkedAsDeleted--,this._observers.splice(T,1),!0)}makeObserverTopPriority(h){this._remove(h,!1),this._observers.unshift(h)}makeObserverBottomPriority(h){this._remove(h,!1),this._observers.push(h)}notifyObservers(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,T=arguments.length>2?arguments[2]:void 0,Y=arguments.length>3?arguments[3]:void 0,y=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=h),!this._observers.length)return!0;const C=this._eventState;C.mask=d,C.target=T,C.currentTarget=Y,C.skipNextObservers=!1,C.lastReturnValue=h,C.userInfo=y;for(const n of this._observers)if(!n._willBeUnregistered&&(n.mask&d&&(n.unregisterOnNextCall&&this._deferUnregister(n),n.scope?C.lastReturnValue=n.callback.apply(n.scope,[h,C]):C.lastReturnValue=n.callback(h,C)),C.skipNextObservers))return!1;return!0}notifyObserver(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=d),h._willBeUnregistered)return;const Y=this._eventState;Y.mask=T,Y.skipNextObservers=!1,h.unregisterOnNextCall&&this._deferUnregister(h),h.callback(d,Y)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const h=this._observers.pop();h&&(h._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const h=new n;return h._observers=this._observers.slice(0),h}hasSpecificMask(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const d of this._observers)if(d.mask&h||d.mask===h)return!0;return!1}}},12651:(h,d,T)=>{T.d(d,{c:()=>y,d:()=>n});let Y=[];class y{static SetImmediate(h){0===Y.length&&setTimeout((()=>{const h=Y;Y=[];for(const d of h)d()}),1),Y.push(h)}}function C(h,d,T){try{if(h())return d(),!0}catch(Y){return null===T||void 0===T||T(Y),!0}return!1}const n=function(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,n=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&C(h,d,T))return null;const X=setInterval((()=>{C(h,d,T)?clearInterval(X):(y-=Y,y<0&&(clearInterval(X),null===T||void 0===T||T(new Error("Operation timed out after maximum retries. "+(n||"")),!0)))}),Y);return()=>clearInterval(X)}}}]);