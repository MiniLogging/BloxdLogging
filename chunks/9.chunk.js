"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{11714:(h,d,m)=>{m.d(d,{b:()=>v,e:()=>L,i:()=>B,l:()=>E,m:()=>Z,q:()=>R,r:()=>I});var j=m(11058),A=m(11353),b=m(11099),w=m(11080),a=m(11722),D=m(11374),S=m(11530),M=m(11144),q=m(11341);const E=Object.freeze(new j.c(0,0,0,0)),I=Object.freeze(j.i.Zero()),R=Object.freeze(j.h.Zero()),Z=Object.freeze(S.b.Zero()),L=Object.freeze(A.d.Black()),B=Object.freeze(new A.f(0,0,0,0)),V={key:0,repeatCount:0,loopMode:2};class v{static _PrepareAnimation(h,d,m,b,w,a,D,M){let q;if(!isNaN(parseFloat(w))&&isFinite(w)?q=v.ANIMATIONTYPE_FLOAT:w instanceof j.c?q=v.ANIMATIONTYPE_QUATERNION:w instanceof j.i?q=v.ANIMATIONTYPE_VECTOR3:w instanceof j.h?q=v.ANIMATIONTYPE_VECTOR2:w instanceof A.d?q=v.ANIMATIONTYPE_COLOR3:w instanceof A.f?q=v.ANIMATIONTYPE_COLOR4:w instanceof S.b&&(q=v.ANIMATIONTYPE_SIZE),void 0==q)return null;const E=new v(h,d,m,q,D),I=[{frame:0,value:w},{frame:b,value:a}];return E.setKeys(I),void 0!==M&&E.setEasingFunction(M),E}static CreateAnimation(h,d,m,j){const A=new v(h+"Animation",h,m,d,v.ANIMATIONLOOPMODE_CONSTANT);return A.setEasingFunction(j),A}static CreateAndStartAnimation(h,d,m,j,A,b,w,a,D,S,M){const q=v._PrepareAnimation(h,m,j,A,b,w,a,D);return q?(d.ih&&(M=d.ih()),M?M.beginDirectAnimation(d,[q],0,A,q.loopMode!==v.ANIMATIONLOOPMODE_CONSTANT,1,S):null):null}static CreateAndStartHierarchyAnimation(h,d,m,j,A,b,w,a,D,S,M){const q=v._PrepareAnimation(h,j,A,b,w,a,D,S);if(!q)return null;return d.ih().beginDirectHierarchyAnimation(d,m,[q],0,b,1===q.loopMode,1,M)}static CreateMergeAndStartAnimation(h,d,m,j,A,b,w,a,D,S){const M=v._PrepareAnimation(h,m,j,A,b,w,a,D);return M?(d.animations.push(M),d.ih().beginAnimation(d,0,A,1===M.loopMode,1,S)):null}static MakeAnimationAdditive(h,d,m){let A;A="object"===typeof d?d:{referenceFrame:d??0,range:m,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let b=h;if(A.cloneOriginalAnimation&&(b=h.clone(),b.name=A.clonedAnimationName||b.name),!b._keys.length)return b;const w=A.referenceFrame&&A.referenceFrame>=0?A.referenceFrame:0;let a=0;const D=b._keys[0];let S=b._keys.length-1;const M=b._keys[S],q={referenceValue:D.value,referencePosition:j.d.Qd[0],referenceQuaternion:j.d.Quaternion[0],referenceScaling:j.d.Qd[1],keyPosition:j.d.Qd[2],keyQuaternion:j.d.Quaternion[1],keyScaling:j.d.Qd[3]};let E=D.frame,I=M.frame;if(A.range){const h=b.getRange(A.range);h&&(E=h.from,I=h.to)}else E=A.fromFrame??E,I=A.toFrame??I;if(E!==D.frame&&(a=b.createKeyForFrame(E)),I!==M.frame&&(S=b.createKeyForFrame(I)),1===b._keys.length){const h=b._getKeyValue(b._keys[0]);q.referenceValue=h.clone?h.clone():h}else if(w<=D.frame){const h=b._getKeyValue(D.value);q.referenceValue=h.clone?h.clone():h}else if(w>=M.frame){const h=b._getKeyValue(M.value);q.referenceValue=h.clone?h.clone():h}else{V.key=0;const h=b._interpolate(w,V);q.referenceValue=h.clone?h.clone():h}b.dataType===v.ANIMATIONTYPE_QUATERNION?q.referenceValue.normalize().conjugateInPlace():b.dataType===v.ANIMATIONTYPE_MATRIX&&(q.referenceValue.decompose(q.referenceScaling,q.referenceQuaternion,q.referencePosition),q.referenceQuaternion.normalize().conjugateInPlace());let R=Number.MAX_VALUE;const Z=A.clipKeys?[]:null;for(let L=a;L<=S;L++){let h=b._keys[L];if((Z||A.cloneOriginalAnimation)&&(h={frame:h.frame,value:h.value.clone?h.value.clone():h.value,inTangent:h.inTangent,outTangent:h.outTangent,interpolation:h.interpolation,lockedTangent:h.lockedTangent},Z&&(R===Number.MAX_VALUE&&(R=h.frame),h.frame-=R,Z.push(h))),!L||b.dataType===v.ANIMATIONTYPE_FLOAT||h.value!==D.value)switch(b.dataType){case v.ANIMATIONTYPE_MATRIX:h.value.decompose(q.keyScaling,q.keyQuaternion,q.keyPosition),q.keyPosition.Dq(q.referencePosition),q.keyScaling.divideInPlace(q.referenceScaling),q.referenceQuaternion.multiplyToRef(q.keyQuaternion,q.keyQuaternion),j.b.ComposeToRef(q.keyScaling,q.keyQuaternion,q.keyPosition,h.value);break;case v.ANIMATIONTYPE_QUATERNION:q.referenceValue.multiplyToRef(h.value,h.value);break;case v.ANIMATIONTYPE_VECTOR2:case v.ANIMATIONTYPE_VECTOR3:case v.ANIMATIONTYPE_COLOR3:case v.ANIMATIONTYPE_COLOR4:h.value.subtractToRef(q.referenceValue,h.value);break;case v.ANIMATIONTYPE_SIZE:h.value.width-=q.referenceValue.width,h.value.height-=q.referenceValue.height;break;default:h.value-=q.referenceValue}}return Z&&b.setKeys(Z,!0),b}static TransitionTo(h,d,m,j,A,b,w){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(w<=0)return m[h]=d,a&&a(),null;const D=A*(w/1e3);b.setKeys([{frame:0,value:m[h].clone?m[h].clone():m[h]},{frame:D,value:d}]),m.animations||(m.animations=[]),m.animations.push(b);const S=j.beginAnimation(m,0,D,!1);return S.onAnimationEnd=a,S}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const h of this._runtimeAnimations)if(!h.isStopped())return!0;return!1}constructor(h,d,m,j,A,b){this.name=h,this.targetProperty=d,this.framePerSecond=m,this.dataType=j,this.loopMode=A,this.enableBlending=b,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=d.split("."),this.dataType=j,this.loopMode=void 0===A?v.ANIMATIONLOOPMODE_CYCLE:A,this.uniqueId=v._UniqueIdGenerator++}toString(h){let d="Name: "+this.name+", property: "+this.targetProperty;if(d+=", datatype: "+["Float","Qd","Quaternion","Matrix","qb","Vector2"][this.dataType],d+=", nKeys: "+(this._keys?this._keys.length:"none"),d+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),h){d+=", Ranges: {";let h=!0;for(const m in this._ranges)h&&(d+=", ",h=!1),d+=m;d+="}"}return d}addEvent(h){this._events.push(h),this._events.sort(((h,d)=>h.frame-d.frame))}removeEvents(h){for(let d=0;d<this._events.length;d++)this._events[d].frame===h&&(this._events.splice(d,1),d--)}getEvents(){return this._events}createRange(h,d,m){this._ranges[h]||(this._ranges[h]=new a.c(h,d,m))}deleteRange(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const m=this._ranges[h];if(m){if(d){const h=m.from,d=m.to;for(let m=this._keys.length-1;m>=0;m--)this._keys[m].frame>=h&&this._keys[m].frame<=d&&this._keys.splice(m,1)}this._ranges[h]=null}}getRange(h){return this._ranges[h]}getKeys(){return this._keys}getHighestFrame(){let h=0;for(let d=0,m=this._keys.length;d<m;d++)h<this._keys[d].frame&&(h=this._keys[d].frame);return h}getEasingFunction(){return this._easingFunction}setEasingFunction(h){this._easingFunction=h}floatInterpolateFunction(h,d,m){return(0,b.Lerp)(h,d,m)}floatInterpolateFunctionWithTangents(h,d,m,j,A){return(0,b.Hermite)(h,d,m,j,A)}quaternionInterpolateFunction(h,d,m){return j.c.Slerp(h,d,m)}quaternionInterpolateFunctionWithTangents(h,d,m,A,b){return j.c.Hermite(h,d,m,A,b).normalize()}vector3InterpolateFunction(h,d,m){return j.i.Lerp(h,d,m)}vector3InterpolateFunctionWithTangents(h,d,m,A,b){return j.i.Hermite(h,d,m,A,b)}vector2InterpolateFunction(h,d,m){return j.h.Lerp(h,d,m)}vector2InterpolateFunctionWithTangents(h,d,m,A,b){return j.h.Hermite(h,d,m,A,b)}sizeInterpolateFunction(h,d,m){return S.b.Lerp(h,d,m)}color3InterpolateFunction(h,d,m){return A.d.Lerp(h,d,m)}color3InterpolateFunctionWithTangents(h,d,m,j,b){return A.d.Hermite(h,d,m,j,b)}color4InterpolateFunction(h,d,m){return A.f.Lerp(h,d,m)}color4InterpolateFunctionWithTangents(h,d,m,j,b){return A.f.Hermite(h,d,m,j,b)}_getKeyValue(h){return"function"===typeof h?h():h}evaluate(h){return V.key=0,this._interpolate(h,V)}_interpolate(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(d.loopMode===v.ANIMATIONLOOPMODE_CONSTANT&&d.repeatCount>0)return d.highLimitValue.clone?d.highLimitValue.clone():d.highLimitValue;const j=this._keys;let A;if(this._coreAnimation)A=this._coreAnimation._key;else{const b=j.length;for(A=d.key;A>=0&&h<j[A].frame;)--A;for(;A+1<=b-1&&h>=j[A+1].frame;)++A;if(d.key=A,A<0)return m?void 0:this._getKeyValue(j[0].value);if(A+1>b-1)return m?void 0:this._getKeyValue(j[b-1].value);this._key=A}const b=j[A],w=j[A+1];if(m&&(h===b.frame||h===w.frame))return;const a=this._getKeyValue(b.value),D=this._getKeyValue(w.value);if(1===b.interpolation)return w.frame>h?a:D;const S=void 0!==b.outTangent&&void 0!==w.inTangent,M=w.frame-b.frame;let q=(h-b.frame)/M;const V=b.easingFunction||this.getEasingFunction();switch(V&&(q=V.ease(q)),this.dataType){case v.ANIMATIONTYPE_FLOAT:{const h=S?this.floatInterpolateFunctionWithTangents(a,b.outTangent*M,D,w.inTangent*M,q):this.floatInterpolateFunction(a,D,q);switch(d.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return h;case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(d.offsetValue??0)*d.repeatCount+h}break}case v.ANIMATIONTYPE_QUATERNION:{const h=S?this.quaternionInterpolateFunctionWithTangents(a,b.outTangent.scale(M),D,w.inTangent.scale(M),q):this.quaternionInterpolateFunction(a,D,q);switch(d.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return h;case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return h.addInPlace((d.offsetValue||E).scale(d.repeatCount))}return h}case v.ANIMATIONTYPE_VECTOR3:{const h=S?this.vector3InterpolateFunctionWithTangents(a,b.outTangent.scale(M),D,w.inTangent.scale(M),q):this.vector3InterpolateFunction(a,D,q);switch(d.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return h;case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return h.add((d.offsetValue||I).scale(d.repeatCount))}break}case v.ANIMATIONTYPE_VECTOR2:{const h=S?this.vector2InterpolateFunctionWithTangents(a,b.outTangent.scale(M),D,w.inTangent.scale(M),q):this.vector2InterpolateFunction(a,D,q);switch(d.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return h;case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return h.add((d.offsetValue||R).scale(d.repeatCount))}break}case v.ANIMATIONTYPE_SIZE:switch(d.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(a,D,q);case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(a,D,q).add((d.offsetValue||Z).scale(d.repeatCount))}break;case v.ANIMATIONTYPE_COLOR3:{const h=S?this.color3InterpolateFunctionWithTangents(a,b.outTangent.scale(M),D,w.inTangent.scale(M),q):this.color3InterpolateFunction(a,D,q);switch(d.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return h;case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return h.add((d.offsetValue||L).scale(d.repeatCount))}break}case v.ANIMATIONTYPE_COLOR4:{const h=S?this.color4InterpolateFunctionWithTangents(a,b.outTangent.scale(M),D,w.inTangent.scale(M),q):this.color4InterpolateFunction(a,D,q);switch(d.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return h;case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return h.add((d.offsetValue||B).scale(d.repeatCount))}break}case v.ANIMATIONTYPE_MATRIX:switch(d.loopMode){case v.ANIMATIONLOOPMODE_CYCLE:case v.ANIMATIONLOOPMODE_CONSTANT:case v.ANIMATIONLOOPMODE_YOYO:return v.AllowMatricesInterpolation?this.matrixInterpolateFunction(a,D,q,d.workValue):a;case v.ANIMATIONLOOPMODE_RELATIVE:case v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return a}}return 0}matrixInterpolateFunction(h,d,m,A){return v.AllowMatrixDecomposeForInterpolation?A?(j.b.DecomposeLerpToRef(h,d,m,A),A):j.b.DecomposeLerp(h,d,m):A?(j.b.LerpToRef(h,d,m,A),A):j.b.Lerp(h,d,m)}clone(){const h=new v(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(h.enableBlending=this.enableBlending,h.blendingSpeed=this.blendingSpeed,this._keys&&h.setKeys(this._keys),this._ranges){h._ranges={};for(const d in this._ranges){const m=this._ranges[d];m&&(h._ranges[d]=m.clone())}}return h}setKeys(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=d?h:h.slice(0)}createKeyForFrame(h){V.key=0;const d=this._interpolate(h,V,!0);if(!d)return this._keys[V.key].frame===h?V.key:V.key+1;const m={frame:h,value:d.clone?d.clone():d};return this._keys.splice(V.key+1,0,m),V.key+1}serialize(){const h={};h.name=this.name,h.property=this.targetProperty,h.framePerSecond=this.framePerSecond,h.dataType=this.dataType,h.loopBehavior=this.loopMode,h.enableBlending=this.enableBlending,h.blendingSpeed=this.blendingSpeed;const d=this.dataType;h.keys=[];const m=this.getKeys();for(let j=0;j<m.length;j++){const A=m[j],b={};switch(b.frame=A.frame,d){case v.ANIMATIONTYPE_FLOAT:b.values=[A.value],void 0!==A.inTangent&&b.values.push(A.inTangent),void 0!==A.outTangent&&(void 0===A.inTangent&&b.values.push(void 0),b.values.push(A.outTangent)),void 0!==A.interpolation&&(void 0===A.inTangent&&b.values.push(void 0),void 0===A.outTangent&&b.values.push(void 0),b.values.push(A.interpolation));break;case v.ANIMATIONTYPE_QUATERNION:case v.ANIMATIONTYPE_MATRIX:case v.ANIMATIONTYPE_VECTOR3:case v.ANIMATIONTYPE_COLOR3:case v.ANIMATIONTYPE_COLOR4:b.values=A.value.fd(),void 0!=A.inTangent&&b.values.push(A.inTangent.fd()),void 0!=A.outTangent&&(void 0===A.inTangent&&b.values.push(void 0),b.values.push(A.outTangent.fd())),void 0!==A.interpolation&&(void 0===A.inTangent&&b.values.push(void 0),void 0===A.outTangent&&b.values.push(void 0),b.values.push(A.interpolation))}h.keys.push(b)}h.ranges=[];for(const j in this._ranges){const d=this._ranges[j];if(!d)continue;const m={};m.name=j,m.from=d.from,m.to=d.to,h.ranges.push(m)}return h}static _UniversalLerp(h,d,m){const j=h.constructor;return j.Lerp?j.Lerp(h,d,m):j.Slerp?j.Slerp(h,d,m):h.toFixed?h*(1-m)+m*d:d}static Parse(h){const d=new v(h.name,h.property,h.framePerSecond,h.dataType,h.loopBehavior),m=h.dataType,b=[];let w,a;for(h.enableBlending&&(d.enableBlending=h.enableBlending),h.blendingSpeed&&(d.blendingSpeed=h.blendingSpeed),a=0;a<h.keys.length;a++){const d=h.keys[a];let D,S,M;switch(m){case v.ANIMATIONTYPE_FLOAT:w=d.values[0],d.values.length>=2&&(D=d.values[1]),d.values.length>=3&&(S=d.values[2]),d.values.length>=4&&(M=d.values[3]);break;case v.ANIMATIONTYPE_QUATERNION:if(w=j.c.Ud(d.values),d.values.length>=8){const h=j.c.Ud(d.values.slice(4,8));h.equals(j.c.Zero())||(D=h)}if(d.values.length>=12){const h=j.c.Ud(d.values.slice(8,12));h.equals(j.c.Zero())||(S=h)}d.values.length>=13&&(M=d.values[12]);break;case v.ANIMATIONTYPE_MATRIX:w=j.b.Ud(d.values),d.values.length>=17&&(M=d.values[16]);break;case v.ANIMATIONTYPE_COLOR3:w=A.d.Ud(d.values),d.values[3]&&(D=A.d.Ud(d.values[3])),d.values[4]&&(S=A.d.Ud(d.values[4])),d.values[5]&&(M=d.values[5]);break;case v.ANIMATIONTYPE_COLOR4:w=A.f.Ud(d.values),d.values[4]&&(D=A.f.Ud(d.values[4])),d.values[5]&&(S=A.f.Ud(d.values[5])),d.values[6]&&(M=A.f.Ud(d.values[6]));break;case v.ANIMATIONTYPE_VECTOR3:default:w=j.i.Ud(d.values),d.values[3]&&(D=j.i.Ud(d.values[3])),d.values[4]&&(S=j.i.Ud(d.values[4])),d.values[5]&&(M=d.values[5])}const q={};q.frame=d.frame,q.value=w,void 0!=D&&(q.inTangent=D),void 0!=S&&(q.outTangent=S),void 0!=M&&(q.interpolation=M),b.push(q)}if(d.setKeys(b),h.ranges)for(a=0;a<h.ranges.length;a++)w=h.ranges[a],d.createRange(w.name,w.from,w.to);return d}static AppendSerializedAnimations(h,d){q.d.AppendSerializedAnimations(h,d)}static async ParseFromFileAsync(h,d){return await new Promise(((m,j)=>{const A=new M.c;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){let d=JSON.parse(A.responseText);if(d.animations&&(d=d.animations),d.length){const h=[];for(const m of d)h.push(this.Parse(m));m(h)}else{const j=this.Parse(d);h&&(j.name=h),m(j)}}else j("Unable to load the animation")})),A.open("GET",d),A.send()}))}static async ParseFromSnippetAsync(h){return await new Promise(((d,m)=>{const j=new M.c;j.addEventListener("readystatechange",(()=>{if(4==j.readyState)if(200==j.status){const m=JSON.parse(JSON.parse(j.responseText).jsonPayload);if(m.animations){const j=JSON.parse(m.animations),A=[];for(const d of j.animations){const m=this.Parse(d);m.snippetId=h,A.push(m)}d(A)}else{const j=JSON.parse(m.animation),A=this.Parse(j);A.snippetId=h,d(A)}}else m("Unable to load the snippet "+h)})),j.open("GET",this.SnippetUrl+"/"+h.replace(/#/g,"/")),j.send()}))}}v._UniqueIdGenerator=0,v.AllowMatricesInterpolation=!1,v.AllowMatrixDecomposeForInterpolation=!0,v.SnippetUrl="https://snippet.babylonjs.com",v.ANIMATIONTYPE_FLOAT=0,v.ANIMATIONTYPE_VECTOR3=1,v.ANIMATIONTYPE_QUATERNION=2,v.ANIMATIONTYPE_MATRIX=3,v.ANIMATIONTYPE_COLOR3=4,v.ANIMATIONTYPE_COLOR4=7,v.ANIMATIONTYPE_VECTOR2=5,v.ANIMATIONTYPE_SIZE=6,v.ANIMATIONLOOPMODE_RELATIVE=0,v.ANIMATIONLOOPMODE_CYCLE=1,v.ANIMATIONLOOPMODE_CONSTANT=2,v.ANIMATIONLOOPMODE_YOYO=4,v.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,v.CreateFromSnippetAsync=v.ParseFromSnippetAsync,(0,w.i)("BABYLON.Animation",v),D.b._AnimationRangeFactory=(h,d,m)=>new a.c(h,d,m)},11722:(h,d,m)=>{m.d(d,{c:()=>j});class j{constructor(h,d,m){this.name=h,this.from=d,this.to=m}clone(){return new j(this.name,this.from,this.to)}}},11281:(h,d,m)=>{m.d(d,{c:()=>w,d:()=>a});var j=m(11286),A=m(11121),b=m(11290);class w{get q(){return this._isDisposed}constructor(h,d,m){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4&&void 0!==arguments[4]&&arguments[4],w=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7?arguments[7]:void 0,S=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,h&&h.ih?this._engine=h.ih().getEngine():this._engine=h,this._updatable=m,this._instanced=w,this._divisor=D||1,this._label=S,d instanceof j.c?(this._data=null,this._buffer=d):(this._data=d,this._buffer=null),this.byteStride=a?A:A*Float32Array.BYTES_PER_ELEMENT,b||this.create()}createVertexBuffer(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6?arguments[6]:void 0;const D=b?d:d*Float32Array.BYTES_PER_ELEMENT,S=j?b?j:j*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new a(this._engine,this,h,this._updatable,!0,S,void 0===A?this._instanced:A,D,m,void 0,void 0,!0,this._divisor||w)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!h&&this._buffer||(h=h||this._data,h&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,h),this._data=h):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(h,this._label),this._data=h):this._buffer=this._engine.createVertexBuffer(h,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.km>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.km,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.km,void 0,this._label));A.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(h){this.create(h)}updateDirectly(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,h,j?d:d*Float32Array.BYTES_PER_ELEMENT,m?m*this.byteStride:void 0),this._data=0===d&&void 0===m?h:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class a{get q(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(h){const d=0!=h;this._instanceDivisor=h,d!==this._instanced&&(this._instanced=d,this._computeHashCode())}get _maxVerticesCount(){const h=this.getData();return h?Array.isArray(h)?h.length/(this.byteStride/4)-this.byteOffset/4:(h.byteLength-this.byteOffset)/this.byteStride:0}constructor(h,d,m,j,A,D,S,M,q,E){let I=arguments.length>10&&void 0!==arguments[10]&&arguments[10],R=arguments.length>11&&void 0!==arguments[11]&&arguments[11],Z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,L=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let B=!1;if(this.sa=h,"object"===typeof j&&null!==j?(B=j.updatable??!1,A=j.postponeInternalCreation,D=j.stride,S=j.instanced,M=j.offset,q=j.size,E=j.type,I=j.normalized??!1,R=j.useBytes??!1,Z=j.divisor??1,L=j.takeBufferOwnership??!1,this._label=j.label):B=!!j,d instanceof w?(this._buffer=d,this._ownsBuffer=L):(this._buffer=new w(h,d,B,D,A,S,R,Z,this._label),this._ownsBuffer=!0),this.uniqueId=a._Counter++,this._kind=m,void 0===E){const h=this.getData();this.type=h?a.GetDataType(h):a.FLOAT}else this.type=E;const V=(0,b.m)(this.type);R?(this._size=q||(D?D/V:a.DeduceStride(m)),this.byteStride=D||this._buffer.byteStride||this._size*V,this.byteOffset=M||0):(this._size=q||D||a.DeduceStride(m),this.byteStride=D?D*V:this._buffer.byteStride||this._size*V,this.byteOffset=(M||0)*V),this.normalized=I,this._instanced=void 0!==S&&S,this._instanceDivisor=S?Z:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var h;null===(h=this._buffer)||void 0===h||h._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(h,d){const m=this.getData();return m?(0,b.i)(m,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,h,d):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,b.m)(this.type)}getOffset(){return this.byteOffset/(0,b.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,b.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(h){this._buffer.create(h),this._alignBuffer()}update(h){this._buffer.update(h),this._alignBuffer()}updateDirectly(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(h,d,void 0,m),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(h,d){(0,b.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,h,this.normalized,((h,m)=>{for(let j=0;j<this._size;j++)d(h[j],m+j)}))}_alignBuffer(){}static DeduceStride(h){switch(h){case a.UVKind:case a.UV2Kind:case a.UV3Kind:case a.UV4Kind:case a.UV5Kind:case a.UV6Kind:return 2;case a.NormalKind:case a.PositionKind:return 3;case a.ColorKind:case a.ColorInstanceKind:case a.MatricesIndicesKind:case a.MatricesIndicesExtraKind:case a.MatricesWeightsKind:case a.MatricesWeightsExtraKind:case a.TangentKind:return 4;default:throw new Error("Invalid kind '"+h+"'")}}static GetDataType(h){return h instanceof Int8Array?a.BYTE:h instanceof Uint8Array?a.UNSIGNED_BYTE:h instanceof Int16Array?a.SHORT:h instanceof Uint16Array?a.UNSIGNED_SHORT:h instanceof Int32Array?a.INT:h instanceof Uint32Array?a.UNSIGNED_INT:a.FLOAT}static GetTypeByteLength(h){return(0,b.m)(h)}static ForEach(h,d,m,j,A,w,a,D){(0,b.h)(h,d,m,j,A,w,a,((h,d)=>{for(let m=0;m<j;m++)D(h[m],d+m)}))}static GetFloatData(h,d,m,j,A,w,a,D){return(0,b.i)(h,d,m,j,A,w,a,D)}}a._Counter=0,a.BYTE=5120,a.UNSIGNED_BYTE=5121,a.SHORT=5122,a.UNSIGNED_SHORT=5123,a.INT=5124,a.UNSIGNED_INT=5125,a.FLOAT=5126,a.PositionKind="position",a.NormalKind="normal",a.TangentKind="tangent",a.UVKind="uv",a.UV2Kind="uv2",a.UV3Kind="uv3",a.UV4Kind="uv4",a.UV5Kind="uv5",a.UV6Kind="uv6",a.ColorKind="color",a.ColorInstanceKind="instanceColor",a.MatricesIndicesKind="matricesIndices",a.MatricesWeightsKind="matricesWeights",a.MatricesIndicesExtraKind="matricesIndicesExtra",a.MatricesWeightsExtraKind="matricesWeightsExtra"},11290:(h,d,m)=>{m.d(d,{b:()=>E,d:()=>q,h:()=>D,i:()=>S,m:()=>w,n:()=>a,q:()=>M});var j=m(11121);function A(h,d,m,j){switch(d){case 5120:{let d=h.getInt8(m);return j&&(d=Math.max(d/127,-1)),d}case 5121:{let d=h.getUint8(m);return j&&(d/=255),d}case 5122:{let d=h.getInt16(m,!0);return j&&(d=Math.max(d/32767,-1)),d}case 5123:{let d=h.getUint16(m,!0);return j&&(d/=65535),d}case 5124:return h.getInt32(m,!0);case 5125:return h.getUint32(m,!0);case 5126:return h.getFloat32(m,!0);default:throw new Error(`Invalid component type ${d}`)}}function b(h,d,m,j,A){switch(d){case 5120:j&&(A=Math.round(127*A)),h.setInt8(m,A);break;case 5121:j&&(A=Math.round(255*A)),h.setUint8(m,A);break;case 5122:j&&(A=Math.round(32767*A)),h.setInt16(m,A,!0);break;case 5123:j&&(A=Math.round(65535*A)),h.setUint16(m,A,!0);break;case 5124:h.setInt32(m,A,!0);break;case 5125:h.setUint32(m,A,!0);break;case 5126:h.setFloat32(m,A,!0);break;default:throw new Error(`Invalid component type ${d}`)}}function w(h){switch(h){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${h}'`)}}function a(h){switch(h){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${h}'`)}}function D(h,d,m,j,a,D,S,M){const q=new Array(j),E=new Array(j);if(h instanceof Array){let A=d/4;const b=m/4;for(let d=0;d<D;d+=j){for(let d=0;d<j;d++)q[d]=E[d]=h[A+d];M(E,d);for(let d=0;d<j;d++)q[d]!==E[d]&&(h[A+d]=E[d]);A+=b}}else{const I=ArrayBuffer.isView(h)?new DataView(h.buffer,h.byteOffset,h.byteLength):new DataView(h),R=w(a);for(let h=0;h<D;h+=j){for(let h=0,m=d;h<j;h++,m+=R)q[h]=E[h]=A(I,a,m,S);M(E,h);for(let h=0,m=d;h<j;h++,m+=R)q[h]!==E[h]&&b(I,a,m,S,E[h]);d+=m}}}function S(h,d,m,A,b,a,S,M){const q=d*w(m),E=S*d;if(5126!==m||b!==q){const j=new Float32Array(E);return D(h,A,b,d,m,E,a,((h,m)=>{for(let A=0;A<d;A++)j[m+A]=h[A]})),j}if(!(h instanceof Array||h instanceof Float32Array)||0!==A||h.length!==E){if(h instanceof Array){const d=A/4;return h.slice(d,d+E)}if(h instanceof ArrayBuffer)return new Float32Array(h,A,E);{const d=h.byteOffset+A;return 0!==(3&d)&&(j.c.Warn("Float array must be aligned to 4-bytes border"),M=!0),M?new Float32Array(h.buffer.slice(d,d+E*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(h.buffer,d,E)}}return M?h.slice():h}function M(h,d,m,A,b,S,M,q){const E=w(m),I=a(m),R=M*d;if(Array.isArray(h)){if(0!==(3&A)||0!==(3&b))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const j=A/4,w=b/4;if(j+(M-1)*w+d>h.length)throw new Error("Last accessed index is out of bounds.");if(w<d)throw new Error("Data stride cannot be smaller than the component size.");if(w!==d){const j=new I(R);return D(h,A,b,d,m,R,S,((h,m)=>{for(let A=0;A<d;A++)j[m+A]=h[A]})),j}return new I(h.slice(j,j+R))}let Z,L=A;h instanceof ArrayBuffer?Z=h:(Z=h.buffer,L+=h.byteOffset);if(L+(M-1)*b+d*E>Z.byteLength)throw new Error("Last accessed byte is out of bounds.");const B=d*E;if(b<B)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(b!==B){const h=new I(R);return D(Z,L,b,d,m,R,S,((m,j)=>{for(let A=0;A<d;A++)h[j+A]=m[A]})),h}return 1!==E&&0!==(L&E-1)&&(j.c.Warn("Array must be aligned to border of element size. Data will be copied."),q=!0),q?new I(Z.slice(L,L+R*E)):new I(Z,L,R)}function q(h,d,m,A,b,a,S,M){const q=d*w(m),E=S*d;if(M.length!==E)throw new Error("Output length is not valid");if(5126===m&&b===q)if(h instanceof Array){const d=A/4;M.set(h,d)}else if(h instanceof ArrayBuffer){const d=new Float32Array(h,A,E);M.set(d)}else{const d=h.byteOffset+A;if(0!==(3&d))return j.c.Warn("Float array must be aligned to 4-bytes border"),void M.set(new Float32Array(h.buffer.slice(d,d+E*Float32Array.BYTES_PER_ELEMENT)));const m=new Float32Array(h.buffer,d,E);M.set(m)}else D(h,A,b,d,m,E,a,((h,m)=>{for(let j=0;j<d;j++)M[m+j]=h[j]}))}function E(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(h)){for(let A=0;A<d;A++)if(h[m+A]-j>65535)return!0;return!1}return 4===h.BYTES_PER_ELEMENT}},11286:(h,d,m)=>{m.d(d,{c:()=>j});class j{get underlyingResource(){return null}constructor(){this.references=0,this.km=0,this.is32Bits=!1,this.uniqueId=j._Counter++}}j._Counter=0},11427:(h,d,m)=>{m.d(d,{e:()=>L});var j=m(11258),A=m(11261),b=m(11430),w=m(11107),a=m(11097),D=m(11058),S=m(11374),M=m(11121),q=m(11080),E=m(11137),I=m(11432),R=m(11434),Z=m(11341);class L extends S.b{get position(){return this._position}set position(h){this._position=h}set upVector(h){this._upVector=h}get upVector(){return this._upVector}get screenArea(){let h=0,d=0;if(this.mode===L.PERSPECTIVE_CAMERA)this.fovMode===L.FOVMODE_VERTICAL_FIXED?(d=2*this.jb*Math.tan(this.fov/2),h=this.getEngine().getAspectRatio(this)*d):(h=2*this.jb*Math.tan(this.fov/2),d=h/this.getEngine().getAspectRatio(this));else{const m=this.getEngine().getRenderWidth()/2,j=this.getEngine().getRenderHeight()/2;h=(this.orthoRight??m)-(this.orthoLeft??-m),d=(this.orthoTop??j)-(this.orthoBottom??-j)}return h*d}set orthoLeft(h){this._orthoLeft=h;for(const d of this._rigCameras)d.orthoLeft=h}get orthoLeft(){return this._orthoLeft}set orthoRight(h){this._orthoRight=h;for(const d of this._rigCameras)d.orthoRight=h}get orthoRight(){return this._orthoRight}set orthoBottom(h){this._orthoBottom=h;for(const d of this._rigCameras)d.orthoBottom=h}get orthoBottom(){return this._orthoBottom}set orthoTop(h){this._orthoTop=h;for(const d of this._rigCameras)d.orthoTop=h}get orthoTop(){return this._orthoTop}setFocalLength(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;this.fov=2*Math.atan(d/(2*h))}set mode(h){this._mode=h;for(const d of this._rigCameras)d.mode=h}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(h,d,m){let j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(h,m,!1),this._position=D.i.Zero(),this._upVector=D.i.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.jb=1,this.maxZ=1e4,this.inertia=.9,this._mode=L.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new I.d(0,0,1,1),this.layerMask=268435455,this.fovMode=L.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=L.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new a.e,this.onProjectionMatrixChangedObservable=new a.e,this.onAfterCheckInputsObservable=new a.e,this.onRestoreStateObservable=new a.e,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new D.b,this._postProcesses=new Array,this._activeMeshes=new b.e(256),this._globalPosition=D.i.Zero(),this._computedViewMatrix=D.b.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=D.b.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=D.c.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.ih().addCamera(this),j&&!this.ih().activeCamera&&(this.ih().activeCamera=this),this.position=d,this.renderPassId=this.ih().getEngine().createRenderPassId(`Camera ${h}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"CM"}toString(h){let d="Name: "+this.name;if(d+=", type: "+this.getClassName(),this.animations)for(let m=0;m<this.animations.length;m++)d+=", animation[0]: "+this.animations[m].toString(h);return d}applyVerticalCorrection(){const h=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-h.x:h.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(h){return-1!==this._activeMeshes.indexOf(h)}isReady(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(h)for(const d of this._postProcesses)if(d&&!d.isReady())return!1;return super.isReady(h)}_initCache(){super._initCache(),this._cache.position=new D.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new D.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.jb=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(h){h||super._updateCache(),this._cache.position.D(this.position),this._cache.upVector.D(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let h=this._cache.mode===this.mode&&this._cache.jb===this.jb&&this._cache.maxZ===this.maxZ;if(!h)return!1;const d=this.getEngine();return this.mode===L.PERSPECTIVE_CAMERA?h=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===d.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(h=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===d.getRenderWidth()&&this._cache.renderHeight===d.getRenderHeight(),this.oblique&&(h=h&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),h}attachControl(h,d){}xq(h){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==L.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let h=0;h<this._postProcesses.length;h++)if(null!==this._postProcesses[h])return this._postProcesses[h];return null}_cascadePostProcessesToRigCams(){const h=this._getFirstPostProcess();h&&h.markTextureDirty();for(let d=0,m=this._rigCameras.length;d<m;d++){const h=this._rigCameras[d],m=h._rigPostProcess;if(m){"pass"===m.getEffectName()&&(h.isIntermediate=0===this._postProcesses.length),h._postProcesses=this._postProcesses.slice(0).concat(m),m.markTextureDirty()}else h._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!h.isReusable()&&this._postProcesses.indexOf(h)>-1?(M.c.Error("You're trying to reuse a post process not defined as reusable."),0):(null==d||d<0?this._postProcesses.push(h):null===this._postProcesses[d]?this._postProcesses[d]=h:this._postProcesses.splice(d,0,h),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.PS(),this._postProcesses.indexOf(h))}detachPostProcess(h){const d=this._postProcesses.indexOf(h);-1!==d&&(this._postProcesses[d]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.PS(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return D.b.Identity()}getViewMatrix(h){return!h&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.ih().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(h){this._doNotComputeProjectionMatrix=!0,void 0!==h&&(this._projectionMatrix=h)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(h){if(this._doNotComputeProjectionMatrix||!h&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.jb=this.jb,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const d=this.getEngine(),m=this.ih(),j=d.useReverseDepthBuffer;if(this.mode===L.PERSPECTIVE_CAMERA){let h;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=d.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.jb<=0&&(this.jb=.1),h=m.useRightHandedSystem?D.b.PerspectiveFovRHToRef:D.b.PerspectiveFovLHToRef,h(this.fov,d.getAspectRatio(this),j?this.maxZ:this.jb,j?this.jb:this.maxZ,this._projectionMatrix,this.fovMode===L.FOVMODE_VERTICAL_FIXED,d.isNDCHalfZRange,this.projectionPlaneTilt,j)}else{var A,b,w;const h=d.getRenderWidth()/2,a=d.getRenderHeight()/2;m.useRightHandedSystem?this.oblique?D.b.ObliqueOffCenterRHToRef(this.orthoLeft??-h,this.orthoRight??h,this.orthoBottom??-a,this.orthoTop??a,j?this.maxZ:this.jb,j?this.jb:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,d.isNDCHalfZRange):D.b.OrthoOffCenterRHToRef(this.orthoLeft??-h,this.orthoRight??h,this.orthoBottom??-a,this.orthoTop??a,j?this.maxZ:this.jb,j?this.jb:this.maxZ,this._projectionMatrix,d.isNDCHalfZRange):this.oblique?D.b.ObliqueOffCenterLHToRef(this.orthoLeft??-h,this.orthoRight??h,this.orthoBottom??-a,this.orthoTop??a,j?this.maxZ:this.jb,j?this.jb:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,d.isNDCHalfZRange):D.b.OrthoOffCenterLHToRef(this.orthoLeft??-h,this.orthoRight??h,this.orthoBottom??-a,this.orthoTop??a,j?this.maxZ:this.jb,j?this.jb:this.maxZ,this._projectionMatrix,d.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(A=this.oblique)||void 0===A?void 0:A.angle,this._cache.obliqueLength=null===(b=this.oblique)||void 0===b?void 0:b.length,this._cache.obliqueOffset=null===(w=this.oblique)||void 0===w?void 0:w.offset,this._cache.renderWidth=d.getRenderWidth(),this._cache.renderHeight=d.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(h){return(this.radius||(this.target?D.i.Distance(this.position,this.target):this.position.length()))+h}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?R.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=R.b.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),d&&this.rigCameras.length>0){let d=!1;for(const m of this.rigCameras)m._updateFrustumPlanes(),d=d||h.isInFrustum(m._frustumPlanes);return d}return h.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(h){return this._updateFrustumPlanes(),h.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,E.b)("Ray")}getForwardRayToRef(h){throw(0,E.b)("Ray")}dispose(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.ih().stopAnimation(this),this.ih().removeCamera(this);this._rigCameras.length>0;){const h=this._rigCameras.pop();h&&h.dispose()}if(this._parentContainer){const h=this._parentContainer.cameras.indexOf(this);h>-1&&this._parentContainer.cameras.splice(h,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==L.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let h=this._postProcesses.length;for(;--h>=0;){const d=this._postProcesses[h];d&&d.dispose(this)}}let m=this.customRenderTargets.length;for(;--m>=0;)this.customRenderTargets[m].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.ih().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(h,d)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(h,d){if(this.cameraRigMode!==h){for(;this._rigCameras.length>0;){const h=this._rigCameras.pop();h&&h.dispose()}if(this.cameraRigMode=h,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=d.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=w.e.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==L.RIG_MODE_NONE){const h=this.createRigCamera(this.name+"_L",0);h&&(h._isLeftCamera=!0);const d=this.createRigCamera(this.name+"_R",1);d&&(d._isRightCamera=!0),h&&d&&(this._rigCameras.push(h),this._rigCameras.push(d))}this._setRigMode(d),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(h){}_getVRProjectionMatrix(){return D.b.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.jb,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(h,d){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[h]=d,"interaxialDistance"===h&&(this._cameraRigParams.stereoHalfAngle=w.e.ToRadians(d/.0637))}createRigCamera(h,d){return null}_updateRigCameras(){for(let h=0;h<this._rigCameras.length;h++)this._rigCameras[h].jb=this.jb,this._rigCameras[h].maxZ=this.maxZ,this._rigCameras[h].fov=this.fov,this._rigCameras[h].upVector.D(this.upVector);this.cameraRigMode===L.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const h=Z.d.Serialize(this);return h.uniqueId=this.uniqueId,h.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(h),this.inputs&&this.inputs.serialize(h),Z.d.AppendSerializedAnimations(this,h),h.ranges=this.serializeAnimationRanges(),h.isEnabled=this.isEnabled(),h}clone(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=Z.d.Clone(L.GetConstructorFromName(this.getClassName(),h,this.ih(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return m.name=h,m.parent=d,this.onClonedObservable.notifyObservers(m),m}JD(h){const d=D.i.Zero();return this.getDirectionToRef(h,d),d}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(h,d){D.i.TransformNormalToRef(h,this.getWorldMatrix(),d)}static GetConstructorFromName(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const b=S.b.Construct(h,d,m,{interaxial_distance:j,isStereoscopicSideBySide:A});return b||(()=>L._CreateDefaultParsedCamera(d,m))}Zd(){return this.getWorldMatrix()}static Parse(h,d){const m=h.type,j=L.GetConstructorFromName(m,h.name,d,h.interaxial_distance,h.isStereoscopicSideBySide),A=Z.d.Parse(j,h,d);if(void 0!==h.parentId&&(A._waitingParentId=h.parentId),void 0!==h.parentInstanceIndex&&(A._waitingParentInstanceIndex=h.parentInstanceIndex),A.inputs&&(A.inputs.parse(h),A._setupInputs()),h.upVector&&(A.upVector=D.i.Ud(h.upVector)),A.setPosition&&(A.position.xd(0,0,0),A.setPosition(D.i.Ud(h.position))),h.target&&A.setTarget&&A.setTarget(D.i.Ud(h.target)),h.cameraRigMode){const d=h.interaxial_distance?{interaxialDistance:h.interaxial_distance}:{};A.setCameraRigMode(h.cameraRigMode,d)}if(h.animations){for(let d=0;d<h.animations.length;d++){const m=h.animations[d],j=(0,q.e)("BABYLON.Animation");j&&A.animations.push(j.Parse(m))}S.b.ParseAnimationRanges(A,h,d)}return h.autoAnimate&&d.beginAnimation(A,h.autoAnimateFrom,h.autoAnimateTo,h.autoAnimateLoop,h.autoAnimateSpeed||1),void 0!==h.isEnabled&&A.jD(h.isEnabled),A}_calculateHandednessMultiplier(){let h=this.ih().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(h*=-1),h}}L._CreateDefaultParsedCamera=(h,d)=>{throw(0,E.b)("UniversalCamera")},L.PERSPECTIVE_CAMERA=0,L.ORTHOGRAPHIC_CAMERA=1,L.FOVMODE_VERTICAL_FIXED=0,L.FOVMODE_HORIZONTAL_FIXED=1,L.RIG_MODE_NONE=0,L.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,L.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,L.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,L.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,L.RIG_MODE_STEREOSCOPIC_INTERLACED=14,L.RIG_MODE_VR=20,L.RIG_MODE_CUSTOM=22,L.ForceAttachControlToAlwaysPreventDefault=!1,(0,j.d)([(0,A.K)("position")],L.prototype,"_position",void 0),(0,j.d)([(0,A.K)("upVector")],L.prototype,"_upVector",void 0),(0,j.d)([(0,A.M)()],L.prototype,"orthoLeft",null),(0,j.d)([(0,A.M)()],L.prototype,"orthoRight",null),(0,j.d)([(0,A.M)()],L.prototype,"orthoBottom",null),(0,j.d)([(0,A.M)()],L.prototype,"orthoTop",null),(0,j.d)([(0,A.M)()],L.prototype,"fov",void 0),(0,j.d)([(0,A.M)()],L.prototype,"projectionPlaneTilt",void 0),(0,j.d)([(0,A.M)()],L.prototype,"jb",void 0),(0,j.d)([(0,A.M)()],L.prototype,"maxZ",void 0),(0,j.d)([(0,A.M)()],L.prototype,"inertia",void 0),(0,j.d)([(0,A.M)()],L.prototype,"mode",null),(0,j.d)([(0,A.M)()],L.prototype,"layerMask",void 0),(0,j.d)([(0,A.M)()],L.prototype,"fovMode",void 0),(0,j.d)([(0,A.M)()],L.prototype,"cameraRigMode",void 0),(0,j.d)([(0,A.M)()],L.prototype,"interaxialDistance",void 0),(0,j.d)([(0,A.M)()],L.prototype,"isStereoscopicSideBySide",void 0)},11587:(h,d,m)=>{m.d(d,{e:()=>q});var j=m(11258),A=m(11261),b=m(11427),w=m(11058),a=m(11065),D=m(11407);m(11374).b.AddNodeConstructor("TargetCamera",((h,d)=>()=>new q(h,w.i.Zero(),d)));const S=w.b.Zero(),M=w.c.Identity();class q extends b.e{constructor(h,d,m){super(h,d,m,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new w.i(0,0,0),this.cameraRotation=new w.h(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=w.i.Zero(),this._initialFocalDistance=1,this._viewMatrix=w.b.Zero(),this._cameraTransformMatrix=w.b.Zero(),this._cameraRotationMatrix=w.b.Zero(),this._transformedReferencePoint=w.i.Zero(),this._deferredPositionUpdate=new w.i,this._deferredRotationQuaternionUpdate=new w.c,this._deferredRotationUpdate=new w.i,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=w.i.Forward(this.ih().useRightHandedSystem),this.rotation=new w.i(0,this.ih().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(h){this.getWorldMatrix();const d=w.d.Qd[0],m=w.d.Qd[1];return m.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(m,d),d.scaleInPlace(h),this.globalPosition.add(d)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const h=this.lockedTarget;h.Zd().getTranslationToRef(h.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.xd(0,0,0),this.cameraRotation.xd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new w.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new w.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new w.c(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(h){h||super._updateCache();const d=this._getLockedTargetPosition();d?this._cache.lockedTarget?this._cache.lockedTarget.D(d):this._cache.lockedTarget=d.clone():this._cache.lockedTarget=null,this._cache.rotation.D(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.D(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const h=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(h):!h)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const h=this.getEngine();return this.speed*Math.sqrt(h.getDeltaTime()/(100*h.getFps()))}setTarget(h){this.upVector.normalize(),this._initialFocalDistance=h.fm(this.position).length(),this.position.z===h.z&&(this.position.z+=a.c),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.ih().useRightHandedSystem?w.b.LookAtRHToRef(this.position,h,w.i.UpReadOnly,S):w.b.LookAtLHToRef(this.position,h,w.i.UpReadOnly,S),S.invert();const d=this.rotationQuaternion||M;w.c.FromRotationMatrixToRef(S,d),d.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(h){this.setTarget(h)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(w.d.Matrix[0]),w.i.TransformNormalToRef(this.cameraDirection,w.d.Matrix[0],w.d.Qd[0]),this._deferredPositionUpdate.addInPlace(w.d.Qd[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.D(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.D(this._deferredPositionUpdate)}_checkInputs(){const h=this.invertRotation?-this.inverseRotationSpeed:1,d=this._decideIfNeedsToMove(),m=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.D(this.rotation),this._deferredPositionUpdate.D(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.D(this.rotationQuaternion),d&&this._updatePosition(),m){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*h,this._deferredRotationUpdate.y+=this.cameraRotation.y*h,!this.noRotationConstraint){const h=1.570796;this._deferredRotationUpdate.x>h&&(this._deferredRotationUpdate.x=h),this._deferredRotationUpdate.x<-h&&(this._deferredRotationUpdate.x=-h)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.D(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(w.c.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.D(this._deferredRotationQuaternionUpdate))}}d&&(Math.abs(this.cameraDirection.x)<this.speed*a.c&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*a.c&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*a.c&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),m&&(Math.abs(this.cameraRotation.x)<this.speed*a.c&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*a.c&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):w.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return w.i.TransformNormalToRef(w.i.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),w.i.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?D.e.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(w.c.FromEulerVectorToRef(this.rotation,M),D.e.Y.rotateByQuaternionToRef(M,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(h,d,m){if(this.ih().useRightHandedSystem?w.b.LookAtRHToRef(h,d,m,this._viewMatrix):w.b.LookAtLHToRef(h,d,m,this._viewMatrix),this.parent){const h=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(h,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.D(h)}createRigCamera(h,d){if(this.cameraRigMode!==b.e.RIG_MODE_NONE){const d=new q(h,this.position.clone(),this.ih());return d.isRigCamera=!0,d.rigParent=this,this.cameraRigMode===b.e.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new w.c),d._cameraRigParams={},d.rotationQuaternion=new w.c),d.mode=this.mode,d.orthoLeft=this.orthoLeft,d.orthoRight=this.orthoRight,d.orthoTop=this.orthoTop,d.orthoBottom=this.orthoBottom,d}return null}_updateRigCameras(){const h=this._rigCameras[0],d=this._rigCameras[1];switch(this.Zd(),this.cameraRigMode){case b.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case b.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case b.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case b.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case b.e.RIG_MODE_STEREOSCOPIC_INTERLACED:{const m=this.cameraRigMode===b.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,j=this.cameraRigMode===b.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*m,h),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*j,d);break}case b.e.RIG_MODE_VR:h.rotationQuaternion?(h.rotationQuaternion.D(this.rotationQuaternion),d.rotationQuaternion.D(this.rotationQuaternion)):(h.rotation.D(this.rotation),d.rotation.D(this.rotation)),h.position.D(this.position),d.position.D(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(h,d){this.getTarget().subtractToRef(this.position,q._TargetFocalPoint),q._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const m=q._TargetFocalPoint.addInPlace(this.position);w.b.TranslationToRef(-m.x,-m.y,-m.z,q._TargetTransformMatrix),q._TargetTransformMatrix.multiplyToRef(w.b.RotationAxis(d.upVector,h),q._RigCamTransformMatrix),w.b.TranslationToRef(m.x,m.y,m.z,q._TargetTransformMatrix),q._RigCamTransformMatrix.multiplyToRef(q._TargetTransformMatrix,q._RigCamTransformMatrix),w.i.TransformCoordinatesToRef(this.position,q._RigCamTransformMatrix,d.position),d.setTarget(m)}getClassName(){return"TargetCamera"}}q._RigCamTransformMatrix=new w.b,q._TargetTransformMatrix=new w.b,q._TargetFocalPoint=new w.i,(0,j.d)([(0,A.M)()],q.prototype,"updateUpVectorFromRotation",void 0),(0,j.d)([(0,A.K)()],q.prototype,"rotation",void 0),(0,j.d)([(0,A.M)()],q.prototype,"speed",void 0),(0,j.d)([(0,A.w)("lockedTargetId")],q.prototype,"lockedTarget",void 0)},11299:(h,d,m)=>{m.d(d,{d:()=>j});class j{constructor(h,d,m){this.bu=h,this.bv=d,this.distance=m,this.faceId=0,this.subMeshId=0}}},11400:(h,d,m)=>{m.d(d,{b:()=>b});var j=m(11058),A=m(11281);class b{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var h;let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||m&&!this.pickedMesh.isVerticesDataPresent(A.d.NormalKind))return null;let b,w=this.pickedMesh.Vd();0===(null===(h=w)||void 0===h?void 0:h.length)&&(w=null);const a=j.d.Qd[0],D=j.d.Qd[1],S=j.d.Qd[2];if(m){const h=this.pickedMesh.getVerticesData(A.d.NormalKind);let d=w?j.i.FromArrayToRef(h,3*w[3*this.faceId],a):a.xd(h[3*this.faceId*3],h[3*this.faceId*3+1],h[3*this.faceId*3+2]),m=w?j.i.FromArrayToRef(h,3*w[3*this.faceId+1],D):D.xd(h[3*(3*this.faceId+1)],h[3*(3*this.faceId+1)+1],h[3*(3*this.faceId+1)+2]),M=w?j.i.FromArrayToRef(h,3*w[3*this.faceId+2],S):S.xd(h[3*(3*this.faceId+2)],h[3*(3*this.faceId+2)+1],h[3*(3*this.faceId+2)+2]);d=d.scale(this.bu),m=m.scale(this.bv),M=M.scale(1-this.bu-this.bv),b=new j.i(d.x+m.x+M.x,d.y+m.y+M.y,d.z+m.z+M.z)}else{const h=this.pickedMesh.getVerticesData(A.d.PositionKind),d=w?j.i.FromArrayToRef(h,3*w[3*this.faceId],a):a.xd(h[3*this.faceId*3],h[3*this.faceId*3+1],h[3*this.faceId*3+2]),m=w?j.i.FromArrayToRef(h,3*w[3*this.faceId+1],D):D.xd(h[3*(3*this.faceId+1)],h[3*(3*this.faceId+1)+1],h[3*(3*this.faceId+1)+2]),M=w?j.i.FromArrayToRef(h,3*w[3*this.faceId+2],S):S.xd(h[3*(3*this.faceId+2)],h[3*(3*this.faceId+2)+1],h[3*(3*this.faceId+2)+2]),q=d.fm(m),E=M.fm(m);b=j.i.Cross(q,E)}const M=(h,d)=>{if(-1!==this.thinInstanceIndex){const m=h.thinInstanceGetWorldMatrices()[this.thinInstanceIndex];m&&j.i.TransformNormalToRef(d,m,d)}let m=h.getWorldMatrix();h.nonUniformScaling&&(j.d.Matrix[0].D(m),m=j.d.Matrix[0],m.setTranslationFromFloats(0,0,0),m.invert(),m.transposeToRef(j.d.Matrix[1]),m=j.d.Matrix[1]),j.i.TransformNormalToRef(d,m,d)};if(d&&M(this.pickedMesh,b),this.ray){const h=j.d.Qd[0].D(b);d||M(this.pickedMesh,h),j.i.Dot(h,this.ray.direction)>0&&b.negateInPlace()}return b.normalize(),b}getTextureCoordinates(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.d.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(h))return null;const d=this.pickedMesh.Vd();if(!d)return null;const m=this.pickedMesh.getVerticesData(h);if(!m)return null;let b=j.h.Ud(m,2*d[3*this.faceId]),w=j.h.Ud(m,2*d[3*this.faceId+1]),a=j.h.Ud(m,2*d[3*this.faceId+2]);return b=b.scale(this.bu),w=w.scale(this.bv),a=a.scale(1-this.bu-this.bv),new j.h(b.x+w.x+a.x,b.y+w.y+a.y)}}},11449:(h,d,m)=>{m.d(d,{b:()=>j});let j=!1},11309:(h,d,m)=>{m.d(d,{e:()=>w});var j=m(11073),A=m(11058),b=m(11065);class w{constructor(h,d,m){this.vectors=(0,j.c)(8,A.i.Zero),this.center=A.i.Zero(),this.centerWorld=A.i.Zero(),this.extendSize=A.i.Zero(),this.extendSizeWorld=A.i.Zero(),this.directions=(0,j.c)(3,A.i.Zero),this.vectorsWorld=(0,j.c)(8,A.i.Zero),this.minimumWorld=A.i.Zero(),this.maximumWorld=A.i.Zero(),this.minimum=A.i.Zero(),this.maximum=A.i.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(h,d,m)}reConstruct(h,d,m){const j=h.x,b=h.y,w=h.z,a=d.x,D=d.y,S=d.z,M=this.vectors;this.minimum.xd(j,b,w),this.maximum.xd(a,D,S),M[0].xd(j,b,w),M[1].xd(a,D,S),M[2].xd(a,b,w),M[3].xd(j,D,w),M[4].xd(j,b,S),M[5].xd(a,D,w),M[6].xd(j,D,S),M[7].xd(a,b,S),d.addToRef(h,this.center).scaleInPlace(.5),d.subtractToRef(h,this.extendSize).scaleInPlace(.5),this._worldMatrix=m||A.b.IdentityReadOnly,this._update(this._worldMatrix)}scale(h){const d=w._TmpVector3,m=this.maximum.subtractToRef(this.minimum,d[0]),j=m.length();m.normalizeFromLength(j);const A=j*h,b=m.scaleInPlace(.5*A),a=this.center.subtractToRef(b,d[1]),D=this.center.addToRef(b,d[2]);return this.reConstruct(a,D,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(h){const d=this.minimumWorld,m=this.maximumWorld,j=this.directions,b=this.vectorsWorld,w=this.vectors;if(h.isIdentity()){d.D(this.minimum),m.D(this.maximum);for(let h=0;h<8;++h)b[h].D(w[h]);this.extendSizeWorld.D(this.extendSize),this.centerWorld.D(this.center)}else{d.sd(Number.MAX_VALUE),m.sd(-Number.MAX_VALUE);for(let j=0;j<8;++j){const a=b[j];A.i.TransformCoordinatesToRef(w[j],h,a),d.minimizeInPlace(a),m.maximizeInPlace(a)}m.subtractToRef(d,this.extendSizeWorld).scaleInPlace(.5),m.addToRef(d,this.centerWorld).scaleInPlace(.5)}A.i.FromArrayToRef(h.m,0,j[0]),A.i.FromArrayToRef(h.m,4,j[1]),A.i.FromArrayToRef(h.m,8,j[2]),this._worldMatrix=h}isInFrustum(h){return w.IsInFrustum(this.vectorsWorld,h)}isCompletelyInFrustum(h){return w.IsCompletelyInFrustum(this.vectorsWorld,h)}intersectsPoint(h){const d=this.minimumWorld,m=this.maximumWorld,j=d.x,A=d.y,w=d.z,a=m.x,D=m.y,S=m.z,M=h.x,q=h.y,E=h.z,I=-b.c;return!(a-M<I||I>M-j)&&(!(D-q<I||I>q-A)&&!(S-E<I||I>E-w))}intersectsSphere(h){return w.IntersectsSphere(this.minimumWorld,this.maximumWorld,h.centerWorld,h.radiusWorld)}intersectsMinMax(h,d){const m=this.minimumWorld,j=this.maximumWorld,A=m.x,b=m.y,w=m.z,a=j.x,D=j.y,S=j.z,M=h.x,q=h.y,E=h.z,I=d.x,R=d.y,Z=d.z;return!(a<M||A>I)&&(!(D<q||b>R)&&!(S<E||w>Z))}dispose(){var h,d;null===(h=this._drawWrapperFront)||void 0===h||h.dispose(),null===(d=this._drawWrapperBack)||void 0===d||d.dispose()}static Intersects(h,d){return h.intersectsMinMax(d.minimumWorld,d.maximumWorld)}static IntersectsSphere(h,d,m,j){const b=w._TmpVector3[0];A.i.ClampToRef(m,h,d,b);return A.i.DistanceSquared(m,b)<=j*j}static IsCompletelyInFrustum(h,d){for(let m=0;m<6;++m){const j=d[m];for(let d=0;d<8;++d)if(j.dotCoordinate(h[d])<0)return!1}return!0}static IsInFrustum(h,d){for(let m=0;m<6;++m){let j=!0;const A=d[m];for(let d=0;d<8;++d)if(A.dotCoordinate(h[d])>=0){j=!1;break}if(j)return!1}return!0}}w._TmpVector3=(0,j.c)(3,A.i.Zero)},11303:(h,d,m)=>{m.d(d,{e:()=>q});var j=m(11073),A=m(11058),b=m(11309),w=m(11317);const a={min:0,max:0},D={min:0,max:0},S=(h,d,m)=>{const j=A.i.Dot(d.centerWorld,h),b=Math.abs(A.i.Dot(d.directions[0],h))*d.extendSize.x+Math.abs(A.i.Dot(d.directions[1],h))*d.extendSize.y+Math.abs(A.i.Dot(d.directions[2],h))*d.extendSize.z;m.min=j-b,m.max=j+b},M=(h,d,m)=>(S(h,d,a),S(h,m,D),!(a.min>D.max||D.min>a.max));class q{constructor(h,d,m){this._isLocked=!1,this.boundingBox=new b.e(h,d,m),this.boundingSphere=new w.d(h,d,m)}reConstruct(h,d,m){this.boundingBox.reConstruct(h,d,m),this.boundingSphere.reConstruct(h,d,m)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(h){this._isLocked=h}update(h){this._isLocked||(this.boundingBox._update(h),this.boundingSphere._update(h))}centerOn(h,d){const m=q._TmpVector3[0].D(h).Dq(d),j=q._TmpVector3[1].D(h).addInPlace(d);return this.boundingBox.reConstruct(m,j,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(m,j,this.boundingBox.getWorldMatrix()),this}encapsulate(h){const d=A.i.Minimize(this.minimum,h),m=A.i.Maximize(this.maximum,h);return this.reConstruct(d,m,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(h){const d=A.d.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(d);const m=A.d.Qd[0];return A.i.TransformCoordinatesToRef(h.boundingBox.minimumWorld,d,m),this.encapsulate(m),A.i.TransformCoordinatesToRef(h.boundingBox.maximumWorld,d,m),this.encapsulate(m),this}scale(h){return this.boundingBox.scale(h),this.boundingSphere.scale(h),this}isInFrustum(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===d||3===d)&&this.boundingSphere.isCenterInFrustum(h))return!0;if(!this.boundingSphere.isInFrustum(h))return!1;return!(1!==d&&3!==d)||this.boundingBox.isInFrustum(h)}get diagonalLength(){const h=this.boundingBox;return h.maximumWorld.subtractToRef(h.minimumWorld,q._TmpVector3[0]).length()}isCompletelyInFrustum(h){return this.boundingBox.isCompletelyInFrustum(h)}_checkCollision(h){return h._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(h){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(h)&&!!this.boundingBox.intersectsPoint(h))}intersects(h,d){if(!w.d.Intersects(this.boundingSphere,h.boundingSphere))return!1;if(!b.e.Intersects(this.boundingBox,h.boundingBox))return!1;if(!d)return!0;const m=this.boundingBox,j=h.boundingBox;return!!M(m.directions[0],m,j)&&(!!M(m.directions[1],m,j)&&(!!M(m.directions[2],m,j)&&(!!M(j.directions[0],m,j)&&(!!M(j.directions[1],m,j)&&(!!M(j.directions[2],m,j)&&(!!M(A.i.Cross(m.directions[0],j.directions[0]),m,j)&&(!!M(A.i.Cross(m.directions[0],j.directions[1]),m,j)&&(!!M(A.i.Cross(m.directions[0],j.directions[2]),m,j)&&(!!M(A.i.Cross(m.directions[1],j.directions[0]),m,j)&&(!!M(A.i.Cross(m.directions[1],j.directions[1]),m,j)&&(!!M(A.i.Cross(m.directions[1],j.directions[2]),m,j)&&(!!M(A.i.Cross(m.directions[2],j.directions[0]),m,j)&&(!!M(A.i.Cross(m.directions[2],j.directions[1]),m,j)&&!!M(A.i.Cross(m.directions[2],j.directions[2]),m,j))))))))))))))}}q._TmpVector3=(0,j.c)(2,A.i.Zero)},11317:(h,d,m)=>{m.d(d,{d:()=>b});var j=m(11073),A=m(11058);class b{constructor(h,d,m){this.center=A.i.Zero(),this.centerWorld=A.i.Zero(),this.minimum=A.i.Zero(),this.maximum=A.i.Zero(),this.reConstruct(h,d,m)}reConstruct(h,d,m){this.minimum.D(h),this.maximum.D(d);const j=A.i.Distance(h,d);d.addToRef(h,this.center).scaleInPlace(.5),this.radius=.5*j,this._update(m||A.b.IdentityReadOnly)}scale(h){const d=this.radius*h,m=b._TmpVector3,j=m[0].sd(d),A=this.center.subtractToRef(j,m[1]),w=this.center.addToRef(j,m[2]);return this.reConstruct(A,w,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(h){if(h.isIdentity())this.centerWorld.D(this.center),this.radiusWorld=this.radius;else{A.i.TransformCoordinatesToRef(this.center,h,this.centerWorld);const d=b._TmpVector3[0];A.i.TransformNormalFromFloatsToRef(1,1,1,h,d),this.radiusWorld=Math.max(Math.abs(d.x),Math.abs(d.y),Math.abs(d.z))*this.radius}}isInFrustum(h){const d=this.centerWorld,m=this.radiusWorld;for(let j=0;j<6;j++)if(h[j].dotCoordinate(d)<=-m)return!1;return!0}isCenterInFrustum(h){const d=this.centerWorld;for(let m=0;m<6;m++)if(h[m].dotCoordinate(d)<0)return!1;return!0}intersectsPoint(h){const d=A.i.DistanceSquared(this.centerWorld,h);return!(this.radiusWorld*this.radiusWorld<d)}static Intersects(h,d){const m=A.i.DistanceSquared(h.centerWorld,d.centerWorld),j=h.radiusWorld+d.radiusWorld;return!(j*j<m)}static CreateFromCenterAndRadius(h,d,m){this._TmpVector3[0].D(h),this._TmpVector3[1].xd(0,0,d),this._TmpVector3[2].D(h),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Dq(this._TmpVector3[1]);const j=new b(this._TmpVector3[0],this._TmpVector3[2]);return j._worldMatrix=m||A.b.Identity(),j}}b._TmpVector3=(0,j.c)(3,A.i.Zero)},11509:(h,d,m)=>{m(11188).b.prototype.createDepthStencilTexture=function(h,d,m){if(d.isCube){const m=h.width||h;return this._createDepthStencilCubeTexture(m,d)}return this._createDepthStencilTexture(h,d,m)}},11491:(h,d,m)=>{m(11470).ThinEngine.prototype.setAlphaMode=function(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==h){switch(h){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}d||(this.depthCullingState.depthMask=0===h),this._alphaMode=h}else if(!d){const d=0===h;this.depthCullingState.depthMask!==d&&(this.depthCullingState.depthMask=d)}}},11493:(h,d,m)=>{var j=m(11470);j.ThinEngine.prototype.updateDynamicIndexBuffer=function(h,d){let m;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(h),m=h.is32Bits?d instanceof Uint32Array?d:new Uint32Array(d):d instanceof Uint16Array?d:new Uint16Array(d),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,m,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},j.ThinEngine.prototype.updateDynamicVertexBuffer=function(h,d,m,j){this.bindArrayBuffer(h),void 0===m&&(m=0);const A=d.byteLength||d.length;void 0===j||j>=A&&0===m?d instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,m,new Float32Array(d)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,m,d):d instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,m,new Float32Array(d).subarray(0,j/4)):(d=d instanceof ArrayBuffer?new Uint8Array(d,0,j):new Uint8Array(d.buffer,d.byteOffset,j),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,m,d)),this._resetVertexBufferBinding()}},11502:(h,d,m)=>{var j=m(11216),A=m(11121),b=m(11470),w=m(11504),a=m(11482);class D extends w.e{setDepthStencilTexture(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(super.setDepthStencilTexture(h,d),!h)return;const m=this._engine,j=this._context,A=h._hardwareTexture;if(A&&h._autoMSAAManagement&&this._MSAAFramebuffer){const d=m._currentFramebuffer;m._bindUnboundFramebuffer(this._MSAAFramebuffer),j.framebufferRenderbuffer(j.FRAMEBUFFER,(0,a.b)(h.format)?j.DEPTH_STENCIL_ATTACHMENT:j.DEPTH_ATTACHMENT,j.RENDERBUFFER,A.getMSAARenderBuffer()),m._bindUnboundFramebuffer(d)}}constructor(h,d,m,j,A){super(h,d,m,j),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=A}_cloneRenderTargetWrapper(){let h=null;return this._colorTextureArray&&this._depthStencilTextureArray?(h=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),h.texture.isReady=!0):h=super._cloneRenderTargetWrapper(),h}_swapRenderTargetWrapper(h){super._swapRenderTargetWrapper(h),h._framebuffer=this._framebuffer,h._depthStencilBuffer=this._depthStencilBuffer,h._MSAAFramebuffer=this._MSAAFramebuffer,h._colorTextureArray=this._colorTextureArray,h._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,b=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const h=this._engine,d=h._currentFramebuffer,m=this._context;h._bindUnboundFramebuffer(this._framebuffer),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,null),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,null),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.STENCIL_ATTACHMENT,m.RENDERBUFFER,null),h._bindUnboundFramebuffer(d),m.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(h,d,m,j,A,b)}shareDepth(h){super.shareDepth(h);const d=this._context,m=this._depthStencilBuffer,j=h._MSAAFramebuffer||h._framebuffer,A=this._engine;h._depthStencilBuffer&&h._depthStencilBuffer!==m&&d.deleteRenderbuffer(h._depthStencilBuffer),h._depthStencilBuffer=m;const b=h._generateStencilBuffer?d.DEPTH_STENCIL_ATTACHMENT:d.DEPTH_ATTACHMENT;A._bindUnboundFramebuffer(j),d.framebufferRenderbuffer(d.FRAMEBUFFER,b,d.RENDERBUFFER,m),A._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const A=h._hardwareTexture;if(!A)return;const b=this._framebuffer,w=this._engine,a=w._currentFramebuffer;let D;if(w._bindUnboundFramebuffer(b),w.webGLVersion>1){const b=this._context;var S;if(D=b["COLOR_ATTACHMENT"+d],h.is2DArray||h.is3D)m=m??(null===(S=this.layerIndices)||void 0===S?void 0:S[d])??0,b.framebufferTextureLayer(b.FRAMEBUFFER,D,A.underlyingResource,j,m);else if(h.isCube){var M;m=m??(null===(M=this.faceIndices)||void 0===M?void 0:M[d])??0,b.framebufferTexture2D(b.FRAMEBUFFER,D,b.TEXTURE_CUBE_MAP_POSITIVE_X+m,A.underlyingResource,j)}else b.framebufferTexture2D(b.FRAMEBUFFER,D,b.TEXTURE_2D,A.underlyingResource,j)}else{const h=this._context;D=h["COLOR_ATTACHMENT"+d+"_WEBGL"];const b=void 0!==m?h.TEXTURE_CUBE_MAP_POSITIVE_X+m:h.TEXTURE_2D;h.framebufferTexture2D(h.FRAMEBUFFER,D,b,A.underlyingResource,j)}if(h._autoMSAAManagement&&this._MSAAFramebuffer){const h=this._context;w._bindUnboundFramebuffer(this._MSAAFramebuffer),h.framebufferRenderbuffer(h.FRAMEBUFFER,D,h.RENDERBUFFER,A.getMSAARenderBuffer())}w._bindUnboundFramebuffer(a)}setTexture(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(h,d,m),this._bindTextureRenderTarget(h,d)}setLayerAndFaceIndices(h,d){var m;if(super.setLayerAndFaceIndices(h,d),!this.textures||!this.layerIndices||!this.faceIndices)return;const j=(null===(m=this._attachments)||void 0===m?void 0:m.length)??this.textures.length;for(let A=0;A<j;A++){const h=this.textures[A];h&&(h.is2DArray||h.is3D?this._bindTextureRenderTarget(h,A,this.layerIndices[A]):h.isCube?this._bindTextureRenderTarget(h,A,this.faceIndices[A]):this._bindTextureRenderTarget(h,A))}}setLayerAndFaceIndex(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(h,d,m),!this.textures||!this.layerIndices||!this.faceIndices)return;const j=this.textures[h];j.is2DArray||j.is3D?this._bindTextureRenderTarget(this.textures[h],h,this.layerIndices[h]):j.isCube&&this._bindTextureRenderTarget(this.textures[h],h,this.faceIndices[h])}resolveMSAATextures(){const h=this._engine,d=h._currentFramebuffer;h._bindUnboundFramebuffer(this._MSAAFramebuffer),super.resolveMSAATextures(),h._bindUnboundFramebuffer(d)}dispose(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const d=this._context;h||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(d.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(d.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(d.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(h)}}m(11509);b.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(h,d,m){const j=new D(h,d,m,this,this._gl);return this._renderTargetWrapperCache.push(j),j},b.ThinEngine.prototype.createRenderTargetTexture=function(h,d){const m=this._createHardwareRenderTargetWrapper(!1,!1,h);let j,A,b=!0,w=!1,a=!1,D=1;void 0!==d&&"object"===typeof d&&(b=d.generateDepthBuffer??!0,w=!!d.generateStencilBuffer,a=!!d.noColorAttachment,j=d.colorAttachment,D=d.samples??1,A=d.label);const S=j||(a?null:this._createInternalTexture(h,d,!0,5)),M=h.width||h,q=h.height||h,E=this._currentFramebuffer,I=this._gl,R=I.createFramebuffer();if(this._bindUnboundFramebuffer(R),m._depthStencilBuffer=this._setupFramebufferDepthAttachments(w,b,M,q),!S||S.is2DArray||S.is3D||I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,S._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(E),m.label=A??"RenderTargetWrapper",m._framebuffer=R,m._generateDepthBuffer=b,m._generateStencilBuffer=w,m.setTextures(S),j){if(m._samples=j.samples,j.samples>1){const h=j._hardwareTexture.getMSAARenderBuffer(0);m._MSAAFramebuffer=I.createFramebuffer(),this._bindUnboundFramebuffer(m._MSAAFramebuffer),I.framebufferRenderbuffer(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.RENDERBUFFER,h),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(m,D);return m},b.ThinEngine.prototype._createDepthStencilTexture=function(h,d,m){const b=this._gl,w=h.layers||0,D=h.depth||0;let S=b.TEXTURE_2D;0!==w?S=b.TEXTURE_2D_ARRAY:0!==D&&(S=b.TEXTURE_3D);const M=new j.c(this,12);if(M.label=d.label,!this._caps.depthTextureExtension)return A.c.Error("Depth texture is not supported by your browser or hardware."),M;const q={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...d};if(this._bindTextureDirectly(S,M,!0),this._setupDepthStencilTexture(M,h,0!==q.comparisonFunction&&q.bilinearFiltering,q.comparisonFunction,q.samples),void 0!==q.depthTextureFormat){if(15!==q.depthTextureFormat&&16!==q.depthTextureFormat&&17!==q.depthTextureFormat&&13!==q.depthTextureFormat&&14!==q.depthTextureFormat&&18!==q.depthTextureFormat)return A.c.Error(`Depth texture ${q.depthTextureFormat} format is not supported.`),M;M.format=q.depthTextureFormat}else M.format=q.generateStencil?13:16;const E=(0,a.b)(M.format),I=this._getWebGLTextureTypeFromDepthTextureFormat(M.format),R=E?b.DEPTH_STENCIL:b.DEPTH_COMPONENT,Z=this._getInternalFormatFromDepthTextureFormat(M.format,!0,E);return M.is2DArray?b.texImage3D(S,0,Z,M.width,M.height,w,0,R,I,null):M.is3D?b.texImage3D(S,0,Z,M.width,M.height,D,0,R,I,null):b.texImage2D(S,0,Z,M.width,M.height,0,R,I,null),this._bindTextureDirectly(S,null),this._internalTexturesCache.push(M),m._depthStencilBuffer&&(b.deleteRenderbuffer(m._depthStencilBuffer),m._depthStencilBuffer=null),this._bindUnboundFramebuffer(m._MSAAFramebuffer??m._framebuffer),m._generateStencilBuffer=E,m._depthStencilTextureWithStencil=E,m._depthStencilBuffer=this._setupFramebufferDepthAttachments(m._generateStencilBuffer,m._generateDepthBuffer,m.width,m.height,m.samples,M.format),this._bindUnboundFramebuffer(null),M},b.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(h,d){var m;if(this.webGLVersion<2||!h)return 1;if(h.samples===d)return d;const j=this._gl;d=Math.min(d,this.getCaps().maxMSAASamples),h._depthStencilBuffer&&(j.deleteRenderbuffer(h._depthStencilBuffer),h._depthStencilBuffer=null),h._MSAAFramebuffer&&(j.deleteFramebuffer(h._MSAAFramebuffer),h._MSAAFramebuffer=null);const A=null===(m=h.texture)||void 0===m?void 0:m._hardwareTexture;if(null===A||void 0===A||A.releaseMSAARenderBuffers(),h.texture&&d>1&&"function"===typeof j.renderbufferStorageMultisample){const m=j.createFramebuffer();if(!m)throw new Error("Unable to create multi sampled framebuffer");h._MSAAFramebuffer=m,this._bindUnboundFramebuffer(h._MSAAFramebuffer);const b=this._createRenderBuffer(h.texture.width,h.texture.height,d,-1,this._getRGBABufferInternalSizedFormat(h.texture.type,h.texture.format,h.texture._useSRGBBuffer),j.COLOR_ATTACHMENT0,!1);if(!b)throw new Error("Unable to create multi sampled framebuffer");null===A||void 0===A||A.addMSAARenderBuffer(b)}this._bindUnboundFramebuffer(h._MSAAFramebuffer??h._framebuffer),h.texture&&(h.texture.samples=d),h._samples=d;const b=h._depthStencilTexture?h._depthStencilTexture.format:void 0;return h._depthStencilBuffer=this._setupFramebufferDepthAttachments(h._generateStencilBuffer,h._generateDepthBuffer,h.width,h.height,d,b),this._bindUnboundFramebuffer(null),d},b.ThinEngine.prototype._setupDepthStencilTexture=function(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const b=d.width??d,w=d.height??d,a=d.layers||0,D=d.depth||0;h.baseWidth=b,h.baseHeight=w,h.width=b,h.height=w,h.is2DArray=a>0,h.depth=a||D,h.isReady=!0,h.samples=A,h.generateMipMaps=!1,h.samplingMode=m?2:1,h.type=0,h._comparisonFunction=j;const S=this._gl,M=this._getTextureTarget(h),q=this._getSamplingParameters(h.samplingMode,!1);S.texParameteri(M,S.TEXTURE_MAG_FILTER,q.mag),S.texParameteri(M,S.TEXTURE_MIN_FILTER,q.min),S.texParameteri(M,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(M,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===j?(S.texParameteri(M,S.TEXTURE_COMPARE_FUNC,515),S.texParameteri(M,S.TEXTURE_COMPARE_MODE,S.NONE)):(S.texParameteri(M,S.TEXTURE_COMPARE_FUNC,j),S.texParameteri(M,S.TEXTURE_COMPARE_MODE,S.COMPARE_REF_TO_TEXTURE)))}},11171:(h,d,m)=>{m.d(d,{b:()=>i,d:()=>o,i:()=>y,h:()=>l,j:()=>K});class j{constructor(){this.children=[]}isValid(h){return!0}process(h,d,m){let j="";if(this.line){let m=this.line;const M=d.processor;if(M){var A,b,w,a,D,S;M.lineProcessor&&(m=M.lineProcessor(m,d.isFragment,d.processingContext));const j=(null===(A=d.processor)||void 0===A?void 0:A.attributeKeywordName)??"attribute",q=d.isFragment&&null!==(b=d.processor)&&void 0!==b&&b.varyingFragmentKeywordName?null===(w=d.processor)||void 0===w?void 0:w.varyingFragmentKeywordName:!d.isFragment&&null!==(a=d.processor)&&void 0!==a&&a.varyingVertexKeywordName?null===(D=d.processor)||void 0===D?void 0:D.varyingVertexKeywordName:"varying";if(!d.isFragment&&M.attributeProcessor&&this.line.startsWith(j))m=M.attributeProcessor(this.line,h,d.processingContext);else if(M.varyingProcessor&&(null!==(S=M.varyingCheck)&&void 0!==S&&S.call(M,this.line,d.isFragment)||!M.varyingCheck&&this.line.startsWith(q)))m=M.varyingProcessor(this.line,d.isFragment,h,d.processingContext);else if(M.uniformProcessor&&M.uniformRegexp&&M.uniformRegexp.test(this.line))d.lookForClosingBracketForUniformBuffer||(m=M.uniformProcessor(this.line,d.isFragment,h,d.processingContext));else if(M.uniformBufferProcessor&&M.uniformBufferRegexp&&M.uniformBufferRegexp.test(this.line))d.lookForClosingBracketForUniformBuffer||(m=M.uniformBufferProcessor(this.line,d.isFragment,d.processingContext),d.lookForClosingBracketForUniformBuffer=!0);else if(M.textureProcessor&&M.textureRegexp&&M.textureRegexp.test(this.line))m=M.textureProcessor(this.line,d.isFragment,h,d.processingContext);else if((M.uniformProcessor||M.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!d.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?M.uniformProcessor&&(m=M.uniformProcessor(this.line,d.isFragment,h,d.processingContext)):M.uniformBufferProcessor&&(m=M.uniformBufferProcessor(this.line,d.isFragment,d.processingContext),d.lookForClosingBracketForUniformBuffer=!0)}d.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(d.lookForClosingBracketForUniformBuffer=!1,M.endOfUniformBufferProcessor&&(m=M.endOfUniformBufferProcessor(this.line,d.isFragment,d.processingContext)))}j+=m+"\n"}for(const M of this.children)j+=M.process(h,d,m);return this.additionalDefineKey&&(h[this.additionalDefineKey]=this.additionalDefineValue||"true",m[this.additionalDefineKey]=h[this.additionalDefineKey]),j}}class A{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(h){this._lines.length=0;for(const d of h){if(!d||"\r"===d)continue;if("#"===d[0]){this._lines.push(d);continue}const h=d.trim();if(!h)continue;if(h.startsWith("//")){this._lines.push(d);continue}const m=h.indexOf(";");if(-1===m)this._lines.push(h);else if(m===h.length-1)h.length>1&&this._lines.push(h);else{const h=d.split(";");for(let d=0;d<h.length;d++){let m=h[d];m&&(m=m.trim(),m&&this._lines.push(m+(d!==h.length-1?";":"")))}}}}}class b extends j{process(h,d,m){for(let j=0;j<this.children.length;j++){const A=this.children[j];if(A.isValid(h))return A.process(h,d,m)}return""}}class w extends j{isValid(h){return this.testExpression.isTrue(h)}}class a{isTrue(h){return!0}static postfixToInfix(h){const d=[];for(const m of h)if(void 0===a._OperatorPriority[m])d.push(m);else{const h=d[d.length-1],j=d[d.length-2];d.length-=2,d.push(`(${j}${m}${h})`)}return d[d.length-1]}static infixToPostfix(h){const d=a._InfixToPostfixCache.get(h);if(d)return d.accessTime=Date.now(),d.result;if(!h.includes("&&")&&!h.includes("||")&&!h.includes(")")&&!h.includes("("))return[h];const m=[];let j=-1;const A=()=>{M=M.trim(),""!==M&&(m.push(M),M="")},b=h=>{j<a._Stack.length-1&&(a._Stack[++j]=h)},w=()=>a._Stack[j],D=()=>-1===j?"!!INVALID EXPRESSION!!":a._Stack[j--];let S=0,M="";for(;S<h.length;){const d=h.charAt(S),q=S<h.length-1?h.substring(S,2+S):"";if("("===d)M="",b(d);else if(")"===d){for(A();-1!==j&&"("!==w();)m.push(D());D()}else if(a._OperatorPriority[q]>1){for(A();-1!==j&&a._OperatorPriority[w()]>=a._OperatorPriority[q];)m.push(D());b(q),S++}else M+=d;S++}for(A();-1!==j;)"("===w()?D():m.push(D());return a._InfixToPostfixCache.size>=a.InfixToPostfixCacheLimitSize&&a.ClearCache(),a._InfixToPostfixCache.set(h,{result:m,accessTime:Date.now()}),m}static ClearCache(){const h=Array.from(a._InfixToPostfixCache.entries()).sort(((h,d)=>h[1].accessTime-d[1].accessTime));for(let d=0;d<a.InfixToPostfixCacheCleanupSize;d++)a._InfixToPostfixCache.delete(h[d][0])}}a.InfixToPostfixCacheLimitSize=5e4,a.InfixToPostfixCacheCleanupSize=25e3,a._InfixToPostfixCache=new Map,a._OperatorPriority={")":0,"(":1,"||":2,"&&":3},a._Stack=["","","","","","","","","","","","","","","","","","","",""];class D extends a{constructor(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=h,this.not=d}isTrue(h){let d=void 0!==h[this.define];return this.not&&(d=!d),d}}class S extends a{isTrue(h){return this.leftOperand.isTrue(h)||this.rightOperand.isTrue(h)}}class M extends a{isTrue(h){return this.leftOperand.isTrue(h)&&this.rightOperand.isTrue(h)}}class q extends a{constructor(h,d,m){super(),this.define=h,this.operand=d,this.testValue=m}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(h){let d=!1;const m=parseInt(void 0!=h[this.define]?h[this.define]:this.define),j=parseInt(void 0!=h[this.testValue]?h[this.testValue]:this.testValue);if(isNaN(m)||isNaN(j))return!1;switch(this.operand){case">":d=m>j;break;case"<":d=m<j;break;case"<=":d=m<=j;break;case">=":d=m>=j;break;case"==":d=m===j;break;case"!=":d=m!==j}return d}}var E=m(11137),I=m(11175);const R=/defined\s*?\((.+?)\)/g,Z=/defined\s*?\[(.+?)\]/g,L=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,B=/__decl__/,V=/light\{X\}.(\w*)/g,v=/\{X\}/g,C=[],T=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function o(h){h.processor&&h.processor.initializeShaders&&h.processor.initializeShaders(h.processingContext)}function y(h,d,m,j){var A;null!==(A=d.processor)&&void 0!==A&&A.preProcessShaderCode&&(h=d.processor.preProcessShaderCode(h,d.isFragment)),l(h,d,(h=>{d.processCodeAfterIncludes&&(h=d.processCodeAfterIncludes(d.isFragment?"fragment":"vertex",h,d.defines));const A=function(h,d,m){let j=function(h,d){var m;if(null!==(m=d.processor)&&void 0!==m&&m.noPrecision)return h;const j=d.shouldUseHighPrecisionShader;-1===h.indexOf("precision highp float")?h=j?"precision highp float;\n"+h:"precision mediump float;\n"+h:j||(h=h.replace("precision highp float","precision mediump float"));return h}(h,d);if(!d.processor)return j;if(0===d.processor.shaderLanguage&&-1!==j.indexOf("#version 3")&&(j=j.replace("#version 300 es",""),!d.processor.parseGLES3))return j;const A=d.defines,b=k(d,m);d.processor.preProcessor&&(j=d.processor.preProcessor(j,A,b,d.isFragment,d.processingContext));const w={};j=c(j,b,d,w),d.processor.postProcessor&&(j=d.processor.postProcessor(j,A,d.isFragment,d.processingContext,m?{drawBuffersExtensionDisabled:!m.getCaps().drawBuffersExtension}:{},b,w));null!==m&&void 0!==m&&m._features.needShaderCodeInlining&&(j=m.inlineShaderCode(j));return j}(h,d,j);m(A,h)}))}function i(h,d,m){return m.processor&&m.processor.finalizeShaders?m.processor.finalizeShaders(h,d,m.processingContext):{vertexCode:h,fragmentCode:d}}function g(h){const d=/defined\((.+)\)/.exec(h);if(d&&d.length)return new D(d[1].trim(),"!"===h[0]);const m=["==","!=",">=","<=","<",">"];let j="",A=0;for(j of m)if(A=h.indexOf(j),A>-1)break;if(-1===A)return new D(h);const b=h.substring(0,A).trim(),w=h.substring(A+j.length).trim();return new q(b,j,w)}function F(h,d){const m=new w,j=h.substring(0,d);let A=h.substring(d);return A=A.substring(0,(A.indexOf("//")+1||A.length+1)-1).trim(),m.testExpression="#ifdef"===j?new D(A):"#ifndef"===j?new D(A,!0):function(h){h=h.replace(R,"defined[$1]");const d=a.infixToPostfix(h),m=[];for(const A of d)if("||"!==A&&"&&"!==A)m.push(A);else if(m.length>=2){let h=m[m.length-1],d=m[m.length-2];m.length-=2;const j="&&"==A?new M:new S;"string"===typeof h&&(h=h.replace(Z,"defined($1)")),"string"===typeof d&&(d=d.replace(Z,"defined($1)")),j.leftOperand="string"===typeof d?g(d):d,j.rightOperand="string"===typeof h?g(h):h,m.push(j)}let j=m[m.length-1];return"string"===typeof j&&(j=j.replace(Z,"defined($1)")),"string"===typeof j?g(j):j}(A),m}function f(h,d,m,A){let b=h.currentLine;for(;H(h,m,A);){b=h.currentLine;const w=b.substring(0,5).toLowerCase();if("#else"===w){const m=new j;return d.children.push(m),void H(h,m,A)}if("#elif"===w){const h=F(b,5);d.children.push(h),m=h}}}function H(h,d,m){for(;h.canRead;){h.lineIndex++;const A=h.currentLine;if(A.indexOf("#")>=0){const j=T.exec(A);if(j&&j.length){switch(j[0]){case"#ifdef":{const j=new b;d.children.push(j);const w=F(A,6);j.children.push(w),f(h,j,w,m);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const j=new b;d.children.push(j);const w=F(A,7);j.children.push(w),f(h,j,w,m);break}case"#if":{const j=new b,w=F(A,3);d.children.push(j),j.children.push(w),f(h,j,w,m);break}}continue}}const w=new j;if(w.line=A,d.children.push(w),"#"===A[0]&&"d"===A[1]){const h=A.replace(";","").split(" ");w.additionalDefineKey=h[1],3===h.length&&(w.additionalDefineValue=h[2])}}return!1}function c(h,d,m,b){const w=new j,a=new A;return a.lineIndex=-1,a.lines=h.split("\n"),H(a,w,b),w.process(d,m,b)}function k(h,d){var m;const j=h.defines,A={};for(const b of j){const h=b.replace("#define","").replace(";","").trim().split(" ");A[h[0]]=h.length>1?h[1]:""}return 0===(null===(m=h.processor)||void 0===m?void 0:m.shaderLanguage)&&(A.GL_ES="true"),A.__VERSION__=h.version,A[h.platformName]="true",(0,I.j)(A,null===d||void 0===d?void 0:d.isNDCHalfZRange,null===d||void 0===d?void 0:d.useReverseDepthBuffer,null===d||void 0===d?void 0:d.useExactSrgbConversions),A}function l(h,d,m){let j;for(C.length=0;null!==(j=L.exec(h));)C.push(j);let A=String(h),b=[h],w=!1;for(const a of C){let h=a[1];if(-1!==h.indexOf("__decl__")&&(h=h.replace(B,""),d.supportsUniformBuffers&&(h=h.replace("Vertex","Ubo").replace("Fragment","Ubo")),h+="Declaration"),!d.includesShadersStore[h]){const j=d.shadersRepository+"ShadersInclude/"+h+".fx";return void K.loadFile(j,(j=>{d.includesShadersStore[h]=j,l(b.join(""),d,m)}))}{let m=d.includesShadersStore[h];if(a[2]){const h=a[3].split(",");for(let d=0;d<h.length;d+=2){const j=new RegExp(h[d],"g"),A=h[d+1];m=m.replace(j,A)}}if(a[4]){const h=a[5];if(-1!==h.indexOf("..")){const j=h.split(".."),A=parseInt(j[0]);let b=parseInt(j[1]),w=m.slice(0);m="",isNaN(b)&&(b=d.indexParameters[j[1]]);for(let h=A;h<b;h++)d.supportsUniformBuffers||(w=w.replace(V,((h,d)=>d+"{X}"))),m+=w.replace(v,h.toString())+"\n"}else d.supportsUniformBuffers||(m=m.replace(V,((h,d)=>d+"{X}"))),m=m.replace(v,h)}const j=[];for(const h of b){const d=h.split(a[0]);for(let h=0;h<d.length-1;h++)j.push(d[h]),j.push(m);j.push(d[d.length-1])}b=j,w=w||m.indexOf("#include<")>=0||m.indexOf("#include <")>=0}}C.length=0,A=b.join(""),w?l(A.toString(),d,m):m(A)}const K={loadFile:(h,d,m,j,A,b)=>{throw(0,E.b)("FileTools")}}},11479:(h,d,m)=>{m.d(d,{e:()=>j});class j{get underlyingResource(){return this._webGLTexture}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=d,!h&&(h=d.createTexture(),!h))throw new Error("Unable to create webGL texture");this.set(h)}setUsage(){}set(h){this._webGLTexture=h}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(h){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(h)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const h of this._MSAARenderBuffers)this._context.deleteRenderbuffer(h);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var h;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(h=this._MSAARenderBuffers)||void 0===h?void 0:h[d])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},11175:(h,d,m)=>{m.d(d,{e:()=>A,i:()=>b,j:()=>a,l:()=>w,n:()=>D});var j=m(11137);m(11115);const A={};function b(h,d){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(d?d+"\n":"")+h}function w(h,d,m,b,w,a,D){const S=D||A.loadFile;if(S){return S(h,d,m,b,w,a)}throw(0,j.b)("FileTools")}function a(h,d,m,j){if(h)return d?h.IS_NDC_HALF_ZRANGE="":delete h.IS_NDC_HALF_ZRANGE,m?h.USE_REVERSE_DEPTHBUFFER="":delete h.USE_REVERSE_DEPTHBUFFER,void(j?h.USE_EXACT_SRGB_CONVERSIONS="":delete h.USE_EXACT_SRGB_CONVERSIONS);{let h="";return d&&(h+="#define IS_NDC_HALF_ZRANGE"),m&&(h&&(h+="\n"),h+="#define USE_REVERSE_DEPTHBUFFER"),j&&(h&&(h+="\n"),h+="#define USE_EXACT_SRGB_CONVERSIONS"),h}}function D(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0;switch(h){case 3:{const h=(ArrayBuffer,new Int8Array(d));return j&&h.set(new Int8Array(j)),h}case 0:{const h=(ArrayBuffer,new Uint8Array(d));return j&&h.set(new Uint8Array(j)),h}case 4:{const h=d instanceof ArrayBuffer?new Int16Array(d):new Int16Array(m?d/2:d);return j&&h.set(new Int16Array(j)),h}case 5:case 8:case 9:case 10:case 2:{const h=d instanceof ArrayBuffer?new Uint16Array(d):new Uint16Array(m?d/2:d);return j&&h.set(new Uint16Array(j)),h}case 6:{const h=d instanceof ArrayBuffer?new Int32Array(d):new Int32Array(m?d/4:d);return j&&h.set(new Int32Array(j)),h}case 7:case 11:case 12:case 13:case 14:case 15:{const h=d instanceof ArrayBuffer?new Uint32Array(d):new Uint32Array(m?d/4:d);return j&&h.set(new Uint32Array(j)),h}case 1:{const h=d instanceof ArrayBuffer?new Float32Array(d):new Float32Array(m?d/4:d);return j&&h.set(new Float32Array(j)),h}}const A=(ArrayBuffer,new Uint8Array(d));return j&&A.set(new Uint8Array(j)),A}},11188:(h,d,m)=>{m.d(d,{b:()=>v});var j=m(11094),A=m(11121),b=m(11196),w=m(11087),a=m(11132);class D{constructor(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,h&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(h){this._zOffset!==h&&(this._zOffset=h,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(h){this._zOffsetUnits!==h&&(this._zOffsetUnits=h,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(h){this._cullFace!==h&&(this._cullFace=h,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(h){this._cull!==h&&(this._cull=h,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(h){this._depthFunc!==h&&(this._depthFunc=h,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(h){this._depthMask!==h&&(this._depthMask=h,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(h){this._depthTest!==h&&(this._depthTest=h,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(h){this._frontFace!==h&&(this._frontFace=h,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(h){this.isDirty&&(this._isCullDirty&&(this.cull?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(h.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(h.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(h.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(h.enable(h.POLYGON_OFFSET_FILL),h.polygonOffset(this.zOffset,this.zOffsetUnits)):h.disable(h.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(h.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class S{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(h){this._func!==h&&(this._func=h,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(h){this._funcRef!==h&&(this._funcRef=h,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(h){this._funcMask!==h&&(this._funcMask=h,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(h){this._opStencilFail!==h&&(this._opStencilFail=h,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(h){this._opDepthFail!==h&&(this._opDepthFail=h,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(h){this._opStencilDepthPass!==h&&(this._opStencilDepthPass=h,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(h){this._mask!==h&&(this._mask=h,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(h){this._enabled!==h&&(this._enabled=h,this._isStencilTestDirty=!0)}constructor(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,h&&this.reset()}reset(){var h;this.stencilMaterial=void 0,null===(h=this.stencilGlobal)||void 0===h||h.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(h){var d;if(!h)return;const m=!this.useStencilGlobalOnly&&!(null===(d=this.stencilMaterial)||void 0===d||!d.enabled);this.enabled=m?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=m?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=m?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=m?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=m?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=m?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=m?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=m?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(h.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(h.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(h.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class M{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=M.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=M.KEEP,this.opDepthFail=M.KEEP,this.opStencilDepthPass=M.REPLACE}get stencilFunc(){return this.func}set stencilFunc(h){this.func=h}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(h){this.funcRef=h}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(h){this.funcMask=h}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(h){this.opStencilFail=h}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(h){this.opDepthFail=h}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(h){this.opStencilDepthPass=h}get stencilMask(){return this.mask}set stencilMask(h){this.mask=h}get stencilTest(){return this.enabled}set stencilTest(h){this.enabled=h}}M.ALWAYS=519,M.KEEP=7680,M.REPLACE=7681;class q{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(h){this._alphaBlend!==h&&(this._alphaBlend=h,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(h,d,m,j){this._blendConstants[0]===h&&this._blendConstants[1]===d&&this._blendConstants[2]===m&&this._blendConstants[3]===j||(this._blendConstants[0]=h,this._blendConstants[1]=d,this._blendConstants[2]=m,this._blendConstants[3]=j,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(h,d,m,j){this._blendFunctionParameters[0]===h&&this._blendFunctionParameters[1]===d&&this._blendFunctionParameters[2]===m&&this._blendFunctionParameters[3]===j||(this._blendFunctionParameters[0]=h,this._blendFunctionParameters[1]=d,this._blendFunctionParameters[2]=m,this._blendFunctionParameters[3]=j,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(h,d){this._blendEquationParameters[0]===h&&this._blendEquationParameters[1]===d||(this._blendEquationParameters[0]=h,this._blendEquationParameters[1]=d,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(h){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?h.enable(h.BLEND):h.disable(h.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(h.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(h.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(h.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var E=m(11137),I=m(11216),R=m(11115),Z=m(11097),L=m(11175),B=m(11229);function V(h,d){if((0,R.j)()){const{requestAnimationFrame:m}=d||window;if("function"===typeof m)return m(h)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(h);return setTimeout(h,16)}class v{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(h){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(h){h!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=h,this._depthCullingState.depthFunc=h?518:515)}setColorWrite(h){h!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=h)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(h){if(h)return this.isNDCHalfZRange?h.IS_NDC_HALF_ZRANGE="":delete h.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?h.USE_REVERSE_DEPTHBUFFER="":delete h.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?h.USE_EXACT_SRGB_CONVERSIONS="":delete h.USE_EXACT_SRGB_CONVERSIONS);{let h="";return this.isNDCHalfZRange&&(h+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(h&&(h+="\n"),h+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(h&&(h+="\n"),h+="#define USE_EXACT_SRGB_CONVERSIONS"),h}}_rebuildInternalTextures(){const h=this._internalTexturesCache.slice();for(const d of h)d._rebuild()}_rebuildRenderTargetWrappers(){const h=this._renderTargetWrapperCache.slice();for(const d of h)d._rebuild()}_rebuildEffects(){for(const h in this._compiledEffects){const d=this._compiledEffects[h];d._pipelineContext=null,d._prepareEffect()}b.e.ResetCache()}_rebuildGraphicsResources(){var h;this.wipeCaches(!0),this._rebuildEffects(),null===(h=this._rebuildComputeEffects)||void 0===h||h.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){A.c.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(h){setTimeout((()=>{this._clearEmptyResources();const d=this._depthCullingState.depthTest,m=this._depthCullingState.depthFunc,j=this._depthCullingState.depthMask,A=this._stencilState.stencilTest;h(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=d,this._depthCullingState.depthFunc=m,this._depthCullingState.depthMask=j,this._stencilState.stencilTest=A,this._flagContextRestored()}),0)}get q(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(h){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(h){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const h=new Uint8Array(4),d=[h,h,h,h,h,h];this._emptyCubeTexture=this.createRawCubeTexture(d,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(h){if(!h)return this._activeRenderLoops.length=0,void this._cancelFrame();const d=this._activeRenderLoops.indexOf(h);d>=0&&(this._activeRenderLoops.splice(d,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const h=this._frameHandler;if(this._frameHandler=0,(0,R.j)()){const{cancelAnimationFrame:d}=this.getHostWindow()||window;if("function"===typeof d)return d(h)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(h);return clearTimeout(h)}}uq(){this.onBeginFrameObservable.notifyObservers(this)}Pq(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(h){this._maxFPS=h,void 0!==h&&(this._minFrameTime=h<=0?Number.MAX_VALUE:1e3/h)}_isOverFrameTime(h){if(!h||void 0===this._maxFPS)return!1;const d=h-this._lastFrameTime;return this._lastFrameTime=h,this._renderAccumulator+=d,this._renderAccumulator<this._minFrameTime||(this._renderAccumulator-=this._minFrameTime,this._renderAccumulator>this._minFrameTime&&(this._renderAccumulator=this._minFrameTime),!1)}_processFrame(h){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(h)){let h=!0;(this.q||!this.renderEvenInBackground&&this._windowIsBackground)&&(h=!1),h&&(this.uq(),this.skipFrameRender||this._renderViews()||this._renderFrame(),this.Pq())}}_renderLoop(h){this._processFrame(h),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let h=0;h<this._activeRenderLoops.length;h++){(0,this._activeRenderLoops[h])()}}_renderViews(){return!1}_queueNewFrame(h,d){return V(h,d)}runRenderLoop(h){-1===this._activeRenderLoops.indexOf(h)&&(this._activeRenderLoops.push(h),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(h){this._depthCullingState.depthTest=h}setZOffset(h){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-h:h}getZOffset(){const h=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-h:h}setZOffsetUnits(h){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-h:h}getZOffsetUnits(){const h=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-h:h}getHostWindow(){return(0,R.j)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(h){this._compatibilityMode=!0}_rebuildTextures(){for(const h of this.scenes)h._rebuildTextures();for(const h of this._virtualScenes)h._rebuildTextures()}_releaseRenderTargetWrapper(h){const d=this._renderTargetWrapperCache.indexOf(h);-1!==d&&this._renderTargetWrapperCache.splice(d,1)}get currentViewport(){return this._cachedViewport}setViewport(h,d,m){const j=d||this.getRenderWidth(),A=m||this.getRenderHeight(),b=h.x||0,w=h.y||0;this._cachedViewport=h,this._viewport(b*j,w*A,j*h.width,A*h.height)}createCanvasImage(){return document.createElement("img")}createCanvasPath2D(h){return new Path2D(h)}get description(){let h=this.name+this.version;return this._caps.parallelShaderCompile&&(h+=" - Parallel shader compilation"),h}_createTextureBase(h,d,m,b){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7?arguments[7]:void 0,M=arguments.length>8?arguments[8]:void 0,q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,E=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,R=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,Z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,L=arguments.length>13?arguments[13]:void 0,V=arguments.length>14?arguments[14]:void 0,C=arguments.length>15?arguments[15]:void 0;const T="data:"===(h=h||"").substring(0,5),o="blob:"===h.substring(0,5),y=T&&-1!==h.indexOf(";base64,"),i=E||new I.c(this,1);i!==E&&(i.label=h.substring(0,60));const g=h;!this._transformTextureUrl||y||E||q||(h=this._transformTextureUrl(h)),g!==h&&(i._originalUrl=g);const F=h.lastIndexOf(".");let f=Z||(F>-1?h.substring(F).toLowerCase():"");f.indexOf("?")>-1&&(f=f.split("?")[0]);const H=(0,B.c)(f,L);b&&b.addPendingData(i),i.url=h,i.generateMipMaps=!d,i.samplingMode=w,i.invertY=m,i._useSRGBBuffer=this._getUseSRGBBuffer(!!C,d),this._doNotHandleContextLost||(i._buffer=q);let c=null;a&&!E&&(c=i.onLoadedObservable.add(a)),E||this._internalTexturesCache.push(i);const k=(m,E)=>{b&&b.removePendingData(i),h===g?(c&&i.onLoadedObservable.remove(c),j.b.UseFallbackTexture&&h!==j.b.FallbackTexture&&this._createTextureBase(j.b.FallbackTexture,d,i.invertY,b,w,null,D,S,M,q,i),m=(m||"Unknown error")+(j.b.UseFallbackTexture?" - Fallback texture was used":""),i.onErrorObservable.notifyObservers({message:m,exception:E}),D&&D(m,E)):(A.c.Warn(`Failed to load ${h}, falling back to ${g}`),this._createTextureBase(g,d,i.invertY,b,w,a,D,S,M,q,i,R,Z,L,V,C))};if(H){const d=async h=>{(await H).loadData(h,i,((h,d,m,j,A,a)=>{a?k("TextureLoader failed to load data"):S(i,f,b,{width:h,height:d},i.invertY,!m,j,(()=>(A(),!1)),w)}),V)};q?q instanceof ArrayBuffer?d(new Uint8Array(q)):ArrayBuffer.isView(q)?d(q):D&&D("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(h,(h=>{d(new Uint8Array(h))}),void 0,b?b.offlineProvider:void 0,!0,((h,d)=>{k("Unable to load "+(h&&h.responseURL,d))}))}else{const m=h=>{o&&!this._doNotHandleContextLost&&(i._buffer=h),S(i,f,b,h,i.invertY,d,!1,M,w)};!T||y?q&&("string"===typeof q.decoding||q.close)?m(q):v._FileToolsLoadImage(h||"",m,k,b?b.offlineProvider:null,L,i.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):"string"===typeof q||q instanceof ArrayBuffer||ArrayBuffer.isView(q)||q instanceof Blob?v._FileToolsLoadImage(q,m,k,b?b.offlineProvider:null,L,i.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):q&&m(q)}return i}_rebuildBuffers(){for(const h of this._uniformBuffers)h._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,R.f)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const h in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,h)&&(this._boundTexturesCache[h]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(h){this._name=h}static get NpmPackage(){return"babylonjs@8.13.0"}static get Version(){return"8.13.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(h){this._hardwareScalingLevel=h,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(h){this._doNotHandleContextLost=h}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(h,d,m){var A,b;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new D,this._stencilStateComposer=new S,this._stencilState=new M,this._alphaState=new q,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new Z.e,this.onCanvasFocusObservable=new Z.e,this.onNewSceneAddedObservable=new Z.e,this.onResizeObservable=new Z.e,this.onCanvasPointerOutObservable=new Z.e,this.onEffectErrorObservable=new Z.e,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new Z.e,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=h=>this._renderLoop(h),this._lastFrameTime=0,this._renderAccumulator=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new Z.e,this.onAfterShaderCompilationObservable=new Z.e,this.onBeginFrameObservable=new Z.e,this.onEndFrameObservable=new Z.e,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new Z.e,this.onContextRestoredObservable=new Z.e,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.pd=new Z.e,this.onReleaseEffectsObservable=new Z.e,j.b.Instances.push(this),this.startTime=a.b.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,w.d.SetMatrixPrecision(!!d.useHighPrecisionMatrix),(0,R.h)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=m??!1,d.antialias=h??d.antialias,d.deterministicLockstep=d.deterministicLockstep??!1,d.lockstepMaxSteps=d.lockstepMaxSteps??4,d.timeStep=d.timeStep??1/60,d.stencil=d.stencil??!0,this._audioContext=(null===(A=d.audioEngineOptions)||void 0===A?void 0:A.audioContext)??null,this._audioDestination=(null===(b=d.audioEngineOptions)||void 0===b?void 0:b.audioDestination)??null,this.premultipliedAlpha=d.premultipliedAlpha??!0,this._doNotHandleContextLost=!!d.doNotHandleContextLost,this._isStencilEnable=!!d.stencil,this.useExactSrgbConversions=d.useExactSrgbConversions??!1;const E=(0,R.j)()&&window.devicePixelRatio||1,I=d.limitDeviceRatio||E;m=m||d.adaptToDeviceRatio||!1,this._hardwareScalingLevel=m?1/Math.min(I,E):1,this._lastDevicePixelRatio=E,this._creationOptions=d}resize(){let h,d,m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const h=(0,R.j)()&&window.devicePixelRatio||1,d=this._lastDevicePixelRatio/h;this._lastDevicePixelRatio=h,this._hardwareScalingLevel*=d}if((0,R.j)()&&(0,R.f)())if(this._renderingCanvas){var j,A;const m=null===(j=(A=this._renderingCanvas).getBoundingClientRect)||void 0===j?void 0:j.call(A);h=this._renderingCanvas.clientWidth||(null===m||void 0===m?void 0:m.width)||this._renderingCanvas.width*this._hardwareScalingLevel||100,d=this._renderingCanvas.clientHeight||(null===m||void 0===m?void 0:m.height)||this._renderingCanvas.height*this._hardwareScalingLevel||100}else h=window.innerWidth,d=window.innerHeight;else h=this._renderingCanvas?this._renderingCanvas.width:100,d=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(h/this._hardwareScalingLevel,d/this._hardwareScalingLevel,m)}setSize(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(h|=0,d|=0,!m&&this._renderingCanvas.width===h&&this._renderingCanvas.height===d)return!1;if(this._renderingCanvas.width=h,this._renderingCanvas.height=d,this.scenes){for(let h=0;h<this.scenes.length;h++){const d=this.scenes[h];for(let h=0;h<d.cameras.length;h++){d.cameras[h]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(h,d,m,j,A,b,w,a,D,S,M){throw(0,E.b)("engine.rawTexture")}createRawCubeTexture(h,d,m,j,A,b,w,a){throw(0,E.b)("engine.rawTexture")}createRawTexture3D(h,d,m,j,A,b,w,a,D,S,M){throw(0,E.b)("engine.rawTexture")}createRawTexture2DArray(h,d,m,j,A,b,w,a,D,S,M){throw(0,E.b)("engine.rawTexture")}_sharedInit(h){this._renderingCanvas=h}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const h=navigator.userAgent;this.hostInformation.isMobile=-1!==h.indexOf("Mobile")||-1!==h.indexOf("Mac")&&(0,R.f)()&&"ontouchend"in document},this._checkForMobile(),(0,R.j)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(h){return document.createElement("video")}_reportDrawCall(){var h;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(h=this._drawCalls)||void 0===h||h.addCount(d,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(h,d){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(h,d){return createImageBitmap(h,d)}resizeImageBitmap(h,d,m){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(h){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(h,d){if("undefined"===typeof document)return new OffscreenCanvas(h,d);const m=document.createElement("canvas");return m.width=h,m.height=d,m}createCanvas(h,d){return v._CreateCanvas(h,d)}static _FileToolsLoadImage(h,d,m,j,A,b,w){throw(0,E.b)("FileTools")}_loadFile(h,d,m,j,A,b){const w=(0,L.l)(h,d,m,j,A,b);return this._activeRequests.push(w),w.onCompleteObservable.add((()=>{const h=this._activeRequests.indexOf(w);-1!==h&&this._activeRequests.splice(h,1)})),w}static _FileToolsLoadFile(h,d,m,j,A,b){if(L.e.loadFile)return L.e.loadFile(h,d,m,j,A,b);throw(0,E.b)("FileTools")}dispose(){var h;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(h=this.releaseComputeEffects)||void 0===h||h.call(this),b.e.ResetCache();for(const m of this._activeRequests)m.abort();this._boundRenderFunction=null,this.pd.notifyObservers(this),this.pd.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),(0,R.j)()&&window.removeEventListener("resize",this._checkForMobile);const d=j.b.Instances.indexOf(this);d>=0&&j.b.Instances.splice(d,1),j.b.Instances.length||(j.b.OnEnginesDisposedObservable.notifyObservers(this),j.b.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(h){throw(0,E.b)("LoadingScreen")}static MarkAllMaterialsAsDirty(h,d){for(let m=0;m<j.b.Instances.length;m++){const A=j.b.Instances[m];for(let m=0;m<A.scenes.length;m++)A.scenes[m].markAllMaterialsAsDirty(h,d)}}}v._RenderPassIdCounter=0,v._RescalePostProcessFactory=null,v.CollisionsEpsilon=.001,v.QueueNewFrame=V},11578:(h,d,m)=>{m.d(d,{c:()=>j});class j{}j.AUTOSAMPLERSUFFIX="Sampler",j.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",j.ALPHA_DISABLE=0,j.ALPHA_ADD=1,j.ALPHA_COMBINE=2,j.ALPHA_SUBTRACT=3,j.ALPHA_MULTIPLY=4,j.ALPHA_MAXIMIZED=5,j.ALPHA_ONEONE=6,j.ALPHA_PREMULTIPLIED=7,j.ALPHA_PREMULTIPLIED_PORTERDUFF=8,j.ALPHA_INTERPOLATE=9,j.ALPHA_SCREENMODE=10,j.ALPHA_ONEONE_ONEONE=11,j.ALPHA_ALPHATOCOLOR=12,j.ALPHA_REVERSEONEMINUS=13,j.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,j.ALPHA_ONEONE_ONEZERO=15,j.ALPHA_EXCLUSION=16,j.ALPHA_LAYER_ACCUMULATE=17,j.ALPHA_EQUATION_ADD=0,j.ALPHA_EQUATION_SUBSTRACT=1,j.ALPHA_EQUATION_REVERSE_SUBTRACT=2,j.ALPHA_EQUATION_MAX=3,j.ALPHA_EQUATION_MIN=4,j.ALPHA_EQUATION_DARKEN=5,j.DELAYLOADSTATE_NONE=0,j.DELAYLOADSTATE_LOADED=1,j.DELAYLOADSTATE_LOADING=2,j.DELAYLOADSTATE_NOTLOADED=4,j.NEVER=512,j.ALWAYS=519,j.LESS=513,j.EQUAL=514,j.LEQUAL=515,j.GREATER=516,j.GEQUAL=518,j.NOTEQUAL=517,j.KEEP=7680,j.ZERO=0,j.REPLACE=7681,j.INCR=7682,j.DECR=7683,j.INVERT=5386,j.INCR_WRAP=34055,j.DECR_WRAP=34056,j.TEXTURE_CLAMP_ADDRESSMODE=0,j.TEXTURE_WRAP_ADDRESSMODE=1,j.TEXTURE_MIRROR_ADDRESSMODE=2,j.TEXTURE_CREATIONFLAG_STORAGE=1,j.TEXTUREFORMAT_ALPHA=0,j.TEXTUREFORMAT_LUMINANCE=1,j.TEXTUREFORMAT_LUMINANCE_ALPHA=2,j.TEXTUREFORMAT_RGB=4,j.TEXTUREFORMAT_RGBA=5,j.TEXTUREFORMAT_RED=6,j.TEXTUREFORMAT_R=6,j.TEXTUREFORMAT_R16_UNORM=33322,j.TEXTUREFORMAT_RG16_UNORM=33324,j.TEXTUREFORMAT_RGB16_UNORM=32852,j.TEXTUREFORMAT_RGBA16_UNORM=32859,j.TEXTUREFORMAT_R16_SNORM=36760,j.TEXTUREFORMAT_RG16_SNORM=36761,j.TEXTUREFORMAT_RGB16_SNORM=36762,j.TEXTUREFORMAT_RGBA16_SNORM=36763,j.TEXTUREFORMAT_RG=7,j.TEXTUREFORMAT_RED_INTEGER=8,j.TEXTUREFORMAT_R_INTEGER=8,j.TEXTUREFORMAT_RG_INTEGER=9,j.TEXTUREFORMAT_RGB_INTEGER=10,j.TEXTUREFORMAT_RGBA_INTEGER=11,j.TEXTUREFORMAT_BGRA=12,j.TEXTUREFORMAT_DEPTH24_STENCIL8=13,j.TEXTUREFORMAT_DEPTH32_FLOAT=14,j.TEXTUREFORMAT_DEPTH16=15,j.TEXTUREFORMAT_DEPTH24=16,j.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,j.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,j.TEXTUREFORMAT_STENCIL8=19,j.TEXTUREFORMAT_UNDEFINED=4294967295,j.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,j.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,j.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,j.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,j.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,j.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,j.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,j.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,j.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,j.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,j.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,j.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,j.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,j.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,j.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,j.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,j.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,j.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,j.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,j.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,j.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,j.TEXTURETYPE_UNSIGNED_BYTE=0,j.TEXTURETYPE_UNSIGNED_INT=0,j.TEXTURETYPE_FLOAT=1,j.TEXTURETYPE_HALF_FLOAT=2,j.TEXTURETYPE_BYTE=3,j.TEXTURETYPE_SHORT=4,j.TEXTURETYPE_UNSIGNED_SHORT=5,j.TEXTURETYPE_INT=6,j.TEXTURETYPE_UNSIGNED_INTEGER=7,j.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,j.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,j.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,j.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,j.TEXTURETYPE_UNSIGNED_INT_24_8=12,j.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,j.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,j.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,j.TEXTURETYPE_UNDEFINED=16,j.TEXTURE_2D=3553,j.TEXTURE_2D_ARRAY=35866,j.TEXTURE_CUBE_MAP=34067,j.TEXTURE_CUBE_MAP_ARRAY=3735928559,j.TEXTURE_3D=32879,j.TEXTURE_NEAREST_SAMPLINGMODE=1,j.TEXTURE_NEAREST_NEAREST=1,j.TEXTURE_BILINEAR_SAMPLINGMODE=2,j.TEXTURE_LINEAR_LINEAR=2,j.TEXTURE_TRILINEAR_SAMPLINGMODE=3,j.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,j.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,j.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,j.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,j.TEXTURE_NEAREST_LINEAR=7,j.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,j.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,j.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,j.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,j.TEXTURE_LINEAR_NEAREST=12,j.TEXTURE_EXPLICIT_MODE=0,j.TEXTURE_SPHERICAL_MODE=1,j.TEXTURE_PLANAR_MODE=2,j.TEXTURE_CUBIC_MODE=3,j.TEXTURE_PROJECTION_MODE=4,j.TEXTURE_SKYBOX_MODE=5,j.TEXTURE_INVCUBIC_MODE=6,j.TEXTURE_EQUIRECTANGULAR_MODE=7,j.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,j.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,j.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,j.TEXTURE_FILTERING_QUALITY_HIGH=64,j.TEXTURE_FILTERING_QUALITY_MEDIUM=16,j.TEXTURE_FILTERING_QUALITY_LOW=8,j.SCALEMODE_FLOOR=1,j.SCALEMODE_NEAREST=2,j.SCALEMODE_CEILING=3,j.MATERIAL_TextureDirtyFlag=1,j.MATERIAL_LightDirtyFlag=2,j.MATERIAL_FresnelDirtyFlag=4,j.MATERIAL_AttributesDirtyFlag=8,j.MATERIAL_MiscDirtyFlag=16,j.MATERIAL_PrePassDirtyFlag=32,j.MATERIAL_ImageProcessingDirtyFlag=64,j.MATERIAL_AllDirtyFlag=127,j.MATERIAL_TriangleFillMode=0,j.MATERIAL_WireFrameFillMode=1,j.MATERIAL_PointFillMode=2,j.MATERIAL_PointListDrawMode=3,j.MATERIAL_LineListDrawMode=4,j.MATERIAL_LineLoopDrawMode=5,j.MATERIAL_LineStripDrawMode=6,j.MATERIAL_TriangleStripDrawMode=7,j.MATERIAL_TriangleFanDrawMode=8,j.MATERIAL_ClockWiseSideOrientation=0,j.MATERIAL_CounterClockWiseSideOrientation=1,j.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,j.MATERIAL_DIFFUSE_MODEL_BURLEY=1,j.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,j.MATERIAL_DIFFUSE_MODEL_LEGACY=3,j.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,j.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,j.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,j.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,j.ACTION_NothingTrigger=0,j.ACTION_OnPickTrigger=1,j.ACTION_OnLeftPickTrigger=2,j.ACTION_OnRightPickTrigger=3,j.ACTION_OnCenterPickTrigger=4,j.ACTION_OnPickDownTrigger=5,j.ACTION_OnDoublePickTrigger=6,j.ACTION_OnPickUpTrigger=7,j.ACTION_OnPickOutTrigger=16,j.ACTION_OnLongPressTrigger=8,j.ACTION_OnPointerOverTrigger=9,j.ACTION_OnPointerOutTrigger=10,j.ACTION_OnEveryFrameTrigger=11,j.ACTION_OnIntersectionEnterTrigger=12,j.ACTION_OnIntersectionExitTrigger=13,j.ACTION_OnKeyDownTrigger=14,j.ACTION_OnKeyUpTrigger=15,j.PARTICLES_BILLBOARDMODE_Y=2,j.PARTICLES_BILLBOARDMODE_ALL=7,j.PARTICLES_BILLBOARDMODE_STRETCHED=8,j.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,j.MESHES_CULLINGSTRATEGY_STANDARD=0,j.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,j.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,j.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,j.SCENELOADER_NO_LOGGING=0,j.SCENELOADER_MINIMAL_LOGGING=1,j.SCENELOADER_SUMMARY_LOGGING=2,j.SCENELOADER_DETAILED_LOGGING=3,j.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,j.PREPASS_POSITION_TEXTURE_TYPE=1,j.PREPASS_VELOCITY_TEXTURE_TYPE=2,j.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,j.PREPASS_COLOR_TEXTURE_TYPE=4,j.PREPASS_DEPTH_TEXTURE_TYPE=5,j.PREPASS_NORMAL_TEXTURE_TYPE=6,j.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,j.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,j.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,j.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,j.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,j.PREPASS_ALBEDO_TEXTURE_TYPE=12,j.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,j.BUFFER_CREATIONFLAG_READ=1,j.BUFFER_CREATIONFLAG_WRITE=2,j.BUFFER_CREATIONFLAG_READWRITE=3,j.BUFFER_CREATIONFLAG_UNIFORM=4,j.BUFFER_CREATIONFLAG_VERTEX=8,j.BUFFER_CREATIONFLAG_INDEX=16,j.BUFFER_CREATIONFLAG_STORAGE=32,j.BUFFER_CREATIONFLAG_INDIRECT=64,j.RENDERPASS_MAIN=0,j.INPUT_ALT_KEY=18,j.INPUT_CTRL_KEY=17,j.INPUT_META_KEY1=91,j.INPUT_META_KEY2=92,j.INPUT_META_KEY3=93,j.INPUT_SHIFT_KEY=16,j.SNAPSHOTRENDERING_STANDARD=0,j.SNAPSHOTRENDERING_FAST=1,j.PERSPECTIVE_CAMERA=0,j.ORTHOGRAPHIC_CAMERA=1,j.FOVMODE_VERTICAL_FIXED=0,j.FOVMODE_HORIZONTAL_FIXED=1,j.RIG_MODE_NONE=0,j.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,j.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,j.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,j.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,j.RIG_MODE_STEREOSCOPIC_INTERLACED=14,j.RIG_MODE_VR=20,j.RIG_MODE_CUSTOM=22,j.MAX_SUPPORTED_UV_SETS=6,j.GL_ALPHA_EQUATION_ADD=32774,j.GL_ALPHA_EQUATION_MIN=32775,j.GL_ALPHA_EQUATION_MAX=32776,j.GL_ALPHA_EQUATION_SUBTRACT=32778,j.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,j.GL_ALPHA_FUNCTION_SRC=768,j.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,j.GL_ALPHA_FUNCTION_SRC_ALPHA=770,j.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,j.GL_ALPHA_FUNCTION_DST_ALPHA=772,j.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,j.GL_ALPHA_FUNCTION_DST_COLOR=774,j.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,j.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,j.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,j.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,j.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,j.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,j.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,j.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,j.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,j.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,j.SnippetUrl="https://snippet.babylonjs.com",j.FOGMODE_NONE=0,j.FOGMODE_EXP=1,j.FOGMODE_EXP2=2,j.FOGMODE_LINEAR=3,j.BYTE=5120,j.UNSIGNED_BYTE=5121,j.SHORT=5122,j.UNSIGNED_SHORT=5123,j.INT=5124,j.UNSIGNED_INT=5125,j.FLOAT=5126,j.PositionKind="position",j.NormalKind="Dd",j.TangentKind="tangent",j.UVKind="uv",j.UV2Kind="uv2",j.UV3Kind="uv3",j.UV4Kind="uv4",j.UV5Kind="uv5",j.UV6Kind="uv6",j.ColorKind="color",j.ColorInstanceKind="instanceColor",j.MatricesIndicesKind="matricesIndices",j.MatricesWeightsKind="matricesWeights",j.MatricesIndicesExtraKind="matricesIndicesExtra",j.MatricesWeightsExtraKind="matricesWeightsExtra",j.ANIMATIONTYPE_FLOAT=0,j.ANIMATIONTYPE_VECTOR3=1,j.ANIMATIONTYPE_QUATERNION=2,j.ANIMATIONTYPE_MATRIX=3,j.ANIMATIONTYPE_COLOR3=4,j.ANIMATIONTYPE_COLOR4=7,j.ANIMATIONTYPE_VECTOR2=5,j.ANIMATIONTYPE_SIZE=6,j.ShadowMinZ=0,j.ShadowMaxZ=1e4},11463:(h,d,m)=>{m.d(d,{b:()=>i});var j=m(11216),A=m(11094),b=m(11470),w=m(11132);class a{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new D(h)}sampleFrame(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.b.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const d=h-this._lastFrameTimeMs;this._rollingFrameTime.add(d)}this._lastFrameTimeMs=h}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const h=this._rollingFrameTime.history(0);return 0===h?0:1e3/h}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class D{constructor(h){this._samples=new Array(h),this.reset()}add(h){let d;if(this.isSaturated()){const h=this._samples[this._pos];d=h-this.average,this.average-=d/(this._sampleCount-1),this._m2-=d*(h-this.average)}else this._sampleCount++;d=h-this.average,this.average+=d/this._sampleCount,this._m2+=d*(h-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=h,this._pos++,this._pos%=this._samples.length}history(h){if(h>=this._sampleCount||h>=this._samples.length)return 0;const d=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(d-h)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(h){const d=this._samples.length;return(h%d+d)%d}}var S=m(11477),M=m(11121),q=m(11479),E=(m(11491),m(11248));function I(h,d,m,j){let A,b=1;1===j?A=new Float32Array(d*m*4):2===j?(A=new Uint16Array(d*m*4),b=15360):A=7===j?new Uint32Array(d*m*4):new Uint8Array(d*m*4);for(let w=0;w<d;w++)for(let j=0;j<m;j++){const m=3*(j*d+w),a=4*(j*d+w);A[a+0]=h[m+0],A[a+1]=h[m+1],A[a+2]=h[m+2],A[a+3]=b}return A}function R(h){return function(d,m,A,b,w,a,D,S){let M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const E=h?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,I=h?10:11,R=new j.c(this,I);R.baseWidth=m,R.baseHeight=A,R.baseDepth=b,R.width=m,R.height=A,R.depth=b,R.format=w,R.type=q,R.generateMipMaps=a,R.samplingMode=S,h?R.is3D=!0:R.is2DArray=!0,this._doNotHandleContextLost||(R._bufferView=d),h?this.updateRawTexture3D(R,d,w,D,M,q):this.updateRawTexture2DArray(R,d,w,D,M,q),this._bindTextureDirectly(E,R,!0);const Z=this._getSamplingParameters(S,a);return this._gl.texParameteri(E,this._gl.TEXTURE_MAG_FILTER,Z.mag),this._gl.texParameteri(E,this._gl.TEXTURE_MIN_FILTER,Z.min),a&&this._gl.generateMipmap(E),this._bindTextureDirectly(E,null),this._internalTexturesCache.push(R),R}}function Z(h){return function(d,m,j,A){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const a=h?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,D=this._getWebGLTextureType(w),S=this._getInternalFormat(j),M=this._getRGBABufferInternalSizedFormat(w,j);this._bindTextureDirectly(a,d,!0),this._unpackFlipY(void 0===A||!!A),this._doNotHandleContextLost||(d._bufferView=m,d.format=j,d.invertY=A,d._compression=b),d.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),b&&m?this._gl.compressedTexImage3D(a,0,this.getCaps().s3tc[b],d.width,d.height,d.depth,0,m):this._gl.texImage3D(a,0,M,d.width,d.height,d.depth,0,S,D,m),d.generateMipMaps&&this._gl.generateMipmap(a),this._bindTextureDirectly(a,null),d.isReady=!0}}b.ThinEngine.prototype.updateRawTexture=function(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!h)return;const a=this._getRGBABufferInternalSizedFormat(b,m,w),D=this._getInternalFormat(m),S=this._getWebGLTextureType(b);this._bindTextureDirectly(this._gl.TEXTURE_2D,h,!0),this._unpackFlipY(void 0===j||!!j),this._doNotHandleContextLost||(h._bufferView=d,h.format=m,h.type=b,h.invertY=j,h._compression=A),h.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),A&&d?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[A],h.width,h.height,0,d):this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,h.width,h.height,0,D,S,d),h.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),h.isReady=!0},b.ThinEngine.prototype.createRawTexture=function(h,d,m,A,b,w,a){let D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,M=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const q=new j.c(this,3);q.baseWidth=d,q.baseHeight=m,q.width=d,q.height=m,q.format=A,q.generateMipMaps=b,q.samplingMode=a,q.invertY=w,q._compression=D,q.type=S,q._useSRGBBuffer=this._getUseSRGBBuffer(M,!b),this._doNotHandleContextLost||(q._bufferView=h),this.updateRawTexture(q,h,A,w,D,S,q._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,q,!0);const E=this._getSamplingParameters(a,b);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,E.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,E.min),b&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(q),q},b.ThinEngine.prototype.createRawCubeTexture=function(h,d,m,A,b,w,a){let D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const S=this._gl,q=new j.c(this,8);q.isCube=!0,q.format=m,q.type=A,this._doNotHandleContextLost||(q._bufferViewArray=h);const I=this._getWebGLTextureType(A);let R=this._getInternalFormat(m);R===S.RGB&&(R=S.RGBA),I!==S.FLOAT||this._caps.textureFloatLinearFiltering?I!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?I!==S.FLOAT||this._caps.textureFloatRender?I!==S.HALF_FLOAT||this._caps.colorBufferFloat||(b=!1,M.c.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(b=!1,M.c.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(b=!1,a=1,M.c.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(b=!1,a=1,M.c.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const Z=d,L=Z;q.width=Z,q.height=L,q.invertY=w,q._compression=D;if(!this.needPOTTextures||(0,E.g)(q.width)&&(0,E.g)(q.height)||(b=!1),h)this.updateRawCubeTexture(q,h,m,A,w,D);else{const h=this._getRGBABufferInternalSizedFormat(A),d=0;this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,q,!0);for(let m=0;m<6;m++)D?S.compressedTexImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+m,d,this.getCaps().s3tc[D],q.width,q.height,0,void 0):S.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+m,d,h,q.width,q.height,0,R,I,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,q,!0),h&&b&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const B=this._getSamplingParameters(a,b);return S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MAG_FILTER,B.mag),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MIN_FILTER,B.min),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,null),q.generateMipMaps=b,q.samplingMode=a,q.isReady=!0,q},b.ThinEngine.prototype.updateRawCubeTexture=function(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;h._bufferViewArray=d,h.format=m,h.type=j,h.invertY=A,h._compression=b;const a=this._gl,D=this._getWebGLTextureType(j);let S=this._getInternalFormat(m);const M=this._getRGBABufferInternalSizedFormat(j);let q=!1;S===a.RGB&&(S=a.RGBA,q=!0),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,h,!0),this._unpackFlipY(void 0===A||!!A),h.width%4!==0&&a.pixelStorei(a.UNPACK_ALIGNMENT,1);for(let E=0;E<6;E++){let m=d[E];b?a.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+E,w,this.getCaps().s3tc[b],h.width,h.height,0,m):(q&&(m=I(m,h.width,h.height,j)),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+E,w,M,h.width,h.height,0,S,D,m))}(!this.needPOTTextures||(0,E.g)(h.width)&&(0,E.g)(h.height))&&h.generateMipMaps&&0===w&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),h.isReady=!0},b.ThinEngine.prototype.createRawCubeTextureFromUrl=function(h,d,m,j,A,b,w,a){let D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,M=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,q=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const E=this._gl,R=this.createRawCubeTexture(null,m,j,A,!b,q,M,null);null===d||void 0===d||d.addPendingData(R),R.url=h,R.isReady=!1,this._internalTexturesCache.push(R);const Z=h=>{if(!R._hardwareTexture)return;const m=R.width,b=w(h);if(b){if(a){const h=this._getWebGLTextureType(A);let d=this._getInternalFormat(j);const w=this._getRGBABufferInternalSizedFormat(A);let D=!1;d===E.RGB&&(d=E.RGBA,D=!0),this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,R,!0),this._unpackFlipY(!1);const S=a(b);for(let j=0;j<S.length;j++){const b=m>>j;for(let m=0;m<6;m++){let a=S[j][m];D&&(a=I(a,b,b,A)),E.texImage2D(m,j,w,b,b,0,d,h,a)}}this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(R,b,j,A,q);R.isReady=!0,null===d||void 0===d||d.removePendingData(R),R.onLoadedObservable.notifyObservers(R),R.onLoadedObservable.clear(),D&&D()}};return this._loadFile(h,(h=>{Z(h)}),void 0,null===d||void 0===d?void 0:d.offlineProvider,!0,((h,m)=>{null===d||void 0===d||d.removePendingData(R),S&&h&&S(h.status+" "+h.statusText,m)})),R},b.ThinEngine.prototype.createRawTexture2DArray=R(!1),b.ThinEngine.prototype.createRawTexture3D=R(!0),b.ThinEngine.prototype.updateRawTexture2DArray=Z(!1),b.ThinEngine.prototype.updateRawTexture3D=Z(!0);var L=m(11175);b.ThinEngine.prototype._readTexturePixelsSync=function(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const M=this._gl;if(!M)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const h=M.createFramebuffer();if(!h)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=h}var q,E;(M.bindFramebuffer(M.FRAMEBUFFER,this._dummyFramebuffer),j>-1)?M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+j,null===(q=h._hardwareTexture)||void 0===q?void 0:q.underlyingResource,A):M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_2D,null===(E=h._hardwareTexture)||void 0===E?void 0:E.underlyingResource,A);let I=void 0!==h.type?this._getWebGLTextureType(h.type):M.UNSIGNED_BYTE;if(a)b||(b=(0,L.n)(h.type,4*d*m));else if(I===M.UNSIGNED_BYTE)b||(b=new Uint8Array(4*d*m)),I=M.UNSIGNED_BYTE;else b||(b=new Float32Array(4*d*m)),I=M.FLOAT;return w&&this.flushFramebuffer(),M.readPixels(D,S,d,m,M.RGBA,I,b),M.bindFramebuffer(M.FRAMEBUFFER,this._currentFramebuffer),b},b.ThinEngine.prototype._readTexturePixels=function(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(h,d,m,j,A,b,w,a,D,S))};m(11493);b.ThinEngine.prototype._createDepthStencilCubeTexture=function(h,d){const m=new j.c(this,12);if(m.isCube=!0,1===this.webGLVersion)return M.c.Error("Depth cube texture is not supported by WebGL 1."),m;const A={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...d},b=this._gl;this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,m,!0),this._setupDepthStencilTexture(m,h,A.bilinearFiltering,A.comparisonFunction);for(let j=0;j<6;j++)A.generateStencil?b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,b.DEPTH24_STENCIL8,h,h,0,b.DEPTH_STENCIL,b.UNSIGNED_INT_24_8,null):b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,b.DEPTH_COMPONENT24,h,h,0,b.DEPTH_COMPONENT,b.UNSIGNED_INT,null);return this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(m),m},b.ThinEngine.prototype._setCubeMapTextureParams=function(h,d,m){const j=this._gl;j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,d?j.LINEAR_MIPMAP_LINEAR:j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),h.samplingMode=d?3:2,d&&this.getCaps().textureMaxLevel&&void 0!==m&&m>0&&(j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAX_LEVEL,m),h._maxLodLevel=m),this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,null)},b.ThinEngine.prototype.createCubeTexture=function(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6?arguments[6]:void 0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]&&arguments[8],S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,I=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,R=arguments.length>13&&void 0!==arguments[13]&&arguments[13],Z=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const L=this._gl;return this.createCubeTextureBase(h,d,m,!!j,A,b,w,a,D,S,q,I,(h=>this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,h,!0)),((h,d)=>{const m=this.needPOTTextures?(0,E.f)(d[0].width,this._caps.maxCubemapTextureSize):d[0].width,b=m,a=[L.TEXTURE_CUBE_MAP_POSITIVE_X,L.TEXTURE_CUBE_MAP_POSITIVE_Y,L.TEXTURE_CUBE_MAP_POSITIVE_Z,L.TEXTURE_CUBE_MAP_NEGATIVE_X,L.TEXTURE_CUBE_MAP_NEGATIVE_Y,L.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(L.TEXTURE_CUBE_MAP,h,!0),this._unpackFlipY(!1);const D=w?this._getInternalFormat(w,h._useSRGBBuffer):h._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:L.RGBA;let S=w?this._getInternalFormat(w):L.RGBA;h._useSRGBBuffer&&1===this.webGLVersion&&(S=D);for(let j=0;j<a.length;j++)if(d[j].width!==m||d[j].height!==b){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void M.c.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=m,this._workingCanvas.height=b,this._workingContext.drawImage(d[j],0,0,d[j].width,d[j].height,0,0,m,b),L.texImage2D(a[j],0,D,S,L.UNSIGNED_BYTE,this._workingCanvas)}else L.texImage2D(a[j],0,D,S,L.UNSIGNED_BYTE,d[j]);j||L.generateMipmap(L.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(h,!j),h.width=m,h.height=b,h.isReady=!0,w&&(h.format=w),h.onLoadedObservable.notifyObservers(h),h.onLoadedObservable.clear(),A&&A()}),!!R,Z)},b.ThinEngine.prototype.generateMipMapsForCubemap=function(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(h.generateMipMaps){const m=this._gl;this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,h,!0),m.generateMipmap(m.TEXTURE_CUBE_MAP),d&&this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,null)}};m(11502);b.ThinEngine.prototype.setDepthStencilTexture=function(h,d,m,j){void 0!==h&&(d&&(this._boundUniforms[h]=d),m&&m.depthStencilTexture?this._setTexture(h,m,!1,!0,j):this._setTexture(h,null,void 0,void 0,j))},b.ThinEngine.prototype.createRenderTargetCubeTexture=function(h,d){const m=this._createHardwareRenderTargetWrapper(!1,!0,h),A={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...d};A.generateStencilBuffer=A.generateDepthBuffer&&A.generateStencilBuffer,(1!==A.type||this._caps.textureFloatLinearFiltering)&&(2!==A.type||this._caps.textureHalfFloatLinearFiltering)||(A.samplingMode=1);const b=this._gl,w=new j.c(this,5);this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,w,!0);const a=this._getSamplingParameters(A.samplingMode,A.generateMipMaps);1!==A.type||this._caps.textureFloat||(A.type=0,M.c.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MAG_FILTER,a.mag),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,a.min),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);for(let j=0;j<6;j++)b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,this._getRGBABufferInternalSizedFormat(A.type,A.format),h,h,0,this._getInternalFormat(A.format),this._getWebGLTextureType(A.type),null);const D=b.createFramebuffer();return this._bindUnboundFramebuffer(D),m._depthStencilBuffer=this._setupFramebufferDepthAttachments(A.generateStencilBuffer,A.generateDepthBuffer,h,h),A.generateMipMaps&&b.generateMipmap(b.TEXTURE_CUBE_MAP),this._bindTextureDirectly(b.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),m._framebuffer=D,m._generateDepthBuffer=A.generateDepthBuffer,m._generateStencilBuffer=A.generateStencilBuffer,w.width=h,w.height=h,w.isReady=!0,w.isCube=!0,w.samples=1,w.generateMipMaps=A.generateMipMaps,w.samplingMode=A.samplingMode,w.type=A.type,w.format=A.format,this._internalTexturesCache.push(w),m.setTextures(w),m};var B=m(11516),V=m(11534);b.ThinEngine.prototype.createPrefilteredCubeTexture=function(h,d,A,b){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(h,d,null,!1,(async h=>{if(!h)return void(w&&w(null));const a=h.texture;if(q?h.info.sphericalPolynomial&&(a._sphericalPolynomial=h.info.sphericalPolynomial):a._sphericalPolynomial=new B.d,a._source=9,this.getCaps().textureLOD)return void(w&&w(a));const D=this._gl,S=h.width;if(!S)return;const{DDSTools:E}=await m.e(26).then(m.bind(m,13339)),I=[];for(let m=0;m<3;m++){const w=1-m/2,q=b,R=Math.log2(S)*A+b,Z=q+(R-q)*w,L=Math.round(Math.min(Math.max(Z,0),R)),B=new j.c(this,2);if(B.type=a.type,B.format=a.format,B.width=Math.pow(2,Math.max(Math.log2(S)-L,0)),B.height=B.width,B.isCube=!0,B._cachedWrapU=0,B._cachedWrapV=0,this._bindTextureDirectly(D.TEXTURE_CUBE_MAP,B,!0),B.samplingMode=2,D.texParameteri(D.TEXTURE_CUBE_MAP,D.TEXTURE_MAG_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_CUBE_MAP,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_CUBE_MAP,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_CUBE_MAP,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),h.isDDS){const d=h.info,m=h.data;this._unpackFlipY(d.isCompressed),E.UploadDDSLevels(this,B,m,d,!0,6,L)}else M.c.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(D.TEXTURE_CUBE_MAP,null);const v=new V.b(d);v._isCube=!0,v._texture=B,B.isReady=!0,I.push(v)}a._lodTextureHigh=I[2],a._lodTextureMid=I[1],a._lodTextureLow=I[0],w&&w(a)}),a,D,S,q,A,b)},b.ThinEngine.prototype.createUniformBuffer=function(h,d){const m=this._gl.createBuffer();if(!m)throw new Error("Unable to create uniform buffer");const j=new S.e(m);return this.bindUniformBuffer(j),h instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,h,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(h),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),j.references=1,j},b.ThinEngine.prototype.createDynamicUniformBuffer=function(h,d){const m=this._gl.createBuffer();if(!m)throw new Error("Unable to create dynamic uniform buffer");const j=new S.e(m);return this.bindUniformBuffer(j),h instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,h,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(h),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),j.references=1,j},b.ThinEngine.prototype.updateUniformBuffer=function(h,d,m,j){this.bindUniformBuffer(h),void 0===m&&(m=0),void 0===j?d instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,m,d):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,m,new Float32Array(d)):d instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,d.subarray(m,m+j)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(d).subarray(m,m+j)),this.bindUniformBuffer(null)},b.ThinEngine.prototype.bindUniformBuffer=function(h){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,h?h.underlyingResource:null)},b.ThinEngine.prototype.bindUniformBufferBase=function(h,d,m){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,d,h?h.underlyingResource:null)},b.ThinEngine.prototype.bindUniformBlock=function(h,d,m){const j=h.program,A=this._gl.getUniformBlockIndex(j,d);4294967295!==A&&this._gl.uniformBlockBinding(j,A,m)};var v=m(11115),C=m(11188);C.b.prototype.displayLoadingUI=function(){if(!(0,v.j)())return;const h=this.loadingScreen;h&&h.displayLoadingUI()},C.b.prototype.hideLoadingUI=function(){if(!(0,v.j)())return;const h=this._loadingScreen;h&&h.hideLoadingUI()},Object.defineProperty(C.b.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=C.b.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(h){this._loadingScreen=h},enumerable:!0,configurable:!0}),Object.defineProperty(C.b.prototype,"loadingUIText",{set:function(h){this.loadingScreen.loadingUIText=h},enumerable:!0,configurable:!0}),Object.defineProperty(C.b.prototype,"loadingUIBackgroundColor",{set:function(h){this.loadingScreen.loadingUIBackgroundColor=h},enumerable:!0,configurable:!0}),C.b.prototype.getInputElement=function(){return this._renderingCanvas},C.b.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},C.b.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},C.b.prototype.getAspectRatio=function(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const m=h.viewport;return this.getRenderWidth(d)*m.width/(this.getRenderHeight(d)*m.height)},C.b.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},C.b.prototype._verifyPointerLock=function(){var h;null===(h=this._onPointerLockChange)||void 0===h||h.call(this)},C.b.prototype.setAlphaEquation=function(h){if(this._alphaEquation!==h){switch(h){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=h}},C.b.prototype.getInputElement=function(){return this._renderingCanvas},C.b.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},C.b.prototype.setDepthFunction=function(h){this._depthCullingState.depthFunc=h},C.b.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},C.b.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},C.b.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},C.b.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},C.b.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},C.b.prototype.setDepthWrite=function(h){this._depthCullingState.depthMask=h},C.b.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},C.b.prototype.setStencilBuffer=function(h){this._stencilState.stencilTest=h},C.b.prototype.getStencilMask=function(){return this._stencilState.stencilMask},C.b.prototype.setStencilMask=function(h){this._stencilState.stencilMask=h},C.b.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},C.b.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},C.b.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},C.b.prototype.setStencilFunction=function(h){this._stencilState.stencilFunc=h},C.b.prototype.setStencilFunctionReference=function(h){this._stencilState.stencilFuncRef=h},C.b.prototype.setStencilFunctionMask=function(h){this._stencilState.stencilFuncMask=h},C.b.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},C.b.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},C.b.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},C.b.prototype.setStencilOperationFail=function(h){this._stencilState.stencilOpStencilFail=h},C.b.prototype.setStencilOperationDepthFail=function(h){this._stencilState.stencilOpDepthFail=h},C.b.prototype.setStencilOperationPass=function(h){this._stencilState.stencilOpStencilDepthPass=h},C.b.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},C.b.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},C.b.prototype.setAlphaConstants=function(h,d,m,j){this._alphaState.setAlphaBlendConstants(h,d,m,j)},C.b.prototype.getAlphaMode=function(){return this._alphaMode},C.b.prototype.getAlphaEquation=function(){return this._alphaEquation},C.b.prototype.getRenderPassNames=function(){return this._renderPassNames},C.b.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},C.b.prototype.createRenderPassId=function(h){const d=++C.b._RenderPassIdCounter;return this._renderPassNames[d]=h??"NONAME",d},C.b.prototype.releaseRenderPassId=function(h){this._renderPassNames[h]=void 0;for(let d=0;d<this.scenes.length;++d){const m=this.scenes[d];for(let d=0;d<m.meshes.length;++d){const j=m.meshes[d];if(j.Ab)for(let d=0;d<j.Ab.length;++d){j.Ab[d]._removeDrawWrapper(h)}}}};m(11509);function T(h){if(h.requestPointerLock){const d=h.requestPointerLock();d instanceof Promise?d.then((()=>{h.focus()})).catch((()=>{})):h.focus()}}var o=m(11536),y=m(11183);class i extends b.ThinEngine{static get NpmPackage(){return C.b.NpmPackage}static get Version(){return C.b.Version}static get Instances(){return A.b.Instances}static get LastCreatedEngine(){return A.b.LastCreatedEngine}static get LastCreatedScene(){return A.b.LastCreatedScene}static DefaultLoadingScreenFactory(h){return C.b.DefaultLoadingScreenFactory(h)}get _supportsHardwareTextureRescaling(){return!!i._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(h,d,m){super(h,d,m,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new a,this._drawCalls=new o.b,h&&(this._features.supportRenderPasses=!0,m=this._creationOptions)}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(h){super._sharedInit(h),function(h,d,m){h._onCanvasFocus=()=>{h.onCanvasFocusObservable.notifyObservers(h)},h._onCanvasBlur=()=>{h.onCanvasBlurObservable.notifyObservers(h)},h._onCanvasContextMenu=d=>{h.disableContextMenu&&d.preventDefault()},d.addEventListener("focus",h._onCanvasFocus),d.addEventListener("blur",h._onCanvasBlur),d.addEventListener("contextmenu",h._onCanvasContextMenu),h._onBlur=()=>{h.disablePerformanceMonitorInBackground&&h.performanceMonitor.disable(),h._windowIsBackground=!0},h._onFocus=()=>{h.disablePerformanceMonitorInBackground&&h.performanceMonitor.enable(),h._windowIsBackground=!1},h._onCanvasPointerOut=m=>{document.elementFromPoint(m.clientX,m.clientY)!==d&&h.onCanvasPointerOutObservable.notifyObservers(m)};const j=h.getHostWindow();j&&"function"===typeof j.addEventListener&&(j.addEventListener("blur",h._onBlur),j.addEventListener("focus",h._onFocus)),d.addEventListener("pointerout",h._onCanvasPointerOut),m.doNotHandleTouchAction||function(h){h&&h.setAttribute&&(h.setAttribute("touch-action","none"),h.style.touchAction="none",h.style.webkitTapHighlightColor="transparent")}(d),!C.b.audioEngine&&m.audioEngine&&C.b.AudioEngineFactory&&(C.b.audioEngine=C.b.AudioEngineFactory(h.getRenderingCanvas(),h.getAudioContext(),h.getAudioDestination())),(0,v.f)()&&(h._onFullscreenChange=()=>{h.isFullscreen=!!document.fullscreenElement,h.isFullscreen&&h._pointerLockRequested&&d&&T(d)},document.addEventListener("fullscreenchange",h._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",h._onFullscreenChange,!1),h._onPointerLockChange=()=>{h.isPointerLock=document.pointerLockElement===d},document.addEventListener("pointerlockchange",h._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",h._onPointerLockChange,!1)),h.enableOfflineSupport=void 0!==C.b.OfflineProviderFactory,h._deterministicLockstep=!!m.deterministicLockstep,h._lockstepMaxSteps=m.lockstepMaxSteps||0,h._timeStep=m.timeStep||1/60}(this,h,this._creationOptions)}resizeImageBitmap(h,d,m){return function(h,d,m,j){const A=h.createCanvas(m,j).getContext("2d");if(!A)throw new Error("Unable to get 2d context for resizeImageBitmap");return A.drawImage(d,0,0),A.getImageData(0,0,m,j).data}(this,h,d,m)}async _createImageBitmapFromSource(h,d){return await async function(h,d,m){return await new Promise(((j,A)=>{const b=new Image;b.onload=()=>{b.decode().then((()=>{h.createImageBitmap(b,m).then((h=>{j(h)}))}))},b.onerror=()=>{A(`Error loading image ${b.src}`)},b.src=d}))}(this,h,d)}switchFullscreen(h){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(h)}enterFullscreen(h){this.isFullscreen||(this._pointerLockRequested=h,this._renderingCanvas&&function(h){const d=h.requestFullscreen||h.webkitRequestFullscreen;d&&d.call(h)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const h=document;document.exitFullscreen?document.exitFullscreen():h.webkitCancelFullScreen&&h.webkitCancelFullScreen()}()}setDitheringState(h){h?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(h){h?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(h,d,m,j){const A=this._cachedViewport;return this._cachedViewport=null,this._viewport(h,d,m,j),A}scissorClear(h,d,m,j,A){this.enableScissor(h,d,m,j),this.clear(A,!0,!0,!0),this.disableScissor()}enableScissor(h,d,m,j){const A=this._gl;A.enable(A.SCISSOR_TEST),A.scissor(h,d,m,j)}disableScissor(){const h=this._gl;h.disable(h.SCISSOR_TEST)}async _loadFileAsync(h,d,m){return await new Promise(((j,A)=>{this._loadFile(h,(h=>{j(h)}),void 0,d,m,((h,d)=>{A(d)}))}))}getVertexShaderSource(h){const d=this._gl.getAttachedShaders(h);return d?this._gl.getShaderSource(d[0]):null}getFragmentShaderSource(h){const d=this._gl.getAttachedShaders(h);return d?this._gl.getShaderSource(d[1]):null}set framebufferDimensionsObject(h){this._framebufferDimensionsObject=h,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const h of this.scenes)h.resetCachedMaterial(),h._rebuildGeometries();for(const h of this._virtualScenes)h.resetCachedMaterial(),h._rebuildGeometries();super._rebuildBuffers()}getFontOffset(h){return function(h){const d=document.createElement("span");d.textContent="Hg",d.style.font=h;const m=document.createElement("div");m.style.display="inline-block",m.style.width="1px",m.style.height="0px",m.style.verticalAlign="bottom";const j=document.createElement("div");j.style.whiteSpace="nowrap",j.appendChild(d),j.appendChild(m),document.body.appendChild(j);let A=0,b=0;try{b=m.getBoundingClientRect().top-d.getBoundingClientRect().top,m.style.verticalAlign="baseline",A=m.getBoundingClientRect().top-d.getBoundingClientRect().top}finally{document.body.removeChild(j)}return{ascent:A,height:b,descent:b-A}}(h)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:h}=this.customAnimationFrameRequester;h&&h(this.customAnimationFrameRequester.I)}}else super._cancelFrame()}_renderLoop(h){this._processFrame(h),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.I=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.I):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&T(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}uq(){this._measureFps(),super.uq()}_deletePipelineContext(h){const d=h;d&&d.program&&d.transformFeedback&&(this.deleteTransformFeedback(d.transformFeedback),d.transformFeedback=null),super._deletePipelineContext(h)}createShaderProgram(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;A=A||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const w=super.createShaderProgram(h,d,m,j,A,b);return this.onAfterShaderCompilationObservable.notifyObservers(this),w}_createShaderProgram(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const b=j.createProgram();if(h.program=b,!b)throw new Error("Unable to create program");if(j.attachShader(b,d),j.attachShader(b,m),this.webGLVersion>1&&A){const d=this.createTransformFeedback();this.bindTransformFeedback(d),this.setTranformFeedbackVaryings(b,A),h.transformFeedback=d}return j.linkProgram(b),this.webGLVersion>1&&A&&this.bindTransformFeedback(null),h.context=j,h.vertexShader=d,h.fragmentShader=m,h.isParallelCompiled||this._finalizePipelineContext(h),b}_releaseTexture(h){super._releaseTexture(h)}_releaseRenderTargetWrapper(h){super._releaseRenderTargetWrapper(h);for(const d of this.scenes){for(const m of d.postProcesses)m._outputTexture===h&&(m._outputTexture=null);for(const m of d.cameras)for(const d of m._postProcesses)d&&d._outputTexture===h&&(d._outputTexture=null)}}_rescaleTexture(h,d,m,j,A){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const b=this.createRenderTargetTexture({width:d.width,height:d.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&i._RescalePostProcessFactory&&(this._rescalePostProcess=i._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const w=()=>{this._rescalePostProcess.onApply=function(d){d._bindTexture("textureSampler",h)};let w=m;w||(w=this.scenes[this.scenes.length-1]),w.postProcessManager.directRender([this._rescalePostProcess],b,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,d,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,j,0,0,d.width,d.height,0),this.unBindFramebuffer(b),b.dispose(),A&&A()},a=this._rescalePostProcess.getEffect();a?a.executeWhenCompiled(w):this._rescalePostProcess.onEffectCreatedObservable.addOnce((h=>{h.executeWhenCompiled(w)}))}}wrapWebGLTexture(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const w=new q.e(h,this._gl),a=new j.c(this,0,!0);return a._hardwareTexture=w,a.baseWidth=A,a.baseHeight=b,a.width=A,a.height=b,a.isReady=!0,a.useMipMaps=d,this.updateTextureSamplingMode(m,a),a}_uploadImageToTexture(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const A=this._gl,b=this._getWebGLTextureType(h.type),w=this._getInternalFormat(h.format),a=this._getRGBABufferInternalSizedFormat(h.type,w),D=h.isCube?A.TEXTURE_CUBE_MAP:A.TEXTURE_2D;this._bindTextureDirectly(D,h,!0),this._unpackFlipY(h.invertY);let S=A.TEXTURE_2D;h.isCube&&(S=A.TEXTURE_CUBE_MAP_POSITIVE_X+m),A.texImage2D(S,j,a,w,b,d),this._bindTextureDirectly(D,null,!0)}updateTextureComparisonFunction(h,d){if(1===this.webGLVersion)return void M.c.Error("WebGL 1 does not support texture comparison.");const m=this._gl;h.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,h,!0),0===d?(m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_COMPARE_FUNC,515),m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_COMPARE_MODE,m.NONE)):(m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_COMPARE_FUNC,d),m.texParameteri(m.TEXTURE_CUBE_MAP,m.TEXTURE_COMPARE_MODE,m.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,h,!0),0===d?(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_COMPARE_FUNC,515),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_COMPARE_MODE,m.NONE)):(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_COMPARE_FUNC,d),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_COMPARE_MODE,m.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),h._comparisonFunction=d}createInstancesBuffer(h){const d=this._gl.createBuffer();if(!d)throw new Error("Unable to create instance buffer");const m=new S.e(d);return m.km=h,this.bindArrayBuffer(m),this._gl.bufferData(this._gl.ARRAY_BUFFER,h,this._gl.DYNAMIC_DRAW),m.references=1,m}deleteInstancesBuffer(h){this._gl.deleteBuffer(h)}async _clientWaitAsync(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const j=this._gl;return await new Promise(((A,b)=>{(0,y.d)((()=>{const m=j.clientWaitSync(h,d,0);if(m==j.WAIT_FAILED)throw new Error("clientWaitSync failed");return m!=j.TIMEOUT_EXPIRED}),A,b,m)}))}_readPixelsAsync(h,d,m,j,A,b,w){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const a=this._gl,D=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,D),a.bufferData(a.PIXEL_PACK_BUFFER,w.byteLength,a.STREAM_READ),a.readPixels(h,d,m,j,A,b,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null);const S=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);return S?(a.flush(),this._clientWaitAsync(S,0,10).then((()=>(a.deleteSync(S),a.bindBuffer(a.PIXEL_PACK_BUFFER,D),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,w),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteBuffer(D),w)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(h,d){1===A.b.Instances.length&&C.b.audioEngine&&(C.b.audioEngine.dispose(),C.b.audioEngine=null);const m=h.getHostWindow();m&&"function"===typeof m.removeEventListener&&(m.removeEventListener("blur",h._onBlur),m.removeEventListener("focus",h._onFocus)),d&&(d.removeEventListener("focus",h._onCanvasFocus),d.removeEventListener("blur",h._onCanvasBlur),d.removeEventListener("pointerout",h._onCanvasPointerOut),d.removeEventListener("contextmenu",h._onCanvasContextMenu)),(0,v.f)()&&(document.removeEventListener("fullscreenchange",h._onFullscreenChange),document.removeEventListener("mozfullscreenchange",h._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",h._onFullscreenChange),document.removeEventListener("msfullscreenchange",h._onFullscreenChange),document.removeEventListener("pointerlockchange",h._onPointerLockChange),document.removeEventListener("mspointerlockchange",h._onPointerLockChange),document.removeEventListener("mozpointerlockchange",h._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",h._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}i.ALPHA_DISABLE=0,i.ALPHA_ADD=1,i.ALPHA_COMBINE=2,i.ALPHA_SUBTRACT=3,i.ALPHA_MULTIPLY=4,i.ALPHA_MAXIMIZED=5,i.ALPHA_ONEONE=6,i.ALPHA_PREMULTIPLIED=7,i.ALPHA_PREMULTIPLIED_PORTERDUFF=8,i.ALPHA_INTERPOLATE=9,i.ALPHA_SCREENMODE=10,i.DELAYLOADSTATE_NONE=0,i.DELAYLOADSTATE_LOADED=1,i.DELAYLOADSTATE_LOADING=2,i.DELAYLOADSTATE_NOTLOADED=4,i.NEVER=512,i.ALWAYS=519,i.LESS=513,i.EQUAL=514,i.LEQUAL=515,i.GREATER=516,i.GEQUAL=518,i.NOTEQUAL=517,i.KEEP=7680,i.REPLACE=7681,i.INCR=7682,i.DECR=7683,i.INVERT=5386,i.INCR_WRAP=34055,i.DECR_WRAP=34056,i.TEXTURE_CLAMP_ADDRESSMODE=0,i.TEXTURE_WRAP_ADDRESSMODE=1,i.TEXTURE_MIRROR_ADDRESSMODE=2,i.TEXTUREFORMAT_ALPHA=0,i.TEXTUREFORMAT_LUMINANCE=1,i.TEXTUREFORMAT_LUMINANCE_ALPHA=2,i.TEXTUREFORMAT_RGB=4,i.TEXTUREFORMAT_RGBA=5,i.TEXTUREFORMAT_RED=6,i.TEXTUREFORMAT_R=6,i.TEXTUREFORMAT_R16_UNORM=33322,i.TEXTUREFORMAT_RG16_UNORM=33324,i.TEXTUREFORMAT_RGB16_UNORM=32852,i.TEXTUREFORMAT_RGBA16_UNORM=32859,i.TEXTUREFORMAT_R16_SNORM=36760,i.TEXTUREFORMAT_RG16_SNORM=36761,i.TEXTUREFORMAT_RGB16_SNORM=36762,i.TEXTUREFORMAT_RGBA16_SNORM=36763,i.TEXTUREFORMAT_RG=7,i.TEXTUREFORMAT_RED_INTEGER=8,i.TEXTUREFORMAT_R_INTEGER=8,i.TEXTUREFORMAT_RG_INTEGER=9,i.TEXTUREFORMAT_RGB_INTEGER=10,i.TEXTUREFORMAT_RGBA_INTEGER=11,i.TEXTURETYPE_UNSIGNED_BYTE=0,i.TEXTURETYPE_UNSIGNED_INT=0,i.TEXTURETYPE_FLOAT=1,i.TEXTURETYPE_HALF_FLOAT=2,i.TEXTURETYPE_BYTE=3,i.TEXTURETYPE_SHORT=4,i.TEXTURETYPE_UNSIGNED_SHORT=5,i.TEXTURETYPE_INT=6,i.TEXTURETYPE_UNSIGNED_INTEGER=7,i.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,i.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,i.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,i.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,i.TEXTURETYPE_UNSIGNED_INT_24_8=12,i.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,i.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,i.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,i.TEXTURE_NEAREST_SAMPLINGMODE=1,i.TEXTURE_BILINEAR_SAMPLINGMODE=2,i.TEXTURE_TRILINEAR_SAMPLINGMODE=3,i.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,i.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,i.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,i.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,i.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,i.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,i.TEXTURE_NEAREST_LINEAR=7,i.TEXTURE_NEAREST_NEAREST=1,i.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,i.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,i.TEXTURE_LINEAR_LINEAR=2,i.TEXTURE_LINEAR_NEAREST=12,i.TEXTURE_EXPLICIT_MODE=0,i.TEXTURE_SPHERICAL_MODE=1,i.TEXTURE_PLANAR_MODE=2,i.TEXTURE_CUBIC_MODE=3,i.TEXTURE_PROJECTION_MODE=4,i.TEXTURE_SKYBOX_MODE=5,i.TEXTURE_INVCUBIC_MODE=6,i.TEXTURE_EQUIRECTANGULAR_MODE=7,i.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,i.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,i.SCALEMODE_FLOOR=1,i.SCALEMODE_NEAREST=2,i.SCALEMODE_CEILING=3},11094:(h,d,m)=>{m.d(d,{b:()=>A});var j=m(11097);class A{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}A.Instances=[],A.OnEnginesDisposedObservable=new j.e,A._LastCreatedScene=null,A.UseFallbackTexture=!0,A.FallbackTexture=""},11087:(h,d,m)=>{m.d(d,{d:()=>j});class j{static SetMatrixPrecision(h){if(j.MatrixTrackPrecisionChange=!1,h&&!j.MatrixUse64Bits&&j.MatrixTrackedMatrices)for(let d=0;d<j.MatrixTrackedMatrices.length;++d){const h=j.MatrixTrackedMatrices[d],m=h.cE;h.cE=new Array(16);for(let d=0;d<16;++d)h.cE[d]=m[d]}j.MatrixUse64Bits=h,j.MatrixCurrentType=j.MatrixUse64Bits?Array:Float32Array,j.MatrixTrackedMatrices=null}}j.MatrixUse64Bits=!1,j.MatrixTrackPrecisionChange=!0,j.MatrixCurrentType=Float32Array,j.MatrixTrackedMatrices=[]},11504:(h,d,m)=>{m.d(d,{e:()=>A});var j=m(11482);class A{get depthStencilTexture(){return this._depthStencilTexture}setDepthStencilTexture(h){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this._depthStencilTexture&&this._depthStencilTexture.dispose(),this._depthStencilTexture=h,this._generateDepthBuffer=this._generateStencilBuffer=this._depthStencilTextureWithStencil=!1,h&&(this._generateDepthBuffer=!0,this._generateStencilBuffer=this._depthStencilTextureWithStencil=(0,j.b)(h.format))}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width??this._size}get height(){return this._size.height??this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var h;return(null===(h=this._textures)||void 0===h?void 0:h[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(h){var d,m;if(!this._textures)return-1;const j=this._textures[h],A=(null===(d=this._layerIndices)||void 0===d?void 0:d[h])??0,b=(null===(m=this._faceIndices)||void 0===m?void 0:m[h])??0;return j.isCube?6*A+b:j.is3D?0:A}get samples(){return this._samples}setSamples(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===h&&!m)return h;const j=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,h,d):this._engine.updateRenderTargetTextureSampleCount(this,h);return this._samples=h,j}resolveMSAATextures(){this.isMulti?this._engine.resolveMultiFramebuffer(this):this._engine.resolveFramebuffer(this)}generateMipMaps(){this._engine._currentRenderTarget===this&&this._engine.unBindFramebuffer(this,!0),this.isMulti?this._engine.generateMipMapsMultiFramebuffer(this):this._engine.generateMipMapsFramebuffer(this)}constructor(h,d,m,j,A){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this.disableAutomaticMSAAResolve=!1,this.resolveMSAAColors=!0,this.resolveMSAADepth=!1,this.resolveMSAAStencil=!1,this._isMulti=h,this._isCube=d,this._size=m,this._engine=j,this._depthStencilTexture=null,this.label=A}setTextures(h){Array.isArray(h)?this._textures=h:this._textures=h?[h]:null}setTexture(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[d]!==h&&(this._textures[d]&&m&&this._textures[d].dispose(),this._textures[d]=h)}setLayerAndFaceIndices(h,d){this._layerIndices=h,this._faceIndices=d}setLayerAndFaceIndex(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==d&&d>=0&&(this._layerIndices[h]=d),void 0!==m&&m>=0&&(this._faceIndices[h]=m)}createDepthStencilTexture(){var h;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,w=arguments.length>5?arguments[5]:void 0;return null===(h=this._depthStencilTexture)||void 0===h||h.dispose(),this._depthStencilTextureWithStencil=j,this._depthStencilTextureLabel=w,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:m,comparisonFunction:d,generateStencil:j,isCube:this._isCube,samples:A,depthTextureFormat:b,label:w},this),this._depthStencilTexture}_shareDepth(h){this.shareDepth(h)}shareDepth(h){this._depthStencilTexture&&(h._depthStencilTexture&&h._depthStencilTexture.dispose(),h._depthStencilTexture=this._depthStencilTexture,h._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(h){this.texture&&this.texture._swapAndDie(h),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let h=null;if(this._isMulti){const d=this.textures;if(d&&d.length>0){let m=!1,j=d.length,A=-1;const b=d[d.length-1]._source;14!==b&&12!==b||(m=!0,A=d[d.length-1].format,j--);const w=[],a=[],D=[],S=[],M=[],q=[],E=[],I={};for(let h=0;h<j;++h){const m=d[h];w.push(m.samplingMode),a.push(m.type),D.push(m.format);void 0!==I[m.uniqueId]?(S.push(-1),E.push(0)):(I[m.uniqueId]=h,m.is2DArray?(S.push(35866),E.push(m.depth)):m.isCube?(S.push(34067),E.push(0)):m.is3D?(S.push(32879),E.push(m.depth)):(S.push(3553),E.push(0))),this._faceIndices&&M.push(this._faceIndices[h]??0),this._layerIndices&&q.push(this._layerIndices[h]??0)}const R={samplingModes:w,generateMipMaps:d[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:m,depthTextureFormat:A,types:a,formats:D,textureCount:j,targetTypes:S,faceIndex:M,layerIndex:q,layerCounts:E,label:this.label},Z={width:this.width,height:this.height,depth:this.depth};h=this._engine.createMultipleRenderTarget(Z,R);for(let L=0;L<j;++L){if(-1!==S[L])continue;const m=I[d[L].uniqueId];h.setTexture(h.textures[m],L)}}}else{var d,m,j,A;const w={};if(w.generateDepthBuffer=this._generateDepthBuffer,w.generateMipMaps=(null===(d=this.texture)||void 0===d?void 0:d.generateMipMaps)??!1,w.generateStencilBuffer=this._generateStencilBuffer,w.samplingMode=null===(m=this.texture)||void 0===m?void 0:m.samplingMode,w.type=null===(j=this.texture)||void 0===j?void 0:j.type,w.format=null===(A=this.texture)||void 0===A?void 0:A.format,w.noColorAttachment=!this._textures,w.label=this.label,this.isCube)h=this._engine.createRenderTargetCubeTexture(this.width,w);else{var b;const d={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(b=this.texture)||void 0===b?void 0:b.depth:void 0};h=this._engine.createRenderTargetTexture(d,w)}h.texture&&(h.texture.isReady=!0)}return h}_swapRenderTargetWrapper(h){if(this._textures&&h._textures)for(let d=0;d<this._textures.length;++d)this._textures[d]._swapAndDie(h._textures[d],!1),h._textures[d].isReady=!0;this._depthStencilTexture&&h._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(h._depthStencilTexture),h._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const h=this._cloneRenderTargetWrapper();if(h){if(this._depthStencilTexture){const d=this._depthStencilTexture.samplingMode,m=this._depthStencilTexture.format,j=2===d||3===d||11===d;h.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,j,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,m,this._depthStencilTextureLabel)}this.samples>1&&h.setSamples(this.samples),h._swapRenderTargetWrapper(this),h.dispose()}}releaseTextures(){if(this._textures)for(let h=0;h<this._textures.length;++h)this._textures[h].dispose();this._textures=null}dispose(){var h;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(h=this._depthStencilTexture)||void 0===h||h.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},11200:(h,d,m)=>{m.d(d,{b:()=>j});class j{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?j.ShadersRepository:j.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?j.ShadersStore:j.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?j.IncludesShadersStore:j.IncludesShadersStoreWGSL}}j.ShadersRepository="src/Shaders/",j.ShadersStore={},j.IncludesShadersStore={},j.ShadersRepositoryWGSL="src/ShadersWGSL/",j.ShadersStoreWGSL={},j.IncludesShadersStoreWGSL={}},11213:(h,d,m)=>{m.d(d,{c:()=>E,e:()=>v,h:()=>R,i:()=>I,l:()=>Z,o:()=>V,p:()=>q,t:()=>S,u:()=>M,v:()=>D,y:()=>a});class j{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.sa._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(h){h&&this.program&&h(this.program)}setEngine(h){this.sa=h}_fillEffectInformation(h,d,m,j,A,b,w,a){const D=this.sa;if(D.supportsUniformBuffers)for(const M in d)h.bindUniformBlock(M,d[M]);let S;for(this.sa.getUniforms(this,m).forEach(((h,d)=>{j[m[d]]=h})),this._uniforms=j,S=0;S<A.length;S++){null==h.getUniform(A[S])&&(A.splice(S,1),S--)}A.forEach(((h,d)=>{b[h]=d}));for(const M of D.getAttributes(this,w))a.push(M)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(h,d){const m=this._valueCache[h],j=d.updateFlag;return(void 0===m||m!==j)&&(this._valueCache[h]=j,!0)}_cacheFloat2(h,d,m){let j=this._valueCache[h];if(!j||2!==j.length)return j=[d,m],this._valueCache[h]=j,!0;let A=!1;return j[0]!==d&&(j[0]=d,A=!0),j[1]!==m&&(j[1]=m,A=!0),A}_cacheFloat3(h,d,m,j){let A=this._valueCache[h];if(!A||3!==A.length)return A=[d,m,j],this._valueCache[h]=A,!0;let b=!1;return A[0]!==d&&(A[0]=d,b=!0),A[1]!==m&&(A[1]=m,b=!0),A[2]!==j&&(A[2]=j,b=!0),b}_cacheFloat4(h,d,m,j,A){let b=this._valueCache[h];if(!b||4!==b.length)return b=[d,m,j,A],this._valueCache[h]=b,!0;let w=!1;return b[0]!==d&&(b[0]=d,w=!0),b[1]!==m&&(b[1]=m,w=!0),b[2]!==j&&(b[2]=j,w=!0),b[3]!==A&&(b[3]=A,w=!0),w}setInt(h,d){const m=this._valueCache[h];void 0!==m&&m===d||this.sa.setInt(this._uniforms[h],d)&&(this._valueCache[h]=d)}setInt2(h,d,m){this._cacheFloat2(h,d,m)&&(this.sa.setInt2(this._uniforms[h],d,m)||(this._valueCache[h]=null))}setInt3(h,d,m,j){this._cacheFloat3(h,d,m,j)&&(this.sa.setInt3(this._uniforms[h],d,m,j)||(this._valueCache[h]=null))}setInt4(h,d,m,j,A){this._cacheFloat4(h,d,m,j,A)&&(this.sa.setInt4(this._uniforms[h],d,m,j,A)||(this._valueCache[h]=null))}setIntArray(h,d){this._valueCache[h]=null,this.sa.setIntArray(this._uniforms[h],d)}setIntArray2(h,d){this._valueCache[h]=null,this.sa.setIntArray2(this._uniforms[h],d)}setIntArray3(h,d){this._valueCache[h]=null,this.sa.setIntArray3(this._uniforms[h],d)}setIntArray4(h,d){this._valueCache[h]=null,this.sa.setIntArray4(this._uniforms[h],d)}setUInt(h,d){const m=this._valueCache[h];void 0!==m&&m===d||this.sa.setUInt(this._uniforms[h],d)&&(this._valueCache[h]=d)}setUInt2(h,d,m){this._cacheFloat2(h,d,m)&&(this.sa.setUInt2(this._uniforms[h],d,m)||(this._valueCache[h]=null))}setUInt3(h,d,m,j){this._cacheFloat3(h,d,m,j)&&(this.sa.setUInt3(this._uniforms[h],d,m,j)||(this._valueCache[h]=null))}setUInt4(h,d,m,j,A){this._cacheFloat4(h,d,m,j,A)&&(this.sa.setUInt4(this._uniforms[h],d,m,j,A)||(this._valueCache[h]=null))}setUIntArray(h,d){this._valueCache[h]=null,this.sa.setUIntArray(this._uniforms[h],d)}setUIntArray2(h,d){this._valueCache[h]=null,this.sa.setUIntArray2(this._uniforms[h],d)}setUIntArray3(h,d){this._valueCache[h]=null,this.sa.setUIntArray3(this._uniforms[h],d)}setUIntArray4(h,d){this._valueCache[h]=null,this.sa.setUIntArray4(this._uniforms[h],d)}setArray(h,d){this._valueCache[h]=null,this.sa.setArray(this._uniforms[h],d)}setArray2(h,d){this._valueCache[h]=null,this.sa.setArray2(this._uniforms[h],d)}setArray3(h,d){this._valueCache[h]=null,this.sa.setArray3(this._uniforms[h],d)}setArray4(h,d){this._valueCache[h]=null,this.sa.setArray4(this._uniforms[h],d)}setMatrices(h,d){d&&(this._valueCache[h]=null,this.sa.setMatrices(this._uniforms[h],d))}setMatrix(h,d){this._cacheMatrix(h,d)&&(this.sa.setMatrices(this._uniforms[h],d.fd())||(this._valueCache[h]=null))}setMatrix3x3(h,d){this._valueCache[h]=null,this.sa.setMatrix3x3(this._uniforms[h],d)}setMatrix2x2(h,d){this._valueCache[h]=null,this.sa.setMatrix2x2(this._uniforms[h],d)}setFloat(h,d){const m=this._valueCache[h];void 0!==m&&m===d||this.sa.setFloat(this._uniforms[h],d)&&(this._valueCache[h]=d)}setVector2(h,d){this._cacheFloat2(h,d.x,d.y)&&(this.sa.setFloat2(this._uniforms[h],d.x,d.y)||(this._valueCache[h]=null))}setFloat2(h,d,m){this._cacheFloat2(h,d,m)&&(this.sa.setFloat2(this._uniforms[h],d,m)||(this._valueCache[h]=null))}setVector3(h,d){this._cacheFloat3(h,d.x,d.y,d.z)&&(this.sa.setFloat3(this._uniforms[h],d.x,d.y,d.z)||(this._valueCache[h]=null))}setFloat3(h,d,m,j){this._cacheFloat3(h,d,m,j)&&(this.sa.setFloat3(this._uniforms[h],d,m,j)||(this._valueCache[h]=null))}setVector4(h,d){this._cacheFloat4(h,d.x,d.y,d.z,d.w)&&(this.sa.setFloat4(this._uniforms[h],d.x,d.y,d.z,d.w)||(this._valueCache[h]=null))}setQuaternion(h,d){this._cacheFloat4(h,d.x,d.y,d.z,d.w)&&(this.sa.setFloat4(this._uniforms[h],d.x,d.y,d.z,d.w)||(this._valueCache[h]=null))}setFloat4(h,d,m,j,A){this._cacheFloat4(h,d,m,j,A)&&(this.sa.setFloat4(this._uniforms[h],d,m,j,A)||(this._valueCache[h]=null))}setColor3(h,d){this._cacheFloat3(h,d.r,d.g,d.b)&&(this.sa.setFloat3(this._uniforms[h],d.r,d.g,d.b)||(this._valueCache[h]=null))}setColor4(h,d,m){this._cacheFloat4(h,d.r,d.g,d.b,m)&&(this.sa.setFloat4(this._uniforms[h],d.r,d.g,d.b,m)||(this._valueCache[h]=null))}setDirectColor4(h,d){this._cacheFloat4(h,d.r,d.g,d.b,d.a)&&(this.sa.setFloat4(this._uniforms[h],d.r,d.g,d.b,d.a)||(this._valueCache[h]=null))}_getVertexShaderCode(){return this.vertexShader?this.sa._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.sa._getShaderSource(this.fragmentShader):null}}var A=m(11175);const b=new WeakMap,w={_webGLVersion:2,cachedPipelines:{}};function a(h){let d=b.get(h);if(!d){if(!h)return w;d={_webGLVersion:h.TEXTURE_BINDING_3D?2:1,_context:h,parallelShaderCompile:h.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},b.set(h,d)}return d}function D(h){b.delete(h)}function S(h,d,m,j,A,b){const w=a(j);b||(b=w._createShaderProgramInjection??E);return b(h,B(d,"vertex",j,w._contextWasLost),B(m,"fragment",j,w._contextWasLost),j,A,w.validateShaderPrograms)}function M(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6?arguments[6]:void 0;const D=a(A);w||(w=D._createShaderProgramInjection??E);const S=D._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return w(h,L(d,"vertex",j,S,A,D._contextWasLost),L(m,"fragment",j,S,A,D._contextWasLost),A,b,D.validateShaderPrograms)}function q(h,d){const m=new j,A=a(h);return A.parallelShaderCompile&&!A.disableParallelShaderCompile&&(m.isParallelCompiled=!0),m.context=A._context,m}function E(h,d,m,j){let A=arguments.length>5?arguments[5]:void 0;const b=j.createProgram();if(h.program=b,!b)throw new Error("Unable to create program");return j.attachShader(b,d),j.attachShader(b,m),j.linkProgram(b),h.context=j,h.vertexShader=d,h.fragmentShader=m,h.isParallelCompiled||R(h,j,A),b}function I(h,d,m){const j=h;if(j._isDisposed)return!1;const A=a(d);return!!(A&&A.parallelShaderCompile&&A.parallelShaderCompile.COMPLETION_STATUS_KHR&&j.program&&d.getProgramParameter(j.program,A.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(R(j,d,m),!0)}function R(h,d,m){const j=h.context,A=h.vertexShader,b=h.fragmentShader,w=h.program;if(!j.getProgramParameter(w,j.LINK_STATUS)){if(!d.getShaderParameter(A,d.COMPILE_STATUS)){const m=d.getShaderInfoLog(A);if(m)throw h.vertexCompilationError=m,new Error("VERTEX SHADER "+m)}if(!d.getShaderParameter(b,d.COMPILE_STATUS)){const m=d.getShaderInfoLog(b);if(m)throw h.fragmentCompilationError=m,new Error("FRAGMENT SHADER "+m)}const m=j.getProgramInfoLog(w);if(m)throw h.programLinkError=m,new Error(m)}if(m){j.validateProgram(w);if(!j.getProgramParameter(w,j.VALIDATE_STATUS)){const d=j.getProgramInfoLog(w);if(d)throw h.programValidationError=d,new Error(d)}}j.deleteShader(A),j.deleteShader(b),h.vertexShader=void 0,h.fragmentShader=void 0,h.onCompiled&&(h.onCompiled(),h.onCompiled=void 0)}function Z(h,d,m,j,A,b,w,D,q){let E=arguments.length>10?arguments[10]:void 0,I=arguments.length>11?arguments[11]:void 0,R=arguments.length>12?arguments[12]:void 0;const Z=a(h.context);I||(I=Z.createRawShaderProgramInjection??S),R||(R=Z.createShaderProgramInjection??M);const L=h;L.program=j?I(L,d,m,L.context,q):R(L,d,m,D,L.context,q),L.program.__SPECTOR_rebuildProgram=w,E()}function L(h,d,m,j,b,w){return B((0,A.i)(h,m,j),d,b,w)}function B(h,d,m,j){const A=m.createShader("vertex"===d?m.VERTEX_SHADER:m.FRAGMENT_SHADER);if(!A){let h=m.NO_ERROR,A=m.NO_ERROR;for(;(A=m.getError())!==m.NO_ERROR;)h=A;throw new Error(`Something went wrong while creating a gl ${d} shader object. gl error=${h}, gl isContextLost=${m.isContextLost()}, _contextWasLost=${j}`)}return m.shaderSource(A,h),m.compileShader(A),A}function V(h,d){d.useProgram(h)}function v(h,d){const m=h;if(!m.isParallelCompiled)return void d(h);const j=m.onCompiled;m.onCompiled=()=>{null===j||void 0===j||j(),d(h)}}},11470:(h,d,m)=>{m.r(d),m.d(d,{ThinEngine:()=>C});var j=m(11213),A=m(11475),b=m(11121),w=m(11115);class a{constructor(){this.shaderLanguage=0}postProcessor(h,d,m,j,A){if(A.drawBuffersExtensionDisabled){const d=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;h=h.replace(d,"")}return h}}const D=/(flat\s)?\s*varying\s*.*/;class S{constructor(){this.shaderLanguage=0}attributeProcessor(h){return h.replace("attribute","in")}varyingCheck(h,d){return D.test(h)}varyingProcessor(h,d){return h.replace("varying",d?"in":"out")}postProcessor(h,d,m){const j=-1!==h.search(/#extension.+GL_EXT_draw_buffers.+require/);if(h=(h=h.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),m){const d=-1!==h.search(/layout *\(location *= *0\) *out/g);h=(h=(h=(h=(h=(h=(h=h.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(j||d?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==d.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+h}return h}}var M=m(11477),q=m(11248),E=m(11188),I=m(11479),R=m(11216),Z=m(11196),L=m(11175),B=m(11204),V=m(11482);class v{}class C extends E.b{get name(){return this._name}set name(h){this._name=h}get version(){return this._webGLVersion}static get ShadersRepository(){return Z.e.ShadersRepository}static set ShadersRepository(h){Z.e.ShadersRepository=h}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(h){this._framebufferDimensionsObject=h}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(h,d,m,A){if(m=m||{},super(d??m.antialias,m,A),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!h)return;let w=null;if(h.getContext){if(w=h,void 0===m.vM&&(m.vM=!1),void 0===m.xrCompatible&&(m.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const h=navigator.userAgent;for(const d of C.ExceptionList){const j=d.key,A=d.targets;if(new RegExp(j).test(h)){if(d.capture&&d.captureConstraint){const m=d.capture,j=d.captureConstraint,A=new RegExp(m).exec(h);if(A&&A.length>0){if(parseInt(A[A.length-1])>=j)continue}}for(const h of A)switch(h){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":m.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost?this._onContextLost=()=>{(0,j.v)(this._gl)}:(this._onContextLost=h=>{h.preventDefault(),this._contextWasLost=!0,(0,j.v)(this._gl),b.c.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},w.addEventListener("webglcontextrestored",this._onContextRestored,!1),m.powerPreference=m.powerPreference||"high-performance"),w.addEventListener("webglcontextlost",this._onContextLost,!1),this._badDesktopOS&&(m.xrCompatible=!1),!m.disableWebGL2Support)try{this._gl=w.getContext("webgl2",m)||w.getContext("experimental-webgl2",m),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(q){}if(!this._gl){if(!w)throw new Error("The provided canvas is null or undefined.");try{this._gl=w.getContext("webgl",m)||w.getContext("experimental-webgl",m)}catch(q){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=h,w=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const d=this._gl.getContextAttributes();d&&(m.stencil=d.stencil)}this._sharedInit(w),this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==m.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=m.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let j=0;j<this._caps.maxVertexAttribs;j++)this._currentBufferPointers[j]=new v;this._shaderProcessor=this.webGLVersion>1?new S:new a;const D=`Babylon.js v${C.Version}`;b.c.Log(D+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",D);const M=(0,j.y)(this._gl);M.validateShaderPrograms=this.validateShaderPrograms,M.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(h){return null}areAllEffectsReady(){for(const h in this._compiledEffects){if(!this._compiledEffects[h].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1,textureNorm16:!!this._gl.getExtension("EXT_texture_norm16")},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const h=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=h&&(this._glRenderer=this._gl.getParameter(h.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(h.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.textureNorm16&&(this._gl.R16_EXT=33322,this._gl.RG16_EXT=33324,this._gl.RGB16_EXT=32852,this._gl.RGBA16_EXT=32859,this._gl.R16_SNORM_EXT=36760,this._gl.RG16_SNORM_EXT=36761,this._gl.RGB16_SNORM_EXT=36762,this._gl.RGBA16_SNORM_EXT=36763),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const h=this._gl.getExtension("WEBGL_draw_buffers");if(null!==h){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=h.drawBuffersWEBGL.bind(h),this._caps.maxDrawBuffers=this._gl.getParameter(h.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let d=0;d<16;d++)this._gl["COLOR_ATTACHMENT"+d+"_WEBGL"]=h["COLOR_ATTACHMENT"+d+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const h=this._gl.getExtension("WEBGL_depth_texture");null!=h&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=h.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const h=this._gl.getExtension("OES_vertex_array_object");null!=h&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=h.createVertexArrayOES.bind(h),this._gl.bindVertexArray=h.bindVertexArrayOES.bind(h),this._gl.deleteVertexArray=h.deleteVertexArrayOES.bind(h))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const h=this._gl.getExtension("ANGLE_instanced_arrays");null!=h?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=h.drawArraysInstancedANGLE.bind(h),this._gl.drawElementsInstanced=h.drawElementsInstancedANGLE.bind(h),this._gl.vertexAttribDivisor=h.vertexAttribDivisorANGLE.bind(h)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const h=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),d=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);h&&d&&(this._caps.highPrecisionShaderSupported=0!==h.precision&&0!==d.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const h=this._gl.getExtension("EXT_blend_minmax");null!=h&&(this._caps.blendMinMax=!0,this._gl.MAX=h.MAX_EXT,this._gl.MIN=h.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const h=this._gl.getExtension("EXT_sRGB");null!=h&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:h.SRGB_EXT,SRGB8:h.SRGB_ALPHA_EXT,SRGB8_ALPHA8:h.SRGB_ALPHA_EXT})}if(this._creationOptions){const h=this._creationOptions.forceSRGBBufferSupportState;void 0!==h&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&h)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let d=0;d<this._maxSimultaneousTextures;d++)this._nextFreeTextureSlots.push(d);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const h=this._workingCanvas.getContext("2d");h&&(this._workingContext=h)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const h=this.getGlInfo();return h&&h.renderer?h.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const A=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=A;let b=0;if(d&&h){let d=!0;if(this._currentRenderTarget){var w;const m=null===(w=this._currentRenderTarget.texture)||void 0===w?void 0:w.format;if(8===m||9===m||10===m||11===m){var a;const m=null===(a=this._currentRenderTarget.texture)||void 0===a?void 0:a.type;7===m||5===m?(C._TempClearColorUint32[0]=255*h.r,C._TempClearColorUint32[1]=255*h.g,C._TempClearColorUint32[2]=255*h.b,C._TempClearColorUint32[3]=255*h.a,this._gl.clearBufferuiv(this._gl.COLOR,0,C._TempClearColorUint32),d=!1):(C._TempClearColorInt32[0]=255*h.r,C._TempClearColorInt32[1]=255*h.g,C._TempClearColorInt32[2]=255*h.b,C._TempClearColorInt32[3]=255*h.a,this._gl.clearBufferiv(this._gl.COLOR,0,C._TempClearColorInt32),d=!1)}}d&&(this._gl.clearColor(h.r,h.g,h.b,void 0!==h.a?h.a:1),b|=this._gl.COLOR_BUFFER_BIT)}m&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),b|=this._gl.DEPTH_BUFFER_BIT),j&&(this._gl.clearStencil(0),b|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(b)}_viewport(h,d,m,j){h===this._viewportCached.x&&d===this._viewportCached.y&&m===this._viewportCached.z&&j===this._viewportCached.w||(this._viewportCached.x=h,this._viewportCached.y=d,this._viewportCached.z=m,this._viewportCached.w=j,this._gl.viewport(h,d,m,j))}Pq(){super.Pq(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0,j=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const D=h;this._currentRenderTarget&&this._resolveAndGenerateMipMapsFramebuffer(this._currentRenderTarget),this._currentRenderTarget=h,this._bindUnboundFramebuffer(D._framebuffer);const S=this._gl;var M;if(!h.isMulti)if(h.is2DArray||h.is3D)S.framebufferTextureLayer(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,null===(M=h.texture._hardwareTexture)||void 0===M?void 0:M.underlyingResource,w,a),D._currentLOD=w;else if(h.isCube){var q;S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+d,null===(q=h.texture._hardwareTexture)||void 0===q?void 0:q.underlyingResource,w)}else if(D._currentLOD!==w){var E;S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_2D,null===(E=h.texture._hardwareTexture)||void 0===E?void 0:E.underlyingResource,w),D._currentLOD=w}const I=h._depthStencilTexture;if(I){h.is3D&&(h.texture.width===I.width&&h.texture.height===I.height&&h.texture.depth===I.depth||b.c.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const m=h._depthStencilTextureWithStencil?S.DEPTH_STENCIL_ATTACHMENT:S.DEPTH_ATTACHMENT;var R;if(h.is2DArray||h.is3D)S.framebufferTextureLayer(S.FRAMEBUFFER,m,null===(R=I._hardwareTexture)||void 0===R?void 0:R.underlyingResource,w,a);else if(h.isCube){var Z;S.framebufferTexture2D(S.FRAMEBUFFER,m,S.TEXTURE_CUBE_MAP_POSITIVE_X+d,null===(Z=I._hardwareTexture)||void 0===Z?void 0:Z.underlyingResource,w)}else{var L;S.framebufferTexture2D(S.FRAMEBUFFER,m,S.TEXTURE_2D,null===(L=I._hardwareTexture)||void 0===L?void 0:L.underlyingResource,w)}}D._MSAAFramebuffer&&this._bindUnboundFramebuffer(D._MSAAFramebuffer),this._cachedViewport&&!A?this.setViewport(this._cachedViewport,m,j):(m||(m=h.width,w&&(m/=Math.pow(2,w))),j||(j=h.height,w&&(j/=Math.pow(2,w))),this._viewport(0,0,m,j)),this.wipeCaches()}setStateCullFaceType(h,d){const m=this.cullBackFaces??h??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==m||d)&&(this._depthCullingState.cullFace=m)}setState(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0,j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==h||m)&&(this._depthCullingState.cull=h),this.setStateCullFaceType(A,m),this.setZOffset(d),this.setZOffsetUnits(w);const a=j?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==a||m)&&(this._depthCullingState.frontFace=a),this._stencilStateComposer.stencilMaterial=b}_resolveAndGenerateMipMapsFramebuffer(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h.disableAutomaticMSAAResolve||(h.isMulti?this.resolveMultiFramebuffer(h):this.resolveFramebuffer(h)),d||(h.isMulti?this.generateMipMapsMultiFramebuffer(h):this.generateMipMapsFramebuffer(h))}_bindUnboundFramebuffer(h){this._currentFramebuffer!==h&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,h),this._currentFramebuffer=h)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(h){const d=this._getTextureTarget(h);this._bindTextureDirectly(d,h,!0),this._gl.generateMipmap(d),this._bindTextureDirectly(d,null)}unBindFramebuffer(h,d,m){const j=h;this._currentRenderTarget=null,this._resolveAndGenerateMipMapsFramebuffer(h,d),m&&(j._MSAAFramebuffer&&this._bindUnboundFramebuffer(j._framebuffer),m()),this._bindUnboundFramebuffer(null)}generateMipMapsFramebuffer(h){var d;h.isMulti||null===(d=h.texture)||void 0===d||!d.generateMipMaps||h.isCube||this.generateMipmaps(h.texture)}resolveFramebuffer(h){const d=h,m=this._gl;if(!d._MSAAFramebuffer||d.isMulti)return;let j=d.resolveMSAAColors?m.COLOR_BUFFER_BIT:0;j|=d._generateDepthBuffer&&d.resolveMSAADepth?m.DEPTH_BUFFER_BIT:0,j|=d._generateStencilBuffer&&d.resolveMSAAStencil?m.STENCIL_BUFFER_BIT:0,m.bindFramebuffer(m.READ_FRAMEBUFFER,d._MSAAFramebuffer),m.bindFramebuffer(m.DRAW_FRAMEBUFFER,d._framebuffer),m.blitFramebuffer(0,0,h.width,h.height,0,0,h.width,h.height,j,m.NEAREST)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(h,d,m){return this._createVertexBuffer(h,this._gl.STATIC_DRAW)}_createVertexBuffer(h,d){const m=this._gl.createBuffer();if(!m)throw new Error("Unable to create vertex buffer");const j=new M.e(m);return this.bindArrayBuffer(j),"number"!==typeof h?h instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(h),d),j.km=4*h.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,h,d),j.km=h.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(h),d),j.km=h),this._resetVertexBufferBinding(),j.references=1,j}createDynamicVertexBuffer(h,d){return this._createVertexBuffer(h,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(h,d,m){const j=this._gl.createBuffer(),A=new M.e(j);if(!j)throw new Error("Unable to create index buffer");this.bindIndexBuffer(A);const b=this._normalizeIndexData(h);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,b,d?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),A.references=1,A.is32Bits=4===b.BYTES_PER_ELEMENT,A}_normalizeIndexData(h){if(2===h.BYTES_PER_ELEMENT)return h;if(this._caps.uintIndices){if(h instanceof Uint32Array)return h;for(let d=0;d<h.length;d++)if(h[d]>=65535)return new Uint32Array(h);return new Uint16Array(h)}return new Uint16Array(h)}bindArrayBuffer(h){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(h,this._gl.ARRAY_BUFFER)}bindUniformBlock(h,d,m){const j=h.program,A=this._gl.getUniformBlockIndex(j,d);this._gl.uniformBlockBinding(j,A,m)}bindIndexBuffer(h){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(h,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(h,d){(this._vaoRecordInProgress||this._currentBoundBuffer[d]!==h)&&(this._gl.bindBuffer(d,h?h.underlyingResource:null),this._currentBoundBuffer[d]=h)}updateArrayBuffer(h){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,h)}_vertexAttribPointer(h,d,m,j,A,b,w){const a=this._currentBufferPointers[d];if(!a)return;let D=!1;a.active?(a.buffer!==h&&(a.buffer=h,D=!0),a.size!==m&&(a.size=m,D=!0),a.type!==j&&(a.type=j,D=!0),a.normalized!==A&&(a.normalized=A,D=!0),a.stride!==b&&(a.stride=b,D=!0),a.offset!==w&&(a.offset=w,D=!0)):(D=!0,a.active=!0,a.index=d,a.size=m,a.type=j,a.normalized=A,a.stride=b,a.offset=w,a.buffer=h),(D||this._vaoRecordInProgress)&&(this.bindArrayBuffer(h),j===this._gl.UNSIGNED_INT||j===this._gl.INT?this._gl.vertexAttribIPointer(d,m,j,b,w):this._gl.vertexAttribPointer(d,m,j,A,b,w))}_bindIndexBufferWithCache(h){null!=h&&this._cachedIndexBuffer!==h&&(this._cachedIndexBuffer=h,this.bindIndexBuffer(h),this._uintIndicesCurrentlySet=h.is32Bits)}_bindVertexBuffersAttributes(h,d,m){const j=d.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let A=0;A<j.length;A++){const b=d.getAttributeLocation(A);if(b>=0){const d=j[A];let w=null;if(m&&(w=m[d]),w||(w=h[d]),!w)continue;this._gl.enableVertexAttribArray(b),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[b]=!0);const a=w.getBuffer();a&&(this._vertexAttribPointer(a,b,w.getSize(),w.type,w.normalized,w.byteStride,w.byteOffset),w.getIsInstanced()&&(this._gl.vertexAttribDivisor(b,w.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(b),this._currentInstanceBuffers.push(a))))}}}recordVertexArrayObject(h,d,m,j){const A=this._gl.createVertexArray();if(!A)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(A),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(h,m,j),this.bindIndexBuffer(d),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),A}bindVertexArrayObject(h,d){this._cachedVertexArrayObject!==h&&(this._cachedVertexArrayObject=h,this._gl.bindVertexArray(h),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=d&&d.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(h,d,m,j,A){if(this._cachedVertexBuffers!==h||this._cachedEffectForVertexBuffers!==A){this._cachedVertexBuffers=h,this._cachedEffectForVertexBuffers=A;const d=A.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let b=0;for(let w=0;w<d;w++)if(w<m.length){const d=A.getAttributeLocation(w);d>=0&&(this._gl.enableVertexAttribArray(d),this._vertexAttribArraysEnabled[d]=!0,this._vertexAttribPointer(h,d,m[w],this._gl.FLOAT,!1,j,b)),b+=4*m[w]}}this._bindIndexBufferWithCache(d)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(h,d,m,j){this._cachedVertexBuffers===h&&this._cachedEffectForVertexBuffers===m||(this._cachedVertexBuffers=h,this._cachedEffectForVertexBuffers=m,this._bindVertexBuffersAttributes(h,m,j)),this._bindIndexBufferWithCache(d)}unbindInstanceAttributes(){let h;for(let d=0,m=this._currentInstanceLocations.length;d<m;d++){const m=this._currentInstanceBuffers[d];h!=m&&m.references&&(h=m,this.bindArrayBuffer(m));const j=this._currentInstanceLocations[d];this._gl.vertexAttribDivisor(j,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(h){this._gl.deleteVertexArray(h)}_releaseBuffer(h){return h.references--,0===h.references&&(this._deleteBuffer(h),!0)}_deleteBuffer(h){this._gl.deleteBuffer(h.underlyingResource)}updateAndBindInstancesBuffer(h,d,m){if(this.bindArrayBuffer(h),d&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,d),void 0!==m[0].index)this.bindInstancesBuffer(h,m,!0);else for(let j=0;j<4;j++){const d=m[j];this._vertexAttribArraysEnabled[d]||(this._gl.enableVertexAttribArray(d),this._vertexAttribArraysEnabled[d]=!0),this._vertexAttribPointer(h,d,4,this._gl.FLOAT,!1,64,16*j),this._gl.vertexAttribDivisor(d,1),this._currentInstanceLocations.push(d),this._currentInstanceBuffers.push(h)}}bindInstancesBuffer(h,d){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(h);let j=0;if(m)for(let A=0;A<d.length;A++){j+=4*d[A].attributeSize}for(let A=0;A<d.length;A++){const m=d[A];void 0===m.index&&(m.index=this._currentEffect.getAttributeLocationByName(m.attributeName)),m.index<0||(this._vertexAttribArraysEnabled[m.index]||(this._gl.enableVertexAttribArray(m.index),this._vertexAttribArraysEnabled[m.index]=!0),this._vertexAttribPointer(h,m.index,m.attributeSize,m.attributeType||this._gl.FLOAT,m.normalized||!1,j,m.offset),this._gl.vertexAttribDivisor(m.index,void 0===m.divisor?1:m.divisor),this._currentInstanceLocations.push(m.index),this._currentInstanceBuffers.push(h))}}disableInstanceAttributeByName(h){if(!this._currentEffect)return;const d=this._currentEffect.getAttributeLocationByName(h);this.disableInstanceAttribute(d)}disableInstanceAttribute(h){let d,m=!1;for(;-1!==(d=this._currentInstanceLocations.indexOf(h));)this._currentInstanceLocations.splice(d,1),this._currentInstanceBuffers.splice(d,1),m=!0,d=this._currentInstanceLocations.indexOf(h);m&&(this._gl.vertexAttribDivisor(h,0),this.disableAttributeByIndex(h))}disableAttributeByIndex(h){this._gl.disableVertexAttribArray(h),this._vertexAttribArraysEnabled[h]=!1,this._currentBufferPointers[h].active=!1}draw(h,d,m,j){this.drawElementsType(h?0:1,d,m,j)}drawPointClouds(h,d,m){this.drawArraysType(2,h,d,m)}drawUnIndexed(h,d,m,j){this.drawArraysType(h?0:1,d,m,j)}drawElementsType(h,d,m,j){this.applyStates(),this._reportDrawCall();const A=this._drawMode(h),b=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,w=this._uintIndicesCurrentlySet?4:2;j?this._gl.drawElementsInstanced(A,m,b,d*w,j):this._gl.drawElements(A,m,b,d*w)}drawArraysType(h,d,m,j){this.applyStates(),this._reportDrawCall();const A=this._drawMode(h);j?this._gl.drawArraysInstanced(A,d,m,j):this._gl.drawArrays(A,d,m)}_drawMode(h){switch(h){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(h){this._compiledEffects[h._key]&&delete this._compiledEffects[h._key];const d=h.getPipelineContext();d&&this._deletePipelineContext(d)}_deletePipelineContext(h){const d=h;d&&d.program&&(d.program.__SPECTOR_rebuildProgram=null,(0,B.m)(d),this._gl&&(this._currentProgram===d.program&&this._setProgram(null),this._gl.deleteProgram(d.program)))}_getGlobalDefines(h){return(0,L.j)(h,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(h,d,m,A,b,w,a,D,S){let M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,q=arguments.length>10?arguments[10]:void 0;const E="string"===typeof h?h:h.vertexToken||h.vertexSource||h.vertexElement||h.vertex,I="string"===typeof h?h:h.fragmentToken||h.fragmentSource||h.fragmentElement||h.fragment,R=this._getGlobalDefines(),L=void 0!==d.attributes;let B=b??d.defines??"";R&&(B+=R);const V=E+"+"+I+"@"+B;if(this._compiledEffects[V]){const h=this._compiledEffects[V];return a&&h.isReady()&&a(h),h._refCount++,h}this._gl&&(0,j.y)(this._gl);const v=new Z.e(h,d,L?this:m,A,this,b,w,a,D,S,V,d.shaderLanguage??M,d.extraInitializationsAsync??q);return this._compiledEffects[V]=v,v}_getShaderSource(h){return this._gl.getShaderSource(h)}createRawShaderProgram(h,d,m,A){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const w=(0,j.y)(this._gl);return w._contextWasLost=this._contextWasLost,w.validateShaderPrograms=this.validateShaderPrograms,(0,j.t)(h,d,m,A||this._gl,b)}createShaderProgram(h,d,m,A,b){let w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const a=(0,j.y)(this._gl);return a._contextWasLost=this._contextWasLost,a.validateShaderPrograms=this.validateShaderPrograms,(0,j.u)(h,d,m,A,b||this._gl,w)}inlineShaderCode(h){return h}createPipelineContext(h){if(this._gl){(0,j.y)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const d=(0,j.p)(this._gl,h);return d.sa=this,d}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(h){return(0,j.h)(h,this._gl,this.validateShaderPrograms)}_preparePipelineContextAsync(h,d,m,A,b,w,a,D,S,M,q){const E=(0,j.y)(this._gl);return E._contextWasLost=this._contextWasLost,E.validateShaderPrograms=this.validateShaderPrograms,E._createShaderProgramInjection=this._createShaderProgram.bind(this),E.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),E.createShaderProgramInjection=this.createShaderProgram.bind(this),E.loadFileInjection=this._loadFile.bind(this),(0,j.l)(h,d,m,A,b,w,a,D,S,M,q)}_createShaderProgram(h,d,m,A){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,j.c)(h,d,m,A,b)}_isRenderingStateCompiled(h){return!this._isDisposed&&(0,j.i)(h,this._gl,this.validateShaderPrograms)}_executeWhenRenderingStateIsCompiled(h,d){(0,j.e)(h,d)}getUniforms(h,d){const m=new Array,j=h;for(let A=0;A<d.length;A++)m.push(this._gl.getUniformLocation(j.program,d[A]));return m}getAttributes(h,d){const m=[],j=h;for(let b=0;b<d.length;b++)try{m.push(this._gl.getAttribLocation(j.program,d[b]))}catch(A){m.push(-1)}return m}enableEffect(h){(h=null!==h&&(0,A.b)(h)?h.effect:h)&&h!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(h),this._currentEffect=h,h.onBind&&h.onBind(h),h._onBindObservable&&h._onBindObservable.notifyObservers(h))}setInt(h,d){return!!h&&(this._gl.uniform1i(h,d),!0)}setInt2(h,d,m){return!!h&&(this._gl.uniform2i(h,d,m),!0)}setInt3(h,d,m,j){return!!h&&(this._gl.uniform3i(h,d,m,j),!0)}setInt4(h,d,m,j,A){return!!h&&(this._gl.uniform4i(h,d,m,j,A),!0)}setIntArray(h,d){return!!h&&(this._gl.uniform1iv(h,d),!0)}setIntArray2(h,d){return!(!h||d.length%2!==0)&&(this._gl.uniform2iv(h,d),!0)}setIntArray3(h,d){return!(!h||d.length%3!==0)&&(this._gl.uniform3iv(h,d),!0)}setIntArray4(h,d){return!(!h||d.length%4!==0)&&(this._gl.uniform4iv(h,d),!0)}setUInt(h,d){return!!h&&(this._gl.uniform1ui(h,d),!0)}setUInt2(h,d,m){return!!h&&(this._gl.uniform2ui(h,d,m),!0)}setUInt3(h,d,m,j){return!!h&&(this._gl.uniform3ui(h,d,m,j),!0)}setUInt4(h,d,m,j,A){return!!h&&(this._gl.uniform4ui(h,d,m,j,A),!0)}setUIntArray(h,d){return!!h&&(this._gl.uniform1uiv(h,d),!0)}setUIntArray2(h,d){return!(!h||d.length%2!==0)&&(this._gl.uniform2uiv(h,d),!0)}setUIntArray3(h,d){return!(!h||d.length%3!==0)&&(this._gl.uniform3uiv(h,d),!0)}setUIntArray4(h,d){return!(!h||d.length%4!==0)&&(this._gl.uniform4uiv(h,d),!0)}setArray(h,d){return!!h&&(!(d.length<1)&&(this._gl.uniform1fv(h,d),!0))}setArray2(h,d){return!(!h||d.length%2!==0)&&(this._gl.uniform2fv(h,d),!0)}setArray3(h,d){return!(!h||d.length%3!==0)&&(this._gl.uniform3fv(h,d),!0)}setArray4(h,d){return!(!h||d.length%4!==0)&&(this._gl.uniform4fv(h,d),!0)}setMatrices(h,d){return!!h&&(this._gl.uniformMatrix4fv(h,!1,d),!0)}setMatrix3x3(h,d){return!!h&&(this._gl.uniformMatrix3fv(h,!1,d),!0)}setMatrix2x2(h,d){return!!h&&(this._gl.uniformMatrix2fv(h,!1,d),!0)}setFloat(h,d){return!!h&&(this._gl.uniform1f(h,d),!0)}setFloat2(h,d,m){return!!h&&(this._gl.uniform2f(h,d,m),!0)}setFloat3(h,d,m,j){return!!h&&(this._gl.uniform3f(h,d,m,j),!0)}setFloat4(h,d,m,j,A){return!!h&&(this._gl.uniform4f(h,d,m,j,A),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const h=this._colorWrite;this._gl.colorMask(h,h,h,h)}}wipeCaches(h){this.preventCacheWipeBetweenFrames&&!h||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),h&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(h,d){const m=this._gl;let j=m.NEAREST,A=m.NEAREST,b=!1;switch(h){case 11:j=m.LINEAR,A=d?m.LINEAR_MIPMAP_NEAREST:m.LINEAR;break;case 3:j=m.LINEAR,b=!0,A=d?m.LINEAR_MIPMAP_LINEAR:m.LINEAR;break;case 8:b=!0,j=m.NEAREST,A=d?m.NEAREST_MIPMAP_LINEAR:m.NEAREST;break;case 4:j=m.NEAREST,A=d?m.NEAREST_MIPMAP_NEAREST:m.NEAREST;break;case 5:j=m.NEAREST,A=d?m.LINEAR_MIPMAP_NEAREST:m.LINEAR;break;case 6:b=!0,j=m.NEAREST,A=d?m.LINEAR_MIPMAP_LINEAR:m.LINEAR;break;case 7:j=m.NEAREST,A=m.LINEAR;break;case 1:j=m.NEAREST,A=m.NEAREST;break;case 9:j=m.LINEAR,A=d?m.NEAREST_MIPMAP_NEAREST:m.NEAREST;break;case 10:b=!0,j=m.LINEAR,A=d?m.NEAREST_MIPMAP_LINEAR:m.NEAREST;break;case 2:j=m.LINEAR,A=m.LINEAR;break;case 12:j=m.LINEAR,A=m.NEAREST}return{min:A,mag:j,hasMipMaps:b}}_createTexture(){const h=this._gl.createTexture();if(!h)throw new Error("Unable to create texture");return h}_createHardwareTexture(){return new I.e(this._createTexture(),this._gl)}_createInternalTexture(h,d){let m,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=!1,w=!1,a=0,D=3,S=5,M=!1,q=1,E=!1,I=0;void 0!==d&&"object"===typeof d?(A=!!d.generateMipMaps,w=!!d.createMipMaps,a=void 0===d.type?0:d.type,D=void 0===d.samplingMode?3:d.samplingMode,S=void 0===d.format?5:d.format,M=void 0!==d.useSRGBBuffer&&d.useSRGBBuffer,q=d.samples??1,m=d.label,E=!!d.createMSAATexture,I=d.comparisonFunction||0):A=!!d,M&&(M=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==a||this._caps.textureFloatLinearFiltering)&&(2!==a||this._caps.textureHalfFloatLinearFiltering)||(D=1),1!==a||this._caps.textureFloat||(a=0,b.c.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const Z=(0,V.e)(S),L=(0,V.b)(S),B=this._gl,v=new R.c(this,j),C=h.width||h,T=h.height||h,o=h.depth||0,y=h.layers||0,i=this._getSamplingParameters(D,(A||w)&&!Z),g=0!==y?B.TEXTURE_2D_ARRAY:0!==o?B.TEXTURE_3D:B.TEXTURE_2D,F=Z?this._getInternalFormatFromDepthTextureFormat(S,!0,L):this._getRGBABufferInternalSizedFormat(a,S,M),f=Z?L?B.DEPTH_STENCIL:B.DEPTH_COMPONENT:this._getInternalFormat(S),H=Z?this._getWebGLTextureTypeFromDepthTextureFormat(S):this._getWebGLTextureType(a);if(this._bindTextureDirectly(g,v),0!==y?(v.is2DArray=!0,B.texImage3D(g,0,F,C,T,y,0,f,H,null)):0!==o?(v.is3D=!0,B.texImage3D(g,0,F,C,T,o,0,f,H,null)):B.texImage2D(g,0,F,C,T,0,f,H,null),B.texParameteri(g,B.TEXTURE_MAG_FILTER,i.mag),B.texParameteri(g,B.TEXTURE_MIN_FILTER,i.min),B.texParameteri(g,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(g,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),Z&&this.webGLVersion>1&&(0===I?(B.texParameteri(g,B.TEXTURE_COMPARE_FUNC,515),B.texParameteri(g,B.TEXTURE_COMPARE_MODE,B.NONE)):(B.texParameteri(g,B.TEXTURE_COMPARE_FUNC,I),B.texParameteri(g,B.TEXTURE_COMPARE_MODE,B.COMPARE_REF_TO_TEXTURE))),(A||w)&&this._gl.generateMipmap(g),this._bindTextureDirectly(g,null),v._useSRGBBuffer=M,v.baseWidth=C,v.baseHeight=T,v.width=C,v.height=T,v.depth=y||o,v.isReady=!0,v.samples=q,v.generateMipMaps=A,v.samplingMode=D,v.type=a,v.format=S,v.label=m,v.comparisonFunction=I,this._internalTexturesCache.push(v),E){let h=null;if(h=(0,V.e)(v.format)?this._setupFramebufferDepthAttachments((0,V.b)(v.format),19!==v.format,v.width,v.height,q,v.format,!0):this._createRenderBuffer(v.width,v.height,q,-1,this._getRGBABufferInternalSizedFormat(v.type,v.format,v._useSRGBBuffer),-1),!h)throw new Error("Unable to create render buffer");v._autoMSAAManagement=!0;let d=v._hardwareTexture;d||(d=v._hardwareTexture=this._createHardwareTexture()),d.addMSAARenderBuffer(h)}return v}_getUseSRGBBuffer(h,d){return h&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||d)}createTexture(h,d,m,j){var A=this;let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,E=arguments.length>11?arguments[11]:void 0,I=arguments.length>12?arguments[12]:void 0,Z=arguments.length>13?arguments[13]:void 0,L=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(h,d,m,j,b,w,a,(function(){for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];return A._prepareWebGLTexture(...d,M)}),((h,d,m,A,b,w)=>{const a=this._gl,D=m.width===h&&m.height===d;b._creationFlags=Z??0;const S=this._getTexImageParametersForCreateTexture(b.format,b._useSRGBBuffer);if(D)return a.texImage2D(a.TEXTURE_2D,0,S.internalFormat,S.format,S.type,m),!1;const M=this._caps.maxTextureSize;if(m.width>M||m.height>M||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=h,this._workingCanvas.height=d,this._workingContext.drawImage(m,0,0,m.width,m.height,0,0,h,d),a.texImage2D(a.TEXTURE_2D,0,S.internalFormat,S.format,S.type,this._workingCanvas),b.width=h,b.height=d,!1);{const h=new R.c(this,2);this._bindTextureDirectly(a.TEXTURE_2D,h,!0),a.texImage2D(a.TEXTURE_2D,0,S.internalFormat,S.format,S.type,m),this._rescaleTexture(h,b,j,S.format,(()=>{this._releaseTexture(h),this._bindTextureDirectly(a.TEXTURE_2D,b,!0),w()}))}return!0}),D,S,M,q,E,I,L)}_getTexImageParametersForCreateTexture(h,d){let m,j;return 1===this.webGLVersion?(m=this._getInternalFormat(h,d),j=m):(m=this._getInternalFormat(h,!1),j=this._getRGBABufferInternalSizedFormat(0,h,d)),{internalFormat:j,format:m,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(h,d,m,j,A){}_unpackFlipY(h){this._unpackFlipYCached!==h&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,h?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=h))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(h){return h.isCube?this._gl.TEXTURE_CUBE_MAP:h.is3D?this._gl.TEXTURE_3D:h.is2DArray||h.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=this._getTextureTarget(d),A=this._getSamplingParameters(h,d.useMipMaps||m);this._setTextureParameterInteger(j,this._gl.TEXTURE_MAG_FILTER,A.mag,d),this._setTextureParameterInteger(j,this._gl.TEXTURE_MIN_FILTER,A.min),m&&A.hasMipMaps&&(d.generateMipMaps=!0,this._gl.generateMipmap(j)),this._bindTextureDirectly(j,null),d.samplingMode=h}updateTextureDimensions(h,d,m){}updateTextureWrappingMode(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const A=this._getTextureTarget(h);null!==d&&(this._setTextureParameterInteger(A,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(d),h),h._cachedWrapU=d),null!==m&&(this._setTextureParameterInteger(A,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(m),h),h._cachedWrapV=m),(h.is2DArray||h.is3D)&&null!==j&&(this._setTextureParameterInteger(A,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(j),h),h._cachedWrapR=j),this._bindTextureDirectly(A,null)}_uploadCompressedDataToTextureDirectly(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const a=this._gl;let D=a.TEXTURE_2D;if(h.isCube&&(D=a.TEXTURE_CUBE_MAP_POSITIVE_X+b),h._useSRGBBuffer)switch(d){case 37492:case 36196:this._caps.etc2?d=a.COMPRESSED_SRGB8_ETC2:h._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?d=a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:h._useSRGBBuffer=!1;break;case 36492:d=a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:d=a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?d=a.COMPRESSED_SRGB_S3TC_DXT1_EXT:h._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?d=a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:h._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?d=a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:h._useSRGBBuffer=!1;break;default:h._useSRGBBuffer=!1}this._gl.compressedTexImage2D(D,w,d,m,j,0,A)}_uploadDataToTextureDirectly(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const w=this._gl,a=this._getWebGLTextureType(h.type),D=this._getInternalFormat(h.format),S=void 0===A?this._getRGBABufferInternalSizedFormat(h.type,h.format,h._useSRGBBuffer):this._getInternalFormat(A,h._useSRGBBuffer);this._unpackFlipY(h.invertY);let M=w.TEXTURE_2D;h.isCube&&(M=w.TEXTURE_CUBE_MAP_POSITIVE_X+m);const q=Math.round(Math.log(h.width)*Math.LOG2E),E=Math.round(Math.log(h.height)*Math.LOG2E),I=b?h.width:Math.pow(2,Math.max(q-j,0)),R=b?h.height:Math.pow(2,Math.max(E-j,0));w.texImage2D(M,j,S,I,R,0,D,a,d)}updateTextureData(h,d,m,j,A,b){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,D=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const S=this._gl,M=this._getWebGLTextureType(h.type),q=this._getInternalFormat(h.format);this._unpackFlipY(h.invertY);let E=S.TEXTURE_2D,I=S.TEXTURE_2D;h.isCube&&(I=S.TEXTURE_CUBE_MAP_POSITIVE_X+w,E=S.TEXTURE_CUBE_MAP),this._bindTextureDirectly(E,h,!0),S.texSubImage2D(I,a,m,j,A,b,q,M,d),D&&this._gl.generateMipmap(I),this._bindTextureDirectly(E,null)}_uploadArrayBufferViewToTexture(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const A=this._gl,b=h.isCube?A.TEXTURE_CUBE_MAP:A.TEXTURE_2D;this._bindTextureDirectly(b,h,!0),this._uploadDataToTextureDirectly(h,d,m,j),this._bindTextureDirectly(b,null,!0)}_prepareWebGLTextureContinuation(h,d,m,j,A){const b=this._gl;if(!b)return;const w=this._getSamplingParameters(A,!m);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,w.mag),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,w.min),m||j||b.generateMipmap(b.TEXTURE_2D),this._bindTextureDirectly(b.TEXTURE_2D,null),d&&d.removePendingData(h),h.onLoadedObservable.notifyObservers(h),h.onLoadedObservable.clear()}_prepareWebGLTexture(h,d,m,j,A,b,w,a,D,S){const M=this.getCaps().maxTextureSize,E=Math.min(M,this.needPOTTextures?(0,q.f)(j.width,M):j.width),I=Math.min(M,this.needPOTTextures?(0,q.f)(j.height,M):j.height),R=this._gl;R&&(h._hardwareTexture?(this._bindTextureDirectly(R.TEXTURE_2D,h,!0),this._unpackFlipY(void 0===A||!!A),h.baseWidth=j.width,h.baseHeight=j.height,h.width=E,h.height=I,h.isReady=!0,h.type=-1!==h.type?h.type:0,h.format=-1!==h.format?h.format:S??(".jpg"!==d||h._useSRGBBuffer?5:4),a(E,I,j,d,h,(()=>{this._prepareWebGLTextureContinuation(h,m,b,w,D)}))||this._prepareWebGLTextureContinuation(h,m,b,w,D)):m&&m.removePendingData(h))}_getInternalFormatFromDepthTextureFormat(h,d,m){const j=this._gl;if(!d)return j.STENCIL_INDEX8;let A=m?j.DEPTH_STENCIL:j.DEPTH_COMPONENT;return this.webGLVersion>1?15===h?A=j.DEPTH_COMPONENT16:16===h?A=j.DEPTH_COMPONENT24:17===h||13===h?A=m?j.DEPTH24_STENCIL8:j.DEPTH_COMPONENT24:14===h?A=j.DEPTH_COMPONENT32F:18===h&&(A=m?j.DEPTH32F_STENCIL8:j.DEPTH_COMPONENT32F):A=j.DEPTH_COMPONENT16,A}_getWebGLTextureTypeFromDepthTextureFormat(h){const d=this._gl;let m=d.UNSIGNED_INT;return 15===h?m=d.UNSIGNED_SHORT:17===h||13===h?m=d.UNSIGNED_INT_24_8:14===h?m=d.FLOAT:18===h?m=d.FLOAT_32_UNSIGNED_INT_24_8_REV:19===h&&(m=d.UNSIGNED_BYTE),m}_setupFramebufferDepthAttachments(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,b=arguments.length>5?arguments[5]:void 0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const a=this._gl;b=b??(h?13:14);const D=this._getInternalFormatFromDepthTextureFormat(b,d,h);return h&&d?this._createRenderBuffer(m,j,A,a.DEPTH_STENCIL,D,w?-1:a.DEPTH_STENCIL_ATTACHMENT):d?this._createRenderBuffer(m,j,A,D,D,w?-1:a.DEPTH_ATTACHMENT):h?this._createRenderBuffer(m,j,A,D,D,w?-1:a.STENCIL_ATTACHMENT):null}_createRenderBuffer(h,d,m,j,A,b){let w=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const a=this._gl.createRenderbuffer();return this._updateRenderBuffer(a,h,d,m,j,A,b,w)}_updateRenderBuffer(h,d,m,j,A,b,w){let a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const D=this._gl;return D.bindRenderbuffer(D.RENDERBUFFER,h),j>1&&D.renderbufferStorageMultisample?D.renderbufferStorageMultisample(D.RENDERBUFFER,j,b,d,m):D.renderbufferStorage(D.RENDERBUFFER,A,d,m),-1!==w&&D.framebufferRenderbuffer(D.FRAMEBUFFER,w,D.RENDERBUFFER,h),a&&D.bindRenderbuffer(D.RENDERBUFFER,null),h}_releaseTexture(h){this._deleteTexture(h._hardwareTexture),this.unbindAllTextures();const d=this._internalTexturesCache.indexOf(h);-1!==d&&this._internalTexturesCache.splice(d,1),h._lodTextureHigh&&h._lodTextureHigh.dispose(),h._lodTextureMid&&h._lodTextureMid.dispose(),h._lodTextureLow&&h._lodTextureLow.dispose(),h._irradianceTexture&&h._irradianceTexture.dispose()}_deleteTexture(h){null===h||void 0===h||h.release()}_setProgram(h){this._currentProgram!==h&&((0,j.o)(h,this._gl),this._currentProgram=h)}bindSamplers(h){const d=h.getPipelineContext();this._setProgram(d.program);const m=h.getSamplers();for(let j=0;j<m.length;j++){const d=h.getUniform(m[j]);d&&(this._boundUniforms[j]=d)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=!1;const w=d&&d._associatedChannel>-1;m&&w&&(this._activeChannel=d._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==d||j){if(this._activateCurrentTexture(),d&&d.isMultiview)throw b.c.Error(["_bindTextureDirectly called with a multiview texture!",h,d]),"_bindTextureDirectly called with a multiview texture!";var a;this._gl.bindTexture(h,(null===d||void 0===d||null===(a=d._hardwareTexture)||void 0===a?void 0:a.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=d,d&&(d._associatedChannel=this._activeChannel)}else m&&(A=!0,this._activateCurrentTexture());return w&&!m&&this._bindSamplerUniformToChannel(d._associatedChannel,this._activeChannel),A}_bindTexture(h,d,m){if(void 0===h)return;d&&(d._associatedChannel=h),this._activeChannel=h;const j=d?this._getTextureTarget(d):this._gl.TEXTURE_2D;this._bindTextureDirectly(j,d)}unbindAllTextures(){for(let h=0;h<this._maxSimultaneousTextures;h++)this._activeChannel=h,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(h,d,m,j){void 0!==h&&(d&&(this._boundUniforms[h]=d),this._setTexture(h,m))}_bindSamplerUniformToChannel(h,d){const m=this._boundUniforms[h];m&&m._currentState!==d&&(this._gl.uniform1i(m,d),m._currentState=d)}_getTextureWrapMode(h){switch(h){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(h,d){let m,j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!d)return null!=this._boundTexturesCache[h]&&(this._activeChannel=h,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(d.video){this._activeChannel=h;const m=d.getInternalTexture();m&&(m._associatedChannel=h),d.update()}else if(4===d.delayLoadState)return d.delayLoad(),!1;m=A?d.depthStencilTexture:d.isReady()?d.getInternalTexture():d.isCube?this.emptyCubeTexture:d.is3D?this.emptyTexture3D:d.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!j&&m&&(m._associatedChannel=h);let b=!0;this._boundTexturesCache[h]===m&&(j||this._bindSamplerUniformToChannel(m._associatedChannel,h),b=!1),this._activeChannel=h;const w=this._getTextureTarget(m);if(b&&this._bindTextureDirectly(w,m,j),m&&!m.isMultiview){if(m.isCube&&m._cachedCoordinatesMode!==d.coordinatesMode){m._cachedCoordinatesMode=d.coordinatesMode;const h=3!==d.coordinatesMode&&5!==d.coordinatesMode?1:0;d.wrapU=h,d.wrapV=h}m._cachedWrapU!==d.wrapU&&(m._cachedWrapU=d.wrapU,this._setTextureParameterInteger(w,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(d.wrapU),m)),m._cachedWrapV!==d.wrapV&&(m._cachedWrapV=d.wrapV,this._setTextureParameterInteger(w,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(d.wrapV),m)),m.is3D&&m._cachedWrapR!==d.wrapR&&(m._cachedWrapR=d.wrapR,this._setTextureParameterInteger(w,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(d.wrapR),m)),this._setAnisotropicLevel(w,m,d.anisotropicFilteringLevel)}return!0}setTextureArray(h,d,m,j){if(void 0!==h&&d){this._textureUnits&&this._textureUnits.length===m.length||(this._textureUnits=new Int32Array(m.length));for(let d=0;d<m.length;d++){const j=m[d].getInternalTexture();j?(this._textureUnits[d]=h+d,j._associatedChannel=h+d):this._textureUnits[d]=-1}this._gl.uniform1iv(d,this._textureUnits);for(let h=0;h<m.length;h++)this._setTexture(this._textureUnits[h],m[h],!0)}}_setAnisotropicLevel(h,d,m){const j=this._caps.textureAnisotropicFilterExtension;11!==d.samplingMode&&3!==d.samplingMode&&2!==d.samplingMode&&(m=1),j&&d._cachedAnisotropicFilteringLevel!==m&&(this._setTextureParameterFloat(h,j.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(m,this._caps.maxAnisotropy),d),d._cachedAnisotropicFilteringLevel=m)}_setTextureParameterFloat(h,d,m,j){this._bindTextureDirectly(h,j,!0,!0),this._gl.texParameterf(h,d,m)}_setTextureParameterInteger(h,d,m,j){j&&this._bindTextureDirectly(h,j,!0,!0),this._gl.texParameteri(h,d,m)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let h=0;h<this._caps.maxVertexAttribs;h++)this.disableAttributeByIndex(h)}else for(let h=0,d=this._vertexAttribArraysEnabled.length;h<d;h++)h>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[h]||this.disableAttributeByIndex(h)}releaseEffects(){this._compiledEffects={},this.onReleaseEffectsObservable.notifyObservers(this)}dispose(){var h;((0,w.j)()&&this._renderingCanvas&&(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._onContextRestored&&this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(h=this._gl.getExtension("WEBGL_lose_context"))||void 0===h||h.loseContext());(0,j.v)(this._gl)}attachContextLostEvent(h){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",h,!1)}attachContextRestoredEvent(h){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",h,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(h){const d=this._gl;for(;d.getError()!==d.NO_ERROR;);let m=!0;const j=d.createTexture();d.bindTexture(d.TEXTURE_2D,j),d.texImage2D(d.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(h),1,1,0,d.RGBA,this._getWebGLTextureType(h),null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);const A=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,A),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,j,0);const b=d.checkFramebufferStatus(d.FRAMEBUFFER);if(m=m&&b===d.FRAMEBUFFER_COMPLETE,m=m&&d.getError()===d.NO_ERROR,m&&(d.clear(d.COLOR_BUFFER_BIT),m=m&&d.getError()===d.NO_ERROR),m){d.bindFramebuffer(d.FRAMEBUFFER,null);const h=d.RGBA,j=d.UNSIGNED_BYTE,A=new Uint8Array(4);d.readPixels(0,0,1,1,h,j,A),m=m&&d.getError()===d.NO_ERROR}for(d.deleteTexture(j),d.deleteFramebuffer(A),d.bindFramebuffer(d.FRAMEBUFFER,null);!m&&d.getError()!==d.NO_ERROR;);return m}_getWebGLTextureType(h){if(1===this._webGLVersion){switch(h){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(h){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=d?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(h){case 0:m=this._gl.ALPHA;break;case 1:m=this._gl.LUMINANCE;break;case 2:m=this._gl.LUMINANCE_ALPHA;break;case 6:case 33322:case 36760:m=this._gl.RED;break;case 7:case 33324:case 36761:m=this._gl.RG;break;case 4:case 32852:case 36762:m=d?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:case 32859:case 36763:m=d?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(h){case 8:m=this._gl.RED_INTEGER;break;case 9:m=this._gl.RG_INTEGER;break;case 10:m=this._gl.RGB_INTEGER;break;case 11:m=this._gl.RGBA_INTEGER}return m}_getRGBABufferInternalSizedFormat(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==d)switch(d){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return m?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(h){case 3:switch(d){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(d){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return m?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return m?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(d){case 8:return this._gl.R16I;case 36760:return this._gl.R16_SNORM_EXT;case 36761:return this._gl.RG16_SNORM_EXT;case 36762:return this._gl.RGB16_SNORM_EXT;case 36763:return this._gl.RGBA16_SNORM_EXT;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(d){case 8:return this._gl.R16UI;case 33322:return this._gl.R16_EXT;case 33324:return this._gl.RG16_EXT;case 32852:return this._gl.RGB16_EXT;case 32859:return this._gl.RGBA16_EXT;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(d){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(d){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(d){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(d){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(d){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return m?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(h,d,m,j){let A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],w=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const D=A?4:3,S=A?this._gl.RGBA:this._gl.RGB,M=m*j*D;if(a){if(a.length<M)return b.c.Error(`Data buffer is too small to store the read pixels (${a.length} should be more than ${M})`),Promise.resolve(a)}else a=new Uint8Array(M);return w&&this.flushFramebuffer(),this._gl.readPixels(h,d,m,j,S,this._gl.UNSIGNED_BYTE,a),Promise.resolve(a)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const h=E.b._CreateCanvas(1,1),d=h.getContext("webgl")||h.getContext("experimental-webgl");this._IsSupported=null!=d&&!!window.WebGLRenderingContext}catch(h){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const h=E.b._CreateCanvas(1,1),d=h.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||h.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!d}catch(h){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}C._TempClearColorUint32=new Uint32Array(4),C._TempClearColorInt32=new Int32Array(4),C.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],C._ConcatenateShader=L.i,C._IsSupported=null,C._HasMajorPerformanceCaveat=null},11635:(h,d,m)=>{var j;m.d(d,{e:()=>A}),function(h){h[h.PointerMove=0]="PointerMove",h[h.PointerDown=1]="PointerDown",h[h.PointerUp=2]="PointerUp"}(j||(j={}));class A{}A.DOM_DELTA_PIXEL=0,A.DOM_DELTA_LINE=1,A.DOM_DELTA_PAGE=2},11632:(h,d,m)=>{m.d(d,{b:()=>j,f:()=>b,i:()=>A});class j{}j.KEYDOWN=1,j.KEYUP=2;class A{constructor(h,d){this.type=h,this.event=d}}class b extends A{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(h){this.skipOnKeyboardObservable=h}constructor(h,d){super(h,d),this.type=h,this.event=d,this.skipOnKeyboardObservable=!1}}},11624:(h,d,m)=>{m.d(d,{d:()=>A,g:()=>w,i:()=>a});var j=m(11058);class A{}A.POINTERDOWN=1,A.POINTERUP=2,A.POINTERMOVE=4,A.POINTERWHEEL=8,A.POINTERPICK=16,A.POINTERTAP=32,A.POINTERDOUBLETAP=64;class b{constructor(h,d){this.type=h,this.event=d}}class w extends b{constructor(h,d,m,A){super(h,d),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new j.h(m,A)}}class a extends b{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(h,d),this._pickInfo=m,this._inputManager=j}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},11736:(h,d,m)=>{m.d(d,{d:()=>E});var j=m(11258),A=m(11261),b=m(11058),w=m(11353),a=m(11374),D=m(11335),S=m(11080),M=m(11359),q=m(11341);class E extends a.b{get range(){return this._range}set range(h){this._range=h,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(h){this._intensityMode=h,this._computePhotometricScale()}get radius(){return this._radius}set radius(h){this._radius=h,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(h){this._shadowEnabled!==h&&(this._shadowEnabled=h,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(h){this._includedOnlyMeshes=h,this._hookArrayForIncludedOnly(h)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(h){this._excludedMeshes=h,this._hookArrayForExcluded(h)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(h){this._excludeWithLayerMask=h,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(h){this._includeOnlyWithLayerMask=h,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(h){this._lightmapMode!==h&&(this._lightmapMode=h,this._markMeshesAsLightDirty())}getViewMatrix(h){return null}getProjectionMatrix(h,d){return null}constructor(h,d){super(h,d,!1),this.Db=new w.d(1,1,1),this.TM=new w.d(1,1,1),this.falloffType=E.FALLOFF_DEFAULT,this.ab=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=E.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.ih().addLight(this),this._uniformBuffer=new D.d(this.ih().getEngine(),void 0,void 0,h),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(h,d){return this}_bindLight(h,d,m,j){let A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const b=h.toString();let a=!1;if(this._uniformBuffer.bindToEffect(m,"Light"+b),this._renderId!==d.getRenderId()||this._lastUseSpecular!==j||!this._uniformBuffer.useUbo){this._renderId=d.getRenderId(),this._lastUseSpecular=j;const h=this.getScaledIntensity();this.transferToEffect(m,b),this.Db.scaleToRef(h,w.g.qb[0]),this._uniformBuffer.updateColor4("vLightDiffuse",w.g.qb[0],this.range,b),j&&(this.TM.scaleToRef(h,w.g.qb[1]),this._uniformBuffer.updateColor4("vLightSpecular",w.g.qb[1],this.radius,b)),a=!0}if(this.transferTexturesToEffect(m,b),d.shadowsEnabled&&this.shadowEnabled&&A){const h=this.getShadowGenerator(d.activeCamera)??this.getShadowGenerator();h&&(h.bindShadowLight(b,m),a=!0)}a?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(h){let d="Name: "+this.name;if(d+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let m=0;m<this.animations.length;m++)d+=", animation[0]: "+this.animations[m].toString(h);return d}_syncParentEnabledState(){super._syncParentEnabledState(),this.q()||this._resyncMeshes()}jD(h){super.jD(h),this._resyncMeshes()}getShadowGenerator(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(h)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return b.i.Zero()}canAffectMesh(h){return!h||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(h))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(h))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&h.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&h.layerMask)))}dispose(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const h=this._shadowGenerators.values();for(let d=h.next();!0!==d.done;d=h.next()){d.value.dispose()}this._shadowGenerators=null}if(this.ih().stopAnimation(this),this._parentContainer){const h=this._parentContainer.lights.indexOf(this);h>-1&&this._parentContainer.lights.splice(h,1),this._parentContainer=null}for(const m of this.ih().meshes)m._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.ih().removeLight(this),super.dispose(h,d)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.ab}clone(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=E.GetConstructorFromName(this.getTypeID(),h,this.ih());if(!m)return null;const j=q.d.Clone(m,this);return h&&(j.name=h),d&&(j.parent=d),j.jD(this.isEnabled()),this.onClonedObservable.notifyObservers(j),j}serialize(){const h=q.d.Serialize(this);if(h.uniqueId=this.uniqueId,h.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(h),this.excludedMeshes.length>0){h.excludedMeshesIds=[];for(const d of this.excludedMeshes)h.excludedMeshesIds.push(d.id)}if(this.includedOnlyMeshes.length>0){h.includedOnlyMeshesIds=[];for(const d of this.includedOnlyMeshes)h.includedOnlyMeshesIds.push(d.id)}return q.d.AppendSerializedAnimations(this,h),h.ranges=this.serializeAnimationRanges(),h.isEnabled=this.isEnabled(),h}static GetConstructorFromName(h,d,m){const j=a.b.Construct("Light_Type_"+h,d,m);return j||null}static Parse(h,d){const m=E.GetConstructorFromName(h.type,h.name,d);if(!m)return null;const j=q.d.Parse(m,h,d);if(h.excludedMeshesIds&&(j._excludedMeshesIds=h.excludedMeshesIds),h.includedOnlyMeshesIds&&(j._includedOnlyMeshesIds=h.includedOnlyMeshesIds),void 0!==h.parentId&&(j._waitingParentId=h.parentId),void 0!==h.parentInstanceIndex&&(j._waitingParentInstanceIndex=h.parentInstanceIndex),void 0!==h.falloffType&&(j.falloffType=h.falloffType),void 0!==h.lightmapMode&&(j.lightmapMode=h.lightmapMode),h.animations){for(let d=0;d<h.animations.length;d++){const m=h.animations[d],A=(0,S.e)("BABYLON.Animation");A&&j.animations.push(A.Parse(m))}a.b.ParseAnimationRanges(j,h,d)}return h.autoAnimate&&d.beginAnimation(j,h.autoAnimateFrom,h.autoAnimateTo,h.autoAnimateLoop,h.autoAnimateSpeed||1),void 0!==h.isEnabled&&j.jD(h.isEnabled),j}_hookArrayForExcluded(h){var d=this;const m=h.push;h.push=function(){for(var j=arguments.length,A=new Array(j),b=0;b<j;b++)A[b]=arguments[b];const w=m.apply(h,A);for(const h of A)h._resyncLightSource(d);return w};const j=h.splice;h.splice=(d,m)=>{const A=j.apply(h,[d,m]);for(const h of A)h._resyncLightSource(this);return A};for(const A of h)A._resyncLightSource(this)}_hookArrayForIncludedOnly(h){var d=this;const m=h.push;h.push=function(){for(var j=arguments.length,A=new Array(j),b=0;b<j;b++)A[b]=arguments[b];const w=m.apply(h,A);return d._resyncMeshes(),w};const j=h.splice;h.splice=(d,m)=>{const A=j.apply(h,[d,m]);return this._resyncMeshes(),A},this._resyncMeshes()}_resyncMeshes(){for(const h of this.ih().meshes)h._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const h of this.ih().meshes)-1!==h.lightSources.indexOf(this)&&h._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.ih().resetCachedMaterial()}_getPhotometricScale(){let h=0;const d=this.getTypeID();let m=this.intensityMode;switch(m===E.INTENSITYMODE_AUTOMATIC&&(m=d===E.LIGHTTYPEID_DIRECTIONALLIGHT?E.INTENSITYMODE_ILLUMINANCE:E.INTENSITYMODE_LUMINOUSINTENSITY),d){case E.LIGHTTYPEID_POINTLIGHT:case E.LIGHTTYPEID_SPOTLIGHT:switch(m){case E.INTENSITYMODE_LUMINOUSPOWER:h=1/(4*Math.PI);break;case E.INTENSITYMODE_LUMINOUSINTENSITY:h=1;break;case E.INTENSITYMODE_LUMINANCE:h=this.radius*this.radius}break;case E.LIGHTTYPEID_DIRECTIONALLIGHT:switch(m){case E.INTENSITYMODE_ILLUMINANCE:h=1;break;case E.INTENSITYMODE_LUMINANCE:{let d=this.radius;d=Math.max(d,.001);h=2*Math.PI*(1-Math.cos(d));break}}break;case E.LIGHTTYPEID_HEMISPHERICLIGHT:h=1}return h}_reorderLightsInScene(){const h=this.ih();0!=this._renderPriority&&(h.requireLightSorting=!0),this.ih().sortLightsByPriority()}_isReady(){return!0}}E.FALLOFF_DEFAULT=M.d.FALLOFF_DEFAULT,E.FALLOFF_PHYSICAL=M.d.FALLOFF_PHYSICAL,E.FALLOFF_GLTF=M.d.FALLOFF_GLTF,E.FALLOFF_STANDARD=M.d.FALLOFF_STANDARD,E.LIGHTMAP_DEFAULT=M.d.LIGHTMAP_DEFAULT,E.LIGHTMAP_SPECULAR=M.d.LIGHTMAP_SPECULAR,E.LIGHTMAP_SHADOWSONLY=M.d.LIGHTMAP_SHADOWSONLY,E.INTENSITYMODE_AUTOMATIC=M.d.INTENSITYMODE_AUTOMATIC,E.INTENSITYMODE_LUMINOUSPOWER=M.d.INTENSITYMODE_LUMINOUSPOWER,E.INTENSITYMODE_LUMINOUSINTENSITY=M.d.INTENSITYMODE_LUMINOUSINTENSITY,E.INTENSITYMODE_ILLUMINANCE=M.d.INTENSITYMODE_ILLUMINANCE,E.INTENSITYMODE_LUMINANCE=M.d.INTENSITYMODE_LUMINANCE,E.LIGHTTYPEID_POINTLIGHT=M.d.LIGHTTYPEID_POINTLIGHT,E.LIGHTTYPEID_DIRECTIONALLIGHT=M.d.LIGHTTYPEID_DIRECTIONALLIGHT,E.LIGHTTYPEID_SPOTLIGHT=M.d.LIGHTTYPEID_SPOTLIGHT,E.LIGHTTYPEID_HEMISPHERICLIGHT=M.d.LIGHTTYPEID_HEMISPHERICLIGHT,E.LIGHTTYPEID_RECT_AREALIGHT=M.d.LIGHTTYPEID_RECT_AREALIGHT,(0,j.d)([(0,A.j)()],E.prototype,"diffuse",void 0),(0,j.d)([(0,A.j)()],E.prototype,"specular",void 0),(0,j.d)([(0,A.M)()],E.prototype,"falloffType",void 0),(0,j.d)([(0,A.M)()],E.prototype,"intensity",void 0),(0,j.d)([(0,A.M)()],E.prototype,"range",null),(0,j.d)([(0,A.M)()],E.prototype,"intensityMode",null),(0,j.d)([(0,A.M)()],E.prototype,"radius",null),(0,j.d)([(0,A.M)()],E.prototype,"_renderPriority",void 0),(0,j.d)([(0,A.b)("_reorderLightsInScene")],E.prototype,"renderPriority",void 0),(0,j.d)([(0,A.M)("shadowEnabled")],E.prototype,"_shadowEnabled",void 0),(0,j.d)([(0,A.M)("excludeWithLayerMask")],E.prototype,"_excludeWithLayerMask",void 0),(0,j.d)([(0,A.M)("includeOnlyWithLayerMask")],E.prototype,"_includeOnlyWithLayerMask",void 0),(0,j.d)([(0,A.M)("lightmapMode")],E.prototype,"_lightmapMode",void 0)},11359:(h,d,m)=>{m.d(d,{d:()=>j});class j{static CompareLightsPriority(h,d){return h.shadowEnabled!==d.shadowEnabled?(d.shadowEnabled?1:0)-(h.shadowEnabled?1:0):d.renderPriority-h.renderPriority}}j.FALLOFF_DEFAULT=0,j.FALLOFF_PHYSICAL=1,j.FALLOFF_GLTF=2,j.FALLOFF_STANDARD=3,j.LIGHTMAP_DEFAULT=0,j.LIGHTMAP_SPECULAR=1,j.LIGHTMAP_SHADOWSONLY=2,j.INTENSITYMODE_AUTOMATIC=0,j.INTENSITYMODE_LUMINOUSPOWER=1,j.INTENSITYMODE_LUMINOUSINTENSITY=2,j.INTENSITYMODE_ILLUMINANCE=3,j.INTENSITYMODE_LUMINANCE=4,j.LIGHTTYPEID_POINTLIGHT=0,j.LIGHTTYPEID_DIRECTIONALLIGHT=1,j.LIGHTTYPEID_SPOTLIGHT=2,j.LIGHTTYPEID_HEMISPHERICLIGHT=3,j.LIGHTTYPEID_RECT_AREALIGHT=4},11809:(h,d,m)=>{m.d(d,{c:()=>D});var j=m(11258),A=m(11261),b=m(11058),w=m(11736),a=m(11407);class D extends w.d{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=b.b.Identity(),this._projectionMatrix=b.b.Identity()}_setPosition(h){this._position=h}get position(){return this._position}set position(h){this._setPosition(h)}_setDirection(h){this._direction=h}get direction(){return this._direction}set direction(h){this._setDirection(h)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(h){this._shadowMinZ=h,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(h){this._shadowMaxZ=h,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=b.i.Zero()),b.i.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=b.i.Zero()),b.i.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(h){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(h){return this.direction=b.i.Normalize(h.fm(this.position)),this.direction}getRotation(){this.direction.normalize();const h=b.i.Cross(this.direction,a.e.Y),d=b.i.Cross(h,this.direction);return b.i.RotationFromAxis(h,d,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=b.i.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Zd(h){return!h&&this.isSynchronized()?(this._currentRenderId=this.ih().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.D(this.position),this._worldMatrix||(this._worldMatrix=b.b.Identity()),b.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(h){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===h||void 0===h?void 0:h.jb)||0}getDepthMaxZ(h){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===h||void 0===h?void 0:h.maxZ)||1e4}setShadowProjectionMatrix(h,d,m){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(d,m,h):this._setDefaultShadowProjectionMatrix(h,d,m),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(h){const d=b.d.Qd[0];let m=this.position;this.computeTransformedInformation()&&(m=this.transformedPosition),b.i.NormalizeToRef(this.getShadowDirection(h),d),1===Math.abs(b.i.Dot(d,b.i.Up()))&&(d.z=1e-13);const j=b.d.Qd[1];return m.addToRef(d,j),b.b.LookAtLHToRef(m,j,b.i.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(h,d){return this.setShadowProjectionMatrix(this._projectionMatrix,h??this._viewMatrix,d??[]),this._projectionMatrix}}(0,j.d)([(0,A.K)()],D.prototype,"position",null),(0,j.d)([(0,A.K)()],D.prototype,"direction",null),(0,j.d)([(0,A.M)()],D.prototype,"shadowMinZ",null),(0,j.d)([(0,A.M)()],D.prototype,"shadowMaxZ",null)},11445:(h,d,m)=>{m.d(d,{c:()=>j});class j{static get ForceFullSceneLoadingForIncremental(){return j._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(h){j._ForceFullSceneLoadingForIncremental=h}static get ShowLoadingScreen(){return j._ShowLoadingScreen}static set ShowLoadingScreen(h){j._ShowLoadingScreen=h}static get loggingLevel(){return j._LoggingLevel}static set loggingLevel(h){j._LoggingLevel=h}static get CleanBoneMatrixWeights(){return j._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(h){j._CleanBoneMatrixWeights=h}}j._ForceFullSceneLoadingForIncremental=!1,j._ShowLoadingScreen=!0,j._CleanBoneMatrixWeights=!1,j._LoggingLevel=0},11602:(h,d,m)=>{m.d(d,{c:()=>t});var j=m(11258),A=m(11261),b=m(11121),w=m(11430),a=m(11595),D=m(11604),S=m(11058),M=m(11281),q=m(11647),E=m(11651);class I extends q.e{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class R extends E.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(h,"PBRBRDF",90,new I,d),this._useEnergyConservation=R.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=R.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=R.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=R.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=R.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=R.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=R.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=R.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=R.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=R.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=R.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=R.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=R.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=R.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=R.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=R.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=R.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=R.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=h._dirtyCallbacks[16],this._enable(!0)}prepareDefines(h){h.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,h.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,h.SPHERICAL_HARMONICS=this._useSphericalHarmonics,h.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,h.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,h.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,h.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,h.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,h.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}R.DEFAULT_USE_ENERGY_CONSERVATION=!0,R.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,R.DEFAULT_USE_SPHERICAL_HARMONICS=!0,R.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,R.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,R.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,R.DEFAULT_DIFFUSE_MODEL=0,R.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,R.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsMiscDirty")],R.prototype,"useEnergyConservation",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsMiscDirty")],R.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsMiscDirty")],R.prototype,"useSphericalHarmonics",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsMiscDirty")],R.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsMiscDirty")],R.prototype,"mixIblRadianceWithIrradiance",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsMiscDirty")],R.prototype,"useLegacySpecularEnergyConservation",void 0),(0,j.d)([(0,A.M)("baseDiffuseModel"),(0,A.b)("_markAllSubMeshesAsMiscDirty")],R.prototype,"baseDiffuseModel",void 0),(0,j.d)([(0,A.M)("dielectricSpecularModel"),(0,A.b)("_markAllSubMeshesAsMiscDirty")],R.prototype,"dielectricSpecularModel",void 0),(0,j.d)([(0,A.M)("conductorSpecularModel"),(0,A.b)("_markAllSubMeshesAsMiscDirty")],R.prototype,"conductorSpecularModel",void 0);var Z=m(11658),L=m(11353),B=m(11606),V=m(11251),v=m(11663),C=m(11543),T=m(11670),o=(m(11675),m(11684)),y=m(11357);class i extends q.e{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class g extends E.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(h,"PBRClearCoat",100,new i,d),this._isEnabled=!1,this.isEnabled=!1,this.ab=1,this.roughness=0,this._indexOfRefraction=g._DefaultIndexOfRefraction,this.indexOfRefraction=g._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=L.d.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=h._dirtyCallbacks[1]}isReadyForSubMesh(h,d,m){if(!this._isEnabled)return!0;const j=this._material._disableBumpMap;if(h._areTexturesDirty&&d.texturesEnabled){if(this._texture&&T.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&T.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(m.getCaps().standardDerivatives&&this._bumpTexture&&T.e.ClearCoatBumpTextureEnabled&&!j&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&T.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(h,d){this._isEnabled?(h.CLEARCOAT=!0,h.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,h.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,h._areTexturesDirty&&d.texturesEnabled&&(this._texture&&T.e.ClearCoatTextureEnabled?(0,y.T)(this._texture,h,"CLEARCOAT_TEXTURE"):h.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&T.e.ClearCoatTextureEnabled?(0,y.T)(this._textureRoughness,h,"CLEARCOAT_TEXTURE_ROUGHNESS"):h.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&T.e.ClearCoatBumpTextureEnabled?(0,y.T)(this._bumpTexture,h,"CLEARCOAT_BUMP"):h.CLEARCOAT_BUMP=!1,h.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===g._DefaultIndexOfRefraction,this._isTintEnabled?(h.CLEARCOAT_TINT=!0,this._tintTexture&&T.e.ClearCoatTintTextureEnabled?((0,y.T)(this._tintTexture,h,"CLEARCOAT_TINT_TEXTURE"),h.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):h.CLEARCOAT_TINT_TEXTURE=!1):(h.CLEARCOAT_TINT=!1,h.CLEARCOAT_TINT_TEXTURE=!1))):(h.CLEARCOAT=!1,h.CLEARCOAT_TEXTURE=!1,h.CLEARCOAT_TEXTURE_ROUGHNESS=!1,h.CLEARCOAT_BUMP=!1,h.CLEARCOAT_TINT=!1,h.CLEARCOAT_TINT_TEXTURE=!1,h.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,h.CLEARCOAT_DEFAULTIOR=!1,h.CLEARCOAT_TEXTUREDIRECTUV=0,h.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,h.CLEARCOAT_BUMPDIRECTUV=0,h.CLEARCOAT_REMAP_F0=!1,h.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,h.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(h,d,m,j){if(!this._isEnabled)return;const A=j.materialDefines,b=this._material.isFrozen,w=this._material._disableBumpMap,a=this._material._invertNormalMapX,D=this._material._invertNormalMapY;if(!h.useUbo||!b||!h.isSync){var S,M,q,E;if((this._texture||this._textureRoughness)&&T.e.ClearCoatTextureEnabled)h.updateFloat4("vClearCoatInfos",(null===(S=this._texture)||void 0===S?void 0:S.coordinatesIndex)??0,(null===(M=this._texture)||void 0===M?void 0:M.level)??0,(null===(q=this._textureRoughness)||void 0===q?void 0:q.coordinatesIndex)??0,(null===(E=this._textureRoughness)||void 0===E?void 0:E.level)??0),this._texture&&(0,y.t)(this._texture,h,"clearCoat"),this._textureRoughness&&!A.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,y.t)(this._textureRoughness,h,"clearCoatRoughness");this._bumpTexture&&m.getCaps().standardDerivatives&&T.e.ClearCoatTextureEnabled&&!w&&(h.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,y.t)(this._bumpTexture,h,"clearCoatBump"),d._mirroredCameraPosition?h.updateFloat2("vClearCoatTangentSpaceParams",a?1:-1,D?1:-1):h.updateFloat2("vClearCoatTangentSpaceParams",a?-1:1,D?-1:1)),this._tintTexture&&T.e.ClearCoatTintTextureEnabled&&(h.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,y.t)(this._tintTexture,h,"clearCoatTint")),h.updateFloat2("vClearCoatParams",this.ab,this.roughness);const j=1-this._indexOfRefraction,b=1+this._indexOfRefraction,I=Math.pow(-j/b,2),R=1/this._indexOfRefraction;h.updateFloat4("vClearCoatRefractionParams",I,R,j,b),this._isTintEnabled&&(h.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),h.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}d.texturesEnabled&&(this._texture&&T.e.ClearCoatTextureEnabled&&h.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!A.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&T.e.ClearCoatTextureEnabled&&h.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&m.getCaps().standardDerivatives&&T.e.ClearCoatBumpTextureEnabled&&!w&&h.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&T.e.ClearCoatTintTextureEnabled&&h.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(h){return this._texture===h||(this._textureRoughness===h||(this._bumpTexture===h||this._tintTexture===h))}getActiveTextures(h){this._texture&&h.push(this._texture),this._textureRoughness&&h.push(this._textureRoughness),this._bumpTexture&&h.push(this._bumpTexture),this._tintTexture&&h.push(this._tintTexture)}getAnimatables(h){this._texture&&this._texture.animations&&this._texture.animations.length>0&&h.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&h.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&h.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&h.push(this._tintTexture)}dispose(h){var d,m,j,A;h&&(null===(d=this._texture)||void 0===d||d.dispose(),null===(m=this._textureRoughness)||void 0===m||m.dispose(),null===(j=this._bumpTexture)||void 0===j||j.dispose(),null===(A=this._tintTexture)||void 0===A||A.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(h,d,m){return h.CLEARCOAT_BUMP&&d.addFallback(m++,"CLEARCOAT_BUMP"),h.CLEARCOAT_TINT&&d.addFallback(m++,"CLEARCOAT_TINT"),h.CLEARCOAT&&d.addFallback(m++,"CLEARCOAT"),m}getSamplers(h){h.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}g._DefaultIndexOfRefraction=1.5,(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"isEnabled",void 0),(0,j.d)([(0,A.M)()],g.prototype,"intensity",void 0),(0,j.d)([(0,A.M)()],g.prototype,"roughness",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"indexOfRefraction",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"texture",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useRoughnessFromMainTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"textureRoughness",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"remapF0OnInterfaceChange",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"bumpTexture",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"isTintEnabled",void 0),(0,j.d)([(0,A.j)()],g.prototype,"tintColor",void 0),(0,j.d)([(0,A.M)()],g.prototype,"tintColorAtDistance",void 0),(0,j.d)([(0,A.M)()],g.prototype,"tintThickness",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"tintTexture",void 0);class F extends q.e{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class f extends E.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(h,"PBRIridescence",110,new F,d),this._isEnabled=!1,this.isEnabled=!1,this.ab=1,this.minimumThickness=f._DefaultMinimumThickness,this.maximumThickness=f._DefaultMaximumThickness,this.indexOfRefraction=f._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=h._dirtyCallbacks[1]}isReadyForSubMesh(h,d){if(!this._isEnabled)return!0;if(h._areTexturesDirty&&d.texturesEnabled){if(this._texture&&T.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&T.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(h,d){this._isEnabled?(h.IRIDESCENCE=!0,h._areTexturesDirty&&d.texturesEnabled&&(this._texture&&T.e.IridescenceTextureEnabled?(0,y.T)(this._texture,h,"IRIDESCENCE_TEXTURE"):h.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&T.e.IridescenceTextureEnabled?(0,y.T)(this._thicknessTexture,h,"IRIDESCENCE_THICKNESS_TEXTURE"):h.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(h.IRIDESCENCE=!1,h.IRIDESCENCE_TEXTURE=!1,h.IRIDESCENCE_THICKNESS_TEXTURE=!1,h.IRIDESCENCE_TEXTUREDIRECTUV=0,h.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(h,d){if(!this._isEnabled)return;const m=this._material.isFrozen;if(!h.useUbo||!m||!h.isSync){var j,A,b,w;if((this._texture||this._thicknessTexture)&&T.e.IridescenceTextureEnabled)h.updateFloat4("vIridescenceInfos",(null===(j=this._texture)||void 0===j?void 0:j.coordinatesIndex)??0,(null===(A=this._texture)||void 0===A?void 0:A.level)??0,(null===(b=this._thicknessTexture)||void 0===b?void 0:b.coordinatesIndex)??0,(null===(w=this._thicknessTexture)||void 0===w?void 0:w.level)??0),this._texture&&(0,y.t)(this._texture,h,"iridescence"),this._thicknessTexture&&(0,y.t)(this._thicknessTexture,h,"iridescenceThickness");h.updateFloat4("vIridescenceParams",this.ab,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}d.texturesEnabled&&(this._texture&&T.e.IridescenceTextureEnabled&&h.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&T.e.IridescenceTextureEnabled&&h.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(h){return this._texture===h||this._thicknessTexture===h}getActiveTextures(h){this._texture&&h.push(this._texture),this._thicknessTexture&&h.push(this._thicknessTexture)}getAnimatables(h){this._texture&&this._texture.animations&&this._texture.animations.length>0&&h.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&h.push(this._thicknessTexture)}dispose(h){var d,m;h&&(null===(d=this._texture)||void 0===d||d.dispose(),null===(m=this._thicknessTexture)||void 0===m||m.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(h,d,m){return h.IRIDESCENCE&&d.addFallback(m++,"IRIDESCENCE"),m}getSamplers(h){h.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}f._DefaultMinimumThickness=100,f._DefaultMaximumThickness=400,f._DefaultIndexOfRefraction=1.3,(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"isEnabled",void 0),(0,j.d)([(0,A.M)()],f.prototype,"intensity",void 0),(0,j.d)([(0,A.M)()],f.prototype,"minimumThickness",void 0),(0,j.d)([(0,A.M)()],f.prototype,"maximumThickness",void 0),(0,j.d)([(0,A.M)()],f.prototype,"indexOfRefraction",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"texture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],f.prototype,"thicknessTexture",void 0);class H extends q.e{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class c extends E.c{set angle(h){this.direction.x=Math.cos(h),this.direction.y=Math.sin(h)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(h,"PBRAnisotropic",110,new H,d),this._isEnabled=!1,this.isEnabled=!1,this.ab=1,this.direction=new S.h(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=h._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=h._dirtyCallbacks[16]}isReadyForSubMesh(h,d){return!this._isEnabled||!(h._areTexturesDirty&&d.texturesEnabled&&this._texture&&T.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(h,d,m){this._isEnabled?(h.ANISOTROPIC=this._isEnabled,this._isEnabled&&!m.isVerticesDataPresent(M.d.TangentKind)&&(h._needUVs=!0,h.MAINUV1=!0),h._areTexturesDirty&&d.texturesEnabled&&(this._texture&&T.e.AnisotropicTextureEnabled?(0,y.T)(this._texture,h,"ANISOTROPIC_TEXTURE"):h.ANISOTROPIC_TEXTURE=!1),h._areMiscDirty&&(h.ANISOTROPIC_LEGACY=this._legacy)):(h.ANISOTROPIC=!1,h.ANISOTROPIC_TEXTURE=!1,h.ANISOTROPIC_TEXTUREDIRECTUV=0,h.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(h,d){if(!this._isEnabled)return;const m=this._material.isFrozen;h.useUbo&&m&&h.isSync||(this._texture&&T.e.AnisotropicTextureEnabled&&(h.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,y.t)(this._texture,h,"anisotropy")),h.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.ab)),d.texturesEnabled&&this._texture&&T.e.AnisotropicTextureEnabled&&h.setTexture("anisotropySampler",this._texture)}hasTexture(h){return this._texture===h}getActiveTextures(h){this._texture&&h.push(this._texture)}getAnimatables(h){this._texture&&this._texture.animations&&this._texture.animations.length>0&&h.push(this._texture)}dispose(h){h&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(h,d,m){return h.ANISOTROPIC&&d.addFallback(m++,"ANISOTROPIC"),m}getSamplers(h){h.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(h,d,m){super.parse(h,d,m),void 0===h.legacy&&(this.legacy=!0)}}(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"isEnabled",void 0),(0,j.d)([(0,A.M)()],c.prototype,"intensity",void 0),(0,j.d)([(0,A.G)()],c.prototype,"direction",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"texture",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsMiscDirty")],c.prototype,"legacy",void 0);class k extends q.e{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class l extends E.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(h,"Sheen",120,new k,d),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.ab=1,this.color=L.d.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=h._dirtyCallbacks[1]}isReadyForSubMesh(h,d){if(!this._isEnabled)return!0;if(h._areTexturesDirty&&d.texturesEnabled){if(this._texture&&T.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&T.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(h,d){this._isEnabled?(h.SHEEN=!0,h.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,h.SHEEN_ROUGHNESS=null!==this._roughness,h.SHEEN_ALBEDOSCALING=this._albedoScaling,h.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,h._areTexturesDirty&&d.texturesEnabled&&(this._texture&&T.e.SheenTextureEnabled?((0,y.T)(this._texture,h,"SHEEN_TEXTURE"),h.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):h.SHEEN_TEXTURE=!1,this._textureRoughness&&T.e.SheenTextureEnabled?(0,y.T)(this._textureRoughness,h,"SHEEN_TEXTURE_ROUGHNESS"):h.SHEEN_TEXTURE_ROUGHNESS=!1)):(h.SHEEN=!1,h.SHEEN_TEXTURE=!1,h.SHEEN_TEXTURE_ROUGHNESS=!1,h.SHEEN_LINKWITHALBEDO=!1,h.SHEEN_ROUGHNESS=!1,h.SHEEN_ALBEDOSCALING=!1,h.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,h.SHEEN_GAMMATEXTURE=!1,h.SHEEN_TEXTUREDIRECTUV=0,h.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(h,d,m,j){if(!this._isEnabled)return;const A=j.materialDefines,b=this._material.isFrozen;if(!h.useUbo||!b||!h.isSync){var w,a,D,S;if((this._texture||this._textureRoughness)&&T.e.SheenTextureEnabled)h.updateFloat4("vSheenInfos",(null===(w=this._texture)||void 0===w?void 0:w.coordinatesIndex)??0,(null===(a=this._texture)||void 0===a?void 0:a.level)??0,(null===(D=this._textureRoughness)||void 0===D?void 0:D.coordinatesIndex)??0,(null===(S=this._textureRoughness)||void 0===S?void 0:S.level)??0),this._texture&&(0,y.t)(this._texture,h,"sheen"),this._textureRoughness&&!A.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,y.t)(this._textureRoughness,h,"sheenRoughness");h.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.ab),null!==this._roughness&&h.updateFloat("vSheenRoughness",this._roughness)}d.texturesEnabled&&(this._texture&&T.e.SheenTextureEnabled&&h.setTexture("sheenSampler",this._texture),this._textureRoughness&&!A.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&T.e.SheenTextureEnabled&&h.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(h){return this._texture===h||this._textureRoughness===h}getActiveTextures(h){this._texture&&h.push(this._texture),this._textureRoughness&&h.push(this._textureRoughness)}getAnimatables(h){this._texture&&this._texture.animations&&this._texture.animations.length>0&&h.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&h.push(this._textureRoughness)}dispose(h){var d,m;h&&(null===(d=this._texture)||void 0===d||d.dispose(),null===(m=this._textureRoughness)||void 0===m||m.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(h,d,m){return h.SHEEN&&d.addFallback(m++,"SHEEN"),m}getSamplers(h){h.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isEnabled",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"linkSheenWithAlbedo",void 0),(0,j.d)([(0,A.M)()],l.prototype,"intensity",void 0),(0,j.d)([(0,A.j)()],l.prototype,"color",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"texture",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useRoughnessFromMainTexture",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"roughness",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"textureRoughness",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"albedoScaling",void 0);class K extends q.e{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class N extends E.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(h){this._scene.enableSubSurfaceForPrePass()&&h&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(h))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(h){this._volumeIndexOfRefraction=h>=1?h:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(h,"PBRSubSurface",130,new K,d),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=L.d.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=L.d.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=N.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=N.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=h.ih(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=h._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=h._dirtyCallbacks[32]}isReadyForSubMesh(h,d){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(h._areTexturesDirty&&d.texturesEnabled){if(this._thicknessTexture&&T.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&T.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&T.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const h=this._getRefractionTexture(d);if(h&&T.e.RefractionTextureEnabled&&!h.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(h,d){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return h.SUBSURFACE=!1,h.SS_DISPERSION=!1,h.SS_TRANSLUCENCY=!1,h.SS_SCATTERING=!1,h.SS_REFRACTION=!1,h.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,h.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,h.SS_THICKNESSANDMASK_TEXTURE=!1,h.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,h.SS_HAS_THICKNESS=!1,h.SS_REFRACTIONINTENSITY_TEXTURE=!1,h.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,h.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,h.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,h.SS_REFRACTIONMAP_3D=!1,h.SS_REFRACTIONMAP_OPPOSITEZ=!1,h.SS_LODINREFRACTIONALPHA=!1,h.SS_GAMMAREFRACTION=!1,h.SS_RGBDREFRACTION=!1,h.SS_LINEARSPECULARREFRACTION=!1,h.SS_LINKREFRACTIONTOTRANSPARENCY=!1,h.SS_ALBEDOFORREFRACTIONTINT=!1,h.SS_ALBEDOFORTRANSLUCENCYTINT=!1,h.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,h.SS_USE_THICKNESS_AS_DEPTH=!1,h.SS_USE_GLTF_TEXTURES=!1,h.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,h.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,h.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(h.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(h._areTexturesDirty){if(h.SUBSURFACE=!0,h.SS_DISPERSION=this._isDispersionEnabled,h.SS_TRANSLUCENCY=this._isTranslucencyEnabled,h.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,h.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,h.SS_SCATTERING=this._isScatteringEnabled,h.SS_THICKNESSANDMASK_TEXTURE=!1,h.SS_REFRACTIONINTENSITY_TEXTURE=!1,h.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,h.SS_HAS_THICKNESS=!1,h.SS_USE_GLTF_TEXTURES=!1,h.SS_REFRACTION=!1,h.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,h.SS_REFRACTIONMAP_3D=!1,h.SS_GAMMAREFRACTION=!1,h.SS_RGBDREFRACTION=!1,h.SS_LINEARSPECULARREFRACTION=!1,h.SS_REFRACTIONMAP_OPPOSITEZ=!1,h.SS_LODINREFRACTIONALPHA=!1,h.SS_LINKREFRACTIONTOTRANSPARENCY=!1,h.SS_ALBEDOFORREFRACTIONTINT=!1,h.SS_ALBEDOFORTRANSLUCENCYTINT=!1,h.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,h.SS_USE_THICKNESS_AS_DEPTH=!1,h.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,h.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,h._areTexturesDirty&&d.texturesEnabled&&(this._thicknessTexture&&T.e.ThicknessTextureEnabled&&(0,y.T)(this._thicknessTexture,h,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&T.e.RefractionIntensityTextureEnabled&&(0,y.T)(this._refractionIntensityTexture,h,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&T.e.TranslucencyIntensityTextureEnabled&&(0,y.T)(this._translucencyIntensityTexture,h,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&T.e.TranslucencyColorTextureEnabled&&((0,y.T)(this._translucencyColorTexture,h,"SS_TRANSLUCENCYCOLOR_TEXTURE"),h.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),h.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,h.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,h.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,h.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&d.texturesEnabled){const m=this._getRefractionTexture(d);m&&T.e.RefractionTextureEnabled&&(h.SS_REFRACTION=!0,h.SS_REFRACTIONMAP_3D=m.isCube,h.SS_GAMMAREFRACTION=m.gammaSpace,h.SS_RGBDREFRACTION=m.isRGBD,h.SS_LINEARSPECULARREFRACTION=m.linearSpecularLOD,h.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&m.isCube?!m.invertZ:m.invertZ,h.SS_LODINREFRACTIONALPHA=m.lodLevelInAlpha,h.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,h.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,h.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=m.isCube&&m.boundingBoxSize,h.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(h.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(h,d,m,j){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)h.updateFloat2("vThicknessParam",0,0);else{j.getRenderingMesh().getWorldMatrix().decompose(S.d.Qd[0]);const d=Math.max(Math.abs(S.d.Qd[0].x),Math.abs(S.d.Qd[0].y),Math.abs(S.d.Qd[0].z));h.updateFloat2("vThicknessParam",this.minimumThickness*d,(this.maximumThickness-this.minimumThickness)*d)}}bindForSubMesh(h,d,m,j){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const A=j.materialDefines,b=this._material.isFrozen,w=this._material.realTimeFiltering,a=A.LODBASEDMICROSFURACE,D=this._getRefractionTexture(d);if(!h.useUbo||!b||!h.isSync){if(this._thicknessTexture&&T.e.ThicknessTextureEnabled&&(h.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,y.t)(this._thicknessTexture,h,"thickness")),this._refractionIntensityTexture&&T.e.RefractionIntensityTextureEnabled&&A.SS_REFRACTIONINTENSITY_TEXTURE&&(h.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,y.t)(this._refractionIntensityTexture,h,"refractionIntensity")),this._translucencyColorTexture&&T.e.TranslucencyColorTextureEnabled&&A.SS_TRANSLUCENCYCOLOR_TEXTURE&&(h.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,y.t)(this._translucencyColorTexture,h,"translucencyColor")),this._translucencyIntensityTexture&&T.e.TranslucencyIntensityTextureEnabled&&A.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(h.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,y.t)(this._translucencyIntensityTexture,h,"translucencyIntensity")),D&&T.e.RefractionTextureEnabled){h.hb("refractionMatrix",D.getRefractionTextureMatrix());let d=1;D.isCube||D.depth&&(d=D.depth);const m=D.getSize().width,j=this.volumeIndexOfRefraction;if(h.updateFloat4("vRefractionInfos",D.level,1/j,d,this._invertRefractionY?-1:1),h.updateFloat4("vRefractionMicrosurfaceInfos",m,D.lodGenerationScale,D.lodGenerationOffset,1/this.indexOfRefraction),w&&h.updateFloat2("vRefractionFilteringInfo",m,Math.log2(m)),D.boundingBoxSize){const d=D;h.updateVector3("vRefractionPosition",d.boundingBoxPosition),h.updateVector3("vRefractionSize",d.boundingBoxSize)}}this._isScatteringEnabled&&h.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),h.updateColor3("vDiffusionDistance",this.diffusionDistance),h.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),h.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),h.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),h.updateFloat("dispersion",this.dispersion)}d.texturesEnabled&&(this._thicknessTexture&&T.e.ThicknessTextureEnabled&&h.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&T.e.RefractionIntensityTextureEnabled&&A.SS_REFRACTIONINTENSITY_TEXTURE&&h.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&T.e.TranslucencyIntensityTextureEnabled&&A.SS_TRANSLUCENCYINTENSITY_TEXTURE&&h.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&T.e.TranslucencyColorTextureEnabled&&A.SS_TRANSLUCENCYCOLOR_TEXTURE&&h.setTexture("translucencyColorSampler",this._translucencyColorTexture),D&&T.e.RefractionTextureEnabled&&(a?h.setTexture("refractionSampler",D):(h.setTexture("refractionSampler",D._lodTextureMid||D),h.setTexture("refractionSamplerLow",D._lodTextureLow||D),h.setTexture("refractionSamplerHigh",D._lodTextureHigh||D))))}_getRefractionTexture(h){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?h.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(h){T.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&h.push(this._refractionTexture)}hasTexture(h){return this._thicknessTexture===h||(this._refractionTexture===h||(this._refractionIntensityTexture===h||(this._translucencyIntensityTexture===h||this._translucencyColorTexture===h)))}hasRenderTargetTextures(){return!!(T.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(h){this._thicknessTexture&&h.push(this._thicknessTexture),this._refractionTexture&&h.push(this._refractionTexture),this._translucencyColorTexture&&h.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&h.push(this._translucencyIntensityTexture)}getAnimatables(h){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&h.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&h.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&h.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&h.push(this._translucencyIntensityTexture)}dispose(h){h&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(h,d,m){return h.SS_SCATTERING&&d.addFallback(m++,"SS_SCATTERING"),h.SS_TRANSLUCENCY&&d.addFallback(m++,"SS_TRANSLUCENCY"),m}getSamplers(h){h.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}N.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,N.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"isRefractionEnabled",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"isTranslucencyEnabled",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"isDispersionEnabled",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markScenePrePassDirty")],N.prototype,"isScatteringEnabled",void 0),(0,j.d)([(0,A.M)()],N.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,j.d)([(0,A.M)()],N.prototype,"refractionIntensity",void 0),(0,j.d)([(0,A.M)()],N.prototype,"translucencyIntensity",void 0),(0,j.d)([(0,A.M)()],N.prototype,"useAlbedoToTintRefraction",void 0),(0,j.d)([(0,A.M)()],N.prototype,"useAlbedoToTintTranslucency",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"thicknessTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"refractionTexture",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"indexOfRefraction",void 0),(0,j.d)([(0,A.M)()],N.prototype,"_volumeIndexOfRefraction",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"volumeIndexOfRefraction",null),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"invertRefractionY",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"linkRefractionWithTransparency",void 0),(0,j.d)([(0,A.M)()],N.prototype,"minimumThickness",void 0),(0,j.d)([(0,A.M)()],N.prototype,"maximumThickness",void 0),(0,j.d)([(0,A.M)()],N.prototype,"useThicknessAsDepth",void 0),(0,j.d)([(0,A.j)()],N.prototype,"tintColor",void 0),(0,j.d)([(0,A.M)()],N.prototype,"tintColorAtDistance",void 0),(0,j.d)([(0,A.M)()],N.prototype,"dispersion",void 0),(0,j.d)([(0,A.j)()],N.prototype,"diffusionDistance",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useMaskFromThicknessTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"refractionIntensityTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"translucencyIntensityTexture",void 0),(0,j.d)([(0,A.j)()],N.prototype,"translucencyColor",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"translucencyColorTexture",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],N.prototype,"useGltfStyleTextures",void 0),(0,j.d)([(0,A.M)()],N.prototype,"applyAlbedoAfterSubSurface",void 0),(0,j.d)([(0,A.M)()],N.prototype,"legacyTransluceny",void 0);var W=m(11693),r=m(11363),Y=m(11702);const x={effect:null,subMesh:null};class Q extends q.e{constructor(h){super(h),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class t extends v.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(h){this._realTimeFiltering=h,this.PS(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(h){this._realTimeFilteringQuality=h,this.PS(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(h){h!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=h||this.ih().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(h,d){super(h,d,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||t.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new S.m(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=L.d.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new L.d(0,0,0),this._albedoColor=new L.d(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new L.d(1,1,1),this._reflectionColor=new L.d(1,1,1),this._emissiveColor=new L.d(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=t.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new w.e(16),this._globalAmbientColor=new L.d(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new R(this),this.clearCoat=new g(this),this.iridescence=new f(this),this.anisotropy=new c(this),this.sheen=new l(this),this.subSurface=new N(this),this.detailMap=new W.b(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),T.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,a.e)(this.ih()),this.prePassConfiguration=new Z.e}get hasRenderTargetTextures(){return!!(T.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var h;return this._transparencyMode===t.PBRMATERIAL_OPAQUE||this._transparencyMode===t.PBRMATERIAL_ALPHATEST||(null===(h=this.subSurface)||void 0===h?void 0:h.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var h;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(h=this.subSurface)||void 0===h||!h.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===t.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Nd&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==t.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Nd||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(h,d,m){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const j=d._drawWrapper;if(j.effect&&this.isFrozen&&j._wasPreviouslyReady&&j._wasPreviouslyUsingInstances===m)return!0;d.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),d.materialDefines=new Q(this._eventInfo.defineNames));const A=d.materialDefines;if(this._isReadyForSubMesh(d))return!0;const w=this.ih(),a=w.getEngine();if(A._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,w.texturesEnabled)){if(this._albedoTexture&&T.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&T.e.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&T.e.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&T.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&T.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const h=this._getReflectionTexture();if(h&&T.e.ReflectionTextureEnabled){if(!h.isReadyOrNotBlocking())return!1;var D;if(h.irradianceTexture){if(!h.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!h.sphericalPolynomial&&null!==(D=h.getInternalTexture())&&void 0!==D&&D._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&T.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&T.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(T.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(a.getCaps().standardDerivatives&&this._bumpTexture&&T.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&T.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=A,this._eventInfo.subMesh=d,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(A._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(A.AREALIGHTUSED)for(let b=0;b<h.lightSources.length;b++)if(!h.lightSources[b]._isReady())return!1;a.getCaps().standardDerivatives||h.isVerticesDataPresent(M.d.NormalKind)||(h.createNormals(!0),b.c.Warn("PBRMaterial: Normals have been created for the mesh: "+h.name));const S=d.effect,q=A._areLightsDisposed;let E=this._prepareEffect(h,A,this.onCompiled,this.onError,m,null,d.getRenderingMesh().hasThinInstances),I=!1;if(E)if(this._onEffectCreatedObservable&&(x.effect=E,x.subMesh=d,this._onEffectCreatedObservable.notifyObservers(x)),this.allowShaderHotSwapping&&S&&!E.isReady()){if(E=S,A.markAsUnprocessed(),I=this.isFrozen,q)return A._areLightsDisposed=!0,!1}else w.resetCachedMaterial(),d.setEffect(E,A,this._materialContext);return!(!d.effect||!d.effect.isReady())&&(A._renderId=w.getRenderId(),j._wasPreviouslyReady=!I,j._wasPreviouslyUsingInstances=!!m,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(h,d){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(h,d,b,w,a),!d.isDirty)return null;d.markAsProcessed();const D=this.ih().getEngine(),S=new o.e;let q=0;d.USESPHERICALINVERTEX&&S.addFallback(q++,"USESPHERICALINVERTEX"),d.FOG&&S.addFallback(q,"FOG"),d.SPECULARAA&&S.addFallback(q,"SPECULARAA"),d.POINTSIZE&&S.addFallback(q,"POINTSIZE"),d.LOGARITHMICDEPTH&&S.addFallback(q,"LOGARITHMICDEPTH"),d.PARALLAX&&S.addFallback(q,"PARALLAX"),d.PARALLAX_RHS&&S.addFallback(q,"PARALLAX_RHS"),d.PARALLAXOCCLUSION&&S.addFallback(q++,"PARALLAXOCCLUSION"),d.ENVIRONMENTBRDF&&S.addFallback(q++,"ENVIRONMENTBRDF"),d.TANGENT&&S.addFallback(q++,"TANGENT"),d.BUMP&&S.addFallback(q++,"BUMP"),q=(0,y.v)(d,S,this._maxSimultaneousLights,q++),d.SPECULARTERM&&S.addFallback(q++,"SPECULARTERM"),d.USESPHERICALFROMREFLECTIONMAP&&S.addFallback(q++,"USESPHERICALFROMREFLECTIONMAP"),d.USEIRRADIANCEMAP&&S.addFallback(q++,"USEIRRADIANCEMAP"),d.LIGHTMAP&&S.addFallback(q++,"LIGHTMAP"),d.NORMAL&&S.addFallback(q++,"NORMAL"),d.AMBIENT&&S.addFallback(q++,"AMBIENT"),d.EMISSIVE&&S.addFallback(q++,"EMISSIVE"),d.VERTEXCOLOR&&S.addFallback(q++,"VERTEXCOLOR"),d.MORPHTARGETS&&S.addFallback(q++,"MORPHTARGETS"),d.MULTIVIEW&&S.addFallback(0,"MULTIVIEW");const E=[M.d.PositionKind];d.NORMAL&&E.push(M.d.NormalKind),d.TANGENT&&E.push(M.d.TangentKind);for(let m=1;m<=6;++m)d["UV"+m]&&E.push(`uv${1===m?"":m}`);d.VERTEXCOLOR&&E.push(M.d.ColorKind),(0,y.z)(E,h,d,S),(0,y.A)(E,d),(0,y.D)(E,h,d),(0,y.y)(E,h,d);let I="pbr";const R=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],L=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],V=["Material","Scene","Mesh"],v={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:d.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=S,this._eventInfo.fallbackRank=q,this._eventInfo.defines=d,this._eventInfo.uniforms=R,this._eventInfo.attributes=E,this._eventInfo.samplers=L,this._eventInfo.uniformBuffersNames=V,this._eventInfo.customCode=void 0,this._eventInfo.mesh=h,this._eventInfo.indexParameters=v,this._callbackPluginEventGeneric(128,this._eventInfo),Y.e.AddUniformsAndSamplers(R,L),Z.e.AddUniforms(R),Z.e.AddSamplers(L),(0,r.b)(R),B.d&&(B.d.PrepareUniforms(R,d),B.d.PrepareSamplers(L,d)),(0,y.db)({uniformsNames:R,uniformBuffersNames:V,samplers:L,defines:d,maxSimultaneousLights:this._maxSimultaneousLights});const C={};this.customShaderNameResolve&&(I=this.customShaderNameResolve(I,R,V,L,d,E,C));const T=d.toString(),i=D.createEffect(I,{attributes:E,uniformsNames:R,uniformBuffersNames:V,samplers:L,defines:T,fallbacks:S,onCompiled:j,onError:A,indexParameters:v,processFinalCode:C.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:d.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([m.e(20),m.e(45)]).then(m.bind(m,13444)),Promise.all([m.e(18),m.e(46)]).then(m.bind(m,13597))]):await Promise.all([Promise.all([m.e(13),m.e(48)]).then(m.bind(m,13687)),Promise.all([m.e(12),m.e(49)]).then(m.bind(m,13852))]),this._shadersLoaded=!0}},D);return this._eventInfo.customCode=void 0,i}_prepareDefines(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const b=this.ih(),w=b.getEngine();(0,y.Q)(b,h,d,!0,this._maxSimultaneousLights,this._disableLighting),d._needNormals=!0,(0,y.$)(b,d);const a=this.needAlphaBlendingForMesh(h)&&this.ih().useOrderIndependentTransparency;if((0,y.cb)(b,d,this.canRenderToMRT&&!a),(0,y.ab)(b,d,a),Y.e.PrepareDefines(w.currentRenderPassId,h,d),d.METALLICWORKFLOW=this.isMetallicWorkflow(),d._areTexturesDirty){d._needUVs=!1;for(let h=1;h<=6;++h)d["MAINUV"+h]=!1;if(b.texturesEnabled){d.ALBEDODIRECTUV=0,d.BASE_WEIGHTDIRECTUV=0,d.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,d.AMBIENTDIRECTUV=0,d.OPACITYDIRECTUV=0,d.EMISSIVEDIRECTUV=0,d.REFLECTIVITYDIRECTUV=0,d.MICROSURFACEMAPDIRECTUV=0,d.METALLIC_REFLECTANCEDIRECTUV=0,d.REFLECTANCEDIRECTUV=0,d.BUMPDIRECTUV=0,d.LIGHTMAPDIRECTUV=0,w.getCaps().textureLOD&&(d.LODBASEDMICROSFURACE=!0),this._albedoTexture&&T.e.DiffuseTextureEnabled?((0,y.T)(this._albedoTexture,d,"ALBEDO"),d.GAMMAALBEDO=this._albedoTexture.gammaSpace):d.ALBEDO=!1,this._baseWeightTexture&&T.e.BaseWeightTextureEnabled?(0,y.T)(this._baseWeightTexture,d,"BASE_WEIGHT"):d.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&T.e.BaseDiffuseRoughnessTextureEnabled?(0,y.T)(this._baseDiffuseRoughnessTexture,d,"BASE_DIFFUSE_ROUGHNESS"):d.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&T.e.AmbientTextureEnabled?((0,y.T)(this._ambientTexture,d,"AMBIENT"),d.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):d.AMBIENT=!1,this._opacityTexture&&T.e.OpacityTextureEnabled?((0,y.T)(this._opacityTexture,d,"OPACITY"),d.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):d.OPACITY=!1;const h=this._getReflectionTexture();if(h&&T.e.ReflectionTextureEnabled){switch(d.REFLECTION=!0,d.GAMMAREFLECTION=h.gammaSpace,d.RGBDREFLECTION=h.isRGBD,d.LODINREFLECTIONALPHA=h.lodLevelInAlpha,d.LINEARSPECULARREFLECTION=h.linearSpecularLOD,d.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(d.NUM_SAMPLES=""+this.realTimeFilteringQuality,w._features.needTypeSuffixInShaderConstants&&(d.NUM_SAMPLES=d.NUM_SAMPLES+"u"),d.REALTIME_FILTERING=!0,this.ih().iblCdfGenerator&&(d.IBL_CDF_FILTERING=!0)):d.REALTIME_FILTERING=!1,d.INVERTCUBICMAP=h.coordinatesMode===C.e.INVCUBIC_MODE,d.REFLECTIONMAP_3D=h.isCube,d.REFLECTIONMAP_OPPOSITEZ=d.REFLECTIONMAP_3D&&this.ih().useRightHandedSystem?!h.invertZ:h.invertZ,d.REFLECTIONMAP_CUBIC=!1,d.REFLECTIONMAP_EXPLICIT=!1,d.REFLECTIONMAP_PLANAR=!1,d.REFLECTIONMAP_PROJECTION=!1,d.REFLECTIONMAP_SKYBOX=!1,d.REFLECTIONMAP_SPHERICAL=!1,d.REFLECTIONMAP_EQUIRECTANGULAR=!1,d.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,d.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,h.coordinatesMode){case C.e.EXPLICIT_MODE:d.REFLECTIONMAP_EXPLICIT=!0;break;case C.e.PLANAR_MODE:d.REFLECTIONMAP_PLANAR=!0;break;case C.e.PROJECTION_MODE:d.REFLECTIONMAP_PROJECTION=!0;break;case C.e.SKYBOX_MODE:d.REFLECTIONMAP_SKYBOX=!0;break;case C.e.SPHERICAL_MODE:d.REFLECTIONMAP_SPHERICAL=!0;break;case C.e.EQUIRECTANGULAR_MODE:d.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case C.e.FIXED_EQUIRECTANGULAR_MODE:d.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case C.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:d.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case C.e.CUBIC_MODE:case C.e.INVCUBIC_MODE:default:d.REFLECTIONMAP_CUBIC=!0,d.USE_LOCAL_REFLECTIONMAP_CUBIC=!!h.boundingBoxSize}h.coordinatesMode!==C.e.SKYBOX_MODE&&(h.irradianceTexture?(d.USEIRRADIANCEMAP=!0,d.USESPHERICALFROMREFLECTIONMAP=!1,d.USESPHERICALINVERTEX=!1,h.irradianceTexture._dominantDirection&&(d.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):h.isCube&&(d.USESPHERICALFROMREFLECTIONMAP=!0,d.USEIRRADIANCEMAP=!1,d.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||w.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?d.USESPHERICALINVERTEX=!1:d.USESPHERICALINVERTEX=!0))}else d.REFLECTION=!1,d.REFLECTIONMAP_3D=!1,d.REFLECTIONMAP_SPHERICAL=!1,d.REFLECTIONMAP_PLANAR=!1,d.REFLECTIONMAP_CUBIC=!1,d.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,d.REFLECTIONMAP_PROJECTION=!1,d.REFLECTIONMAP_SKYBOX=!1,d.REFLECTIONMAP_EXPLICIT=!1,d.REFLECTIONMAP_EQUIRECTANGULAR=!1,d.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,d.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,d.INVERTCUBICMAP=!1,d.USESPHERICALFROMREFLECTIONMAP=!1,d.USEIRRADIANCEMAP=!1,d.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,d.USESPHERICALINVERTEX=!1,d.REFLECTIONMAP_OPPOSITEZ=!1,d.LODINREFLECTIONALPHA=!1,d.GAMMAREFLECTION=!1,d.RGBDREFLECTION=!1,d.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&T.e.LightmapTextureEnabled?((0,y.T)(this._lightmapTexture,d,"LIGHTMAP"),d.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,d.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,d.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):d.LIGHTMAP=!1,this._emissiveTexture&&T.e.EmissiveTextureEnabled?((0,y.T)(this._emissiveTexture,d,"EMISSIVE"),d.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):d.EMISSIVE=!1,T.e.SpecularTextureEnabled?(this._metallicTexture?((0,y.T)(this._metallicTexture,d,"REFLECTIVITY"),d.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,d.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,d.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,d.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,d.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,y.T)(this._reflectivityTexture,d,"REFLECTIVITY"),d.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,d.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,d.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):d.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(d.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,y.T)(this._metallicReflectanceTexture,d,"METALLIC_REFLECTANCE"),d.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):d.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,y.T)(this._reflectanceTexture,d,"REFLECTANCE"),d.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):d.REFLECTANCE=!1):(d.METALLIC_REFLECTANCE=!1,d.REFLECTANCE=!1),this._microSurfaceTexture?(0,y.T)(this._microSurfaceTexture,d,"MICROSURFACEMAP"):d.MICROSURFACEMAP=!1):(d.REFLECTIVITY=!1,d.MICROSURFACEMAP=!1),w.getCaps().standardDerivatives&&this._bumpTexture&&T.e.BumpTextureEnabled&&!this._disableBumpMap?((0,y.T)(this._bumpTexture,d,"BUMP"),this._useParallax&&this._albedoTexture&&T.e.DiffuseTextureEnabled?(d.PARALLAX=!0,d.PARALLAX_RHS=b.useRightHandedSystem,d.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):d.PARALLAX=!1,d.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(d.BUMP=!1,d.PARALLAX=!1,d.PARALLAX_RHS=!1,d.PARALLAXOCCLUSION=!1,d.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&T.e.ReflectionTextureEnabled?(d.ENVIRONMENTBRDF=!0,d.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(d.ENVIRONMENTBRDF=!1,d.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?d.ALPHAFROMALBEDO=!0:d.ALPHAFROMALBEDO=!1}d.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===t.LIGHTFALLOFF_STANDARD?(d.USEPHYSICALLIGHTFALLOFF=!1,d.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===t.LIGHTFALLOFF_GLTF?(d.USEPHYSICALLIGHTFALLOFF=!1,d.USEGLTFLIGHTFALLOFF=!0):(d.USEPHYSICALLIGHTFALLOFF=!0,d.USEGLTFLIGHTFALLOFF=!1),d.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.yd&&this._twoSidedLighting?d.TWOSIDEDLIGHTING=!0:d.TWOSIDEDLIGHTING=!1,d.MIRRORED=!!b._mirroredCameraPosition,d.SPECULARAA=w.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(d._areTexturesDirty||d._areMiscDirty)&&(d.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,d.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,d.ALPHABLEND=this.needAlphaBlendingForMesh(h),d.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,d.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),d._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(d),d.FORCENORMALFORWARD=this._forceNormalForward,d.RADIANCEOCCLUSION=this._useRadianceOcclusion,d.HORIZONOCCLUSION=this._useHorizonOcclusion,d._areMiscDirty&&((0,y.X)(h,b,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(h),d,this._applyDecalMapAfterDetailMap),d.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!h.isVerticesDataPresent(M.d.NormalKind),d.DEBUGMODE=this._debugMode),(0,y.M)(b,w,this,d,!!m,j,A),this._eventInfo.defines=d,this._eventInfo.mesh=h,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,y.I)(h,d,!0,!0,!0,this._transparencyMode!==t.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(h,d,m){const j={clipPlane:!1,useInstances:!1,...m};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const m=new Q(this._eventInfo.defineNames),A=this._prepareEffect(h,m,void 0,void 0,j.useInstances,j.clipPlane,h.hasThinInstances);this._onEffectCreatedObservable&&(x.effect=A,x.subMesh=null,this._onEffectCreatedObservable.notifyObservers(x)),A.isReady()?d&&d(this):A.onCompileObservable.add((()=>{d&&d(this)}))})()}buildUniformLayout(){const h=this._uniformBuffer;h.addUniform("vAlbedoInfos",2),h.addUniform("vBaseWeightInfos",2),h.addUniform("vBaseDiffuseRoughnessInfos",2),h.addUniform("vAmbientInfos",4),h.addUniform("vOpacityInfos",2),h.addUniform("vEmissiveInfos",2),h.addUniform("vLightmapInfos",2),h.addUniform("vReflectivityInfos",3),h.addUniform("vMicroSurfaceSamplerInfos",2),h.addUniform("vReflectionInfos",2),h.addUniform("vReflectionFilteringInfo",2),h.addUniform("vReflectionPosition",3),h.addUniform("vReflectionSize",3),h.addUniform("vBumpInfos",3),h.addUniform("albedoMatrix",16),h.addUniform("baseWeightMatrix",16),h.addUniform("baseDiffuseRoughnessMatrix",16),h.addUniform("ambientMatrix",16),h.addUniform("opacityMatrix",16),h.addUniform("emissiveMatrix",16),h.addUniform("lightmapMatrix",16),h.addUniform("reflectivityMatrix",16),h.addUniform("microSurfaceSamplerMatrix",16),h.addUniform("bumpMatrix",16),h.addUniform("vTangentSpaceParams",2),h.addUniform("reflectionMatrix",16),h.addUniform("vReflectionColor",3),h.addUniform("vAlbedoColor",4),h.addUniform("baseWeight",1),h.addUniform("baseDiffuseRoughness",1),h.addUniform("vLightingIntensity",4),h.addUniform("vReflectionMicrosurfaceInfos",3),h.addUniform("vReflectionDominantDirection",3),h.addUniform("pointSize",1),h.addUniform("vReflectivityColor",4),h.addUniform("vEmissiveColor",3),h.addUniform("vAmbientColor",3),h.addUniform("vDebugMode",2),h.addUniform("vMetallicReflectanceFactors",4),h.addUniform("vMetallicReflectanceInfos",2),h.addUniform("metallicReflectanceMatrix",16),h.addUniform("vReflectanceInfos",2),h.addUniform("reflectanceMatrix",16),h.addUniform("vSphericalL00",3),h.addUniform("vSphericalL1_1",3),h.addUniform("vSphericalL10",3),h.addUniform("vSphericalL11",3),h.addUniform("vSphericalL2_2",3),h.addUniform("vSphericalL2_1",3),h.addUniform("vSphericalL20",3),h.addUniform("vSphericalL21",3),h.addUniform("vSphericalL22",3),h.addUniform("vSphericalX",3),h.addUniform("vSphericalY",3),h.addUniform("vSphericalZ",3),h.addUniform("vSphericalXX_ZZ",3),h.addUniform("vSphericalYY_ZZ",3),h.addUniform("vSphericalZZ",3),h.addUniform("vSphericalXY",3),h.addUniform("vSphericalYZ",3),h.addUniform("vSphericalZX",3),h.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(h,d,m){const j=this.ih(),A=m.materialDefines;if(!A)return;const b=m.effect;if(!b)return;this._activeEffect=b,d.getMeshUniformBuffer().bindToEffect(b,"Mesh"),d.transferToEffect(h);const w=j.getEngine();this._uniformBuffer.bindToEffect(b,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,j,d,h,this.isFrozen),Y.e.Bind(w.currentRenderPassId,this._activeEffect,d,h,this);const a=j.activeCamera;a?this._uniformBuffer.updateFloat4("cameraInfo",a.jb,a.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=m,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),A.OBJECTSPACE_NORMALMAP&&(h.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const S=this._mustRebind(j,b,m,d.visibility);(0,y.c)(d,this._activeEffect,this.prePassConfiguration);let M=null;const q=this._uniformBuffer;if(S){if(this.bindViewProjection(b),M=this._getReflectionTexture(),!q.useUbo||!this.isFrozen||!q.isSync||m._drawWrapper._forceRebindOnNextCall){var E;if(j.texturesEnabled){if(this._albedoTexture&&T.e.DiffuseTextureEnabled&&(q.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,y.t)(this._albedoTexture,q,"albedo")),this._baseWeightTexture&&T.e.BaseWeightTextureEnabled&&(q.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,y.t)(this._baseWeightTexture,q,"baseWeight")),this._baseDiffuseRoughnessTexture&&T.e.BaseDiffuseRoughnessTextureEnabled&&(q.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,y.t)(this._baseDiffuseRoughnessTexture,q,"baseDiffuseRoughness")),this._ambientTexture&&T.e.AmbientTextureEnabled&&(q.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,y.t)(this._ambientTexture,q,"ambient")),this._opacityTexture&&T.e.OpacityTextureEnabled&&(q.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,y.t)(this._opacityTexture,q,"opacity")),M&&T.e.ReflectionTextureEnabled){if(q.hb("reflectionMatrix",M.getReflectionTextureMatrix()),q.updateFloat2("vReflectionInfos",M.level*j.iblIntensity,0),M.boundingBoxSize){const h=M;q.updateVector3("vReflectionPosition",h.boundingBoxPosition),q.updateVector3("vReflectionSize",h.boundingBoxSize)}if(this.realTimeFiltering){const h=M.getSize().width;q.updateFloat2("vReflectionFilteringInfo",h,Math.log2(h))}if(A.USEIRRADIANCEMAP)A.USEIRRADIANCEMAP&&A.USE_IRRADIANCE_DOMINANT_DIRECTION&&q.updateVector3("vReflectionDominantDirection",M.irradianceTexture._dominantDirection);else{const h=M.sphericalPolynomial;if(A.USESPHERICALFROMREFLECTIONMAP&&h)if(A.SPHERICAL_HARMONICS){const d=h.preScaledHarmonics;q.updateVector3("vSphericalL00",d.l00),q.updateVector3("vSphericalL1_1",d.l1_1),q.updateVector3("vSphericalL10",d.l10),q.updateVector3("vSphericalL11",d.l11),q.updateVector3("vSphericalL2_2",d.l2_2),q.updateVector3("vSphericalL2_1",d.l2_1),q.updateVector3("vSphericalL20",d.l20),q.updateVector3("vSphericalL21",d.l21),q.updateVector3("vSphericalL22",d.l22)}else q.updateFloat3("vSphericalX",h.x.x,h.x.y,h.x.z),q.updateFloat3("vSphericalY",h.y.x,h.y.y,h.y.z),q.updateFloat3("vSphericalZ",h.z.x,h.z.y,h.z.z),q.updateFloat3("vSphericalXX_ZZ",h.xx.x-h.zz.x,h.xx.y-h.zz.y,h.xx.z-h.zz.z),q.updateFloat3("vSphericalYY_ZZ",h.yy.x-h.zz.x,h.yy.y-h.zz.y,h.yy.z-h.zz.z),q.updateFloat3("vSphericalZZ",h.zz.x,h.zz.y,h.zz.z),q.updateFloat3("vSphericalXY",h.xy.x,h.xy.y,h.xy.z),q.updateFloat3("vSphericalYZ",h.yz.x,h.yz.y,h.yz.z),q.updateFloat3("vSphericalZX",h.zx.x,h.zx.y,h.zx.z)}q.updateFloat3("vReflectionMicrosurfaceInfos",M.getSize().width,M.lodGenerationScale,M.lodGenerationOffset)}this._emissiveTexture&&T.e.EmissiveTextureEnabled&&(q.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,y.t)(this._emissiveTexture,q,"emissive")),this._lightmapTexture&&T.e.LightmapTextureEnabled&&(q.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,y.t)(this._lightmapTexture,q,"lightmap")),T.e.SpecularTextureEnabled&&(this._metallicTexture?(q.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,y.t)(this._metallicTexture,q,"reflectivity")):this._reflectivityTexture&&(q.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,y.t)(this._reflectivityTexture,q,"reflectivity")),this._metallicReflectanceTexture&&(q.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,y.t)(this._metallicReflectanceTexture,q,"metallicReflectance")),this._reflectanceTexture&&A.REFLECTANCE&&(q.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,y.t)(this._reflectanceTexture,q,"reflectance")),this._microSurfaceTexture&&(q.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,y.t)(this._microSurfaceTexture,q,"microSurfaceSampler"))),this._bumpTexture&&w.getCaps().standardDerivatives&&T.e.BumpTextureEnabled&&!this._disableBumpMap&&(q.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,y.t)(this._bumpTexture,q,"bump"),j._mirroredCameraPosition?q.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):q.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&q.updateFloat("pointSize",this.pointSize),A.METALLICWORKFLOW){var I;L.g.Eb[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,L.g.Eb[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const h=(null===(I=this.subSurface)||void 0===I?void 0:I._indexOfRefraction)??1.5,d=1;L.g.Eb[0].b=h;const m=Math.pow((h-d)/(h+d),2);L.g.Eb[0].a=m,q.updateDirectColor4("vReflectivityColor",L.g.Eb[0]),q.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else q.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);q.updateColor3("vEmissiveColor",T.e.EmissiveTextureEnabled?this._emissiveColor:L.d.BlackReadOnly),q.updateColor3("vReflectionColor",this._reflectionColor),!A.SS_REFRACTION&&null!==(E=this.subSurface)&&void 0!==E&&E._linkRefractionWithTransparency?q.updateColor4("vAlbedoColor",this._albedoColor,1):q.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),q.updateFloat("baseWeight",this._baseWeight),q.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*j.environmentIntensity,this._lightingInfos.w=this._specularIntensity,q.updateVector4("vLightingIntensity",this._lightingInfos),j.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),q.updateColor3("vAmbientColor",this._globalAmbientColor),q.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(j.texturesEnabled){if(this._albedoTexture&&T.e.DiffuseTextureEnabled&&q.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&T.e.BaseWeightTextureEnabled&&q.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&T.e.BaseDiffuseRoughnessTextureEnabled&&q.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&T.e.AmbientTextureEnabled&&q.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&T.e.OpacityTextureEnabled&&q.setTexture("opacitySampler",this._opacityTexture),M&&T.e.ReflectionTextureEnabled){A.LODBASEDMICROSFURACE?q.setTexture("reflectionSampler",M):(q.setTexture("reflectionSampler",M._lodTextureMid||M),q.setTexture("reflectionSamplerLow",M._lodTextureLow||M),q.setTexture("reflectionSamplerHigh",M._lodTextureHigh||M)),A.USEIRRADIANCEMAP&&q.setTexture("irradianceSampler",M.irradianceTexture);const h=this.ih().iblCdfGenerator;this.realTimeFiltering&&h&&q.setTexture("icdfSampler",h.getIcdfTexture())}A.ENVIRONMENTBRDF&&q.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&T.e.EmissiveTextureEnabled&&q.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&T.e.LightmapTextureEnabled&&q.setTexture("lightmapSampler",this._lightmapTexture),T.e.SpecularTextureEnabled&&(this._metallicTexture?q.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&q.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&q.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&A.REFLECTANCE&&q.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&q.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&w.getCaps().standardDerivatives&&T.e.BumpTextureEnabled&&!this._disableBumpMap&&q.setTexture("bumpSampler",this._bumpTexture)}this.ih().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(d)&&this.ih().depthPeelingRenderer.bind(b),this._eventInfo.subMesh=m,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,r.f)(this._activeEffect,this,j),this.bindEyePosition(b)}else j.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(S||!this.isFrozen){var R;if(j.lightsEnabled&&!this._disableLighting&&(0,y.j)(j,d,this._activeEffect,A,this._maxSimultaneousLights),(j.fogEnabled&&d.applyFog&&j.fogMode!==D.c.FOGMODE_NONE||M||this.subSurface.refractionTexture||d.receiveShadows||A.PREPASS)&&this.bindView(b),(0,y.g)(j,d,this._activeEffect,!0),A.NUM_MORPH_INFLUENCERS&&(0,y.o)(d,this._activeEffect),A.BAKED_VERTEX_ANIMATION_TEXTURE)null===(R=d.bakedVertexAnimationManager)||void 0===R||R.bind(b,A.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,y.l)(A,this._activeEffect,j)}this._afterBind(d,this._activeEffect,m),q.update()}getAnimatables(){const h=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&h.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&h.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&h.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&h.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&h.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&h.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&h.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?h.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&h.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&h.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&h.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&h.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&h.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&h.push(this._microSurfaceTexture),h}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.ih().environmentTexture}getActiveTextures(){const h=super.getActiveTextures();return this._albedoTexture&&h.push(this._albedoTexture),this._baseWeightTexture&&h.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&h.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&h.push(this._ambientTexture),this._opacityTexture&&h.push(this._opacityTexture),this._reflectionTexture&&h.push(this._reflectionTexture),this._emissiveTexture&&h.push(this._emissiveTexture),this._reflectivityTexture&&h.push(this._reflectivityTexture),this._metallicTexture&&h.push(this._metallicTexture),this._metallicReflectanceTexture&&h.push(this._metallicReflectanceTexture),this._reflectanceTexture&&h.push(this._reflectanceTexture),this._microSurfaceTexture&&h.push(this._microSurfaceTexture),this._bumpTexture&&h.push(this._bumpTexture),this._lightmapTexture&&h.push(this._lightmapTexture),h}hasTexture(h){return!!super.hasTexture(h)||(this._albedoTexture===h||(this._baseWeightTexture===h||(this._baseDiffuseRoughnessTexture===h||(this._ambientTexture===h||(this._opacityTexture===h||(this._reflectionTexture===h||(this._emissiveTexture===h||(this._reflectivityTexture===h||(this._metallicTexture===h||(this._metallicReflectanceTexture===h||(this._reflectanceTexture===h||(this._microSurfaceTexture===h||(this._bumpTexture===h||this._lightmapTexture===h)))))))))))))}setPrePassRenderer(){var h;if(null===(h=this.subSurface)||void 0===h||!h.isScatteringEnabled)return!1;const d=this.ih().enableSubSurfaceForPrePass();return d&&(d.enabled=!0),!0}dispose(h,d){var m,j,A,b,w,a,D,S,M,q,E,I,R,Z;(this._breakShaderLoadedCheck=!0,d)&&(this._environmentBRDFTexture&&this.ih().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(m=this._albedoTexture)||void 0===m||m.dispose(),null===(j=this._baseWeightTexture)||void 0===j||j.dispose(),null===(A=this._baseDiffuseRoughnessTexture)||void 0===A||A.dispose(),null===(b=this._ambientTexture)||void 0===b||b.dispose(),null===(w=this._opacityTexture)||void 0===w||w.dispose(),null===(a=this._reflectionTexture)||void 0===a||a.dispose(),null===(D=this._emissiveTexture)||void 0===D||D.dispose(),null===(S=this._metallicTexture)||void 0===S||S.dispose(),null===(M=this._reflectivityTexture)||void 0===M||M.dispose(),null===(q=this._bumpTexture)||void 0===q||q.dispose(),null===(E=this._lightmapTexture)||void 0===E||E.dispose(),null===(I=this._metallicReflectanceTexture)||void 0===I||I.dispose(),null===(R=this._reflectanceTexture)||void 0===R||R.dispose(),null===(Z=this._microSurfaceTexture)||void 0===Z||Z.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(h,d)}}t.PBRMATERIAL_OPAQUE=V.d.MATERIAL_OPAQUE,t.PBRMATERIAL_ALPHATEST=V.d.MATERIAL_ALPHATEST,t.PBRMATERIAL_ALPHABLEND=V.d.MATERIAL_ALPHABLEND,t.PBRMATERIAL_ALPHATESTANDBLEND=V.d.MATERIAL_ALPHATESTANDBLEND,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,t.LIGHTFALLOFF_PHYSICAL=0,t.LIGHTFALLOFF_GLTF=1,t.LIGHTFALLOFF_STANDARD=2,t.ForceGLSL=!1,(0,j.d)([(0,A.s)()],t.prototype,"_imageProcessingConfiguration",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"debugMode",void 0)},11590:(h,d,m)=>{m.d(d,{d:()=>q});var j=m(11258),A=m(11261),b=m(11595),w=m(11353),a=m(11602),D=m(11080),S=m(11251),M=m(11341);class q extends a.c{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(h){this.subSurface.refractionTexture=h,h?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(h){this.subSurface.indexOfRefraction=h}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(h){this.subSurface.invertRefractionY=h}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(h){this.subSurface.linkRefractionWithTransparency=h,h&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===a.c.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(h){h!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=h?a.c.LIGHTFALLOFF_PHYSICAL:a.c.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===a.c.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(h){h!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=h?a.c.LIGHTFALLOFF_GLTF:a.c.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(h){this._attachImageProcessingConfiguration(h),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(h){this.imageProcessingConfiguration.colorCurvesEnabled=h}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(h){this.imageProcessingConfiguration.colorGradingEnabled=h}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(h){this._imageProcessingConfiguration.toneMappingEnabled=h}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(h){this._imageProcessingConfiguration.exposure=h}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(h){this._imageProcessingConfiguration.contrast=h}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(h){this._imageProcessingConfiguration.colorGradingTexture=h}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(h){this._imageProcessingConfiguration.colorCurves=h}constructor(h,d){super(h,d,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=q.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=w.d.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new w.d(0,0,0),this.albedoColor=new w.d(1,1,1),this.baseWeight=1,this.reflectivityColor=new w.d(1,1,1),this.reflectionColor=new w.d(1,1,1),this.emissiveColor=new w.d(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,b.e)(this.ih())}getClassName(){return"PBRMaterial"}clone(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const j=M.d.Clone((()=>new q(h,this.ih())),this,{cloneTexturesOnlyOnce:d});return j.id=h,j.name=h,this.stencil.copyTo(j.stencil),this._clonePlugins(j,m),j}serialize(){const h=super.serialize();return h.customType="BABYLON.PBRMaterial",h}static Parse(h,d,m){const j=M.d.Parse((()=>new q(h.name,d)),h,d,m);return h.stencil&&j.stencil.parse(h.stencil,d,m),S.d._ParsePlugins(h,j,d,m),h.clearCoat&&j.clearCoat.parse(h.clearCoat,d,m),h.anisotropy&&j.anisotropy.parse(h.anisotropy,d,m),h.brdf&&j.brdf.parse(h.brdf,d,m),h.sheen&&j.sheen.parse(h.sheen,d,m),h.subSurface&&j.subSurface.parse(h.subSurface,d,m),h.iridescence&&j.iridescence.parse(h.iridescence,d,m),j}}q.PBRMATERIAL_OPAQUE=a.c.PBRMATERIAL_OPAQUE,q.PBRMATERIAL_ALPHATEST=a.c.PBRMATERIAL_ALPHATEST,q.PBRMATERIAL_ALPHABLEND=a.c.PBRMATERIAL_ALPHABLEND,q.PBRMATERIAL_ALPHATESTANDBLEND=a.c.PBRMATERIAL_ALPHATESTANDBLEND,q.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=a.c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"directIntensity",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"emissiveIntensity",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"environmentIntensity",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"specularIntensity",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"disableBumpMap",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"albedoTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"baseWeightTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"baseDiffuseRoughnessTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"ambientTexture",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"ambientTextureStrength",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],q.prototype,"opacityTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"reflectionTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"emissiveTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"reflectivityTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"metallicTexture",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"metallic",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"roughness",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"metallicF0Factor",void 0),(0,j.d)([(0,A.j)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"metallicReflectanceColor",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"metallicReflectanceTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"reflectanceTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"microSurfaceTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"bumpTexture",void 0),(0,j.d)([(0,A.D)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty",null)],q.prototype,"lightmapTexture",void 0),(0,j.d)([(0,A.j)("ambient"),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"ambientColor",void 0),(0,j.d)([(0,A.j)("albedo"),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"albedoColor",void 0),(0,j.d)([(0,A.M)("baseWeight"),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"baseWeight",void 0),(0,j.d)([(0,A.M)("baseDiffuseRoughness"),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"baseDiffuseRoughness",void 0),(0,j.d)([(0,A.j)("reflectivity"),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"reflectivityColor",void 0),(0,j.d)([(0,A.j)("reflection"),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"reflectionColor",void 0),(0,j.d)([(0,A.j)("emissive"),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"emissiveColor",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"microSurface",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useLightmapAsShadowmap",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],q.prototype,"useAlphaFromAlbedoTexture",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],q.prototype,"forceAlphaTest",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],q.prototype,"alphaCutOff",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useSpecularOverAlpha",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useAmbientInGrayScale",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,j.d)([(0,A.M)()],q.prototype,"usePhysicalLightFalloff",null),(0,j.d)([(0,A.M)()],q.prototype,"useGLTFLightFalloff",null),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useRadianceOverAlpha",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useObjectSpaceNormalMap",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useParallax",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useParallaxOcclusion",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"parallaxScaleBias",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsLightsDirty")],q.prototype,"disableLighting",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"forceIrradianceInFragment",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsLightsDirty")],q.prototype,"maxSimultaneousLights",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"invertNormalMapX",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"invertNormalMapY",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"twoSidedLighting",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useAlphaFresnel",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useLinearAlphaFresnel",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"environmentBRDFTexture",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"forceNormalForward",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"enableSpecularAntiAliasing",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useHorizonOcclusion",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useRadianceOcclusion",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsMiscDirty")],q.prototype,"unlit",void 0),(0,j.d)([(0,A.M)(),(0,A.b)("_markAllSubMeshesAsMiscDirty")],q.prototype,"applyDecalMapAfterDetailMap",void 0),(0,D.i)("BABYLON.PBRMaterial",q)},11229:(h,d,m)=>{m.d(d,{c:()=>w});var j=m(11121);const A=new Map;function b(h,d){(function(h){return A.delete(h)})(h)&&j.c.Warn(`Extension with the name '${h}' already exists`),A.set(h,d)}function w(h,d){"image/ktx"!==d&&"image/ktx2"!==d||(h=".ktx"),A.has(h)||(h.endsWith(".ies")&&b(".ies",(async()=>await m.e(28).then(m.bind(m,13330)).then((h=>new h._IESTextureLoader)))),h.endsWith(".dds")&&b(".dds",(async()=>await m.e(25).then(m.bind(m,13337)).then((h=>new h._DDSTextureLoader)))),h.endsWith(".basis")&&b(".basis",(async()=>await m.e(29).then(m.bind(m,13342)).then((h=>new h._BasisTextureLoader)))),h.endsWith(".env")&&b(".env",(async()=>await Promise.all([m.e(24),m.e(30)]).then(m.bind(m,13346)).then((h=>new h._ENVTextureLoader)))),h.endsWith(".hdr")&&b(".hdr",(async()=>await m.e(31).then(m.bind(m,13348)).then((h=>new h._HDRTextureLoader)))),(h.endsWith(".ktx")||h.endsWith(".ktx2"))&&(b(".ktx",(async()=>await m.e(32).then(m.bind(m,13355)).then((h=>new h._KTXTextureLoader)))),b(".ktx2",(async()=>await m.e(32).then(m.bind(m,13355)).then((h=>new h._KTXTextureLoader))))),h.endsWith(".tga")&&b(".tga",(async()=>await m.e(33).then(m.bind(m,13363)).then((h=>new h._TGATextureLoader)))),h.endsWith(".exr")&&b(".exr",(async()=>await m.e(34).then(m.bind(m,13367)).then((h=>new h._ExrTextureLoader)))));const j=A.get(h);return j?Promise.resolve(j(d)):null}},11534:(h,d,m)=>{m.d(d,{b:()=>E});var j=m(11258),A=m(11261),b=m(11097),w=m(11058),a=m(11094),D=m(11245),S=(m(11150),m(11530));class M{get wrapU(){return this._wrapU}set wrapU(h){this._wrapU=h}get wrapV(){return this._wrapV}set wrapV(h){this._wrapV=h}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(h){this._texture&&(this._texture.isCube=h)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(h){this._texture&&(this._texture.is3D=h)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(h){this._texture&&(this._texture.is2DArray=h)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(h){return void 0!==(null===h||void 0===h?void 0:h.shareDepth)}constructor(h){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=S.b.Zero(),this._cachedBaseSize=S.b.Zero(),this._initialSamplingMode=2,this._texture=M._IsRenderTargetWrapper(h)?h.texture:h,this._texture&&(this._engine=this._texture.getEngine(),this.wrapU=this._texture._cachedWrapU??this.wrapU,this.wrapV=this._texture._cachedWrapV??this.wrapV,this.wrapR=this._texture._cachedWrapR??this.wrapR)}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(h){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(h,this._texture,this._texture.generateMipMaps)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var q=m(11341);class E extends M{set Nd(h){this._hasAlpha!==h&&(this._hasAlpha=h,this._scene&&this._scene.markAllMaterialsAsDirty(1,(h=>h.hasTexture(this))))}get Nd(){return this._hasAlpha}set getAlphaFromRGB(h){this._getAlphaFromRGB!==h&&(this._getAlphaFromRGB=h,this._scene&&this._scene.markAllMaterialsAsDirty(1,(h=>h.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(h){this._coordinatesIndex!==h&&(this._coordinatesIndex=h,this._scene&&this._scene.markAllMaterialsAsDirty(1,(h=>h.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(h){this._coordinatesMode!==h&&(this._coordinatesMode=h,this._scene&&this._scene.markAllMaterialsAsDirty(1,(h=>h.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(h){this._wrapU=h}get wrapV(){return this._wrapV}set wrapV(h){this._wrapV=h}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(h){this._texture?this._texture.isCube=h:this._isCube=h}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(h){this._texture&&(this._texture.is3D=h)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(h){this._texture&&(this._texture.is2DArray=h)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(h){var d;if(this._texture){if(this._texture._gammaSpace===h)return;this._texture._gammaSpace=h}else{if(this._gammaSpace===h)return;this._gammaSpace=h}null===(d=this.ih())||void 0===d||d.markAllMaterialsAsDirty(1,(h=>h.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(h){var d;h!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=h),null===(d=this.ih())||void 0===d||d.markAllMaterialsAsDirty(1,(h=>h.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(h){this._texture&&(this._texture._lodGenerationOffset=h)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(h){this._texture&&(this._texture._lodGenerationScale=h)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(h){this._texture&&(this._texture._linearSpecularLOD=h)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(h){this._texture&&(this._texture._irradianceTexture=h)}get uid(){return this._uid||(this._uid=(0,D.d)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(h){this._onDisposeObserver&&this.pd.remove(this._onDisposeObserver),this._onDisposeObserver=this.pd.add(h)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=E.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this._dominantDirection=null,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.pd=new b.e,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,h?E._IsScene(h)?this._scene=h:this._engine=h:this._scene=a.b.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=d,this._uid=null}ih(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return w.b.IdentityReadOnly}getReflectionTextureMatrix(){return w.b.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(h){}get canRescale(){return!1}_getFromCache(h,d,m,j,A,b){const w=this._getEngine();if(!w)return null;const a=w._getUseSRGBBuffer(!!A,d),D=w.getLoadedTexturesCache();for(let S=0;S<D.length;S++){const w=D[S];if((void 0===A||a===w._useSRGBBuffer)&&(void 0===j||j===w.invertY)&&w.url===h&&w.generateMipMaps===!d&&(!m||m===w.samplingMode)&&(void 0===b||b===w.isCube))return w.incrementReferences(),w}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const h=this.ih();h&&h.markAllMaterialsAsDirty(1)}readPixels(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],A=arguments.length>4&&void 0!==arguments[4]&&arguments[4],b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const S=this._getEngine();if(!S)return null;const M=this.getSize();let q=M.width,E=M.height;0!==d&&(q/=Math.pow(2,d),E/=Math.pow(2,d),q=Math.round(q),E=Math.round(E)),a=Math.min(q,a),D=Math.min(E,D);try{return this._texture.isCube?S._readTexturePixels(this._texture,a,D,h,d,m,j,A,b,w):S._readTexturePixels(this._texture,a,D,-1,d,m,j,A,b,w)}catch(I){return null}}_readPixelsSync(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const b=this.getSize();let w=b.width,a=b.height;const D=this._getEngine();if(!D)return null;0!=d&&(w/=Math.pow(2,d),a/=Math.pow(2,d),w=Math.round(w),a=Math.round(a));try{return this._texture.isCube?D._readTexturePixelsSync(this._texture,w,a,h,d,m,j,A):D._readTexturePixelsSync(this._texture,w,a,-1,d,m,j,A)}catch(S){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const h=this._scene.textures.indexOf(this);if(h>=0&&this._scene.textures.splice(h,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const h=this._parentContainer.textures.indexOf(this);h>-1&&this._parentContainer.textures.splice(h,1),this._parentContainer=null}}this.pd.notifyObservers(this),this.pd.clear(),this.metadata=null,super.dispose()}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!h)return null;const d=q.d.Serialize(this);return q.d.AppendSerializedAnimations(this,d),d}static WhenAllReady(h,d){let m=h.length;if(0!==m)for(let j=0;j<h.length;j++){const A=h[j];if(A.isReady())0===--m&&d();else{const h=A.onLoadObservable;h?h.addOnce((()=>{0===--m&&d()})):0===--m&&d()}}else d()}static _IsScene(h){return"Scene"===h.getClassName()}}E.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,j.d)([(0,A.M)()],E.prototype,"uniqueId",void 0),(0,j.d)([(0,A.M)()],E.prototype,"name",void 0),(0,j.d)([(0,A.M)()],E.prototype,"displayName",void 0),(0,j.d)([(0,A.M)()],E.prototype,"metadata",void 0),(0,j.d)([(0,A.M)("Nd")],E.prototype,"_hasAlpha",void 0),(0,j.d)([(0,A.M)("getAlphaFromRGB")],E.prototype,"_getAlphaFromRGB",void 0),(0,j.d)([(0,A.M)()],E.prototype,"level",void 0),(0,j.d)([(0,A.M)("coordinatesIndex")],E.prototype,"_coordinatesIndex",void 0),(0,j.d)([(0,A.M)()],E.prototype,"optimizeUVAllocation",void 0),(0,j.d)([(0,A.M)("coordinatesMode")],E.prototype,"_coordinatesMode",void 0),(0,j.d)([(0,A.M)()],E.prototype,"wrapU",null),(0,j.d)([(0,A.M)()],E.prototype,"wrapV",null),(0,j.d)([(0,A.M)()],E.prototype,"wrapR",void 0),(0,j.d)([(0,A.M)()],E.prototype,"anisotropicFilteringLevel",void 0),(0,j.d)([(0,A.M)()],E.prototype,"isCube",null),(0,j.d)([(0,A.M)()],E.prototype,"is3D",null),(0,j.d)([(0,A.M)()],E.prototype,"is2DArray",null),(0,j.d)([(0,A.M)()],E.prototype,"gammaSpace",null),(0,j.d)([(0,A.M)()],E.prototype,"invertZ",void 0),(0,j.d)([(0,A.M)()],E.prototype,"lodLevelInAlpha",void 0),(0,j.d)([(0,A.M)()],E.prototype,"lodGenerationOffset",null),(0,j.d)([(0,A.M)()],E.prototype,"lodGenerationScale",null),(0,j.d)([(0,A.M)()],E.prototype,"linearSpecularLOD",null),(0,j.d)([(0,A.D)()],E.prototype,"irradianceTexture",null),(0,j.d)([(0,A.M)()],E.prototype,"isRenderTarget",void 0)},11675:(h,d,m)=>{var j=m(11682),A=m(11534);A.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(A.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=j.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((h=>{this._texture._sphericalPolynomial=h,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(h){this._texture&&(this._texture._sphericalPolynomial=h)},enumerable:!0,configurable:!0})},11216:(h,d,m)=>{m.d(d,{c:()=>w});var j,A=m(11097),b=m(11223);!function(h){h[h.Unknown=0]="Unknown",h[h.Url=1]="Url",h[h.Temp=2]="Temp",h[h.Raw=3]="Raw",h[h.Dynamic=4]="Dynamic",h[h.RenderTarget=5]="RenderTarget",h[h.MultiRenderTarget=6]="MultiRenderTarget",h[h.Cube=7]="Cube",h[h.CubeRaw=8]="CubeRaw",h[h.CubePrefiltered=9]="CubePrefiltered",h[h.Raw3D=10]="Raw3D",h[h.Raw2DArray=11]="Raw2DArray",h[h.DepthStencil=12]="DepthStencil",h[h.CubeRawRGBD=13]="CubeRawRGBD",h[h.Depth=14]="Depth"}(j||(j={}));class w extends b.c{get useMipMaps(){return this.generateMipMaps}set useMipMaps(h){this.generateMipMaps=h}get uniqueId(){return this._uniqueId}_setUniqueId(h){this._uniqueId=h}getEngine(){return this._engine}get source(){return this._source}constructor(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new A.e,this.onErrorObservable=new A.e,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=h,this._source=d,this._uniqueId=w._Counter++,m||(this._hardwareTexture=h._createHardwareTexture())}incrementReferences(){this._references++}updateSize(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,h,d,m),this.width=h,this.height=d,this.depth=m,this.baseWidth=h,this.baseHeight=d,this.baseDepth=m,this._size=h*d*m}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const h=this.onRebuildCallback(this),d=d=>{d._swapAndDie(this,!1),this.isReady=h.isReady};return void(h.isAsync?h.proxy.then(d):d(h.proxy))}let h;switch(this.source){case 2:case 12:case 14:break;case 1:return void(h=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(h=>{h._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:h=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),h._swapAndDie(this,!1),this.isReady=!0;break;case 10:h=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),h._swapAndDie(this,!1),this.isReady=!0;break;case 11:h=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),h._swapAndDie(this,!1),this.isReady=!0;break;case 4:h=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),h._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(h=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{h._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:h=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),h._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return h=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(h=>{h&&h._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(h._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(h){var d;let m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(d=this._hardwareTexture)||void 0===d||d.setUsage(h._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),h._hardwareTexture=this._hardwareTexture,m&&(h._isRGBD=this._isRGBD),this._lodTextureHigh&&(h._lodTextureHigh&&h._lodTextureHigh.dispose(),h._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(h._lodTextureMid&&h._lodTextureMid.dispose(),h._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(h._lodTextureLow&&h._lodTextureLow.dispose(),h._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(h._irradianceTexture&&h._irradianceTexture.dispose(),h._irradianceTexture=this._irradianceTexture);const j=this._engine.getLoadedTexturesCache();let A=j.indexOf(this);-1!==A&&j.splice(A,1),A=j.indexOf(h),-1===A&&j.push(h)}dispose(){this._references--,0===this._references&&(this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}w._Counter=0},11573:(h,d,m)=>{m.d(d,{b:()=>A});var j=m(11543);class A extends j.e{constructor(h,d,m,A,b){let w=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,M=arguments.length>9?arguments[9]:void 0,q=arguments.length>10?arguments[10]:void 0,E=arguments.length>11?arguments[11]:void 0;super(null,b,!w,a,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,M),this.format=A,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==S||(D=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==S||(D=1),this._texture=this._engine.createRawTexture(h,d,m,A,w,a,D,null,S,M??0,q??!1),this.wrapU=j.e.CLAMP_ADDRESSMODE,this.wrapV=j.e.CLAMP_ADDRESSMODE,this._waitingForData=!!E&&!h)}update(h){this._getEngine().updateRawTexture(this._texture,h,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const h=new A(null,this.getSize().width,this.getSize().height,this.format,this.ih(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return h._texture=this._texture,this._texture.incrementReferences(),h}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(h,d,m,j){return new A(h,d,m,1,j,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(h,d,m,j){return new A(h,d,m,2,j,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(h,d,m,j){return new A(h,d,m,0,j,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(h,d,m,j){return new A(h,d,m,4,j,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(h,d,m,j){return new A(h,d,m,5,j,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(h,d,m,j){return new A(h,d,m,5,j,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(h,d,m,b){let w=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:j.e.TRILINEAR_SAMPLINGMODE;return new A(h,d,m,6,b,w,a,D,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(h,d,m,b){let w=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:j.e.TRILINEAR_SAMPLINGMODE;return new A(h,d,m,6,b,w,a,D,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11548:(h,d,m)=>{m.d(d,{e:()=>I});var j=m(11097),A=m(11058),b=m(11543),w=m(11553),a=m(11248),D=m(11196),S=m(11121),M=m(11557),q=m(11073);class E{get renderList(){return this._renderList}set renderList(h){this._renderList!==h&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),h&&(this._unObserveRenderList=(0,q.i)(h,this._renderListHasChanged)),this._renderList=h)}get disableImageProcessing(){return this._disableImageProcessing}set disableImageProcessing(h){h!==this._disableImageProcessing&&(this._disableImageProcessing=h,this._scene.markAllMaterialsAsDirty(64))}get name(){return this._name}set name(h){if(this._name===h)return;if(this._name=h,!this._scene)return;const d=this._scene.getEngine();for(let m=0;m<this._renderPassIds.length;++m){const h=this._renderPassIds[m];d._renderPassNames[h]=`${this._name}#${m}`}}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(h,d){let m;m=Array.isArray(h)?h:[h];for(let j=0;j<m.length;++j)for(let h=0;h<this.options.numPasses;++h){let A=m[j];m[j].isAnInstance&&(A=m[j].sourceMesh),A.setMaterialForRenderPass(this._renderPassIds[h],void 0!==d?Array.isArray(d)?d[h]:d:void 0)}}constructor(h,d,m){this._unObserveRenderList=null,this._renderListHasChanged=(h,d)=>{const m=this._renderList?this._renderList.length:0;if(0===d&&m>0||0===m)for(const j of this._scene.meshes)j._markSubMeshesAsLightDirty()},this.particleSystemList=null,this.getCustomRenderList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this._disableImageProcessing=!1,this.onBeforeRenderObservable=new j.e,this.onAfterRenderObservable=new j.e,this.onBeforeRenderingManagerRenderObservable=new j.e,this.onAfterRenderingManagerRenderObservable=new j.e,this.onFastPathRenderObservable=new j.e,this._currentRefreshId=-1,this._refreshRate=1,this._currentApplyByPostProcessSetting=!1,this._currentSceneCamera=null,this.name=h,this._scene=d,this.renderList=[],this._renderPassIds=[],this.options={numPasses:1,doNotChangeAspectRatio:!0,...m},this._createRenderPassId(),this.renderPassId=this._renderPassIds[0],this._renderingManager=new M.d(d),this._renderingManager._useSceneAutoClearSetup=!0}_releaseRenderPassId(){const h=this._scene.getEngine();for(let d=0;d<this.options.numPasses;++d)h.releaseRenderPassId(this._renderPassIds[d]);this._renderPassIds.length=0}_createRenderPassId(){this._releaseRenderPassId();const h=this._scene.getEngine();for(let d=0;d<this.options.numPasses;++d)this._renderPassIds[d]=h.createRenderPassId(`${this.name}#${d}`)}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(h){this._refreshRate=h,this.resetRefreshCounter()}shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}isReadyForRendering(h,d){this.prepareRenderList(),this.initRender(h,d);const m=this._checkReadiness();return this.finishRender(),m}prepareRenderList(){const h=this._scene;if(this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let d=0;d<this._waitingRenderList.length;d++){const m=this._waitingRenderList[d],j=h.getMeshById(m);j&&this.renderList.push(j)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const h=this._scene.meshes;for(let d=0;d<h.length;d++){const m=h[d];this.renderListPredicate(m)&&this.renderList.push(m)}}this._currentApplyByPostProcessSetting=this._scene.imageProcessingConfiguration.applyByPostProcess,this._disableImageProcessing&&(this._scene.imageProcessingConfiguration._applyByPostProcess=this._disableImageProcessing)}initRender(h,d){const m=this._scene.getEngine(),j=this.activeCamera??this._scene.activeCamera;this._currentSceneCamera=this._scene.activeCamera,j&&(j!==this._scene.activeCamera&&(this._scene.setTransformMatrix(j.getViewMatrix(),j.getProjectionMatrix(!0)),this._scene.activeCamera=j),m.setViewport(j.rigParent?j.rigParent.viewport:j.viewport,h,d)),this._defaultRenderListPrepared=!1}finishRender(){const h=this._scene;this._disableImageProcessing&&(h.imageProcessingConfiguration._applyByPostProcess=this._currentApplyByPostProcessSetting),h.activeCamera=this._currentSceneCamera,this._currentSceneCamera&&(this.activeCamera&&this.activeCamera!==h.activeCamera&&h.setTransformMatrix(this._currentSceneCamera.getViewMatrix(),this._currentSceneCamera.getProjectionMatrix(!0)),h.getEngine().setViewport(this._currentSceneCamera.viewport)),h.resetCachedMaterial()}render(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const m=this._scene,j=m.getEngine(),A=j.currentRenderPassId;j.currentRenderPassId=this._renderPassIds[h],this.onBeforeRenderObservable.notifyObservers(h);if(j.snapshotRendering&&1===j.snapshotRenderingMode)this.onFastPathRenderObservable.notifyObservers(h);else{let d=null;const j=this.renderList?this.renderList:m.getActiveMeshes().data,A=this.renderList?this.renderList.length:m.getActiveMeshes().length;this.getCustomRenderList&&(d=this.getCustomRenderList(h,j,A)),d?this._prepareRenderingManager(d,d.length,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(j,A,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),d=j),this.onBeforeRenderingManagerRenderObservable.notifyObservers(h),this._renderingManager.render(this.customRenderFunction,d,this.renderParticles,this.renderSprites),this.onAfterRenderingManagerRenderObservable.notifyObservers(h)}d||this.onAfterRenderObservable.notifyObservers(h),j.currentRenderPassId=A}_checkReadiness(){const h=this._scene,d=h.getEngine(),m=d.currentRenderPassId;let j=!0;h.getViewMatrix()||h.updateTransformMatrix();const A=this.options.numPasses;for(let w=0;w<A&&j;w++){let m=null;const b=this.renderList?this.renderList:h.getActiveMeshes().data,a=this.renderList?this.renderList.length:h.getActiveMeshes().length;d.currentRenderPassId=this._renderPassIds[w],this.onBeforeRenderObservable.notifyObservers(w),this.getCustomRenderList&&(m=this.getCustomRenderList(w,b,a)),m||(m=b),this.options.doNotChangeAspectRatio||h.updateTransformMatrix(!0);for(let h=0;h<m.length&&j;++h){const d=m[h];if(d.isEnabled()&&!d.isBlocked&&d.isVisible&&d.Ab)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(d,this.refreshRate,!0)){j=!1;continue}}else if(!d.isReady(!0)){j=!1;continue}}this.onAfterRenderObservable.notifyObservers(w),A>1&&(h.incrementRenderId(),h.resetCachedMaterial())}const b=this.particleSystemList||h.aE;for(const w of b)w.isReady()||(j=!1);return d.currentRenderPassId=m,j}_prepareRenderingManager(h,d,m){const j=this._scene,A=j.activeCamera,b=this.cameraForLOD??A;this._renderingManager.reset();const w=j.getRenderId(),a=j.getFrameId();for(let S=0;S<d;S++){const d=h[S];if(d&&!d.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(d,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!d.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}let h,D=null;if(b){const h=d._internalAbstractMeshDataInfo._currentLOD.get(b);h&&h[1]===a?D=h[0]:(D=j.customLODSelector?j.customLODSelector(d,b):d.getLOD(b),h?(h[0]=D,h[1]=a):d._internalAbstractMeshDataInfo._currentLOD.set(b,[D,a]))}else D=d;if(!D)continue;if(D!==d&&0!==D.billboardMode&&D.Zd(),D._preActivateForIntermediateRendering(w),h=!(!m||!A)&&0===(d.layerMask&A.layerMask),d.isEnabled()&&d.isVisible&&d.Ab&&!h){if(D!==d&&D._activate(w,!0),d._activate(w,!0)&&d.Ab.length){d.isAnInstance?d._internalAbstractMeshDataInfo._actAsRegularMesh&&(D=d):D._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,D._internalAbstractMeshDataInfo._isActiveIntermediate=!0,j._prepareSkeleton(D);for(let h=0;h<D.Ab.length;h++){const d=D.Ab[h];this._renderingManager.dispatch(d,D)}}d._postActivate()}}}const D=this.particleSystemList||j.aE;for(let S=0;S<D.length;S++){const h=D[S],d=h.k;h.isStarted()&&d&&(!d.position||d.isEnabled())&&this._renderingManager.dispatchParticles(h)}}setRenderingOrder(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(h,d,m,j)}setRenderingAutoClearDepthStencil(h,d){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(h,d,m,j),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const h=new E(this.name,this._scene,this.options);return this.renderList&&(h.renderList=this.renderList.slice(0)),h}dispose(){const h=this.renderList?this.renderList:this._scene.getActiveMeshes().data,d=this.renderList?this.renderList.length:this._scene.getActiveMeshes().length;for(let m=0;m<d;m++){const d=h[m];d&&void 0!==d.getMaterialForRenderPass(this.renderPassId)&&d.setMaterialForRenderPass(this.renderPassId,void 0)}this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderingManagerRenderObservable.clear(),this.onAfterRenderingManagerRenderObservable.clear(),this.onFastPathRenderObservable.clear(),this._releaseRenderPassId(),this.renderList=null}_rebuild(){this.refreshRate===E.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=E.REFRESHRATE_RENDER_ONCE)}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}}E.REFRESHRATE_RENDER_ONCE=0,E.REFRESHRATE_RENDER_ONEVERYFRAME=1,E.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,D.e.prototype.setDepthStencilTexture=function(h,d){this._engine.setDepthStencilTexture(this._samplers[h],this._uniforms[h],d,h)};class I extends b.e{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(h){this._objectRenderer.renderListPredicate=h}get renderList(){return this._objectRenderer.renderList}set renderList(h){this._objectRenderer.renderList=h}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(h){this._objectRenderer.particleSystemList=h}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(h){this._objectRenderer.getCustomRenderList=h}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(h){this._objectRenderer.renderParticles=h}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(h){this._objectRenderer.renderSprites=h}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(h){this._objectRenderer.forceLayerMaskCheck=h}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(h){this._objectRenderer.activeCamera=h}get cameraForLOD(){return this._objectRenderer.cameraForLOD}set cameraForLOD(h){this._objectRenderer.cameraForLOD=h}get disableImageProcessing(){return this._objectRenderer.disableImageProcessing}set disableImageProcessing(h){this._objectRenderer.disableImageProcessing=h}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(h){this._objectRenderer.customIsReadyFunction=h}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(h){this._objectRenderer.customRenderFunction=h}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(h){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(h)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(h){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(h)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(h){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(h)}set onClear(h){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(h)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(h){this._objectRenderer._waitingRenderList=h}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(h,d){this._objectRenderer.setMaterialForRendering(h,d)}get isMulti(){var h;return(null===(h=this._renderTarget)||void 0===h?void 0:h.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(h){if(this._boundingBoxSize&&this._boundingBoxSize.equals(h))return;this._boundingBoxSize=h;const d=this.ih();d&&d.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var h;return(null===(h=this._renderTarget)||void 0===h?void 0:h._depthStencilTexture)??null}constructor(h,d,m){let w,a,D=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,I=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b.e.TRILINEAR_SAMPLINGMODE,Z=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],L=arguments.length>9&&void 0!==arguments[9]&&arguments[9],B=arguments.length>10&&void 0!==arguments[10]&&arguments[10],V=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,v=arguments.length>12&&void 0!==arguments[12]&&arguments[12],C=arguments.length>13?arguments[13]:void 0,T=arguments.length>14?arguments[14]:void 0,o=arguments.length>15&&void 0!==arguments[15]&&arguments[15],y=arguments.length>16&&void 0!==arguments[16]&&arguments[16],i=!0;if("object"===typeof D){const h=D;D=!!h.generateMipMaps,M=h.doNotChangeAspectRatio??!0,q=h.type??0,I=!!h.isCube,R=h.samplingMode??b.e.TRILINEAR_SAMPLINGMODE,Z=h.generateDepthBuffer??!0,L=!!h.generateStencilBuffer,B=!!h.isMulti,V=h.format??5,v=!!h.delayAllocation,C=h.samples,T=h.creationFlags,o=!!h.noColorAttachment,y=!!h.useSRGBBuffer,w=h.colorAttachment,i=h.gammaSpace??i,a=h.existingObjectRenderer}if(super(null,m,!D,void 0,R,void 0,void 0,void 0,void 0,V),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new j.e,this.onAfterUnbindObservable=new j.e,this.onClearObservable=new j.e,this.onResizeObservable=new j.e,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this._dontDisposeObjectRenderer=!1,this.boundingBoxPosition=A.i.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,!(m=this.ih()))return;const g=this.ih().getEngine();this._gammaSpace=i,this._coordinatesMode=b.e.PROJECTION_MODE,this.name=h,this.isRenderTarget=!0,this._initialSizeParameter=d,this._dontDisposeObjectRenderer=!!a,this._processSizeParameter(d),this._objectRenderer=a??new E(h,m,{numPasses:I?6:this.getRenderLayers()||1,doNotChangeAspectRatio:M}),this._onBeforeRenderingManagerRenderObserver=this._objectRenderer.onBeforeRenderingManagerRenderObservable.add((()=>{if(!this._disableEngineStages)for(const h of this._scene._beforeRenderTargetClearStage)h.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(g):this.skipInitialClear||g.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(const h of this._scene._beforeRenderTargetDrawStage)h.action(this,this._currentFaceIndex,this._currentLayer)})),this._onAfterRenderingManagerRenderObserver=this._objectRenderer.onAfterRenderingManagerRenderObservable.add((()=>{var h;if(!this._disableEngineStages)for(const m of this._scene._afterRenderTargetDrawStage)m.action(this,this._currentFaceIndex,this._currentLayer);const d=(null===(h=this._texture)||void 0===h?void 0:h.generateMipMaps)??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(const m of this._scene._afterRenderTargetPostProcessStage)m.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=d),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),g):S.c.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))})),this._onFastPathRenderObserver=this._objectRenderer.onFastPathRenderObservable.add((()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(g):this.skipInitialClear||g.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)})),this._resizeObserver=g.onResizeObservable.add((()=>{})),this._generateMipMaps=!!D,this._doNotChangeAspectRatio=M,B||(this._renderTargetOptions={generateMipMaps:D,type:q,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:Z,generateStencilBuffer:L,samples:C,creationFlags:T,noColorAttachment:o,useSRGBBuffer:y,colorAttachment:w,label:this.name},this.samplingMode===b.e.NEAREST_SAMPLINGMODE&&(this.wrapU=b.e.CLAMP_ADDRESSMODE,this.wrapV=b.e.CLAMP_ADDRESSMODE),v||(I?(this._renderTarget=m.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=b.e.INVCUBIC_MODE,this._textureMatrix=A.b.Identity()):this._renderTarget=m.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==C&&(this.samples=C)))}createDepthStencilTexture(){var h;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,w=arguments.length>5?arguments[5]:void 0;null===(h=this._renderTarget)||void 0===h||h.createDepthStencilTexture(d,m,j,A,b,w)}_processSizeParameter(h){if(h.ratio){this._sizeRatio=h.ratio;const d=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(d.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(d.getRenderHeight(),this._sizeRatio)}}else this._size=h}get samples(){var h;return(null===(h=this._renderTarget)||void 0===h?void 0:h.samples)??this._samples}set samples(h){this._renderTarget&&(this._samples=this._renderTarget.setSamples(h))}addPostProcess(h){if(!this._postProcessManager){const h=this.ih();if(!h)return;this._postProcessManager=new w.e(h),this._postProcesses=new Array}this._postProcesses.push(h),this._postProcesses[0].Qq=!1}clearPostProcesses(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(h)for(const h of this._postProcesses)h.dispose();this._postProcesses=[]}}removePostProcess(h){if(!this._postProcesses)return;const d=this._postProcesses.indexOf(h);-1!==d&&(this._postProcesses.splice(d,1),this._postProcesses.length>0&&(this._postProcesses[0].Qq=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(h){this._objectRenderer.refreshRate=h}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const h=this._size.layers;if(h)return h;const d=this._size.depth;return d||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(h){const d=Math.max(1,this.getRenderSize()*h);this.resize(d)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(h){var d;const m=this.isCube;null===(d=this._renderTarget)||void 0===d||d.dispose(),this._renderTarget=null;const j=this.ih();j&&(this._processSizeParameter(h),this._renderTarget=m?j.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):j.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(h,d)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(m.bind(m,11582)).then((h=>this._dumpTools=h))),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());const h=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),h}_render(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const m=this.ih();if(m){if(void 0!==this.useCameraPostProcesses&&(h=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let j=0;j<6;j++)this._renderToTarget(j,h,d),m.incrementRenderId(),m.resetCachedMaterial();else this._renderToTarget(0,h,d);else for(let j=0;j<this.getRenderLayers();j++)this._renderToTarget(0,h,d,j),m.incrementRenderId(),m.resetCachedMaterial();this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(h,d){const m=h*d,j=(0,a.m)(m+16384/(128+m));return Math.min((0,a.c)(h),j)}_bindFrameBuffer(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const m=this.ih();if(!m)return;const j=m.getEngine();this._renderTarget&&j.bindFramebuffer(this._renderTarget,this.isCube?h:void 0,void 0,void 0,this.ignoreCameraViewport,0,d)}_unbindFrameBuffer(h,d){this._renderTarget&&h.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(d)}))}_prepareFrame(h,d,m,j){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses)||this._bindFrameBuffer(d,m):j&&h.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(d,m)}_renderToTarget(h,d,m){var j,A;let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const w=this.ih();if(!w)return;const a=w.getEngine();this._currentFaceIndex=h,this._currentLayer=b,this._currentUseCameraPostProcess=d,this._currentDumpForDebug=m,this._prepareFrame(w,h,b,d),null===(j=a._debugPushGroup)||void 0===j||j.call(a,`render to face #${h} layer #${b}`,2),this._objectRenderer.render(h+b,!0),null===(A=a._debugPopGroup)||void 0===A||A.call(a,2),this._unbindFrameBuffer(a,h),this._texture&&this.isCube&&5===h&&a.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._objectRenderer.setRenderingOrder(h,d,m,j)}setRenderingAutoClearDepthStencil(h,d){this._objectRenderer.setRenderingAutoClearDepthStencil(h,d)}clone(){const h=this.getSize(),d=new I(this.name,h,this.ih(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return d.Nd=this.Nd,d.level=this.level,d.coordinatesMode=this.coordinatesMode,this.renderList&&(d.renderList=this.renderList.slice(0)),d}serialize(){if(!this.name)return null;const h=super.serialize();if(h.renderTargetSize=this.getRenderSize(),h.renderList=[],this.renderList)for(let d=0;d<this.renderList.length;d++)h.renderList.push(this.renderList[d].id);return h}disposeFramebufferObjects(){var h;null===(h=this._renderTarget)||void 0===h||h.dispose(!0)}releaseInternalTexture(){var h;null===(h=this._renderTarget)||void 0===h||h.releaseTextures(),this._texture=null}dispose(){var h;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.onBeforeRenderingManagerRenderObservable.remove(this._onBeforeRenderingManagerRenderObserver),this._objectRenderer.onAfterRenderingManagerRenderObservable.remove(this._onAfterRenderingManagerRenderObserver),this._objectRenderer.onFastPathRenderObservable.remove(this._onFastPathRenderObserver),this._dontDisposeObjectRenderer||this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.ih().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);const d=this.ih();if(!d)return;let m=d.customRenderTargets.indexOf(this);m>=0&&d.customRenderTargets.splice(m,1);for(const j of d.cameras)m=j.customRenderTargets.indexOf(this),m>=0&&j.customRenderTargets.splice(m,1);null===(h=this._renderTarget)||void 0===h||h.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}I.REFRESHRATE_RENDER_ONCE=E.REFRESHRATE_RENDER_ONCE,I.REFRESHRATE_RENDER_ONEVERYFRAME=E.REFRESHRATE_RENDER_ONEVERYFRAME,I.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=E.REFRESHRATE_RENDER_ONEVERYTWOFRAMES,b.e._CreateRenderTargetTexture=(h,d,m,j,A)=>new I(h,d,m,j)},11543:(h,d,m)=>{m.d(d,{e:()=>v});var j=m(11258),A=m(11261),b=m(11097),w=m(11058),a=m(11534),D=m(11080),S=m(11137),M=m(11183),q=m(11238),E=m(11337),I=m(11162);function R(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=d.width,A=d.height;if(h instanceof Float32Array){let d=h.byteLength/h.BYTES_PER_ELEMENT;const m=new Uint8Array(d);for(;--d>=0;){let j=h[d];j<0?j=0:j>1&&(j=1),m[d]=255*j}h=m}const b=document.createElement("canvas");b.width=j,b.height=A;const w=b.getContext("2d");if(!w)return null;const a=w.createImageData(j,A);if(a.data.set(h),w.putImageData(a,0,0),m){const h=document.createElement("canvas");h.width=j,h.height=A;const d=h.getContext("2d");return d?(d.translate(0,A),d.scale(1,-1),d.drawImage(b,0,0),h.toDataURL("image/png")):null}return b.toDataURL("image/png")}function Z(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const j=h.getInternalTexture();if(!j)return null;const A=h._readPixelsSync(d,m);return A?R(A,h.getSize(),j.invertY):null}async function L(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const j=h.getInternalTexture();if(!j)return null;const A=await h.readPixels(d,m);return A?R(A,h.getSize(),j.invertY):null}var B=m(11449),V=m(11341);class v extends a.b{static _CreateVideoTexture(h,d,m){arguments.length>5&&void 0!==arguments[5]||v.TRILINEAR_SAMPLINGMODE;throw(0,S.b)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(h){this._isBlocking=h}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(h,d,m,j){let A,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v.TRILINEAR_SAMPLINGMODE,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],E=arguments.length>9?arguments[9]:void 0,I=arguments.length>10?arguments[10]:void 0,R=arguments.length>11?arguments[11]:void 0,Z=arguments.length>12?arguments[12]:void 0,L=arguments.length>13?arguments[13]:void 0;super(d),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new b.e,this._isBlocking=!0,this.name=h||"",this.url=h;let V=!1,C=null,T=!0;"object"===typeof m&&null!==m?(A=m.noMipmap??!1,j=m.invertY??!B.b,w=m.samplingMode??v.TRILINEAR_SAMPLINGMODE,a=m.u??null,D=m.onError??null,S=m.buffer??null,q=m.deleteBuffer??!1,E=m.format,I=m.mimeType,R=m.loaderOptions,Z=m.creationFlags,V=m.useSRGBBuffer??!1,C=m.internalTexture??null,T=m.gammaSpace??T,L=m.forcedExtension??L):A=!!m,this._gammaSpace=T,this._noMipmap=A,this._invertY=void 0===j?!B.b:j,this._initialSamplingMode=w,this._buffer=S,this._deleteBuffer=q,this._mimeType=I,this._loaderOptions=R,this._creationFlags=Z,this._useSRGBBuffer=V,this._forcedExtension=L,void 0!==E&&(this._format=E);const o=this.ih(),y=this._getEngine();if(!y)return;y.onBeforeTextureInitObservable.notifyObservers(this);const i=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),a&&a(),!this.isBlocking&&o&&o.resetCachedMaterial()},g=(h,d)=>{this._loadingError=!0,this._errorObject={message:h,exception:d},D&&D(h,d),v.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!C)return this._delayedOnLoad=i,void(this._delayedOnError=g);if(this._texture=C??this._getFromCache(this.url,A,w,this._invertY,V,this.isCube),this._texture)if(this._texture.isReady)M.c.SetImmediate((()=>i()));else{const h=this._texture.onLoadedObservable.add(i);this._texture.onErrorObservable.add((d=>{var m;g(d.message,d.exception),null===(m=this._texture)||void 0===m||m.onLoadedObservable.remove(h)}))}else if(o&&o.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=g;else{try{this._texture=y.createTexture(this.url,A,this._invertY,o,w,i,g,this._buffer,void 0,this._format,this._forcedExtension,I,R,Z,V)}catch(F){throw g("error loading",F),F}q&&(this._buffer=null)}}updateURL(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,j=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.ih().markAllMaterialsAsDirty(1,(h=>h.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=h),this.url=h,this._buffer=d,this._forcedExtension=j,this.delayLoadState=4,m&&(this._delayedOnLoad=m),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const h=this.ih();h&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?M.c.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=h.getEngine().createTexture(this.url,this._noMipmap,this._invertY,h,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(h,d,m,j){h*=this._cachedUScale,d*=this._cachedVScale,h-=this.uRotationCenter*this._cachedUScale,d-=this.vRotationCenter*this._cachedVScale,m-=this.wRotationCenter,w.i.TransformCoordinatesFromFloatsToRef(h,d,m,this._rowGenerationMatrix,j),j.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,j.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,j.z+=this.wRotationCenter}getTextureMatrix(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*h===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*h,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=w.b.Zero(),this._rowGenerationMatrix=new w.b,this._t0=w.i.Zero(),this._t1=w.i.Zero(),this._t2=w.i.Zero()),w.b.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(w.b.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,w.d.Matrix[0]),w.b.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,w.d.Matrix[1]),w.b.ScalingToRef(this._cachedUScale,this._cachedVScale,0,w.d.Matrix[2]),w.b.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,w.d.Matrix[3]),w.d.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(w.d.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(w.d.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(w.d.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.Dq(this._t0),this._t2.Dq(this._t0),w.b.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const d=this.ih();if(!d)return this._cachedTextureMatrix;const m=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&m!==this._cachedIdentity3x2&&d.markAllMaterialsAsDirty(1,(h=>h.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const h=this.ih();if(!h)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==v.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===h.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=w.b.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=w.b.Zero());const d=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case v.PLANAR_MODE:w.b.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case v.PROJECTION_MODE:{w.b.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const d=h.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=d.updateFlag,d.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:w.b.IdentityToRef(this._cachedReflectionTextureMatrix)}return d&&h.markAllMaterialsAsDirty(1,(h=>h.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const h={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,u:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return V.d.Clone((()=>new v(this._texture?this._texture.url:null,this.ih(),h)),this)}serialize(){var h;const d=this.name;v.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const m=super.serialize(v._SerializeInternalTextureUniqueId);if(!m)return null;if(v.SerializeBuffers||v.ForceSerializeBuffers)if("string"===typeof this._buffer&&this._buffer.startsWith("data:"))m.base64String=this._buffer,m.name=m.name.replace("data:","");else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){const h=this.mimeType||"image/png";m.base64String=`data:${h};base64,${(0,I.p)(this._buffer)}`}else(v.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(m.base64String=!this._engine||this._engine._features.supportSyncTextureRead?Z(this):L(this));var j;(m.invertY=this._invertY,m.samplingMode=this.samplingMode,m._creationFlags=this._creationFlags,m._useSRGBBuffer=this._useSRGBBuffer,v._SerializeInternalTextureUniqueId)&&(m.internalTextureUniqueId=null===(j=this._texture)||void 0===j?void 0:j.uniqueId);return m.internalTextureLabel=null===(h=this._texture)||void 0===h?void 0:h.label,m.noMipmap=this._noMipmap,this.name=d,m}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(h,d,m){if(h.customType){const j=q.e.Instantiate(h.customType).Parse(h,d,m);return h.samplingMode&&j.updateSamplingMode&&j._samplingMode&&j._samplingMode!==h.samplingMode&&j.updateSamplingMode(h.samplingMode),j}if(h.isCube&&!h.isRenderTarget)return v._CubeTextureParser(h,d,m);const j=void 0!==h.internalTextureUniqueId;if(!h.name&&!h.isRenderTarget&&!j)return null;let A;if(j){const m=d.getEngine().getLoadedTexturesCache();for(const d of m)if(d.uniqueId===h.internalTextureUniqueId){A=d;break}}const b=d=>{if(d&&d._texture&&(d._texture._cachedWrapU=null,d._texture._cachedWrapV=null,d._texture._cachedWrapR=null),h.samplingMode){const m=h.samplingMode;d&&d.samplingMode!==m&&d.updateSamplingMode(m)}if(d&&h.animations)for(let m=0;m<h.animations.length;m++){const j=h.animations[m],A=(0,D.e)("BABYLON.Animation");A&&d.animations.push(A.Parse(j))}d&&d._texture&&(j&&!A&&d._texture._setUniqueId(h.internalTextureUniqueId),d._texture.label=h.internalTextureLabel)};return V.d.Parse((()=>{let j=!0;if(h.noMipmap&&(j=!1),h.mirrorPlane){const m=v._CreateMirror(h.name,h.renderTargetSize,d,j);return m._waitingRenderList=h.renderList,m.mirrorPlane=E.e.Ud(h.mirrorPlane),b(m),m}if(h.isRenderTarget){let m=null;if(h.isCube){if(d.reflectionProbes)for(let j=0;j<d.reflectionProbes.length;j++){const m=d.reflectionProbes[j];if(m.name===h.name)return m.cubeTexture}}else m=v._CreateRenderTargetTexture(h.name,h.renderTargetSize,d,j,h._creationFlags??0),m._waitingRenderList=h.renderList;return b(m),m}if(h.isVideo){const A=v._CreateVideoTexture(m+(h.url||h.name),m+(h.src||h.url),d,j,h.invertY,h.samplingMode,h.settings||{});return b(A),A}{let w;if(h.base64String&&!A)w=v.CreateFromBase64String(h.base64String,h.base64String,d,!j,h.invertY,h.samplingMode,(()=>{b(w)}),h._creationFlags??0,h._useSRGBBuffer??!1),w.name=h.name;else{let a;a=h.name&&(h.name.indexOf("://")>0||h.name.startsWith("data:"))?h.name:m+h.name,h.url&&(h.url.startsWith("data:")||v.UseSerializedUrlIfAny)&&(a=h.url);const D={noMipmap:!j,invertY:h.invertY,samplingMode:h.samplingMode,u:()=>{b(w)},internalTexture:A};w=new v(a,d,D)}return w}}),h,d)}static CreateFromBase64String(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:v.TRILINEAR_SAMPLINGMODE;return new v("data:"+d,m,j,A,b,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:v.TRILINEAR_SAMPLINGMODE,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,M=arguments.length>10?arguments[10]:void 0,q=arguments.length>11?arguments[11]:void 0;return"data:"!==h.substring(0,5)&&(h="data:"+h),new v(h,m,A,b,w,a,D,d,j,S,void 0,void 0,M,q)}}v.SerializeBuffers=!0,v.ForceSerializeBuffers=!1,v.OnTextureLoadErrorObservable=new b.e,v._SerializeInternalTextureUniqueId=!1,v._CubeTextureParser=(h,d,m)=>{throw(0,S.b)("CubeTexture")},v._CreateMirror=(h,d,m,j)=>{throw(0,S.b)("MirrorTexture")},v._CreateRenderTargetTexture=(h,d,m,j,A)=>{throw(0,S.b)("RenderTargetTexture")},v.NEAREST_SAMPLINGMODE=1,v.NEAREST_NEAREST_MIPLINEAR=8,v.BILINEAR_SAMPLINGMODE=2,v.LINEAR_LINEAR_MIPNEAREST=11,v.TRILINEAR_SAMPLINGMODE=3,v.LINEAR_LINEAR_MIPLINEAR=3,v.NEAREST_NEAREST_MIPNEAREST=4,v.NEAREST_LINEAR_MIPNEAREST=5,v.NEAREST_LINEAR_MIPLINEAR=6,v.NEAREST_LINEAR=7,v.NEAREST_NEAREST=1,v.LINEAR_NEAREST_MIPNEAREST=9,v.LINEAR_NEAREST_MIPLINEAR=10,v.LINEAR_LINEAR=2,v.LINEAR_NEAREST=12,v.EXPLICIT_MODE=0,v.SPHERICAL_MODE=1,v.PLANAR_MODE=2,v.CUBIC_MODE=3,v.PROJECTION_MODE=4,v.SKYBOX_MODE=5,v.INVCUBIC_MODE=6,v.EQUIRECTANGULAR_MODE=7,v.FIXED_EQUIRECTANGULAR_MODE=8,v.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,v.CLAMP_ADDRESSMODE=0,v.WRAP_ADDRESSMODE=1,v.MIRROR_ADDRESSMODE=2,v.UseSerializedUrlIfAny=!1,(0,j.d)([(0,A.M)()],v.prototype,"url",void 0),(0,j.d)([(0,A.M)()],v.prototype,"uOffset",void 0),(0,j.d)([(0,A.M)()],v.prototype,"vOffset",void 0),(0,j.d)([(0,A.M)()],v.prototype,"uScale",void 0),(0,j.d)([(0,A.M)()],v.prototype,"vScale",void 0),(0,j.d)([(0,A.M)()],v.prototype,"uAng",void 0),(0,j.d)([(0,A.M)()],v.prototype,"vAng",void 0),(0,j.d)([(0,A.M)()],v.prototype,"wAng",void 0),(0,j.d)([(0,A.M)()],v.prototype,"uRotationCenter",void 0),(0,j.d)([(0,A.M)()],v.prototype,"vRotationCenter",void 0),(0,j.d)([(0,A.M)()],v.prototype,"wRotationCenter",void 0),(0,j.d)([(0,A.M)()],v.prototype,"homogeneousRotationInUVTransform",void 0),(0,j.d)([(0,A.M)()],v.prototype,"isBlocking",null),(0,D.i)("BABYLON.Texture",v),V.d._TextureParser=v.Parse},11482:(h,d,m)=>{function j(h){return 13===h||14===h||15===h||16===h||17===h||18===h||19===h}function A(h){return 13===h||17===h||18===h||19===h}m.d(d,{b:()=>A,e:()=>j})},11223:(h,d,m)=>{m.d(d,{c:()=>j});class j{get wrapU(){return this._cachedWrapU}set wrapU(h){this._cachedWrapU=h}get wrapV(){return this._cachedWrapV}set wrapV(h){this._cachedWrapV=h}get wrapR(){return this._cachedWrapR}set wrapR(h){this._cachedWrapR=h}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(h){this._cachedAnisotropicFilteringLevel=h}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(h){this._comparisonFunction=h}get useMipMaps(){return this._useMipMaps}set useMipMaps(h){this._useMipMaps=h}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=h,this._cachedWrapV=d,this._cachedWrapR=m,this._cachedAnisotropicFilteringLevel=j,this.samplingMode=A,this._comparisonFunction=b,this}compareSampler(h){return this._cachedWrapU===h._cachedWrapU&&this._cachedWrapV===h._cachedWrapV&&this._cachedWrapR===h._cachedWrapR&&this._cachedAnisotropicFilteringLevel===h._cachedAnisotropicFilteringLevel&&this.samplingMode===h.samplingMode&&this._comparisonFunction===h._comparisonFunction&&this._useMipMaps===h._useMipMaps}}},11363:(h,d,m)=>{function j(h){-1===h.indexOf("vClipPlane")&&h.push("vClipPlane"),-1===h.indexOf("vClipPlane2")&&h.push("vClipPlane2"),-1===h.indexOf("vClipPlane3")&&h.push("vClipPlane3"),-1===h.indexOf("vClipPlane4")&&h.push("vClipPlane4"),-1===h.indexOf("vClipPlane5")&&h.push("vClipPlane5"),-1===h.indexOf("vClipPlane6")&&h.push("vClipPlane6")}function A(h,d,m){const j=!!(h.clipPlane??d.clipPlane),A=!!(h.clipPlane2??d.clipPlane2),b=!!(h.clipPlane3??d.clipPlane3),w=!!(h.clipPlane4??d.clipPlane4),a=!!(h.clipPlane5??d.clipPlane5),D=!!(h.clipPlane6??d.clipPlane6);j&&m.push("#define CLIPPLANE"),A&&m.push("#define CLIPPLANE2"),b&&m.push("#define CLIPPLANE3"),w&&m.push("#define CLIPPLANE4"),a&&m.push("#define CLIPPLANE5"),D&&m.push("#define CLIPPLANE6")}function b(h,d,m){let j=!1;const A=!!(h.clipPlane??d.clipPlane),b=!!(h.clipPlane2??d.clipPlane2),w=!!(h.clipPlane3??d.clipPlane3),a=!!(h.clipPlane4??d.clipPlane4),D=!!(h.clipPlane5??d.clipPlane5),S=!!(h.clipPlane6??d.clipPlane6);return m.CLIPPLANE!==A&&(m.CLIPPLANE=A,j=!0),m.CLIPPLANE2!==b&&(m.CLIPPLANE2=b,j=!0),m.CLIPPLANE3!==w&&(m.CLIPPLANE3=w,j=!0),m.CLIPPLANE4!==a&&(m.CLIPPLANE4=a,j=!0),m.CLIPPLANE5!==D&&(m.CLIPPLANE5=D,j=!0),m.CLIPPLANE6!==S&&(m.CLIPPLANE6=S,j=!0),j}function w(h,d,m){let j=d.clipPlane??m.clipPlane;a(h,"vClipPlane",j),j=d.clipPlane2??m.clipPlane2,a(h,"vClipPlane2",j),j=d.clipPlane3??m.clipPlane3,a(h,"vClipPlane3",j),j=d.clipPlane4??m.clipPlane4,a(h,"vClipPlane4",j),j=d.clipPlane5??m.clipPlane5,a(h,"vClipPlane5",j),j=d.clipPlane6??m.clipPlane6,a(h,"vClipPlane6",j)}function a(h,d,m){m&&h.setFloat4(d,m.Dd.x,m.Dd.y,m.Dd.z,m.d)}m.d(d,{b:()=>j,f:()=>w,g:()=>b,k:()=>A})},11615:(h,d,m)=>{function j(h){h.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}m.d(d,{d:()=>j})},11475:(h,d,m)=>{function j(h){return void 0===h.getPipelineContext}m.d(d,{b:()=>j})},11329:(h,d,m)=>{m.d(d,{d:()=>A});var j=m(11183);class A{static GetEffect(h){return void 0===h.getPipelineContext?h.effect:h}constructor(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=h.createDrawContext(),d&&(this.materialContext=h.createMaterialContext())}setEffect(h,d){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var j;(this.effect=h,void 0!==d&&(this.defines=d),m)&&(null===(j=this.drawContext)||void 0===j||j.reset())}dispose(){var h;let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const h=this.effect;d?h.dispose():j.c.SetImmediate((()=>{h.getEngine().onEndFrameObservable.addOnce((()=>{h.dispose()}))})),this.effect=null}null===(h=this.drawContext)||void 0===h||h.dispose()}}},11204:(h,d,m)=>{m.d(d,{c:()=>q,g:()=>I,j:()=>S,m:()=>M});var j=m(11115),A=m(11213),b=m(11200),w=m(11121),a=m(11171),D=m(11175);function S(h,d){return(0,A.y)(d).cachedPipelines[h]}function M(h){const d=h._name,m=h.context;if(d&&m){const h=(0,A.y)(m),j=h.cachedPipelines[d];null===j||void 0===j||j.dispose(),delete h.cachedPipelines[d]}}function q(h,d,m,A,b,w,D){let S,M;const q=(0,j.j)()?null===w||void 0===w?void 0:w.getHostDocument():null;S="string"===typeof d?d:d.vertexSource?"source:"+d.vertexSource:d.vertexElement?(null===q||void 0===q?void 0:q.getElementById(d.vertexElement))||d.vertexElement:d.vertex||d,M="string"===typeof d?d:d.fragmentSource?"source:"+d.fragmentSource:d.fragmentElement?(null===q||void 0===q?void 0:q.getElementById(d.fragmentElement))||d.fragmentElement:d.fragment||d;const I=[void 0,void 0],R=()=>{if(I[0]&&I[1]){h.isFragment=!0;const[j,S]=I;(0,a.i)(S,h,((w,S)=>{D&&(D._fragmentSourceCodeBeforeMigration=S),m&&(w=m("fragment",w));const M=(0,a.b)(j,w,h);h=null;const q=function(h,d,m,j){if(m){return{vertexSourceCode:(1===j?"//":"")+"#define SHADER_NAME vertex:"+(m.vertexElement||m.vertex||m.spectorName||m)+"\n"+h,fragmentSourceCode:(1===j?"//":"")+"#define SHADER_NAME fragment:"+(m.fragmentElement||m.fragment||m.spectorName||m)+"\n"+d}}return{vertexSourceCode:h,fragmentSourceCode:d}}(M.vertexCode,M.fragmentCode,d,b);null===A||void 0===A||A(q.vertexSourceCode,q.fragmentSourceCode)}),w)}};E(S,"Vertex","",(d=>{(0,a.d)(h),(0,a.i)(d,h,((h,j)=>{D&&(D._rawVertexSourceCode=d,D._vertexSourceCodeBeforeMigration=j),m&&(h=m("vertex",h)),I[0]=h,R()}),w)}),b),E(M,"Fragment","Pixel",(h=>{D&&(D._rawFragmentSourceCode=h),I[1]=h,R()}),b)}function E(h,d,m,A,w,a){if("undefined"!==typeof HTMLElement&&h instanceof HTMLElement){return void A((0,j.d)(h))}if("source:"===h.substring(0,7))return void A(h.substring(7));if("base64:"===h.substring(0,7)){return void A(window.atob(h.substring(7)))}const S=b.b.GetShadersStore(w);if(S[h+d+"Shader"])return void A(S[h+d+"Shader"]);if(m&&S[h+m+"Shader"])return void A(S[h+m+"Shader"]);let M;if(M="."===h[0]||"/"===h[0]||h.indexOf("http")>-1?h:b.b.GetShadersRepository(w)+h,!(a=a||D.l))throw new Error("loadFileInjection is not defined");a(M+"."+d.toLowerCase()+".fx",A)}const I=(h,d,m,j)=>{try{const b=h.context?(0,A.y)(h.context):null;b&&(b.disableParallelShaderCompile=h.disableParallelCompilation);const w=h.existingPipelineContext||d(h.shaderProcessingContext);return w._name=h.name,h.name&&b&&(b.cachedPipelines[h.name]=w),m(w,h.vertex,h.fragment,!!h.createAsRaw,"","",h.rebuildRebind,h.defines,h.transformFeedbackVaryings,"",(()=>{j(w,(()=>{var d;null===(d=h.onRenderingStateCompiled)||void 0===d||d.call(h,w)}))})),w}catch(b){throw w.c.Error("Error compiling effect"),b}}},11196:(h,d,m)=>{m.d(d,{e:()=>D});var j=m(11097),A=m(11121),b=m(11200),w=m(11204),a=m(11183);class D{static get ShadersRepository(){return b.b.ShadersRepository}static set ShadersRepository(h){b.b.ShadersRepository=h}get q(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new j.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(h,d,m){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,E=arguments.length>9?arguments[9]:void 0,I=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",R=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,Z=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new j.e,this.onErrorObservable=new j.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=h,this._key=I;const L=this._key.replace(/\r/g,"").replace(/\n/g,"|");let B;if(d.attributes){const h=d;if(this._engine=m,this._attributesNames=h.attributes,this._uniformsNames=h.uniformsNames.concat(h.samplers),this._samplerList=h.samplers.slice(),this.defines=h.defines,this.onError=h.onError,this.onCompiled=h.onCompiled,this._fallbacks=h.fallbacks,this._indexParameters=h.indexParameters,this._transformFeedbackVaryings=h.transformFeedbackVaryings||null,this._multiTarget=!!h.multiTarget,this._shaderLanguage=h.shaderLanguage??0,this._disableParallelShaderCompilation=!!h.disableParallelShaderCompilation,h.uniformBuffersNames){this._uniformBuffersNamesList=h.uniformBuffersNames.slice();for(let d=0;d<h.uniformBuffersNames.length;d++)this._uniformBuffersNames[h.uniformBuffersNames[d]]=d}this._processFinalCode=h.processFinalCode??null,this._processCodeAfterIncludes=h.processCodeAfterIncludes??void 0,Z=h.extraInitializationsAsync,B=h.existingPipelineContext}else this._engine=b,this.defines=null==a?"":a,this._uniformsNames=m.concat(A),this._samplerList=A?A.slice():[],this._attributesNames=d,this._uniformBuffersNamesList=[],this._shaderLanguage=R,this.onError=q,this.onCompiled=M,this._indexParameters=E,this._fallbacks=S;"WEBGL2"===this._engine.shaderPlatformName&&(B=(0,w.j)(L,this._engine._gl)??B),this._attributeLocationByName={},this.uniqueId=D._UniqueIdSeed++,B?(this._pipelineContext=B,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,Z),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.q||this.dispose(!0)}))}async _processShaderCodeAsync(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3?arguments[3]:void 0;j&&await j(),this._processingContext=m||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const A={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:h??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:b.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:b.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,w.c)(A,this.name,this._processFinalCode,((h,m)=>{this._vertexSourceCode=h,this._fragmentSourceCode=m,this._prepareEffect(d)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.q||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(h){return this._attributes[h]}getAttributeLocationByName(h){return this._attributeLocationByName[h]}getAttributesCount(){return this._attributes.length}getUniformIndex(h){return this._uniformsNames.indexOf(h)}getUniform(h){return this._uniforms[h]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((h=>{this.executeWhenCompiled(h)}))}executeWhenCompiled(h){this.isReady()?h(this):(this.onCompileObservable.add((d=>{h(d)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(h){(0,a.d)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(d=>{this._processCompilationErrors(d,h)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var h;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(h=this._pipelineContext)||void 0===h?void 0:h._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var h;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(h=this._pipelineContext)||void 0===h?void 0:h._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(h,d,m,j){this._isReady=!1,this._vertexSourceCodeOverride=h,this._fragmentSourceCodeOverride=d,this.onError=(h,d)=>{j&&j(d)},this.onCompiled=()=>{var h,d;const j=this.getEngine().scenes;if(j)for(let m=0;m<j.length;m++)j[m].markAllMaterialsAsDirty(127);null===(h=(d=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===h||h.call(d,m)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(h){if(this._pipelineContext=h,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let d=0;d<this._attributesNames.length;d++){const h=this._attributesNames[d];this._attributeLocationByName[h]=this._attributes[d]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),D.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=this._pipelineContext;this._isReady=!1;try{const m=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),j=m?null:this.defines,A=m?this._vertexSourceCodeOverride:this._vertexSourceCode,b=m?this._fragmentSourceCodeOverride:this._fragmentSourceCode,a=this._engine;this._pipelineContext=(0,w.g)({existingPipelineContext:h?d:null,vertex:A,fragment:b,context:"WEBGL2"===a.shaderPlatformName||"WEBGL1"===a.shaderPlatformName?a._gl:void 0,rebuildRebind:(h,d,m,j)=>this._rebuildProgram(h,d,m,j),defines:j,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:m,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:m=>{d&&!h&&this._engine._deletePipelineContext(d),m&&this._onRenderingStateCompiled(m)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(d)}catch(m){this._processCompilationErrors(m,d)}}_getShaderCodeAndErrorLine(h,d,m){const j=m?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let A=null;if(d&&h){const b=d.match(j);if(b&&2===b.length){const d=parseInt(b[1]),j=h.split("\n",-1);j.length>=d&&(A=`Offending line [${d}] in ${m?"fragment":"vertex"} code: ${j[d-1]}`)}}return[h,A]}_processCompilationErrors(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=h.message;const m=this._attributesNames,j=this._fallbacks;if(A.c.Error("Unable to compile effect:"),A.c.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),A.c.Error(`Attributes: ${m.join(" ")}`),A.c.Error("Defines:\n"+this.defines),D.LogShaderCodeOnCompilationError){var b,w;let h=null,d=null,m=null;var a;if(null!==(b=this._pipelineContext)&&void 0!==b&&b._getVertexShaderCode()&&([m,h]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),m&&(A.c.Error("Vertex code:"),A.c.Error(m))),null!==(w=this._pipelineContext)&&void 0!==w&&w._getFragmentShaderCode())[m,d]=this._getShaderCodeAndErrorLine(null===(a=this._pipelineContext)||void 0===a?void 0:a._getFragmentShaderCode(),this._compilationError,!0),m&&(A.c.Error("Fragment code:"),A.c.Error(m));h&&A.c.Error(h),d&&A.c.Error(d)}A.c.Error("Error: "+this._compilationError);const S=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};d&&(this._pipelineContext=d,this._isReady=!0,S()),j?(this._pipelineContext=null,j.hasMoreFallbacks?(this._allFallbacksProcessed=!1,A.c.Error("Trying next fallback."),this.defines=j.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,S(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,d||S())}get isSupported(){return""===this._compilationError}_bindTexture(h,d){this._engine._bindTexture(this._samplers[h],d,h)}setTexture(h,d){this._engine.setTexture(this._samplers[h],this._uniforms[h],d,h)}setTextureArray(h,d){const m=h+"Ex";if(-1===this._samplerList.indexOf(m+"0")){const j=this._samplerList.indexOf(h);for(let h=1;h<d.length;h++){const d=m+(h-1).toString();this._samplerList.splice(j+h,0,d)}let A=0;for(const h of this._samplerList)this._samplers[h]=A,A+=1}this._engine.setTextureArray(this._samplers[h],this._uniforms[h],d,h)}bindUniformBuffer(h,d){const m=this._uniformBuffersNames[d];void 0===m||D._BaseCache[m]===h&&this._engine._features.useUBOBindingCache||(D._BaseCache[m]=h,this._engine.bindUniformBufferBase(h,m,d))}bindUniformBlock(h,d){this._engine.bindUniformBlock(this._pipelineContext,h,d)}setInt(h,d){return this._pipelineContext.setInt(h,d),this}setInt2(h,d,m){return this._pipelineContext.setInt2(h,d,m),this}setInt3(h,d,m,j){return this._pipelineContext.setInt3(h,d,m,j),this}setInt4(h,d,m,j,A){return this._pipelineContext.setInt4(h,d,m,j,A),this}setIntArray(h,d){return this._pipelineContext.setIntArray(h,d),this}setIntArray2(h,d){return this._pipelineContext.setIntArray2(h,d),this}setIntArray3(h,d){return this._pipelineContext.setIntArray3(h,d),this}setIntArray4(h,d){return this._pipelineContext.setIntArray4(h,d),this}setUInt(h,d){return this._pipelineContext.setUInt(h,d),this}setUInt2(h,d,m){return this._pipelineContext.setUInt2(h,d,m),this}setUInt3(h,d,m,j){return this._pipelineContext.setUInt3(h,d,m,j),this}setUInt4(h,d,m,j,A){return this._pipelineContext.setUInt4(h,d,m,j,A),this}setUIntArray(h,d){return this._pipelineContext.setUIntArray(h,d),this}setUIntArray2(h,d){return this._pipelineContext.setUIntArray2(h,d),this}setUIntArray3(h,d){return this._pipelineContext.setUIntArray3(h,d),this}setUIntArray4(h,d){return this._pipelineContext.setUIntArray4(h,d),this}setFloatArray(h,d){return this._pipelineContext.setArray(h,d),this}setFloatArray2(h,d){return this._pipelineContext.setArray2(h,d),this}setFloatArray3(h,d){return this._pipelineContext.setArray3(h,d),this}setFloatArray4(h,d){return this._pipelineContext.setArray4(h,d),this}setArray(h,d){return this._pipelineContext.setArray(h,d),this}setArray2(h,d){return this._pipelineContext.setArray2(h,d),this}setArray3(h,d){return this._pipelineContext.setArray3(h,d),this}setArray4(h,d){return this._pipelineContext.setArray4(h,d),this}setMatrices(h,d){return this._pipelineContext.setMatrices(h,d),this}setMatrix(h,d){return this._pipelineContext.setMatrix(h,d),this}setMatrix3x3(h,d){return this._pipelineContext.setMatrix3x3(h,d),this}setMatrix2x2(h,d){return this._pipelineContext.setMatrix2x2(h,d),this}setFloat(h,d){return this._pipelineContext.setFloat(h,d),this}setBool(h,d){return this._pipelineContext.setInt(h,d?1:0),this}setVector2(h,d){return this._pipelineContext.setVector2(h,d),this}setFloat2(h,d,m){return this._pipelineContext.setFloat2(h,d,m),this}setVector3(h,d){return this._pipelineContext.setVector3(h,d),this}setFloat3(h,d,m,j){return this._pipelineContext.setFloat3(h,d,m,j),this}setVector4(h,d){return this._pipelineContext.setVector4(h,d),this}setQuaternion(h,d){return this._pipelineContext.setQuaternion(h,d),this}setFloat4(h,d,m,j,A){return this._pipelineContext.setFloat4(h,d,m,j,A),this}setColor3(h,d){return this._pipelineContext.setColor3(h,d),this}setColor4(h,d,m){return this._pipelineContext.setColor4(h,d,m),this}setDirectColor4(h,d){return this._pipelineContext.setDirectColor4(h,d),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(D.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,w.m)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;d&&(b.b.GetShadersStore(j)[`${h}PixelShader`]=d),m&&(b.b.GetShadersStore(j)[`${h}VertexShader`]=m)}static ResetCache(){D._BaseCache={}}}D.LogShaderCodeOnCompilationError=!0,D.PersistentMode=!1,D.AutomaticallyClearCodeCache=!1,D._UniqueIdSeed=0,D._BaseCache={},D.ShadersStore=b.b.ShadersStore,D.IncludesShadersStore=b.b.IncludesShadersStore},11684:(h,d,m)=>{m.d(d,{e:()=>j});class j{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(h,d){this._defines[h]||(h<this._currentRank&&(this._currentRank=h),h>this._maxRank&&(this._maxRank=h),this._defines[h]=new Array),this._defines[h].push(d)}addCPUSkinningFallback(h,d){this._mesh=d,h<this._currentRank&&(this._currentRank=h),h>this._maxRank&&(this._maxRank=h)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(h,d){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,h=h.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),d._bonesComputationForcedToCPU=!0;const m=this._mesh.ih();for(let h=0;h<m.meshes.length;h++){const j=m.meshes[h];if(j.material){if(j.computeBonesUsingShaders&&0!==j.numBoneInfluencers)if(j.material.getEffect()===d)j.computeBonesUsingShaders=!1;else if(j.Ab)for(const h of j.Ab){if(h.effect===d){j.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&j.computeBonesUsingShaders&&j.numBoneInfluencers>0&&(j.computeBonesUsingShaders=!1)}}else{const d=this._defines[this._currentRank];if(d)for(let m=0;m<d.length;m++)h=h.replace("#define "+d[m],"");this._currentRank++}return h}}},11561:(h,d,m)=>{m.d(d,{b:()=>S,c:()=>M});var j=m(11281),A=m(11432),b=m(11097),w=m(11196),a=m(11329);m(11565);const D={Fh:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class S{constructor(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D;this._fullscreenViewport=new A.d(0,0,1,1);const m=d.Fh??D.Fh,b=d.indices??D.indices;this.sa=h,this._vertexBuffers={[j.d.PositionKind]:new j.d(h,m,j.d.PositionKind,!1,!1,2)},this._indexBuffer=h.createIndexBuffer(b),this._indexBufferLength=b.length,this._onContextRestoredObserver=h.onContextRestoredObservable.add((()=>{this._indexBuffer=h.createIndexBuffer(b);for(const h in this._vertexBuffers){this._vertexBuffers[h]._rebuild()}}))}setViewport(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.sa.setViewport(h)}bindBuffers(h){this.sa.bindBuffers(this._vertexBuffers,this._indexBuffer,h)}applyEffectWrapper(h){this.sa.setState(!0),this.sa.depthCullingState.depthTest=!1,this.sa.stencilState.stencilTest=!1,this.sa.enableEffect(h.drawWrapper),this.bindBuffers(h.effect),h.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.sa.depthCullingState.depthTest,this._savedStateStencilTest=this.sa.stencilState.stencilTest}restoreStates(){this.sa.depthCullingState.depthTest=this._savedStateDepthTest,this.sa.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.sa.drawElementsType(0,0,this._indexBufferLength)}_isRenderTargetTexture(h){return void 0!==h.renderTarget}render(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!h.effect.isReady())return;this.saveStates(),this.setViewport();const m=null===d?null:this._isRenderTargetTexture(d)?d.renderTarget:d;m&&this.sa.bindFramebuffer(m),this.applyEffectWrapper(h),this.draw(),m&&this.sa.unBindFramebuffer(m),this.restoreStates()}dispose(){const h=this._vertexBuffers[j.d.PositionKind];h&&(h.dispose(),delete this._vertexBuffers[j.d.PositionKind]),this._indexBuffer&&this.sa._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.sa.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class M{static RegisterShaderCodeProcessing(h,d){d?M._CustomShaderCodeProcessing[h??""]=d:delete M._CustomShaderCodeProcessing[h??""]}static _GetShaderCodeProcessing(h){return M._CustomShaderCodeProcessing[h]??M._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(h){this.options.name=h}isReady(){var h;return(null===(h=this._drawWrapper.effect)||void 0===h?void 0:h.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(h){this._drawWrapper.effect=h}constructor(h){this.alphaMode=0,this.onEffectCreatedObservable=new b.e(void 0,!0),this.onApplyObservable=new b.e,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...h,name:h.name||"effectWrapper",sa:h.sa,uniforms:h.uniforms||h.uniformNames||[],uniformNames:void 0,samplers:h.samplers||h.samplerNames||[],samplerNames:void 0,attributeNames:h.attributeNames||["position"],uniformBuffers:h.uniformBuffers||[],defines:h.defines||"",useShaderStore:h.useShaderStore||!1,vertexUrl:h.vertexUrl||h.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:h.fragmentShader||"pass",indexParameters:h.indexParameters,blockCompilation:h.blockCompilation||!1,shaderLanguage:h.shaderLanguage||0,onCompiled:h.onCompiled||void 0,extraInitializations:h.extraInitializations||void 0,extraInitializationsAsync:h.extraInitializationsAsync||void 0,useAsPostProcess:h.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),h.vertexUrl||h.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.sa.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new a.d(this.options.sa),this._webGPUReady=1===this.options.shaderLanguage;const d=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,d,this.options.extraInitializations)}_gatherImports(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(h&&this._webGPUReady?d.push(Promise.all([m.e(42).then(m.bind(m,13411))])):d.push(Promise.all([Promise.resolve().then(m.bind(m,11565))])))}_postConstructor(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,j=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,j&&this._importPromises.push(...j);const A=this.options.sa.isWebGPU&&!M.ForceGLSL;this._gatherImports(A,this._importPromises),void 0!==m&&m(A,this._importPromises),A&&this._webGPUReady&&(this.options.shaderLanguage=1),h||this.updateEffect(d)}updateEffect(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,D=arguments.length>7?arguments[7]:void 0;const S=M._GetShaderCodeProcessing(this.name);if(null!==S&&void 0!==S&&S.defineCustomBindings){var q,E;const j=(null===(q=d)||void 0===q?void 0:q.slice())??[];j.push(...this.options.uniforms);const A=(null===(E=m)||void 0===E?void 0:E.slice())??[];A.push(...this.options.samplers),h=S.defineCustomBindings(this.name,h,j,A),d=j,m=A}this.options.defines=h||"";const I=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let R;R=this.options.extraInitializationsAsync?async()=>{null===I||void 0===I||I(),await this.options.extraInitializationsAsync()}:I,this.options.useShaderStore?this._drawWrapper.effect=this.options.sa.createEffect({vertex:a??this._shaderPath.vertex,fragment:D??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:d||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:m||this.options.samplers,defines:null!==h?h:"",fallbacks:null,onCompiled:A??this.options.onCompiled,onError:b??null,indexParameters:j||this.options.indexParameters,processCodeAfterIncludes:null!==S&&void 0!==S&&S.processCodeAfterIncludes?(h,d)=>S.processCodeAfterIncludes(this.name,h,d):null,processFinalCode:null!==S&&void 0!==S&&S.processFinalCode?(h,d)=>S.processFinalCode(this.name,h,d):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:R},this.options.sa):this._drawWrapper.effect=new w.e(this._shaderPath,this.options.attributeNames,d||this.options.uniforms,m||this.options.samplerNames,this.options.sa,h,void 0,A||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,R),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var h,d;let m=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.options.useAsPostProcess&&!m&&(this.options.sa.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(h=M._GetShaderCodeProcessing(this.name))||void 0===h||null===(d=h.bindCustomBindings)||void 0===d||d.call(h,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this._drawWrapper.dispose(!0)}}M.ForceGLSL=!1,M._CustomShaderCodeProcessing={}},11617:(h,d,m)=>{m.d(d,{b:()=>b,e:()=>A});var j=m(11615);function A(h,d){d.EXPOSURE&&h.push("exposureLinear"),d.CONTRAST&&h.push("contrast"),d.COLORGRADING&&h.push("colorTransformSettings"),(d.VIGNETTE||d.DITHER)&&h.push("vInverseScreenSize"),d.VIGNETTE&&(h.push("vignetteSettings1"),h.push("vignetteSettings2")),d.COLORCURVES&&(0,j.d)(h),d.DITHER&&h.push("ditherIntensity")}function b(h,d){d.COLORGRADING&&h.push("txColorTransform")}},11606:(h,d,m)=>{m.d(d,{d:()=>I});var j=m(11258),A=m(11261),b=m(11097),w=m(11353),a=m(11341),D=m(11615);class S{constructor(){this._dirty=!0,this._tempColor=new w.f(0,0,0,0),this._globalCurve=new w.f(0,0,0,0),this._highlightsCurve=new w.f(0,0,0,0),this._midtonesCurve=new w.f(0,0,0,0),this._shadowsCurve=new w.f(0,0,0,0),this._positiveCurve=new w.f(0,0,0,0),this._negativeCurve=new w.f(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(h){this._globalHue=h,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(h){this._globalDensity=h,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(h){this._globalSaturation=h,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(h){this._globalExposure=h,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(h){this._highlightsHue=h,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(h){this._highlightsDensity=h,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(h){this._highlightsSaturation=h,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(h){this._highlightsExposure=h,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(h){this._midtonesHue=h,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(h){this._midtonesDensity=h,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(h){this._midtonesSaturation=h,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(h){this._midtonesExposure=h,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(h){this._shadowsHue=h,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(h){this._shadowsDensity=h,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(h){this._shadowsSaturation=h,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(h){this._shadowsExposure=h,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";h._dirty&&(h._dirty=!1,h._getColorGradingDataToRef(h._globalHue,h._globalDensity,h._globalSaturation,h._globalExposure,h._globalCurve),h._getColorGradingDataToRef(h._highlightsHue,h._highlightsDensity,h._highlightsSaturation,h._highlightsExposure,h._tempColor),h._tempColor.multiplyToRef(h._globalCurve,h._highlightsCurve),h._getColorGradingDataToRef(h._midtonesHue,h._midtonesDensity,h._midtonesSaturation,h._midtonesExposure,h._tempColor),h._tempColor.multiplyToRef(h._globalCurve,h._midtonesCurve),h._getColorGradingDataToRef(h._shadowsHue,h._shadowsDensity,h._shadowsSaturation,h._shadowsExposure,h._tempColor),h._tempColor.multiplyToRef(h._globalCurve,h._shadowsCurve),h._highlightsCurve.subtractToRef(h._midtonesCurve,h._positiveCurve),h._midtonesCurve.subtractToRef(h._shadowsCurve,h._negativeCurve)),d&&(d.setFloat4(m,h._positiveCurve.r,h._positiveCurve.g,h._positiveCurve.b,h._positiveCurve.a),d.setFloat4(j,h._midtonesCurve.r,h._midtonesCurve.g,h._midtonesCurve.b,h._midtonesCurve.a),d.setFloat4(A,h._negativeCurve.r,h._negativeCurve.g,h._negativeCurve.b,h._negativeCurve.a))}_getColorGradingDataToRef(h,d,m,j,A){null!=h&&(h=S._Clamp(h,0,360),d=S._Clamp(d,-100,100),m=S._Clamp(m,-100,100),j=S._Clamp(j,-100,100),d=S._ApplyColorGradingSliderNonlinear(d),d*=.5,j=S._ApplyColorGradingSliderNonlinear(j),d<0&&(d*=-1,h=(h+180)%360),S._FromHSBToRef(h,d,50+.25*j,A),A.scaleToRef(2,A),A.a=1+.01*m)}static _ApplyColorGradingSliderNonlinear(h){h/=100;let d=Math.abs(h);return d=Math.pow(d,2),h<0&&(d*=-1),d*=100,d}static _FromHSBToRef(h,d,m,j){let A=S._Clamp(h,0,360);const b=S._Clamp(d/100,0,1),w=S._Clamp(m/100,0,1);if(0===b)j.r=w,j.g=w,j.b=w;else{A/=60;const h=Math.floor(A),d=A-h,m=w*(1-b),a=w*(1-b*d),D=w*(1-b*(1-d));switch(h){case 0:j.r=w,j.g=D,j.b=m;break;case 1:j.r=a,j.g=w,j.b=m;break;case 2:j.r=m,j.g=w,j.b=D;break;case 3:j.r=m,j.g=a,j.b=w;break;case 4:j.r=D,j.g=m,j.b=w;break;default:j.r=w,j.g=m,j.b=a}}j.a=1}static _Clamp(h,d,m){return Math.min(Math.max(h,d),m)}clone(){return a.d.Clone((()=>new S),this)}serialize(){return a.d.Serialize(this)}static Parse(h){return a.d.Parse((()=>new S),h,null,null)}}S.PrepareUniforms=D.d,(0,j.d)([(0,A.M)()],S.prototype,"_globalHue",void 0),(0,j.d)([(0,A.M)()],S.prototype,"_globalDensity",void 0),(0,j.d)([(0,A.M)()],S.prototype,"_globalSaturation",void 0),(0,j.d)([(0,A.M)()],S.prototype,"_globalExposure",void 0),(0,j.d)([(0,A.M)()],S.prototype,"_highlightsHue",void 0),(0,j.d)([(0,A.M)()],S.prototype,"_highlightsDensity",void 0),(0,j.d)([(0,A.M)()],S.prototype,"_highlightsSaturation",void 0),(0,j.d)([(0,A.M)()],S.prototype,"_highlightsExposure",void 0),(0,j.d)([(0,A.M)()],S.prototype,"_midtonesHue",void 0),(0,j.d)([(0,A.M)()],S.prototype,"_midtonesDensity",void 0),(0,j.d)([(0,A.M)()],S.prototype,"_midtonesSaturation",void 0),(0,j.d)([(0,A.M)()],S.prototype,"_midtonesExposure",void 0),a.d._ColorCurvesParser=S.Parse;var M=m(11248),q=m(11617),E=m(11080);class I{constructor(){this.colorCurves=new S,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=I.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new w.f(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=I.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.outputTextureWidth=0,this.outputTextureHeight=0,this.onUpdateParameters=new b.e}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(h){this._colorCurvesEnabled!==h&&(this._colorCurvesEnabled=h,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(h){this._colorGradingTexture!==h&&(this._colorGradingTexture=h,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(h){this._colorGradingEnabled!==h&&(this._colorGradingEnabled=h,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(h){this._colorGradingWithGreenDepth!==h&&(this._colorGradingWithGreenDepth=h,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(h){this._colorGradingBGR!==h&&(this._colorGradingBGR=h,this._updateParameters())}get exposure(){return this._exposure}set exposure(h){this._exposure!==h&&(this._exposure=h,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(h){this._toneMappingEnabled!==h&&(this._toneMappingEnabled=h,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(h){this._toneMappingType!==h&&(this._toneMappingType=h,this._updateParameters())}get contrast(){return this._contrast}set contrast(h){this._contrast!==h&&(this._contrast=h,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(h){this.vignetteCenterY=h}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(h){this.vignetteCenterX=h}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(h){this._vignetteBlendMode!==h&&(this._vignetteBlendMode=h,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(h){this._vignetteEnabled!==h&&(this._vignetteEnabled=h,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(h){this._ditheringEnabled!==h&&(this._ditheringEnabled=h,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(h){this._ditheringIntensity!==h&&(this._ditheringIntensity=h,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(h){this._skipFinalColorClamp!==h&&(this._skipFinalColorClamp=h,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(h){this._applyByPostProcess!==h&&(this._applyByPostProcess=h,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(h){this._isEnabled!==h&&(this._isEnabled=h,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(h){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return h.VIGNETTE=!1,h.TONEMAPPING=0,h.CONTRAST=!1,h.EXPOSURE=!1,h.COLORCURVES=!1,h.COLORGRADING=!1,h.COLORGRADING3D=!1,h.DITHER=!1,h.IMAGEPROCESSING=!1,h.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(h.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(h.VIGNETTE=this.vignetteEnabled,h.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===I._VIGNETTEMODE_MULTIPLY,h.VIGNETTEBLENDMODEOPAQUE=!h.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case I.TONEMAPPING_KHR_PBR_NEUTRAL:h.TONEMAPPING=3;break;case I.TONEMAPPING_ACES:h.TONEMAPPING=2;break;default:h.TONEMAPPING=1}else h.TONEMAPPING=0;h.CONTRAST=1!==this.contrast,h.EXPOSURE=1!==this.exposure,h.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,h.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,h.COLORGRADING?h.COLORGRADING3D=this.colorGradingTexture.is3D:h.COLORGRADING3D=!1,h.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,h.SAMPLER3DBGRMAP=this.colorGradingBGR,h.DITHER=this._ditheringEnabled,h.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,h.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,h.IMAGEPROCESSING=h.VIGNETTE||!!h.TONEMAPPING||h.CONTRAST||h.EXPOSURE||h.COLORCURVES||h.COLORGRADING||h.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(h,d){if(this._colorCurvesEnabled&&this.colorCurves&&S.Bind(this.colorCurves,h),this._vignetteEnabled||this._ditheringEnabled){const m=1/(this.outputTextureWidth||h.getEngine().getRenderWidth()),j=1/(this.outputTextureHeight||h.getEngine().getRenderHeight());if(h.setFloat2("vInverseScreenSize",m,j),this._ditheringEnabled&&h.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const A=null!=d?d:j/m;let b=Math.tan(.5*this.vignetteCameraFov),w=b*A;const a=Math.sqrt(w*b);w=(0,M.k)(w,a,this.vignetteStretch),b=(0,M.k)(b,a,this.vignetteStretch),h.setFloat4("vignetteSettings1",w,b,-w*this.vignetteCenterX,-b*this.vignetteCenterY);const D=-2*this.vignetteWeight;h.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,D)}}if(h.setFloat("exposureLinear",this.exposure),h.setFloat("contrast",this.contrast),this.colorGradingTexture){h.setTexture("txColorTransform",this.colorGradingTexture);const d=this.colorGradingTexture.getSize().height;h.setFloat4("colorTransformSettings",(d-1)/d,.5/d,d,this.colorGradingTexture.level)}}clone(){return a.d.Clone((()=>new I),this)}serialize(){return a.d.Serialize(this)}static Parse(h){const d=a.d.Parse((()=>new I),h,null,null);return void 0!==h.vignetteCentreX&&(d.vignetteCenterX=h.vignetteCentreX),void 0!==h.vignetteCentreY&&(d.vignetteCenterY=h.vignetteCentreY),d}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}I.TONEMAPPING_STANDARD=0,I.TONEMAPPING_ACES=1,I.TONEMAPPING_KHR_PBR_NEUTRAL=2,I.PrepareUniforms=q.e,I.PrepareSamplers=q.b,I._VIGNETTEMODE_MULTIPLY=0,I._VIGNETTEMODE_OPAQUE=1,(0,j.d)([(0,A.i)()],I.prototype,"colorCurves",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_colorCurvesEnabled",void 0),(0,j.d)([(0,A.D)("colorGradingTexture")],I.prototype,"_colorGradingTexture",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_colorGradingEnabled",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_colorGradingWithGreenDepth",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_colorGradingBGR",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_exposure",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_toneMappingEnabled",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_toneMappingType",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_contrast",void 0),(0,j.d)([(0,A.M)()],I.prototype,"vignetteStretch",void 0),(0,j.d)([(0,A.M)()],I.prototype,"vignetteCenterX",void 0),(0,j.d)([(0,A.M)()],I.prototype,"vignetteCenterY",void 0),(0,j.d)([(0,A.M)()],I.prototype,"vignetteWeight",void 0),(0,j.d)([(0,A.n)()],I.prototype,"vignetteColor",void 0),(0,j.d)([(0,A.M)()],I.prototype,"vignetteCameraFov",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_vignetteBlendMode",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_vignetteEnabled",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_ditheringEnabled",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_ditheringIntensity",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_skipFinalColorClamp",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_applyByPostProcess",void 0),(0,j.d)([(0,A.M)()],I.prototype,"_isEnabled",void 0),(0,j.d)([(0,A.M)()],I.prototype,"outputTextureWidth",void 0),(0,j.d)([(0,A.M)()],I.prototype,"outputTextureHeight",void 0),a.d._ImageProcessingConfigurationParser=I.Parse,(0,E.i)("BABYLON.ImageProcessingConfiguration",I)},11693:(h,d,m)=>{m.d(d,{b:()=>q});var j=m(11258),A=m(11251),b=m(11261),w=m(11670),a=m(11647),D=m(11651),S=m(11357);class M extends a.e{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class q extends D.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(h,"DetailMap",140,new M,d),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=A.d.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=h._dirtyCallbacks[1]}isReadyForSubMesh(h,d,m){return!this._isEnabled||!(h._areTexturesDirty&&d.texturesEnabled&&m.getCaps().standardDerivatives&&this._texture&&w.e.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(h,d){if(this._isEnabled){h.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const m=d.getEngine();h._areTexturesDirty&&(m.getCaps().standardDerivatives&&this._texture&&w.e.DetailTextureEnabled&&this._isEnabled?((0,S.T)(this._texture,h,"DETAIL"),h.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):h.DETAIL=!1)}else h.DETAIL=!1}bindForSubMesh(h,d){if(!this._isEnabled)return;const m=this._material.isFrozen;h.useUbo&&m&&h.isSync||this._texture&&w.e.DetailTextureEnabled&&(h.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,S.t)(this._texture,h,"detail")),d.texturesEnabled&&this._texture&&w.e.DetailTextureEnabled&&h.setTexture("detailSampler",this._texture)}hasTexture(h){return this._texture===h}getActiveTextures(h){this._texture&&h.push(this._texture)}getAnimatables(h){this._texture&&this._texture.animations&&this._texture.animations.length>0&&h.push(this._texture)}dispose(h){var d;h&&(null===(d=this._texture)||void 0===d||d.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(h){h.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,j.d)([(0,b.D)("detailTexture"),(0,b.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"texture",void 0),(0,j.d)([(0,b.M)()],q.prototype,"diffuseBlendLevel",void 0),(0,j.d)([(0,b.M)()],q.prototype,"roughnessBlendLevel",void 0),(0,j.d)([(0,b.M)()],q.prototype,"bumpLevel",void 0),(0,j.d)([(0,b.M)(),(0,b.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"normalBlendMethod",void 0),(0,j.d)([(0,b.M)(),(0,b.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"isEnabled",void 0)},11251:(h,d,m)=>{m.d(d,{d:()=>L});var j=m(11258),A=m(11261),b=m(11107),w=m(11097),a=m(11094),D=m(11276),S=m(11335),M=m(11121),q=m(11337),E=m(11329),I=m(11341);class R{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(h){this._func=h}get funcRef(){return this._funcRef}set funcRef(h){this._funcRef=h}get funcMask(){return this._funcMask}set funcMask(h){this._funcMask=h}get opStencilFail(){return this._opStencilFail}set opStencilFail(h){this._opStencilFail=h}get opDepthFail(){return this._opDepthFail}set opDepthFail(h){this._opDepthFail=h}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(h){this._opStencilDepthPass=h}get mask(){return this._mask}set mask(h){this._mask=h}get enabled(){return this._enabled}set enabled(h){this._enabled=h}getClassName(){return"MaterialStencilState"}copyTo(h){I.d.Clone((()=>h),this)}serialize(){return I.d.Serialize(this)}parse(h,d,m){I.d.Parse((()=>this),h,d,m)}}(0,j.d)([(0,A.M)()],R.prototype,"func",null),(0,j.d)([(0,A.M)()],R.prototype,"funcRef",null),(0,j.d)([(0,A.M)()],R.prototype,"funcMask",null),(0,j.d)([(0,A.M)()],R.prototype,"opStencilFail",null),(0,j.d)([(0,A.M)()],R.prototype,"opDepthFail",null),(0,j.d)([(0,A.M)()],R.prototype,"opStencilDepthPass",null),(0,j.d)([(0,A.M)()],R.prototype,"mask",null),(0,j.d)([(0,A.M)()],R.prototype,"enabled",null);var Z=m(11357);class L{get _supportGlowLayer(){return!1}set _glowModeEnabled(h){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(h){if(this._alpha===h)return;const d=this._alpha;this._alpha=h,1!==d&&1!==h||this.PS(L.MiscDirtyFlag+L.PrePassDirtyFlag)}get alpha(){return this._alpha}set yd(h){this._backFaceCulling!==h&&(this._backFaceCulling=h,this.PS(L.TextureDirtyFlag))}get yd(){return this._backFaceCulling}set cullBackFaces(h){this._cullBackFaces!==h&&(this._cullBackFaces=h,this.PS(L.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(h){this._blockDirtyMechanism!==h&&(this._blockDirtyMechanism=h,h||this.zq())}atomicMaterialsUpdate(h){this.blockDirtyMechanism=!0;try{h(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(h){this._onDisposeObserver&&this.pd.remove(this._onDisposeObserver),this._onDisposeObserver=this.pd.add(h)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new w.e),this._onBindObservable}set onBind(h){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(h)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new w.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new w.e),this._onEffectCreatedObservable}set alphaMode(h){this._alphaMode!==h&&(this._alphaMode=h,this.PS(L.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(h){this._needDepthPrePass!==h&&(this._needDepthPrePass=h,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(h){this._fogEnabled!==h&&(this._fogEnabled=h,this.PS(L.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case L.WireFrameFillMode:case L.LineListDrawMode:case L.LineLoopDrawMode:case L.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(h){this.fillMode=h?L.WireFrameFillMode:L.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case L.PointFillMode:case L.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(h){this.fillMode=h?L.PointFillMode:L.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(h){this._fillMode!==h&&(this._fillMode=h,this.PS(L.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(h){const d=this.ih().getEngine().getCaps().fragmentDepthSupported;h&&!d&&M.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=h&&d,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(h){this._drawWrapper=h}constructor(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.pd=new w.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new R,this._useUBO=!1,this._fillMode=L.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=h;const A=d||a.b.LastCreatedScene;A&&(this._scene=A,this._dirtyCallbacks={},this._forceGLSL=j,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=h||b.e.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new E.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new S.d(this._scene.getEngine(),void 0,void 0,h),this._useUBO=this.ih().getEngine().supportsUniformBuffers,this._createUniformBuffer(),m||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),L.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var h;const d=this.ih().getEngine();null===(h=this._uniformBuffer)||void 0===h||h.dispose(),d.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new S.d(d,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new S.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(h){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.zq(),this.checkReadyOnlyOnce=!0}unfreeze(){this.zq(),this.checkReadyOnlyOnce=!1}isReady(h,d){return!0}isReadyForSubMesh(h,d,m){const j=d.materialDefines;return!!j&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=j,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}ih(){return this._scene}_getEffectiveOrientation(h){return null!==this.sideOrientation?this.sideOrientation:h.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(h){this._transparencyMode!==h&&(this._transparencyMode=h,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===L.MATERIAL_ALPHABLEND||this._transparencyMode===L.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===L.MATERIAL_ALPHATEST||this._transparencyMode===L.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===L.MATERIAL_OPAQUE||this._transparencyMode===L.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(h){return this._hasTransparencyMode?this._transparencyModeIsBlend:h.visibility<1||!this._disableAlphaBlending&&(h.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(h){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(h)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}zq(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=this.ih().meshes;for(const m of d)if(m.Ab)for(const d of m.Ab)if(d.Qh()===this)for(const m of d._drawWrappers)m&&this._materialContext===m.materialContext&&(m._wasPreviouslyReady=!1,m._wasPreviouslyUsingInstances=null,m._forceRebindOnNextCall=h);h&&this.PS(L.AllDirtyFlag)}_preBind(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=this._scene.getEngine(),j=(null==d?this.sideOrientation:d)===L.ClockWiseSideOrientation;return m.enableEffect(h||this._getDrawWrapper()),m.setState(this.yd,this.zOffset,!1,j,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),j}bind(h,d){}buildUniformLayout(){const h=this._uniformBuffer;this._eventInfo.ubo=h,this._callbackPluginEventGeneric(8,this._eventInfo),h.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(h,d,m){const j=m._drawWrapper;this._eventInfo.subMesh=m,this._callbackPluginEventBindForSubMesh(this._eventInfo),j._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(h){}bindView(h){this._useUBO?this._needToBindSceneUbo=!0:h.setMatrix("view",this.ih().getViewMatrix())}bindViewProjection(h){this._useUBO?this._needToBindSceneUbo=!0:(h.setMatrix("viewProjection",this.ih().getTransformMatrix()),h.setMatrix("projection",this.ih().getProjectionMatrix()))}bindEyePosition(h,d){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(h,d)}_afterBind(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&d&&(this._needToBindSceneUbo=!1,(0,Z.s)(d,this.ih().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=h?h.visibility:1,this._onBindObservable&&h&&this._onBindObservable.notifyObservers(h),this.disableDepthWrite){const h=this._scene.getEngine();this._cachedDepthWriteState=h.getDepthWrite(),h.setDepthWrite(!1)}if(this.disableColorWrite){const h=this._scene.getEngine();this._cachedColorWriteState=h.getColorWrite(),h.setColorWrite(!1)}if(0!==this.depthFunction){const h=this._scene.getEngine();this._cachedDepthFunctionState=h.getDepthFunction()||0,h.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(h){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=h,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(h){return null}_clonePlugins(h,d){const m={};if(this._serializePlugins(m),L._ParsePlugins(m,h,this._scene,d),this.pluginManager)for(const j of this.pluginManager._plugins){const d=h.pluginManager.getPlugin(j.name);d&&j.copyTo(d)}}getBindedMeshes(){if(this.meshMap){const h=[];for(const d in this.meshMap){const m=this.meshMap[d];m&&h.push(m)}return h}return this._scene.meshes.filter((h=>h.material===this))}forceCompilation(h,d,m,j){const A={clipPlane:!1,useInstances:!1,...m},b=this.ih(),w=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const a=()=>{if(!this._scene||!this._scene.getEngine())return;const m=b.clipPlane;if(A.clipPlane&&(b.clipPlane=new q.e(0,0,0,1)),this._storeEffectOnSubMeshes){let m=!0,b=null;if(h.Ab){const d=new D.b(0,0,0,0,0,h,void 0,!1,!1);d.materialDefines&&(d.materialDefines._renderId=-1),this.isReadyForSubMesh(h,d,A.useInstances)||(d.effect&&d.effect.getCompilationError()&&d.effect.allFallbacksProcessed()?b=d.effect.getCompilationError():(m=!1,setTimeout(a,16)))}m&&(this.allowShaderHotSwapping=w,b&&j&&j(b),d&&d(this))}else this.isReady()?(this.allowShaderHotSwapping=w,d&&d(this)):setTimeout(a,16);A.clipPlane&&(b.clipPlane=m)};a()}async forceCompilationAsync(h,d){return await new Promise(((m,j)=>{this.forceCompilation(h,(()=>{m()}),d,(h=>{j(h)}))}))}PS(h){this.ih().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(L._DirtyCallbackArray.length=0,h&L.ImageProcessingDirtyFlag&&L._DirtyCallbackArray.push(L._ImageProcessingDirtyCallBack),h&L.TextureDirtyFlag&&L._DirtyCallbackArray.push(L._TextureDirtyCallBack),h&L.LightDirtyFlag&&L._DirtyCallbackArray.push(L._LightsDirtyCallBack),h&L.FresnelDirtyFlag&&L._DirtyCallbackArray.push(L._FresnelDirtyCallBack),h&L.AttributesDirtyFlag&&L._DirtyCallbackArray.push(L._AttributeDirtyCallBack),h&L.MiscDirtyFlag&&L._DirtyCallbackArray.push(L._MiscDirtyCallBack),h&L.PrePassDirtyFlag&&L._DirtyCallbackArray.push(L._PrePassDirtyCallBack),L._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(L._RunDirtyCallBacks),this.ih().resetCachedMaterial())}resetDrawCache(){const h=this.ih().meshes;for(const d of h)if(d.Ab)for(const h of d.Ab)h.Qh()===this&&h.resetDrawCache()}_markAllSubMeshesAsDirty(h){const d=this.ih();if(d.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const m=d.meshes;for(const j of m)if(j.Ab)for(const m of j.Ab){if((m.Qh()||(d._hasDefaultMaterial?d.defaultMaterial:null))===this)for(const d of m._drawWrappers)d&&d.defines&&d.defines.markAllAsDirty&&this._materialContext===d.materialContext&&h(d.defines)}}_markScenePrePassDirty(){if(this.ih().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const h=this.ih().enablePrePassRenderer();h&&h.PS()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(L._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(L._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(L._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(L._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(L._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(L._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(L._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(L._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(L._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(L._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const h=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.pd.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(h)}))}}setPrePassRenderer(h){return!1}dispose(h,d,m){const j=this.ih();if(j.stopAnimation(this),j.freeProcessedMaterials(),j.removeMaterial(this),this._eventInfo.forceDisposeTextures=d,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const h=this._parentContainer.materials.indexOf(this);h>-1&&this._parentContainer.materials.splice(h,1),this._parentContainer=null}if(!0!==m)if(this.meshMap)for(const A in this.meshMap){const h=this.meshMap[A];this._disposeMeshResources(h)}else{const h=j.meshes;for(const d of h)this._disposeMeshResources(d)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.pd.notifyObservers(this),this.pd.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(h){if(!h)return;const d=h.Ld,m=h._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(h.Ab&&m)for(const A of h.Ab){const h=A._drawWrappers;for(let b=0;b<h.length;b++){var j;const w=null===(j=h[b])||void 0===j?void 0:j.effect;if(!w)continue;m[b]===this&&(null===d||void 0===d||d._releaseVertexArrayObject(w),A._removeDrawWrapper(b,!0,!0))}}}else null===d||void 0===d||d._releaseVertexArrayObject(this._drawWrapper.effect);h.material!==this||h.sourceMesh||(h.material=null)}serialize(){const h=I.d.Serialize(this);return h.stencil=this.stencil.serialize(),h.uniqueId=this.uniqueId,this._serializePlugins(h),h}_serializePlugins(h){if(h.plugins={},this.pluginManager)for(const d of this.pluginManager._plugins)d.doNotSerialize||(h.plugins[d.getClassName()]=d.serialize())}static Parse(h,d,m){if(h.customType){if("BABYLON.PBRMaterial"===h.customType&&h.overloadedAlbedo&&(h.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return M.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else h.customType="BABYLON.StandardMaterial";const j=b.e.Instantiate(h.customType).Parse(h,d,m);return j._loadedUniqueId=h.uniqueId,j}static _ParsePlugins(h,d,m,j){if(h.plugins)for(const a in h.plugins){var A,w;const D=h.plugins[a];let S=null===(A=d.pluginManager)||void 0===A?void 0:A.getPlugin(D.name);if(!S){const h=b.e.Instantiate("BABYLON."+a);h&&(S=new h(d))}null===(w=S)||void 0===w||w.parse(D,m,j)}}}L.TriangleFillMode=0,L.WireFrameFillMode=1,L.PointFillMode=2,L.PointListDrawMode=3,L.LineListDrawMode=4,L.LineLoopDrawMode=5,L.LineStripDrawMode=6,L.TriangleStripDrawMode=7,L.TriangleFanDrawMode=8,L.ClockWiseSideOrientation=0,L.CounterClockWiseSideOrientation=1,L.ImageProcessingDirtyFlag=64,L.TextureDirtyFlag=1,L.LightDirtyFlag=2,L.FresnelDirtyFlag=4,L.AttributesDirtyFlag=8,L.MiscDirtyFlag=16,L.PrePassDirtyFlag=32,L.AllDirtyFlag=127,L.MATERIAL_OPAQUE=0,L.MATERIAL_ALPHATEST=1,L.MATERIAL_ALPHABLEND=2,L.MATERIAL_ALPHATESTANDBLEND=3,L.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,L.MATERIAL_NORMALBLENDMETHOD_RNM=1,L.OnEventObservable=new w.e,L._AllDirtyCallBack=h=>h.markAllAsDirty(),L._ImageProcessingDirtyCallBack=h=>h.markAsImageProcessingDirty(),L._TextureDirtyCallBack=h=>h.markAsTexturesDirty(),L._FresnelDirtyCallBack=h=>h.markAsFresnelDirty(),L._MiscDirtyCallBack=h=>h.markAsMiscDirty(),L._PrePassDirtyCallBack=h=>h.markAsPrePassDirty(),L._LightsDirtyCallBack=h=>h.markAsLightDirty(),L._AttributeDirtyCallBack=h=>h.markAsAttributesDirty(),L._FresnelAndMiscDirtyCallBack=h=>{L._FresnelDirtyCallBack(h),L._MiscDirtyCallBack(h)},L._TextureAndMiscDirtyCallBack=h=>{L._TextureDirtyCallBack(h),L._MiscDirtyCallBack(h)},L._DirtyCallbackArray=[],L._RunDirtyCallBacks=h=>{for(const d of L._DirtyCallbackArray)d(h)},(0,j.d)([(0,A.M)()],L.prototype,"id",void 0),(0,j.d)([(0,A.M)()],L.prototype,"uniqueId",void 0),(0,j.d)([(0,A.M)()],L.prototype,"name",void 0),(0,j.d)([(0,A.M)()],L.prototype,"metadata",void 0),(0,j.d)([(0,A.M)()],L.prototype,"checkReadyOnEveryCall",void 0),(0,j.d)([(0,A.M)()],L.prototype,"checkReadyOnlyOnce",void 0),(0,j.d)([(0,A.M)()],L.prototype,"state",void 0),(0,j.d)([(0,A.M)("alpha")],L.prototype,"_alpha",void 0),(0,j.d)([(0,A.M)("yd")],L.prototype,"_backFaceCulling",void 0),(0,j.d)([(0,A.M)("cullBackFaces")],L.prototype,"_cullBackFaces",void 0),(0,j.d)([(0,A.M)()],L.prototype,"sideOrientation",void 0),(0,j.d)([(0,A.M)("alphaMode")],L.prototype,"_alphaMode",void 0),(0,j.d)([(0,A.M)()],L.prototype,"_needDepthPrePass",void 0),(0,j.d)([(0,A.M)()],L.prototype,"disableDepthWrite",void 0),(0,j.d)([(0,A.M)()],L.prototype,"disableColorWrite",void 0),(0,j.d)([(0,A.M)()],L.prototype,"forceDepthWrite",void 0),(0,j.d)([(0,A.M)()],L.prototype,"depthFunction",void 0),(0,j.d)([(0,A.M)()],L.prototype,"separateCullingPass",void 0),(0,j.d)([(0,A.M)("fogEnabled")],L.prototype,"_fogEnabled",void 0),(0,j.d)([(0,A.M)()],L.prototype,"pointSize",void 0),(0,j.d)([(0,A.M)()],L.prototype,"zOffset",void 0),(0,j.d)([(0,A.M)()],L.prototype,"zOffsetUnits",void 0),(0,j.d)([(0,A.M)()],L.prototype,"pointsCloud",null),(0,j.d)([(0,A.M)()],L.prototype,"fillMode",null),(0,j.d)([(0,A.M)()],L.prototype,"useLogarithmicDepth",null),(0,j.d)([(0,A.M)()],L.prototype,"transparencyMode",null)},11647:(h,d,m)=>{m.d(d,{e:()=>j});class j{constructor(h){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=h,h)for(const d in h)Object.prototype.hasOwnProperty.call(h,d)&&this._setDefaultValue(d)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||h,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const h of Object.keys(this))"_"!==h[0]&&this._keys.push(h);if(this._externalProperties)for(const h in this._externalProperties)-1===this._keys.indexOf(h)&&this._keys.push(h)}isEqual(h){if(this._keys.length!==h._keys.length)return!1;for(let d=0;d<this._keys.length;d++){const m=this._keys[d];if(this[m]!==h[m])return!1}return!0}cloneTo(h){this._keys.length!==h._keys.length&&(h._keys=this._keys.slice(0));for(let d=0;d<this._keys.length;d++){const m=this._keys[d];h[m]=this[m]}}reset(){for(const h of this._keys)this._setDefaultValue(h)}_setDefaultValue(h){var d,m,j,A;const b=(null===(d=this._externalProperties)||void 0===d||null===(m=d[h])||void 0===m?void 0:m.type)??typeof this[h],w=null===(j=this._externalProperties)||void 0===j||null===(A=j[h])||void 0===A?void 0:A.default;switch(b){case"number":this[h]=w??0;break;case"string":this[h]=w??"";break;default:this[h]=w??!1}}toString(){let h="";for(let d=0;d<this._keys.length;d++){const m=this._keys[d],j=this[m];switch(typeof j){case"number":case"string":h+="#define "+m+" "+j+"\n";break;default:j&&(h+="#define "+m+"\n")}}return h}}},11670:(h,d,m)=>{m.d(d,{e:()=>A});var j=m(11188);class A{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(h){this._DiffuseTextureEnabled!==h&&(this._DiffuseTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(h){this._BaseWeightTextureEnabled!==h&&(this._BaseWeightTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(h){this._BaseDiffuseRoughnessTextureEnabled!==h&&(this._BaseDiffuseRoughnessTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(h){this._DetailTextureEnabled!==h&&(this._DetailTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(h){this._DecalMapEnabled!==h&&(this._DecalMapEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(h){this._AmbientTextureEnabled!==h&&(this._AmbientTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(h){this._OpacityTextureEnabled!==h&&(this._OpacityTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(h){this._ReflectionTextureEnabled!==h&&(this._ReflectionTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(h){this._EmissiveTextureEnabled!==h&&(this._EmissiveTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(h){this._SpecularTextureEnabled!==h&&(this._SpecularTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(h){this._BumpTextureEnabled!==h&&(this._BumpTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(h){this._LightmapTextureEnabled!==h&&(this._LightmapTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(h){this._RefractionTextureEnabled!==h&&(this._RefractionTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(h){this._ColorGradingTextureEnabled!==h&&(this._ColorGradingTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(h){this._FresnelEnabled!==h&&(this._FresnelEnabled=h,j.b.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(h){this._ClearCoatTextureEnabled!==h&&(this._ClearCoatTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(h){this._ClearCoatBumpTextureEnabled!==h&&(this._ClearCoatBumpTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(h){this._ClearCoatTintTextureEnabled!==h&&(this._ClearCoatTintTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(h){this._SheenTextureEnabled!==h&&(this._SheenTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(h){this._AnisotropicTextureEnabled!==h&&(this._AnisotropicTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(h){this._ThicknessTextureEnabled!==h&&(this._ThicknessTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(h){this._RefractionIntensityTextureEnabled!==h&&(this._RefractionIntensityTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(h){this._TranslucencyIntensityTextureEnabled!==h&&(this._TranslucencyIntensityTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(h){this._TranslucencyColorTextureEnabled!==h&&(this._TranslucencyColorTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(h){this._IridescenceTextureEnabled!==h&&(this._IridescenceTextureEnabled=h,j.b.MarkAllMaterialsAsDirty(1))}}A._DiffuseTextureEnabled=!0,A._BaseWeightTextureEnabled=!0,A._BaseDiffuseRoughnessTextureEnabled=!0,A._DetailTextureEnabled=!0,A._DecalMapEnabled=!0,A._AmbientTextureEnabled=!0,A._OpacityTextureEnabled=!0,A._ReflectionTextureEnabled=!0,A._EmissiveTextureEnabled=!0,A._SpecularTextureEnabled=!0,A._BumpTextureEnabled=!0,A._LightmapTextureEnabled=!0,A._RefractionTextureEnabled=!0,A._ColorGradingTextureEnabled=!0,A._FresnelEnabled=!0,A._ClearCoatTextureEnabled=!0,A._ClearCoatBumpTextureEnabled=!0,A._ClearCoatTintTextureEnabled=!0,A._SheenTextureEnabled=!0,A._AnisotropicTextureEnabled=!0,A._ThicknessTextureEnabled=!0,A._RefractionIntensityTextureEnabled=!0,A._TranslucencyIntensityTextureEnabled=!0,A._TranslucencyColorTextureEnabled=!0,A._IridescenceTextureEnabled=!0},11357:(h,d,m)=>{m.d(d,{$:()=>l,A:()=>i,D:()=>I,F:()=>E,I:()=>k,M:()=>c,Q:()=>f,T:()=>B,X:()=>F,ab:()=>K,c:()=>C,cb:()=>N,db:()=>r,fb:()=>R,g:()=>q,j:()=>o,l:()=>M,o:()=>Z,s:()=>L,t:()=>V,v:()=>g,y:()=>v,z:()=>y});var j=m(11121),A=m(11353),b=m(11094),w=m(11359),a=m(11363);const D=A.d.Black(),S={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function M(h,d,m){if(!h||h.LOGARITHMICDEPTH||h.indexOf&&h.indexOf("LOGARITHMICDEPTH")>=0){const h=m.activeCamera;1===h.mode&&j.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),d.setFloat("logarithmicDepthConstant",2/(Math.log(h.maxZ+1)/Math.LN2))}}function q(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];m&&h.fogEnabled&&(!d||d.applyFog)&&0!==h.fogMode&&(m.setFloat4("vFogInfos",h.fogMode,h.fogStart,h.fogEnd,h.fogDensity),j?(h.fogColor.toLinearSpaceToRef(D,h.getEngine().useExactSrgbConversions),m.setColor3("vFogColor",D)):m.setColor3("vFogColor",h.fogColor))}function E(h,d,m,j,A,b,w,a,D,M){const q=h.numMaxInfluencers||h.numInfluencers;return q<=0?0:(d.push("#define MORPHTARGETS"),h.hasPositions&&d.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),h.hasNormals&&d.push("#define MORPHTARGETTEXTURE_HASNORMALS"),h.hasTangents&&d.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),h.hasUVs&&d.push("#define MORPHTARGETTEXTURE_HASUVS"),h.hasUV2s&&d.push("#define MORPHTARGETTEXTURE_HASUV2S"),h.hasColors&&d.push("#define MORPHTARGETTEXTURE_HASCOLORS"),h.supportsPositions&&A&&d.push("#define MORPHTARGETS_POSITION"),h.supportsNormals&&b&&d.push("#define MORPHTARGETS_NORMAL"),h.supportsTangents&&w&&d.push("#define MORPHTARGETS_TANGENT"),h.supportsUVs&&a&&d.push("#define MORPHTARGETS_UV"),h.supportsUV2s&&D&&d.push("#define MORPHTARGETS_UV2"),h.supportsColors&&M&&d.push("#define MORPHTARGETS_COLOR"),d.push("#define NUM_MORPH_INFLUENCERS "+q),h.isUsingTextureForTargets&&d.push("#define MORPHTARGETS_TEXTURE"),S.NUM_MORPH_INFLUENCERS=q,S.NORMAL=b,S.TANGENT=w,S.UV=a,S.UV2=D,S.COLOR=M,I(m,j,S,A),q)}function I(h,d,m){let A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const w=m.NUM_MORPH_INFLUENCERS;if(w>0&&b.b.LastCreatedEngine){const a=b.b.LastCreatedEngine.getCaps().maxVertexAttribs,D=d.morphTargetManager;if(null!==D&&void 0!==D&&D.isUsingTextureForTargets)return;const S=D&&D.supportsPositions&&A,M=D&&D.supportsNormals&&m.NORMAL,q=D&&D.supportsTangents&&m.TANGENT,E=D&&D.supportsUVs&&m.UV1,I=D&&D.supportsUV2s&&m.UV2,R=D&&D.supportsColors&&m.VERTEXCOLOR;for(let m=0;m<w;m++)S&&h.push("position"+m),M&&h.push("normal"+m),q&&h.push("tangent"+m),E&&h.push("uv_"+m),I&&h.push("uv2_"+m),R&&h.push("color"+m),h.length>a&&j.c.Error("Cannot add more vertex attributes for mesh "+d.name)}}function R(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h.push("world0"),h.push("world1"),h.push("world2"),h.push("world3"),d&&(h.push("previousWorld0"),h.push("previousWorld1"),h.push("previousWorld2"),h.push("previousWorld3"))}function Z(h,d){const m=h.morphTargetManager;h&&m&&d.setFloatArray("morphTargetInfluences",m.influences)}function L(h,d){d.bindToEffect(h,"Scene")}function B(h,d,m){d._needUVs=!0,d[m]=!0,h.optimizeUVAllocation&&h.getTextureMatrix().isIdentityAs3x2()?(d[m+"DIRECTUV"]=h.coordinatesIndex+1,d["MAINUV"+(h.coordinatesIndex+1)]=!0):d[m+"DIRECTUV"]=0}function V(h,d,m){const j=h.getTextureMatrix();d.hb(m+"Matrix",j)}function v(h,d,m){m.BAKED_VERTEX_ANIMATION_TEXTURE&&m.INSTANCES&&h.push("bakedVertexAnimationSettingsInstanced")}function C(h,d,m){var j;if(d&&h&&(h.computeBonesUsingShaders&&d._bonesComputationForcedToCPU&&(h.computeBonesUsingShaders=!1),h.useBones&&h.computeBonesUsingShaders&&h.skeleton)){const A=h.skeleton;if(A.isUsingTextureForMatrices&&d.getUniformIndex("boneTextureWidth")>-1){const m=A.getTransformMatrixTexture(h);d.setTexture("boneSampler",m),d.setFloat("boneTextureWidth",4*(A.bones.length+1))}else{const b=A.getTransformMatrices(h);b&&(d.setMatrices("mBones",b),m&&h.ih().prePassRenderer&&h.ih().prePassRenderer.getIndex(2)&&(m.previousBones[h.uniqueId]||(m.previousBones[h.uniqueId]=b.slice()),d.setMatrices("mPreviousBones",m.previousBones[h.uniqueId]),j=b,m.previousBones[h.uniqueId].set(j)))}}}function T(h,d,m,j,A){let b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];h._bindLight(d,m,j,A,b)}function o(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const b=Math.min(d.lightSources.length,A);for(let w=0;w<b;w++){T(d.lightSources[w],w,h,m,"boolean"===typeof j?j:j.SPECULARTERM,d.receiveShadows)}}function y(h,d,m,j){m.NUM_BONE_INFLUENCERS>0&&(j.addCPUSkinningFallback(0,d),h.push("matricesIndices"),h.push("matricesWeights"),m.NUM_BONE_INFLUENCERS>4&&(h.push("matricesIndicesExtra"),h.push("matricesWeightsExtra")))}function i(h,d){(d.INSTANCES||d.THIN_INSTANCES)&&R(h,!!d.PREPASS_VELOCITY),d.INSTANCESCOLOR&&h.push("instanceColor")}function g(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=0;for(let b=0;b<m&&h["LIGHT"+b];b++)b>0&&(A=j+b,d.addFallback(A,"LIGHT"+b)),h.SHADOWS||(h["SHADOW"+b]&&d.addFallback(j,"SHADOW"+b),h["SHADOWPCF"+b]&&d.addFallback(j,"SHADOWPCF"+b),h["SHADOWPCSS"+b]&&d.addFallback(j,"SHADOWPCSS"+b),h["SHADOWPOISSON"+b]&&d.addFallback(j,"SHADOWPOISSON"+b),h["SHADOWESM"+b]&&d.addFallback(j,"SHADOWESM"+b),h["SHADOWCLOSEESM"+b]&&d.addFallback(j,"SHADOWCLOSEESM"+b));return A++}function F(h,d,m,j,A,b,w){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];w._areMiscDirty&&(w.LOGARITHMICDEPTH=m,w.POINTSIZE=j,w.FOG=A&&function(h,d){return d.fogEnabled&&h.applyFog&&0!==d.fogMode}(h,d),w.NONUNIFORMSCALING=h.nonUniformScaling,w.ALPHATEST=b,w.DECAL_AFTER_DETAIL=a)}function f(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!m._areLightsDirty)return m._needNormals;let w=0;const a={needNormals:m._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(h.lightsEnabled&&!b)for(const S of d.lightSources)if(H(h,d,S,w,m,j,a),w++,w===A)break;m.SPECULARTERM=a.specularEnabled,m.SHADOWS=a.shadowEnabled;for(let S=w;S<A;S++)void 0!==m["LIGHT"+S]&&(m["LIGHT"+S]=!1,m["HEMILIGHT"+S]=!1,m["POINTLIGHT"+S]=!1,m["DIRLIGHT"+S]=!1,m["SPOTLIGHT"+S]=!1,m["AREALIGHT"+S]=!1,m["SHADOW"+S]=!1,m["SHADOWCSM"+S]=!1,m["SHADOWCSMDEBUG"+S]=!1,m["SHADOWCSMNUM_CASCADES"+S]=!1,m["SHADOWCSMUSESHADOWMAXZ"+S]=!1,m["SHADOWCSMNOBLEND"+S]=!1,m["SHADOWCSM_RIGHTHANDED"+S]=!1,m["SHADOWPCF"+S]=!1,m["SHADOWPCSS"+S]=!1,m["SHADOWPOISSON"+S]=!1,m["SHADOWESM"+S]=!1,m["SHADOWCLOSEESM"+S]=!1,m["SHADOWCUBE"+S]=!1,m["SHADOWLOWQUALITY"+S]=!1,m["SHADOWMEDIUMQUALITY"+S]=!1);const D=h.getEngine().getCaps();return void 0===m.SHADOWFLOAT&&(a.needRebuild=!0),m.SHADOWFLOAT=a.shadowEnabled&&(D.textureFloatRender&&D.textureFloatLinearFiltering||D.textureHalfFloatRender&&D.textureHalfFloatLinearFiltering),m.LIGHTMAPEXCLUDED=a.lightmapMode,a.needRebuild&&m.rebuild(),a.needNormals}function H(h,d,m,j,A,b,a){switch(a.needNormals=!0,void 0===A["LIGHT"+j]&&(a.needRebuild=!0),A["LIGHT"+j]=!0,A["SPOTLIGHT"+j]=!1,A["HEMILIGHT"+j]=!1,A["POINTLIGHT"+j]=!1,A["DIRLIGHT"+j]=!1,A["AREALIGHT"+j]=!1,m.prepareLightSpecificDefines(A,j),A["LIGHT_FALLOFF_PHYSICAL"+j]=!1,A["LIGHT_FALLOFF_GLTF"+j]=!1,A["LIGHT_FALLOFF_STANDARD"+j]=!1,m.falloffType){case w.d.FALLOFF_GLTF:A["LIGHT_FALLOFF_GLTF"+j]=!0;break;case w.d.FALLOFF_PHYSICAL:A["LIGHT_FALLOFF_PHYSICAL"+j]=!0;break;case w.d.FALLOFF_STANDARD:A["LIGHT_FALLOFF_STANDARD"+j]=!0}if(b&&!m.TM.equalsFloats(0,0,0)&&(a.specularEnabled=!0),A["SHADOW"+j]=!1,A["SHADOWCSM"+j]=!1,A["SHADOWCSMDEBUG"+j]=!1,A["SHADOWCSMNUM_CASCADES"+j]=!1,A["SHADOWCSMUSESHADOWMAXZ"+j]=!1,A["SHADOWCSMNOBLEND"+j]=!1,A["SHADOWCSM_RIGHTHANDED"+j]=!1,A["SHADOWPCF"+j]=!1,A["SHADOWPCSS"+j]=!1,A["SHADOWPOISSON"+j]=!1,A["SHADOWESM"+j]=!1,A["SHADOWCLOSEESM"+j]=!1,A["SHADOWCUBE"+j]=!1,A["SHADOWLOWQUALITY"+j]=!1,A["SHADOWMEDIUMQUALITY"+j]=!1,d&&d.receiveShadows&&h.shadowsEnabled&&m.shadowEnabled){const d=m.getShadowGenerator(h.activeCamera)??m.getShadowGenerator();if(d){const h=d.getShadowMap();h&&h.renderList&&h.renderList.length>0&&(a.shadowEnabled=!0,d.prepareDefines(A,j))}}m.lightmapMode!=w.d.LIGHTMAP_DEFAULT?(a.lightmapMode=!0,A["LIGHTMAPEXCLUDED"+j]=!0,A["LIGHTMAPNOSPECULAR"+j]=m.lightmapMode==w.d.LIGHTMAP_SHADOWSONLY):(A["LIGHTMAPEXCLUDED"+j]=!1,A["LIGHTMAPNOSPECULAR"+j]=!1)}function c(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=function(h,d){let m=!1;if(h.activeCamera){const j=d.CAMERA_ORTHOGRAPHIC?1:0,A=d.CAMERA_PERSPECTIVE?1:0,b=1===h.activeCamera.mode?1:0,w=0===h.activeCamera.mode?1:0;(j^b||A^w)&&(d.CAMERA_ORTHOGRAPHIC=1===b,d.CAMERA_PERSPECTIVE=1===w,m=!0)}return m}(h,j);!1!==b&&(D=(0,a.g)(m,h,j)),j.DEPTHPREPASS!==!d.getColorWrite()&&(j.DEPTHPREPASS=!j.DEPTHPREPASS,D=!0),j.INSTANCES!==A&&(j.INSTANCES=A,D=!0),j.THIN_INSTANCES!==w&&(j.THIN_INSTANCES=w,D=!0),D&&j.markAsUnprocessed()}function k(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]&&arguments[4],b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],w=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!d._areAttributesDirty&&d._needNormals===d._normals&&d._needUVs===d._uvs)return!1;d._normals=d._needNormals,d._uvs=d._needUVs,d.NORMAL=d._needNormals&&h.isVerticesDataPresent("normal"),d._needNormals&&h.isVerticesDataPresent("tangent")&&(d.TANGENT=!0);for(let a=1;a<=6;++a)d["UV"+a]=!!d._needUVs&&h.isVerticesDataPresent(`uv${1===a?"":a}`);if(m){const m=h.useVertexColors&&h.isVerticesDataPresent("color");d.VERTEXCOLOR=m,d.VERTEXALPHA=h.hasVertexAlpha&&m&&b}return h.isVerticesDataPresent("instanceColor")&&(h.hasInstances||h.hasThinInstances)&&(d.INSTANCESCOLOR=!0),j&&function(h,d){if(h.useBones&&h.computeBonesUsingShaders&&h.skeleton){d.NUM_BONE_INFLUENCERS=h.numBoneInfluencers;const m=void 0!==d.BONETEXTURE;if(h.skeleton.isUsingTextureForMatrices&&m)d.BONETEXTURE=!0;else{d.BonesPerMesh=h.skeleton.bones.length+1,d.BONETEXTURE=!m&&void 0;const j=h.ih().prePassRenderer;if(j&&j.enabled){const m=-1===j.excludedSkinnedMesh.indexOf(h);d.BONES_VELOCITY_ENABLED=m}}}else d.NUM_BONE_INFLUENCERS=0,d.BonesPerMesh=0,void 0!==d.BONETEXTURE&&(d.BONETEXTURE=!1)}(h,d),A&&function(h,d){const m=h.morphTargetManager;m?(d.MORPHTARGETS_UV=m.supportsUVs&&d.UV1,d.MORPHTARGETS_UV2=m.supportsUV2s&&d.UV2,d.MORPHTARGETS_TANGENT=m.supportsTangents&&d.TANGENT,d.MORPHTARGETS_NORMAL=m.supportsNormals&&d.NORMAL,d.MORPHTARGETS_POSITION=m.supportsPositions,d.MORPHTARGETS_COLOR=m.supportsColors,d.MORPHTARGETTEXTURE_HASUVS=m.hasUVs,d.MORPHTARGETTEXTURE_HASUV2S=m.hasUV2s,d.MORPHTARGETTEXTURE_HASTANGENTS=m.hasTangents,d.MORPHTARGETTEXTURE_HASNORMALS=m.hasNormals,d.MORPHTARGETTEXTURE_HASPOSITIONS=m.hasPositions,d.MORPHTARGETTEXTURE_HASCOLORS=m.hasColors,d.NUM_MORPH_INFLUENCERS=m.numMaxInfluencers||m.numInfluencers,d.MORPHTARGETS=d.NUM_MORPH_INFLUENCERS>0,d.MORPHTARGETS_TEXTURE=m.isUsingTextureForTargets):(d.MORPHTARGETS_UV=!1,d.MORPHTARGETS_UV2=!1,d.MORPHTARGETS_TANGENT=!1,d.MORPHTARGETS_NORMAL=!1,d.MORPHTARGETS_POSITION=!1,d.MORPHTARGETS_COLOR=!1,d.MORPHTARGETTEXTURE_HASUVS=!1,d.MORPHTARGETTEXTURE_HASUV2S=!1,d.MORPHTARGETTEXTURE_HASTANGENTS=!1,d.MORPHTARGETTEXTURE_HASNORMALS=!1,d.MORPHTARGETTEXTURE_HASPOSITIONS=!1,d.MORPHTARGETTEXTURE_HAS_COLORS=!1,d.MORPHTARGETS=!1,d.NUM_MORPH_INFLUENCERS=0)}(h,d),w&&function(h,d){const m=h.bakedVertexAnimationManager;d.BAKED_VERTEX_ANIMATION_TEXTURE=!(!m||!m.isEnabled)}(h,d),!0}function l(h,d){if(h.activeCamera){const m=d.MULTIVIEW;d.MULTIVIEW=null!==h.activeCamera.outputRenderTarget&&h.activeCamera.outputRenderTarget.getViewCount()>1,d.MULTIVIEW!=m&&d.markAsUnprocessed()}}function K(h,d,m){const j=d.ORDER_INDEPENDENT_TRANSPARENCY,A=d.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;d.ORDER_INDEPENDENT_TRANSPARENCY=h.useOrderIndependentTransparency&&m,d.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!h.getEngine().getCaps().textureFloatLinearFiltering,j===d.ORDER_INDEPENDENT_TRANSPARENCY&&A===d.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||d.markAsUnprocessed()}function N(h,d,m){const j=d.PREPASS;if(!d._arePrePassDirty)return;const A=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(h.prePassRenderer&&h.prePassRenderer.enabled&&m){d.PREPASS=!0,d.SCENE_MRT_COUNT=h.prePassRenderer.mrtCount,d.PREPASS_NORMAL_WORLDSPACE=h.prePassRenderer.generateNormalsInWorldSpace,d.PREPASS_COLOR=!0,d.PREPASS_COLOR_INDEX=0;for(let m=0;m<A.length;m++){const j=h.prePassRenderer.getIndex(A[m].type);-1!==j?(d[A[m].define]=!0,d[A[m].index]=j):d[A[m].define]=!1}}else{d.PREPASS=!1;for(let h=0;h<A.length;h++)d[A[h].define]=!1}d.PREPASS!=j&&(d.markAsUnprocessed(),d.markAsImageProcessingDirty())}function W(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6];A&&A.push("Light"+h),b||(d.push("vLightData"+h,"vLightDiffuse"+h,"vLightSpecular"+h,"vLightDirection"+h,"vLightWidth"+h,"vLightHeight"+h,"vLightFalloff"+h,"vLightGround"+h,"lightMatrix"+h,"shadowsInfo"+h,"depthValues"+h),m.push("shadowTexture"+h),m.push("depthTexture"+h),d.push("viewFrustumZ"+h,"cascadeBlendFactor"+h,"lightSizeUVCorrection"+h,"depthCorrection"+h,"penumbraDarkness"+h,"frustumLengths"+h),j&&(m.push("projectionLightTexture"+h),d.push("textureProjectionMatrix"+h)),w&&m.push("iesLightTexture"+h))}function r(h,d,m){let j,A,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(h.uniformsNames){const w=h;j=w.uniformsNames,A=w.uniformBuffersNames,d=w.samplers,m=w.defines,b=w.maxSimultaneousLights||0}else j=h,d||(d=[]);for(let w=0;w<b&&m["LIGHT"+w];w++)W(w,j,d,m["PROJECTEDLIGHTTEXTURE"+w],A,!1,m["IESLIGHTTEXTURE"+w]);m.NUM_MORPH_INFLUENCERS&&(j.push("morphTargetInfluences"),j.push("morphTargetCount")),m.BAKED_VERTEX_ANIMATION_TEXTURE&&(j.push("bakedVertexAnimationSettings"),j.push("bakedVertexAnimationTextureSizeInverted"),j.push("bakedVertexAnimationTime"),d.push("bakedVertexAnimationTexture"))}},11702:(h,d,m)=>{m.d(d,{e:()=>b});var j,A=m(11058);!function(h){h[h.Zero=0]="Zero",h[h.One=1]="One",h[h.MaxViewZ=2]="MaxViewZ"}(j||(j={}));class b{static CreateConfiguration(h){return b._Configurations[h]={defines:{},previousWorldMatrices:{},previousViewProjection:A.b.Zero(),currentViewProjection:A.b.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},b._Configurations[h]}static DeleteConfiguration(h){delete b._Configurations[h]}static GetConfiguration(h){return b._Configurations[h]}static AddUniformsAndSamplers(h,d){h.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(h,d){for(const m of d)if(m.Ab)for(const d of m.Ab)d._removeDrawWrapper(h)}static PrepareDefines(h,d,m){if(!m._arePrePassDirty)return;const j=b._Configurations[h];if(!j)return;m.PREPASS=!0,m.PREPASS_COLOR=!1,m.PREPASS_COLOR_INDEX=-1;let A=0;for(let w=0;w<b.GeometryTextureDescriptions.length;w++){const h=b.GeometryTextureDescriptions[w],d=h.define,a=h.defineIndex,D=j.defines[a];void 0!==D?(m[d]=!0,m[a]=D,A++):(m[d]=!1,delete m[a])}m.SCENE_MRT_COUNT=A,m.BONES_VELOCITY_ENABLED=d.useBones&&d.computeBonesUsingShaders&&d.skeleton&&!d.skeleton.isUsingTextureForMatrices&&-1===j.excludedSkinnedMesh.indexOf(d)}static Bind(h,d,m,j,A){const w=b._Configurations[h];if(!w)return;const a=m.ih(),D=a.getEngine();if(w.reverseCulling&&D.setStateCullFaceType(a._mirroredCameraPosition?A.cullBackFaces:!A.cullBackFaces),(void 0!==w.defines.PREPASS_VELOCITY_INDEX||void 0!==w.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(w.previousWorldMatrices[m.uniqueId]||(w.previousWorldMatrices[m.uniqueId]=j.clone()),w.previousViewProjection||(w.previousViewProjection=a.getTransformMatrix().clone(),w.currentViewProjection=a.getTransformMatrix().clone()),w.currentViewProjection.updateFlag!==a.getTransformMatrix().updateFlag?(w.lastUpdateFrameId=D.frameId,w.previousViewProjection.D(w.currentViewProjection),w.currentViewProjection.D(a.getTransformMatrix())):w.lastUpdateFrameId!==D.frameId&&(w.lastUpdateFrameId=D.frameId,w.previousViewProjection.D(w.currentViewProjection)),d.setMatrix("previousWorld",w.previousWorldMatrices[m.uniqueId]),d.setMatrix("previousViewProjection",w.previousViewProjection),w.previousWorldMatrices[m.uniqueId]=j.clone(),m.useBones&&m.computeBonesUsingShaders&&m.skeleton)){const h=m.skeleton;if(!h.isUsingTextureForMatrices||-1===d.getUniformIndex("boneTextureWidth")){const j=h.getTransformMatrices(m);j&&(w.previousBones[m.uniqueId]||(w.previousBones[m.uniqueId]=j.slice()),d.setMatrices("mPreviousBones",w.previousBones[m.uniqueId]),w.previousBones[m.uniqueId].set(j))}}}}b.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],b._Configurations={}},11651:(h,d,m)=>{m.d(d,{c:()=>B});var j=m(11258),A=m(11261),b=m(11251),w=m(11094),a=m(11171),D=m(11200);const S=new RegExp("^([gimus]+)!");class M{constructor(h){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=h,this._scene=h.ih(),this._engine=this._scene.getEngine()}_addPlugin(h){for(let j=0;j<this._plugins.length;++j)if(this._plugins[j].name===h.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!h.isCompatible(this._material.shaderLanguage))throw`The plugin "${h.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const d=h.getClassName();M._MaterialPluginClassToMainDefine[d]||(M._MaterialPluginClassToMainDefine[d]="MATERIALPLUGIN_"+ ++M._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(h,d)=>this._handlePluginEvent(h,d),this._plugins.push(h),this._plugins.sort(((h,d)=>h.priority-d.priority)),this._codeInjectionPoints={};const m={};m[M._MaterialPluginClassToMainDefine[d]]={type:"boolean",default:!0};for(const j of this._plugins)j.collectDefines(m),this._collectPointNames("vertex",j.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",j.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=m,!0}_activatePlugin(h){-1===this._activePlugins.indexOf(h)&&(this._activePlugins.push(h),this._activePlugins.sort(((h,d)=>h.priority-d.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),h.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(h),this._activePluginsForExtraEvents.sort(((h,d)=>h.priority-d.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(h){for(let d=0;d<this._plugins.length;++d)if(this._plugins[d].name===h)return this._plugins[d];return null}_handlePluginEventIsReadyForSubMesh(h){let d=!0;for(const m of this._activePlugins)d=d&&m.isReadyForSubMesh(h.defines,this._scene,this._engine,h.subMesh);h.isReadyForSubMesh=d}_handlePluginEventPrepareDefinesBeforeAttributes(h){for(const d of this._activePlugins)d.prepareDefinesBeforeAttributes(h.defines,this._scene,h.mesh)}_handlePluginEventPrepareDefines(h){for(const d of this._activePlugins)d.prepareDefines(h.defines,this._scene,h.mesh)}_handlePluginEventHardBindForSubMesh(h){for(const d of this._activePluginsForExtraEvents)d.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,h.subMesh)}_handlePluginEventBindForSubMesh(h){for(const d of this._activePlugins)d.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,h.subMesh)}_handlePluginEventHasRenderTargetTextures(h){let d=!1;for(const m of this._activePluginsForExtraEvents)if(d=m.hasRenderTargetTextures(),d)break;h.hasRenderTargetTextures=d}_handlePluginEventFillRenderTargetTextures(h){for(const d of this._activePluginsForExtraEvents)d.fillRenderTargetTextures(h.renderTargets)}_handlePluginEvent(h,d){switch(h){case 512:{const h=d;for(const d of this._activePlugins)d.getActiveTextures(h.activeTextures);break}case 256:{const h=d;for(const d of this._activePlugins)d.getAnimatables(h.animatables);break}case 1024:{const h=d;let m=!1;for(const d of this._activePlugins)if(m=d.hasTexture(h.texture),m)break;h.hasTexture=m;break}case 2:{const h=d;for(const d of this._plugins)d.dispose(h.forceDisposeTextures);break}case 4:d.defineNames=this._defineNamesFromPlugins;break;case 128:{const h=d;for(const d of this._activePlugins)h.fallbackRank=d.addFallbacks(h.defines,h.fallbacks,h.fallbackRank),d.getAttributes(h.attributes,this._scene,h.mesh);this._uniformList.length>0&&h.uniforms.push(...this._uniformList),this._samplerList.length>0&&h.samplers.push(...this._samplerList),this._uboList.length>0&&h.uniformBuffersNames.push(...this._uboList),h.customCode=this._injectCustomCode(h,h.customCode);break}case 8:{const h=d;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const m=1===this._material.shaderLanguage;for(const d of this._plugins){const j=d.getUniforms(this._material.shaderLanguage);if(j){if(j.ubo)for(const d of j.ubo){if(d.size&&d.type){const j=d.arraySize??0;if(h.ubo.addUniform(d.name,d.size,j),m){let h;switch(d.type){case"mat4":h="mat4x4f";break;case"float":h="f32";break;default:h=`${d.type}f`}this._uboDeclaration+=j>0?`uniform ${d.name}: array<${h}, ${j}>;\n`:`uniform ${d.name}: ${h};\n`}else this._uboDeclaration+=`${d.type} ${d.name}${j>0?`[${j}]`:""};\n`}this._uniformList.push(d.name)}j.vertex&&(this._vertexDeclaration+=j.vertex+"\n"),j.fragment&&(this._fragmentDeclaration+=j.fragment+"\n")}d.getSamplers(this._samplerList),d.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(h,d){if(d)for(const m in d)this._codeInjectionPoints[h]||(this._codeInjectionPoints[h]={}),this._codeInjectionPoints[h][m]=!0}_injectCustomCode(h,d){return(m,j)=>{var A;d&&(j=d(m,j)),this._uboDeclaration&&(j=j.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(j=j.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(j=j.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const b=null===(A=this._codeInjectionPoints)||void 0===A?void 0:A[m];if(!b)return j;let w=null;for(let d in b){let A="";for(const j of this._activePlugins){var M;let b=null===(M=j.getCustomCode(m,this._material.shaderLanguage))||void 0===M?void 0:M[d];if(b){if(j.resolveIncludes){if(null===w){const d=0;w={defines:[],indexParameters:h.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:D.b.GetShadersRepository(d),includesShadersStore:D.b.GetIncludesShadersStore(d),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}w.isFragment="fragment"===m,(0,a.h)(b,w,(h=>b=h))}A+=b+"\n"}}if(A.length>0)if("!"===d.charAt(0)){d=d.substring(1);let h="g";if("!"===d.charAt(0))h="",d=d.substring(1);else{const m=S.exec(d);m&&m.length>=2&&(h=m[1],d=d.substring(h.length+1))}h.indexOf("g")<0&&(h+="g");const m=j,b=new RegExp(d,h);let w=b.exec(m);for(;null!==w;){let h=A;for(let d=0;d<w.length;++d)h=h.replace("$"+d,w[d]);j=j.replace(w[0],h),w=b.exec(m)}}else{const h="#define "+d;j=j.replace(h,"\n"+A+"\n"+h)}}return j}}}M._MaterialPluginClassToMainDefine={},M._MaterialPluginCounter=0,w.b.OnEnginesDisposedObservable.add((()=>{R()}));const q=[];let E=!1,I=null;function R(){q.length=0,E=!1,b.d.OnEventObservable.remove(I),I=null}var Z=m(11341),L=m(11080);class B{isCompatible(h){return 0===h}_enable(h){h&&this._pluginManager._activatePlugin(this)}constructor(h,d,m,j){let A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=h,this.name=d,this.priority=m,this.resolveIncludes=w,h.pluginManager||(h.pluginManager=new M(h),h.pd.add((()=>{h.pluginManager=void 0}))),this._pluginDefineNames=j,this._pluginManager=h.pluginManager,A&&this._pluginManager._addPlugin(this),b&&this._enable(!0),this.markAllDefinesAsDirty=h._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(h,d,m,j){return!0}hardBindForSubMesh(h,d,m,j){}bindForSubMesh(h,d,m,j){}dispose(h){}getCustomCode(h){return null}collectDefines(h){if(this._pluginDefineNames)for(const d of Object.keys(this._pluginDefineNames)){if("_"===d[0])continue;const m=typeof this._pluginDefineNames[d];h[d]={type:"number"===m?"number":"string"===m?"string":"boolean"===m?"boolean":"object",default:this._pluginDefineNames[d]}}}prepareDefinesBeforeAttributes(h,d,m){}prepareDefines(h,d,m){}hasTexture(h){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(h){}getActiveTextures(h){}getAnimatables(h){}addFallbacks(h,d,m){return m}getSamplers(h){}getAttributes(h,d,m){}getUniformBuffersNames(h){}getUniforms(){return{}}copyTo(h){Z.d.Clone((()=>h),this)}serialize(){return Z.d.Serialize(this)}parse(h,d,m){Z.d.Parse((()=>this),h,d,m)}}(0,j.d)([(0,A.M)()],B.prototype,"name",void 0),(0,j.d)([(0,A.M)()],B.prototype,"priority",void 0),(0,j.d)([(0,A.M)()],B.prototype,"resolveIncludes",void 0),(0,j.d)([(0,A.M)()],B.prototype,"registerForExtraEvents",void 0),(0,L.i)("BABYLON.MaterialPluginBase",B)},11457:(h,d,m)=>{m.d(d,{e:()=>w});var j=m(11251),A=m(11350),b=m(11080);class w extends j.d{get bb(){return this._subMaterials}set bb(h){this._subMaterials=h,this._hookArray(h)}getChildren(){return this.bb}constructor(h,d){super(h,d,!0),this._waitingSubMaterialsUniqueIds=[],this.ih().addMultiMaterial(this),this.bb=[],this._storeEffectOnSubMeshes=!0}_hookArray(h){var d=this;const m=h.push;h.push=function(){for(var j=arguments.length,A=new Array(j),b=0;b<j;b++)A[b]=arguments[b];const w=m.apply(h,A);return d._markAllSubMeshesAsTexturesDirty(),w};const j=h.splice;h.splice=(d,m)=>{const A=j.apply(h,[d,m]);return this._markAllSubMeshesAsTexturesDirty(),A}}getSubMaterial(h){return h<0||h>=this.bb.length?this.ih().defaultMaterial:this.bb[h]}getActiveTextures(){return super.getActiveTextures().concat(...this.bb.map((h=>h?h.getActiveTextures():[])))}hasTexture(h){if(super.hasTexture(h))return!0;for(let m=0;m<this.bb.length;m++){var d;if(null!==(d=this.bb[m])&&void 0!==d&&d.hasTexture(h))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(h,d,m){for(let j=0;j<this.bb.length;j++){const A=this.bb[j];if(A){if(A._storeEffectOnSubMeshes){if(!A.isReadyForSubMesh(h,d,m))return!1;continue}if(!A.isReady(h))return!1}}return!0}clone(h,d){const m=new w(h,this.ih());for(let j=0;j<this.bb.length;j++){let A=null;const b=this.bb[j];A=d&&b?b.clone(h+"-"+b.name):this.bb[j],m.bb.push(A)}return m}serialize(){const h={};h.name=this.name,h.id=this.id,h.uniqueId=this.uniqueId,A.e&&(h.tags=A.e.GetTags(this)),h.materialsUniqueIds=[],h.materials=[];for(let d=0;d<this.bb.length;d++){const m=this.bb[d];m?(h.materialsUniqueIds.push(m.uniqueId),h.materials.push(m.id)):(h.materialsUniqueIds.push(null),h.materials.push(null))}return h}dispose(h,d,m){const j=this.ih();if(!j)return;if(m)for(let b=0;b<this.bb.length;b++){const m=this.bb[b];m&&m.dispose(h,d)}const A=j.multiMaterials.indexOf(this);A>=0&&j.multiMaterials.splice(A,1),super.dispose(h,d)}static ParseMultiMaterial(h,d){const m=new w(h.name,d);if(m.id=h.id,m._loadedUniqueId=h.uniqueId,A.e&&A.e.AddTagsTo(m,h.tags),h.materialsUniqueIds)m._waitingSubMaterialsUniqueIds=h.materialsUniqueIds;else for(const j of h.materials)m.bb.push(d.getLastMaterialById(j));return m}}(0,b.i)("BABYLON.MultiMaterial",w)},11658:(h,d,m)=>{m.d(d,{e:()=>j});class j{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(h){h.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(h){}bindForSubMesh(h,d,m,j,A){if(d.prePassRenderer&&d.prePassRenderer.enabled&&d.prePassRenderer.currentRTisSceneRT&&(-1!==d.prePassRenderer.getIndex(2)||-1!==d.prePassRenderer.getIndex(11))){this.previousWorldMatrices[m.uniqueId]||(this.previousWorldMatrices[m.uniqueId]=j.clone()),this.previousViewProjection||(this.previousViewProjection=d.getTransformMatrix().clone(),this.currentViewProjection=d.getTransformMatrix().clone());const A=d.getEngine();this.currentViewProjection.updateFlag!==d.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=A.frameId,this.previousViewProjection.D(this.currentViewProjection),this.currentViewProjection.D(d.getTransformMatrix())):this._lastUpdateFrameId!==A.frameId&&(this._lastUpdateFrameId=A.frameId,this.previousViewProjection.D(this.currentViewProjection)),h.setMatrix("previousWorld",this.previousWorldMatrices[m.uniqueId]),h.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[m.uniqueId]=j.clone()}}}},11663:(h,d,m)=>{m.d(d,{c:()=>b});var j=m(11058),A=m(11251);class b extends A.d{constructor(h,d){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(h,d,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new j.b,this._storeEffectOnSubMeshes=m}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(h,d){return!!h&&(!this._storeEffectOnSubMeshes||(!h.Ab||0===h.Ab.length||this.isReadyForSubMesh(h,h.Ab[0],d)))}_isReadyForSubMesh(h){const d=h.materialDefines;return!(this.checkReadyOnEveryCall||!h.effect||!d||d._renderId!==this.ih().getRenderId())}bindOnlyWorldMatrix(h){this._activeEffect.setMatrix("world",h)}bindOnlyNormalMatrix(h){this._activeEffect.setMatrix("normalMatrix",h)}bind(h,d){d&&this.bindForSubMesh(h,d,d.Ab[0])}_afterBind(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0;super._afterBind(h,d,m),this.ih()._cachedEffect=d,m?m._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return m._drawWrapper._forceRebindOnNextCall||h.isCachedMaterialInvalid(this,d,j)}dispose(h,d,m){this._activeEffect=void 0,super.dispose(h,d,m)}}},11747:(h,d,m)=>{m.d(d,{b:()=>L});var j=m(11341),A=m(11604),b=m(11058),w=m(11281),a=m(11543),D=m(11080),S=m(11684),M=m(11144),q=m(11663),E=m(11094),I=m(11363),R=m(11357);const Z={effect:null,subMesh:null};class L extends q.c{constructor(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(h,d,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new b.b,this._cachedWorldViewProjectionMatrix=new b.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=m,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","Dd","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...j}}get shaderPath(){return this._shaderPath}set shaderPath(h){this._shaderPath=h}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(h){-1===this._options.uniforms.indexOf(h)&&this._options.uniforms.push(h)}setTexture(h,d){return-1===this._options.samplers.indexOf(h)&&this._options.samplers.push(h),this._textures[h]=d,this}removeTexture(h){delete this._textures[h]}setTextureArray(h,d){return-1===this._options.samplers.indexOf(h)&&this._options.samplers.push(h),this._checkUniform(h),this._textureArrays[h]=d,this}setExternalTexture(h,d){return-1===this._options.externalTextures.indexOf(h)&&this._options.externalTextures.push(h),this._externalTextures[h]=d,this}setFloat(h,d){return this._checkUniform(h),this._floats[h]=d,this}setInt(h,d){return this._checkUniform(h),this._ints[h]=d,this}setUInt(h,d){return this._checkUniform(h),this._uints[h]=d,this}setFloats(h,d){return this._checkUniform(h),this._floatsArrays[h]=d,this}setColor3(h,d){return this._checkUniform(h),this._colors3[h]=d,this}setColor3Array(h,d){return this._checkUniform(h),this._colors3Arrays[h]=d.reduce(((h,d)=>(h.push(d.r,d.g,d.b),h)),[]),this}setColor4(h,d){return this._checkUniform(h),this._colors4[h]=d,this}setColor4Array(h,d){return this._checkUniform(h),this._colors4Arrays[h]=d.reduce(((h,d)=>(h.push(d.r,d.g,d.b,d.a),h)),[]),this}setVector2(h,d){return this._checkUniform(h),this._vectors2[h]=d,this}setVector3(h,d){return this._checkUniform(h),this._vectors3[h]=d,this}setVector4(h,d){return this._checkUniform(h),this._vectors4[h]=d,this}setQuaternion(h,d){return this._checkUniform(h),this._quaternions[h]=d,this}setQuaternionArray(h,d){return this._checkUniform(h),this._quaternionsArrays[h]=d.reduce(((h,d)=>(d.toArray(h,h.length),h)),[]),this}setMatrix(h,d){return this._checkUniform(h),this._matrices[h]=d,this}setMatrices(h,d){this._checkUniform(h);const m=new Float32Array(16*d.length);for(let j=0;j<d.length;j++){d[j].copyToArray(m,16*j)}return this._matrixArrays[h]=m,this}setMatrix3x3(h,d){return this._checkUniform(h),this._matrices3x3[h]=d,this}setMatrix2x2(h,d){return this._checkUniform(h),this._matrices2x2[h]=d,this}setArray2(h,d){return this._checkUniform(h),this._vectors2Arrays[h]=d,this}setArray3(h,d){return this._checkUniform(h),this._vectors3Arrays[h]=d,this}setArray4(h,d){return this._checkUniform(h),this._vectors4Arrays[h]=d,this}setUniformBuffer(h,d){return-1===this._options.uniformBuffers.indexOf(h)&&this._options.uniformBuffers.push(h),this._uniformBuffers[h]=d,this}setTextureSampler(h,d){return-1===this._options.samplerObjects.indexOf(h)&&this._options.samplerObjects.push(h),this._textureSamplers[h]=d,this}setStorageBuffer(h,d){return-1===this._options.storageBuffers.indexOf(h)&&this._options.storageBuffers.push(h),this._storageBuffers[h]=d,this}setDefine(h,d){const m=h.trimEnd()+" ",j=this.options.defines.findIndex((d=>d===h||d.startsWith(m)));return j>=0&&this.options.defines.splice(j,1),("boolean"!==typeof d||d)&&this.options.defines.push(m+d),this}isReadyForSubMesh(h,d,m){return this.isReady(h,m,d)}isReady(h,d,m){var j;const b=m&&this._storeEffectOnSubMeshes;if(this.isFrozen){const h=b?m._drawWrapper:this._drawWrapper;if(h.effect&&h._wasPreviouslyReady&&h._wasPreviouslyUsingInstances===d)return!0}const a=this.ih(),D=a.getEngine(),M=[],q=[];let E=null,L=this._shaderPath,B=this._options.uniforms,V=this._options.uniformBuffers,v=this._options.samplers;D.getCaps().multiview&&a.activeCamera&&a.activeCamera.outputRenderTarget&&a.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,M.push("#define MULTIVIEW"),-1!==B.indexOf("viewProjection")&&-1===B.indexOf("viewProjectionR")&&B.push("viewProjectionR"));for(let A=0;A<this._options.defines.length;A++){const h=0===this._options.defines[A].indexOf("#define")?this._options.defines[A]:`#define ${this._options.defines[A]}`;M.push(h)}for(let A=0;A<this._options.attributes.length;A++)q.push(this._options.attributes[A]);if(h&&h.isVerticesDataPresent(w.d.ColorKind)&&(-1===q.indexOf(w.d.ColorKind)&&q.push(w.d.ColorKind),M.push("#define VERTEXCOLOR")),d&&(M.push("#define INSTANCES"),(0,R.fb)(q,this._materialHelperNeedsPreviousMatrices),null!==h&&void 0!==h&&h.hasThinInstances&&(M.push("#define THIN_INSTANCES"),h&&h.isVerticesDataPresent(w.d.ColorInstanceKind)&&(q.push(w.d.ColorInstanceKind),M.push("#define INSTANCESCOLOR")))),h&&h.useBones&&h.computeBonesUsingShaders&&h.skeleton){q.push(w.d.MatricesIndicesKind),q.push(w.d.MatricesWeightsKind),h.numBoneInfluencers>4&&(q.push(w.d.MatricesIndicesExtraKind),q.push(w.d.MatricesWeightsExtraKind));const d=h.skeleton;M.push("#define NUM_BONE_INFLUENCERS "+h.numBoneInfluencers),E=new S.e,E.addCPUSkinningFallback(0,h),d.isUsingTextureForMatrices?(M.push("#define BONETEXTURE"),-1===B.indexOf("boneTextureWidth")&&B.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(M.push("#define BonesPerMesh "+(d.bones.length+1)),-1===B.indexOf("mBones")&&B.push("mBones"))}else M.push("#define NUM_BONE_INFLUENCERS 0");let C=0;const T=h?h.morphTargetManager:null;if(T){const d=-1!==M.indexOf("#define UV1"),m=-1!==M.indexOf("#define UV2"),j=-1!==M.indexOf("#define TANGENT"),A=-1!==M.indexOf("#define NORMAL"),b=-1!==M.indexOf("#define VERTEXCOLOR");C=(0,R.F)(T,M,q,h,!0,A,j,d,m,b),T.isUsingTextureForTargets&&(-1===B.indexOf("morphTargetTextureIndices")&&B.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),C>0&&(B=B.slice(),B.push("morphTargetInfluences"),B.push("morphTargetCount"),B.push("morphTargetTextureInfo"),B.push("morphTargetTextureIndices"))}else M.push("#define NUM_MORPH_INFLUENCERS 0");if(h){const d=h.bakedVertexAnimationManager;d&&d.isEnabled&&(M.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===B.indexOf("bakedVertexAnimationSettings")&&B.push("bakedVertexAnimationSettings"),-1===B.indexOf("bakedVertexAnimationTextureSizeInverted")&&B.push("bakedVertexAnimationTextureSizeInverted"),-1===B.indexOf("bakedVertexAnimationTime")&&B.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,R.y)(q,h,M)}for(const A in this._textures)if(!this._textures[A].isReady())return!1;h&&this.needAlphaTestingForMesh(h)&&M.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,I.b)(B),(0,I.k)(this,a,M)),a.fogEnabled&&null!==h&&void 0!==h&&h.applyFog&&a.fogMode!==A.c.FOGMODE_NONE&&(M.push("#define FOG"),-1===B.indexOf("view")&&B.push("view"),-1===B.indexOf("vFogInfos")&&B.push("vFogInfos"),-1===B.indexOf("vFogColor")&&B.push("vFogColor")),this._useLogarithmicDepth&&(M.push("#define LOGARITHMICDEPTH"),-1===B.indexOf("logarithmicDepthConstant")&&B.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(B=B.slice(),V=V.slice(),v=v.slice(),L=this.customShaderNameResolve(this.name,B,V,v,M,q));const o=b?m._getDrawWrapper(void 0,!0):this._drawWrapper,y=(null===o||void 0===o?void 0:o.effect)??null,i=(null===o||void 0===o?void 0:o.defines)??null,g=M.join("\n");let F=y;return i!==g&&(F=D.createEffect(L,{attributes:q,uniformsNames:B,uniformBuffersNames:V,samplers:v,defines:g,fallbacks:E,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:C},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},D),b?m.setEffect(F,g,this._materialContext):o&&o.setEffect(F,g),this._onEffectCreatedObservable&&(Z.effect=F,Z.subMesh=m??(null===h||void 0===h?void 0:h.Ab[0])??null,this._onEffectCreatedObservable.notifyObservers(Z))),o._wasPreviouslyUsingInstances=!!d,!(null===(j=F)||void 0===j||!j.isReady())&&(y!==F&&a.resetCachedMaterial(),o._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(h,d){const m=d??this.getEffect();if(!m)return;const j=this._options.uniforms;-1!==j.indexOf("world")&&m.setMatrix("world",h);const A=this.ih();-1!==j.indexOf("worldView")&&(h.multiplyToRef(A.getViewMatrix(),this._cachedWorldViewMatrix),m.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==j.indexOf("worldViewProjection")&&(h.multiplyToRef(A.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),m.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==j.indexOf("view")&&m.setMatrix("view",A.getViewMatrix())}bindForSubMesh(h,d,m){var j;this.bind(h,d,null===(j=m._drawWrapperOverride)||void 0===j?void 0:j.effect,m)}bind(h,d,m,j){const A=j&&this._storeEffectOnSubMeshes,b=m??(A?j.effect:this.getEffect());if(!b)return;const w=this.ih();this._activeEffect=b,this.bindOnlyWorldMatrix(h,m);const a=this._options.uniformBuffers;let D=!1;if(b&&a&&a.length>0&&w.getEngine().supportsUniformBuffers)for(let q=0;q<a.length;++q){switch(a[q]){case"Mesh":d&&(d.getMeshUniformBuffer().bindToEffect(b,"Mesh"),d.transferToEffect(h));break;case"Scene":(0,R.s)(b,w.getSceneUniformBuffer()),w.finalizeSceneUbo(),D=!0}}const S=d&&A?this._mustRebind(w,b,j,d.visibility):w.getCachedMaterial()!==this;if(b&&S){let h;for(h in D||-1===this._options.uniforms.indexOf("view")||b.setMatrix("view",w.getViewMatrix()),D||-1===this._options.uniforms.indexOf("projection")||b.setMatrix("projection",w.getProjectionMatrix()),D||-1===this._options.uniforms.indexOf("viewProjection")||(b.setMatrix("viewProjection",w.getTransformMatrix()),this._multiview&&b.setMatrix("viewProjectionR",w._transformMatrixR)),w.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&b.setVector3("cameraPosition",w.activeCamera.globalPosition),(0,R.c)(d,b),(0,I.f)(b,this,w),this._useLogarithmicDepth&&(0,R.l)(A?j.materialDefines:b.defines,b,w),d&&(0,R.g)(w,d,b),this._textures)b.setTexture(h,this._textures[h]);for(h in this._textureArrays)b.setTextureArray(h,this._textureArrays[h]);for(h in this._ints)b.setInt(h,this._ints[h]);for(h in this._uints)b.setUInt(h,this._uints[h]);for(h in this._floats)b.setFloat(h,this._floats[h]);for(h in this._floatsArrays)b.setArray(h,this._floatsArrays[h]);for(h in this._colors3)b.setColor3(h,this._colors3[h]);for(h in this._colors3Arrays)b.setArray3(h,this._colors3Arrays[h]);for(h in this._colors4){const d=this._colors4[h];b.setFloat4(h,d.r,d.g,d.b,d.a)}for(h in this._colors4Arrays)b.setArray4(h,this._colors4Arrays[h]);for(h in this._vectors2)b.setVector2(h,this._vectors2[h]);for(h in this._vectors3)b.setVector3(h,this._vectors3[h]);for(h in this._vectors4)b.setVector4(h,this._vectors4[h]);for(h in this._quaternions)b.setQuaternion(h,this._quaternions[h]);for(h in this._matrices)b.setMatrix(h,this._matrices[h]);for(h in this._matrixArrays)b.setMatrices(h,this._matrixArrays[h]);for(h in this._matrices3x3)b.setMatrix3x3(h,this._matrices3x3[h]);for(h in this._matrices2x2)b.setMatrix2x2(h,this._matrices2x2[h]);for(h in this._vectors2Arrays)b.setArray2(h,this._vectors2Arrays[h]);for(h in this._vectors3Arrays)b.setArray3(h,this._vectors3Arrays[h]);for(h in this._vectors4Arrays)b.setArray4(h,this._vectors4Arrays[h]);for(h in this._quaternionsArrays)b.setArray4(h,this._quaternionsArrays[h]);for(h in this._uniformBuffers){const d=this._uniformBuffers[h].getBuffer();d&&b.bindUniformBuffer(d,h)}const m=w.getEngine(),a=m.setExternalTexture;if(a)for(h in this._externalTextures)a.call(m,h,this._externalTextures[h]);const S=m.setTextureSampler;if(S)for(h in this._textureSamplers)S.call(m,h,this._textureSamplers[h]);const M=m.setStorageBuffer;if(M)for(h in this._storageBuffers)M.call(m,h,this._storageBuffers[h])}if(b&&d&&(S||!this.isFrozen)){(0,R.o)(d,b),d.morphTargetManager&&d.morphTargetManager.isUsingTextureForTargets&&d.morphTargetManager._bind(b);const h=d.bakedVertexAnimationManager;if(h&&h.isEnabled){var M;const h=A?j._drawWrapper:this._drawWrapper;null===(M=d.bakedVertexAnimationManager)||void 0===M||M.bind(b,!!h._wasPreviouslyUsingInstances)}}this._afterBind(d,b,j)}getActiveTextures(){const h=super.getActiveTextures();for(const d in this._textures)h.push(this._textures[d]);for(const d in this._textureArrays){const m=this._textureArrays[d];for(let d=0;d<m.length;d++)h.push(m[d])}return h}hasTexture(h){if(super.hasTexture(h))return!0;for(const d in this._textures)if(this._textures[d]===h)return!0;for(const d in this._textureArrays){const m=this._textureArrays[d];for(let d=0;d<m.length;d++)if(m[d]===h)return!0}return!1}clone(h){const d=j.d.Clone((()=>new L(h,this.ih(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);d.name=h,d.id=h,"object"===typeof d._shaderPath&&(d._shaderPath={...d._shaderPath}),this._options={...this._options};const m=Object.keys(this._options);for(const j of m){const h=this._options[j];Array.isArray(h)&&(this._options[j]=h.slice(0))}this.stencil.copyTo(d.stencil);for(const j in this._textures)d.setTexture(j,this._textures[j]);for(const j in this._textureArrays)d.setTextureArray(j,this._textureArrays[j]);for(const j in this._externalTextures)d.setExternalTexture(j,this._externalTextures[j]);for(const j in this._ints)d.setInt(j,this._ints[j]);for(const j in this._uints)d.setUInt(j,this._uints[j]);for(const j in this._floats)d.setFloat(j,this._floats[j]);for(const j in this._floatsArrays)d.setFloats(j,this._floatsArrays[j]);for(const j in this._colors3)d.setColor3(j,this._colors3[j]);for(const j in this._colors3Arrays)d._colors3Arrays[j]=this._colors3Arrays[j];for(const j in this._colors4)d.setColor4(j,this._colors4[j]);for(const j in this._colors4Arrays)d._colors4Arrays[j]=this._colors4Arrays[j];for(const j in this._vectors2)d.setVector2(j,this._vectors2[j]);for(const j in this._vectors3)d.setVector3(j,this._vectors3[j]);for(const j in this._vectors4)d.setVector4(j,this._vectors4[j]);for(const j in this._quaternions)d.setQuaternion(j,this._quaternions[j]);for(const j in this._quaternionsArrays)d._quaternionsArrays[j]=this._quaternionsArrays[j];for(const j in this._matrices)d.setMatrix(j,this._matrices[j]);for(const j in this._matrixArrays)d._matrixArrays[j]=this._matrixArrays[j].slice();for(const j in this._matrices3x3)d.setMatrix3x3(j,this._matrices3x3[j]);for(const j in this._matrices2x2)d.setMatrix2x2(j,this._matrices2x2[j]);for(const j in this._vectors2Arrays)d.setArray2(j,this._vectors2Arrays[j]);for(const j in this._vectors3Arrays)d.setArray3(j,this._vectors3Arrays[j]);for(const j in this._vectors4Arrays)d.setArray4(j,this._vectors4Arrays[j]);for(const j in this._uniformBuffers)d.setUniformBuffer(j,this._uniformBuffers[j]);for(const j in this._textureSamplers)d.setTextureSampler(j,this._textureSamplers[j]);for(const j in this._storageBuffers)d.setStorageBuffer(j,this._storageBuffers[j]);return d}dispose(h,d,m){if(d){let h;for(h in this._textures)this._textures[h].dispose();for(h in this._textureArrays){const d=this._textureArrays[h];for(let h=0;h<d.length;h++)d[h].dispose()}}this._textures={},super.dispose(h,d,m)}serialize(){const h=j.d.Serialize(this);let d;for(d in h.customType="BABYLON.ShaderMaterial",h.uniqueId=this.uniqueId,h.options=this._options,h.shaderPath=this._shaderPath,h.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,h.stencil=this.stencil.serialize(),h.textures={},this._textures)h.textures[d]=this._textures[d].serialize();for(d in h.textureArrays={},this._textureArrays){h.textureArrays[d]=[];const m=this._textureArrays[d];for(let j=0;j<m.length;j++)h.textureArrays[d].push(m[j].serialize())}for(d in h.ints={},this._ints)h.ints[d]=this._ints[d];for(d in h.uints={},this._uints)h.uints[d]=this._uints[d];for(d in h.floats={},this._floats)h.floats[d]=this._floats[d];for(d in h.floatsArrays={},this._floatsArrays)h.floatsArrays[d]=this._floatsArrays[d];for(d in h.colors3={},this._colors3){const m=this._colors3[d];h.colors3[d]=[m.r,m.g,m.b]}for(d in h.colors3Arrays={},this._colors3Arrays)h.colors3Arrays[d]=this._colors3Arrays[d];for(d in h.colors4={},this._colors4){const m=this._colors4[d];h.colors4[d]=[m.r,m.g,m.b,m.a]}for(d in h.colors4Arrays={},this._colors4Arrays)h.colors4Arrays[d]=this._colors4Arrays[d];for(d in h.vectors2={},this._vectors2){const m=this._vectors2[d];h.vectors2[d]=[m.x,m.y]}for(d in h.vectors3={},this._vectors3){const m=this._vectors3[d];h.vectors3[d]=[m.x,m.y,m.z]}for(d in h.vectors4={},this._vectors4){const m=this._vectors4[d];h.vectors4[d]=[m.x,m.y,m.z,m.w]}for(d in h.quaternions={},this._quaternions)h.quaternions[d]=this._quaternions[d].fd();for(d in h.matrices={},this._matrices)h.matrices[d]=this._matrices[d].fd();for(d in h.matrixArray={},this._matrixArrays)h.matrixArray[d]=this._matrixArrays[d];for(d in h.matrices3x3={},this._matrices3x3)h.matrices3x3[d]=this._matrices3x3[d];for(d in h.matrices2x2={},this._matrices2x2)h.matrices2x2[d]=this._matrices2x2[d];for(d in h.vectors2Arrays={},this._vectors2Arrays)h.vectors2Arrays[d]=this._vectors2Arrays[d];for(d in h.vectors3Arrays={},this._vectors3Arrays)h.vectors3Arrays[d]=this._vectors3Arrays[d];for(d in h.vectors4Arrays={},this._vectors4Arrays)h.vectors4Arrays[d]=this._vectors4Arrays[d];for(d in h.quaternionsArrays={},this._quaternionsArrays)h.quaternionsArrays[d]=this._quaternionsArrays[d];return h}static Parse(h,d,m){const A=j.d.Parse((()=>new L(h.name,d,h.shaderPath,h.options,h.storeEffectOnSubMeshes)),h,d,m);let w;for(w in h.stencil&&A.stencil.parse(h.stencil,d,m),h.textures)A.setTexture(w,a.e.Parse(h.textures[w],d,m));for(w in h.textureArrays){const j=h.textureArrays[w],b=[];for(let h=0;h<j.length;h++)b.push(a.e.Parse(j[h],d,m));A.setTextureArray(w,b)}for(w in h.ints)A.setInt(w,h.ints[w]);for(w in h.uints)A.setUInt(w,h.uints[w]);for(w in h.floats)A.setFloat(w,h.floats[w]);for(w in h.floatsArrays)A.setFloats(w,h.floatsArrays[w]);for(w in h.colors3){const d=h.colors3[w];A.setColor3(w,{r:d[0],g:d[1],b:d[2]})}for(w in h.colors3Arrays){const d=h.colors3Arrays[w].reduce(((h,d,m)=>(m%3===0?h.push([d]):h[h.length-1].push(d),h)),[]).map((h=>({r:h[0],g:h[1],b:h[2]})));A.setColor3Array(w,d)}for(w in h.colors4){const d=h.colors4[w];A.setColor4(w,{r:d[0],g:d[1],b:d[2],a:d[3]})}for(w in h.colors4Arrays){const d=h.colors4Arrays[w].reduce(((h,d,m)=>(m%4===0?h.push([d]):h[h.length-1].push(d),h)),[]).map((h=>({r:h[0],g:h[1],b:h[2],a:h[3]})));A.setColor4Array(w,d)}for(w in h.vectors2){const d=h.vectors2[w];A.setVector2(w,{x:d[0],y:d[1]})}for(w in h.vectors3){const d=h.vectors3[w];A.setVector3(w,{x:d[0],y:d[1],z:d[2]})}for(w in h.vectors4){const d=h.vectors4[w];A.setVector4(w,{x:d[0],y:d[1],z:d[2],w:d[3]})}for(w in h.quaternions)A.setQuaternion(w,b.c.Ud(h.quaternions[w]));for(w in h.matrices)A.setMatrix(w,b.b.Ud(h.matrices[w]));for(w in h.matrixArray)A._matrixArrays[w]=new Float32Array(h.matrixArray[w]);for(w in h.matrices3x3)A.setMatrix3x3(w,h.matrices3x3[w]);for(w in h.matrices2x2)A.setMatrix2x2(w,h.matrices2x2[w]);for(w in h.vectors2Arrays)A.setArray2(w,h.vectors2Arrays[w]);for(w in h.vectors3Arrays)A.setArray3(w,h.vectors3Arrays[w]);for(w in h.vectors4Arrays)A.setArray4(w,h.vectors4Arrays[w]);for(w in h.quaternionsArrays)A.setArray4(w,h.quaternionsArrays[w]);return A}static async ParseFromFileAsync(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((A,b)=>{const w=new M.c;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const d=JSON.parse(w.responseText),b=this.Parse(d,m||E.b.LastCreatedScene,j);h&&(b.name=h),A(b)}else b("Unable to load the ShaderMaterial")})),w.open("GET",d),w.send()}))}static async ParseFromSnippetAsync(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((j,A)=>{const b=new M.c;b.addEventListener("readystatechange",(()=>{if(4==b.readyState)if(200==b.status){const A=JSON.parse(JSON.parse(b.responseText).jsonPayload),w=JSON.parse(A.shaderMaterial),a=this.Parse(w,d||E.b.LastCreatedScene,m);a.snippetId=h,j(a)}else A("Unable to load the snippet "+h)})),b.open("GET",this.SnippetUrl+"/"+h.replace(/#/g,"/")),b.send()}))}}L.SnippetUrl="https://snippet.babylonjs.com",L.CreateFromSnippetAsync=L.ParseFromSnippetAsync,(0,D.i)("BABYLON.ShaderMaterial",L)},11711:(h,d,m)=>{m.d(d,{b:()=>g});var j=m(11258),A=m(11261),b=m(11430),w=m(11604),a=m(11353),D=m(11281),S=m(11658),M=m(11606),q=m(11251),E=m(11647),I=m(11663),R=m(11543),Z=m(11080),L=m(11670),B=m(11684),V=m(11693),v=m(11363),C=m(11357),T=m(11341),o=m(11702);const y={effect:null,subMesh:null};class i extends E.e{constructor(h){super(h),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(h){const d=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const m of d)this[m]=m===h}}class g extends I.c{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(h){this._attachImageProcessingConfiguration(h),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(h){h!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=h||this.ih().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(h){this.imageProcessingConfiguration.colorCurvesEnabled=h}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(h){this.imageProcessingConfiguration.colorGradingEnabled=h}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(h){this._imageProcessingConfiguration.toneMappingEnabled=h}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(h){this._imageProcessingConfiguration.exposure=h}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(h){this._imageProcessingConfiguration.contrast=h}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(h){this._imageProcessingConfiguration.colorGradingTexture=h}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(h){this._imageProcessingConfiguration.colorCurves=h}get canRenderToMRT(){return!0}constructor(h,d){super(h,d,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||g.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new a.d(0,0,0),this.diffuseColor=new a.d(1,1,1),this.specularColor=new a.d(1,1,1),this.emissiveColor=new a.d(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new b.e(16),this._globalAmbientColor=new a.d(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new V.b(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new S.e,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),g.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),g.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(g.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(g.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"Sb"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===q.d.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Nd&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==q.d.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Nd||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(h,d){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const A=d._drawWrapper;if(A.effect&&this.isFrozen&&A._wasPreviouslyReady&&A._wasPreviouslyUsingInstances===j)return!0;d.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),d.materialDefines=new i(this._eventInfo.defineNames));const b=this.ih(),w=d.materialDefines;if(this._isReadyForSubMesh(d))return!0;const a=b.getEngine();w._needNormals=(0,C.Q)(b,h,w,!0,this._maxSimultaneousLights,this._disableLighting),(0,C.$)(b,w);const q=this.needAlphaBlendingForMesh(h)&&this.ih().useOrderIndependentTransparency;if((0,C.cb)(b,w,this.canRenderToMRT&&!q),(0,C.ab)(b,w,q),o.e.PrepareDefines(a.currentRenderPassId,h,w),w._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,w._needUVs=!1;for(let h=1;h<=6;++h)w["MAINUV"+h]=!1;if(b.texturesEnabled){if(w.DIFFUSEDIRECTUV=0,w.BUMPDIRECTUV=0,w.AMBIENTDIRECTUV=0,w.OPACITYDIRECTUV=0,w.EMISSIVEDIRECTUV=0,w.SPECULARDIRECTUV=0,w.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&g.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,C.T)(this._diffuseTexture,w,"DIFFUSE")}else w.DIFFUSE=!1;if(this._ambientTexture&&g.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,C.T)(this._ambientTexture,w,"AMBIENT")}else w.AMBIENT=!1;if(this._opacityTexture&&g.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,C.T)(this._opacityTexture,w,"OPACITY"),w.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else w.OPACITY=!1;if(this._reflectionTexture&&g.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(w._needNormals=!0,w.REFLECTION=!0,w.ROUGHNESS=this._roughness>0,w.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,w.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===R.e.INVCUBIC_MODE,w.REFLECTIONMAP_3D=this._reflectionTexture.isCube,w.REFLECTIONMAP_OPPOSITEZ=w.REFLECTIONMAP_3D&&this.ih().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,w.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case R.e.EXPLICIT_MODE:w.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case R.e.PLANAR_MODE:w.setReflectionMode("REFLECTIONMAP_PLANAR");break;case R.e.PROJECTION_MODE:w.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case R.e.SKYBOX_MODE:w.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case R.e.SPHERICAL_MODE:w.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case R.e.EQUIRECTANGULAR_MODE:w.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case R.e.FIXED_EQUIRECTANGULAR_MODE:w.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case R.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:w.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case R.e.CUBIC_MODE:case R.e.INVCUBIC_MODE:default:w.setReflectionMode("REFLECTIONMAP_CUBIC")}w.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else w.REFLECTION=!1,w.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&g.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,C.T)(this._emissiveTexture,w,"EMISSIVE")}else w.EMISSIVE=!1;if(this._lightmapTexture&&g.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,C.T)(this._lightmapTexture,w,"LIGHTMAP"),w.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,w.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else w.LIGHTMAP=!1;if(this._specularTexture&&g.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,C.T)(this._specularTexture,w,"SPECULAR"),w.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else w.SPECULAR=!1;if(b.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&g.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,C.T)(this._bumpTexture,w,"BUMP"),w.PARALLAX=this._useParallax,w.PARALLAX_RHS=b.useRightHandedSystem,w.PARALLAXOCCLUSION=this._useParallaxOcclusion,w.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else w.BUMP=!1,w.PARALLAX=!1,w.PARALLAX_RHS=!1,w.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&g.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;w._needUVs=!0,w.REFRACTION=!0,w.REFRACTIONMAP_3D=this._refractionTexture.isCube,w.RGBDREFRACTION=this._refractionTexture.isRGBD,w.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else w.REFRACTION=!1;w.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else w.DIFFUSE=!1,w.AMBIENT=!1,w.OPACITY=!1,w.REFLECTION=!1,w.EMISSIVE=!1,w.LIGHTMAP=!1,w.BUMP=!1,w.REFRACTION=!1;w.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),w.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,w.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,w.SPECULAROVERALPHA=this._useSpecularOverAlpha,w.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,w.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,w.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(h)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=w,this._eventInfo.subMesh=d,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(w._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(w),w.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,w.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(w._areFresnelDirty&&(g.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(w.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,w.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,w.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,w.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,w.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,w.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,w._needNormals=!0,w.FRESNEL=!0):w.FRESNEL=!1),w.AREALIGHTUSED)for(let m=0;m<h.lightSources.length;m++)if(!h.lightSources[m]._isReady())return!1;(0,C.X)(h,b,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(h),w,this._applyDecalMapAfterDetailMap),(0,C.M)(b,a,this,w,j,null,d.getRenderingMesh().hasThinInstances),this._eventInfo.defines=w,this._eventInfo.mesh=h,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,C.I)(h,w,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let E=!1;if(w.isDirty){const j=w._areLightsDisposed;w.markAsProcessed();const A=new B.e;w.REFLECTION&&A.addFallback(0,"REFLECTION"),w.SPECULAR&&A.addFallback(0,"SPECULAR"),w.BUMP&&A.addFallback(0,"BUMP"),w.PARALLAX&&A.addFallback(1,"PARALLAX"),w.PARALLAX_RHS&&A.addFallback(1,"PARALLAX_RHS"),w.PARALLAXOCCLUSION&&A.addFallback(0,"PARALLAXOCCLUSION"),w.SPECULAROVERALPHA&&A.addFallback(0,"SPECULAROVERALPHA"),w.FOG&&A.addFallback(1,"FOG"),w.POINTSIZE&&A.addFallback(0,"POINTSIZE"),w.LOGARITHMICDEPTH&&A.addFallback(0,"LOGARITHMICDEPTH"),(0,C.v)(w,A,this._maxSimultaneousLights),w.SPECULARTERM&&A.addFallback(0,"SPECULARTERM"),w.DIFFUSEFRESNEL&&A.addFallback(1,"DIFFUSEFRESNEL"),w.OPACITYFRESNEL&&A.addFallback(2,"OPACITYFRESNEL"),w.REFLECTIONFRESNEL&&A.addFallback(3,"REFLECTIONFRESNEL"),w.EMISSIVEFRESNEL&&A.addFallback(4,"EMISSIVEFRESNEL"),w.FRESNEL&&A.addFallback(4,"FRESNEL"),w.MULTIVIEW&&A.addFallback(0,"MULTIVIEW");const q=[D.d.PositionKind];w.NORMAL&&q.push(D.d.NormalKind),w.TANGENT&&q.push(D.d.TangentKind);for(let h=1;h<=6;++h)w["UV"+h]&&q.push(`uv${1===h?"":h}`);w.VERTEXCOLOR&&q.push(D.d.ColorKind),(0,C.z)(q,h,w,A),(0,C.A)(q,w),(0,C.D)(q,h,w),(0,C.y)(q,h,w);let I="default";const R=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],Z=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],L=["Material","Scene","Mesh"],V={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:w.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=A,this._eventInfo.fallbackRank=0,this._eventInfo.defines=w,this._eventInfo.uniforms=R,this._eventInfo.attributes=q,this._eventInfo.samplers=Z,this._eventInfo.uniformBuffersNames=L,this._eventInfo.customCode=void 0,this._eventInfo.mesh=h,this._eventInfo.indexParameters=V,this._callbackPluginEventGeneric(128,this._eventInfo),o.e.AddUniformsAndSamplers(R,Z),S.e.AddUniforms(R),S.e.AddSamplers(Z),M.d&&(M.d.PrepareUniforms(R,w),M.d.PrepareSamplers(Z,w)),(0,C.db)({uniformsNames:R,uniformBuffersNames:L,samplers:Z,defines:w,maxSimultaneousLights:this._maxSimultaneousLights}),(0,v.b)(R);const T={};this.customShaderNameResolve&&(I=this.customShaderNameResolve(I,R,L,Z,w,q,T));const i=w.toString(),g=d.effect;let F=b.getEngine().createEffect(I,{attributes:q,uniformsNames:R,uniformBuffersNames:L,samplers:Z,defines:i,fallbacks:A,onCompiled:this.onCompiled,onError:this.onError,indexParameters:V,processFinalCode:T.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:w.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([m.e(20),m.e(51)]).then(m.bind(m,13956)),Promise.all([m.e(18),m.e(52)]).then(m.bind(m,13962))]):await Promise.all([Promise.all([m.e(13),m.e(53)]).then(m.bind(m,13969)),Promise.all([m.e(12),m.e(54)]).then(m.bind(m,13977))]),this._shadersLoaded=!0}},a);if(this._eventInfo.customCode=void 0,F)if(this._onEffectCreatedObservable&&(y.effect=F,y.subMesh=d,this._onEffectCreatedObservable.notifyObservers(y)),this.allowShaderHotSwapping&&g&&!F.isReady()){if(F=g,w.markAsUnprocessed(),E=this.isFrozen,j)return w._areLightsDisposed=!0,!1}else b.resetCachedMaterial(),d.setEffect(F,w,this._materialContext)}return!(!d.effect||!d.effect.isReady())&&(w._renderId=b.getRenderId(),A._wasPreviouslyReady=!E,A._wasPreviouslyUsingInstances=j,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const h=this._uniformBuffer;h.addUniform("diffuseLeftColor",4),h.addUniform("diffuseRightColor",4),h.addUniform("opacityParts",4),h.addUniform("reflectionLeftColor",4),h.addUniform("reflectionRightColor",4),h.addUniform("refractionLeftColor",4),h.addUniform("refractionRightColor",4),h.addUniform("emissiveLeftColor",4),h.addUniform("emissiveRightColor",4),h.addUniform("vDiffuseInfos",2),h.addUniform("vAmbientInfos",2),h.addUniform("vOpacityInfos",2),h.addUniform("vReflectionInfos",2),h.addUniform("vReflectionPosition",3),h.addUniform("vReflectionSize",3),h.addUniform("vEmissiveInfos",2),h.addUniform("vLightmapInfos",2),h.addUniform("vSpecularInfos",2),h.addUniform("vBumpInfos",3),h.addUniform("diffuseMatrix",16),h.addUniform("ambientMatrix",16),h.addUniform("opacityMatrix",16),h.addUniform("reflectionMatrix",16),h.addUniform("emissiveMatrix",16),h.addUniform("lightmapMatrix",16),h.addUniform("specularMatrix",16),h.addUniform("bumpMatrix",16),h.addUniform("vTangentSpaceParams",2),h.addUniform("pointSize",1),h.addUniform("alphaCutOff",1),h.addUniform("refractionMatrix",16),h.addUniform("vRefractionInfos",4),h.addUniform("vRefractionPosition",3),h.addUniform("vRefractionSize",3),h.addUniform("vSpecularColor",4),h.addUniform("vEmissiveColor",3),h.addUniform("vDiffuseColor",4),h.addUniform("vAmbientColor",3),h.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(h,d,m){const j=this.ih(),A=m.materialDefines;if(!A)return;const b=m.effect;if(!b)return;this._activeEffect=b,d.getMeshUniformBuffer().bindToEffect(b,"Mesh"),d.transferToEffect(h),this._uniformBuffer.bindToEffect(b,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,j,d,h,this.isFrozen),o.e.Bind(j.getEngine().currentRenderPassId,this._activeEffect,d,h,this);const D=j.activeCamera;D?this._uniformBuffer.updateFloat4("cameraInfo",D.jb,D.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=m,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),A.OBJECTSPACE_NORMALMAP&&(h.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const S=this._mustRebind(j,b,m,d.visibility);(0,C.c)(d,b);const M=this._uniformBuffer;if(S){if(this.bindViewProjection(b),!M.useUbo||!this.isFrozen||!M.isSync||m._drawWrapper._forceRebindOnNextCall){if(g.FresnelEnabled&&A.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(M.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),M.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&M.updateColor4("opacityParts",new a.d(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(M.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),M.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(M.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),M.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(M.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),M.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),j.texturesEnabled){if(this._diffuseTexture&&g.DiffuseTextureEnabled&&(M.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,C.t)(this._diffuseTexture,M,"diffuse")),this._ambientTexture&&g.AmbientTextureEnabled&&(M.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,C.t)(this._ambientTexture,M,"ambient")),this._opacityTexture&&g.OpacityTextureEnabled&&(M.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,C.t)(this._opacityTexture,M,"opacity")),this._hasAlphaChannel()&&M.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&g.ReflectionTextureEnabled){if(M.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),M.hb("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const h=this._reflectionTexture;M.updateVector3("vReflectionPosition",h.boundingBoxPosition),M.updateVector3("vReflectionSize",h.boundingBoxSize)}}else M.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&g.EmissiveTextureEnabled&&(M.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,C.t)(this._emissiveTexture,M,"emissive")),this._lightmapTexture&&g.LightmapTextureEnabled&&(M.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,C.t)(this._lightmapTexture,M,"lightmap")),this._specularTexture&&g.SpecularTextureEnabled&&(M.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,C.t)(this._specularTexture,M,"specular")),this._bumpTexture&&j.getEngine().getCaps().standardDerivatives&&g.BumpTextureEnabled&&(M.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,C.t)(this._bumpTexture,M,"bump"),j._mirroredCameraPosition?M.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):M.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&g.RefractionTextureEnabled){let h=1;if(this._refractionTexture.isCube||(M.hb("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(h=this._refractionTexture.depth)),M.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,h,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const h=this._refractionTexture;M.updateVector3("vRefractionPosition",h.boundingBoxPosition),M.updateVector3("vRefractionSize",h.boundingBoxSize)}}}this.pointsCloud&&M.updateFloat("pointSize",this.pointSize),M.updateColor4("vSpecularColor",this.specularColor,this.specularPower),M.updateColor3("vEmissiveColor",g.EmissiveTextureEnabled?this.emissiveColor:a.d.BlackReadOnly),M.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),j.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),M.updateColor3("vAmbientColor",this._globalAmbientColor)}j.texturesEnabled&&(this._diffuseTexture&&g.DiffuseTextureEnabled&&b.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&g.AmbientTextureEnabled&&b.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&g.OpacityTextureEnabled&&b.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&g.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?b.setTexture("reflectionCubeSampler",this._reflectionTexture):b.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&g.EmissiveTextureEnabled&&b.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&g.LightmapTextureEnabled&&b.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&g.SpecularTextureEnabled&&b.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&j.getEngine().getCaps().standardDerivatives&&g.BumpTextureEnabled&&b.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&g.RefractionTextureEnabled&&(this._refractionTexture.isCube?b.setTexture("refractionCubeSampler",this._refractionTexture):b.setTexture("refraction2DSampler",this._refractionTexture))),this.ih().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(d)&&this.ih().depthPeelingRenderer.bind(b),this._eventInfo.subMesh=m,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,v.f)(b,this,j),this.bindEyePosition(b)}else j.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(S||!this.isFrozen){var q;if(j.lightsEnabled&&!this._disableLighting&&(0,C.j)(j,d,b,A,this._maxSimultaneousLights),(j.fogEnabled&&d.applyFog&&j.fogMode!==w.c.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||d.receiveShadows||A.PREPASS)&&this.bindView(b),(0,C.g)(j,d,b),A.NUM_MORPH_INFLUENCERS&&(0,C.o)(d,b),A.BAKED_VERTEX_ANIMATION_TEXTURE)null===(q=d.bakedVertexAnimationManager)||void 0===q||q.bind(b,A.INSTANCES);this.useLogarithmicDepth&&(0,C.l)(A,b,j),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(d,this._activeEffect,m),M.update()}getAnimatables(){const h=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&h.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&h.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&h.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&h.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&h.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&h.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&h.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&h.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&h.push(this._refractionTexture),h}getActiveTextures(){const h=super.getActiveTextures();return this._diffuseTexture&&h.push(this._diffuseTexture),this._ambientTexture&&h.push(this._ambientTexture),this._opacityTexture&&h.push(this._opacityTexture),this._reflectionTexture&&h.push(this._reflectionTexture),this._emissiveTexture&&h.push(this._emissiveTexture),this._specularTexture&&h.push(this._specularTexture),this._bumpTexture&&h.push(this._bumpTexture),this._lightmapTexture&&h.push(this._lightmapTexture),this._refractionTexture&&h.push(this._refractionTexture),h}hasTexture(h){return!!super.hasTexture(h)||(this._diffuseTexture===h||(this._ambientTexture===h||(this._opacityTexture===h||(this._reflectionTexture===h||(this._emissiveTexture===h||(this._specularTexture===h||(this._bumpTexture===h||(this._lightmapTexture===h||this._refractionTexture===h))))))))}dispose(h,d){var m,j,A,b,w,a,D,S,M;d&&(null===(m=this._diffuseTexture)||void 0===m||m.dispose(),null===(j=this._ambientTexture)||void 0===j||j.dispose(),null===(A=this._opacityTexture)||void 0===A||A.dispose(),null===(b=this._reflectionTexture)||void 0===b||b.dispose(),null===(w=this._emissiveTexture)||void 0===w||w.dispose(),null===(a=this._specularTexture)||void 0===a||a.dispose(),null===(D=this._bumpTexture)||void 0===D||D.dispose(),null===(S=this._lightmapTexture)||void 0===S||S.dispose(),null===(M=this._refractionTexture)||void 0===M||M.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(h,d)}clone(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const j=T.d.Clone((()=>new g(h,this.ih())),this,{cloneTexturesOnlyOnce:d});return j.name=h,j.id=h,this.stencil.copyTo(j.stencil),this._clonePlugins(j,m),j}static Parse(h,d,m){const j=T.d.Parse((()=>new g(h.name,d)),h,d,m);return h.stencil&&j.stencil.parse(h.stencil,d,m),q.d._ParsePlugins(h,j,d,m),j}static get DiffuseTextureEnabled(){return L.e.DiffuseTextureEnabled}static set DiffuseTextureEnabled(h){L.e.DiffuseTextureEnabled=h}static get DetailTextureEnabled(){return L.e.DetailTextureEnabled}static set DetailTextureEnabled(h){L.e.DetailTextureEnabled=h}static get AmbientTextureEnabled(){return L.e.AmbientTextureEnabled}static set AmbientTextureEnabled(h){L.e.AmbientTextureEnabled=h}static get OpacityTextureEnabled(){return L.e.OpacityTextureEnabled}static set OpacityTextureEnabled(h){L.e.OpacityTextureEnabled=h}static get ReflectionTextureEnabled(){return L.e.ReflectionTextureEnabled}static set ReflectionTextureEnabled(h){L.e.ReflectionTextureEnabled=h}static get EmissiveTextureEnabled(){return L.e.EmissiveTextureEnabled}static set EmissiveTextureEnabled(h){L.e.EmissiveTextureEnabled=h}static get SpecularTextureEnabled(){return L.e.SpecularTextureEnabled}static set SpecularTextureEnabled(h){L.e.SpecularTextureEnabled=h}static get BumpTextureEnabled(){return L.e.BumpTextureEnabled}static set BumpTextureEnabled(h){L.e.BumpTextureEnabled=h}static get LightmapTextureEnabled(){return L.e.LightmapTextureEnabled}static set LightmapTextureEnabled(h){L.e.LightmapTextureEnabled=h}static get RefractionTextureEnabled(){return L.e.RefractionTextureEnabled}static set RefractionTextureEnabled(h){L.e.RefractionTextureEnabled=h}static get ColorGradingTextureEnabled(){return L.e.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(h){L.e.ColorGradingTextureEnabled=h}static get FresnelEnabled(){return L.e.FresnelEnabled}static set FresnelEnabled(h){L.e.FresnelEnabled=h}}g.ForceGLSL=!1,(0,j.d)([(0,A.D)("diffuseTexture")],g.prototype,"_diffuseTexture",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],g.prototype,"diffuseTexture",void 0),(0,j.d)([(0,A.D)("ambientTexture")],g.prototype,"_ambientTexture",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"ambientTexture",void 0),(0,j.d)([(0,A.D)("opacityTexture")],g.prototype,"_opacityTexture",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],g.prototype,"opacityTexture",void 0),(0,j.d)([(0,A.D)("reflectionTexture")],g.prototype,"_reflectionTexture",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"reflectionTexture",void 0),(0,j.d)([(0,A.D)("emissiveTexture")],g.prototype,"_emissiveTexture",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"emissiveTexture",void 0),(0,j.d)([(0,A.D)("specularTexture")],g.prototype,"_specularTexture",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"specularTexture",void 0),(0,j.d)([(0,A.D)("bumpTexture")],g.prototype,"_bumpTexture",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"bumpTexture",void 0),(0,j.d)([(0,A.D)("lightmapTexture")],g.prototype,"_lightmapTexture",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"lightmapTexture",void 0),(0,j.d)([(0,A.D)("refractionTexture")],g.prototype,"_refractionTexture",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"refractionTexture",void 0),(0,j.d)([(0,A.j)("ambient")],g.prototype,"ambientColor",void 0),(0,j.d)([(0,A.j)("diffuse")],g.prototype,"diffuseColor",void 0),(0,j.d)([(0,A.j)("specular")],g.prototype,"specularColor",void 0),(0,j.d)([(0,A.j)("emissive")],g.prototype,"emissiveColor",void 0),(0,j.d)([(0,A.M)()],g.prototype,"specularPower",void 0),(0,j.d)([(0,A.M)("useAlphaFromDiffuseTexture")],g.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],g.prototype,"useAlphaFromDiffuseTexture",void 0),(0,j.d)([(0,A.M)("useEmissiveAsIllumination")],g.prototype,"_useEmissiveAsIllumination",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useEmissiveAsIllumination",void 0),(0,j.d)([(0,A.M)("linkEmissiveWithDiffuse")],g.prototype,"_linkEmissiveWithDiffuse",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"linkEmissiveWithDiffuse",void 0),(0,j.d)([(0,A.M)("useSpecularOverAlpha")],g.prototype,"_useSpecularOverAlpha",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useSpecularOverAlpha",void 0),(0,j.d)([(0,A.M)("useReflectionOverAlpha")],g.prototype,"_useReflectionOverAlpha",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useReflectionOverAlpha",void 0),(0,j.d)([(0,A.M)("disableLighting")],g.prototype,"_disableLighting",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsLightsDirty")],g.prototype,"disableLighting",void 0),(0,j.d)([(0,A.M)("useObjectSpaceNormalMap")],g.prototype,"_useObjectSpaceNormalMap",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useObjectSpaceNormalMap",void 0),(0,j.d)([(0,A.M)("useParallax")],g.prototype,"_useParallax",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useParallax",void 0),(0,j.d)([(0,A.M)("useParallaxOcclusion")],g.prototype,"_useParallaxOcclusion",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useParallaxOcclusion",void 0),(0,j.d)([(0,A.M)()],g.prototype,"parallaxScaleBias",void 0),(0,j.d)([(0,A.M)("roughness")],g.prototype,"_roughness",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"roughness",void 0),(0,j.d)([(0,A.M)()],g.prototype,"indexOfRefraction",void 0),(0,j.d)([(0,A.M)()],g.prototype,"invertRefractionY",void 0),(0,j.d)([(0,A.M)()],g.prototype,"alphaCutOff",void 0),(0,j.d)([(0,A.M)("useLightmapAsShadowmap")],g.prototype,"_useLightmapAsShadowmap",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useLightmapAsShadowmap",void 0),(0,j.d)([(0,A.p)("diffuseFresnelParameters")],g.prototype,"_diffuseFresnelParameters",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsFresnelDirty")],g.prototype,"diffuseFresnelParameters",void 0),(0,j.d)([(0,A.p)("opacityFresnelParameters")],g.prototype,"_opacityFresnelParameters",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],g.prototype,"opacityFresnelParameters",void 0),(0,j.d)([(0,A.p)("reflectionFresnelParameters")],g.prototype,"_reflectionFresnelParameters",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsFresnelDirty")],g.prototype,"reflectionFresnelParameters",void 0),(0,j.d)([(0,A.p)("refractionFresnelParameters")],g.prototype,"_refractionFresnelParameters",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsFresnelDirty")],g.prototype,"refractionFresnelParameters",void 0),(0,j.d)([(0,A.p)("emissiveFresnelParameters")],g.prototype,"_emissiveFresnelParameters",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsFresnelDirty")],g.prototype,"emissiveFresnelParameters",void 0),(0,j.d)([(0,A.M)("useReflectionFresnelFromSpecular")],g.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsFresnelDirty")],g.prototype,"useReflectionFresnelFromSpecular",void 0),(0,j.d)([(0,A.M)("useGlossinessFromSpecularMapAlpha")],g.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,j.d)([(0,A.M)("maxSimultaneousLights")],g.prototype,"_maxSimultaneousLights",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsLightsDirty")],g.prototype,"maxSimultaneousLights",void 0),(0,j.d)([(0,A.M)("invertNormalMapX")],g.prototype,"_invertNormalMapX",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"invertNormalMapX",void 0),(0,j.d)([(0,A.M)("invertNormalMapY")],g.prototype,"_invertNormalMapY",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"invertNormalMapY",void 0),(0,j.d)([(0,A.M)("twoSidedLighting")],g.prototype,"_twoSidedLighting",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsTexturesDirty")],g.prototype,"twoSidedLighting",void 0),(0,j.d)([(0,A.M)("applyDecalMapAfterDetailMap")],g.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,j.d)([(0,A.b)("_markAllSubMeshesAsMiscDirty")],g.prototype,"applyDecalMapAfterDetailMap",void 0),(0,Z.i)("BABYLON.StandardMaterial",g),w.c.DefaultMaterialFactory=h=>new g("default material",h)},11335:(h,d,m)=>{m.d(d,{d:()=>b});var j=m(11121),A=m(11107);class b{constructor(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=h,this._noUBO=!h.supportsUniformBuffers||A,this._dynamic=m,this._name=j??"no-name",this._data=d||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.hb=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.hb=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(h){let d;if(d=h<=2?h:4,this._uniformLocationPointer%d!==0){const h=this._uniformLocationPointer;this._uniformLocationPointer+=d-this._uniformLocationPointer%d;const m=this._uniformLocationPointer-h;for(let d=0;d<m;d++)this._data.push(0)}}addUniform(h,d){let m,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[h]){if(j>0){if(d instanceof Array)throw"addUniform should not be use with Array in UBO: "+h;if(this._fillAlignment(4),this._uniformArraySizes[h]={strideSize:d,arraySize:j},16==d)d*=j;else{d=d*j+(4-d)*j}m=[];for(let h=0;h<d;h++)m.push(0)}else{if(d instanceof Array)m=d,d=m.length;else{m=[];for(let h=0;h<d;h++)m.push(0)}this._fillAlignment(d)}this._uniformSizes[h]=d,this._uniformLocations[h]=this._uniformLocationPointer,this._uniformLocationPointer+=d;for(let h=0;h<d;h++)this._data.push(m[h]);this._needSync=!0}}addMatrix(h,d){this.addUniform(h,Array.prototype.slice.call(d.fd()))}addFloat2(h,d,m){const j=[d,m];this.addUniform(h,j)}addFloat3(h,d,m,j){const A=[d,m,j];this.addUniform(h,A)}addColor3(h,d){const m=[d.r,d.g,d.b];this.addUniform(h,m)}addColor4(h,d,m){const j=[d.r,d.g,d.b,m];this.addUniform(h,j)}addVector3(h,d){const m=[d.x,d.y,d.z];this.addUniform(h,m)}addMatrix3x3(h){this.addUniform(h,12)}addMatrix2x2(h){this.addUniform(h,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const h=[];let d=0;for(const m in this._uniformLocations)if(h.push(m),10===++d)break;return h.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(h,d){for(let m=0;m<h.length;++m)if(h[m]!==d[m])return!1;return!0}_copyBuffer(h,d){for(let m=0;m<h.length;++m)d[m]=h[m]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(b._UpdatedUbosInFrame[this._name]||(b._UpdatedUbosInFrame[this._name]=0),b._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(h,d,m){this._checkNewFrame();let A=this._uniformLocations[h];if(void 0===A){if(this._buffer)return void j.c.Error("Cannot add an uniform after UBO has been created. uniformName="+h);this.addUniform(h,m),A=this._uniformLocations[h]}if(this._buffer||this.create(),this._dynamic)for(let j=0;j<m;j++)this._bufferData[A+j]=d[j];else{let h=!1;for(let j=0;j<m;j++)(16===m&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[A+j]!==Math.fround(d[j]))&&(h=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[A+j]=d[j]);this._needSync=this._needSync||h}}updateUniformArray(h,d,m){this._checkNewFrame();const b=this._uniformLocations[h];if(void 0===b)return void j.c.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const w=this._uniformArraySizes[h];if(this._dynamic)for(let j=0;j<m;j++)this._bufferData[b+j]=d[j];else{let h=!1,j=0,a=0;for(let D=0;D<m;D++)if(this._bufferData[b+4*a+j]!==A.e.FloatRound(d[D])&&(h=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[b+4*a+j]=d[D]),j++,j===w.strideSize){for(;j<4;j++)this._bufferData[b+4*a+j]=0;j=0,a++}this._needSync=this._needSync||h}}_cacheMatrix(h,d){this._checkNewFrame();const m=this._valueCache[h],j=d.updateFlag;return(void 0===m||m!==j)&&(this._valueCache[h]=j,!0)}_updateMatrix3x3ForUniform(h,d){for(let m=0;m<3;m++)b._TempBuffer[4*m]=d[3*m],b._TempBuffer[4*m+1]=d[3*m+1],b._TempBuffer[4*m+2]=d[3*m+2],b._TempBuffer[4*m+3]=0;this.updateUniform(h,b._TempBuffer,12)}_updateMatrix3x3ForEffect(h,d){this._currentEffect.setMatrix3x3(h,d)}_updateMatrix2x2ForEffect(h,d){this._currentEffect.setMatrix2x2(h,d)}_updateMatrix2x2ForUniform(h,d){for(let m=0;m<2;m++)b._TempBuffer[4*m]=d[2*m],b._TempBuffer[4*m+1]=d[2*m+1],b._TempBuffer[4*m+2]=0,b._TempBuffer[4*m+3]=0;this.updateUniform(h,b._TempBuffer,8)}_updateFloatForEffect(h,d){this._currentEffect.setFloat(h,d)}_updateFloatForUniform(h,d){b._TempBuffer[0]=d,this.updateUniform(h,b._TempBuffer,1)}_updateFloat2ForEffect(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(h+j,d,m)}_updateFloat2ForUniform(h,d,m){b._TempBuffer[0]=d,b._TempBuffer[1]=m,this.updateUniform(h,b._TempBuffer,2)}_updateFloat3ForEffect(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(h+A,d,m,j)}_updateFloat3ForUniform(h,d,m,j){b._TempBuffer[0]=d,b._TempBuffer[1]=m,b._TempBuffer[2]=j,this.updateUniform(h,b._TempBuffer,3)}_updateFloat4ForEffect(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(h+b,d,m,j,A)}_updateFloat4ForUniform(h,d,m,j,A){b._TempBuffer[0]=d,b._TempBuffer[1]=m,b._TempBuffer[2]=j,b._TempBuffer[3]=A,this.updateUniform(h,b._TempBuffer,4)}_updateFloatArrayForEffect(h,d){this._currentEffect.setFloatArray(h,d)}_updateFloatArrayForUniform(h,d){this.updateUniformArray(h,d,d.length)}_updateArrayForEffect(h,d){this._currentEffect.setArray(h,d)}_updateArrayForUniform(h,d){this.updateUniformArray(h,d,d.length)}_updateIntArrayForEffect(h,d){this._currentEffect.setIntArray(h,d)}_updateIntArrayForUniform(h,d){b._TempBufferInt32View.set(d),this.updateUniformArray(h,b._TempBuffer,d.length)}_updateUIntArrayForEffect(h,d){this._currentEffect.setUIntArray(h,d)}_updateUIntArrayForUniform(h,d){b._TempBufferUInt32View.set(d),this.updateUniformArray(h,b._TempBuffer,d.length)}_updateMatrixForEffect(h,d){this._currentEffect.setMatrix(h,d)}_updateMatrixForUniform(h,d){this._cacheMatrix(h,d)&&this.updateUniform(h,d.fd(),16)}_updateMatricesForEffect(h,d){this._currentEffect.setMatrices(h,d)}_updateMatricesForUniform(h,d){this.updateUniform(h,d,d.length)}_updateVector3ForEffect(h,d){this._currentEffect.setVector3(h,d)}_updateVector3ForUniform(h,d){b._TempBuffer[0]=d.x,b._TempBuffer[1]=d.y,b._TempBuffer[2]=d.z,this.updateUniform(h,b._TempBuffer,3)}_updateVector4ForEffect(h,d){this._currentEffect.setVector4(h,d)}_updateVector4ForUniform(h,d){b._TempBuffer[0]=d.x,b._TempBuffer[1]=d.y,b._TempBuffer[2]=d.z,b._TempBuffer[3]=d.w,this.updateUniform(h,b._TempBuffer,4)}_updateColor3ForEffect(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(h+m,d)}_updateColor3ForUniform(h,d){b._TempBuffer[0]=d.r,b._TempBuffer[1]=d.g,b._TempBuffer[2]=d.b,this.updateUniform(h,b._TempBuffer,3)}_updateColor4ForEffect(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(h+j,d,m)}_updateDirectColor4ForEffect(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(h+m,d)}_updateColor4ForUniform(h,d,m){b._TempBuffer[0]=d.r,b._TempBuffer[1]=d.g,b._TempBuffer[2]=d.b,b._TempBuffer[3]=m,this.updateUniform(h,b._TempBuffer,4)}_updateDirectColor4ForUniform(h,d){b._TempBuffer[0]=d.r,b._TempBuffer[1]=d.g,b._TempBuffer[2]=d.b,b._TempBuffer[3]=d.a,this.updateUniform(h,b._TempBuffer,4)}_updateIntForEffect(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(h+m,d)}_updateIntForUniform(h,d){b._TempBufferInt32View[0]=d,this.updateUniform(h,b._TempBuffer,1)}_updateInt2ForEffect(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(h+j,d,m)}_updateInt2ForUniform(h,d,m){b._TempBufferInt32View[0]=d,b._TempBufferInt32View[1]=m,this.updateUniform(h,b._TempBuffer,2)}_updateInt3ForEffect(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(h+A,d,m,j)}_updateInt3ForUniform(h,d,m,j){b._TempBufferInt32View[0]=d,b._TempBufferInt32View[1]=m,b._TempBufferInt32View[2]=j,this.updateUniform(h,b._TempBuffer,3)}_updateInt4ForEffect(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(h+b,d,m,j,A)}_updateInt4ForUniform(h,d,m,j,A){b._TempBufferInt32View[0]=d,b._TempBufferInt32View[1]=m,b._TempBufferInt32View[2]=j,b._TempBufferInt32View[3]=A,this.updateUniform(h,b._TempBuffer,4)}_updateUIntForEffect(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(h+m,d)}_updateUIntForUniform(h,d){b._TempBufferUInt32View[0]=d,this.updateUniform(h,b._TempBuffer,1)}_updateUInt2ForEffect(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(h+j,d,m)}_updateUInt2ForUniform(h,d,m){b._TempBufferUInt32View[0]=d,b._TempBufferUInt32View[1]=m,this.updateUniform(h,b._TempBuffer,2)}_updateUInt3ForEffect(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(h+A,d,m,j)}_updateUInt3ForUniform(h,d,m,j){b._TempBufferUInt32View[0]=d,b._TempBufferUInt32View[1]=m,b._TempBufferUInt32View[2]=j,this.updateUniform(h,b._TempBuffer,3)}_updateUInt4ForEffect(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(h+b,d,m,j,A)}_updateUInt4ForUniform(h,d,m,j,A){b._TempBufferUInt32View[0]=d,b._TempBufferUInt32View[1]=m,b._TempBufferUInt32View[2]=j,b._TempBufferUInt32View[3]=A,this.updateUniform(h,b._TempBuffer,4)}setTexture(h,d){this._currentEffect.setTexture(h,d)}setTextureArray(h,d){this._currentEffect.setTextureArray(h,d)}bindTexture(h,d){this._currentEffect._bindTexture(h,d)}updateUniformDirectly(h,d){this.updateUniform(h,d,d.length),this.update()}bindToEffect(h,d){this._currentEffect=h,this._currentEffectName=d}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(h){if(!this._buffers)return this._buffer===h;for(let d=0;d<this._buffers.length;++d){if(this._buffers[d][0]===h)return this._bufferIndex=d,this._buffer=h,this._createBufferOnWrite=!1,this._currentEffect=void 0,this._buffers.length>1&&this._buffers[d][1]&&this._bufferData.set(this._buffers[d][1]),this._valueCache={},this._currentFrameId=this._engine.frameId,!0}return!1}dispose(){if(this._noUBO)return;const h=this._engine._uniformBuffers,d=h.indexOf(this);if(-1!==d&&(h[d]=h[h.length-1],h.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let m=0;m<this._buffers.length;++m){const h=this._buffers[m][0];this._engine._releaseBuffer(h)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}b._UpdatedUbosInFrame={},b._MAX_UNIFORM_SIZE=256,b._TempBuffer=new Float32Array(b._MAX_UNIFORM_SIZE),b._TempBufferInt32View=new Int32Array(b._TempBuffer.buffer),b._TempBufferUInt32View=new Uint32Array(b._TempBuffer.buffer)},11407:(h,d,m)=>{m.d(d,{e:()=>w,h:()=>j});var j,A,b=m(11058);!function(h){h[h.LOCAL=0]="LOCAL",h[h.WORLD=1]="WORLD",h[h.BONE=2]="BONE"}(j||(j={}));class w{}w.X=new b.i(1,0,0),w.Y=new b.i(0,1,0),w.Z=new b.i(0,0,1),function(h){h[h.X=0]="X",h[h.Y=1]="Y",h[h.Z=2]="Z"}(A||(A={}))},11353:(h,d,m)=>{m.d(d,{d:()=>q,f:()=>E,g:()=>I});var j=m(11073),A=m(11080),b=m(11065),w=m(11099);function a(h){return Math.pow(h,b.j)}function D(h){return h<=.04045?.0773993808*h:Math.pow(.947867299*(h+.055),2.4)}function S(h){return Math.pow(h,b.g)}function M(h){return h<=.0031308?12.92*h:1.055*Math.pow(h,.41666)-.055}class q{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=h,this.g=d,this.b=m}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"qb"}getHashCode(){let h=255*this.r|0;return h=397*h^255*this.g,h=397*h^255*this.b,h}toArray(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return h[d]=this.r,h[d+1]=this.g,h[d+2]=this.b,this}Hm(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q.FromArrayToRef(h,d,this),this}toColor4(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new E(this.r,this.g,this.b,h)}fd(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(h){return new q(this.r*h.r,this.g*h.g,this.b*h.b)}multiplyToRef(h,d){return d.r=this.r*h.r,d.g=this.g*h.g,d.b=this.b*h.b,d}multiplyInPlace(h){return this.r*=h.r,this.g*=h.g,this.b*=h.b,this}multiplyByFloats(h,d,m){return new q(this.r*h,this.g*d,this.b*m)}divide(h){throw new ReferenceError("Can not divide a color")}divideToRef(h,d){throw new ReferenceError("Can not divide a color")}divideInPlace(h){throw new ReferenceError("Can not divide a color")}minimizeInPlace(h){return this.minimizeInPlaceFromFloats(h.r,h.g,h.b)}maximizeInPlace(h){return this.maximizeInPlaceFromFloats(h.r,h.g,h.b)}minimizeInPlaceFromFloats(h,d,m){return this.r=Math.min(h,this.r),this.g=Math.min(d,this.g),this.b=Math.min(m,this.b),this}maximizeInPlaceFromFloats(h,d,m){return this.r=Math.max(h,this.r),this.g=Math.max(d,this.g),this.b=Math.max(m,this.b),this}floorToRef(h){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(h){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(h){return h&&this.r===h.r&&this.g===h.g&&this.b===h.b}equalsFloats(h,d,m){return this.equalsToFloats(h,d,m)}equalsToFloats(h,d,m){return this.r===h&&this.g===d&&this.b===m}equalsWithEpsilon(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.c;return(0,w.WithinEpsilon)(this.r,h.r,d)&&(0,w.WithinEpsilon)(this.g,h.g,d)&&(0,w.WithinEpsilon)(this.b,h.b,d)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(h){throw new ReferenceError("Can not negate a color")}scale(h){return new q(this.r*h,this.g*h,this.b*h)}scaleInPlace(h){return this.r*=h,this.g*=h,this.b*=h,this}scaleToRef(h,d){return d.r=this.r*h,d.g=this.g*h,d.b=this.b*h,d}scaleAndAddToRef(h,d){return d.r+=this.r*h,d.g+=this.g*h,d.b+=this.b*h,d}clampToRef(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2?arguments[2]:void 0;return m.r=(0,w.Clamp)(this.r,h,d),m.g=(0,w.Clamp)(this.g,h,d),m.b=(0,w.Clamp)(this.b,h,d),m}add(h){return new q(this.r+h.r,this.g+h.g,this.b+h.b)}addInPlace(h){return this.r+=h.r,this.g+=h.g,this.b+=h.b,this}addInPlaceFromFloats(h,d,m){return this.r+=h,this.g+=d,this.b+=m,this}addToRef(h,d){return d.r=this.r+h.r,d.g=this.g+h.g,d.b=this.b+h.b,d}fm(h){return new q(this.r-h.r,this.g-h.g,this.b-h.b)}subtractToRef(h,d){return d.r=this.r-h.r,d.g=this.g-h.g,d.b=this.b-h.b,d}Dq(h){return this.r-=h.r,this.g-=h.g,this.b-=h.b,this}subtractFromFloats(h,d,m){return new q(this.r-h,this.g-d,this.b-m)}subtractFromFloatsToRef(h,d,m,j){return j.r=this.r-h,j.g=this.g-d,j.b=this.b-m,j}clone(){return new q(this.r,this.g,this.b)}D(h){return this.r=h.r,this.g=h.g,this.b=h.b,this}xd(h,d,m){return this.r=h,this.g=d,this.b=m,this}set(h,d,m){return this.xd(h,d,m)}sd(h){return this.r=this.g=this.b=h,this}toHexString(){const h=Math.round(255*this.r),d=Math.round(255*this.g),m=Math.round(255*this.b);return"#"+(0,w.ToHex)(h)+(0,w.ToHex)(d)+(0,w.ToHex)(m)}fromHexString(h){return"#"!==h.substring(0,1)||7!==h.length||(this.r=parseInt(h.substring(1,3),16)/255,this.g=parseInt(h.substring(3,5),16)/255,this.b=parseInt(h.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new q)}toHSVToRef(h){const d=this.r,m=this.g,j=this.b,A=Math.max(d,m,j),b=Math.min(d,m,j);let w=0,a=0;const D=A,S=A-b;return 0!==A&&(a=S/A),A!=b&&(A==d?(w=(m-j)/S,m<j&&(w+=6)):A==m?w=(j-d)/S+2:A==j&&(w=(d-m)/S+4),w*=60),h.r=w,h.g=a,h.b=D,h}toLinearSpace(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=new q;return this.toLinearSpaceToRef(d,h),d}toLinearSpaceToRef(h){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(h.r=D(this.r),h.g=D(this.g),h.b=D(this.b)):(h.r=a(this.r),h.g=a(this.g),h.b=a(this.b)),this}toGammaSpace(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=new q;return this.toGammaSpaceToRef(d,h),d}toGammaSpaceToRef(h){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(h.r=M(this.r),h.g=M(this.g),h.b=M(this.b)):(h.r=S(this.r),h.g=S(this.g),h.b=S(this.b)),this}static HSVtoRGBToRef(h,d,m,j){const A=m*d,b=h/60,w=A*(1-Math.abs(b%2-1));let a=0,D=0,S=0;b>=0&&b<=1?(a=A,D=w):b>=1&&b<=2?(a=w,D=A):b>=2&&b<=3?(D=A,S=w):b>=3&&b<=4?(D=w,S=A):b>=4&&b<=5?(a=w,S=A):b>=5&&b<=6&&(a=A,S=w);const M=m-A;return j.r=a+M,j.g=D+M,j.b=S+M,j}static FromHSV(h,d,m){const j=new q(0,0,0);return q.HSVtoRGBToRef(h,d,m,j),j}static FromHexString(h){return new q(0,0,0).fromHexString(h)}static Ud(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new q(h[d],h[d+1],h[d+2])}static FromArrayToRef(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;m.r=h[d],m.g=h[d+1],m.b=h[d+2]}static FromInts(h,d,m){return new q(h/255,d/255,m/255)}static Lerp(h,d,m){const j=new q(0,0,0);return q.LerpToRef(h,d,m,j),j}static LerpToRef(h,d,m,j){j.r=h.r+(d.r-h.r)*m,j.g=h.g+(d.g-h.g)*m,j.b=h.b+(d.b-h.b)*m}static Hermite(h,d,m,j,A){const b=A*A,w=A*b,a=2*w-3*b+1,D=-2*w+3*b,S=w-2*b+A,M=w-b,E=h.r*a+m.r*D+d.r*S+j.r*M,I=h.g*a+m.g*D+d.g*S+j.g*M,R=h.b*a+m.b*D+d.b*S+j.b*M;return new q(E,I,R)}static Hermite1stDerivative(h,d,m,j,A){const b=q.Black();return this.Hermite1stDerivativeToRef(h,d,m,j,A,b),b}static Hermite1stDerivativeToRef(h,d,m,j,A,b){const w=A*A;b.r=6*(w-A)*h.r+(3*w-4*A+1)*d.r+6*(-w+A)*m.r+(3*w-2*A)*j.r,b.g=6*(w-A)*h.g+(3*w-4*A+1)*d.g+6*(-w+A)*m.g+(3*w-2*A)*j.g,b.b=6*(w-A)*h.b+(3*w-4*A+1)*d.b+6*(-w+A)*m.b+(3*w-2*A)*j.b}static Red(){return new q(1,0,0)}static Green(){return new q(0,1,0)}static Blue(){return new q(0,0,1)}static Black(){return new q(0,0,0)}static get BlackReadOnly(){return q._BlackReadOnly}static White(){return new q(1,1,1)}static Purple(){return new q(.5,0,.5)}static Magenta(){return new q(1,0,1)}static Yellow(){return new q(1,1,0)}static Gray(){return new q(.5,.5,.5)}static Teal(){return new q(0,1,1)}static Random(){return new q(Math.random(),Math.random(),Math.random())}}q._V8PerformanceHack=new q(.5,.5,.5),q._BlackReadOnly=q.Black(),Object.defineProperties(q.prototype,{dimension:{value:[3]},rank:{value:1}});class E{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=h,this.g=d,this.b=m,this.a=j}fd(){return[this.r,this.g,this.b,this.a]}toArray(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return h[d]=this.r,h[d+1]=this.g,h[d+2]=this.b,h[d+3]=this.a,this}Hm(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=h[d],this.g=h[d+1],this.b=h[d+2],this.a=h[d+3],this}equals(h){return h&&this.r===h.r&&this.g===h.g&&this.b===h.b&&this.a===h.a}add(h){return new E(this.r+h.r,this.g+h.g,this.b+h.b,this.a+h.a)}addToRef(h,d){return d.r=this.r+h.r,d.g=this.g+h.g,d.b=this.b+h.b,d.a=this.a+h.a,d}addInPlace(h){return this.r+=h.r,this.g+=h.g,this.b+=h.b,this.a+=h.a,this}addInPlaceFromFloats(h,d,m,j){return this.r+=h,this.g+=d,this.b+=m,this.a+=j,this}fm(h){return new E(this.r-h.r,this.g-h.g,this.b-h.b,this.a-h.a)}subtractToRef(h,d){return d.r=this.r-h.r,d.g=this.g-h.g,d.b=this.b-h.b,d.a=this.a-h.a,d}Dq(h){return this.r-=h.r,this.g-=h.g,this.b-=h.b,this.a-=h.a,this}subtractFromFloats(h,d,m,j){return new E(this.r-h,this.g-d,this.b-m,this.a-j)}subtractFromFloatsToRef(h,d,m,j,A){return A.r=this.r-h,A.g=this.g-d,A.b=this.b-m,A.a=this.a-j,A}scale(h){return new E(this.r*h,this.g*h,this.b*h,this.a*h)}scaleInPlace(h){return this.r*=h,this.g*=h,this.b*=h,this.a*=h,this}scaleToRef(h,d){return d.r=this.r*h,d.g=this.g*h,d.b=this.b*h,d.a=this.a*h,d}scaleAndAddToRef(h,d){return d.r+=this.r*h,d.g+=this.g*h,d.b+=this.b*h,d.a+=this.a*h,d}clampToRef(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2?arguments[2]:void 0;return m.r=(0,w.Clamp)(this.r,h,d),m.g=(0,w.Clamp)(this.g,h,d),m.b=(0,w.Clamp)(this.b,h,d),m.a=(0,w.Clamp)(this.a,h,d),m}multiply(h){return new E(this.r*h.r,this.g*h.g,this.b*h.b,this.a*h.a)}multiplyToRef(h,d){return d.r=this.r*h.r,d.g=this.g*h.g,d.b=this.b*h.b,d.a=this.a*h.a,d}multiplyInPlace(h){return this.r*=h.r,this.g*=h.g,this.b*=h.b,this.a*=h.a,this}multiplyByFloats(h,d,m,j){return new E(this.r*h,this.g*d,this.b*m,this.a*j)}divide(h){throw new ReferenceError("Can not divide a color")}divideToRef(h,d){throw new ReferenceError("Can not divide a color")}divideInPlace(h){throw new ReferenceError("Can not divide a color")}minimizeInPlace(h){return this.r=Math.min(this.r,h.r),this.g=Math.min(this.g,h.g),this.b=Math.min(this.b,h.b),this.a=Math.min(this.a,h.a),this}maximizeInPlace(h){return this.r=Math.max(this.r,h.r),this.g=Math.max(this.g,h.g),this.b=Math.max(this.b,h.b),this.a=Math.max(this.a,h.a),this}minimizeInPlaceFromFloats(h,d,m,j){return this.r=Math.min(h,this.r),this.g=Math.min(d,this.g),this.b=Math.min(m,this.b),this.a=Math.min(j,this.a),this}maximizeInPlaceFromFloats(h,d,m,j){return this.r=Math.max(h,this.r),this.g=Math.max(d,this.g),this.b=Math.max(m,this.b),this.a=Math.max(j,this.a),this}floorToRef(h){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(h){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(h){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.c;return(0,w.WithinEpsilon)(this.r,h.r,d)&&(0,w.WithinEpsilon)(this.g,h.g,d)&&(0,w.WithinEpsilon)(this.b,h.b,d)&&(0,w.WithinEpsilon)(this.a,h.a,d)}equalsToFloats(h,d,m,j){return this.r===h&&this.g===d&&this.b===m&&this.a===j}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Eb"}getHashCode(){let h=255*this.r|0;return h=397*h^255*this.g,h=397*h^255*this.b,h=397*h^255*this.a,h}clone(){return(new E).D(this)}D(h){return this.r=h.r,this.g=h.g,this.b=h.b,this.a=h.a,this}xd(h,d,m,j){return this.r=h,this.g=d,this.b=m,this.a=j,this}set(h,d,m,j){return this.xd(h,d,m,j)}sd(h){return this.r=this.g=this.b=this.a=h,this}toHexString(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=Math.round(255*this.r),m=Math.round(255*this.g),j=Math.round(255*this.b);if(h)return"#"+(0,w.ToHex)(d)+(0,w.ToHex)(m)+(0,w.ToHex)(j);const A=Math.round(255*this.a);return"#"+(0,w.ToHex)(d)+(0,w.ToHex)(m)+(0,w.ToHex)(j)+(0,w.ToHex)(A)}fromHexString(h){return"#"!==h.substring(0,1)||9!==h.length&&7!==h.length||(this.r=parseInt(h.substring(1,3),16)/255,this.g=parseInt(h.substring(3,5),16)/255,this.b=parseInt(h.substring(5,7),16)/255,9===h.length&&(this.a=parseInt(h.substring(7,9),16)/255)),this}toLinearSpace(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=new E;return this.toLinearSpaceToRef(d,h),d}toLinearSpaceToRef(h){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(h.r=D(this.r),h.g=D(this.g),h.b=D(this.b)):(h.r=a(this.r),h.g=a(this.g),h.b=a(this.b)),h.a=this.a,this}toGammaSpace(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=new E;return this.toGammaSpaceToRef(d,h),d}toGammaSpaceToRef(h){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(h.r=M(this.r),h.g=M(this.g),h.b=M(this.b)):(h.r=S(this.r),h.g=S(this.g),h.b=S(this.b)),h.a=this.a,this}static FromHexString(h){return"#"!==h.substring(0,1)||9!==h.length&&7!==h.length?new E(0,0,0,0):new E(0,0,0,1).fromHexString(h)}static Lerp(h,d,m){return E.LerpToRef(h,d,m,new E)}static LerpToRef(h,d,m,j){return j.r=h.r+(d.r-h.r)*m,j.g=h.g+(d.g-h.g)*m,j.b=h.b+(d.b-h.b)*m,j.a=h.a+(d.a-h.a)*m,j}static Hermite(h,d,m,j,A){const b=A*A,w=A*b,a=2*w-3*b+1,D=-2*w+3*b,S=w-2*b+A,M=w-b,q=h.r*a+m.r*D+d.r*S+j.r*M,I=h.g*a+m.g*D+d.g*S+j.g*M,R=h.b*a+m.b*D+d.b*S+j.b*M,Z=h.a*a+m.a*D+d.a*S+j.a*M;return new E(q,I,R,Z)}static Hermite1stDerivative(h,d,m,j,A){const b=new E;return this.Hermite1stDerivativeToRef(h,d,m,j,A,b),b}static Hermite1stDerivativeToRef(h,d,m,j,A,b){const w=A*A;b.r=6*(w-A)*h.r+(3*w-4*A+1)*d.r+6*(-w+A)*m.r+(3*w-2*A)*j.r,b.g=6*(w-A)*h.g+(3*w-4*A+1)*d.g+6*(-w+A)*m.g+(3*w-2*A)*j.g,b.b=6*(w-A)*h.b+(3*w-4*A+1)*d.b+6*(-w+A)*m.b+(3*w-2*A)*j.b,b.a=6*(w-A)*h.a+(3*w-4*A+1)*d.a+6*(-w+A)*m.a+(3*w-2*A)*j.a}static FromColor3(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new E(h.r,h.g,h.b,d)}static Ud(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new E(h[d],h[d+1],h[d+2],h[d+3])}static FromArrayToRef(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0;m.r=h[d],m.g=h[d+1],m.b=h[d+2],m.a=h[d+3]}static FromInts(h,d,m,j){return new E(h/255,d/255,m/255,j/255)}static CheckColors4(h,d){if(h.length===3*d){const d=[];for(let m=0;m<h.length;m+=3){const j=m/3*4;d[j]=h[m],d[j+1]=h[m+1],d[j+2]=h[m+2],d[j+3]=1}return d}return h}}E._V8PerformanceHack=new E(.5,.5,.5,.5),Object.defineProperties(E.prototype,{dimension:{value:[4]},rank:{value:1}});class I{}I.qb=(0,j.c)(3,q.Black),I.Eb=(0,j.c)(3,(()=>new E(0,0,0,0))),(0,A.i)("BABYLON.Color3",q),(0,A.i)("BABYLON.Color4",E)},11065:(h,d,m)=>{m.d(d,{c:()=>w,f:()=>b,g:()=>j,j:()=>A});const j=1/2.2,A=2.2,b=(1+Math.sqrt(5))/2,w=.001},11434:(h,d,m)=>{m.d(d,{b:()=>A});var j=m(11337);class A{static GetPlanes(h){const d=[];for(let m=0;m<6;m++)d.push(new j.e(0,0,0,0));return A.GetPlanesToRef(h,d),d}static GetNearPlaneToRef(h,d){const m=h.m;d.Dd.x=m[3]+m[2],d.Dd.y=m[7]+m[6],d.Dd.z=m[11]+m[10],d.d=m[15]+m[14],d.normalize()}static GetFarPlaneToRef(h,d){const m=h.m;d.Dd.x=m[3]-m[2],d.Dd.y=m[7]-m[6],d.Dd.z=m[11]-m[10],d.d=m[15]-m[14],d.normalize()}static GetLeftPlaneToRef(h,d){const m=h.m;d.Dd.x=m[3]+m[0],d.Dd.y=m[7]+m[4],d.Dd.z=m[11]+m[8],d.d=m[15]+m[12],d.normalize()}static GetRightPlaneToRef(h,d){const m=h.m;d.Dd.x=m[3]-m[0],d.Dd.y=m[7]-m[4],d.Dd.z=m[11]-m[8],d.d=m[15]-m[12],d.normalize()}static GetTopPlaneToRef(h,d){const m=h.m;d.Dd.x=m[3]-m[1],d.Dd.y=m[7]-m[5],d.Dd.z=m[11]-m[9],d.d=m[15]-m[13],d.normalize()}static GetBottomPlaneToRef(h,d){const m=h.m;d.Dd.x=m[3]+m[1],d.Dd.y=m[7]+m[5],d.Dd.z=m[11]+m[9],d.d=m[15]+m[13],d.normalize()}static GetPlanesToRef(h,d){A.GetNearPlaneToRef(h,d[0]),A.GetFarPlaneToRef(h,d[1]),A.GetLeftPlaneToRef(h,d[2]),A.GetRightPlaneToRef(h,d[3]),A.GetTopPlaneToRef(h,d[4]),A.GetBottomPlaneToRef(h,d[5])}static IsPointInFrustum(h,d){for(let m=0;m<6;m++)if(d[m].dotCoordinate(h)<0)return!1;return!0}}},11323:(h,d,m)=>{m.d(d,{c:()=>a,e:()=>D});var j=m(11258),A=m(11058),b=m(11261);class w{static extractMinAndMaxIndexed(h,d,m,j,A,b){for(let w=m;w<m+j;w++){const m=3*d[w],j=h[m],a=h[m+1],D=h[m+2];A.minimizeInPlaceFromFloats(j,a,D),b.maximizeInPlaceFromFloats(j,a,D)}}static extractMinAndMax(h,d,m,j,A,b){for(let w=d,a=d*j;w<d+m;w++,a+=j){const d=h[a],m=h[a+1],j=h[a+2];A.minimizeInPlaceFromFloats(d,m,j),b.maximizeInPlaceFromFloats(d,m,j)}}}function a(h,d,m,j){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const a=new A.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),D=new A.i(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return w.extractMinAndMaxIndexed(h,d,m,j,a,D),b&&(a.x-=a.x*b.x+b.y,a.y-=a.y*b.x+b.y,a.z-=a.z*b.x+b.y,D.x+=D.x*b.x+b.y,D.y+=D.y*b.x+b.y,D.z+=D.z*b.x+b.y),{minimum:a,maximum:D}}function D(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4?arguments[4]:void 0;const a=new A.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),D=new A.i(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return b||(b=3),w.extractMinAndMax(h,d,m,b,a,D),j&&(a.x-=a.x*j.x+j.y,a.y-=a.y*j.x+j.y,a.z-=a.z*j.x+j.y,D.x+=D.x*j.x+j.y,D.y+=D.y*j.x+j.y,D.z+=D.z*j.x+j.y),{minimum:a,maximum:D}}(0,j.d)([b.f.filter((function(){for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];let[j,A]=d;return!Array.isArray(j)&&!Array.isArray(A)}))],w,"extractMinAndMaxIndexed",null),(0,j.d)([b.f.filter((function(){for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];let[j]=d;return!Array.isArray(j)}))],w,"extractMinAndMax",null)},11519:(h,d,m)=>{m.d(d,{c:()=>j.b,d:()=>j.c,g:()=>j.d,j:()=>j.i});m(11407),m(11353),m(11065),m(11434),m(11526),m(11337),m(11530);var j=m(11058);m(11432)},11526:(h,d,m)=>{m.d(d,{b:()=>a,d:()=>E,e:()=>M,f:()=>q});var j,A=m(11099),b=m(11058),w=m(11065);!function(h){h[h.CW=0]="CW",h[h.CCW=1]="CCW"}(j||(j={}));class a{static Interpolate(h,d,m,j,A){if(0===h)return 0;const b=1-3*j+3*d,w=3*j-6*d,a=3*d;let D=h;for(let S=0;S<5;S++){const d=D*D;D-=(b*(d*D)+w*d+a*D-h)*(1/(3*b*d+2*w*D+a)),D=Math.min(1,Math.max(0,D))}return 3*Math.pow(1-D,2)*D*m+3*(1-D)*Math.pow(D,2)*A+Math.pow(D,3)}}class D{constructor(h){this._radians=h,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(h,d){const m=d.fm(h),j=Math.atan2(m.y,m.x);return new D(j)}static BetweenTwoVectors(h,d){let m=h.lengthSquared()*d.lengthSquared();if(0===m)return new D(Math.PI/2);m=Math.sqrt(m);let j=h.dot(d)/m;j=(0,A.Clamp)(j,-1,1);const b=Math.acos(j);return new D(b)}static FromRadians(h){return new D(h)}static FromDegrees(h){return new D(h*Math.PI/180)}}class S{constructor(h,d,m){this.startPoint=h,this.midPoint=d,this.endPoint=m;const j=Math.pow(d.x,2)+Math.pow(d.y,2),A=(Math.pow(h.x,2)+Math.pow(h.y,2)-j)/2,w=(j-Math.pow(m.x,2)-Math.pow(m.y,2))/2,a=(h.x-d.x)*(d.y-m.y)-(d.x-m.x)*(h.y-d.y);this.centerPoint=new b.h((A*(d.y-m.y)-w*(h.y-d.y))/a,((h.x-d.x)*w-(d.x-m.x)*A)/a),this.radius=this.centerPoint.fm(this.startPoint).length(),this.startAngle=D.BetweenTwoPoints(this.centerPoint,this.startPoint);const S=this.startAngle.degrees();let M=D.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),q=D.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();M-S>180&&(M-=360),M-S<-180&&(M+=360),q-M>180&&(q-=360),q-M<-180&&(q+=360),this.orientation=M-S<0?0:1,this.angle=D.FromDegrees(0===this.orientation?S-q:q-S)}}class M{constructor(h,d){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new b.h(h,d))}addLineTo(h,d){if(this.closed)return this;const m=new b.h(h,d),j=this._points[this._points.length-1];return this._points.push(m),this._length+=m.fm(j).length(),this}addArcTo(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const w=this._points[this._points.length-1],a=new b.h(h,d),D=new b.h(m,j),M=new S(w,a,D);let q=M.angle.radians()/A;0===M.orientation&&(q*=-1);let E=M.startAngle.radians()+q;for(let b=0;b<A;b++){const h=Math.cos(E)*M.radius+M.centerPoint.x,d=Math.sin(E)*M.radius+M.centerPoint.y;this.addLineTo(h,d),E+=q}return this}addQuadraticCurveTo(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const b=(h,d,m,j)=>(1-h)*(1-h)*d+2*h*(1-h)*m+h*h*j,w=this._points[this._points.length-1];for(let a=0;a<=A;a++){const D=a/A,S=b(D,w.x,h,m),M=b(D,w.y,d,j);this.addLineTo(S,M)}return this}addBezierCurveTo(h,d,m,j,A,b){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const a=(h,d,m,j,A)=>(1-h)*(1-h)*(1-h)*d+3*h*(1-h)*(1-h)*m+3*h*h*(1-h)*j+h*h*h*A,D=this._points[this._points.length-1];for(let S=0;S<=w;S++){const M=S/w,q=a(M,D.x,h,m,A),E=a(M,D.y,d,j,b);this.addLineTo(q,E)}return this}isPointInside(h){let d=!1;const m=this._points.length;for(let j=m-1,A=0;A<m;j=A++){let m=this._points[j],b=this._points[A],w=b.x-m.x,a=b.y-m.y;if(Math.abs(a)>Number.EPSILON){if(a<0&&(m=this._points[A],w=-w,b=this._points[j],a=-a),h.y<m.y||h.y>b.y)continue;if(h.y===m.y&&h.x===m.x)return!0;{const j=a*(h.x-m.x)-w*(h.y-m.y);if(0===j)return!0;if(j<0)continue;d=!d}}else{if(h.y!==m.y)continue;if(b.x<=h.x&&h.x<=m.x||m.x<=h.x&&h.x<=b.x)return!0}}return d}close(){return this.closed=!0,this}length(){let h=this._length;if(this.closed){const d=this._points[this._points.length-1];h+=this._points[0].fm(d).length()}return h}area(){const h=this._points.length;let d=0;for(let m=h-1,j=0;j<h;m=j++)d+=this._points[m].x*this._points[j].y-this._points[j].x*this._points[m].y;return.5*d}getPoints(){return this._points}getPointAtLengthPosition(h){if(h<0||h>1)return b.h.Zero();const d=h*this.length();let m=0;for(let j=0;j<this._points.length;j++){const h=(j+1)%this._points.length,A=this._points[j],w=this._points[h].fm(A),a=w.length()+m;if(d>=m&&d<=a){const h=w.normalize(),j=d-m;return new b.h(A.x+h.x*j,A.y+h.y*j)}m=a}return b.h.Zero()}static StartingAt(h,d){return new M(h,d)}}class q{constructor(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=h,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:b.i.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:b.b.Identity()};for(let A=0;A<h.length;A++)this._curve[A]=h[A].clone();this._raw=m||!1,this._alignTangentsWithPath=j,this._compute(d,j)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(h){return this._updatePointAtData(h).point}getTangentAt(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(h,d),d?b.i.TransformCoordinates(b.i.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(h,d),d?b.i.TransformCoordinates(b.i.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(h,d),d?b.i.TransformCoordinates(b.i.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(h){return this.length()*h}getPreviousPointIndexAt(h){return this._updatePointAtData(h),this._pointAtData.previousPointArrayIndex}getSubPositionAt(h){return this._updatePointAtData(h),this._pointAtData.subPosition}getClosestPositionTo(h){let d=Number.MAX_VALUE,m=0;for(let j=0;j<this._curve.length-1;j++){const A=this._curve[j+0],w=this._curve[j+1].fm(A).normalize(),a=this._distances[j+1]-this._distances[j+0],D=Math.min(Math.max(b.i.Dot(w,h.fm(A).normalize()),0)*b.i.Distance(A,h)/a,1),S=b.i.Distance(A.add(w.scale(D*a)),h);S<d&&(d=S,m=(this._distances[j+0]+a*D)/this.length())}return m}slice(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(h<0&&(h=1- -1*h%1),d<0&&(d=1- -1*d%1),h>d){const m=h;h=d,d=m}const m=this.getCurve(),j=this.getPointAt(h);let A=this.getPreviousPointIndexAt(h);const b=this.getPointAt(d),w=this.getPreviousPointIndexAt(d)+1,a=[];return 0!==h&&(A++,a.push(j)),a.push(...m.slice(A,w)),1===d&&1!==h||a.push(b),new q(a,this.getNormalAt(h),this._raw,this._alignTangentsWithPath)}update(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let j=0;j<h.length;j++)this._curve[j].x=h[j].x,this._curve[j].y=h[j].y,this._curve[j].z=h[j].z;return this._compute(d,m),this}_compute(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const m=this._curve.length;if(m<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[m-1]=this._curve[m-1].fm(this._curve[m-2]),this._raw||this._tangents[m-1].normalize();const j=this._tangents[0],A=this._normalVector(j,h);let w,a,D,S,M;this._normals[0]=A,this._raw||this._normals[0].normalize(),this._binormals[0]=b.i.Cross(j,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let q=1;q<m;q++)w=this._getLastNonNullVector(q),q<m-1&&(a=this._getFirstNonNullVector(q),this._tangents[q]=d?a:w.add(a),this._tangents[q].normalize()),this._distances[q]=this._distances[q-1]+this._curve[q].fm(this._curve[q-1]).length(),D=this._tangents[q],M=this._binormals[q-1],this._normals[q]=b.i.Cross(M,D),this._raw||(0===this._normals[q].length()?(S=this._normals[q-1],this._normals[q]=S.clone()):this._normals[q].normalize()),this._binormals[q]=b.i.Cross(D,this._normals[q]),this._raw||this._binormals[q].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(h){let d=1,m=this._curve[h+d].fm(this._curve[h]);for(;0===m.length()&&h+d+1<this._curve.length;)d++,m=this._curve[h+d].fm(this._curve[h]);return m}_getLastNonNullVector(h){let d=1,m=this._curve[h].fm(this._curve[h-d]);for(;0===m.length()&&h>d+1;)d++,m=this._curve[h].fm(this._curve[h-d]);return m}_normalVector(h,d){let m,j=h.length();if(0===j&&(j=1),void 0===d||null===d){let d;d=(0,A.WithinEpsilon)(Math.abs(h.y)/j,1,w.c)?(0,A.WithinEpsilon)(Math.abs(h.x)/j,1,w.c)?(0,A.WithinEpsilon)(Math.abs(h.z)/j,1,w.c)?b.i.Zero():new b.i(0,0,1):new b.i(1,0,0):new b.i(0,-1,0),m=b.i.Cross(h,d)}else m=b.i.Cross(h,d),b.i.CrossToRef(m,h,m);return m.normalize(),m}_updatePointAtData(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===h)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=h;const m=this.getPoints();if(h<=0)return this._setPointAtData(0,0,m[0],0,d);if(h>=1)return this._setPointAtData(1,1,m[m.length-1],m.length-1,d);let j,A=m[0],w=0;const a=h*this.length();for(let D=1;D<m.length;D++){j=m[D];const S=b.i.Distance(A,j);if(w+=S,w===a)return this._setPointAtData(h,1,j,D,d);if(w>a){const m=(w-a)/S,b=A.fm(j),M=j.add(b.scaleInPlace(m));return this._setPointAtData(h,1-m,M,D-1,d)}A=j}return this._pointAtData}_setPointAtData(h,d,m,j,A){return this._pointAtData.point=m,this._pointAtData.position=h,this._pointAtData.subPosition=d,this._pointAtData.previousPointArrayIndex=j,this._pointAtData.interpolateReady=A,A&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=b.b.Identity();const h=this._pointAtData.previousPointArrayIndex;if(h!==this._tangents.length-1){const d=h+1,m=this._tangents[h].clone(),j=this._normals[h].clone(),A=this._binormals[h].clone(),w=this._tangents[d].clone(),a=this._normals[d].clone(),D=this._binormals[d].clone(),S=b.c.RotationQuaternionFromAxis(j,A,m),M=b.c.RotationQuaternionFromAxis(a,D,w);b.c.Slerp(S,M,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class E{static CreateQuadraticBezier(h,d,m,j){j=j>2?j:3;const A=[],w=(h,d,m,j)=>(1-h)*(1-h)*d+2*h*(1-h)*m+h*h*j;for(let a=0;a<=j;a++)A.push(new b.i(w(a/j,h.x,d.x,m.x),w(a/j,h.y,d.y,m.y),w(a/j,h.z,d.z,m.z)));return new E(A)}static CreateCubicBezier(h,d,m,j,A){A=A>3?A:4;const w=[],a=(h,d,m,j,A)=>(1-h)*(1-h)*(1-h)*d+3*h*(1-h)*(1-h)*m+3*h*h*(1-h)*j+h*h*h*A;for(let D=0;D<=A;D++)w.push(new b.i(a(D/A,h.x,d.x,m.x,j.x),a(D/A,h.y,d.y,m.y,j.y),a(D/A,h.z,d.z,m.z,j.z)));return new E(w)}static CreateHermiteSpline(h,d,m,j,A){const w=[],a=1/A;for(let D=0;D<=A;D++)w.push(b.i.Hermite(h,d,m,j,D*a));return new E(w)}static CreateCatmullRomSpline(h,d,m){const j=[],A=1/d;let w=0;if(m){const m=h.length;for(let a=0;a<m;a++){w=0;for(let D=0;D<d;D++)j.push(b.i.CatmullRom(h[a%m],h[(a+1)%m],h[(a+2)%m],h[(a+3)%m],w)),w+=A}j.push(j[0])}else{const m=[];m.push(h[0].clone()),Array.prototype.push.apply(m,h),m.push(h[h.length-1].clone());let a=0;for(;a<m.length-3;a++){w=0;for(let h=0;h<d;h++)j.push(b.i.CatmullRom(m[a],m[a+1],m[a+2],m[a+3],w)),w+=A}a--,j.push(b.i.CatmullRom(m[a],m[a+1],m[a+2],m[a+3],w))}return new E(j)}static ArcThru3Points(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,A=arguments.length>4&&void 0!==arguments[4]&&arguments[4],w=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=[],D=d.fm(h),S=m.fm(d),M=h.fm(m),q=b.i.Cross(D,S),I=q.length();if(I<Math.pow(10,-8))return new E(a);const R=D.lengthSquared(),Z=S.lengthSquared(),L=M.lengthSquared(),B=q.lengthSquared(),V=.5*D.length()*S.length()*M.length()/I,v=-.5*Z*b.i.Dot(D,M)/B,C=-.5*L*b.i.Dot(D,S)/B,T=-.5*R*b.i.Dot(S,M)/B,o=h.scale(v).add(d.scale(C)).add(m.scale(T)),y=h.fm(o).normalize(),i=b.i.Cross(q,y).normalize();if(w){const d=2*Math.PI/j;for(let h=0;h<=2*Math.PI;h+=d)a.push(o.add(y.scale(V*Math.cos(h)).add(i.scale(V*Math.sin(h)))));a.push(h)}else{const d=1/j;let w=0,D=b.i.Zero();do{D=o.add(y.scale(V*Math.cos(w)).add(i.scale(V*Math.sin(w)))),a.push(D),w+=d}while(!D.equalsWithEpsilon(m,V*d*1.1));a.push(m),A&&a.push(h)}return new E(a)}constructor(h){this._length=0,this._points=h,this._length=this._computeLength(h)}getPoints(){return this._points}length(){return this._length}continue(h){const d=this._points[this._points.length-1],m=this._points.slice(),j=h.getPoints();for(let A=1;A<j.length;A++)m.push(j[A].fm(j[0]).add(d));return new E(m)}_computeLength(h){let d=0;for(let m=1;m<h.length;m++)d+=h[m].fm(h[m-1]).length();return d}}},11337:(h,d,m)=>{m.d(d,{e:()=>A});var j=m(11058);class A{constructor(h,d,m,A){this.Dd=new j.i(h,d,m),this.d=A}fd(){return[this.Dd.x,this.Dd.y,this.Dd.z,this.d]}clone(){return new A(this.Dd.x,this.Dd.y,this.Dd.z,this.d)}getClassName(){return"Plane"}getHashCode(){let h=this.Dd.getHashCode();return h=397*h^this.d,h}normalize(){const h=Math.sqrt(this.Dd.x*this.Dd.x+this.Dd.y*this.Dd.y+this.Dd.z*this.Dd.z);let d=0;return 0!==h&&(d=1/h),this.Dd.x*=d,this.Dd.y*=d,this.Dd.z*=d,this.d*=d,this}transform(h){const d=A._TmpMatrix;h.invertToRef(d);const m=d.m,j=this.Dd.x,b=this.Dd.y,w=this.Dd.z,a=this.d,D=j*m[0]+b*m[1]+w*m[2]+a*m[3],S=j*m[4]+b*m[5]+w*m[6]+a*m[7],M=j*m[8]+b*m[9]+w*m[10]+a*m[11],q=j*m[12]+b*m[13]+w*m[14]+a*m[15];return new A(D,S,M,q)}dotCoordinate(h){return this.Dd.x*h.x+this.Dd.y*h.y+this.Dd.z*h.z+this.d}copyFromPoints(h,d,m){const j=d.x-h.x,A=d.y-h.y,b=d.z-h.z,w=m.x-h.x,a=m.y-h.y,D=m.z-h.z,S=A*D-b*a,M=b*w-j*D,q=j*a-A*w,E=Math.sqrt(S*S+M*M+q*q);let I;return I=0!==E?1/E:0,this.Dd.x=S*I,this.Dd.y=M*I,this.Dd.z=q*I,this.d=-(this.Dd.x*h.x+this.Dd.y*h.y+this.Dd.z*h.z),this}isFrontFacingTo(h,d){return j.i.Dot(this.Dd,h)<=d}signedDistanceTo(h){return j.i.Dot(h,this.Dd)+this.d}static Ud(h){return new A(h[0],h[1],h[2],h[3])}static FromPoints(h,d,m){const j=new A(0,0,0,0);return j.copyFromPoints(h,d,m),j}static FromPositionAndNormal(h,d){const m=new A(0,0,0,0);return this.FromPositionAndNormalToRef(h,d,m)}static FromPositionAndNormalToRef(h,d,m){return m.Dd.D(d),m.Dd.normalize(),m.d=-h.dot(m.Dd),m}static SignedDistanceToPlaneFromPositionAndNormal(h,d,m){const A=-(d.x*h.x+d.y*h.y+d.z*h.z);return j.i.Dot(m,d)+A}}A._TmpMatrix=j.b.Identity()},11099:(h,d,m)=>{function j(h){return parseInt(h.toString().replace(/\W/g,""))}function A(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(h-d)<=m}function b(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1401298e-51;return h<d-j||h>m+j}function w(h,d){return h===d?h:Math.random()*(d-h)+h}function a(h,d,m){return h+(d-h)*m}function D(h,d,m){let j=L(d-h,360);return j>180&&(j-=360),h+j*E(m)}function S(h,d,m){let j=0;return j=h!=d?E((m-h)/(d-h)):0,j}function M(h,d,m,j,A){const b=A*A,w=A*b;return h*(2*w-3*b+1)+m*(-2*w+3*b)+d*(w-2*b+A)+j*(w-b)}function q(h,d,m,j,A){const b=A*A;return 6*(b-A)*h+(3*b-4*A+1)*d+6*(-b+A)*m+(3*b-2*A)*j}function E(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(m,Math.max(d,h))}function I(h){return h-=2*Math.PI*Math.floor((h+Math.PI)/(2*Math.PI))}function R(h){const d=h.toString(16);return h<=15?("0"+d).toUpperCase():d.toUpperCase()}function Z(h){if(Math.log2)return Math.floor(Math.log2(h));if(h<0)return NaN;if(0===h)return-1/0;let d=0;if(h<1){for(;h<1;)d++,h*=2;d=-d}else if(h>1)for(;h>1;)d++,h=Math.floor(h/2);return d}function L(h,d){return h-Math.floor(h/d)*d}function B(h,d,m){return(h-d)/(m-d)}function V(h,d,m){return h*(m-d)+d}function v(h,d){let m=L(d-h,360);return m>180&&(m-=360),m}function C(h,d){const m=L(h,2*d);return d-Math.abs(m-d)}function T(h,d,m){let j=E(m);return j=-2*j*j*j+3*j*j,d*j+h*(1-j)}function o(h,d,m){let j=0;return j=Math.abs(d-h)<=m?d:h+Math.sign(d-h)*m,j}function y(h,d,m){const j=v(h,d);let A=0;return A=-m<j&&j<m?d:o(h,d=h+j,m),A}function i(h,d,m){return(h-d)/(m-d)}function g(h,d,m){return(m-d)*h+d}function F(h,d){const m=h%d;return 0===m?d:F(d,m)}m.r(d),m.d(d,{Clamp:()=>E,DeltaAngle:()=>v,Denormalize:()=>V,ExtractAsInt:()=>j,Hermite:()=>M,Hermite1stDerivative:()=>q,HighestCommonFactor:()=>F,ILog2:()=>Z,InverseLerp:()=>S,Lerp:()=>a,LerpAngle:()=>D,MoveTowards:()=>o,MoveTowardsAngle:()=>y,Normalize:()=>B,NormalizeRadians:()=>I,OutsideRange:()=>b,PercentToRange:()=>g,PingPong:()=>C,RandomRange:()=>w,RangeToPercent:()=>i,Repeat:()=>L,SmoothStep:()=>T,ToHex:()=>R,WithinEpsilon:()=>A})},11530:(h,d,m)=>{m.d(d,{b:()=>j});class j{constructor(h,d){this.width=h,this.height=d}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let h=0|this.width;return h=397*h^this.height,h}D(h){this.width=h.width,this.height=h.height}xd(h,d){return this.width=h,this.height=d,this}set(h,d){return this.xd(h,d)}multiplyByFloats(h,d){return new j(this.width*h,this.height*d)}clone(){return new j(this.width,this.height)}equals(h){return!!h&&(this.width===h.width&&this.height===h.height)}get surface(){return this.width*this.height}static Zero(){return new j(0,0)}add(h){return new j(this.width+h.width,this.height+h.height)}fm(h){return new j(this.width-h.width,this.height-h.height)}scale(h){return new j(this.width*h,this.height*h)}static Lerp(h,d,m){const A=h.width+(d.width-h.width)*m,b=h.height+(d.height-h.height)*m;return new j(A,b)}}},11058:(h,d,m)=>{m.d(d,{b:()=>V,c:()=>B,d:()=>C,h:()=>R,i:()=>Z,m:()=>L});var j=m(11065),A=m(11073),b=m(11080),w=m(11087),a=m(11094),D=m(11099);class S{}function M(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const A=h.fd(),b=d.fd(),w=A[0],a=A[1],D=A[2],S=A[3],M=A[4],q=A[5],E=A[6],I=A[7],R=A[8],Z=A[9],L=A[10],B=A[11],V=A[12],v=A[13],C=A[14],T=A[15],o=b[0],y=b[1],i=b[2],g=b[3],F=b[4],f=b[5],H=b[6],c=b[7],k=b[8],l=b[9],K=b[10],N=b[11],W=b[12],r=b[13],Y=b[14],x=b[15];m[j]=w*o+a*F+D*k+S*W,m[j+1]=w*y+a*f+D*l+S*r,m[j+2]=w*i+a*H+D*K+S*Y,m[j+3]=w*g+a*c+D*N+S*x,m[j+4]=M*o+q*F+E*k+I*W,m[j+5]=M*y+q*f+E*l+I*r,m[j+6]=M*i+q*H+E*K+I*Y,m[j+7]=M*g+q*c+E*N+I*x,m[j+8]=R*o+Z*F+L*k+B*W,m[j+9]=R*y+Z*f+L*l+B*r,m[j+10]=R*i+Z*H+L*K+B*Y,m[j+11]=R*g+Z*c+L*N+B*x,m[j+12]=V*o+v*F+C*k+T*W,m[j+13]=V*y+v*f+C*l+T*r,m[j+14]=V*i+v*H+C*K+T*Y,m[j+15]=V*g+v*c+C*N+T*x}function q(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const j=h.fd();d[m]=j[0],d[m+1]=j[1],d[m+2]=j[2],d[m+3]=j[3],d[m+4]=j[4],d[m+5]=j[5],d[m+6]=j[6],d[m+7]=j[7],d[m+8]=j[8],d[m+9]=j[9],d[m+10]=j[10],d[m+11]=j[11],d[m+12]=j[12],d[m+13]=j[13],d[m+14]=j[14],d[m+15]=j[15]}function E(h,d){const m=h.fd(),j=m[0],A=m[1],b=m[2],w=m[3],a=m[4],D=m[5],S=m[6],M=m[7],q=m[8],E=m[9],I=m[10],R=m[11],Z=m[12],L=m[13],B=m[14],V=m[15],v=I*V-B*R,C=E*V-L*R,T=E*B-L*I,o=q*V-Z*R,y=q*B-I*Z,i=q*L-Z*E,g=+(D*v-S*C+M*T),F=-(a*v-S*o+M*y),f=+(a*C-D*o+M*i),H=-(a*T-D*y+S*i),c=j*g+A*F+b*f+w*H;if(0===c)return!1;const k=1/c,l=S*V-B*M,K=D*V-L*M,N=D*B-L*S,W=a*V-Z*M,r=a*B-Z*S,Y=a*L-Z*D,x=S*R-I*M,Q=D*R-E*M,t=D*I-E*S,U=a*R-q*M,s=a*I-q*S,J=a*E-q*D,O=-(A*v-b*C+w*T),n=+(j*v-b*o+w*y),p=-(j*C-A*o+w*i),e=+(j*T-A*y+b*i),X=+(A*l-b*K+w*N),z=-(j*l-b*W+w*r),u=+(j*K-A*W+w*Y),P=-(j*N-A*r+b*Y),G=-(A*x-b*Q+w*t),hh=+(j*x-b*U+w*s),dh=-(j*Q-A*U+w*J),mh=+(j*t-A*s+b*J);return d[0]=g*k,d[1]=O*k,d[2]=X*k,d[3]=G*k,d[4]=F*k,d[5]=n*k,d[6]=z*k,d[7]=hh*k,d[8]=f*k,d[9]=p*k,d[10]=u*k,d[11]=dh*k,d[12]=H*k,d[13]=e*k,d[14]=P*k,d[15]=mh*k,!0}S._UpdateFlagSeed=0;const I=h=>parseInt(h.toString().replace(/\W/g,""));class R{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=h,this.y=d}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let h=I(this.x);return h=397*h^I(this.y),h}toArray(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return h[d]=this.x,h[d+1]=this.y,this}Hm(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return R.FromArrayToRef(h,d,this),this}fd(){return[this.x,this.y]}D(h){return this.x=h.x,this.y=h.y,this}xd(h,d){return this.x=h,this.y=d,this}set(h,d){return this.xd(h,d)}sd(h){return this.xd(h,h)}add(h){return new R(this.x+h.x,this.y+h.y)}addToRef(h,d){return d.x=this.x+h.x,d.y=this.y+h.y,d}addInPlace(h){return this.x+=h.x,this.y+=h.y,this}addInPlaceFromFloats(h,d){return this.x+=h,this.y+=d,this}addVector3(h){return new R(this.x+h.x,this.y+h.y)}fm(h){return new R(this.x-h.x,this.y-h.y)}subtractToRef(h,d){return d.x=this.x-h.x,d.y=this.y-h.y,d}Dq(h){return this.x-=h.x,this.y-=h.y,this}multiplyInPlace(h){return this.x*=h.x,this.y*=h.y,this}multiply(h){return new R(this.x*h.x,this.y*h.y)}multiplyToRef(h,d){return d.x=this.x*h.x,d.y=this.y*h.y,d}multiplyByFloats(h,d){return new R(this.x*h,this.y*d)}divide(h){return new R(this.x/h.x,this.y/h.y)}divideToRef(h,d){return d.x=this.x/h.x,d.y=this.y/h.y,d}divideInPlace(h){return this.x=this.x/h.x,this.y=this.y/h.y,this}minimizeInPlace(h){return this.minimizeInPlaceFromFloats(h.x,h.y)}maximizeInPlace(h){return this.maximizeInPlaceFromFloats(h.x,h.y)}minimizeInPlaceFromFloats(h,d){return this.x=Math.min(h,this.x),this.y=Math.min(d,this.y),this}maximizeInPlaceFromFloats(h,d){return this.x=Math.max(h,this.x),this.y=Math.max(d,this.y),this}subtractFromFloats(h,d){return new R(this.x-h,this.y-d)}subtractFromFloatsToRef(h,d,m){return m.x=this.x-h,m.y=this.y-d,m}negate(){return new R(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(h){return h.x=-this.x,h.y=-this.y,h}scaleInPlace(h){return this.x*=h,this.y*=h,this}scale(h){return new R(this.x*h,this.y*h)}scaleToRef(h,d){return d.x=this.x*h,d.y=this.y*h,d}scaleAndAddToRef(h,d){return d.x+=this.x*h,d.y+=this.y*h,d}equals(h){return h&&this.x===h.x&&this.y===h.y}equalsWithEpsilon(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.c;return h&&(0,D.WithinEpsilon)(this.x,h.x,d)&&(0,D.WithinEpsilon)(this.y,h.y,d)}equalsToFloats(h,d){return this.x===h&&this.y===d}floor(){return new R(Math.floor(this.x),Math.floor(this.y))}floorToRef(h){return h.x=Math.floor(this.x),h.y=Math.floor(this.y),h}fract(){return new R(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(h){return h.x=this.x-Math.floor(this.x),h.y=this.y-Math.floor(this.y),h}rotate(h){return this.rotateToRef(h,new R)}rotateToRef(h,d){const m=Math.cos(h),j=Math.sin(h);return d.x=m*this.x-j*this.y,d.y=j*this.x+m*this.y,d}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(h){return 0===h||1===h?this:this.scaleInPlace(1/h)}normalizeToNew(){const h=new R;return this.normalizeToRef(h),h}normalizeToRef(h){const d=this.length();return 0===d&&(h.x=this.x,h.y=this.y),this.scaleToRef(1/d,h)}clone(){return new R(this.x,this.y)}dot(h){return this.x*h.x+this.y*h.y}static Zero(){return new R(0,0)}static One(){return new R(1,1)}static Random(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new R((0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d))}static RandomToRef(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).xd((0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d))}static get ZeroReadOnly(){return R._ZeroReadOnly}static Ud(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new R(h[d],h[d+1])}static FromArrayToRef(h,d,m){return m.x=h[d],m.y=h[d+1],m}static FromFloatsToRef(h,d,m){return m.xd(h,d),m}static CatmullRom(h,d,m,j,A){const b=A*A,w=A*b,a=.5*(2*d.x+(-h.x+m.x)*A+(2*h.x-5*d.x+4*m.x-j.x)*b+(-h.x+3*d.x-3*m.x+j.x)*w),D=.5*(2*d.y+(-h.y+m.y)*A+(2*h.y-5*d.y+4*m.y-j.y)*b+(-h.y+3*d.y-3*m.y+j.y)*w);return new R(a,D)}static ClampToRef(h,d,m,j){return j.x=(0,D.Clamp)(h.x,d.x,m.x),j.y=(0,D.Clamp)(h.y,d.y,m.y),j}static Clamp(h,d,m){const j=(0,D.Clamp)(h.x,d.x,m.x),A=(0,D.Clamp)(h.y,d.y,m.y);return new R(j,A)}static Hermite(h,d,m,j,A){const b=A*A,w=A*b,a=2*w-3*b+1,D=-2*w+3*b,S=w-2*b+A,M=w-b,q=h.x*a+m.x*D+d.x*S+j.x*M,E=h.y*a+m.y*D+d.y*S+j.y*M;return new R(q,E)}static Hermite1stDerivative(h,d,m,j,A){return this.Hermite1stDerivativeToRef(h,d,m,j,A,new R)}static Hermite1stDerivativeToRef(h,d,m,j,A,b){const w=A*A;return b.x=6*(w-A)*h.x+(3*w-4*A+1)*d.x+6*(-w+A)*m.x+(3*w-2*A)*j.x,b.y=6*(w-A)*h.y+(3*w-4*A+1)*d.y+6*(-w+A)*m.y+(3*w-2*A)*j.y,b}static Lerp(h,d,m){return R.LerpToRef(h,d,m,new R)}static LerpToRef(h,d,m,j){return j.x=h.x+(d.x-h.x)*m,j.y=h.y+(d.y-h.y)*m,j}static Dot(h,d){return h.x*d.x+h.y*d.y}static Normalize(h){return R.NormalizeToRef(h,new R)}static NormalizeToRef(h,d){return h.normalizeToRef(d),d}static Minimize(h,d){const m=h.x<d.x?h.x:d.x,j=h.y<d.y?h.y:d.y;return new R(m,j)}static Maximize(h,d){const m=h.x>d.x?h.x:d.x,j=h.y>d.y?h.y:d.y;return new R(m,j)}static Transform(h,d){return R.TransformToRef(h,d,new R)}static TransformToRef(h,d,m){const j=d.m,A=h.x*j[0]+h.y*j[4]+j[12],b=h.x*j[1]+h.y*j[5]+j[13];return m.x=A,m.y=b,m}static PointInTriangle(h,d,m,j){const A=.5*(-m.y*j.x+d.y*(-m.x+j.x)+d.x*(m.y-j.y)+m.x*j.y),b=A<0?-1:1,w=(d.y*j.x-d.x*j.y+(j.y-d.y)*h.x+(d.x-j.x)*h.y)*b,a=(d.x*m.y-d.y*m.x+(d.y-m.y)*h.x+(m.x-d.x)*h.y)*b;return w>0&&a>0&&w+a<2*A*b}static Distance(h,d){return Math.sqrt(R.DistanceSquared(h,d))}static DistanceSquared(h,d){const m=h.x-d.x,j=h.y-d.y;return m*m+j*j}static Center(h,d){return R.CenterToRef(h,d,new R)}static CenterToRef(h,d,m){return m.xd((h.x+d.x)/2,(h.y+d.y)/2)}static DistanceOfPointFromSegment(h,d,m){const j=R.DistanceSquared(d,m);if(0===j)return R.Distance(h,d);const A=m.fm(d),b=Math.max(0,Math.min(1,R.Dot(h.fm(d),A)/j)),w=d.add(A.multiplyByFloats(b,b));return R.Distance(h,w)}}R._V8PerformanceHack=new R(.5,.5),R._ZeroReadOnly=R.Zero(),Object.defineProperties(R.prototype,{dimension:{value:[2]},rank:{value:1}});class Z{get x(){return this._x}set x(h){this._x=h,this._isDirty=!0}get y(){return this._y}set y(h){this._y=h,this._isDirty=!0}get z(){return this._z}set z(h){this._z=h,this._isDirty=!0}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=h,this._y=d,this._z=m}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"Qd"}getHashCode(){let h=I(this._x);return h=397*h^I(this._y),h=397*h^I(this._z),h}fd(){return[this._x,this._y,this._z]}toArray(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return h[d]=this._x,h[d+1]=this._y,h[d+2]=this._z,this}Hm(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Z.FromArrayToRef(h,d,this),this}toQuaternion(){return B.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(h){return this._x+=h._x,this._y+=h._y,this._z+=h._z,this._isDirty=!0,this}addInPlaceFromFloats(h,d,m){return this._x+=h,this._y+=d,this._z+=m,this._isDirty=!0,this}add(h){return new Z(this._x+h._x,this._y+h._y,this._z+h._z)}addToRef(h,d){return d._x=this._x+h._x,d._y=this._y+h._y,d._z=this._z+h._z,d._isDirty=!0,d}Dq(h){return this._x-=h._x,this._y-=h._y,this._z-=h._z,this._isDirty=!0,this}fm(h){return new Z(this._x-h._x,this._y-h._y,this._z-h._z)}subtractToRef(h,d){return this.subtractFromFloatsToRef(h._x,h._y,h._z,d)}subtractFromFloats(h,d,m){return new Z(this._x-h,this._y-d,this._z-m)}subtractFromFloatsToRef(h,d,m,j){return j._x=this._x-h,j._y=this._y-d,j._z=this._z-m,j._isDirty=!0,j}negate(){return new Z(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(h){return h._x=-1*this._x,h._y=-1*this._y,h._z=-1*this._z,h._isDirty=!0,h}scaleInPlace(h){return this._x*=h,this._y*=h,this._z*=h,this._isDirty=!0,this}scale(h){return new Z(this._x*h,this._y*h,this._z*h)}scaleToRef(h,d){return d._x=this._x*h,d._y=this._y*h,d._z=this._z*h,d._isDirty=!0,d}getNormalToRef(h){const d=this.length();let m=Math.acos(this._y/d);const j=Math.atan2(this._z,this._x);m>Math.PI/2?m-=Math.PI/2:m+=Math.PI/2;const A=d*Math.sin(m)*Math.cos(j),b=d*Math.cos(m),w=d*Math.sin(m)*Math.sin(j);return h.set(A,b,w),h}applyRotationQuaternionToRef(h,d){const m=this._x,j=this._y,A=this._z,b=h._x,w=h._y,a=h._z,D=h._w,S=2*(w*A-a*j),M=2*(a*m-b*A),q=2*(b*j-w*m);return d._x=m+D*S+w*q-a*M,d._y=j+D*M+a*S-b*q,d._z=A+D*q+b*M-w*S,d._isDirty=!0,d}applyRotationQuaternionInPlace(h){return this.applyRotationQuaternionToRef(h,this)}applyRotationQuaternion(h){return this.applyRotationQuaternionToRef(h,new Z)}scaleAndAddToRef(h,d){return d._x+=this._x*h,d._y+=this._y*h,d._z+=this._z*h,d._isDirty=!0,d}projectOnPlane(h,d){return this.projectOnPlaneToRef(h,d,new Z)}projectOnPlaneToRef(h,d,m){const j=h.Dd,A=h.d,b=v.Qd[0];this.subtractToRef(d,b),b.normalize();const w=Z.Dot(b,j);if(Math.abs(w)<1e-10)m.sd(1/0);else{const h=-(Z.Dot(d,j)+A)/w,a=b.scaleInPlace(h);d.addToRef(a,m)}return m}equals(h){return h&&this._x===h._x&&this._y===h._y&&this._z===h._z}equalsWithEpsilon(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.c;return h&&(0,D.WithinEpsilon)(this._x,h._x,d)&&(0,D.WithinEpsilon)(this._y,h._y,d)&&(0,D.WithinEpsilon)(this._z,h._z,d)}equalsToFloats(h,d,m){return this._x===h&&this._y===d&&this._z===m}multiplyInPlace(h){return this._x*=h._x,this._y*=h._y,this._z*=h._z,this._isDirty=!0,this}multiply(h){return this.multiplyByFloats(h._x,h._y,h._z)}multiplyToRef(h,d){return d._x=this._x*h._x,d._y=this._y*h._y,d._z=this._z*h._z,d._isDirty=!0,d}multiplyByFloats(h,d,m){return new Z(this._x*h,this._y*d,this._z*m)}divide(h){return new Z(this._x/h._x,this._y/h._y,this._z/h._z)}divideToRef(h,d){return d._x=this._x/h._x,d._y=this._y/h._y,d._z=this._z/h._z,d._isDirty=!0,d}divideInPlace(h){return this._x=this._x/h._x,this._y=this._y/h._y,this._z=this._z/h._z,this._isDirty=!0,this}minimizeInPlace(h){return this.minimizeInPlaceFromFloats(h._x,h._y,h._z)}maximizeInPlace(h){return this.maximizeInPlaceFromFloats(h._x,h._y,h._z)}minimizeInPlaceFromFloats(h,d,m){return h<this._x&&(this.x=h),d<this._y&&(this.y=d),m<this._z&&(this.z=m),this}maximizeInPlaceFromFloats(h,d,m){return h>this._x&&(this.x=h),d>this._y&&(this.y=d),m>this._z&&(this.z=m),this}isNonUniformWithinEpsilon(h){const d=Math.abs(this._x),m=Math.abs(this._y);if(!(0,D.WithinEpsilon)(d,m,h))return!0;const j=Math.abs(this._z);return!(0,D.WithinEpsilon)(d,j,h)||!(0,D.WithinEpsilon)(m,j,h)}get isNonUniform(){const h=Math.abs(this._x);if(h!==Math.abs(this._y))return!0;return h!==Math.abs(this._z)}floorToRef(h){return h._x=Math.floor(this._x),h._y=Math.floor(this._y),h._z=Math.floor(this._z),h._isDirty=!0,h}floor(){return new Z(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}fractToRef(h){return h._x=this._x-Math.floor(this._x),h._y=this._y-Math.floor(this._y),h._z=this._z-Math.floor(this._z),h._isDirty=!0,h}fract(){return new Z(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(h){if("xyz"===(h=h.toLowerCase()))return this;const d=v.Qd[0].D(this);return this.x=d[h[0]],this.y=d[h[1]],this.z=d[h[2]],this}rotateByQuaternionToRef(h,d){return h.toRotationMatrix(v.Matrix[0]),Z.TransformCoordinatesToRef(this,v.Matrix[0],d),d}rotateByQuaternionAroundPointToRef(h,d,m){return this.subtractToRef(d,v.Qd[0]),v.Qd[0].rotateByQuaternionToRef(h,v.Qd[0]),d.addToRef(v.Qd[0],m),m}cross(h){return Z.CrossToRef(this,h,new Z)}normalizeFromLength(h){return 0===h||1===h?this:this.scaleInPlace(1/h)}normalizeToNew(){return this.normalizeToRef(new Z)}normalizeToRef(h){const d=this.length();return 0===d||1===d?(h._x=this._x,h._y=this._y,h._z=this._z,h._isDirty=!0,h):this.scaleToRef(1/d,h)}clone(){return new Z(this._x,this._y,this._z)}D(h){return this.xd(h._x,h._y,h._z)}xd(h,d,m){return this._x=h,this._y=d,this._z=m,this._isDirty=!0,this}set(h,d,m){return this.xd(h,d,m)}sd(h){return this._x=this._y=this._z=h,this._isDirty=!0,this}static GetClipFactor(h,d,m,j){const A=Z.Dot(h,m);return(A-j)/(A-Z.Dot(d,m))}static GetAngleBetweenVectors(h,d,m){const j=h.normalizeToRef(v.Qd[1]),A=d.normalizeToRef(v.Qd[2]);let b=Z.Dot(j,A);b=(0,D.Clamp)(b,-1,1);const w=Math.acos(b),a=v.Qd[3];return Z.CrossToRef(j,A,a),Z.Dot(a,m)>0?isNaN(w)?0:w:isNaN(w)?-Math.PI:-Math.acos(b)}static GetAngleBetweenVectorsOnPlane(h,d,m){v.Qd[0].D(h);const j=v.Qd[0];v.Qd[1].D(d);const A=v.Qd[1];v.Qd[2].D(m);const b=v.Qd[2],w=v.Qd[3],a=v.Qd[4];j.normalize(),A.normalize(),b.normalize(),Z.CrossToRef(b,j,w),Z.CrossToRef(w,b,a);const S=Math.atan2(Z.Dot(A,w),Z.Dot(A,a));return(0,D.NormalizeRadians)(S)}static PitchYawRollToMoveBetweenPointsToRef(h,d,m){const j=C.Qd[0];return d.subtractToRef(h,j),m._y=Math.atan2(j.x,j.z)||0,m._x=Math.atan2(Math.sqrt(j.x**2+j.z**2),j.y)||0,m._z=0,m._isDirty=!0,m}static PitchYawRollToMoveBetweenPoints(h,d){const m=Z.Zero();return Z.PitchYawRollToMoveBetweenPointsToRef(h,d,m)}static SlerpToRef(h,d,m,A){m=(0,D.Clamp)(m,0,1);const b=v.Qd[0],w=v.Qd[1];b.D(h);const a=b.length();b.normalizeFromLength(a),w.D(d);const S=w.length();w.normalizeFromLength(S);const M=Z.Dot(b,w);let q,E;if(M<1-j.c){const h=Math.acos(M),d=1/Math.sin(h);q=Math.sin((1-m)*h)*d,E=Math.sin(m*h)*d}else q=1-m,E=m;return b.scaleInPlace(q),w.scaleInPlace(E),A.D(b).addInPlace(w),A.scaleInPlace((0,D.Lerp)(a,S,m)),A}static SmoothToRef(h,d,m,j,A){return Z.SlerpToRef(h,d,0===j?1:m/j,A),A}static Ud(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Z(h[d],h[d+1],h[d+2])}static FromFloatArray(h,d){return Z.Ud(h,d)}static FromArrayToRef(h,d,m){return m._x=h[d],m._y=h[d+1],m._z=h[d+2],m._isDirty=!0,m}static FromFloatArrayToRef(h,d,m){return Z.FromArrayToRef(h,d,m)}static FromFloatsToRef(h,d,m,j){return j.xd(h,d,m),j}static Zero(){return new Z(0,0,0)}static One(){return new Z(1,1,1)}static Up(){return new Z(0,1,0)}static get UpReadOnly(){return Z._UpReadOnly}static get DownReadOnly(){return Z._DownReadOnly}static get RightReadOnly(){return Z._RightReadOnly}static get LeftReadOnly(){return Z._LeftReadOnly}static get LeftHandedForwardReadOnly(){return Z._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return Z._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return Z._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return Z._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return Z._ZeroReadOnly}static get OneReadOnly(){return Z._OneReadOnly}static Down(){return new Z(0,-1,0)}static Forward(){return new Z(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new Z(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new Z(1,0,0)}static Left(){return new Z(-1,0,0)}static Random(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Z((0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d))}static RandomToRef(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).xd((0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d))}static TransformCoordinates(h,d){const m=Z.Zero();return Z.TransformCoordinatesToRef(h,d,m),m}static TransformCoordinatesToRef(h,d,m){return Z.TransformCoordinatesFromFloatsToRef(h._x,h._y,h._z,d,m),m}static TransformCoordinatesFromFloatsToRef(h,d,m,j,A){const b=j.m,w=h*b[0]+d*b[4]+m*b[8]+b[12],a=h*b[1]+d*b[5]+m*b[9]+b[13],D=h*b[2]+d*b[6]+m*b[10]+b[14],S=1/(h*b[3]+d*b[7]+m*b[11]+b[15]);return A._x=w*S,A._y=a*S,A._z=D*S,A._isDirty=!0,A}static TransformNormal(h,d){const m=Z.Zero();return Z.TransformNormalToRef(h,d,m),m}static TransformNormalToRef(h,d,m){return this.TransformNormalFromFloatsToRef(h._x,h._y,h._z,d,m),m}static TransformNormalFromFloatsToRef(h,d,m,j,A){const b=j.m;return A._x=h*b[0]+d*b[4]+m*b[8],A._y=h*b[1]+d*b[5]+m*b[9],A._z=h*b[2]+d*b[6]+m*b[10],A._isDirty=!0,A}static CatmullRom(h,d,m,j,A){const b=A*A,w=A*b,a=.5*(2*d._x+(-h._x+m._x)*A+(2*h._x-5*d._x+4*m._x-j._x)*b+(-h._x+3*d._x-3*m._x+j._x)*w),D=.5*(2*d._y+(-h._y+m._y)*A+(2*h._y-5*d._y+4*m._y-j._y)*b+(-h._y+3*d._y-3*m._y+j._y)*w),S=.5*(2*d._z+(-h._z+m._z)*A+(2*h._z-5*d._z+4*m._z-j._z)*b+(-h._z+3*d._z-3*m._z+j._z)*w);return new Z(a,D,S)}static Clamp(h,d,m){const j=new Z;return Z.ClampToRef(h,d,m,j),j}static ClampToRef(h,d,m,j){let A=h._x;A=A>m._x?m._x:A,A=A<d._x?d._x:A;let b=h._y;b=b>m._y?m._y:b,b=b<d._y?d._y:b;let w=h._z;return w=w>m._z?m._z:w,w=w<d._z?d._z:w,j.xd(A,b,w),j}static CheckExtends(h,d,m){d.minimizeInPlace(h),m.maximizeInPlace(h)}static Hermite(h,d,m,j,A){const b=A*A,w=A*b,a=2*w-3*b+1,D=-2*w+3*b,S=w-2*b+A,M=w-b,q=h._x*a+m._x*D+d._x*S+j._x*M,E=h._y*a+m._y*D+d._y*S+j._y*M,I=h._z*a+m._z*D+d._z*S+j._z*M;return new Z(q,E,I)}static Hermite1stDerivative(h,d,m,j,A){const b=new Z;return this.Hermite1stDerivativeToRef(h,d,m,j,A,b),b}static Hermite1stDerivativeToRef(h,d,m,j,A,b){const w=A*A;return b._x=6*(w-A)*h._x+(3*w-4*A+1)*d._x+6*(-w+A)*m._x+(3*w-2*A)*j._x,b._y=6*(w-A)*h._y+(3*w-4*A+1)*d._y+6*(-w+A)*m._y+(3*w-2*A)*j._y,b._z=6*(w-A)*h._z+(3*w-4*A+1)*d._z+6*(-w+A)*m._z+(3*w-2*A)*j._z,b._isDirty=!0,b}static Lerp(h,d,m){const j=new Z(0,0,0);return Z.LerpToRef(h,d,m,j),j}static LerpToRef(h,d,m,j){return j._x=h._x+(d._x-h._x)*m,j._y=h._y+(d._y-h._y)*m,j._z=h._z+(d._z-h._z)*m,j._isDirty=!0,j}static Dot(h,d){return h._x*d._x+h._y*d._y+h._z*d._z}dot(h){return this._x*h._x+this._y*h._y+this._z*h._z}static Cross(h,d){const m=new Z;return Z.CrossToRef(h,d,m),m}static CrossToRef(h,d,m){const j=h._y*d._z-h._z*d._y,A=h._z*d._x-h._x*d._z,b=h._x*d._y-h._y*d._x;return m.xd(j,A,b),m}static Normalize(h){const d=Z.Zero();return Z.NormalizeToRef(h,d),d}static NormalizeToRef(h,d){return h.normalizeToRef(d),d}static Project(h,d,m,j){const A=new Z;return Z.ProjectToRef(h,d,m,j,A),A}static ProjectToRef(h,d,m,j,A){var b;const w=j.width,D=j.height,S=j.x,M=j.y,q=v.Matrix[1],E=null===(b=a.b.LastCreatedEngine)||void 0===b?void 0:b.isNDCHalfZRange,I=E?1:.5,R=E?0:.5;V.FromValuesToRef(w/2,0,0,0,0,-D/2,0,0,0,0,I,0,S+w/2,D/2+M,R,1,q);const L=v.Matrix[0];return d.multiplyToRef(m,L),L.multiplyToRef(q,L),Z.TransformCoordinatesToRef(h,L,A),A}static Reflect(h,d){return this.ReflectToRef(h,d,new Z)}static ReflectToRef(h,d,m){const j=C.Qd[0];return j.D(d).scaleInPlace(2*Z.Dot(h,d)),m.D(h).Dq(j)}static _UnprojectFromInvertedMatrixToRef(h,d,m){Z.TransformCoordinatesToRef(h,d,m);const j=d.m,A=h._x*j[3]+h._y*j[7]+h._z*j[11]+j[15];return(0,D.WithinEpsilon)(A,1)&&m.scaleInPlace(1/A),m}static UnprojectFromTransform(h,d,m,j,A){return this.Unproject(h,d,m,j,A,V.IdentityReadOnly)}static Unproject(h,d,m,j,A,b){const w=new Z;return Z.UnprojectToRef(h,d,m,j,A,b,w),w}static UnprojectToRef(h,d,m,j,A,b,w){return Z.UnprojectFloatsToRef(h._x,h._y,h._z,d,m,j,A,b,w),w}static UnprojectFloatsToRef(h,d,m,j,A,b,w,D,S){var M;const q=v.Matrix[0];b.multiplyToRef(w,q),q.multiplyToRef(D,q),q.invert();const E=v.Qd[0];return E.x=h/j*2-1,E.y=-(d/A*2-1),null!==(M=a.b.LastCreatedEngine)&&void 0!==M&&M.isNDCHalfZRange?E.z=m:E.z=2*m-1,Z._UnprojectFromInvertedMatrixToRef(E,q,S),S}static Minimize(h,d){const m=new Z;return m.D(h),m.minimizeInPlace(d),m}static Maximize(h,d){const m=new Z;return m.D(h),m.maximizeInPlace(d),m}static Distance(h,d){return Math.sqrt(Z.DistanceSquared(h,d))}static DistanceSquared(h,d){const m=h._x-d._x,j=h._y-d._y,A=h._z-d._z;return m*m+j*j+A*A}static ProjectOnTriangleToRef(h,d,m,A,b){const w=v.Qd[0],a=v.Qd[1],S=v.Qd[2],M=v.Qd[3],q=v.Qd[4];m.subtractToRef(d,w),A.subtractToRef(d,a),A.subtractToRef(m,S);const E=w.length(),I=a.length(),R=S.length();if(E<j.c||I<j.c||R<j.c)return b.D(d),Z.Distance(h,d);h.subtractToRef(d,q),Z.CrossToRef(w,a,M);const L=M.length();if(L<j.c)return b.D(d),Z.Distance(h,d);M.normalizeFromLength(L);let B=q.length();if(B<j.c)return b.D(d),0;q.normalizeFromLength(B);const V=Z.Dot(M,q),C=v.Qd[5],T=v.Qd[6];C.D(M).scaleInPlace(-B*V),T.D(h).addInPlace(C);const o=v.Qd[4],y=v.Qd[5],i=v.Qd[7],g=v.Qd[8];o.D(w).scaleInPlace(1/E),g.D(a).scaleInPlace(1/I),o.addInPlace(g).scaleInPlace(-1),y.D(w).scaleInPlace(-1/E),g.D(S).scaleInPlace(1/R),y.addInPlace(g).scaleInPlace(-1),i.D(S).scaleInPlace(-1/R),g.D(a).scaleInPlace(-1/I),i.addInPlace(g).scaleInPlace(-1);const F=v.Qd[9];let f;F.D(T).Dq(d),Z.CrossToRef(o,F,g),f=Z.Dot(g,M);const H=f;F.D(T).Dq(m),Z.CrossToRef(y,F,g),f=Z.Dot(g,M);const c=f;F.D(T).Dq(A),Z.CrossToRef(i,F,g),f=Z.Dot(g,M);const k=f,l=v.Qd[10];let K,N;H>0&&c<0?(l.D(w),K=d,N=m):c>0&&k<0?(l.D(S),K=m,N=A):(l.D(a).scaleInPlace(-1),K=A,N=d);const W=v.Qd[9],r=v.Qd[4];K.subtractToRef(T,g),N.subtractToRef(T,W),Z.CrossToRef(g,W,r);if(!(Z.Dot(r,M)<0))return b.D(T),Math.abs(B*V);const Y=v.Qd[5];Z.CrossToRef(l,r,Y),Y.normalize();const x=v.Qd[9];x.D(K).Dq(T);const Q=x.length();if(Q<j.c)return b.D(K),Z.Distance(h,K);x.normalizeFromLength(Q);const t=Z.Dot(Y,x),U=v.Qd[7];U.D(T).addInPlace(Y.scaleInPlace(Q*t)),g.D(U).Dq(K),B=l.length(),l.normalizeFromLength(B);let s=Z.Dot(g,l)/Math.max(B,j.c);return s=(0,D.Clamp)(s,0,1),U.D(K).addInPlace(l.scaleInPlace(s*B)),b.D(U),Z.Distance(h,U)}static Center(h,d){return Z.CenterToRef(h,d,Z.Zero())}static CenterToRef(h,d,m){return m.xd((h._x+d._x)/2,(h._y+d._y)/2,(h._z+d._z)/2)}static RotationFromAxis(h,d,m){const j=new Z;return Z.RotationFromAxisToRef(h,d,m,j),j}static RotationFromAxisToRef(h,d,m,j){const A=v.Quaternion[0];return B.RotationQuaternionFromAxisToRef(h,d,m,A),A.toEulerAnglesToRef(j),j}}Z._V8PerformanceHack=new Z(.5,.5,.5),Z._UpReadOnly=Z.Up(),Z._DownReadOnly=Z.Down(),Z._LeftHandedForwardReadOnly=Z.Forward(!1),Z._RightHandedForwardReadOnly=Z.Forward(!0),Z._LeftHandedBackwardReadOnly=Z.Backward(!1),Z._RightHandedBackwardReadOnly=Z.Backward(!0),Z._RightReadOnly=Z.Right(),Z._LeftReadOnly=Z.Left(),Z._ZeroReadOnly=Z.Zero(),Z._OneReadOnly=Z.One(),Object.defineProperties(Z.prototype,{dimension:{value:[3]},rank:{value:1}});class L{get x(){return this._x}set x(h){this._x=h,this._isDirty=!0}get y(){return this._y}set y(h){this._y=h,this._isDirty=!0}get z(){return this._z}set z(h){this._z=h,this._isDirty=!0}get w(){return this._w}set w(h){this._w=h,this._isDirty=!0}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._isDirty=!0,this._x=h,this._y=d,this._z=m,this._w=j}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Vector4"}getHashCode(){let h=I(this._x);return h=397*h^I(this._y),h=397*h^I(this._z),h=397*h^I(this._w),h}fd(){return[this._x,this._y,this._z,this._w]}toArray(h,d){return void 0===d&&(d=0),h[d]=this._x,h[d+1]=this._y,h[d+2]=this._z,h[d+3]=this._w,this}Hm(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return L.FromArrayToRef(h,d,this),this}addInPlace(h){return this.x+=h._x,this.y+=h._y,this.z+=h._z,this.w+=h._w,this}addInPlaceFromFloats(h,d,m,j){return this.x+=h,this.y+=d,this.z+=m,this.w+=j,this}add(h){return new L(this._x+h.x,this._y+h.y,this._z+h.z,this._w+h.w)}addToRef(h,d){return d.x=this._x+h.x,d.y=this._y+h.y,d.z=this._z+h.z,d.w=this._w+h.w,d}Dq(h){return this.x-=h.x,this.y-=h.y,this.z-=h.z,this.w-=h.w,this}fm(h){return new L(this._x-h.x,this._y-h.y,this._z-h.z,this._w-h.w)}subtractToRef(h,d){return d.x=this._x-h.x,d.y=this._y-h.y,d.z=this._z-h.z,d.w=this._w-h.w,d}subtractFromFloats(h,d,m,j){return new L(this._x-h,this._y-d,this._z-m,this._w-j)}subtractFromFloatsToRef(h,d,m,j,A){return A.x=this._x-h,A.y=this._y-d,A.z=this._z-m,A.w=this._w-j,A}negate(){return new L(-this._x,-this._y,-this._z,-this._w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(h){return h.x=-this._x,h.y=-this._y,h.z=-this._z,h.w=-this._w,h}scaleInPlace(h){return this.x*=h,this.y*=h,this.z*=h,this.w*=h,this}scale(h){return new L(this._x*h,this._y*h,this._z*h,this._w*h)}scaleToRef(h,d){return d.x=this._x*h,d.y=this._y*h,d.z=this._z*h,d.w=this._w*h,d}scaleAndAddToRef(h,d){return d.x+=this._x*h,d.y+=this._y*h,d.z+=this._z*h,d.w+=this._w*h,d}equals(h){return h&&this._x===h.x&&this._y===h.y&&this._z===h.z&&this._w===h.w}equalsWithEpsilon(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.c;return h&&(0,D.WithinEpsilon)(this._x,h.x,d)&&(0,D.WithinEpsilon)(this._y,h.y,d)&&(0,D.WithinEpsilon)(this._z,h.z,d)&&(0,D.WithinEpsilon)(this._w,h.w,d)}equalsToFloats(h,d,m,j){return this._x===h&&this._y===d&&this._z===m&&this._w===j}multiplyInPlace(h){return this.x*=h.x,this.y*=h.y,this.z*=h.z,this.w*=h.w,this}multiply(h){return new L(this._x*h.x,this._y*h.y,this._z*h.z,this._w*h.w)}multiplyToRef(h,d){return d.x=this._x*h.x,d.y=this._y*h.y,d.z=this._z*h.z,d.w=this._w*h.w,d}multiplyByFloats(h,d,m,j){return new L(this._x*h,this._y*d,this._z*m,this._w*j)}divide(h){return new L(this._x/h.x,this._y/h.y,this._z/h.z,this._w/h.w)}divideToRef(h,d){return d.x=this._x/h.x,d.y=this._y/h.y,d.z=this._z/h.z,d.w=this._w/h.w,d}divideInPlace(h){return this.divideToRef(h,this)}minimizeInPlace(h){return h.x<this._x&&(this.x=h.x),h.y<this._y&&(this.y=h.y),h.z<this._z&&(this.z=h.z),h.w<this._w&&(this.w=h.w),this}maximizeInPlace(h){return h.x>this._x&&(this.x=h.x),h.y>this._y&&(this.y=h.y),h.z>this._z&&(this.z=h.z),h.w>this._w&&(this.w=h.w),this}minimizeInPlaceFromFloats(h,d,m,j){return this.x=Math.min(h,this._x),this.y=Math.min(d,this._y),this.z=Math.min(m,this._z),this.w=Math.min(j,this._w),this}maximizeInPlaceFromFloats(h,d,m,j){return this.x=Math.max(h,this._x),this.y=Math.max(d,this._y),this.z=Math.max(m,this._z),this.w=Math.max(j,this._w),this}floorToRef(h){return h.x=Math.floor(this._x),h.y=Math.floor(this._y),h.z=Math.floor(this._z),h.w=Math.floor(this._w),h}floor(){return new L(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),Math.floor(this._w))}fractToRef(h){return h.x=this._x-Math.floor(this._x),h.y=this._y-Math.floor(this._y),h.z=this._z-Math.floor(this._z),h.w=this._w-Math.floor(this._w),h}fract(){return new L(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z),this._w-Math.floor(this._w))}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(h){return 0===h||1===h?this:this.scaleInPlace(1/h)}normalizeToNew(){return this.normalizeToRef(new L)}normalizeToRef(h){const d=this.length();return 0===d||1===d?(h.x=this._x,h.y=this._y,h.z=this._z,h.w=this._w,h):this.scaleToRef(1/d,h)}toVector3(){return new Z(this._x,this._y,this._z)}clone(){return new L(this._x,this._y,this._z,this._w)}D(h){return this.x=h.x,this.y=h.y,this.z=h.z,this.w=h.w,this}xd(h,d,m,j){return this.x=h,this.y=d,this.z=m,this.w=j,this}set(h,d,m,j){return this.xd(h,d,m,j)}sd(h){return this.x=this.y=this.z=this.w=h,this}dot(h){return this._x*h.x+this._y*h.y+this._z*h.z+this._w*h.w}static Ud(h,d){return d||(d=0),new L(h[d],h[d+1],h[d+2],h[d+3])}static FromArrayToRef(h,d,m){return m.x=h[d],m.y=h[d+1],m.z=h[d+2],m.w=h[d+3],m}static FromFloatArrayToRef(h,d,m){return L.FromArrayToRef(h,d,m),m}static FromFloatsToRef(h,d,m,j,A){return A.x=h,A.y=d,A.z=m,A.w=j,A}static Zero(){return new L(0,0,0,0)}static One(){return new L(1,1,1,1)}static Random(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new L((0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d))}static RandomToRef(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m=arguments.length>2?arguments[2]:void 0;return m.x=(0,D.RandomRange)(h,d),m.y=(0,D.RandomRange)(h,d),m.z=(0,D.RandomRange)(h,d),m.w=(0,D.RandomRange)(h,d),m}static Clamp(h,d,m){return L.ClampToRef(h,d,m,new L)}static ClampToRef(h,d,m,j){return j.x=(0,D.Clamp)(h.x,d.x,m.x),j.y=(0,D.Clamp)(h.y,d.y,m.y),j.z=(0,D.Clamp)(h.z,d.z,m.z),j.w=(0,D.Clamp)(h.w,d.w,m.w),j}static CheckExtends(h,d,m){d.minimizeInPlace(h),m.maximizeInPlace(h)}static get ZeroReadOnly(){return L._ZeroReadOnly}static Normalize(h){return L.NormalizeToRef(h,new L)}static NormalizeToRef(h,d){return h.normalizeToRef(d),d}static Minimize(h,d){const m=new L;return m.D(h),m.minimizeInPlace(d),m}static Maximize(h,d){const m=new L;return m.D(h),m.maximizeInPlace(d),m}static Distance(h,d){return Math.sqrt(L.DistanceSquared(h,d))}static DistanceSquared(h,d){const m=h.x-d.x,j=h.y-d.y,A=h.z-d.z,b=h.w-d.w;return m*m+j*j+A*A+b*b}static Center(h,d){return L.CenterToRef(h,d,new L)}static CenterToRef(h,d,m){return m.x=(h.x+d.x)/2,m.y=(h.y+d.y)/2,m.z=(h.z+d.z)/2,m.w=(h.w+d.w)/2,m}static TransformCoordinates(h,d){return L.TransformCoordinatesToRef(h,d,new L)}static TransformCoordinatesToRef(h,d,m){return L.TransformCoordinatesFromFloatsToRef(h._x,h._y,h._z,d,m),m}static TransformCoordinatesFromFloatsToRef(h,d,m,j,A){const b=j.m,w=h*b[0]+d*b[4]+m*b[8]+b[12],a=h*b[1]+d*b[5]+m*b[9]+b[13],D=h*b[2]+d*b[6]+m*b[10]+b[14],S=h*b[3]+d*b[7]+m*b[11]+b[15];return A.x=w,A.y=a,A.z=D,A.w=S,A}static TransformNormal(h,d){return L.TransformNormalToRef(h,d,new L)}static TransformNormalToRef(h,d,m){const j=d.m,A=h.x*j[0]+h.y*j[4]+h.z*j[8],b=h.x*j[1]+h.y*j[5]+h.z*j[9],w=h.x*j[2]+h.y*j[6]+h.z*j[10];return m.x=A,m.y=b,m.z=w,m.w=h.w,m}static TransformNormalFromFloatsToRef(h,d,m,j,A,b){const w=A.m;return b.x=h*w[0]+d*w[4]+m*w[8],b.y=h*w[1]+d*w[5]+m*w[9],b.z=h*w[2]+d*w[6]+m*w[10],b.w=j,b}static FromVector3(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new L(h._x,h._y,h._z,d)}static Dot(h,d){return h.x*d.x+h.y*d.y+h.z*d.z+h.w*d.w}}L._V8PerformanceHack=new L(.5,.5,.5,.5),L._ZeroReadOnly=L.Zero(),Object.defineProperties(L.prototype,{dimension:{value:[4]},rank:{value:1}});class B{get x(){return this._x}set x(h){this._x=h,this._isDirty=!0}get y(){return this._y}set y(h){this._y=h,this._isDirty=!0}get z(){return this._z}set z(h){this._z=h,this._isDirty=!0}get w(){return this._w}set w(h){this._w=h,this._isDirty=!0}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=h,this._y=d,this._z=m,this._w=j}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let h=I(this._x);return h=397*h^I(this._y),h=397*h^I(this._z),h=397*h^I(this._w),h}fd(){return[this._x,this._y,this._z,this._w]}toArray(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return h[d]=this._x,h[d+1]=this._y,h[d+2]=this._z,h[d+3]=this._w,this}Hm(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return B.FromArrayToRef(h,d,this)}equals(h){return h&&this._x===h._x&&this._y===h._y&&this._z===h._z&&this._w===h._w}equalsWithEpsilon(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.c;return h&&(0,D.WithinEpsilon)(this._x,h._x,d)&&(0,D.WithinEpsilon)(this._y,h._y,d)&&(0,D.WithinEpsilon)(this._z,h._z,d)&&(0,D.WithinEpsilon)(this._w,h._w,d)}isApprox(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.c;return h&&((0,D.WithinEpsilon)(this._x,h._x,d)&&(0,D.WithinEpsilon)(this._y,h._y,d)&&(0,D.WithinEpsilon)(this._z,h._z,d)&&(0,D.WithinEpsilon)(this._w,h._w,d)||(0,D.WithinEpsilon)(this._x,-h._x,d)&&(0,D.WithinEpsilon)(this._y,-h._y,d)&&(0,D.WithinEpsilon)(this._z,-h._z,d)&&(0,D.WithinEpsilon)(this._w,-h._w,d))}clone(){return new B(this._x,this._y,this._z,this._w)}D(h){return this._x=h._x,this._y=h._y,this._z=h._z,this._w=h._w,this._isDirty=!0,this}xd(h,d,m,j){return this._x=h,this._y=d,this._z=m,this._w=j,this._isDirty=!0,this}set(h,d,m,j){return this.xd(h,d,m,j)}sd(h){return this.xd(h,h,h,h)}add(h){return new B(this._x+h._x,this._y+h._y,this._z+h._z,this._w+h._w)}addInPlace(h){return this._x+=h._x,this._y+=h._y,this._z+=h._z,this._w+=h._w,this._isDirty=!0,this}addToRef(h,d){return d._x=this._x+h._x,d._y=this._y+h._y,d._z=this._z+h._z,d._w=this._w+h._w,d._isDirty=!0,d}addInPlaceFromFloats(h,d,m,j){return this._x+=h,this._y+=d,this._z+=m,this._w+=j,this._isDirty=!0,this}subtractToRef(h,d){return d._x=this._x-h._x,d._y=this._y-h._y,d._z=this._z-h._z,d._w=this._w-h._w,d._isDirty=!0,d}subtractFromFloats(h,d,m,j){return this.subtractFromFloatsToRef(h,d,m,j,new B)}subtractFromFloatsToRef(h,d,m,j,A){return A._x=this._x-h,A._y=this._y-d,A._z=this._z-m,A._w=this._w-j,A._isDirty=!0,A}fm(h){return new B(this._x-h._x,this._y-h._y,this._z-h._z,this._w-h._w)}Dq(h){return this._x-=h._x,this._y-=h._y,this._z-=h._z,this._w-=h._w,this._isDirty=!0,this}scale(h){return new B(this._x*h,this._y*h,this._z*h,this._w*h)}scaleToRef(h,d){return d._x=this._x*h,d._y=this._y*h,d._z=this._z*h,d._w=this._w*h,d._isDirty=!0,d}scaleInPlace(h){return this._x*=h,this._y*=h,this._z*=h,this._w*=h,this._isDirty=!0,this}scaleAndAddToRef(h,d){return d._x+=this._x*h,d._y+=this._y*h,d._z+=this._z*h,d._w+=this._w*h,d._isDirty=!0,d}multiply(h){const d=new B(0,0,0,1);return this.multiplyToRef(h,d),d}multiplyToRef(h,d){const m=this._x*h._w+this._y*h._z-this._z*h._y+this._w*h._x,j=-this._x*h._z+this._y*h._w+this._z*h._x+this._w*h._y,A=this._x*h._y-this._y*h._x+this._z*h._w+this._w*h._z,b=-this._x*h._x-this._y*h._y-this._z*h._z+this._w*h._w;return d.xd(m,j,A,b),d}multiplyInPlace(h){return this.multiplyToRef(h,this)}multiplyByFloats(h,d,m,j){return this._x*=h,this._y*=d,this._z*=m,this._w*=j,this._isDirty=!0,this}divide(h){throw new ReferenceError("Can not divide a quaternion")}divideToRef(h,d){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(h){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new B)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(h){return h._x=-this._x,h._y=-this._y,h._z=-this._z,h._w=-this._w,h._isDirty=!0,h}equalsToFloats(h,d,m,j){return this._x===h&&this._y===d&&this._z===m&&this._w===j}floorToRef(h){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(h){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(h){return h.xd(-this._x,-this._y,-this._z,this._w),h}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new B(-this._x,-this._y,-this._z,this._w)}invert(){const h=this.conjugate(),d=this.lengthSquared();return 0==d||1==d||h.scaleInPlace(1/d),h}invertInPlace(){this.conjugateInPlace();const h=this.lengthSquared();return 0==h||1==h||this.scaleInPlace(1/h),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(h){return 0===h||1===h?this:this.scaleInPlace(1/h)}normalizeToNew(){const h=new B(0,0,0,1);return this.normalizeToRef(h),h}normalizeToRef(h){const d=this.length();return 0===d||1===d?h.xd(this._x,this._y,this._z,this._w):this.scaleToRef(1/d,h)}toEulerAngles(){const h=Z.Zero();return this.toEulerAnglesToRef(h),h}toEulerAnglesToRef(h){const d=this._z,m=this._x,j=this._y,A=this._w,b=j*d-m*A,w=.4999999;if(b<-w)h._y=2*Math.atan2(j,A),h._x=Math.PI/2,h._z=0,h._isDirty=!0;else if(b>w)h._y=2*Math.atan2(j,A),h._x=-Math.PI/2,h._z=0,h._isDirty=!0;else{const w=A*A,a=d*d,D=m*m,S=j*j;h._z=Math.atan2(2*(m*j+d*A),-a-D+S+w),h._x=Math.asin(-2*b),h._y=Math.atan2(2*(d*m+j*A),a-D-S+w),h._isDirty=!0}return h}toAlphaBetaGammaToRef(h){const d=this._z,m=this._x,j=this._y,A=this._w,b=Math.sqrt(m*m+j*j),w=Math.sqrt(d*d+A*A),a=2*Math.atan2(b,w),D=2*Math.atan2(d,A),S=2*Math.atan2(j,m),M=(D+S)/2,q=(D-S)/2;return h.set(q,a,M),h}toRotationMatrix(h){return V.FromQuaternionToRef(this,h),h}fromRotationMatrix(h){return B.FromRotationMatrixToRef(h,this),this}dot(h){return this._x*h._x+this._y*h._y+this._z*h._z+this._w*h._w}toAxisAngle(){const h=Z.Zero();return{axis:h,angle:this.toAxisAngleToRef(h)}}toAxisAngleToRef(h){let d=0;const m=Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z),j=this._w;return m>0?(d=2*Math.atan2(m,j),h.set(this._x/m,this._y/m,this._z/m)):(d=0,h.set(1,0,0)),d}static FromRotationMatrix(h){const d=new B;return B.FromRotationMatrixToRef(h,d),d}static FromRotationMatrixToRef(h,d){const m=h.m,j=m[0],A=m[4],b=m[8],w=m[1],a=m[5],D=m[9],S=m[2],M=m[6],q=m[10],E=j+a+q;let I;return E>0?(I=.5/Math.sqrt(E+1),d._w=.25/I,d._x=(M-D)*I,d._y=(b-S)*I,d._z=(w-A)*I,d._isDirty=!0):j>a&&j>q?(I=2*Math.sqrt(1+j-a-q),d._w=(M-D)/I,d._x=.25*I,d._y=(A+w)/I,d._z=(b+S)/I,d._isDirty=!0):a>q?(I=2*Math.sqrt(1+a-j-q),d._w=(b-S)/I,d._x=(A+w)/I,d._y=.25*I,d._z=(D+M)/I,d._isDirty=!0):(I=2*Math.sqrt(1+q-j-a),d._w=(w-A)/I,d._x=(b+S)/I,d._y=(D+M)/I,d._z=.25*I,d._isDirty=!0),d}static Dot(h,d){return h._x*d._x+h._y*d._y+h._z*d._z+h._w*d._w}static AreClose(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const j=B.Dot(h,d);return 1-j*j<=m}static SmoothToRef(h,d,m,j,A){let b=0===j?1:m/j;return b=(0,D.Clamp)(b,0,1),B.SlerpToRef(h,d,b,A),A}static Zero(){return new B(0,0,0,0)}static Inverse(h){return new B(-h._x,-h._y,-h._z,h._w)}static InverseToRef(h,d){return d.set(-h._x,-h._y,-h._z,h._w),d}static Identity(){return new B(0,0,0,1)}static IsIdentity(h){return h&&0===h._x&&0===h._y&&0===h._z&&1===h._w}static RotationAxis(h,d){return B.RotationAxisToRef(h,d,new B)}static RotationAxisToRef(h,d,m){m._w=Math.cos(d/2);const j=Math.sin(d/2)/h.length();return m._x=h._x*j,m._y=h._y*j,m._z=h._z*j,m._isDirty=!0,m}static Ud(h,d){return d||(d=0),new B(h[d],h[d+1],h[d+2],h[d+3])}static FromArrayToRef(h,d,m){return m._x=h[d],m._y=h[d+1],m._z=h[d+2],m._w=h[d+3],m._isDirty=!0,m}static FromFloatsToRef(h,d,m,j,A){return A.xd(h,d,m,j),A}static FromEulerAngles(h,d,m){const j=new B;return B.RotationYawPitchRollToRef(d,h,m,j),j}static FromEulerAnglesToRef(h,d,m,j){return B.RotationYawPitchRollToRef(d,h,m,j),j}static FromEulerVector(h){const d=new B;return B.RotationYawPitchRollToRef(h._y,h._x,h._z,d),d}static FromEulerVectorToRef(h,d){return B.RotationYawPitchRollToRef(h._y,h._x,h._z,d),d}static FromUnitVectorsToRef(h,d,m){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:j.c;const b=Z.Dot(h,d)+1;return b<A?Math.abs(h.x)>Math.abs(h.z)?m.set(-h.y,h.x,0,0):m.set(0,-h.z,h.y,0):(Z.CrossToRef(h,d,C.Qd[0]),m.set(C.Qd[0].x,C.Qd[0].y,C.Qd[0].z,b)),m.normalize()}static RotationYawPitchRoll(h,d,m){const j=new B;return B.RotationYawPitchRollToRef(h,d,m,j),j}static RotationYawPitchRollToRef(h,d,m,j){const A=.5*m,b=.5*d,w=.5*h,a=Math.sin(A),D=Math.cos(A),S=Math.sin(b),M=Math.cos(b),q=Math.sin(w),E=Math.cos(w);return j._x=E*S*D+q*M*a,j._y=q*M*D-E*S*a,j._z=E*M*a-q*S*D,j._w=E*M*D+q*S*a,j._isDirty=!0,j}static RotationAlphaBetaGamma(h,d,m){const j=new B;return B.RotationAlphaBetaGammaToRef(h,d,m,j),j}static RotationAlphaBetaGammaToRef(h,d,m,j){const A=.5*(m+h),b=.5*(m-h),w=.5*d;return j._x=Math.cos(b)*Math.sin(w),j._y=Math.sin(b)*Math.sin(w),j._z=Math.sin(A)*Math.cos(w),j._w=Math.cos(A)*Math.cos(w),j._isDirty=!0,j}static RotationQuaternionFromAxis(h,d,m){const j=new B(0,0,0,0);return B.RotationQuaternionFromAxisToRef(h,d,m,j),j}static RotationQuaternionFromAxisToRef(h,d,m,j){const A=v.Matrix[0];return h=h.normalizeToRef(v.Qd[0]),d=d.normalizeToRef(v.Qd[1]),m=m.normalizeToRef(v.Qd[2]),V.FromXYZAxesToRef(h,d,m,A),B.FromRotationMatrixToRef(A,j),j}static FromLookDirectionLH(h,d){const m=new B;return B.FromLookDirectionLHToRef(h,d,m),m}static FromLookDirectionLHToRef(h,d,m){const j=v.Matrix[0];return V.LookDirectionLHToRef(h,d,j),B.FromRotationMatrixToRef(j,m),m}static FromLookDirectionRH(h,d){const m=new B;return B.FromLookDirectionRHToRef(h,d,m),m}static FromLookDirectionRHToRef(h,d,m){const j=v.Matrix[0];return V.LookDirectionRHToRef(h,d,j),B.FromRotationMatrixToRef(j,m)}static Slerp(h,d,m){const j=B.Identity();return B.SlerpToRef(h,d,m,j),j}static SlerpToRef(h,d,m,j){let A,b,w=h._x*d._x+h._y*d._y+h._z*d._z+h._w*d._w,a=!1;if(w<0&&(a=!0,w=-w),w>.999999)b=1-m,A=a?-m:m;else{const h=Math.acos(w),d=1/Math.sin(h);b=Math.sin((1-m)*h)*d,A=a?-Math.sin(m*h)*d:Math.sin(m*h)*d}return j._x=b*h._x+A*d._x,j._y=b*h._y+A*d._y,j._z=b*h._z+A*d._z,j._w=b*h._w+A*d._w,j._isDirty=!0,j}static Hermite(h,d,m,j,A){const b=A*A,w=A*b,a=2*w-3*b+1,D=-2*w+3*b,S=w-2*b+A,M=w-b,q=h._x*a+m._x*D+d._x*S+j._x*M,E=h._y*a+m._y*D+d._y*S+j._y*M,I=h._z*a+m._z*D+d._z*S+j._z*M,R=h._w*a+m._w*D+d._w*S+j._w*M;return new B(q,E,I,R)}static Hermite1stDerivative(h,d,m,j,A){const b=new B;return this.Hermite1stDerivativeToRef(h,d,m,j,A,b),b}static Hermite1stDerivativeToRef(h,d,m,j,A,b){const w=A*A;return b._x=6*(w-A)*h._x+(3*w-4*A+1)*d._x+6*(-w+A)*m._x+(3*w-2*A)*j._x,b._y=6*(w-A)*h._y+(3*w-4*A+1)*d._y+6*(-w+A)*m._y+(3*w-2*A)*j._y,b._z=6*(w-A)*h._z+(3*w-4*A+1)*d._z+6*(-w+A)*m._z+(3*w-2*A)*j._z,b._w=6*(w-A)*h._w+(3*w-4*A+1)*d._w+6*(-w+A)*m._w+(3*w-2*A)*j._w,b._isDirty=!0,b}static Normalize(h){const d=B.Zero();return B.NormalizeToRef(h,d),d}static NormalizeToRef(h,d){return h.normalizeToRef(d),d}static Clamp(h,d,m){const j=new B;return B.ClampToRef(h,d,m,j),j}static ClampToRef(h,d,m,j){return j.xd((0,D.Clamp)(h.x,d.x,m.x),(0,D.Clamp)(h.y,d.y,m.y),(0,D.Clamp)(h.z,d.z,m.z),(0,D.Clamp)(h.w,d.w,m.w))}static Random(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new B((0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d))}static RandomToRef(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).xd((0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d),(0,D.RandomRange)(h,d))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(h,d){return Math.sqrt(B.DistanceSquared(h,d))}static DistanceSquared(h,d){const m=h.x-d.x,j=h.y-d.y,A=h.z-d.z,b=h.w-d.w;return m*m+j*j+A*A+b*b}static Center(h,d){return B.CenterToRef(h,d,B.Zero())}static CenterToRef(h,d,m){return m.xd((h.x+d.x)/2,(h.y+d.y)/2,(h.z+d.z)/2,(h.w+d.w)/2)}}B._V8PerformanceHack=new B(.5,.5,.5,.5),Object.defineProperties(B.prototype,{dimension:{value:[4]},rank:{value:1}});class V{static get Use64Bits(){return w.d.MatrixUse64Bits}get m(){return this.cE}markAsUpdated(){this.updateFlag=S._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=h,this._isIdentity3x2=h||m,this._isIdentityDirty=!this._isIdentity&&d,this._isIdentity3x2Dirty=!this._isIdentity3x2&&j}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,w.d.MatrixTrackPrecisionChange&&w.d.MatrixTrackedMatrices.push(this),this.cE=new w.d.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const h=this.cE;this._isIdentity=1===h[0]&&0===h[1]&&0===h[2]&&0===h[3]&&0===h[4]&&1===h[5]&&0===h[6]&&0===h[7]&&0===h[8]&&0===h[9]&&1===h[10]&&0===h[11]&&0===h[12]&&0===h[13]&&0===h[14]&&1===h[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.cE[0]||1!==this.cE[5]||1!==this.cE[15]||0!==this.cE[1]||0!==this.cE[2]||0!==this.cE[3]||0!==this.cE[4]||0!==this.cE[6]||0!==this.cE[7]||0!==this.cE[8]||0!==this.cE[9]||0!==this.cE[10]||0!==this.cE[11]||0!==this.cE[12]||0!==this.cE[13]||0!==this.cE[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const h=this.cE,d=h[0],m=h[1],j=h[2],A=h[3],b=h[4],w=h[5],a=h[6],D=h[7],S=h[8],M=h[9],q=h[10],E=h[11],I=h[12],R=h[13],Z=h[14],L=h[15],B=q*L-Z*E,V=M*L-R*E,v=M*Z-R*q,C=S*L-I*E,T=S*Z-q*I,o=S*R-I*M;return d*+(w*B-a*V+D*v)+m*-(b*B-a*C+D*T)+j*+(b*V-w*C+D*o)+A*-(b*v-w*T+a*o)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!h)return this.cE;const m=this.cE;for(let j=0;j<16;j++)h[d+j]=m[j];return this}fd(){return this.cE}Hm(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V.FromArrayToRef(h,d,this)}xd(){for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];return V.FromArrayToRef(d,0,this)}set(){const h=this.cE;for(let d=0;d<16;d++)h[d]=d<0||arguments.length<=d?void 0:arguments[d];return this.markAsUpdated(),this}sd(h){const d=this.cE;for(let m=0;m<16;m++)d[m]=h;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return V.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(h){const d=new V;return this.addToRef(h,d),d}addToRef(h,d){const m=this.cE,j=d.cE,A=h.m;for(let b=0;b<16;b++)j[b]=m[b]+A[b];return d.markAsUpdated(),d}addToSelf(h){const d=this.cE,m=h.m;return d[0]+=m[0],d[1]+=m[1],d[2]+=m[2],d[3]+=m[3],d[4]+=m[4],d[5]+=m[5],d[6]+=m[6],d[7]+=m[7],d[8]+=m[8],d[9]+=m[9],d[10]+=m[10],d[11]+=m[11],d[12]+=m[12],d[13]+=m[13],d[14]+=m[14],d[15]+=m[15],this.markAsUpdated(),this}addInPlace(h){const d=this.cE,m=h.m;for(let j=0;j<16;j++)d[j]+=m[j];return this.markAsUpdated(),this}addInPlaceFromFloats(){const h=this.cE;for(let d=0;d<16;d++)h[d]+=d<0||arguments.length<=d?void 0:arguments[d];return this.markAsUpdated(),this}fm(h){const d=this.cE,m=h.m;for(let j=0;j<16;j++)d[j]-=m[j];return this.markAsUpdated(),this}subtractToRef(h,d){const m=this.cE,j=h.m,A=d.cE;for(let b=0;b<16;b++)A[b]=m[b]-j[b];return d.markAsUpdated(),d}Dq(h){const d=this.cE,m=h.m;for(let j=0;j<16;j++)d[j]-=m[j];return this.markAsUpdated(),this}subtractFromFloats(){for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];return this.subtractFromFloatsToRef(...d,new V)}subtractFromFloatsToRef(){for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];const j=d.pop(),A=this.cE,b=j.cE,w=d;for(let a=0;a<16;a++)b[a]=A[a]-w[a];return j.markAsUpdated(),j}invertToRef(h){return!0===this._isIdentity?(V.IdentityToRef(h),h):(E(this,h.fd())?h.markAsUpdated():h.D(this),h)}addAtIndex(h,d){return this.cE[h]+=d,this.markAsUpdated(),this}multiplyAtIndex(h,d){return this.cE[h]*=d,this.markAsUpdated(),this}setTranslationFromFloats(h,d,m){return this.cE[12]=h,this.cE[13]=d,this.cE[14]=m,this.markAsUpdated(),this}addTranslationFromFloats(h,d,m){return this.cE[12]+=h,this.cE[13]+=d,this.cE[14]+=m,this.markAsUpdated(),this}setTranslation(h){return this.setTranslationFromFloats(h._x,h._y,h._z)}getTranslation(){return new Z(this.cE[12],this.cE[13],this.cE[14])}getTranslationToRef(h){return h.x=this.cE[12],h.y=this.cE[13],h.z=this.cE[14],h}removeRotationAndScaling(){const h=this.m;return V.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,h[12],h[13],h[14],h[15],this),this._updateIdentityStatus(0===h[12]&&0===h[13]&&0===h[14]&&1===h[15]),this}D(h){h.copyToArray(this.cE);const d=h;return this.updateFlag=d.updateFlag,this._updateIdentityStatus(d._isIdentity,d._isIdentityDirty,d._isIdentity3x2,d._isIdentity3x2Dirty),this}copyToArray(h){return q(this,h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this}multiply(h){const d=new V;return this.multiplyToRef(h,d),d}multiplyInPlace(h){const d=this.cE,m=h.m;for(let j=0;j<16;j++)d[j]*=m[j];return this.markAsUpdated(),this}multiplyByFloats(){const h=this.cE;for(let d=0;d<16;d++)h[d]*=d<0||arguments.length<=d?void 0:arguments[d];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];const j=d.pop(),A=this.cE,b=j.cE,w=d;for(let a=0;a<16;a++)b[a]=A[a]*w[a];return j.markAsUpdated(),j}multiplyToRef(h,d){return this._isIdentity?(d.D(h),d):h._isIdentity?(d.D(this),d):(this.multiplyToArray(h,d.cE,0),d.markAsUpdated(),d)}multiplyToArray(h,d,m){return M(this,h,d,m),this}divide(h){return this.divideToRef(h,new V)}divideToRef(h,d){const m=this.cE,j=h.m,A=d.cE;for(let b=0;b<16;b++)A[b]=m[b]/j[b];return d.markAsUpdated(),d}divideInPlace(h){const d=this.cE,m=h.m;for(let j=0;j<16;j++)d[j]/=m[j];return this.markAsUpdated(),this}minimizeInPlace(h){const d=this.cE,m=h.m;for(let j=0;j<16;j++)d[j]=Math.min(d[j],m[j]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const h=this.cE;for(let d=0;d<16;d++)h[d]=Math.min(h[d],d<0||arguments.length<=d?void 0:arguments[d]);return this.markAsUpdated(),this}maximizeInPlace(h){const d=this.cE,m=h.m;for(let j=0;j<16;j++)d[j]=Math.min(d[j],m[j]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const h=this.cE;for(let d=0;d<16;d++)h[d]=Math.min(h[d],d<0||arguments.length<=d?void 0:arguments[d]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new V)}negateInPlace(){const h=this.cE;for(let d=0;d<16;d++)h[d]=-h[d];return this.markAsUpdated(),this}negateToRef(h){const d=this.cE,m=h.cE;for(let j=0;j<16;j++)m[j]=-d[j];return h.markAsUpdated(),h}equals(h){const d=h;if(!d)return!1;if((this._isIdentity||d._isIdentity)&&!this._isIdentityDirty&&!d._isIdentityDirty)return this._isIdentity&&d._isIdentity;const m=this.m,j=d.m;return m[0]===j[0]&&m[1]===j[1]&&m[2]===j[2]&&m[3]===j[3]&&m[4]===j[4]&&m[5]===j[5]&&m[6]===j[6]&&m[7]===j[7]&&m[8]===j[8]&&m[9]===j[9]&&m[10]===j[10]&&m[11]===j[11]&&m[12]===j[12]&&m[13]===j[13]&&m[14]===j[14]&&m[15]===j[15]}equalsWithEpsilon(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const m=this.cE,j=h.m;for(let A=0;A<16;A++)if(!(0,D.WithinEpsilon)(m[A],j[A],d))return!1;return!0}equalsToFloats(){const h=this.cE;for(let d=0;d<16;d++)if(h[d]!=(d<0||arguments.length<=d?void 0:arguments[d]))return!1;return!0}floor(){return this.floorToRef(new V)}floorToRef(h){const d=this.cE,m=h.cE;for(let j=0;j<16;j++)m[j]=Math.floor(d[j]);return h.markAsUpdated(),h}fract(){return this.fractToRef(new V)}fractToRef(h){const d=this.cE,m=h.cE;for(let j=0;j<16;j++)m[j]=d[j]-Math.floor(d[j]);return h.markAsUpdated(),h}clone(){const h=new V;return h.D(this),h}getClassName(){return"Matrix"}getHashCode(){let h=I(this.cE[0]);for(let d=1;d<16;d++)h=397*h^I(this.cE[d]);return h}decomposeToTransformNode(h){return h.rotationQuaternion=h.rotationQuaternion||new B,this.decompose(h.td,h.rotationQuaternion,h.position)}decompose(h,d,m,j){let A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return m&&m.sd(0),h&&h.sd(1),d&&d.xd(0,0,0,1),!0;const b=this.cE;if(m&&m.xd(b[12],b[13],b[14]),(h=h||v.Qd[0]).x=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]),h.y=Math.sqrt(b[4]*b[4]+b[5]*b[5]+b[6]*b[6]),h.z=Math.sqrt(b[8]*b[8]+b[9]*b[9]+b[10]*b[10]),j){const d=(A?j.absoluteScaling.x:j.td.x)<0?-1:1,m=(A?j.absoluteScaling.y:j.td.y)<0?-1:1,b=(A?j.absoluteScaling.z:j.td.z)<0?-1:1;h.x*=d,h.y*=m,h.z*=b}else this.determinant()<=0&&(h.y*=-1);if(0===h._x||0===h._y||0===h._z)return d&&d.xd(0,0,0,1),!1;if(d){const m=1/h._x,j=1/h._y,A=1/h._z;V.FromValuesToRef(b[0]*m,b[1]*m,b[2]*m,0,b[4]*j,b[5]*j,b[6]*j,0,b[8]*A,b[9]*A,b[10]*A,0,0,0,0,1,v.Matrix[0]),B.FromRotationMatrixToRef(v.Matrix[0],d)}return!0}getRow(h){if(h<0||h>3)return null;const d=4*h;return new L(this.cE[d+0],this.cE[d+1],this.cE[d+2],this.cE[d+3])}getRowToRef(h,d){if(h>=0&&h<=3){const m=4*h;d.x=this.cE[m+0],d.y=this.cE[m+1],d.z=this.cE[m+2],d.w=this.cE[m+3]}return d}setRow(h,d){return this.setRowFromFloats(h,d.x,d.y,d.z,d.w)}transpose(){const h=new V;return V.TransposeToRef(this,h),h}transposeToRef(h){return V.TransposeToRef(this,h),h}setRowFromFloats(h,d,m,j,A){if(h<0||h>3)return this;const b=4*h;return this.cE[b+0]=d,this.cE[b+1]=m,this.cE[b+2]=j,this.cE[b+3]=A,this.markAsUpdated(),this}scale(h){const d=new V;return this.scaleToRef(h,d),d}scaleToRef(h,d){for(let m=0;m<16;m++)d.cE[m]=this.cE[m]*h;return d.markAsUpdated(),d}scaleAndAddToRef(h,d){for(let m=0;m<16;m++)d.cE[m]+=this.cE[m]*h;return d.markAsUpdated(),d}scaleInPlace(h){const d=this.cE;for(let m=0;m<16;m++)d[m]*=h;return this.markAsUpdated(),this}toNormalMatrix(h){const d=v.Matrix[0];this.invertToRef(d),d.transposeToRef(h);const m=h.cE;return V.FromValuesToRef(m[0],m[1],m[2],0,m[4],m[5],m[6],0,m[8],m[9],m[10],0,0,0,0,1,h),h}getRotationMatrix(){const h=new V;return this.getRotationMatrixToRef(h),h}getRotationMatrixToRef(h){const d=v.Qd[0];if(!this.decompose(d))return V.IdentityToRef(h),h;const m=this.cE,j=1/d._x,A=1/d._y,b=1/d._z;return V.FromValuesToRef(m[0]*j,m[1]*j,m[2]*j,0,m[4]*A,m[5]*A,m[6]*A,0,m[8]*b,m[9]*b,m[10]*b,0,0,0,0,1,h),h}toggleModelMatrixHandInPlace(){const h=this.cE;return h[2]*=-1,h[6]*=-1,h[8]*=-1,h[9]*=-1,h[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const h=this.cE;return h[8]*=-1,h[9]*=-1,h[10]*=-1,h[11]*=-1,this.markAsUpdated(),this}static Ud(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const m=new V;return V.FromArrayToRef(h,d,m),m}static FromArrayToRef(h,d,m){for(let j=0;j<16;j++)m.cE[j]=h[j+d];return m.markAsUpdated(),m}static FromFloat32ArrayToRefScaled(h,d,m,j){return j.cE[0]=h[0+d]*m,j.cE[1]=h[1+d]*m,j.cE[2]=h[2+d]*m,j.cE[3]=h[3+d]*m,j.cE[4]=h[4+d]*m,j.cE[5]=h[5+d]*m,j.cE[6]=h[6+d]*m,j.cE[7]=h[7+d]*m,j.cE[8]=h[8+d]*m,j.cE[9]=h[9+d]*m,j.cE[10]=h[10+d]*m,j.cE[11]=h[11+d]*m,j.cE[12]=h[12+d]*m,j.cE[13]=h[13+d]*m,j.cE[14]=h[14+d]*m,j.cE[15]=h[15+d]*m,j.markAsUpdated(),j}static get IdentityReadOnly(){return V._IdentityReadOnly}static FromValuesToRef(h,d,m,j,A,b,w,a,D,S,M,q,E,I,R,Z,L){const B=L.cE;B[0]=h,B[1]=d,B[2]=m,B[3]=j,B[4]=A,B[5]=b,B[6]=w,B[7]=a,B[8]=D,B[9]=S,B[10]=M,B[11]=q,B[12]=E,B[13]=I,B[14]=R,B[15]=Z,L.markAsUpdated()}static FromValues(h,d,m,j,A,b,w,a,D,S,M,q,E,I,R,Z){const L=new V,B=L.cE;return B[0]=h,B[1]=d,B[2]=m,B[3]=j,B[4]=A,B[5]=b,B[6]=w,B[7]=a,B[8]=D,B[9]=S,B[10]=M,B[11]=q,B[12]=E,B[13]=I,B[14]=R,B[15]=Z,L.markAsUpdated(),L}static Compose(h,d,m){const j=new V;return V.ComposeToRef(h,d,m,j),j}static ComposeToRef(h,d,m,j){const A=j.cE,b=d._x,w=d._y,a=d._z,D=d._w,S=b+b,M=w+w,q=a+a,E=b*S,I=b*M,R=b*q,Z=w*M,L=w*q,B=a*q,V=D*S,v=D*M,C=D*q,T=h._x,o=h._y,y=h._z;return A[0]=(1-(Z+B))*T,A[1]=(I+C)*T,A[2]=(R-v)*T,A[3]=0,A[4]=(I-C)*o,A[5]=(1-(E+B))*o,A[6]=(L+V)*o,A[7]=0,A[8]=(R+v)*y,A[9]=(L-V)*y,A[10]=(1-(E+Z))*y,A[11]=0,A[12]=m._x,A[13]=m._y,A[14]=m._z,A[15]=1,j.markAsUpdated(),j}static Identity(){const h=V.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return h._updateIdentityStatus(!0),h}static IdentityToRef(h){return V.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,h),h._updateIdentityStatus(!0),h}static Zero(){const h=V.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return h._updateIdentityStatus(!1),h}static RotationX(h){const d=new V;return V.RotationXToRef(h,d),d}static Invert(h){const d=new V;return h.invertToRef(d),d}static RotationXToRef(h,d){const m=Math.sin(h),j=Math.cos(h);return V.FromValuesToRef(1,0,0,0,0,j,m,0,0,-m,j,0,0,0,0,1,d),d._updateIdentityStatus(1===j&&0===m),d}static RotationY(h){const d=new V;return V.RotationYToRef(h,d),d}static RotationYToRef(h,d){const m=Math.sin(h),j=Math.cos(h);return V.FromValuesToRef(j,0,-m,0,0,1,0,0,m,0,j,0,0,0,0,1,d),d._updateIdentityStatus(1===j&&0===m),d}static RotationZ(h){const d=new V;return V.RotationZToRef(h,d),d}static RotationZToRef(h,d){const m=Math.sin(h),j=Math.cos(h);return V.FromValuesToRef(j,m,0,0,-m,j,0,0,0,0,1,0,0,0,0,1,d),d._updateIdentityStatus(1===j&&0===m),d}static RotationAxis(h,d){const m=new V;return V.RotationAxisToRef(h,d,m),m}static RotationAxisToRef(h,d,m){const j=Math.sin(-d),A=Math.cos(-d),b=1-A;h=h.normalizeToRef(v.Qd[0]);const w=m.cE;return w[0]=h._x*h._x*b+A,w[1]=h._x*h._y*b-h._z*j,w[2]=h._x*h._z*b+h._y*j,w[3]=0,w[4]=h._y*h._x*b+h._z*j,w[5]=h._y*h._y*b+A,w[6]=h._y*h._z*b-h._x*j,w[7]=0,w[8]=h._z*h._x*b-h._y*j,w[9]=h._z*h._y*b+h._x*j,w[10]=h._z*h._z*b+A,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,m.markAsUpdated(),m}static RotationAlignToRef(h,d,m){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const b=Z.Dot(d,h),w=m.cE;if(b<-1+j.c)w[0]=-1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=A?1:-1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=A?-1:1,w[11]=0;else{const m=Z.Cross(d,h),j=1/(1+b);w[0]=m._x*m._x*j+b,w[1]=m._y*m._x*j-m._z,w[2]=m._z*m._x*j+m._y,w[3]=0,w[4]=m._x*m._y*j+m._z,w[5]=m._y*m._y*j+b,w[6]=m._z*m._y*j-m._x,w[7]=0,w[8]=m._x*m._z*j-m._y,w[9]=m._y*m._z*j+m._x,w[10]=m._z*m._z*j+b,w[11]=0}return w[12]=0,w[13]=0,w[14]=0,w[15]=1,m.markAsUpdated(),m}static RotationYawPitchRoll(h,d,m){const j=new V;return V.RotationYawPitchRollToRef(h,d,m,j),j}static RotationYawPitchRollToRef(h,d,m,j){return B.RotationYawPitchRollToRef(h,d,m,v.Quaternion[0]),v.Quaternion[0].toRotationMatrix(j),j}static Scaling(h,d,m){const j=new V;return V.ScalingToRef(h,d,m,j),j}static ScalingToRef(h,d,m,j){return V.FromValuesToRef(h,0,0,0,0,d,0,0,0,0,m,0,0,0,0,1,j),j._updateIdentityStatus(1===h&&1===d&&1===m),j}static Translation(h,d,m){const j=new V;return V.TranslationToRef(h,d,m,j),j}static TranslationToRef(h,d,m,j){return V.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,h,d,m,1,j),j._updateIdentityStatus(0===h&&0===d&&0===m),j}static Lerp(h,d,m){const j=new V;return V.LerpToRef(h,d,m,j),j}static LerpToRef(h,d,m,j){const A=j.cE,b=h.m,w=d.m;for(let a=0;a<16;a++)A[a]=b[a]*(1-m)+w[a]*m;return j.markAsUpdated(),j}static DecomposeLerp(h,d,m){const j=new V;return V.DecomposeLerpToRef(h,d,m,j),j}static DecomposeLerpToRef(h,d,m,j){const A=v.Qd[0],b=v.Quaternion[0],w=v.Qd[1];h.decompose(A,b,w);const a=v.Qd[2],D=v.Quaternion[1],S=v.Qd[3];d.decompose(a,D,S);const M=v.Qd[4];Z.LerpToRef(A,a,m,M);const q=v.Quaternion[2];B.SlerpToRef(b,D,m,q);const E=v.Qd[5];return Z.LerpToRef(w,S,m,E),V.ComposeToRef(M,q,E,j),j}static LookAtLH(h,d,m){const j=new V;return V.LookAtLHToRef(h,d,m,j),j}static LookAtLHToRef(h,d,m,j){const A=v.Qd[0],b=v.Qd[1],w=v.Qd[2];d.subtractToRef(h,w),w.normalize(),Z.CrossToRef(m,w,A);const a=A.lengthSquared();0===a?A.x=1:A.normalizeFromLength(Math.sqrt(a)),Z.CrossToRef(w,A,b),b.normalize();const D=-Z.Dot(A,h),S=-Z.Dot(b,h),M=-Z.Dot(w,h);return V.FromValuesToRef(A._x,b._x,w._x,0,A._y,b._y,w._y,0,A._z,b._z,w._z,0,D,S,M,1,j),j}static LookAtRH(h,d,m){const j=new V;return V.LookAtRHToRef(h,d,m,j),j}static LookAtRHToRef(h,d,m,j){const A=v.Qd[0],b=v.Qd[1],w=v.Qd[2];h.subtractToRef(d,w),w.normalize(),Z.CrossToRef(m,w,A);const a=A.lengthSquared();0===a?A.x=1:A.normalizeFromLength(Math.sqrt(a)),Z.CrossToRef(w,A,b),b.normalize();const D=-Z.Dot(A,h),S=-Z.Dot(b,h),M=-Z.Dot(w,h);return V.FromValuesToRef(A._x,b._x,w._x,0,A._y,b._y,w._y,0,A._z,b._z,w._z,0,D,S,M,1,j),j}static LookDirectionLH(h,d){const m=new V;return V.LookDirectionLHToRef(h,d,m),m}static LookDirectionLHToRef(h,d,m){const j=v.Qd[0];j.D(h),j.scaleInPlace(-1);const A=v.Qd[1];return Z.CrossToRef(d,j,A),V.FromValuesToRef(A._x,A._y,A._z,0,d._x,d._y,d._z,0,j._x,j._y,j._z,0,0,0,0,1,m),m}static LookDirectionRH(h,d){const m=new V;return V.LookDirectionRHToRef(h,d,m),m}static LookDirectionRHToRef(h,d,m){const j=v.Qd[2];return Z.CrossToRef(d,h,j),V.FromValuesToRef(j._x,j._y,j._z,0,d._x,d._y,d._z,0,h._x,h._y,h._z,0,0,0,0,1,m),m}static OrthoLH(h,d,m,j,A){const b=new V;return V.OrthoLHToRef(h,d,m,j,b,A),b}static OrthoLHToRef(h,d,m,j,A,b){const w=2/h,a=2/d,D=2/(j-m),S=-(j+m)/(j-m);return V.FromValuesToRef(w,0,0,0,0,a,0,0,0,0,D,0,0,0,S,1,A),b&&A.multiplyToRef(T,A),A._updateIdentityStatus(1===w&&1===a&&1===D&&0===S),A}static OrthoOffCenterLH(h,d,m,j,A,b,w){const a=new V;return V.OrthoOffCenterLHToRef(h,d,m,j,A,b,a,w),a}static OrthoOffCenterLHToRef(h,d,m,j,A,b,w,a){const D=2/(d-h),S=2/(j-m),M=2/(b-A),q=-(b+A)/(b-A),E=(h+d)/(h-d),I=(j+m)/(m-j);return V.FromValuesToRef(D,0,0,0,0,S,0,0,0,0,M,0,E,I,q,1,w),a&&w.multiplyToRef(T,w),w.markAsUpdated(),w}static ObliqueOffCenterLHToRef(h,d,m,j,A,b,w,a,D,S,M){const q=-w*Math.cos(a),E=-w*Math.sin(a);return V.TranslationToRef(0,0,-D,v.Matrix[1]),V.FromValuesToRef(1,0,0,0,0,1,0,0,q,E,1,0,0,0,0,1,v.Matrix[0]),v.Matrix[1].multiplyToRef(v.Matrix[0],v.Matrix[0]),V.TranslationToRef(0,0,D,v.Matrix[1]),v.Matrix[0].multiplyToRef(v.Matrix[1],v.Matrix[0]),V.OrthoOffCenterLHToRef(h,d,m,j,A,b,S,M),v.Matrix[0].multiplyToRef(S,S),S}static OrthoOffCenterRH(h,d,m,j,A,b,w){const a=new V;return V.OrthoOffCenterRHToRef(h,d,m,j,A,b,a,w),a}static OrthoOffCenterRHToRef(h,d,m,j,A,b,w,a){return V.OrthoOffCenterLHToRef(h,d,m,j,A,b,w,a),w.cE[10]*=-1,w}static ObliqueOffCenterRHToRef(h,d,m,j,A,b,w,a,D,S,M){const q=w*Math.cos(a),E=w*Math.sin(a);return V.TranslationToRef(0,0,D,v.Matrix[1]),V.FromValuesToRef(1,0,0,0,0,1,0,0,q,E,1,0,0,0,0,1,v.Matrix[0]),v.Matrix[1].multiplyToRef(v.Matrix[0],v.Matrix[0]),V.TranslationToRef(0,0,-D,v.Matrix[1]),v.Matrix[0].multiplyToRef(v.Matrix[1],v.Matrix[0]),V.OrthoOffCenterRHToRef(h,d,m,j,A,b,S,M),v.Matrix[0].multiplyToRef(S,S),S}static PerspectiveLH(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const w=new V,a=2*m/h,D=2*m/d,S=(j+m)/(j-m),M=-2*j*m/(j-m),q=Math.tan(b);return V.FromValuesToRef(a,0,0,0,0,D,0,q,0,0,S,1,0,0,M,0,w),A&&w.multiplyToRef(T,w),w._updateIdentityStatus(!1),w}static PerspectiveFovLH(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const a=new V;return V.PerspectiveFovLHToRef(h,d,m,j,a,!0,A,b,w),a}static PerspectiveFovLHToRef(h,d,m,j,A){let b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],w=arguments.length>6?arguments[6]:void 0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,D=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const S=m,M=j,q=1/Math.tan(.5*h),E=b?q/d:q,I=b?q:q*d,R=D&&0===S?-1:0!==M?(M+S)/(M-S):1,Z=D&&0===S?2*M:0!==M?-2*M*S/(M-S):-2*S,L=Math.tan(a);return V.FromValuesToRef(E,0,0,0,0,I,0,L,0,0,R,1,0,0,Z,0,A),w&&A.multiplyToRef(T,A),A._updateIdentityStatus(!1),A}static PerspectiveFovReverseLHToRef(h,d,m,j,A){let b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],w=arguments.length>6?arguments[6]:void 0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const D=1/Math.tan(.5*h),S=b?D/d:D,M=b?D:D*d,q=Math.tan(a);return V.FromValuesToRef(S,0,0,0,0,M,0,q,0,0,-m,1,0,0,1,0,A),w&&A.multiplyToRef(T,A),A._updateIdentityStatus(!1),A}static PerspectiveFovRH(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const a=new V;return V.PerspectiveFovRHToRef(h,d,m,j,a,!0,A,b,w),a}static PerspectiveFovRHToRef(h,d,m,j,A){let b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],w=arguments.length>6?arguments[6]:void 0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,D=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const S=m,M=j,q=1/Math.tan(.5*h),E=b?q/d:q,I=b?q:q*d,R=D&&0===S?1:0!==M?-(M+S)/(M-S):-1,Z=D&&0===S?2*M:0!==M?-2*M*S/(M-S):-2*S,L=Math.tan(a);return V.FromValuesToRef(E,0,0,0,0,I,0,L,0,0,R,-1,0,0,Z,0,A),w&&A.multiplyToRef(T,A),A._updateIdentityStatus(!1),A}static PerspectiveFovReverseRHToRef(h,d,m,j,A){let b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],w=arguments.length>6?arguments[6]:void 0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const D=1/Math.tan(.5*h),S=b?D/d:D,M=b?D:D*d,q=Math.tan(a);return V.FromValuesToRef(S,0,0,0,0,M,0,q,0,0,-m,-1,0,0,-1,0,A),w&&A.multiplyToRef(T,A),A._updateIdentityStatus(!1),A}static GetFinalMatrix(h,d,m,j,A,b){const w=h.width,a=h.height,D=h.x,S=h.y,M=V.FromValues(w/2,0,0,0,0,-a/2,0,0,0,0,b-A,0,D+w/2,a/2+S,A,1),q=new V;return d.multiplyToRef(m,q),q.multiplyToRef(j,q),q.multiplyToRef(M,q)}static GetAsMatrix2x2(h){const d=h.m,m=[d[0],d[1],d[4],d[5]];return w.d.MatrixUse64Bits?m:new Float32Array(m)}static GetAsMatrix3x3(h){const d=h.m,m=[d[0],d[1],d[2],d[4],d[5],d[6],d[8],d[9],d[10]];return w.d.MatrixUse64Bits?m:new Float32Array(m)}static Transpose(h){const d=new V;return V.TransposeToRef(h,d),d}static TransposeToRef(h,d){const m=h.m,j=m[0],A=m[4],b=m[8],w=m[12],a=m[1],D=m[5],S=m[9],M=m[13],q=m[2],E=m[6],I=m[10],R=m[14],Z=m[3],L=m[7],B=m[11],V=m[15],v=d.cE;return v[0]=j,v[1]=A,v[2]=b,v[3]=w,v[4]=a,v[5]=D,v[6]=S,v[7]=M,v[8]=q,v[9]=E,v[10]=I,v[11]=R,v[12]=Z,v[13]=L,v[14]=B,v[15]=V,d.markAsUpdated(),d._updateIdentityStatus(h._isIdentity,h._isIdentityDirty),d}static Reflection(h){const d=new V;return V.ReflectionToRef(h,d),d}static ReflectionToRef(h,d){h.normalize();const m=h.Dd.x,j=h.Dd.y,A=h.Dd.z,b=-2*m,w=-2*j,a=-2*A;return V.FromValuesToRef(b*m+1,w*m,a*m,0,b*j,w*j+1,a*j,0,b*A,w*A,a*A+1,0,b*h.d,w*h.d,a*h.d,1,d),d}static FromXYZAxesToRef(h,d,m,j){return V.FromValuesToRef(h._x,h._y,h._z,0,d._x,d._y,d._z,0,m._x,m._y,m._z,0,0,0,0,1,j),j}static FromQuaternionToRef(h,d){const m=h._x*h._x,j=h._y*h._y,A=h._z*h._z,b=h._x*h._y,w=h._z*h._w,a=h._z*h._x,D=h._y*h._w,S=h._y*h._z,M=h._x*h._w;return d.cE[0]=1-2*(j+A),d.cE[1]=2*(b+w),d.cE[2]=2*(a-D),d.cE[3]=0,d.cE[4]=2*(b-w),d.cE[5]=1-2*(A+m),d.cE[6]=2*(S+M),d.cE[7]=0,d.cE[8]=2*(a+D),d.cE[9]=2*(S-M),d.cE[10]=1-2*(j+m),d.cE[11]=0,d.cE[12]=0,d.cE[13]=0,d.cE[14]=0,d.cE[15]=1,d.markAsUpdated(),d}}V._IdentityReadOnly=V.Identity(),Object.defineProperties(V.prototype,{dimension:{value:[4,4]},rank:{value:2}});class v{}v.Qd=(0,A.e)(11,Z.Zero),v.Matrix=(0,A.e)(2,V.Identity),v.Quaternion=(0,A.e)(3,B.Zero);class C{}C.Vector2=(0,A.e)(3,R.Zero),C.Qd=(0,A.e)(13,Z.Zero),C.Vector4=(0,A.e)(3,L.Zero),C.Quaternion=(0,A.e)(3,B.Zero),C.Matrix=(0,A.e)(8,V.Identity),(0,b.i)("BABYLON.Vector2",R),(0,b.i)("BABYLON.Vector3",Z),(0,b.i)("BABYLON.Vector4",L),(0,b.i)("BABYLON.Matrix",V);const T=V.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11432:(h,d,m)=>{m.d(d,{d:()=>j});class j{constructor(h,d,m,j){this.x=h,this.y=d,this.width=m,this.height=j}toGlobal(h,d){return new j(this.x*h,this.y*d,this.width*h,this.height*d)}toGlobalToRef(h,d,m){return m.x=this.x*h,m.y=this.y*d,m.width=this.width*h,m.height=this.height*d,this}clone(){return new j(this.x,this.y,this.width,this.height)}}},11516:(h,d,m)=>{m.d(d,{b:()=>S,d:()=>M});var j=m(11058),A=m(11519);const b=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],w=[()=>1,h=>h.y,h=>h.z,h=>h.x,h=>h.x*h.y,h=>h.y*h.z,h=>3*h.z*h.z-1,h=>h.x*h.z,h=>h.x*h.x-h.y*h.y],a=(h,d)=>b[h]*w[h](d),D=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class S{constructor(){this.preScaled=!1,this.l00=j.i.Zero(),this.l1_1=j.i.Zero(),this.l10=j.i.Zero(),this.l11=j.i.Zero(),this.l2_2=j.i.Zero(),this.l2_1=j.i.Zero(),this.l20=j.i.Zero(),this.l21=j.i.Zero(),this.l22=j.i.Zero()}addLight(h,d,m){A.g.Qd[0].set(d.r,d.g,d.b);const j=A.g.Qd[0],b=A.g.Qd[1];j.scaleToRef(m,b),b.scaleToRef(a(0,h),A.g.Qd[2]),this.l00.addInPlace(A.g.Qd[2]),b.scaleToRef(a(1,h),A.g.Qd[2]),this.l1_1.addInPlace(A.g.Qd[2]),b.scaleToRef(a(2,h),A.g.Qd[2]),this.l10.addInPlace(A.g.Qd[2]),b.scaleToRef(a(3,h),A.g.Qd[2]),this.l11.addInPlace(A.g.Qd[2]),b.scaleToRef(a(4,h),A.g.Qd[2]),this.l2_2.addInPlace(A.g.Qd[2]),b.scaleToRef(a(5,h),A.g.Qd[2]),this.l2_1.addInPlace(A.g.Qd[2]),b.scaleToRef(a(6,h),A.g.Qd[2]),this.l20.addInPlace(A.g.Qd[2]),b.scaleToRef(a(7,h),A.g.Qd[2]),this.l21.addInPlace(A.g.Qd[2]),b.scaleToRef(a(8,h),A.g.Qd[2]),this.l22.addInPlace(A.g.Qd[2])}scaleInPlace(h){this.l00.scaleInPlace(h),this.l1_1.scaleInPlace(h),this.l10.scaleInPlace(h),this.l11.scaleInPlace(h),this.l2_2.scaleInPlace(h),this.l2_1.scaleInPlace(h),this.l20.scaleInPlace(h),this.l21.scaleInPlace(h),this.l22.scaleInPlace(h)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(D[0]),this.l1_1.scaleInPlace(D[1]),this.l10.scaleInPlace(D[2]),this.l11.scaleInPlace(D[3]),this.l2_2.scaleInPlace(D[4]),this.l2_1.scaleInPlace(D[5]),this.l20.scaleInPlace(D[6]),this.l21.scaleInPlace(D[7]),this.l22.scaleInPlace(D[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(b[0]),this.l1_1.scaleInPlace(b[1]),this.l10.scaleInPlace(b[2]),this.l11.scaleInPlace(b[3]),this.l2_2.scaleInPlace(b[4]),this.l2_1.scaleInPlace(b[5]),this.l20.scaleInPlace(b[6]),this.l21.scaleInPlace(b[7]),this.l22.scaleInPlace(b[8])}updateFromArray(h){return j.i.FromArrayToRef(h[0],0,this.l00),j.i.FromArrayToRef(h[1],0,this.l1_1),j.i.FromArrayToRef(h[2],0,this.l10),j.i.FromArrayToRef(h[3],0,this.l11),j.i.FromArrayToRef(h[4],0,this.l2_2),j.i.FromArrayToRef(h[5],0,this.l2_1),j.i.FromArrayToRef(h[6],0,this.l20),j.i.FromArrayToRef(h[7],0,this.l21),j.i.FromArrayToRef(h[8],0,this.l22),this}updateFromFloatsArray(h){return j.i.FromFloatsToRef(h[0],h[1],h[2],this.l00),j.i.FromFloatsToRef(h[3],h[4],h[5],this.l1_1),j.i.FromFloatsToRef(h[6],h[7],h[8],this.l10),j.i.FromFloatsToRef(h[9],h[10],h[11],this.l11),j.i.FromFloatsToRef(h[12],h[13],h[14],this.l2_2),j.i.FromFloatsToRef(h[15],h[16],h[17],this.l2_1),j.i.FromFloatsToRef(h[18],h[19],h[20],this.l20),j.i.FromFloatsToRef(h[21],h[22],h[23],this.l21),j.i.FromFloatsToRef(h[24],h[25],h[26],this.l22),this}static Ud(h){return(new S).updateFromArray(h)}static FromPolynomial(h){const d=new S;return d.l00=h.xx.scale(.376127).add(h.yy.scale(.376127)).add(h.zz.scale(.376126)),d.l1_1=h.y.scale(.977204),d.l10=h.z.scale(.977204),d.l11=h.x.scale(.977204),d.l2_2=h.xy.scale(1.16538),d.l2_1=h.yz.scale(1.16538),d.l20=h.zz.scale(1.34567).fm(h.xx.scale(.672834)).fm(h.yy.scale(.672834)),d.l21=h.zx.scale(1.16538),d.l22=h.xx.scale(1.16538).fm(h.yy.scale(1.16538)),d.l1_1.scaleInPlace(-1),d.l11.scaleInPlace(-1),d.l2_1.scaleInPlace(-1),d.l21.scaleInPlace(-1),d.scaleInPlace(Math.PI),d}}class M{constructor(){this.x=j.i.Zero(),this.y=j.i.Zero(),this.z=j.i.Zero(),this.xx=j.i.Zero(),this.yy=j.i.Zero(),this.zz=j.i.Zero(),this.xy=j.i.Zero(),this.yz=j.i.Zero(),this.zx=j.i.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=S.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(h){A.g.Qd[0].xd(h.r,h.g,h.b);const d=A.g.Qd[0];this.xx.addInPlace(d),this.yy.addInPlace(d),this.zz.addInPlace(d)}scaleInPlace(h){this.x.scaleInPlace(h),this.y.scaleInPlace(h),this.z.scaleInPlace(h),this.xx.scaleInPlace(h),this.yy.scaleInPlace(h),this.zz.scaleInPlace(h),this.yz.scaleInPlace(h),this.zx.scaleInPlace(h),this.xy.scaleInPlace(h)}updateFromHarmonics(h){return this._harmonics=h,this.x.D(h.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.D(h.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.D(h.l10),this.z.scaleInPlace(1.02333),this.xx.D(h.l00),A.g.Qd[0].D(h.l20).scaleInPlace(.247708),A.g.Qd[1].D(h.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).Dq(A.g.Qd[0]).addInPlace(A.g.Qd[1]),this.yy.D(h.l00),this.yy.scaleInPlace(.886277).Dq(A.g.Qd[0]).Dq(A.g.Qd[1]),this.zz.D(h.l00),A.g.Qd[0].D(h.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(A.g.Qd[0]),this.yz.D(h.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.D(h.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.D(h.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(h){return(new M).updateFromHarmonics(h)}static Ud(h){const d=new M;return j.i.FromArrayToRef(h[0],0,d.x),j.i.FromArrayToRef(h[1],0,d.y),j.i.FromArrayToRef(h[2],0,d.z),j.i.FromArrayToRef(h[3],0,d.xx),j.i.FromArrayToRef(h[4],0,d.yy),j.i.FromArrayToRef(h[5],0,d.zz),j.i.FromArrayToRef(h[6],0,d.yz),j.i.FromArrayToRef(h[7],0,d.zx),j.i.FromArrayToRef(h[8],0,d.xy),d}}},11761:(h,d,m)=>{m.d(d,{e:()=>B,i:()=>V});var j=m(11058),A=m(11353),b=m(11419),w=m(11388),a=m(11121),D=m(11281),S=m(11526),M=m(11065),q=m(11094);class E extends j.h{constructor(h,d){super(h.x,h.y),this.index=d}}class I{constructor(){this.elements=[]}add(h){const d=[];for(const m of h){const h=new E(m,this.elements.length);d.push(h),this.elements.push(h)}return d}computeBounds(){const h=new j.h(this.elements[0].x,this.elements[0].y),d=new j.h(this.elements[0].x,this.elements[0].y);for(const m of this.elements)m.x<h.x?h.x=m.x:m.x>d.x&&(d.x=m.x),m.y<h.y?h.y=m.y:m.y>d.y&&(d.y=m.y);return{min:h,max:d,width:d.x-h.x,height:d.y-h.y}}}class R{_addToepoint(h){for(const d of h)this._epoints.push(d.x,d.y)}constructor(h,d,m){let j,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new I,this._outlinepoints=new I,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=A,this._name=h,this._scene=m||q.b.LastCreatedScene,j=d instanceof S.e?d.getPoints():d,this._addToepoint(j),this._points.add(j),this._outlinepoints.add(j),"undefined"===typeof this.bjsEarcut&&a.c.Warn("Earcut was not found, the polygon will not be built.")}addHole(h){this._points.add(h);const d=new I;return d.add(h),this._holes.push(d),this._eholes.push(this._epoints.length/2),this._addToepoint(h),this}build(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const j=new b.d(this._name,this._scene),A=this.buildVertexData(d,m);return j.xh(D.d.PositionKind,A.Fh,h),j.xh(D.d.NormalKind,A.fh,h),j.xh(D.d.UVKind,A.kh,h),j.setIndices(A.indices),j}buildVertexData(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const m=new w.c,j=[],A=[],b=[],a=this._points.computeBounds();for(const w of this._points.elements)j.push(0,1,0),A.push(w.x,0,w.y),b.push((w.x-a.min.x)/a.width,(w.y-a.min.y)/a.height);const D=[],S=this.bjsEarcut(this._epoints,this._eholes,2);for(let w=0;w<S.length;w++)D.push(S[w]);if(h>0){const m=A.length/3;for(const d of this._points.elements)j.push(0,-1,0),A.push(d.x,-h,d.y),b.push(1-(d.x-a.min.x)/a.width,1-(d.y-a.min.y)/a.height);const w=D.length;for(let h=0;h<w;h+=3){const d=D[h+0],j=D[h+1],A=D[h+2];D.push(A+m),D.push(j+m),D.push(d+m)}this._addSide(A,j,b,D,a,this._outlinepoints,h,!1,d);for(const S of this._holes)this._addSide(A,j,b,D,a,S,h,!0,d)}return m.indices=D,m.Fh=A,m.fh=j,m.kh=b,m}_addSide(h,d,m,A,b,w,a,D,S){let q=h.length/3,E=0;for(let I=0;I<w.elements.length;I++){const R=w.elements[I],Z=w.elements[(I+1)%w.elements.length];h.push(R.x,0,R.y),h.push(R.x,-a,R.y),h.push(Z.x,0,Z.y),h.push(Z.x,-a,Z.y);const L=w.elements[(I+w.elements.length-1)%w.elements.length],B=w.elements[(I+2)%w.elements.length];let V=new j.i(-(Z.y-R.y),0,Z.x-R.x),v=new j.i(-(R.y-L.y),0,R.x-L.x),C=new j.i(-(B.y-Z.y),0,B.x-Z.x);D||(V=V.scale(-1),v=v.scale(-1),C=C.scale(-1));const T=V.normalizeToNew();let o=v.normalizeToNew(),y=C.normalizeToNew();const i=j.i.Dot(o,T);o=i>S?i<M.c-1?new j.i(R.x,0,R.y).fm(new j.i(Z.x,0,Z.y)).normalize():v.add(V).normalize():T;const g=j.i.Dot(C,V);y=g>S?g<M.c-1?new j.i(Z.x,0,Z.y).fm(new j.i(R.x,0,R.y)).normalize():C.add(V).normalize():T,m.push(E/b.width,0),m.push(E/b.width,1),E+=V.length(),m.push(E/b.width,0),m.push(E/b.width,1),d.push(o.x,o.y,o.z),d.push(o.x,o.y,o.z),d.push(y.x,y.y,y.z),d.push(y.x,y.y,y.z),D?(A.push(q),A.push(q+2),A.push(q+1),A.push(q+1),A.push(q+2),A.push(q+3)):(A.push(q),A.push(q+1),A.push(q+2),A.push(q+1),A.push(q+3),A.push(q+2)),q+=4}}}var Z=m(11449);function L(h,d,m,b,a,S,M){const q=m||new Array(3),E=b,I=[],R=M||!1;for(let w=0;w<3;w++)void 0===q[w]&&(q[w]=new j.m(0,0,1,1)),E&&void 0===E[w]&&(E[w]=new A.f(1,1,1,1));const L=h.getVerticesData(D.d.PositionKind),B=h.getVerticesData(D.d.NormalKind),V=h.getVerticesData(D.d.UVKind),v=h.Vd(),C=L.length/9;let T=0,o=0,y=0,i=0,g=0;const F=[0];if(R)for(let j=C;j<L.length/3;j+=4)o=L[3*(j+2)]-L[3*j],y=L[3*(j+2)+2]-L[3*j+2],i=Math.sqrt(o*o+y*y),g+=i,F.push(g);let f=0,H=0;for(let j=0;j<B.length;j+=3)Math.abs(B[j+1])<.001&&(H=1),Math.abs(B[j+1]-1)<.001&&(H=0),Math.abs(B[j+1]+1)<.001&&(H=2),f=j/3,1===H?(T=f-C,V[2*f]=T%4<1.5?R?q[H].x+(q[H].z-q[H].x)*F[Math.floor(T/4)]/g:q[H].x:R?q[H].x+(q[H].z-q[H].x)*F[Math.floor(T/4)+1]/g:q[H].z,V[2*f+1]=T%2===0?Z.b?1-q[H].w:q[H].w:Z.b?1-q[H].y:q[H].y):(V[2*f]=(1-V[2*f])*q[H].x+V[2*f]*q[H].z,V[2*f+1]=(1-V[2*f+1])*q[H].y+V[2*f+1]*q[H].w,Z.b&&(V[2*f+1]=1-V[2*f+1])),E&&I.push(E[H].r,E[H].g,E[H].b,E[H].a);w.c._ComputeSides(d,L,v,B,V,a,S);const c=new w.c;if(c.indices=v,c.Fh=L,c.fh=B,c.kh=V,E){const h=d===w.c.DOUBLESIDE?I.concat(I):I;c.Hh=h}return c}function B(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;d.sideOrientation=b.d._GetDefaultSideOrientation(d.sideOrientation);const w=d.shape,a=d.holes||[],D=d.depth||0,S=d.smoothingThreshold||2,M=[];let E=[];for(let b=0;b<w.length;b++)M[b]=new j.h(w[b].x,w[b].z);M[0].equalsWithEpsilon(M[M.length-1],1e-8)&&M.pop();const I=new R(h,M,m||q.b.LastCreatedScene,A);for(let b=0;b<a.length;b++){E=[];for(let h=0;h<a[b].length;h++)E.push(new j.h(a[b][h].x,a[b][h].z));I.addHole(E)}const Z=I.build(!1,D,S);Z._originalBuilderSideOrientation=d.sideOrientation;return L(Z,d.sideOrientation,d.faceUV,d.faceColors,d.frontUVs,d.backUVs,d.wrap).Nh(Z,d.updatable),Z}function V(h,d){return B(h,d,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}w.c.CreatePolygon=L,b.d.CreatePolygon=function(h,d,m,j,A,b){return B(h,{shape:d,holes:j,updatable:A,sideOrientation:b},m,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},b.d.ExtrudePolygon=function(h,d,m,j,A,b,w){return V(h,{shape:d,holes:A,depth:m,updatable:b,sideOrientation:w},j,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)}},11752:(h,d,m)=>{m.d(d,{c:()=>M,e:()=>q});var j=m(11526),A=m(11058),b=m(11419),w=m(11366),a=m(11761);class D{constructor(h){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=h}moveTo(h,d){this._currentPath=new j.e(h,d),this._tempPaths.push(this._currentPath)}lineTo(h,d){this._currentPath.addLineTo(h,d)}quadraticCurveTo(h,d,m,j){this._currentPath.addQuadraticCurveTo(h,d,m,j,this._resolution)}bezierCurveTo(h,d,m,j,A,b){this._currentPath.addBezierCurveTo(h,d,m,j,A,b,this._resolution)}extractHoles(){for(const h of this._tempPaths)h.area()>0?this._holes.push(h):this._paths.push(h);if(!this._paths.length&&this._holes.length){const h=this._holes;this._holes=this._paths,this._paths=h}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function S(h,d,m,j,A,b){const w=b.glyphs[h]||b.glyphs["?"];if(!w)return null;const a=new D(A);if(w.o){const h=w.o.split(" ");for(let A=0,b=h.length;A<b;){switch(h[A++]){case"m":{const b=parseInt(h[A++])*d+m,w=parseInt(h[A++])*d+j;a.moveTo(b,w);break}case"l":{const b=parseInt(h[A++])*d+m,w=parseInt(h[A++])*d+j;a.lineTo(b,w);break}case"q":{const b=parseInt(h[A++])*d+m,w=parseInt(h[A++])*d+j,D=parseInt(h[A++])*d+m,S=parseInt(h[A++])*d+j;a.quadraticCurveTo(D,S,b,w);break}case"b":{const b=parseInt(h[A++])*d+m,w=parseInt(h[A++])*d+j,D=parseInt(h[A++])*d+m,S=parseInt(h[A++])*d+j,M=parseInt(h[A++])*d+m,q=parseInt(h[A++])*d+j;a.bezierCurveTo(D,S,M,q,b,w);break}}}}return a.extractHoles(),{offsetX:w.ha*d,shapePath:a}}function M(h,d,m,j){const A=Array.from(h),b=d/j.resolution,w=(j.boundingBox.yMax-j.boundingBox.yMin+j.underlineThickness)*b,a=[];let D=0,M=0;for(let q=0;q<A.length;q++){const h=A[q];if("\n"===h)D=0,M-=w;else{const d=S(h,b,D,M,m,j);d&&(D+=d.offsetX,a.push(d.shapePath))}}return a}function q(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const q=M(d,j.size||50,j.resolution||8,m),E=[];let I=0;for(const w of q){if(!w.paths.length)continue;const d=w.holes.slice();for(const m of w.paths){var R,Z;const w=[],M=[],q=m.getPoints();for(const h of q)M.push(new A.i(h.x,0,h.y));const L=d.slice();for(const h of L){const j=h.getPoints();let b=!1;for(const h of j)if(m.isPointInside(h)){b=!0;break}if(!b)continue;const a=[];for(const h of j)a.push(new A.i(h.x,0,h.y));w.push(a),d.splice(d.indexOf(h),1)}if(!w.length&&d.length)for(const h of d){const d=h.getPoints(),m=[];for(const h of d)m.push(new A.i(h.x,0,h.y));w.push(m)}const B=(0,a.i)(h,{shape:M,holes:w.length?w:void 0,depth:j.depth||1,faceUV:j.faceUV||(null===(R=j.perLetterFaceUV)||void 0===R?void 0:R.call(j,I)),faceColors:j.faceColors||(null===(Z=j.perLetterFaceColors)||void 0===Z?void 0:Z.call(j,I)),sideOrientation:b.d._GetDefaultSideOrientation(j.sideOrientation||b.d.DOUBLESIDE)},D,S);E.push(B),I++}}const L=b.d.MergeMeshes(E,!0,!0);if(L){const d=L.getBoundingInfo().boundingBox;L.position.x+=-(d.minimumWorld.x+d.maximumWorld.x)/2,L.position.y+=-(d.minimumWorld.y+d.maximumWorld.y)/2,L.position.z+=-(d.minimumWorld.z+d.maximumWorld.z)/2+d.extendSize.z,L.name=h;const m=new w.c("pivot",D);m.rotation.x=-Math.PI/2,L.parent=m,L.bakeCurrentTransformIntoVertices(),L.parent=null,m.dispose()}return L}},11771:(h,d,m)=>{m.d(d,{d:()=>D,g:()=>w,h:()=>a});var j=m(11107),A=m(11779),b=m(11786);function w(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function a(h){return!!(h.wasmUrl&&(h.wasmBinary||h.wasmBinaryUrl)&&"object"===typeof WebAssembly||h.fallbackUrl)}class D{constructor(h){if(h.workerPool)return void(this._workerPoolPromise=Promise.resolve(h.workerPool));const d=h.wasmBinary,m=h.numWorkers??w(),a=m&&"function"===typeof Worker&&"function"===typeof URL,D=a||!h.jsModule,S=h.wasmUrl&&h.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:D?j.e.GetBabylonScriptURL(h.wasmUrl,!0):"",wasmBinaryPromise:d?Promise.resolve(d):j.e.LoadFileAsync(j.e.GetBabylonScriptURL(h.wasmBinaryUrl,!0))}:{url:D?j.e.GetBabylonScriptURL(h.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};a?this._workerPoolPromise=S.wasmBinaryPromise.then((h=>{const d=this._getWorkerContent(),j=URL.createObjectURL(new Blob([d],{type:"application/javascript"}));return new A.b(m,(()=>{const d=new Worker(j);return(0,b.n)(d,h,S.url)}))})):this._modulePromise=S.wasmBinaryPromise.then((async d=>{if(!this._isModuleAvailable()&&!h.jsModule){if(!S.url)throw new Error("Draco codec module is not available");await j.e.LoadBabylonScriptAsync(S.url)}return await this._createModuleAsync(d,h.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((h=>{h.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},11786:(h,d,m)=>{function j(h,d,m,j){const A=h;let b=null,w=null,a=null,D=null;const S={},M=d.find((h=>"POSITION"===h.dracoName));if(!M)throw new Error("Position attribute is required for Draco encoding");if(!m){const h=M.data.length/M.size;m=new(h>65535?Uint32Array:Uint16Array)(h);for(let d=0;d<h;d++)m[d]=d}try{b=new A.Encoder,w=new A.MeshBuilder,a=new A.Mesh,w.AddFacesToMesh(a,m.length/3,m);const h=new Map([[Float32Array,(h,d,m,j,A,b)=>h.AddFloatAttribute(d,m,j,A,b)],[Uint32Array,(h,d,m,j,A,b)=>h.AddUInt32Attribute(d,m,j,A,b)],[Uint16Array,(h,d,m,j,A,b)=>h.AddUInt16Attribute(d,m,j,A,b)],[Uint8Array,(h,d,m,j,A,b)=>h.AddUInt8Attribute(d,m,j,A,b)],[Int32Array,(h,d,m,j,A,b)=>h.AddInt32Attribute(d,m,j,A,b)],[Int16Array,(h,d,m,j,A,b)=>h.AddInt16Attribute(d,m,j,A,b)],[Int8Array,(h,d,m,j,A,b)=>h.AddInt8Attribute(d,m,j,A,b)]]);for(const m of d){m.data instanceof Uint8ClampedArray&&(m.data=new Uint8Array(m.data));const d=h.get(m.data.constructor),D=m.data.length/m.size;S[m.kind]=d(w,a,A[m.dracoName],D,m.size,m.data),j.quantizationBits&&j.quantizationBits[m.dracoName]&&b.SetAttributeQuantization(A[m.dracoName],j.quantizationBits[m.dracoName])}j.method&&b.SetEncodingMethod(A[j.method]),void 0!==j.encodeSpeed&&void 0!==j.decodeSpeed&&b.SetSpeedOptions(j.encodeSpeed,j.decodeSpeed),D=new A.DracoInt8Array;const M=b.EncodeMeshToDracoBuffer(a,D);if(M<=0)throw new Error("Draco encoding failed.");const q=new Int8Array(M);for(let d=0;d<M;d++)q[d]=D.GetValue(d);return{data:q,attributeIds:S}}finally{a&&A.destroy(a),w&&A.destroy(w),b&&A.destroy(b),D&&A.destroy(D)}}function A(){let h;onmessage=d=>{const m=d.data;switch(m.id){case"init":{m.url&&importScripts(m.url);const d=m.wasmBinary?{wasmBinary:m.wasmBinary}:{};h=DracoEncoderModule(d),postMessage({id:"initDone"});break}case"encodeMesh":if(!h)throw new Error("Draco encoder module is not available");h.then((h=>{const d=j(h,m.attributes,m.indices,m.options);postMessage({id:"encodeMeshDone",encodedMeshData:d},d?[d.data.buffer]:void 0)}))}}}function b(h,d,m,j,A){const b=h;let w=null,a=null,D=null;try{let h;w=new b.Decoder,a=new b.DecoderBuffer,a.Init(d,d.byteLength);const S=w.GetEncodedGeometryType(a);switch(S){case b.TRIANGULAR_MESH:{const d=new b.Mesh;if(h=w.DecodeBufferToMesh(a,d),!h.ok()||0===d.ptr)throw new Error(h.error_msg());const m=3*d.num_faces(),A=4*m,S=b._malloc(A);try{w.GetTrianglesUInt32Array(d,A,S);const h=new Uint32Array(m);h.set(new Uint32Array(b.HEAPF32.buffer,S,m)),j(h)}finally{b._free(S)}D=d;break}case b.POINT_CLOUD:{const d=new b.PointCloud;if(h=w.DecodeBufferToPointCloud(a,d),!h.ok()||!d.ptr)throw new Error(h.error_msg());D=d;break}default:throw new Error(`Invalid geometry type ${S}`)}const M=D.num_points(),q=(h,d,m,j)=>{const w=j.data_type(),a=j.num_components(),D=j.normalized(),S=j.byte_stride(),q=j.byte_offset(),E={[b.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:b.HEAPF32},[b.DT_INT8]:{typedArrayConstructor:Int8Array,heap:b.HEAP8},[b.DT_INT16]:{typedArrayConstructor:Int16Array,heap:b.HEAP16},[b.DT_INT32]:{typedArrayConstructor:Int32Array,heap:b.HEAP32},[b.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:b.HEAPU8},[b.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:b.HEAPU16},[b.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:b.HEAPU32}}[w];if(!E)throw new Error(`Invalid data type ${w}`);const I=M*a,R=I*E.typedArrayConstructor.BYTES_PER_ELEMENT,Z=b._malloc(R);try{h.GetAttributeDataArrayForAllPoints(d,j,w,R,Z);const b=new E.typedArrayConstructor(E.heap.buffer,Z,I);A(m,b.slice(),a,q,S,D)}finally{b._free(Z)}};if(m)for(const d in m){const h=m[d],j=w.GetAttributeByUniqueId(D,h);q(w,D,d,j)}else{const h={position:b.POSITION,Dd:b.NORMAL,color:b.COLOR,uv:b.TEX_COORD};for(const d in h){const m=w.GetAttributeId(D,h[d]);if(-1!==m){const h=w.GetAttribute(D,m);q(w,D,d,h)}}}return M}finally{D&&b.destroy(D),a&&b.destroy(a),w&&b.destroy(w)}}function w(){let h;onmessage=d=>{const m=d.data;switch(m.id){case"init":{m.url&&importScripts(m.url);const d=m.wasmBinary?{wasmBinary:m.wasmBinary}:{};h=DracoDecoderModule(d),postMessage({id:"initDone"});break}case"decodeMesh":if(!h)throw new Error("Draco decoder module is not available");h.then((h=>{const d=b(h,m.dataView,m.attributes,(h=>{postMessage({id:"indices",data:h},[h.buffer])}),((h,d,m,j,A,b)=>{postMessage({id:"attribute",kind:h,data:d,size:m,byteOffset:j,byteStride:A,normalized:b},[d.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:d})}))}}}async function a(h,d,m){return await new Promise(((j,A)=>{const b=d=>{h.removeEventListener("error",b),h.removeEventListener("message",w),A(d)},w=d=>{"initDone"===d.data.id&&(h.removeEventListener("error",b),h.removeEventListener("message",w),j(h))};if(h.addEventListener("error",b),h.addEventListener("message",w),d){const j=d.slice(0);h.postMessage({id:"init",url:m,wasmBinary:j},[j])}else h.postMessage({id:"init",url:m})}))}m.d(d,{d:()=>b,g:()=>w,j:()=>j,m:()=>A,n:()=>a})},11477:(h,d,m)=>{m.d(d,{e:()=>A});var j=m(11286);class A extends j.c{constructor(h){super(),this._buffer=h}get underlyingResource(){return this._buffer}}},11380:(h,d,m)=>{m.d(d,{b:()=>y});var j=m(11258),A=m(11097),b=m(11058),w=m(11281),a=m(11388),D=m(11366),S=m(11400),M=m(11303),q=m(11335);class E{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new b.i(0,0,0),this._diffPositionForCollisions=new b.i(0,0,0),this._collisionResponse=!0}}var I=m(11137),R=m(11323),Z=m(11353),L=m(11065),B=m(11407),V=m(11080),v=m(11261),C=m(11188);class T{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=b.i.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class o{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new T,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new E,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class y extends D.c{static get BILLBOARDMODE_NONE(){return D.c.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return D.c.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return D.c.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return D.c.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return D.c.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return D.c.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(h){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=h}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(h){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=h}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(h){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=h}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(h){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=h}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(h){this._internalAbstractMeshDataInfo._collisionRetryCount=h}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(h){this._internalAbstractMeshDataInfo._morphTargetManager!==h&&(this._internalAbstractMeshDataInfo._morphTargetManager=h,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(h){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==h&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=h,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(h){return!!super._updateNonUniformScalingState(h)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(h){this._internalAbstractMeshDataInfo._rawBoundingInfo=h}set yI(h){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(h)}set onCollisionPositionChange(h){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(h)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(h){if(this._internalAbstractMeshDataInfo._visibility===h)return;const d=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=h,(1===d&&1!==h||1!==d&&1===h)&&this._markSubMeshesAsDirty((h=>{h.markAsMiscDirty(),h.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(h){this._internalAbstractMeshDataInfo._inheritVisibility=h}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let h=this._parentNode;for(;h;){const d=h.isVisible;if("undefined"!==typeof d)return d;h=h.parent}}return this._isVisible}set isVisible(h){this._isVisible=h}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(h){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=h}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(h){this._internalAbstractMeshDataInfo._renderingGroupId=h}get material(){return this._internalAbstractMeshDataInfo._material}set material(h){this._setMaterial(h)}_setMaterial(h){this._internalAbstractMeshDataInfo._material!==h&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=h,h&&h.meshMap&&(h.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.Ab&&(this.resetDrawCache(void 0,null==h),this._unBindEffect()))}getMaterialForRenderPass(h){var d;return null===(d=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===d?void 0:d[h]}setMaterialForRenderPass(h,d){var m;this.resetDrawCache(h),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const j=this._internalAbstractMeshDataInfo._materialForRenderPass[h];null!==j&&void 0!==j&&null!==(m=j.meshMap)&&void 0!==m&&m[this.uniqueId]&&(j.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[h]=d,d&&d.meshMap&&(d.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(h){this._internalAbstractMeshDataInfo._receiveShadows!==h&&(this._internalAbstractMeshDataInfo._receiveShadows=h,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(h){this._internalAbstractMeshDataInfo._hasVertexAlpha!==h&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=h,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(h){this._internalAbstractMeshDataInfo._useVertexColors!==h&&(this._internalAbstractMeshDataInfo._useVertexColors=h,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(h){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==h&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=h,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(h){this._internalAbstractMeshDataInfo._numBoneInfluencers!==h&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=h,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(h){this._internalAbstractMeshDataInfo._applyFog!==h&&(this._internalAbstractMeshDataInfo._applyFog=h,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(h){this._internalAbstractMeshDataInfo._enableDistantPicking=h}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(h){h!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=h,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(h){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(h)?-1:h}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(h){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=h}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(h){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(h)?-1:h}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(h){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=h}get lightSources(){return this._lightSources}set skeleton(h){const d=this._internalAbstractMeshDataInfo._skeleton;d&&d.needInitialSkinMatrix&&d._unregisterMeshWithPoseMatrix(this),h&&h.needInitialSkinMatrix&&h._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=h,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(h){var d;let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(h,m,!1),d=this,this._internalAbstractMeshDataInfo=new o,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Tq=y.oq,this.onCollideObservable=new A.e,this.onCollisionPositionChangeObservable=new A.e,this.onMaterialChangedObservable=new A.e,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.GD=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=Z.d.Red(),this.outlineWidth=.02,this.overlayColor=Z.d.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.Ga=!1,this.Wh=!1,this.actionManager=null,this.ellipsoid=new b.i(.5,1,.5),this.ellipsoidOffset=new b.i(0,0,0),this.edgesWidth=1,this.edgesColor=new Z.f(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,Xb:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new A.e,this._onCollisionPositionChange=function(h,m){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;m.subtractToRef(d._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,d._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),d._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>C.b.CollisionsEpsilon&&d.position.addInPlace(d._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),j&&d.onCollideObservable.notifyObservers(j),d.onCollisionPositionChangeObservable.notifyObservers(d.position)},m=this.ih(),m.qM(this),this._resyncLightSources(),this._uniformBuffer=new q.d(this.ih().getEngine(),void 0,void 0,h,!this.ih().getEngine().isWebGPU),this._buildUniformLayout(),m.performancePriority){case 2:this.Wh=!0;case 1:this.Ga=!0,this.GD=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(h){const d=this._uniformBuffer;d.hb("world",h),d.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),d.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(h){let d="Name: "+this.name+", isInstance: "+("InstancedMesh"===this.getClassName()?"YES":"NO");d+=", # of submeshes: "+(this.Ab?this.Ab.length:0);const m=this._internalAbstractMeshDataInfo._skeleton;return m&&(d+=", skeleton: "+m.name),h&&(d+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],d+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.Xb?"YES":"NO")),d}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==D.c.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(d||this.actionManager.isRecursive)){if(!h)return this.actionManager;if(this.actionManager.hasSpecificTrigger(h))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(h,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.Ab){for(const h of this.Ab)h._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const h of this.ih().lights)h.isEnabled()&&h.canAffectMesh(this)&&this._lightSources.push(h);this._markSubMeshesAsLightDirty()}_resyncLightSource(h){const d=h.isEnabled()&&h.canAffectMesh(this),m=this._lightSources.indexOf(h);let j=!1;if(-1===m){if(!d)return;this._lightSources.push(h)}else{if(d)return;j=!0,this._lightSources.splice(m,1)}this._markSubMeshesAsLightDirty(j)}_unBindEffect(){for(const h of this.Ab)h.setEffect(null)}_removeLightSource(h,d){const m=this._lightSources.indexOf(h);-1!==m&&(this._lightSources.splice(m,1),this._markSubMeshesAsLightDirty(d))}_markSubMeshesAsDirty(h){if(this.Ab)for(const d of this.Ab)for(let m=0;m<d._drawWrappers.length;++m){const j=d._drawWrappers[m];j&&j.defines&&j.defines.markAllAsDirty&&h(j.defines)}}_markSubMeshesAsLightDirty(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((d=>d.markAsLightDirty(h)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((h=>h.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((h=>h.markAsMiscDirty()))}PS(h){return this._currentRenderId=Number.MAX_VALUE,super.PS(h),this._isDirty=!0,this}resetDrawCache(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.Ab)for(const m of this.Ab)m.resetDrawCache(h,d)}get isBlocked(){return!1}getLOD(h){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Vd(){return null}getVerticesData(h){return null}xh(h,d,m,j){return this}updateVerticesData(h,d,m,j){return this}setIndices(h,d){return this}isVerticesDataPresent(h){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.rh()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(h){return this._boundingInfo=h,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(h,d,m){return this._boundingInfo=new M.e(h,d,m),this._boundingInfo}normalizeToUnitCube(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(h,d,m)}get useBones(){return this.skeleton&&this.ih().skeletonsEnabled&&this.isVerticesDataPresent(w.d.MatricesIndicesKind)&&this.isVerticesDataPresent(w.d.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(h){}_activate(h,d){return this._renderId=h,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===D.c.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(h,d,m){return this.position.addInPlace(this.calcMovePOV(h,d,m)),this}calcMovePOV(h,d,m){const j=new b.b;(this.rotationQuaternion?this.rotationQuaternion:b.c.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(j);const A=b.i.Zero(),w=this.definedFacingForward?-1:1;return b.i.TransformCoordinatesFromFloatsToRef(h*w,d,m*w,j,A),A}rotatePOV(h,d,m){return this.rotation.addInPlace(this.calcRotatePOV(h,d,m)),this}calcRotatePOV(h,d,m){const j=this.definedFacingForward?1:-1;return new b.i(h*j,d,m*j)}Yh(h,d){if(h){const m=(0,R.e)(h,0,this.getTotalVertices(),d);this._boundingInfo?this._boundingInfo.reConstruct(m.minimum,m.maximum):this._boundingInfo=new M.e(m.minimum,m.maximum)}if(this.Ab)for(let m=0;m<this.Ab.length;m++)this.Ab[m].refreshBoundingInfo(h);this.rh()}_refreshBoundingInfoDirect(h){if(this._boundingInfo?this._boundingInfo.reConstruct(h.minimum,h.maximum):this._boundingInfo=new M.e(h.minimum,h.maximum),this.Ab)for(let d=0;d<this.Ab.length;d++)this.Ab[d].refreshBoundingInfo(null);this.rh()}static _ApplySkeleton(h,d,m,j,A,a,D){!function(h,d,m,j,A,a,D){const S=b.d.Qd[0],M=b.d.Matrix[0],q=b.d.Matrix[1],E=d===w.d.NormalKind?b.i.TransformNormalFromFloatsToRef:b.i.TransformCoordinatesFromFloatsToRef;for(let w=0,I=0;w<h.length;w+=3,I+=4){let d,R;for(M.reset(),d=0;d<4;d++)R=A[I+d],R>0&&(b.b.FromFloat32ArrayToRefScaled(m,Math.floor(16*j[I+d]),R,q),M.addToSelf(q));if(a&&D)for(d=0;d<4;d++)R=D[I+d],R>0&&(b.b.FromFloat32ArrayToRefScaled(m,Math.floor(16*a[I+d]),R,q),M.addToSelf(q));E(h[w],h[w+1],h[w+2],M,S),S.toArray(h,w)}}(h,d,m,j,A,a,D)}_getData(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.d.PositionKind;const j=h.cache,A=h=>{if(j){const d=j._vertexData||(j._vertexData={});return d[h]||this.copyVerticesData(h,d),d[h]}return this.getVerticesData(h)};if(d||(d=A(m)),!d)return null;if(j?(j._outputData?j._outputData.set(d):j._outputData=new Float32Array(d),d=j._outputData):(h.applyMorph&&this.morphTargetManager||h.applySkeleton&&this.skeleton)&&(d=d.slice()),h.applyMorph&&this.morphTargetManager&&function(h,d,m){let j=null;switch(d){case w.d.PositionKind:j=h=>h.getPositions();break;case w.d.NormalKind:j=h=>h.getNormals();break;case w.d.TangentKind:j=h=>h.getTangents();break;case w.d.UVKind:j=h=>h.getUVs();break;case w.d.UV2Kind:j=h=>h.getUV2s();break;case w.d.ColorKind:j=h=>h.getColors();break;default:return}for(let A=0;A<h.length;A++){let d=h[A];for(let b=0;b<m.numTargets;b++){const w=m.getTarget(b),a=w.influence;if(0!==a){const m=j(w);m&&(d+=(m[A]-h[A])*a)}}h[A]=d}}(d,m,this.morphTargetManager),h.applySkeleton&&this.skeleton){const h=A(w.d.MatricesIndicesKind),j=A(w.d.MatricesWeightsKind);if(j&&h){const b=this.numBoneInfluencers>4,a=b?A(w.d.MatricesIndicesExtraKind):null,D=b?A(w.d.MatricesWeightsExtraKind):null,S=this.skeleton.getTransformMatrices(this);y._ApplySkeleton(d,m,S,h,j,a,D)}}if(!1!==h.updatePositionsArray&&m===w.d.PositionKind){const h=this._internalAbstractMeshDataInfo._positions||[],m=h.length;if(h.length=d.length/3,m<h.length)for(let d=m;d<h.length;d++)h[d]=new b.i;for(let j=0,A=0;j<h.length;j++,A+=3)h[j].xd(d[A],d[A+1],d[A+2]);this._internalAbstractMeshDataInfo._positions=h}return d}getNormalsData(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:h,applyMorph:d,updatePositionsArray:!1},null,w.d.NormalKind)}bD(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:h,applyMorph:d,updatePositionsArray:!1},m,w.d.PositionKind)}rh(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new M.e(b.i.Zero(),b.i.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(h){if(!this.Ab)return this;const d=this.Ab.length;for(let m=0;m<d;m++){const j=this.Ab[m];(d>1||!j.IsGlobal)&&j.updateBoundingInfo(h)}return this}_afterComputeWorldMatrix(){this.Wh||(this._boundingInfoIsDirty=!0)}isInFrustum(h){return this.getBoundingInfo().isInFrustum(h,this.Tq)}isCompletelyInFrustum(h){return this.getBoundingInfo().isCompletelyInFrustum(h)}intersectsMesh(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0;const j=this.getBoundingInfo(),A=h.getBoundingInfo();if(j.intersects(A,d))return!0;if(m)for(const b of this.getChildMeshes())if(b.intersectsMesh(h,d,!0))return!0;return!1}intersectsPoint(h){return this.getBoundingInfo().intersectsPoint(h)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(h){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=h}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const m=this.ih().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=m.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,m.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,h,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId,d),this}_collideForSubMesh(h,d,m){var j;if(this._generatePointsArray(),!this._positions)return this;if(!h._lastColliderWorldVertices||!h._lastColliderTransformMatrix.equals(d)){h._lastColliderTransformMatrix=d.clone(),h._lastColliderWorldVertices=[],h._trianglePlanes=[];const m=h.verticesStart,j=h.verticesStart+h.verticesCount;for(let A=m;A<j;A++)h._lastColliderWorldVertices.push(b.i.TransformCoordinates(this._positions[A],d))}return m._collide(h._trianglePlanes,h._lastColliderWorldVertices,this.Vd(),h.indexStart,h.indexStart+h.indexCount,h.verticesStart,!!h.Qh(),this,this._shouldConvertRHS(),7===(null===(j=h.Qh())||void 0===j?void 0:j.fillMode)),this}_processCollisionsForSubMeshes(h,d){const m=this._scene.getCollidingSubMeshCandidates(this,h),j=m.length;for(let A=0;A<j;A++){const b=m.data[A];j>1&&!b._checkCollision(h)||this._collideForSubMesh(b,d,h)}return this}_shouldConvertRHS(){return!1}_checkCollision(h){if(!this.getBoundingInfo()._checkCollision(h))return this;const d=b.d.Matrix[0],m=b.d.Matrix[1];return b.b.ScalingToRef(1/h._radius.x,1/h._radius.y,1/h._radius.z,d),this.worldMatrixFromCache.multiplyToRef(d,m),this._processCollisionsForSubMeshes(h,m),this}_generatePointsArray(){return!1}intersects(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=new S.b,D=this.getClassName(),M="InstancedLinesMesh"===D||"LinesMesh"===D||"GreasedLineMesh"===D?this.intersectionThreshold:0,q=this.getBoundingInfo();if(!this.Ab)return a;if(!w&&(!h.intersectsSphere(q.boundingSphere,M)||!h.intersectsBox(q.boundingBox,M)))return a;if(j)return a.hit=!w,a.pickedMesh=w?null:this,a.distance=w?0:b.i.Distance(h.origin,q.boundingSphere.center),a.subMeshId=0,a;if(!this._generatePointsArray())return a;let E=null;const I=this._scene.getIntersectingSubMeshCandidates(this,h),R=I.length;let Z=!1;for(let b=0;b<R;b++){const h=I.data[b].Qh();if(h&&(7==h.fillMode||0==h.fillMode||1==h.fillMode||2==h.fillMode||4==h.fillMode)){Z=!0;break}}if(!Z)return a.hit=!0,a.pickedMesh=this,a.distance=b.i.Distance(h.origin,q.boundingSphere.center),a.subMeshId=-1,a;for(let b=0;b<R;b++){const j=I.data[b];if(R>1&&!w&&!j.canIntersects(h))continue;const A=j.intersects(h,this._positions,this.Vd(),d,m);if(A&&(d||!E||A.distance<E.distance)&&(E=A,E.subMeshId=b,d))break}if(E){const d=A??this.getWorldMatrix(),m=b.d.Qd[0],j=b.d.Qd[1];b.i.TransformCoordinatesToRef(h.origin,d,m),h.direction.scaleToRef(E.distance,j);const w=b.i.TransformNormal(j,d).addInPlace(m);return a.hit=!0,a.distance=b.i.Distance(m,w),a.pickedPoint=w,a.pickedMesh=this,a.bu=E.bu||0,a.bv=E.bv||0,a.subMeshFaceId=E.faceId,a.faceId=E.faceId+I.data[E.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),a.subMeshId=E.subMeshId,a}return a}clone(h,d,m){return null}releaseSubMeshes(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.Ab)for(;this.Ab.length;)this.Ab[0].dispose(h);else this.Ab=[];return this}dispose(h){let d,m=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const j=this.ih();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),j.freeActiveMeshes(),j.freeRenderingGroups(),j.renderingManager.maintainStateBetweenFrames&&j.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((h=>h!==this&&h.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),d=0;d<this._intersectionsInProgress.length;d++){const h=this._intersectionsInProgress[d],m=h._intersectionsInProgress.indexOf(this);h._intersectionsInProgress.splice(m,1)}this._intersectionsInProgress.length=0;const A=j.lights;for(const w of A){let h=w.includedOnlyMeshes.indexOf(this);-1!==h&&w.includedOnlyMeshes.splice(h,1),h=w.excludedMeshes.indexOf(this),-1!==h&&w.excludedMeshes.splice(h,1);const d=w.getShadowGenerators();if(d){const m=d.values();for(let d=m.next();!0!==d.done;d=m.next()){const m=d.value.getShadowMap();m&&m.renderList&&(h=m.renderList.indexOf(this),-1!==h&&m.renderList.splice(h,1))}}}"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const b=j.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,b.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),b.wipeCaches(),j.MM(this),this._parentContainer){const h=this._parentContainer.meshes.indexOf(this);h>-1&&this._parentContainer.meshes.splice(h,1),this._parentContainer=null}if(m&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!h)for(d=0;d<j.aE.length;d++)j.aE[d].k===this&&(j.aE[d].dispose(),d--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(h,m)}_initFacetData(){const h=this._internalAbstractMeshDataInfo._facetData;h.facetNormals||(h.facetNormals=[]),h.facetPositions||(h.facetPositions=[]),h.facetPartitioning||(h.facetPartitioning=new Array),h.facetNb=this.Vd().length/3|0,h.partitioningSubdivisions=h.partitioningSubdivisions?h.partitioningSubdivisions:10,h.partitioningBBoxRatio=h.partitioningBBoxRatio?h.partitioningBBoxRatio:1.01;for(let d=0;d<h.facetNb;d++)h.facetNormals[d]=b.i.Zero(),h.facetPositions[d]=b.i.Zero();return h.facetDataEnabled=!0,this}updateFacetData(){const h=this._internalAbstractMeshDataInfo._facetData;h.facetDataEnabled||this._initFacetData();const d=this.getVerticesData(w.d.PositionKind),m=this.Vd(),j=this.getVerticesData(w.d.NormalKind),A=this.getBoundingInfo();if(h.facetDepthSort&&!h.facetDepthSortEnabled){if(h.facetDepthSortEnabled=!0,m instanceof Uint16Array)h.depthSortedIndices=new Uint16Array(m);else if(m instanceof Uint32Array)h.depthSortedIndices=new Uint32Array(m);else{let d=!1;for(let h=0;h<m.length;h++)if(m[h]>65535){d=!0;break}h.depthSortedIndices=d?new Uint32Array(m):new Uint16Array(m)}if(h.facetDepthSortFunction=function(h,d){return d.sqDistance-h.sqDistance},!h.facetDepthSortFrom){const d=this.ih().activeCamera;h.facetDepthSortFrom=d?d.position:b.i.Zero()}h.depthSortedFacets=[];for(let d=0;d<h.facetNb;d++){const m={ind:3*d,sqDistance:0};h.depthSortedFacets.push(m)}h.invertedMatrix=b.b.Identity(),h.facetDepthSortOrigin=b.i.Zero()}h.bbSize.x=A.maximum.x-A.minimum.x>L.c?A.maximum.x-A.minimum.x:L.c,h.bbSize.y=A.maximum.y-A.minimum.y>L.c?A.maximum.y-A.minimum.y:L.c,h.bbSize.z=A.maximum.z-A.minimum.z>L.c?A.maximum.z-A.minimum.z:L.c;let D=h.bbSize.x>h.bbSize.y?h.bbSize.x:h.bbSize.y;if(D=D>h.bbSize.z?D:h.bbSize.z,h.subDiv.max=h.partitioningSubdivisions,h.subDiv.X=Math.floor(h.subDiv.max*h.bbSize.x/D),h.subDiv.Y=Math.floor(h.subDiv.max*h.bbSize.y/D),h.subDiv.Z=Math.floor(h.subDiv.max*h.bbSize.z/D),h.subDiv.X=h.subDiv.X<1?1:h.subDiv.X,h.subDiv.Y=h.subDiv.Y<1?1:h.subDiv.Y,h.subDiv.Z=h.subDiv.Z<1?1:h.subDiv.Z,h.facetParameters.facetNormals=this.getFacetLocalNormals(),h.facetParameters.facetPositions=this.getFacetLocalPositions(),h.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),h.facetParameters.bInfo=A,h.facetParameters.bbSize=h.bbSize,h.facetParameters.subDiv=h.subDiv,h.facetParameters.ratio=this.partitioningBBoxRatio,h.facetParameters.depthSort=h.facetDepthSort,h.facetDepthSort&&h.facetDepthSortEnabled&&(this.Zd(!0),this._worldMatrix.invertToRef(h.invertedMatrix),b.i.TransformCoordinatesToRef(h.facetDepthSortFrom,h.invertedMatrix,h.facetDepthSortOrigin),h.facetParameters.distanceTo=h.facetDepthSortOrigin),h.facetParameters.depthSortedFacets=h.depthSortedFacets,j&&a.c.ComputeNormals(d,m,j,h.facetParameters),h.facetDepthSort&&h.facetDepthSortEnabled){h.depthSortedFacets.sort(h.facetDepthSortFunction);const d=h.depthSortedIndices.length/3|0;for(let j=0;j<d;j++){const d=h.depthSortedFacets[j].ind;h.depthSortedIndices[3*j]=m[d],h.depthSortedIndices[3*j+1]=m[d+1],h.depthSortedIndices[3*j+2]=m[d+2]}this.updateIndices(h.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const h=this._internalAbstractMeshDataInfo._facetData;return h.facetNormals||this.updateFacetData(),h.facetNormals}getFacetLocalPositions(){const h=this._internalAbstractMeshDataInfo._facetData;return h.facetPositions||this.updateFacetData(),h.facetPositions}getFacetLocalPartitioning(){const h=this._internalAbstractMeshDataInfo._facetData;return h.facetPartitioning||this.updateFacetData(),h.facetPartitioning}getFacetPosition(h){const d=b.i.Zero();return this.getFacetPositionToRef(h,d),d}getFacetPositionToRef(h,d){const m=this.getFacetLocalPositions()[h],j=this.getWorldMatrix();return b.i.TransformCoordinatesToRef(m,j,d),this}getFacetNormal(h){const d=b.i.Zero();return this.getFacetNormalToRef(h,d),d}getFacetNormalToRef(h,d){const m=this.getFacetLocalNormals()[h];return b.i.TransformNormalToRef(m,this.getWorldMatrix(),d),this}getFacetsAtLocalCoordinates(h,d,m){const j=this.getBoundingInfo(),A=this._internalAbstractMeshDataInfo._facetData,b=Math.floor((h-j.minimum.x*A.partitioningBBoxRatio)*A.subDiv.X*A.partitioningBBoxRatio/A.bbSize.x),w=Math.floor((d-j.minimum.y*A.partitioningBBoxRatio)*A.subDiv.Y*A.partitioningBBoxRatio/A.bbSize.y),a=Math.floor((m-j.minimum.z*A.partitioningBBoxRatio)*A.subDiv.Z*A.partitioningBBoxRatio/A.bbSize.z);return b<0||b>A.subDiv.max||w<0||w>A.subDiv.max||a<0||a>A.subDiv.max?null:A.facetPartitioning[b+A.subDiv.max*w+A.subDiv.max*A.subDiv.max*a]}getClosestFacetAtCoordinates(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]&&arguments[4],w=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const a=this.getWorldMatrix(),D=b.d.Matrix[5];a.invertToRef(D);const S=b.d.Qd[8];b.i.TransformCoordinatesFromFloatsToRef(h,d,m,D,S);const M=this.getClosestFacetAtLocalCoordinates(S.x,S.y,S.z,j,A,w);return j&&b.i.TransformCoordinatesFromFloatsToRef(j.x,j.y,j.z,a,j),M}getClosestFacetAtLocalCoordinates(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]&&arguments[4],b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],w=null,a=0,D=0,S=0,M=0,q=0,E=0,I=0,R=0;const Z=this.getFacetLocalPositions(),L=this.getFacetLocalNormals(),B=this.getFacetsAtLocalCoordinates(h,d,m);if(!B)return null;let V,v,C,T=Number.MAX_VALUE,o=T;for(let y=0;y<B.length;y++)V=B[y],v=L[V],C=Z[V],M=(h-C.x)*v.x+(d-C.y)*v.y+(m-C.z)*v.z,(!A||A&&b&&M>=0||A&&!b&&M<=0)&&(M=v.x*C.x+v.y*C.y+v.z*C.z,q=-(v.x*h+v.y*d+v.z*m-M)/(v.x*v.x+v.y*v.y+v.z*v.z),E=h+v.x*q,I=d+v.y*q,R=m+v.z*q,a=E-h,D=I-d,S=R-m,o=a*a+D*D+S*S,o<T&&(T=o,w=V,j&&(j.x=E,j.y=I,j.z=R)));return w}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const h=this._internalAbstractMeshDataInfo._facetData;return h.facetDataEnabled&&(h.facetDataEnabled=!1,h.facetPositions=[],h.facetNormals=[],h.facetPartitioning=new Array,h.facetParameters={},h.depthSortedIndices=new Uint32Array(0)),this}updateIndices(h,d){return this}createNormals(h){const d=this.getVerticesData(w.d.PositionKind),m=this.Vd();let j;return j=this.isVerticesDataPresent(w.d.NormalKind)?this.getVerticesData(w.d.NormalKind):[],a.c.ComputeNormals(d,m,j,{useRightHandedSystem:this.ih().useRightHandedSystem}),this.xh(w.d.NormalKind,j,h),this}async optimizeIndicesAsync(){const h=this.Vd();if(!h)return this;const{OptimizeIndices:d}=await m.e(35).then(m.bind(m,13374));return d(h),this.setIndices(h,this.getTotalVertices()),this}alignWithNormal(h,d){d||(d=B.e.Y);const m=b.d.Qd[0],j=b.d.Qd[1];return b.i.CrossToRef(d,h,j),b.i.CrossToRef(h,j,m),this.rotationQuaternion?b.c.RotationQuaternionFromAxisToRef(m,h,j,this.rotationQuaternion):b.i.RotationFromAxisToRef(m,h,j,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,I.b)("EdgesRenderer")}enableEdgesRendering(h,d,m){throw(0,I.b)("EdgesRenderer")}DE(){return this._scene.aE.filter((h=>h.k===this))}}y.OCCLUSION_TYPE_NONE=0,y.OCCLUSION_TYPE_OPTIMISTIC=1,y.OCCLUSION_TYPE_STRICT=2,y.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,y.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,y.CULLINGSTRATEGY_STANDARD=0,y.oq=1,y.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,y.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,j.d)([v.f.filter((function(){for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];let[j,A,b,w,a]=d;return!Array.isArray(j)&&!Array.isArray(A)&&!Array.isArray(b)&&!Array.isArray(w)&&!Array.isArray(a)}))],y,"_ApplySkeleton",null),(0,V.i)("BABYLON.AbstractMesh",y)},11794:(h,d,m)=>{m.d(d,{b:()=>j.d});var j=m(11281)},11443:(h,d,m)=>{m.d(d,{b:()=>L});var j=m(11058),A=m(11353),b=m(11388),w=m(11281),a=m(11276),D=m(11445),S=m(11303),M=m(11107),q=m(11350),E=m(11323),I=m(11094),R=m(11449),Z=m(11290);class L{get boundingBias(){return this._boundingBias}set boundingBias(h){this._boundingBias?this._boundingBias.D(h):this._boundingBias=h.clone(),this.rh(!0,null)}static CreateGeometryForMesh(h){const d=new L(L.RandomId(),h.ih());return d.Nh(h),d}get meshes(){return this._meshes}constructor(h,d,m){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={minimum:new j.i(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),maximum:new j.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=d||I.b.LastCreatedScene,this._scene&&(this.id=h,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=A,m?this.setAllVerticesData(m,A):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),b&&(this.Nh(b),b.Zd(!0)))}get extend(){return this._extend}ih(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let h=0;h<this._meshes.length;h++)if(!this._meshes[h].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const h=new Set;for(const d in this._vertexBuffers)h.add(this._vertexBuffers[d].getWrapperBuffer());h.forEach((h=>{h._rebuild()}))}setAllVerticesData(h,d){h.applyToGeometry(this,d),this._notifyUpdate()}xh(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0;m&&Array.isArray(d)&&(d=new Float32Array(d));const A=new w.d(this._engine,d,h,{updatable:m,postponeInternalCreation:0===this._meshes.length,stride:j,label:"Geometry_"+this.id+"_"+h});this.setVerticesBuffer(A)}removeVerticesData(h){this._vertexBuffers[h]&&(this._vertexBuffers[h].dispose(),delete this._vertexBuffers[h]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const A=h.getKind();this._vertexBuffers[A]&&m&&this._vertexBuffers[A].dispose(),h._buffer&&h._buffer._increaseReferences(),this._vertexBuffers[A]=h;const b=this._meshes,a=b.length;if(A===w.d.PositionKind){this._totalVertices=d??h._maxVerticesCount,this._updateExtend(h.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const m=this._extend&&this._extend.minimum||new j.i(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),A=this._extend&&this._extend.maximum||new j.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let h=0;h<a;h++){const d=b[h];d.buildBoundingInfo(m,A),d._createGlobalSubMesh(d.isUnIndexed),d.Zd(!0),d.synchronizeInstances()}}this._notifyUpdate(A)}updateVerticesDataDirectly(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const A=this.getVertexBuffer(h);A&&(A.updateDirectly(d,m,j),this._notifyUpdate(h))}updateVerticesData(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=this.getVertexBuffer(h);j&&(j.update(d),h===w.d.PositionKind&&this.rh(m,d),this._notifyUpdate(h))}rh(h,d){if(h&&this._updateExtend(d),this._resetPointsArrayCache(),h){const h=this._meshes;for(const d of h){d.hasBoundingInfo?d.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):d.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const h=d.Ab;for(const d of h)d.refreshBoundingInfo()}}}_bind(h,d,m,j){if(!h)return;void 0===d&&(d=this._indexBuffer);const A=this.getVertexBuffers();if(!A)return;if(d!=this._indexBuffer||!this._vertexArrayObjects&&!j)return void this._engine.bindBuffers(A,d,h,m);const b=j||this._vertexArrayObjects,w=this._engine;b[h.key]||(b[h.key]=w.recordVertexArrayObject(A,d,h,m)),w.bindVertexArrayObject(b[h.key],d)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(h,d,m){const j=this.getVertexBuffer(h);return j?j.getFloatData(this._totalVertices,m||d&&1!==this._meshes.length):null}copyVerticesData(h,d){const m=this.getVertexBuffer(h);if(!m)return;d[h]||(d[h]=new Float32Array(this._totalVertices*m.getSize()));const j=m.getData();j&&(0,Z.d)(j,m.getSize(),m.type,m.byteOffset,m.byteStride,m.normalized,this._totalVertices,d[h])}isVertexBufferUpdatable(h){const d=this._vertexBuffers[h];return!!d&&d.isUpdatable()}getVertexBuffer(h){return this.isReady()?this._vertexBuffers[h]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(h){return this._vertexBuffers?void 0!==this._vertexBuffers[h]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(h)}getVerticesDataKinds(){const h=[];let d;if(!this._vertexBuffers&&this._delayInfo)for(d in this._delayInfo)h.push(d);else for(d in this._vertexBuffers)h.push(d);return h}updateIndices(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const j=h.length!==this._indices.length;if(m||(this._indices=h.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,h,d),j)for(const h of this._meshes)h._createGlobalSubMesh(!0)}else this.setIndices(h,null,!0)}setIndexBuffer(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=h,this._totalVertices=d,this._totalIndices=m,h.is32Bits=null===j?d>65535:j;for(const A of this._meshes)A._createGlobalSubMesh(!0),A.synchronizeInstances();this._notifyUpdate()}setIndices(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=h,this._indexBufferIsUpdatable=m,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,m,"Geometry_"+this.id+"_IndexBuffer")),void 0!=d&&(this._totalVertices=d);for(const A of this._meshes)A._createGlobalSubMesh(!j),A.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Vd(h,d){if(!this.isReady())return null;const m=this._indices;return d||h&&1!==this._meshes.length?m.slice():m}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;h&&this._vertexArrayObjects&&this._vertexArrayObjects[h.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[h.key]),delete this._vertexArrayObjects[h.key])}releaseForMesh(h,d){const m=this._meshes,j=m.indexOf(h);-1!==j&&(m.splice(j,1),this._vertexArrayObjects&&h._invalidateInstanceVertexArrayObject(),h._geometry=null,0===m.length&&d&&this.dispose())}Nh(h){if(h._geometry===this)return;const d=h._geometry;d&&d.releaseForMesh(h),this._vertexArrayObjects&&h._invalidateInstanceVertexArrayObject();const m=this._meshes;h._geometry=this,h._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),m.push(h),this.isReady()?this._applyToMesh(h):this._boundingInfo&&h.setBoundingInfo(this._boundingInfo)}_updateExtend(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!h&&(h=this.getVerticesData(w.d.PositionKind),!h))return;this._extend=(0,E.e)(h,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(h){const d=this._meshes.length;for(const m in this._vertexBuffers)1===d&&this._vertexBuffers[m].create(),m===w.d.PositionKind&&(this._extend||this._updateExtend(),h.buildBoundingInfo(this._extend.minimum,this._extend.maximum),h._createGlobalSubMesh(h.isUnIndexed),h.rh());1===d&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),h._syncGeometryWithMorphTargetManager(),h.synchronizeInstances()}_notifyUpdate(h){this.onGeometryUpdated&&this.onGeometryUpdated(this,h),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const d of this._meshes)d._markSubMeshesAsAttributesDirty()}load(h,d){2!==this.delayLoadState&&(this.isReady()?d&&d():(this.delayLoadState=2,this._queueLoad(h,d)))}_queueLoad(h,d){this.delayLoadingFile&&(h.addPendingData(this),h._loadFile(this.delayLoadingFile,(m=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(m),this),this.delayLoadState=1,this._delayInfo=[],h.removePendingData(this);const j=this._meshes,A=j.length;for(let h=0;h<A;h++)this._applyToMesh(j[h]);d&&d()}),void 0,!0))}toLeftHanded(){const h=this.Vd(!1);if(null!=h&&h.length>0){for(let d=0;d<h.length;d+=3){const m=h[d+0];h[d+0]=h[d+2],h[d+2]=m}this.setIndices(h)}const d=this.getVerticesData(w.d.PositionKind,!1);if(null!=d&&d.length>0){for(let h=0;h<d.length;h+=3)d[h+2]=-d[h+2];this.xh(w.d.PositionKind,d,!1)}const m=this.getVerticesData(w.d.NormalKind,!1);if(null!=m&&m.length>0){for(let h=0;h<m.length;h+=3)m[h+2]=-m[h+2];this.xh(w.d.NormalKind,m,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const h=this.getVerticesData(w.d.PositionKind);if(!h||0===h.length)return!1;for(let d=3*this._positionsCache.length,m=this._positionsCache.length;d<h.length;d+=3,++m)this._positionsCache[m]=j.i.Ud(h,d);for(let d=0,m=0;d<h.length;d+=3,++m)this._positionsCache[m].set(h[0+d],h[1+d],h[2+d]);return this._positionsCache.length=h.length/3,this._positions=this._positionsCache,!0}q(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const m in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[m]);this._vertexArrayObjects={};const h=this._meshes,d=h.length;for(let m=0;m<d;m++)h[m]._invalidateInstanceVertexArrayObject()}}dispose(){const h=this._meshes,d=h.length;let m;for(m=0;m<d;m++)this.releaseForMesh(h[m]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const j in this._vertexBuffers)this._vertexBuffers[j].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const h=this._parentContainer.geometries.indexOf(this);h>-1&&this._parentContainer.geometries.splice(h,1),this._parentContainer=null}this._isDisposed=!0}i(h){const d=new b.c;d.indices=[];const m=this.Vd();if(m)for(let b=0;b<m.length;b++)d.indices.push(m[b]);let j,A=!1,w=!1;for(j in this._vertexBuffers){const h=this.getVerticesData(j);if(h&&(h instanceof Float32Array?d.set(new Float32Array(h),j):d.set(h.slice(0),j),!w)){const h=this.getVertexBuffer(j);h&&(A=h.isUpdatable(),w=!A)}}const a=new L(h,this._scene,d,A);for(j in a.delayLoadState=this.delayLoadState,a.delayLoadingFile=this.delayLoadingFile,a._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)a._delayInfo=a._delayInfo||[],a._delayInfo.push(j);return a._boundingInfo=new S.e(this._extend.minimum,this._extend.maximum),a}serialize(){const h={};return h.id=this.id,h.uniqueId=this.uniqueId,h.updatable=this._updatable,q.e&&q.e.HasTags(this)&&(h.tags=q.e.GetTags(this)),h}_toNumberArray(h){return Array.isArray(h)?h:Array.prototype.slice.call(h)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const h in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,h)&&(this._vertexBuffers[h]._buffer._data=null)}serializeVerticeData(){const h=this.serialize();return this.isVerticesDataPresent(w.d.PositionKind)&&(h.Fh=this._toNumberArray(this.getVerticesData(w.d.PositionKind)),this.isVertexBufferUpdatable(w.d.PositionKind)&&(h.positionsUpdatable=!0)),this.isVerticesDataPresent(w.d.NormalKind)&&(h.fh=this._toNumberArray(this.getVerticesData(w.d.NormalKind)),this.isVertexBufferUpdatable(w.d.NormalKind)&&(h.normalsUpdatable=!0)),this.isVerticesDataPresent(w.d.TangentKind)&&(h.tangents=this._toNumberArray(this.getVerticesData(w.d.TangentKind)),this.isVertexBufferUpdatable(w.d.TangentKind)&&(h.tangentsUpdatable=!0)),this.isVerticesDataPresent(w.d.UVKind)&&(h.kh=this._toNumberArray(this.getVerticesData(w.d.UVKind)),this.isVertexBufferUpdatable(w.d.UVKind)&&(h.uvsUpdatable=!0)),this.isVerticesDataPresent(w.d.UV2Kind)&&(h.uvs2=this._toNumberArray(this.getVerticesData(w.d.UV2Kind)),this.isVertexBufferUpdatable(w.d.UV2Kind)&&(h.uvs2Updatable=!0)),this.isVerticesDataPresent(w.d.UV3Kind)&&(h.uvs3=this._toNumberArray(this.getVerticesData(w.d.UV3Kind)),this.isVertexBufferUpdatable(w.d.UV3Kind)&&(h.uvs3Updatable=!0)),this.isVerticesDataPresent(w.d.UV4Kind)&&(h.uvs4=this._toNumberArray(this.getVerticesData(w.d.UV4Kind)),this.isVertexBufferUpdatable(w.d.UV4Kind)&&(h.uvs4Updatable=!0)),this.isVerticesDataPresent(w.d.UV5Kind)&&(h.uvs5=this._toNumberArray(this.getVerticesData(w.d.UV5Kind)),this.isVertexBufferUpdatable(w.d.UV5Kind)&&(h.uvs5Updatable=!0)),this.isVerticesDataPresent(w.d.UV6Kind)&&(h.uvs6=this._toNumberArray(this.getVerticesData(w.d.UV6Kind)),this.isVertexBufferUpdatable(w.d.UV6Kind)&&(h.uvs6Updatable=!0)),this.isVerticesDataPresent(w.d.ColorKind)&&(h.Hh=this._toNumberArray(this.getVerticesData(w.d.ColorKind)),this.isVertexBufferUpdatable(w.d.ColorKind)&&(h.colorsUpdatable=!0)),this.isVerticesDataPresent(w.d.MatricesIndicesKind)&&(h.matricesIndices=this._toNumberArray(this.getVerticesData(w.d.MatricesIndicesKind)),h.matricesIndicesExpanded=!0,this.isVertexBufferUpdatable(w.d.MatricesIndicesKind)&&(h.matricesIndicesUpdatable=!0)),this.isVerticesDataPresent(w.d.MatricesWeightsKind)&&(h.matricesWeights=this._toNumberArray(this.getVerticesData(w.d.MatricesWeightsKind)),this.isVertexBufferUpdatable(w.d.MatricesWeightsKind)&&(h.matricesWeightsUpdatable=!0)),h.indices=this._toNumberArray(this.Vd()),h}static ExtractFromMesh(h,d){const m=h._geometry;return m?m.i(d):null}static RandomId(){return M.e.RandomId()}static _GetGeometryByLoadedUniqueId(h,d){for(let m=0;m<d.geometries.length;m++)if(d.geometries[m]._loadedUniqueId===h)return d.geometries[m];return null}static _ImportGeometry(h,d){const m=d.ih(),j=h.geometryUniqueId,b=h.geometryId;if(j||b){const h=j?this._GetGeometryByLoadedUniqueId(j,m):m.getGeometryById(b);h&&h.Nh(d)}else if(h instanceof ArrayBuffer){const m=d._binaryInfo;if(m.positionsAttrDesc&&m.positionsAttrDesc.count>0){const j=new Float32Array(h,m.positionsAttrDesc.offset,m.positionsAttrDesc.count);d.xh(w.d.PositionKind,j,!1)}if(m.normalsAttrDesc&&m.normalsAttrDesc.count>0){const j=new Float32Array(h,m.normalsAttrDesc.offset,m.normalsAttrDesc.count);d.xh(w.d.NormalKind,j,!1)}if(m.tangetsAttrDesc&&m.tangetsAttrDesc.count>0){const j=new Float32Array(h,m.tangetsAttrDesc.offset,m.tangetsAttrDesc.count);d.xh(w.d.TangentKind,j,!1)}if(m.uvsAttrDesc&&m.uvsAttrDesc.count>0){const j=new Float32Array(h,m.uvsAttrDesc.offset,m.uvsAttrDesc.count);if(R.b)for(let h=1;h<j.length;h+=2)j[h]=1-j[h];d.xh(w.d.UVKind,j,!1)}if(m.uvs2AttrDesc&&m.uvs2AttrDesc.count>0){const j=new Float32Array(h,m.uvs2AttrDesc.offset,m.uvs2AttrDesc.count);if(R.b)for(let h=1;h<j.length;h+=2)j[h]=1-j[h];d.xh(w.d.UV2Kind,j,!1)}if(m.uvs3AttrDesc&&m.uvs3AttrDesc.count>0){const j=new Float32Array(h,m.uvs3AttrDesc.offset,m.uvs3AttrDesc.count);if(R.b)for(let h=1;h<j.length;h+=2)j[h]=1-j[h];d.xh(w.d.UV3Kind,j,!1)}if(m.uvs4AttrDesc&&m.uvs4AttrDesc.count>0){const j=new Float32Array(h,m.uvs4AttrDesc.offset,m.uvs4AttrDesc.count);if(R.b)for(let h=1;h<j.length;h+=2)j[h]=1-j[h];d.xh(w.d.UV4Kind,j,!1)}if(m.uvs5AttrDesc&&m.uvs5AttrDesc.count>0){const j=new Float32Array(h,m.uvs5AttrDesc.offset,m.uvs5AttrDesc.count);if(R.b)for(let h=1;h<j.length;h+=2)j[h]=1-j[h];d.xh(w.d.UV5Kind,j,!1)}if(m.uvs6AttrDesc&&m.uvs6AttrDesc.count>0){const j=new Float32Array(h,m.uvs6AttrDesc.offset,m.uvs6AttrDesc.count);if(R.b)for(let h=1;h<j.length;h+=2)j[h]=1-j[h];d.xh(w.d.UV6Kind,j,!1)}if(m.colorsAttrDesc&&m.colorsAttrDesc.count>0){const j=new Float32Array(h,m.colorsAttrDesc.offset,m.colorsAttrDesc.count);d.xh(w.d.ColorKind,j,!1,m.colorsAttrDesc.stride)}if(m.matricesIndicesAttrDesc&&m.matricesIndicesAttrDesc.count>0){const j=new Int32Array(h,m.matricesIndicesAttrDesc.offset,m.matricesIndicesAttrDesc.count),A=[];for(let h=0;h<j.length;h++){const d=j[h];A.push(255&d),A.push((65280&d)>>8),A.push((16711680&d)>>16),A.push(d>>24&255)}d.xh(w.d.MatricesIndicesKind,A,!1)}if(m.matricesIndicesExtraAttrDesc&&m.matricesIndicesExtraAttrDesc.count>0){const j=new Int32Array(h,m.matricesIndicesExtraAttrDesc.offset,m.matricesIndicesExtraAttrDesc.count),A=[];for(let h=0;h<j.length;h++){const d=j[h];A.push(255&d),A.push((65280&d)>>8),A.push((16711680&d)>>16),A.push(d>>24&255)}d.xh(w.d.MatricesIndicesExtraKind,A,!1)}if(m.matricesWeightsAttrDesc&&m.matricesWeightsAttrDesc.count>0){const j=new Float32Array(h,m.matricesWeightsAttrDesc.offset,m.matricesWeightsAttrDesc.count);d.xh(w.d.MatricesWeightsKind,j,!1)}if(m.indicesAttrDesc&&m.indicesAttrDesc.count>0){const j=new Int32Array(h,m.indicesAttrDesc.offset,m.indicesAttrDesc.count);d.setIndices(j,null)}if(m.subMeshesAttrDesc&&m.subMeshesAttrDesc.count>0){const j=new Int32Array(h,m.subMeshesAttrDesc.offset,5*m.subMeshesAttrDesc.count);d.Ab=[];for(let h=0;h<m.subMeshesAttrDesc.count;h++){const m=j[5*h+0],A=j[5*h+1],b=j[5*h+2],w=j[5*h+3],D=j[5*h+4];a.b.AddToMesh(m,A,b,w,D,d)}}}else if(h.Fh&&h.fh&&h.indices){if(d.xh(w.d.PositionKind,h.Fh,h.Fh._updatable||h.positionsUpdatable),d.xh(w.d.NormalKind,h.fh,h.fh._updatable||h.normalsUpdatable),h.tangents&&d.xh(w.d.TangentKind,h.tangents,h.tangents._updatable||h.tangentsUpdatable),h.kh&&d.xh(w.d.UVKind,h.kh,h.kh._updatable||h.uvsUpdatable),h.uvs2&&d.xh(w.d.UV2Kind,h.uvs2,h.uvs2._updatable||h.uvs2Updatable),h.uvs3&&d.xh(w.d.UV3Kind,h.uvs3,h.uvs3._updatable||h.uvs3Updatable),h.uvs4&&d.xh(w.d.UV4Kind,h.uvs4,h.uvs4._updatable||h.uvs4Updatable),h.uvs5&&d.xh(w.d.UV5Kind,h.uvs5,h.uvs5._updatable||h.uvs5Updatable),h.uvs6&&d.xh(w.d.UV6Kind,h.uvs6,h.uvs6._updatable||h.uvs6Updatable),h.Hh&&d.xh(w.d.ColorKind,A.f.CheckColors4(h.Hh,h.Fh.length/3),h.Hh._updatable),h.matricesIndices)if(h.matricesIndices._isExpanded||h.matricesIndicesExpanded)delete h.matricesIndices._isExpanded,delete h.matricesIndicesExpanded,d.xh(w.d.MatricesIndicesKind,h.matricesIndices,h.matricesIndices._updatable||h.matricesIndicesUpdatable);else{const m=[];for(let d=0;d<h.matricesIndices.length;d++){const j=h.matricesIndices[d];m.push(255&j),m.push((65280&j)>>8),m.push((16711680&j)>>16),m.push(j>>24&255)}d.xh(w.d.MatricesIndicesKind,m,h.matricesIndices._updatable||h.matricesIndicesUpdatable)}if(h.matricesIndicesExtra)if(h.matricesIndicesExtraExpanded||h.matricesIndicesExtra._isExpanded)delete h.matricesIndices._isExpanded,delete h.matricesIndicesExtraExpanded,d.xh(w.d.MatricesIndicesExtraKind,h.matricesIndicesExtra,h.matricesIndicesExtra._updatable||h.matricesIndicesExtraUpdatable);else{const m=[];for(let d=0;d<h.matricesIndicesExtra.length;d++){const j=h.matricesIndicesExtra[d];m.push(255&j),m.push((65280&j)>>8),m.push((16711680&j)>>16),m.push(j>>24&255)}d.xh(w.d.MatricesIndicesExtraKind,m,h.matricesIndicesExtra._updatable||h.matricesIndicesExtraUpdatable)}h.matricesWeights&&(L._CleanMatricesWeights(h,d),d.xh(w.d.MatricesWeightsKind,h.matricesWeights,h.matricesWeights._updatable)),h.matricesWeightsExtra&&d.xh(w.d.MatricesWeightsExtraKind,h.matricesWeightsExtra,h.matricesWeights._updatable),d.setIndices(h.indices,null)}if(h.Ab){d.Ab=[];for(let m=0;m<h.Ab.length;m++){const j=h.Ab[m];a.b.AddToMesh(j.materialIndex,j.verticesStart,j.verticesCount,j.indexStart,j.indexCount,d)}}d._shouldGenerateFlatShading&&(d.convertToFlatShadedMesh(),d._shouldGenerateFlatShading=!1),d.Zd(!0),m.onMeshImportedObservable.notifyObservers(d)}static _CleanMatricesWeights(h,d){const m=.001;if(!D.c.CleanBoneMatrixWeights)return;let j=0;if(!(h.skeletonId>-1))return;{const m=d.ih().getLastSkeletonById(h.skeletonId);if(!m)return;j=m.bones.length}const A=d.getVerticesData(w.d.MatricesIndicesKind),b=d.getVerticesData(w.d.MatricesIndicesExtraKind),a=h.matricesWeights,S=h.matricesWeightsExtra,M=h.numBoneInfluencer,q=a.length;for(let w=0;w<q;w+=4){let h=0,d=-1;for(let j=0;j<4;j++){const A=a[w+j];h+=A,A<m&&d<0&&(d=j)}if(S)for(let j=0;j<4;j++){const A=S[w+j];h+=A,A<m&&d<0&&(d=j+4)}if((d<0||d>M-1)&&(d=M-1),h>m){const d=1/h;for(let h=0;h<4;h++)a[w+h]*=d;if(S)for(let h=0;h<4;h++)S[w+h]*=d}else d>=4?(S[w+d-4]=1-h,b[w+d-4]=j):(a[w+d]=1-h,A[w+d]=j)}d.xh(w.d.MatricesIndicesKind,A),h.matricesWeightsExtra&&d.xh(w.d.MatricesIndicesExtraKind,b)}static Parse(h,d,m){const A=new L(h.id,d,void 0,h.updatable);return A._loadedUniqueId=h.uniqueId,q.e&&q.e.AddTagsTo(A,h.tags),h.delayLoadingFile?(A.delayLoadState=4,A.delayLoadingFile=m+h.delayLoadingFile,A._boundingInfo=new S.e(j.i.Ud(h.boundingBoxMinimum),j.i.Ud(h.boundingBoxMaximum)),A._delayInfo=[],h.hasUVs&&A._delayInfo.push(w.d.UVKind),h.hasUVs2&&A._delayInfo.push(w.d.UV2Kind),h.hasUVs3&&A._delayInfo.push(w.d.UV3Kind),h.hasUVs4&&A._delayInfo.push(w.d.UV4Kind),h.hasUVs5&&A._delayInfo.push(w.d.UV5Kind),h.hasUVs6&&A._delayInfo.push(w.d.UV6Kind),h.hasColors&&A._delayInfo.push(w.d.ColorKind),h.hasMatricesIndices&&A._delayInfo.push(w.d.MatricesIndicesKind),h.hasMatricesWeights&&A._delayInfo.push(w.d.MatricesWeightsKind),A._delayLoadingFunction=b.c.ImportVertexData):b.c.ImportVertexData(h,A),d.pushGeometry(A,!0),A}}},11412:(h,d,m)=>{m.d(d,{b:()=>E});var j=m(11058),A=m(11121),b=m(11380),w=m(11419),a=m(11126),D=m(11366),S=m(11281),M=m(11107),q=m(11080);w.d._instancedMeshFactory=(h,d)=>{const m=new E(h,d);if(d.instancedBuffers){m.instancedBuffers={};for(const h in d.instancedBuffers)m.instancedBuffers[h]=d.instancedBuffers[h]}return m};class E extends b.b{constructor(h,d){super(h,d.ih()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,d.oE(this),this._sourceMesh=d,this._unIndexed=d._unIndexed,this.position.D(d.position),this.rotation.D(d.rotation),this.td.D(d.td),d.rotationQuaternion&&(this.rotationQuaternion=d.rotationQuaternion.clone()),this.animations=d.animations.slice();for(const m of d.getAnimationRanges())null!=m&&this.createAnimationRange(m.name,m.from,m.to);if(this.infiniteDistance=d.infiniteDistance,this.setPivotMatrix(d.getPivotMatrix()),d.skeleton||d.morphTargetManager||!d.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const h=d.getBoundingInfo();this.buildBoundingInfo(h.minimum,h.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(h){var d;(null===(d=this._sourceMesh)||void 0===d?void 0:d.receiveShadows)!==h&&M.e.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(h){var d;(null===(d=this._sourceMesh)||void 0===d?void 0:d.material)!==h&&M.e.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(h){var d;(null===(d=this._sourceMesh)||void 0===d?void 0:d.visibility)!==h&&M.e.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(h){var d;(null===(d=this._sourceMesh)||void 0===d?void 0:d.skeleton)!==h&&M.e.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(h){this._sourceMesh&&h!==this._sourceMesh.renderingGroupId&&A.c.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get Ld(){return this._sourceMesh._geometry}createInstance(h){return this._sourceMesh.createInstance(h)}isReady(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(h,!0)}getVerticesData(h,d,m){return this._sourceMesh.getVerticesData(h,d,m)}copyVerticesData(h,d){this._sourceMesh.copyVerticesData(h,d)}xh(h,d,m,j){return this.sourceMesh&&this.sourceMesh.xh(h,d,m,j),this.sourceMesh}updateVerticesData(h,d,m,j){return this.sourceMesh&&this.sourceMesh.updateVerticesData(h,d,m,j),this.sourceMesh}setIndices(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(h,d),this.sourceMesh}isVerticesDataPresent(h){return this._sourceMesh.isVerticesDataPresent(h)}Vd(){return this._sourceMesh.Vd()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let h,d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],m=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;h="object"===typeof d?d:{applySkeleton:d,applyMorph:m};const j=this._sourceMesh.Ld?this._sourceMesh.Ld.boundingBias:null;return this.Yh(this._sourceMesh._getData(h,null,S.d.PositionKind),j),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(h,d){if(super._activate(h,d),this._sourceMesh.Ab||A.c.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,h),d){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==D.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new j.b);const h=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,j.d.Qd[7].D(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.D(this._currentLOD.Zd(!0)),this._currentLOD.position.D(j.d.Qd[7]),this._currentLOD._masterMesh=h,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(h){if(!h)return this;const d=this.sourceMesh.getLODLevels();if(d&&0!==d.length){const d=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(h,d.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(h){return this.sourceMesh._preActivateForIntermediateRendering(h)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.Ab)for(let h=0;h<this._sourceMesh.Ab.length;h++)this._sourceMesh.Ab[h].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}rh(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0;const j=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(h);if(a.e.DeepCopy(this,j,["name","Ab","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","wE","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","Ld"],[]),this.refreshBoundingInfo(),d&&(j.parent=d),!m)for(let A=0;A<this.ih().meshes.length;A++){const h=this.ih().meshes[A];h.parent===this&&h.clone(h.name,j)}return j.Zd(!0),this.onClonedObservable.notifyObservers(j),j}dispose(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.TE(this),super.dispose(h,d)}_serializeAsParent(h){super._serializeAsParent(h),h.parentId=this._sourceMesh.uniqueId,h.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;const j=this.clone("Clone of "+(this.name||this.id),h||this.parent,!0,d&&d.newSourcedMesh);j&&m&&m(this,j);for(const A of this.getChildTransformNodes(!0))A.instantiateHierarchy(j,d,m);return j}}w.d.prototype.registerInstancedBuffer=function(h,d){var m,j;if(null===(m=this._userInstancedBuffersStorage)||void 0===m||null===(j=m.vertexBuffers[h])||void 0===j||j.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const h of this.instances)h.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[h]=null,this._userInstancedBuffersStorage.strides[h]=d,this._userInstancedBuffersStorage.sizes[h]=32*d,this._userInstancedBuffersStorage.data[h]=new Float32Array(this._userInstancedBuffersStorage.sizes[h]),this._userInstancedBuffersStorage.vertexBuffers[h]=new S.d(this.getEngine(),this._userInstancedBuffersStorage.data[h],h,!0,!1,d,!0);for(const A of this.instances)A.instancedBuffers[h]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},w.d.prototype._processInstancedBuffers=function(h,d){const m=h?h.length:0;for(const j in this.instancedBuffers){let A=this._userInstancedBuffersStorage.sizes[j];const b=this._userInstancedBuffersStorage.strides[j],w=(m+1)*b;for(;A<w;)A*=2;this._userInstancedBuffersStorage.data[j].length!=A&&(this._userInstancedBuffersStorage.data[j]=new Float32Array(A),this._userInstancedBuffersStorage.sizes[j]=A,this._userInstancedBuffersStorage.vertexBuffers[j]&&(this._userInstancedBuffersStorage.vertexBuffers[j].dispose(),this._userInstancedBuffersStorage.vertexBuffers[j]=null));const a=this._userInstancedBuffersStorage.data[j];let D=0;if(d){const h=this.instancedBuffers[j];h.toArray?h.toArray(a,D):h.copyToArray?h.copyToArray(a,D):a[D]=h,D+=b}for(let d=0;d<m;d++){const m=h[d].instancedBuffers[j];m.toArray?m.toArray(a,D):m.copyToArray?m.copyToArray(a,D):a[D]=m,D+=b}this._userInstancedBuffersStorage.vertexBuffers[j]?this._userInstancedBuffersStorage.vertexBuffers[j].updateDirectly(a,0):(this._userInstancedBuffersStorage.vertexBuffers[j]=new S.d(this.getEngine(),this._userInstancedBuffersStorage.data[j],j,!0,!1,b,!0),this._invalidateInstanceVertexArrayObject())}},w.d.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const h in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[h]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},w.d.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const h in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[h]&&this._userInstancedBuffersStorage.vertexBuffers[h].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,q.i)("BABYLON.InstancedMesh",E)},11740:(h,d,m)=>{m.d(d,{d:()=>S});var j=m(11353),A=m(11281),b=m(11419),w=m(11412),a=m(11251),D=m(11747);b.d._LinesMeshParser=(h,d)=>S.Parse(h,d);class S extends b.d{_isShaderMaterial(h){return"ShaderMaterial"===h.getClassName()}constructor(h){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>5?arguments[5]:void 0,w=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0;super(h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d,arguments.length>4?arguments[4]:void 0),this.useVertexColor=b,this.useVertexAlpha=w,this.color=new j.d(1,1,1),this.alpha=1,this._shaderLanguage=0,d&&(this.color=d.color.clone(),this.alpha=d.alpha,this.useVertexColor=d.useVertexColor,this.useVertexAlpha=d.useVertexAlpha),this.intersectionThreshold=.1;const M={attributes:[A.d.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?M.defines.push("#define VERTEXALPHA"):M.needAlphaBlending=!1,this.useVertexColor?(M.defines.push("#define VERTEXCOLOR"),M.attributes.push(A.d.ColorKind)):(M.uniforms.push("color"),this._color4=new j.f),a)this.material=a;else{this.ih().getEngine().isWebGPU&&!S.ForceGLSL&&(this._shaderLanguage=1),M.shaderLanguage=this._shaderLanguage,M.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([m.e(23).then(m.bind(m,13984)),m.e(19).then(m.bind(m,13986))]):await Promise.all([m.e(17).then(m.bind(m,13993)),m.e(16).then(m.bind(m,14e3))])},this.material=new D.b("colorShader",this.ih(),"color",M,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(h){this._lineMaterial=h,this._lineMaterial.fillMode=a.d.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(h){}_bind(h,d){if(!this._geometry)return this;const m=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(d,m):this._geometry._bind(d,m,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:h,g:d,b:m}=this.color;this._color4.set(h,d,m,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(h,d,m){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const j=this.ih().getEngine();return this._unIndexed?j.drawArraysType(a.d.LineListDrawMode,h.verticesStart,h.verticesCount,m):j.drawElementsType(a.d.LineListDrawMode,h.indexStart,h.indexCount,m),this}dispose(h){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(h)}clone(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0;if(d&&void 0===d._addToSceneRootNodes){const m=d;return m.source=this,new S(h,this.ih(),m.parent,m.source,m.doNotCloneChildren)}return new S(h,this.ih(),d,this,m)}createInstance(h){const d=new M(h,this);if(this.instancedBuffers){d.instancedBuffers={};for(const h in this.instancedBuffers)d.instancedBuffers[h]=this.instancedBuffers[h]}return d}serialize(h){super.serialize(h),h.color=this.color.fd(),h.alpha=this.alpha}static Parse(h,d){const m=new S(h.name,d);return m.color=j.d.Ud(h.color),m.alpha=h.alpha,m}}S.ForceGLSL=!1;class M extends w.b{constructor(h,d){super(h,d),this.intersectionThreshold=d.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}},11419:(h,d,m)=>{m.d(d,{d:()=>K,h:()=>F});var j=m(11097),A=m(11107),b=m(11126),w=m(11350),a=m(11395),D=m(11427),S=m(11058),M=m(11353),q=m(11374),E=m(11281),I=m(11388),R=m(11443),Z=m(11380),L=m(11276),B=m(11251),V=m(11457),v=m(11445),C=m(11341),T=m(11121),o=m(11080),y=m(11137),i=m(11461);class g{constructor(h,d){this.distanceOrScreenCoverage=h,this.mesh=d}}class F{}class f{constructor(){this.visibleInstances={},this.batchCache=new H,this.batchCacheReplacementModeInFrozenMode=new H,this.instancesBufferSize=2048}}class H{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class c{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class k{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const l={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class K extends Z.b{static _GetDefaultSideOrientation(h){return h||K.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(h){this._internalMeshDataInfo._useLODScreenCoverage=h,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(h){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==h&&(h&&this._internalMeshDataInfo._sourcePositions&&(this.xh(E.d.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.xh(E.d.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=h,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new j.e),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new j.e),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new j.e),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new j.e),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new j.e),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(h){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(h)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(h){this._internalMeshDataInfo._forcedInstanceCount=h}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(h){this._internalMeshDataInfo._sideOrientation=h,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===h||!this._scene.useRightHandedSystem&&0===h}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(h){this.sideOrientation=h,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(h){this._internalMeshDataInfo._overrideRenderingFillMode=h}get material(){return this._internalAbstractMeshDataInfo._material}set material(h){h&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(h.sideOrientation=null),this._setMaterial(h)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(h){this._unIndexed!==h&&(this._unIndexed=h,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(h){this._instanceDataStorage.manualUpdate=h}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(h){this._instanceDataStorage.previousManualUpdate=h}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(h){this._instanceDataStorage.forceMatrixUpdates=h}_copySource(h,d){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const A=this.ih();if(h._geometry&&h._geometry.Nh(this),b.e.DeepCopy(h,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Ld","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","wE","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=h,A.useClonedMeshMap&&(h._internalMeshDataInfo.meshMap||(h._internalMeshDataInfo.meshMap={}),h._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=h._originalBuilderSideOrientation,this._creationDataStorage=h._creationDataStorage,h._ranges){const d=h._ranges;for(const h in d)Object.prototype.hasOwnProperty.call(d,h)&&d[h]&&this.createAnimationRange(h,d[h].from,d[h].to)}if(h.metadata&&h.metadata.clone?this.metadata=h.metadata.clone():this.metadata=h.metadata,this._internalMetadata=h._internalMetadata,w.e&&w.e.HasTags(h)&&w.e.AddTagsTo(this,w.e.GetTags(h,!0)),this.jD(h.isEnabled(!1)),this.parent=h.parent,this.setPivotMatrix(h.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+h.id,this.material=h.material,!d){const A=h.getDescendants(!0);for(let h=0;h<A.length;h++){const b=A[h];b._isMesh?(l.parent=this,l.doNotCloneChildren=d,l.clonePhysicsImpostor=m,l.cloneThinInstances=j,b.clone(this.name+"."+b.name,l)):b.clone&&b.clone(this.name+"."+b.name,this)}}if(h.morphTargetManager&&(this.morphTargetManager=h.morphTargetManager),A.getPhysicsEngine){const d=A.getPhysicsEngine();if(m&&d)if(1===d.getPluginVersion()){const m=d.getImpostorForPhysicsObject(h);m&&(this.physicsImpostor=m.clone(this))}else 2===d.getPluginVersion()&&h.physicsBody&&h.physicsBody.clone(this)}for(let b=0;b<A.aE.length;b++){const d=A.aE[b];d.k===h&&d.clone(d.name,this)}if(this.skeleton=h.skeleton,j&&(h._thinInstanceDataStorage.matrixData?(this.iq("matrix",new Float32Array(h._thinInstanceDataStorage.matrixData),16,!h._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=h._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=h._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=h._thinInstanceDataStorage.matrixBufferSize,h._userThinInstanceBuffersStorage)){const d=h._userThinInstanceBuffersStorage;for(const h in d.data){var a,D;this.iq(h,new Float32Array(d.data[h]),d.strides[h],!(null!==(a=d.vertexBuffers)&&void 0!==a&&null!==(D=a[h])&&void 0!==D&&D.isUpdatable())),this._userThinInstanceBuffersStorage.sizes[h]=d.sizes[h]}}this.refreshBoundingInfo(!0,!0),this.Zd(!0)}constructor(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4?arguments[4]:void 0,w=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(h,d),this._internalMeshDataInfo=new k,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new f,this._thinInstanceDataStorage=new c,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=K.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,d=this.ih(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(h,d,m)=>{h&&m&&(this._uniformBuffer?this.transferToEffect(d):m.bindOnlyWorldMatrix(d))};let a=null,D=!1;if(m&&void 0===m._addToSceneRootNodes){const h=m;a=h.parent??null,A=h.source??null,b=h.doNotCloneChildren??!1,w=h.clonePhysicsImpostor??!0,D=h.cloneThinInstances??!1}else a=m;A&&this._copySource(A,b,w,D),null!==a&&(this.parent=a),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=h=>{h.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new j.e(this._internalMeshDataInfo._onMeshReadyObserverAdded),A&&A.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;const j=0===this.getTotalVertices()||d&&d.doNotInstantiate&&(!0===d.doNotInstantiate||d.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),h||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));j.parent=h||this.parent,j.position=this.position.clone(),j.td=this.td.clone(),this.rotationQuaternion?j.rotationQuaternion=this.rotationQuaternion.clone():j.rotation=this.rotation.clone(),m&&m(this,j);for(const A of this.getChildTransformNodes(!0))"InstancedMesh"===A.getClassName()&&"Mesh"===j.getClassName()&&A.sourceMesh===this?A.instantiateHierarchy(j,{doNotInstantiate:d&&d.doNotInstantiate||!1,newSourcedMesh:j},m):A.instantiateHierarchy(j,d,m);return j}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(h){let d=super.toString(h);if(d+=", n vertices: "+this.getTotalVertices(),d+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let m=0;m<this.animations.length;m++)d+=", animation[0]: "+this.animations[m].toString(h);if(h)if(this._geometry){const h=this.Vd(),m=this.getVerticesData(E.d.PositionKind);m&&h&&(d+=", flat shading: "+(m.length/3===h.length?"YES":"NO"))}else d+=", flat shading: UNKNOWN";return d}_unBindEffect(){super._unBindEffect();for(const h of this.instances)h._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const h=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((d,m)=>d.distanceOrScreenCoverage<m.distanceOrScreenCoverage?h:d.distanceOrScreenCoverage>m.distanceOrScreenCoverage?-h:0))}addLODLevel(h,d){if(d&&d._masterMesh)return T.c.Warn("You cannot use a mesh as LOD level twice"),this;const m=new g(h,d);return this._internalMeshDataInfo._LODLevels.push(m),d&&(d._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(h){const d=this._internalMeshDataInfo;for(let m=0;m<d._LODLevels.length;m++){const j=d._LODLevels[m];if(j.distanceOrScreenCoverage===h)return j.mesh}return null}removeLODLevel(h){const d=this._internalMeshDataInfo;for(let m=0;m<d._LODLevels.length;m++)d._LODLevels[m].mesh===h&&(d._LODLevels.splice(m,1),h&&(h._masterMesh=null));return this._sortLODLevels(),this}getLOD(h,d){const m=this._internalMeshDataInfo;if(!m._LODLevels||0===m._LODLevels.length)return this;const j=d||this.getBoundingInfo().boundingSphere,A=h.mode===D.e.ORTHOGRAPHIC_CAMERA?h.jb:j.centerWorld.fm(h.globalPosition).length();let b=A,w=1;if(m._useLODScreenCoverage){const d=h.screenArea;let m=j.radiusWorld*h.jb/A;m=m*m*Math.PI,b=m/d,w=-1}if(w*m._LODLevels[m._LODLevels.length-1].distanceOrScreenCoverage>w*b)return this.onLODLevelSelection&&this.onLODLevelSelection(b,this,this),this;for(let a=0;a<m._LODLevels.length;a++){const h=m._LODLevels[a];if(w*h.distanceOrScreenCoverage<w*b){if(h.mesh){if(4===h.mesh.delayLoadState)return h.mesh._checkDelayState(),this;if(2===h.mesh.delayLoadState)return this;h.mesh._preActivate(),h.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(b,this,h.mesh),h.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(b,this,this),this}get Ld(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(h,d,m,j){var A,b;if(!this._geometry)return null;let w=j||null===(A=this._userInstancedBuffersStorage)||void 0===A||null===(b=A.vertexBuffers[h])||void 0===b?void 0:b.getFloatData(this.instances.length+1,m||d&&1!==this._geometry.meshes.length);return w||(w=this._geometry.getVerticesData(h,d,m)),w}copyVerticesData(h,d){this._geometry&&this._geometry.copyVerticesData(h,d)}getVertexBuffer(h,d){var m;return this._geometry?(d||null===(m=this._userInstancedBuffersStorage)||void 0===m?void 0:m.vertexBuffers[h])??this._geometry.getVertexBuffer(h):null}isVerticesDataPresent(h,d){var m;return this._geometry?!d&&void 0!==(null===(m=this._userInstancedBuffersStorage)||void 0===m?void 0:m.vertexBuffers[h])||this._geometry.isVerticesDataPresent(h):!!this._delayInfo&&-1!==this._delayInfo.indexOf(h)}isVertexBufferUpdatable(h,d){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(h);if(!d){var m;const d=null===(m=this._userInstancedBuffersStorage)||void 0===m?void 0:m.vertexBuffers[h];if(d)return d.isUpdatable()}return this._geometry.isVertexBufferUpdatable(h)}getVerticesDataKinds(h){if(!this._geometry){const h=[];if(this._delayInfo)for(const d of this._delayInfo)h.push(d);return h}const d=this._geometry.getVerticesDataKinds();if(!h&&this._userInstancedBuffersStorage)for(const m in this._userInstancedBuffersStorage.vertexBuffers)-1===d.indexOf(m)&&d.push(m);return d}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Vd(h,d){return this._geometry?this._geometry.Vd(h,d):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(h))return!1;if(!this.Ab||0===this.Ab.length)return!0;if(!h)return!0;const m=this.getEngine(),j=this.ih(),A=d||m.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Zd();const b=this.material||j.defaultMaterial;if(b)if(b._storeEffectOnSubMeshes)for(const E of this.Ab){const h=E.Qh();if(h)if(h._storeEffectOnSubMeshes){if(!h.isReadyForSubMesh(this,E,A))return!1}else if(!h.isReady(this,A))return!1}else if(!b.isReady(this,A))return!1;const w=m.currentRenderPassId;for(const E of this.lightSources){const h=E.getShadowGenerators();if(!h)continue;const d=h.values();for(let j=d.next();!0!==j.done;j=d.next()){var a,D,S,M;const h=j.value;if(h&&(null===(a=h.getShadowMap())||void 0===a||!a.renderList||null!==(D=h.getShadowMap())&&void 0!==D&&D.renderList&&-1!==(null===(S=h.getShadowMap())||void 0===S||null===(M=S.renderList)||void 0===M?void 0:M.indexOf(this)))){const d=h.getShadowMap().renderPassIds??[m.currentRenderPassId];for(let j=0;j<d.length;++j){m.currentRenderPassId=d[j];for(const d of this.Ab){var q;if(!h.isReady(d,A,(null===(q=d.Qh())||void 0===q?void 0:q.needAlphaBlendingForMesh(this))??!1))return m.currentRenderPassId=w,!1}}m.currentRenderPassId=w}}}for(const E of this._internalMeshDataInfo._LODLevels)if(E.mesh&&!E.mesh.isReady(A))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}KM(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(h){this._instanceDataStorage.overridenInstanceCount=h}_preActivate(){const h=this._internalMeshDataInfo,d=this.ih().getRenderId();return h._preActivateId===d||(h._preActivateId=d,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(h){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=h),this}_registerInstanceForRenderId(h,d){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:d,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[d]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=d,this._instanceDataStorage.visibleInstances[d]=new Array),this._instanceDataStorage.visibleInstances[d].push(h),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Wh||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let h,d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],m=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;h="object"===typeof d?d:{applySkeleton:d,applyMorph:m};const j=this.Ld?this.Ld.boundingBias:null;return this.Yh(this._getData(h,null,E.d.PositionKind),j),this}_createGlobalSubMesh(h){const d=this.getTotalVertices();if(!d||!this.Vd())return null;if(this.Ab&&this.Ab.length>0){const m=this.Vd();if(!m)return null;const j=m.length;let A=!1;if(h)A=!0;else for(const h of this.Ab){if(h.indexStart+h.indexCount>j){A=!0;break}if(h.verticesStart+h.verticesCount>d){A=!0;break}}if(!A)return this.Ab[0]}return this.releaseSubMeshes(),new L.b(0,0,d,0,this.getTotalIndices()||d,this)}subdivide(h){if(h<1)return;const d=this.getTotalIndices();let m=d/h|0,j=0;for(;m%3!==0;)m++;this.releaseSubMeshes();for(let A=0;A<h&&!(j>=d);A++)L.b.CreateFromIndices(0,j,A===h-1?d-j:m,this,void 0,!1),j+=m;this.refreshBoundingInfo(),this.synchronizeInstances()}xh(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.xh(h,d,m,j);else{const j=new I.c;j.set(d,h);const A=this.ih();new R.b(R.b.RandomId(),A,j,m,this)}return this}removeVerticesData(h){this._geometry&&this._geometry.removeVerticesData(h)}markVerticesDataAsUpdatable(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const m=this.getVertexBuffer(h);m&&m.isUpdatable()!==d&&this.xh(h,this.getVerticesData(h),d)}setVerticesBuffer(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=R.b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(h,null,d),this}updateVerticesData(h,d,m,j){return this._geometry?(j?(this.makeGeometryUnique(),this.updateVerticesData(h,d,m,!1)):this._geometry.updateVerticesData(h,d,m),this):this}updateMeshPositions(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const m=this.getVerticesData(E.d.PositionKind);if(!m)return this;if(h(m),this.updateVerticesData(E.d.PositionKind,m,!1,!1),d){const h=this.Vd(),d=this.getVerticesData(E.d.NormalKind);if(!d)return this;I.c.ComputeNormals(m,h,d),this.updateVerticesData(E.d.NormalKind,d,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const h=this._geometry,d=this._geometry.i(R.b.RandomId());return h.releaseForMesh(this,!0),d.Nh(this),this}setIndexBuffer(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=this._geometry;A||(A=new R.b(R.b.RandomId(),this.ih(),void 0,void 0,this)),A.setIndexBuffer(h,d,m,j)}setIndices(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(h,d,m,j);else{const d=new I.c;d.indices=h;const j=this.ih();new R.b(R.b.RandomId(),j,d,m,this)}return this}updateIndices(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(h,d,m),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(h,d,m){let j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const A=this.ih().getEngine();let b;if(this._unIndexed)if(this._getRenderingFillMode(m)===B.d.WireFrameFillMode)b=h._getLinesIndexBuffer(this.Vd(),A);else b=null;else switch(this._getRenderingFillMode(m)){case B.d.PointFillMode:b=null;break;case B.d.WireFrameFillMode:b=h._getLinesIndexBuffer(this.Vd(),A);break;default:case B.d.TriangleFillMode:b=this._geometry.getIndexBuffer()}return this._bindDirect(d,b,j)}_bindDirect(h,d){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(h),m&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(h,d,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(h,d),this):this}_draw(h,d,m){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const j=this.ih().getEngine();return this._unIndexed&&d!==B.d.WireFrameFillMode||d==B.d.PointFillMode?j.drawArraysType(d,h.verticesStart,h.verticesCount,this.forcedInstanceCount||m):d==B.d.WireFrameFillMode?j.drawElementsType(d,0,h._linesIndexCount,this.forcedInstanceCount||m):j.drawElementsType(d,h.indexStart,h.indexCount,this.forcedInstanceCount||m),this}registerBeforeRender(h){return this.onBeforeRenderObservable.add(h),this}unregisterBeforeRender(h){return this.onBeforeRenderObservable.removeCallback(h),this}registerAfterRender(h){return this.onAfterRenderObservable.add(h),this}unregisterAfterRender(h){return this.onAfterRenderObservable.removeCallback(h),this}_getInstancesRenderList(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(d)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[h]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[h]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const m=this.ih(),j=m._isInIntermediateRendering(),A=j?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,b=this._instanceDataStorage.batchCache;if(b.mustReturn=!1,b.renderSelf[h]=d||!A&&this.isEnabled()&&this.isVisible,b.visibleInstances[h]=null,this._instanceDataStorage.visibleInstances&&!d){const d=this._instanceDataStorage.visibleInstances,A=m.getRenderId(),w=j?d.intermediateDefaultRenderId:d.defaultRenderId;b.visibleInstances[h]=d[A],!b.visibleInstances[h]&&w&&(b.visibleInstances[h]=d[w])}return b.hardwareInstancedRendering[h]=!d&&this._instanceDataStorage.hardwareInstancedRendering&&null!==b.visibleInstances[h]&&void 0!==b.visibleInstances[h],this._instanceDataStorage.previousBatch=b,b}_updateInstancedBuffers(h,d,m,j,A,b){const w=d.visibleInstances[h._id],a=w?w.length:0,D=this._instanceDataStorage;let M=D.instancesBuffer,q=D.instancesPreviousBuffer,I=0,R=0;const Z=d.renderSelf[h._id],L=!M||m!==D.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!D.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||D.isFrozen&&!L)R=(Z?1:0)+a;else{const d=this.getWorldMatrix();if(Z&&(this._scene.needsPreviousWorldMatrices&&(D.masterMeshPreviousWorldMatrix?(D.masterMeshPreviousWorldMatrix.copyToArray(D.instancesPreviousData,I),D.masterMeshPreviousWorldMatrix.D(d)):(D.masterMeshPreviousWorldMatrix=d.clone(),D.masterMeshPreviousWorldMatrix.copyToArray(D.instancesPreviousData,I))),d.copyToArray(D.instancesData,I),I+=16,R++),w){var B;if(K.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(B=h.Qh())&&void 0!==B&&B.needAlphaBlendingForMesh(h.getRenderingMesh())){const h=this._scene.activeCamera.globalPosition;for(let d=0;d<w.length;d++){const m=w[d];m._distanceToCamera=S.i.Distance(m.getBoundingInfo().boundingSphere.centerWorld,h)}w.sort(((h,d)=>h._distanceToCamera>d._distanceToCamera?-1:h._distanceToCamera<d._distanceToCamera?1:0))}for(let h=0;h<w.length;h++){const d=w[h],m=d.getWorldMatrix();m.copyToArray(D.instancesData,I),this._scene.needsPreviousWorldMatrices&&(d._previousWorldMatrix?(d._previousWorldMatrix.copyToArray(D.instancesPreviousData,I),d._previousWorldMatrix.D(m)):(d._previousWorldMatrix=m.clone(),d._previousWorldMatrix.copyToArray(D.instancesPreviousData,I))),I+=16,R++}}}L?(M&&M.dispose(),q&&q.dispose(),M=new E.c(j,D.instancesData,!0,16,!1,!0),D.instancesBuffer=M,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=M.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=M.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=M.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=M.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(q=new E.c(j,D.instancesPreviousData,!0,16,!1,!0),D.instancesPreviousBuffer=q,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=q.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=q.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=q.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=q.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(M.updateDirectly(D.instancesData,0,R),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||q.updateDirectly(D.instancesPreviousData,0,R)),this._processInstancedBuffers(w,Z),b&&void 0!==A&&(this.ih()._activeIndices.addCount(h.indexCount*R,!1),j._currentDrawContext&&(j._currentDrawContext.useInstancing=!0),this._bind(h,b,A),this._draw(h,A,R)),!this._scene.needsPreviousWorldMatrices||L||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||q.updateDirectly(D.instancesData,0,R)}_renderWithInstances(h,d,m,j,A){const b=m.visibleInstances[h._id],w=b?b.length:0,a=this._instanceDataStorage,D=a.instancesBufferSize,S=16*(w+1)*4;for(;a.instancesBufferSize<S;)a.instancesBufferSize*=2;return a.instancesData&&D==a.instancesBufferSize||(a.instancesData=new Float32Array(a.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!a.instancesPreviousData||D!=a.instancesBufferSize)&&(a.instancesPreviousData=new Float32Array(a.instancesBufferSize/4)),this._updateInstancedBuffers(h,m,D,A,d,j),A.unbindInstanceAttributes(),this}_renderWithThinInstances(h,d,m,j){var A;const b=(null===(A=this._thinInstanceDataStorage)||void 0===A?void 0:A.instancesCount)??0;this.ih()._activeIndices.addCount(h.indexCount*b,!1),j._currentDrawContext&&(j._currentDrawContext.useInstancing=!0),this._bind(h,m,d),this._draw(h,d,b),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,b):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),j.unbindInstanceAttributes()}_processInstancedBuffers(h,d){}_processRendering(h,d,m,j,A,b,w,a){const D=this.ih(),S=D.getEngine();if(j=this._getRenderingFillMode(j),b&&d.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(d,j,m,S),this;if(b)this._renderWithInstances(d,j,A,m,S);else{S._currentDrawContext&&(S._currentDrawContext.useInstancing=!1);let m=0;A.renderSelf[d._id]&&(w&&w(!1,h.getWorldMatrix(),a),m++,this._draw(d,j,this._instanceDataStorage.overridenInstanceCount));const b=A.visibleInstances[d._id];if(b){const h=b.length;m+=h;for(let m=0;m<h;m++){const h=b[m].getWorldMatrix();w&&w(!0,h,a),this._draw(d,j)}}D._activeIndices.addCount(d.indexCount*m,!1)}return this}_rebuild(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(h&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const d in this._userInstancedBuffersStorage.vertexBuffers){const m=this._userInstancedBuffersStorage.vertexBuffers[d];m&&(h&&m.dispose(),this._userInstancedBuffersStorage.vertexBuffers[d]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(h)}_freeze(){if(this.Ab){for(let h=0;h<this.Ab.length;h++)this._getInstancesRenderList(h);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(h,d,m,j){let A=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const b=this._scene.getEngine(),w=b.currentRenderPassId;if(void 0!==h&&(b.currentRenderPassId=h),j)(!A||A&&j.isInFrustum(this._scene._frustumPlanes))&&this.render(j,!!d,m);else for(let a=0;a<this.Ab.length;a++){const h=this.Ab[a];(!A||A&&h.isInFrustum(this._scene._frustumPlanes))&&this.render(h,!!d,m)}return void 0!==h&&(b.currentRenderPassId=w),this}directRender(){if(!this.Ab)return this;for(const h of this.Ab)this.render(h,!1);return this}render(h,d,m){var j,A,b;const w=this.ih();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const a=(null===(j=w.activeCameras)||void 0===j?void 0:j.length)??0;if((a>1&&w.activeCamera===w.activeCameras[0]||a<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const D=this._getInstancesRenderList(h._id,!!m);if(D.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const S=w.getEngine();let M=0,q=null;this.ignoreCameraMaxZ&&w.activeCamera&&!w._isInIntermediateRendering()&&(M=w.activeCamera.maxZ,q=w.activeCamera,w.activeCamera.maxZ=0,w.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const E=h.getRenderingMesh(),I=D.hardwareInstancedRendering[h._id]||E.hasThinInstances||!!this._userInstancedBuffersStorage&&!h.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,R=this._instanceDataStorage,Z=h.Qh();if(!Z)return q&&(q.maxZ=M,w.updateTransformMatrix(!0)),this;if(R.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===Z){if(Z._storeEffectOnSubMeshes&&(null===(A=h._drawWrapper)||void 0===A||!A._wasPreviouslyReady)||!Z._storeEffectOnSubMeshes&&!Z._getDrawWrapper()._wasPreviouslyReady)return q&&(q.maxZ=M,w.updateTransformMatrix(!0)),this}else{if(Z._storeEffectOnSubMeshes){if(!Z.isReadyForSubMesh(this,h,I))return q&&(q.maxZ=M,w.updateTransformMatrix(!0)),this}else if(!Z.isReady(this,I))return q&&(q.maxZ=M,w.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=Z}let L;d&&S.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),L=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?h._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const V=(null===(b=L)||void 0===b?void 0:b.effect)??null;for(const B of w._beforeRenderingMeshStage)B.action(this,h,D,V);if(!L||!V)return q&&(q.maxZ=M,w.updateTransformMatrix(!0)),this;const v=m||this;let C;if(R.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.yd&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)C=R.sideOrientation;else{const h=v._getWorldMatrixDeterminant();C=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),h<0&&(C=C===B.d.ClockWiseSideOrientation?B.d.CounterClockWiseSideOrientation:B.d.ClockWiseSideOrientation),R.sideOrientation=C}const T=this._internalMeshDataInfo._effectiveMaterial._preBind(L,C);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&S.setDepthWrite(!0);const o=this._internalMeshDataInfo._effectiveMaterial,y=o.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),I||this._bind(h,V,y,!1);const i=v.getWorldMatrix();o._storeEffectOnSubMeshes?o.bindForSubMesh(i,this,h):o.bind(i,this),!o.yd&&o.separateCullingPass&&(S.setState(!0,o.zOffset,!1,!T,o.cullBackFaces,o.stencil,o.zOffsetUnits),this._processRendering(this,h,V,y,D,I,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),S.setState(!0,o.zOffset,!1,T,o.cullBackFaces,o.stencil,o.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(h)),this._processRendering(this,h,V,y,D,I,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const B of w._afterRenderingMeshStage)B.action(this,h,D,V);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),q&&(q.maxZ=M,w.updateTransformMatrix(!0)),2!==w.performancePriority||R.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(E.d.MatricesWeightsKind)&&(this.isVerticesDataPresent(E.d.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const h=this.getVerticesData(E.d.MatricesWeightsKind),d=h.length;for(let m=0;m<d;m+=4){const d=h[m]+h[m+1]+h[m+2]+h[m+3];if(0===d)h[m]=1;else{const j=1/d;h[m]*=j,h[m+1]*=j,h[m+2]*=j,h[m+3]*=j}}this.xh(E.d.MatricesWeightsKind,h)}_normalizeSkinWeightsAndExtra(){const h=this.getVerticesData(E.d.MatricesWeightsExtraKind),d=this.getVerticesData(E.d.MatricesWeightsKind),m=d.length;for(let j=0;j<m;j+=4){let m=d[j]+d[j+1]+d[j+2]+d[j+3];if(m+=h[j]+h[j+1]+h[j+2]+h[j+3],0===m)d[j]=1;else{const A=1/m;d[j]*=A,d[j+1]*=A,d[j+2]*=A,d[j+3]*=A,h[j]*=A,h[j+1]*=A,h[j+2]*=A,h[j+3]*=A}}this.xh(E.d.MatricesWeightsKind,d),this.xh(E.d.MatricesWeightsKind,h)}validateSkinning(){const h=this.getVerticesData(E.d.MatricesWeightsExtraKind),d=this.getVerticesData(E.d.MatricesWeightsKind);if(null===d||null==this.skeleton)return{skinned:!1,valid:!0,hZ:"not skinned"};const m=d.length;let j=0,A=0,b=0,w=0;const a=null===h?4:8,D=[];for(let E=0;E<=a;E++)D[E]=0;for(let E=0;E<m;E+=4){let m=d[E],S=m,M=0===S?0:1;for(let A=1;A<a;A++){const b=A<4?d[E+A]:h[E+A-4];b>m&&j++,0!==b&&M++,S+=b,m=b}if(D[M]++,M>b&&(b=M),0===S)A++;else{const m=1/S;let j=0;for(let A=0;A<a;A++)j+=A<4?Math.abs(d[E+A]-d[E+A]*m):Math.abs(h[E+A-4]-h[E+A-4]*m);j>.001&&w++}}const S=this.skeleton.bones.length,M=this.getVerticesData(E.d.MatricesIndicesKind),q=this.getVerticesData(E.d.MatricesIndicesExtraKind);let I=0;for(let E=0;E<m;E+=4)for(let h=0;h<a;h++){const d=h<4?M[E+h]:q[E+h-4];(d>=S||d<0)&&I++}return{skinned:!0,valid:0===A&&0===w&&0===I,hZ:"Number of Weights = "+m/4+"\nMaximum influences = "+b+"\nMissing Weights = "+A+"\nNot Sorted = "+j+"\nNot Normalized = "+w+"\nWeightCounts = ["+D+"]\nNumber of bones = "+S+"\nBad Bone Indices = "+I}}_checkDelayState(){const h=this.ih();return this._geometry?this._geometry.load(h):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(h)),this}_queueLoad(h){h.addPendingData(this);const d=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return A.e.LoadFile(this.delayLoadingFile,(d=>{d instanceof ArrayBuffer?this._delayLoadingFunction(d,this):this._delayLoadingFunction(JSON.parse(d),this);for(const h of this.instances)h.refreshBoundingInfo(),h._syncSubMeshes();this.delayLoadState=1,h.removePendingData(this)}),(()=>{}),h.offlineProvider,d),this}isInFrustum(h){return 2!==this.delayLoadState&&(!!super.isInFrustum(h)&&(this._checkDelayState(),!0))}setMaterialById(h){const d=this.ih().materials;let m;for(m=d.length-1;m>-1;m--)if(d[m].id===h)return this.material=d[m],this;const j=this.ih().multiMaterials;for(m=j.length-1;m>-1;m--)if(j[m].id===h)return this.material=j[m],this;return this}getAnimatables(){const h=[];return this.material&&h.push(this.material),this.skeleton&&h.push(this.skeleton),h}bakeTransformIntoVertices(h){if(!this.isVerticesDataPresent(E.d.PositionKind))return this;const d=this.Ab.splice(0);this._resetPointsArrayCache();let m=this.getVerticesData(E.d.PositionKind);const j=S.i.Zero();let A;for(A=0;A<m.length;A+=3)S.i.TransformCoordinatesFromFloatsToRef(m[A],m[A+1],m[A+2],h,j).toArray(m,A);if(this.xh(E.d.PositionKind,m,this.getVertexBuffer(E.d.PositionKind).isUpdatable()),this.isVerticesDataPresent(E.d.NormalKind)){for(m=this.getVerticesData(E.d.NormalKind),A=0;A<m.length;A+=3)S.i.TransformNormalFromFloatsToRef(m[A],m[A+1],m[A+2],h,j).normalize().toArray(m,A);this.xh(E.d.NormalKind,m,this.getVertexBuffer(E.d.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(E.d.TangentKind)){for(m=this.getVerticesData(E.d.TangentKind),A=0;A<m.length;A+=4)S.i.TransformNormalFromFloatsToRef(m[A],m[A+1],m[A+2],h,j).normalize().toArray(m,A);this.xh(E.d.TangentKind,m,this.getVertexBuffer(E.d.TangentKind).isUpdatable())}return h.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.Ab=d,this}bakeCurrentTransformIntoVertices(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.Zd(!0)),this.resetLocalMatrix(h),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(d&&void 0===d._addToSceneRootNodes){const m=d;return l.source=this,l.doNotCloneChildren=m.doNotCloneChildren,l.clonePhysicsImpostor=m.clonePhysicsImpostor,l.cloneThinInstances=m.cloneThinInstances,new K(h,this.ih(),l)}return new K(h,this.ih(),d,this,m,j)}dispose(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const m=this._internalMeshDataInfo;if(m._onBeforeDrawObservable&&m._onBeforeDrawObservable.clear(),m._onBeforeBindObservable&&m._onBeforeBindObservable.clear(),m._onBeforeRenderObservable&&m._onBeforeRenderObservable.clear(),m._onAfterRenderObservable&&m._onAfterRenderObservable.clear(),m._onBetweenPassObservable&&m._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(m.meshMap)for(const h in m.meshMap){const d=m.meshMap[h];d&&(d._internalMeshDataInfo._source=null,m.meshMap[h]=void 0)}m._source&&m._source._internalMeshDataInfo.meshMap&&(m._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const h=this.ih().meshes;for(const d of h){const h=d;h._internalMeshDataInfo&&h._internalMeshDataInfo._source&&h._internalMeshDataInfo._source===this&&(h._internalMeshDataInfo._source=null)}}m._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(h,d)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(h,d,m,j,b,w){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7?arguments[7]:void 0;const S=this.ih();return A.e.LoadImage(h,(h=>{const A=h.width,D=h.height,S=this.getEngine().createCanvas(A,D).getContext("2d");S.drawImage(h,0,0);const M=S.getImageData(0,0,A,D).data;this.applyDisplacementMapFromBuffer(M,A,D,d,m,b,w,a),j&&j(this)}),D||(()=>{}),S.offlineProvider),this}applyDisplacementMapFromBuffer(h,d,m,j,A,b,w){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(E.d.PositionKind)||!this.isVerticesDataPresent(E.d.NormalKind)||!this.isVerticesDataPresent(E.d.UVKind))return T.c.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const D=this.getVerticesData(E.d.PositionKind,!0,!0),M=this.getVerticesData(E.d.NormalKind),q=this.getVerticesData(E.d.UVKind);let R=S.i.Zero();const Z=S.i.Zero(),L=S.h.Zero();b=b||S.h.Zero(),w=w||new S.h(1,1);for(let E=0;E<D.length;E+=3){S.i.FromArrayToRef(D,E,R),S.i.FromArrayToRef(M,E,Z),S.h.FromArrayToRef(q,E/3*2,L);const a=4*((Math.abs(L.x*w.x+b.x%1)*(d-1)%d|0)+(Math.abs(L.y*w.y+b.y%1)*(m-1)%m|0)*d),I=.3*(h[a]/255)+.59*(h[a+1]/255)+.11*(h[a+2]/255);Z.normalize(),Z.scaleInPlace(j+(A-j)*I),R=R.add(Z),R.toArray(D,E)}return I.c.ComputeNormals(D,this.Vd(),M),a?(this.xh(E.d.PositionKind,D),this.xh(E.d.NormalKind,M),this.xh(E.d.UVKind,q)):(this.updateVerticesData(E.d.PositionKind,D),this.updateVerticesData(E.d.NormalKind,M)),this}_getFlattenedNormals(h,d){const m=new Float32Array(3*h.length);let j=0;const A=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let b=0;b<h.length;b+=3){const w=S.i.Ud(d,3*h[b]),a=S.i.Ud(d,3*h[b+1]),D=S.i.Ud(d,3*h[b+2]),M=w.fm(a),q=D.fm(a),E=S.i.Normalize(S.i.Cross(M,q));A&&E.scaleInPlace(-1);for(let h=0;h<3;h++)m[j++]=E.x,m[j++]=E.y,m[j++]=E.z}return m}_convertToUnIndexedMesh(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=this.getVerticesDataKinds().filter((h=>{var d;return!(null!==(d=this.getVertexBuffer(h))&&void 0!==d&&d.getIsInstanced())})),m=this.Vd(),j={},A=(h,d)=>{const j=new Float32Array(m.length*d);let A=0;for(let b=0;b<m.length;b++)for(let w=0;w<d;w++)j[A++]=h[m[b]*d+w];return j},b=this.getBoundingInfo(),w=this.Ld?this.Ab.slice(0):[];for(const a of d)j[a]=this.getVerticesData(a);for(const a of d){const d=this.getVertexBuffer(a),b=d.getSize();if(h&&a===E.d.NormalKind){const h=this._getFlattenedNormals(m,j[E.d.PositionKind]);this.xh(E.d.NormalKind,h,d.isUpdatable(),b)}else this.xh(a,A(j[a],b),d.isUpdatable(),b)}if(this.morphTargetManager){for(let d=0;d<this.morphTargetManager.numTargets;d++){const j=this.morphTargetManager.getTarget(d),b=j.getPositions();j.setPositions(A(b,3));const w=j.getNormals();w&&j.setNormals(h?this._getFlattenedNormals(m,b):A(w,3));const a=j.getTangents();a&&j.setTangents(A(a,3));const D=j.getUVs();D&&j.setUVs(A(D,2));const S=j.getColors();S&&j.setColors(A(S,4))}this.morphTargetManager.synchronize()}for(let a=0;a<m.length;a++)m[a]=a;this.setIndices(m),this._unIndexed=!0,this.releaseSubMeshes();for(const a of w){const h=a.getBoundingInfo();L.b.AddToMesh(a.materialIndex,a.indexStart,a.indexCount,a.indexStart,a.indexCount,this).setBoundingInfo(h)}return this.setBoundingInfo(b),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=I.c.ExtractFromMesh(this);let m;if(h&&this.isVerticesDataPresent(E.d.NormalKind)&&d.fh){for(m=0;m<d.fh.length;m++)d.fh[m]*=-1;this.xh(E.d.NormalKind,d.fh,this.isVertexBufferUpdatable(E.d.NormalKind))}if(d.indices){let h;for(m=0;m<d.indices.length;m+=3)h=d.indices[m+1],d.indices[m+1]=d.indices[m+2],d.indices[m+2]=h;this.setIndices(d.indices,null,this.isVertexBufferUpdatable(E.d.PositionKind),!0)}return this}increaseVertices(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const d=I.c.ExtractFromMesh(this),m=d.indices&&!Array.isArray(d.indices)&&Array.from?Array.from(d.indices):d.indices,j=d.Fh&&!Array.isArray(d.Fh)&&Array.from?Array.from(d.Fh):d.Fh,A=d.kh&&!Array.isArray(d.kh)&&Array.from?Array.from(d.kh):d.kh,b=d.fh&&!Array.isArray(d.fh)&&Array.from?Array.from(d.fh):d.fh;if(m&&j){d.indices=m,d.Fh=j,A&&(d.kh=A),b&&(d.fh=b);const w=h+1,a=[];for(let h=0;h<w+1;h++)a[h]=[];let D,M;const q=new S.i(0,0,0),I=new S.i(0,0,0),R=new S.h(0,0),Z=[],L=[],B=[];let V,v,C,T=j.length;A&&(v=A.length),b&&(C=b.length);for(let h=0;h<m.length;h+=3){L[0]=m[h],L[1]=m[h+1],L[2]=m[h+2];for(let h=0;h<3;h++)if(D=L[h],M=L[(h+1)%3],void 0===B[D]&&void 0===B[M]?(B[D]=[],B[M]=[]):(void 0===B[D]&&(B[D]=[]),void 0===B[M]&&(B[M]=[])),void 0===B[D][M]&&void 0===B[M][D]){B[D][M]=[],q.x=(j[3*M]-j[3*D])/w,q.y=(j[3*M+1]-j[3*D+1])/w,q.z=(j[3*M+2]-j[3*D+2])/w,b&&(I.x=(b[3*M]-b[3*D])/w,I.y=(b[3*M+1]-b[3*D+1])/w,I.z=(b[3*M+2]-b[3*D+2])/w),A&&(R.x=(A[2*M]-A[2*D])/w,R.y=(A[2*M+1]-A[2*D+1])/w),B[D][M].push(D);for(let h=1;h<w;h++)B[D][M].push(j.length/3),j[T++]=j[3*D]+h*q.x,j[T++]=j[3*D+1]+h*q.y,j[T++]=j[3*D+2]+h*q.z,b&&(b[C++]=b[3*D]+h*I.x,b[C++]=b[3*D+1]+h*I.y,b[C++]=b[3*D+2]+h*I.z),A&&(A[v++]=A[2*D]+h*R.x,A[v++]=A[2*D+1]+h*R.y);B[D][M].push(M),B[M][D]=[],V=B[D][M].length;for(let h=0;h<V;h++)B[M][D][h]=B[D][M][V-1-h]}a[0][0]=m[h],a[1][0]=B[m[h]][m[h+1]][1],a[1][1]=B[m[h]][m[h+2]][1];for(let d=2;d<w;d++){a[d][0]=B[m[h]][m[h+1]][d],a[d][d]=B[m[h]][m[h+2]][d],q.x=(j[3*a[d][d]]-j[3*a[d][0]])/d,q.y=(j[3*a[d][d]+1]-j[3*a[d][0]+1])/d,q.z=(j[3*a[d][d]+2]-j[3*a[d][0]+2])/d,b&&(I.x=(b[3*a[d][d]]-b[3*a[d][0]])/d,I.y=(b[3*a[d][d]+1]-b[3*a[d][0]+1])/d,I.z=(b[3*a[d][d]+2]-b[3*a[d][0]+2])/d),A&&(R.x=(A[2*a[d][d]]-A[2*a[d][0]])/d,R.y=(A[2*a[d][d]+1]-A[2*a[d][0]+1])/d);for(let h=1;h<d;h++)a[d][h]=j.length/3,j[T++]=j[3*a[d][0]]+h*q.x,j[T++]=j[3*a[d][0]+1]+h*q.y,j[T++]=j[3*a[d][0]+2]+h*q.z,b&&(b[C++]=b[3*a[d][0]]+h*I.x,b[C++]=b[3*a[d][0]+1]+h*I.y,b[C++]=b[3*a[d][0]+2]+h*I.z),A&&(A[v++]=A[2*a[d][0]]+h*R.x,A[v++]=A[2*a[d][0]+1]+h*R.y)}a[w]=B[m[h+1]][m[h+2]],Z.push(a[0][0],a[1][0],a[1][1]);for(let h=1;h<w;h++){let d;for(d=0;d<h;d++)Z.push(a[h][d],a[h+1][d],a[h+1][d+1]),Z.push(a[h][d],a[h+1][d+1],a[h][d+1]);Z.push(a[h][d],a[h+1][d],a[h+1][d+1])}}d.indices=Z,d.Nh(this,this.isVertexBufferUpdatable(E.d.PositionKind))}else T.c.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const h=I.c.ExtractFromMesh(this),d=h.kh,m=h.indices,j=h.Fh,A=h.Hh,b=h.matricesIndices,w=h.matricesWeights,a=h.matricesIndicesExtra,D=h.matricesWeightsExtra;if(void 0===m||void 0===j||null===m||null===j)T.c.Warn("VertexData contains empty entries");else{const S=[],M=[],q=[],R=[],Z=[],L=[],B=[],V=[];let v=[],C=0;const T={};let o,y;for(let h=0;h<m.length;h+=3){y=[m[h],m[h+1],m[h+2]],v=[];for(let h=0;h<3;h++){v[h]="";for(let d=0;d<3;d++)Math.abs(j[3*y[h]+d])<1e-8&&(j[3*y[h]+d]=0),v[h]+=j[3*y[h]+d]+"|"}if(v[0]!=v[1]&&v[0]!=v[2]&&v[1]!=v[2])for(let h=0;h<3;h++){if(o=T[v[h]],void 0===o){T[v[h]]=C,o=C++;for(let d=0;d<3;d++)S.push(j[3*y[h]+d]);if(null!==A&&void 0!==A)for(let d=0;d<4;d++)R.push(A[4*y[h]+d]);if(null!==d&&void 0!==d)for(let m=0;m<2;m++)q.push(d[2*y[h]+m]);if(null!==b&&void 0!==b)for(let d=0;d<4;d++)Z.push(b[4*y[h]+d]);if(null!==w&&void 0!==w)for(let d=0;d<4;d++)L.push(w[4*y[h]+d]);if(null!==a&&void 0!==a)for(let d=0;d<4;d++)B.push(a[4*y[h]+d]);if(null!==D&&void 0!==D)for(let d=0;d<4;d++)V.push(D[4*y[h]+d])}M.push(o)}}const i=[];I.c.ComputeNormals(S,M,i),h.Fh=S,h.indices=M,h.fh=i,null!==d&&void 0!==d&&(h.kh=q),null!==A&&void 0!==A&&(h.Hh=R),null!==b&&void 0!==b&&(h.matricesIndices=Z),null!==w&&void 0!==w&&(h.matricesWeights=L),null!==a&&void 0!==a&&(h.matricesIndicesExtra=B),null!==w&&void 0!==w&&(h.matricesWeightsExtra=V),h.Nh(this,this.isVertexBufferUpdatable(E.d.PositionKind))}}static _instancedMeshFactory(h,d){throw(0,y.b)("InstancedMesh")}static _PhysicsImpostorParser(h,d,m){throw(0,y.b)("PhysicsImpostor")}createInstance(h){const d=K._instancedMeshFactory(h,this);return d.parent=this.parent,d}synchronizeInstances(){for(let h=0;h<this.instances.length;h++){this.instances[h]._syncSubMeshes()}return this}optimizeIndices(h){const d=this.Vd(),m=this.getVerticesData(E.d.PositionKind);if(!m||!d)return this;const j=[];for(let A=0;A<m.length;A+=3)j.push(S.i.Ud(m,A));const b=[];return A.d.SyncAsyncForLoop(j.length,40,(h=>{const d=j.length-1-h,m=j[d];for(let A=0;A<d;++A){const h=j[A];if(m.equals(h)){b[d]=A;break}}}),(()=>{for(let h=0;h<d.length;++h)d[h]=b[d[h]]||d[h];const m=this.Ab.slice(0);this.setIndices(d),this.Ab=m,h&&h(this)})),this}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h.name=this.name,h.id=this.id,h.uniqueId=this.uniqueId,h.type=this.getClassName(),w.e&&w.e.HasTags(this)&&(h.tags=w.e.GetTags(this)),h.position=this.position.fd(),this.rotationQuaternion?h.rotationQuaternion=this.rotationQuaternion.fd():this.rotation&&(h.rotation=this.rotation.fd()),h.td=this.td.fd(),this._postMultiplyPivotMatrix?h.pivotMatrix=this.getPivotMatrix().fd():h.localMatrix=this.getPivotMatrix().fd(),h.isEnabled=this.isEnabled(!1),h.isVisible=this.isVisible,h.infiniteDistance=this.infiniteDistance,h.pickable=this.GD,h.receiveShadows=this.receiveShadows,h.billboardMode=this.billboardMode,h.visibility=this.visibility,h.Ga=this.Ga,h.checkCollisions=this.checkCollisions,h.ellipsoid=this.ellipsoid.fd(),h.ellipsoidOffset=this.ellipsoidOffset.fd(),h.Wh=this.Wh,h.isBlocker=this.isBlocker,h.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(h),h.isUnIndexed=this.isUnIndexed;const d=this._geometry;if(d&&this.Ab){h.geometryUniqueId=d.uniqueId,h.geometryId=d.id,h.Ab=[];for(let d=0;d<this.Ab.length;d++){const m=this.Ab[d];h.Ab.push({materialIndex:m.materialIndex,verticesStart:m.verticesStart,verticesCount:m.verticesCount,indexStart:m.indexStart,indexCount:m.indexCount})}}if(this.material?this.material.doNotSerialize||(h.materialUniqueId=this.material.uniqueId,h.materialId=this.material.id):(this.material=null,h.materialUniqueId=this._scene.defaultMaterial.uniqueId,h.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(h.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(h.skeletonId=this.skeleton.id,h.numBoneInfluencers=this.numBoneInfluencers),this.ih()._getComponent(i.b.NAME_PHYSICSENGINE)){const d=this.getPhysicsImpostor();d&&(h.physicsMass=d.getParam("FA"),h.physicsFriction=d.getParam("friction"),h.physicsRestitution=d.getParam("FA"),h.physicsImpostor=d.type)}this.metadata&&(h.metadata=this.metadata),h.instances=[];for(let m=0;m<this.instances.length;m++){const d=this.instances[m];if(d.doNotSerialize)continue;const j={name:d.name,id:d.id,isEnabled:d.isEnabled(!1),isVisible:d.isVisible,GD:d.GD,checkCollisions:d.checkCollisions,position:d.position.fd(),td:d.td.fd()};if(d.parent&&d.parent._serializeAsParent(j),d.rotationQuaternion?j.rotationQuaternion=d.rotationQuaternion.fd():d.rotation&&(j.rotation=d.rotation.fd()),this.ih()._getComponent(i.b.NAME_PHYSICSENGINE)){const h=d.getPhysicsImpostor();h&&(j.physicsMass=h.getParam("FA"),j.physicsFriction=h.getParam("friction"),j.physicsRestitution=h.getParam("FA"),j.physicsImpostor=h.type)}d.metadata&&(j.metadata=d.metadata),d.actionManager&&(j.actions=d.actionManager.serialize(d.name)),h.instances.push(j),C.d.AppendSerializedAnimations(d,j),j.ranges=d.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(h.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const d={data:{},sizes:{},strides:{}};for(const h in this._userThinInstanceBuffersStorage.data)d.data[h]=Array.from(this._userThinInstanceBuffersStorage.data[h]),d.sizes[h]=this._userThinInstanceBuffersStorage.sizes[h],d.strides[h]=this._userThinInstanceBuffersStorage.strides[h];h.thinInstances.userThinInstance=d}return C.d.AppendSerializedAnimations(this,h),h.ranges=this.serializeAnimationRanges(),h.layerMask=this.layerMask,h.alphaIndex=this.alphaIndex,h.hasVertexAlpha=this.hasVertexAlpha,h.overlayAlpha=this.overlayAlpha,h.overlayColor=this.overlayColor.fd(),h.renderOverlay=this.renderOverlay,h.applyFog=this.applyFog,this.actionManager&&(h.actions=this.actionManager.serialize(this.name)),h}_syncGeometryWithMorphTargetManager(){if(!this.Ld)return;this._markSubMeshesAsAttributesDirty();const h=this._internalAbstractMeshDataInfo._morphTargetManager;if(h&&h.vertexCount){if(h.vertexCount!==this.getTotalVertices())return T.c.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(h.isUsingTextureForTargets)return;for(let d=0;d<h.numInfluencers;d++){const m=h.getActiveTarget(d),j=m.getPositions();if(!j)return void T.c.Error("Invalid morph target. Target must have positions.");this.Ld.xh(E.d.PositionKind+d,j,!1,3);const A=m.getNormals();A&&this.Ld.xh(E.d.NormalKind+d,A,!1,3);const b=m.getTangents();b&&this.Ld.xh(E.d.TangentKind+d,b,!1,3);const w=m.getUVs();w&&this.Ld.xh(E.d.UVKind+"_"+d,w,!1,2);const a=m.getUV2s();a&&this.Ld.xh(E.d.UV2Kind+"_"+d,a,!1,2);const D=m.getColors();D&&this.Ld.xh(E.d.ColorKind+d,D,!1,4)}}else{let h=0;for(;this.Ld.isVerticesDataPresent(E.d.PositionKind+h);)this.Ld.removeVerticesData(E.d.PositionKind+h),this.Ld.isVerticesDataPresent(E.d.NormalKind+h)&&this.Ld.removeVerticesData(E.d.NormalKind+h),this.Ld.isVerticesDataPresent(E.d.TangentKind+h)&&this.Ld.removeVerticesData(E.d.TangentKind+h),this.Ld.isVerticesDataPresent(E.d.UVKind+h)&&this.Ld.removeVerticesData(E.d.UVKind+"_"+h),this.Ld.isVerticesDataPresent(E.d.UV2Kind+h)&&this.Ld.removeVerticesData(E.d.UV2Kind+"_"+h),this.Ld.isVerticesDataPresent(E.d.ColorKind+h)&&this.Ld.removeVerticesData(E.d.ColorKind+h),h++}}static Parse(h,d,m){let j;if(j=h.type&&"LinesMesh"===h.type?K._LinesMeshParser(h,d):h.type&&"GroundMesh"===h.type?K._GroundMeshParser(h,d):h.type&&"GoldbergMesh"===h.type?K._GoldbergMeshParser(h,d):h.type&&"GreasedLineMesh"===h.type?K._GreasedLineMeshParser(h,d):h.type&&"TrailMesh"===h.type?K._TrailMeshParser(h,d):new K(h.name,d),j.id=h.id,j._waitingParsedUniqueId=h.uniqueId,w.e&&w.e.AddTagsTo(j,h.tags),j.position=S.i.Ud(h.position),void 0!==h.metadata&&(j.metadata=h.metadata),h.rotationQuaternion?j.rotationQuaternion=S.c.Ud(h.rotationQuaternion):h.rotation&&(j.rotation=S.i.Ud(h.rotation)),j.td=S.i.Ud(h.td),h.localMatrix?j.setPreTransformMatrix(S.b.Ud(h.localMatrix)):h.pivotMatrix&&j.setPivotMatrix(S.b.Ud(h.pivotMatrix)),j.jD(h.isEnabled),j.isVisible=h.isVisible,j.infiniteDistance=h.infiniteDistance,j.Ga=!!h.Ga,j.showBoundingBox=h.showBoundingBox,j.showSubMeshesBoundingBox=h.showSubMeshesBoundingBox,void 0!==h.applyFog&&(j.applyFog=h.applyFog),void 0!==h.pickable&&(j.GD=h.pickable),void 0!==h.alphaIndex&&(j.alphaIndex=h.alphaIndex),j.receiveShadows=h.receiveShadows,void 0!==h.billboardMode&&(j.billboardMode=h.billboardMode),void 0!==h.visibility&&(j.visibility=h.visibility),j.checkCollisions=h.checkCollisions,j.Wh=!!h.Wh,h.ellipsoid&&(j.ellipsoid=S.i.Ud(h.ellipsoid)),h.ellipsoidOffset&&(j.ellipsoidOffset=S.i.Ud(h.ellipsoidOffset)),null!=h.overrideMaterialSideOrientation&&(j.sideOrientation=h.overrideMaterialSideOrientation),void 0!==h.sideOrientation&&(j.sideOrientation=h.sideOrientation),void 0!==h.isBlocker&&(j.isBlocker=h.isBlocker),j._shouldGenerateFlatShading=h.useFlatShading,h.Xb&&(j._waitingData.Xb=h.Xb),void 0!==h.parentId&&(j._waitingParentId=h.parentId),void 0!==h.parentInstanceIndex&&(j._waitingParentInstanceIndex=h.parentInstanceIndex),void 0!==h.actions&&(j._waitingData.actions=h.actions),void 0!==h.overlayAlpha&&(j.overlayAlpha=h.overlayAlpha),void 0!==h.overlayColor&&(j.overlayColor=M.d.Ud(h.overlayColor)),void 0!==h.renderOverlay&&(j.renderOverlay=h.renderOverlay),j.isUnIndexed=!!h.isUnIndexed,j.hasVertexAlpha=h.hasVertexAlpha,h.delayLoadingFile?(j.delayLoadState=4,j.delayLoadingFile=m+h.delayLoadingFile,j.buildBoundingInfo(S.i.Ud(h.boundingBoxMinimum),S.i.Ud(h.boundingBoxMaximum)),h._binaryInfo&&(j._binaryInfo=h._binaryInfo),j._delayInfo=[],h.hasUVs&&j._delayInfo.push(E.d.UVKind),h.hasUVs2&&j._delayInfo.push(E.d.UV2Kind),h.hasUVs3&&j._delayInfo.push(E.d.UV3Kind),h.hasUVs4&&j._delayInfo.push(E.d.UV4Kind),h.hasUVs5&&j._delayInfo.push(E.d.UV5Kind),h.hasUVs6&&j._delayInfo.push(E.d.UV6Kind),h.hasColors&&j._delayInfo.push(E.d.ColorKind),h.hasMatricesIndices&&j._delayInfo.push(E.d.MatricesIndicesKind),h.hasMatricesWeights&&j._delayInfo.push(E.d.MatricesWeightsKind),j._delayLoadingFunction=R.b._ImportGeometry,v.c.ForceFullSceneLoadingForIncremental&&j._checkDelayState()):R.b._ImportGeometry(h,j),h.materialUniqueId?j._waitingMaterialId=h.materialUniqueId:h.materialId&&(j._waitingMaterialId=h.materialId),h.morphTargetManagerId>-1&&(j._waitingMorphTargetManagerId=h.morphTargetManagerId),void 0!==h.skeletonId&&null!==h.skeletonId&&(j.skeleton=d.getLastSkeletonById(h.skeletonId),h.numBoneInfluencers&&(j.numBoneInfluencers=h.numBoneInfluencers)),h.animations){for(let d=0;d<h.animations.length;d++){const m=h.animations[d],A=(0,o.e)("BABYLON.Animation");A&&j.animations.push(A.Parse(m))}q.b.ParseAnimationRanges(j,h,d)}if(h.autoAnimate&&d.beginAnimation(j,h.autoAnimateFrom,h.autoAnimateTo,h.autoAnimateLoop,h.autoAnimateSpeed||1),h.layerMask&&!isNaN(h.layerMask)?j.layerMask=Math.abs(parseInt(h.layerMask)):j.layerMask=268435455,h.physicsImpostor&&(j.physicsImpostor=K._PhysicsImpostorParser(d,j,h)),h.lodMeshIds&&(j._waitingData.lods={ids:h.lodMeshIds,distances:h.lodDistances?h.lodDistances:null,coverages:h.lodCoverages?h.lodCoverages:null}),h.instances)for(let A=0;A<h.instances.length;A++){const m=h.instances[A],b=j.createInstance(m.name);if(m.id&&(b.id=m.id),w.e&&(m.tags?w.e.AddTagsTo(b,m.tags):w.e.AddTagsTo(b,h.tags)),b.position=S.i.Ud(m.position),void 0!==m.metadata&&(b.metadata=m.metadata),void 0!==m.parentId&&(b._waitingParentId=m.parentId),void 0!==m.parentInstanceIndex&&(b._waitingParentInstanceIndex=m.parentInstanceIndex),void 0!==m.isEnabled&&null!==m.isEnabled&&b.jD(m.isEnabled),void 0!==m.isVisible&&null!==m.isVisible&&(b.isVisible=m.isVisible),void 0!==m.GD&&null!==m.GD&&(b.GD=m.GD),m.rotationQuaternion?b.rotationQuaternion=S.c.Ud(m.rotationQuaternion):m.rotation&&(b.rotation=S.i.Ud(m.rotation)),b.td=S.i.Ud(m.td),void 0!=m.checkCollisions&&null!=m.checkCollisions&&(b.checkCollisions=m.checkCollisions),void 0!=m.pickable&&null!=m.pickable&&(b.GD=m.pickable),void 0!=m.showBoundingBox&&null!=m.showBoundingBox&&(b.showBoundingBox=m.showBoundingBox),void 0!=m.showSubMeshesBoundingBox&&null!=m.showSubMeshesBoundingBox&&(b.showSubMeshesBoundingBox=m.showSubMeshesBoundingBox),void 0!=m.alphaIndex&&null!=m.showSubMeshesBoundingBox&&(b.alphaIndex=m.alphaIndex),m.physicsImpostor&&(b.physicsImpostor=K._PhysicsImpostorParser(d,b,m)),void 0!==m.actions&&(b._waitingData.actions=m.actions),m.animations){for(let h=0;h<m.animations.length;h++){const d=m.animations[h],j=(0,o.e)("BABYLON.Animation");j&&b.animations.push(j.Parse(d))}q.b.ParseAnimationRanges(b,m,d),m.autoAnimate&&d.beginAnimation(b,m.autoAnimateFrom,m.autoAnimateTo,m.autoAnimateLoop,m.autoAnimateSpeed||1)}}if(h.thinInstances){const d=h.thinInstances;if(j.thinInstanceEnablePicking=!!d.enablePicking,d.matrixData?(j.iq("matrix",new Float32Array(d.matrixData),16,!1),j._thinInstanceDataStorage.matrixBufferSize=d.matrixBufferSize,j._thinInstanceDataStorage.instancesCount=d.instancesCount):j._thinInstanceDataStorage.matrixBufferSize=d.matrixBufferSize,h.thinInstances.userThinInstance){const d=h.thinInstances.userThinInstance;for(const h in d.data)j.iq(h,new Float32Array(d.data[h]),d.strides[h],!1),j._userThinInstanceBuffersStorage.sizes[h]=d.sizes[h]}}return j}setPositionsForCPUSkinning(){const h=this._internalMeshDataInfo;if(!h._sourcePositions){const d=this.getVerticesData(E.d.PositionKind);if(!d)return h._sourcePositions;h._sourcePositions=new Float32Array(d),this.isVertexBufferUpdatable(E.d.PositionKind)||this.xh(E.d.PositionKind,d,!0)}return h._sourcePositions}setNormalsForCPUSkinning(){const h=this._internalMeshDataInfo;if(!h._sourceNormals){const d=this.getVerticesData(E.d.NormalKind);if(!d)return h._sourceNormals;h._sourceNormals=new Float32Array(d),this.isVertexBufferUpdatable(E.d.NormalKind)||this.xh(E.d.NormalKind,d,!0)}return h._sourceNormals}applySkeleton(h){if(!this.Ld)return this;if(this.Ld._softwareSkinningFrameId==this.ih().getFrameId())return this;if(this.Ld._softwareSkinningFrameId=this.ih().getFrameId(),!this.isVerticesDataPresent(E.d.PositionKind))return this;if(!this.isVerticesDataPresent(E.d.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(E.d.MatricesWeightsKind))return this;const d=this.isVerticesDataPresent(E.d.NormalKind),m=this._internalMeshDataInfo;if(!m._sourcePositions){const h=this.Ab.slice();this.setPositionsForCPUSkinning(),this.Ab=h}d&&!m._sourceNormals&&this.setNormalsForCPUSkinning();let j=this.getVerticesData(E.d.PositionKind);if(!j)return this;j instanceof Float32Array||(j=new Float32Array(j));let A=this.getVerticesData(E.d.NormalKind);if(d){if(!A)return this;A instanceof Float32Array||(A=new Float32Array(A))}const b=this.getVerticesData(E.d.MatricesIndicesKind),w=this.getVerticesData(E.d.MatricesWeightsKind);if(!w||!b)return this;const a=this.numBoneInfluencers>4,D=a?this.getVerticesData(E.d.MatricesIndicesExtraKind):null,M=a?this.getVerticesData(E.d.MatricesWeightsExtraKind):null,q=h.getTransformMatrices(this),I=S.i.Zero(),R=new S.b,Z=new S.b;let L,B=0;for(let E=0;E<j.length;E+=3,B+=4){let h;for(L=0;L<4;L++)h=w[B+L],h>0&&(S.b.FromFloat32ArrayToRefScaled(q,Math.floor(16*b[B+L]),h,Z),R.addToSelf(Z));if(a)for(L=0;L<4;L++)h=M[B+L],h>0&&(S.b.FromFloat32ArrayToRefScaled(q,Math.floor(16*D[B+L]),h,Z),R.addToSelf(Z));S.i.TransformCoordinatesFromFloatsToRef(m._sourcePositions[E],m._sourcePositions[E+1],m._sourcePositions[E+2],R,I),I.toArray(j,E),d&&(S.i.TransformNormalFromFloatsToRef(m._sourceNormals[E],m._sourceNormals[E+1],m._sourceNormals[E+2],R,I),I.toArray(A,E)),R.reset()}return this.updateVerticesData(E.d.PositionKind,j),d&&this.updateVerticesData(E.d.NormalKind,A),this}static MinMax(h){let d=null,m=null;for(const j of h){const h=j.getBoundingInfo().boundingBox;d&&m?(d.minimizeInPlace(h.minimumWorld),m.maximizeInPlace(h.maximumWorld)):(d=h.minimumWorld,m=h.maximumWorld)}return d&&m?{min:d,max:m}:{min:S.i.Zero(),max:S.i.Zero()}}static Center(h){const d=h instanceof Array?K.MinMax(h):h;return S.i.Center(d.min,d.max)}static MergeMeshes(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=arguments.length>2?arguments[2]:void 0,j=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0;return(0,a.l)(K._MergeMeshesCoroutine(h,d,m,j,A,b,!1))}static async MergeMeshesAsync(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=arguments.length>2?arguments[2]:void 0,j=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0;return await(0,a.h)(K._MergeMeshesCoroutine(h,d,m,j,A,b,!0),(0,a.e)())}static*_MergeMeshesCoroutine(h){let d,m=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=arguments.length>2?arguments[2]:void 0,A=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0,w=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;if(0===(h=h.filter(Boolean)).length)return null;if(!j){let m=0;for(d=0;d<h.length;d++)if(m+=h[d].getTotalVertices(),m>=65536)return T.c.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}w&&(b=!1);const D=new Array,S=new Array,M=new Array,q=h[0].sideOrientation;for(d=0;d<h.length;d++){const m=h[d];if(m.isAnInstance)return T.c.Warn("Cannot merge instance meshes."),null;if(q!==m.sideOrientation)return T.c.Warn("Cannot merge meshes with different sideOrientation values."),null;if(b&&M.push(m.getTotalIndices()),w)if(m.material){const h=m.material;if(h instanceof V.e){for(let d=0;d<h.bb.length;d++)D.indexOf(h.bb[d])<0&&D.push(h.bb[d]);for(let d=0;d<m.Ab.length;d++)S.push(D.indexOf(h.bb[m.Ab[d].materialIndex])),M.push(m.Ab[d].indexCount)}else{D.indexOf(h)<0&&D.push(h);for(let d=0;d<m.Ab.length;d++)S.push(D.indexOf(h)),M.push(m.Ab[d].indexCount)}}else for(let h=0;h<m.Ab.length;h++)S.push(0),M.push(m.Ab[h].indexCount)}const E=h[0],R=h=>{const d=h.Zd(!0);return{vertexData:I.c.ExtractFromMesh(h,!1,!1),transform:d}},{vertexData:Z,transform:B}=R(E);a&&(yield);const v=new Array(h.length-1);for(let I=1;I<h.length;I++)v[I-1]=R(h[I]),a&&(yield);const C=Z._mergeCoroutine(B,v,j,a,!m);let o=C.next();for(;!o.done;)a&&(yield),o=C.next();const y=o.value;A||(A=new K(E.name+"_merged",E.ih()));const i=y._applyToCoroutine(A,void 0,a);let g=i.next();for(;!g.done;)a&&(yield),g=i.next();if(A.checkCollisions=E.checkCollisions,A.sideOrientation=E.sideOrientation,m)for(d=0;d<h.length;d++)h[d].dispose();if(b||w){A.releaseSubMeshes(),d=0;let h=0;for(;d<M.length;)L.b.CreateFromIndices(0,h,M[d],A,void 0,!1),h+=M[d],d++;for(const d of A.Ab)d.refreshBoundingInfo();A.Zd(!0)}if(w){const h=new V.e(E.name+"_merged",E.ih());h.bb=D;for(let d=0;d<A.Ab.length;d++)A.Ab[d].materialIndex=S[d];A.material=h}else A.material=E.material;return A}oE(h){h._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(h)}TE(h){const d=h._indexInSourceMeshInstanceArray;if(-1!=d){if(d!==this.instances.length-1){const h=this.instances[this.instances.length-1];this.instances[d]=h,h._indexInSourceMeshInstanceArray=d}h._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===B.d.CounterClockWiseSideOrientation}_getRenderingFillMode(h){const d=this.ih();return d.forcePointsCloud?B.d.PointFillMode:d.forceWireframe?B.d.WireFrameFillMode:this.overrideRenderingFillMode??h}setMaterialByID(h){return this.setMaterialById(h)}static CreateRibbon(h,d,m,j,A,b,w,a,D){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(h,d,m,j,A,b){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(h,d,m,j,A){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(h,d,m,j,A,b){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(h,d,m,j){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(h,d,m,j,A,b,w,a,D){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(h,d,m,j,A,b,w){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(h,d,m,j,A,b,w,a,D,S){throw new Error("Import MeshBuilder to populate this function")}static cS(h,d,m,j,A){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(h,d,m,j,A,b,w,a){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(h,d,m,j,A,b,w){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(h,d,m,j,A,b,w,a){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(h,d,m,j,A,b,w,a,D,S){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(h,d,m,j,A,b,w,a,D,S,M,q){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(h,d,m,j,A,b,w){throw new Error("Import MeshBuilder to populate this function")}static lS(h,d,m,j,A){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(h,d,m,j,A,b){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(h,d,m,j,A,b,w,a,D){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(h,d,m,j,A,b,w,a,D,S,M){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(h,d,m,j,A,b,w,a,D,S){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(h,d,m){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(h,d,m){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(h,d,m,j,A,b){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(h,d,m){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(h){throw new Error("Import MeshBuilder to populate this function")}}K.FRONTSIDE=I.c.FRONTSIDE,K.BACKSIDE=I.c.BACKSIDE,K.DOUBLESIDE=I.c.DOUBLESIDE,K.DEFAULTSIDE=I.c.DEFAULTSIDE,K.NO_CAP=0,K.CAP_START=1,K.CAP_END=2,K.CAP_ALL=3,K.NO_FLIP=0,K.FLIP_TILE=1,K.ROTATE_TILE=2,K.FLIP_ROW=3,K.ROTATE_ROW=4,K.FLIP_N_ROTATE_TILE=5,K.FLIP_N_ROTATE_ROW=6,K.CENTER=0,K.LEFT=1,K.RIGHT=2,K.TOP=3,K.BOTTOM=4,K.INSTANCEDMESH_SORT_TRANSPARENT=!1,K._GroundMeshParser=(h,d)=>{throw(0,y.b)("GroundMesh")},K._GoldbergMeshParser=(h,d)=>{throw(0,y.b)("GoldbergMesh")},K._LinesMeshParser=(h,d)=>{throw(0,y.b)("LinesMesh")},K._GreasedLineMeshParser=(h,d)=>{throw(0,y.b)("GreasedLineMesh")},K._GreasedLineRibbonMeshParser=(h,d)=>{throw(0,y.b)("GreasedLineRibbonMesh")},K._TrailMeshParser=(h,d)=>{throw(0,y.b)("TrailMesh")},(0,o.i)("BABYLON.Mesh",K)},11388:(h,d,m)=>{m.d(d,{c:()=>R});var j=m(11258),A=m(11058),b=m(11281),w=m(11137),a=m(11353),D=m(11121),S=m(11261),M=m(11395),q=m(11154),E=m(11276);class I{}class R{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,M.g)(this._applyToCoroutine.bind(this)),this.uniqueId=R._UniqueIdGenerator,R._UniqueIdGenerator++}set(h,d){switch(h.length||D.c.Warn(`Setting vertex data kind '${d}' with an empty array`),d){case b.d.PositionKind:this.Fh=h;break;case b.d.NormalKind:this.fh=h;break;case b.d.TangentKind:this.tangents=h;break;case b.d.UVKind:this.kh=h;break;case b.d.UV2Kind:this.uvs2=h;break;case b.d.UV3Kind:this.uvs3=h;break;case b.d.UV4Kind:this.uvs4=h;break;case b.d.UV5Kind:this.uvs5=h;break;case b.d.UV6Kind:this.uvs6=h;break;case b.d.ColorKind:this.Hh=h;break;case b.d.MatricesIndicesKind:this.matricesIndices=h;break;case b.d.MatricesWeightsKind:this.matricesWeights=h;break;case b.d.MatricesIndicesExtraKind:this.matricesIndicesExtra=h;break;case b.d.MatricesWeightsExtraKind:this.matricesWeightsExtra=h}}Nh(h,d){return this._applyTo(h,d,!1),this}applyToGeometry(h,d){return this._applyTo(h,d,!1),this}updateMesh(h){return this._update(h),this}updateGeometry(h){return this._update(h),this}*_applyToCoroutine(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0;if(this.Fh&&(h.xh(b.d.PositionKind,this.Fh,d),m&&(yield)),this.fh&&(h.xh(b.d.NormalKind,this.fh,d),m&&(yield)),this.tangents&&(h.xh(b.d.TangentKind,this.tangents,d),m&&(yield)),this.kh&&(h.xh(b.d.UVKind,this.kh,d),m&&(yield)),this.uvs2&&(h.xh(b.d.UV2Kind,this.uvs2,d),m&&(yield)),this.uvs3&&(h.xh(b.d.UV3Kind,this.uvs3,d),m&&(yield)),this.uvs4&&(h.xh(b.d.UV4Kind,this.uvs4,d),m&&(yield)),this.uvs5&&(h.xh(b.d.UV5Kind,this.uvs5,d),m&&(yield)),this.uvs6&&(h.xh(b.d.UV6Kind,this.uvs6,d),m&&(yield)),this.Hh){const j=this.Fh&&this.Hh.length===this.Fh.length?3:4;h.xh(b.d.ColorKind,this.Hh,d,j),this.hasVertexAlpha&&void 0!==h.hasVertexAlpha&&(h.hasVertexAlpha=!0),m&&(yield)}if(this.matricesIndices&&(h.xh(b.d.MatricesIndicesKind,this.matricesIndices,d),m&&(yield)),this.matricesWeights&&(h.xh(b.d.MatricesWeightsKind,this.matricesWeights,d),m&&(yield)),this.matricesIndicesExtra&&(h.xh(b.d.MatricesIndicesExtraKind,this.matricesIndicesExtra,d),m&&(yield)),this.matricesWeightsExtra&&(h.xh(b.d.MatricesWeightsExtraKind,this.matricesWeightsExtra,d),m&&(yield)),this.indices?(h.setIndices(this.indices,null,d),m&&(yield)):h.setIndices([],null),h.Ab&&this.materialInfos&&this.materialInfos.length>1){const d=h;d.Ab=[];for(const h of this.materialInfos)new E.b(h.materialIndex,h.verticesStart,h.verticesCount,h.indexStart,h.indexCount,d)}return this}_update(h,d,m){return this.Fh&&h.updateVerticesData(b.d.PositionKind,this.Fh,d,m),this.fh&&h.updateVerticesData(b.d.NormalKind,this.fh,d,m),this.tangents&&h.updateVerticesData(b.d.TangentKind,this.tangents,d,m),this.kh&&h.updateVerticesData(b.d.UVKind,this.kh,d,m),this.uvs2&&h.updateVerticesData(b.d.UV2Kind,this.uvs2,d,m),this.uvs3&&h.updateVerticesData(b.d.UV3Kind,this.uvs3,d,m),this.uvs4&&h.updateVerticesData(b.d.UV4Kind,this.uvs4,d,m),this.uvs5&&h.updateVerticesData(b.d.UV5Kind,this.uvs5,d,m),this.uvs6&&h.updateVerticesData(b.d.UV6Kind,this.uvs6,d,m),this.Hh&&h.updateVerticesData(b.d.ColorKind,this.Hh,d,m),this.matricesIndices&&h.updateVerticesData(b.d.MatricesIndicesKind,this.matricesIndices,d,m),this.matricesWeights&&h.updateVerticesData(b.d.MatricesWeightsKind,this.matricesWeights,d,m),this.matricesIndicesExtra&&h.updateVerticesData(b.d.MatricesIndicesExtraKind,this.matricesIndicesExtra,d,m),this.matricesWeightsExtra&&h.updateVerticesData(b.d.MatricesWeightsExtraKind,this.matricesWeightsExtra,d,m),this.indices&&h.setIndices(this.indices,null),this}static _TransformVector3Coordinates(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.length;const b=A.d.Qd[0],w=A.d.Qd[1];for(let a=m;a<m+j;a+=3)A.i.FromArrayToRef(h,a,b),A.i.TransformCoordinatesToRef(b,d,w),h[a]=w.x,h[a+1]=w.y,h[a+2]=w.z}static _TransformVector3Normals(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.length;const b=A.d.Qd[0],w=A.d.Qd[1];for(let a=m;a<m+j;a+=3)A.i.FromArrayToRef(h,a,b),A.i.TransformNormalToRef(b,d,w),h[a]=w.x,h[a+1]=w.y,h[a+2]=w.z}static _TransformVector4Normals(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.length;const b=A.d.Vector4[0],w=A.d.Vector4[1];for(let a=m;a<m+j;a+=4)A.m.FromArrayToRef(h,a,b),A.m.TransformNormalToRef(b,d,w),h[a]=w.x,h[a+1]=w.y,h[a+2]=w.z,h[a+3]=w.w}static _FlipFaces(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.length;for(let j=d;j<d+m;j+=3){const d=h[j+1];h[j+1]=h[j+2],h[j+2]=d}}transform(h){const d=h.determinant()<0;return this.Fh&&R._TransformVector3Coordinates(this.Fh,h),this.fh&&R._TransformVector3Normals(this.fh,h),this.tangents&&R._TransformVector4Normals(this.tangents,h),d&&this.indices&&R._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const h=[];for(const d of this.materialInfos){const m=new R;if(this.Fh&&(m.Fh=this.Fh.slice(3*d.verticesStart,3*(d.verticesCount+d.verticesStart))),this.fh&&(m.fh=this.fh.slice(3*d.verticesStart,3*(d.verticesCount+d.verticesStart))),this.tangents&&(m.tangents=this.tangents.slice(4*d.verticesStart,4*(d.verticesCount+d.verticesStart))),this.Hh&&(m.Hh=this.Hh.slice(4*d.verticesStart,4*(d.verticesCount+d.verticesStart))),this.kh&&(m.kh=this.kh.slice(2*d.verticesStart,2*(d.verticesCount+d.verticesStart))),this.uvs2&&(m.uvs2=this.uvs2.slice(2*d.verticesStart,2*(d.verticesCount+d.verticesStart))),this.uvs3&&(m.uvs3=this.uvs3.slice(2*d.verticesStart,2*(d.verticesCount+d.verticesStart))),this.uvs4&&(m.uvs4=this.uvs4.slice(2*d.verticesStart,2*(d.verticesCount+d.verticesStart))),this.uvs5&&(m.uvs5=this.uvs5.slice(2*d.verticesStart,2*(d.verticesCount+d.verticesStart))),this.uvs6&&(m.uvs6=this.uvs6.slice(2*d.verticesStart,2*(d.verticesCount+d.verticesStart))),this.matricesIndices&&(m.matricesIndices=this.matricesIndices.slice(4*d.verticesStart,4*(d.verticesCount+d.verticesStart))),this.matricesIndicesExtra&&(m.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*d.verticesStart,4*(d.verticesCount+d.verticesStart))),this.matricesWeights&&(m.matricesWeights=this.matricesWeights.slice(4*d.verticesStart,4*(d.verticesCount+d.verticesStart))),this.matricesWeightsExtra&&(m.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*d.verticesStart,4*(d.verticesCount+d.verticesStart))),this.indices){m.indices=[];for(let h=d.indexStart;h<d.indexStart+d.indexCount;h++)m.indices.push(this.indices[h]-d.verticesStart)}const j=new I;j.indexStart=0,j.indexCount=m.indices?m.indices.length:0,j.materialIndex=d.materialIndex,j.verticesStart=0,j.verticesCount=(m.Fh?m.Fh.length:0)/3,m.materialInfos=[j],h.push(m)}return h}merge(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const b=Array.isArray(h)?h.map((h=>({vertexData:h}))):[{vertexData:h}];return(0,M.l)(this._mergeCoroutine(void 0,b,d,!1,m,j,A))}*_mergeCoroutine(h,d){var m,j;let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let M=d.map((h=>h.vertexData)),q=this;if(S)for(const b of M)b&&(b._validate(),!this.fh&&b.fh&&(this.fh=new Float32Array(this.Fh.length)),!this.tangents&&b.tangents&&(this.tangents=new Float32Array(this.Fh.length/3*4)),!this.kh&&b.kh&&(this.kh=new Float32Array(this.Fh.length/3*2)),!this.uvs2&&b.uvs2&&(this.uvs2=new Float32Array(this.Fh.length/3*2)),!this.uvs3&&b.uvs3&&(this.uvs3=new Float32Array(this.Fh.length/3*2)),!this.uvs4&&b.uvs4&&(this.uvs4=new Float32Array(this.Fh.length/3*2)),!this.uvs5&&b.uvs5&&(this.uvs5=new Float32Array(this.Fh.length/3*2)),!this.uvs6&&b.uvs6&&(this.uvs6=new Float32Array(this.Fh.length/3*2)),!this.Hh&&b.Hh&&(this.Hh=new Float32Array(this.Fh.length/3*4),this.Hh.fill(1)),!this.matricesIndices&&b.matricesIndices&&(this.matricesIndices=new Float32Array(this.Fh.length/3*4)),!this.matricesWeights&&b.matricesWeights&&(this.matricesWeights=new Float32Array(this.Fh.length/3*4)),!this.matricesIndicesExtra&&b.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.Fh.length/3*4)),!this.matricesWeightsExtra&&b.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.Fh.length/3*4)));for(const b of M)if(b)if(S)this.fh&&!b.fh&&(b.fh=new Float32Array(b.Fh.length)),this.tangents&&!b.tangents&&(b.tangents=new Float32Array(b.Fh.length/3*4)),this.kh&&!b.kh&&(b.kh=new Float32Array(b.Fh.length/3*2)),this.uvs2&&!b.uvs2&&(b.uvs2=new Float32Array(b.Fh.length/3*2)),this.uvs3&&!b.uvs3&&(b.uvs3=new Float32Array(b.Fh.length/3*2)),this.uvs4&&!b.uvs4&&(b.uvs4=new Float32Array(b.Fh.length/3*2)),this.uvs5&&!b.uvs5&&(b.uvs5=new Float32Array(b.Fh.length/3*2)),this.uvs6&&!b.uvs6&&(b.uvs6=new Float32Array(b.Fh.length/3*2)),this.Hh&&!b.Hh&&(b.Hh=new Float32Array(b.Fh.length/3*4),b.Hh.fill(1)),this.matricesIndices&&!b.matricesIndices&&(b.matricesIndices=new Float32Array(b.Fh.length/3*4)),this.matricesWeights&&!b.matricesWeights&&(b.matricesWeights=new Float32Array(b.Fh.length/3*4)),this.matricesIndicesExtra&&!b.matricesIndicesExtra&&(b.matricesIndicesExtra=new Float32Array(b.Fh.length/3*4)),this.matricesWeightsExtra&&!b.matricesWeightsExtra&&(b.matricesWeightsExtra=new Float32Array(b.Fh.length/3*4));else if(b._validate(),!this.fh!==!b.fh||!this.tangents!==!b.tangents||!this.kh!==!b.kh||!this.uvs2!==!b.uvs2||!this.uvs3!==!b.uvs3||!this.uvs4!==!b.uvs4||!this.uvs5!==!b.uvs5||!this.uvs6!==!b.uvs6||!this.Hh!==!b.Hh||!this.matricesIndices!==!b.matricesIndices||!this.matricesWeights!==!b.matricesWeights||!this.matricesIndicesExtra!==!b.matricesIndicesExtra||!this.matricesWeightsExtra!==!b.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(D){let m=0,j=0,A=0;const b=[];let w=null;const a=[];for(const d of this.splitBasedOnMaterialID())a.push({vertexData:d,transform:h});for(const h of d)if(h.vertexData)for(const d of h.vertexData.splitBasedOnMaterialID())a.push({vertexData:d,transform:h.transform});a.sort(((h,d)=>{const m=h.vertexData.materialInfos?h.vertexData.materialInfos[0].materialIndex:0,j=d.vertexData.materialInfos?d.vertexData.materialInfos[0].materialIndex:0;return m>j?1:m===j?0:-1}));for(const h of a){const d=h.vertexData;if(m=d.materialInfos?d.materialInfos[0].materialIndex:0,w&&w.materialIndex===m)w.indexCount+=d.indices.length,w.verticesCount+=d.Fh.length/3;else{const h=new I;h.materialIndex=m,h.indexStart=j,h.indexCount=d.indices.length,h.verticesStart=A,h.verticesCount=d.Fh.length/3,b.push(h),w=h}j+=d.indices.length,A+=d.Fh.length/3}const D=a.splice(0,1)[0];q=D.vertexData,h=D.transform,M=a.map((h=>h.vertexData)),d=a,this.materialInfos=b}const E=M.reduce(((h,d)=>{var m;return h+((null===(m=d.indices)||void 0===m?void 0:m.length)??0)}),(null===(m=q.indices)||void 0===m?void 0:m.length)??0);let Z=a||M.some((h=>h.indices===q.indices))?null===(j=q.indices)||void 0===j?void 0:j.slice():q.indices;if(E>0){var L;let m=(null===(L=Z)||void 0===L?void 0:L.length)??0;if(Z||(Z=new Array(E)),Z.length!==E){if(Array.isArray(Z))Z.length=E;else{const h=A||Z instanceof Uint32Array?new Uint32Array(E):new Uint16Array(E);h.set(Z),Z=h}h&&h.determinant()<0&&R._FlipFaces(Z,0,m)}let j=q.Fh?q.Fh.length/3:0;for(const{vertexData:h,transform:A}of d)if(h.indices){for(let d=0;d<h.indices.length;d++)Z[m+d]=h.indices[d]+j;A&&A.determinant()<0&&R._FlipFaces(Z,m,h.indices.length),j+=h.Fh.length/3,m+=h.indices.length,w&&(yield)}}return this.indices=Z,this.Fh=R._MergeElement(b.d.PositionKind,q.Fh,h,d.map((h=>[h.vertexData.Fh,h.transform]))),w&&(yield),q.fh&&(this.fh=R._MergeElement(b.d.NormalKind,q.fh,h,d.map((h=>[h.vertexData.fh,h.transform]))),w&&(yield)),q.tangents&&(this.tangents=R._MergeElement(b.d.TangentKind,q.tangents,h,d.map((h=>[h.vertexData.tangents,h.transform]))),w&&(yield)),q.kh&&(this.kh=R._MergeElement(b.d.UVKind,q.kh,h,d.map((h=>[h.vertexData.kh,h.transform]))),w&&(yield)),q.uvs2&&(this.uvs2=R._MergeElement(b.d.UV2Kind,q.uvs2,h,d.map((h=>[h.vertexData.uvs2,h.transform]))),w&&(yield)),q.uvs3&&(this.uvs3=R._MergeElement(b.d.UV3Kind,q.uvs3,h,d.map((h=>[h.vertexData.uvs3,h.transform]))),w&&(yield)),q.uvs4&&(this.uvs4=R._MergeElement(b.d.UV4Kind,q.uvs4,h,d.map((h=>[h.vertexData.uvs4,h.transform]))),w&&(yield)),q.uvs5&&(this.uvs5=R._MergeElement(b.d.UV5Kind,q.uvs5,h,d.map((h=>[h.vertexData.uvs5,h.transform]))),w&&(yield)),q.uvs6&&(this.uvs6=R._MergeElement(b.d.UV6Kind,q.uvs6,h,d.map((h=>[h.vertexData.uvs6,h.transform]))),w&&(yield)),q.Hh&&(this.Hh=R._MergeElement(b.d.ColorKind,q.Hh,h,d.map((h=>[h.vertexData.Hh,h.transform]))),(void 0!==q.hasVertexAlpha||d.some((h=>void 0!==h.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=q.hasVertexAlpha||d.some((h=>h.vertexData.hasVertexAlpha))),w&&(yield)),q.matricesIndices&&(this.matricesIndices=R._MergeElement(b.d.MatricesIndicesKind,q.matricesIndices,h,d.map((h=>[h.vertexData.matricesIndices,h.transform]))),w&&(yield)),q.matricesWeights&&(this.matricesWeights=R._MergeElement(b.d.MatricesWeightsKind,q.matricesWeights,h,d.map((h=>[h.vertexData.matricesWeights,h.transform]))),w&&(yield)),q.matricesIndicesExtra&&(this.matricesIndicesExtra=R._MergeElement(b.d.MatricesIndicesExtraKind,q.matricesIndicesExtra,h,d.map((h=>[h.vertexData.matricesIndicesExtra,h.transform]))),w&&(yield)),q.matricesWeightsExtra&&(this.matricesWeightsExtra=R._MergeElement(b.d.MatricesWeightsExtraKind,q.matricesWeightsExtra,h,d.map((h=>[h.vertexData.matricesWeightsExtra,h.transform])))),this}static _MergeElement(h,d,m,j){const A=j.filter((h=>null!==h[0]&&void 0!==h[0]));if(!d&&0==A.length)return d;if(!d)return this._MergeElement(h,A[0][0],A[0][1],A.slice(1));const w=A.reduce(((h,d)=>h+d[0].length),d.length),a=h===b.d.PositionKind?R._TransformVector3Coordinates:h===b.d.NormalKind?R._TransformVector3Normals:h===b.d.TangentKind?R._TransformVector4Normals:()=>{};if(d instanceof Float32Array){const h=new Float32Array(w);h.set(d),m&&a(h,m,0,d.length);let j=d.length;for(const[d,m]of A)h.set(d,j),m&&a(h,m,j,d.length),j+=d.length;return h}{const h=new Array(w);for(let m=0;m<d.length;m++)h[m]=d[m];m&&a(h,m,0,d.length);let j=d.length;for(const[d,m]of A){for(let m=0;m<d.length;m++)h[j+m]=d[m];m&&a(h,m,j,d.length),j+=d.length}return h}}_validate(){if(!this.Fh)throw new q.i("Positions are required",q.e.MeshInvalidPositionsError);const h=(h,d)=>{const m=b.d.DeduceStride(h);if(d.length%m!==0)throw new Error("The "+h+"s array count must be a multiple of "+m);return d.length/m},d=h(b.d.PositionKind,this.Fh),m=(m,j)=>{const A=h(m,j);if(A!==d)throw new Error("The "+m+"s element count ("+A+") does not match the positions count ("+d+")")};this.fh&&m(b.d.NormalKind,this.fh),this.tangents&&m(b.d.TangentKind,this.tangents),this.kh&&m(b.d.UVKind,this.kh),this.uvs2&&m(b.d.UV2Kind,this.uvs2),this.uvs3&&m(b.d.UV3Kind,this.uvs3),this.uvs4&&m(b.d.UV4Kind,this.uvs4),this.uvs5&&m(b.d.UV5Kind,this.uvs5),this.uvs6&&m(b.d.UV6Kind,this.uvs6),this.Hh&&m(b.d.ColorKind,this.Hh),this.matricesIndices&&m(b.d.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&m(b.d.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&m(b.d.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&m(b.d.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const h=this.serialize();return R.Parse(h)}serialize(){const h={};if(this.Fh&&(h.Fh=Array.from(this.Fh)),this.fh&&(h.fh=Array.from(this.fh)),this.tangents&&(h.tangents=Array.from(this.tangents)),this.kh&&(h.kh=Array.from(this.kh)),this.uvs2&&(h.uvs2=Array.from(this.uvs2)),this.uvs3&&(h.uvs3=Array.from(this.uvs3)),this.uvs4&&(h.uvs4=Array.from(this.uvs4)),this.uvs5&&(h.uvs5=Array.from(this.uvs5)),this.uvs6&&(h.uvs6=Array.from(this.uvs6)),this.Hh&&(h.Hh=Array.from(this.Hh),h.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(h.matricesIndices=Array.from(this.matricesIndices),h.matricesIndicesExpanded=!0),this.matricesWeights&&(h.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(h.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),h.matricesIndicesExtraExpanded=!0),this.matricesWeightsExtra&&(h.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),h.indices=this.indices?Array.from(this.indices):[],this.materialInfos){h.materialInfos=[];for(const d of this.materialInfos){const m={indexStart:d.indexStart,indexCount:d.indexCount,materialIndex:d.materialIndex,verticesStart:d.verticesStart,verticesCount:d.verticesCount};h.materialInfos.push(m)}}return h}static ExtractFromMesh(h,d,m){return R._ExtractFrom(h,d,m)}static ExtractFromGeometry(h,d,m){return R._ExtractFrom(h,d,m)}static _ExtractFrom(h,d,m){const j=new R;if(h.isVerticesDataPresent(b.d.PositionKind)&&(j.Fh=h.getVerticesData(b.d.PositionKind,d,m)),h.isVerticesDataPresent(b.d.NormalKind)&&(j.fh=h.getVerticesData(b.d.NormalKind,d,m)),h.isVerticesDataPresent(b.d.TangentKind)&&(j.tangents=h.getVerticesData(b.d.TangentKind,d,m)),h.isVerticesDataPresent(b.d.UVKind)&&(j.kh=h.getVerticesData(b.d.UVKind,d,m)),h.isVerticesDataPresent(b.d.UV2Kind)&&(j.uvs2=h.getVerticesData(b.d.UV2Kind,d,m)),h.isVerticesDataPresent(b.d.UV3Kind)&&(j.uvs3=h.getVerticesData(b.d.UV3Kind,d,m)),h.isVerticesDataPresent(b.d.UV4Kind)&&(j.uvs4=h.getVerticesData(b.d.UV4Kind,d,m)),h.isVerticesDataPresent(b.d.UV5Kind)&&(j.uvs5=h.getVerticesData(b.d.UV5Kind,d,m)),h.isVerticesDataPresent(b.d.UV6Kind)&&(j.uvs6=h.getVerticesData(b.d.UV6Kind,d,m)),h.isVerticesDataPresent(b.d.ColorKind)){const A=h.Ld||h,w=A.getVertexBuffer(b.d.ColorKind),a=A.getVerticesData(b.d.ColorKind,d,m);if(3===w.getSize()){const h=new Float32Array(4*a.length/3);for(let d=0,m=0;d<a.length;d+=3,m+=4)h[m]=a[d],h[m+1]=a[d+1],h[m+2]=a[d+2],h[m+3]=1;j.Hh=h}else{if(4!==w.getSize())throw new Error(`Unexpected number of color components: ${w.getSize()}`);j.Hh=a}}return h.isVerticesDataPresent(b.d.MatricesIndicesKind)&&(j.matricesIndices=h.getVerticesData(b.d.MatricesIndicesKind,d,m)),h.isVerticesDataPresent(b.d.MatricesWeightsKind)&&(j.matricesWeights=h.getVerticesData(b.d.MatricesWeightsKind,d,m)),h.isVerticesDataPresent(b.d.MatricesIndicesExtraKind)&&(j.matricesIndicesExtra=h.getVerticesData(b.d.MatricesIndicesExtraKind,d,m)),h.isVerticesDataPresent(b.d.MatricesWeightsExtraKind)&&(j.matricesWeightsExtra=h.getVerticesData(b.d.MatricesWeightsExtraKind,d,m)),j.indices=h.Vd(d,m),j}static CreateRibbon(h){throw(0,w.b)("ribbonBuilder")}static CreateBox(h){throw(0,w.b)("boxBuilder")}static CreateTiledBox(h){throw(0,w.b)("tiledBoxBuilder")}static CreateTiledPlane(h){throw(0,w.b)("tiledPlaneBuilder")}static CreateSphere(h){throw(0,w.b)("sphereBuilder")}static CreateCylinder(h){throw(0,w.b)("cylinderBuilder")}static CreateTorus(h){throw(0,w.b)("torusBuilder")}static CreateLineSystem(h){throw(0,w.b)("linesBuilder")}static CreateDashedLines(h){throw(0,w.b)("linesBuilder")}static CreateGround(h){throw(0,w.b)("groundBuilder")}static CreateTiledGround(h){throw(0,w.b)("groundBuilder")}static CreateGroundFromHeightMap(h){throw(0,w.b)("groundBuilder")}static lS(h){throw(0,w.b)("planeBuilder")}static CreateDisc(h){throw(0,w.b)("discBuilder")}static CreatePolygon(h,d,m,j,A,b,a){throw(0,w.b)("polygonBuilder")}static CreateIcoSphere(h){throw(0,w.b)("icoSphereBuilder")}static CreatePolyhedron(h){throw(0,w.b)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||A.i.Up();throw(0,w.b)("capsuleBuilder")}static CreateTorusKnot(h){throw(0,w.b)("torusKnotBuilder")}static ComputeNormals(h,d,m,j){let b=0,w=0,a=0,D=0,S=0,M=0,q=0,E=0,I=0,R=0,Z=0,L=0,B=0,V=0,v=0,C=0,T=0,o=0,y=0,i=0,g=!1,F=!1,f=!1,H=!1,c=1,k=0,l=null;j&&(g=!!j.facetNormals,F=!!j.facetPositions,f=!!j.facetPartitioning,c=!0===j.useRightHandedSystem?-1:1,k=j.ratio||0,H=!!j.depthSort,l=j.distanceTo,H&&void 0===l&&(l=A.i.Zero()));let K=0,N=0,W=0,r=0;for(f&&j&&j.bbSize&&(K=j.subDiv.X*k/j.bbSize.x,N=j.subDiv.Y*k/j.bbSize.y,W=j.subDiv.Z*k/j.bbSize.z,r=j.subDiv.max*j.subDiv.max,j.facetPartitioning.length=0),b=0;b<h.length;b++)m[b]=0;const Y=d.length/3|0;for(b=0;b<Y;b++){if(L=3*d[3*b],B=L+1,V=L+2,v=3*d[3*b+1],C=v+1,T=v+2,o=3*d[3*b+2],y=o+1,i=o+2,w=h[L]-h[v],a=h[B]-h[C],D=h[V]-h[T],S=h[o]-h[v],M=h[y]-h[C],q=h[i]-h[T],E=c*(a*q-D*M),I=c*(D*S-w*q),R=c*(w*M-a*S),Z=Math.sqrt(E*E+I*I+R*R),Z=0===Z?1:Z,E/=Z,I/=Z,R/=Z,g&&j&&(j.facetNormals[b].x=E,j.facetNormals[b].y=I,j.facetNormals[b].z=R),F&&j&&(j.facetPositions[b].x=(h[L]+h[v]+h[o])/3,j.facetPositions[b].y=(h[B]+h[C]+h[y])/3,j.facetPositions[b].z=(h[V]+h[T]+h[i])/3),f&&j){const d=Math.floor((j.facetPositions[b].x-j.bInfo.minimum.x*k)*K),m=Math.floor((j.facetPositions[b].y-j.bInfo.minimum.y*k)*N),A=Math.floor((j.facetPositions[b].z-j.bInfo.minimum.z*k)*W),w=Math.floor((h[L]-j.bInfo.minimum.x*k)*K),a=Math.floor((h[B]-j.bInfo.minimum.y*k)*N),D=Math.floor((h[V]-j.bInfo.minimum.z*k)*W),S=Math.floor((h[v]-j.bInfo.minimum.x*k)*K),M=Math.floor((h[C]-j.bInfo.minimum.y*k)*N),q=Math.floor((h[T]-j.bInfo.minimum.z*k)*W),E=Math.floor((h[o]-j.bInfo.minimum.x*k)*K),I=Math.floor((h[y]-j.bInfo.minimum.y*k)*N),R=Math.floor((h[i]-j.bInfo.minimum.z*k)*W),Z=w+j.subDiv.max*a+r*D,g=S+j.subDiv.max*M+r*q,F=E+j.subDiv.max*I+r*R,f=d+j.subDiv.max*m+r*A;j.facetPartitioning[f]=j.facetPartitioning[f]?j.facetPartitioning[f]:[],j.facetPartitioning[Z]=j.facetPartitioning[Z]?j.facetPartitioning[Z]:[],j.facetPartitioning[g]=j.facetPartitioning[g]?j.facetPartitioning[g]:[],j.facetPartitioning[F]=j.facetPartitioning[F]?j.facetPartitioning[F]:[],j.facetPartitioning[Z].push(b),g!=Z&&j.facetPartitioning[g].push(b),F!=g&&F!=Z&&j.facetPartitioning[F].push(b),f!=Z&&f!=g&&f!=F&&j.facetPartitioning[f].push(b)}if(H&&j&&j.facetPositions){const h=j.depthSortedFacets[b];h.ind=3*b,h.sqDistance=A.i.DistanceSquared(j.facetPositions[b],l)}m[L]+=E,m[B]+=I,m[V]+=R,m[v]+=E,m[C]+=I,m[T]+=R,m[o]+=E,m[y]+=I,m[i]+=R}for(b=0;b<m.length/3;b++)E=m[3*b],I=m[3*b+1],R=m[3*b+2],Z=Math.sqrt(E*E+I*I+R*R),Z=0===Z?1:Z,E/=Z,I/=Z,R/=Z,m[3*b]=E,m[3*b+1]=I,m[3*b+2]=R}static _ComputeSides(h,d,m,j,b,w,a){const D=m.length,S=j.length;let M,q;switch(h=h||R.DEFAULTSIDE){case R.FRONTSIDE:break;case R.BACKSIDE:for(M=0;M<D;M+=3){const h=m[M];m[M]=m[M+2],m[M+2]=h}for(q=0;q<S;q++)j[q]=-j[q];break;case R.DOUBLESIDE:{const h=d.length,E=h/3;for(let m=0;m<h;m++)d[h+m]=d[m];for(M=0;M<D;M+=3)m[M+D]=m[M+2]+E,m[M+1+D]=m[M+1]+E,m[M+2+D]=m[M]+E;for(q=0;q<S;q++)j[S+q]=-j[q];const I=b.length;let R=0;for(R=0;R<I;R++)b[R+I]=b[R];for(w=w||new A.m(0,0,1,1),a=a||new A.m(0,0,1,1),R=0,M=0;M<I/2;M++)b[R]=w.x+(w.z-w.x)*b[R],b[R+1]=w.y+(w.w-w.y)*b[R+1],b[R+I]=a.x+(a.z-a.x)*b[R+I],b[R+I+1]=a.y+(a.w-a.y)*b[R+I+1],R+=2;break}}}static Parse(h){const d=new R,m=h.Fh;m&&d.set(m,b.d.PositionKind);const j=h.fh;j&&d.set(j,b.d.NormalKind);const A=h.tangents;A&&d.set(A,b.d.TangentKind);const w=h.kh;w&&d.set(w,b.d.UVKind);const D=h.uvs2;D&&d.set(D,b.d.UV2Kind);const S=h.uvs3;S&&d.set(S,b.d.UV3Kind);const M=h.uvs4;M&&d.set(M,b.d.UV4Kind);const q=h.uvs5;q&&d.set(q,b.d.UV5Kind);const E=h.uvs6;E&&d.set(E,b.d.UV6Kind);const Z=h.Hh;Z&&(d.set(a.f.CheckColors4(Z,m.length/3),b.d.ColorKind),void 0!==h.hasVertexAlpha&&(d.hasVertexAlpha=h.hasVertexAlpha));const L=h.matricesIndices;L&&d.set(L,b.d.MatricesIndicesKind);const B=h.matricesWeights;B&&d.set(B,b.d.MatricesWeightsKind);const V=h.indices;V&&(d.indices=V);const v=h.materialInfos;if(v){d.materialInfos=[];for(const h of v){const m=new I;m.indexCount=h.indexCount,m.indexStart=h.indexStart,m.verticesCount=h.verticesCount,m.verticesStart=h.verticesStart,m.materialIndex=h.materialIndex,d.materialInfos.push(m)}}return d}static ImportVertexData(h,d){const m=R.Parse(h);d.setAllVerticesData(m,h.updatable)}}R.FRONTSIDE=0,R.BACKSIDE=1,R.DOUBLESIDE=2,R.DEFAULTSIDE=0,R._UniqueIdGenerator=0,(0,j.d)([S.f.filter((function(){for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];let[j]=d;return!Array.isArray(j)}))],R,"_TransformVector3Coordinates",null),(0,j.d)([S.f.filter((function(){for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];let[j]=d;return!Array.isArray(j)}))],R,"_TransformVector3Normals",null),(0,j.d)([S.f.filter((function(){for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];let[j]=d;return!Array.isArray(j)}))],R,"_TransformVector4Normals",null),(0,j.d)([S.f.filter((function(){for(var h=arguments.length,d=new Array(h),m=0;m<h;m++)d[m]=arguments[m];let[j]=d;return!Array.isArray(j)}))],R,"_FlipFaces",null)},11276:(h,d,m)=>{m.d(d,{b:()=>D});var j=m(11281),A=m(11299),b=m(11303),w=m(11323),a=m(11329);class D{get materialDefines(){var h;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(h=this._getDrawWrapper())||void 0===h?void 0:h.defines}set materialDefines(h){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=h}_getDrawWrapper(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h=h??this._engine.currentRenderPassId;let m=this._drawWrappers[h];return!m&&d&&(this._drawWrappers[h]=m=new a.d(this._mesh.ih().getEngine())),m}_removeDrawWrapper(h){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var m;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(m=this._drawWrappers[h])||void 0===m||m.dispose(d));this._drawWrappers[h]=void 0}get effect(){var h;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(h=this._getDrawWrapper())||void 0===h?void 0:h.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(h){this._mainDrawWrapperOverride=h}setEffect(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2?arguments[2]:void 0,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const A=this._drawWrapper;A.setEffect(h,d,j),void 0!==m&&(A.materialContext=m),h||(A.defines=null,A.materialContext=void 0)}resetDrawCache(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==h)return void this._removeDrawWrapper(h,!0,d);for(const h of this._drawWrappers)null===h||void 0===h||h.dispose(d)}this._drawWrappers=[]}static AddToMesh(h,d,m,j,A,b,w){return new D(h,d,m,j,A,b,w,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(h,d,m,j,A,b,w){let a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],D=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=h,this.verticesStart=d,this.verticesCount=m,this.indexStart=j,this.indexCount=A,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=b,this._renderingMesh=w||b,D&&b.Ab.push(this),this._engine=this._mesh.ih().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=b.Ab.length-1,a&&(this.refreshBoundingInfo(),b.Zd(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(h){return this._boundingInfo=h,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const h=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return h||this._renderingMesh}Qh(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const d=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!d)return h&&this._mesh.ih()._hasDefaultMaterial?this._mesh.ih().defaultMaterial:null;if(this._isMultiMaterial(d)){const h=d.getSubMaterial(this.materialIndex);return this._currentMaterial!==h&&(this._currentMaterial=h,this.resetDrawCache()),h}return d}_isMultiMaterial(h){return void 0!==h.getSubMaterial}refreshBoundingInfo(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Ld)return this;if(h||(h=this._renderingMesh.getVerticesData(j.d.PositionKind)),!h)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const d=this._renderingMesh.Vd();let m;if(0===this.indexStart&&this.indexCount===d.length){const h=this._renderingMesh.getBoundingInfo();m={minimum:h.minimum.clone(),maximum:h.maximum.clone()}}else m=(0,w.c)(h,d,this.indexStart,this.indexCount,this._renderingMesh.Ld.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(m.minimum,m.maximum):this._boundingInfo=new b.e(m.minimum,m.maximum),this}_checkCollision(h){return this.getBoundingInfo()._checkCollision(h)}updateBoundingInfo(h){let d=this.getBoundingInfo();return d||(this.refreshBoundingInfo(),d=this.getBoundingInfo()),d&&d.update(h),this}isInFrustum(h){const d=this.getBoundingInfo();return!!d&&d.isInFrustum(h,this._mesh.Tq)}isCompletelyInFrustum(h){const d=this.getBoundingInfo();return!!d&&d.isCompletelyInFrustum(h)}render(h){return this._renderingMesh.render(this,h,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(h,d){if(!this._linesIndexBuffer){const m=6*Math.floor(this.indexCount/3),j=this.verticesStart+this.verticesCount>65535?new Uint32Array(m):new Uint16Array(m);let A=0;if(0===h.length)for(let h=this.indexStart;h<this.indexStart+this.indexCount;h+=3)j[A++]=h,j[A++]=h+1,j[A++]=h+1,j[A++]=h+2,j[A++]=h+2,j[A++]=h;else for(let d=this.indexStart;d<this.indexStart+this.indexCount;d+=3)j[A++]=h[d],j[A++]=h[d+1],j[A++]=h[d+1],j[A++]=h[d+2],j[A++]=h[d+2],j[A++]=h[d];this._linesIndexBuffer=d.createIndexBuffer(j),this._linesIndexCount=j.length}return this._linesIndexBuffer}canIntersects(h){const d=this.getBoundingInfo();return!!d&&h.intersectsBox(d.boundingBox)}intersects(h,d,m,j,A){const b=this.Qh();if(!b)return null;let w=3,a=!1;switch(b.fillMode){case 3:case 5:case 6:case 8:return null;case 7:w=1,a=!0}return 4===b.fillMode?m.length?this._intersectLines(h,d,m,this._mesh.intersectionThreshold,j):this._intersectUnIndexedLines(h,d,m,this._mesh.intersectionThreshold,j):!m.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(h,d,m,j,A):this._intersectTriangles(h,d,m,w,a,j,A)}_intersectLines(h,d,m,j,b){let w=null;for(let a=this.indexStart;a<this.indexStart+this.indexCount;a+=2){const D=d[m[a]],S=d[m[a+1]],M=h.intersectionSegment(D,S,j);if(!(M<0)&&((b||!w||M<w.distance)&&(w=new A.d(null,null,M),w.faceId=a/2,b)))break}return w}_intersectUnIndexedLines(h,d,m,j,b){let w=null;for(let a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=2){const m=d[a],D=d[a+1],S=h.intersectionSegment(m,D,j);if(!(S<0)&&((b||!w||S<w.distance)&&(w=new A.d(null,null,S),w.faceId=a/2,b)))break}return w}_intersectTriangles(h,d,m,j,A,b,w){let a=null,D=-1;for(let S=this.indexStart;S<this.indexStart+this.indexCount-(3-j);S+=j){D++;const j=m[S],M=m[S+1],q=m[S+2];if(A&&4294967295===q){S+=2;continue}const E=d[j],I=d[M],R=d[q];if(!E||!I||!R)continue;if(w&&!w(E,I,R,h,j,M,q))continue;const Z=h.intersectsTriangle(E,I,R);if(Z){if(Z.distance<0)continue;if((b||!a||Z.distance<a.distance)&&(a=Z,a.faceId=D,b))break}}return a}_intersectUnIndexedTriangles(h,d,m,j,A){let b=null;for(let w=this.verticesStart;w<this.verticesStart+this.verticesCount;w+=3){const m=d[w],a=d[w+1],D=d[w+2];if(A&&!A(m,a,D,h,-1,-1,-1))continue;const S=h.intersectsTriangle(m,a,D);if(S){if(S.distance<0)continue;if((j||!b||S.distance<b.distance)&&(b=S,b.faceId=w/3,j))break}}return b}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(h,d){const m=new D(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,h,d,!1);if(!this.IsGlobal){const h=this.getBoundingInfo();if(!h)return m;m._boundingInfo=new b.e(h.minimum,h.maximum)}return m}dispose(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.ih().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const d=this._mesh.Ab.indexOf(this);this._mesh.Ab.splice(d,1),this.resetDrawCache(void 0,h)}getClassName(){return"SubMesh"}static CreateFromIndices(h,d,m,j,A){let b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],w=Number.MAX_VALUE,a=-Number.MAX_VALUE;const S=(A||j).Vd();for(let D=d;D<d+m;D++){const h=S[D];h<w&&(w=h),h>a&&(a=h)}return new D(h,w,a-w+1,d,m,j,A,b)}}},11767:(h,d,m)=>{var j=m(11419),A=m(11281),b=m(11058),w=m(11121),a=m(11303);j.d.prototype.thinInstanceAdd=function(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.ih().getEngine().getCaps().instancedArrays)return w.c.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(h)?h.length:1);const m=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(h))for(let j=0;j<h.length;++j)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,h[j],j===h.length-1&&d);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,h,d);return m},j.d.prototype.thinInstanceAddSelf=function(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(b.b.IdentityReadOnly,h)},j.d.prototype.thinInstanceRegisterAttribute=function(h,d){h===A.d.ColorKind&&(h=A.d.ColorInstanceKind),this.removeVerticesData(h),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[h]=d,this._userThinInstanceBuffersStorage.sizes[h]=d*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[h]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[h]),this._userThinInstanceBuffersStorage.vertexBuffers[h]=new A.d(this.getEngine(),this._userThinInstanceBuffersStorage.data[h],h,!0,!1,d,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[h])},j.d.prototype.thinInstanceSetMatrixAt=function(h,d){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||h>=this._thinInstanceDataStorage.instancesCount)return!1;const j=this._thinInstanceDataStorage.matrixData;return d.copyToArray(j,16*h),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[h]=d),m&&(this.gq("matrix"),this.Wh||this.thinInstanceRefreshBoundingInfo(!1)),!0},j.d.prototype.thinInstanceSetAttributeAt=function(h,d,m){let j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return h===A.d.ColorKind&&(h=A.d.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[h]||d>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(h,0),this._userThinInstanceBuffersStorage.data[h].set(m,d*this._userThinInstanceBuffersStorage.strides[h]),j&&this.gq(h),!0)},Object.defineProperty(j.d.prototype,"wb",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(h){var d;const m=this._thinInstanceDataStorage.matrixData??(null===(d=this.source)||void 0===d?void 0:d._thinInstanceDataStorage.matrixData);h<=(m?m.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=h)},enumerable:!0,configurable:!0}),j.d.prototype._thinInstanceCreateMatrixBuffer=function(h,d){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const j=new A.c(this.getEngine(),d,!m,16,!1,!0);for(let A=0;A<4;A++)this.setVerticesBuffer(j.createVertexBuffer(h+A,4*A,4));return j},j.d.prototype.iq=function(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var b;if(m=m||16,"matrix"===h)null===(b=this._thinInstanceDataStorage.matrixBuffer)||void 0===b||b.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=d?d.length:32*m,this._thinInstanceDataStorage.matrixData=d,this._thinInstanceDataStorage.worldMatrices=null,null!==d?(this._thinInstanceDataStorage.instancesCount=d.length/m,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",d,j),this.Wh||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Wh||this.refreshBoundingInfo());else if("previousMatrix"===h){var w;null===(w=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===w||w.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=d,null!==d&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",d,j))}else{var a;if(h===A.d.ColorKind&&(h=A.d.ColorInstanceKind),null===d)null!==(a=this._userThinInstanceBuffersStorage)&&void 0!==a&&a.data[h]&&(this.removeVerticesData(h),delete this._userThinInstanceBuffersStorage.data[h],delete this._userThinInstanceBuffersStorage.strides[h],delete this._userThinInstanceBuffersStorage.sizes[h],delete this._userThinInstanceBuffersStorage.vertexBuffers[h]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[h]=d,this._userThinInstanceBuffersStorage.strides[h]=m,this._userThinInstanceBuffersStorage.sizes[h]=d.length,this._userThinInstanceBuffersStorage.vertexBuffers[h]=new A.d(this.getEngine(),d,h,!j,!1,m,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[h])}},j.d.prototype.gq=function(h){var d;if("matrix"===h)this.fE&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(h),null===(d=this._thinInstanceDataStorage.matrixBuffer)||void 0===d||d.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===h){var m;this.fE&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(h),null===(m=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===m||m.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var j;h===A.d.ColorKind&&(h=A.d.ColorInstanceKind),null!==(j=this._userThinInstanceBuffersStorage)&&void 0!==j&&j.vertexBuffers[h]&&(this.fE&&!this._userThinInstanceBuffersStorage.vertexBuffers[h].isUpdatable()&&this._thinInstanceRecreateBuffer(h),this._userThinInstanceBuffersStorage.vertexBuffers[h].updateDirectly(this._userThinInstanceBuffersStorage.data[h],0))}},j.d.prototype.thinInstancePartialBufferUpdate=function(h,d,m){var j;"matrix"===h?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(d,m):(h===A.d.ColorKind&&(h=A.d.ColorInstanceKind),null!==(j=this._userThinInstanceBuffersStorage)&&void 0!==j&&j.vertexBuffers[h]&&this._userThinInstanceBuffersStorage.vertexBuffers[h].updateDirectly(d,m))},j.d.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const h=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let d=0;d<this._thinInstanceDataStorage.instancesCount;++d)this._thinInstanceDataStorage.worldMatrices[d]=b.b.Ud(h,16*d)}return this._thinInstanceDataStorage.worldMatrices},j.d.prototype.thinInstanceRefreshBoundingInfo=function(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const j=this._thinInstanceDataStorage.boundingVectors;if(h||!this.rawBoundingInfo){j.length=0,this.refreshBoundingInfo(d,m);const h=this.getBoundingInfo();this.rawBoundingInfo=new a.e(h.minimum,h.maximum)}const A=this.getBoundingInfo(),w=this._thinInstanceDataStorage.matrixData;if(0===j.length)for(let b=0;b<A.boundingBox.vectors.length;++b)j.push(A.boundingBox.vectors[b].clone());b.d.Qd[0].sd(Number.POSITIVE_INFINITY),b.d.Qd[1].sd(Number.NEGATIVE_INFINITY);for(let a=0;a<this._thinInstanceDataStorage.instancesCount;++a){b.b.FromArrayToRef(w,16*a,b.d.Matrix[0]);for(let h=0;h<j.length;++h)b.i.TransformCoordinatesToRef(j[h],b.d.Matrix[0],b.d.Qd[2]),b.d.Qd[0].minimizeInPlace(b.d.Qd[2]),b.d.Qd[1].maximizeInPlace(b.d.Qd[2])}A.reConstruct(b.d.Qd[0],b.d.Qd[1]),this.rh()},j.d.prototype._thinInstanceRecreateBuffer=function(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var m;if("matrix"===h)null===(m=this._thinInstanceDataStorage.matrixBuffer)||void 0===m||m.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,d);else if("previousMatrix"===h){var j;if(this._scene.needsPreviousWorldMatrices)null===(j=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===j||j.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,d)}else{var b;h===A.d.ColorKind&&(h=A.d.ColorInstanceKind),null===(b=this._userThinInstanceBuffersStorage.vertexBuffers[h])||void 0===b||b.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[h]=new A.d(this.getEngine(),this._userThinInstanceBuffersStorage.data[h],h,!d,!1,this._userThinInstanceBuffersStorage.strides[h],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[h])}},j.d.prototype._thinInstanceUpdateBufferSize=function(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;h===A.d.ColorKind&&(h=A.d.ColorInstanceKind);const m="matrix"===h;if(!m&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[h]))return;const j=m?16:this._userThinInstanceBuffersStorage.strides[h],b=m?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[h];let w=m?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[h];const a=(this._thinInstanceDataStorage.instancesCount+d)*j;let D=b;for(;D<a;)D*=2;if(!w||b!=D){if(w){const h=new Float32Array(D);h.set(w,0),w=h}else w=new Float32Array(D);var S,M,q;if(m){if(null===(S=this._thinInstanceDataStorage.matrixBuffer)||void 0===S||S.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",w,!1),this._thinInstanceDataStorage.matrixData=w,this._thinInstanceDataStorage.matrixBufferSize=D,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(M=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===M||M.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",w,!1)}else null===(q=this._userThinInstanceBuffersStorage.vertexBuffers[h])||void 0===q||q.dispose(),this._userThinInstanceBuffersStorage.data[h]=w,this._userThinInstanceBuffersStorage.sizes[h]=D,this._userThinInstanceBuffersStorage.vertexBuffers[h]=new A.d(this.getEngine(),w,h,!0,!1,j,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[h])}},j.d.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},j.d.prototype._disposeThinInstanceSpecificData=function(){var h;null!==(h=this._thinInstanceDataStorage)&&void 0!==h&&h.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11366:(h,d,m)=>{m.d(d,{c:()=>M});var j=m(11258),A=m(11261),b=m(11341),w=m(11097),a=m(11058),D=m(11374),S=m(11080);class M extends D.b{get billboardMode(){return this._billboardMode}set billboardMode(h){this._billboardMode!==h&&(this._billboardMode=h,this._cache.useBillboardPosition=0!==(this._billboardMode&M.BILLBOARDMODE_USE_POSITION))}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(h){this._infiniteDistance!==h&&(this._infiniteDistance=h)}constructor(h){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new a.i(0,0,1),this._up=new a.i(0,1,0),this._right=new a.i(1,0,0),this._position=a.i.Zero(),this._rotation=a.i.Zero(),this._rotationQuaternion=null,this._scaling=a.i.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=M.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.kE=a.b.Zero(),this._usePivotMatrix=!1,this._absolutePosition=a.i.Zero(),this._absoluteScaling=a.i.Zero(),this._absoluteRotationQuaternion=a.c.Identity(),this._pivotMatrix=a.b.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new w.e,this._nonUniformScaling=!1,d&&this.ih().addTransformNode(this)}getClassName(){return"Ib"}get position(){return this._position}set position(h){this._position=h,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(h){this._rotation=h,this._rotationQuaternion=null,this._markAsDirtyInternal()}get td(){return this._scaling}set td(h){this._scaling=h,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(h){this._rotationQuaternion=h,h&&this._rotation.sd(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return a.i.TransformNormalFromFloatsToRef(0,0,this.ih().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return a.i.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return a.i.TransformNormalFromFloatsToRef(this.ih().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(h){return this._poseMatrix?(this._poseMatrix.D(h),this):(this._poseMatrix=h.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=a.b.Identity()),this._poseMatrix}_isSynchronized(){const h=this._cache;return this._billboardMode===h.billboardMode&&this._billboardMode===M.BILLBOARDMODE_NONE&&(!h.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const h=this._cache;h.localMatrixUpdated=!1,h.billboardMode=-1,h.infiniteDistance=!1,h.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(h){return this.setPivotMatrix(h,!1)}setPivotMatrix(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.D(h),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=d,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=a.b.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;const j=this.clone("Clone of "+(this.name||this.id),h||this.parent,!0);j&&m&&m(this,j);for(const A of this.getChildTransformNodes(!0))A.instantiateHierarchy(j,d,m);return j}Xb(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return h?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.sd(0),this._rotationQuaternion=this._rotationQuaternion||a.c.Identity(),h.decompose(this._scaling,this._rotationQuaternion,this._position),this.Zd(!0)):(this._worldMatrix=h,this._absolutePosition.xd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Zd(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Zd(!0),this}get wE(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Zd(),this._absolutePosition}setAbsolutePosition(h){if(!h)return this;let d,m,j;if(void 0===h.x){if(arguments.length<3)return this;d=arguments[0],m=arguments[1],j=arguments[2]}else d=h.x,m=h.y,j=h.z;if(this.parent){const h=a.d.Matrix[0];this.parent.getWorldMatrix().invertToRef(h),a.i.TransformCoordinatesFromFloatsToRef(d,m,j,h,this.position)}else this.position.x=d,this.position.y=m,this.position.z=j;return this._absolutePosition.D(h),this}setPositionWithLocalVector(h){return this.Zd(),this.position=a.i.TransformNormal(h,this.kE),this}getPositionExpressedInLocalSpace(){this.Zd();const h=a.d.Matrix[0];return this.kE.invertToRef(h),a.i.TransformNormal(this.position,h)}locallyTranslate(h){return this.Zd(!0),this.position=a.i.TransformCoordinates(h,this.kE),this}lookAt(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const b=M._LookAtVectorCache,w=0===A?this.position:this.getAbsolutePosition();if(h.subtractToRef(w,b),this.setDirection(b,d,m,j),1===A&&this.parent)if(this.rotationQuaternion){const h=a.d.Matrix[0];this.rotationQuaternion.toRotationMatrix(h);const d=a.d.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(d),d.invert(),h.multiplyToRef(d,h),this.rotationQuaternion.fromRotationMatrix(h)}else{const h=a.d.Quaternion[0];a.c.FromEulerVectorToRef(this.rotation,h);const d=a.d.Matrix[0];h.toRotationMatrix(d);const m=a.d.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(m),m.invert(),d.multiplyToRef(m,d),h.fromRotationMatrix(d),h.toEulerAnglesToRef(this.rotation)}return this}JD(h){const d=a.i.Zero();return this.getDirectionToRef(h,d),d}getDirectionToRef(h,d){return a.i.TransformNormalToRef(h,this.getWorldMatrix(),d),this}setDirection(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const A=-Math.atan2(h.z,h.x)+Math.PI/2,b=Math.sqrt(h.x*h.x+h.z*h.z),w=-Math.atan2(h.y,b);return this.rotationQuaternion?a.c.RotationYawPitchRollToRef(A+d,w+m,j,this.rotationQuaternion):(this.rotation.x=w+m,this.rotation.y=A+d,this.rotation.z=j),this}setPivotPoint(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.ih().getRenderId()&&this.Zd(!0);const m=this.getWorldMatrix();if(1==d){const d=a.d.Matrix[0];m.invertToRef(d),h=a.i.TransformCoordinates(h,d)}return this.setPivotMatrix(a.b.Translation(-h.x,-h.y,-h.z),!0)}getPivotPoint(){const h=a.i.Zero();return this.getPivotPointToRef(h),h}getPivotPointToRef(h){return h.x=-this._pivotMatrix.m[12],h.y=-this._pivotMatrix.m[13],h.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const h=a.i.Zero();return this.getAbsolutePivotPointToRef(h),h}getAbsolutePivotPointToRef(h){return this.getPivotPointToRef(h),a.i.TransformCoordinatesToRef(h,this.getWorldMatrix(),h),this}PS(h){if(this._isDirty)return this;if(this._children)for(const d of this._children)d.PS(h);return super.PS(h)}setParent(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!h&&!this.parent)return this;const j=a.d.Quaternion[0],A=a.d.Qd[0],b=a.d.Qd[1],w=a.d.Matrix[1];a.b.IdentityToRef(w);const D=a.d.Matrix[0];this.Zd(!0);let S=this.rotationQuaternion;return S||(S=M._TmpRotation,a.c.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,S)),a.b.ComposeToRef(this.td,S,this.position,D),this.parent&&D.multiplyToRef(this.parent.Zd(!0),D),h&&(h.Zd(!0).invertToRef(w),D.multiplyToRef(w,D)),D.decompose(b,j,A,d?this:void 0),this.rotationQuaternion?this.rotationQuaternion.D(j):j.toEulerAnglesToRef(this.rotation),this.td.D(b),this.position.D(A),this.parent=h,m&&this.setPivotMatrix(a.b.Identity()),this}addChild(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return h.setParent(this,d),this}removeChild(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return h.parent!==this||h.setParent(null,d),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(h){return this._nonUniformScaling!==h&&(this._nonUniformScaling=h,!0)}attachToBone(h,d){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=d,this.parent=h,h.getSkeleton().prepare(!0),h.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=h?this._currentParentWhenAttachingToBone:null,this):(h&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(h,d,m){let j;if(h.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.sd(0)),m&&0!==m){if(this.parent){const m=this.parent.getWorldMatrix(),j=a.d.Matrix[0];m.invertToRef(j),h=a.i.TransformNormal(h,j),m.determinant()<0&&(d*=-1)}j=a.c.RotationAxisToRef(h,d,M._RotationAxisCache),j.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else j=a.c.RotationAxisToRef(h,d,M._RotationAxisCache),this.rotationQuaternion.multiplyToRef(j,this.rotationQuaternion);return this}rotateAround(h,d,m){d.normalize(),this.rotationQuaternion||(this.rotationQuaternion=a.c.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.sd(0));const j=a.d.Qd[0],A=a.d.Qd[1],b=a.d.Qd[2],w=a.d.Quaternion[0],D=a.d.Matrix[0],S=a.d.Matrix[1],M=a.d.Matrix[2],q=a.d.Matrix[3];return h.subtractToRef(this.position,j),a.b.TranslationToRef(j.x,j.y,j.z,D),a.b.TranslationToRef(-j.x,-j.y,-j.z,S),a.b.RotationAxisToRef(d,m,M),S.multiplyToRef(M,q),q.multiplyToRef(D,q),q.decompose(A,w,b),this.position.addInPlace(b),w.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(h,d,m){const j=h.scale(d);if(m&&0!==m)this.setAbsolutePosition(this.getAbsolutePosition().add(j));else{const h=this.getPositionExpressedInLocalSpace().add(j);this.setPositionWithLocalVector(h)}return this}addRotation(h,d,m){let j;this.rotationQuaternion?j=this.rotationQuaternion:(j=a.d.Quaternion[1],a.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,j));const A=a.d.Quaternion[0];return a.c.RotationYawPitchRollToRef(d,h,m,A),j.multiplyInPlace(A),this.rotationQuaternion||j.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==M.BILLBOARDMODE_NONE}Zd(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const m=this.ih().getRenderId();if(!this._isDirty&&!h&&(this._currentRenderId===m||this.isSynchronized()))return this._currentRenderId=m,this._worldMatrix;d=d||this.ih().activeCamera,this._updateCache();const j=this._cache;j.pivotMatrixUpdated=!1,j.billboardMode=this.billboardMode,j.infiniteDistance=this.infiniteDistance,j.parent=this._parentNode,this._currentRenderId=m,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const A=this._getEffectiveParent(),b=M._TmpScaling;let w,D=this._position;if(this._infiniteDistance&&!this.parent&&d){const h=d.getWorldMatrix(),m=new a.i(h.m[12],h.m[13],h.m[14]);D=M._TmpTranslation,D.xd(this._position.x+m.x,this._position.y+m.y,this._position.z+m.z)}if(b.xd(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,w=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(a.c.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.xd(0,0,0))}}else w=M._TmpRotation,a.c.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,w);if(this._usePivotMatrix){const h=a.d.Matrix[1];a.b.ScalingToRef(b.x,b.y,b.z,h);const d=a.d.Matrix[0];w.toRotationMatrix(d),this._pivotMatrix.multiplyToRef(h,a.d.Matrix[4]),a.d.Matrix[4].multiplyToRef(d,this.kE),this._postMultiplyPivotMatrix&&this.kE.multiplyToRef(this._pivotMatrixInverse,this.kE),this.kE.addTranslationFromFloats(D.x,D.y,D.z)}else a.b.ComposeToRef(b,w,D,this.kE);if(A&&A.getWorldMatrix){if(h&&A.Zd(h),this.billboardMode){if(this._transformToBoneReferal){const h=this.parent;h.getSkeleton().prepare(),h.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),a.d.Matrix[7])}else a.d.Matrix[7].D(A.getWorldMatrix());const h=a.d.Qd[5],d=a.d.Qd[6],m=a.d.Quaternion[0];a.d.Matrix[7].decompose(d,m,h),a.b.ScalingToRef(d.x,d.y,d.z,a.d.Matrix[7]),a.d.Matrix[7].setTranslation(h),M.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(m,h),this.kE.setTranslation(h)),this.kE.multiplyToRef(a.d.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const h=this.parent;h.getSkeleton().prepare(),this.kE.multiplyToRef(h.getFinalMatrix(),a.d.Matrix[6]),a.d.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.kE.multiplyToRef(A.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.D(this.kE);if(d&&this.billboardMode)if(j.useBillboardPosition){if(j.useBillboardPosition){const h=a.d.Qd[0];this._worldMatrix.getTranslationToRef(h);const m=d.globalPosition;this._worldMatrix.invertToRef(a.d.Matrix[1]);const j=a.d.Qd[1];a.i.TransformCoordinatesToRef(m,a.d.Matrix[1],j),j.normalize();const A=-Math.atan2(j.z,j.x)+Math.PI/2,b=Math.sqrt(j.x*j.x+j.z*j.z),w=-Math.atan2(j.y,b);if(a.c.RotationYawPitchRollToRef(A,w,0,a.d.Quaternion[0]),(this.billboardMode&M.BILLBOARDMODE_ALL)!==M.BILLBOARDMODE_ALL){const h=a.d.Qd[1];a.d.Quaternion[0].toEulerAnglesToRef(h),(this.billboardMode&M.BILLBOARDMODE_X)!==M.BILLBOARDMODE_X&&(h.x=0),(this.billboardMode&M.BILLBOARDMODE_Y)!==M.BILLBOARDMODE_Y&&(h.y=0),(this.billboardMode&M.BILLBOARDMODE_Z)!==M.BILLBOARDMODE_Z&&(h.z=0),a.b.RotationYawPitchRollToRef(h.y,h.x,h.z,a.d.Matrix[0])}else a.b.FromQuaternionToRef(a.d.Quaternion[0],a.d.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(a.d.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(a.d.Qd[0])}}else{const h=a.d.Qd[0];if(this._worldMatrix.getTranslationToRef(h),a.d.Matrix[1].D(d.getViewMatrix()),a.d.Matrix[1].setTranslationFromFloats(0,0,0),a.d.Matrix[1].invertToRef(a.d.Matrix[0]),(this.billboardMode&M.BILLBOARDMODE_ALL)!==M.BILLBOARDMODE_ALL){a.d.Matrix[0].decompose(void 0,a.d.Quaternion[0],void 0);const h=a.d.Qd[1];a.d.Quaternion[0].toEulerAnglesToRef(h),(this.billboardMode&M.BILLBOARDMODE_X)!==M.BILLBOARDMODE_X&&(h.x=0),(this.billboardMode&M.BILLBOARDMODE_Y)!==M.BILLBOARDMODE_Y&&(h.y=0),(this.billboardMode&M.BILLBOARDMODE_Z)!==M.BILLBOARDMODE_Z&&(h.z=0),a.b.RotationYawPitchRollToRef(h.y,h.x,h.z,a.d.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(a.d.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(a.d.Qd[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):A&&A._nonUniformScaling?this._updateNonUniformScalingState(A._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.xd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=a.b.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Zd(),h){const h=this.getChildren();for(let d=0;d<h.length;++d){const m=h[d];if(m){m.Zd();const h=a.d.Matrix[0];m.kE.multiplyToRef(this.kE,h);const d=a.d.Quaternion[0];h.decompose(m.td,d,m.position),m.rotationQuaternion?m.rotationQuaternion.D(d):d.toEulerAnglesToRef(m.rotation)}}}this.td.xd(1,1,1),this.position.xd(0,0,0),this.rotation.xd(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=a.c.Identity()),this._worldMatrix=a.b.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(h){return this.onAfterWorldMatrixUpdateObservable.add(h),this}unregisterAfterWorldMatrixUpdate(h){return this.onAfterWorldMatrixUpdateObservable.removeCallback(h),this}getPositionInCameraSpace(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return h||(h=this.ih().activeCamera),a.i.TransformCoordinates(this.getAbsolutePosition(),h.getViewMatrix())}getDistanceToCamera(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return h||(h=this.ih().activeCamera),this.getAbsolutePosition().fm(h.globalPosition).length()}clone(h,d,m){const j=b.d.Clone((()=>new M(h,this.ih())),this);if(j.name=h,j.id=h,d&&(j.parent=d),!m){const d=this.getDescendants(!0);for(let m=0;m<d.length;m++){const A=d[m];A.clone&&A.clone(h+"."+A.name,j)}}return j}serialize(h){const d=b.d.Serialize(this,h);return d.type=this.getClassName(),d.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(d),d.localMatrix=this.getPivotMatrix().fd(),d.isEnabled=this.isEnabled(),b.d.AppendSerializedAnimations(this,d),d.ranges=this.serializeAnimationRanges(),d}static Parse(h,d,m){const j=b.d.Parse((()=>new M(h.name,d)),h,d,m);if(h.localMatrix?j.setPreTransformMatrix(a.b.Ud(h.localMatrix)):h.pivotMatrix&&j.setPivotMatrix(a.b.Ud(h.pivotMatrix)),j.jD(h.isEnabled),j._waitingParsedUniqueId=h.uniqueId,void 0!==h.parentId&&(j._waitingParentId=h.parentId),void 0!==h.parentInstanceIndex&&(j._waitingParentInstanceIndex=h.parentInstanceIndex),h.animations){for(let d=0;d<h.animations.length;d++){const m=h.animations[d],A=(0,S.e)("BABYLON.Animation");A&&j.animations.push(A.Parse(m))}D.b.ParseAnimationRanges(j,h,d)}return h.autoAnimate&&d.beginAnimation(j,h.autoAnimateFrom,h.autoAnimateTo,h.autoAnimateLoop,h.autoAnimateSpeed||1),j}getChildTransformNodes(h,d){const m=[];return this._getDescendants(m,h,(h=>(!d||d(h))&&h instanceof M)),m}dispose(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.ih().stopAnimation(this),this.ih().removeTransformNode(this),this._parentContainer){const h=this._parentContainer.transformNodes.indexOf(this);h>-1&&this._parentContainer.transformNodes.splice(h,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),h){const h=this.getChildTransformNodes(!0);for(const d of h)d.parent=null,d.Zd(!0)}super.dispose(h,d)}normalizeToUnitCube(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0,j=null,A=null;d&&(this.rotationQuaternion?(A=this.rotationQuaternion.clone(),this.rotationQuaternion.xd(0,0,0,1)):this.rotation&&(j=this.rotation.clone(),this.rotation.xd(0,0,0)));const b=this.getHierarchyBoundingVectors(h,m),w=b.max.fm(b.min),a=Math.max(w.x,w.y,w.z);if(0===a)return this;const D=1/a;return this.td.scaleInPlace(D),d&&(this.rotationQuaternion&&A?this.rotationQuaternion.D(A):this.rotation&&j&&this.rotation.D(j)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}M.BILLBOARDMODE_NONE=0,M.BILLBOARDMODE_X=1,M.BILLBOARDMODE_Y=2,M.BILLBOARDMODE_Z=4,M.BILLBOARDMODE_ALL=7,M.BILLBOARDMODE_USE_POSITION=128,M.BillboardUseParentOrientation=!1,M._TmpRotation=a.c.Zero(),M._TmpScaling=a.i.Zero(),M._TmpTranslation=a.i.Zero(),M._LookAtVectorCache=new a.i(0,0,0),M._RotationAxisCache=new a.c,(0,j.d)([(0,A.K)("position")],M.prototype,"_position",void 0),(0,j.d)([(0,A.K)("rotation")],M.prototype,"_rotation",void 0),(0,j.d)([(0,A.z)("rotationQuaternion")],M.prototype,"_rotationQuaternion",void 0),(0,j.d)([(0,A.K)("td")],M.prototype,"_scaling",void 0),(0,j.d)([(0,A.M)("billboardMode")],M.prototype,"_billboardMode",void 0),(0,j.d)([(0,A.M)()],M.prototype,"scalingDeterminant",void 0),(0,j.d)([(0,A.M)("infiniteDistance")],M.prototype,"_infiniteDistance",void 0),(0,j.d)([(0,A.M)()],M.prototype,"ignoreNonUniformScaling",void 0),(0,j.d)([(0,A.M)()],M.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11682:(h,d,m)=>{m.d(d,{e:()=>S});var j=m(11058),A=m(11099),b=m(11516),w=m(11065),a=m(11353);class D{constructor(h,d,m,j){this.name=h,this.worldAxisForNormal=d,this.worldAxisForFileX=m,this.worldAxisForFileY=j}}class S{static ConvertCubeMapTextureToSphericalPolynomial(h){var d;if(!h.isCube)return null;null===(d=h.ih())||void 0===d||d.getEngine().flushFramebuffer();const m=h.getSize().width,j=h.readPixels(0,void 0,void 0,!1),A=h.readPixels(1,void 0,void 0,!1);let b,w;h.isRenderTarget?(b=h.readPixels(3,void 0,void 0,!1),w=h.readPixels(2,void 0,void 0,!1)):(b=h.readPixels(2,void 0,void 0,!1),w=h.readPixels(3,void 0,void 0,!1));const a=h.readPixels(4,void 0,void 0,!1),D=h.readPixels(5,void 0,void 0,!1),S=h.gammaSpace;let M=0;return 1!=h.textureType&&2!=h.textureType||(M=1),new Promise((h=>{Promise.all([A,j,b,w,a,D]).then((d=>{let[j,A,b,w,a,D]=d;const q={size:m,right:A,left:j,up:b,down:w,front:a,back:D,format:5,type:M,gammaSpace:S};h(this.ConvertCubeMapToSphericalPolynomial(q))}))}))}static _AreaElement(h,d){return Math.atan2(h*d,Math.sqrt(h*h+d*d+1))}static ConvertCubeMapToSphericalPolynomial(h){const d=new b.b;let m=0;const j=2/h.size,D=j,S=.5*j,M=S-1;for(let b=0;b<6;b++){const q=this._FileFaces[b],E=h[q.name];let I=M;const R=5===h.format?4:3;for(let b=0;b<h.size;b++){let Z=M;for(let D=0;D<h.size;D++){const M=q.worldAxisForFileX.scale(Z).add(q.worldAxisForFileY.scale(I)).add(q.worldAxisForNormal);M.normalize();const L=this._AreaElement(Z-S,I-S)-this._AreaElement(Z-S,I+S)-this._AreaElement(Z+S,I-S)+this._AreaElement(Z+S,I+S);let B=E[b*h.size*R+D*R+0],V=E[b*h.size*R+D*R+1],v=E[b*h.size*R+D*R+2];isNaN(B)&&(B=0),isNaN(V)&&(V=0),isNaN(v)&&(v=0),0===h.type&&(B/=255,V/=255,v/=255),h.gammaSpace&&(B=Math.pow((0,A.Clamp)(B),w.j),V=Math.pow((0,A.Clamp)(V),w.j),v=Math.pow((0,A.Clamp)(v),w.j));const C=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const h=Math.max(B,V,v);if(h>C){const d=C/h;B*=d,V*=d,v*=d}}else B=(0,A.Clamp)(B,0,C),V=(0,A.Clamp)(V,0,C),v=(0,A.Clamp)(v,0,C);const T=new a.d(B,V,v);d.addLight(M,T,L),m+=L,Z+=j}I+=D}}const q=6*(4*Math.PI)/6/m;return d.scaleInPlace(q),d.convertIncidentRadianceToIrradiance(),d.convertIrradianceToLambertianRadiance(),b.d.FromHarmonics(d)}}S._FileFaces=[new D("right",new j.i(1,0,0),new j.i(0,0,-1),new j.i(0,-1,0)),new D("left",new j.i(-1,0,0),new j.i(0,0,1),new j.i(0,-1,0)),new D("up",new j.i(0,1,0),new j.i(1,0,0),new j.i(0,0,1)),new D("down",new j.i(0,-1,0),new j.i(1,0,0),new j.i(0,0,-1)),new D("front",new j.i(0,0,1),new j.i(1,0,0),new j.i(0,-1,0)),new D("back",new j.i(0,0,-1),new j.i(-1,0,0),new j.i(0,-1,0))],S.MAX_HDRI_VALUE=4096,S.PRESERVE_CLAMPED_COLORS=!1},11073:(h,d,m)=>{function j(h,d){const m=[];for(let j=0;j<h;++j)m.push(d());return m}function A(h,d){return j(h,d)}m.d(d,{c:()=>j,e:()=>A,i:()=>w});const b=["push","splice","pop","shift","unshift"];function w(h,d){const m=b.map((m=>function(h,d,m){const j=h[d];if("function"!==typeof j)return null;const A=function(){const j=h.length,b=A.previous.apply(h,arguments);return m(d,j),b};return j.next=A,A.previous=j,h[d]=A,()=>{const m=A.previous;if(!m)return;const j=A.next;j?(m.next=j,j.previous=m):(m.next=void 0,h[d]=m),A.next=void 0,A.previous=void 0}}(h,m,d)));return()=>{for(const h of m)null===h||void 0===h||h()}}},11595:(h,d,m)=>{m.d(d,{e:()=>w});var j=m(11543),A=m(11598);let b=0;const w=h=>{if(!h.environmentBRDFTexture){const d=h.useDelayedTextureLoading;h.useDelayedTextureLoading=!1;const m=h._blockEntityCollection;h._blockEntityCollection=!1;const w=j.e.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+b++,h,!0,!1,j.e.BILINEAR_SAMPLINGMODE);h._blockEntityCollection=m;const a=h.getEngine().getLoadedTexturesCache(),D=a.indexOf(w.getInternalTexture());-1!==D&&a.splice(D,1),w.isRGBD=!0,w.wrapU=j.e.CLAMP_ADDRESSMODE,w.wrapV=j.e.CLAMP_ADDRESSMODE,h.environmentBRDFTexture=w,h.useDelayedTextureLoading=d,A.e.ExpandRGBDTexture(w);const S=h.getEngine().onContextRestoredObservable.add((()=>{w.isRGBD=!0;const d=h.onBeforeRenderObservable.add((()=>{w.isReady()&&(h.onBeforeRenderObservable.remove(d),A.e.ExpandRGBDTexture(w))}))}));h.pd.add((()=>{h.getEngine().onContextRestoredObservable.remove(S)}))}return h.environmentBRDFTexture}},11395:(h,d,m)=>{function j(h,d,m){try{const j=h.next();j.done?d(j):j.value?j.value.then((()=>{j.value=void 0,d(j)}),m):d(j)}catch(j){m(j)}}function A(){let h,d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(m,A,b)=>{const w=performance.now();void 0===h||w-h>d?(h=w,setTimeout((()=>{j(m,A,b)}),0)):j(m,A,b)}}function b(h,d,m,j,A){const b=()=>{let w;const a=h=>{h.done?m(h.value):void 0===w?w=!0:b()};do{w=void 0,A&&A.aborted?j(new Error("Aborted")):d(h,a,j),void 0===w&&(w=!1)}while(w)};b()}function w(h,d){let m;return b(h,j,(h=>m=h),(h=>{throw h}),d),m}async function a(h,d,m){return await new Promise(((j,A)=>{b(h,d,j,A,m)}))}function D(h,d){return function(){return w(h(...arguments),d)}}m.d(d,{e:()=>A,g:()=>D,h:()=>a,l:()=>w})},11269:(h,d,m)=>{m.d(d,{b:()=>b,d:()=>w});const j={},A={};function b(h){const d=h.getClassName();return A[d]||(A[d]={}),A[d]}function w(h){const d=h.getClassName();if(j[d])return j[d];j[d]={};const m=j[d];let b=h,w=d;for(;w;){const h=A[w];for(const A in h)m[A]=h[A];let d,j=!1;do{if(d=Object.getPrototypeOf(b),!d.getClassName){j=!0;break}if(d.getClassName()!==w)break;b=d}while(d);if(j)break;w=d.getClassName(),b=d}return m}},11261:(h,d,m)=>{m.d(d,{D:()=>a,G:()=>M,K:()=>q,M:()=>w,b:()=>b,f:()=>V,i:()=>I,j:()=>D,n:()=>R,p:()=>S,s:()=>Z,v:()=>B,w:()=>E,z:()=>L});var j=m(11269);function A(h,d){return(m,A)=>{const b=(0,j.b)(m);b[A]||(b[A]={type:h,sourceName:d})}}function b(h){return function(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(m,j)=>{const A=d||"_"+j;Object.defineProperty(m,j,{get:function(){return this[A]},set:function(d){var j;"function"===typeof(null===(j=this[A])||void 0===j?void 0:j.equals)&&this[A].equals(d)||this[A]!==d&&(this[A]=d,m[h].apply(this))},enumerable:!0,configurable:!0})}}(h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function w(h){return A(0,h)}function a(h){return A(1,h)}function D(h){return A(2,h)}function S(h){return A(3,h)}function M(h){return A(4,h)}function q(h){return A(5,h)}function E(h){return A(6,h)}function I(h){return A(7,h)}function R(h){return A(8,h)}function Z(h){return A(9,h)}function L(h){return A(10,h)}function B(h){return A(12,h)}function V(h,d,m,j){const A=m.value;m.value=function(){let m=A;if("undefined"!==typeof _native&&_native[d]){const h=_native[d];m=j?function(){return j(...arguments)?h(...arguments):A(...arguments)}:h}return h[d]=m,m(...arguments)}}V.filter=function(h){return(d,m,j)=>V(d,m,j,h)}},11341:(h,d,m)=>{m.d(d,{d:()=>S});var j=m(11137),A=m(11350),b=m(11353),w=m(11058),a=m(11269);const D=function(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const b=h();A.e&&A.e.HasTags(d)&&A.e.AddTagsTo(b,A.e.GetTags(d,!0));const w=(0,a.d)(b),D={};for(const A in w){const h=w[A],a=d[A],M=h.type;if(void 0!==a&&null!==a&&("uniqueId"!==A||S.AllowLoadingUniqueId))switch(M){case 0:case 6:case 9:case 11:b[A]=a;break;case 1:j.cloneTexturesOnlyOnce&&D[a.uniqueId]?b[A]=D[a.uniqueId]:(b[A]=m||a.isRenderTarget?a:a.clone(),D[a.uniqueId]=b[A]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:b[A]=m?a:a.clone()}}return b};class S{static AppendSerializedAnimations(h,d){if(h.animations){d.animations=[];for(let m=0;m<h.animations.length;m++){const j=h.animations[m];d.animations.push(j.serialize())}}}static Serialize(h,d){d||(d={}),A.e&&(d.tags=A.e.GetTags(h));const m=(0,a.d)(h);for(const j in m){const A=m[j],b=A.sourceName||j,w=A.type,a=h[j];if(void 0!==a&&null!==a&&("uniqueId"!==j||S.AllowLoadingUniqueId))switch(w){case 0:d[b]=a;break;case 1:case 3:case 7:case 9:d[b]=a.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:d[b]=a.fd();break;case 6:case 11:d[b]=a.id}}return d}static ParseProperties(h,d,m,j){j||(j="");const A=(0,a.d)(d);for(const a in A){const D=A[a],M=h[D.sourceName||a],q=D.type;if(void 0!==M&&null!==M&&("uniqueId"!==a||S.AllowLoadingUniqueId)){const h=d;switch(q){case 0:h[a]=M;break;case 1:m&&(h[a]=S._TextureParser(M,m,j));break;case 2:h[a]=b.d.Ud(M);break;case 3:h[a]=S._FresnelParametersParser(M);break;case 4:h[a]=w.h.Ud(M);break;case 5:h[a]=w.i.Ud(M);break;case 6:m&&(h[a]=m.getLastMeshById(M));break;case 7:h[a]=S._ColorCurvesParser(M);break;case 8:h[a]=b.f.Ud(M);break;case 9:h[a]=S._ImageProcessingConfigurationParser(M);break;case 10:h[a]=w.c.Ud(M);break;case 11:m&&(h[a]=m.getCameraById(M));break;case 12:h[a]=w.b.Ud(M)}}}}static Parse(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const b=h();return A.e&&A.e.AddTagsTo(b,d.tags),S.ParseProperties(d,b,m,j),b}static Clone(h,d){return D(h,d,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(h,d){return D(h,d,!0)}}S.AllowLoadingUniqueId=!1,S._ImageProcessingConfigurationParser=h=>{throw(0,j.b)("ImageProcessingConfiguration")},S._FresnelParametersParser=h=>{throw(0,j.b)("FresnelParameters")},S._ColorCurvesParser=h=>{throw(0,j.b)("ColorCurves")},S._TextureParser=(h,d,m)=>{throw(0,j.b)("Texture")}},11126:(h,d,m)=>{m.d(d,{e:()=>b});var j=m(11121);const A=(h,d,m)=>h?h.getClassName&&"Mesh"===h.getClassName()?null:!h.getClassName||"SubMesh"!==h.getClassName()&&"PhysicsBody"!==h.getClassName()?h.clone?h.clone():Array.isArray(h)?h.slice():m&&"object"===typeof h?{...h}:null:h.clone(d):null;class b{static DeepCopy(h,d,m,b){let w=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const a=function(h){const d=[];do{const m=Object.getOwnPropertyNames(h);for(const h of m)-1===d.indexOf(h)&&d.push(h)}while(h=Object.getPrototypeOf(h));return d}(h);for(const S of a){if("_"===S[0]&&(!b||-1===b.indexOf(S)))continue;if(S.endsWith("Observable"))continue;if(m&&-1!==m.indexOf(S))continue;const a=h[S],M=typeof a;if("function"!==M)try{if("object"===M)if(a instanceof Uint8Array)d[S]=Uint8Array.from(a);else if(a instanceof Array){if(d[S]=[],a.length>0)if("object"==typeof a[0])for(let h=0;h<a.length;h++){const m=A(a[h],d,w);-1===d[S].indexOf(m)&&d[S].push(m)}else d[S]=a.slice(0)}else d[S]=A(a,d,w);else d[S]=a}catch(D){j.c.Warn(D.message)}}}}},11803:(h,d,m)=>{function j(){const h=h=>!!h&&"object"===typeof h;for(var d=arguments.length,m=new Array(d),A=0;A<d;A++)m[A]=arguments[A];return m.reduce(((d,m)=>{const A=Object.keys(m);for(const b of A){const A=d[b],w=m[b];Array.isArray(A)&&Array.isArray(w)?d[b]=A.concat(...w):h(A)&&h(w)?d[b]=j(A,w):d[b]=w}return d}),{})}m.d(d,{d:()=>j})},11137:(h,d,m)=>{m.d(d,{b:()=>A});const j={};function A(h){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!j[h])return j[h]=!0,`${h} needs to be imported before as it contains a side-effect required by your code.`}},11115:(h,d,m)=>{function j(){return"undefined"!==typeof window}function A(){return"undefined"!==typeof navigator}function b(){return"undefined"!==typeof document}function w(h){let d="",m=h.firstChild;for(;m;)3===m.nodeType&&(d+=m.textContent),m=m.nextSibling;return d}m.d(d,{d:()=>w,f:()=>b,h:()=>A,j:()=>j})},11582:(h,d,m)=>{m.r(d),m.d(d,{Dispose:()=>E,DumpData:()=>q,DumpDataAsync:()=>M,DumpFramebuffer:()=>S,DumpTools:()=>I});var j=m(11561),A=m(11107),b=m(11099),w=m(11094);let a,D=null;async function S(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",b=arguments.length>5?arguments[5]:void 0,w=arguments.length>6?arguments[6]:void 0;const a=await m.readPixels(0,0,h,d);q(h,d,new Uint8Array(a.buffer),j,A,b,!0,void 0,w)}async function M(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",A=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7?arguments[7]:void 0;return await new Promise((D=>{q(h,d,m,(h=>D(h)),j,A,b,w,a)}))}function q(h,d,S,M){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",I=arguments.length>5?arguments[5]:void 0,R=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],L=arguments.length>8?arguments[8]:void 0;(async function(){return D||(D=new Promise(((h,d)=>{let A,b=null;const D={vM:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(m.bind(m,11470)).then((S=>{let{ThinEngine:M}=S;const q=w.b.Instances.length;try{A=new OffscreenCanvas(100,100),b=new M(A,!1,D)}catch(Z){var I;q<w.b.Instances.length&&(null===(I=w.b.Instances.pop())||void 0===I||I.dispose()),A=document.createElement("canvas"),b=new M(A,!1,D)}w.b.Instances.pop(),w.b.OnEnginesDisposedObservable.add((h=>{b&&h!==b&&!b.q&&0===w.b.Instances.length&&E()})),b.getCaps().parallelShaderCompile=void 0;const R=new j.b(b);m.e(37).then(m.bind(m,13384)).then((m=>{let{passPixelShader:w}=m;if(!b)return void d("Engine is not defined");const D=new j.c({sa:b,name:w.name,fragmentShader:w.shader,samplerNames:["textureSampler"]});a={canvas:A,sa:b,renderer:R,wrapper:D},h(a)}))})).catch(d)}))),await D})().then((m=>{if(m.sa.setSize(h,d,!0),S instanceof Float32Array){const h=new Uint8Array(S.length);let d=S.length;for(;d--;){const m=S[d];h[d]=Math.round(255*(0,b.Clamp)(m))}S=h}const j=m.sa.createRawTexture(S,h,d,5,!1,!R,1);m.renderer.setViewport(),m.renderer.applyEffectWrapper(m.wrapper),m.wrapper.effect._bindTexture("textureSampler",j),m.renderer.draw(),Z?A.e.ToBlob(m.canvas,(h=>{const d=new FileReader;d.onload=h=>{const d=h.target.result;M&&M(d)},d.readAsArrayBuffer(h)}),q,L):A.e.EncodeScreenshotCanvasData(m.canvas,M,q,I,L),j.dispose()}))}function E(){var h;a?(a.wrapper.dispose(),a.renderer.dispose(),a.sa.dispose()):null===(h=D)||void 0===h||h.then((h=>{h.wrapper.dispose(),h.renderer.dispose(),h.sa.dispose()}));D=null,a=null}const I={DumpData:q,DumpDataAsync:M,DumpFramebuffer:S,Dispose:E};A.e.DumpData=q,A.e.DumpDataAsync=M,A.e.DumpFramebuffer=S},11154:(h,d,m)=>{m.d(d,{c:()=>j,e:()=>A,i:()=>b});class j extends Error{}j._setPrototypeOf=Object.setPrototypeOf||((h,d)=>(h.__proto__=d,h));const A={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class b extends j{constructor(h,d,m){super(h),this.errorCode=d,this.innerError=m,this.name="RuntimeError",j._setPrototypeOf(this,b.prototype)}}},11150:(h,d,m)=>{m.d(d,{e:()=>k,i:()=>v,m:()=>F,q:()=>H,u:()=>i,s:()=>L,y:()=>o,B:()=>y,C:()=>g,D:()=>C});var j=m(11144),A=m(11115),b=m(11097);class w{}w.FilesToLoad={};var a=m(11154),D=m(11162),S=m(11171),M=m(11094),q=m(11121),E=m(11183),I=m(11175),R=m(11188);const Z=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class L extends a.i{constructor(h,d){super(h,a.e.LoadFileError),this.name="LoadFileError",a.c._setPrototypeOf(this,L.prototype),d instanceof j.c?this.request=d:this.file=d}}class B extends a.i{constructor(h,d){super(h,a.e.RequestFileError),this.request=d,this.name="RequestFileError",a.c._setPrototypeOf(this,B.prototype)}}class V extends a.i{constructor(h,d){super(h,a.e.ReadFileError),this.file=d,this.name="ReadFileError",a.c._setPrototypeOf(this,V.prototype)}}const v={DefaultRetryStrategy:class{static ExponentialBackoff(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(m,j,A)=>0!==j.status||A>=h||-1!==m.indexOf("file:")?-1:Math.pow(2,A)*d}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:h=>h,ScriptBaseUrl:"",ScriptPreprocessUrl:h=>h,CleanUrl:h=>h=h.replace(/#/gm,"%23")},C=(h,d)=>{if((!h||0!==h.indexOf("data:"))&&v.CorsBehavior)if("string"===typeof v.CorsBehavior||v.CorsBehavior instanceof String)d.crossOrigin=v.CorsBehavior;else{const m=v.CorsBehavior(h);m&&(d.crossOrigin=m)}},T={getRequiredSize:null},o=function(h,d,m,A){let b,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",S=arguments.length>5?arguments[5]:void 0,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:M.b.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===q||void 0===q||!q._features.forceBitmapOverHTMLImageElement))return m("LoadImage is only supported in web or BabylonNative environments."),null;let E=!1;h instanceof ArrayBuffer||ArrayBuffer.isView(h)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(b=URL.createObjectURL(new Blob([h],{type:a})),E=!0):b=`data:${a};base64,`+(0,D.p)(h):h instanceof Blob?(b=URL.createObjectURL(h),E=!0):(b=v.CleanUrl(h),b=v.PreprocessUrl(b));const I=d=>{if(m){const j=b||h.toString();m(`Error while trying to load image: ${0===j.indexOf("http")||j.length<=128?j:j.slice(0,128)+"..."}`,d)}};if(null!==q&&void 0!==q&&q._features.forceBitmapOverHTMLImageElement)return i(b,(j=>{q.createImageBitmap(new Blob([j],{type:a}),{premultiplyAlpha:"none",...S}).then((h=>{d(h),E&&URL.revokeObjectURL(b)})).catch((d=>{m&&m("Error while trying to load image: "+h,d)}))}),void 0,A||void 0,!0,((h,d)=>{I(d)})),null;const R=new Image;if(T.getRequiredSize){const d=T.getRequiredSize(h);d.width&&(R.width=d.width),d.height&&(R.height=d.height)}C(b,R);const Z=[],L=()=>{for(const h of Z)h.target.removeEventListener(h.name,h.handler);Z.length=0};Z.push({target:R,name:"load",handler:()=>{L(),d(R),E&&R.src&&URL.revokeObjectURL(R.src)}}),Z.push({target:R,name:"error",handler:h=>{L(),I(h),E&&R.src&&URL.revokeObjectURL(R.src)}}),Z.push({target:document,name:"securitypolicyviolation",handler:h=>{if(h.blockedURI!==R.src||"hZ"===h.disposition)return;L();const d=new Error(`CSP violation of policy ${h.effectiveDirective} ${h.blockedURI}. Current policy is ${h.originalPolicy}`);M.b.UseFallbackTexture=!1,I(d),E&&R.src&&URL.revokeObjectURL(R.src),R.src=""}}),(()=>{for(const h of Z)h.target.addEventListener(h.name,h.handler)})();const B="blob:"===b.substring(0,5),V="data:"===b.substring(0,5),o=()=>{B||V||!j.c.IsCustomRequestAvailable?R.src=b:i(b,((h,d,m)=>{const j=new Blob([h],{type:!a&&m?m:a}),A=URL.createObjectURL(j);E=!0,R.src=A}),void 0,A||void 0,!0,((h,d)=>{I(d)}))},y=()=>{A&&A.loadImage(b,R)};if(!B&&!V&&A&&A.enableTexturesOffline)A.open(y,o);else{if(-1!==b.indexOf("file:")){const h=decodeURIComponent(b.substring(5).toLowerCase());if(w.FilesToLoad[h]&&"undefined"!==typeof URL){try{let d;try{d=URL.createObjectURL(w.FilesToLoad[h])}catch(g){d=URL.createObjectURL(w.FilesToLoad[h])}R.src=d,E=!0}catch(F){R.src=""}return R}}o()}return R},y=(h,d,m,j,A)=>{const w=new FileReader,a={onCompleteObservable:new b.e,abort:()=>w.abort()};return w.onloadend=()=>a.onCompleteObservable.notifyObservers(a),A&&(w.onerror=()=>{A(new V(`Unable to read ${h.name}`,h))}),w.onload=h=>{d(h.target.result)},m&&(w.onprogress=m),j?w.readAsArrayBuffer(h):w.readAsText(h),a},i=(h,d,m,j,A,D,S)=>{if(h.name)return y(h,d,m,A,D?h=>{D(void 0,h)}:void 0);const M=h;if(-1!==M.indexOf("file:")){let h=decodeURIComponent(M.substring(5).toLowerCase());0===h.indexOf("./")&&(h=h.substring(2));const j=w.FilesToLoad[h];if(j)return y(j,d,m,A,D?h=>D(void 0,new L(h.message,h.file)):void 0)}const{match:I,type:R}=c(M);if(I){const h={onCompleteObservable:new b.e,abort:()=>()=>{}};try{const h=A?k(M):l(M);d(h,void 0,R)}catch(a){D?D(void 0,a):q.c.Error(a.message||"Failed to parse the Data URL")}return E.c.SetImmediate((()=>{h.onCompleteObservable.notifyObservers(h)})),h}return g(M,((h,m)=>{d(h,null===m||void 0===m?void 0:m.responseURL,null===m||void 0===m?void 0:m.getResponseHeader("content-type"))}),m,j,A,D?h=>{D(h.request,new L(h.message,h.request))}:void 0,S)},g=(h,d,m,w,a,D,S)=>{h=v.CleanUrl(h),h=v.PreprocessUrl(h);const M=v.BaseUrl+h;let E=!1;const I={onCompleteObservable:new b.e,abort:()=>E=!0},R=()=>{let h,b=new j.c,w=null;const R=()=>{b&&(m&&b.removeEventListener("progress",m),h&&b.removeEventListener("readystatechange",h),b.removeEventListener("loadend",Z))};let Z=()=>{R(),I.onCompleteObservable.notifyObservers(I),I.onCompleteObservable.clear(),m=void 0,h=null,Z=null,D=void 0,S=void 0,d=void 0};I.abort=()=>{E=!0,Z&&Z(),b&&b.readyState!==(XMLHttpRequest.DONE||4)&&b.abort(),null!==w&&(clearTimeout(w),w=null),b=null};const L=h=>{const d=h.message||"Unknown error";D&&b?D(new B(d,b)):q.c.Error(d)},V=q=>{if(b){if(b.open("GET",M),S)try{S(b)}catch(I){return void L(I)}a&&(b.responseType="arraybuffer"),m&&b.addEventListener("progress",m),Z&&b.addEventListener("loadend",Z),h=()=>{if(!E&&b&&b.readyState===(XMLHttpRequest.DONE||4)){if(h&&b.removeEventListener("readystatechange",h),b.status>=200&&b.status<300||0===b.status&&(!(0,A.j)()||f())){const h=a?b.response:b.responseText;if(null!==h){try{d&&d(h,b)}catch(I){L(I)}return}}const m=v.DefaultRetryStrategy;if(m){const h=m(M,b,q);if(-1!==h)return R(),b=new j.c,void(w=setTimeout((()=>V(q+1)),h))}const S=new B("Error status: "+b.status+" "+b.statusText+" - Unable to load "+M,b);D&&D(S)}},b.addEventListener("readystatechange",h),b.send()}};V(0)};if(w&&w.enableSceneOffline){const j=h=>{h&&h.status>400?D&&D(h):R()},A=()=>{w&&w.loadFile(v.BaseUrl+h,(h=>{!E&&d&&d(h),I.onCompleteObservable.notifyObservers(I)}),m?h=>{!E&&m&&m(h)}:void 0,j,a)};w.open(A,j)}else R();return I},F=h=>{const{match:d,type:m}=c(h);if(d)return m||void 0;const j=h.lastIndexOf(".");switch(h.substring(j+1).toLowerCase()){case"glb":return"model/gltf-binary";case"bin":return"application/octet-stream";case"mb":return"model/gltf+json";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";default:return}},f=()=>"undefined"!==typeof location&&"file:"===location.protocol,H=h=>Z.test(h),c=h=>{const d=Z.exec(h);if(null===d||0===d.length)return{match:!1,type:""};return{match:!0,type:d[0].replace("data:","").replace("base64,","")}};function k(h){return(0,D.e)(h.split(",")[1])}const l=h=>(0,D.h)(h.split(",")[1]);let K;R.b._FileToolsLoadImage=o,I.e.loadFile=i,S.j.loadFile=i;((h,d,m,j,A,b,w,a,D,S)=>{K={DecodeBase64UrlToBinary:h,DecodeBase64UrlToString:d,DefaultRetryStrategy:m.DefaultRetryStrategy,BaseUrl:m.BaseUrl,CorsBehavior:m.CorsBehavior,PreprocessUrl:m.PreprocessUrl,IsBase64DataUrl:j,IsFileURL:A,LoadFile:b,LoadImage:w,ReadFile:a,RequestFile:D,SetCorsBehavior:S},Object.defineProperty(K,"DefaultRetryStrategy",{get:function(){return m.DefaultRetryStrategy},set:function(h){m.DefaultRetryStrategy=h}}),Object.defineProperty(K,"BaseUrl",{get:function(){return m.BaseUrl},set:function(h){m.BaseUrl=h}}),Object.defineProperty(K,"PreprocessUrl",{get:function(){return m.PreprocessUrl},set:function(h){m.PreprocessUrl=h}}),Object.defineProperty(K,"CorsBehavior",{get:function(){return m.CorsBehavior},set:function(h){m.CorsBehavior=h}})})(k,l,v,H,f,i,o,y,g,C)},11245:(h,d,m)=>{function j(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(h=>{const d=16*Math.random()|0;return("x"===h?d:3&d|8).toString(16)}))}m.d(d,{d:()=>j})},11238:(h,d,m)=>{m.d(d,{e:()=>b});var j=m(11121),A=m(11080);class b{static Instantiate(h){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[h])return this.RegisteredExternalClasses[h];const d=(0,A.e)(h);if(d)return d;j.c.Warn(h+" not found, you may have missed an import.");const m=h.split(".");let b=window||this;for(let j=0,A=m.length;j<A;j++)b=b[m[j]];return"function"!==typeof b?null:b}}b.RegisteredExternalClasses={}},11121:(h,d,m)=>{m.d(d,{c:()=>j});class j{static _CheckLimit(h,d){let m=j._LogLimitOutputs[h];return m?m.current++:(m={limit:d,current:1},j._LogLimitOutputs[h]=m),m.current<=m.limit}static _GenerateLimitMessage(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const m=j._LogLimitOutputs[h];if(!m||!j.MessageLimitReached)return;const A=this._Levels[d];m.current===m.limit&&j[A.name](j.MessageLimitReached.replace(/%LIMIT%/g,""+m.limit).replace(/%TYPE%/g,A.name??""))}static _AddLogEntry(h){j._LogCache=h+j._LogCache,j.OnNewCacheEntry&&j.OnNewCacheEntry(h)}static _FormatMessage(h){const d=h=>h<10?"0"+h:""+h,m=new Date;return"["+d(m.getHours())+":"+d(m.getMinutes())+":"+d(m.getSeconds())+"]: "+h}static _LogDisabled(h,d){}static _LogEnabled(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0;const A=Array.isArray(d)?d[0]:d;if(void 0!==m&&!j._CheckLimit(A,m))return;const b=j._FormatMessage(A),w=this._Levels[h],a=Array.isArray(d)?d.slice(1):[];w.logFunc&&w.logFunc("BJS - "+b,...a);const D=`<div style='color:${w.color}'>${b}</div><br>`;j._AddLogEntry(D),j._GenerateLimitMessage(A,h)}static get LogCache(){return j._LogCache}static ClearLogCache(){j._LogCache="",j._LogLimitOutputs={},j.errorsCount=0}static set LogLevels(h){j.Log=j._LogDisabled,j.Warn=j._LogDisabled,j.Error=j._LogDisabled;const d=[j.MessageLogLevel,j.WarningLogLevel,j.ErrorLogLevel];for(const m of d)if((h&m)===m){const h=this._Levels[m];j[h.name]=j._LogEnabled.bind(j,m)}}}j.NoneLogLevel=0,j.MessageLogLevel=1,j.WarningLogLevel=2,j.ErrorLogLevel=4,j.AllLogLevel=7,j.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",j._LogCache="",j._LogLimitOutputs={},j._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],j.errorsCount=0,j.Log=j._LogEnabled.bind(j,j.MessageLogLevel),j.Warn=j._LogEnabled.bind(j,j.WarningLogLevel),j.Error=j._LogEnabled.bind(j,j.ErrorLogLevel)},11097:(h,d,m)=>{m.d(d,{e:()=>w});const j="undefined"!==typeof WeakRef;class A{constructor(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0,j=arguments.length>3?arguments[3]:void 0;this.initialize(h,d,m,j)}initialize(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0,j=arguments.length>3?arguments[3]:void 0;return this.mask=h,this.skipNextObservers=d,this.target=m,this.currentTarget=j,this}}class b{constructor(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=h,this.mask=d,this.scope=m,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(h)}}class w{static FromPromise(h,d){const m=new w;return h.then((h=>{m.notifyObservers(h)})).catch((h=>{if(!d)throw h;d.notifyObservers(h)})),m}get observers(){return this._observers}constructor(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=d,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new A(0),h&&(this._onObserverAdded=h)}add(h){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!h)return null;const A=new b(h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);A.unregisterOnNextCall=m,d?this._observers.unshift(A):this._observers.push(A),this._onObserverAdded&&this._onObserverAdded(A),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(A,this._lastNotifiedValue);const w=j?new WeakRef(this):{deref:()=>this};return A._remove=function(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d=w.deref();d&&(h?d.remove(A):d._remove(A))},A}addOnce(h){return this.add(h,void 0,void 0,void 0,!0)}remove(h){if(!h)return!1;h._remove=null;return-1!==this._observers.indexOf(h)&&(this._deferUnregister(h),!0)}removeCallback(h,d){for(let m=0;m<this._observers.length;m++){const j=this._observers[m];if(!j._willBeUnregistered&&(j.callback===h&&(!d||d===j.scope)))return this._deferUnregister(j),!0}return!1}_deferUnregister(h){h._willBeUnregistered||(this._numObserversMarkedAsDeleted++,h.unregisterOnNextCall=!1,h._willBeUnregistered=!0,setTimeout((()=>{this._remove(h)}),0))}_remove(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!h)return!1;const m=this._observers.indexOf(h);return-1!==m&&(d&&this._numObserversMarkedAsDeleted--,this._observers.splice(m,1),!0)}makeObserverTopPriority(h){this._remove(h,!1),this._observers.unshift(h)}makeObserverBottomPriority(h){this._remove(h,!1),this._observers.push(h)}notifyObservers(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,m=arguments.length>2?arguments[2]:void 0,j=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=h),!this._observers.length)return!0;const b=this._eventState;b.mask=d,b.target=m,b.currentTarget=j,b.skipNextObservers=!1,b.lastReturnValue=h,b.userInfo=A;for(const w of this._observers)if(!w._willBeUnregistered&&(w.mask&d&&(w.unregisterOnNextCall&&this._deferUnregister(w),w.scope?b.lastReturnValue=w.callback.apply(w.scope,[h,b]):b.lastReturnValue=w.callback(h,b)),b.skipNextObservers))return!1;return!0}notifyObserver(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=d),h._willBeUnregistered)return;const j=this._eventState;j.mask=m,j.skipNextObservers=!1,h.unregisterOnNextCall&&this._deferUnregister(h),h.callback(d,j)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const h=this._observers.pop();h&&(h._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const h=new w;return h._observers=this._observers.slice(0),h}hasSpecificMask(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const d of this._observers)if(d.mask&h||d.mask===h)return!0;return!1}}},11536:(h,d,m)=>{m.d(d,{b:()=>A});var j=m(11132);class A{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(h,d){A.Enabled&&(this._current+=h,d&&this._fetchResult())}beginMonitoring(){A.Enabled&&(this._startMonitoringTime=j.b.Now)}endMonitoring(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!A.Enabled)return;h&&this.fetchNewFrame();const d=j.b.Now;this._current=d-this._startMonitoringTime,h&&this._fetchResult()}Pq(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const h=j.b.Now;h-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=h,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}A.Enabled=!0},11132:(h,d,m)=>{m.d(d,{b:()=>A});var j=m(11115);class A{static get Now(){return(0,j.j)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},11598:(h,d,m)=>{m.d(d,{e:()=>b});var j=m(11559),A=m(11538);class b{static ExpandRGBDTexture(h){const d=h._texture;if(!d||!h.isRGBD)return;const A=d.getEngine(),b=A.getCaps(),w=d.isReady;let a=!1;b.textureHalfFloatRender&&b.textureHalfFloatLinearFiltering?(a=!0,d.type=2):b.textureFloatRender&&b.textureFloatLinearFiltering&&(a=!0,d.type=1),a&&(d.isReady=!1,d._isRGBD=!1,d.invertY=!1);const D=async()=>{const b=A.isWebGPU,w=b?1:0;d.isReady=!1,b?await m.e(21).then(m.bind(m,13424)):await m.e(14).then(m.bind(m,13433));const a=new j.e("rgbdDecode","rgbdDecode",null,null,1,null,3,A,!1,void 0,d.type,void 0,null,!1,void 0,w);a.externalTextureSamplerBinding=!0;const D=A.createRenderTargetTexture(d.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:d.samplingMode,type:d.type,format:5});a.onEffectCreatedObservable.addOnce((m=>{m.executeWhenCompiled((()=>{a.onApply=h=>{h._bindTexture("textureSampler",d),h.setFloat2("scale",1,1)},h.ih().postProcessManager.directRender([a],D,!0),A.restoreDefaultFramebuffer(),A._releaseTexture(d),a&&a.dispose(),D._swapAndDie(d),d.isReady=!0}))}))};a&&(w?D():h.onLoadObservable.addOnce(D))}static async EncodeTextureToRGBD(h,d){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return d.getEngine().isWebGPU?await m.e(22).then(m.bind(m,13437)):await m.e(15).then(m.bind(m,13435)),await(0,A.e)("rgbdEncode",h,d,j,1,5)}}},11430:(h,d,m)=>{m.d(d,{c:()=>A,e:()=>j});class j{constructor(h){this.length=0,this.data=new Array(h),this._id=j._GlobalId++}push(h){this.data[this.length++]=h,this.length>this.data.length&&(this.data.length*=2)}forEach(h){for(let d=0;d<this.length;d++)h(this.data[d])}sort(h){this.data.sort(h)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(h){if(0!==h.length){this.length+h.length>this.data.length&&(this.data.length=2*(this.length+h.length));for(let d=0;d<h.length;d++)this.data[this.length++]=(h.data||h)[d]}}indexOf(h){const d=this.data.indexOf(h);return d>=this.length?-1:d}contains(h){return-1!==this.indexOf(h)}}j._GlobalId=0;class A extends j{constructor(){super(...arguments),this._duplicateId=0}push(h){super.push(h),h.__smartArrayFlags||(h.__smartArrayFlags={}),h.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(h){return(!h.__smartArrayFlags||h.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(h),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(h){if(0!==h.length){this.length+h.length>this.data.length&&(this.data.length=2*(this.length+h.length));for(let d=0;d<h.length;d++){const m=(h.data||h)[d];this.pushNoDuplicate(m)}}}}},11162:(h,d,m)=>{m.d(d,{e:()=>w,h:()=>b,l:()=>j,p:()=>A});const j=h=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(h);let d="";for(let m=0;m<h.byteLength;m++)d+=String.fromCharCode(h[m]);return d},A=h=>{const d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let m,j,A,b,w,a,D,S="",M=0;const q=ArrayBuffer.isView(h)?new Uint8Array(h.buffer,h.byteOffset,h.byteLength):new Uint8Array(h);for(;M<q.length;)m=q[M++],j=M<q.length?q[M++]:Number.NaN,A=M<q.length?q[M++]:Number.NaN,b=m>>2,w=(3&m)<<4|j>>4,a=(15&j)<<2|A>>6,D=63&A,isNaN(j)?a=D=64:isNaN(A)&&(D=64),S+=d.charAt(b)+d.charAt(w)+d.charAt(a)+d.charAt(D);return S},b=h=>atob(h),w=h=>{const d=b(h),m=d.length,j=new Uint8Array(new ArrayBuffer(m));for(let A=0;A<m;A++)j[A]=d.charCodeAt(A);return j.buffer}},11350:(h,d,m)=>{m.d(d,{e:()=>A});class j{static Eval(h,d){return"true"===(h=h.match(/\([^()]*\)/g)?h.replace(/\([^()]*\)/g,(h=>(h=h.slice(1,h.length-1),j._HandleParenthesisContent(h,d)))):j._HandleParenthesisContent(h,d))||"false"!==h&&j.Eval(h,d)}static _HandleParenthesisContent(h,d){let m;d=d||(h=>"true"===h);const A=h.split("||");for(const b in A)if(Object.prototype.hasOwnProperty.call(A,b)){let h=j._SimplifyNegation(A[b].trim());const w=h.split("&&");if(w.length>1)for(let A=0;A<w.length;++A){const b=j._SimplifyNegation(w[A].trim());if(m="true"!==b&&"false"!==b?"!"===b[0]?!d(b.substring(1)):d(b):"true"===b,!m){h="false";break}}if(m||"true"===h){m=!0;break}m="true"!==h&&"false"!==h?"!"===h[0]?!d(h.substring(1)):d(h):"true"===h}return m?"true":"false"}static _SimplifyNegation(h){return"!true"===(h=(h=h.replace(/^[\s!]+/,(h=>(h=h.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?h="false":"!false"===h&&(h="true"),h}}class A{static EnableFor(h){h._tags=h._tags||{},h.hasTags=()=>A.HasTags(h),h.addTags=d=>A.AddTagsTo(h,d),h.removeTags=d=>A.RemoveTagsFrom(h,d),h.matchesTagsQuery=d=>A.MatchesQuery(h,d)}static DisableFor(h){delete h._tags,delete h.hasTags,delete h.addTags,delete h.removeTags,delete h.matchesTagsQuery}static HasTags(h){if(!h._tags)return!1;const d=h._tags;for(const m in d)if(Object.prototype.hasOwnProperty.call(d,m))return!0;return!1}static GetTags(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!h._tags)return null;if(d){const d=[];for(const m in h._tags)Object.prototype.hasOwnProperty.call(h._tags,m)&&!0===h._tags[m]&&d.push(m);return d.join(" ")}return h._tags}static AddTagsTo(h,d){if(!d)return;if("string"!==typeof d)return;const m=d.split(" ");for(const j of m)A._AddTagTo(h,j)}static _AddTagTo(h,d){""!==(d=d.trim())&&"true"!==d&&"false"!==d&&(d.match(/[\s]/)||d.match(/^([!]|([|]|[&]){2})/)||(A.EnableFor(h),h._tags[d]=!0))}static RemoveTagsFrom(h,d){if(!A.HasTags(h))return;const m=d.split(" ");for(const j in m)A._RemoveTagFrom(h,m[j])}static _RemoveTagFrom(h,d){delete h._tags[d]}static MatchesQuery(h,d){return void 0===d||(""===d?A.HasTags(h):j.Eval(d,(d=>A.HasTags(h)&&h._tags[d])))}}},11538:(h,d,m)=>{m.d(d,{e:()=>B,f:()=>T,g:()=>y,j:()=>i,k:()=>C});var j=m(11543),A=m(11548),b=m(11258),w=m(11559),a=m(11188),D=m(11080),S=m(11341),M=m(11561),q=m(11463);class E extends M.c{_gatherImports(h,d){h?(this._webGPUReady=!0,d.push(Promise.all([m.e(36).then(m.bind(m,13380))]))):d.push(Promise.all([m.e(37).then(m.bind(m,13384))])),super._gatherImports(h,d)}constructor(h){super({...arguments.length>2?arguments[2]:void 0,name:h,sa:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||q.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:E.FragmentUrl})}}E.FragmentUrl="pass";class I extends M.c{_gatherImports(h,d){h?(this._webGPUReady=!0,d.push(Promise.all([m.e(43).then(m.bind(m,13416))]))):d.push(Promise.all([m.e(44).then(m.bind(m,13419))])),super._gatherImports(h,d)}constructor(h){super({...arguments.length>2?arguments[2]:void 0,name:h,sa:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||q.b.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:I.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(h){if(!(h<0||h>5))switch(this._face=h,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}}}I.FragmentUrl="passCube";var R=m(11261);class Z extends w.e{getClassName(){return"PassPostProcess"}constructor(h,d){let m=arguments.length>4?arguments[4]:void 0;const j={size:"number"===typeof d?d:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,sa:m,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...d};super(h,E.FragmentUrl,{effectWrapper:"number"!==typeof d&&d.effectWrapper?void 0:new E(h,m,j),...j})}static _Parse(h,d,m,j){return S.d.Parse((()=>new Z(h.name,h.options,d,h.renderTargetSamplingMode,h._engine,h.reusable)),h,m,j)}}(0,D.i)("BABYLON.PassPostProcess",Z);class L extends w.e{get face(){return this._effectWrapper.face}set face(h){this._effectWrapper.face=h}getClassName(){return"PassCubePostProcess"}constructor(h,d){let m=arguments.length>4?arguments[4]:void 0;const j={size:"number"===typeof d?d:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,sa:m,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...d};super(h,E.FragmentUrl,{effectWrapper:"number"!==typeof d&&d.effectWrapper?void 0:new I(h,m,j),...j})}static _Parse(h,d,m,j){return S.d.Parse((()=>new L(h.name,h.options,d,h.renderTargetSamplingMode,h._engine,h.reusable)),h,m,j)}}function B(h,d,m,j,A,b,a,D){const S=d.getEngine();return d.isReady=!1,A=A??d.samplingMode,j=j??d.type,b=b??d.format,a=a??d.width,D=D??d.height,-1===j&&(j=0),new Promise((M=>{const q=new w.e("postprocess",h,null,null,1,null,A,S,!1,void 0,j,void 0,null,!1,b);q.externalTextureSamplerBinding=!0;const E=S.createRenderTargetTexture({width:a,height:D},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:A,type:j,format:b});q.onEffectCreatedObservable.addOnce((h=>{h.executeWhenCompiled((()=>{q.onApply=h=>{h._bindTexture("textureSampler",d),h.setFloat2("scale",1,1)},m.postProcessManager.directRender([q],E,!0),S.restoreDefaultFramebuffer(),S._releaseTexture(d),q&&q.dispose(),E._swapAndDie(d),d.type=j,d.format=5,d.isReady=!0,M(d)}))}))}))}let V,v;function C(h){V||(V=new Float32Array(1),v=new Int32Array(V.buffer)),V[0]=h;const d=v[0];let m=d>>16&32768,j=d>>12&2047;const A=d>>23&255;return A<103?m:A>142?(m|=31744,m|=(255==A?0:1)&&8388607&d,m):A<113?(j|=2048,m|=(j>>114-A)+(j>>113-A&1),m):(m|=A-112<<10|j>>1,m+=1&j,m)}function T(h){const d=(32768&h)>>15,m=(31744&h)>>10,j=1023&h;return 0===m?(d?-1:1)*Math.pow(2,-14)*(j/Math.pow(2,10)):31==m?j?NaN:1/0*(d?-1:1):(d?-1:1)*Math.pow(2,m-15)*(1+j/Math.pow(2,10))}(0,b.d)([(0,R.M)()],L.prototype,"face",null),a.b._RescalePostProcessFactory=h=>new Z("rescale",1,null,2,h,!1,0);const o=async(h,d,b,a,D)=>{const S=h.ih(),M=S.getEngine();let q;if(M.isWebGPU?h.isCube?await m.e(40).then(m.bind(m,13401)):await m.e(41).then(m.bind(m,13408)):h.isCube?await m.e(38).then(m.bind(m,13391)):await m.e(39).then(m.bind(m,13397)),h.isCube){const h=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"];q=new w.e("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:j.e.NEAREST_NEAREST_MIPNEAREST,sa:M,defines:h[a],shaderLanguage:M.isWebGPU?1:0})}else q=new w.e("lod","lod",{uniforms:["lod","gamma"],samplingMode:j.e.NEAREST_NEAREST_MIPNEAREST,sa:M,shaderLanguage:M.isWebGPU?1:0});await new Promise((h=>{q.onEffectCreatedObservable.addOnce((d=>{d.executeWhenCompiled((()=>{h(0)}))}))}));const E=new A.e("temp",{width:d,height:b},S,!1);q.onApply=function(d){d.setTexture("textureSampler",h),d.setFloat("lod",D),d.setInt("gamma",h.gammaSpace?1:0)};const I=h.getInternalTexture();try{if(E.renderTarget&&I){const m=I.samplingMode;0!==D?h.updateSamplingMode(j.e.NEAREST_NEAREST_MIPNEAREST):h.updateSamplingMode(j.e.NEAREST_NEAREST),S.postProcessManager.directRender([q],E.renderTarget,!0),h.updateSamplingMode(m);const A=await M.readPixels(0,0,d,b),w=new Uint8Array(A.buffer,0,A.byteLength);return M.unBindFramebuffer(E.renderTarget),w}throw Error("Render to texture failed.")}finally{E.dispose(),q.dispose()}};async function y(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!h.isReady()&&h._texture&&await new Promise(((d,m)=>{null!==h._texture?h._texture.onLoadedObservable.addOnce((()=>{d(0)})):m(0)})),await o(h,d,m,j,A)}const i={CreateResizedCopy:function(h,d,m){let b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const w=h.ih(),a=w.getEngine(),D=new A.e("resized"+h.name,{width:d,height:m},w,!h.noMipmap,!0,h._texture.type,!1,h.samplingMode,!1);D.wrapU=h.wrapU,D.wrapV=h.wrapV,D.uOffset=h.uOffset,D.vOffset=h.vOffset,D.uScale=h.uScale,D.vScale=h.vScale,D.uAng=h.uAng,D.vAng=h.vAng,D.wAng=h.wAng,D.coordinatesIndex=h.coordinatesIndex,D.level=h.level,D.anisotropicFilteringLevel=h.anisotropicFilteringLevel,D._texture.isReady=!1,h.wrapU=j.e.CLAMP_ADDRESSMODE,h.wrapV=j.e.CLAMP_ADDRESSMODE;const S=new Z("pass",1,null,b?j.e.BILINEAR_SAMPLINGMODE:j.e.NEAREST_SAMPLINGMODE,a,!1,0);return S.externalTextureSamplerBinding=!0,S.onEffectCreatedObservable.addOnce((d=>{d.executeWhenCompiled((()=>{S.onApply=function(d){d.setTexture("textureSampler",h)};const d=D.renderTarget;d&&(w.postProcessManager.directRender([S],d),a.unBindFramebuffer(d),D.disposeFramebufferObjects(),S.dispose(),D.getInternalTexture().isReady=!0)}))})),D},ApplyPostProcess:B,ToHalfFloat:C,FromHalfFloat:T,GetTextureDataAsync:y}},11183:(h,d,m)=>{m.d(d,{c:()=>A,d:()=>w});let j=[];class A{static SetImmediate(h){0===j.length&&setTimeout((()=>{const h=j;j=[];for(const d of h)d()}),1),j.push(h)}}function b(h,d,m){try{if(h())return d(),!0}catch(j){return null===m||void 0===m||m(j),!0}return!1}const w=function(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,w=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&b(h,d,m))return null;const a=setInterval((()=>{b(h,d,m)?clearInterval(a):(A-=j,A<0&&(clearInterval(a),null===m||void 0===m||m(new Error("Operation timed out after maximum retries. "+(w||"")),!0)))}),j);return()=>clearInterval(a)}},11248:(h,d,m)=>{function j(h){let d=1;do{d*=2}while(d<h);return d===h}function A(h,d,m){return h*(1-m)+d*m}function b(h){const d=w(h),m=a(h);return d-h>h-m?m:d}function w(h){return h--,h|=h>>1,h|=h>>2,h|=h>>4,h|=h>>8,h|=h>>16,++h}function a(h){return h|=h>>1,h|=h>>2,h|=h>>4,h|=h>>8,(h|=h>>16)-(h>>1)}function D(h,d){let m;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:m=a(h);break;case 2:m=b(h);break;default:m=w(h)}return Math.min(m,d)}m.d(d,{c:()=>a,f:()=>D,g:()=>j,k:()=>A,m:()=>b})},11107:(h,d,m)=>{m.d(d,{d:()=>B,e:()=>L});var j=m(11097),A=m(11115),b=m(11121),w=m(11126),a=m(11132),D=m(11137),S=m(11144),M=m(11094),q=m(11150),E=m(11183),I=m(11238),R=m(11245),Z=m(11248);class L{static get BaseUrl(){return q.i.BaseUrl}static set BaseUrl(h){q.i.BaseUrl=h}static get CleanUrl(){return q.i.CleanUrl}static set CleanUrl(h){q.i.CleanUrl=h}static IsAbsoluteUrl(h){return 0===h.indexOf("//")||-1!==h.indexOf("://")&&(-1!==h.indexOf(".")&&(-1!==h.indexOf("/")&&(!(h.indexOf(":")>h.indexOf("/"))&&(h.indexOf("://")<h.indexOf(".")||(0===h.indexOf("data:")||0===h.indexOf("blob:"))))))}static set ScriptBaseUrl(h){q.i.ScriptBaseUrl=h}static get ScriptBaseUrl(){return q.i.ScriptBaseUrl}static set CDNBaseUrl(h){L.ScriptBaseUrl=h,L.AssetBaseUrl=h}static set ScriptPreprocessUrl(h){q.i.ScriptPreprocessUrl=h}static get ScriptPreprocessUrl(){return q.i.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return q.i.DefaultRetryStrategy}static set DefaultRetryStrategy(h){q.i.DefaultRetryStrategy=h}static get CorsBehavior(){return q.i.CorsBehavior}static set CorsBehavior(h){q.i.CorsBehavior=h}static get UseFallbackTexture(){return M.b.UseFallbackTexture}static set UseFallbackTexture(h){M.b.UseFallbackTexture=h}static get RegisteredExternalClasses(){return I.e.RegisteredExternalClasses}static set RegisteredExternalClasses(h){I.e.RegisteredExternalClasses=h}static get fallbackTexture(){return M.b.FallbackTexture}static set fallbackTexture(h){M.b.FallbackTexture=h}static FetchToRef(h,d,m,j,A,b){const w=4*((Math.abs(h)*m%m|0)+(Math.abs(d)*j%j|0)*m);b.r=A[w]/255,b.g=A[w+1]/255,b.b=A[w+2]/255,b.a=A[w+3]/255}static Mix(h,d,m){return 0}static Instantiate(h){return I.e.Instantiate(h)}static SetImmediate(h){E.c.SetImmediate(h)}static IsExponentOfTwo(h){return!0}static FloatRound(h){return Math.fround(h)}static GetFilename(h){const d=h.lastIndexOf("/");return d<0?h:h.substring(d+1)}static GetFolderPath(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const m=h.lastIndexOf("/");return m<0?d?h:"":h.substring(0,m+1)}static ToDegrees(h){return 180*h/Math.PI}static ToRadians(h){return h*Math.PI/180}static SmoothAngleChange(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const j=this.ToRadians(h),A=this.ToRadians(d);return this.ToDegrees(Math.atan2((1-m)*Math.sin(A)+m*Math.sin(j),(1-m)*Math.cos(A)+m*Math.cos(j)))}static MakeArray(h,d){return!0===d||void 0!==h&&null!=h?Array.isArray(h)?h:[h]:null}static GetPointerPrefix(h){return(0,A.j)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(h,d){(0,q.D)(h,d)}static SetReferrerPolicyBehavior(h,d){d.referrerPolicy=h}static get PreprocessUrl(){return q.i.PreprocessUrl}static set PreprocessUrl(h){q.i.PreprocessUrl=h}static LoadImage(h,d,m,j,A,b){return(0,q.y)(h,d,m,j,A,b)}static LoadFile(h,d,m,j,A,b){return(0,q.u)(h,d,m,j,A,b)}static async LoadFileAsync(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return await new Promise(((m,j)=>{(0,q.u)(h,(h=>{m(h)}),void 0,void 0,d,((h,d)=>{j(d)}))}))}static GetAssetUrl(h){if(!h)return"";if(L.AssetBaseUrl&&h.startsWith(L._DefaultAssetsUrl)){const d="/"===L.AssetBaseUrl[L.AssetBaseUrl.length-1]?L.AssetBaseUrl.substring(0,L.AssetBaseUrl.length-1):L.AssetBaseUrl;return h.replace(L._DefaultAssetsUrl,d)}return h}static GetBabylonScriptURL(h,d){if(!h)return"";if(L.ScriptBaseUrl&&h.startsWith(L._DefaultCdnUrl)){const d="/"===L.ScriptBaseUrl[L.ScriptBaseUrl.length-1]?L.ScriptBaseUrl.substring(0,L.ScriptBaseUrl.length-1):L.ScriptBaseUrl;h=h.replace(L._DefaultCdnUrl,d)}return h=L.ScriptPreprocessUrl(h),d&&(h=L.GetAbsoluteUrl(h)),h}static LoadBabylonScript(h,d,m,j){h=L.GetBabylonScriptURL(h),L.LoadScript(h,d,m)}static async LoadBabylonScriptAsync(h){return h=L.GetBabylonScriptURL(h),await L.LoadScriptAsync(h)}static LoadScript(h,d,m,j){let b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(h),d&&d()}catch(D){null===m||void 0===m||m(`Unable to load script '${h}' in worker`,D)}return}if(!(0,A.j)())return void(null===m||void 0===m||m(`Cannot load script '${h}' outside of a window or a worker`));const w=document.getElementsByTagName("head")[0],a=document.createElement("script");b?(a.setAttribute("type","module"),a.innerText=h):(a.setAttribute("type","text/javascript"),a.setAttribute("src",h)),j&&(a.id=j),a.onload=()=>{d&&d()},a.onerror=d=>{m&&m(`Unable to load script '${h}'`,d)},w.appendChild(a)}static async LoadScriptAsync(h,d){return await new Promise(((m,j)=>{this.LoadScript(h,(()=>{m()}),((h,d)=>{j(d||new Error(h))}),d)}))}static ReadFileAsDataURL(h,d,m){const A=new FileReader,b={onCompleteObservable:new j.e,abort:()=>A.abort()};return A.onloadend=()=>{b.onCompleteObservable.notifyObservers(b)},A.onload=h=>{d(h.target.result)},A.onprogress=m,A.readAsDataURL(h),b}static ReadFile(h,d,m,j,A){return(0,q.B)(h,d,m,j,A)}static FileAsURL(h){const d=new Blob([h]);return window.URL.createObjectURL(d)}static Format(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return h.toFixed(d)}static DeepCopy(h,d,m,j){w.e.DeepCopy(h,d,m,j)}static IsEmpty(h){for(const d in h)if(Object.prototype.hasOwnProperty.call(h,d))return!1;return!0}static RegisterTopRootEvents(h,d){for(let j=0;j<d.length;j++){const A=d[j];h.addEventListener(A.name,A.handler,!1);try{window.parent&&window.parent.addEventListener(A.name,A.handler,!1)}catch(m){}}}static UnregisterTopRootEvents(h,d){for(let j=0;j<d.length;j++){const A=d[j];h.removeEventListener(A.name,A.handler);try{h.parent&&h.parent.removeEventListener(A.name,A.handler)}catch(m){}}}static async DumpFramebuffer(h,d,m,j){throw(0,D.b)("DumpTools")}static DumpData(h,d,m,j){throw(0,D.b)("DumpTools")}static async DumpDataAsync(h,d,m){throw(0,D.b)("DumpTools")}static _IsOffScreenCanvas(h){return void 0!==h.convertToBlob}static ToBlob(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",j=arguments.length>3?arguments[3]:void 0;L._IsOffScreenCanvas(h)||h.toBlob||(h.toBlob=function(h,d,m){setTimeout((()=>{const j=atob(this.toDataURL(d,m).split(",")[1]),A=j.length,b=new Uint8Array(A);for(let h=0;h<A;h++)b[h]=j.charCodeAt(h);h(new Blob([b]))}))}),L._IsOffScreenCanvas(h)?h.convertToBlob({type:m,quality:j}).then((h=>d(h))):h.toBlob((function(h){d(h)}),m,j)}static DownloadBlob(h,d){if("download"in document.createElement("a")){if(!d){const h=new Date;d="screenshot_"+((h.getFullYear()+"-"+(h.getMonth()+1)).slice(2)+"-"+h.getDate()+"_"+h.getHours()+"-"+("0"+h.getMinutes()).slice(-2))+".png"}L.Download(h,d)}else if(h&&"undefined"!==typeof URL){const d=URL.createObjectURL(h),m=window.open("");if(!m)return;const j=m.document.createElement("img");j.onload=function(){URL.revokeObjectURL(d)},j.src=d,m.document.body.appendChild(j)}}static EncodeScreenshotCanvasData(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",j=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;if("string"!==typeof j&&d){if(d){if(L._IsOffScreenCanvas(h))return void h.convertToBlob({type:m,quality:A}).then((h=>{const m=new FileReader;m.readAsDataURL(h),m.onloadend=()=>{const h=m.result;d(h)}}));const j=h.toDataURL(m,A);d(j)}}else this.ToBlob(h,(function(h){h&&L.DownloadBlob(h,j),d&&d("")}),m,A)}static Download(h,d){if("undefined"===typeof URL)return;const m=window.URL.createObjectURL(h),j=document.createElement("a");document.body.appendChild(j),j.style.display="none",j.href=m,j.download=d,j.addEventListener("click",(()=>{j.parentElement&&j.parentElement.removeChild(j)})),j.click(),window.URL.revokeObjectURL(m)}static BackCompatCameraNoPreventDefault(h){return"boolean"===typeof h[0]?h[0]:"boolean"===typeof h[1]&&h[1]}static CreateScreenshot(h,d,m,j){throw(0,D.b)("ScreenshotTools")}static async CreateScreenshotAsync(h,d,m){throw(0,D.b)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(h,d,m,j){throw(0,D.b)("ScreenshotTools")}static async CreateScreenshotUsingRenderTargetAsync(h,d,m){throw(0,D.b)("ScreenshotTools")}static RandomId(){return(0,R.d)()}static IsBase64(h){return(0,q.q)(h)}static DecodeBase64(h){return(0,q.e)(h)}static get errorsCount(){return b.c.errorsCount}static Log(h){b.c.Log(h)}static Warn(h){b.c.Warn(h)}static Error(h){b.c.Error(h)}static get LogCache(){return b.c.LogCache}static ClearLogCache(){b.c.ClearLogCache()}static set LogLevels(h){b.c.LogLevels=h}static set PerformanceLogLevel(h){return(h&L.PerformanceUserMarkLogLevel)===L.PerformanceUserMarkLogLevel?(L.StartPerformanceCounter=L._StartUserMark,void(L.EndPerformanceCounter=L._EndUserMark)):(h&L.PerformanceConsoleLogLevel)===L.PerformanceConsoleLogLevel?(L.StartPerformanceCounter=L._StartPerformanceConsole,void(L.EndPerformanceCounter=L._EndPerformanceConsole)):(L.StartPerformanceCounter=L._StartPerformanceCounterDisabled,void(L.EndPerformanceCounter=L._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(h,d){}static _EndPerformanceCounterDisabled(h,d){}static _StartUserMark(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!L._Performance){if(!(0,A.j)())return;L._Performance=window.performance}d&&L._Performance.mark&&L._Performance.mark(h+"-Begin")}static _EndUserMark(h){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&L._Performance.mark&&(L._Performance.mark(h+"-End"),L._Performance.measure(h,h+"-Begin",h+"-End"))}static _StartPerformanceConsole(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];d&&(L._StartUserMark(h,d),console.time&&console.time(h))}static _EndPerformanceConsole(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];d&&(L._EndUserMark(h,d),console.timeEnd(h))}static get Now(){return a.b.Now}static GetClassName(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=null;if(!d&&h.getClassName)m=h.getClassName();else{if(h instanceof Object){m=(d?h:Object.getPrototypeOf(h)).constructor.__bjsclassName__}m||(m=typeof h)}return m}static First(h,d){for(const m of h)if(d(m))return m;return null}static getFullClassName(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=null,j=null;if(!d&&h.getClassName)m=h.getClassName();else{if(h instanceof Object){const A=d?h:Object.getPrototypeOf(h);m=A.constructor.__bjsclassName__,j=A.constructor.__bjsmoduleName__}m||(m=typeof h)}return m?(null!=j?j+".":"")+m:null}static async DelayAsync(h){await new Promise((d=>{setTimeout((()=>{d()}),h)}))}static IsSafari(){return!!(0,A.h)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}L.AssetBaseUrl="",L.UseCustomRequestHeaders=!1,L.CustomRequestHeaders=S.c.CustomRequestHeaders,L.GetDOMTextContent=A.d,L._DefaultCdnUrl="https://cdn.babylonjs.com",L._DefaultAssetsUrl="https://assets.babylonjs.com/core",L.GetAbsoluteUrl="object"===typeof document?h=>{const d=document.createElement("a");return d.href=h,d.href}:"function"===typeof URL&&"object"===typeof location?h=>new URL(h,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},L.NoneLogLevel=b.c.NoneLogLevel,L.MessageLogLevel=b.c.MessageLogLevel,L.WarningLogLevel=b.c.WarningLogLevel,L.ErrorLogLevel=b.c.ErrorLogLevel,L.AllLogLevel=b.c.AllLogLevel,L.IsWindowObjectExist=A.j,L.PerformanceNoneLogLevel=0,L.PerformanceUserMarkLogLevel=1,L.PerformanceConsoleLogLevel=2,L.StartPerformanceCounter=L._StartPerformanceCounterDisabled,L.EndPerformanceCounter=L._EndPerformanceCounterDisabled;class B{constructor(h,d,m){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=h,this.index=j-1,this._done=!1,this._fn=d,this._successCallback=m}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(h,d,m){const j=new B(h,d,m,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return j.executeNext(),j}static SyncAsyncForLoop(h,d,m,j,A){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return B.Run(Math.ceil(h/d),(j=>{A&&A()?j.breakLoop():setTimeout((()=>{for(let b=0;b<d;++b){const w=j.index*d+b;if(w>=h)break;if(m(w),A&&A()){j.breakLoop();break}}j.executeNext()}),b)}),j)}}L.Mix=Z.k,L.IsExponentOfTwo=Z.g,M.b.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},11080:(h,d,m)=>{m.d(d,{e:()=>b,i:()=>A});const j={};function A(h,d){j[h]=d}function b(h){return j[h]}},11645:(h,d,m)=>{m.d(d,{b:()=>j});class j{static get UniqueId(){const h=this._UniqueIdCounter;return this._UniqueIdCounter++,h}}j._UniqueIdCounter=1},11144:(h,d,m)=>{m.d(d,{c:()=>j});class j{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(j.CustomRequestHeaders).length>0||j.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const h in j.CustomRequestHeaders){const d=j.CustomRequestHeaders[h];d&&this._xhr.setRequestHeader(h,d)}}_shouldSkipRequestModifications(h){return j.SkipRequestModificationForBabylonCDN&&(h.includes("preview.babylonjs.com")||h.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(h){this._xhr.onprogress=h}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(h){this._xhr.responseType=h}get timeout(){return this._xhr.timeout}set timeout(h){this._xhr.timeout=h}addEventListener(h,d,m){this._xhr.addEventListener(h,d,m)}removeEventListener(h,d,m){this._xhr.removeEventListener(h,d,m)}abort(){this._xhr.abort()}send(h){j.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(h)}open(h,d){for(const m of j.CustomRequestModifiers){if(this._shouldSkipRequestModifications(d))return;d=m(this._xhr,d)||d}d=(d=d.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=d,this._xhr.open(h,d,!0)}setRequestHeader(h,d){this._xhr.setRequestHeader(h,d)}getResponseHeader(h){return this._xhr.getResponseHeader(h)}}j.CustomRequestHeaders={},j.CustomRequestModifiers=new Array,j.SkipRequestModificationForBabylonCDN=!0},11779:(h,d,m)=>{m.d(d,{b:()=>A});class j{constructor(h){this._pendingActions=new Array,this._workerInfos=h.map((h=>({workerPromise:Promise.resolve(h),idle:!0})))}dispose(){for(const h of this._workerInfos)h.workerPromise.then((h=>{h.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(h){this._executeOnIdleWorker(h)||this._pendingActions.push(h)}_executeOnIdleWorker(h){for(const d of this._workerInfos)if(d.idle)return this._execute(d,h),!0;return!1}_execute(h,d){h.idle=!1,h.workerPromise.then((m=>{d(m,(()=>{const d=this._pendingActions.shift();d?this._execute(h,d):h.idle=!0}))}))}}class A extends j{constructor(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.DefaultOptions;super([]),this._maxWorkers=h,this._createWorkerAsync=d,this._options=m}push(h){if(!this._executeOnIdleWorker(h))if(this._workerInfos.length<this._maxWorkers){const d={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(d),this._execute(d,h)}else this._pendingActions.push(h)}_execute(h,d){h.timeoutId&&(clearTimeout(h.timeoutId),delete h.timeoutId),super._execute(h,((m,j)=>{d(m,(()=>{j(),h.idle&&(h.timeoutId=setTimeout((()=>{h.workerPromise.then((h=>{h.terminate()}));const d=this._workerInfos.indexOf(h);-1!==d&&this._workerInfos.splice(d,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}A.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11728:(h,d,m)=>{m.d(d,{e:()=>M});var j=m(11258),A=m(11097),b=m(11094),w=m(11281),a=m(11261),D=m(11341),S=m(11080);class M{get influence(){return this._influence}set influence(h){if(this._influence===h)return;const d=this._influence;this._influence=h,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===d||0===h)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(h){this._animationPropertiesOverride=h}constructor(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=h,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new A.e,this._onDataLayoutChanged=new A.e,this._animationPropertiesOverride=null,this.id=h,this._scene=m||b.b.LastCreatedScene,this.influence=d,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(h){const d=this.hasPositions;this._positions=h,d!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(h){const d=this.hasNormals;this._normals=h,d!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(h){const d=this.hasTangents;this._tangents=h,d!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(h){const d=this.hasUVs;this._uvs=h,d!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(h){const d=this.hasUV2s;this._uv2s=h,d!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(h){const d=this.hasColors;this._colors=h,d!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const h=D.d.Clone((()=>new M(this.name,this.influence,this._scene)),this);return h._positions=this._positions,h._normals=this._normals,h._tangents=this._tangents,h._uvs=this._uvs,h._uv2s=this._uv2s,h._colors=this._colors,h}serialize(){const h={};return h.name=this.name,h.influence=this.influence,h.Fh=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(h.id=this.id),this.hasNormals&&(h.fh=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(h.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(h.kh=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(h.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(h.Hh=Array.prototype.slice.call(this.getColors())),D.d.AppendSerializedAnimations(this,h),h}getClassName(){return"MorphTarget"}static Parse(h,d){const m=new M(h.name,h.influence);if(m.setPositions(h.Fh),null!=h.id&&(m.id=h.id),h.fh&&m.setNormals(h.fh),h.tangents&&m.setTangents(h.tangents),h.kh&&m.setUVs(h.kh),h.uv2s&&m.setUV2s(h.uv2s),h.Hh&&m.setColors(h.Hh),h.animations){for(let d=0;d<h.animations.length;d++){const j=h.animations[d],A=(0,S.e)("BABYLON.Animation");A&&m.animations.push(A.Parse(j))}h.autoAnimate&&d&&d.beginAnimation(m,h.autoAnimateFrom,h.autoAnimateTo,h.autoAnimateLoop,h.autoAnimateSpeed||1)}return m}static FromMesh(h,d,m){d||(d=h.name);const j=new M(d,m,h.ih());return j.setPositions(h.getVerticesData(w.d.PositionKind)),h.isVerticesDataPresent(w.d.NormalKind)&&j.setNormals(h.getVerticesData(w.d.NormalKind)),h.isVerticesDataPresent(w.d.TangentKind)&&j.setTangents(h.getVerticesData(w.d.TangentKind)),h.isVerticesDataPresent(w.d.UVKind)&&j.setUVs(h.getVerticesData(w.d.UVKind)),h.isVerticesDataPresent(w.d.UV2Kind)&&j.setUV2s(h.getVerticesData(w.d.UV2Kind)),h.isVerticesDataPresent(w.d.ColorKind)&&j.setColors(h.getVerticesData(w.d.ColorKind)),j}}(0,j.d)([(0,a.M)()],M.prototype,"id",void 0)},11559:(h,d,m)=>{m.d(d,{e:()=>R});var j=m(11258),A=m(11430),b=m(11097),w=m(11058),a=m(11196),D=m(11261),S=m(11341),M=m(11080),q=m(11188),E=m(11248),I=m(11561);q.b.prototype.setTextureFromPostProcess=function(h,d,m){var j;let A=null;d&&(d._forcedOutputTexture?A=d._forcedOutputTexture:d._textures.data[d._currentRenderTextureInd]&&(A=d._textures.data[d._currentRenderTextureInd])),this._bindTexture(h,(null===(j=A)||void 0===j?void 0:j.texture)??null,m)},q.b.prototype.setTextureFromPostProcessOutput=function(h,d,m){var j;this._bindTexture(h,(null===d||void 0===d||null===(j=d._outputTexture)||void 0===j?void 0:j.texture)??null,m)},a.e.prototype.setTextureFromPostProcess=function(h,d){this._engine.setTextureFromPostProcess(this._samplers[h],d,h)},a.e.prototype.setTextureFromPostProcessOutput=function(h,d){this._engine.setTextureFromPostProcessOutput(this._samplers[h],d,h)};class R{static get ForceGLSL(){return I.c.ForceGLSL}static set ForceGLSL(h){I.c.ForceGLSL=h}static RegisterShaderCodeProcessing(h,d){I.c.RegisterShaderCodeProcessing(h,d)}get name(){return this._effectWrapper.name}set name(h){this._effectWrapper.name=h}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(h){this._effectWrapper.alphaMode=h}get samples(){return this._samples}set samples(h){this._samples=Math.min(h,this._engine.getCaps().maxMSAASamples),this._textures.forEach((h=>{h.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(h){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),h&&(this._onActivateObserver=this.onActivateObservable.add(h))}set onSizeChanged(h){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(h)}set onApply(h){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(h)}set onBeforeRender(h){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(h)}set onAfterRender(h){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(h)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(h){this._forcedOutputTexture=h}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.xd(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(h,d,m,j,a,D){var S;let M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,q=arguments.length>7?arguments[7]:void 0,E=arguments.length>8?arguments[8]:void 0,Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,L=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",V=arguments.length>12?arguments[12]:void 0,v=arguments.length>13&&void 0!==arguments[13]&&arguments[13],C=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,T=arguments.length>15?arguments[15]:void 0,o=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Qq=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new A.e(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new w.h(1,1),this._texelSize=w.h.Zero(),this.onActivateObservable=new b.e,this.onSizeChangedObservable=new b.e,this.onApplyObservable=new b.e,this.onBeforeRenderObservable=new b.e,this.onAfterRenderObservable=new b.e,this.pd=new b.e;let y,i=1,g=null;if(m&&!Array.isArray(m)){const h=m;m=h.uniforms??null,j=h.samplers??null,i=h.size??1,D=h.camera??null,M=h.samplingMode??1,q=h.sa,E=h.reusable,Z=Array.isArray(h.defines)?h.defines.join("\n"):h.defines??null,L=h.textureType??0,B=h.vertexUrl??"postprocess",V=h.indexParameters,v=h.blockCompilation??!1,C=h.textureFormat??5,T=h.shaderLanguage??0,g=h.uniformBuffers??null,o=h.extraInitializations,y=h.effectWrapper}else a&&(i="number"===typeof a?a:{width:a.width,height:a.height});if(this._useExistingThinPostProcess=!!y,this._effectWrapper=y??new I.c({name:h,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:d,sa:q||(null===(S=D)||void 0===S?void 0:S.ih().getEngine()),uniforms:m,samplers:j,uniformBuffers:g,defines:Z,vertexUrl:B,indexParameters:V,blockCompilation:!0,shaderLanguage:T,extraInitializations:void 0}),this.name=h,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=D?(this._camera=D,this._scene=D.ih(),D.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):q&&(this._engine=q,this._engine.postProcesses.push(this)),this._options=i,this.renderTargetSamplingMode=M||1,this._reusable=E||!1,this._textureType=L,this._textureFormat=C,this._shaderLanguage=T||0,this._samplers=j||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=d,this._vertexUrl=B,this._parameters=m||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=g||[],this._indexParameters=V,!this._useExistingThinPostProcess){this._webGPUReady=1===this._shaderLanguage;const h=[];this._gatherImports(this._engine.isWebGPU&&!R.ForceGLSL,h),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(v,Z,o,h)}}_gatherImports(){let h=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?h.push(Promise.all([m.e(42).then(m.bind(m,13411))])):h.push(Promise.all([Promise.resolve().then(m.bind(m,11565))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(h){return this._disposeTextures(),this._shareOutputWithPostProcess=h,this}useOwnOutput(){0==this._textures.length&&(this._textures=new A.e(2)),this._shareOutputWithPostProcess=null}updateEffect(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0,w=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(h,d,m,j,A,b,w,a),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let A=0;A<this._textureCache.length;A++)if(this._textureCache[A].texture.width===h.width&&this._textureCache[A].texture.height===h.height&&this._textureCache[A].postProcessChannel===m&&this._textureCache[A].texture._generateDepthBuffer===d.generateDepthBuffer&&this._textureCache[A].texture.samples===d.samples)return this._textureCache[A].texture;const j=this._engine.createRenderTargetTexture(h,d);return this._textureCache.push({texture:j,postProcessChannel:m,lastUsedRenderId:-1}),j}_flushTextureCache(){const h=this._renderId;for(let d=this._textureCache.length-1;d>=0;d--)if(h-this._textureCache[d].lastUsedRenderId>100){let h=!1;for(let m=0;m<this._textures.length;m++)if(this._textures.data[m]===this._textureCache[d].texture){h=!0;break}h||(this._textureCache[d].texture.dispose(),this._textureCache.splice(d,1))}}resize(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=h,this.height=d;let b=null;if(m)for(let D=0;D<m._postProcesses.length;D++)if(null!==m._postProcesses[D]){b=m._postProcesses[D];break}const w={width:this.width,height:this.height},a={generateMipMaps:j,generateDepthBuffer:A||b===this,generateStencilBuffer:(A||b===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(w,a,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(w,a,1)),this._texelSize.xd(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let h;if(this._shareOutputWithPostProcess)h=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)h=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let d;h=this.inputTexture;for(let m=0;m<this._textureCache.length;m++)if(this._textureCache[m].texture===h){d=this._textureCache[m];break}d&&(d.lastUsedRenderId=this._renderId)}return h}activate(h){var d,m;let j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;const b=null===h||void 0!==h.cameraRigMode?h||this._camera:null,w=(null===b||void 0===b?void 0:b.ih())??h,a=w.getEngine(),D=a.getCaps().maxTextureSize,S=(j?j.width:this._engine.getRenderWidth(!0))*this._options|0,M=(j?j.height:this._engine.getRenderHeight(!0))*this._options|0;let q=this._options.width||S,I=this._options.height||M;const R=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let Z=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const h=a.currentViewport;h&&(q*=h.width,I*=h.height)}(R||this.alwaysForcePOT)&&(this._options.width||(q=a.needPOTTextures?(0,E.f)(q,D,this.scaleMode):q),this._options.height||(I=a.needPOTTextures?(0,E.f)(I,D,this.scaleMode):I)),this.width===q&&this.height===I&&(Z=this._getTarget())||this.resize(q,I,b,R,A),this._textures.forEach((h=>{h.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(h,this.samples)})),this._flushTextureCache(),this._renderId++}return Z||(Z=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.xd(S/q,M/I),this._engine.bindFramebuffer(Z,0,S,M,this.forceFullscreenViewport)):(this._scaleRatio.xd(1,1),this._engine.bindFramebuffer(Z,0,void 0,void 0,this.forceFullscreenViewport)),null===(d=(m=this._engine)._debugInsertMarker)||void 0===d||d.call(m,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(b),this.Qq&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:w.clearColor,w._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),Z}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let h;var d;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),this._engine.setAlphaMode(this.alphaMode),h=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(d=h)||void 0===d?void 0:d.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(!0),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let h=this._textureCache.length-1;h>=0;h--)this._textureCache[h].texture.dispose();this._textureCache.length=0}setPrePassRenderer(h){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=h.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(h){let d;if(h=h||this._camera,this._useExistingThinPostProcess||this._effectWrapper.dispose(),this._disposeTextures(),this._scene&&(d=this._scene.postProcesses.indexOf(this),-1!==d&&this._scene.postProcesses.splice(d,1)),this._parentContainer){const h=this._parentContainer.postProcesses.indexOf(this);h>-1&&this._parentContainer.postProcesses.splice(h,1),this._parentContainer=null}if(d=this._engine.postProcesses.indexOf(this),-1!==d&&this._engine.postProcesses.splice(d,1),this.pd.notifyObservers(),h){if(h.detachPostProcess(this),d=h._postProcesses.indexOf(this),0===d&&h._postProcesses.length>0){const h=this._camera._getFirstPostProcess();h&&h.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const h=S.d.Serialize(this),d=this.getCamera()||this._scene&&this._scene.activeCamera;return h.customType="BABYLON."+this.getClassName(),h.cameraId=d?d.id:null,h.reusable=this._reusable,h.textureType=this._textureType,h.fragmentUrl=this._fragmentUrl,h.parameters=this._parameters,h.samplers=this._samplers,h.uniformBuffers=this._uniformBuffers,h.options=this._options,h.defines=this._postProcessDefines,h.textureFormat=this._textureFormat,h.vertexUrl=this._vertexUrl,h.indexParameters=this._indexParameters,h}clone(){const h=this.serialize();h._engine=this._engine,h.cameraId=null;const d=R.Parse(h,this._scene,"");return d?(d.onActivateObservable=this.onActivateObservable.clone(),d.onSizeChangedObservable=this.onSizeChangedObservable.clone(),d.onApplyObservable=this.onApplyObservable.clone(),d.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),d.onAfterRenderObservable=this.onAfterRenderObservable.clone(),d._prePassEffectConfiguration=this._prePassEffectConfiguration,d):null}static Parse(h,d,m){const j=(0,M.e)(h.customType);if(!j||!j._Parse)return null;const A=d?d.getCameraById(h.cameraId):null;return j._Parse(h,A,d,m)}static _Parse(h,d,m,j){return S.d.Parse((()=>new R(h.name,h.fragmentUrl,h.parameters,h.samplers,h.options,d,h.renderTargetSamplingMode,h._engine,h.reusable,h.defines,h.textureType,h.vertexUrl,h.indexParameters,!1,h.textureFormat)),h,m,j)}}(0,j.d)([(0,D.M)()],R.prototype,"uniqueId",void 0),(0,j.d)([(0,D.M)()],R.prototype,"name",null),(0,j.d)([(0,D.M)()],R.prototype,"width",void 0),(0,j.d)([(0,D.M)()],R.prototype,"height",void 0),(0,j.d)([(0,D.M)()],R.prototype,"renderTargetSamplingMode",void 0),(0,j.d)([(0,D.n)()],R.prototype,"clearColor",void 0),(0,j.d)([(0,D.M)()],R.prototype,"Qq",void 0),(0,j.d)([(0,D.M)()],R.prototype,"forceAutoClearInAlphaMode",void 0),(0,j.d)([(0,D.M)()],R.prototype,"alphaMode",null),(0,j.d)([(0,D.M)()],R.prototype,"alphaConstants",void 0),(0,j.d)([(0,D.M)()],R.prototype,"enablePixelPerfectMode",void 0),(0,j.d)([(0,D.M)()],R.prototype,"forceFullscreenViewport",void 0),(0,j.d)([(0,D.M)()],R.prototype,"scaleMode",void 0),(0,j.d)([(0,D.M)()],R.prototype,"alwaysForcePOT",void 0),(0,j.d)([(0,D.M)("samples")],R.prototype,"_samples",void 0),(0,j.d)([(0,D.M)()],R.prototype,"adaptScaleToCurrentViewport",void 0),(0,M.i)("BABYLON.PostProcess",R)},11553:(h,d,m)=>{m.d(d,{e:()=>b});var j=m(11281),A=m(11097);class b{constructor(h){this._vertexBuffers={},this.onBeforeRenderObservable=new A.e,this._scene=h}_prepareBuffers(){if(this._vertexBuffers[j.d.PositionKind])return;const h=[];h.push(1,1),h.push(-1,1),h.push(-1,-1),h.push(1,-1),this._vertexBuffers[j.d.PositionKind]=new j.d(this._scene.getEngine(),h,j.d.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const h=[];h.push(0),h.push(1),h.push(2),h.push(0),h.push(2),h.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(h)}_rebuild(){const h=this._vertexBuffers[j.d.PositionKind];h&&(h._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const m=this._scene.activeCamera;return!!m&&(d=d||m._postProcesses.filter((h=>null!=h)),!(!d||0===d.length||!this._scene.postProcessesEnabled)&&(d[0].activate(m,h,null!==d&&void 0!==d),!0))}directRender(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:h.length;const a=this._scene.getEngine();for(let S=0;S<w;S++){var D;if(S<h.length-1)h[S+1].activate(this._scene.activeCamera||this._scene,null===d||void 0===d?void 0:d.texture);else d?a.bindFramebuffer(d,j,void 0,void 0,m,A):b||a.restoreDefaultFramebuffer(),null===(D=a._debugInsertMarker)||void 0===D||D.call(a,`post process ${h[S].name} output`);const w=h[S],M=w.apply();M&&(w.onBeforeRenderObservable.notifyObservers(M),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,M),a.drawElementsType(0,0,6),w.onAfterRenderObservable.notifyObservers(M))}a.setDepthBuffer(!0),a.setDepthWrite(!0)}_finalizeFrame(h,d,m,j){let A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const b=this._scene.activeCamera;if(!b)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(j=j||b._postProcesses.filter((h=>null!=h))).length||!this._scene.postProcessesEnabled)return;const w=this._scene.getEngine();for(let D=0,S=j.length;D<S;D++){const M=j[D];var a;if(D<S-1)M._outputTexture=j[D+1].activate(b,null===d||void 0===d?void 0:d.texture);else d?(w.bindFramebuffer(d,m,void 0,void 0,A),M._outputTexture=d):(w.restoreDefaultFramebuffer(),M._outputTexture=null),null===(a=w._debugInsertMarker)||void 0===a||a.call(w,`post process ${j[D].name} output`);if(h)break;const q=M.apply();q&&(M.onBeforeRenderObservable.notifyObservers(q),this._prepareBuffers(),w.bindBuffers(this._vertexBuffers,this._indexBuffer,q),w.drawElementsType(0,0,6),M.onAfterRenderObservable.notifyObservers(q))}w.setDepthBuffer(!0),w.setDepthWrite(!0),w.setAlphaMode(0)}dispose(){const h=this._vertexBuffers[j.d.PositionKind];h&&(h.dispose(),this._vertexBuffers[j.d.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11557:(h,d,m)=>{m.d(d,{d:()=>a});var j=m(11430),A=m(11058);class b{set opaqueSortCompareFn(h){this._opaqueSortCompareFn=h||b.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(h){this._alphaTestSortCompareFn=h||b.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(h){this._transparentSortCompareFn=h||b.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=h,this._opaqueSubMeshes=new j.e(256),this._transparentSubMeshes=new j.e(256),this._alphaTestSubMeshes=new j.e(256),this._depthOnlySubMeshes=new j.e(256),this._particleSystems=new j.e(256),this._spriteManagers=new j.e(256),this._empty=!0,this._edgesRenderers=new j.c(16),this._scene=d,this.opaqueSortCompareFn=m,this.alphaTestSortCompareFn=A,this.transparentSortCompareFn=b}render(h,d,m,j){if(h)return void h(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const A=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(A.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),A.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const b=A.getStencilBuffer();if(A.setStencilBuffer(!1),d&&this._renderSprites(),m&&this._renderParticles(j),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(A.setStencilBuffer(b),this._scene.useOrderIndependentTransparency){const h=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);h.length&&this._renderTransparent(h)}else this._renderTransparent(this._transparentSubMeshes);A.setAlphaMode(0)}if(A.setStencilBuffer(!1),this._edgesRenderers.length){for(let h=0;h<this._edgesRenderers.length;h++)this._edgesRenderers.data[h].render();A.setAlphaMode(0)}A.setStencilBuffer(b)}_renderOpaqueSorted(h){b._RenderSorted(h,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(h){b._RenderSorted(h,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(h){b._RenderSorted(h,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(h,d,m,j){let w,a=0;const D=m?m.globalPosition:b._ZeroVector;if(j)for(;a<h.length;a++)w=h.data[a],w._alphaIndex=w.getMesh().alphaIndex,w._distanceToCamera=A.i.Distance(w.getBoundingInfo().boundingSphere.centerWorld,D);const S=h.length===h.data.length?h.data:h.data.slice(0,h.length);d&&S.sort(d);const M=S[0].getMesh().ih();for(a=0;a<S.length;a++)if(w=S[a],!M._activeMeshesFrozenButKeepClipping||w.isInFrustum(M._frustumPlanes)){if(j){const h=w.Qh();if(h&&h.needDepthPrePass){const d=h.ih().getEngine();d.setColorWrite(!1),d.setAlphaMode(0),w.render(!1),d.setColorWrite(!0)}}w.render(j)}}static defaultTransparentSortCompare(h,d){return h._alphaIndex>d._alphaIndex?1:h._alphaIndex<d._alphaIndex?-1:b.backToFrontSortCompare(h,d)}static backToFrontSortCompare(h,d){return h._distanceToCamera<d._distanceToCamera?1:h._distanceToCamera>d._distanceToCamera?-1:0}static frontToBackSortCompare(h,d){return h._distanceToCamera<d._distanceToCamera?-1:h._distanceToCamera>d._distanceToCamera?1:0}static PainterSortCompare(h,d){const m=h.getMesh(),j=d.getMesh();return m.material&&j.material?m.material.uniqueId-j.material.uniqueId:m.uniqueId-j.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(h,d,m){void 0===d&&(d=h.getMesh()),void 0===m&&(m=h.Qh()),null!==m&&void 0!==m&&(m.needAlphaBlendingForMesh(d)?this._transparentSubMeshes.push(h):m.needAlphaTestingForMesh(d)?(m.needDepthPrePass&&this._depthOnlySubMeshes.push(h),this._alphaTestSubMeshes.push(h)):(m.needDepthPrePass&&this._depthOnlySubMeshes.push(h),this._opaqueSubMeshes.push(h)),d._renderingGroup=this,d._edgesRenderer&&d.isEnabled()&&d.isVisible&&d._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(d._edgesRenderer),this._empty=!1)}dispatchSprites(h){this._spriteManagers.push(h),this._empty=!1}dispatchParticles(h){this._particleSystems.push(h),this._empty=!1}_renderParticles(h){if(0===this._particleSystems.length)return;const d=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let m=0;m<this._particleSystems.length;m++){const j=this._particleSystems.data[m];if(0===(d&&d.layerMask&j.layerMask))continue;const A=j.k;A.position&&h&&-1===h.indexOf(A)||this._scene._activeParticles.addCount(j.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const h=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let d=0;d<this._spriteManagers.length;d++){const m=this._spriteManagers.data[d];0!==(h&&h.layerMask&m.layerMask)&&m.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}b._ZeroVector=A.i.Zero();class w{}class a{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(h){h!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=h,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const h of this._scene.meshes)if(h.Ab)for(const d of h.Ab)d._wasDispatched=!1;if(this._scene.spriteManagers)for(const h of this._scene.spriteManagers)h._wasDispatched=!1;for(const h of this._scene.aE)h._wasDispatched=!1}constructor(h){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new w,this._maintainStateBetweenFrames=!1,this._scene=h;for(let d=a.MIN_RENDERINGGROUPS;d<a.MAX_RENDERINGGROUPS;d++)this._autoClearDepthStencil[d]={Qq:!0,depth:!0,stencil:!0}}getRenderingGroup(h){const d=h||0;return this._prepareRenderingGroup(d),this._renderingGroups[d]}_clearDepthStencilBuffer(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,h,d),this._depthStencilBufferAlreadyCleaned=!0)}render(h,d,m,j){const A=this._renderingGroupInfo;if(A.Fd=this._scene,A.camera=this._scene.activeCamera,A.renderingManager=this,this._scene.spriteManagers&&j)for(let b=0;b<this._scene.spriteManagers.length;b++){const h=this._scene.spriteManagers[b];this.dispatchSprites(h)}for(let b=a.MIN_RENDERINGGROUPS;b<a.MAX_RENDERINGGROUPS;b++){this._depthStencilBufferAlreadyCleaned=b===a.MIN_RENDERINGGROUPS;const w=this._renderingGroups[b];if(!w||w._empty)continue;const D=1<<b;if(A.renderingGroupId=b,this._scene.onBeforeRenderingGroupObservable.notifyObservers(A,D),a.AUTOCLEAR){const h=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(b):this._autoClearDepthStencil[b];h&&h.Qq&&this._clearDepthStencilBuffer(h.depth,h.stencil)}for(const h of this._scene._beforeRenderingGroupDrawStage)h.action(b);w.render(h,j,m,d);for(const h of this._scene._afterRenderingGroupDrawStage)h.action(b);this._scene.onAfterRenderingGroupObservable.notifyObservers(A,D)}}reset(){if(!this.maintainStateBetweenFrames)for(let h=a.MIN_RENDERINGGROUPS;h<a.MAX_RENDERINGGROUPS;h++){const d=this._renderingGroups[h];d&&d.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let h=a.MIN_RENDERINGGROUPS;h<a.MAX_RENDERINGGROUPS;h++){const d=this._renderingGroups[h];d&&d.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let h=a.MIN_RENDERINGGROUPS;h<a.MAX_RENDERINGGROUPS;h++){const d=this._renderingGroups[h];d&&d.dispose()}}_prepareRenderingGroup(h){void 0===this._renderingGroups[h]&&(this._renderingGroups[h]=new b(h,this._scene,this._customOpaqueSortCompareFn[h],this._customAlphaTestSortCompareFn[h],this._customTransparentSortCompareFn[h]))}dispatchSprites(h){this.maintainStateBetweenFrames&&h._wasDispatched||(h._wasDispatched=!0,this.getRenderingGroup(h.renderingGroupId).dispatchSprites(h))}dispatchParticles(h){this.maintainStateBetweenFrames&&h._wasDispatched||(h._wasDispatched=!0,this.getRenderingGroup(h.renderingGroupId).dispatchParticles(h))}dispatch(h,d,m){void 0===d&&(d=h.getMesh()),this.maintainStateBetweenFrames&&h._wasDispatched||(h._wasDispatched=!0,this.getRenderingGroup(d.renderingGroupId).dispatch(h,d,m))}setRenderingOrder(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[h]=d,this._customAlphaTestSortCompareFn[h]=m,this._customTransparentSortCompareFn[h]=j,this._renderingGroups[h]){const d=this._renderingGroups[h];d.opaqueSortCompareFn=this._customOpaqueSortCompareFn[h],d.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[h],d.transparentSortCompareFn=this._customTransparentSortCompareFn[h]}}setRenderingAutoClearDepthStencil(h,d){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[h]={Qq:d,depth:m,stencil:j}}getAutoClearDepthStencilSetup(h){return this._autoClearDepthStencil[h]}}a.MAX_RENDERINGGROUPS=4,a.MIN_RENDERINGGROUPS=0,a.AUTOCLEAR=!0},11565:(h,d,m)=>{m.r(d),m.d(d,{postprocessVertexShader:()=>w});var j=m(11200);const A="postprocessVertexShader",b="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";j.b.ShadersStore[A]||(j.b.ShadersStore[A]=b);const w={name:A,shader:b}},11639:(h,d,m)=>{m.d(d,{b:()=>j});class j{}j._IsPickingAvailable=!1},11374:(h,d,m)=>{m.d(d,{b:()=>q});var j=m(11258),A=m(11058),b=m(11261),w=m(11097),a=m(11094),D=m(11137),S=m(11341);class M{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new w.e,this._onClonedObservable=new w.e}}class q{static AddNodeConstructor(h,d){this._NodeConstructors[h]=d}static Construct(h,d,m,j){const A=this._NodeConstructors[h];return A?A(d,m,j):null}set accessibilityTag(h){this._accessibilityTag=h,this.onAccessibilityTagChangedObservable.notifyObservers(h)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(h){this._nodeDataStorage._doNotSerialize=h}q(){return this._nodeDataStorage._isDisposed}set parent(h){if(this._parentNode===h)return;const d=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const d=this._parentNode._children.indexOf(this);-1!==d&&this._parentNode._children.splice(d,1),h||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=h,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),d||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(h){h.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const h=this._scene.rootNodes,d=h.length-1;h[this._nodeDataStorage._sceneRootNodesIndex]=h[d],h[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(h){this._animationPropertiesOverride=h}getClassName(){return"Node"}set onDispose(h){this._onDisposeObserver&&this.pd.remove(this._onDisposeObserver),this._onDisposeObserver=this.pd.add(h)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new M,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new w.e,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=A.b.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.pd=new w.e,this._onDisposeObserver=null,this._behaviors=new Array,this.name=h,this.id=h,this._scene=d||a.b.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),m&&this._addToSceneRootNodes()}ih(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(h)||(h.init(),this._scene.isLoading&&!d?this._scene.onDataLoadedObservable.addOnce((()=>{h.attach(this)})):h.attach(this),this._behaviors.push(h)),this}removeBehavior(h){const d=this._behaviors.indexOf(h);return-1===d||(this._behaviors[d].detach(),this._behaviors.splice(d,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(h){for(const d of this._behaviors)if(d.name===h)return d;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Zd(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(h){!h&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(h){return this.parent?this.parent._getActionManagerForTrigger(h,!1):null}_updateCache(h){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}PS(h){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){if(this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children)for(const h of this._children)h._syncParentEnabledState()}jD(h){this._nodeDataStorage._isEnabled!==h&&(this._nodeDataStorage._isEnabled=h,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(h))}isDescendantOf(h){return!!this.parent&&(this.parent===h||this.parent.isDescendantOf(h))}_getDescendants(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],m=arguments.length>2?arguments[2]:void 0;if(this._children)for(let j=0;j<this._children.length;j++){const A=this._children[j];m&&!m(A)||h.push(A),d||A._getDescendants(h,!1,m)}}getDescendants(h,d){const m=[];return this._getDescendants(m,h,d),m}getChildMeshes(h,d){const m=[];return this._getDescendants(m,h,(h=>(!d||d(h))&&void 0!==h.Tq)),m}getChildren(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(d,h)}_setReady(h){h!==this._nodeDataStorage._isReady&&(h?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(h){for(let d=0;d<this.animations.length;d++){const m=this.animations[d];if(m.name===h)return m}return null}createAnimationRange(h,d,m){if(!this._ranges[h]){this._ranges[h]=q._AnimationRangeFactory(h,d,m);for(let j=0,A=this.animations.length;j<A;j++)this.animations[j]&&this.animations[j].createRange(h,d,m)}}deleteAnimationRange(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let m=0,j=this.animations.length;m<j;m++)this.animations[m]&&this.animations[m].deleteRange(h,d);this._ranges[h]=null}getAnimationRange(h){return this._ranges[h]||null}clone(h,d,m){const j=S.d.Clone((()=>new q(h,this.ih())),this);if(d&&(j.parent=d),!m){const d=this.getDescendants(!0);for(let m=0;m<d.length;m++){const A=d[m];A.clone(h+"."+A.name,j)}}return j}getAnimationRanges(){const h=[];let d;for(d in this._ranges)h.push(this._ranges[d]);return h}beginAnimation(h,d,m,j){const A=this.getAnimationRange(h);return A?this._scene.beginAnimation(this,A.from,A.to,d,m,j):null}serializeAnimationRanges(){const h=[];for(const d in this._ranges){const m=this._ranges[d];if(!m)continue;const j={};j.name=d,j.from=m.from,j.to=m.to,h.push(j)}return h}Zd(h){return this._worldMatrix||(this._worldMatrix=A.b.Identity()),this._worldMatrix}dispose(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!h){const m=this.getDescendants(!0);for(const j of m)j.dispose(h,d)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.pd.notifyObservers(this),this.pd.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const m of this._behaviors)m.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(h,d,m){if(d.ranges)for(let j=0;j<d.ranges.length;j++){const m=d.ranges[j];h.createAnimationRange(m.name,m.from,m.to)}}getHierarchyBoundingVectors(){let h,d,m=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.ih().incrementRenderId(),this.Zd(!0);const b=this;if(b.getBoundingInfo&&b.Ab){const m=b.getBoundingInfo();h=m.boundingBox.minimumWorld.clone(),d=m.boundingBox.maximumWorld.clone()}else h=new A.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),d=new A.i(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(m){const m=this.getDescendants(!1);for(const b of m){const m=b;if(m.Zd(!0),j&&!j(m))continue;if(!m.getBoundingInfo||0===m.getTotalVertices())continue;const w=m.getBoundingInfo().boundingBox,a=w.minimumWorld,D=w.maximumWorld;A.i.CheckExtends(a,h,d),A.i.CheckExtends(D,h,d)}}return{min:h,max:d}}}q._AnimationRangeFactory=(h,d,m)=>{throw(0,D.b)("AnimationRange")},q._NodeConstructors={},(0,j.d)([(0,b.M)()],q.prototype,"name",void 0),(0,j.d)([(0,b.M)()],q.prototype,"id",void 0),(0,j.d)([(0,b.M)()],q.prototype,"uniqueId",void 0),(0,j.d)([(0,b.M)()],q.prototype,"state",void 0),(0,j.d)([(0,b.M)()],q.prototype,"metadata",void 0)},11604:(h,d,m)=>{m.d(d,{c:()=>hh});var j=m(11107),A=m(11132),b=m(11097),w=m(11430);class a{constructor(){this._count=0,this._data={}}D(h){this.clear(),h.forEach(((h,d)=>this.add(h,d)))}get(h){const d=this._data[h];if(void 0!==d)return d}getOrAddWithFactory(h,d){let m=this.get(h);return void 0!==m||(m=d(h),m&&this.add(h,m)),m}getOrAdd(h,d){const m=this.get(h);return void 0!==m?m:(this.add(h,d),d)}contains(h){return void 0!==this._data[h]}add(h,d){return void 0===this._data[h]&&(this._data[h]=d,++this._count,!0)}set(h,d){return void 0!==this._data[h]&&(this._data[h]=d,!0)}getAndRemove(h){const d=this.get(h);return void 0!==d?(delete this._data[h],--this._count,d):null}remove(h){return!!this.contains(h)&&(delete this._data[h],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(h){for(const d in this._data){h(d,this._data[d])}}first(h){for(const d in this._data){const m=h(d,this._data[d]);if(m)return m}return null}}var D=m(11350),S=m(11058),M=m(11606),q=m(11335),E=m(11400);class I{constructor(h,d,m,j,A,b){this.source=h,this.pointerX=d,this.pointerY=m,this.meshUnderPointer=j,this.sourceEvent=A,this.additionalData=b}static CreateNew(h,d,m){const j=h.ih();return new I(h,j.pointerX,j.pointerY,j.meshUnderPointer||h,d,m)}static CreateNewFromSprite(h,d,m,j){return new I(h,d.pointerX,d.pointerY,d.meshUnderPointer,m,j)}static CreateNewFromScene(h,d){return new I(null,h.pointerX,h.pointerY,h.meshUnderPointer,d)}static CreateNewFromPrimitive(h,d,m,j){return new I(h,d.x,d.y,null,m,j)}}var R=m(11553),Z=m(11557),L=m(11461),B=m(11115),V=m(11094),v=m(11137),C=m(11624);class T{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const h in T.Triggers)if(Object.prototype.hasOwnProperty.call(T.Triggers,h))return!0;return!1}static get HasPickTriggers(){for(const h in T.Triggers)if(Object.prototype.hasOwnProperty.call(T.Triggers,h)){const d=parseInt(h);if(d>=1&&d<=7)return!0}return!1}static HasSpecificTrigger(h){for(const d in T.Triggers)if(Object.prototype.hasOwnProperty.call(T.Triggers,d)){if(parseInt(d)===h)return!0}return!1}}T.Triggers={};var o,y,i,g,F,f,H,c=m(11632);!function(h){h[h.Generic=0]="Generic",h[h.Keyboard=1]="Keyboard",h[h.Mouse=2]="Mouse",h[h.Touch=3]="Touch",h[h.DualShock=4]="DualShock",h[h.Xbox=5]="Xbox",h[h.Switch=6]="Switch",h[h.DualSense=7]="DualSense"}(o||(o={})),function(h){h[h.Horizontal=0]="Horizontal",h[h.Vertical=1]="Vertical",h[h.LeftClick=2]="LeftClick",h[h.MiddleClick=3]="MiddleClick",h[h.RightClick=4]="RightClick",h[h.BrowserBack=5]="BrowserBack",h[h.BrowserForward=6]="BrowserForward",h[h.MouseWheelX=7]="MouseWheelX",h[h.MouseWheelY=8]="MouseWheelY",h[h.MouseWheelZ=9]="MouseWheelZ",h[h.Move=12]="Move"}(y||(y={})),function(h){h[h.Horizontal=0]="Horizontal",h[h.Vertical=1]="Vertical",h[h.LeftClick=2]="LeftClick",h[h.MiddleClick=3]="MiddleClick",h[h.RightClick=4]="RightClick",h[h.BrowserBack=5]="BrowserBack",h[h.BrowserForward=6]="BrowserForward",h[h.MouseWheelX=7]="MouseWheelX",h[h.MouseWheelY=8]="MouseWheelY",h[h.MouseWheelZ=9]="MouseWheelZ",h[h.DeltaHorizontal=10]="DeltaHorizontal",h[h.DeltaVertical=11]="DeltaVertical"}(i||(i={})),function(h){h[h.Cross=0]="Cross",h[h.Circle=1]="Circle",h[h.Square=2]="Square",h[h.Triangle=3]="Triangle",h[h.L1=4]="L1",h[h.R1=5]="R1",h[h.L2=6]="L2",h[h.R2=7]="R2",h[h.Share=8]="Share",h[h.Options=9]="Options",h[h.L3=10]="L3",h[h.R3=11]="R3",h[h.DPadUp=12]="DPadUp",h[h.DPadDown=13]="DPadDown",h[h.DPadLeft=14]="DPadLeft",h[h.DPadRight=15]="DPadRight",h[h.Home=16]="Home",h[h.TouchPad=17]="TouchPad",h[h.LStickXAxis=18]="LStickXAxis",h[h.LStickYAxis=19]="LStickYAxis",h[h.RStickXAxis=20]="RStickXAxis",h[h.RStickYAxis=21]="RStickYAxis"}(g||(g={})),function(h){h[h.Cross=0]="Cross",h[h.Circle=1]="Circle",h[h.Square=2]="Square",h[h.Triangle=3]="Triangle",h[h.L1=4]="L1",h[h.R1=5]="R1",h[h.L2=6]="L2",h[h.R2=7]="R2",h[h.Create=8]="Create",h[h.Options=9]="Options",h[h.L3=10]="L3",h[h.R3=11]="R3",h[h.DPadUp=12]="DPadUp",h[h.DPadDown=13]="DPadDown",h[h.DPadLeft=14]="DPadLeft",h[h.DPadRight=15]="DPadRight",h[h.Home=16]="Home",h[h.TouchPad=17]="TouchPad",h[h.LStickXAxis=18]="LStickXAxis",h[h.LStickYAxis=19]="LStickYAxis",h[h.RStickXAxis=20]="RStickXAxis",h[h.RStickYAxis=21]="RStickYAxis"}(F||(F={})),function(h){h[h.A=0]="A",h[h.B=1]="B",h[h.X=2]="X",h[h.Y=3]="Y",h[h.LB=4]="LB",h[h.RB=5]="RB",h[h.LT=6]="LT",h[h.RT=7]="RT",h[h.Back=8]="Back",h[h.Start=9]="Start",h[h.LS=10]="LS",h[h.RS=11]="RS",h[h.DPadUp=12]="DPadUp",h[h.DPadDown=13]="DPadDown",h[h.DPadLeft=14]="DPadLeft",h[h.DPadRight=15]="DPadRight",h[h.Home=16]="Home",h[h.LStickXAxis=17]="LStickXAxis",h[h.LStickYAxis=18]="LStickYAxis",h[h.RStickXAxis=19]="RStickXAxis",h[h.RStickYAxis=20]="RStickYAxis"}(f||(f={})),function(h){h[h.B=0]="B",h[h.A=1]="A",h[h.Y=2]="Y",h[h.X=3]="X",h[h.L=4]="L",h[h.R=5]="R",h[h.ZL=6]="ZL",h[h.ZR=7]="ZR",h[h.Minus=8]="Minus",h[h.Plus=9]="Plus",h[h.LS=10]="LS",h[h.RS=11]="RS",h[h.DPadUp=12]="DPadUp",h[h.DPadDown=13]="DPadDown",h[h.DPadLeft=14]="DPadLeft",h[h.DPadRight=15]="DPadRight",h[h.Home=16]="Home",h[h.Capture=17]="Capture",h[h.LStickXAxis=18]="LStickXAxis",h[h.LStickYAxis=19]="LStickYAxis",h[h.RStickXAxis=20]="RStickXAxis",h[h.RStickYAxis=21]="RStickYAxis"}(H||(H={}));var k=m(11635);class l{static CreateDeviceEvent(h,d,m,j,A,b,w){switch(h){case o.Keyboard:return this._CreateKeyboardEvent(m,j,A,b);case o.Mouse:if(m===y.MouseWheelX||m===y.MouseWheelY||m===y.MouseWheelZ)return this._CreateWheelEvent(h,d,m,j,A,b);case o.Touch:return this._CreatePointerEvent(h,d,m,j,A,b,w);default:throw`Unable to generate event for device ${o[h]}`}}static _CreatePointerEvent(h,d,m,j,A,b,w){const a=this._CreateMouseEvent(h,d,m,j,A,b);h===o.Mouse?(a.deviceType=o.Mouse,a.pointerId=1,a.pointerType="mouse"):(a.deviceType=o.Touch,a.pointerId=w??d,a.pointerType="touch");let D=0;return D+=A.pollInput(h,d,y.LeftClick),D+=2*A.pollInput(h,d,y.RightClick),D+=4*A.pollInput(h,d,y.MiddleClick),a.buttons=D,m===y.Move?a.type="pointermove":m>=y.LeftClick&&m<=y.RightClick&&(a.type=1===j?"pointerdown":"pointerup",a.button=m-2),a}static _CreateWheelEvent(h,d,m,j,A,b){const w=this._CreateMouseEvent(h,d,m,j,A,b);switch(w.pointerId=1,w.type="wheel",w.deltaMode=k.e.DOM_DELTA_PIXEL,w.deltaX=0,w.deltaY=0,w.deltaZ=0,m){case y.MouseWheelX:w.deltaX=j;break;case y.MouseWheelY:w.deltaY=j;break;case y.MouseWheelZ:w.deltaZ=j}return w}static _CreateMouseEvent(h,d,m,j,A,b){const w=this._CreateEvent(b),a=A.pollInput(h,d,y.Horizontal),D=A.pollInput(h,d,y.Vertical);return b?(w.movementX=0,w.movementY=0,w.offsetX=w.movementX-b.getBoundingClientRect().x,w.offsetY=w.movementY-b.getBoundingClientRect().y):(w.movementX=A.pollInput(h,d,10),w.movementY=A.pollInput(h,d,11),w.offsetX=0,w.offsetY=0),this._CheckNonCharacterKeys(w,A),w.clientX=a,w.clientY=D,w.x=a,w.y=D,w.deviceType=h,w.deviceSlot=d,w.inputIndex=m,w}static _CreateKeyboardEvent(h,d,m,j){const A=this._CreateEvent(j);return this._CheckNonCharacterKeys(A,m),A.deviceType=o.Keyboard,A.deviceSlot=0,A.inputIndex=h,A.type=1===d?"keydown":"keyup",A.key=String.fromCharCode(h),A.keyCode=h,A}static _CheckNonCharacterKeys(h,d){const m=d.isDeviceAvailable(o.Keyboard),j=m&&1===d.pollInput(o.Keyboard,0,18),A=m&&1===d.pollInput(o.Keyboard,0,17),b=m&&(1===d.pollInput(o.Keyboard,0,91)||1===d.pollInput(o.Keyboard,0,92)||1===d.pollInput(o.Keyboard,0,93)),w=m&&1===d.pollInput(o.Keyboard,0,16);h.altKey=j,h.ctrlKey=A,h.metaKey=b,h.shiftKey=w}static _CreateEvent(h){const d={preventDefault:()=>{}};return d.target=h,d}}class K{constructor(h,d,m){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(h,d,((h,d,j,A)=>{const b=l.CreateDeviceEvent(h,d,j,A,this);m(h,d,b)})):this._createDummyNativeInput()}pollInput(h,d,m){return this._nativeInput.pollInput(h,d,m)}isDeviceAvailable(h){return h===o.Mouse||h===o.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const N=Object.keys(y).length/2;class W{constructor(h,d,m,A){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=j.e.IsSafari(),this._usingMacOs=(0,B.h)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=h=>{},this._keyboardUpEvent=h=>{},this._keyboardBlurEvent=h=>{},this._pointerMoveEvent=h=>{},this._pointerDownEvent=h=>{},this._pointerUpEvent=h=>{},this._pointerCancelEvent=h=>{},this._pointerCancelTouch=h=>{},this._pointerLeaveEvent=h=>{},this._pointerWheelEvent=h=>{},this._pointerBlurEvent=h=>{},this._pointerMacOsChromeOutEvent=h=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,B.h)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,B.h)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=h=>{},this._gamepadDisconnectedEvent=h=>{},this._eventPrefix=j.e.GetPointerPrefix(h),this._engine=h,this._onDeviceConnected=d,this._onDeviceDisconnected=m,this._onInputChanged=A,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOs&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(h,d,m){const A=this._inputs[h][d];if(!A)throw`Unable to find device ${o[h]}`;h>=o.DualShock&&h<=o.DualSense&&this._updateDevice(h,d,m);const b=A[m];if(void 0===b)throw`Unable to find input ${m} for device ${o[h]} in slot ${d}`;return m===y.Move&&j.e.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),b}isDeviceAvailable(h){return void 0!==this._inputs[h]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const h=null===this||void 0===this?void 0:this._engine.getInputElement();if(h&&(!this._eventsAttached||this._elementToAttachTo!==h)){if(this._disableEvents(),this._inputs)for(const h of this._inputs)if(h)for(const d in h){const m=h[+d];if(m)for(let h=0;h<m.length;h++)m[h]=0}this._elementToAttachTo=h,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOs&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const h=navigator.getGamepads();for(const d of h)d&&this._addGamePad(d)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(o.Mouse,0,0,0)}_addGamePad(h){const d=this._getGamepadDeviceType(h.id),m=h.index;this._gamepads=this._gamepads||new Array(h.index+1),this._registerDevice(d,m,h.buttons.length+h.axes.length),this._gamepads[m]=d}_addPointerDevice(h,d,m,j){this._pointerActive||(this._pointerActive=!0),this._registerDevice(h,d,N);const A=this._inputs[h][d];A[0]=m,A[1]=j}_registerDevice(h,d,m){if(void 0===d)throw`Unable to register device ${o[h]} to undefined slot.`;if(this._inputs[h]||(this._inputs[h]={}),!this._inputs[h][d]){const j=new Array(m);j.fill(0),this._inputs[h][d]=j,this._onDeviceConnected(h,d)}}_unregisterDevice(h,d){this._inputs[h][d]&&(delete this._inputs[h][d],this._onDeviceDisconnected(h,d))}_handleKeyActions(){this._keyboardDownEvent=h=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(o.Keyboard,0,255));const d=this._inputs[o.Keyboard][0];if(d){d[h.keyCode]=1;const m=h;m.inputIndex=h.keyCode,this._usingMacOs&&h.metaKey&&"Meta"!==h.key&&(this._metaKeys.includes(h.keyCode)||this._metaKeys.push(h.keyCode)),this._onInputChanged(o.Keyboard,0,m)}},this._keyboardUpEvent=h=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(o.Keyboard,0,255));const d=this._inputs[o.Keyboard][0];if(d){d[h.keyCode]=0;const m=h;if(m.inputIndex=h.keyCode,this._usingMacOs&&"Meta"===h.key&&this._metaKeys.length>0){for(const h of this._metaKeys){const m=l.CreateDeviceEvent(o.Keyboard,0,h,0,this,this._elementToAttachTo);d[h]=0,this._onInputChanged(o.Keyboard,0,m)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(o.Keyboard,0,m)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const h=this._inputs[o.Keyboard][0];for(let d=0;d<h.length;d++)if(0!==h[d]){h[d]=0;const m=l.CreateDeviceEvent(o.Keyboard,0,d,0,this,this._elementToAttachTo);this._onInputChanged(o.Keyboard,0,m)}this._usingMacOs&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,B.h)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let j=0;j<this._maxTouchPoints;j++)this._activeTouchIds[j]=-1;this._pointerMoveEvent=h=>{const d=this._getPointerType(h);let m=d===o.Mouse?0:this._activeTouchIds.indexOf(h.pointerId);if(d===o.Touch&&-1===m){const A=this._activeTouchIds.indexOf(-1);if(!(A>=0))return void j.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);m=A,this._activeTouchIds[A]=h.pointerId,this._onDeviceConnected(d,m)}this._inputs[d]||(this._inputs[d]={}),this._inputs[d][m]||this._addPointerDevice(d,m,h.clientX,h.clientY);const A=this._inputs[d][m];if(A){const j=h;j.inputIndex=y.Move,A[y.Horizontal]=h.clientX,A[y.Vertical]=h.clientY,d===o.Touch&&0===A[y.LeftClick]&&(A[y.LeftClick]=1),void 0===h.pointerId&&(h.pointerId=this._mouseId),this._onInputChanged(d,m,j),this._usingSafari||-1===h.button||(j.inputIndex=h.button+2,A[h.button+2]=A[h.button+2]?0:1,this._onInputChanged(d,m,j))}},this._pointerDownEvent=h=>{const d=this._getPointerType(h);let m=d===o.Mouse?0:h.pointerId;if(d===o.Touch){let d=this._activeTouchIds.indexOf(h.pointerId);if(-1===d&&(d=this._activeTouchIds.indexOf(-1)),!(d>=0))return void j.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);m=d,this._activeTouchIds[d]=h.pointerId}this._inputs[d]||(this._inputs[d]={}),this._inputs[d][m]?d===o.Touch&&this._onDeviceConnected(d,m):this._addPointerDevice(d,m,h.clientX,h.clientY);const A=this._inputs[d][m];if(A){const j=A[y.Horizontal],w=A[y.Vertical];if(d===o.Mouse){if(void 0===h.pointerId&&(h.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(b){}}else if(h.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(h.pointerId)}catch(b){}A[y.Horizontal]=h.clientX,A[y.Vertical]=h.clientY,A[h.button+2]=1;const a=h;a.inputIndex=h.button+2,this._onInputChanged(d,m,a),j===h.clientX&&w===h.clientY||(a.inputIndex=y.Move,this._onInputChanged(d,m,a))}},this._pointerUpEvent=h=>{var d;const m=this._getPointerType(h),j=m===o.Mouse?0:this._activeTouchIds.indexOf(h.pointerId);if(m===o.Touch){if(-1===j)return;this._activeTouchIds[j]=-1}const A=null===(d=this._inputs[m])||void 0===d?void 0:d[j];let b=h.button,w=A&&0!==A[b+2];if(!w&&this._isUsingFirefox&&this._usingMacOs&&A&&(b=2===b?0:2,w=0!==A[b+2]),w){var a,D,S,M;const d=A[y.Horizontal],w=A[y.Vertical];A[y.Horizontal]=h.clientX,A[y.Vertical]=h.clientY,A[b+2]=0;const q=h;void 0===h.pointerId&&(h.pointerId=this._mouseId),d===h.clientX&&w===h.clientY||(q.inputIndex=y.Move,this._onInputChanged(m,j,q)),q.inputIndex=b+2,m===o.Mouse&&this._mouseId>=0&&null!==(a=(D=this._elementToAttachTo).hasPointerCapture)&&void 0!==a&&a.call(D,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):h.pointerId&&null!==(S=(M=this._elementToAttachTo).hasPointerCapture)&&void 0!==S&&S.call(M,h.pointerId)&&this._elementToAttachTo.releasePointerCapture(h.pointerId),this._onInputChanged(m,j,q),m===o.Touch&&this._onDeviceDisconnected(m,j)}},this._pointerCancelTouch=h=>{var d,m;const j=this._activeTouchIds.indexOf(h);if(-1===j)return;null!==(d=(m=this._elementToAttachTo).hasPointerCapture)&&void 0!==d&&d.call(m,h)&&this._elementToAttachTo.releasePointerCapture(h),this._inputs[o.Touch][j][y.LeftClick]=0;const A=l.CreateDeviceEvent(o.Touch,j,y.LeftClick,0,this,this._elementToAttachTo,h);this._onInputChanged(o.Touch,j,A),this._activeTouchIds[j]=-1,this._onDeviceDisconnected(o.Touch,j)},this._pointerCancelEvent=h=>{if("mouse"===h.pointerType){var d,m;const h=this._inputs[o.Mouse][0];this._mouseId>=0&&null!==(d=(m=this._elementToAttachTo).hasPointerCapture)&&void 0!==d&&d.call(m,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let d=y.LeftClick;d<=y.BrowserForward;d++)if(1===h[d]){h[d]=0;const m=l.CreateDeviceEvent(o.Mouse,0,d,0,this,this._elementToAttachTo);this._onInputChanged(o.Mouse,0,m)}}else this._pointerCancelTouch(h.pointerId)},this._pointerLeaveEvent=h=>{"pen"===h.pointerType&&this._pointerCancelTouch(h.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let h=!1;const d=function(){};try{const m=Object.defineProperty({},"passive",{get:function(){h=!0}});this._elementToAttachTo.addEventListener("test",d,m),this._elementToAttachTo.removeEventListener("test",d,m)}catch(m){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(o.Mouse)){var h,d;const m=this._inputs[o.Mouse][0];this._mouseId>=0&&null!==(h=(d=this._elementToAttachTo).hasPointerCapture)&&void 0!==h&&h.call(d,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let h=y.LeftClick;h<=y.BrowserForward;h++)if(1===m[h]){m[h]=0;const d=l.CreateDeviceEvent(o.Mouse,0,h,0,this,this._elementToAttachTo);this._onInputChanged(o.Mouse,0,d)}}if(this.isDeviceAvailable(o.Touch)){const h=this._inputs[o.Touch];for(let d=0;d<this._activeTouchIds.length;d++){var m,j,A;const b=this._activeTouchIds[d];if(null!==(m=(j=this._elementToAttachTo).hasPointerCapture)&&void 0!==m&&m.call(j,b)&&this._elementToAttachTo.releasePointerCapture(b),-1!==b&&1===(null===(A=h[d])||void 0===A?void 0:A[y.LeftClick])){h[d][y.LeftClick]=0;const m=l.CreateDeviceEvent(o.Touch,d,y.LeftClick,0,this,this._elementToAttachTo,b);this._onInputChanged(o.Touch,d,m),this._activeTouchIds[d]=-1,this._onDeviceDisconnected(o.Touch,d)}}}},this._pointerWheelEvent=h=>{const d=o.Mouse;this._inputs[d]||(this._inputs[d]=[]),this._inputs[d][0]||(this._pointerActive=!0,this._registerDevice(d,0,N));const m=this._inputs[d][0];if(m){m[y.MouseWheelX]=h.deltaX||0,m[y.MouseWheelY]=h.deltaY||h.wheelDelta||0,m[y.MouseWheelZ]=h.deltaZ||0;const j=h;void 0===h.pointerId&&(h.pointerId=this._mouseId),0!==m[y.MouseWheelX]&&(j.inputIndex=y.MouseWheelX,this._onInputChanged(d,0,j)),0!==m[y.MouseWheelY]&&(j.inputIndex=y.MouseWheelY,this._onInputChanged(d,0,j)),0!==m[y.MouseWheelZ]&&(j.inputIndex=y.MouseWheelZ,this._onInputChanged(d,0,j))}},this._usingMacOs&&this._isUsingChromium&&(this._pointerMacOsChromeOutEvent=h=>{h.buttons>1&&this._pointerCancelEvent(h)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!h&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(o.Mouse)){const h=this._inputs[o.Mouse][0];h[y.MouseWheelX]=0,h[y.MouseWheelY]=0,h[y.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=h=>{this._addGamePad(h.gamepad)},this._gamepadDisconnectedEvent=h=>{if(this._gamepads){const d=this._getGamepadDeviceType(h.gamepad.id),m=h.gamepad.index;this._unregisterDevice(d,m),delete this._gamepads[m]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(h,d,m){const j=navigator.getGamepads()[d];if(j&&h===this._gamepads[d]){const A=this._inputs[h][d];m>=j.buttons.length?A[m]=j.axes[m-j.buttons.length].valueOf():A[m]=j.buttons[m].value}}_getGamepadDeviceType(h){return-1!==h.indexOf("054c")?-1!==h.indexOf("0ce6")?o.DualSense:o.DualShock:-1!==h.indexOf("Xbox One")||-1!==h.search("Xbox 360")||-1!==h.search("xinput")?o.Xbox:-1!==h.indexOf("057e")?o.Switch:o.Generic}_getPointerType(h){let d=o.Mouse;return("touch"===h.pointerType||"pen"===h.pointerType||h.touches)&&(d=o.Touch),d}}class r{constructor(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=d,this.deviceSlot=m,this.onInputChangedObservable=new b.e,this._deviceInputSystem=h}getInput(h){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,h)}}class Y{constructor(h){this._registeredManagers=new Array,this._refCount=0,this.registerManager=h=>{for(let d=0;d<this._devices.length;d++){const m=this._devices[d];for(const j in m){const m=+j;h._addDevice(new r(this._deviceInputSystem,d,m))}}this._registeredManagers.push(h)},this.unregisterManager=h=>{const d=this._registeredManagers.indexOf(h);d>-1&&this._registeredManagers.splice(d,1)};const d=Object.keys(o).length/2;this._devices=new Array(d);const m=(h,d)=>{this._devices[h]||(this._devices[h]=new Array),this._devices[h][d]||(this._devices[h][d]=d);for(const m of this._registeredManagers){const j=new r(this._deviceInputSystem,h,d);m._addDevice(j)}},j=(h,d)=>{var m;null!==(m=this._devices[h])&&void 0!==m&&m[d]&&delete this._devices[h][d];for(const j of this._registeredManagers)j._removeDevice(h,d)},A=(h,d,m)=>{if(m)for(const j of this._registeredManagers)j._onInputChanged(h,d,m)};"undefined"!==typeof _native?this._deviceInputSystem=new K(m,j,A):this._deviceInputSystem=new W(h,m,j,A)}dispose(){this._deviceInputSystem.dispose()}}class x{getDeviceSource(h,d){if(void 0===d){if(void 0===this._firstDevice[h])return null;d=this._firstDevice[h]}return this._devices[h]&&void 0!==this._devices[h][d]?this._devices[h][d]:null}getDeviceSources(h){return this._devices[h]?this._devices[h].filter((h=>!!h)):[]}constructor(h){const d=Object.keys(o).length/2;this._devices=new Array(d),this._firstDevice=new Array(d),this._engine=h,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new Y(h)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new b.e((h=>{for(const d of this._devices)if(d)for(const m of d)m&&this.onDeviceConnectedObservable.notifyObserver(h,m)})),this.onDeviceDisconnectedObservable=new b.e,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=h.pd.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.pd.remove(this._onDisposeObserver)}_addDevice(h){this._devices[h.deviceType]||(this._devices[h.deviceType]=[]),this._devices[h.deviceType][h.deviceSlot]||(this._devices[h.deviceType][h.deviceSlot]=h,this._updateFirstDevices(h.deviceType)),this.onDeviceConnectedObservable.notifyObservers(h)}_removeDevice(h,d){var m,j;const A=null===(m=this._devices[h])||void 0===m?void 0:m[d];this.onDeviceDisconnectedObservable.notifyObservers(A),null!==(j=this._devices[h])&&void 0!==j&&j[d]&&delete this._devices[h][d],this._updateFirstDevices(h)}_onInputChanged(h,d,m){var j,A;null===(j=this._devices[h])||void 0===j||null===(A=j[d])||void 0===A||A.onInputChangedObservable.notifyObservers(m)}_updateFirstDevices(h){switch(h){case o.Keyboard:case o.Mouse:this._firstDevice[h]=0;break;case o.Touch:case o.DualSense:case o.DualShock:case o.Xbox:case o.Switch:case o.Generic:{delete this._firstDevice[h];const d=this._devices[h];if(d)for(let m=0;m<d.length;m++)if(d[m]){this._firstDevice[h]=m;break}break}}}}var Q=m(11639);class t{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get Bj(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(h){this._singleClick=h}set Bj(h){this._doubleClick=h}set hasSwiped(h){this._hasSwiped=h}set ignore(h){this._ignore=h}}class U{constructor(h){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new S.h(0,0),this._previousStartingPointerPosition=new S.h(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=h||V.b.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(h){return this._meshUnderPointerId[h]||null}get unTranslatedPointer(){return new S.h(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(h){this._pointerX=h}get pointerY(){return this._pointerY}set pointerY(h){this._pointerY=h}_updatePointerPosition(h){const d=this._scene.getEngine().getInputElementClientRect();d&&(this._pointerX=h.clientX-d.left,this._pointerY=h.clientY-d.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(h,d){const m=this._scene,j=m.getEngine(),A=j.getInputElement();A&&(A.tabIndex=j.canvasTabIndex,m.doNotHandleCursors||(A.style.cursor=m.defaultCursor)),this._setCursorAndPointerOverMesh(h,d,m);for(const D of m._pointerMoveStage){var b;const m=!(null===(b=h=h||this._pickMove(d))||void 0===b||!b.pickedMesh);h=D.action(this._unTranslatedPointerX,this._unTranslatedPointerY,h,m,A)}const w=d.inputIndex>=y.MouseWheelX&&d.inputIndex<=y.MouseWheelZ?C.d.POINTERWHEEL:C.d.POINTERMOVE;let a;m.onPointerMove&&(h=h||this._pickMove(d),m.onPointerMove(d,h,w)),h?(a=new C.i(w,d,h),this._setRayOnPointerInfo(h,d)):(a=new C.i(w,d,null,this),this._movePointerInfo=a),m.onPointerObservable.hasObservers()&&m.onPointerObservable.notifyObservers(a,w)}_setRayOnPointerInfo(h,d){const m=this._scene;h&&Q.b._IsPickingAvailable&&(h.ray||(h.ray=m.createPickingRay(d.offsetX,d.offsetY,S.b.Identity(),m.activeCamera)))}_addCameraPointerObserver(h,d){return this._cameraObserverCount++,this._scene.onPointerObservable.add(h,d)}_removeCameraPointerObserver(h){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(h)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(h,d,m){const j=this._scene,A=new C.g(m,d,this._unTranslatedPointerX,this._unTranslatedPointerY);return h&&(A.originalPickingInfo=h,A.ray=h.ray,"xr-near"===d.pointerType&&h.originMesh&&(A.nearInteractionPickingInfo=h)),j.onPrePointerObservable.notifyObservers(A,m),!!A.skipOnPointerObservable}_pickMove(h){const d=this._scene,m=d.Fm(this._unTranslatedPointerX,this._unTranslatedPointerY,d.pointerMovePredicate,d.pointerMoveFastCheck,d.cameraToUseForPointers,d.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(m,h,d),m}_setCursorAndPointerOverMesh(h,d,m){const j=m.getEngine().getInputElement();if(null!==h&&void 0!==h&&h.pickedMesh){if(this.setPointerOverMesh(h.pickedMesh,d.pointerId,h,d),!m.doNotHandleCursors&&j&&this._pointerOverMesh){const h=this._pointerOverMesh._getActionManagerForTrigger();h&&h.hasPointerTriggers&&(j.style.cursor=h.hoverCursor||m.hoverCursor)}}else this.setPointerOverMesh(null,d.pointerId,h,d)}simulatePointerMove(h,d){const m=new PointerEvent("pointermove",d);m.inputIndex=y.Move,this._checkPrePointerObservable(h,m,C.d.POINTERMOVE)||this._processPointerMove(h,m)}simulatePointerDown(h,d){const m=new PointerEvent("pointerdown",d);m.inputIndex=m.button+2,this._checkPrePointerObservable(h,m,C.d.POINTERDOWN)||this._processPointerDown(h,m)}_processPointerDown(h,d){var m;const j=this._scene;if(null!==(m=h)&&void 0!==m&&m.pickedMesh){this._pickedDownMesh=h.pickedMesh;const m=h.pickedMesh._getActionManagerForTrigger();if(m){if(m.hasPickTriggers)switch(m.processTrigger(5,new I(h.pickedMesh,j.pointerX,j.pointerY,h.pickedMesh,d,h)),d.button){case 0:m.processTrigger(2,new I(h.pickedMesh,j.pointerX,j.pointerY,h.pickedMesh,d,h));break;case 1:m.processTrigger(4,new I(h.pickedMesh,j.pointerX,j.pointerY,h.pickedMesh,d,h));break;case 2:m.processTrigger(3,new I(h.pickedMesh,j.pointerX,j.pointerY,h.pickedMesh,d,h))}m.hasSpecificTrigger(8)&&window.setTimeout((()=>{const h=j.Fm(this._unTranslatedPointerX,this._unTranslatedPointerY,(h=>h.GD&&h.isVisible&&h.isReady()&&h.actionManager&&h.actionManager.hasSpecificTrigger(8)&&h===this._pickedDownMesh),!1,j.cameraToUseForPointers);null!==h&&void 0!==h&&h.pickedMesh&&m&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>U.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,m.processTrigger(8,I.CreateNew(h.pickedMesh,d)))}),U.LongPressDelay)}}else for(const w of j._pointerDownStage)h=w.action(this._unTranslatedPointerX,this._unTranslatedPointerY,h,d,!1);let A;const b=C.d.POINTERDOWN;h?(j.onPointerDown&&j.onPointerDown(d,h,b),A=new C.i(b,d,h),this._setRayOnPointerInfo(h,d)):A=new C.i(b,d,null,this),j.onPointerObservable.hasObservers()&&j.onPointerObservable.notifyObservers(A,b)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(h,d,m){const j=new PointerEvent("pointerup",d);j.inputIndex=y.Move;const A=new t;m?A.Bj=!0:A.singleClick=!0,this._checkPrePointerObservable(h,j,C.d.POINTERUP)||this._processPointerUp(h,j,A)}_processPointerUp(h,d,m){var j;const A=this._scene;if(null!==(j=h)&&void 0!==j&&j.pickedMesh){if(this._pickedUpMesh=h.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(A.onPointerPick&&A.onPointerPick(d,h),m.singleClick&&!m.ignore&&A.onPointerObservable.observers.length>this._cameraObserverCount)){const m=C.d.POINTERPICK,j=new C.i(m,d,h);this._setRayOnPointerInfo(h,d),A.onPointerObservable.notifyObservers(j,m)}const j=h.pickedMesh._getActionManagerForTrigger();if(j&&!m.ignore){j.processTrigger(7,I.CreateNew(h.pickedMesh,d,h)),!m.hasSwiped&&m.singleClick&&j.processTrigger(1,I.CreateNew(h.pickedMesh,d,h));const A=h.pickedMesh._getActionManagerForTrigger(6);m.Bj&&A&&A.processTrigger(6,I.CreateNew(h.pickedMesh,d,h))}}else if(!m.ignore)for(const b of A._pointerUpStage)h=b.action(this._unTranslatedPointerX,this._unTranslatedPointerY,h,d,m.Bj);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const h=this._pickedDownMesh._getActionManagerForTrigger(16);h&&h.processTrigger(16,I.CreateNew(this._pickedDownMesh,d))}if(!m.ignore){const j=new C.i(C.d.POINTERUP,d,h);if(this._setRayOnPointerInfo(h,d),A.onPointerObservable.notifyObservers(j,C.d.POINTERUP),A.onPointerUp&&A.onPointerUp(d,h,C.d.POINTERUP),!m.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let j=0;if(m.singleClick?j=C.d.POINTERTAP:m.Bj&&(j=C.d.POINTERDOUBLETAP),j){const m=new C.i(j,d,h);A.onPointerObservable.hasObservers()&&A.onPointerObservable.hasSpecificMask(j)&&A.onPointerObservable.notifyObservers(m,j)}}}}isPointerCaptured(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[h]}attachControl(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const A=this._scene,b=A.getEngine();j||(j=b.getInputElement()),this._alreadyAttached&&this.xq(),j&&(this._alreadyAttachedTo=j),this._deviceSourceManager=new x(b),this._initActionManager=h=>{if(!this._meshPickProceed){const d=A.skipPointerUpPicking||0===A._registeredActions&&!this._checkForPicking()&&!A.onPointerUp?null:A.Fm(this._unTranslatedPointerX,this._unTranslatedPointerY,A.pointerUpPredicate,A.pointerUpFastCheck,A.cameraToUseForPointers,A.pointerUpTrianglePredicate);this._currentPickResult=d,d&&(h=d.hit&&d.pickedMesh?d.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return h},this._delayedSimpleClick=(h,d,m)=>{if((Date.now()-this._previousStartingPointerTime>U.DoubleClickDelay&&!this._doubleClickOccured||h!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,d.singleClick=!0,d.ignore=!1,this._delayedClicks[h])){const d=this._delayedClicks[h].evt,m=C.d.POINTERTAP,j=new C.i(m,d,this._currentPickResult);A.onPointerObservable.hasObservers()&&A.onPointerObservable.hasSpecificMask(m)&&A.onPointerObservable.notifyObservers(j,m),this._delayedClicks[h]=null}},this._initClickEvent=(h,d,m,j)=>{const A=new t;this._currentPickResult=null;let b=null,w=h.hasSpecificMask(C.d.POINTERPICK)||d.hasSpecificMask(C.d.POINTERPICK)||h.hasSpecificMask(C.d.POINTERTAP)||d.hasSpecificMask(C.d.POINTERTAP)||h.hasSpecificMask(C.d.POINTERDOUBLETAP)||d.hasSpecificMask(C.d.POINTERDOUBLETAP);!w&&T&&(b=this._initActionManager(b,A),b&&(w=b.hasPickTriggers));let a=!1;if(w=w&&!this._isMultiTouchGesture,w){const w=m.button;if(A.hasSwiped=this._isPointerSwiping(),!A.hasSwiped){let M=!U.ExclusiveDoubleClickMode;if(M||(M=!h.hasSpecificMask(C.d.POINTERDOUBLETAP)&&!d.hasSpecificMask(C.d.POINTERDOUBLETAP),M&&!T.HasSpecificTrigger(6)&&(b=this._initActionManager(b,A),b&&(M=!b.hasSpecificTrigger(6)))),M)(Date.now()-this._previousStartingPointerTime>U.DoubleClickDelay||w!==this._previousButtonPressed)&&(A.singleClick=!0,j(A,this._currentPickResult),a=!0);else{const h={evt:m,clickInfo:A,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,w,A,j),U.DoubleClickDelay)};this._delayedClicks[w]=h}let q=h.hasSpecificMask(C.d.POINTERDOUBLETAP)||d.hasSpecificMask(C.d.POINTERDOUBLETAP);if(!q&&T.HasSpecificTrigger(6)&&(b=this._initActionManager(b,A),b&&(q=b.hasSpecificTrigger(6))),q)if(w===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<U.DoubleClickDelay&&!this._doubleClickOccured){if(A.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=w,U.ExclusiveDoubleClickMode){var D;if(this._delayedClicks[w])clearTimeout(null===(D=this._delayedClicks[w])||void 0===D?void 0:D.timeoutId),this._delayedClicks[w]=null;j(A,this._previousPickResult)}else j(A,this._currentPickResult);else{var S;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,A.Bj=!0,A.ignore=!1,U.ExclusiveDoubleClickMode&&this._delayedClicks[w])clearTimeout(null===(S=this._delayedClicks[w])||void 0===S?void 0:S.timeoutId),this._delayedClicks[w]=null;j(A,this._currentPickResult)}a=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=w}}a||j(A,this._currentPickResult)},this._onPointerMove=h=>{if(this._updatePointerPosition(h),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>U.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>U.DragMovementThreshold),b.isPointerLock&&b._verifyPointerLock(),this._checkPrePointerObservable(null,h,h.inputIndex>=y.MouseWheelX&&h.inputIndex<=y.MouseWheelZ?C.d.POINTERWHEEL:C.d.POINTERMOVE))return;if(!A.cameraToUseForPointers&&!A.activeCamera)return;if(A.nq)return void this._processPointerMove(new E.b,h);A.pointerMovePredicate||(A.pointerMovePredicate=h=>h.GD&&h.isVisible&&h.isReady()&&h.isEnabled()&&(h.enablePointerMoveEvents||A.constantlyUpdateMeshUnderPointer||null!==h._getActionManagerForTrigger())&&(!A.cameraToUseForPointers||0!==(A.cameraToUseForPointers.layerMask&h.layerMask)));const d=A._registeredActions>0||A.constantlyUpdateMeshUnderPointer?this._pickMove(h):null;this._processPointerMove(d,h)},this._onPointerDown=h=>{const d=this._activePointerIds.indexOf(-1);if(-1===d?this._activePointerIds.push(h.pointerId):this._activePointerIds[d]=h.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,U.ExclusiveDoubleClickMode)for(let j=0;j<this._delayedClicks.length;j++)if(this._delayedClicks[j])if(h.button===j){var m;clearTimeout(null===(m=this._delayedClicks[j])||void 0===m?void 0:m.timeoutId)}else{const h=this._delayedClicks[j].clickInfo;this._doubleClickOccured=!1,h.singleClick=!0,h.ignore=!1;const d=this._delayedClicks[j].evt,m=C.d.POINTERTAP,b=new C.i(m,d,this._currentPickResult);A.onPointerObservable.hasObservers()&&A.onPointerObservable.hasSpecificMask(m)&&A.onPointerObservable.notifyObservers(b,m),this._delayedClicks[j]=null}if(this._updatePointerPosition(h),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=h.button),A.preventDefaultOnPointerDown&&j&&(h.preventDefault(),j.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,h,C.d.POINTERDOWN))return;if(!A.cameraToUseForPointers&&!A.activeCamera)return;let b;this._pointerCaptures[h.pointerId]=!0,A.pointerDownPredicate||(A.pointerDownPredicate=h=>h.GD&&h.isVisible&&h.isReady()&&h.isEnabled()&&(!A.cameraToUseForPointers||0!==(A.cameraToUseForPointers.layerMask&h.layerMask))),this._pickedDownMesh=null,b=A.skipPointerDownPicking||0===A._registeredActions&&!this._checkForPicking()&&!A.onPointerDown?new E.b:A.Fm(this._unTranslatedPointerX,this._unTranslatedPointerY,A.pointerDownPredicate,A.pointerDownFastCheck,A.cameraToUseForPointers,A.pointerDownTrianglePredicate),this._processPointerDown(b,h)},this._onPointerUp=h=>{const d=this._activePointerIds.indexOf(h.pointerId);-1!==d&&(this._activePointerIds[d]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(h),A.preventDefaultOnPointerUp&&j&&(h.preventDefault(),j.focus()),this._initClickEvent(A.onPrePointerObservable,A.onPointerObservable,h,((d,m)=>{if(A.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!d.ignore)){if(this._checkPrePointerObservable(null,h,C.d.POINTERUP))return this._swipeButtonPressed===h.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===h.buttons&&(this._pointerCaptures[h.pointerId]=!1));d.hasSwiped||(d.singleClick&&A.onPrePointerObservable.hasSpecificMask(C.d.POINTERTAP)&&this._checkPrePointerObservable(null,h,C.d.POINTERTAP)&&(this._skipPointerTap=!0),d.Bj&&A.onPrePointerObservable.hasSpecificMask(C.d.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,h,C.d.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[h.pointerId]?(0===h.buttons&&(this._pointerCaptures[h.pointerId]=!1),(A.cameraToUseForPointers||A.activeCamera)&&(A.pointerUpPredicate||(A.pointerUpPredicate=h=>h.GD&&h.isVisible&&h.isReady()&&h.isEnabled()&&(!A.cameraToUseForPointers||0!==(A.cameraToUseForPointers.layerMask&h.layerMask))),!this._meshPickProceed&&(T&&T.HasTriggers||this._checkForPicking()||A.onPointerUp)&&this._initActionManager(null,d),m||(m=this._currentPickResult),this._processPointerUp(m,h,d),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===h.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===h.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=h=>{const d=c.b.KEYDOWN;if(A.onPreKeyboardObservable.hasObservers()){const m=new c.f(d,h);if(A.onPreKeyboardObservable.notifyObservers(m,d),m.skipOnKeyboardObservable)return}if(A.onKeyboardObservable.hasObservers()){const m=new c.i(d,h);A.onKeyboardObservable.notifyObservers(m,d)}A.actionManager&&A.actionManager.processTrigger(14,I.CreateNewFromScene(A,h))},this._onKeyUp=h=>{const d=c.b.KEYUP;if(A.onPreKeyboardObservable.hasObservers()){const m=new c.f(d,h);if(A.onPreKeyboardObservable.notifyObservers(m,d),m.skipOnKeyboardObservable)return}if(A.onKeyboardObservable.hasObservers()){const m=new c.i(d,h);A.onKeyboardObservable.notifyObservers(m,d)}A.actionManager&&A.actionManager.processTrigger(15,I.CreateNewFromScene(A,h))},this._deviceSourceManager.onDeviceConnectedObservable.add((j=>{j.deviceType===o.Mouse?j.onInputChangedObservable.add((A=>{this._originMouseEvent=A,A.inputIndex===y.LeftClick||A.inputIndex===y.MiddleClick||A.inputIndex===y.RightClick||A.inputIndex===y.BrowserBack||A.inputIndex===y.BrowserForward?d&&1===j.getInput(A.inputIndex)?this._onPointerDown(A):h&&0===j.getInput(A.inputIndex)&&this._onPointerUp(A):m&&(A.inputIndex===y.Move?this._onPointerMove(A):A.inputIndex!==y.MouseWheelX&&A.inputIndex!==y.MouseWheelY&&A.inputIndex!==y.MouseWheelZ||this._onPointerMove(A))})):j.deviceType===o.Touch?j.onInputChangedObservable.add((A=>{A.inputIndex===y.LeftClick&&(d&&1===j.getInput(A.inputIndex)?(this._onPointerDown(A),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):h&&0===j.getInput(A.inputIndex)&&(this._onPointerUp(A),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),m&&A.inputIndex===y.Move&&this._onPointerMove(A)})):j.deviceType===o.Keyboard&&j.onInputChangedObservable.add((h=>{"keydown"===h.type?this._onKeyDown(h):"keyup"===h.type&&this._onKeyUp(h)}))})),this._alreadyAttached=!0}xq(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m=arguments.length>2?arguments[2]:void 0,j=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[d]===h&&(!h||!h._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const A=this._meshUnderPointerId[d];let b;A&&(b=A._getActionManagerForTrigger(10),b&&b.processTrigger(10,new I(A,this._pointerX,this._pointerY,h,j,{pointerId:d}))),h?(this._meshUnderPointerId[d]=h,this._pointerOverMesh=h,b=h._getActionManagerForTrigger(9),b&&b.processTrigger(9,new I(h,this._pointerX,this._pointerY,h,j,{pointerId:d,pickResult:m}))):(delete this._meshUnderPointerId[d],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:h,pointerId:d})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(h){this._pointerOverMesh===h&&(this._pointerOverMesh=null),this._pickedDownMesh===h&&(this._pickedDownMesh=null),this._pickedUpMesh===h&&(this._pickedUpMesh=null);for(const d in this._meshUnderPointerId)this._meshUnderPointerId[d]===h&&delete this._meshUnderPointerId[d]}}U.DragMovementThreshold=10,U.LongPressDelay=500,U.DoubleClickDelay=300,U.ExclusiveDoubleClickMode=!1;var s=m(11536),J=m(11353),O=m(11434),n=m(11645),p=m(11150),e=m(11359),X=m(11073);class z{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.nq=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var u,P=m(11121),G=m(11080);!function(h){h[h.BackwardCompatible=0]="BackwardCompatible",h[h.Intermediate=1]="Intermediate",h[h.Aggressive=2]="Aggressive"}(u||(u={}));class hh{static DefaultMaterialFactory(h){throw(0,v.b)("Sb")}static CollisionCoordinatorFactory(){throw(0,v.b)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(h){h!==this._clearColor&&(this._clearColor=h,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(h){if(h!==this._performancePriority){switch(this._performancePriority=h,h){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.nq=!1,this.Qq=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.nq=!0,this.Qq=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.nq=!0,this.Qq=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(h)}}set forceWireframe(h){this._forceWireframe!==h&&(this._forceWireframe=h,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(h){this._skipFrustumClipping!==h&&(this._skipFrustumClipping=h)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(h){this._forcePointsCloud!==h&&(this._forcePointsCloud=h,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(h){this._environmentTexture!==h&&(this._environmentTexture=h,this.onEnvironmentTextureChangedObservable.notifyObservers(h),this.markAllMaterialsAsDirty(1))}getNodes(){let h=[];h=h.concat(this.meshes),h=h.concat(this.lights),h=h.concat(this.cameras),h=h.concat(this.transformNodes);for(const d of this.skeletons)h=h.concat(d.bones);return h}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(h){this._animationPropertiesOverride=h}set onDispose(h){this._onDisposeObserver&&this.pd.remove(this._onDisposeObserver),this._onDisposeObserver=this.pd.add(h)}set beforeRender(h){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),h&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(h))}set afterRender(h){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),h&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(h))}set beforeCameraRender(h){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(h)}set afterCameraRender(h){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(h)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(h){this._pointerPickingConfiguration.pointerDownPredicate=h}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(h){this._pointerPickingConfiguration.pointerUpPredicate=h}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(h){this._pointerPickingConfiguration.pointerMovePredicate=h}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(h){this._pointerPickingConfiguration.pointerDownFastCheck=h}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(h){this._pointerPickingConfiguration.pointerUpFastCheck=h}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(h){this._pointerPickingConfiguration.pointerMoveFastCheck=h}get nq(){return this._pointerPickingConfiguration.nq}set nq(h){this._pointerPickingConfiguration.nq=h}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(h){this._pointerPickingConfiguration.skipPointerDownPicking=h}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(h){this._pointerPickingConfiguration.skipPointerUpPicking=h}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return U.DragMovementThreshold}static set DragMovementThreshold(h){U.DragMovementThreshold=h}static get LongPressDelay(){return U.LongPressDelay}static set LongPressDelay(h){U.LongPressDelay=h}static get DoubleClickDelay(){return U.DoubleClickDelay}static set DoubleClickDelay(h){U.DoubleClickDelay=h}static get ExclusiveDoubleClickMode(){return U.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(h){U.ExclusiveDoubleClickMode=h}bindEyePosition(h){var d;let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(null===(d=this.activeCamera)||void 0===d?void 0:d.globalPosition)??S.i.ZeroReadOnly,b=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return S.d.Vector4[0].set(A.x,A.y,A.z,b?-1:1),h&&(j?h.setFloat3(m,S.d.Vector4[0].x,S.d.Vector4[0].y,S.d.Vector4[0].z):h.setVector4(m,S.d.Vector4[0])),S.d.Vector4[0]}finalizeSceneUbo(){const h=this.getSceneUniformBuffer(),d=this.bindEyePosition(null);return h.updateFloat4("vEyePosition",d.x,d.y,d.z,d.w),h.update(),h}set useRightHandedSystem(h){this._useRightHandedSystem!==h&&(this._useRightHandedSystem=h,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(h){this._currentStepId=h}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(h){this._fogEnabled!==h&&(this._fogEnabled=h,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(h){this._fogMode!==h&&(this._fogMode=h,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(h){this._shadowsEnabled!==h&&(this._shadowsEnabled=h,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(h){this._lightsEnabled!==h&&(this._lightsEnabled=h,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(h){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),h&&(this._unObserveActiveCameras=(0,X.i)(h,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=h}get activeCamera(){return this._activeCamera}set activeCamera(h){h!==this._activeCamera&&(this._activeCamera=h,this.onActiveCameraChanged.notifyObservers(this))}get _hasDefaultMaterial(){return hh.DefaultMaterialFactory!==hh._OriginalDefaultMaterialFactory}get defaultMaterial(){return this.Iq||(this.Iq=hh.DefaultMaterialFactory(this)),this.Iq}set defaultMaterial(h){this.Iq=h}set texturesEnabled(h){this._texturesEnabled!==h&&(this._texturesEnabled=h,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(h){if(this._frameGraph)return this._frameGraph=h,void(h||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=h,h&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph,this.activeCamera=null)}set skeletonsEnabled(h){this._skeletonsEnabled!==h&&(this._skeletonsEnabled=h,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=hh.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const h of this._transientComponents)h.register();this._transientComponents.length=0}}o(h){this._components.push(h),this._transientComponents.push(h);const d=h;d.addFromContainer&&d.serialize&&this._serializableComponents.push(d)}_getComponent(h){for(const d of this._components)if(d.name===h)return d;return null}get uniqueId(){return this._uniqueId}constructor(h,d){this._inputManager=new U(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Qq=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new J.f(.2,.2,.3,1),this.onClearColorChangedObservable=new b.e,this.ambientColor=new J.d(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new b.e,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.aE=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.sE=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.pd=new b.e,this._onDisposeObserver=null,this.onBeforeRenderObservable=new b.e,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new b.e,this.onAfterRenderCameraObservable=new b.e,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new b.e,this.onAfterAnimationsObservable=new b.e,this.onBeforeDrawPhaseObservable=new b.e,this.onAfterDrawPhaseObservable=new b.e,this.onReadyObservable=new b.e,this.onBeforeCameraRenderObservable=new b.e,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new b.e,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new b.e,this.onAfterActiveMeshesEvaluationObservable=new b.e,this.onBeforeParticlesRenderingObservable=new b.e,this.onAfterParticlesRenderingObservable=new b.e,this.onDataLoadedObservable=new b.e,this.onNewCameraAddedObservable=new b.e,this.onCameraRemovedObservable=new b.e,this.onNewLightAddedObservable=new b.e,this.onLightRemovedObservable=new b.e,this.onNewGeometryAddedObservable=new b.e,this.onGeometryRemovedObservable=new b.e,this.onNewTransformNodeAddedObservable=new b.e,this.onTransformNodeRemovedObservable=new b.e,this.onNewMeshAddedObservable=new b.e,this.onMeshRemovedObservable=new b.e,this.onNewSkeletonAddedObservable=new b.e,this.onSkeletonRemovedObservable=new b.e,this.onNewMaterialAddedObservable=new b.e,this.onNewMultiMaterialAddedObservable=new b.e,this.onMaterialRemovedObservable=new b.e,this.onMultiMaterialRemovedObservable=new b.e,this.onNewTextureAddedObservable=new b.e,this.onTextureRemovedObservable=new b.e,this.onBeforeRenderTargetsRenderObservable=new b.e,this.onAfterRenderTargetsRenderObservable=new b.e,this.onBeforeStepObservable=new b.e,this.onAfterStepObservable=new b.e,this.onActiveCameraChanged=new b.e,this.onActiveCamerasChanged=new b.e,this.onBeforeRenderingGroupObservable=new b.e,this.onAfterRenderingGroupObservable=new b.e,this.onMeshImportedObservable=new b.e,this.onAnimationFileImportedObservable=new b.e,this.onEnvironmentTextureChangedObservable=new b.e,this.onMeshUnderPointerUpdatedObservable=new b.e,this._registeredForLateAnimationBindings=new w.c(256),this._pointerPickingConfiguration=new z,this.onPrePointerObservable=new b.e,this.onPointerObservable=new b.e,this.onPreKeyboardObservable=new b.e,this.onKeyboardObservable=new b.e,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=hh.FOGMODE_NONE,this.fogColor=new J.d(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new S.i(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new w.c(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new s.b,this._activeIndices=new s.b,this._activeParticles=new s.b,this._activeBones=new s.b,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=[],this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new w.e(256),this._processedMaterials=new w.e(256),this._renderTargets=new w.c(256),this._materialsRenderTargets=new w.c(256),this._activeParticleSystems=new w.e(256),this._activeSkeletons=new w.c(32),this._softwareSkinnedMeshes=new w.c(32),this._activeAnimatables=new Array,this._transformMatrix=S.b.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=L.c.Create(),this._beforeClearStage=L.c.Create(),this._beforeRenderTargetClearStage=L.c.Create(),this._gatherRenderTargetsStage=L.c.Create(),this._gatherActiveCameraRenderTargetsStage=L.c.Create(),this._isReadyForMeshStage=L.c.Create(),this._beforeEvaluateActiveMeshStage=L.c.Create(),this._evaluateSubMeshStage=L.c.Create(),this._preActiveMeshStage=L.c.Create(),this._cameraDrawRenderTargetStage=L.c.Create(),this._beforeCameraDrawStage=L.c.Create(),this._beforeRenderTargetDrawStage=L.c.Create(),this._beforeRenderingGroupDrawStage=L.c.Create(),this._beforeRenderingMeshStage=L.c.Create(),this._afterRenderingMeshStage=L.c.Create(),this._afterRenderingGroupDrawStage=L.c.Create(),this._afterCameraDrawStage=L.c.Create(),this._afterCameraPostProcessStage=L.c.Create(),this._afterRenderTargetDrawStage=L.c.Create(),this._afterRenderTargetPostProcessStage=L.c.Create(),this._afterRenderStage=L.c.Create(),this._pointerMoveStage=L.c.Create(),this._pointerDownStage=L.c.Create(),this._pointerUpStage=L.c.Create(),this._geometriesByUniqueId=null,this._uniqueId=0,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[],this._uniqueId=this.getUniqueId();const m={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...d};h=this._engine=h||V.b.LastCreatedEngine,m.virtual?h._virtualScenes.push(this):(V.b._LastCreatedScene=this,h.scenes.push(this)),this._uid=null,this._renderingManager=new Z.d(this),R.e&&(this.postProcessManager=new R.e(this)),(0,B.j)()&&this.attachControl(),this._createUbo(),M.d&&(this._imageProcessingConfiguration=new M.d),this.setDefaultCandidateProviders(),m.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=m.useMaterialMeshMap,this.useClonedMeshMap=m.useClonedMeshMap,d&&d.virtual||h.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(h){return this._defaultSubMeshCandidates.data=h.Ab,this._defaultSubMeshCandidates.length=h.Ab.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=h=>this._getDefaultSubMeshCandidates(h),this.getIntersectingSubMeshCandidates=(h,d)=>this._getDefaultSubMeshCandidates(h),this.getCollidingSubMeshCandidates=(h,d)=>this._getDefaultSubMeshCandidates(h)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(h){this._inputManager.pointerX=h}get pointerY(){return this._inputManager.pointerY}set pointerY(h){this._inputManager.pointerY=h}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(h,d){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==d||this._cachedMaterial!==h||this._cachedVisibility!==m}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(h,d){return this._inputManager.simulatePointerMove(h,d),this}simulatePointerDown(h,d){return this._inputManager.simulatePointerDown(h,d),this}simulatePointerUp(h,d,m){return this._inputManager.simulatePointerUp(h,d,m),this}isPointerCaptured(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(h)}attachControl(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(h,d,m)}xq(){this._inputManager.xq()}isReady(){var h,d;let m,j=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const A=this.getEngine(),b=A.currentRenderPassId;A.currentRenderPassId=(null===(h=this.activeCamera)||void 0===h?void 0:h.renderPassId)??b;let w=!0;for(this._pendingData.length>0&&(w=!1),null===(d=this.prePassRenderer)||void 0===d||d.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&w&&(w=this.depthPeelingRenderer.isReady()),j&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),m=0;m<this.meshes.length;m++){const h=this.meshes[m];if(!h.Ab||0===h.Ab.length)continue;if(!h.isReady(!0)){w=!1;continue}const d=h.hasThinInstances||"InstancedMesh"===h.getClassName()||"InstancedLinesMesh"===h.getClassName()||A.getCaps().instancedArrays&&h.instances.length>0;for(const m of this._isReadyForMeshStage)m.action(h,d)||(w=!1);if(!j)continue;const b=h.material||this.defaultMaterial;if(b)if(b._storeEffectOnSubMeshes)for(const m of h.Ab){const h=m.Qh();h&&h.hasRenderTargetTextures&&null!=h.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(h)&&(this._processedMaterials.push(h),this._materialsRenderTargets.concatWithNoDuplicate(h.getRenderTargetTextures()))}else b.hasRenderTargetTextures&&null!=b.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(b)&&(this._processedMaterials.push(b),this._materialsRenderTargets.concatWithNoDuplicate(b.getRenderTargetTextures()))}if(j)for(m=0;m<this._materialsRenderTargets.length;++m){this._materialsRenderTargets.data[m].isReadyForRendering()||(w=!1)}for(m=0;m<this.geometries.length;m++){2===this.geometries[m].delayLoadState&&(w=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const a of this.activeCameras)a.isReady(!0)||(w=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(w=!1));for(const a of this.aE)a.isReady()||(w=!1);if(this.layers)for(const a of this.layers)a.isReady()||(w=!1);if(this.effectLayers)for(const a of this.effectLayers)a.isLayerReady()||(w=!1);return A.areAllEffectsReady()||(w=!1),A.currentRenderPassId=b,w}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(h){this.onBeforeRenderObservable.add(h)}unregisterBeforeRender(h){this.onBeforeRenderObservable.removeCallback(h)}registerAfterRender(h){this.onAfterRenderObservable.add(h)}unregisterAfterRender(h){this.onAfterRenderObservable.removeCallback(h)}_executeOnceBeforeRender(h){const d=()=>{h(),setTimeout((()=>{this.unregisterBeforeRender(d)}))};this.registerBeforeRender(d)}executeOnceBeforeRender(h,d){void 0!==d?setTimeout((()=>{this._executeOnceBeforeRender(h)}),d):this._executeOnceBeforeRender(h)}addPendingData(h){this._pendingData.push(h)}removePendingData(h){const d=this.isLoading,m=this._pendingData.indexOf(h);-1!==m&&this._pendingData.splice(m,1),d&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(h),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(d)}async whenReadyAsync(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return await new Promise((d=>{this.executeWhenReady((()=>{d()}),h)}))}_checkIsReady(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(h)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(h)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=A.b.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(h,d,m,j){m||j||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===h.updateFlag&&this._projectionUpdateFlag===d.updateFlag||(this._viewUpdateFlag=h.updateFlag,this._projectionUpdateFlag=d.updateFlag,this._viewMatrix=h,this._projectionMatrix=d,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?O.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=O.b.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(m,j):this._sceneUbo.useUbo&&(this._sceneUbo.hb("viewProjection",this._transformMatrix),this._sceneUbo.hb("view",this._viewMatrix),this._sceneUbo.hb("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(h){const d=new q.d(this._engine,void 0,!1,h??"Fd");return d.addUniform("viewProjection",16),d.addUniform("view",16),d.addUniform("projection",16),d.addUniform("vEyePosition",4),d}setSceneUniformBuffer(h){this._sceneUbo=h,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return n.b.UniqueId}qM(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._blockEntityCollection&&(this.meshes.push(h),h._resyncLightSources(),h.parent||h._addToSceneRootNodes(),j.e.SetImmediate((()=>{this.onNewMeshAddedObservable.notifyObservers(h)})),d)){const d=h.getChildMeshes();for(const h of d)this.qM(h)}}MM(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const m=this.meshes.indexOf(h);if(-1!==m&&(this.meshes.splice(m,1),h.parent||h._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(h),this.onMeshRemovedObservable.notifyObservers(h),d){const d=h.getChildMeshes();for(const h of d)this.MM(h)}return m}addTransformNode(h){this._blockEntityCollection||h.ih()===this&&-1!==h._indexInSceneTransformNodesArray||(h._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(h),h.parent||h._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(h))}removeTransformNode(h){const d=h._indexInSceneTransformNodesArray;if(-1!==d){if(d!==this.transformNodes.length-1){const h=this.transformNodes[this.transformNodes.length-1];this.transformNodes[d]=h,h._indexInSceneTransformNodesArray=d}h._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),h.parent||h._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(h),d}removeSkeleton(h){const d=this.skeletons.indexOf(h);return-1!==d&&(this.skeletons.splice(d,1),this.onSkeletonRemovedObservable.notifyObservers(h),this._executeActiveContainerCleanup(this._activeSkeletons)),d}removeMorphTargetManager(h){const d=this.morphTargetManagers.indexOf(h);return-1!==d&&this.morphTargetManagers.splice(d,1),d}removeLight(h){const d=this.lights.indexOf(h);if(-1!==d){for(const d of this.meshes)d._removeLightSource(h,!1);this.lights.splice(d,1),this.sortLightsByPriority(),h.parent||h._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(h),d}removeCamera(h){const d=this.cameras.indexOf(h);if(-1!==d&&(this.cameras.splice(d,1),h.parent||h._removeFromSceneRootNodes()),this.activeCameras){const d=this.activeCameras.indexOf(h);-1!==d&&this.activeCameras.splice(d,1)}return this.activeCamera===h&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(h),d}removeParticleSystem(h){const d=this.aE.indexOf(h);return-1!==d&&(this.aE.splice(d,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),d}removeAnimation(h){const d=this.animations.indexOf(h);return-1!==d&&this.animations.splice(d,1),d}stopAnimation(h,d,m){}removeAnimationGroup(h){const d=this.animationGroups.indexOf(h);return-1!==d&&this.animationGroups.splice(d,1),d}removeMultiMaterial(h){const d=this.multiMaterials.indexOf(h);return-1!==d&&this.multiMaterials.splice(d,1),this.onMultiMaterialRemovedObservable.notifyObservers(h),d}removeMaterial(h){const d=h._indexInSceneMaterialArray;if(-1!==d&&d<this.materials.length){if(d!==this.materials.length-1){const h=this.materials[this.materials.length-1];this.materials[d]=h,h._indexInSceneMaterialArray=d}h._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(h),d}removeActionManager(h){const d=this.actionManagers.indexOf(h);return-1!==d&&this.actionManagers.splice(d,1),d}removeTexture(h){const d=this.textures.indexOf(h);return-1!==d&&this.textures.splice(d,1),this.onTextureRemovedObservable.notifyObservers(h),d}addLight(h){if(!this._blockEntityCollection){this.lights.push(h),this.sortLightsByPriority(),h.parent||h._addToSceneRootNodes();for(const d of this.meshes)-1===d.lightSources.indexOf(h)&&(d.lightSources.push(h),d._resyncLightSources());j.e.SetImmediate((()=>{this.onNewLightAddedObservable.notifyObservers(h)}))}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(e.d.CompareLightsPriority)}addCamera(h){this._blockEntityCollection||(this.cameras.push(h),j.e.SetImmediate((()=>{this.onNewCameraAddedObservable.notifyObservers(h)})),h.parent||h._addToSceneRootNodes())}addSkeleton(h){this._blockEntityCollection||(this.skeletons.push(h),j.e.SetImmediate((()=>{this.onNewSkeletonAddedObservable.notifyObservers(h)})))}addParticleSystem(h){this._blockEntityCollection||this.aE.push(h)}addAnimation(h){this._blockEntityCollection||this.animations.push(h)}addAnimationGroup(h){this._blockEntityCollection||this.animationGroups.push(h)}addMultiMaterial(h){this._blockEntityCollection||(this.multiMaterials.push(h),j.e.SetImmediate((()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(h)})))}addMaterial(h){this._blockEntityCollection||h.ih()===this&&-1!==h._indexInSceneMaterialArray||(h._indexInSceneMaterialArray=this.materials.length,this.materials.push(h),j.e.SetImmediate((()=>{this.onNewMaterialAddedObservable.notifyObservers(h)})))}addMorphTargetManager(h){this._blockEntityCollection||this.morphTargetManagers.push(h)}addGeometry(h){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[h.uniqueId]=this.geometries.length),this.geometries.push(h))}addActionManager(h){this.actionManagers.push(h)}addTexture(h){this._blockEntityCollection||(this.textures.push(h),this.onNewTextureAddedObservable.notifyObservers(h))}switchActiveCamera(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.xq(),this.activeCamera=h,d&&h.attachControl())}setActiveCameraById(h){const d=this.getCameraById(h);return d?(this.activeCamera=d,d):null}setActiveCameraByName(h){const d=this.getCameraByName(h);return d?(this.activeCamera=d,d):null}getAnimationGroupByName(h){for(let d=0;d<this.animationGroups.length;d++)if(this.animationGroups[d].name===h)return this.animationGroups[d];return null}_getMaterial(h,d){for(let m=0;m<this.materials.length;m++){const h=this.materials[m];if(d(h))return h}if(h)for(let m=0;m<this.multiMaterials.length;m++){const h=this.multiMaterials[m];if(d(h))return h}return null}getMaterialByUniqueID(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getMaterialByUniqueId(h,d)}getMaterialByUniqueId(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(d,(d=>d.uniqueId===h))}getMaterialById(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(d,(d=>d.id===h))}getMaterialByName(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(d,(d=>d.name===h))}getLastMaterialById(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let m=this.materials.length-1;m>=0;m--)if(this.materials[m].id===h)return this.materials[m];if(d)for(let m=this.multiMaterials.length-1;m>=0;m--)if(this.multiMaterials[m].id===h)return this.multiMaterials[m];return null}getTextureByUniqueId(h){for(let d=0;d<this.textures.length;d++)if(this.textures[d].uniqueId===h)return this.textures[d];return null}getTextureByName(h){for(let d=0;d<this.textures.length;d++)if(this.textures[d].name===h)return this.textures[d];return null}getCameraById(h){for(let d=0;d<this.cameras.length;d++)if(this.cameras[d].id===h)return this.cameras[d];return null}getCameraByUniqueId(h){for(let d=0;d<this.cameras.length;d++)if(this.cameras[d].uniqueId===h)return this.cameras[d];return null}getCameraByName(h){for(let d=0;d<this.cameras.length;d++)if(this.cameras[d].name===h)return this.cameras[d];return null}getBoneById(h){for(let d=0;d<this.skeletons.length;d++){const m=this.skeletons[d];for(let d=0;d<m.bones.length;d++)if(m.bones[d].id===h)return m.bones[d]}return null}getBoneByName(h){for(let d=0;d<this.skeletons.length;d++){const m=this.skeletons[d];for(let d=0;d<m.bones.length;d++)if(m.bones[d].name===h)return m.bones[d]}return null}getLightByName(h){for(let d=0;d<this.lights.length;d++)if(this.lights[d].name===h)return this.lights[d];return null}getLightById(h){for(let d=0;d<this.lights.length;d++)if(this.lights[d].id===h)return this.lights[d];return null}getLightByUniqueId(h){for(let d=0;d<this.lights.length;d++)if(this.lights[d].uniqueId===h)return this.lights[d];return null}getParticleSystemById(h){for(let d=0;d<this.aE.length;d++)if(this.aE[d].id===h)return this.aE[d];return null}getGeometryById(h){for(let d=0;d<this.geometries.length;d++)if(this.geometries[d].id===h)return this.geometries[d];return null}_getGeometryByUniqueId(h){if(this._geometriesByUniqueId){const d=this._geometriesByUniqueId[h];if(void 0!==d)return this.geometries[d]}else for(let d=0;d<this.geometries.length;d++)if(this.geometries[d].uniqueId===h)return this.geometries[d];return null}getFrameGraphByName(h){for(let d=0;d<this.frameGraphs.length;d++)if(this.frameGraphs[d].name===h)return this.frameGraphs[d];return null}pushGeometry(h,d){return!(!d&&this._getGeometryByUniqueId(h.uniqueId))&&(this.addGeometry(h),j.e.SetImmediate((()=>{this.onNewGeometryAddedObservable.notifyObservers(h)})),!0)}removeGeometry(h){let d;if(this._geometriesByUniqueId){if(d=this._geometriesByUniqueId[h.uniqueId],void 0===d)return!1}else if(d=this.geometries.indexOf(h),d<0)return!1;if(d!==this.geometries.length-1){const h=this.geometries[this.geometries.length-1];h&&(this.geometries[d]=h,this._geometriesByUniqueId&&(this._geometriesByUniqueId[h.uniqueId]=d))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[h.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(h),!0}getGeometries(){return this.geometries}getMeshById(h){for(let d=0;d<this.meshes.length;d++)if(this.meshes[d].id===h)return this.meshes[d];return null}getMeshesById(h){return this.meshes.filter((function(d){return d.id===h}))}getTransformNodeById(h){for(let d=0;d<this.transformNodes.length;d++)if(this.transformNodes[d].id===h)return this.transformNodes[d];return null}getTransformNodeByUniqueId(h){for(let d=0;d<this.transformNodes.length;d++)if(this.transformNodes[d].uniqueId===h)return this.transformNodes[d];return null}getTransformNodesById(h){return this.transformNodes.filter((function(d){return d.id===h}))}getMeshByUniqueId(h){for(let d=0;d<this.meshes.length;d++)if(this.meshes[d].uniqueId===h)return this.meshes[d];return null}getLastMeshById(h){for(let d=this.meshes.length-1;d>=0;d--)if(this.meshes[d].id===h)return this.meshes[d];return null}getLastTransformNodeById(h){for(let d=this.transformNodes.length-1;d>=0;d--)if(this.transformNodes[d].id===h)return this.transformNodes[d];return null}getLastEntryById(h){let d;for(d=this.meshes.length-1;d>=0;d--)if(this.meshes[d].id===h)return this.meshes[d];for(d=this.transformNodes.length-1;d>=0;d--)if(this.transformNodes[d].id===h)return this.transformNodes[d];for(d=this.cameras.length-1;d>=0;d--)if(this.cameras[d].id===h)return this.cameras[d];for(d=this.lights.length-1;d>=0;d--)if(this.lights[d].id===h)return this.lights[d];return null}getNodeById(h){const d=this.getMeshById(h);if(d)return d;const m=this.getTransformNodeById(h);if(m)return m;const j=this.getLightById(h);if(j)return j;const A=this.getCameraById(h);if(A)return A;const b=this.getBoneById(h);return b||null}getNodeByName(h){const d=this.getMeshByName(h);if(d)return d;const m=this.getTransformNodeByName(h);if(m)return m;const j=this.getLightByName(h);if(j)return j;const A=this.getCameraByName(h);if(A)return A;const b=this.getBoneByName(h);return b||null}getMeshByName(h){for(let d=0;d<this.meshes.length;d++)if(this.meshes[d].name===h)return this.meshes[d];return null}getTransformNodeByName(h){for(let d=0;d<this.transformNodes.length;d++)if(this.transformNodes[d].name===h)return this.transformNodes[d];return null}getLastSkeletonById(h){for(let d=this.skeletons.length-1;d>=0;d--)if(this.skeletons[d].id===h)return this.skeletons[d];return null}getSkeletonByUniqueId(h){for(let d=0;d<this.skeletons.length;d++)if(this.skeletons[d].uniqueId===h)return this.skeletons[d];return null}getSkeletonById(h){for(let d=0;d<this.skeletons.length;d++)if(this.skeletons[d].id===h)return this.skeletons[d];return null}getSkeletonByName(h){for(let d=0;d<this.skeletons.length;d++)if(this.skeletons[d].name===h)return this.skeletons[d];return null}getMorphTargetManagerById(h){for(let d=0;d<this.morphTargetManagers.length;d++)if(this.morphTargetManagers[d].uniqueId===h)return this.morphTargetManagers[d];return null}getMorphTargetById(h){for(let d=0;d<this.morphTargetManagers.length;++d){const m=this.morphTargetManagers[d];for(let d=0;d<m.numTargets;++d){const j=m.getTarget(d);if(j.id===h)return j}}return null}getMorphTargetByName(h){for(let d=0;d<this.morphTargetManagers.length;++d){const m=this.morphTargetManagers[d];for(let d=0;d<m.numTargets;++d){const j=m.getTarget(d);if(j.name===h)return j}}return null}getPostProcessByName(h){for(let d=0;d<this.postProcesses.length;++d){const m=this.postProcesses[d];if(m.name===h)return m}return null}isActiveMesh(h){return-1!==this._activeMeshes.indexOf(h)}get uid(){return this._uid||(this._uid=j.e.RandomId()),this._uid}addExternalData(h,d){return this._externalData||(this._externalData=new a),this._externalData.add(h,d)}getExternalData(h){return this._externalData?this._externalData.get(h):null}getOrAddExternalDataWithFactory(h,d){return this._externalData||(this._externalData=new a),this._externalData.getOrAddWithFactory(h,d)}removeExternalData(h){return this._externalData.remove(h)}_evaluateSubMesh(h,d,m,j){if(j||h.isInFrustum(this._frustumPlanes)){for(const j of this._evaluateSubMeshStage)j.action(d,h);const m=h.Qh();null!==m&&void 0!==m&&(m.hasRenderTargetTextures&&null!=m.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(m)&&(this._processedMaterials.push(m),this._materialsRenderTargets.concatWithNoDuplicate(m.getRenderTargetTextures())),this._renderingManager.dispatch(h,d,m))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(h){this._preventFreeActiveMeshesAndRenderingGroups!==h&&(h&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=h)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let h=0;h<this.activeCameras.length;h++){const d=this.activeCameras[h];d&&d._activeMeshes&&d._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let h=0;h<this.textures.length;h++){const d=this.textures[h];d&&d.renderList&&d.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1?arguments[1]:void 0,m=arguments.length>2?arguments[2]:void 0,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=A,this._skipEvaluateActiveMeshesCompletely=h,j)for(let h=0;h<this._activeMeshes.length;h++)this._activeMeshes.data[h]._freeze();d&&d()}else m&&m("No active camera found")})),this}unfreezeActiveMeshes(){for(let h=0;h<this.meshes.length;h++){const d=this.meshes[h];d._internalAbstractMeshDataInfo&&(d._internalAbstractMeshDataInfo._isActive=!1)}for(let h=0;h<this._activeMeshes.length;h++)this._activeMeshes.data[h]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(h){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>h.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var h;if(this._activeMeshes.length>0)null===(h=this.activeCamera)||void 0===h||h._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const h=this._activeMeshes.length;for(let d=0;d<h;d++){this._activeMeshes.data[d].Zd()}}if(this._activeParticleSystems){const h=this._activeParticleSystems.length;for(let d=0;d<h;d++)this._activeParticleSystems.data[d].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const j of this._beforeEvaluateActiveMeshStage)j.action();const d=this.getActiveMeshCandidates(),m=d.length;for(let j=0;j<m;j++){const h=d.data[j];let m=h._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(m?m[1]=-1:(m=[h,-1],h._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,m)),h.isBlocked)continue;if(this._totalVertices.addCount(h.getTotalVertices(),!1),!h.isReady()||!h.isEnabled()||h.td.hasAZeroComponent)continue;h.Zd(),h.actionManager&&h.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(h);let A=this.customLODSelector?this.customLODSelector(h,this.activeCamera):h.getLOD(this.activeCamera);if(m[0]=A,m[1]=this._frameId,void 0!==A&&null!==A&&(A!==h&&0!==A.billboardMode&&A.Zd(),h._preActivate(),h.isVisible&&h.visibility>0&&0!==(h.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||h.Ga||h.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(h),this.activeCamera._activeMeshes.push(h),A!==h&&A._activate(this._renderId,!1);for(const d of this._preActiveMeshStage)d.action(h);h._activate(this._renderId,!1)&&(h.isAnInstance?h._internalAbstractMeshDataInfo._actAsRegularMesh&&(A=h):A._internalAbstractMeshDataInfo._onlyForInstances=!1,A._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(h,A)),h._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let h=0;h<this.aE.length;h++){const d=this.aE[h];if(!d.isStarted()||!d.k)continue;const m=d.k;m.position&&!m.isEnabled()||(this._activeParticleSystems.push(d),d.animate(),this._renderingManager.dispatchParticles(d))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(h){this._skeletonsEnabled&&h.skeleton&&(this._activeSkeletons.pushNoDuplicate(h.skeleton)&&(h.skeleton.prepare(),this._activeBones.addCount(h.skeleton.bones.length,!1)),h.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(h)&&this.frameGraph&&h.applySkeleton(h.skeleton))}_activeMesh(h,d){this._prepareSkeleton(d);let m=h.hasInstances||h.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||d.Ga;if(d&&d.Ab&&d.Ab.length>0){const j=this.getActiveSubMeshCandidates(d),A=j.length;m=m||1===A;for(let b=0;b<A;b++){const A=j.data[b];this._evaluateSubMesh(A,d,h,m)}}}updateTransformMatrix(h){const d=this.activeCamera;if(d)if(d._renderingMultiview){const m=d._rigCameras[0],j=d._rigCameras[1];this.setTransformMatrix(m.getViewMatrix(),m.getProjectionMatrix(h),j.getViewMatrix(),j.getProjectionMatrix(h))}else this.setTransformMatrix(d.getViewMatrix(),d.getProjectionMatrix(h))}_bindFrameBuffer(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._useCurrentFrameBuffer||(h&&h._multiviewTexture?h._multiviewTexture._bindFrameBuffer():h&&h.outputRenderTarget?h.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),d&&this._clearFrameBuffer(h)}_clearFrameBuffer(h){if(h&&h._multiviewTexture);else if(h&&h.outputRenderTarget&&!h._renderingMultiview){const d=h.outputRenderTarget;d.onClearObservable.hasObservers()?d.onClearObservable.notifyObservers(this._engine):d.skipInitialClear||h.isRightCamera||(this.Qq&&this._engine.clear(d.clearColor||this._clearColor,!d._cleared,!0,!0),d._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(h,d){var m;let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(h&&h._skipRendering)return;const b=this._engine;if(this._activeCamera=h,!this.activeCamera)throw new Error("Active camera not set");if(b.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&A){let d=!0;h._renderingMultiview&&h.outputRenderTarget&&(d=h.outputRenderTarget.skipInitialClear,this.Qq&&(this._defaultFrameBufferCleared=!1,h.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),h._renderingMultiview&&h.outputRenderTarget&&(h.outputRenderTarget.skipInitialClear=d)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let j=0;j<this._softwareSkinnedMeshes.length;j++){const h=this._softwareSkinnedMeshes.data[j];h.applySkeleton(h.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),h.customRenderTargets&&h.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(h.customRenderTargets),d&&d.customRenderTargets&&d.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(d.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const j of this._gatherActiveCameraRenderTargetsStage)j.action(this._renderTargets);let w=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){j.e.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let h=0;h<this._renderTargets.length;h++){const d=this._renderTargets.data[h];if(d._shouldRender()){this._renderId++;const h=d.activeCamera&&d.activeCamera!==this.activeCamera;d.render(h,this.dumpNextRenderTargets),w=!0}}j.e.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const h of this._cameraDrawRenderTargetStage)w=h.action(this.activeCamera)||w;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(m=h.outputRenderTarget)||void 0===m?void 0:m.renderPassId)??h.renderPassId??0,w&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||h._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const j of this._beforeCameraDrawStage)j.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),b.snapshotRendering&&1===b.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const j of this._afterCameraDrawStage)j.action(this.activeCamera);if(this.postProcessManager&&!h._multiviewTexture){const d=h.outputRenderTarget?h.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(h.isIntermediate,d)}for(const j of this._afterCameraPostProcessStage)j.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===h.cameraRigMode||h._renderingMultiview)return h._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(h,void 0,d),void this.onAfterRenderCameraObservable.notifyObservers(h);if(h._useMultiviewToSingleView)this._renderMultiviewToSingleView(h);else{this.onBeforeCameraRenderObservable.notifyObservers(h);for(let d=0;d<h._rigCameras.length;d++)this._renderForCamera(h._rigCameras[d],h)}this._activeCamera=h,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(h)}_checkIntersections(){for(let h=0;h<this._meshesForIntersections.length;h++){const d=this._meshesForIntersections.data[h];if(d.actionManager)for(let h=0;d.actionManager&&h<d.actionManager.actions.length;h++){const m=d.actionManager.actions[h];if(12===m.trigger||13===m.trigger){const h=m.getTriggerParameter(),j=h.mesh?h.mesh:h,A=j.intersectsMesh(d,h.usePreciseIntersection),b=d._intersectionsInProgress.indexOf(j);A&&-1===b?12===m.trigger?(m._executeCurrent(I.CreateNew(d,void 0,j)),d._intersectionsInProgress.push(j)):13===m.trigger&&d._intersectionsInProgress.push(j):!A&&b>-1&&(13===m.trigger&&m._executeCurrent(I.CreateNew(d,void 0,j)),d.actionManager.hasSpecificTrigger(13,(h=>{const d=h.mesh?h.mesh:h;return j===d}))&&13!==m.trigger||d._intersectionsInProgress.splice(b,1))}}}}_advancePhysicsEngineStep(h){}_animate(h){}animate(){if(this._engine.isDeterministicLockStep()){let h=Math.max(hh.MinDeltaTime,Math.min(this._engine.getDeltaTime(),hh.MaxDeltaTime))+this._timeAccumulator;const d=this._engine.getTimeStep(),m=1e3/d/1e3;let j=0;const A=this._engine.getLockstepMaxSteps();let b=Math.floor(h/d);for(b=Math.min(b,A);h>0&&j<b;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=d*m,this._animate(d),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(d),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,j++,h-=d;this._timeAccumulator=h<0?0:h}else{const h=this.useConstantAnimationDeltaTime?16:Math.max(hh.MinDeltaTime,Math.min(this._engine.getDeltaTime(),hh.MaxDeltaTime));this._animationRatio=.06*h,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(h)}}_clear(){(this.autoClearDepthAndStencil||this.Qq)&&this._engine.clear(this._clearColor,this.Qq||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(h){var d;if(null===h||void 0===h||!h.outputRenderTarget||null!==h&&void 0!==h&&h.isRigCamera||(h.outputRenderTarget._cleared=!1),null!==h&&void 0!==h&&null!==(d=h.rigCameras)&&void 0!==d&&d.length)for(let m=0;m<h.rigCameras.length;++m){const d=h.rigCameras[m].outputRenderTarget;d&&(d._cleared=!1)}}resetDrawCache(h){if(this.meshes)for(const d of this.meshes)d.resetDrawCache(h)}_renderWithFrameGraph(){var h;let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),d)for(const A of this.cameras)if(A.update(),0!==A.cameraRigMode)for(let h=0;h<A._rigCameras.length;h++)A._rigCameras[h].update();this.onBeforeRenderObservable.notifyObservers(this);for(const A of this._beforeClearStage)A.action();const m=this.getActiveMeshCandidates(),j=m.length;for(let A=0;A<j;A++){const h=m.data[A];h.isBlocked||(this._totalVertices.addCount(h.getTotalVertices(),!1),h.isReady()&&h.isEnabled()&&!h.td.hasAZeroComponent&&(h.Zd(),h.actionManager&&h.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(h)))}if(this.particlesEnabled)for(let A=0;A<this.aE.length;A++){const h=this.aE[A];if(!h.isStarted()||!h.k)continue;const d=h.k;d.position&&!d.isEnabled()||(this._activeParticleSystems.push(h),h.animate())}null===(h=this.frameGraph)||void 0===h||h.execute()}_renderRenderTarget(h,d){let m=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._intermediateRendering=!0,h._shouldRender()){if(this._renderId++,this.activeCamera=d,!this.activeCamera)throw new Error("Active camera not set");this._engine.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),h.render(m,j)}this._intermediateRendering=!1}render(){var h;let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],m=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.q){if(this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(h=this.activeCameras)&&void 0!==h&&h.length)for(const h of this.activeCameras)this._checkCameraRenderTarget(h);this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),m||this.animate();for(const h of this._beforeCameraUpdateStage)h.action();if(d)if(this.activeCameras&&this.activeCameras.length>0)for(let h=0;h<this.activeCameras.length;h++){const d=this.activeCameras[h];if(d.update(),0!==d.cameraRigMode)for(let h=0;h<d._rigCameras.length;h++)d._rigCameras[h].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let h=0;h<this.activeCamera._rigCameras.length;h++)this.activeCamera._rigCameras[h].update();if(this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(d,m);else{var A;this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const h=null!==(A=this.activeCameras)&&void 0!==A&&A.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){j.e.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(let d=0;d<this.customRenderTargets.length;d++){const m=this.customRenderTargets[d],j=m.activeCamera||this.activeCamera;this._renderRenderTarget(m,j,h!==j,this.dumpNextRenderTargets)}j.e.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}this._engine.currentRenderPassId=(null===h||void 0===h?void 0:h.renderPassId)??0,this.activeCamera=h,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const d of this._beforeClearStage)d.action();this._clearFrameBuffer(this.activeCamera);for(const d of this._gatherRenderTargetsStage)d.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let d=0;d<this.activeCameras.length;d++)this._processSubCameras(this.activeCameras[d],d>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const h of this._afterRenderStage)h.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let h=0;h<this._toBeDisposed.length;h++){const d=this._toBeDisposed[h];d&&d.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let h=0;h<this.materials.length;h++)this.materials[h].freeze()}unfreezeMaterials(){for(let h=0;h<this.materials.length;h++)this.materials[h].unfreeze()}dispose(){if(this.q)return;if(this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations){for(const h of this._activeAnimatables)h.onAnimationEndObservable.clear(),h.onAnimationEnd=null;this.stopAllAnimations()}this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const h=this._activeRequests.slice();for(const A of h)A.abort();this._activeRequests.length=0;try{this.pd.notifyObservers(this)}catch(j){P.c.Error("An error occurred while calling onDisposeObservable!",j)}this.xq();if(this._engine.getInputElement())for(let A=0;A<this.cameras.length;A++)this.cameras[A].xq();this._disposeList(this.animationGroups),this._disposeList(this.lights),this.Iq&&this.Iq.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,(h=>h.dispose(!0))),this._disposeList(this.transformNodes,(h=>h.dispose(!0)));const d=this.cameras;this._disposeList(d),this._disposeList(this.aE),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let m=this._engine.scenes.indexOf(this);if(m>-1&&this._engine.scenes.splice(m,1),V.b._LastCreatedScene===this){V.b._LastCreatedScene=null;let h=V.b.Instances.length-1;for(;h>=0;){const d=V.b.Instances[h];if(d.scenes.length>0){V.b._LastCreatedScene=d.scenes[this._engine.scenes.length-1];break}h--}}m=this._engine._virtualScenes.indexOf(this),m>-1&&this._engine._virtualScenes.splice(m,1),this._engine.wipeCaches(!0),this.pd.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(h,d){const m=h.slice(0);d=d??(h=>h.dispose());for(const j of m)d(j);h.length=0}get q(){return this._isDisposed}clearCachedVertexData(){for(let h=0;h<this.meshes.length;h++){const d=this.meshes[h].Ld;d&&d.clearCachedData()}}cleanCachedTextureBuffer(){for(const h of this.textures){h._buffer&&(h._buffer=null)}}getWorldExtends(h){const d=new S.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),m=new S.i(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);h=h||(()=>!0);const j=this.meshes.filter(h);for(const A of j){if(A.Zd(!0),!A.Ab||0===A.Ab.length||A.infiniteDistance)continue;const h=A.getBoundingInfo(),j=h.boundingBox.minimumWorld,b=h.boundingBox.maximumWorld;S.i.CheckExtends(j,d,m),S.i.CheckExtends(b,d,m)}return{min:d,max:m}}createPickingRay(h,d,m,j){throw(0,v.b)("Ray")}createPickingRayToRef(h,d,m,j,A){throw(0,v.b)("Ray")}createPickingRayInCameraSpace(h,d,m){throw(0,v.b)("Ray")}createPickingRayInCameraSpaceToRef(h,d,m,j){throw(0,v.b)("Ray")}Fm(h,d,m,j,A,b){const w=(0,v.b)("Ray",!0);return w&&P.c.Warn(w),new E.b}pickWithBoundingInfo(h,d,m,j,A){const b=(0,v.b)("Ray",!0);return b&&P.c.Warn(b),new E.b}pickWithRay(h,d,m,j){throw(0,v.b)("Ray")}multiPick(h,d,m,j,A){throw(0,v.b)("Ray")}multiPickWithRay(h,d,m){throw(0,v.b)("Ray")}setPointerOverMesh(h,d,m){this._inputManager.setPointerOverMesh(h,d,m)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const h of this.geometries)h._rebuild();for(const h of this.meshes)h._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const h of this._components)h.rebuild();for(const h of this.aE)h.rebuild();if(this.spriteManagers)for(const h of this.spriteManagers)h.rebuild()}_rebuildTextures(){for(const h of this.textures)h._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(h,d,m){if(void 0===d)return h;const j=[];for(const A in h){const b=h[A];D.e&&D.e.MatchesQuery(b,d)&&(!m||m(b))&&j.push(b)}return j}getMeshesByTags(h,d){return this._getByTags(this.meshes,h,d)}getCamerasByTags(h,d){return this._getByTags(this.cameras,h,d)}getLightsByTags(h,d){return this._getByTags(this.lights,h,d)}getMaterialByTags(h,d){return this._getByTags(this.materials,h,d).concat(this._getByTags(this.multiMaterials,h,d))}getTransformNodesByTags(h,d){return this._getByTags(this.transformNodes,h,d)}setRenderingOrder(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(h,d,m,j)}setRenderingAutoClearDepthStencil(h,d){let m=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(h,d,m,j)}getAutoClearDepthStencilSetup(h){return this._renderingManager.getAutoClearDepthStencilSetup(h)}_forceBlockMaterialDirtyMechanism(h){this._blockMaterialDirtyMechanism=h}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(h){this._blockMaterialDirtyMechanism!==h&&(this._blockMaterialDirtyMechanism=h,h||this.markAllMaterialsAsDirty(127))}markAllMaterialsAsDirty(h,d){if(!this._blockMaterialDirtyMechanism)for(const m of this.materials)d&&!d(m)||m.PS(h)}_loadFile(h,d,m,j,A,b,w){const a=(0,p.u)(h,d,m,j?this.offlineProvider:void 0,A,b,w);return this._activeRequests.push(a),a.onCompleteObservable.add((h=>{this._activeRequests.splice(this._activeRequests.indexOf(h),1)})),a}async _loadFileAsync(h,d,m,j,A){return await new Promise(((b,w)=>{this._loadFile(h,(h=>{b(h)}),d,m,j,((h,d)=>{w(d)}),A)}))}_requestFile(h,d,m,j,A,b,w){const a=(0,p.C)(h,d,m,j?this.offlineProvider:void 0,A,b,w);return this._activeRequests.push(a),a.onCompleteObservable.add((h=>{this._activeRequests.splice(this._activeRequests.indexOf(h),1)})),a}async _requestFileAsync(h,d,m,j,A){return await new Promise(((b,w)=>{this._requestFile(h,(h=>{b(h)}),d,m,j,(h=>{w(h)}),A)}))}_readFile(h,d,m,j,A){const b=(0,p.B)(h,d,m,j,A);return this._activeRequests.push(b),b.onCompleteObservable.add((h=>{this._activeRequests.splice(this._activeRequests.indexOf(h),1)})),b}async _readFileAsync(h,d,m){return await new Promise(((j,A)=>{this._readFile(h,(h=>{j(h)}),d,m,(h=>{A(h)}))}))}getPerfCollector(){throw(0,v.b)("performanceViewerSceneExtension")}setActiveCameraByID(h){return this.setActiveCameraById(h)}getMaterialByID(h){return this.getMaterialById(h)}getLastMaterialByID(h){return this.getLastMaterialById(h)}getTextureByUniqueID(h){return this.getTextureByUniqueId(h)}getCameraByID(h){return this.getCameraById(h)}getCameraByUniqueID(h){return this.getCameraByUniqueId(h)}getBoneByID(h){return this.getBoneById(h)}getLightByID(h){return this.getLightById(h)}getLightByUniqueID(h){return this.getLightByUniqueId(h)}getParticleSystemByID(h){return this.getParticleSystemById(h)}getGeometryByID(h){return this.getGeometryById(h)}getMeshByID(h){return this.getMeshById(h)}getMeshByUniqueID(h){return this.getMeshByUniqueId(h)}getLastMeshByID(h){return this.getLastMeshById(h)}getMeshesByID(h){return this.getMeshesById(h)}getTransformNodeByID(h){return this.getTransformNodeById(h)}getTransformNodeByUniqueID(h){return this.getTransformNodeByUniqueId(h)}getTransformNodesByID(h){return this.getTransformNodesById(h)}getNodeByID(h){return this.getNodeById(h)}getLastEntryByID(h){return this.getLastEntryById(h)}getLastSkeletonByID(h){return this.getLastSkeletonById(h)}}hh.FOGMODE_NONE=0,hh.FOGMODE_EXP=1,hh.FOGMODE_EXP2=2,hh.FOGMODE_LINEAR=3,hh.MinDeltaTime=1,hh.MaxDeltaTime=1e3,hh._OriginalDefaultMaterialFactory=hh.DefaultMaterialFactory,(0,G.i)("BABYLON.Scene",hh)},11461:(h,d,m)=>{m.d(d,{b:()=>j,c:()=>A});class j{}j.NAME_EFFECTLAYER="EffectLayer",j.NAME_LAYER="Layer",j.NAME_LENSFLARESYSTEM="LensFlareSystem",j.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",j.NAME_PARTICLESYSTEM="Rb",j.NAME_GAMEPAD="Gamepad",j.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",j.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",j.NAME_PREPASSRENDERER="PrePassRenderer",j.NAME_DEPTHRENDERER="DepthRenderer",j.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",j.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",j.NAME_SPRITE="Sprite",j.NAME_SUBSURFACE="SubSurface",j.NAME_OUTLINERENDERER="Outline",j.NAME_PROCEDURALTEXTURE="ProceduralTexture",j.NAME_SHADOWGENERATOR="ShadowGenerator",j.NAME_OCTREE="Zb",j.NAME_PHYSICSENGINE="PhysicsEngine",j.NAME_AUDIO="Audio",j.NAME_FLUIDRENDERER="FluidRenderer",j.NAME_IBLCDFGENERATOR="iblCDFGenerator",j.STEP_ISREADYFORMESH_EFFECTLAYER=0,j.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,j.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,j.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,j.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,j.STEP_BEFORECAMERADRAW_PREPASS=0,j.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,j.STEP_BEFORECAMERADRAW_LAYER=2,j.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,j.STEP_BEFORERENDERTARGETDRAW_LAYER=1,j.STEP_BEFORERENDERINGMESH_PREPASS=0,j.STEP_BEFORERENDERINGMESH_OUTLINE=1,j.STEP_AFTERRENDERINGMESH_PREPASS=0,j.STEP_AFTERRENDERINGMESH_OUTLINE=1,j.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,j.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,j.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,j.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,j.STEP_BEFORECLEAR_PREPASS=1,j.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,j.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,j.STEP_AFTERRENDERTARGETDRAW_LAYER=1,j.STEP_AFTERCAMERADRAW_PREPASS=0,j.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,j.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,j.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,j.STEP_AFTERCAMERADRAW_LAYER=4,j.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,j.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,j.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,j.STEP_AFTERRENDER_AUDIO=0,j.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,j.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,j.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,j.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,j.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,j.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,j.STEP_POINTERMOVE_SPRITE=0,j.STEP_POINTERDOWN_SPRITE=0,j.STEP_POINTERUP_SPRITE=0;class A extends Array{constructor(h){super(...h)}static Create(){return Object.create(A.prototype)}registerStep(h,d,m){let j=0,A=Number.MAX_VALUE;for(;j<this.length;j++){if(A=this[j].index,h<A)break}this.splice(j,0,{index:h,component:d,action:m.bind(d)})}clear(){this.length=0}}},11258:(h,d,m)=>{m.d(d,{d:()=>j});function j(h,d,m,j){var A,b=arguments.length,w=b<3?d:null===j?j=Object.getOwnPropertyDescriptor(d,m):j;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)w=Reflect.decorate(h,d,m,j);else for(var a=h.length-1;a>=0;a--)(A=h[a])&&(w=(b<3?A(w):b>3?A(d,m,w):A(d,m))||w);return b>3&&w&&Object.defineProperty(d,m,w),w}Object.create;Object.create}}]);