"use strict";(self.ufnpnb83drd=self.ufnpnb83drd||[]).push([[9],{12226:(E,U,g)=>{g.d(U,{c:()=>G,d:()=>Y,i:()=>t,g:()=>j,k:()=>Z});class N{constructor(){this.children=[]}isValid(E){return!0}process(E,U,g){let N="";if(this.line){let g=this.line;const B=U.processor;if(B){var L,D,S,u,s,C;B.lineProcessor&&(g=B.lineProcessor(g,U.isFragment,U.processingContext));const N=(null===(L=U.processor)||void 0===L?void 0:L.attributeKeywordName)??"attribute",P=U.isFragment&&null!==(D=U.processor)&&void 0!==D&&D.varyingFragmentKeywordName?null===(S=U.processor)||void 0===S?void 0:S.varyingFragmentKeywordName:!U.isFragment&&null!==(u=U.processor)&&void 0!==u&&u.varyingVertexKeywordName?null===(s=U.processor)||void 0===s?void 0:s.varyingVertexKeywordName:"varying";if(!U.isFragment&&B.attributeProcessor&&this.line.startsWith(N))g=B.attributeProcessor(this.line,E,U.processingContext);else if(B.varyingProcessor&&(null!==(C=B.varyingCheck)&&void 0!==C&&C.call(B,this.line,U.isFragment)||!B.varyingCheck&&this.line.startsWith(P)))g=B.varyingProcessor(this.line,U.isFragment,E,U.processingContext);else if(B.uniformProcessor&&B.uniformRegexp&&B.uniformRegexp.test(this.line))U.lookForClosingBracketForUniformBuffer||(g=B.uniformProcessor(this.line,U.isFragment,E,U.processingContext));else if(B.uniformBufferProcessor&&B.uniformBufferRegexp&&B.uniformBufferRegexp.test(this.line))U.lookForClosingBracketForUniformBuffer||(g=B.uniformBufferProcessor(this.line,U.isFragment,U.processingContext),U.lookForClosingBracketForUniformBuffer=!0);else if(B.textureProcessor&&B.textureRegexp&&B.textureRegexp.test(this.line))g=B.textureProcessor(this.line,U.isFragment,E,U.processingContext);else if((B.uniformProcessor||B.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!U.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?B.uniformProcessor&&(g=B.uniformProcessor(this.line,U.isFragment,E,U.processingContext)):B.uniformBufferProcessor&&(g=B.uniformBufferProcessor(this.line,U.isFragment,U.processingContext),U.lookForClosingBracketForUniformBuffer=!0)}U.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(U.lookForClosingBracketForUniformBuffer=!1,B.endOfUniformBufferProcessor&&(g=B.endOfUniformBufferProcessor(this.line,U.isFragment,U.processingContext)))}N+=g+"\n"}for(const B of this.children)N+=B.process(E,U,g);return this.additionalDefineKey&&(E[this.additionalDefineKey]=this.additionalDefineValue||"true",g[this.additionalDefineKey]=E[this.additionalDefineKey]),N}}class L{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(E){this._lines.length=0;for(const U of E){if(!U||"\r"===U)continue;if("#"===U[0]){this._lines.push(U);continue}const E=U.trim();if(!E)continue;if(E.startsWith("//")){this._lines.push(U);continue}const g=E.indexOf(";");if(-1===g)this._lines.push(E);else if(g===E.length-1)E.length>1&&this._lines.push(E);else{const E=U.split(";");for(let U=0;U<E.length;U++){let g=E[U];g&&(g=g.trim(),g&&this._lines.push(g+(U!==E.length-1?";":"")))}}}}}class D extends N{process(E,U,g){for(let N=0;N<this.children.length;N++){const L=this.children[N];if(L.isValid(E))return L.process(E,U,g)}return""}}class S extends N{isValid(E){return this.testExpression.isTrue(E)}}class u{isTrue(E){return!0}static postfixToInfix(E){const U=[];for(const g of E)if(void 0===u._OperatorPriority[g])U.push(g);else{const E=U[U.length-1],N=U[U.length-2];U.length-=2,U.push(`(${N}${g}${E})`)}return U[U.length-1]}static infixToPostfix(E){const U=u._InfixToPostfixCache.get(E);if(U)return U.accessTime=Date.now(),U.result;if(!E.includes("&&")&&!E.includes("||")&&!E.includes(")")&&!E.includes("("))return[E];const g=[];let N=-1;const L=()=>{B=B.trim(),""!==B&&(g.push(B),B="")},D=E=>{N<u._Stack.length-1&&(u._Stack[++N]=E)},S=()=>u._Stack[N],s=()=>-1===N?"!!INVALID EXPRESSION!!":u._Stack[N--];let C=0,B="";for(;C<E.length;){const U=E.charAt(C),P=C<E.length-1?E.substring(C,2+C):"";if("("===U)B="",D(U);else if(")"===U){for(L();-1!==N&&"("!==S();)g.push(s());s()}else if(u._OperatorPriority[P]>1){for(L();-1!==N&&u._OperatorPriority[S()]>=u._OperatorPriority[P];)g.push(s());D(P),C++}else B+=U;C++}for(L();-1!==N;)"("===S()?s():g.push(s());return u._InfixToPostfixCache.size>=u.InfixToPostfixCacheLimitSize&&u.ClearCache(),u._InfixToPostfixCache.set(E,{result:g,accessTime:Date.now()}),g}static ClearCache(){const E=Array.from(u._InfixToPostfixCache.entries()).sort(((E,U)=>E[1].accessTime-U[1].accessTime));for(let U=0;U<u.InfixToPostfixCacheCleanupSize;U++)u._InfixToPostfixCache.delete(E[U][0])}}u.InfixToPostfixCacheLimitSize=5e4,u.InfixToPostfixCacheCleanupSize=25e3,u._InfixToPostfixCache=new Map,u._OperatorPriority={")":0,"(":1,"||":2,"&&":3},u._Stack=["","","","","","","","","","","","","","","","","","","",""];class s extends u{constructor(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=E,this.not=U}isTrue(E){let U=void 0!==E[this.define];return this.not&&(U=!U),U}}class C extends u{isTrue(E){return this.leftOperand.isTrue(E)||this.rightOperand.isTrue(E)}}class B extends u{isTrue(E){return this.leftOperand.isTrue(E)&&this.rightOperand.isTrue(E)}}class P extends u{constructor(E,U,g){super(),this.define=E,this.operand=U,this.testValue=g}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(E){let U=!1;const g=parseInt(void 0!=E[this.define]?E[this.define]:this.define),N=parseInt(void 0!=E[this.testValue]?E[this.testValue]:this.testValue);if(isNaN(g)||isNaN(N))return!1;switch(this.operand){case">":U=g>N;break;case"<":U=g<N;break;case"<=":U=g<=N;break;case">=":U=g>=N;break;case"==":U=g===N;break;case"!=":U=g!==N}return U}}var F=g(12199),f=g(12229);const d=/defined\s*?\((.+?)\)/g,I=/defined\s*?\[(.+?)\]/g,y=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,h=/__decl__/,V=/light\{X\}.(\w*)/g,e=/\{X\}/g,x=[],l=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function Y(E){E.processor&&E.processor.initializeShaders&&E.processor.initializeShaders(E.processingContext)}function t(E,U,g,N){var L;null!==(L=U.processor)&&void 0!==L&&L.preProcessShaderCode&&(E=U.processor.preProcessShaderCode(E,U.isFragment)),j(E,U,(E=>{U.processCodeAfterIncludes&&(E=U.processCodeAfterIncludes(U.isFragment?"fragment":"vertex",E,U.defines));const L=function(E,U,g){let N=function(E,U){var g;if(null!==(g=U.processor)&&void 0!==g&&g.noPrecision)return E;const N=U.shouldUseHighPrecisionShader;-1===E.indexOf("precision highp float")?E=N?"precision highp float;\n"+E:"precision mediump float;\n"+E:N||(E=E.replace("precision highp float","precision mediump float"));return E}(E,U);if(!U.processor)return N;if(0===U.processor.shaderLanguage&&-1!==N.indexOf("#version 3")&&(N=N.replace("#version 300 es",""),!U.processor.parseGLES3))return N;const L=U.defines,D=r(U,g);U.processor.preProcessor&&(N=U.processor.preProcessor(N,L,D,U.isFragment,U.processingContext));const S={};N=c(N,D,U,S),U.processor.postProcessor&&(N=U.processor.postProcessor(N,L,U.isFragment,U.processingContext,g?{drawBuffersExtensionDisabled:!g.getCaps().drawBuffersExtension}:{},D,S));null!==g&&void 0!==g&&g._features.needShaderCodeInlining&&(N=g.inlineShaderCode(N));return N}(E,U,N);g(L,E)}))}function G(E,U,g){return g.processor&&g.processor.finalizeShaders?g.processor.finalizeShaders(E,U,g.processingContext):{vertexCode:E,fragmentCode:U}}function b(E){const U=/defined\((.+)\)/.exec(E);if(U&&U.length)return new s(U[1].trim(),"!"===E[0]);const g=["==","!=",">=","<=","<",">"];let N="",L=0;for(N of g)if(L=E.indexOf(N),L>-1)break;if(-1===L)return new s(E);const D=E.substring(0,L).trim(),S=E.substring(L+N.length).trim();return new P(D,N,S)}function T(E,U){const g=new S,N=E.substring(0,U);let L=E.substring(U);return L=L.substring(0,(L.indexOf("//")+1||L.length+1)-1).trim(),g.testExpression="#ifdef"===N?new s(L):"#ifndef"===N?new s(L,!0):function(E){E=E.replace(d,"defined[$1]");const U=u.infixToPostfix(E),g=[];for(const L of U)if("||"!==L&&"&&"!==L)g.push(L);else if(g.length>=2){let E=g[g.length-1],U=g[g.length-2];g.length-=2;const N="&&"==L?new B:new C;"string"===typeof E&&(E=E.replace(I,"defined($1)")),"string"===typeof U&&(U=U.replace(I,"defined($1)")),N.leftOperand="string"===typeof U?b(U):U,N.rightOperand="string"===typeof E?b(E):E,g.push(N)}let N=g[g.length-1];return"string"===typeof N&&(N=N.replace(I,"defined($1)")),"string"===typeof N?b(N):N}(L),g}function v(E,U,g,L){let D=E.currentLine;for(;o(E,g,L);){D=E.currentLine;const S=D.substring(0,5).toLowerCase();if("#else"===S){const g=new N;return U.children.push(g),void o(E,g,L)}if("#elif"===S){const E=T(D,5);U.children.push(E),g=E}}}function o(E,U,g){for(;E.canRead;){E.lineIndex++;const L=E.currentLine;if(L.indexOf("#")>=0){const N=l.exec(L);if(N&&N.length){switch(N[0]){case"#ifdef":{const N=new D;U.children.push(N);const S=T(L,6);N.children.push(S),v(E,N,S,g);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const N=new D;U.children.push(N);const S=T(L,7);N.children.push(S),v(E,N,S,g);break}case"#if":{const N=new D,S=T(L,3);U.children.push(N),N.children.push(S),v(E,N,S,g);break}}continue}}const S=new N;if(S.line=L,U.children.push(S),"#"===L[0]&&"d"===L[1]){const E=L.replace(";","").split(" ");S.additionalDefineKey=E[1],3===E.length&&(S.additionalDefineValue=E[2])}}return!1}function c(E,U,g,D){const S=new N,u=new L;return u.lineIndex=-1,u.lines=E.split("\n"),o(u,S,D),S.process(U,g,D)}function r(E,U){var g;const N=E.defines,L={};for(const D of N){const E=D.replace("#define","").replace(";","").trim().split(" ");L[E[0]]=E.length>1?E[1]:""}return 0===(null===(g=E.processor)||void 0===g?void 0:g.shaderLanguage)&&(L.GL_ES="true"),L.__VERSION__=E.version,L[E.platformName]="true",(0,f.g)(L,null===U||void 0===U?void 0:U.isNDCHalfZRange,null===U||void 0===U?void 0:U.Fg,null===U||void 0===U?void 0:U.useExactSrgbConversions),L}function j(E,U,g){let N;for(x.length=0;null!==(N=y.exec(E));)x.push(N);let L=String(E),D=[E],S=!1;for(const u of x){let E=u[1];if(-1!==E.indexOf("__decl__")&&(E=E.replace(h,""),U.supportsUniformBuffers&&(E=E.replace("Vertex","Ubo").replace("Fragment","Ubo")),E+="Declaration"),!U.includesShadersStore[E]){const N=U.shadersRepository+"ShadersInclude/"+E+".fx";return void Z.loadFile(N,(N=>{U.includesShadersStore[E]=N,j(D.join(""),U,g)}))}{let g=U.includesShadersStore[E];if(u[2]){const E=u[3].split(",");for(let U=0;U<E.length;U+=2){const N=new RegExp(E[U],"g"),L=E[U+1];g=g.replace(N,L)}}if(u[4]){const E=u[5];if(-1!==E.indexOf("..")){const N=E.split(".."),L=parseInt(N[0]);let D=parseInt(N[1]),S=g.slice(0);g="",isNaN(D)&&(D=U.indexParameters[N[1]]);for(let E=L;E<D;E++)U.supportsUniformBuffers||(S=S.replace(V,((E,U)=>U+"{X}"))),g+=S.replace(e,E.toString())+"\n"}else U.supportsUniformBuffers||(g=g.replace(V,((E,U)=>U+"{X}"))),g=g.replace(e,E)}const N=[];for(const E of D){const U=E.split(u[0]);for(let E=0;E<U.length-1;E++)N.push(U[E]),N.push(g);N.push(U[U.length-1])}D=N,S=S||g.indexOf("#include<")>=0||g.indexOf("#include <")>=0}}x.length=0,L=D.join(""),S?j(L.toString(),U,g):g(L)}const Z={loadFile:(E,U,g,N,L,D)=>{throw(0,F.e)("FileTools")}}},12229:(E,U,g)=>{g.d(U,{b:()=>L,c:()=>D,g:()=>u,h:()=>S,k:()=>s});var N=g(12199);g(12183);const L={};function D(E,U){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(U?U+"\n":"")+E}function S(E,U,g,D,S,u,s){const C=s||L.loadFile;if(C){return C(E,U,g,D,S,u)}throw(0,N.e)("FileTools")}function u(E,U,g,N){if(E)return U?E.IS_NDC_HALF_ZRANGE="":delete E.IS_NDC_HALF_ZRANGE,g?E.USE_REVERSE_DEPTHBUFFER="":delete E.USE_REVERSE_DEPTHBUFFER,void(N?E.USE_EXACT_SRGB_CONVERSIONS="":delete E.USE_EXACT_SRGB_CONVERSIONS);{let E="";return U&&(E+="#define IS_NDC_HALF_ZRANGE"),g&&(E&&(E+="\n"),E+="#define USE_REVERSE_DEPTHBUFFER"),N&&(E&&(E+="\n"),E+="#define USE_EXACT_SRGB_CONVERSIONS"),E}}function s(E,U){let g=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0;switch(E){case 3:{const E=(ArrayBuffer,new Int8Array(U));return N&&E.set(new Int8Array(N)),E}case 0:{const E=(ArrayBuffer,new Uint8Array(U));return N&&E.set(new Uint8Array(N)),E}case 4:{const E=U instanceof ArrayBuffer?new Int16Array(U):new Int16Array(g?U/2:U);return N&&E.set(new Int16Array(N)),E}case 5:case 8:case 9:case 10:case 2:{const E=U instanceof ArrayBuffer?new Uint16Array(U):new Uint16Array(g?U/2:U);return N&&E.set(new Uint16Array(N)),E}case 6:{const E=U instanceof ArrayBuffer?new Int32Array(U):new Int32Array(g?U/4:U);return N&&E.set(new Int32Array(N)),E}case 7:case 11:case 12:case 13:case 14:case 15:{const E=U instanceof ArrayBuffer?new Uint32Array(U):new Uint32Array(g?U/4:U);return N&&E.set(new Uint32Array(N)),E}case 1:{const E=U instanceof ArrayBuffer?new Float32Array(U):new Float32Array(g?U/4:U);return N&&E.set(new Float32Array(N)),E}}const L=(ArrayBuffer,new Uint8Array(U));return N&&L.set(new Uint8Array(N)),L}},12250:(E,U,g)=>{g.d(U,{e:()=>N});class N{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?N.ShadersRepository:N.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?N.ShadersStore:N.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?N.IncludesShadersStore:N.IncludesShadersStoreWGSL}}N.ShadersRepository="src/Shaders/",N.ShadersStore={},N.IncludesShadersStore={},N.ShadersRepositoryWGSL="src/ShadersWGSL/",N.ShadersStoreWGSL={},N.IncludesShadersStoreWGSL={}},12255:(E,U,g)=>{g.d(U,{b:()=>F,e:()=>e,g:()=>d,h:()=>f,l:()=>I,m:()=>V,p:()=>P,s:()=>C,w:()=>B,A:()=>s,D:()=>u});class N{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.fU._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(E){E&&this.program&&E(this.program)}setEngine(E){this.fU=E}_fillEffectInformation(E,U,g,N,L,D,S,u){const s=this.fU;if(s.supportsUniformBuffers)for(const B in U)E.bindUniformBlock(B,U[B]);let C;for(this.fU.getUniforms(this,g).forEach(((E,U)=>{N[g[U]]=E})),this._uniforms=N,C=0;C<L.length;C++){null==E.getUniform(L[C])&&(L.splice(C,1),C--)}L.forEach(((E,U)=>{D[E]=U}));for(const B of s.getAttributes(this,S))u.push(B)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(E,U){const g=this._valueCache[E],N=U.updateFlag;return(void 0===g||g!==N)&&(this._valueCache[E]=N,!0)}_cacheFloat2(E,U,g){let N=this._valueCache[E];if(!N||2!==N.length)return N=[U,g],this._valueCache[E]=N,!0;let L=!1;return N[0]!==U&&(N[0]=U,L=!0),N[1]!==g&&(N[1]=g,L=!0),L}_cacheFloat3(E,U,g,N){let L=this._valueCache[E];if(!L||3!==L.length)return L=[U,g,N],this._valueCache[E]=L,!0;let D=!1;return L[0]!==U&&(L[0]=U,D=!0),L[1]!==g&&(L[1]=g,D=!0),L[2]!==N&&(L[2]=N,D=!0),D}_cacheFloat4(E,U,g,N,L){let D=this._valueCache[E];if(!D||4!==D.length)return D=[U,g,N,L],this._valueCache[E]=D,!0;let S=!1;return D[0]!==U&&(D[0]=U,S=!0),D[1]!==g&&(D[1]=g,S=!0),D[2]!==N&&(D[2]=N,S=!0),D[3]!==L&&(D[3]=L,S=!0),S}setInt(E,U){const g=this._valueCache[E];void 0!==g&&g===U||this.fU.setInt(this._uniforms[E],U)&&(this._valueCache[E]=U)}setInt2(E,U,g){this._cacheFloat2(E,U,g)&&(this.fU.setInt2(this._uniforms[E],U,g)||(this._valueCache[E]=null))}setInt3(E,U,g,N){this._cacheFloat3(E,U,g,N)&&(this.fU.setInt3(this._uniforms[E],U,g,N)||(this._valueCache[E]=null))}setInt4(E,U,g,N,L){this._cacheFloat4(E,U,g,N,L)&&(this.fU.setInt4(this._uniforms[E],U,g,N,L)||(this._valueCache[E]=null))}setIntArray(E,U){this._valueCache[E]=null,this.fU.setIntArray(this._uniforms[E],U)}setIntArray2(E,U){this._valueCache[E]=null,this.fU.setIntArray2(this._uniforms[E],U)}setIntArray3(E,U){this._valueCache[E]=null,this.fU.setIntArray3(this._uniforms[E],U)}setIntArray4(E,U){this._valueCache[E]=null,this.fU.setIntArray4(this._uniforms[E],U)}setUInt(E,U){const g=this._valueCache[E];void 0!==g&&g===U||this.fU.setUInt(this._uniforms[E],U)&&(this._valueCache[E]=U)}setUInt2(E,U,g){this._cacheFloat2(E,U,g)&&(this.fU.setUInt2(this._uniforms[E],U,g)||(this._valueCache[E]=null))}setUInt3(E,U,g,N){this._cacheFloat3(E,U,g,N)&&(this.fU.setUInt3(this._uniforms[E],U,g,N)||(this._valueCache[E]=null))}setUInt4(E,U,g,N,L){this._cacheFloat4(E,U,g,N,L)&&(this.fU.setUInt4(this._uniforms[E],U,g,N,L)||(this._valueCache[E]=null))}setUIntArray(E,U){this._valueCache[E]=null,this.fU.setUIntArray(this._uniforms[E],U)}setUIntArray2(E,U){this._valueCache[E]=null,this.fU.setUIntArray2(this._uniforms[E],U)}setUIntArray3(E,U){this._valueCache[E]=null,this.fU.setUIntArray3(this._uniforms[E],U)}setUIntArray4(E,U){this._valueCache[E]=null,this.fU.setUIntArray4(this._uniforms[E],U)}setArray(E,U){this._valueCache[E]=null,this.fU.setArray(this._uniforms[E],U)}setArray2(E,U){this._valueCache[E]=null,this.fU.setArray2(this._uniforms[E],U)}setArray3(E,U){this._valueCache[E]=null,this.fU.setArray3(this._uniforms[E],U)}setArray4(E,U){this._valueCache[E]=null,this.fU.setArray4(this._uniforms[E],U)}setMatrices(E,U){U&&(this._valueCache[E]=null,this.fU.setMatrices(this._uniforms[E],U))}setMatrix(E,U){this._cacheMatrix(E,U)&&(this.fU.setMatrices(this._uniforms[E],U.Og())||(this._valueCache[E]=null))}setMatrix3x3(E,U){this._valueCache[E]=null,this.fU.setMatrix3x3(this._uniforms[E],U)}setMatrix2x2(E,U){this._valueCache[E]=null,this.fU.setMatrix2x2(this._uniforms[E],U)}setFloat(E,U){const g=this._valueCache[E];void 0!==g&&g===U||this.fU.setFloat(this._uniforms[E],U)&&(this._valueCache[E]=U)}setVector2(E,U){this._cacheFloat2(E,U.x,U.y)&&(this.fU.setFloat2(this._uniforms[E],U.x,U.y)||(this._valueCache[E]=null))}setFloat2(E,U,g){this._cacheFloat2(E,U,g)&&(this.fU.setFloat2(this._uniforms[E],U,g)||(this._valueCache[E]=null))}setVector3(E,U){this._cacheFloat3(E,U.x,U.y,U.z)&&(this.fU.setFloat3(this._uniforms[E],U.x,U.y,U.z)||(this._valueCache[E]=null))}setFloat3(E,U,g,N){this._cacheFloat3(E,U,g,N)&&(this.fU.setFloat3(this._uniforms[E],U,g,N)||(this._valueCache[E]=null))}setVector4(E,U){this._cacheFloat4(E,U.x,U.y,U.z,U.w)&&(this.fU.setFloat4(this._uniforms[E],U.x,U.y,U.z,U.w)||(this._valueCache[E]=null))}setQuaternion(E,U){this._cacheFloat4(E,U.x,U.y,U.z,U.w)&&(this.fU.setFloat4(this._uniforms[E],U.x,U.y,U.z,U.w)||(this._valueCache[E]=null))}setFloat4(E,U,g,N,L){this._cacheFloat4(E,U,g,N,L)&&(this.fU.setFloat4(this._uniforms[E],U,g,N,L)||(this._valueCache[E]=null))}setColor3(E,U){this._cacheFloat3(E,U.r,U.g,U.b)&&(this.fU.setFloat3(this._uniforms[E],U.r,U.g,U.b)||(this._valueCache[E]=null))}setColor4(E,U,g){this._cacheFloat4(E,U.r,U.g,U.b,g)&&(this.fU.setFloat4(this._uniforms[E],U.r,U.g,U.b,g)||(this._valueCache[E]=null))}setDirectColor4(E,U){this._cacheFloat4(E,U.r,U.g,U.b,U.a)&&(this.fU.setFloat4(this._uniforms[E],U.r,U.g,U.b,U.a)||(this._valueCache[E]=null))}_getVertexShaderCode(){return this.vertexShader?this.fU._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.fU._getShaderSource(this.fragmentShader):null}}var L=g(12229);const D=new WeakMap,S={_webGLVersion:2,cachedPipelines:{}};function u(E){let U=D.get(E);if(!U){if(!E)return S;U={_webGLVersion:E.TEXTURE_BINDING_3D?2:1,_context:E,parallelShaderCompile:E.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},D.set(E,U)}return U}function s(E){D.delete(E)}function C(E,U,g,N,L,D){const S=u(N);D||(D=S._createShaderProgramInjection??F);return D(E,h(U,"vertex",N,S._contextWasLost),h(g,"fragment",N,S._contextWasLost),N,L,S.validateShaderPrograms)}function B(E,U,g,N,L){let D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6?arguments[6]:void 0;const s=u(L);S||(S=s._createShaderProgramInjection??F);const C=s._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return S(E,y(U,"vertex",N,C,L,s._contextWasLost),y(g,"fragment",N,C,L,s._contextWasLost),L,D,s.validateShaderPrograms)}function P(E,U){const g=new N,L=u(E);return L.parallelShaderCompile&&!L.disableParallelShaderCompile&&(g.isParallelCompiled=!0),g.context=L._context,g}function F(E,U,g,N){let L=arguments.length>5?arguments[5]:void 0;const D=N.createProgram();if(E.program=D,!D)throw new Error("Unable to create program");return N.attachShader(D,U),N.attachShader(D,g),N.linkProgram(D),E.context=N,E.vertexShader=U,E.fragmentShader=g,E.isParallelCompiled||d(E,N,L),D}function f(E,U,g){const N=E;if(N._isDisposed)return!1;const L=u(U);return!!(L&&L.parallelShaderCompile&&L.parallelShaderCompile.COMPLETION_STATUS_KHR&&N.program&&U.getProgramParameter(N.program,L.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(d(N,U,g),!0)}function d(E,U,g){const N=E.context,L=E.vertexShader,D=E.fragmentShader,S=E.program;if(!N.getProgramParameter(S,N.LINK_STATUS)){if(!U.getShaderParameter(L,U.COMPILE_STATUS)){const g=U.getShaderInfoLog(L);if(g)throw E.vertexCompilationError=g,new Error("VERTEX SHADER "+g)}if(!U.getShaderParameter(D,U.COMPILE_STATUS)){const g=U.getShaderInfoLog(D);if(g)throw E.fragmentCompilationError=g,new Error("FRAGMENT SHADER "+g)}const g=N.getProgramInfoLog(S);if(g)throw E.programLinkError=g,new Error(g)}if(g){N.validateProgram(S);if(!N.getProgramParameter(S,N.VALIDATE_STATUS)){const U=N.getProgramInfoLog(S);if(U)throw E.programValidationError=U,new Error(U)}}N.deleteShader(L),N.deleteShader(D),E.vertexShader=void 0,E.fragmentShader=void 0,E.onCompiled&&(E.onCompiled(),E.onCompiled=void 0)}function I(E,U,g,N,L,D,S,s,P){let F=arguments.length>10?arguments[10]:void 0,f=arguments.length>11?arguments[11]:void 0,d=arguments.length>12?arguments[12]:void 0;const I=u(E.context);f||(f=I.createRawShaderProgramInjection??C),d||(d=I.createShaderProgramInjection??B);const y=E;y.program=N?f(y,U,g,y.context,P):d(y,U,g,s,y.context,P),y.program.__SPECTOR_rebuildProgram=S,F()}function y(E,U,g,N,D,S){return h((0,L.c)(E,g,N),U,D,S)}function h(E,U,g,N){const L=g.createShader("vertex"===U?g.VERTEX_SHADER:g.FRAGMENT_SHADER);if(!L){let E=g.NO_ERROR,L=g.NO_ERROR;for(;(L=g.getError())!==g.NO_ERROR;)E=L;throw new Error(`Something went wrong while creating a gl ${U} shader object. gl error=${E}, gl isContextLost=${g.isContextLost()}, _contextWasLost=${N}`)}return g.shaderSource(L,E),g.compileShader(L),L}function V(E,U){U.useProgram(E)}function e(E,U){const g=E;if(!g.isParallelCompiled)return void U(E);const N=g.onCompiled;g.onCompiled=()=>{null===N||void 0===N||N(),U(E)}}},12253:(E,U,g)=>{g.d(U,{b:()=>P,e:()=>f,g:()=>C,i:()=>B});var N=g(12183),L=g(12255),D=g(12250),S=g(12186),u=g(12226),s=g(12229);function C(E,U){return(0,L.D)(U).cachedPipelines[E]}function B(E){const U=E._name,g=E.context;if(U&&g){const E=(0,L.D)(g),N=E.cachedPipelines[U];null===N||void 0===N||N.dispose(),delete E.cachedPipelines[U]}}function P(E,U,g,L,D,S,s){let C,B;const P=(0,N.f)()?null===S||void 0===S?void 0:S.getHostDocument():null;C="string"===typeof U?U:U.vertexSource?"source:"+U.vertexSource:U.vertexElement?(null===P||void 0===P?void 0:P.getElementById(U.vertexElement))||U.vertexElement:U.vertex||U,B="string"===typeof U?U:U.fragmentSource?"source:"+U.fragmentSource:U.fragmentElement?(null===P||void 0===P?void 0:P.getElementById(U.fragmentElement))||U.fragmentElement:U.fragment||U;const f=[void 0,void 0],d=()=>{if(f[0]&&f[1]){E.isFragment=!0;const[N,C]=f;(0,u.i)(C,E,((S,C)=>{s&&(s._fragmentSourceCodeBeforeMigration=C),g&&(S=g("fragment",S));const B=(0,u.c)(N,S,E);E=null;const P=function(E,U,g,N){if(g){return{vertexSourceCode:(1===N?"//":"")+"#define SHADER_NAME vertex:"+(g.vertexElement||g.vertex||g.spectorName||g)+"\n"+E,fragmentSourceCode:(1===N?"//":"")+"#define SHADER_NAME fragment:"+(g.fragmentElement||g.fragment||g.spectorName||g)+"\n"+U}}return{vertexSourceCode:E,fragmentSourceCode:U}}(B.vertexCode,B.fragmentCode,U,D);null===L||void 0===L||L(P.vertexSourceCode,P.fragmentSourceCode)}),S)}};F(C,"Vertex","",(U=>{(0,u.d)(E),(0,u.i)(U,E,((E,N)=>{s&&(s._rawVertexSourceCode=U,s._vertexSourceCodeBeforeMigration=N),g&&(E=g("vertex",E)),f[0]=E,d()}),S)}),D),F(B,"Fragment","Pixel",(E=>{s&&(s._rawFragmentSourceCode=E),f[1]=E,d()}),D)}function F(E,U,g,L,S,u){if("undefined"!==typeof HTMLElement&&E instanceof HTMLElement){return void L((0,N.b)(E))}if("source:"===E.substring(0,7))return void L(E.substring(7));if("base64:"===E.substring(0,7)){return void L(window.atob(E.substring(7)))}const C=D.e.GetShadersStore(S);if(C[E+U+"Shader"])return void L(C[E+U+"Shader"]);if(g&&C[E+g+"Shader"])return void L(C[E+g+"Shader"]);let B;if(B="."===E[0]||"/"===E[0]||E.indexOf("http")>-1?E:D.e.GetShadersRepository(S)+E,!(u=u||s.h))throw new Error("loadFileInjection is not defined");u(B+"."+U.toLowerCase()+".fx",L)}const f=(E,U,g,N)=>{try{const D=E.context?(0,L.D)(E.context):null;D&&(D.disableParallelShaderCompile=E.disableParallelCompilation);const S=E.existingPipelineContext||U(E.shaderProcessingContext);return S._name=E.name,E.name&&D&&(D.cachedPipelines[E.name]=S),g(S,E.vertex,E.fragment,!!E.createAsRaw,"","",E.rebuildRebind,E.defines,E.transformFeedbackVaryings,"",(()=>{N(S,(()=>{var U;null===(U=E.onRenderingStateCompiled)||void 0===U||U.call(E,S)}))})),S}catch(D){throw S.d.Error("Error compiling effect"),D}}},12247:(E,U,g)=>{g.r(U),g.d(U,{Effect:()=>s});var N=g(12174),L=g(12186),D=g(12250),S=g(12253),u=g(12234);class s{static get ShadersRepository(){return D.e.ShadersRepository}static set ShadersRepository(E){D.e.ShadersRepository=E}get C(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new N.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(E,U,g){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,F=arguments.length>9?arguments[9]:void 0,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,I=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new N.b,this.onErrorObservable=new N.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=E,this._key=f;const y=this._key.replace(/\r/g,"").replace(/\n/g,"|");let h;if(U.attributes){const E=U;if(this._engine=g,this._attributesNames=E.attributes,this._uniformsNames=E.uniformsNames.concat(E.samplers),this._samplerList=E.samplers.slice(),this.defines=E.defines,this.onError=E.onError,this.onCompiled=E.onCompiled,this._fallbacks=E.fallbacks,this._indexParameters=E.indexParameters,this._transformFeedbackVaryings=E.transformFeedbackVaryings||null,this._multiTarget=!!E.multiTarget,this._shaderLanguage=E.shaderLanguage??0,this._disableParallelShaderCompilation=!!E.disableParallelShaderCompilation,E.uniformBuffersNames){this._uniformBuffersNamesList=E.uniformBuffersNames.slice();for(let U=0;U<E.uniformBuffersNames.length;U++)this._uniformBuffersNames[E.uniformBuffersNames[U]]=U}this._processFinalCode=E.processFinalCode??null,this._processCodeAfterIncludes=E.processCodeAfterIncludes??void 0,I=E.extraInitializationsAsync,h=E.existingPipelineContext}else this._engine=D,this.defines=null==u?"":u,this._uniformsNames=g.concat(L),this._samplerList=L?L.slice():[],this._attributesNames=U,this._uniformBuffersNamesList=[],this._shaderLanguage=d,this.onError=P,this.onCompiled=B,this._indexParameters=F,this._fallbacks=C;"WEBGL2"===this._engine.shaderPlatformName&&(h=(0,S.g)(y,this._engine._gl)??h),this._attributeLocationByName={},this.uniqueId=s._UniqueIdSeed++,h?(this._pipelineContext=h,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,I),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.C||this.dispose(!0)}))}async _processShaderCodeAsync(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3?arguments[3]:void 0;N&&await N(),this._processingContext=g||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const L={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:E??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:D.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:D.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,Fg:this._engine.Fg,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,S.b)(L,this.name,this._processFinalCode,((E,g)=>{this._vertexSourceCode=E,this._fragmentSourceCode=g,this._prepareEffect(U)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.C||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(E){return this._attributes[E]}getAttributeLocationByName(E){return this._attributeLocationByName[E]}getAttributesCount(){return this._attributes.length}getUniformIndex(E){return this._uniformsNames.indexOf(E)}getUniform(E){return this._uniforms[E]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((E=>{this.executeWhenCompiled(E)}))}executeWhenCompiled(E){this.isReady()?E(this):(this.onCompileObservable.add((U=>{E(U)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(E){(0,u.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(U=>{this._processCompilationErrors(U,E)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var E;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(E=this._pipelineContext)||void 0===E?void 0:E._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var E;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(E=this._pipelineContext)||void 0===E?void 0:E._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,Fg:this._engine.Fg,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(E,U,g,N){this._isReady=!1,this._vertexSourceCodeOverride=E,this._fragmentSourceCodeOverride=U,this.onError=(E,U)=>{N&&N(U)},this.onCompiled=()=>{var E,U;const N=this.getEngine().scenes;if(N)for(let g=0;g<N.length;g++)N[g].markAllMaterialsAsDirty(127);null===(E=(U=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===E||E.call(U,g)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(E){if(this._pipelineContext=E,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let U=0;U<this._attributesNames.length;U++){const E=this._attributesNames[U];this._attributeLocationByName[E]=this._attributes[U]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),s.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U=this._pipelineContext;this._isReady=!1;try{const g=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),N=g?null:this.defines,L=g?this._vertexSourceCodeOverride:this._vertexSourceCode,D=g?this._fragmentSourceCodeOverride:this._fragmentSourceCode,u=this._engine;this._pipelineContext=(0,S.e)({existingPipelineContext:E?U:null,vertex:L,fragment:D,context:"WEBGL2"===u.shaderPlatformName||"WEBGL1"===u.shaderPlatformName?u._gl:void 0,rebuildRebind:(E,U,g,N)=>this._rebuildProgram(E,U,g,N),defines:N,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:g,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:g=>{U&&!E&&this._engine._deletePipelineContext(U),g&&this._onRenderingStateCompiled(g)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(U)}catch(g){this._processCompilationErrors(g,U)}}_getShaderCodeAndErrorLine(E,U,g){const N=g?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let L=null;if(U&&E){const D=U.match(N);if(D&&2===D.length){const U=parseInt(D[1]),N=E.split("\n",-1);N.length>=U&&(L=`Offending line [${U}] in ${g?"fragment":"vertex"} code: ${N[U-1]}`)}}return[E,L]}_processCompilationErrors(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=E.message;const g=this._attributesNames,N=this._fallbacks;if(L.d.Error("Unable to compile effect:"),L.d.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),L.d.Error(`Attributes: ${g.join(" ")}`),L.d.Error("Defines:\n"+this.defines),s.LogShaderCodeOnCompilationError){var D,S;let E=null,U=null,g=null;var u;if(null!==(D=this._pipelineContext)&&void 0!==D&&D._getVertexShaderCode()&&([g,E]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),g&&(L.d.Error("Vertex code:"),L.d.Error(g))),null!==(S=this._pipelineContext)&&void 0!==S&&S._getFragmentShaderCode())[g,U]=this._getShaderCodeAndErrorLine(null===(u=this._pipelineContext)||void 0===u?void 0:u._getFragmentShaderCode(),this._compilationError,!0),g&&(L.d.Error("Fragment code:"),L.d.Error(g));E&&L.d.Error(E),U&&L.d.Error(U)}L.d.Error("Error: "+this._compilationError);const C=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};U&&(this._pipelineContext=U,this._isReady=!0,C()),N?(this._pipelineContext=null,N.hasMoreFallbacks?(this._allFallbacksProcessed=!1,L.d.Error("Trying next fallback."),this.defines=N.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,C(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,U||C())}get isSupported(){return""===this._compilationError}_bindTexture(E,U){this._engine._bindTexture(this._samplers[E],U,E)}setTexture(E,U){this._engine.setTexture(this._samplers[E],this._uniforms[E],U,E)}setTextureArray(E,U){const g=E+"Ex";if(-1===this._samplerList.indexOf(g+"0")){const N=this._samplerList.indexOf(E);for(let E=1;E<U.length;E++){const U=g+(E-1).toString();this._samplerList.splice(N+E,0,U)}let L=0;for(const E of this._samplerList)this._samplers[E]=L,L+=1}this._engine.setTextureArray(this._samplers[E],this._uniforms[E],U,E)}bindUniformBuffer(E,U){const g=this._uniformBuffersNames[U];void 0===g||s._BaseCache[g]===E&&this._engine._features.useUBOBindingCache||(s._BaseCache[g]=E,this._engine.bindUniformBufferBase(E,g,U))}bindUniformBlock(E,U){this._engine.bindUniformBlock(this._pipelineContext,E,U)}setInt(E,U){return this._pipelineContext.setInt(E,U),this}setInt2(E,U,g){return this._pipelineContext.setInt2(E,U,g),this}setInt3(E,U,g,N){return this._pipelineContext.setInt3(E,U,g,N),this}setInt4(E,U,g,N,L){return this._pipelineContext.setInt4(E,U,g,N,L),this}setIntArray(E,U){return this._pipelineContext.setIntArray(E,U),this}setIntArray2(E,U){return this._pipelineContext.setIntArray2(E,U),this}setIntArray3(E,U){return this._pipelineContext.setIntArray3(E,U),this}setIntArray4(E,U){return this._pipelineContext.setIntArray4(E,U),this}setUInt(E,U){return this._pipelineContext.setUInt(E,U),this}setUInt2(E,U,g){return this._pipelineContext.setUInt2(E,U,g),this}setUInt3(E,U,g,N){return this._pipelineContext.setUInt3(E,U,g,N),this}setUInt4(E,U,g,N,L){return this._pipelineContext.setUInt4(E,U,g,N,L),this}setUIntArray(E,U){return this._pipelineContext.setUIntArray(E,U),this}setUIntArray2(E,U){return this._pipelineContext.setUIntArray2(E,U),this}setUIntArray3(E,U){return this._pipelineContext.setUIntArray3(E,U),this}setUIntArray4(E,U){return this._pipelineContext.setUIntArray4(E,U),this}setFloatArray(E,U){return this._pipelineContext.setArray(E,U),this}setFloatArray2(E,U){return this._pipelineContext.setArray2(E,U),this}setFloatArray3(E,U){return this._pipelineContext.setArray3(E,U),this}setFloatArray4(E,U){return this._pipelineContext.setArray4(E,U),this}setArray(E,U){return this._pipelineContext.setArray(E,U),this}setArray2(E,U){return this._pipelineContext.setArray2(E,U),this}setArray3(E,U){return this._pipelineContext.setArray3(E,U),this}setArray4(E,U){return this._pipelineContext.setArray4(E,U),this}setMatrices(E,U){return this._pipelineContext.setMatrices(E,U),this}setMatrix(E,U){return this._pipelineContext.setMatrix(E,U),this}setMatrix3x3(E,U){return this._pipelineContext.setMatrix3x3(E,U),this}setMatrix2x2(E,U){return this._pipelineContext.setMatrix2x2(E,U),this}setFloat(E,U){return this._pipelineContext.setFloat(E,U),this}setBool(E,U){return this._pipelineContext.setInt(E,U?1:0),this}setVector2(E,U){return this._pipelineContext.setVector2(E,U),this}setFloat2(E,U,g){return this._pipelineContext.setFloat2(E,U,g),this}setVector3(E,U){return this._pipelineContext.setVector3(E,U),this}setFloat3(E,U,g,N){return this._pipelineContext.setFloat3(E,U,g,N),this}setVector4(E,U){return this._pipelineContext.setVector4(E,U),this}setQuaternion(E,U){return this._pipelineContext.setQuaternion(E,U),this}setFloat4(E,U,g,N,L){return this._pipelineContext.setFloat4(E,U,g,N,L),this}setColor3(E,U){return this._pipelineContext.setColor3(E,U),this}setColor4(E,U,g){return this._pipelineContext.setColor4(E,U,g),this}setDirectColor4(E,U){return this._pipelineContext.setDirectColor4(E,U),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(s.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,S.i)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;U&&(D.e.GetShadersStore(N)[`${E}PixelShader`]=U),g&&(D.e.GetShadersStore(N)[`${E}VertexShader`]=g)}static ResetCache(){s._BaseCache={}}}s.LogShaderCodeOnCompilationError=!0,s.PersistentMode=!1,s.AutomaticallyClearCodeCache=!1,s._UniqueIdSeed=0,s._BaseCache={},s.ShadersStore=D.e.ShadersStore,s.IncludesShadersStore=D.e.IncludesShadersStore},12199:(E,U,g)=>{g.d(U,{e:()=>L});const N={};function L(E){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!N[E])return N[E]=!0,`${E} needs to be imported before as it contains a side-effect required by your code.`}},12183:(E,U,g)=>{function N(){return"undefined"!==typeof window}function L(){return"undefined"!==typeof navigator}function D(){return"undefined"!==typeof document}function S(E){let U="",g=E.firstChild;for(;g;)3===g.nodeType&&(U+=g.textContent),g=g.nextSibling;return U}g.d(U,{b:()=>S,c:()=>D,d:()=>L,f:()=>N})},12186:(E,U,g)=>{g.d(U,{d:()=>N});class N{static _CheckLimit(E,U){let g=N._LogLimitOutputs[E];return g?g.current++:(g={limit:U,current:1},N._LogLimitOutputs[E]=g),g.current<=g.limit}static _GenerateLimitMessage(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const g=N._LogLimitOutputs[E];if(!g||!N.MessageLimitReached)return;const L=this._Levels[U];g.current===g.limit&&N[L.name](N.MessageLimitReached.replace(/%LIMIT%/g,""+g.limit).replace(/%TYPE%/g,L.name??""))}static _AddLogEntry(E){N._LogCache=E+N._LogCache,N.OnNewCacheEntry&&N.OnNewCacheEntry(E)}static _FormatMessage(E){const U=E=>E<10?"0"+E:""+E,g=new Date;return"["+U(g.getHours())+":"+U(g.getMinutes())+":"+U(g.getSeconds())+"]: "+E}static _LogDisabled(E,U){}static _LogEnabled(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,U=arguments.length>1?arguments[1]:void 0,g=arguments.length>2?arguments[2]:void 0;const L=Array.isArray(U)?U[0]:U;if(void 0!==g&&!N._CheckLimit(L,g))return;const D=N._FormatMessage(L),S=this._Levels[E],u=Array.isArray(U)?U.slice(1):[];S.logFunc&&S.logFunc("BJS - "+D,...u);const s=`<div style='color:${S.color}'>${D}</div><br>`;N._AddLogEntry(s),N._GenerateLimitMessage(L,E)}static get LogCache(){return N._LogCache}static ClearLogCache(){N._LogCache="",N._LogLimitOutputs={},N.errorsCount=0}static set LogLevels(E){N.Log=N._LogDisabled,N.Warn=N._LogDisabled,N.Error=N._LogDisabled;const U=[N.MessageLogLevel,N.WarningLogLevel,N.ErrorLogLevel];for(const g of U)if((E&g)===g){const E=this._Levels[g];N[E.name]=N._LogEnabled.bind(N,g)}}}N.NoneLogLevel=0,N.MessageLogLevel=1,N.WarningLogLevel=2,N.ErrorLogLevel=4,N.AllLogLevel=7,N.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",N._LogCache="",N._LogLimitOutputs={},N._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],N.errorsCount=0,N.Log=N._LogEnabled.bind(N,N.MessageLogLevel),N.Warn=N._LogEnabled.bind(N,N.WarningLogLevel),N.Error=N._LogEnabled.bind(N,N.ErrorLogLevel)},12174:(E,U,g)=>{g.d(U,{b:()=>S});const N="undefined"!==typeof WeakRef;class L{constructor(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0;this.initialize(E,U,g,N)}initialize(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0;return this.mask=E,this.skipNextObservers=U,this.target=g,this.currentTarget=N,this}}class D{constructor(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=E,this.mask=U,this.scope=g,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(E)}}class S{static FromPromise(E,U){const g=new S;return E.then((E=>{g.notifyObservers(E)})).catch((E=>{if(!U)throw E;U.notifyObservers(E)})),g}get observers(){return this._observers}constructor(E){let U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=U,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new L(0),E&&(this._onObserverAdded=E)}add(E){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!E)return null;const L=new D(E,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);L.unregisterOnNextCall=g,U?this._observers.unshift(L):this._observers.push(L),this._onObserverAdded&&this._onObserverAdded(L),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(L,this._lastNotifiedValue);const S=N?new WeakRef(this):{deref:()=>this};return L._remove=function(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const U=S.deref();U&&(E?U.remove(L):U._remove(L))},L}addOnce(E){return this.add(E,void 0,void 0,void 0,!0)}remove(E){if(!E)return!1;E._remove=null;return-1!==this._observers.indexOf(E)&&(this._deferUnregister(E),!0)}removeCallback(E,U){for(let g=0;g<this._observers.length;g++){const N=this._observers[g];if(!N._willBeUnregistered&&(N.callback===E&&(!U||U===N.scope)))return this._deferUnregister(N),!0}return!1}_deferUnregister(E){E._willBeUnregistered||(this._numObserversMarkedAsDeleted++,E.unregisterOnNextCall=!1,E._willBeUnregistered=!0,setTimeout((()=>{this._remove(E)}),0))}_remove(E){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!E)return!1;const g=this._observers.indexOf(E);return-1!==g&&(U&&this._numObserversMarkedAsDeleted--,this._observers.splice(g,1),!0)}makeObserverTopPriority(E){this._remove(E,!1),this._observers.unshift(E)}makeObserverBottomPriority(E){this._remove(E,!1),this._observers.push(E)}notifyObservers(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,g=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=E),!this._observers.length)return!0;const D=this._eventState;D.mask=U,D.target=g,D.currentTarget=N,D.skipNextObservers=!1,D.lastReturnValue=E,D.userInfo=L;for(const S of this._observers)if(!S._willBeUnregistered&&(S.mask&U&&(S.unregisterOnNextCall&&this._deferUnregister(S),S.scope?D.lastReturnValue=S.callback.apply(S.scope,[E,D]):D.lastReturnValue=S.callback(E,D)),D.skipNextObservers))return!1;return!0}notifyObserver(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=U),E._willBeUnregistered)return;const N=this._eventState;N.mask=g,N.skipNextObservers=!1,E.unregisterOnNextCall&&this._deferUnregister(E),E.callback(U,N)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const E=this._observers.pop();E&&(E._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const E=new S;return E._observers=this._observers.slice(0),E}hasSpecificMask(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const U of this._observers)if(U.mask&E||U.mask===E)return!0;return!1}}},12234:(E,U,g)=>{g.d(U,{c:()=>L,f:()=>S});let N=[];class L{static SetImmediate(E){0===N.length&&setTimeout((()=>{const E=N;N=[];for(const U of E)U()}),1),N.push(E)}}function D(E,U,g){try{if(E())return U(),!0}catch(N){return null===g||void 0===g||g(N),!0}return!1}const S=function(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,S=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&D(E,U,g))return null;const u=setInterval((()=>{D(E,U,g)?clearInterval(u):(L-=N,L<0&&(clearInterval(u),null===g||void 0===g||g(new Error("Operation timed out after maximum retries. "+(S||"")),!0)))}),N);return()=>clearInterval(u)}}}]);