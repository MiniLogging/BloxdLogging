"use strict";(self.xeuzlpp225k=self.xeuzlpp225k||[]).push([[9],{11183:(k,Q,i)=>{i.d(Q,{d:()=>s,h:()=>y,n:()=>L,l:()=>N,q:()=>X});class Z{constructor(){this.children=[]}isValid(k){return!0}process(k,Q,i){let Z="";if(this.line){let i=this.line;const J=Q.processor;if(J){var U,C,B,o,m,O;J.lineProcessor&&(i=J.lineProcessor(i,Q.isFragment,Q.processingContext));const Z=(null===(U=Q.processor)||void 0===U?void 0:U.attributeKeywordName)??"attribute",G=Q.isFragment&&null!==(C=Q.processor)&&void 0!==C&&C.varyingFragmentKeywordName?null===(B=Q.processor)||void 0===B?void 0:B.varyingFragmentKeywordName:!Q.isFragment&&null!==(o=Q.processor)&&void 0!==o&&o.varyingVertexKeywordName?null===(m=Q.processor)||void 0===m?void 0:m.varyingVertexKeywordName:"varying";if(!Q.isFragment&&J.attributeProcessor&&this.line.startsWith(Z))i=J.attributeProcessor(this.line,k,Q.processingContext);else if(J.varyingProcessor&&(null!==(O=J.varyingCheck)&&void 0!==O&&O.call(J,this.line,Q.isFragment)||!J.varyingCheck&&this.line.startsWith(G)))i=J.varyingProcessor(this.line,Q.isFragment,k,Q.processingContext);else if(J.uniformProcessor&&J.uniformRegexp&&J.uniformRegexp.test(this.line))Q.lookForClosingBracketForUniformBuffer||(i=J.uniformProcessor(this.line,Q.isFragment,k,Q.processingContext));else if(J.uniformBufferProcessor&&J.uniformBufferRegexp&&J.uniformBufferRegexp.test(this.line))Q.lookForClosingBracketForUniformBuffer||(i=J.uniformBufferProcessor(this.line,Q.isFragment,Q.processingContext),Q.lookForClosingBracketForUniformBuffer=!0);else if(J.textureProcessor&&J.textureRegexp&&J.textureRegexp.test(this.line))i=J.textureProcessor(this.line,Q.isFragment,k,Q.processingContext);else if((J.uniformProcessor||J.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!Q.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?J.uniformProcessor&&(i=J.uniformProcessor(this.line,Q.isFragment,k,Q.processingContext)):J.uniformBufferProcessor&&(i=J.uniformBufferProcessor(this.line,Q.isFragment,Q.processingContext),Q.lookForClosingBracketForUniformBuffer=!0)}Q.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(Q.lookForClosingBracketForUniformBuffer=!1,J.endOfUniformBufferProcessor&&(i=J.endOfUniformBufferProcessor(this.line,Q.isFragment,Q.processingContext)))}Z+=i+"\n"}for(const J of this.children)Z+=J.process(k,Q,i);return this.additionalDefineKey&&(k[this.additionalDefineKey]=this.additionalDefineValue||"true",i[this.additionalDefineKey]=k[this.additionalDefineKey]),Z}}class U{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(k){this._lines.length=0;for(const Q of k){if(!Q||"\r"===Q)continue;if("#"===Q[0]){this._lines.push(Q);continue}const k=Q.trim();if(!k)continue;if(k.startsWith("//")){this._lines.push(Q);continue}const i=k.indexOf(";");if(-1===i)this._lines.push(k);else if(i===k.length-1)k.length>1&&this._lines.push(k);else{const k=Q.split(";");for(let Q=0;Q<k.length;Q++){let i=k[Q];i&&(i=i.trim(),i&&this._lines.push(i+(Q!==k.length-1?";":"")))}}}}}class C extends Z{process(k,Q,i){for(let Z=0;Z<this.children.length;Z++){const U=this.children[Z];if(U.isValid(k))return U.process(k,Q,i)}return""}}class B extends Z{isValid(k){return this.testExpression.isTrue(k)}}class o{isTrue(k){return!0}static postfixToInfix(k){const Q=[];for(const i of k)if(void 0===o._OperatorPriority[i])Q.push(i);else{const k=Q[Q.length-1],Z=Q[Q.length-2];Q.length-=2,Q.push(`(${Z}${i}${k})`)}return Q[Q.length-1]}static infixToPostfix(k){const Q=o._InfixToPostfixCache.get(k);if(Q)return Q.accessTime=Date.now(),Q.result;if(!k.includes("&&")&&!k.includes("||")&&!k.includes(")")&&!k.includes("("))return[k];const i=[];let Z=-1;const U=()=>{J=J.trim(),""!==J&&(i.push(J),J="")},C=k=>{Z<o._Stack.length-1&&(o._Stack[++Z]=k)},B=()=>o._Stack[Z],m=()=>-1===Z?"!!INVALID EXPRESSION!!":o._Stack[Z--];let O=0,J="";for(;O<k.length;){const Q=k.charAt(O),G=O<k.length-1?k.substring(O,2+O):"";if("("===Q)J="",C(Q);else if(")"===Q){for(U();-1!==Z&&"("!==B();)i.push(m());m()}else if(o._OperatorPriority[G]>1){for(U();-1!==Z&&o._OperatorPriority[B()]>=o._OperatorPriority[G];)i.push(m());C(G),O++}else J+=Q;O++}for(U();-1!==Z;)"("===B()?m():i.push(m());return o._InfixToPostfixCache.size>=o.InfixToPostfixCacheLimitSize&&o.ClearCache(),o._InfixToPostfixCache.set(k,{result:i,accessTime:Date.now()}),i}static ClearCache(){const k=Array.from(o._InfixToPostfixCache.entries()).sort(((k,Q)=>k[1].accessTime-Q[1].accessTime));for(let Q=0;Q<o.InfixToPostfixCacheCleanupSize;Q++)o._InfixToPostfixCache.delete(k[Q][0])}}o.InfixToPostfixCacheLimitSize=5e4,o.InfixToPostfixCacheCleanupSize=25e3,o._InfixToPostfixCache=new Map,o._OperatorPriority={")":0,"(":1,"||":2,"&&":3},o._Stack=["","","","","","","","","","","","","","","","","","","",""];class m extends o{constructor(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=k,this.not=Q}isTrue(k){let Q=void 0!==k[this.define];return this.not&&(Q=!Q),Q}}class O extends o{isTrue(k){return this.leftOperand.isTrue(k)||this.rightOperand.isTrue(k)}}class J extends o{isTrue(k){return this.leftOperand.isTrue(k)&&this.rightOperand.isTrue(k)}}class G extends o{constructor(k,Q,i){super(),this.define=k,this.operand=Q,this.testValue=i}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(k){let Q=!1;const i=parseInt(void 0!=k[this.define]?k[this.define]:this.define),Z=parseInt(void 0!=k[this.testValue]?k[this.testValue]:this.testValue);if(isNaN(i)||isNaN(Z))return!1;switch(this.operand){case">":Q=i>Z;break;case"<":Q=i<Z;break;case"<=":Q=i<=Z;break;case">=":Q=i>=Z;break;case"==":Q=i===Z;break;case"!=":Q=i!==Z}return Q}}var H=i(11146),e=i(11187);const F=/defined\s*?\((.+?)\)/g,z=/defined\s*?\[(.+?)\]/g,E=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,l=/__decl__/,h=/light\{X\}.(\w*)/g,c=/\{X\}/g,f=[],Y=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function y(k){k.processor&&k.processor.initializeShaders&&k.processor.initializeShaders(k.processingContext)}function L(k,Q,i,Z){var U;null!==(U=Q.processor)&&void 0!==U&&U.preProcessShaderCode&&(k=Q.processor.preProcessShaderCode(k,Q.isFragment)),N(k,Q,(k=>{Q.processCodeAfterIncludes&&(k=Q.processCodeAfterIncludes(Q.isFragment?"fragment":"vertex",k,Q.defines));const U=function(k,Q,i){let Z=function(k,Q){var i;if(null!==(i=Q.processor)&&void 0!==i&&i.noPrecision)return k;const Z=Q.shouldUseHighPrecisionShader;-1===k.indexOf("precision highp float")?k=Z?"precision highp float;\n"+k:"precision mediump float;\n"+k:Z||(k=k.replace("precision highp float","precision mediump float"));return k}(k,Q);if(!Q.processor)return Z;if(0===Q.processor.shaderLanguage&&-1!==Z.indexOf("#version 3")&&(Z=Z.replace("#version 300 es",""),!Q.processor.parseGLES3))return Z;const U=Q.defines,C=v(Q,i);Q.processor.preProcessor&&(Z=Q.processor.preProcessor(Z,U,C,Q.isFragment,Q.processingContext));const B={};Z=K(Z,C,Q,B),Q.processor.postProcessor&&(Z=Q.processor.postProcessor(Z,U,Q.isFragment,Q.processingContext,i?{drawBuffersExtensionDisabled:!i.getCaps().drawBuffersExtension}:{},C,B));null!==i&&void 0!==i&&i._features.needShaderCodeInlining&&(Z=i.inlineShaderCode(Z));return Z}(k,Q,Z);i(U,k)}))}function s(k,Q,i){return i.processor&&i.processor.finalizeShaders?i.processor.finalizeShaders(k,Q,i.processingContext):{vertexCode:k,fragmentCode:Q}}function u(k){const Q=/defined\((.+)\)/.exec(k);if(Q&&Q.length)return new m(Q[1].trim(),"!"===k[0]);const i=["==","!=",">=","<=","<",">"];let Z="",U=0;for(Z of i)if(U=k.indexOf(Z),U>-1)break;if(-1===U)return new m(k);const C=k.substring(0,U).trim(),B=k.substring(U+Z.length).trim();return new G(C,Z,B)}function a(k,Q){const i=new B,Z=k.substring(0,Q);let U=k.substring(Q);return U=U.substring(0,(U.indexOf("//")+1||U.length+1)-1).trim(),i.testExpression="#ifdef"===Z?new m(U):"#ifndef"===Z?new m(U,!0):function(k){k=k.replace(F,"defined[$1]");const Q=o.infixToPostfix(k),i=[];for(const U of Q)if("||"!==U&&"&&"!==U)i.push(U);else if(i.length>=2){let k=i[i.length-1],Q=i[i.length-2];i.length-=2;const Z="&&"==U?new J:new O;"string"===typeof k&&(k=k.replace(z,"defined($1)")),"string"===typeof Q&&(Q=Q.replace(z,"defined($1)")),Z.leftOperand="string"===typeof Q?u(Q):Q,Z.rightOperand="string"===typeof k?u(k):k,i.push(Z)}let Z=i[i.length-1];return"string"===typeof Z&&(Z=Z.replace(z,"defined($1)")),"string"===typeof Z?u(Z):Z}(U),i}function j(k,Q,i,U){let C=k.currentLine;for(;T(k,i,U);){C=k.currentLine;const B=C.substring(0,5).toLowerCase();if("#else"===B){const i=new Z;return Q.children.push(i),void T(k,i,U)}if("#elif"===B){const k=a(C,5);Q.children.push(k),i=k}}}function T(k,Q,i){for(;k.canRead;){k.lineIndex++;const U=k.currentLine;if(U.indexOf("#")>=0){const Z=Y.exec(U);if(Z&&Z.length){switch(Z[0]){case"#ifdef":{const Z=new C;Q.children.push(Z);const B=a(U,6);Z.children.push(B),j(k,Z,B,i);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const Z=new C;Q.children.push(Z);const B=a(U,7);Z.children.push(B),j(k,Z,B,i);break}case"#if":{const Z=new C,B=a(U,3);Q.children.push(Z),Z.children.push(B),j(k,Z,B,i);break}}continue}}const B=new Z;if(B.line=U,Q.children.push(B),"#"===U[0]&&"d"===U[1]){const k=U.replace(";","").split(" ");B.additionalDefineKey=k[1],3===k.length&&(B.additionalDefineValue=k[2])}}return!1}function K(k,Q,i,C){const B=new Z,o=new U;return o.lineIndex=-1,o.lines=k.split("\n"),T(o,B,C),B.process(Q,i,C)}function v(k,Q){var i;const Z=k.defines,U={};for(const C of Z){const k=C.replace("#define","").replace(";","").trim().split(" ");U[k[0]]=k.length>1?k[1]:""}return 0===(null===(i=k.processor)||void 0===i?void 0:i.shaderLanguage)&&(U.GL_ES="true"),U.__VERSION__=k.version,U[k.platformName]="true",(0,e.j)(U,null===Q||void 0===Q?void 0:Q.isNDCHalfZRange,null===Q||void 0===Q?void 0:Q.useReverseDepthBuffer,null===Q||void 0===Q?void 0:Q.useExactSrgbConversions),U}function N(k,Q,i){let Z;for(f.length=0;null!==(Z=E.exec(k));)f.push(Z);let U=String(k),C=[k],B=!1;for(const o of f){let k=o[1];if(-1!==k.indexOf("__decl__")&&(k=k.replace(l,""),Q.supportsUniformBuffers&&(k=k.replace("Vertex","Ubo").replace("Fragment","Ubo")),k+="Declaration"),!Q.includesShadersStore[k]){const Z=Q.shadersRepository+"ShadersInclude/"+k+".fx";return void X.loadFile(Z,(Z=>{Q.includesShadersStore[k]=Z,N(C.join(""),Q,i)}))}{let i=Q.includesShadersStore[k];if(o[2]){const k=o[3].split(",");for(let Q=0;Q<k.length;Q+=2){const Z=new RegExp(k[Q],"g"),U=k[Q+1];i=i.replace(Z,U)}}if(o[4]){const k=o[5];if(-1!==k.indexOf("..")){const Z=k.split(".."),U=parseInt(Z[0]);let C=parseInt(Z[1]),B=i.slice(0);i="",isNaN(C)&&(C=Q.indexParameters[Z[1]]);for(let k=U;k<C;k++)Q.supportsUniformBuffers||(B=B.replace(h,((k,Q)=>Q+"{X}"))),i+=B.replace(c,k.toString())+"\n"}else Q.supportsUniformBuffers||(i=i.replace(h,((k,Q)=>Q+"{X}"))),i=i.replace(c,k)}const Z=[];for(const k of C){const Q=k.split(o[0]);for(let k=0;k<Q.length-1;k++)Z.push(Q[k]),Z.push(i);Z.push(Q[Q.length-1])}C=Z,B=B||i.indexOf("#include<")>=0||i.indexOf("#include <")>=0}}f.length=0,U=C.join(""),B?N(U.toString(),Q,i):i(U)}const X={loadFile:(k,Q,i,Z,U,C)=>{throw(0,H.d)("FileTools")}}},11187:(k,Q,i)=>{i.d(Q,{c:()=>U,g:()=>C,j:()=>o,n:()=>B,p:()=>m});var Z=i(11146);i(11131);const U={};function C(k,Q){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(Q?Q+"\n":"")+k}function B(k,Q,i,C,B,o,m){const O=m||U.loadFile;if(O){return O(k,Q,i,C,B,o)}throw(0,Z.d)("FileTools")}function o(k,Q,i,Z){if(k)return Q?k.IS_NDC_HALF_ZRANGE="":delete k.IS_NDC_HALF_ZRANGE,i?k.USE_REVERSE_DEPTHBUFFER="":delete k.USE_REVERSE_DEPTHBUFFER,void(Z?k.USE_EXACT_SRGB_CONVERSIONS="":delete k.USE_EXACT_SRGB_CONVERSIONS);{let k="";return Q&&(k+="#define IS_NDC_HALF_ZRANGE"),i&&(k&&(k+="\n"),k+="#define USE_REVERSE_DEPTHBUFFER"),Z&&(k&&(k+="\n"),k+="#define USE_EXACT_SRGB_CONVERSIONS"),k}}function m(k,Q){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3?arguments[3]:void 0;switch(k){case 3:{const k=(ArrayBuffer,new Int8Array(Q));return Z&&k.set(new Int8Array(Z)),k}case 0:{const k=(ArrayBuffer,new Uint8Array(Q));return Z&&k.set(new Uint8Array(Z)),k}case 4:{const k=Q instanceof ArrayBuffer?new Int16Array(Q):new Int16Array(i?Q/2:Q);return Z&&k.set(new Int16Array(Z)),k}case 5:case 8:case 9:case 10:case 2:{const k=Q instanceof ArrayBuffer?new Uint16Array(Q):new Uint16Array(i?Q/2:Q);return Z&&k.set(new Uint16Array(Z)),k}case 6:{const k=Q instanceof ArrayBuffer?new Int32Array(Q):new Int32Array(i?Q/4:Q);return Z&&k.set(new Int32Array(Z)),k}case 7:case 11:case 12:case 13:case 14:case 15:{const k=Q instanceof ArrayBuffer?new Uint32Array(Q):new Uint32Array(i?Q/4:Q);return Z&&k.set(new Uint32Array(Z)),k}case 1:{const k=Q instanceof ArrayBuffer?new Float32Array(Q):new Float32Array(i?Q/4:Q);return Z&&k.set(new Float32Array(Z)),k}}const U=(ArrayBuffer,new Uint8Array(Q));return Z&&U.set(new Uint8Array(Z)),U}},11210:(k,Q,i)=>{i.d(Q,{d:()=>Z});class Z{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Z.ShadersRepository:Z.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Z.ShadersStore:Z.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Z.IncludesShadersStore:Z.IncludesShadersStoreWGSL}}Z.ShadersRepository="src/Shaders/",Z.ShadersStore={},Z.IncludesShadersStore={},Z.ShadersRepositoryWGSL="src/ShadersWGSL/",Z.ShadersStoreWGSL={},Z.IncludesShadersStoreWGSL={}},11224:(k,Q,i)=>{i.d(Q,{d:()=>H,h:()=>c,l:()=>F,p:()=>e,s:()=>z,t:()=>h,w:()=>G,y:()=>O,C:()=>J,D:()=>m,G:()=>o});class Z{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.FQ._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(k){k&&this.program&&k(this.program)}setEngine(k){this.FQ=k}_fillEffectInformation(k,Q,i,Z,U,C,B,o){const m=this.FQ;if(m.supportsUniformBuffers)for(const J in Q)k.bindUniformBlock(J,Q[J]);let O;for(this.FQ.getUniforms(this,i).forEach(((k,Q)=>{Z[i[Q]]=k})),this._uniforms=Z,O=0;O<U.length;O++){null==k.getUniform(U[O])&&(U.splice(O,1),O--)}U.forEach(((k,Q)=>{C[k]=Q}));for(const J of m.getAttributes(this,B))o.push(J)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(k,Q){const i=this._valueCache[k],Z=Q.updateFlag;return(void 0===i||i!==Z)&&(this._valueCache[k]=Z,!0)}_cacheFloat2(k,Q,i){let Z=this._valueCache[k];if(!Z||2!==Z.length)return Z=[Q,i],this._valueCache[k]=Z,!0;let U=!1;return Z[0]!==Q&&(Z[0]=Q,U=!0),Z[1]!==i&&(Z[1]=i,U=!0),U}_cacheFloat3(k,Q,i,Z){let U=this._valueCache[k];if(!U||3!==U.length)return U=[Q,i,Z],this._valueCache[k]=U,!0;let C=!1;return U[0]!==Q&&(U[0]=Q,C=!0),U[1]!==i&&(U[1]=i,C=!0),U[2]!==Z&&(U[2]=Z,C=!0),C}_cacheFloat4(k,Q,i,Z,U){let C=this._valueCache[k];if(!C||4!==C.length)return C=[Q,i,Z,U],this._valueCache[k]=C,!0;let B=!1;return C[0]!==Q&&(C[0]=Q,B=!0),C[1]!==i&&(C[1]=i,B=!0),C[2]!==Z&&(C[2]=Z,B=!0),C[3]!==U&&(C[3]=U,B=!0),B}setInt(k,Q){const i=this._valueCache[k];void 0!==i&&i===Q||this.FQ.setInt(this._uniforms[k],Q)&&(this._valueCache[k]=Q)}setInt2(k,Q,i){this._cacheFloat2(k,Q,i)&&(this.FQ.setInt2(this._uniforms[k],Q,i)||(this._valueCache[k]=null))}setInt3(k,Q,i,Z){this._cacheFloat3(k,Q,i,Z)&&(this.FQ.setInt3(this._uniforms[k],Q,i,Z)||(this._valueCache[k]=null))}setInt4(k,Q,i,Z,U){this._cacheFloat4(k,Q,i,Z,U)&&(this.FQ.setInt4(this._uniforms[k],Q,i,Z,U)||(this._valueCache[k]=null))}setIntArray(k,Q){this._valueCache[k]=null,this.FQ.setIntArray(this._uniforms[k],Q)}setIntArray2(k,Q){this._valueCache[k]=null,this.FQ.setIntArray2(this._uniforms[k],Q)}setIntArray3(k,Q){this._valueCache[k]=null,this.FQ.setIntArray3(this._uniforms[k],Q)}setIntArray4(k,Q){this._valueCache[k]=null,this.FQ.setIntArray4(this._uniforms[k],Q)}setUInt(k,Q){const i=this._valueCache[k];void 0!==i&&i===Q||this.FQ.setUInt(this._uniforms[k],Q)&&(this._valueCache[k]=Q)}setUInt2(k,Q,i){this._cacheFloat2(k,Q,i)&&(this.FQ.setUInt2(this._uniforms[k],Q,i)||(this._valueCache[k]=null))}setUInt3(k,Q,i,Z){this._cacheFloat3(k,Q,i,Z)&&(this.FQ.setUInt3(this._uniforms[k],Q,i,Z)||(this._valueCache[k]=null))}setUInt4(k,Q,i,Z,U){this._cacheFloat4(k,Q,i,Z,U)&&(this.FQ.setUInt4(this._uniforms[k],Q,i,Z,U)||(this._valueCache[k]=null))}setUIntArray(k,Q){this._valueCache[k]=null,this.FQ.setUIntArray(this._uniforms[k],Q)}setUIntArray2(k,Q){this._valueCache[k]=null,this.FQ.setUIntArray2(this._uniforms[k],Q)}setUIntArray3(k,Q){this._valueCache[k]=null,this.FQ.setUIntArray3(this._uniforms[k],Q)}setUIntArray4(k,Q){this._valueCache[k]=null,this.FQ.setUIntArray4(this._uniforms[k],Q)}setArray(k,Q){this._valueCache[k]=null,this.FQ.setArray(this._uniforms[k],Q)}setArray2(k,Q){this._valueCache[k]=null,this.FQ.setArray2(this._uniforms[k],Q)}setArray3(k,Q){this._valueCache[k]=null,this.FQ.setArray3(this._uniforms[k],Q)}setArray4(k,Q){this._valueCache[k]=null,this.FQ.setArray4(this._uniforms[k],Q)}setMatrices(k,Q){Q&&(this._valueCache[k]=null,this.FQ.setMatrices(this._uniforms[k],Q))}setMatrix(k,Q){this._cacheMatrix(k,Q)&&(this.FQ.setMatrices(this._uniforms[k],Q.Zo())||(this._valueCache[k]=null))}setMatrix3x3(k,Q){this._valueCache[k]=null,this.FQ.setMatrix3x3(this._uniforms[k],Q)}setMatrix2x2(k,Q){this._valueCache[k]=null,this.FQ.setMatrix2x2(this._uniforms[k],Q)}setFloat(k,Q){const i=this._valueCache[k];void 0!==i&&i===Q||this.FQ.setFloat(this._uniforms[k],Q)&&(this._valueCache[k]=Q)}setVector2(k,Q){this._cacheFloat2(k,Q.x,Q.y)&&(this.FQ.setFloat2(this._uniforms[k],Q.x,Q.y)||(this._valueCache[k]=null))}setFloat2(k,Q,i){this._cacheFloat2(k,Q,i)&&(this.FQ.setFloat2(this._uniforms[k],Q,i)||(this._valueCache[k]=null))}setVector3(k,Q){this._cacheFloat3(k,Q.x,Q.y,Q.z)&&(this.FQ.setFloat3(this._uniforms[k],Q.x,Q.y,Q.z)||(this._valueCache[k]=null))}setFloat3(k,Q,i,Z){this._cacheFloat3(k,Q,i,Z)&&(this.FQ.setFloat3(this._uniforms[k],Q,i,Z)||(this._valueCache[k]=null))}setVector4(k,Q){this._cacheFloat4(k,Q.x,Q.y,Q.z,Q.w)&&(this.FQ.setFloat4(this._uniforms[k],Q.x,Q.y,Q.z,Q.w)||(this._valueCache[k]=null))}setQuaternion(k,Q){this._cacheFloat4(k,Q.x,Q.y,Q.z,Q.w)&&(this.FQ.setFloat4(this._uniforms[k],Q.x,Q.y,Q.z,Q.w)||(this._valueCache[k]=null))}setFloat4(k,Q,i,Z,U){this._cacheFloat4(k,Q,i,Z,U)&&(this.FQ.setFloat4(this._uniforms[k],Q,i,Z,U)||(this._valueCache[k]=null))}setColor3(k,Q){this._cacheFloat3(k,Q.r,Q.g,Q.b)&&(this.FQ.setFloat3(this._uniforms[k],Q.r,Q.g,Q.b)||(this._valueCache[k]=null))}setColor4(k,Q,i){this._cacheFloat4(k,Q.r,Q.g,Q.b,i)&&(this.FQ.setFloat4(this._uniforms[k],Q.r,Q.g,Q.b,i)||(this._valueCache[k]=null))}setDirectColor4(k,Q){this._cacheFloat4(k,Q.r,Q.g,Q.b,Q.a)&&(this.FQ.setFloat4(this._uniforms[k],Q.r,Q.g,Q.b,Q.a)||(this._valueCache[k]=null))}_getVertexShaderCode(){return this.vertexShader?this.FQ._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.FQ._getShaderSource(this.fragmentShader):null}}var U=i(11187);const C=new WeakMap,B={_webGLVersion:2,cachedPipelines:{}};function o(k){let Q=C.get(k);if(!Q){if(!k)return B;Q={_webGLVersion:k.TEXTURE_BINDING_3D?2:1,_context:k,parallelShaderCompile:k.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},C.set(k,Q)}return Q}function m(k){C.delete(k)}function O(k,Q,i,Z,U,C){const B=o(Z);C||(C=B._createShaderProgramInjection??H);return C(k,l(Q,"vertex",Z,B._contextWasLost),l(i,"fragment",Z,B._contextWasLost),Z,U,B.validateShaderPrograms)}function J(k,Q,i,Z,U){let C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6?arguments[6]:void 0;const m=o(U);B||(B=m._createShaderProgramInjection??H);const O=m._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return B(k,E(Q,"vertex",Z,O,U,m._contextWasLost),E(i,"fragment",Z,O,U,m._contextWasLost),U,C,m.validateShaderPrograms)}function G(k,Q){const i=new Z,U=o(k);return U.parallelShaderCompile&&!U.disableParallelShaderCompile&&(i.isParallelCompiled=!0),i.context=U._context,i}function H(k,Q,i,Z){let U=arguments.length>5?arguments[5]:void 0;const C=Z.createProgram();if(k.program=C,!C)throw new Error("Unable to create program");return Z.attachShader(C,Q),Z.attachShader(C,i),Z.linkProgram(C),k.context=Z,k.vertexShader=Q,k.fragmentShader=i,k.isParallelCompiled||F(k,Z,U),C}function e(k,Q,i){const Z=k;if(Z._isDisposed)return!1;const U=o(Q);return!!(U&&U.parallelShaderCompile&&U.parallelShaderCompile.COMPLETION_STATUS_KHR&&Z.program&&Q.getProgramParameter(Z.program,U.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(F(Z,Q,i),!0)}function F(k,Q,i){const Z=k.context,U=k.vertexShader,C=k.fragmentShader,B=k.program;if(!Z.getProgramParameter(B,Z.LINK_STATUS)){if(!Q.getShaderParameter(U,Q.COMPILE_STATUS)){const i=Q.getShaderInfoLog(U);if(i)throw k.vertexCompilationError=i,new Error("VERTEX SHADER "+i)}if(!Q.getShaderParameter(C,Q.COMPILE_STATUS)){const i=Q.getShaderInfoLog(C);if(i)throw k.fragmentCompilationError=i,new Error("FRAGMENT SHADER "+i)}const i=Z.getProgramInfoLog(B);if(i)throw k.programLinkError=i,new Error(i)}if(i){Z.validateProgram(B);if(!Z.getProgramParameter(B,Z.VALIDATE_STATUS)){const Q=Z.getProgramInfoLog(B);if(Q)throw k.programValidationError=Q,new Error(Q)}}Z.deleteShader(U),Z.deleteShader(C),k.vertexShader=void 0,k.fragmentShader=void 0,k.onCompiled&&(k.onCompiled(),k.onCompiled=void 0)}function z(k,Q,i,Z,U,C,B,m,G){let H=arguments.length>10?arguments[10]:void 0,e=arguments.length>11?arguments[11]:void 0,F=arguments.length>12?arguments[12]:void 0;const z=o(k.context);e||(e=z.createRawShaderProgramInjection??O),F||(F=z.createShaderProgramInjection??J);const E=k;E.program=Z?e(E,Q,i,E.context,G):F(E,Q,i,m,E.context,G),E.program.__SPECTOR_rebuildProgram=B,H()}function E(k,Q,i,Z,C,B){return l((0,U.g)(k,i,Z),Q,C,B)}function l(k,Q,i,Z){const U=i.createShader("vertex"===Q?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!U){let k=i.NO_ERROR,U=i.NO_ERROR;for(;(U=i.getError())!==i.NO_ERROR;)k=U;throw new Error(`Something went wrong while creating a gl ${Q} shader object. gl error=${k}, gl isContextLost=${i.isContextLost()}, _contextWasLost=${Z}`)}return i.shaderSource(U,k),i.compileShader(U),U}function h(k,Q){Q.useProgram(k)}function c(k,Q){const i=k;if(!i.isParallelCompiled)return void Q(k);const Z=i.onCompiled;i.onCompiled=()=>{null===Z||void 0===Z||Z(),Q(k)}}},11218:(k,Q,i)=>{i.d(Q,{b:()=>G,d:()=>e,e:()=>O,f:()=>J});var Z=i(11131),U=i(11224),C=i(11210),B=i(11134),o=i(11183),m=i(11187);function O(k,Q){return(0,U.G)(Q).cachedPipelines[k]}function J(k){const Q=k._name,i=k.context;if(Q&&i){const k=(0,U.G)(i),Z=k.cachedPipelines[Q];null===Z||void 0===Z||Z.dispose(),delete k.cachedPipelines[Q]}}function G(k,Q,i,U,C,B,m){let O,J;const G=(0,Z.j)()?null===B||void 0===B?void 0:B.getHostDocument():null;O="string"===typeof Q?Q:Q.vertexSource?"source:"+Q.vertexSource:Q.vertexElement?(null===G||void 0===G?void 0:G.getElementById(Q.vertexElement))||Q.vertexElement:Q.vertex||Q,J="string"===typeof Q?Q:Q.fragmentSource?"source:"+Q.fragmentSource:Q.fragmentElement?(null===G||void 0===G?void 0:G.getElementById(Q.fragmentElement))||Q.fragmentElement:Q.fragment||Q;const e=[void 0,void 0],F=()=>{if(e[0]&&e[1]){k.isFragment=!0;const[Z,O]=e;(0,o.n)(O,k,((B,O)=>{m&&(m._fragmentSourceCodeBeforeMigration=O),i&&(B=i("fragment",B));const J=(0,o.d)(Z,B,k);k=null;const G=function(k,Q,i,Z){if(i){return{vertexSourceCode:(1===Z?"//":"")+"#define SHADER_NAME vertex:"+(i.vertexElement||i.vertex||i.spectorName||i)+"\n"+k,fragmentSourceCode:(1===Z?"//":"")+"#define SHADER_NAME fragment:"+(i.fragmentElement||i.fragment||i.spectorName||i)+"\n"+Q}}return{vertexSourceCode:k,fragmentSourceCode:Q}}(J.vertexCode,J.fragmentCode,Q,C);null===U||void 0===U||U(G.vertexSourceCode,G.fragmentSourceCode)}),B)}};H(O,"Vertex","",(Q=>{(0,o.h)(k),(0,o.n)(Q,k,((k,Z)=>{m&&(m._rawVertexSourceCode=Q,m._vertexSourceCodeBeforeMigration=Z),i&&(k=i("vertex",k)),e[0]=k,F()}),B)}),C),H(J,"Fragment","Pixel",(k=>{m&&(m._rawFragmentSourceCode=k),e[1]=k,F()}),C)}function H(k,Q,i,U,B,o){if("undefined"!==typeof HTMLElement&&k instanceof HTMLElement){return void U((0,Z.b)(k))}if("source:"===k.substring(0,7))return void U(k.substring(7));if("base64:"===k.substring(0,7)){return void U(window.atob(k.substring(7)))}const O=C.d.GetShadersStore(B);if(O[k+Q+"Shader"])return void U(O[k+Q+"Shader"]);if(i&&O[k+i+"Shader"])return void U(O[k+i+"Shader"]);let J;if(J="."===k[0]||"/"===k[0]||k.indexOf("http")>-1?k:C.d.GetShadersRepository(B)+k,!(o=o||m.n))throw new Error("loadFileInjection is not defined");o(J+"."+Q.toLowerCase()+".fx",U)}const e=(k,Q,i,Z)=>{try{const C=k.context?(0,U.G)(k.context):null;C&&(C.disableParallelShaderCompile=k.disableParallelCompilation);const B=k.existingPipelineContext||Q(k.shaderProcessingContext);return B._name=k.name,k.name&&C&&(C.cachedPipelines[k.name]=B),i(B,k.vertex,k.fragment,!!k.createAsRaw,"","",k.rebuildRebind,k.defines,k.transformFeedbackVaryings,"",(()=>{Z(B,(()=>{var Q;null===(Q=k.onRenderingStateCompiled)||void 0===Q||Q.call(k,B)}))})),B}catch(C){throw B.c.Error("Error compiling effect"),C}}},11203:(k,Q,i)=>{i.r(Q),i.d(Q,{Effect:()=>m});var Z=i(11122),U=i(11134),C=i(11210),B=i(11218),o=i(11189);class m{static get ShadersRepository(){return C.d.ShadersRepository}static set ShadersRepository(k){C.d.ShadersRepository=k}get J(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Z.c),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(k,Q,i){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,H=arguments.length>9?arguments[9]:void 0,e=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,z=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new Z.c,this.onErrorObservable=new Z.c,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=k,this._key=e;const E=this._key.replace(/\r/g,"").replace(/\n/g,"|");let l;if(Q.attributes){const k=Q;if(this._engine=i,this._attributesNames=k.attributes,this._uniformsNames=k.uniformsNames.concat(k.samplers),this._samplerList=k.samplers.slice(),this.defines=k.defines,this.onError=k.onError,this.onCompiled=k.onCompiled,this._fallbacks=k.fallbacks,this._indexParameters=k.indexParameters,this._transformFeedbackVaryings=k.transformFeedbackVaryings||null,this._multiTarget=!!k.multiTarget,this._shaderLanguage=k.shaderLanguage??0,this._disableParallelShaderCompilation=!!k.disableParallelShaderCompilation,k.uniformBuffersNames){this._uniformBuffersNamesList=k.uniformBuffersNames.slice();for(let Q=0;Q<k.uniformBuffersNames.length;Q++)this._uniformBuffersNames[k.uniformBuffersNames[Q]]=Q}this._processFinalCode=k.processFinalCode??null,this._processCodeAfterIncludes=k.processCodeAfterIncludes??void 0,z=k.extraInitializationsAsync,l=k.existingPipelineContext}else this._engine=C,this.defines=null==o?"":o,this._uniformsNames=i.concat(U),this._samplerList=U?U.slice():[],this._attributesNames=Q,this._uniformBuffersNamesList=[],this._shaderLanguage=F,this.onError=G,this.onCompiled=J,this._indexParameters=H,this._fallbacks=O;"WEBGL2"===this._engine.shaderPlatformName&&(l=(0,B.e)(E,this._engine._gl)??l),this._attributeLocationByName={},this.uniqueId=m._UniqueIdSeed++,l?(this._pipelineContext=l,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,z),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.J||this.dispose(!0)}))}async _processShaderCodeAsync(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3?arguments[3]:void 0;Z&&await Z(),this._processingContext=i||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const U={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:k??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:C.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:C.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,B.b)(U,this.name,this._processFinalCode,((k,i)=>{this._vertexSourceCode=k,this._fragmentSourceCode=i,this._prepareEffect(Q)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.J||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(k){return this._attributes[k]}getAttributeLocationByName(k){return this._attributeLocationByName[k]}getAttributesCount(){return this._attributes.length}getUniformIndex(k){return this._uniformsNames.indexOf(k)}getUniform(k){return this._uniforms[k]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((k=>{this.executeWhenCompiled(k)}))}executeWhenCompiled(k){this.isReady()?k(this):(this.onCompileObservable.add((Q=>{k(Q)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(k){(0,o.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(Q=>{this._processCompilationErrors(Q,k)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var k;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(k=this._pipelineContext)||void 0===k?void 0:k._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var k;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(k=this._pipelineContext)||void 0===k?void 0:k._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(k,Q,i,Z){this._isReady=!1,this._vertexSourceCodeOverride=k,this._fragmentSourceCodeOverride=Q,this.onError=(k,Q)=>{Z&&Z(Q)},this.onCompiled=()=>{var k,Q;const Z=this.getEngine().scenes;if(Z)for(let i=0;i<Z.length;i++)Z[i].markAllMaterialsAsDirty(127);null===(k=(Q=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===k||k.call(Q,i)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(k){if(this._pipelineContext=k,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let Q=0;Q<this._attributesNames.length;Q++){const k=this._attributesNames[Q];this._attributeLocationByName[k]=this._attributes[Q]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),m.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Q=this._pipelineContext;this._isReady=!1;try{const i=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),Z=i?null:this.defines,U=i?this._vertexSourceCodeOverride:this._vertexSourceCode,C=i?this._fragmentSourceCodeOverride:this._fragmentSourceCode,o=this._engine;this._pipelineContext=(0,B.d)({existingPipelineContext:k?Q:null,vertex:U,fragment:C,context:"WEBGL2"===o.shaderPlatformName||"WEBGL1"===o.shaderPlatformName?o._gl:void 0,rebuildRebind:(k,Q,i,Z)=>this._rebuildProgram(k,Q,i,Z),defines:Z,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:i,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:i=>{Q&&!k&&this._engine._deletePipelineContext(Q),i&&this._onRenderingStateCompiled(i)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(Q)}catch(i){this._processCompilationErrors(i,Q)}}_getShaderCodeAndErrorLine(k,Q,i){const Z=i?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let U=null;if(Q&&k){const C=Q.match(Z);if(C&&2===C.length){const Q=parseInt(C[1]),Z=k.split("\n",-1);Z.length>=Q&&(U=`Offending line [${Q}] in ${i?"fragment":"vertex"} code: ${Z[Q-1]}`)}}return[k,U]}_processCompilationErrors(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=k.message;const i=this._attributesNames,Z=this._fallbacks;if(U.c.Error("Unable to compile effect:"),U.c.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),U.c.Error(`Attributes: ${i.join(" ")}`),U.c.Error("Defines:\n"+this.defines),m.LogShaderCodeOnCompilationError){var C,B;let k=null,Q=null,i=null;var o;if(null!==(C=this._pipelineContext)&&void 0!==C&&C._getVertexShaderCode()&&([i,k]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),i&&(U.c.Error("Vertex code:"),U.c.Error(i))),null!==(B=this._pipelineContext)&&void 0!==B&&B._getFragmentShaderCode())[i,Q]=this._getShaderCodeAndErrorLine(null===(o=this._pipelineContext)||void 0===o?void 0:o._getFragmentShaderCode(),this._compilationError,!0),i&&(U.c.Error("Fragment code:"),U.c.Error(i));k&&U.c.Error(k),Q&&U.c.Error(Q)}U.c.Error("Error: "+this._compilationError);const O=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};Q&&(this._pipelineContext=Q,this._isReady=!0,O()),Z?(this._pipelineContext=null,Z.hasMoreFallbacks?(this._allFallbacksProcessed=!1,U.c.Error("Trying next fallback."),this.defines=Z.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,O(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,Q||O())}get isSupported(){return""===this._compilationError}_bindTexture(k,Q){this._engine._bindTexture(this._samplers[k],Q,k)}setTexture(k,Q){this._engine.setTexture(this._samplers[k],this._uniforms[k],Q,k)}setTextureArray(k,Q){const i=k+"Ex";if(-1===this._samplerList.indexOf(i+"0")){const Z=this._samplerList.indexOf(k);for(let k=1;k<Q.length;k++){const Q=i+(k-1).toString();this._samplerList.splice(Z+k,0,Q)}let U=0;for(const k of this._samplerList)this._samplers[k]=U,U+=1}this._engine.setTextureArray(this._samplers[k],this._uniforms[k],Q,k)}bindUniformBuffer(k,Q){const i=this._uniformBuffersNames[Q];void 0===i||m._BaseCache[i]===k&&this._engine._features.useUBOBindingCache||(m._BaseCache[i]=k,this._engine.bindUniformBufferBase(k,i,Q))}bindUniformBlock(k,Q){this._engine.bindUniformBlock(this._pipelineContext,k,Q)}setInt(k,Q){return this._pipelineContext.setInt(k,Q),this}setInt2(k,Q,i){return this._pipelineContext.setInt2(k,Q,i),this}setInt3(k,Q,i,Z){return this._pipelineContext.setInt3(k,Q,i,Z),this}setInt4(k,Q,i,Z,U){return this._pipelineContext.setInt4(k,Q,i,Z,U),this}setIntArray(k,Q){return this._pipelineContext.setIntArray(k,Q),this}setIntArray2(k,Q){return this._pipelineContext.setIntArray2(k,Q),this}setIntArray3(k,Q){return this._pipelineContext.setIntArray3(k,Q),this}setIntArray4(k,Q){return this._pipelineContext.setIntArray4(k,Q),this}setUInt(k,Q){return this._pipelineContext.setUInt(k,Q),this}setUInt2(k,Q,i){return this._pipelineContext.setUInt2(k,Q,i),this}setUInt3(k,Q,i,Z){return this._pipelineContext.setUInt3(k,Q,i,Z),this}setUInt4(k,Q,i,Z,U){return this._pipelineContext.setUInt4(k,Q,i,Z,U),this}setUIntArray(k,Q){return this._pipelineContext.setUIntArray(k,Q),this}setUIntArray2(k,Q){return this._pipelineContext.setUIntArray2(k,Q),this}setUIntArray3(k,Q){return this._pipelineContext.setUIntArray3(k,Q),this}setUIntArray4(k,Q){return this._pipelineContext.setUIntArray4(k,Q),this}setFloatArray(k,Q){return this._pipelineContext.setArray(k,Q),this}setFloatArray2(k,Q){return this._pipelineContext.setArray2(k,Q),this}setFloatArray3(k,Q){return this._pipelineContext.setArray3(k,Q),this}setFloatArray4(k,Q){return this._pipelineContext.setArray4(k,Q),this}setArray(k,Q){return this._pipelineContext.setArray(k,Q),this}setArray2(k,Q){return this._pipelineContext.setArray2(k,Q),this}setArray3(k,Q){return this._pipelineContext.setArray3(k,Q),this}setArray4(k,Q){return this._pipelineContext.setArray4(k,Q),this}setMatrices(k,Q){return this._pipelineContext.setMatrices(k,Q),this}setMatrix(k,Q){return this._pipelineContext.setMatrix(k,Q),this}setMatrix3x3(k,Q){return this._pipelineContext.setMatrix3x3(k,Q),this}setMatrix2x2(k,Q){return this._pipelineContext.setMatrix2x2(k,Q),this}setFloat(k,Q){return this._pipelineContext.setFloat(k,Q),this}setBool(k,Q){return this._pipelineContext.setInt(k,Q?1:0),this}setVector2(k,Q){return this._pipelineContext.setVector2(k,Q),this}setFloat2(k,Q,i){return this._pipelineContext.setFloat2(k,Q,i),this}setVector3(k,Q){return this._pipelineContext.setVector3(k,Q),this}setFloat3(k,Q,i,Z){return this._pipelineContext.setFloat3(k,Q,i,Z),this}setVector4(k,Q){return this._pipelineContext.setVector4(k,Q),this}setQuaternion(k,Q){return this._pipelineContext.setQuaternion(k,Q),this}setFloat4(k,Q,i,Z,U){return this._pipelineContext.setFloat4(k,Q,i,Z,U),this}setColor3(k,Q){return this._pipelineContext.setColor3(k,Q),this}setColor4(k,Q,i){return this._pipelineContext.setColor4(k,Q,i),this}setDirectColor4(k,Q){return this._pipelineContext.setDirectColor4(k,Q),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(m.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,B.f)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Q&&(C.d.GetShadersStore(Z)[`${k}PixelShader`]=Q),i&&(C.d.GetShadersStore(Z)[`${k}VertexShader`]=i)}static ResetCache(){m._BaseCache={}}}m.LogShaderCodeOnCompilationError=!0,m.PersistentMode=!1,m.AutomaticallyClearCodeCache=!1,m._UniqueIdSeed=0,m._BaseCache={},m.ShadersStore=C.d.ShadersStore,m.IncludesShadersStore=C.d.IncludesShadersStore},11146:(k,Q,i)=>{i.d(Q,{d:()=>U});const Z={};function U(k){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!Z[k])return Z[k]=!0,`${k} needs to be imported before as it contains a side-effect required by your code.`}},11131:(k,Q,i)=>{function Z(){return"undefined"!==typeof window}function U(){return"undefined"!==typeof navigator}function C(){return"undefined"!==typeof document}function B(k){let Q="",i=k.firstChild;for(;i;)3===i.nodeType&&(Q+=i.textContent),i=i.nextSibling;return Q}i.d(Q,{b:()=>B,e:()=>C,f:()=>U,j:()=>Z})},11134:(k,Q,i)=>{i.d(Q,{c:()=>Z});class Z{static _CheckLimit(k,Q){let i=Z._LogLimitOutputs[k];return i?i.current++:(i={limit:Q,current:1},Z._LogLimitOutputs[k]=i),i.current<=i.limit}static _GenerateLimitMessage(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const i=Z._LogLimitOutputs[k];if(!i||!Z.MessageLimitReached)return;const U=this._Levels[Q];i.current===i.limit&&Z[U.name](Z.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,U.name??""))}static _AddLogEntry(k){Z._LogCache=k+Z._LogCache,Z.OnNewCacheEntry&&Z.OnNewCacheEntry(k)}static _FormatMessage(k){const Q=k=>k<10?"0"+k:""+k,i=new Date;return"["+Q(i.getHours())+":"+Q(i.getMinutes())+":"+Q(i.getSeconds())+"]: "+k}static _LogDisabled(k,Q){}static _LogEnabled(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;const U=Array.isArray(Q)?Q[0]:Q;if(void 0!==i&&!Z._CheckLimit(U,i))return;const C=Z._FormatMessage(U),B=this._Levels[k],o=Array.isArray(Q)?Q.slice(1):[];B.logFunc&&B.logFunc("BJS - "+C,...o);const m=`<div style='color:${B.color}'>${C}</div><br>`;Z._AddLogEntry(m),Z._GenerateLimitMessage(U,k)}static get LogCache(){return Z._LogCache}static ClearLogCache(){Z._LogCache="",Z._LogLimitOutputs={},Z.errorsCount=0}static set LogLevels(k){Z.Log=Z._LogDisabled,Z.Warn=Z._LogDisabled,Z.Error=Z._LogDisabled;const Q=[Z.MessageLogLevel,Z.WarningLogLevel,Z.ErrorLogLevel];for(const i of Q)if((k&i)===i){const k=this._Levels[i];Z[k.name]=Z._LogEnabled.bind(Z,i)}}}Z.NoneLogLevel=0,Z.MessageLogLevel=1,Z.WarningLogLevel=2,Z.ErrorLogLevel=4,Z.AllLogLevel=7,Z.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",Z._LogCache="",Z._LogLimitOutputs={},Z._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],Z.errorsCount=0,Z.Log=Z._LogEnabled.bind(Z,Z.MessageLogLevel),Z.Warn=Z._LogEnabled.bind(Z,Z.WarningLogLevel),Z.Error=Z._LogEnabled.bind(Z,Z.ErrorLogLevel)},11122:(k,Q,i)=>{i.d(Q,{c:()=>B});const Z="undefined"!==typeof WeakRef;class U{constructor(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0;this.initialize(k,Q,i,Z)}initialize(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0;return this.mask=k,this.skipNextObservers=Q,this.target=i,this.currentTarget=Z,this}}class C{constructor(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=k,this.mask=Q,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(k)}}class B{static FromPromise(k,Q){const i=new B;return k.then((k=>{i.notifyObservers(k)})).catch((k=>{if(!Q)throw k;Q.notifyObservers(k)})),i}get observers(){return this._observers}constructor(k){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=Q,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new U(0),k&&(this._onObserverAdded=k)}add(k){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!k)return null;const U=new C(k,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);U.unregisterOnNextCall=i,Q?this._observers.unshift(U):this._observers.push(U),this._onObserverAdded&&this._onObserverAdded(U),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(U,this._lastNotifiedValue);const B=Z?new WeakRef(this):{deref:()=>this};return U._remove=function(){let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Q=B.deref();Q&&(k?Q.remove(U):Q._remove(U))},U}addOnce(k){return this.add(k,void 0,void 0,void 0,!0)}remove(k){if(!k)return!1;k._remove=null;return-1!==this._observers.indexOf(k)&&(this._deferUnregister(k),!0)}removeCallback(k,Q){for(let i=0;i<this._observers.length;i++){const Z=this._observers[i];if(!Z._willBeUnregistered&&(Z.callback===k&&(!Q||Q===Z.scope)))return this._deferUnregister(Z),!0}return!1}_deferUnregister(k){k._willBeUnregistered||(this._numObserversMarkedAsDeleted++,k.unregisterOnNextCall=!1,k._willBeUnregistered=!0,setTimeout((()=>{this._remove(k)}),0))}_remove(k){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!k)return!1;const i=this._observers.indexOf(k);return-1!==i&&(Q&&this._numObserversMarkedAsDeleted--,this._observers.splice(i,1),!0)}makeObserverTopPriority(k){this._remove(k,!1),this._observers.unshift(k)}makeObserverBottomPriority(k){this._remove(k,!1),this._observers.push(k)}notifyObservers(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=k),!this._observers.length)return!0;const C=this._eventState;C.mask=Q,C.target=i,C.currentTarget=Z,C.skipNextObservers=!1,C.lastReturnValue=k,C.userInfo=U;for(const B of this._observers)if(!B._willBeUnregistered&&(B.mask&Q&&(B.unregisterOnNextCall&&this._deferUnregister(B),B.scope?C.lastReturnValue=B.callback.apply(B.scope,[k,C]):C.lastReturnValue=B.callback(k,C)),C.skipNextObservers))return!1;return!0}notifyObserver(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=Q),k._willBeUnregistered)return;const Z=this._eventState;Z.mask=i,Z.skipNextObservers=!1,k.unregisterOnNextCall&&this._deferUnregister(k),k.callback(Q,Z)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const k=this._observers.pop();k&&(k._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const k=new B;return k._observers=this._observers.slice(0),k}hasSpecificMask(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const Q of this._observers)if(Q.mask&k||Q.mask===k)return!0;return!1}}},11189:(k,Q,i)=>{i.d(Q,{c:()=>U,f:()=>B});let Z=[];class U{static SetImmediate(k){0===Z.length&&setTimeout((()=>{const k=Z;Z=[];for(const Q of k)Q()}),1),Z.push(k)}}function C(k,Q,i){try{if(k())return Q(),!0}catch(Z){return null===i||void 0===i||i(Z),!0}return!1}const B=function(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,B=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&C(k,Q,i))return null;const o=setInterval((()=>{C(k,Q,i)?clearInterval(o):(U-=Z,U<0&&(clearInterval(o),null===i||void 0===i||i(new Error("Operation timed out after maximum retries. "+(B||"")),!0)))}),Z);return()=>clearInterval(o)}}}]);