/*! For license information please see znec.9.ac7d59df.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{12779:(V,p,W)=>{"use strict";var N=W(12783),d=W(12789),E=W(12791);W.g.__TYPEDARRAY_POOL||(W.g.__TYPEDARRAY_POOL={UINT8:d([32,0]),UINT16:d([32,0]),UINT32:d([32,0]),INT8:d([32,0]),INT16:d([32,0]),INT32:d([32,0]),FLOAT:d([32,0]),DOUBLE:d([32,0]),DATA:d([32,0]),UINT8C:d([32,0]),BUFFER:d([32,0])});var z="undefined"!==typeof Uint8ClampedArray,S=W.g.__TYPEDARRAY_POOL;S.UINT8C||(S.UINT8C=d([32,0])),S.BUFFER||(S.BUFFER=d([32,0]));var Q=S.DATA,J=S.BUFFER;function i(V){if(V){var p=V.length||V.byteLength,W=N.log2(p);Q[W].push(V)}}function l(V){V=N.nextPow2(V);var p=N.log2(V),W=Q[p];return W.length>0?W.pop():new ArrayBuffer(V)}function j(V){return new Uint8Array(l(V),0,V)}function k(V){return new Uint16Array(l(2*V),0,V)}function u(V){return new Uint32Array(l(4*V),0,V)}function f(V){return new Int8Array(l(V),0,V)}function O(V){return new Int16Array(l(2*V),0,V)}function U(V){return new Int32Array(l(4*V),0,V)}function F(V){return new Float32Array(l(4*V),0,V)}function C(V){return new Float64Array(l(8*V),0,V)}function A(V){return z?new Uint8ClampedArray(l(V),0,V):j(V)}function v(V){return new DataView(l(V),0,V)}p.free=function(V){if(E(V))J[N.log2(V.length)].push(V);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(V)&&(V=V.buffer),!V)return;var p=V.length||V.byteLength,W=0|N.log2(p);Q[W].push(V)}},p.freeUint8=p.freeUint16=p.freeUint32=p.freeInt8=p.freeInt16=p.freeInt32=p.freeFloat32=p.freeFloat=p.freeFloat64=p.freeDouble=p.freeUint8Clamped=p.freeDataView=function(V){i(V.buffer)},p.freeArrayBuffer=i,p.freeBuffer=function(V){J[N.log2(V.length)].push(V)},p.malloc=function(V,p){if(void 0===p||"arraybuffer"===p)return l(V);switch(p){case"uint8":return j(V);case"uint16":return k(V);case"uint32":return u(V);case"int8":return f(V);case"int16":return O(V);case"int32":return U(V);case"float":case"float32":return F(V);case"double":case"float64":return C(V);case"uint8_clamped":return A(V);case"buffer":throw"Buffer not supported";case"data":case"dataview":return v(V);default:return null}return null},p.mallocArrayBuffer=l,p.mallocUint8=j,p.mallocUint16=k,p.mallocUint32=u,p.mallocInt8=f,p.mallocInt16=O,p.mallocInt32=U,p.mallocFloat32=p.mallocFloat=F,p.mallocFloat64=p.mallocDouble=C,p.mallocUint8Clamped=A,p.mallocDataView=v,p.clearCache=function(){for(var V=0;V<32;++V)S.UINT8[V].length=0,S.UINT16[V].length=0,S.UINT32[V].length=0,S.INT8[V].length=0,S.INT16[V].length=0,S.INT32[V].length=0,S.FLOAT[V].length=0,S.DOUBLE[V].length=0,S.UINT8C[V].length=0,Q[V].length=0,J[V].length=0}},12868:(V,p,W)=>{V.exports=d;var N=W(12162);function d(V,p){if(!(this instanceof d))return new d(V,p);var W=N.create();N.add(W,V,p),this.base=N.min(N.create(),V,W),this.Yg=N.clone(p),this.max=N.max(N.create(),V,W),this.mag=N.length(this.Yg)}var E=d.prototype;E.width=function(){return this.Yg[0]},E.height=function(){return this.Yg[1]},E.depth=function(){return this.Yg[2]},E.x0=function(){return this.base[0]},E.y0=function(){return this.base[1]},E.z0=function(){return this.base[2]},E.x1=function(){return this.max[0]},E.y1=function(){return this.max[1]},E.z1=function(){return this.max[2]},E.translate=function(V){return N.add(this.max,this.max,V),N.add(this.base,this.base,V),this},E.setPosition=function(V){return N.add(this.max,V,this.Yg),N.i(this.base,V),this},E.expand=function(V){var p=N.create(),W=N.create();return N.max(p,V.max,this.max),N.min(W,V.base,this.base),N.ed(p,p,W),new d(W,p)},E.intersects=function(V){return!(V.base[0]>this.max[0])&&(!(V.base[1]>this.max[1])&&(!(V.base[2]>this.max[2])&&(!(V.max[0]<this.base[0])&&(!(V.max[1]<this.base[1])&&!(V.max[2]<this.base[2])))))},E.touches=function(V){var p=this.union(V);return null!==p&&(0==p.width()||0==p.height()||0==p.depth())},E.union=function(V){if(!this.intersects(V))return null;var p=Math.max(V.base[0],this.base[0]),W=Math.max(V.base[1],this.base[1]),N=Math.max(V.base[2],this.base[2]);return new d([p,W,N],[Math.min(V.max[0],this.max[0])-p,Math.min(V.max[1],this.max[1])-W,Math.min(V.max[2],this.max[2])-N])}},12783:(V,p)=>{"use strict";function W(V){var p=32;return(V&=-V)&&p--,65535&V&&(p-=16),16711935&V&&(p-=8),252645135&V&&(p-=4),858993459&V&&(p-=2),1431655765&V&&(p-=1),p}p.INT_BITS=32,p.INT_MAX=2147483647,p.INT_MIN=-1<<31,p.sign=function(V){return(V>0)-(V<0)},p.abs=function(V){var p=V>>31;return(V^p)-p},p.min=function(V,p){return p^(V^p)&-(V<p)},p.max=function(V,p){return V^(V^p)&-(V<p)},p.isPow2=function(V){return!(V&V-1)&&!!V},p.log2=function(V){var p,W;return p=(V>65535)<<4,p|=W=((V>>>=p)>255)<<3,p|=W=((V>>>=W)>15)<<2,(p|=W=((V>>>=W)>3)<<1)|(V>>>=W)>>1},p.log10=function(V){return V>=1e9?9:V>=1e8?8:V>=1e7?7:V>=1e6?6:V>=1e5?5:V>=1e4?4:V>=1e3?3:V>=100?2:V>=10?1:0},p.popCount=function(V){return 16843009*((V=(858993459&(V-=V>>>1&1431655765))+(V>>>2&858993459))+(V>>>4)&252645135)>>>24},p.countTrailingZeros=W,p.nextPow2=function(V){return V+=0===V,--V,V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)+1},p.prevPow2=function(V){return V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)-(V>>>1)},p.parity=function(V){return V^=V>>>16,V^=V>>>8,V^=V>>>4,27030>>>(V&=15)&1};var N=new Array(256);!function(V){for(var p=0;p<256;++p){var W=p,N=p,d=7;for(W>>>=1;W;W>>>=1)N<<=1,N|=1&W,--d;V[p]=N<<d&255}}(N),p.reverse=function(V){return N[255&V]<<24|N[V>>>8&255]<<16|N[V>>>16&255]<<8|N[V>>>24&255]},p.interleave2=function(V,p){return(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V&=65535)|V<<8))|V<<4))|V<<2))|V<<1))|(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p&=65535)|p<<8))|p<<4))|p<<2))|p<<1))<<1},p.deinterleave2=function(V,p){return(V=65535&((V=16711935&((V=252645135&((V=858993459&((V=V>>>p&1431655765)|V>>>1))|V>>>2))|V>>>4))|V>>>16))<<16>>16},p.interleave3=function(V,p,W){return V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2),(V|=(p=1227133513&((p=3272356035&((p=251719695&((p=4278190335&((p&=1023)|p<<16))|p<<8))|p<<4))|p<<2))<<1)|(W=1227133513&((W=3272356035&((W=251719695&((W=4278190335&((W&=1023)|W<<16))|W<<8))|W<<4))|W<<2))<<2},p.deinterleave3=function(V,p){return(V=1023&((V=4278190335&((V=251719695&((V=3272356035&((V=V>>>p&1227133513)|V>>>2))|V>>>4))|V>>>8))|V>>>16))<<22>>22},p.nextCombination=function(V){var p=V|V-1;return p+1|(~p&-~p)-1>>>W(V)+1}},12770:(V,p,W)=>{"use strict";V.exports=function(V,p,W){switch(arguments.length){case 1:return N=[],J(d=V,d,i,!0),N;case 2:return"function"===typeof p?J(V,V,p,!0):function(V,p){return N=[],J(V,p,i,!1),N}(V,p);case 3:return J(V,p,W,!1);default:throw new Error("box-intersect: Invalid arguments")}var d};var N,d=W(12779),E=W(12795),z=W(12813);function S(V,p){for(var W=0;W<V;++W)if(!(p[W]<=p[W+V]))return!0;return!1}function Q(V,p,W,N){for(var d=0,E=0,z=0,Q=V.length;z<Q;++z){var J=V[z];if(!S(p,J)){for(var i=0;i<2*p;++i)W[d++]=J[i];N[E++]=z}}return E}function J(V,p,W,N){var S=V.length,J=p.length;if(!(S<=0||J<=0)){var i=V[0].length>>>1;if(!(i<=0)){var l,j=d.mallocDouble(2*i*S),k=d.mallocInt32(S);if((S=Q(V,i,j,k))>0){if(1===i&&N)E.init(S),l=E.sweepComplete(i,W,0,S,j,k,0,S,j,k);else{var u=d.mallocDouble(2*i*J),f=d.mallocInt32(J);(J=Q(p,i,u,f))>0&&(E.init(S+J),l=1===i?E.sweepBipartite(i,W,0,S,j,k,0,J,u,f):z(i,W,N,S,j,k,J,u,f),d.free(u),d.free(f))}d.free(j),d.free(k)}return l}}}function i(V,p){N.push([V,p])}},12820:(V,p)=>{"use strict";var W="d",N="ax",d="fp",E="es",z="rs",S="re",Q="rb",J="bs",i="be",l="bb",j=[W,N,"vv",z,S,Q,"ri",J,i,l,"bi"];function k(V){var p="bruteForce"+(V?"Full":"Partial"),N=[],z=j.slice();V||z.splice(3,0,d);var S=["function "+p+"("+z.join()+"){"];function Q(p,d){var z=function(V,p,N){var d="bruteForce"+(V?"Red":"Blue")+(p?"Flip":"")+(N?"Full":""),z=["function ",d,"(",j.join(),"){","var ",E,"=2*",W,";"],S="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",Q="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(N?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return V?z.push(S,"Q",":",Q):z.push(Q,"Q",":",S),N?z.push("if(y1<x0||x1<y0)continue;"):p?z.push("if(y0<=x0||x1<y0)continue;"):z.push("if(y0<x0||x1<y0)continue;"),z.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),p?z.push("yi,xi"):z.push("xi,yi"),z.push(");if(rv!==void 0)return rv;}}}"),{name:d,code:z.join("")}}(p,d,V);N.push(z.code),S.push("return "+z.name+"("+j.join()+");")}S.push("if(re-rs>be-bs){"),V?(Q(!0,!1),S.push("}else{"),Q(!1,!1)):(S.push("if(fp){"),Q(!0,!0),S.push("}else{"),Q(!0,!1),S.push("}}else{if(fp){"),Q(!1,!0),S.push("}else{"),Q(!1,!1),S.push("}")),S.push("}}return "+p);var J=N.join("")+S.join("");return new Function(J)()}p.partial=k(!1),p.full=k(!0)},12813:(V,p,W)=>{"use strict";V.exports=function(V,p,W,E,i,h,L,x,T){!function(V,p){var W=8*d.log2(p+1)*(V+1)|0,E=d.nextPow2(A*W);t.length<E&&(N.free(t),t=N.mallocInt32(E));var z=d.nextPow2(v*W);e.length<z&&(N.free(e),e=N.mallocDouble(z))}(V,E+L);var P,b=0,s=2*V;Z(b++,0,0,E,0,L,W?16:0,-1/0,1/0),W||Z(b++,0,0,L,0,E,1,-1/0,1/0);for(;b>0;){var G=(b-=1)*A,R=t[G],X=t[G+1],r=t[G+2],B=t[G+3],Y=t[G+4],I=t[G+5],c=b*v,q=e[c],g=e[c+1],D=1&I,H=!!(16&I),m=i,M=h,a=x,y=T;if(D&&(m=x,M=T,a=i,y=h),!(2&I&&X>=(r=O(V,R,X,r,m,M,g)))&&!(4&I&&(X=U(V,R,X,r,m,M,q))>=r)){var n=r-X,w=Y-B;if(H){if(V*n*(n+w)<k){if(void 0!==(P=Q.scanComplete(V,R,p,X,r,m,M,B,Y,a,y)))return P;continue}}else{if(V*Math.min(n,w)<l){if(void 0!==(P=z(V,R,p,D,X,r,m,M,B,Y,a,y)))return P;continue}if(V*n*w<j){if(void 0!==(P=Q.scanBipartite(V,R,p,D,X,r,m,M,B,Y,a,y)))return P;continue}}var VV=u(V,R,X,r,m,M,q,g);if(X<VV)if(V*(VV-X)<l){if(void 0!==(P=S(V,R+1,p,X,VV,m,M,B,Y,a,y)))return P}else if(R===V-2){if(void 0!==(P=D?Q.sweepBipartite(V,p,B,Y,a,y,X,VV,m,M):Q.sweepBipartite(V,p,X,VV,m,M,B,Y,a,y)))return P}else Z(b++,R+1,X,VV,B,Y,D,-1/0,1/0),Z(b++,R+1,B,Y,X,VV,1^D,-1/0,1/0);if(VV<r){var pV=J(V,R,B,Y,a,y),WV=a[s*pV+R],NV=f(V,R,pV,Y,a,y,WV);if(NV<Y&&Z(b++,R,VV,r,NV,Y,(4|D)+(H?16:0),WV,g),B<pV&&Z(b++,R,VV,r,B,pV,(2|D)+(H?16:0),q,WV),pV+1===NV){if(void 0!==(P=H?K(V,R,p,VV,r,m,M,pV,a,y[pV]):o(V,R,p,D,VV,r,m,M,pV,a,y[pV])))return P}else if(pV<NV){var dV;if(H){if(VV<(dV=F(V,R,VV,r,m,M,WV))){var EV=f(V,R,VV,dV,m,M,WV);if(R===V-2){if(VV<EV&&void 0!==(P=Q.sweepComplete(V,p,VV,EV,m,M,pV,NV,a,y)))return P;if(EV<dV&&void 0!==(P=Q.sweepBipartite(V,p,EV,dV,m,M,pV,NV,a,y)))return P}else VV<EV&&Z(b++,R+1,VV,EV,pV,NV,16,-1/0,1/0),EV<dV&&(Z(b++,R+1,EV,dV,pV,NV,0,-1/0,1/0),Z(b++,R+1,pV,NV,EV,dV,1,-1/0,1/0))}}else VV<(dV=D?C(V,R,VV,r,m,M,WV):F(V,R,VV,r,m,M,WV))&&(R===V-2?P=D?Q.sweepBipartite(V,p,pV,NV,a,y,VV,dV,m,M):Q.sweepBipartite(V,p,VV,dV,m,M,pV,NV,a,y):(Z(b++,R+1,VV,dV,pV,NV,D,-1/0,1/0),Z(b++,R+1,pV,NV,VV,dV,1^D,-1/0,1/0)))}}}}};var N=W(12779),d=W(12783),E=W(12820),z=E.partial,S=E.full,Q=W(12795),J=W(12824),i=W(12829),l=128,j=1<<22,k=1<<22,u=i("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),f=i("lo===p0",["p0"]),O=i("lo<p0",["p0"]),U=i("hi<=p0",["p0"]),F=i("lo<=p0&&p0<=hi",["p0"]),C=i("lo<p0&&p0<=hi",["p0"]),A=6,v=2,t=N.mallocInt32(1024),e=N.mallocDouble(1024);function Z(V,p,W,N,d,E,z,S,Q){var J=A*V;t[J]=p,t[J+1]=W,t[J+2]=N,t[J+3]=d,t[J+4]=E,t[J+5]=z;var i=v*V;e[i]=S,e[i+1]=Q}function o(V,p,W,N,d,E,z,S,Q,J,i){var l=2*V,j=Q*l,k=J[j+p];V:for(var u=d,f=d*l;u<E;++u,f+=l){var O=z[f+p],U=z[f+p+V];if(!(k<O||U<k)&&(!N||k!==O)){for(var F,C=S[u],A=p+1;A<V;++A){O=z[f+A],U=z[f+A+V];var v=J[j+A],t=J[j+A+V];if(U<v||t<O)continue V}if(void 0!==(F=N?W(i,C):W(C,i)))return F}}}function K(V,p,W,N,d,E,z,S,Q,J){var i=2*V,l=S*i,j=Q[l+p];V:for(var k=N,u=N*i;k<d;++k,u+=i){var f=z[k];if(f!==J){var O=E[u+p],U=E[u+p+V];if(!(j<O||U<j)){for(var F=p+1;F<V;++F){O=E[u+F],U=E[u+F+V];var C=Q[l+F],A=Q[l+F+V];if(U<C||A<O)continue V}var v=W(f,J);if(void 0!==v)return v}}}}},12824:(V,p,W)=>{"use strict";V.exports=function(V,p,W,z,S,Q){if(z<=W+1)return W;var J=W,i=z,l=z+W>>>1,j=2*V,k=l,u=S[j*l+p];for(;J<i;){if(i-J<d){E(V,p,J,i,S,Q),u=S[j*l+p];break}var f=i-J,O=Math.random()*f+J|0,U=S[j*O+p],F=Math.random()*f+J|0,C=S[j*F+p],A=Math.random()*f+J|0,v=S[j*A+p];U<=C?v>=C?(k=F,u=C):U>=v?(k=O,u=U):(k=A,u=v):C>=v?(k=F,u=C):v>=U?(k=O,u=U):(k=A,u=v);for(var t=j*(i-1),e=j*k,Z=0;Z<j;++Z,++t,++e){var o=S[t];S[t]=S[e],S[e]=o}var K=Q[i-1];Q[i-1]=Q[k],Q[k]=K;for(t=j*(i-1),e=j*(k=N(V,p,J,i-1,S,Q,u)),Z=0;Z<j;++Z,++t,++e){o=S[t];S[t]=S[e],S[e]=o}K=Q[i-1];if(Q[i-1]=Q[k],Q[k]=K,l<k){for(i=k-1;J<i&&S[j*(i-1)+p]===u;)i-=1;i+=1}else{if(!(k<l))break;for(J=k+1;J<i&&S[j*J+p]===u;)J+=1}}return N(V,p,W,l,S,Q,S[j*l+p])};var N=W(12829)("lo<p0",["p0"]),d=8;function E(V,p,W,N,d,E){for(var z=2*V,S=z*(W+1)+p,Q=W+1;Q<N;++Q,S+=z)for(var J=d[S],i=Q,l=z*(Q-1);i>W&&d[l+p]>J;--i,l-=z){for(var j=l,k=l+z,u=0;u<z;++u,++j,++k){var f=d[j];d[j]=d[k],d[k]=f}var O=E[i];E[i]=E[i-1],E[i-1]=O}}},12829:V=>{"use strict";V.exports=function(V,W){var N="abcdef".split("").concat(W),d=[];V.indexOf("lo")>=0&&d.push("lo=e[k+n]");V.indexOf("hi")>=0&&d.push("hi=e[k+o]");return N.push(p.replace("_",d.join()).replace("$",V)),Function.apply(void 0,N)};var p="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12804:V=>{"use strict";V.exports=function(V,N){N<=4*p?W(0,N-1,V):J(0,N-1,V)};var p=32;function W(V,p,W){for(var N=2*(V+1),d=V+1;d<=p;++d){for(var E=W[N++],z=W[N++],S=d,Q=N-2;S-- >V;){var J=W[Q-2],i=W[Q-1];if(J<E)break;if(J===E&&i<z)break;W[Q]=J,W[Q+1]=i,Q-=2}W[Q]=E,W[Q+1]=z}}function N(V,p,W){p*=2;var N=W[V*=2],d=W[V+1];W[V]=W[p],W[V+1]=W[p+1],W[p]=N,W[p+1]=d}function d(V,p,W){p*=2,W[V*=2]=W[p],W[V+1]=W[p+1]}function E(V,p,W,N){p*=2,W*=2;var d=N[V*=2],E=N[V+1];N[V]=N[p],N[V+1]=N[p+1],N[p]=N[W],N[p+1]=N[W+1],N[W]=d,N[W+1]=E}function z(V,p,W,N,d){p*=2,d[V*=2]=d[p],d[p]=W,d[V+1]=d[p+1],d[p+1]=N}function S(V,p,W){p*=2;var N=W[V*=2],d=W[p];return!(N<d)&&(N!==d||W[V+1]>W[p+1])}function Q(V,p,W,N){var d=N[V*=2];return d<p||d===p&&N[V+1]<W}function J(V,i,l){var j=(i-V+1)/6|0,k=V+j,u=i-j,f=V+i>>1,O=f-j,U=f+j,F=k,C=O,A=f,v=U,t=u,e=V+1,Z=i-1,o=0;S(F,C,l)&&(o=F,F=C,C=o),S(v,t,l)&&(o=v,v=t,t=o),S(F,A,l)&&(o=F,F=A,A=o),S(C,A,l)&&(o=C,C=A,A=o),S(F,v,l)&&(o=F,F=v,v=o),S(A,v,l)&&(o=A,A=v,v=o),S(C,t,l)&&(o=C,C=t,t=o),S(C,A,l)&&(o=C,C=A,A=o),S(v,t,l)&&(o=v,v=t,t=o);for(var K=l[2*C],h=l[2*C+1],L=l[2*v],x=l[2*v+1],T=2*F,P=2*A,b=2*t,s=2*k,G=2*f,R=2*u,X=0;X<2;++X){var r=l[T+X],B=l[P+X],Y=l[b+X];l[s+X]=r,l[G+X]=B,l[R+X]=Y}d(O,V,l),d(U,i,l);for(var I=e;I<=Z;++I)if(Q(I,K,h,l))I!==e&&N(I,e,l),++e;else if(!Q(I,L,x,l))for(;;){if(Q(Z,L,x,l)){Q(Z,K,h,l)?(E(I,e,Z,l),++e,--Z):(N(I,Z,l),--Z);break}if(--Z<I)break}z(V,e-1,K,h,l),z(i,Z+1,L,x,l),e-2-V<=p?W(V,e-2,l):J(V,e-2,l),i-(Z+2)<=p?W(Z+2,i,l):J(Z+2,i,l),Z-e<=p?W(e,Z,l):J(e,Z,l)}},12795:(V,p,W)=>{"use strict";V.exports={init:function(V){var p=d.nextPow2(V);Q.length<p&&(N.free(Q),Q=N.mallocInt32(p));J.length<p&&(N.free(J),J=N.mallocInt32(p));i.length<p&&(N.free(i),i=N.mallocInt32(p));l.length<p&&(N.free(l),l=N.mallocInt32(p));j.length<p&&(N.free(j),j=N.mallocInt32(p));k.length<p&&(N.free(k),k=N.mallocInt32(p));var W=8*p;u.length<W&&(N.free(u),u=N.mallocDouble(W))},sweepBipartite:function(V,p,W,N,d,S,j,k,U,F){for(var C=0,A=2*V,v=V-1,t=A-1,e=W;e<N;++e){var Z=S[e],o=A*e;u[C++]=d[o+v],u[C++]=-(Z+1),u[C++]=d[o+t],u[C++]=Z}for(e=j;e<k;++e){Z=F[e]+z;var K=A*e;u[C++]=U[K+v],u[C++]=-Z,u[C++]=U[K+t],u[C++]=Z}var h=C>>>1;E(u,h);var L=0,x=0;for(e=0;e<h;++e){var T=0|u[2*e+1];if(T>=z)f(i,l,x--,T=T-z|0);else if(T>=0)f(Q,J,L--,T);else if(T<=-z){T=-T-z|0;for(var P=0;P<L;++P){if(void 0!==(b=p(Q[P],T)))return b}O(i,l,x++,T)}else{T=-T-1|0;for(P=0;P<x;++P){var b;if(void 0!==(b=p(T,i[P])))return b}O(Q,J,L++,T)}}},sweepComplete:function(V,p,W,N,d,z,S,U,F,C){for(var A=0,v=2*V,t=V-1,e=v-1,Z=W;Z<N;++Z){var o=z[Z]+1<<1,K=v*Z;u[A++]=d[K+t],u[A++]=-o,u[A++]=d[K+e],u[A++]=o}for(Z=S;Z<U;++Z){o=C[Z]+1<<1;var h=v*Z;u[A++]=F[h+t],u[A++]=1|-o,u[A++]=F[h+e],u[A++]=1|o}var L=A>>>1;E(u,L);var x=0,T=0,P=0;for(Z=0;Z<L;++Z){var b=0|u[2*Z+1],s=1&b;if(Z<L-1&&b>>1===u[2*Z+3]>>1&&(s=2,Z+=1),b<0){for(var G=-(b>>1)-1,R=0;R<P;++R){if(void 0!==(X=p(j[R],G)))return X}if(0!==s)for(R=0;R<x;++R){if(void 0!==(X=p(Q[R],G)))return X}if(1!==s)for(R=0;R<T;++R){var X;if(void 0!==(X=p(i[R],G)))return X}0===s?O(Q,J,x++,G):1===s?O(i,l,T++,G):2===s&&O(j,k,P++,G)}else{G=(b>>1)-1;0===s?f(Q,J,x--,G):1===s?f(i,l,T--,G):2===s&&f(j,k,P--,G)}}},scanBipartite:function(V,p,W,N,d,S,i,l,j,k,U,F){var C=0,A=2*V,v=p,t=p+V,e=1,Z=1;N?Z=z:e=z;for(var o=d;o<S;++o){var K=o+e,h=A*o;u[C++]=i[h+v],u[C++]=-K,u[C++]=i[h+t],u[C++]=K}for(o=j;o<k;++o){K=o+Z;var L=A*o;u[C++]=U[L+v],u[C++]=-K}var x=C>>>1;E(u,x);var T=0;for(o=0;o<x;++o){var P=0|u[2*o+1];if(P<0){var b=!1;if((K=-P)>=z?(b=!N,K-=z):(b=!!N,K-=1),b)O(Q,J,T++,K);else{var s=F[K],G=A*K,R=U[G+p+1],X=U[G+p+1+V];V:for(var r=0;r<T;++r){var B=Q[r],Y=A*B;if(!(X<i[Y+p+1]||i[Y+p+1+V]<R)){for(var I=p+2;I<V;++I)if(U[G+I+V]<i[Y+I]||i[Y+I+V]<U[G+I])continue V;var c,q=l[B];if(void 0!==(c=N?W(s,q):W(q,s)))return c}}}}else f(Q,J,T--,P-e)}},scanComplete:function(V,p,W,N,d,S,J,i,l,j,k){for(var f=0,O=2*V,U=p,F=p+V,C=N;C<d;++C){var A=C+z,v=O*C;u[f++]=S[v+U],u[f++]=-A,u[f++]=S[v+F],u[f++]=A}for(C=i;C<l;++C){A=C+1;var t=O*C;u[f++]=j[t+U],u[f++]=-A}var e=f>>>1;E(u,e);var Z=0;for(C=0;C<e;++C){var o=0|u[2*C+1];if(o<0){if((A=-o)>=z)Q[Z++]=A-z;else{var K=k[A-=1],h=O*A,L=j[h+p+1],x=j[h+p+1+V];V:for(var T=0;T<Z;++T){var P=Q[T],b=J[P];if(b===K)break;var s=O*P;if(!(x<S[s+p+1]||S[s+p+1+V]<L)){for(var G=p+2;G<V;++G)if(j[h+G+V]<S[s+G]||S[s+G+V]<j[h+G])continue V;var R=W(b,K);if(void 0!==R)return R}}}}else{for(A=o-z,T=Z-1;T>=0;--T)if(Q[T]===A){for(G=T+1;G<Z;++G)Q[G-1]=Q[G];break}--Z}}}};var N=W(12779),d=W(12783),E=W(12804),z=1<<28,S=1024,Q=N.mallocInt32(S),J=N.mallocInt32(S),i=N.mallocInt32(S),l=N.mallocInt32(S),j=N.mallocInt32(S),k=N.mallocInt32(S),u=N.mallocDouble(8192);function f(V,p,W,N){var d=p[N],E=V[W-1];V[d]=E,p[E]=d}function O(V,p,W,N){V[W]=N,p[N]=W}},12789:V=>{"use strict";function p(V,W,N){var d=0|V[N];if(d<=0)return[];var E,z=new Array(d);if(N===V.length-1)for(E=0;E<d;++E)z[E]=W;else for(E=0;E<d;++E)z[E]=p(V,W,N+1);return z}V.exports=function(V,W){switch("undefined"===typeof W&&(W=0),typeof V){case"number":if(V>0)return function(V,p){var W,N;for(W=new Array(V),N=0;N<V;++N)W[N]=p;return W}(0|V,W);break;case"object":if("number"===typeof V.length)return p(V,W,0)}return[]}},12745:(V,p,W)=>{V.exports=function(){var V=this;this.components={},this.comps=this.components;var p=this.components,W=1,d={},E=[],z=[],S={timeout:!1,removals:[],multiComps:[]};function Q(V,W){var N=p[W],E=d[W],z=E.hash[V];z&&(E.remove(V),N.ab&&(N.multi?(z.forEach((p=>{p&&N.ab(V,p)})),z.length=0):N.ab(V,z)),S.removals.push(E),J())}function J(){S.timeout||(S.timeout=!0,setTimeout(i,1))}function i(){S.timeout=!1,l()}function l(){S.multiComps.length&&function(V){for(var p=0;p<V.length;p++){var{entID:W,data:N}=V[p],d=N.hash[W];if(d){for(var E=0;E<d.length;E++)d[E]||(d.splice(E,1),E--);0===d.length&&(N.remove(W),S.removals.push(N))}}V.length=0}(S.multiComps),S.removals.length&&function(V){for(var p=0;p<V.length;p++){V[p].flush()}V.length=0}(S.removals)}this.qi=d,this._systems=E,this._renderSystems=z,this.dh=function(p){var N=W++;return Array.isArray(p)&&p.forEach((p=>V.hf(N,p))),N},this.deleteEntity=function(p){return Object.keys(d).forEach((V=>{d[V].hash[p]&&Q(p,V)})),V},this.wh=function(V){if(!V)throw new Error("Missing component definition");var W=V.name;if(!W)throw new Error("Component definition must have a name property.");if("string"!==typeof W)throw new Error("Component name must be a string.");if(""===W)throw new Error("Component name must be a non-empty string.");if(d[W])throw new Error(`Component ${W} already exists.`);var S={};return S.name=W,S.multi=!!V.multi,S.order=isNaN(V.order)?99:V.order,S.stateConstructor=V.stateConstructor||null,S.state=V.state||{},S.Hc=V.Hc||null,S.ab=V.ab||null,S.system=V.system||null,S.Xd=V.Xd||null,p[W]=S,d[W]=new N,d[W]._pendingMultiCleanup=!1,d[W]._multiCleanupIDs=S.multi?[]:null,S.system&&(E.push(W),E.sort(((V,W)=>p[V].order-p[W].order))),S.Xd&&(z.push(W),z.sort(((V,W)=>p[V].order-p[W].order))),W},this.overwriteComponent=function(V,W){var N=p[V];if(!N)throw new Error(`Unknown component: ${V}`);if(!W)throw new Error("Missing component definition");if(N.name!==W.name)throw new Error("Overwriting component must use the same name property.");var S={};S.name=V,S.multi=!!W.multi,S.order=isNaN(W.order)?99:W.order,S.state=W.state||{},S.Hc=W.Hc||null,S.ab=W.ab||null,S.system=W.system||null,S.Xd=W.Xd||null,p[V]=S,d[V]._pendingMultiCleanup=!1,d[V]._multiCleanupIDs=S.multi?[]:null;var Q=E.indexOf(V);S.system&&Q<0&&E.push(V),!S.system&&Q>=0&&E.splice(Q,1),E.sort(((V,W)=>p[V].order-p[W].order));var J=z.indexOf(V);S.Xd&&J<0&&z.push(V),!S.Xd&&J>=0&&z.splice(J,1),z.sort(((V,W)=>p[V].order-p[W].order));var i=S.state;return this.Bg(V).forEach((V=>{for(var p in i)p in V||(V[p]=i[p]);S.Hc&&S.Hc(V.Vd,V)})),V},this.deleteComponent=function(W){var N=d[W];if(!N)throw new Error(`Unknown component: ${W}`);N.flush(),N.list.forEach((V=>{V&&Q(V.Vd||V[0].Vd,W)}));var S=E.indexOf(W),J=z.indexOf(W);return S>-1&&E.splice(S,1),J>-1&&z.splice(J,1),d[W].dispose(),delete d[W],delete p[W],V},this.hf=function(V,W,N){var E,z=p[W],S=d[W];if(!S)throw new Error(`Unknown component: ${W}.`);if(S.hash[V]&&!z.multi)throw new Error(`Entity ${V} already has component: ${W}.`);if(z.stateConstructor){if(!(E=new z.stateConstructor).hasOwnProperty("Vd"))throw new Error(`Component ${z.name} stateConstructor type does not have property __id`)}else E=Object.assign({},{Vd:V},z.state,N);if(E.Vd=V,z.multi){var Q=S.hash[V];Q||(Q=[],S.add(V,Q)),Q.push(E)}else S.add(V,E);return z.Hc&&z.Hc(V,E),this},this.wf=function(V,p){var W=d[p];if(!W)throw new Error(`Unknown component: ${p}.`);return!!W.hash[V]},this.mf=function(p,W){if(!d[W])throw new Error(`Unknown component: ${W}.`);return Q(p,W),V},this.getState=function(V,p){var W=d[p];if(!W)throw new Error(`Unknown component: ${p}.`);return W.hash[V]},this.Bg=function(V){var p=d[V];if(!p)throw new Error(`Unknown component: ${V}.`);return l(),p.list},this.lk=function(V){if(!d[V])throw new Error(`Unknown component: ${V}.`);var p=d[V].hash;return V=>p[V]},this.pk=function(V){if(!d[V])throw new Error(`Unknown component: ${V}.`);var p=d[V].hash;return V=>!!p[V]},this.Rd=function(W){l();for(var N=0;N<E.length;N++){var z=E[N],S=p[z],Q=d[z];S.system(W,Q.list),l()}return V},this.render=function(W){l();for(var N=0;N<z.length;N++){var E=z[N],S=p[E],Q=d[E];S.Xd(W,Q.list),l()}return V},this.removeMultiComponent=function(W,N,E){var z=p[N],Q=d[N];if(!Q)throw new Error(`Unknown component: ${N}.`);if(!z.multi)throw new Error("removeMultiComponent called on non-multi component");return function(V,p,W,N){var d=W.hash[V];if(d){var E=d[N];E&&(d[N]=null,p.ab&&p.ab(V,E),S.multiComps.push({entID:V,data:W}),J())}}(W,z,Q,E),V}};var N=W(12750)},12750:V=>{function p(V,p){var W=V._map[p];if(delete V.hash[p],delete V._map[p],W===V.list.length-1)V.list.pop();else{var N=V.list.pop();if(V.list[W]=N,null===N||null===N[0]){var d=V.list.length;for(var E in V._map)if(V._map[E]===d)return void(V._map[E]=W)}else{var z=N.Vd||N[0].Vd;V._map[z]=W}}}V.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(V,p){if("number"===typeof this._map[V]){var W=this._map[V];this.hash[V]=p,this.list[W]=p}else this._map[V]=this.list.length,this.hash[V]=p,this.list.push(p)}remove(V){var p=this._map[V];this.hash[V]=null,this.list[p]=null,this._pendingRemovals.push(V)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var V=0;V<this._pendingRemovals.length;V++){var W=this._pendingRemovals[V];null===this.hash[W]&&p(this,W)}this._pendingRemovals.length=0}}},12705:V=>{"use strict";var p,W="object"===typeof Reflect?Reflect:null,N=function(V,p,W){return Function.prototype.apply.call(V,p,W)};p=W&&"function"===typeof W.ownKeys?W.ownKeys:Object.getOwnPropertySymbols?function(V){return Object.getOwnPropertyNames(V).concat(Object.getOwnPropertySymbols(V))}:function(V){return Object.getOwnPropertyNames(V)};var d=Number.isNaN||function(V){return V!==V};function E(){E.init.call(this)}V.exports=E,V.exports.once=function(V,p){return new Promise((function(W,N){function d(W){V.removeListener(p,E),N(W)}function E(){"function"===typeof V.removeListener&&V.removeListener("error",d),W([].slice.call(arguments))}f(V,p,E,{once:!0}),"error"!==p&&function(V,p,W){"function"===typeof V.on&&f(V,"error",p,W)}(V,d,{once:!0})}))},E.EventEmitter=E,E.prototype._events=void 0,E.prototype._eventsCount=0,E.prototype._maxListeners=void 0;var z=10;function S(V){if("function"!==typeof V)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof V)}function Q(V){return void 0===V._maxListeners?E.defaultMaxListeners:V._maxListeners}function J(V,p,W,N){var d,E,z,J;if(S(W),void 0===(E=V._events)?(E=V._events=Object.create(null),V._eventsCount=0):(void 0!==E.newListener&&(V.emit("newListener",p,W.listener?W.listener:W),E=V._events),z=E[p]),void 0===z)z=E[p]=W,++V._eventsCount;else if("function"===typeof z?z=E[p]=N?[W,z]:[z,W]:N?z.unshift(W):z.push(W),(d=Q(V))>0&&z.length>d&&!z.warned){z.warned=!0;var i=new Error("Possible EventEmitter memory leak detected. "+z.length+" "+String(p)+" listeners added. Use emitter.setMaxListeners() to increase limit");i.name="MaxListenersExceededWarning",i.j=V,i.type=p,i.count=z.length,J=i,console&&console.warn&&console.warn(J)}return V}function i(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(V,p,W){var N={fired:!1,wrapFn:void 0,target:V,type:p,listener:W},d=i.bind(N);return d.listener=W,N.wrapFn=d,d}function j(V,p,W){var N=V._events;if(void 0===N)return[];var d=N[p];return void 0===d?[]:"function"===typeof d?W?[d.listener||d]:[d]:W?function(V){for(var p=new Array(V.length),W=0;W<p.length;++W)p[W]=V[W].listener||V[W];return p}(d):u(d,d.length)}function k(V){var p=this._events;if(void 0!==p){var W=p[V];if("function"===typeof W)return 1;if(void 0!==W)return W.length}return 0}function u(V,p){for(var W=new Array(p),N=0;N<p;++N)W[N]=V[N];return W}function f(V,p,W,N){if("function"===typeof V.on)N.once?V.once(p,W):V.on(p,W);else{if("function"!==typeof V.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof V);V.addEventListener(p,(function d(E){N.once&&V.removeEventListener(p,d),W(E)}))}}Object.defineProperty(E,"defaultMaxListeners",{enumerable:!0,get:function(){return z},set:function(V){if("number"!==typeof V||V<0||d(V))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+V+".");z=V}}),E.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},E.prototype.setMaxListeners=function(V){if("number"!==typeof V||V<0||d(V))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+V+".");return this._maxListeners=V,this},E.prototype.getMaxListeners=function(){return Q(this)},E.prototype.emit=function(V){for(var p=[],W=1;W<arguments.length;W++)p.push(arguments[W]);var d="error"===V,E=this._events;if(void 0!==E)d=d&&void 0===E.error;else if(!d)return!1;if(d){var z;if(p.length>0&&(z=p[0]),z instanceof Error)throw z;var S=new Error("Unhandled error."+(z?" ("+z.message+")":""));throw S.context=z,S}var Q=E[V];if(void 0===Q)return!1;if("function"===typeof Q)N(Q,this,p);else{var J=Q.length,i=u(Q,J);for(W=0;W<J;++W)N(i[W],this,p)}return!0},E.prototype.addListener=function(V,p){return J(this,V,p,!1)},E.prototype.on=E.prototype.addListener,E.prototype.prependListener=function(V,p){return J(this,V,p,!0)},E.prototype.once=function(V,p){return S(p),this.on(V,l(this,V,p)),this},E.prototype.prependOnceListener=function(V,p){return S(p),this.prependListener(V,l(this,V,p)),this},E.prototype.removeListener=function(V,p){var W,N,d,E,z;if(S(p),void 0===(N=this._events))return this;if(void 0===(W=N[V]))return this;if(W===p||W.listener===p)0===--this._eventsCount?this._events=Object.create(null):(delete N[V],N.removeListener&&this.emit("removeListener",V,W.listener||p));else if("function"!==typeof W){for(d=-1,E=W.length-1;E>=0;E--)if(W[E]===p||W[E].listener===p){z=W[E].listener,d=E;break}if(d<0)return this;0===d?W.shift():function(V,p){for(;p+1<V.length;p++)V[p]=V[p+1];V.pop()}(W,d),1===W.length&&(N[V]=W[0]),void 0!==N.removeListener&&this.emit("removeListener",V,z||p)}return this},E.prototype.off=E.prototype.removeListener,E.prototype.removeAllListeners=function(V){var p,W,N;if(void 0===(W=this._events))return this;if(void 0===W.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==W[V]&&(0===--this._eventsCount?this._events=Object.create(null):delete W[V]),this;if(0===arguments.length){var d,E=Object.keys(W);for(N=0;N<E.length;++N)"removeListener"!==(d=E[N])&&this.removeAllListeners(d);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(p=W[V]))this.removeListener(V,p);else if(void 0!==p)for(N=p.length-1;N>=0;N--)this.removeListener(V,p[N]);return this},E.prototype.listeners=function(V){return j(this,V,!0)},E.prototype.rawListeners=function(V){return j(this,V,!1)},E.listenerCount=function(V,p){return"function"===typeof V.listenerCount?V.listenerCount(p):k.call(V,p)},E.prototype.listenerCount=k,E.prototype.eventNames=function(){return this._eventsCount>0?p(this._events):[]}},13010:V=>{"use strict";V.exports=function(V,p,W,N,d,E){var z=+p[0],S=+p[1],Q=+p[2],J=+W[0],i=+W[1],l=+W[2],j=Math.sqrt(J*J+i*i+l*l);if(0===j)throw new Error("Can't raycast along a zero vector");return function(V,p,W,N,d,E,z,S,Q,J){for(var i=0,l=Math.floor,j=0|l(p),k=0|l(W),u=0|l(N),f=d>0?1:-1,O=E>0?1:-1,U=z>0?1:-1,F=Math.abs(1/d),C=Math.abs(1/E),A=Math.abs(1/z),v=F<1/0?F*(f>0?j+1-p:p-j):1/0,t=C<1/0?C*(O>0?k+1-W:W-k):1/0,e=A<1/0?A*(U>0?u+1-N:N-u):1/0,Z=-1;i<=S;){var o=V(j,k,u);if(o)return Q&&(Q[0]=p+i*d,Q[1]=W+i*E,Q[2]=N+i*z),J&&(J[0]=J[1]=J[2]=0,0===Z&&(J[0]=-f),1===Z&&(J[1]=-O),2===Z&&(J[2]=-U)),o;v<t?v<e?(j+=f,i=v,v+=F,Z=0):(u+=U,i=e,e+=A,Z=2):t<e?(k+=O,i=t,t+=C,Z=1):(u+=U,i=e,e+=A,Z=2)}return Q&&(Q[0]=p+i*d,Q[1]=W+i*E,Q[2]=N+i*z),J&&(J[0]=J[1]=J[2]=0),0}(V,z,S,Q,J/=j,i/=j,l/=j,N="undefined"===typeof N?64:+N,d,E)}},13045:(V,p,W)=>{"use strict";W.d(p,{c:()=>E});var N=W(12705);function d(){this.kj=!1,this.stopPropagation=!1,this.lj=!1,this.disabled=!1}class E{constructor(V,p){this.version="0.7.0";var W=Object.assign({},new d,p||{});this.element=V||document,this.kj=!!W.kj,this.stopPropagation=!!W.stopPropagation,this.lj=!!W.lj,this.disabled=!!W.disabled,this.filterEvents=(V,p)=>!0,this.down=new N.EventEmitter,this.up=new N.EventEmitter,this.state={},this.tg={dx:0,dy:0,ck:0,sg:0,dk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?S(this):document.addEventListener("DOMContentLoaded",(V=>{S(this)}),{once:!0})}bind(V){for(var p=arguments.length,W=new Array(p>1?p-1:0),N=1;N<p;N++)W[N-1]=arguments[N];W.forEach((p=>{var W=this._keyBindmap[p]||[];W.includes(V)||(W.push(V),this._keyBindmap[p]=W)})),this.state[V]=!!this.state[V],this.pressCount[V]=this.pressCount[V]||0,this.releaseCount[V]=this.releaseCount[V]||0}unbind(V){for(var p in this._keyBindmap){var W=this._keyBindmap[p],N=W.indexOf(V);N>-1&&W.splice(N,1)}}getBindings(){var V={};for(var p in this._keyBindmap){this._keyBindmap[p].forEach((W=>{V[W]=V[W]||[],V[W].push(p)}))}return V}Rd(){z(this.tg),z(this.pressCount),z(this.releaseCount)}}function z(V){for(var p in V)V[p]=0}function S(V){window.addEventListener("keydown",u.bind(null,V,!0),!1),window.addEventListener("keyup",u.bind(null,V,!1),!1);var p={passive:!0};V.element.addEventListener("touchstart",l.bind(void 0,V),{passive:!1}),V.element.addEventListener("touchend",k.bind(void 0,V),p),V.element.addEventListener("mousedown",f.bind(null,V,!0),p),window.document.addEventListener("mouseup",f.bind(null,V,!1),p),V.element.addEventListener("touchmove",O.bind(null,V),p),V.element.addEventListener("mousemove",O.bind(null,V),p),window.PointerEvent,V.element.addEventListener("wheel",U.bind(null,V),p),V.element.addEventListener("contextmenu",F.bind(null,V),!1),window.addEventListener("blur",C.bind(null,V),!1)}var Q=0,J=0,i=null;function l(V,p){p.preventDefault(),j(p)}function j(V){let p=!1;for(let W=0;W<V.touches.length;++W)if(V.touches[W].identifier===i){p=!0;break}if(!p){const p=V.changedTouches[0];Q=p.clientX,J=p.clientY,i=p.identifier}}function k(V,p){for(var W=p.changedTouches,N=0;N<W.length;++N)W[N].identifier===i&&(i=null)}function u(V,p,W){A(W.code,p,V,W)}function f(V,p,W){if("pointerId"in W)if(p){if(null!==V._touches.currID)return;V._touches.currID=W.pointerId}else{if(V._touches.currID!==W.pointerId)return;V._touches.currID=null}return A("Mouse"+("button"in W?W.button+1:1),p,V,W),!1}function O(V,p){var W=p.movementX||p.mozMovementX||0,N=p.movementY||p.mozMovementY||0;if(p.touches&&0===(W|N)){var d=function(V){j(V);for(let p=0;p<V.changedTouches.length;++p)if(V.changedTouches[p].identifier==i){const W=V.changedTouches[p],N=[W.clientX-Q,W.clientY-J];return Q=W.clientX,J=W.clientY,N}return console.error(`Did not find touch id ${i}`),[0,0]}(p);W=d[0],N=d[1]}V.tg.dx+=W,V.tg.dy+=N}function U(V,p){var W=1;switch(p.deltaMode){case 0:W=1;break;case 1:W=12;break;case 2:W=V.element.clientHeight||window.innerHeight}V.tg.ck+=(p.deltaX||0)*W,V.tg.sg+=(p.deltaY||0)*W,V.tg.dk+=(p.deltaZ||0)*W}function F(V,p){if(!V.lj)return p.preventDefault(),!1}function C(V){for(var p in V._keyStates)V._keyStates[p]&&(/^Mouse\d/.test(p)||A(p,!1,V,{code:p,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function A(V,p,W,N){var d=W._keyBindmap[V];d&&(v(W._keyStates[V],p)&&(W._keyStates[V]=p,d.forEach((V=>{(!W.filterEvents||W.filterEvents(N,V))&&function(V,p,W,N){var d=p?W.pressCount:W.releaseCount;d[V]=(d[V]||0)+1;var E=W._bindPressCount[V]||0;(E+=p?1:-1)<0&&(E=0);W._bindPressCount[V]=E;var z=W.state[V];if(v(z,E)){W.state[V]=E>0;var S=p?W.down:W.up;W.disabled||S.emit(V,N)}}(V,p,W,N)}))),"button"in N||(W.kj&&!N.defaultPrevented&&N.preventDefault(),W.stopPropagation&&N.stopPropagation()))}function v(V,p){return V?!p:p}},12220:V=>{V.exports=function(V,p,W){return V[0]=p[0]+W[0],V[1]=p[1]+W[1],V[2]=p[2]+W[2],V}},12177:(V,p,W)=>{V.exports=function(V,p){var W=N(V[0],V[1],V[2]),z=N(p[0],p[1],p[2]);d(W,W),d(z,z);var S=E(W,z);return S>1?0:Math.acos(S)};var N=W(12180),d=W(12186),E=W(12191)},12293:V=>{V.exports=function(V,p){return V[0]=Math.ceil(p[0]),V[1]=Math.ceil(p[1]),V[2]=Math.ceil(p[2]),V}},12175:V=>{V.exports=function(V){var p=new Float32Array(3);return p[0]=V[0],p[1]=V[1],p[2]=V[2],p}},12199:V=>{V.exports=function(V,p){return V[0]=p[0],V[1]=p[1],V[2]=p[2],V}},12167:V=>{V.exports=function(){var V=new Float32Array(3);return V[0]=0,V[1]=0,V[2]=0,V}},12381:V=>{V.exports=function(V,p,W){var N=p[0],d=p[1],E=p[2],z=W[0],S=W[1],Q=W[2];return V[0]=d*Q-E*S,V[1]=E*z-N*Q,V[2]=N*S-d*z,V}},12316:(V,p,W)=>{V.exports=W(12312)},12312:V=>{V.exports=function(V,p){var W=p[0]-V[0],N=p[1]-V[1],d=p[2]-V[2];return Math.sqrt(W*W+N*N+d*d)}},12264:(V,p,W)=>{V.exports=W(12259)},12259:V=>{V.exports=function(V,p,W){return V[0]=p[0]/W[0],V[1]=p[1]/W[1],V[2]=p[2]/W[2],V}},12191:V=>{V.exports=function(V,p){return V[0]*p[0]+V[1]*p[1]+V[2]*p[2]}},12164:V=>{V.exports=1e-6},12209:(V,p,W)=>{V.exports=function(V,p){var W=V[0],d=V[1],E=V[2],z=p[0],S=p[1],Q=p[2];return Math.abs(W-z)<=N*Math.max(1,Math.abs(W),Math.abs(z))&&Math.abs(d-S)<=N*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(E-Q)<=N*Math.max(1,Math.abs(E),Math.abs(Q))};var N=W(12164)},12218:V=>{V.exports=function(V,p){return V[0]===p[0]&&V[1]===p[1]&&V[2]===p[2]}},12285:V=>{V.exports=function(V,p){return V[0]=Math.floor(p[0]),V[1]=Math.floor(p[1]),V[2]=Math.floor(p[2]),V}},12446:(V,p,W)=>{V.exports=function(V,p,W,d,E,z){var S,Q;p||(p=3);W||(W=0);Q=d?Math.min(d*p+W,V.length):V.length;for(S=W;S<Q;S+=p)N[0]=V[S],N[1]=V[S+1],N[2]=V[S+2],E(N,N,z),V[S]=N[0],V[S+1]=N[1],V[S+2]=N[2];return V};var N=W(12167)()},12180:V=>{V.exports=function(V,p,W){var N=new Float32Array(3);return N[0]=V,N[1]=p,N[2]=W,N}},12162:(V,p,W)=>{V.exports={EPSILON:W(12164),create:W(12167),clone:W(12175),angle:W(12177),Gd:W(12180),i:W(12199),set:W(12206),equals:W(12209),exactEquals:W(12218),add:W(12220),ed:W(12229),sub:W(12237),multiply:W(12244),mul:W(12253),divide:W(12259),div:W(12264),min:W(12272),max:W(12280),floor:W(12285),ceil:W(12293),round:W(12299),scale:W(12301),Hd:W(12308),distance:W(12312),dist:W(12316),squaredDistance:W(12321),sqrDist:W(12329),length:W(12338),len:W(12344),squaredLength:W(12352),Jd:W(12355),negate:W(12364),inverse:W(12372),normalize:W(12186),dot:W(12191),cross:W(12381),ud:W(12388),random:W(12397),transformMat4:W(12401),transformMat3:W(12410),transformQuat:W(12416),Kd:W(12424),Ld:W(12431),Nd:W(12439),forEach:W(12446)}},12372:V=>{V.exports=function(V,p){return V[0]=1/p[0],V[1]=1/p[1],V[2]=1/p[2],V}},12344:(V,p,W)=>{V.exports=W(12338)},12338:V=>{V.exports=function(V){var p=V[0],W=V[1],N=V[2];return Math.sqrt(p*p+W*W+N*N)}},12388:V=>{V.exports=function(V,p,W,N){var d=p[0],E=p[1],z=p[2];return V[0]=d+N*(W[0]-d),V[1]=E+N*(W[1]-E),V[2]=z+N*(W[2]-z),V}},12280:V=>{V.exports=function(V,p,W){return V[0]=Math.max(p[0],W[0]),V[1]=Math.max(p[1],W[1]),V[2]=Math.max(p[2],W[2]),V}},12272:V=>{V.exports=function(V,p,W){return V[0]=Math.min(p[0],W[0]),V[1]=Math.min(p[1],W[1]),V[2]=Math.min(p[2],W[2]),V}},12253:(V,p,W)=>{V.exports=W(12244)},12244:V=>{V.exports=function(V,p,W){return V[0]=p[0]*W[0],V[1]=p[1]*W[1],V[2]=p[2]*W[2],V}},12364:V=>{V.exports=function(V,p){return V[0]=-p[0],V[1]=-p[1],V[2]=-p[2],V}},12186:V=>{V.exports=function(V,p){var W=p[0],N=p[1],d=p[2],E=W*W+N*N+d*d;E>0&&(E=1/Math.sqrt(E),V[0]=p[0]*E,V[1]=p[1]*E,V[2]=p[2]*E);return V}},12397:V=>{V.exports=function(V,p){p=p||1;var W=2*Math.random()*Math.PI,N=2*Math.random()-1,d=Math.sqrt(1-N*N)*p;return V[0]=Math.cos(W)*d,V[1]=Math.sin(W)*d,V[2]=N*p,V}},12424:V=>{V.exports=function(V,p,W,N){var d=W[1],E=W[2],z=p[1]-d,S=p[2]-E,Q=Math.sin(N),J=Math.cos(N);return V[0]=p[0],V[1]=d+z*J-S*Q,V[2]=E+z*Q+S*J,V}},12431:V=>{V.exports=function(V,p,W,N){var d=W[0],E=W[2],z=p[0]-d,S=p[2]-E,Q=Math.sin(N),J=Math.cos(N);return V[0]=d+S*Q+z*J,V[1]=p[1],V[2]=E+S*J-z*Q,V}},12439:V=>{V.exports=function(V,p,W,N){var d=W[0],E=W[1],z=p[0]-d,S=p[1]-E,Q=Math.sin(N),J=Math.cos(N);return V[0]=d+z*J-S*Q,V[1]=E+z*Q+S*J,V[2]=p[2],V}},12299:V=>{V.exports=function(V,p){return V[0]=Math.round(p[0]),V[1]=Math.round(p[1]),V[2]=Math.round(p[2]),V}},12301:V=>{V.exports=function(V,p,W){return V[0]=p[0]*W,V[1]=p[1]*W,V[2]=p[2]*W,V}},12308:V=>{V.exports=function(V,p,W,N){return V[0]=p[0]+W[0]*N,V[1]=p[1]+W[1]*N,V[2]=p[2]+W[2]*N,V}},12206:V=>{V.exports=function(V,p,W,N){return V[0]=p,V[1]=W,V[2]=N,V}},12329:(V,p,W)=>{V.exports=W(12321)},12355:(V,p,W)=>{V.exports=W(12352)},12321:V=>{V.exports=function(V,p){var W=p[0]-V[0],N=p[1]-V[1],d=p[2]-V[2];return W*W+N*N+d*d}},12352:V=>{V.exports=function(V){var p=V[0],W=V[1],N=V[2];return p*p+W*W+N*N}},12237:(V,p,W)=>{V.exports=W(12229)},12229:V=>{V.exports=function(V,p,W){return V[0]=p[0]-W[0],V[1]=p[1]-W[1],V[2]=p[2]-W[2],V}},12410:V=>{V.exports=function(V,p,W){var N=p[0],d=p[1],E=p[2];return V[0]=N*W[0]+d*W[3]+E*W[6],V[1]=N*W[1]+d*W[4]+E*W[7],V[2]=N*W[2]+d*W[5]+E*W[8],V}},12401:V=>{V.exports=function(V,p,W){var N=p[0],d=p[1],E=p[2],z=W[3]*N+W[7]*d+W[11]*E+W[15];return z=z||1,V[0]=(W[0]*N+W[4]*d+W[8]*E+W[12])/z,V[1]=(W[1]*N+W[5]*d+W[9]*E+W[13])/z,V[2]=(W[2]*N+W[6]*d+W[10]*E+W[14])/z,V}},12416:V=>{V.exports=function(V,p,W){var N=p[0],d=p[1],E=p[2],z=W[0],S=W[1],Q=W[2],J=W[3],i=J*N+S*E-Q*d,l=J*d+Q*N-z*E,j=J*E+z*d-S*N,k=-z*N-S*d-Q*E;return V[0]=i*J+k*-z+l*-Q-j*-S,V[1]=l*J+k*-S+j*-z-i*-Q,V[2]=j*J+k*-Q+i*-S-l*-z,V}},12726:V=>{"use strict";V.exports=function(V){for(var p=new Array(V),W=0;W<V;++W)p[W]=W;return p}},12791:V=>{V.exports=function(V){return null!=V&&null!=V.constructor&&"function"===typeof V.constructor.isBuffer&&V.constructor.isBuffer(V)}},13017:(V,p,W)=>{"use strict";W.d(p,{c:()=>N});class N{constructor(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Qh=!1,this.Rh=!1,this.Oh=30,this.Ph=0,this.Zh=!1,this.fullscreen=!1,this.Th=function(V){},this.Uh=function(){},this.Xh=function(){},this.bb=function(){},this.Vh=function(V){},this.onFullscreenChanged=function(V){},J((()=>{!function(V,p){V._nowObject=performance||Date,V._lastTick=0,V._renderAccum=0,V._rt=0,V._frameCB=S.bind(null,V),requestAnimationFrame(V._frameCB),p>0&&(V._intervalCB=z.bind(null,V),V._interval=setInterval(V._intervalCB,Math.max(p,1e3/V.Oh/2)))}(this,p),function(V,p){if(!p)return;var W=!1,N=!1;document.addEventListener("pointerlockchange",(N=>{W=document.pointerLockElement===p,V.Vh(W)})),document.addEventListener("fullscreenchange",(W=>{N=document.fullscreenElement===p,V.onFullscreenChanged(N)})),Object.defineProperty(V,"Zh",{get:()=>W,set:V=>{V&&!W?Q(p):W&&!V&&function(V){V.exitPointerLock&&V.exitPointerLock()}(document)}}),Object.defineProperty(V,"fullscreen",{get:()=>N,set:V=>{V&&!N?p.requestFullscreen():N&&!V&&document.exitFullscreen()}}),p.addEventListener("click",(d=>{V.Qh&&!W&&Q(p),V.Rh&&!N&&p.requestFullscreen()}));var d=()=>V.bb();if(window.ResizeObserver){new ResizeObserver(d).observe(p)}else window.addEventListener("resize",d)}(this,V),this.Xh()}))}}var d=3,E=20;function z(V){for(var p=1e3/V.Oh,W=V._nowObject.now()+E,N=0;V._nowObject.now()>=V._lastTick+p&&V._nowObject.now()<W&&++N<=d;)V.Th(p),V._lastTick+=p;var z=5*(p+5),S=V._nowObject.now();if(S-V._lastTick>z)for(;S>=V._lastTick+p;)V._lastTick+=p}function S(V){requestAnimationFrame(V._frameCB),z(V);var p=V._nowObject.now(),W=p-V._rt;if(V._rt=p,V.Ph>0){V._renderAccum+=W;var N=1e3/V.Ph;if(V._renderAccum<N)return;V._renderAccum=Math.min(V._renderAccum-N,N)}var d=1e3/V.Oh,E=(p-V._lastTick)/d;V.Uh(W,E,d)}function Q(V){V.requestPointerLock&&V.requestPointerLock()}var J=V=>{if("loading"===document.readyState){var p=()=>{document.removeEventListener("readystatechange",p),V()};document.addEventListener("readystatechange",p)}else setTimeout(V,1)}},12720:(V,p,W)=>{var N=W(12726),d=W(12735),E="undefined"!==typeof Float64Array;function z(V,p){return V[0]-p[0]}function S(){var V,p=this.stride,W=new Array(p.length);for(V=0;V<W.length;++V)W[V]=[Math.abs(p[V]),V];W.sort(z);var N=new Array(W.length);for(V=0;V<N.length;++V)N[V]=W[V][1];return N}function Q(V,p){var W=["View",p,"d",V].join("");p<0&&(W="View_Nil"+V);var d="generic"===V;if(-1===p){var E="function "+W+"(a){this.data=a;};var proto="+W+".prototype;proto.dtype='"+V+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+W+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+W+"(a){return new "+W+"(a);}";return new Function(E)()}if(0===p){E="function "+W+"(a,d) {this.data = a;this.offset = d};var proto="+W+".prototype;proto.dtype='"+V+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+W+"_copy() {return new "+W+"(this.data,this.offset)};proto.pick=function "+W+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+W+"_get(){return "+(d?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+W+"_set(v){return "+(d?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+W+"(a,b,c,d){return new "+W+"(a,d)}";return new Function("TrivialArray",E)(J[V][0])}E=["'use strict'"];var z=N(p),Q=z.map((function(V){return"i"+V})),i="this.offset+"+z.map((function(V){return"this.stride["+V+"]*i"+V})).join("+"),l=z.map((function(V){return"b"+V})).join(","),j=z.map((function(V){return"c"+V})).join(",");E.push("function "+W+"(a,"+l+","+j+",d){this.data=a","this.shape=["+l+"]","this.stride=["+j+"]","this.offset=d|0}","var proto="+W+".prototype","proto.dtype='"+V+"'","proto.dimension="+p),E.push("Object.defineProperty(proto,'size',{get:function "+W+"_size(){return "+z.map((function(V){return"this.shape["+V+"]"})).join("*"),"}})"),1===p?E.push("proto.order=[0]"):(E.push("Object.defineProperty(proto,'order',{get:"),p<4?(E.push("function "+W+"_order(){"),2===p?E.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===p&&E.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):E.push("ORDER})")),E.push("proto.set=function "+W+"_set("+Q.join(",")+",v){"),d?E.push("return this.data.set("+i+",v)}"):E.push("return this.data["+i+"]=v}"),E.push("proto.get=function "+W+"_get("+Q.join(",")+"){"),d?E.push("return this.data.get("+i+")}"):E.push("return this.data["+i+"]}"),E.push("proto.index=function "+W+"_index(",Q.join(),"){return "+i+"}"),E.push("proto.hi=function "+W+"_hi("+Q.join(",")+"){return new "+W+"(this.data,"+z.map((function(V){return["(typeof i",V,"!=='number'||i",V,"<0)?this.shape[",V,"]:i",V,"|0"].join("")})).join(",")+","+z.map((function(V){return"this.stride["+V+"]"})).join(",")+",this.offset)}");var k=z.map((function(V){return"a"+V+"=this.shape["+V+"]"})),u=z.map((function(V){return"c"+V+"=this.stride["+V+"]"}));E.push("proto.lo=function "+W+"_lo("+Q.join(",")+"){var b=this.offset,d=0,"+k.join(",")+","+u.join(","));for(var f=0;f<p;++f)E.push("if(typeof i"+f+"==='number'&&i"+f+">=0){d=i"+f+"|0;b+=c"+f+"*d;a"+f+"-=d}");E.push("return new "+W+"(this.data,"+z.map((function(V){return"a"+V})).join(",")+","+z.map((function(V){return"c"+V})).join(",")+",b)}"),E.push("proto.step=function "+W+"_step("+Q.join(",")+"){var "+z.map((function(V){return"a"+V+"=this.shape["+V+"]"})).join(",")+","+z.map((function(V){return"b"+V+"=this.stride["+V+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(f=0;f<p;++f)E.push("if(typeof i"+f+"==='number'){d=i"+f+"|0;if(d<0){c+=b"+f+"*(a"+f+"-1);a"+f+"=ceil(-a"+f+"/d)}else{a"+f+"=ceil(a"+f+"/d)}b"+f+"*=d}");E.push("return new "+W+"(this.data,"+z.map((function(V){return"a"+V})).join(",")+","+z.map((function(V){return"b"+V})).join(",")+",c)}");var O=new Array(p),U=new Array(p);for(f=0;f<p;++f)O[f]="a[i"+f+"]",U[f]="b[i"+f+"]";E.push("proto.transpose=function "+W+"_transpose("+Q+"){"+Q.map((function(V,p){return V+"=("+V+"===undefined?"+p+":"+V+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+W+"(this.data,"+O.join(",")+","+U.join(",")+",this.offset)}"),E.push("proto.pick=function "+W+"_pick("+Q+"){var a=[],b=[],c=this.offset");for(f=0;f<p;++f)E.push("if(typeof i"+f+"==='number'&&i"+f+">=0){c=(c+this.stride["+f+"]*i"+f+")|0}else{a.push(this.shape["+f+"]);b.push(this.stride["+f+"])}");return E.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),E.push("return function construct_"+W+"(data,shape,stride,offset){return new "+W+"(data,"+z.map((function(V){return"shape["+V+"]"})).join(",")+","+z.map((function(V){return"stride["+V+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",E.join("\n"))(J[V],S)}var J={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};V.exports=function(V,p,W,N){if(void 0===V)return(0,J.array[0])([]);"number"===typeof V&&(V=[V]),void 0===p&&(p=[V.length]);var z=p.length;if(void 0===W){W=new Array(z);for(var S=z-1,i=1;S>=0;--S)W[S]=i,i*=p[S]}if(void 0===N){N=0;for(S=0;S<z;++S)W[S]<0&&(N-=(p[S]-1)*W[S])}for(var l=function(V){if(d(V))return"buffer";if(E)switch(Object.prototype.toString.call(V)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(V)?"array":"generic"}(V),j=J[l];j.length<=z+1;)j.push(Q(l,j.length-1));return(0,j[z+1])(V,p,W,N)}},12735:V=>{function p(V){return!!V.constructor&&"function"===typeof V.constructor.isBuffer&&V.constructor.isBuffer(V)}V.exports=function(V){return null!=V&&(p(V)||function(V){return"function"===typeof V.readFloatLE&&"function"===typeof V.slice&&p(V.slice(0,0))}(V)||!!V._isBuffer)}},12877:V=>{"use strict";var p=[],W=[],N=[],d=[],E=[],z=[],S=[],Q=[],J=[],i=[],l=[],j=[];V.exports=function(V,k,u,f,O,U){for(var F=S,C=J,A=i,v=j,t=0;t<3;t++)F[t]=+u[t],A[t]=+k.max[t],C[t]=+k.base[t];U||(U=1e-10);var e=function(V,S,J,i,j,k){var u=p,f=W,O=N,U=d,F=E,C=z,A=Q,v=Math.floor,t=0,e=0,Z=0,o=0,K=0;if(h(),0===Z)return 0;for(o=T();e<=Z;){if(L(o)&&x())return t;o=T()}for(t+=Z,K=0;K<3;K++)i[K]+=J[K],j[K]+=J[K];return t;function h(){if(e=0,0!==(Z=Math.sqrt(J[0]*J[0]+J[1]*J[1]+J[2]*J[2])))for(var V=0;V<3;V++){var p=J[V]>=0;U[V]=p?1:-1;var W=p?j[V]:i[V];u[V]=p?i[V]:j[V],f[V]=P(W,U[V]),O[V]=b(u[V],U[V]),A[V]=J[V]/Z,F[V]=Math.abs(1/A[V]);var N=p?f[V]+1-W:W-f[V];C[V]=F[V]<1/0?F[V]*N:1/0}}function L(p){for(var W=U[0],N=0===p?f[0]:O[0],d=f[0]+W,E=U[1],z=1===p?f[1]:O[1],S=f[1]+E,Q=U[2],J=2===p?f[2]:O[2],i=f[2]+Q,l=N;l!=d;l+=W)for(var j=z;j!=S;j+=E)for(var k=J;k!=i;k+=Q)if(V(l,j,k))return!0;return!1}function x(){t+=e;var V=U[o],p=e/Z,W=l;for(K=0;K<3;K++){var N=J[K]*p;i[K]+=N,j[K]+=N,W[K]=J[K]-N}if(V>0?j[o]=Math.round(j[o]):i[o]=Math.round(i[o]),S(t,o,V,W))return!0;for(K=0;K<3;K++)J[K]=W[K];return h(),0===Z}function T(){var V=C[0]<C[1]?C[0]<C[2]?0:2:C[1]<C[2]?1:2,p=C[V]-e;for(e=C[V],f[V]+=U[V],C[V]+=F[V],K=0;K<3;K++)u[K]+=p*A[K],O[K]=b(u[K],U[K]);return V}function P(V,p){return v(V-p*k)}function b(V,p){return v(V+p*k)}}(V,f,F,C,A,U);if(!O){for(t=0;t<3;t++)v[t]=u[t]>0?A[t]-k.max[t]:C[t]-k.base[t];k.translate(v)}return e}},13050:(V,p,W)=>{"use strict";W.d(p,{c:()=>l});var N=W(12868),d=W(12162);class E{constructor(V,p,W,E,z,S,Q){this.Ag=new N(V.base,V.Yg),this.mass=p,this.friction=W,this.restitution=E,this.jd=z,this.xk=S,this.kd=!!Q,this.Vg=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.il=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Tf=d.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=d.create(),this._impulses=d.create(),this._sleepFrameCount=10}loadFromCopy(V){d.i(this.Ag.base,V.Ag.base),d.i(this.Ag.Yg,V.Ag.Yg),d.i(this.Ag.max,V.Ag.max),this.Ag.mag=V.Ag.mag,this.mass=V.mass,this.friction=V.friction,this.restitution=V.restitution,this.jd=V.jd,this.xk=V.xk,this.kd=V.kd,this.Vg=V.Vg,this.fluidDrag=V.fluidDrag,this.il=V.il,this.preventFallOffEdge=V.preventFallOffEdge,this.rolledBackLastTick=V.rolledBackLastTick,d.i(this.Tf,V.Tf),d.i(this.resting,V.resting),this.inFluid=V.inFluid,this._ratioInFluid=V._ratioInFluid,d.i(this._forces,V._forces),d.i(this._impulses,V._impulses),this._sleepFrameCount=V._sleepFrameCount}setPosition(V){z(V),d.ed(V,V,this.Ag.base),this.Ag.translate(V),this.Wf()}cb(){return d.clone(this.Ag.base)}applyForce(V){z(V),d.add(this._forces,this._forces,V),this.Wf()}applyImpulse(V){z(V),d.add(this._impulses,this._impulses,V),this.Wf()}Wf(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var z=V=>{};var S=W(12868),Q=W(12162),J=W(12877);function i(){this.Vg=.1,this.fluidDrag=.4,this.td=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function l(V,p,W){V=Object.assign(new i,V),this.gravity=V.gravity||[0,-10,0],this.Vg=V.Vg||.1,this.td=V.td||2,this.fluidDrag=V.fluidDrag||.4,this.minBounceImpulse=V.minBounceImpulse,this.bodies=[],this.Uj=V.Uj,this.testSolid=p,this.testFluid=W}l.prototype.Ek=function(V,p,W,N,d,z){V=V||new S([0,0,0],[1,1,1]),"undefined"==typeof p&&(p=1),"undefined"==typeof W&&(W=1),"undefined"==typeof N&&(N=0),"undefined"==typeof d&&(d=1);var Q=new E(V,p,W,N,d,z);return this.bodies.push(Q),Q},l.prototype.Fk=function(V){var p=this.bodies.indexOf(V);p<0||(this.bodies.splice(p,1),V.Ag=V.xk=null)};var j=Q.create(),k=Q.create(),u=Q.create(),f=Q.create(),O=Q.create(),U=Q.create(),F=Q.create(),C=new S([0,0,0],[1,1,1]),A=new E(C,1,1,0,1,(()=>{}),!1);function v(V,p,W){return p=W,p*=1-(1-V.ratioInFluid)**2}l.prototype.Rd=function(V){V/=1e3;var p=r(0,Q.squaredLength(this.gravity));this.bodies.forEach((W=>function(V,p,W,N){Q.i(O,p.resting),V.Uj&&A.loadFromCopy(p);if(p.mass<=0)return Q.set(p.Tf,0,0,0),Q.set(p._forces,0,0,0),void Q.set(p._impulses,0,0,0);var d=N||0===p.jd;if(function(V,p,W,N){if(p._sleepFrameCount>0)return!1;if(N)return!0;var d=!1,E=.5*W*W*p.jd;return Q.scale(X,V.gravity,E),J(V.testSolid,p.Ag,X,(function(){return d=!0,!0}),!0),d}(V,p,W,d))return;p._sleepFrameCount--,function(V,p){var W=p.Ag,N=Math.floor(W.base[0]),d=Math.floor(W.base[2]),E=Math.floor(W.base[1]),z=Math.floor(W.max[1]);if(!V.testFluid(N,E,d))return p.inFluid=!1,void(p.ratioInFluid=0);var S=1,J=E+1;for(;J<=z&&V.testFluid(N,J,d);)S++,J++;var i=(E+S-W.base[1])/W.Yg[1];i>1&&(i=1);var l=W.Yg[0]*W.Yg[1]*W.Yg[2]*i,j=e;Q.scale(j,V.gravity,-V.td*l*p.jd),p.applyForce(j),p.inFluid=!0,p.ratioInFluid=i}(V,p),Y(p._forces),Y(p._impulses),Y(p.Tf),Y(p.resting),Q.scale(j,p._forces,1/p.mass),Q.Hd(j,j,V.gravity,p.jd),Q.scale(k,p._impulses,1/p.mass),Q.Hd(k,k,j,W),Q.add(p.Tf,p.Tf,k),p.friction&&(Z(V,0,p,k,W),Z(V,1,p,k,W),Z(V,2,p,k,W));var E=p.fluidDrag>=0?p.fluidDrag:V.fluidDrag,z=p.Vg>=0?p.Vg:V.Vg,S=z,i=z;p.inFluid&&(S=v(p,S,p.fluidDragHoriz>=0?p.fluidDragHoriz:E),i=v(p,i,p.fluidDragVert>=0?p.fluidDragVert:E));S=Math.max(1-S*W/p.mass,0),i=Math.max(1-i*W/p.mass,0),Q.set(t,S,i,S),Q.multiply(p.Tf,p.Tf,t),Q.scale(u,p.Tf,W),Q.set(p._forces,0,0,0),Q.set(p._impulses,0,0,0),p.kd&&B(h,p.Ag);Q.i(U,u),Q.set(F,0,0,0),p.preventFallOffEdge&&function(V,p,W,N){if(!p.resting[1]||W[1]>0)return;var d=s;B(d,p.Ag);for(var E=0;E<3;E+=2){Q.set(b,0,0,0),b[E]=W[E];var z=!0;(z=(z=(z=(z=z&&!R(V,d.base[0]+b[0]+1e-5,d.base[1],d.base[2]+b[2]+1e-5))&&!R(V,d.max[0]+b[0]-1e-5,d.base[1],d.base[2]+b[2]+1e-5))&&!R(V,d.base[0]+b[0]+1e-5,d.base[1],d.max[2]+b[2]-1e-5))&&!R(V,d.max[0]+b[0]-1e-5,d.base[1],d.max[2]+b[2]-1e-5))?(N[E]=W[E]>0?1:-1,W[E]=0):0===E&&(Q.set(G,W[0],0,0),K(V,d,G,N,p.slideOnCollision))}}(V,p,u,F);K(V,p.Ag,u,p.resting,p.slideOnCollision),p.kd&&function(V,p,W,N){if(p.resting[1]>=0&&!p.inFluid)return;var d=0!==p.resting[0],E=0!==p.resting[2];if(!d&&!E)return;var z=Math.abs(N[0]/N[2]),S=4;if(!d&&z>S)return;if(!E&&z<1/S)return;Q.add(x,W.base,N);var i=V.testSolid;J(i,W,N,(function(V,p,W,N){if(1!==p)return!0;N[p]=0}));var l=W.base[1],j=p.inFluid?1.951:1.001,k=Math.floor(l+j)-l;Q.set(T,0,k,0);var u=!1;if(J(i,W,T,(function(V,p,W,N){return u=!0,!0})),u)return;Q.ed(P,x,W.base),P[1]=0,K(V,W,P,L,!0);var f=r(W.base[0],x[0]),O=r(W.base[2],x[2]);if(d&&!f&&(!O||!E))return;if(E&&(!f||!d)&&!O)return;var U=!0;if(U=U&&!R(V,W.base[0]+1e-5,W.base[1],W.base[2]+1e-5),U=U&&!R(V,W.max[0]-1e-5,W.base[1],W.base[2]+1e-5),U=U&&!R(V,W.base[0]+1e-5,W.base[1],W.max[2]-1e-5),U=U&&!R(V,W.max[0]-1e-5,W.base[1],W.max[2]-1e-5),U)return;B(p.Ag,W),p.resting[0]=L[0],p.resting[2]=L[2],p.il&&p.il()}(V,p,h,U);for(var l=0;l<3;++l)p.resting[l]=p.resting[l]||F[l],f[l]=0,p.resting[l]&&(O[l]||(f[l]=-p.Tf[l]),p.Tf[l]=0);var C=Q.length(f);C>.001&&(Q.scale(f,f,p.mass),p.xk&&p.xk(f),p.restitution>0&&C>V.minBounceImpulse&&(Q.scale(f,f,p.restitution),p.applyImpulse(f)));var o=Q.squaredLength(p.Tf);o>1e-5&&p.Wf();V.Uj&&V.Uj(p)?(p.loadFromCopy(A),p.rolledBackLastTick=!0):p.rolledBackLastTick=!1}(this,W,V,p)))};var t=Q.create([0,0,0]);var e=Q.create();function Z(V,p,W,N,d){var E=W.resting[p],z=N[p];if(!W.alwaysApplyHorizFriction||1!==p){if(0===E)return;if(E*z<=0)return}Q.i(o,W.Tf),o[p]=0;var S=Q.length(o);if(!r(S,0)){var J=Math.abs(W.friction*V.gravity[p]*d),i=S>J?(S-J)/S:0;W.Tf[(p+1)%3]*=i,W.Tf[(p+2)%3]*=i}}var o=Q.create();function K(V,p,W,N,d){return Q.set(N,0,0,0),J(V.testSolid,p,W,(function(V,p,W,E){N[p]=W,E[p]=0,d||(E[0]=0,E[1]=0,E[2]=0)}))}var h=new S([],[]),L=Q.create(),x=Q.create(),T=Q.create(),P=Q.create();var b=Q.create(),s=new S([],[]),G=Q.create();function R(V,p,W,N){return V.testSolid(Math.floor(p),Math.floor(W-1),Math.floor(N))}var X=Q.create();function r(V,p){return Math.abs(V-p)<1e-5}function B(V,p){for(var W=0;W<3;W++)V.base[W]=p.base[W],V.max[W]=p.max[W],V.Yg[W]=p.Yg[W]}var Y=function(V){}},10749:function(V,p){!function(V){"use strict";var p=function(V,W){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,p){V.__proto__=p}||function(V,p){for(var W in p)Object.prototype.hasOwnProperty.call(p,W)&&(V[W]=p[W])},p(V,W)};function W(V,W){if("function"!==typeof W&&null!==W)throw new TypeError("Class extends value "+String(W)+" is not a constructor or null");function N(){this.constructor=V}p(V,W),V.prototype=null===W?Object.create(W):(N.prototype=W.prototype,new N)}function N(V,p,W,N){var d,E=arguments.length,z=E<3?p:null===N?N=Object.getOwnPropertyDescriptor(p,W):N;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)z=Reflect.decorate(V,p,W,N);else for(var S=V.length-1;S>=0;S--)(d=V[S])&&(z=(E<3?d(z):E>3?d(p,W,z):d(p,W))||z);return E>3&&z&&Object.defineProperty(p,W,z),z}function d(V,p,W){if(W||2===arguments.length)for(var N,d=0,E=p.length;d<E;d++)!N&&d in p||(N||(N=Array.prototype.slice.call(p,0,d)),N[d]=p[d]);return V.concat(N||Array.prototype.slice.call(p))}var E,z=255,S=213;V.OPERATION=void 0,(E=V.OPERATION||(V.OPERATION={}))[E.ADD=128]="ADD",E[E.REPLACE=0]="REPLACE",E[E.DELETE=64]="DELETE",E[E.DELETE_AND_ADD=192]="DELETE_AND_ADD",E[E.TOUCH=1]="TOUCH",E[E.CLEAR=10]="CLEAR";var Q=function(){function p(V,p,W){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=V,this.setParent(p,W)}return p.prototype.setParent=function(V,p,W){var N=this;if(this.indexes||(this.indexes=this.ref instanceof PV?this.ref._definition.indexes:{}),this.parent=V,this.parentIndex=W,p)if(this.root=p,this.ref instanceof PV){var d=this.ref._definition;for(var E in d.schema){var z=this.ref[E];if(z&&z.$changes){var S=d.indexes[E];z.$changes.setParent(this.ref,p,S)}}}else"object"===typeof this.ref&&this.ref.forEach((function(V,p){if(V instanceof PV){var W=V.$changes,d=N.ref.$changes.indexes[p];W.setParent(N.ref,N.root,d)}}))},p.prototype.operation=function(V){this.changes.set(--this.currentCustomOperation,V)},p.prototype.change=function(p,W){void 0===W&&(W=V.OPERATION.ADD);var N="number"===typeof p?p:this.indexes[p];this.assertValidIndex(N,p);var d=this.changes.get(N);d&&d.op!==V.OPERATION.DELETE&&d.op!==V.OPERATION.TOUCH||this.changes.set(N,{op:d&&d.op===V.OPERATION.DELETE?V.OPERATION.DELETE_AND_ADD:W,index:N}),this.allChanges.add(N),this.changed=!0,this.touchParents()},p.prototype.touch=function(p){var W="number"===typeof p?p:this.indexes[p];this.assertValidIndex(W,p),this.changes.has(W)||this.changes.set(W,{op:V.OPERATION.TOUCH,index:W}),this.allChanges.add(W),this.touchParents()},p.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},p.prototype.getType=function(V){if(this.ref._definition)return(p=this.ref._definition).schema[p.fieldsByIndex[V]];var p,W=(p=this.parent._definition).schema[p.fieldsByIndex[this.parentIndex]];return Object.values(W)[0]},p.prototype.getChildrenFilter=function(){var V=this.parent._definition.childFilters;return V&&V[this.parentIndex]},p.prototype.getValue=function(V){return this.ref.getByIndex(V)},p.prototype.delete=function(p){var W="number"===typeof p?p:this.indexes[p];if(void 0!==W){var N=this.getValue(W);this.changes.set(W,{op:V.OPERATION.DELETE,index:W}),this.allChanges.delete(W),delete this.caches[W],N&&N.$changes&&(N.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(p," (").concat(W,")"))},p.prototype.discard=function(p,W){var N=this;void 0===p&&(p=!1),void 0===W&&(W=!1),this.ref instanceof PV||this.changes.forEach((function(p){if(p.op===V.OPERATION.DELETE){var W=N.ref.getIndex(p.index);delete N.indexes[W]}})),this.changes.clear(),this.changed=p,W&&this.allChanges.clear(),this.currentCustomOperation=0},p.prototype.discardAll=function(){var V=this;this.changes.forEach((function(p){var W=V.getValue(p.index);W&&W.$changes&&W.$changes.discardAll()})),this.discard()},p.prototype.cache=function(V,p){this.caches[V]=p},p.prototype.clone=function(){return new p(this.ref,this.parent,this.root)},p.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},p.prototype.assertValidIndex=function(V,p){if(void 0===V)throw new Error('ChangeTree: missing index for field "'.concat(p,'"'))},p}();function J(V,p,W,N){return V[p]||(V[p]=[]),V[p].push(W),null===N||void 0===N||N.forEach((function(V,p){return W(V,p)})),function(){return l(V[p],V[p].indexOf(W))}}function i(p){var W=this,N="string"!==typeof this.$changes.getType();this.$items.forEach((function(d,E){p.push({refId:W.$changes.refId,op:V.OPERATION.DELETE,field:E,value:void 0,previousValue:d}),N&&W.$changes.root.removeRef(d.$changes.refId)}))}function l(V,p){if(-1===p||p>=V.length)return!1;for(var W=V.length-1,N=p;N<W;N++)V[N]=V[N+1];return V.length=W,!0}var j=function(V,p){var W=V.toString(),N=p.toString();return W<N?-1:W>N?1:0};function k(V){return V.$proxy=!0,V=new Proxy(V,{get:function(V,p){return"symbol"===typeof p||isNaN(p)?V[p]:V.at(p)},set:function(V,p,W){if("symbol"===typeof p||isNaN(p))V[p]=W;else{var N=Array.from(V.$items.keys()),d=parseInt(N[p]||p);void 0===W||null===W?V.deleteAt(d):V.setAt(d,W)}return!0},deleteProperty:function(V,p){return"number"===typeof p?V.deleteAt(p):delete V[p],!0}})}var u=function(){function p(){for(var V=[],p=0;p<arguments.length;p++)V[p]=arguments[p];this.$changes=new Q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,V)}return p.prototype.Hc=function(p,W){return void 0===W&&(W=!0),J(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,p,W?this.$items:void 0)},p.prototype.ab=function(p){return J(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return J(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,p)},p.is=function(V){return Array.isArray(V)||void 0!==V.array},Object.defineProperty(p.prototype,"length",{get:function(){return this.$items.size},set:function(V){0===V?this.clear():this.splice(V,this.length-V)},enumerable:!1,configurable:!0}),p.prototype.push=function(){for(var V,p=this,W=[],N=0;N<arguments.length;N++)W[N]=arguments[N];return W.forEach((function(W){V=p.$refId++,p.setAt(V,W)})),V},p.prototype.pop=function(){var V=Array.from(this.$indexes.values()).pop();if(void 0!==V){this.$changes.delete(V),this.$indexes.delete(V);var p=this.$items.get(V);return this.$items.delete(V),p}},p.prototype.at=function(V){var p=Array.from(this.$items.keys())[V];return this.$items.get(p)},p.prototype.setAt=function(p,W){var N,d;if(void 0!==W&&null!==W){if(this.$items.get(p)!==W){void 0!==W.$changes&&W.$changes.setParent(this,this.$changes.root,p);var E=null!==(d=null===(N=this.$changes.indexes[p])||void 0===N?void 0:N.op)&&void 0!==d?d:V.OPERATION.ADD;this.$changes.indexes[p]=p,this.$indexes.set(p,p),this.$items.set(p,W),this.$changes.change(p,E)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},p.prototype.deleteAt=function(V){var p=Array.from(this.$items.keys())[V];return void 0!==p&&this.$deleteAt(p)},p.prototype.$deleteAt=function(V){return this.$changes.delete(V),this.$indexes.delete(V),this.$items.delete(V)},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&i.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.concat=function(){for(var V,W=[],N=0;N<arguments.length;N++)W[N]=arguments[N];return new(p.bind.apply(p,d([void 0],(V=Array.from(this.$items.values())).concat.apply(V,W),!1)))},p.prototype.join=function(V){return Array.from(this.$items.values()).join(V)},p.prototype.reverse=function(){var V=this,p=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(W,N){V.setAt(p[N],W)})),this},p.prototype.shift=function(){var V=Array.from(this.$items.keys()).shift();if(void 0!==V){var p=this.$items.get(V);return this.$deleteAt(V),p}},p.prototype.slice=function(V,W){var N=new p;return N.push.apply(N,Array.from(this.$items.values()).slice(V,W)),N},p.prototype.sort=function(V){var p=this;void 0===V&&(V=j);var W=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(V).forEach((function(V,N){p.setAt(W[N],V)})),this},p.prototype.splice=function(V,p){void 0===p&&(p=this.length-V);for(var W=Array.from(this.$items.keys()),N=[],d=V;d<V+p;d++)N.push(this.$items.get(W[d])),this.$deleteAt(W[d]);return N},p.prototype.unshift=function(){for(var V=this,p=[],W=0;W<arguments.length;W++)p[W]=arguments[W];var N=this.length,d=p.length,E=Array.from(this.$items.values());return p.forEach((function(p,W){V.setAt(W,p)})),E.forEach((function(p,W){V.setAt(d+W,p)})),N+d},p.prototype.indexOf=function(V,p){return Array.from(this.$items.values()).indexOf(V,p)},p.prototype.lastIndexOf=function(V,p){return void 0===p&&(p=this.length-1),Array.from(this.$items.values()).lastIndexOf(V,p)},p.prototype.every=function(V,p){return Array.from(this.$items.values()).every(V,p)},p.prototype.some=function(V,p){return Array.from(this.$items.values()).some(V,p)},p.prototype.forEach=function(V,p){Array.from(this.$items.values()).forEach(V,p)},p.prototype.map=function(V,p){return Array.from(this.$items.values()).map(V,p)},p.prototype.filter=function(V,p){return Array.from(this.$items.values()).filter(V,p)},p.prototype.reduce=function(V,p){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},p.prototype.reduceRight=function(V,p){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},p.prototype.find=function(V,p){return Array.from(this.$items.values()).find(V,p)},p.prototype.findIndex=function(V,p){return Array.from(this.$items.values()).findIndex(V,p)},p.prototype.fill=function(V,p,W){throw new Error("ArraySchema#fill() not implemented")},p.prototype.copyWithin=function(V,p,W){throw new Error("ArraySchema#copyWithin() not implemented")},p.prototype.toString=function(){return this.$items.toString()},p.prototype.toLocaleString=function(){return this.$items.toLocaleString()},p.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(p,Symbol.species,{get:function(){return p},enumerable:!1,configurable:!0}),p.prototype.entries=function(){return this.$items.entries()},p.prototype.keys=function(){return this.$items.keys()},p.prototype.values=function(){return this.$items.values()},p.prototype.includes=function(V,p){return Array.from(this.$items.values()).includes(V,p)},p.prototype.flatMap=function(V,p){throw new Error("ArraySchema#flatMap() is not supported.")},p.prototype.flat=function(V){throw new Error("ArraySchema#flat() is not supported.")},p.prototype.findLast=function(){var V=Array.from(this.$items.values());return V.findLast.apply(V,arguments)},p.prototype.findLastIndex=function(){var V=Array.from(this.$items.values());return V.findLastIndex.apply(V,arguments)},p.prototype.setIndex=function(V,p){this.$indexes.set(V,p)},p.prototype.getIndex=function(V){return this.$indexes.get(V)},p.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},p.prototype.deleteByIndex=function(V){var p=this.$indexes.get(V);this.$items.delete(p),this.$indexes.delete(V)},p.prototype.toArray=function(){return Array.from(this.$items.values())},p.prototype.toJSON=function(){return this.toArray().map((function(V){return"function"===typeof V.toJSON?V.toJSON():V}))},p.prototype.clone=function(V){return V?new(p.bind.apply(p,d([void 0],Array.from(this.$items.values()),!1))):new(p.bind.apply(p,d([void 0],this.map((function(V){return V.$changes?V.clone():V})),!1)))},p}();function f(V){return V.$proxy=!0,V=new Proxy(V,{get:function(V,p){return"symbol"!==typeof p&&"undefined"===typeof V[p]?V.get(p):V[p]},set:function(V,p,W){return"symbol"!==typeof p&&-1===p.indexOf("$")&&"Hc"!==p&&"ab"!==p&&"onChange"!==p?V.set(p,W):V[p]=W,!0},deleteProperty:function(V,p){return V.delete(p),!0}})}var O=function(){function p(V){var W=this;if(this.$changes=new Q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V)if(V instanceof Map||V instanceof p)V.forEach((function(V,p){return W.set(p,V)}));else for(var N in V)this.set(N,V[N])}return p.prototype.Hc=function(p,W){return void 0===W&&(W=!0),J(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,p,W?this.$items:void 0)},p.prototype.ab=function(p){return J(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return J(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,p)},p.is=function(V){return void 0!==V.map},p.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(p.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(p,Symbol.species,{get:function(){return p},enumerable:!1,configurable:!0}),p.prototype.set=function(p,W){if(void 0===W||null===W)throw new Error("MapSchema#set('".concat(p,"', ").concat(W,"): trying to set ").concat(W," value on '").concat(p,"'."));p=p.toString();var N="undefined"!==typeof this.$changes.indexes[p],d=N?this.$changes.indexes[p]:this.$refId++,E=N?V.OPERATION.REPLACE:V.OPERATION.ADD,z=void 0!==W.$changes;if(z&&W.$changes.setParent(this,this.$changes.root,d),N){if(!z&&this.$items.get(p)===W)return;z&&this.$items.get(p)!==W&&(E=V.OPERATION.ADD)}else this.$changes.indexes[p]=d,this.$indexes.set(d,p);return this.$items.set(p,W),this.$changes.change(p,E),this},p.prototype.get=function(V){return this.$items.get(V)},p.prototype.delete=function(V){return this.$changes.delete(V),this.$items.delete(V)},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&i.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.has=function(V){return this.$items.has(V)},p.prototype.forEach=function(V){this.$items.forEach(V)},p.prototype.entries=function(){return this.$items.entries()},p.prototype.keys=function(){return this.$items.keys()},p.prototype.values=function(){return this.$items.values()},Object.defineProperty(p.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),p.prototype.setIndex=function(V,p){this.$indexes.set(V,p)},p.prototype.getIndex=function(V){return this.$indexes.get(V)},p.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},p.prototype.deleteByIndex=function(V){var p=this.$indexes.get(V);this.$items.delete(p),this.$indexes.delete(V)},p.prototype.toJSON=function(){var V={};return this.forEach((function(p,W){V[W]="function"===typeof p.toJSON?p.toJSON():p})),V},p.prototype.clone=function(V){var W;return V?W=Object.assign(new p,this):(W=new p,this.forEach((function(V,p){V.$changes?W.set(p,V.clone()):W.set(p,V)}))),W},p}(),U={};function F(V,p){U[V]=p}function C(V){return U[V]}var A=function(){function V(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return V.create=function(p){var W=new V;return W.schema=Object.assign({},p&&p.schema||{}),W.indexes=Object.assign({},p&&p.indexes||{}),W.fieldsByIndex=Object.assign({},p&&p.fieldsByIndex||{}),W.descriptors=Object.assign({},p&&p.descriptors||{}),W.deprecated=Object.assign({},p&&p.deprecated||{}),W},V.prototype.addField=function(V,p){var W=this.getNextFieldIndex();this.fieldsByIndex[W]=V,this.indexes[V]=W,this.schema[V]=Array.isArray(p)?{array:p[0]}:p},V.prototype.hasField=function(V){return void 0!==this.indexes[V]},V.prototype.addFilter=function(V,p){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[V]]=p,this.indexesWithFilters.push(this.indexes[V]),!0},V.prototype.addChildrenFilter=function(V,p){var W=this.indexes[V],N=this.schema[V];if(C(Object.keys(N)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[W]=p,!0;console.warn("@filterChildren: field '".concat(V,"' can't have children. Ignoring filter."))},V.prototype.getChildrenFilter=function(V){return this.childFilters&&this.childFilters[this.indexes[V]]},V.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},V}();function v(V){return V._context&&V._context.useFilters}var t=function(){function V(){this.types={},this.schemas=new Map,this.useFilters=!1}return V.prototype.has=function(V){return this.schemas.has(V)},V.prototype.get=function(V){return this.types[V]},V.prototype.add=function(V,p){void 0===p&&(p=this.schemas.size),V._definition=A.create(V._definition),V._typeid=p,this.types[p]=V,this.schemas.set(V,p)},V.create=function(p){return void 0===p&&(p={}),function(W){return p.context||(p.context=new V),Z(W,p)}},V}(),e=new t;function Z(V,p){return void 0===p&&(p={}),function(W,N){var E=p.context||e,z=W.constructor;if(z._context=E,!V)throw new Error("".concat(z.name,': @type() reference provided for "').concat(N,"\" is undefined. Make sure you don't have any circular dependencies."));E.has(z)||E.add(z);var S=z._definition;if(S.addField(N,V),S.descriptors[N]){if(S.deprecated[N])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(N,"' definition on '").concat(z.name,"'.\nCheck @type() annotation"))}catch(U){var Q=U.stack.split("\n")[4].trim();throw new Error("".concat(U.message," ").concat(Q))}}var J=u.is(V),i=!J&&O.is(V);if("string"!==typeof V&&!PV.is(V)){var l=Object.values(V)[0];"string"===typeof l||E.has(l)||E.add(l)}if(p.manual)S.descriptors[N]={enumerable:!0,configurable:!0,writable:!0};else{var j="_".concat(N);S.descriptors[j]={enumerable:!1,configurable:!1,writable:!0},S.descriptors[N]={get:function(){return this[j]},set:function(V){V!==this[j]&&(void 0!==V&&null!==V?(!J||V instanceof u||(V=new(u.bind.apply(u,d([void 0],V,!1)))),!i||V instanceof O||(V=new O(V)),void 0===V.$proxy&&(i?V=f(V):J&&(V=k(V))),this.$changes.change(N),V.$changes&&V.$changes.setParent(this,this.$changes.root,this._definition.indexes[N])):this[j]&&this.$changes.delete(N),this[j]=V)},enumerable:!0,configurable:!0}}}}function o(V){return function(p,W){var N=p.constructor;N._definition.addFilter(W,V)&&(N._context.useFilters=!0)}}function K(V){return function(p,W){var N=p.constructor;N._definition.addChildrenFilter(W,V)&&(N._context.useFilters=!0)}}function h(V){return void 0===V&&(V=!0),function(p,W){var N=p.constructor._definition;N.deprecated[W]=!0,V&&(N.descriptors[W]={get:function(){throw new Error("".concat(W," is deprecated."))},set:function(V){},enumerable:!1,configurable:!0})}}function L(V,p,W){for(var N in void 0===W&&(W={}),W.context||(W.context=V._context||W.context||e),p)Z(p[N],W)(V.prototype,N);return V}function x(V){for(var p=0,W=0,N=0,d=V.length;N<d;N++)(p=V.charCodeAt(N))<128?W+=1:p<2048?W+=2:p<55296||p>=57344?W+=3:(N++,W+=4);return W}function T(V,p,W){for(var N=0,d=0,E=W.length;d<E;d++)(N=W.charCodeAt(d))<128?V[p++]=N:N<2048?(V[p++]=192|N>>6,V[p++]=128|63&N):N<55296||N>=57344?(V[p++]=224|N>>12,V[p++]=128|N>>6&63,V[p++]=128|63&N):(d++,N=65536+((1023&N)<<10|1023&W.charCodeAt(d)),V[p++]=240|N>>18,V[p++]=128|N>>12&63,V[p++]=128|N>>6&63,V[p++]=128|63&N)}function P(V,p){V.push(255&p)}function b(V,p){V.push(255&p)}function s(V,p){V.push(255&p),V.push(p>>8&255)}function G(V,p){V.push(255&p),V.push(p>>8&255)}function R(V,p){V.push(255&p),V.push(p>>8&255),V.push(p>>16&255),V.push(p>>24&255)}function X(V,p){var W=p>>24,N=p>>16,d=p>>8,E=p;V.push(255&E),V.push(255&d),V.push(255&N),V.push(255&W)}function r(V,p){var W=Math.floor(p/Math.pow(2,32));X(V,p>>>0),X(V,W)}function B(V,p){var W=p/Math.pow(2,32)|0;X(V,p>>>0),X(V,W)}function Y(V,p){D(V,p)}function I(V,p){H(V,p)}var c=new Int32Array(2),q=new Float32Array(c.buffer),g=new Float64Array(c.buffer);function D(V,p){q[0]=p,R(V,c[0])}function H(V,p){g[0]=p,R(V,c[0]),R(V,c[1])}function m(V,p){return b(V,p?1:0)}function M(V,p){p||(p="");var W=x(p),N=0;if(W<32)V.push(160|W),N=1;else if(W<256)V.push(217),b(V,W),N=2;else if(W<65536)V.push(218),G(V,W),N=3;else{if(!(W<4294967296))throw new Error("String too long");V.push(219),X(V,W),N=5}return T(V,V.length,p),N+W}function a(V,p){return isNaN(p)?a(V,0):isFinite(p)?p!==(0|p)?(V.push(203),H(V,p),9):p>=0?p<128?(b(V,p),1):p<256?(V.push(204),b(V,p),2):p<65536?(V.push(205),G(V,p),3):p<4294967296?(V.push(206),X(V,p),5):(V.push(207),B(V,p),9):p>=-32?(V.push(224|p+32),1):p>=-128?(V.push(208),P(V,p),2):p>=-32768?(V.push(209),s(V,p),3):p>=-2147483648?(V.push(210),R(V,p),5):(V.push(211),r(V,p),9):a(V,p>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var y=Object.freeze({__proto__:null,utf8Write:T,int8:P,uint8:b,int16:s,uint16:G,int32:R,uint32:X,int64:r,uint64:B,float32:Y,float64:I,writeFloat32:D,writeFloat64:H,boolean:m,string:M,number:a});function n(V,p,W){for(var N="",d=0,E=p,z=p+W;E<z;E++){var S=V[E];0!==(128&S)?192!==(224&S)?224!==(240&S)?240!==(248&S)?console.error("Invalid byte "+S.toString(16)):(d=(7&S)<<18|(63&V[++E])<<12|(63&V[++E])<<6|63&V[++E])>=65536?(d-=65536,N+=String.fromCharCode(55296+(d>>>10),56320+(1023&d))):N+=String.fromCharCode(d):N+=String.fromCharCode((15&S)<<12|(63&V[++E])<<6|63&V[++E]):N+=String.fromCharCode((31&S)<<6|63&V[++E]):N+=String.fromCharCode(S)}return N}function w(V,p){return VV(V,p)<<24>>24}function VV(V,p){return V[p.offset++]}function pV(V,p){return WV(V,p)<<16>>16}function WV(V,p){return V[p.offset++]|V[p.offset++]<<8}function NV(V,p){return V[p.offset++]|V[p.offset++]<<8|V[p.offset++]<<16|V[p.offset++]<<24}function dV(V,p){return NV(V,p)>>>0}function EV(V,p){return jV(V,p)}function zV(V,p){return kV(V,p)}function SV(V,p){var W=dV(V,p);return NV(V,p)*Math.pow(2,32)+W}function QV(V,p){var W=dV(V,p);return dV(V,p)*Math.pow(2,32)+W}var JV=new Int32Array(2),iV=new Float32Array(JV.buffer),lV=new Float64Array(JV.buffer);function jV(V,p){return JV[0]=NV(V,p),iV[0]}function kV(V,p){return JV[0]=NV(V,p),JV[1]=NV(V,p),lV[0]}function uV(V,p){return VV(V,p)>0}function fV(V,p){var W,N=V[p.offset++];N<192?W=31&N:217===N?W=VV(V,p):218===N?W=WV(V,p):219===N&&(W=dV(V,p));var d=n(V,p.offset,W);return p.offset+=W,d}function OV(V,p){var W=V[p.offset];return W<192&&W>160||217===W||218===W||219===W}function UV(V,p){var W=V[p.offset++];return W<128?W:202===W?jV(V,p):203===W?kV(V,p):204===W?VV(V,p):205===W?WV(V,p):206===W?dV(V,p):207===W?QV(V,p):208===W?w(V,p):209===W?pV(V,p):210===W?NV(V,p):211===W?SV(V,p):W>223?-1*(255-W+1):void 0}function FV(V,p){var W=V[p.offset];return W<128||W>=202&&W<=211}function CV(V,p){return V[p.offset]<160}function AV(V,p){return V[p.offset-1]===z&&(V[p.offset]<128||V[p.offset]>=202&&V[p.offset]<=211)}var vV=Object.freeze({__proto__:null,int8:w,uint8:VV,int16:pV,uint16:WV,int32:NV,uint32:dV,float32:EV,float64:zV,int64:SV,uint64:QV,readFloat32:jV,readFloat64:kV,boolean:uV,string:fV,stringCheck:OV,number:UV,numberCheck:FV,arrayCheck:CV,switchStructureCheck:AV}),tV=function(){function p(V){var p=this;this.$changes=new Q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V&&V.forEach((function(V){return p.add(V)}))}return p.prototype.Hc=function(p,W){return void 0===W&&(W=!0),J(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,p,W?this.$items:void 0)},p.prototype.ab=function(p){return J(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return J(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,p)},p.is=function(V){return void 0!==V.collection},p.prototype.add=function(V){var p=this.$refId++;return void 0!==V.$changes&&V.$changes.setParent(this,this.$changes.root,p),this.$changes.indexes[p]=p,this.$indexes.set(p,p),this.$items.set(p,V),this.$changes.change(p),p},p.prototype.at=function(V){var p=Array.from(this.$items.keys())[V];return this.$items.get(p)},p.prototype.entries=function(){return this.$items.entries()},p.prototype.delete=function(V){for(var p,W,N=this.$items.entries();(W=N.next())&&!W.done;)if(V===W.value[1]){p=W.value[0];break}return void 0!==p&&(this.$changes.delete(p),this.$indexes.delete(p),this.$items.delete(p))},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&i.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.has=function(V){return Array.from(this.$items.values()).some((function(p){return p===V}))},p.prototype.forEach=function(V){var p=this;this.$items.forEach((function(W,N,d){return V(W,N,p)}))},p.prototype.values=function(){return this.$items.values()},Object.defineProperty(p.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),p.prototype.setIndex=function(V,p){this.$indexes.set(V,p)},p.prototype.getIndex=function(V){return this.$indexes.get(V)},p.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},p.prototype.deleteByIndex=function(V){var p=this.$indexes.get(V);this.$items.delete(p),this.$indexes.delete(V)},p.prototype.toArray=function(){return Array.from(this.$items.values())},p.prototype.toJSON=function(){var V=[];return this.forEach((function(p,W){V.push("function"===typeof p.toJSON?p.toJSON():p)})),V},p.prototype.clone=function(V){var W;return V?W=Object.assign(new p,this):(W=new p,this.forEach((function(V){V.$changes?W.add(V.clone()):W.add(V)}))),W},p}(),eV=function(){function p(V){var p=this;this.$changes=new Q(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V&&V.forEach((function(V){return p.add(V)}))}return p.prototype.Hc=function(p,W){return void 0===W&&(W=!0),J(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,p,W?this.$items:void 0)},p.prototype.ab=function(p){return J(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return J(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,p)},p.is=function(V){return void 0!==V.set},p.prototype.add=function(p){var W,N;if(this.has(p))return!1;var d=this.$refId++;void 0!==p.$changes&&p.$changes.setParent(this,this.$changes.root,d);var E=null!==(N=null===(W=this.$changes.indexes[d])||void 0===W?void 0:W.op)&&void 0!==N?N:V.OPERATION.ADD;return this.$changes.indexes[d]=d,this.$indexes.set(d,d),this.$items.set(d,p),this.$changes.change(d,E),d},p.prototype.entries=function(){return this.$items.entries()},p.prototype.delete=function(V){for(var p,W,N=this.$items.entries();(W=N.next())&&!W.done;)if(V===W.value[1]){p=W.value[0];break}return void 0!==p&&(this.$changes.delete(p),this.$indexes.delete(p),this.$items.delete(p))},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&i.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.has=function(V){for(var p,W=this.$items.values(),N=!1;(p=W.next())&&!p.done;)if(V===p.value){N=!0;break}return N},p.prototype.forEach=function(V){var p=this;this.$items.forEach((function(W,N,d){return V(W,N,p)}))},p.prototype.values=function(){return this.$items.values()},Object.defineProperty(p.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),p.prototype.setIndex=function(V,p){this.$indexes.set(V,p)},p.prototype.getIndex=function(V){return this.$indexes.get(V)},p.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},p.prototype.deleteByIndex=function(V){var p=this.$indexes.get(V);this.$items.delete(p),this.$indexes.delete(V)},p.prototype.toArray=function(){return Array.from(this.$items.values())},p.prototype.toJSON=function(){var V=[];return this.forEach((function(p,W){V.push("function"===typeof p.toJSON?p.toJSON():p)})),V},p.prototype.clone=function(V){var W;return V?W=Object.assign(new p,this):(W=new p,this.forEach((function(V){V.$changes?W.add(V.clone()):W.add(V)}))),W},p}(),ZV=function(){function V(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return V.prototype.addRefId=function(V){this.refIds.has(V)||(this.refIds.add(V),this.containerIndexes.set(V,new Set))},V.get=function(p){return void 0===p.$filterState&&(p.$filterState=new V),p.$filterState},V}(),oV=function(){function V(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return V.prototype.getNextUniqueId=function(){return this.nextUniqueId++},V.prototype.addRef=function(V,p,W){void 0===W&&(W=!0),this.refs.set(V,p),W&&(this.refCounts[V]=(this.refCounts[V]||0)+1)},V.prototype.removeRef=function(V){this.refCounts[V]=this.refCounts[V]-1,this.deletedRefs.add(V)},V.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},V.prototype.garbageCollectDeletedRefs=function(){var V=this;this.deletedRefs.forEach((function(p){if(!(V.refCounts[p]>0)){var W=V.refs.get(p);if(W instanceof PV)for(var N in W._definition.schema)"string"!==typeof W._definition.schema[N]&&W[N]&&W[N].$changes&&V.removeRef(W[N].$changes.refId);else{var d=W.$changes.parent._definition,E=d.schema[d.fieldsByIndex[W.$changes.parentIndex]];"function"===typeof Object.values(E)[0]&&Array.from(W.values()).forEach((function(p){return V.removeRef(p.$changes.refId)}))}V.refs.delete(p),delete V.refCounts[p]}})),this.deletedRefs.clear()},V}(),KV=function(V){function p(){return null!==V&&V.apply(this,arguments)||this}return W(p,V),p}(Error);function hV(V,p,W,N){var d,E=!1;switch(p){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":d="number",isNaN(V)&&console.log('trying to encode "NaN" in '.concat(W.constructor.name,"#").concat(N));break;case"string":d="string",E=!0;break;case"boolean":return}if(typeof V!==d&&(!E||E&&null!==V)){var z="'".concat(JSON.stringify(V),"'").concat(V&&V.constructor&&" (".concat(V.constructor.name,")")||"");throw new KV("a '".concat(d,"' was expected, but ").concat(z," was provided in ").concat(W.constructor.name,"#").concat(N))}}function LV(V,p,W,N){if(!(V instanceof p))throw new KV("a '".concat(p.name,"' was expected, but '").concat(V.constructor.name,"' was provided in ").concat(W.constructor.name,"#").concat(N))}function xV(V,p,W,N,d){hV(W,V,N,d);var E=y[V];if(!E)throw new KV("a '".concat(V,"' was expected, but ").concat(W," was provided in ").concat(N.constructor.name,"#").concat(d));E(p,W)}function TV(V,p,W){return vV[V](p,W)}var PV=function(){function p(){for(var V=[],p=0;p<arguments.length;p++)V[p]=arguments[p];Object.defineProperties(this,{$changes:{value:new Q(this,void 0,new oV),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var W=this._definition.descriptors;W&&Object.defineProperties(this,W),V[0]&&this.assign(V[0])}return p.onError=function(V){console.error(V)},p.is=function(V){return V._definition&&void 0!==V._definition.schema},p.prototype.onChange=function(p){return J(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,p)},p.prototype.ab=function(p){return J(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,p)},p.prototype.assign=function(V){return Object.assign(this,V),this},Object.defineProperty(p.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),p.prototype.setDirty=function(V,p){this.$changes.change(V,p)},p.prototype.listen=function(V,p,W){var N=this;return void 0===W&&(W=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[V]||(this.$callbacks[V]=[]),this.$callbacks[V].push(p),W&&void 0!==this[V]&&p(this[V],void 0),function(){return l(N.$callbacks[V],N.$callbacks[V].indexOf(p))}},p.prototype.decode=function(W,N,d){var E;void 0===N&&(N={offset:0}),void 0===d&&(d=this);var S=[],Q=this.$changes.root,J=W.length,i=0;for(Q.refs.set(i,this);N.offset<J;){var l=W[N.offset++];if(l!=z){var j=d.$changes,k=void 0!==d._definition,f=k?l>>6<<6:l;if(f!==V.OPERATION.CLEAR){var U=k?l%(f||255):UV(W,N),F=k?d._definition.fieldsByIndex[U]:"",A=j.getType(U),v=void 0,t=void 0,e=void 0;if(k?t=d["_".concat(F)]:(t=d.getByIndex(U),(f&V.OPERATION.ADD)===V.OPERATION.ADD?(e=d instanceof O?fV(W,N):U,d.setIndex(U,e)):e=d.getIndex(U)),(f&V.OPERATION.DELETE)===V.OPERATION.DELETE&&(f!==V.OPERATION.DELETE_AND_ADD&&d.deleteByIndex(U),t&&t.$changes&&Q.removeRef(t.$changes.refId),v=null),void 0!==F){if(f===V.OPERATION.DELETE);else if(p.is(A)){var Z=UV(W,N);if(v=Q.refs.get(Z),f!==V.OPERATION.REPLACE){var o=this.getSchemaType(W,N,A);v||((v=this.createTypeInstance(o)).$changes.refId=Z,t&&(v.$callbacks=t.$callbacks,t.$changes.refId&&Z!==t.$changes.refId&&Q.removeRef(t.$changes.refId))),Q.addRef(Z,v,v!==t)}}else if("string"===typeof A)v=TV(A,W,N);else{var K=C(Object.keys(A)[0]),h=UV(W,N),L=Q.refs.has(h)?t||Q.refs.get(h):new K.constructor;if((v=L.clone(!0)).$changes.refId=h,t&&(v.$callbacks=t.$callbacks,t.$changes.refId&&h!==t.$changes.refId)){Q.removeRef(t.$changes.refId);for(var x=t.entries(),T=void 0;(T=x.next())&&!T.done;){var P=(E=T.value)[0],b=E[1];S.push({refId:h,op:V.OPERATION.DELETE,field:P,value:void 0,previousValue:b})}}Q.addRef(h,v,L!==t)}if(null!==v&&void 0!==v)if(v.$changes&&v.$changes.setParent(j.ref,j.root,U),d instanceof p)d[F]=v;else if(d instanceof O)P=e,d.$items.set(P,v),d.$changes.allChanges.add(U);else if(d instanceof u)d.setAt(U,v);else if(d instanceof tV){var s=d.add(v);d.setIndex(U,s)}else d instanceof eV&&!1!==(s=d.add(v))&&d.setIndex(U,s);t!==v&&S.push({refId:i,op:f,field:F,dynamicIndex:e,value:v,previousValue:t})}else{console.warn("@colyseus/schema: definition mismatch");for(var G={offset:N.offset};N.offset<J&&(!AV(W,N)||(G.offset=N.offset+1,!Q.refs.has(UV(W,G))));)N.offset++}}else d.clear(S)}else{i=UV(W,N);var R=Q.refs.get(i);if(!R)throw new Error('"refId" not found: '.concat(i));d=R}}return this._triggerChanges(S),Q.garbageCollectDeletedRefs(),S},p.prototype.encode=function(W,N,d){void 0===W&&(W=!1),void 0===N&&(N=[]),void 0===d&&(d=!1);for(var E=this.$changes,S=new WeakSet,Q=[E],J=1,i=0;i<J;i++){var l=Q[i],j=l.ref,k=j instanceof p;l.ensureRefId(),S.add(l),l!==E&&(l.changed||W)&&(b(N,z),a(N,l.refId));for(var u=W?Array.from(l.allChanges):Array.from(l.changes.values()),f=0,U=u.length;f<U;f++){var F=W?{op:V.OPERATION.ADD,index:u[f]}:u[f],A=F.index,v=k?j._definition.fieldsByIndex&&j._definition.fieldsByIndex[A]:A,t=N.length;if(F.op!==V.OPERATION.TOUCH)if(k)b(N,A|F.op);else{if(b(N,F.op),F.op===V.OPERATION.CLEAR)continue;a(N,A)}if(k||(F.op&V.OPERATION.ADD)!=V.OPERATION.ADD||j instanceof O&&M(N,l.ref.$indexes.get(A)),F.op!==V.OPERATION.DELETE){var e=l.getType(A),Z=l.getValue(A);if(Z&&Z.$changes&&!S.has(Z.$changes)&&(Q.push(Z.$changes),Z.$changes.ensureRefId(),J++),F.op!==V.OPERATION.TOUCH){if(p.is(e))LV(Z,e,j,v),a(N,Z.$changes.refId),(F.op&V.OPERATION.ADD)===V.OPERATION.ADD&&this.tryEncodeTypeId(N,e,Z.constructor);else if("string"===typeof e)xV(e,N,Z,j,v);else{var o=C(Object.keys(e)[0]);LV(j["_".concat(v)],o.constructor,j,v),a(N,Z.$changes.refId)}d&&l.cache(A,N.slice(t))}}}W||d||l.discard()}return N},p.prototype.encodeAll=function(V){return this.encode(!0,[],V)},p.prototype.applyFilters=function(W,N){var d,E;void 0===N&&(N=!1);for(var S=this,Q=new Set,J=ZV.get(W),i=[this.$changes],l=1,j=[],k=function(k){var u=i[k];if(Q.has(u.refId))return"continue";var f=u.ref,U=f instanceof p;b(j,z),a(j,u.refId);var F=J.refIds.has(u),C=N||!F;J.addRefId(u);var A=J.containerIndexes.get(u),v=C?Array.from(u.allChanges):Array.from(u.changes.values());!N&&U&&f._definition.indexesWithFilters&&f._definition.indexesWithFilters.forEach((function(p){!A.has(p)&&u.allChanges.has(p)&&(C?v.push(p):v.push({op:V.OPERATION.ADD,index:p}))}));for(var t=0,e=v.length;t<e;t++){var Z=C?{op:V.OPERATION.ADD,index:v[t]}:v[t];if(Z.op!==V.OPERATION.CLEAR){var o=Z.index;if(Z.op!==V.OPERATION.DELETE){var K=u.getValue(o),h=u.getType(o);if(U){if((L=f._definition.filters&&f._definition.filters[o])&&!L.call(f,W,K,S)){K&&K.$changes&&Q.add(K.$changes.refId);continue}}else{var L,x=u.parent;if((L=u.getChildrenFilter())&&!L.call(x,W,f.$indexes.get(o),K,S)){K&&K.$changes&&Q.add(K.$changes.refId);continue}}if(K.$changes&&(i.push(K.$changes),l++),Z.op!==V.OPERATION.TOUCH)if(Z.op===V.OPERATION.ADD||U)j.push.apply(j,null!==(d=u.caches[o])&&void 0!==d?d:[]),A.add(o);else if(A.has(o))j.push.apply(j,null!==(E=u.caches[o])&&void 0!==E?E:[]);else{if(A.add(o),b(j,V.OPERATION.ADD),a(j,o),f instanceof O){var T=u.ref.$indexes.get(o);M(j,T)}K.$changes?a(j,K.$changes.refId):y[h](j,K)}else K.$changes&&!U&&(b(j,V.OPERATION.ADD),a(j,o),f instanceof O&&(T=u.ref.$indexes.get(o),M(j,T)),a(j,K.$changes.refId))}else U?b(j,Z.op|o):(b(j,Z.op),a(j,o))}else b(j,Z.op)}},u=0;u<l;u++)k(u);return j},p.prototype.clone=function(){var V,p=new this.constructor,W=this._definition.schema;for(var N in W)"object"===typeof this[N]&&"function"===typeof(null===(V=this[N])||void 0===V?void 0:V.clone)?p[N]=this[N].clone():p[N]=this[N];return p},p.prototype.toJSON=function(){var V=this._definition.schema,p=this._definition.deprecated,W={};for(var N in V)p[N]||null===this[N]||"undefined"===typeof this[N]||(W[N]="function"===typeof this[N].toJSON?this[N].toJSON():this["_".concat(N)]);return W},p.prototype.discardAllChanges=function(){this.$changes.discardAll()},p.prototype.getByIndex=function(V){return this[this._definition.fieldsByIndex[V]]},p.prototype.deleteByIndex=function(V){this[this._definition.fieldsByIndex[V]]=void 0},p.prototype.tryEncodeTypeId=function(V,p,W){p._typeid!==W._typeid&&(b(V,S),a(V,W._typeid))},p.prototype.getSchemaType=function(V,p,W){var N;return V[p.offset]===S&&(p.offset++,N=this.constructor._context.get(UV(V,p))),N||W},p.prototype.createTypeInstance=function(V){var p=new V;return p.$changes.root=this.$changes.root,p},p.prototype._triggerChanges=function(W){for(var N,d,E,z,S,Q,J,i,l,j=new Set,k=this.$changes.root.refs,u=function(u){var f=W[u],O=f.refId,U=k.get(O),F=U.$callbacks;if((f.op&V.OPERATION.DELETE)===V.OPERATION.DELETE&&f.previousValue instanceof p&&(null===(d=null===(N=f.previousValue.$callbacks)||void 0===N?void 0:N[V.OPERATION.DELETE])||void 0===d||d.forEach((function(V){return V()}))),!F)return"continue";if(U instanceof p){if(!j.has(O))try{null===(E=null===F||void 0===F?void 0:F[V.OPERATION.REPLACE])||void 0===E||E.forEach((function(V){return V()}))}catch(C){p.onError(C)}try{F.hasOwnProperty(f.field)&&(null===(z=F[f.field])||void 0===z||z.forEach((function(V){return V(f.value,f.previousValue)})))}catch(C){p.onError(C)}}else f.op===V.OPERATION.ADD&&void 0===f.previousValue?null===(S=F[V.OPERATION.ADD])||void 0===S||S.forEach((function(V){var p;return V(f.value,null!==(p=f.dynamicIndex)&&void 0!==p?p:f.field)})):f.op===V.OPERATION.DELETE?void 0!==f.previousValue&&(null===(Q=F[V.OPERATION.DELETE])||void 0===Q||Q.forEach((function(V){var p;return V(f.previousValue,null!==(p=f.dynamicIndex)&&void 0!==p?p:f.field)}))):f.op===V.OPERATION.DELETE_AND_ADD&&(void 0!==f.previousValue&&(null===(J=F[V.OPERATION.DELETE])||void 0===J||J.forEach((function(V){var p;return V(f.previousValue,null!==(p=f.dynamicIndex)&&void 0!==p?p:f.field)}))),null===(i=F[V.OPERATION.ADD])||void 0===i||i.forEach((function(V){var p;return V(f.value,null!==(p=f.dynamicIndex)&&void 0!==p?p:f.field)}))),f.value!==f.previousValue&&(null===(l=F[V.OPERATION.REPLACE])||void 0===l||l.forEach((function(V){var p;return V(f.value,null!==(p=f.dynamicIndex)&&void 0!==p?p:f.field)})));j.add(O)},f=0;f<W.length;f++)u(f)},p._definition=A.create(),p}();function bV(V){for(var p=[V.$changes],W=1,N={},d=N,E=function(V){var W=p[V];W.changes.forEach((function(V){var p=W.ref,N=V.index,E=p._definition?p._definition.fieldsByIndex[N]:p.$indexes.get(N);d[E]=W.getValue(N)}))},z=0;z<W;z++)E(z);return N}var sV={context:new t},GV=function(V){function p(){return null!==V&&V.apply(this,arguments)||this}return W(p,V),N([Z("string",sV)],p.prototype,"name",void 0),N([Z("string",sV)],p.prototype,"type",void 0),N([Z("number",sV)],p.prototype,"referencedType",void 0),p}(PV),RV=function(V){function p(){var p=null!==V&&V.apply(this,arguments)||this;return p.fields=new u,p}return W(p,V),N([Z("number",sV)],p.prototype,"id",void 0),N([Z([GV],sV)],p.prototype,"fields",void 0),p}(PV),XV=function(V){function p(){var p=null!==V&&V.apply(this,arguments)||this;return p.types=new u,p}return W(p,V),p.encode=function(V){var W=V.constructor,N=new p;N.rootType=W._typeid;var d=function(V,p){for(var W in p){var d=new GV;d.name=W;var E=void 0;if("string"===typeof p[W])E=p[W];else{var z=p[W],S=void 0;PV.is(z)?(E="ref",S=p[W]):"string"===typeof z[E=Object.keys(z)[0]]?E+=":"+z[E]:S=z[E],d.referencedType=S?S._typeid:-1}d.type=E,V.fields.push(d)}N.types.push(V)},E=W._context.types;for(var z in E){var S=new RV;S.id=Number(z),d(S,E[z]._definition.schema)}return N.encodeAll()},p.decode=function(V,N){var d=new t,E=new p;E.decode(V,N);var z=E.types.reduce((function(V,p){var N=function(V){function p(){return null!==V&&V.apply(this,arguments)||this}return W(p,V),p}(PV),E=p.id;return V[E]=N,d.add(N,E),V}),{});E.types.forEach((function(V){var p=z[V.id];V.fields.forEach((function(V){var W;if(void 0!==V.referencedType){var N=V.type,E=z[V.referencedType];if(!E){var S=V.type.split(":");N=S[0],E=S[1]}"ref"===N?Z(E,{context:d})(p.prototype,V.name):Z(((W={})[N]=E,W),{context:d})(p.prototype,V.name)}else Z(V.type,{context:d})(p.prototype,V.name)}))}));var S=z[E.rootType],Q=new S;for(var J in S._definition.schema){var i=S._definition.schema[J];"string"!==typeof i&&(Q[J]="function"===typeof i?new i:new(C(Object.keys(i)[0]).constructor))}return Q},N([Z([RV],sV)],p.prototype,"types",void 0),N([Z("number",sV)],p.prototype,"rootType",void 0),p}(PV);F("map",{constructor:O}),F("array",{constructor:u}),F("set",{constructor:eV}),F("collection",{constructor:tV}),V.ArraySchema=u,V.CollectionSchema=tV,V.Context=t,V.MapSchema=O,V.Reflection=XV,V.ReflectionField=GV,V.ReflectionType=RV,V.Schema=PV,V.SchemaDefinition=A,V.SetSchema=eV,V.decode=vV,V.defineTypes=L,V.deprecated=h,V.dumpChanges=bV,V.encode=y,V.filter=o,V.filterChildren=K,V.hasFilter=v,V.registerType=F,V.type=Z,Object.defineProperty(V,"__esModule",{value:!0})}(p)},12921:V=>{"use strict";V.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12912:(V,p,W)=>{var N=W(12921),d=W(12925),E=Object.hasOwnProperty,z=Object.create(null);for(var S in N)E.call(N,S)&&(z[N[S]]=S);var Q=V.exports={to:{},get:{}};function J(V,p,W){return Math.min(Math.max(p,V),W)}function i(V){var p=Math.round(V).toString(16).toUpperCase();return p.length<2?"0"+p:p}Q.get=function(V){var p,W;switch(V.substring(0,3).toLowerCase()){case"hsl":p=Q.get.hsl(V),W="hsl";break;case"hwb":p=Q.get.hwb(V),W="hwb";break;default:p=Q.get.rgb(V),W="rgb"}return p?{model:W,value:p}:null},Q.get.rgb=function(V){if(!V)return null;var p,W,d,z=[0,0,0,1];if(p=V.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(d=p[2],p=p[1],W=0;W<3;W++){var S=2*W;z[W]=parseInt(p.slice(S,S+2),16)}d&&(z[3]=parseInt(d,16)/255)}else if(p=V.match(/^#([a-f0-9]{3,4})$/i)){for(d=(p=p[1])[3],W=0;W<3;W++)z[W]=parseInt(p[W]+p[W],16);d&&(z[3]=parseInt(d+d,16)/255)}else if(p=V.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(W=0;W<3;W++)z[W]=parseInt(p[W+1],0);p[4]&&(p[5]?z[3]=.01*parseFloat(p[4]):z[3]=parseFloat(p[4]))}else{if(!(p=V.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(p=V.match(/^(\w+)$/))?"transparent"===p[1]?[0,0,0,0]:E.call(N,p[1])?((z=N[p[1]])[3]=1,z):null:null;for(W=0;W<3;W++)z[W]=Math.round(2.55*parseFloat(p[W+1]));p[4]&&(p[5]?z[3]=.01*parseFloat(p[4]):z[3]=parseFloat(p[4]))}for(W=0;W<3;W++)z[W]=J(z[W],0,255);return z[3]=J(z[3],0,1),z},Q.get.hsl=function(V){if(!V)return null;var p=V.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(p){var W=parseFloat(p[4]);return[(parseFloat(p[1])%360+360)%360,J(parseFloat(p[2]),0,100),J(parseFloat(p[3]),0,100),J(isNaN(W)?1:W,0,1)]}return null},Q.get.hwb=function(V){if(!V)return null;var p=V.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(p){var W=parseFloat(p[4]);return[(parseFloat(p[1])%360+360)%360,J(parseFloat(p[2]),0,100),J(parseFloat(p[3]),0,100),J(isNaN(W)?1:W,0,1)]}return null},Q.to.hex=function(){var V=d(arguments);return"#"+i(V[0])+i(V[1])+i(V[2])+(V[3]<1?i(Math.round(255*V[3])):"")},Q.to.rgb=function(){var V=d(arguments);return V.length<4||1===V[3]?"rgb("+Math.round(V[0])+", "+Math.round(V[1])+", "+Math.round(V[2])+")":"rgba("+Math.round(V[0])+", "+Math.round(V[1])+", "+Math.round(V[2])+", "+V[3]+")"},Q.to.rgb.percent=function(){var V=d(arguments),p=Math.round(V[0]/255*100),W=Math.round(V[1]/255*100),N=Math.round(V[2]/255*100);return V.length<4||1===V[3]?"rgb("+p+"%, "+W+"%, "+N+"%)":"rgba("+p+"%, "+W+"%, "+N+"%, "+V[3]+")"},Q.to.hsl=function(){var V=d(arguments);return V.length<4||1===V[3]?"hsl("+V[0]+", "+V[1]+"%, "+V[2]+"%)":"hsla("+V[0]+", "+V[1]+"%, "+V[2]+"%, "+V[3]+")"},Q.to.hwb=function(){var V=d(arguments),p="";return V.length>=4&&1!==V[3]&&(p=", "+V[3]),"hwb("+V[0]+", "+V[1]+"%, "+V[2]+"%"+p+")"},Q.to.keyword=function(V){return z[V.slice(0,3)]}},12907:(V,p,W)=>{const N=W(12912),d=W(12933),E=["keyword","gray","hex"],z={};for(const k of Object.keys(d))z[[...d[k].labels].sort().join("")]=k;const S={};function Q(V,p){if(!(this instanceof Q))return new Q(V,p);if(p&&p in E&&(p=null),p&&!(p in d))throw new Error("Unknown model: "+p);let W,J;if(null==V)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(V instanceof Q)this.model=V.model,this.color=[...V.color],this.valpha=V.valpha;else if("string"===typeof V){const p=N.get(V);if(null===p)throw new Error("Unable to parse color from string: "+V);this.model=p.model,J=d[this.model].channels,this.color=p.value.slice(0,J),this.valpha="number"===typeof p.value[J]?p.value[J]:1}else if(V.length>0){this.model=p||"rgb",J=d[this.model].channels;const W=Array.prototype.slice.call(V,0,J);this.color=j(W,J),this.valpha="number"===typeof V[J]?V[J]:1}else if("number"===typeof V)this.model="rgb",this.color=[V>>16&255,V>>8&255,255&V],this.valpha=1;else{this.valpha=1;const p=Object.keys(V);"alpha"in V&&(p.splice(p.indexOf("alpha"),1),this.valpha="number"===typeof V.alpha?V.alpha:0);const N=p.sort().join("");if(!(N in z))throw new Error("Unable to parse color from object: "+JSON.stringify(V));this.model=z[N];const{labels:E}=d[this.model],S=[];for(W=0;W<E.length;W++)S.push(V[E[W]]);this.color=j(S)}if(S[this.model])for(J=d[this.model].channels,W=0;W<J;W++){const V=S[this.model][W];V&&(this.color[W]=V(this.color[W]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}Q.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(V){let p=this.model in N.to?this:this.rgb();p=p.round("number"===typeof V?V:1);const W=1===p.valpha?p.color:[...p.color,this.valpha];return N.to[p.model](W)},percentString(V){const p=this.rgb().round("number"===typeof V?V:1),W=1===p.valpha?p.color:[...p.color,this.valpha];return N.to.rgb.percent(W)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const V={},{channels:p}=d[this.model],{labels:W}=d[this.model];for(let N=0;N<p;N++)V[W[N]]=this.color[N];return 1!==this.valpha&&(V.alpha=this.valpha),V},unitArray(){const V=this.rgb().color;return V[0]/=255,V[1]/=255,V[2]/=255,1!==this.valpha&&V.push(this.valpha),V},unitObject(){const V=this.rgb().object();return V.r/=255,V.g/=255,V.b/=255,1!==this.valpha&&(V.alpha=this.valpha),V},round(V){return V=Math.max(V||0,0),new Q([...this.color.map(J(V)),this.valpha],this.model)},alpha(V){return void 0!==V?new Q([...this.color,Math.max(0,Math.min(1,V))],this.model):this.valpha},red:i("rgb",0,l(255)),green:i("rgb",1,l(255)),blue:i("rgb",2,l(255)),hue:i(["hsl","hsv","hsl","hwb","hcg"],0,(V=>(V%360+360)%360)),saturationl:i("hsl",1,l(100)),lightness:i("hsl",2,l(100)),saturationv:i("hsv",1,l(100)),value:i("hsv",2,l(100)),chroma:i("hcg",1,l(100)),gray:i("hcg",2,l(100)),white:i("hwb",1,l(100)),wblack:i("hwb",2,l(100)),cyan:i("cmyk",0,l(100)),magenta:i("cmyk",1,l(100)),yellow:i("cmyk",2,l(100)),black:i("cmyk",3,l(100)),x:i("xyz",0,l(95.047)),y:i("xyz",1,l(100)),z:i("xyz",2,l(108.833)),l:i("lab",0,l(100)),a:i("lab",1),b:i("lab",2),keyword(V){return void 0!==V?new Q(V):d[this.model].keyword(this.color)},hex(V){return void 0!==V?new Q(V):N.to.hex(this.rgb().round().color)},hexa(V){if(void 0!==V)return new Q(V);const p=this.rgb().round().color;let W=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===W.length&&(W="0"+W),N.to.hex(p)+W},rgbNumber(){const V=this.rgb().color;return(255&V[0])<<16|(255&V[1])<<8|255&V[2]},luminosity(){const V=this.rgb().color,p=[];for(const[W,N]of V.entries()){const V=N/255;p[W]=V<=.04045?V/12.92:((V+.055)/1.055)**2.4}return.2126*p[0]+.7152*p[1]+.0722*p[2]},contrast(V){const p=this.luminosity(),W=V.luminosity();return p>W?(p+.05)/(W+.05):(W+.05)/(p+.05)},level(V){const p=this.contrast(V);return p>=7?"AAA":p>=4.5?"AA":""},isDark(){const V=this.rgb().color;return(2126*V[0]+7152*V[1]+722*V[2])/1e4<128},isLight(){return!this.isDark()},negate(){const V=this.rgb();for(let p=0;p<3;p++)V.color[p]=255-V.color[p];return V},lighten(V){const p=this.hsl();return p.color[2]+=p.color[2]*V,p},darken(V){const p=this.hsl();return p.color[2]-=p.color[2]*V,p},saturate(V){const p=this.hsl();return p.color[1]+=p.color[1]*V,p},desaturate(V){const p=this.hsl();return p.color[1]-=p.color[1]*V,p},whiten(V){const p=this.hwb();return p.color[1]+=p.color[1]*V,p},blacken(V){const p=this.hwb();return p.color[2]+=p.color[2]*V,p},grayscale(){const V=this.rgb().color,p=.3*V[0]+.59*V[1]+.11*V[2];return Q.rgb(p,p,p)},fade(V){return this.alpha(this.valpha-this.valpha*V)},opaquer(V){return this.alpha(this.valpha+this.valpha*V)},rotate(V){const p=this.hsl();let W=p.color[0];return W=(W+V)%360,W=W<0?360+W:W,p.color[0]=W,p},mix(V,p){if(!V||!V.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof V);const W=V.rgb(),N=this.rgb(),d=void 0===p?.5:p,E=2*d-1,z=W.alpha()-N.alpha(),S=((E*z===-1?E:(E+z)/(1+E*z))+1)/2,J=1-S;return Q.rgb(S*W.red()+J*N.red(),S*W.green()+J*N.green(),S*W.blue()+J*N.blue(),W.alpha()*d+N.alpha()*(1-d))}};for(const k of Object.keys(d)){if(E.includes(k))continue;const{channels:V}=d[k];Q.prototype[k]=function(){if(this.model===k)return new Q(this);for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];return p.length>0?new Q(p,k):new Q([...(N=d[this.model][k].raw(this.color),Array.isArray(N)?N:[N]),this.valpha],k);var N},Q[k]=function(){for(var p=arguments.length,W=new Array(p),N=0;N<p;N++)W[N]=arguments[N];let d=W[0];return"number"===typeof d&&(d=j(W,V)),new Q(d,k)}}function J(V){return function(p){return function(V,p){return Number(V.toFixed(p))}(p,V)}}function i(V,p,W){V=Array.isArray(V)?V:[V];for(const N of V)(S[N]||(S[N]=[]))[p]=W;return V=V[0],function(N){let d;return void 0!==N?(W&&(N=W(N)),d=this[V](),d.color[p]=N,d):(d=this[V]().color[p],W&&(d=W(d)),d)}}function l(V){return function(p){return Math.max(0,Math.min(V,p))}}function j(V,p){for(let W=0;W<p;W++)"number"!==typeof V[W]&&(V[W]=0);return V}V.exports=Q},12936:(V,p,W)=>{const N=W(12945),d={};for(const z of Object.keys(N))d[N[z]]=z;const E={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};V.exports=E;for(const z of Object.keys(E)){if(!("channels"in E[z]))throw new Error("missing channels property: "+z);if(!("labels"in E[z]))throw new Error("missing channel labels property: "+z);if(E[z].labels.length!==E[z].channels)throw new Error("channel and label counts mismatch: "+z);const{channels:V,labels:p}=E[z];delete E[z].channels,delete E[z].labels,Object.defineProperty(E[z],"channels",{value:V}),Object.defineProperty(E[z],"labels",{value:p})}E.rgb.hsl=function(V){const p=V[0]/255,W=V[1]/255,N=V[2]/255,d=Math.min(p,W,N),E=Math.max(p,W,N),z=E-d;let S,Q;E===d?S=0:p===E?S=(W-N)/z:W===E?S=2+(N-p)/z:N===E&&(S=4+(p-W)/z),S=Math.min(60*S,360),S<0&&(S+=360);const J=(d+E)/2;return Q=E===d?0:J<=.5?z/(E+d):z/(2-E-d),[S,100*Q,100*J]},E.rgb.hsv=function(V){let p,W,N,d,E;const z=V[0]/255,S=V[1]/255,Q=V[2]/255,J=Math.max(z,S,Q),i=J-Math.min(z,S,Q),l=function(V){return(J-V)/6/i+.5};return 0===i?(d=0,E=0):(E=i/J,p=l(z),W=l(S),N=l(Q),z===J?d=N-W:S===J?d=1/3+p-N:Q===J&&(d=2/3+W-p),d<0?d+=1:d>1&&(d-=1)),[360*d,100*E,100*J]},E.rgb.hwb=function(V){const p=V[0],W=V[1];let N=V[2];const d=E.rgb.hsl(V)[0],z=1/255*Math.min(p,Math.min(W,N));return N=1-1/255*Math.max(p,Math.max(W,N)),[d,100*z,100*N]},E.rgb.cmyk=function(V){const p=V[0]/255,W=V[1]/255,N=V[2]/255,d=Math.min(1-p,1-W,1-N);return[100*((1-p-d)/(1-d)||0),100*((1-W-d)/(1-d)||0),100*((1-N-d)/(1-d)||0),100*d]},E.rgb.keyword=function(V){const p=d[V];if(p)return p;let W,E=1/0;for(const d of Object.keys(N)){const p=N[d],Q=(S=p,((z=V)[0]-S[0])**2+(z[1]-S[1])**2+(z[2]-S[2])**2);Q<E&&(E=Q,W=d)}var z,S;return W},E.keyword.rgb=function(V){return N[V]},E.rgb.xyz=function(V){let p=V[0]/255,W=V[1]/255,N=V[2]/255;p=p>.04045?((p+.055)/1.055)**2.4:p/12.92,W=W>.04045?((W+.055)/1.055)**2.4:W/12.92,N=N>.04045?((N+.055)/1.055)**2.4:N/12.92;return[100*(.4124*p+.3576*W+.1805*N),100*(.2126*p+.7152*W+.0722*N),100*(.0193*p+.1192*W+.9505*N)]},E.rgb.lab=function(V){const p=E.rgb.xyz(V);let W=p[0],N=p[1],d=p[2];W/=95.047,N/=100,d/=108.883,W=W>.008856?W**(1/3):7.787*W+16/116,N=N>.008856?N**(1/3):7.787*N+16/116,d=d>.008856?d**(1/3):7.787*d+16/116;return[116*N-16,500*(W-N),200*(N-d)]},E.hsl.rgb=function(V){const p=V[0]/360,W=V[1]/100,N=V[2]/100;let d,E,z;if(0===W)return z=255*N,[z,z,z];d=N<.5?N*(1+W):N+W-N*W;const S=2*N-d,Q=[0,0,0];for(let J=0;J<3;J++)E=p+1/3*-(J-1),E<0&&E++,E>1&&E--,z=6*E<1?S+6*(d-S)*E:2*E<1?d:3*E<2?S+(d-S)*(2/3-E)*6:S,Q[J]=255*z;return Q},E.hsl.hsv=function(V){const p=V[0];let W=V[1]/100,N=V[2]/100,d=W;const E=Math.max(N,.01);N*=2,W*=N<=1?N:2-N,d*=E<=1?E:2-E;return[p,100*(0===N?2*d/(E+d):2*W/(N+W)),100*((N+W)/2)]},E.hsv.rgb=function(V){const p=V[0]/60,W=V[1]/100;let N=V[2]/100;const d=Math.floor(p)%6,E=p-Math.floor(p),z=255*N*(1-W),S=255*N*(1-W*E),Q=255*N*(1-W*(1-E));switch(N*=255,d){case 0:return[N,Q,z];case 1:return[S,N,z];case 2:return[z,N,Q];case 3:return[z,S,N];case 4:return[Q,z,N];case 5:return[N,z,S]}},E.hsv.hsl=function(V){const p=V[0],W=V[1]/100,N=V[2]/100,d=Math.max(N,.01);let E,z;z=(2-W)*N;const S=(2-W)*d;return E=W*d,E/=S<=1?S:2-S,E=E||0,z/=2,[p,100*E,100*z]},E.hwb.rgb=function(V){const p=V[0]/360;let W=V[1]/100,N=V[2]/100;const d=W+N;let E;d>1&&(W/=d,N/=d);const z=Math.floor(6*p),S=1-N;E=6*p-z,0!==(1&z)&&(E=1-E);const Q=W+E*(S-W);let J,i,l;switch(z){default:case 6:case 0:J=S,i=Q,l=W;break;case 1:J=Q,i=S,l=W;break;case 2:J=W,i=S,l=Q;break;case 3:J=W,i=Q,l=S;break;case 4:J=Q,i=W,l=S;break;case 5:J=S,i=W,l=Q}return[255*J,255*i,255*l]},E.cmyk.rgb=function(V){const p=V[0]/100,W=V[1]/100,N=V[2]/100,d=V[3]/100;return[255*(1-Math.min(1,p*(1-d)+d)),255*(1-Math.min(1,W*(1-d)+d)),255*(1-Math.min(1,N*(1-d)+d))]},E.xyz.rgb=function(V){const p=V[0]/100,W=V[1]/100,N=V[2]/100;let d,E,z;return d=3.2406*p+-1.5372*W+-.4986*N,E=-.9689*p+1.8758*W+.0415*N,z=.0557*p+-.204*W+1.057*N,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,E=E>.0031308?1.055*E**(1/2.4)-.055:12.92*E,z=z>.0031308?1.055*z**(1/2.4)-.055:12.92*z,d=Math.min(Math.max(0,d),1),E=Math.min(Math.max(0,E),1),z=Math.min(Math.max(0,z),1),[255*d,255*E,255*z]},E.xyz.lab=function(V){let p=V[0],W=V[1],N=V[2];p/=95.047,W/=100,N/=108.883,p=p>.008856?p**(1/3):7.787*p+16/116,W=W>.008856?W**(1/3):7.787*W+16/116,N=N>.008856?N**(1/3):7.787*N+16/116;return[116*W-16,500*(p-W),200*(W-N)]},E.lab.xyz=function(V){let p,W,N;W=(V[0]+16)/116,p=V[1]/500+W,N=W-V[2]/200;const d=W**3,E=p**3,z=N**3;return W=d>.008856?d:(W-16/116)/7.787,p=E>.008856?E:(p-16/116)/7.787,N=z>.008856?z:(N-16/116)/7.787,p*=95.047,W*=100,N*=108.883,[p,W,N]},E.lab.lch=function(V){const p=V[0],W=V[1],N=V[2];let d;d=360*Math.atan2(N,W)/2/Math.PI,d<0&&(d+=360);return[p,Math.sqrt(W*W+N*N),d]},E.lch.lab=function(V){const p=V[0],W=V[1],N=V[2]/360*2*Math.PI;return[p,W*Math.cos(N),W*Math.sin(N)]},E.rgb.ansi16=function(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[W,N,d]=V;let z=null===p?E.rgb.hsv(V)[2]:p;if(z=Math.round(z/50),0===z)return 30;let S=30+(Math.round(d/255)<<2|Math.round(N/255)<<1|Math.round(W/255));return 2===z&&(S+=60),S},E.hsv.ansi16=function(V){return E.rgb.ansi16(E.hsv.rgb(V),V[2])},E.rgb.ansi256=function(V){const p=V[0],W=V[1],N=V[2];if(p===W&&W===N)return p<8?16:p>248?231:Math.round((p-8)/247*24)+232;return 16+36*Math.round(p/255*5)+6*Math.round(W/255*5)+Math.round(N/255*5)},E.ansi16.rgb=function(V){let p=V%10;if(0===p||7===p)return V>50&&(p+=3.5),p=p/10.5*255,[p,p,p];const W=.5*(1+~~(V>50));return[(1&p)*W*255,(p>>1&1)*W*255,(p>>2&1)*W*255]},E.ansi256.rgb=function(V){if(V>=232){const p=10*(V-232)+8;return[p,p,p]}let p;V-=16;return[Math.floor(V/36)/5*255,Math.floor((p=V%36)/6)/5*255,p%6/5*255]},E.rgb.hex=function(V){const p=(((255&Math.round(V[0]))<<16)+((255&Math.round(V[1]))<<8)+(255&Math.round(V[2]))).toString(16).toUpperCase();return"000000".substring(p.length)+p},E.hex.rgb=function(V){const p=V.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!p)return[0,0,0];let W=p[0];3===p[0].length&&(W=W.split("").map((V=>V+V)).join(""));const N=parseInt(W,16);return[N>>16&255,N>>8&255,255&N]},E.rgb.hcg=function(V){const p=V[0]/255,W=V[1]/255,N=V[2]/255,d=Math.max(Math.max(p,W),N),E=Math.min(Math.min(p,W),N),z=d-E;let S,Q;return S=z<1?E/(1-z):0,Q=z<=0?0:d===p?(W-N)/z%6:d===W?2+(N-p)/z:4+(p-W)/z,Q/=6,Q%=1,[360*Q,100*z,100*S]},E.hsl.hcg=function(V){const p=V[1]/100,W=V[2]/100,N=W<.5?2*p*W:2*p*(1-W);let d=0;return N<1&&(d=(W-.5*N)/(1-N)),[V[0],100*N,100*d]},E.hsv.hcg=function(V){const p=V[1]/100,W=V[2]/100,N=p*W;let d=0;return N<1&&(d=(W-N)/(1-N)),[V[0],100*N,100*d]},E.hcg.rgb=function(V){const p=V[0]/360,W=V[1]/100,N=V[2]/100;if(0===W)return[255*N,255*N,255*N];const d=[0,0,0],E=p%1*6,z=E%1,S=1-z;let Q=0;switch(Math.floor(E)){case 0:d[0]=1,d[1]=z,d[2]=0;break;case 1:d[0]=S,d[1]=1,d[2]=0;break;case 2:d[0]=0,d[1]=1,d[2]=z;break;case 3:d[0]=0,d[1]=S,d[2]=1;break;case 4:d[0]=z,d[1]=0,d[2]=1;break;default:d[0]=1,d[1]=0,d[2]=S}return Q=(1-W)*N,[255*(W*d[0]+Q),255*(W*d[1]+Q),255*(W*d[2]+Q)]},E.hcg.hsv=function(V){const p=V[1]/100,W=p+V[2]/100*(1-p);let N=0;return W>0&&(N=p/W),[V[0],100*N,100*W]},E.hcg.hsl=function(V){const p=V[1]/100,W=V[2]/100*(1-p)+.5*p;let N=0;return W>0&&W<.5?N=p/(2*W):W>=.5&&W<1&&(N=p/(2*(1-W))),[V[0],100*N,100*W]},E.hcg.hwb=function(V){const p=V[1]/100,W=p+V[2]/100*(1-p);return[V[0],100*(W-p),100*(1-W)]},E.hwb.hcg=function(V){const p=V[1]/100,W=1-V[2]/100,N=W-p;let d=0;return N<1&&(d=(W-N)/(1-N)),[V[0],100*N,100*d]},E.apple.rgb=function(V){return[V[0]/65535*255,V[1]/65535*255,V[2]/65535*255]},E.rgb.apple=function(V){return[V[0]/255*65535,V[1]/255*65535,V[2]/255*65535]},E.gray.rgb=function(V){return[V[0]/100*255,V[0]/100*255,V[0]/100*255]},E.gray.hsl=function(V){return[0,0,V[0]]},E.gray.hsv=E.gray.hsl,E.gray.hwb=function(V){return[0,100,V[0]]},E.gray.cmyk=function(V){return[0,0,0,V[0]]},E.gray.lab=function(V){return[V[0],0,0]},E.gray.hex=function(V){const p=255&Math.round(V[0]/100*255),W=((p<<16)+(p<<8)+p).toString(16).toUpperCase();return"000000".substring(W.length)+W},E.rgb.gray=function(V){return[(V[0]+V[1]+V[2])/3/255*100]}},12933:(V,p,W)=>{const N=W(12936),d=W(12948),E={};Object.keys(N).forEach((V=>{E[V]={},Object.defineProperty(E[V],"channels",{value:N[V].channels}),Object.defineProperty(E[V],"labels",{value:N[V].labels});const p=d(V);Object.keys(p).forEach((W=>{const N=p[W];E[V][W]=function(V){const p=function(){for(var p=arguments.length,W=new Array(p),N=0;N<p;N++)W[N]=arguments[N];const d=W[0];if(void 0===d||null===d)return d;d.length>1&&(W=d);const E=V(W);if("object"===typeof E)for(let V=E.length,z=0;z<V;z++)E[z]=Math.round(E[z]);return E};return"conversion"in V&&(p.conversion=V.conversion),p}(N),E[V][W].raw=function(V){const p=function(){for(var p=arguments.length,W=new Array(p),N=0;N<p;N++)W[N]=arguments[N];const d=W[0];return void 0===d||null===d?d:(d.length>1&&(W=d),V(W))};return"conversion"in V&&(p.conversion=V.conversion),p}(N)}))})),V.exports=E},12948:(V,p,W)=>{const N=W(12936);function d(V){const p=function(){const V={},p=Object.keys(N);for(let W=p.length,N=0;N<W;N++)V[p[N]]={distance:-1,parent:null};return V}(),W=[V];for(p[V].distance=0;W.length;){const V=W.pop(),d=Object.keys(N[V]);for(let N=d.length,E=0;E<N;E++){const N=d[E],z=p[N];-1===z.distance&&(z.distance=p[V].distance+1,z.parent=V,W.unshift(N))}}return p}function E(V,p){return function(W){return p(V(W))}}function z(V,p){const W=[p[V].parent,V];let d=N[p[V].parent][V],z=p[V].parent;for(;p[z].parent;)W.unshift(p[z].parent),d=E(N[p[z].parent][z],d),z=p[z].parent;return d.conversion=W,d}V.exports=function(V){const p=d(V),W={},N=Object.keys(p);for(let d=N.length,E=0;E<d;E++){const V=N[E];null!==p[V].parent&&(W[V]=z(V,p))}return W}},12945:V=>{"use strict";V.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},10756:function(V,p,W){"use strict";var N=this&&this.__createBinding||(Object.create?function(V,p,W,N){void 0===N&&(N=W);var d=Object.getOwnPropertyDescriptor(p,W);d&&!("get"in d?!p.__esModule:d.writable||d.configurable)||(d={enumerable:!0,get:function(){return p[W]}}),Object.defineProperty(V,N,d)}:function(V,p,W,N){void 0===N&&(N=W),V[N]=p[W]}),d=this&&this.__setModuleDefault||(Object.create?function(V,p){Object.defineProperty(V,"default",{enumerable:!0,value:p})}:function(V,p){V.default=p}),E=this&&this.__importStar||function(V){if(V&&V.__esModule)return V;var p={};if(null!=V)for(var W in V)"default"!==W&&Object.prototype.hasOwnProperty.call(V,W)&&N(p,V,W);return d(p,V),p},z=this&&this.__awaiter||function(V,p,W,N){return new(W||(W=Promise))((function(d,E){function z(V){try{Q(N.next(V))}catch(p){E(p)}}function S(V){try{Q(N.throw(V))}catch(p){E(p)}}function Q(V){var p;V.done?d(V.value):(p=V.value,p instanceof W?p:new W((function(V){V(p)}))).then(z,S)}Q((N=N.apply(V,p||[])).next())}))};Object.defineProperty(p,"__esModule",{value:!0}),p.Auth=p.Platform=void 0;const S=E(W(10672)),Q=W(10763),J="colyseus-auth-token";!function(V){V.ios="ios",V.android="android"}(p.Platform||(p.Platform={}));p.Auth=class{constructor(V){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=V.replace("ws","http"),(0,Q.getItem)(J,(V=>this.token=V))}get hasToken(){return!!this.token}login(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return z(this,void 0,void 0,(function*(){const p=Object.assign({},V);this.hasToken&&(p.token=this.token);const W=yield this.request("post","/auth",p);this.token=W.token,(0,Q.setItem)(J,this.token);for(let V in W)this.hasOwnProperty(V)&&(this[V]=W[V]);return this.registerPingService(),this}))}save(){return z(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return z(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return z(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return z(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(V){return z(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:V})}))}acceptFriendRequest(V){return z(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:V})}))}declineFriendRequest(V){return z(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:V})}))}blockUser(V){return z(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:V})}))}unblockUser(V){return z(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:V})}))}request(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},N=arguments.length>3?arguments[3]:void 0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return z(this,void 0,void 0,(function*(){d.Accept="application/json",this.hasToken&&(d.Authorization="Bearer "+this.token);const E=[];for(const V in W)E.push(`${V}=${W[V]}`);const z=E.length>0?`?${E.join("&")}`:"",Q={headers:d};return N&&(Q.body=N),(yield S[V](`${this.endpoint}${p}${z}`,Q)).data}))}logout(){this.token=void 0,(0,Q.removeItem)(J),this.unregisterPingService()}registerPingService(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),V)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},10667:function(V,p,W){"use strict";var N,d=this&&this.__awaiter||function(V,p,W,N){return new(W||(W=Promise))((function(d,E){function z(V){try{Q(N.next(V))}catch(p){E(p)}}function S(V){try{Q(N.throw(V))}catch(p){E(p)}}function Q(V){var p;V.done?d(V.value):(p=V.value,p instanceof W?p:new W((function(V){V(p)}))).then(z,S)}Q((N=N.apply(V,p||[])).next())}))};Object.defineProperty(p,"__esModule",{value:!0}),p.Client=p.MatchMakeError=void 0;const E=W(10672),z=W(10681),S=W(10684);class Q extends Error{constructor(V,p){super(V),this.code=p,Object.setPrototypeOf(this,Q.prototype)}}p.MatchMakeError=Q;const J="undefined"!==typeof window&&"undefined"!==typeof(null===(N=null===window||void 0===window?void 0:window.location)||void 0===N?void 0:N.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";p.Client=class{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J;if("string"===typeof V){const p=new URL(V),W="https:"===p.protocol||"wss:"===p.protocol,N=Number(p.port||(W?443:80));this.settings={hostname:p.hostname,pathname:"/"!==p.pathname?p.pathname:"",port:N,secure:W}}else void 0===V.port&&(V.port=V.secure?443:80),void 0===V.pathname&&(V.pathname=""),this.settings=V}joinOrCreate(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return d(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",V,p,W)}))}create(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return d(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",V,p,W)}))}join(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return d(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",V,p,W)}))}joinById(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;return d(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",V,p,W)}))}reconnect(V,p){return d(this,void 0,void 0,(function*(){if("string"===typeof V&&"string"===typeof p)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[W,N]=V.split(":");return yield this.createMatchMakeRequest("reconnect",W,{reconnectionToken:N},p)}))}getAvailableRooms(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return d(this,void 0,void 0,(function*(){return(yield(0,E.get)(this.getHttpEndpoint(`${V}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(V,p,W){return d(this,void 0,void 0,(function*(){const N=this.createRoom(V.room.name,p);N.roomId=V.room.roomId,N.sessionId=V.sessionId;const E={sessionId:N.sessionId};V.reconnectionToken&&(E.reconnectionToken=V.reconnectionToken);const S=W||N;return N.connect(this.buildEndpoint(V.room,E),V.devMode&&(()=>d(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${N.roomId}'...`);let W=0;const E=()=>d(this,void 0,void 0,(function*(){W++;try{yield this.consumeSeatReservation(V,p,S),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${N.roomId}'`)}catch(d){W<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${W} out of 8)`),setTimeout(E,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(E,2e3)}))),S),new Promise(((V,p)=>{const W=(V,W)=>p(new z.ServerError(V,W));S.onError.once(W),S.onJoin.once((()=>{S.onError.remove(W),V(S)}))}))}))}createMatchMakeRequest(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},N=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0;return d(this,void 0,void 0,(function*(){const d=(yield(0,E.post)(this.getHttpEndpoint(`${V}/${p}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(W)})).data;if(d.error)throw new Q(d.error,d.code);return"reconnect"===V&&(d.reconnectionToken=W.reconnectionToken),yield this.consumeSeatReservation(d,N,z)}))}createRoom(V,p){return new S.Room(V,p)}buildEndpoint(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const W=[];for(const d in p)p.hasOwnProperty(d)&&W.push(`${d}=${p[d]}`);let N=this.settings.secure?"wss://":"ws://";return V.publicAddress?N+=`${V.publicAddress}`:N+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${N}/${V.processId}/${V.roomId}?${W.join("&")}`}getHttpEndpoint(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${V}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},10696:(V,p,W)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.Connection=void 0;const N=W(10704);p.Connection=class{constructor(){this.events={},this.transport=new N.WebSocketTransport(this.events)}send(V){this.transport.send(V)}connect(V){this.transport.connect(V)}close(V,p){this.transport.close(V,p)}get isOpen(){return this.transport.isOpen}}},10719:(V,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.utf8Length=p.utf8Read=p.ErrorCode=p.Protocol=void 0,function(V){V[V.HANDSHAKE=9]="HANDSHAKE",V[V.JOIN_ROOM=10]="JOIN_ROOM",V[V.ERROR=11]="ERROR",V[V.LEAVE_ROOM=12]="LEAVE_ROOM",V[V.ROOM_DATA=13]="ROOM_DATA",V[V.ROOM_STATE=14]="ROOM_STATE",V[V.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",V[V.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",V[V.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(p.Protocol||(p.Protocol={})),function(V){V[V.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",V[V.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",V[V.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",V[V.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",V[V.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",V[V.AUTH_FAILED=4215]="AUTH_FAILED",V[V.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(p.ErrorCode||(p.ErrorCode={})),p.utf8Read=function(V,p){const W=V[p++];for(var N="",d=0,E=p,z=p+W;E<z;E++){var S=V[E];if(0!==(128&S))if(192!==(224&S))if(224!==(240&S)){if(240!==(248&S))throw new Error("Invalid byte "+S.toString(16));(d=(7&S)<<18|(63&V[++E])<<12|(63&V[++E])<<6|63&V[++E])>=65536?(d-=65536,N+=String.fromCharCode(55296+(d>>>10),56320+(1023&d))):N+=String.fromCharCode(d)}else N+=String.fromCharCode((15&S)<<12|(63&V[++E])<<6|63&V[++E]);else N+=String.fromCharCode((31&S)<<6|63&V[++E]);else N+=String.fromCharCode(S)}return N},p.utf8Length=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",p=0,W=0;for(let N=0,d=V.length;N<d;N++)p=V.charCodeAt(N),p<128?W+=1:p<2048?W+=2:p<55296||p>=57344?W+=3:(N++,W+=4);return W+1}},10684:function(V,p,W){"use strict";var N=this&&this.__createBinding||(Object.create?function(V,p,W,N){void 0===N&&(N=W);var d=Object.getOwnPropertyDescriptor(p,W);d&&!("get"in d?!p.__esModule:d.writable||d.configurable)||(d={enumerable:!0,get:function(){return p[W]}}),Object.defineProperty(V,N,d)}:function(V,p,W,N){void 0===N&&(N=W),V[N]=p[W]}),d=this&&this.__setModuleDefault||(Object.create?function(V,p){Object.defineProperty(V,"default",{enumerable:!0,value:p})}:function(V,p){V.default=p}),E=this&&this.__importStar||function(V){if(V&&V.__esModule)return V;var p={};if(null!=V)for(var W in V)"default"!==W&&Object.prototype.hasOwnProperty.call(V,W)&&N(p,V,W);return d(p,V),p};Object.defineProperty(p,"__esModule",{value:!0}),p.Room=void 0;const z=E(W(10688)),S=W(10696),Q=W(10719),J=W(10727),i=W(10734),l=W(10742),j=W(10749),k=W(10681);class u{constructor(V,p){this.onStateChange=(0,l.createSignal)(),this.onError=(0,l.createSignal)(),this.onLeave=(0,l.createSignal)(),this.onJoin=(0,l.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,i.createNanoEvents)(),this.roomId=null,this.name=V,p&&(this.serializer=new((0,J.getSerializer)("schema")),this.rootSchema=p,this.serializer.state=new p),this.onError(((V,p)=>{var W;return null===(W=console.warn)||void 0===W?void 0:W.call(console,`colyseus.js - onError => (${V}) ${p}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const N=new S.Connection;W.connection=N,N.events.onmessage=u.prototype.onMessageCallback.bind(W),N.events.onclose=function(V){var N;if(!W.hasJoined)return null===(N=console.warn)||void 0===N||N.call(console,`Room connection was closed unexpectedly (${V.code}): ${V.reason}`),void W.onError.invoke(V.code,V.reason);V.code===k.CloseCode.DEVMODE_RESTART&&p?p():(W.onLeave.invoke(V.code),W.destroy())},N.events.onerror=function(V){var p;null===(p=console.warn)||void 0===p||p.call(console,`Room, onError (${V.code}): ${V.reason}`),W.onError.invoke(V.code,V.reason)},N.connect(V)}leave(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((p=>{this.onLeave((V=>p(V))),this.connection?V?this.connection.send([Q.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(k.CloseCode.CONSENTED)}))}onMessage(V,p){return this.onMessageHandlers.on(this.getMessageHandlerKey(V),p)}send(V,p){const W=[Q.Protocol.ROOM_DATA];let N;if("string"===typeof V?j.encode.string(W,V):j.encode.number(W,V),void 0!==p){const V=z.encode(p);N=new Uint8Array(W.length+V.byteLength),N.set(new Uint8Array(W),0),N.set(new Uint8Array(V),W.length)}else N=new Uint8Array(W);this.connection.send(N.buffer)}sendBytes(V,p){const W=[Q.Protocol.ROOM_DATA_BYTES];let N;"string"===typeof V?j.encode.string(W,V):j.encode.number(W,V),N=new Uint8Array(W.length+(p.byteLength||p.length)),N.set(new Uint8Array(W),0),N.set(new Uint8Array(p),W.length),this.connection.send(N.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(V){const p=Array.from(new Uint8Array(V.data)),W=p[0];if(W===Q.Protocol.JOIN_ROOM){let V=1;const W=(0,Q.utf8Read)(p,V);if(V+=(0,Q.utf8Length)(W),this.serializerId=(0,Q.utf8Read)(p,V),V+=(0,Q.utf8Length)(this.serializerId),!this.serializer){const V=(0,J.getSerializer)(this.serializerId);this.serializer=new V}p.length>V&&this.serializer.handshake&&this.serializer.handshake(p,{offset:V}),this.reconnectionToken=`${this.roomId}:${W}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([Q.Protocol.JOIN_ROOM])}else if(W===Q.Protocol.ERROR){const V={offset:1},W=j.decode.number(p,V),N=j.decode.string(p,V);this.onError.invoke(W,N)}else if(W===Q.Protocol.LEAVE_ROOM)this.leave();else if(W===Q.Protocol.ROOM_DATA_SCHEMA){const V={offset:1},W=this.serializer.getState().constructor._context.get(j.decode.number(p,V)),N=new W;N.decode(p,V),this.dispatchMessage(W,N)}else if(W===Q.Protocol.ROOM_STATE)p.shift(),this.setState(p);else if(W===Q.Protocol.ROOM_STATE_PATCH)p.shift(),this.patch(p);else if(W===Q.Protocol.ROOM_DATA){const W={offset:1},N=j.decode.stringCheck(p,W)?j.decode.string(p,W):j.decode.number(p,W),d=p.length>W.offset?z.decode(V.data,W.offset):void 0;this.dispatchMessage(N,d)}else if(W===Q.Protocol.ROOM_DATA_BYTES){const V={offset:1},W=j.decode.stringCheck(p,V)?j.decode.string(p,V):j.decode.number(p,V);this.dispatchMessage(W,new Uint8Array(p.slice(V.offset)))}}setState(V){this.serializer.setState(V),this.onStateChange.invoke(this.serializer.getState())}patch(V){this.serializer.patch(V),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(V,p){var W;const N=this.getMessageHandlerKey(V);this.onMessageHandlers.events[N]?this.onMessageHandlers.emit(N,p):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",V,p):null===(W=console.warn)||void 0===W||W.call(console,`colyseus.js: onMessage() not registered for type '${V}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(V){switch(typeof V){case"function":return`$${V._typeid}`;case"string":return V;case"number":return`i${V}`;default:throw new Error("invalid message type.")}}}p.Room=u},10763:(V,p)=>{"use strict";let W;function N(){return W||(W="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(V,p){this.cache[V]=p},getItem:function(V){this.cache[V]},removeItem:function(V){delete this.cache[V]}}),W}Object.defineProperty(p,"__esModule",{value:!0}),p.getItem=p.removeItem=p.setItem=void 0,p.setItem=function(V,p){N().setItem(V,p)},p.removeItem=function(V){N().removeItem(V)},p.getItem=function(V,p){const W=N().getItem(V);"undefined"!==typeof Promise&&W instanceof Promise?W.then((V=>p(V))):p(W)}},10734:(V,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.createNanoEvents=void 0;p.createNanoEvents=()=>({emit(V){let p=this.events[V]||[];for(var W=arguments.length,N=new Array(W>1?W-1:0),d=1;d<W;d++)N[d-1]=arguments[d];for(let E=0,z=p.length;E<z;E++)p[E](...N)},events:{},on(V,p){var W;return(null===(W=this.events[V])||void 0===W?void 0:W.push(p))||(this.events[V]=[p]),()=>{var W;this.events[V]=null===(W=this.events[V])||void 0===W?void 0:W.filter((V=>p!==V))}}})},10742:(V,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.createSignal=p.EventEmitter=void 0;class W{constructor(){this.handlers=[]}register(V){return this.handlers.push(V),this}invoke(){for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];this.handlers.forEach((V=>V.apply(this,p)))}invokeAsync(){for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];return Promise.all(this.handlers.map((V=>V.apply(this,p))))}remove(V){const p=this.handlers.indexOf(V);this.handlers[p]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}p.EventEmitter=W,p.createSignal=function(){const V=new W;function p(p){return V.register(p,null===this)}return p.once=p=>{const W=function(){for(var N=arguments.length,d=new Array(N),E=0;E<N;E++)d[E]=arguments[E];p.apply(this,d),V.remove(W)};V.register(W)},p.remove=p=>V.remove(p),p.invoke=function(){return V.invoke(...arguments)},p.invokeAsync=function(){return V.invokeAsync(...arguments)},p.clear=()=>V.clear(),p}},10681:(V,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.ServerError=p.CloseCode=void 0,function(V){V[V.CONSENTED=4e3]="CONSENTED",V[V.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(p.CloseCode||(p.CloseCode={}));class W extends Error{constructor(V,p){super(p),this.name="ServerError",this.code=V}}p.ServerError=W},10655:(V,p,W)=>{"use strict";p.c=void 0,W(10664);var N=W(10667);Object.defineProperty(p,"c",{enumerable:!0,get:function(){return N.Client}});var d=W(10719);var E=W(10684);var z=W(10756);const S=W(10769);const Q=W(10772),J=W(10727);(0,J.registerSerializer)("schema",S.SchemaSerializer),(0,J.registerSerializer)("none",Q.NoneSerializer)},10664:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=V=>null!==V&&"object"===typeof V&&V.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},10688:(V,p)=>{"use strict";function W(V,p){if(this._offset=p,V instanceof ArrayBuffer)this._buffer=V,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(V))throw new Error("Invalid argument");this._buffer=V.buffer,this._view=new DataView(this._buffer,V.byteOffset,V.byteLength)}}Object.defineProperty(p,"__esModule",{value:!0}),p.decode=p.encode=void 0,W.prototype._array=function(V){for(var p=new Array(V),W=0;W<V;W++)p[W]=this._parse();return p},W.prototype._map=function(V){for(var p={},W=0;W<V;W++)p[this._parse()]=this._parse();return p},W.prototype._str=function(V){var p=function(V,p,W){for(var N="",d=0,E=p,z=p+W;E<z;E++){var S=V.getUint8(E);if(0!==(128&S))if(192!==(224&S))if(224!==(240&S)){if(240!==(248&S))throw new Error("Invalid byte "+S.toString(16));(d=(7&S)<<18|(63&V.getUint8(++E))<<12|(63&V.getUint8(++E))<<6|63&V.getUint8(++E))>=65536?(d-=65536,N+=String.fromCharCode(55296+(d>>>10),56320+(1023&d))):N+=String.fromCharCode(d)}else N+=String.fromCharCode((15&S)<<12|(63&V.getUint8(++E))<<6|63&V.getUint8(++E));else N+=String.fromCharCode((31&S)<<6|63&V.getUint8(++E));else N+=String.fromCharCode(S)}return N}(this._view,this._offset,V);return this._offset+=V,p},W.prototype._bin=function(V){var p=this._buffer.slice(this._offset,this._offset+V);return this._offset+=V,p},W.prototype._parse=function(){var V,p=this._view.getUint8(this._offset++),W=0,N=0,d=0,E=0;if(p<192)return p<128?p:p<144?this._map(15&p):p<160?this._array(15&p):this._str(31&p);if(p>223)return-1*(255-p+1);switch(p){case 192:return null;case 194:return!1;case 195:return!0;case 196:return W=this._view.getUint8(this._offset),this._offset+=1,this._bin(W);case 197:return W=this._view.getUint16(this._offset),this._offset+=2,this._bin(W);case 198:return W=this._view.getUint32(this._offset),this._offset+=4,this._bin(W);case 199:if(W=this._view.getUint8(this._offset),N=this._view.getInt8(this._offset+1),this._offset+=2,-1===N){var z=this._view.getUint32(this._offset);return d=this._view.getInt32(this._offset+4),E=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*d+E)+z/1e6)}return[N,this._bin(W)];case 200:return W=this._view.getUint16(this._offset),N=this._view.getInt8(this._offset+2),this._offset+=3,[N,this._bin(W)];case 201:return W=this._view.getUint32(this._offset),N=this._view.getInt8(this._offset+4),this._offset+=5,[N,this._bin(W)];case 202:return V=this._view.getFloat32(this._offset),this._offset+=4,V;case 203:return V=this._view.getFloat64(this._offset),this._offset+=8,V;case 204:return V=this._view.getUint8(this._offset),this._offset+=1,V;case 205:return V=this._view.getUint16(this._offset),this._offset+=2,V;case 206:return V=this._view.getUint32(this._offset),this._offset+=4,V;case 207:return d=this._view.getUint32(this._offset)*Math.pow(2,32),E=this._view.getUint32(this._offset+4),this._offset+=8,d+E;case 208:return V=this._view.getInt8(this._offset),this._offset+=1,V;case 209:return V=this._view.getInt16(this._offset),this._offset+=2,V;case 210:return V=this._view.getInt32(this._offset),this._offset+=4,V;case 211:return d=this._view.getInt32(this._offset)*Math.pow(2,32),E=this._view.getUint32(this._offset+4),this._offset+=8,d+E;case 212:return N=this._view.getInt8(this._offset),this._offset+=1,0===N?void(this._offset+=1):[N,this._bin(1)];case 213:return N=this._view.getInt8(this._offset),this._offset+=1,[N,this._bin(2)];case 214:return N=this._view.getInt8(this._offset),this._offset+=1,-1===N?(V=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*V)):[N,this._bin(4)];case 215:return N=this._view.getInt8(this._offset),this._offset+=1,0===N?(d=this._view.getInt32(this._offset)*Math.pow(2,32),E=this._view.getUint32(this._offset+4),this._offset+=8,new Date(d+E)):-1===N?(d=this._view.getUint32(this._offset),E=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&d)+E)+(d>>>2)/1e6)):[N,this._bin(8)];case 216:return N=this._view.getInt8(this._offset),this._offset+=1,[N,this._bin(16)];case 217:return W=this._view.getUint8(this._offset),this._offset+=1,this._str(W);case 218:return W=this._view.getUint16(this._offset),this._offset+=2,this._str(W);case 219:return W=this._view.getUint32(this._offset),this._offset+=4,this._str(W);case 220:return W=this._view.getUint16(this._offset),this._offset+=2,this._array(W);case 221:return W=this._view.getUint32(this._offset),this._offset+=4,this._array(W);case 222:return W=this._view.getUint16(this._offset),this._offset+=2,this._map(W);case 223:return W=this._view.getUint32(this._offset),this._offset+=4,this._map(W)}throw new Error("Could not parse")},p.decode=function(V){var p=new W(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),N=p._parse();if(p._offset!==V.byteLength)throw new Error(V.byteLength-p._offset+" trailing bytes");return N};function N(V,p,W){for(var N=0,d=0,E=W.length;d<E;d++)(N=W.charCodeAt(d))<128?V.setUint8(p++,N):N<2048?(V.setUint8(p++,192|N>>6),V.setUint8(p++,128|63&N)):N<55296||N>=57344?(V.setUint8(p++,224|N>>12),V.setUint8(p++,128|N>>6&63),V.setUint8(p++,128|63&N)):(d++,N=65536+((1023&N)<<10|1023&W.charCodeAt(d)),V.setUint8(p++,240|N>>18),V.setUint8(p++,128|N>>12&63),V.setUint8(p++,128|N>>6&63),V.setUint8(p++,128|63&N))}function d(V,p,W){var N=typeof W,E=0,z=0,S=0,Q=0,J=0,i=0;if("string"===N){if(J=function(V){for(var p=0,W=0,N=0,d=V.length;N<d;N++)(p=V.charCodeAt(N))<128?W+=1:p<2048?W+=2:p<55296||p>=57344?W+=3:(N++,W+=4);return W}(W),J<32)V.push(160|J),i=1;else if(J<256)V.push(217,J),i=2;else if(J<65536)V.push(218,J>>8,J),i=3;else{if(!(J<4294967296))throw new Error("String too long");V.push(219,J>>24,J>>16,J>>8,J),i=5}return p.push({_str:W,_length:J,_offset:V.length}),i+J}if("number"===N)return Math.floor(W)===W&&isFinite(W)?W>=0?W<128?(V.push(W),1):W<256?(V.push(204,W),2):W<65536?(V.push(205,W>>8,W),3):W<4294967296?(V.push(206,W>>24,W>>16,W>>8,W),5):(S=W/Math.pow(2,32)|0,Q=W>>>0,V.push(207,S>>24,S>>16,S>>8,S,Q>>24,Q>>16,Q>>8,Q),9):W>=-32?(V.push(W),1):W>=-128?(V.push(208,W),2):W>=-32768?(V.push(209,W>>8,W),3):W>=-2147483648?(V.push(210,W>>24,W>>16,W>>8,W),5):(S=Math.floor(W/Math.pow(2,32)),Q=W>>>0,V.push(211,S>>24,S>>16,S>>8,S,Q>>24,Q>>16,Q>>8,Q),9):(V.push(203),p.push({_float:W,_length:8,_offset:V.length}),9);if("object"===N){if(null===W)return V.push(192),1;if(Array.isArray(W)){if((J=W.length)<16)V.push(144|J),i=1;else if(J<65536)V.push(220,J>>8,J),i=3;else{if(!(J<4294967296))throw new Error("Array too large");V.push(221,J>>24,J>>16,J>>8,J),i=5}for(E=0;E<J;E++)i+=d(V,p,W[E]);return i}if(W instanceof Date){var l=W.getTime(),j=Math.floor(l/1e3),k=1e6*(l-1e3*j);return j>=0&&k>=0&&j<=17179869183?0===k&&j<=4294967295?(V.push(214,255,j>>24,j>>16,j>>8,j),6):(S=j/4294967296,Q=4294967295&j,V.push(215,255,k>>22,k>>14,k>>6,S,Q>>24,Q>>16,Q>>8,Q),10):(S=Math.floor(j/4294967296),Q=j>>>0,V.push(199,12,255,k>>24,k>>16,k>>8,k,S>>24,S>>16,S>>8,S,Q>>24,Q>>16,Q>>8,Q),15)}if(W instanceof ArrayBuffer){if((J=W.byteLength)<256)V.push(196,J),i=2;else if(J<65536)V.push(197,J>>8,J),i=3;else{if(!(J<4294967296))throw new Error("Buffer too large");V.push(198,J>>24,J>>16,J>>8,J),i=5}return p.push({_bin:W,_length:J,_offset:V.length}),i+J}if("function"===typeof W.toJSON)return d(V,p,W.toJSON());var u=[],f="",O=Object.keys(W);for(E=0,z=O.length;E<z;E++)void 0!==W[f=O[E]]&&"function"!==typeof W[f]&&u.push(f);if((J=u.length)<16)V.push(128|J),i=1;else if(J<65536)V.push(222,J>>8,J),i=3;else{if(!(J<4294967296))throw new Error("Object too large");V.push(223,J>>24,J>>16,J>>8,J),i=5}for(E=0;E<J;E++)i+=d(V,p,f=u[E]),i+=d(V,p,W[f]);return i}if("boolean"===N)return V.push(W?195:194),1;if("undefined"===N)return V.push(192),1;if("function"===typeof W.toJSON)return d(V,p,W.toJSON());throw new Error("Could not encode")}p.encode=function(V){var p=[],W=[],E=d(p,W,V),z=new ArrayBuffer(E),S=new DataView(z),Q=0,J=0,i=-1;W.length>0&&(i=W[0]._offset);for(var l,j=0,k=0,u=0,f=p.length;u<f;u++)if(S.setUint8(J+u,p[u]),u+1===i){if(j=(l=W[Q])._length,k=J+i,l._bin)for(var O=new Uint8Array(l._bin),U=0;U<j;U++)S.setUint8(k+U,O[U]);else l._str?N(S,k,l._str):void 0!==l._float&&S.setFloat64(k,l._float);J+=j,W[++Q]&&(i=W[Q]._offset)}return z}},10772:(V,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.NoneSerializer=void 0;p.NoneSerializer=class{setState(V){}getState(){return null}patch(V){}teardown(){}handshake(V){}}},10769:(V,p,W)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.SchemaSerializer=void 0;const N=W(10749);p.SchemaSerializer=class{setState(V){return this.state.decode(V)}getState(){return this.state}patch(V){return this.state.decode(V)}teardown(){var V,p;null===(p=null===(V=this.state)||void 0===V?void 0:V.$changes)||void 0===p||p.root.clearRefs()}handshake(V,p){if(this.state){(new N.Reflection).decode(V,p)}else this.state=N.Reflection.decode(V,p)}}},10727:(V,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.getSerializer=p.registerSerializer=void 0;const W={};p.registerSerializer=function(V,p){W[V]=p},p.getSerializer=function(V){const p=W[V];if(!p)throw new Error("missing serializer: "+V);return p}},10704:function(V,p,W){"use strict";var N=this&&this.__importDefault||function(V){return V&&V.__esModule?V:{default:V}};Object.defineProperty(p,"__esModule",{value:!0}),p.WebSocketTransport=void 0;const d=N(W(10710)),E=globalThis.WebSocket||d.default;p.WebSocketTransport=class{constructor(V){this.events=V}send(V){V instanceof ArrayBuffer?this.ws.send(V):Array.isArray(V)&&this.ws.send(new Uint8Array(V).buffer)}connect(V){this.ws=new E(V,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(V,p){this.ws.close(V,p)}get isOpen(){return this.ws.readyState===E.OPEN}}},10710:V=>{"use strict";V.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},10833:V=>{"use strict";V.exports=function(V){for(var p=new Array(V),W=0;W<V;++W)p[W]=W;return p}},10836:V=>{function p(V){return!!V.constructor&&"function"===typeof V.constructor.isBuffer&&V.constructor.isBuffer(V)}V.exports=function(V){return null!=V&&(p(V)||function(V){return"function"===typeof V.readFloatLE&&"function"===typeof V.slice&&p(V.slice(0,0))}(V)||!!V._isBuffer)}},10829:(V,p,W)=>{var N=W(10833),d=W(10836),E="undefined"!==typeof Float64Array;function z(V,p){return V[0]-p[0]}function S(){var V,p=this.stride,W=new Array(p.length);for(V=0;V<W.length;++V)W[V]=[Math.abs(p[V]),V];W.sort(z);var N=new Array(W.length);for(V=0;V<N.length;++V)N[V]=W[V][1];return N}function Q(V,p){var W=["View",p,"d",V].join("");p<0&&(W="View_Nil"+V);var d="generic"===V;if(-1===p){var E="function "+W+"(a){this.data=a;};var proto="+W+".prototype;proto.dtype='"+V+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+W+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+W+"(a){return new "+W+"(a);}";return new Function(E)()}if(0===p){E="function "+W+"(a,d) {this.data = a;this.offset = d};var proto="+W+".prototype;proto.dtype='"+V+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+W+"_copy() {return new "+W+"(this.data,this.offset)};proto.pick=function "+W+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+W+"_get(){return "+(d?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+W+"_set(v){return "+(d?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+W+"(a,b,c,d){return new "+W+"(a,d)}";return new Function("TrivialArray",E)(J[V][0])}E=["'use strict'"];var z=N(p),Q=z.map((function(V){return"i"+V})),i="this.offset+"+z.map((function(V){return"this.stride["+V+"]*i"+V})).join("+"),l=z.map((function(V){return"b"+V})).join(","),j=z.map((function(V){return"c"+V})).join(",");E.push("function "+W+"(a,"+l+","+j+",d){this.data=a","this.shape=["+l+"]","this.stride=["+j+"]","this.offset=d|0}","var proto="+W+".prototype","proto.dtype='"+V+"'","proto.dimension="+p),E.push("Object.defineProperty(proto,'size',{get:function "+W+"_size(){return "+z.map((function(V){return"this.shape["+V+"]"})).join("*"),"}})"),1===p?E.push("proto.order=[0]"):(E.push("Object.defineProperty(proto,'order',{get:"),p<4?(E.push("function "+W+"_order(){"),2===p?E.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===p&&E.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):E.push("ORDER})")),E.push("proto.set=function "+W+"_set("+Q.join(",")+",v){"),d?E.push("return this.data.set("+i+",v)}"):E.push("return this.data["+i+"]=v}"),E.push("proto.get=function "+W+"_get("+Q.join(",")+"){"),d?E.push("return this.data.get("+i+")}"):E.push("return this.data["+i+"]}"),E.push("proto.index=function "+W+"_index(",Q.join(),"){return "+i+"}"),E.push("proto.hi=function "+W+"_hi("+Q.join(",")+"){return new "+W+"(this.data,"+z.map((function(V){return["(typeof i",V,"!=='number'||i",V,"<0)?this.shape[",V,"]:i",V,"|0"].join("")})).join(",")+","+z.map((function(V){return"this.stride["+V+"]"})).join(",")+",this.offset)}");var k=z.map((function(V){return"a"+V+"=this.shape["+V+"]"})),u=z.map((function(V){return"c"+V+"=this.stride["+V+"]"}));E.push("proto.lo=function "+W+"_lo("+Q.join(",")+"){var b=this.offset,d=0,"+k.join(",")+","+u.join(","));for(var f=0;f<p;++f)E.push("if(typeof i"+f+"==='number'&&i"+f+">=0){d=i"+f+"|0;b+=c"+f+"*d;a"+f+"-=d}");E.push("return new "+W+"(this.data,"+z.map((function(V){return"a"+V})).join(",")+","+z.map((function(V){return"c"+V})).join(",")+",b)}"),E.push("proto.step=function "+W+"_step("+Q.join(",")+"){var "+z.map((function(V){return"a"+V+"=this.shape["+V+"]"})).join(",")+","+z.map((function(V){return"b"+V+"=this.stride["+V+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(f=0;f<p;++f)E.push("if(typeof i"+f+"==='number'){d=i"+f+"|0;if(d<0){c+=b"+f+"*(a"+f+"-1);a"+f+"=ceil(-a"+f+"/d)}else{a"+f+"=ceil(a"+f+"/d)}b"+f+"*=d}");E.push("return new "+W+"(this.data,"+z.map((function(V){return"a"+V})).join(",")+","+z.map((function(V){return"b"+V})).join(",")+",c)}");var O=new Array(p),U=new Array(p);for(f=0;f<p;++f)O[f]="a[i"+f+"]",U[f]="b[i"+f+"]";E.push("proto.transpose=function "+W+"_transpose("+Q+"){"+Q.map((function(V,p){return V+"=("+V+"===undefined?"+p+":"+V+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+W+"(this.data,"+O.join(",")+","+U.join(",")+",this.offset)}"),E.push("proto.pick=function "+W+"_pick("+Q+"){var a=[],b=[],c=this.offset");for(f=0;f<p;++f)E.push("if(typeof i"+f+"==='number'&&i"+f+">=0){c=(c+this.stride["+f+"]*i"+f+")|0}else{a.push(this.shape["+f+"]);b.push(this.stride["+f+"])}");return E.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),E.push("return function construct_"+W+"(data,shape,stride,offset){return new "+W+"(data,"+z.map((function(V){return"shape["+V+"]"})).join(",")+","+z.map((function(V){return"stride["+V+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",E.join("\n"))(J[V],S)}var J={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};V.exports=function(V,p,W,N){if(void 0===V)return(0,J.array[0])([]);"number"===typeof V&&(V=[V]),void 0===p&&(p=[V.length]);var z=p.length;if(void 0===W){W=new Array(z);for(var S=z-1,i=1;S>=0;--S)W[S]=i,i*=p[S]}if(void 0===N){N=0;for(S=0;S<z;++S)W[S]<0&&(N-=(p[S]-1)*W[S])}for(var l=function(V){if(d(V))return"buffer";if(E)switch(Object.prototype.toString.call(V)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(V)?"array":"generic"}(V),j=J[l];j.length<=z+1;)j.push(Q(l,j.length-1));return(0,j[z+1])(V,p,W,N)}},10794:V=>{var p;self,p=()=>(()=>{"use strict";var V={d:(p,W)=>{for(var N in W)V.o(W,N)&&!V.o(p,N)&&Object.defineProperty(p,N,{enumerable:!0,get:W[N]})},o:(V,p)=>Object.prototype.hasOwnProperty.call(V,p)},p={};V.d(p,{default:()=>b});var W,N=function(V,p){var W=p.x-V.x,N=p.y-V.y;return Math.sqrt(W*W+N*N)},d=function(V){return V*(Math.PI/180)},E=new Map,z=function(V){E.has(V)&&clearTimeout(E.get(V)),E.set(V,setTimeout(V,100))},S=function(V,p,W){for(var N,d=p.split(/[ ,]+/g),E=0;E<d.length;E+=1)N=d[E],V.addEventListener?V.addEventListener(N,W,!1):V.attachEvent&&V.attachEvent(N,W)},Q=function(V,p,W){for(var N,d=p.split(/[ ,]+/g),E=0;E<d.length;E+=1)N=d[E],V.removeEventListener?V.removeEventListener(N,W):V.detachEvent&&V.detachEvent(N,W)},J=function(V){return V.preventDefault(),V.type.match(/^touch/)?V.changedTouches:V},i=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},l=function(V,p){p.top||p.right||p.bottom||p.left?(V.style.top=p.top,V.style.right=p.right,V.style.bottom=p.bottom,V.style.left=p.left):(V.style.left=p.x+"px",V.style.top=p.y+"px")},j=function(V,p,W){var N=k(V);for(var d in N)if(N.hasOwnProperty(d))if("string"==typeof p)N[d]=p+" "+W;else{for(var E="",z=0,S=p.length;z<S;z+=1)E+=p[z]+" "+W+", ";N[d]=E.slice(0,-2)}return N},k=function(V){var p={};return p[V]="",["webkit","Moz","o"].forEach((function(W){p[W+V.charAt(0).toUpperCase()+V.slice(1)]=""})),p},u=function(V,p){for(var W in p)p.hasOwnProperty(W)&&(V[W]=p[W]);return V},f=function(V,p){if(V.length)for(var W=0,N=V.length;W<N;W+=1)p(V[W]);else p(V)},O="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,U=window.matchMedia("(any-hover: none)").matches,F=!!("ontouchstart"in window),C=!!window.PointerEvent,A=!!window.MSPointerEvent,v={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},t={start:"mousedown",move:"mousemove",end:"mouseup"},e={};function Z(){}O&&!U?W=v:C?W={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:A?W={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:F?(W=v,e=t):W=t,Z.prototype.on=function(V,p){var W,N=this,d=V.split(/[ ,]+/g);N._handlers_=N._handlers_||{};for(var E=0;E<d.length;E+=1)W=d[E],N._handlers_[W]=N._handlers_[W]||[],N._handlers_[W].push(p);return N},Z.prototype.off=function(V,p){var W=this;return W._handlers_=W._handlers_||{},void 0===V?W._handlers_={}:void 0===p?W._handlers_[V]=null:W._handlers_[V]&&W._handlers_[V].indexOf(p)>=0&&W._handlers_[V].splice(W._handlers_[V].indexOf(p),1),W},Z.prototype.trigger=function(V,p){var W,N=this,d=V.split(/[ ,]+/g);N._handlers_=N._handlers_||{};for(var E=0;E<d.length;E+=1)W=d[E],N._handlers_[W]&&N._handlers_[W].length&&N._handlers_[W].forEach((function(V){V.call(N,{type:W,target:N},p)}))},Z.prototype.config=function(V){var p=this;p.options=p.defaults||{},V&&(p.options=function(V,p){var W={};for(var N in V)V.hasOwnProperty(N)&&p.hasOwnProperty(N)?W[N]=p[N]:V.hasOwnProperty(N)&&(W[N]=V[N]);return W}(p.options,V))},Z.prototype.bindEvt=function(V,p){var N=this;return N._domHandlers_=N._domHandlers_||{},N._domHandlers_[p]=function(){"function"==typeof N["on"+p]?N["on"+p].apply(N,arguments):console.warn('[WARNING] : Missing "on'+p+'" handler.')},S(V,W[p],N._domHandlers_[p]),e[p]&&S(V,e[p],N._domHandlers_[p]),N},Z.prototype.unbindEvt=function(V,p){var N=this;return N._domHandlers_=N._domHandlers_||{},Q(V,W[p],N._domHandlers_[p]),e[p]&&Q(V,e[p],N._domHandlers_[p]),delete N._domHandlers_[p],this};const o=Z;function K(V,p){return this.identifier=p.identifier,this.position=p.position,this.frontPosition=p.frontPosition,this.collection=V,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(p),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=K.id,K.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}K.prototype=new o,K.constructor=K,K.id=0,K.prototype.buildEl=function(V){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},K.prototype.stylize=function(){if(this.options.dataOnly)return this;var V=this.options.fadeTime+"ms",p=function(){var V=k("borderRadius");for(var p in V)V.hasOwnProperty(p)&&(V[p]="50%");return V}(),W=j("transition","opacity",V),N={};return N.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},N.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},N.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},u(N.el,W),"circle"===this.options.shape&&u(N.back,p),u(N.front,p),this.applyStyles(N),this},K.prototype.applyStyles=function(V){for(var p in this.ui)if(this.ui.hasOwnProperty(p))for(var W in V[p])this.ui[p].style[W]=V[p][W];return this},K.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},K.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},K.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},K.prototype.show=function(V){var p=this;return p.options.dataOnly||(clearTimeout(p.removeTimeout),clearTimeout(p.showTimeout),clearTimeout(p.restTimeout),p.addToDom(),p.restCallback(),setTimeout((function(){p.ui.el.style.opacity=1}),0),p.showTimeout=setTimeout((function(){p.trigger("shown",p.instance),"function"==typeof V&&V.call(this)}),p.options.fadeTime)),p},K.prototype.hide=function(V){var p=this;if(p.options.dataOnly)return p;if(p.ui.el.style.opacity=p.options.restOpacity,clearTimeout(p.removeTimeout),clearTimeout(p.showTimeout),clearTimeout(p.restTimeout),p.removeTimeout=setTimeout((function(){var W="dynamic"===p.options.mode?"none":"block";p.ui.el.style.display=W,"function"==typeof V&&V.call(p),p.trigger("hidden",p.instance)}),p.options.fadeTime),p.options.restJoystick){var W=p.options.restJoystick,N={};N.x=!0===W||!1!==W.x?0:p.instance.frontPosition.x,N.y=!0===W||!1!==W.y?0:p.instance.frontPosition.y,p.setPosition(V,N)}return p},K.prototype.setPosition=function(V,p){var W=this;W.frontPosition={x:p.x,y:p.y};var N=W.options.fadeTime+"ms",d={};d.front=j("transition",["transform"],N);var E={front:{}};E.front={transform:"translate("+W.frontPosition.x+"px,"+W.frontPosition.y+"px)"},W.applyStyles(d),W.applyStyles(E),W.restTimeout=setTimeout((function(){"function"==typeof V&&V.call(W),W.restCallback()}),W.options.fadeTime)},K.prototype.restCallback=function(){var V=this,p={};p.front=j("transition","none",""),V.applyStyles(p),V.trigger("rested",V.instance)},K.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},K.prototype.computeDirection=function(V){var p,W,N,d=V.angle.radian,E=Math.PI/4,z=Math.PI/2;if(d>E&&d<3*E&&!V.lockX?p="up":d>-E&&d<=E&&!V.lockY?p="left":d>3*-E&&d<=-E&&!V.lockX?p="down":V.lockY||(p="right"),V.lockY||(W=d>-z&&d<z?"left":"right"),V.lockX||(N=d>0?"up":"down"),V.force>this.options.threshold){var S,Q={};for(S in this.direction)this.direction.hasOwnProperty(S)&&(Q[S]=this.direction[S]);var J={};for(S in this.direction={x:W,y:N,angle:p},V.direction=this.direction,Q)Q[S]===this.direction[S]&&(J[S]=!0);if(J.x&&J.y&&J.angle)return V;J.x&&J.y||this.trigger("plain",V),J.x||this.trigger("plain:"+W,V),J.y||this.trigger("plain:"+N,V),J.angle||this.trigger("dir dir:"+p,V)}else this.resetDirection();return V};const h=K;function L(V,p){var W=this;W.nipples=[],W.idles=[],W.actives=[],W.ids=[],W.pressureIntervals={},W.manager=V,W.id=L.id,L.id+=1,W.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},W.config(p),"static"!==W.options.mode&&"semi"!==W.options.mode||(W.options.multitouch=!1),W.options.multitouch||(W.options.maxNumberOfNipples=1);var N=getComputedStyle(W.options.zone.parentElement);return N&&"flex"===N.display&&(W.parentIsFlex=!0),W.updateBox(),W.prepareNipples(),W.mj(),W.begin(),W.nipples}L.prototype=new o,L.constructor=L,L.id=0,L.prototype.prepareNipples=function(){var V=this,p=V.nipples;p.on=V.on.bind(V),p.off=V.off.bind(V),p.options=V.options,p.destroy=V.destroy.bind(V),p.ids=V.ids,p.id=V.id,p.processOnMove=V.processOnMove.bind(V),p.processOnEnd=V.processOnEnd.bind(V),p.get=function(V){if(void 0===V)return p[0];for(var W=0,N=p.length;W<N;W+=1)if(p[W].identifier===V)return p[W];return!1}},L.prototype.mj=function(){var V=this;V.bindEvt(V.options.zone,"start"),V.options.zone.style.touchAction="none",V.options.zone.style.msTouchAction="none"},L.prototype.begin=function(){var V=this,p=V.options;if("static"===p.mode){var W=V.createNipple(p.position,V.manager.getIdentifier());W.add(),V.idles.push(W)}},L.prototype.createNipple=function(V,p){var W=this,N=W.manager.scroll,d={},E=W.options,z=W.parentIsFlex?N.x:N.x+W.box.left,S=W.parentIsFlex?N.y:N.y+W.box.top;if(V.x&&V.y)d={x:V.x-z,y:V.y-S};else if(V.top||V.right||V.bottom||V.left){var Q=document.createElement("DIV");Q.style.display="hidden",Q.style.top=V.top,Q.style.right=V.right,Q.style.bottom=V.bottom,Q.style.left=V.left,Q.style.position="absolute",E.zone.appendChild(Q);var J=Q.getBoundingClientRect();E.zone.removeChild(Q),d=V,V={x:J.left+N.x,y:J.top+N.y}}var i=new h(W,{color:E.color,size:E.size,threshold:E.threshold,fadeTime:E.fadeTime,dataOnly:E.dataOnly,restJoystick:E.restJoystick,restOpacity:E.restOpacity,mode:E.mode,identifier:p,position:V,zone:E.zone,frontPosition:{x:0,y:0},shape:E.shape});return E.dataOnly||(l(i.ui.el,d),l(i.ui.front,i.frontPosition)),W.nipples.push(i),W.trigger("added "+i.identifier+":added",i),W.manager.trigger("added "+i.identifier+":added",i),W.bindNipple(i),i},L.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},L.prototype.bindNipple=function(V){var p,W=this,N=function(V,N){p=V.type+" "+N.id+":"+V.type,W.trigger(p,N)};V.on("destroyed",W.onDestroyed.bind(W)),V.on("shown hidden rested dir plain",N),V.on("dir:up dir:right dir:down dir:left",N),V.on("plain:up plain:right plain:down plain:left",N)},L.prototype.pressureFn=function(V,p,W){var N=this,d=0;clearInterval(N.pressureIntervals[W]),N.pressureIntervals[W]=setInterval(function(){var W=V.force||V.pressure||V.webkitForce||0;W!==d&&(p.trigger("pressure",W),N.trigger("pressure "+p.identifier+":pressure",W),d=W)}.bind(N),100)},L.prototype.onstart=function(V){var p=this,W=p.options,N=V;return V=J(V),p.updateBox(),f(V,(function(d){p.actives.length<W.maxNumberOfNipples?p.processOnStart(d):N.type.match(/^touch/)&&(Object.keys(p.manager.ids).forEach((function(W){if(Object.values(N.touches).findIndex((function(V){return V.identifier===W}))<0){var d=[V[0]];d.identifier=W,p.processOnEnd(d)}})),p.actives.length<W.maxNumberOfNipples&&p.processOnStart(d))})),p.manager.bindDocument(),!1},L.prototype.processOnStart=function(V){var p,W=this,d=W.options,E=W.manager.getIdentifier(V),z=V.force||V.pressure||V.webkitForce||0,S={x:V.pageX,y:V.pageY},Q=W.getOrCreate(E,S);Q.identifier!==E&&W.manager.removeIdentifier(Q.identifier),Q.identifier=E;var J=function(p){p.trigger("start",p),W.trigger("start "+p.id+":start",p),p.show(),z>0&&W.pressureFn(V,p,p.identifier),W.processOnMove(V)};if((p=W.idles.indexOf(Q))>=0&&W.idles.splice(p,1),W.actives.push(Q),W.ids.push(Q.identifier),"semi"!==d.mode)J(Q);else{if(!(N(S,Q.position)<=d.catchDistance))return Q.destroy(),void W.processOnStart(V);J(Q)}return Q},L.prototype.getOrCreate=function(V,p){var W,N=this,d=N.options;return/(semi|static)/.test(d.mode)?(W=N.idles[0])?(N.idles.splice(0,1),W):"semi"===d.mode?N.createNipple(p,V):(console.warn("Coudln't find the needed nipple."),!1):W=N.createNipple(p,V)},L.prototype.processOnMove=function(V){var p=this,W=p.options,E=p.manager.getIdentifier(V),z=p.nipples.get(E),S=p.manager.scroll;if(function(V){return isNaN(V.buttons)?0!==V.pressure:0!==V.buttons}(V)){if(!z)return console.error("Found zombie joystick with ID "+E),void p.manager.removeIdentifier(E);if(W.dynamicPage){var Q=z.el.getBoundingClientRect();z.position={x:S.x+Q.left,y:S.y+Q.top}}z.identifier=E;var J=z.options.size/2,i={x:V.pageX,y:V.pageY};W.lockX&&(i.y=z.position.y),W.lockY&&(i.x=z.position.x);var l,j,k,u,f,O,U,F,C,A,v=N(i,z.position),t=(l=i,k=(j=z.position).x-l.x,u=j.y-l.y,function(V){return V*(180/Math.PI)}(Math.atan2(u,k))),e=d(t),Z=v/J,o={distance:v,position:i};if("circle"===z.options.shape?(f=Math.min(v,J),U=z.position,F=f,A={x:0,y:0},C=d(C=t),A.x=U.x-F*Math.cos(C),A.y=U.y-F*Math.sin(C),O=A):(O=function(V,p,W){return{x:Math.min(Math.max(V.x,p.x-W),p.x+W),y:Math.min(Math.max(V.y,p.y-W),p.y+W)}}(i,z.position,J),f=N(O,z.position)),W.follow){if(v>J){var K=i.x-O.x,h=i.y-O.y;z.position.x+=K,z.position.y+=h,z.el.style.top=z.position.y-(p.box.top+S.y)+"px",z.el.style.left=z.position.x-(p.box.left+S.x)+"px",v=N(i,z.position)}}else i=O,v=f;var L=i.x-z.position.x,x=i.y-z.position.y;z.frontPosition={x:L,y:x},W.dataOnly||(z.ui.front.style.transform="translate("+L+"px,"+x+"px)");var T={identifier:z.identifier,position:i,force:Z,pressure:V.force||V.pressure||V.webkitForce||0,distance:v,angle:{radian:e,degree:t},vector:{x:L/J,y:-x/J},raw:o,instance:z,lockX:W.lockX,lockY:W.lockY};(T=z.computeDirection(T)).angle={radian:d(180-t),degree:180-t},z.trigger("move",T),p.trigger("move "+z.id+":move",T)}else this.processOnEnd(V)},L.prototype.processOnEnd=function(V){var p=this,W=p.options,N=p.manager.getIdentifier(V),d=p.nipples.get(N),E=p.manager.removeIdentifier(d.identifier);d&&(W.dataOnly||d.hide((function(){"dynamic"===W.mode&&(d.trigger("removed",d),p.trigger("removed "+d.id+":removed",d),p.manager.trigger("removed "+d.id+":removed",d),d.destroy())})),clearInterval(p.pressureIntervals[d.identifier]),d.resetDirection(),d.trigger("end",d),p.trigger("end "+d.id+":end",d),p.ids.indexOf(d.identifier)>=0&&p.ids.splice(p.ids.indexOf(d.identifier),1),p.actives.indexOf(d)>=0&&p.actives.splice(p.actives.indexOf(d),1),/(semi|static)/.test(W.mode)?p.idles.push(d):p.nipples.indexOf(d)>=0&&p.nipples.splice(p.nipples.indexOf(d),1),p.manager.unbindDocument(),/(semi|static)/.test(W.mode)&&(p.manager.ids[E.id]=E.identifier))},L.prototype.onDestroyed=function(V,p){var W=this;W.nipples.indexOf(p)>=0&&W.nipples.splice(W.nipples.indexOf(p),1),W.actives.indexOf(p)>=0&&W.actives.splice(W.actives.indexOf(p),1),W.idles.indexOf(p)>=0&&W.idles.splice(W.idles.indexOf(p),1),W.ids.indexOf(p.identifier)>=0&&W.ids.splice(W.ids.indexOf(p.identifier),1),W.manager.removeIdentifier(p.identifier),W.manager.unbindDocument()},L.prototype.destroy=function(){var V=this;for(var p in V.unbindEvt(V.options.zone,"start"),V.nipples.forEach((function(V){V.destroy()})),V.pressureIntervals)V.pressureIntervals.hasOwnProperty(p)&&clearInterval(V.pressureIntervals[p]);V.trigger("destroyed",V.nipples),V.manager.unbindDocument(),V.off()};const x=L;function T(V){var p=this;p.ids={},p.index=0,p.collections=[],p.scroll=i(),p.config(V),p.prepareCollections();var W=function(){var V;p.collections.forEach((function(W){W.forEach((function(W){V=W.el.getBoundingClientRect(),W.position={x:p.scroll.x+V.left,y:p.scroll.y+V.top}}))}))};S(window,"resize",(function(){z(W)}));var N=function(){p.scroll=i()};return S(window,"scroll",(function(){z(N)})),p.collections}T.prototype=new o,T.constructor=T,T.prototype.prepareCollections=function(){var V=this;V.collections.create=V.create.bind(V),V.collections.on=V.on.bind(V),V.collections.off=V.off.bind(V),V.collections.destroy=V.destroy.bind(V),V.collections.get=function(p){var W;return V.collections.every((function(V){return!(W=V.get(p))})),W}},T.prototype.create=function(V){return this.createCollection(V)},T.prototype.createCollection=function(V){var p=this,W=new x(p,V);return p.bindCollection(W),p.collections.push(W),W},T.prototype.bindCollection=function(V){var p,W=this,N=function(V,N){p=V.type+" "+N.id+":"+V.type,W.trigger(p,N)};V.on("destroyed",W.onDestroyed.bind(W)),V.on("shown hidden rested dir plain",N),V.on("dir:up dir:right dir:down dir:left",N),V.on("plain:up plain:right plain:down plain:left",N)},T.prototype.bindDocument=function(){var V=this;V.binded||(V.bindEvt(document,"move").bindEvt(document,"end"),V.binded=!0)},T.prototype.unbindDocument=function(V){var p=this;Object.keys(p.ids).length&&!0!==V||(p.unbindEvt(document,"move").unbindEvt(document,"end"),p.binded=!1)},T.prototype.getIdentifier=function(V){var p;return V?void 0===(p=void 0===V.identifier?V.pointerId:V.identifier)&&(p=this.latest||0):p=this.index,void 0===this.ids[p]&&(this.ids[p]=this.index,this.index+=1),this.latest=p,this.ids[p]},T.prototype.removeIdentifier=function(V){var p={};for(var W in this.ids)if(this.ids[W]===V){p.id=W,p.identifier=this.ids[W],delete this.ids[W];break}return p},T.prototype.onmove=function(V){return this.onAny("move",V),!1},T.prototype.onend=function(V){return this.onAny("end",V),!1},T.prototype.oncancel=function(V){return this.onAny("end",V),!1},T.prototype.onAny=function(V,p){var W,N=this,d="processOn"+V.charAt(0).toUpperCase()+V.slice(1);p=J(p);var E=function(V,p,W){W.ids.indexOf(p)>=0&&(W[d](V),V._found_=!0)};return f(p,(function(V){W=N.getIdentifier(V),f(N.collections,E.bind(null,V,W)),V._found_||N.removeIdentifier(W)})),!1},T.prototype.destroy=function(){var V=this;V.unbindDocument(!0),V.ids={},V.index=0,V.collections.forEach((function(V){V.destroy()})),V.off()},T.prototype.onDestroyed=function(V,p){var W=this;if(W.collections.indexOf(p)<0)return!1;W.collections.splice(W.collections.indexOf(p),1)};var P=new T;const b={create:function(V){return P.create(V)},factory:P};return p.default})(),V.exports=p()},11033:(V,p,W)=>{"use strict";const{Deflate:N,deflate:d,deflateRaw:E,gzip:z}=W(11035),{Inflate:S,inflate:Q,inflateRaw:J,ungzip:i}=W(11096),l=W(11074);V.exports.Deflate=N,V.exports.deflate=d,V.exports.deflateRaw=E,V.exports.gzip=z,V.exports.Inflate=S,V.exports.inflate=Q,V.exports.inflateRaw=J,V.exports.ungzip=i,V.exports.constants=l},11035:(V,p,W)=>{"use strict";const N=W(11044),d=W(11080),E=W(11082),z=W(11068),S=W(11088),Q=Object.prototype.toString,{Z_NO_FLUSH:J,Z_SYNC_FLUSH:i,Z_FULL_FLUSH:l,Z_FINISH:j,Z_OK:k,Z_STREAM_END:u,Z_DEFAULT_COMPRESSION:f,Z_DEFAULT_STRATEGY:O,Z_DEFLATED:U}=W(11074);function F(V){this.options=d.assign({level:f,method:U,Ja:16384,windowBits:15,memLevel:8,strategy:O},V||{});let p=this.options;p.raw&&p.windowBits>0?p.windowBits=-p.windowBits:p.gzip&&p.windowBits>0&&p.windowBits<16&&(p.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new S,this.strm.avail_out=0;let W=N.deflateInit2(this.strm,p.level,p.method,p.windowBits,p.memLevel,p.strategy);if(W!==k)throw new Error(z[W]);if(p.header&&N.deflateSetHeader(this.strm,p.header),p.dictionary){let V;if(V="string"===typeof p.dictionary?E.string2buf(p.dictionary):"[object ArrayBuffer]"===Q.call(p.dictionary)?new Uint8Array(p.dictionary):p.dictionary,W=N.deflateSetDictionary(this.strm,V),W!==k)throw new Error(z[W]);this._dict_set=!0}}function C(V,p){const W=new F(p);if(W.push(V,!0),W.err)throw W.msg||z[W.err];return W.result}F.prototype.push=function(V,p){const W=this.strm,d=this.options.Ja;let z,S;if(this.ended)return!1;for(S=p===~~p?p:!0===p?j:J,"string"===typeof V?W.input=E.string2buf(V):"[object ArrayBuffer]"===Q.call(V)?W.input=new Uint8Array(V):W.input=V,W.next_in=0,W.avail_in=W.input.length;;)if(0===W.avail_out&&(W.output=new Uint8Array(d),W.next_out=0,W.avail_out=d),(S===i||S===l)&&W.avail_out<=6)this.onData(W.output.subarray(0,W.next_out)),W.avail_out=0;else{if(z=N.deflate(W,S),z===u)return W.next_out>0&&this.onData(W.output.subarray(0,W.next_out)),z=N.deflateEnd(this.strm),this.onEnd(z),this.ended=!0,z===k;if(0!==W.avail_out){if(S>0&&W.next_out>0)this.onData(W.output.subarray(0,W.next_out)),W.avail_out=0;else if(0===W.avail_in)break}else this.onData(W.output)}return!0},F.prototype.onData=function(V){this.chunks.push(V)},F.prototype.onEnd=function(V){V===k&&(this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=V,this.msg=this.strm.msg},V.exports.Deflate=F,V.exports.deflate=C,V.exports.deflateRaw=function(V,p){return(p=p||{}).raw=!0,C(V,p)},V.exports.gzip=function(V,p){return(p=p||{}).gzip=!0,C(V,p)},V.exports.constants=W(11074)},11096:(V,p,W)=>{"use strict";const N=W(11102),d=W(11080),E=W(11082),z=W(11068),S=W(11088),Q=W(11125),J=Object.prototype.toString,{Z_NO_FLUSH:i,Z_FINISH:l,Z_OK:j,Z_STREAM_END:k,Z_NEED_DICT:u,Z_STREAM_ERROR:f,Z_DATA_ERROR:O,Z_MEM_ERROR:U}=W(11074);function F(V){this.options=d.assign({Ja:65536,windowBits:15,to:""},V||{});const p=this.options;p.raw&&p.windowBits>=0&&p.windowBits<16&&(p.windowBits=-p.windowBits,0===p.windowBits&&(p.windowBits=-15)),!(p.windowBits>=0&&p.windowBits<16)||V&&V.windowBits||(p.windowBits+=32),p.windowBits>15&&p.windowBits<48&&0===(15&p.windowBits)&&(p.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new S,this.strm.avail_out=0;let W=N.inflateInit2(this.strm,p.windowBits);if(W!==j)throw new Error(z[W]);if(this.header=new Q,N.inflateGetHeader(this.strm,this.header),p.dictionary&&("string"===typeof p.dictionary?p.dictionary=E.string2buf(p.dictionary):"[object ArrayBuffer]"===J.call(p.dictionary)&&(p.dictionary=new Uint8Array(p.dictionary)),p.raw&&(W=N.inflateSetDictionary(this.strm,p.dictionary),W!==j)))throw new Error(z[W])}function C(V,p){const W=new F(p);if(W.push(V),W.err)throw W.msg||z[W.err];return W.result}F.prototype.push=function(V,p){const W=this.strm,d=this.options.Ja,z=this.options.dictionary;let S,Q,F;if(this.ended)return!1;for(Q=p===~~p?p:!0===p?l:i,"[object ArrayBuffer]"===J.call(V)?W.input=new Uint8Array(V):W.input=V,W.next_in=0,W.avail_in=W.input.length;;){for(0===W.avail_out&&(W.output=new Uint8Array(d),W.next_out=0,W.avail_out=d),S=N.inflate(W,Q),S===u&&z&&(S=N.inflateSetDictionary(W,z),S===j?S=N.inflate(W,Q):S===O&&(S=u));W.avail_in>0&&S===k&&W.state.wrap>0&&0!==V[W.next_in];)N.inflateReset(W),S=N.inflate(W,Q);switch(S){case f:case O:case u:case U:return this.onEnd(S),this.ended=!0,!1}if(F=W.avail_out,W.next_out&&(0===W.avail_out||S===k))if("string"===this.options.to){let V=E.utf8border(W.output,W.next_out),p=W.next_out-V,N=E.buf2string(W.output,V);W.next_out=p,W.avail_out=d-p,p&&W.output.set(W.output.subarray(V,V+p),0),this.onData(N)}else this.onData(W.output.length===W.next_out?W.output:W.output.subarray(0,W.next_out));if(S!==j||0!==F){if(S===k)return S=N.inflateEnd(this.strm),this.onEnd(S),this.ended=!0,!0;if(0===W.avail_in)break}}return!0},F.prototype.onData=function(V){this.chunks.push(V)},F.prototype.onEnd=function(V){V===j&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=V,this.msg=this.strm.msg},V.exports.Inflate=F,V.exports.inflate=C,V.exports.inflateRaw=function(V,p){return(p=p||{}).raw=!0,C(V,p)},V.exports.ungzip=C,V.exports.constants=W(11074)},11080:V=>{"use strict";const p=(V,p)=>Object.prototype.hasOwnProperty.call(V,p);V.exports.assign=function(V){const W=Array.prototype.slice.call(arguments,1);for(;W.length;){const N=W.shift();if(N){if("object"!==typeof N)throw new TypeError(N+"must be non-object");for(const W in N)p(N,W)&&(V[W]=N[W])}}return V},V.exports.flattenChunks=V=>{let p=0;for(let N=0,d=V.length;N<d;N++)p+=V[N].length;const W=new Uint8Array(p);for(let N=0,d=0,E=V.length;N<E;N++){let p=V[N];W.set(p,d),d+=p.length}return W}},11082:V=>{"use strict";let p=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(N){p=!1}const W=new Uint8Array(256);for(let d=0;d<256;d++)W[d]=d>=252?6:d>=248?5:d>=240?4:d>=224?3:d>=192?2:1;W[254]=W[254]=1,V.exports.string2buf=V=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(V);let p,W,N,d,E,z=V.length,S=0;for(d=0;d<z;d++)W=V.charCodeAt(d),55296===(64512&W)&&d+1<z&&(N=V.charCodeAt(d+1),56320===(64512&N)&&(W=65536+(W-55296<<10)+(N-56320),d++)),S+=W<128?1:W<2048?2:W<65536?3:4;for(p=new Uint8Array(S),E=0,d=0;E<S;d++)W=V.charCodeAt(d),55296===(64512&W)&&d+1<z&&(N=V.charCodeAt(d+1),56320===(64512&N)&&(W=65536+(W-55296<<10)+(N-56320),d++)),W<128?p[E++]=W:W<2048?(p[E++]=192|W>>>6,p[E++]=128|63&W):W<65536?(p[E++]=224|W>>>12,p[E++]=128|W>>>6&63,p[E++]=128|63&W):(p[E++]=240|W>>>18,p[E++]=128|W>>>12&63,p[E++]=128|W>>>6&63,p[E++]=128|63&W);return p};V.exports.buf2string=(V,N)=>{const d=N||V.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(V.subarray(0,N));let E,z;const S=new Array(2*d);for(z=0,E=0;E<d;){let p=V[E++];if(p<128){S[z++]=p;continue}let N=W[p];if(N>4)S[z++]=65533,E+=N-1;else{for(p&=2===N?31:3===N?15:7;N>1&&E<d;)p=p<<6|63&V[E++],N--;N>1?S[z++]=65533:p<65536?S[z++]=p:(p-=65536,S[z++]=55296|p>>10&1023,S[z++]=56320|1023&p)}}return((V,W)=>{if(W<65534&&V.subarray&&p)return String.fromCharCode.apply(null,V.length===W?V:V.subarray(0,W));let N="";for(let p=0;p<W;p++)N+=String.fromCharCode(V[p]);return N})(S,z)},V.exports.utf8border=(V,p)=>{(p=p||V.length)>V.length&&(p=V.length);let N=p-1;for(;N>=0&&128===(192&V[N]);)N--;return N<0||0===N?p:N+W[V[N]]>p?N:p}},11059:V=>{"use strict";V.exports=(V,p,W,N)=>{let d=65535&V,E=V>>>16&65535,z=0;for(;0!==W;){z=W>2e3?2e3:W,W-=z;do{d=d+p[N++]|0,E=E+d|0}while(--z);d%=65521,E%=65521}return d|E<<16}},11074:V=>{"use strict";V.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11061:V=>{"use strict";const p=new Uint32Array((()=>{let V,p=[];for(var W=0;W<256;W++){V=W;for(var N=0;N<8;N++)V=1&V?3988292384^V>>>1:V>>>1;p[W]=V}return p})());V.exports=(V,W,N,d)=>{const E=p,z=d+N;V^=-1;for(let p=d;p<z;p++)V=V>>>8^E[255&(V^W[p])];return~V}},11044:(V,p,W)=>{"use strict";const{_tr_init:N,_tr_stored_block:d,_tr_flush_block:E,_tr_tally:z,_tr_align:S}=W(11050),Q=W(11059),J=W(11061),i=W(11068),{Z_NO_FLUSH:l,Z_PARTIAL_FLUSH:j,Z_FULL_FLUSH:k,Z_FINISH:u,Z_BLOCK:f,Z_OK:O,Z_STREAM_END:U,Z_STREAM_ERROR:F,Z_DATA_ERROR:C,Z_BUF_ERROR:A,Z_DEFAULT_COMPRESSION:v,Z_FILTERED:t,Z_HUFFMAN_ONLY:e,Z_RLE:Z,Z_FIXED:o,Z_DEFAULT_STRATEGY:K,Z_UNKNOWN:h,Z_DEFLATED:L}=W(11074),x=258,T=262,P=103,b=113,s=666,G=(V,p)=>(V.msg=i[p],p),R=V=>(V<<1)-(V>4?9:0),X=V=>{let p=V.length;for(;--p>=0;)V[p]=0};let r=(V,p,W)=>(p<<V.hash_shift^W)&V.hash_mask;const B=V=>{const p=V.state;let W=p.pending;W>V.avail_out&&(W=V.avail_out),0!==W&&(V.output.set(p.pending_buf.subarray(p.pending_out,p.pending_out+W),V.next_out),V.next_out+=W,p.pending_out+=W,V.total_out+=W,V.avail_out-=W,p.pending-=W,0===p.pending&&(p.pending_out=0))},Y=(V,p)=>{E(V,V.block_start>=0?V.block_start:-1,V.strstart-V.block_start,p),V.block_start=V.strstart,B(V.strm)},I=(V,p)=>{V.pending_buf[V.pending++]=p},c=(V,p)=>{V.pending_buf[V.pending++]=p>>>8&255,V.pending_buf[V.pending++]=255&p},q=(V,p,W,N)=>{let d=V.avail_in;return d>N&&(d=N),0===d?0:(V.avail_in-=d,p.set(V.input.subarray(V.next_in,V.next_in+d),W),1===V.state.wrap?V.adler=Q(V.adler,p,d,W):2===V.state.wrap&&(V.adler=J(V.adler,p,d,W)),V.next_in+=d,V.total_in+=d,d)},g=(V,p)=>{let W,N,d=V.max_chain_length,E=V.strstart,z=V.prev_length,S=V.nice_match;const Q=V.strstart>V.w_size-T?V.strstart-(V.w_size-T):0,J=V.window,i=V.w_mask,l=V.prev,j=V.strstart+x;let k=J[E+z-1],u=J[E+z];V.prev_length>=V.good_match&&(d>>=2),S>V.lookahead&&(S=V.lookahead);do{if(W=p,J[W+z]===u&&J[W+z-1]===k&&J[W]===J[E]&&J[++W]===J[E+1]){E+=2,W++;do{}while(J[++E]===J[++W]&&J[++E]===J[++W]&&J[++E]===J[++W]&&J[++E]===J[++W]&&J[++E]===J[++W]&&J[++E]===J[++W]&&J[++E]===J[++W]&&J[++E]===J[++W]&&E<j);if(N=x-(j-E),E=j-x,N>z){if(V.match_start=p,z=N,N>=S)break;k=J[E+z-1],u=J[E+z]}}}while((p=l[p&i])>Q&&0!==--d);return z<=V.lookahead?z:V.lookahead},D=V=>{const p=V.w_size;let W,N,d,E,z;do{if(E=V.window_size-V.lookahead-V.strstart,V.strstart>=p+(p-T)){V.window.set(V.window.subarray(p,p+p),0),V.match_start-=p,V.strstart-=p,V.block_start-=p,N=V.hash_size,W=N;do{d=V.head[--W],V.head[W]=d>=p?d-p:0}while(--N);N=p,W=N;do{d=V.prev[--W],V.prev[W]=d>=p?d-p:0}while(--N);E+=p}if(0===V.strm.avail_in)break;if(N=q(V.strm,V.window,V.strstart+V.lookahead,E),V.lookahead+=N,V.lookahead+V.insert>=3)for(z=V.strstart-V.insert,V.ins_h=V.window[z],V.ins_h=r(V,V.ins_h,V.window[z+1]);V.insert&&(V.ins_h=r(V,V.ins_h,V.window[z+3-1]),V.prev[z&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=z,z++,V.insert--,!(V.lookahead+V.insert<3)););}while(V.lookahead<T&&0!==V.strm.avail_in)},H=(V,p)=>{let W,N;for(;;){if(V.lookahead<T){if(D(V),V.lookahead<T&&p===l)return 1;if(0===V.lookahead)break}if(W=0,V.lookahead>=3&&(V.ins_h=r(V,V.ins_h,V.window[V.strstart+3-1]),W=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart),0!==W&&V.strstart-W<=V.w_size-T&&(V.match_length=g(V,W)),V.match_length>=3)if(N=z(V,V.strstart-V.match_start,V.match_length-3),V.lookahead-=V.match_length,V.match_length<=V.max_lazy_match&&V.lookahead>=3){V.match_length--;do{V.strstart++,V.ins_h=r(V,V.ins_h,V.window[V.strstart+3-1]),W=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart}while(0!==--V.match_length);V.strstart++}else V.strstart+=V.match_length,V.match_length=0,V.ins_h=V.window[V.strstart],V.ins_h=r(V,V.ins_h,V.window[V.strstart+1]);else N=z(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++;if(N&&(Y(V,!1),0===V.strm.avail_out))return 1}return V.insert=V.strstart<2?V.strstart:2,p===u?(Y(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(Y(V,!1),0===V.strm.avail_out)?1:2},m=(V,p)=>{let W,N,d;for(;;){if(V.lookahead<T){if(D(V),V.lookahead<T&&p===l)return 1;if(0===V.lookahead)break}if(W=0,V.lookahead>=3&&(V.ins_h=r(V,V.ins_h,V.window[V.strstart+3-1]),W=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart),V.prev_length=V.match_length,V.prev_match=V.match_start,V.match_length=2,0!==W&&V.prev_length<V.max_lazy_match&&V.strstart-W<=V.w_size-T&&(V.match_length=g(V,W),V.match_length<=5&&(V.strategy===t||3===V.match_length&&V.strstart-V.match_start>4096)&&(V.match_length=2)),V.prev_length>=3&&V.match_length<=V.prev_length){d=V.strstart+V.lookahead-3,N=z(V,V.strstart-1-V.prev_match,V.prev_length-3),V.lookahead-=V.prev_length-1,V.prev_length-=2;do{++V.strstart<=d&&(V.ins_h=r(V,V.ins_h,V.window[V.strstart+3-1]),W=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart)}while(0!==--V.prev_length);if(V.match_available=0,V.match_length=2,V.strstart++,N&&(Y(V,!1),0===V.strm.avail_out))return 1}else if(V.match_available){if(N=z(V,0,V.window[V.strstart-1]),N&&Y(V,!1),V.strstart++,V.lookahead--,0===V.strm.avail_out)return 1}else V.match_available=1,V.strstart++,V.lookahead--}return V.match_available&&(N=z(V,0,V.window[V.strstart-1]),V.match_available=0),V.insert=V.strstart<2?V.strstart:2,p===u?(Y(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(Y(V,!1),0===V.strm.avail_out)?1:2};function M(V,p,W,N,d){this.good_length=V,this.max_lazy=p,this.nice_length=W,this.max_chain=N,this.func=d}const a=[new M(0,0,0,0,((V,p)=>{let W=65535;for(W>V.pending_buf_size-5&&(W=V.pending_buf_size-5);;){if(V.lookahead<=1){if(D(V),0===V.lookahead&&p===l)return 1;if(0===V.lookahead)break}V.strstart+=V.lookahead,V.lookahead=0;const N=V.block_start+W;if((0===V.strstart||V.strstart>=N)&&(V.lookahead=V.strstart-N,V.strstart=N,Y(V,!1),0===V.strm.avail_out))return 1;if(V.strstart-V.block_start>=V.w_size-T&&(Y(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,p===u?(Y(V,!0),0===V.strm.avail_out?3:4):(V.strstart>V.block_start&&(Y(V,!1),V.strm.avail_out),1)})),new M(4,4,8,4,H),new M(4,5,16,8,H),new M(4,6,32,32,H),new M(4,4,16,16,m),new M(8,16,32,32,m),new M(8,16,128,128,m),new M(8,32,128,256,m),new M(32,128,258,1024,m),new M(32,258,258,4096,m)];function y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=L,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),X(this.dyn_ltree),X(this.dyn_dtree),X(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),X(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),X(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const n=V=>{if(!V||!V.state)return G(V,F);V.total_in=V.total_out=0,V.data_type=h;const p=V.state;return p.pending=0,p.pending_out=0,p.wrap<0&&(p.wrap=-p.wrap),p.status=p.wrap?42:b,V.adler=2===p.wrap?0:1,p.last_flush=l,N(p),O},w=V=>{const p=n(V);var W;return p===O&&((W=V.state).window_size=2*W.w_size,X(W.head),W.max_lazy_match=a[W.level].max_lazy,W.good_match=a[W.level].good_length,W.nice_match=a[W.level].nice_length,W.max_chain_length=a[W.level].max_chain,W.strstart=0,W.block_start=0,W.lookahead=0,W.insert=0,W.match_length=W.prev_length=2,W.match_available=0,W.ins_h=0),p},VV=(V,p,W,N,d,E)=>{if(!V)return F;let z=1;if(p===v&&(p=6),N<0?(z=0,N=-N):N>15&&(z=2,N-=16),d<1||d>9||W!==L||N<8||N>15||p<0||p>9||E<0||E>o)return G(V,F);8===N&&(N=9);const S=new y;return V.state=S,S.strm=V,S.wrap=z,S.gzhead=null,S.w_bits=N,S.w_size=1<<S.w_bits,S.w_mask=S.w_size-1,S.hash_bits=d+7,S.hash_size=1<<S.hash_bits,S.hash_mask=S.hash_size-1,S.hash_shift=~~((S.hash_bits+3-1)/3),S.window=new Uint8Array(2*S.w_size),S.head=new Uint16Array(S.hash_size),S.prev=new Uint16Array(S.w_size),S.lit_bufsize=1<<d+6,S.pending_buf_size=4*S.lit_bufsize,S.pending_buf=new Uint8Array(S.pending_buf_size),S.d_buf=1*S.lit_bufsize,S.l_buf=3*S.lit_bufsize,S.level=p,S.strategy=E,S.method=W,w(V)};V.exports.deflateInit=(V,p)=>VV(V,p,L,15,8,K),V.exports.deflateInit2=VV,V.exports.deflateReset=w,V.exports.deflateResetKeep=n,V.exports.deflateSetHeader=(V,p)=>V&&V.state?2!==V.state.wrap?F:(V.state.gzhead=p,O):F,V.exports.deflate=(V,p)=>{let W,N;if(!V||!V.state||p>f||p<0)return V?G(V,F):F;const E=V.state;if(!V.output||!V.input&&0!==V.avail_in||E.status===s&&p!==u)return G(V,0===V.avail_out?A:F);E.strm=V;const Q=E.last_flush;if(E.last_flush=p,42===E.status)if(2===E.wrap)V.adler=0,I(E,31),I(E,139),I(E,8),E.gzhead?(I(E,(E.gzhead.text?1:0)+(E.gzhead.hcrc?2:0)+(E.gzhead.extra?4:0)+(E.gzhead.name?8:0)+(E.gzhead.comment?16:0)),I(E,255&E.gzhead.time),I(E,E.gzhead.time>>8&255),I(E,E.gzhead.time>>16&255),I(E,E.gzhead.time>>24&255),I(E,9===E.level?2:E.strategy>=e||E.level<2?4:0),I(E,255&E.gzhead.os),E.gzhead.extra&&E.gzhead.extra.length&&(I(E,255&E.gzhead.extra.length),I(E,E.gzhead.extra.length>>8&255)),E.gzhead.hcrc&&(V.adler=J(V.adler,E.pending_buf,E.pending,0)),E.gzindex=0,E.status=69):(I(E,0),I(E,0),I(E,0),I(E,0),I(E,0),I(E,9===E.level?2:E.strategy>=e||E.level<2?4:0),I(E,3),E.status=b);else{let p=L+(E.w_bits-8<<4)<<8,W=-1;W=E.strategy>=e||E.level<2?0:E.level<6?1:6===E.level?2:3,p|=W<<6,0!==E.strstart&&(p|=32),p+=31-p%31,E.status=b,c(E,p),0!==E.strstart&&(c(E,V.adler>>>16),c(E,65535&V.adler)),V.adler=1}if(69===E.status)if(E.gzhead.extra){for(W=E.pending;E.gzindex<(65535&E.gzhead.extra.length)&&(E.pending!==E.pending_buf_size||(E.gzhead.hcrc&&E.pending>W&&(V.adler=J(V.adler,E.pending_buf,E.pending-W,W)),B(V),W=E.pending,E.pending!==E.pending_buf_size));)I(E,255&E.gzhead.extra[E.gzindex]),E.gzindex++;E.gzhead.hcrc&&E.pending>W&&(V.adler=J(V.adler,E.pending_buf,E.pending-W,W)),E.gzindex===E.gzhead.extra.length&&(E.gzindex=0,E.status=73)}else E.status=73;if(73===E.status)if(E.gzhead.name){W=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>W&&(V.adler=J(V.adler,E.pending_buf,E.pending-W,W)),B(V),W=E.pending,E.pending===E.pending_buf_size)){N=1;break}N=E.gzindex<E.gzhead.name.length?255&E.gzhead.name.charCodeAt(E.gzindex++):0,I(E,N)}while(0!==N);E.gzhead.hcrc&&E.pending>W&&(V.adler=J(V.adler,E.pending_buf,E.pending-W,W)),0===N&&(E.gzindex=0,E.status=91)}else E.status=91;if(91===E.status)if(E.gzhead.comment){W=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>W&&(V.adler=J(V.adler,E.pending_buf,E.pending-W,W)),B(V),W=E.pending,E.pending===E.pending_buf_size)){N=1;break}N=E.gzindex<E.gzhead.comment.length?255&E.gzhead.comment.charCodeAt(E.gzindex++):0,I(E,N)}while(0!==N);E.gzhead.hcrc&&E.pending>W&&(V.adler=J(V.adler,E.pending_buf,E.pending-W,W)),0===N&&(E.status=P)}else E.status=P;if(E.status===P&&(E.gzhead.hcrc?(E.pending+2>E.pending_buf_size&&B(V),E.pending+2<=E.pending_buf_size&&(I(E,255&V.adler),I(E,V.adler>>8&255),V.adler=0,E.status=b)):E.status=b),0!==E.pending){if(B(V),0===V.avail_out)return E.last_flush=-1,O}else if(0===V.avail_in&&R(p)<=R(Q)&&p!==u)return G(V,A);if(E.status===s&&0!==V.avail_in)return G(V,A);if(0!==V.avail_in||0!==E.lookahead||p!==l&&E.status!==s){let W=E.strategy===e?((V,p)=>{let W;for(;;){if(0===V.lookahead&&(D(V),0===V.lookahead)){if(p===l)return 1;break}if(V.match_length=0,W=z(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++,W&&(Y(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,p===u?(Y(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(Y(V,!1),0===V.strm.avail_out)?1:2})(E,p):E.strategy===Z?((V,p)=>{let W,N,d,E;const S=V.window;for(;;){if(V.lookahead<=x){if(D(V),V.lookahead<=x&&p===l)return 1;if(0===V.lookahead)break}if(V.match_length=0,V.lookahead>=3&&V.strstart>0&&(d=V.strstart-1,N=S[d],N===S[++d]&&N===S[++d]&&N===S[++d])){E=V.strstart+x;do{}while(N===S[++d]&&N===S[++d]&&N===S[++d]&&N===S[++d]&&N===S[++d]&&N===S[++d]&&N===S[++d]&&N===S[++d]&&d<E);V.match_length=x-(E-d),V.match_length>V.lookahead&&(V.match_length=V.lookahead)}if(V.match_length>=3?(W=z(V,1,V.match_length-3),V.lookahead-=V.match_length,V.strstart+=V.match_length,V.match_length=0):(W=z(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++),W&&(Y(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,p===u?(Y(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(Y(V,!1),0===V.strm.avail_out)?1:2})(E,p):a[E.level].func(E,p);if(3!==W&&4!==W||(E.status=s),1===W||3===W)return 0===V.avail_out&&(E.last_flush=-1),O;if(2===W&&(p===j?S(E):p!==f&&(d(E,0,0,!1),p===k&&(X(E.head),0===E.lookahead&&(E.strstart=0,E.block_start=0,E.insert=0))),B(V),0===V.avail_out))return E.last_flush=-1,O}return p!==u?O:E.wrap<=0?U:(2===E.wrap?(I(E,255&V.adler),I(E,V.adler>>8&255),I(E,V.adler>>16&255),I(E,V.adler>>24&255),I(E,255&V.total_in),I(E,V.total_in>>8&255),I(E,V.total_in>>16&255),I(E,V.total_in>>24&255)):(c(E,V.adler>>>16),c(E,65535&V.adler)),B(V),E.wrap>0&&(E.wrap=-E.wrap),0!==E.pending?O:U)},V.exports.deflateEnd=V=>{if(!V||!V.state)return F;const p=V.state.status;return 42!==p&&69!==p&&73!==p&&91!==p&&p!==P&&p!==b&&p!==s?G(V,F):(V.state=null,p===b?G(V,C):O)},V.exports.deflateSetDictionary=(V,p)=>{let W=p.length;if(!V||!V.state)return F;const N=V.state,d=N.wrap;if(2===d||1===d&&42!==N.status||N.lookahead)return F;if(1===d&&(V.adler=Q(V.adler,p,W,0)),N.wrap=0,W>=N.w_size){0===d&&(X(N.head),N.strstart=0,N.block_start=0,N.insert=0);let V=new Uint8Array(N.w_size);V.set(p.subarray(W-N.w_size,W),0),p=V,W=N.w_size}const E=V.avail_in,z=V.next_in,S=V.input;for(V.avail_in=W,V.next_in=0,V.input=p,D(N);N.lookahead>=3;){let V=N.strstart,p=N.lookahead-2;do{N.ins_h=r(N,N.ins_h,N.window[V+3-1]),N.prev[V&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=V,V++}while(--p);N.strstart=V,N.lookahead=2,D(N)}return N.strstart+=N.lookahead,N.block_start=N.strstart,N.insert=N.lookahead,N.lookahead=0,N.match_length=N.prev_length=2,N.match_available=0,V.next_in=z,V.input=S,V.avail_in=E,N.wrap=d,O},V.exports.deflateInfo="pako deflate (from Nodeca project)"},11125:V=>{"use strict";V.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11107:V=>{"use strict";V.exports=function(V,p){let W,N,d,E,z,S,Q,J,i,l,j,k,u,f,O,U,F,C,A,v,t,e,Z,o;const K=V.state;W=V.next_in,Z=V.input,N=W+(V.avail_in-5),d=V.next_out,o=V.output,E=d-(p-V.avail_out),z=d+(V.avail_out-257),S=K.dmax,Q=K.wsize,J=K.whave,i=K.wnext,l=K.window,j=K.hold,k=K.bits,u=K.lencode,f=K.distcode,O=(1<<K.lenbits)-1,U=(1<<K.distbits)-1;V:do{k<15&&(j+=Z[W++]<<k,k+=8,j+=Z[W++]<<k,k+=8),F=u[j&O];p:for(;;){if(C=F>>>24,j>>>=C,k-=C,C=F>>>16&255,0===C)o[d++]=65535&F;else{if(!(16&C)){if(0===(64&C)){F=u[(65535&F)+(j&(1<<C)-1)];continue p}if(32&C){K.mode=12;break V}V.msg="invalid literal/length code",K.mode=30;break V}A=65535&F,C&=15,C&&(k<C&&(j+=Z[W++]<<k,k+=8),A+=j&(1<<C)-1,j>>>=C,k-=C),k<15&&(j+=Z[W++]<<k,k+=8,j+=Z[W++]<<k,k+=8),F=f[j&U];W:for(;;){if(C=F>>>24,j>>>=C,k-=C,C=F>>>16&255,!(16&C)){if(0===(64&C)){F=f[(65535&F)+(j&(1<<C)-1)];continue W}V.msg="invalid distance code",K.mode=30;break V}if(v=65535&F,C&=15,k<C&&(j+=Z[W++]<<k,k+=8,k<C&&(j+=Z[W++]<<k,k+=8)),v+=j&(1<<C)-1,v>S){V.msg="invalid distance too far back",K.mode=30;break V}if(j>>>=C,k-=C,C=d-E,v>C){if(C=v-C,C>J&&K.sane){V.msg="invalid distance too far back",K.mode=30;break V}if(t=0,e=l,0===i){if(t+=Q-C,C<A){A-=C;do{o[d++]=l[t++]}while(--C);t=d-v,e=o}}else if(i<C){if(t+=Q+i-C,C-=i,C<A){A-=C;do{o[d++]=l[t++]}while(--C);if(t=0,i<A){C=i,A-=C;do{o[d++]=l[t++]}while(--C);t=d-v,e=o}}}else if(t+=i-C,C<A){A-=C;do{o[d++]=l[t++]}while(--C);t=d-v,e=o}for(;A>2;)o[d++]=e[t++],o[d++]=e[t++],o[d++]=e[t++],A-=3;A&&(o[d++]=e[t++],A>1&&(o[d++]=e[t++]))}else{t=d-v;do{o[d++]=o[t++],o[d++]=o[t++],o[d++]=o[t++],A-=3}while(A>2);A&&(o[d++]=o[t++],A>1&&(o[d++]=o[t++]))}break}}break}}while(W<N&&d<z);A=k>>3,W-=A,k-=A<<3,j&=(1<<k)-1,V.next_in=W,V.next_out=d,V.avail_in=W<N?N-W+5:5-(W-N),V.avail_out=d<z?z-d+257:257-(d-z),K.hold=j,K.bits=k}},11102:(V,p,W)=>{"use strict";const N=W(11059),d=W(11061),E=W(11107),z=W(11116),{Z_FINISH:S,Z_BLOCK:Q,Z_TREES:J,Z_OK:i,Z_STREAM_END:l,Z_NEED_DICT:j,Z_STREAM_ERROR:k,Z_DATA_ERROR:u,Z_MEM_ERROR:f,Z_BUF_ERROR:O,Z_DEFLATED:U}=W(11074),F=12,C=30,A=V=>(V>>>24&255)+(V>>>8&65280)+((65280&V)<<8)+((255&V)<<24);function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const t=V=>{if(!V||!V.state)return k;const p=V.state;return V.total_in=V.total_out=p.total=0,V.msg="",p.wrap&&(V.adler=1&p.wrap),p.mode=1,p.last=0,p.havedict=0,p.dmax=32768,p.head=null,p.hold=0,p.bits=0,p.lencode=p.lendyn=new Int32Array(852),p.distcode=p.distdyn=new Int32Array(592),p.sane=1,p.back=-1,i},e=V=>{if(!V||!V.state)return k;const p=V.state;return p.wsize=0,p.whave=0,p.wnext=0,t(V)},Z=(V,p)=>{let W;if(!V||!V.state)return k;const N=V.state;return p<0?(W=0,p=-p):(W=1+(p>>4),p<48&&(p&=15)),p&&(p<8||p>15)?k:(null!==N.window&&N.wbits!==p&&(N.window=null),N.wrap=W,N.wbits=p,e(V))},o=(V,p)=>{if(!V)return k;const W=new v;V.state=W,W.window=null;const N=Z(V,p);return N!==i&&(V.state=null),N};let K,h,L=!0;const x=V=>{if(L){K=new Int32Array(512),h=new Int32Array(32);let p=0;for(;p<144;)V.lens[p++]=8;for(;p<256;)V.lens[p++]=9;for(;p<280;)V.lens[p++]=7;for(;p<288;)V.lens[p++]=8;for(z(1,V.lens,0,288,K,0,V.work,{bits:9}),p=0;p<32;)V.lens[p++]=5;z(2,V.lens,0,32,h,0,V.work,{bits:5}),L=!1}V.lencode=K,V.lenbits=9,V.distcode=h,V.distbits=5},T=(V,p,W,N)=>{let d;const E=V.state;return null===E.window&&(E.wsize=1<<E.wbits,E.wnext=0,E.whave=0,E.window=new Uint8Array(E.wsize)),N>=E.wsize?(E.window.set(p.subarray(W-E.wsize,W),0),E.wnext=0,E.whave=E.wsize):(d=E.wsize-E.wnext,d>N&&(d=N),E.window.set(p.subarray(W-N,W-N+d),E.wnext),(N-=d)?(E.window.set(p.subarray(W-N,W),0),E.wnext=N,E.whave=E.wsize):(E.wnext+=d,E.wnext===E.wsize&&(E.wnext=0),E.whave<E.wsize&&(E.whave+=d))),0};V.exports.inflateReset=e,V.exports.inflateReset2=Z,V.exports.inflateResetKeep=t,V.exports.inflateInit=V=>o(V,15),V.exports.inflateInit2=o,V.exports.inflate=(V,p)=>{let W,v,t,e,Z,o,K,h,L,P,b,s,G,R,X,r,B,Y,I,c,q,g,D=0;const H=new Uint8Array(4);let m,M;const a=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!V||!V.state||!V.output||!V.input&&0!==V.avail_in)return k;W=V.state,W.mode===F&&(W.mode=13),Z=V.next_out,t=V.output,K=V.avail_out,e=V.next_in,v=V.input,o=V.avail_in,h=W.hold,L=W.bits,P=o,b=K,g=i;V:for(;;)switch(W.mode){case 1:if(0===W.wrap){W.mode=13;break}for(;L<16;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}if(2&W.wrap&&35615===h){W.check=0,H[0]=255&h,H[1]=h>>>8&255,W.check=d(W.check,H,2,0),h=0,L=0,W.mode=2;break}if(W.flags=0,W.head&&(W.head.done=!1),!(1&W.wrap)||(((255&h)<<8)+(h>>8))%31){V.msg="incorrect header check",W.mode=C;break}if((15&h)!==U){V.msg="unknown compression method",W.mode=C;break}if(h>>>=4,L-=4,q=8+(15&h),0===W.wbits)W.wbits=q;else if(q>W.wbits){V.msg="invalid window size",W.mode=C;break}W.dmax=1<<W.wbits,V.adler=W.check=1,W.mode=512&h?10:F,h=0,L=0;break;case 2:for(;L<16;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}if(W.flags=h,(255&W.flags)!==U){V.msg="unknown compression method",W.mode=C;break}if(57344&W.flags){V.msg="unknown header flags set",W.mode=C;break}W.head&&(W.head.text=h>>8&1),512&W.flags&&(H[0]=255&h,H[1]=h>>>8&255,W.check=d(W.check,H,2,0)),h=0,L=0,W.mode=3;case 3:for(;L<32;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}W.head&&(W.head.time=h),512&W.flags&&(H[0]=255&h,H[1]=h>>>8&255,H[2]=h>>>16&255,H[3]=h>>>24&255,W.check=d(W.check,H,4,0)),h=0,L=0,W.mode=4;case 4:for(;L<16;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}W.head&&(W.head.xflags=255&h,W.head.os=h>>8),512&W.flags&&(H[0]=255&h,H[1]=h>>>8&255,W.check=d(W.check,H,2,0)),h=0,L=0,W.mode=5;case 5:if(1024&W.flags){for(;L<16;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}W.length=h,W.head&&(W.head.extra_len=h),512&W.flags&&(H[0]=255&h,H[1]=h>>>8&255,W.check=d(W.check,H,2,0)),h=0,L=0}else W.head&&(W.head.extra=null);W.mode=6;case 6:if(1024&W.flags&&(s=W.length,s>o&&(s=o),s&&(W.head&&(q=W.head.extra_len-W.length,W.head.extra||(W.head.extra=new Uint8Array(W.head.extra_len)),W.head.extra.set(v.subarray(e,e+s),q)),512&W.flags&&(W.check=d(W.check,v,s,e)),o-=s,e+=s,W.length-=s),W.length))break V;W.length=0,W.mode=7;case 7:if(2048&W.flags){if(0===o)break V;s=0;do{q=v[e+s++],W.head&&q&&W.length<65536&&(W.head.name+=String.fromCharCode(q))}while(q&&s<o);if(512&W.flags&&(W.check=d(W.check,v,s,e)),o-=s,e+=s,q)break V}else W.head&&(W.head.name=null);W.length=0,W.mode=8;case 8:if(4096&W.flags){if(0===o)break V;s=0;do{q=v[e+s++],W.head&&q&&W.length<65536&&(W.head.comment+=String.fromCharCode(q))}while(q&&s<o);if(512&W.flags&&(W.check=d(W.check,v,s,e)),o-=s,e+=s,q)break V}else W.head&&(W.head.comment=null);W.mode=9;case 9:if(512&W.flags){for(;L<16;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}if(h!==(65535&W.check)){V.msg="header crc mismatch",W.mode=C;break}h=0,L=0}W.head&&(W.head.hcrc=W.flags>>9&1,W.head.done=!0),V.adler=W.check=0,W.mode=F;break;case 10:for(;L<32;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}V.adler=W.check=A(h),h=0,L=0,W.mode=11;case 11:if(0===W.havedict)return V.next_out=Z,V.avail_out=K,V.next_in=e,V.avail_in=o,W.hold=h,W.bits=L,j;V.adler=W.check=1,W.mode=F;case F:if(p===Q||p===J)break V;case 13:if(W.last){h>>>=7&L,L-=7&L,W.mode=27;break}for(;L<3;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}switch(W.last=1&h,h>>>=1,L-=1,3&h){case 0:W.mode=14;break;case 1:if(x(W),W.mode=20,p===J){h>>>=2,L-=2;break V}break;case 2:W.mode=17;break;case 3:V.msg="invalid block type",W.mode=C}h>>>=2,L-=2;break;case 14:for(h>>>=7&L,L-=7&L;L<32;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}if((65535&h)!==(h>>>16^65535)){V.msg="invalid stored block lengths",W.mode=C;break}if(W.length=65535&h,h=0,L=0,W.mode=15,p===J)break V;case 15:W.mode=16;case 16:if(s=W.length,s){if(s>o&&(s=o),s>K&&(s=K),0===s)break V;t.set(v.subarray(e,e+s),Z),o-=s,e+=s,K-=s,Z+=s,W.length-=s;break}W.mode=F;break;case 17:for(;L<14;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}if(W.nlen=257+(31&h),h>>>=5,L-=5,W.ndist=1+(31&h),h>>>=5,L-=5,W.ncode=4+(15&h),h>>>=4,L-=4,W.nlen>286||W.ndist>30){V.msg="too many length or distance symbols",W.mode=C;break}W.have=0,W.mode=18;case 18:for(;W.have<W.ncode;){for(;L<3;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}W.lens[a[W.have++]]=7&h,h>>>=3,L-=3}for(;W.have<19;)W.lens[a[W.have++]]=0;if(W.lencode=W.lendyn,W.lenbits=7,m={bits:W.lenbits},g=z(0,W.lens,0,19,W.lencode,0,W.work,m),W.lenbits=m.bits,g){V.msg="invalid code lengths set",W.mode=C;break}W.have=0,W.mode=19;case 19:for(;W.have<W.nlen+W.ndist;){for(;D=W.lencode[h&(1<<W.lenbits)-1],X=D>>>24,r=D>>>16&255,B=65535&D,!(X<=L);){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}if(B<16)h>>>=X,L-=X,W.lens[W.have++]=B;else{if(16===B){for(M=X+2;L<M;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}if(h>>>=X,L-=X,0===W.have){V.msg="invalid bit length repeat",W.mode=C;break}q=W.lens[W.have-1],s=3+(3&h),h>>>=2,L-=2}else if(17===B){for(M=X+3;L<M;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}h>>>=X,L-=X,q=0,s=3+(7&h),h>>>=3,L-=3}else{for(M=X+7;L<M;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}h>>>=X,L-=X,q=0,s=11+(127&h),h>>>=7,L-=7}if(W.have+s>W.nlen+W.ndist){V.msg="invalid bit length repeat",W.mode=C;break}for(;s--;)W.lens[W.have++]=q}}if(W.mode===C)break;if(0===W.lens[256]){V.msg="invalid code -- missing end-of-block",W.mode=C;break}if(W.lenbits=9,m={bits:W.lenbits},g=z(1,W.lens,0,W.nlen,W.lencode,0,W.work,m),W.lenbits=m.bits,g){V.msg="invalid literal/lengths set",W.mode=C;break}if(W.distbits=6,W.distcode=W.distdyn,m={bits:W.distbits},g=z(2,W.lens,W.nlen,W.ndist,W.distcode,0,W.work,m),W.distbits=m.bits,g){V.msg="invalid distances set",W.mode=C;break}if(W.mode=20,p===J)break V;case 20:W.mode=21;case 21:if(o>=6&&K>=258){V.next_out=Z,V.avail_out=K,V.next_in=e,V.avail_in=o,W.hold=h,W.bits=L,E(V,b),Z=V.next_out,t=V.output,K=V.avail_out,e=V.next_in,v=V.input,o=V.avail_in,h=W.hold,L=W.bits,W.mode===F&&(W.back=-1);break}for(W.back=0;D=W.lencode[h&(1<<W.lenbits)-1],X=D>>>24,r=D>>>16&255,B=65535&D,!(X<=L);){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}if(r&&0===(240&r)){for(Y=X,I=r,c=B;D=W.lencode[c+((h&(1<<Y+I)-1)>>Y)],X=D>>>24,r=D>>>16&255,B=65535&D,!(Y+X<=L);){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}h>>>=Y,L-=Y,W.back+=Y}if(h>>>=X,L-=X,W.back+=X,W.length=B,0===r){W.mode=26;break}if(32&r){W.back=-1,W.mode=F;break}if(64&r){V.msg="invalid literal/length code",W.mode=C;break}W.extra=15&r,W.mode=22;case 22:if(W.extra){for(M=W.extra;L<M;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}W.length+=h&(1<<W.extra)-1,h>>>=W.extra,L-=W.extra,W.back+=W.extra}W.was=W.length,W.mode=23;case 23:for(;D=W.distcode[h&(1<<W.distbits)-1],X=D>>>24,r=D>>>16&255,B=65535&D,!(X<=L);){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}if(0===(240&r)){for(Y=X,I=r,c=B;D=W.distcode[c+((h&(1<<Y+I)-1)>>Y)],X=D>>>24,r=D>>>16&255,B=65535&D,!(Y+X<=L);){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}h>>>=Y,L-=Y,W.back+=Y}if(h>>>=X,L-=X,W.back+=X,64&r){V.msg="invalid distance code",W.mode=C;break}W.offset=B,W.extra=15&r,W.mode=24;case 24:if(W.extra){for(M=W.extra;L<M;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}W.offset+=h&(1<<W.extra)-1,h>>>=W.extra,L-=W.extra,W.back+=W.extra}if(W.offset>W.dmax){V.msg="invalid distance too far back",W.mode=C;break}W.mode=25;case 25:if(0===K)break V;if(s=b-K,W.offset>s){if(s=W.offset-s,s>W.whave&&W.sane){V.msg="invalid distance too far back",W.mode=C;break}s>W.wnext?(s-=W.wnext,G=W.wsize-s):G=W.wnext-s,s>W.length&&(s=W.length),R=W.window}else R=t,G=Z-W.offset,s=W.length;s>K&&(s=K),K-=s,W.length-=s;do{t[Z++]=R[G++]}while(--s);0===W.length&&(W.mode=21);break;case 26:if(0===K)break V;t[Z++]=W.length,K--,W.mode=21;break;case 27:if(W.wrap){for(;L<32;){if(0===o)break V;o--,h|=v[e++]<<L,L+=8}if(b-=K,V.total_out+=b,W.total+=b,b&&(V.adler=W.check=W.flags?d(W.check,t,b,Z-b):N(W.check,t,b,Z-b)),b=K,(W.flags?h:A(h))!==W.check){V.msg="incorrect data check",W.mode=C;break}h=0,L=0}W.mode=28;case 28:if(W.wrap&&W.flags){for(;L<32;){if(0===o)break V;o--,h+=v[e++]<<L,L+=8}if(h!==(4294967295&W.total)){V.msg="incorrect length check",W.mode=C;break}h=0,L=0}W.mode=29;case 29:g=l;break V;case C:g=u;break V;case 31:return f;default:return k}return V.next_out=Z,V.avail_out=K,V.next_in=e,V.avail_in=o,W.hold=h,W.bits=L,(W.wsize||b!==V.avail_out&&W.mode<C&&(W.mode<27||p!==S))&&T(V,V.output,V.next_out,b-V.avail_out)?(W.mode=31,f):(P-=V.avail_in,b-=V.avail_out,V.total_in+=P,V.total_out+=b,W.total+=b,W.wrap&&b&&(V.adler=W.check=W.flags?d(W.check,t,b,V.next_out-b):N(W.check,t,b,V.next_out-b)),V.data_type=W.bits+(W.last?64:0)+(W.mode===F?128:0)+(20===W.mode||15===W.mode?256:0),(0===P&&0===b||p===S)&&g===i&&(g=O),g)},V.exports.inflateEnd=V=>{if(!V||!V.state)return k;let p=V.state;return p.window&&(p.window=null),V.state=null,i},V.exports.inflateGetHeader=(V,p)=>{if(!V||!V.state)return k;const W=V.state;return 0===(2&W.wrap)?k:(W.head=p,p.done=!1,i)},V.exports.inflateSetDictionary=(V,p)=>{const W=p.length;let d,E,z;return V&&V.state?(d=V.state,0!==d.wrap&&11!==d.mode?k:11===d.mode&&(E=1,E=N(E,p,W,0),E!==d.check)?u:(z=T(V,p,W,W),z?(d.mode=31,f):(d.havedict=1,i))):k},V.exports.inflateInfo="pako inflate (from Nodeca project)"},11116:V=>{"use strict";const p=15,W=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),N=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),d=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),E=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);V.exports=(V,z,S,Q,J,i,l,j)=>{const k=j.bits;let u,f,O,U,F,C,A=0,v=0,t=0,e=0,Z=0,o=0,K=0,h=0,L=0,x=0,T=null,P=0;const b=new Uint16Array(16),s=new Uint16Array(16);let G,R,X,r=null,B=0;for(A=0;A<=p;A++)b[A]=0;for(v=0;v<Q;v++)b[z[S+v]]++;for(Z=k,e=p;e>=1&&0===b[e];e--);if(Z>e&&(Z=e),0===e)return J[i++]=20971520,J[i++]=20971520,j.bits=1,0;for(t=1;t<e&&0===b[t];t++);for(Z<t&&(Z=t),h=1,A=1;A<=p;A++)if(h<<=1,h-=b[A],h<0)return-1;if(h>0&&(0===V||1!==e))return-1;for(s[1]=0,A=1;A<p;A++)s[A+1]=s[A]+b[A];for(v=0;v<Q;v++)0!==z[S+v]&&(l[s[z[S+v]]++]=v);if(0===V?(T=r=l,C=19):1===V?(T=W,P-=257,r=N,B-=257,C=256):(T=d,r=E,C=-1),x=0,v=0,A=t,F=i,o=Z,K=0,O=-1,L=1<<Z,U=L-1,1===V&&L>852||2===V&&L>592)return 1;for(;;){G=A-K,l[v]<C?(R=0,X=l[v]):l[v]>C?(R=r[B+l[v]],X=T[P+l[v]]):(R=96,X=0),u=1<<A-K,f=1<<o,t=f;do{f-=u,J[F+(x>>K)+f]=G<<24|R<<16|X}while(0!==f);for(u=1<<A-1;x&u;)u>>=1;if(0!==u?(x&=u-1,x+=u):x=0,v++,0===--b[A]){if(A===e)break;A=z[S+l[v]]}if(A>Z&&(x&U)!==O){for(0===K&&(K=Z),F+=t,o=A-K,h=1<<o;o+K<e&&(h-=b[o+K],!(h<=0));)o++,h<<=1;if(L+=1<<o,1===V&&L>852||2===V&&L>592)return 1;O=x&U,J[O]=Z<<24|o<<16|F-i}}return 0!==x&&(J[F+x]=A-K<<24|64<<16),j.bits=Z,0}},11068:V=>{"use strict";V.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11050:V=>{"use strict";function p(V){let p=V.length;for(;--p>=0;)V[p]=0}const W=256,N=286,d=30,E=15,z=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),S=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Q=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),J=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=new Array(576);p(i);const l=new Array(60);p(l);const j=new Array(512);p(j);const k=new Array(256);p(k);const u=new Array(29);p(u);const f=new Array(d);function O(V,p,W,N,d){this.static_tree=V,this.extra_bits=p,this.extra_base=W,this.elems=N,this.max_length=d,this.has_stree=V&&V.length}let U,F,C;function A(V,p){this.dyn_tree=V,this.max_code=0,this.stat_desc=p}p(f);const v=V=>V<256?j[V]:j[256+(V>>>7)],t=(V,p)=>{V.pending_buf[V.pending++]=255&p,V.pending_buf[V.pending++]=p>>>8&255},e=(V,p,W)=>{V.bi_valid>16-W?(V.bi_buf|=p<<V.bi_valid&65535,t(V,V.bi_buf),V.bi_buf=p>>16-V.bi_valid,V.bi_valid+=W-16):(V.bi_buf|=p<<V.bi_valid&65535,V.bi_valid+=W)},Z=(V,p,W)=>{e(V,W[2*p],W[2*p+1])},o=(V,p)=>{let W=0;do{W|=1&V,V>>>=1,W<<=1}while(--p>0);return W>>>1},K=(V,p,W)=>{const N=new Array(16);let d,z,S=0;for(d=1;d<=E;d++)N[d]=S=S+W[d-1]<<1;for(z=0;z<=p;z++){let p=V[2*z+1];0!==p&&(V[2*z]=o(N[p]++,p))}},h=V=>{let p;for(p=0;p<N;p++)V.dyn_ltree[2*p]=0;for(p=0;p<d;p++)V.dyn_dtree[2*p]=0;for(p=0;p<19;p++)V.bl_tree[2*p]=0;V.dyn_ltree[512]=1,V.opt_len=V.static_len=0,V.last_lit=V.matches=0},L=V=>{V.bi_valid>8?t(V,V.bi_buf):V.bi_valid>0&&(V.pending_buf[V.pending++]=V.bi_buf),V.bi_buf=0,V.bi_valid=0},x=(V,p,W,N)=>{const d=2*p,E=2*W;return V[d]<V[E]||V[d]===V[E]&&N[p]<=N[W]},T=(V,p,W)=>{const N=V.heap[W];let d=W<<1;for(;d<=V.heap_len&&(d<V.heap_len&&x(p,V.heap[d+1],V.heap[d],V.depth)&&d++,!x(p,N,V.heap[d],V.depth));)V.heap[W]=V.heap[d],W=d,d<<=1;V.heap[W]=N},P=(V,p,N)=>{let d,E,Q,J,i=0;if(0!==V.last_lit)do{d=V.pending_buf[V.d_buf+2*i]<<8|V.pending_buf[V.d_buf+2*i+1],E=V.pending_buf[V.l_buf+i],i++,0===d?Z(V,E,p):(Q=k[E],Z(V,Q+W+1,p),J=z[Q],0!==J&&(E-=u[Q],e(V,E,J)),d--,Q=v(d),Z(V,Q,N),J=S[Q],0!==J&&(d-=f[Q],e(V,d,J)))}while(i<V.last_lit);Z(V,256,p)},b=(V,p)=>{const W=p.dyn_tree,N=p.stat_desc.static_tree,d=p.stat_desc.has_stree,z=p.stat_desc.elems;let S,Q,J,i=-1;for(V.heap_len=0,V.heap_max=573,S=0;S<z;S++)0!==W[2*S]?(V.heap[++V.heap_len]=i=S,V.depth[S]=0):W[2*S+1]=0;for(;V.heap_len<2;)J=V.heap[++V.heap_len]=i<2?++i:0,W[2*J]=1,V.depth[J]=0,V.opt_len--,d&&(V.static_len-=N[2*J+1]);for(p.max_code=i,S=V.heap_len>>1;S>=1;S--)T(V,W,S);J=z;do{S=V.heap[1],V.heap[1]=V.heap[V.heap_len--],T(V,W,1),Q=V.heap[1],V.heap[--V.heap_max]=S,V.heap[--V.heap_max]=Q,W[2*J]=W[2*S]+W[2*Q],V.depth[J]=(V.depth[S]>=V.depth[Q]?V.depth[S]:V.depth[Q])+1,W[2*S+1]=W[2*Q+1]=J,V.heap[1]=J++,T(V,W,1)}while(V.heap_len>=2);V.heap[--V.heap_max]=V.heap[1],((V,p)=>{const W=p.dyn_tree,N=p.max_code,d=p.stat_desc.static_tree,z=p.stat_desc.has_stree,S=p.stat_desc.extra_bits,Q=p.stat_desc.extra_base,J=p.stat_desc.max_length;let i,l,j,k,u,f,O=0;for(k=0;k<=E;k++)V.bl_count[k]=0;for(W[2*V.heap[V.heap_max]+1]=0,i=V.heap_max+1;i<573;i++)l=V.heap[i],k=W[2*W[2*l+1]+1]+1,k>J&&(k=J,O++),W[2*l+1]=k,l>N||(V.bl_count[k]++,u=0,l>=Q&&(u=S[l-Q]),f=W[2*l],V.opt_len+=f*(k+u),z&&(V.static_len+=f*(d[2*l+1]+u)));if(0!==O){do{for(k=J-1;0===V.bl_count[k];)k--;V.bl_count[k]--,V.bl_count[k+1]+=2,V.bl_count[J]--,O-=2}while(O>0);for(k=J;0!==k;k--)for(l=V.bl_count[k];0!==l;)j=V.heap[--i],j>N||(W[2*j+1]!==k&&(V.opt_len+=(k-W[2*j+1])*W[2*j],W[2*j+1]=k),l--)}})(V,p),K(W,i,V.bl_count)},s=(V,p,W)=>{let N,d,E=-1,z=p[1],S=0,Q=7,J=4;for(0===z&&(Q=138,J=3),p[2*(W+1)+1]=65535,N=0;N<=W;N++)d=z,z=p[2*(N+1)+1],++S<Q&&d===z||(S<J?V.bl_tree[2*d]+=S:0!==d?(d!==E&&V.bl_tree[2*d]++,V.bl_tree[32]++):S<=10?V.bl_tree[34]++:V.bl_tree[36]++,S=0,E=d,0===z?(Q=138,J=3):d===z?(Q=6,J=3):(Q=7,J=4))},G=(V,p,W)=>{let N,d,E=-1,z=p[1],S=0,Q=7,J=4;for(0===z&&(Q=138,J=3),N=0;N<=W;N++)if(d=z,z=p[2*(N+1)+1],!(++S<Q&&d===z)){if(S<J)do{Z(V,d,V.bl_tree)}while(0!==--S);else 0!==d?(d!==E&&(Z(V,d,V.bl_tree),S--),Z(V,16,V.bl_tree),e(V,S-3,2)):S<=10?(Z(V,17,V.bl_tree),e(V,S-3,3)):(Z(V,18,V.bl_tree),e(V,S-11,7));S=0,E=d,0===z?(Q=138,J=3):d===z?(Q=6,J=3):(Q=7,J=4)}};let R=!1;const X=(V,p,W,N)=>{e(V,0+(N?1:0),3),((V,p,W,N)=>{L(V),N&&(t(V,W),t(V,~W)),V.pending_buf.set(V.window.subarray(p,p+W),V.pending),V.pending+=W})(V,p,W,!0)};V.exports._tr_init=V=>{R||((()=>{let V,p,W,J,A;const v=new Array(16);for(W=0,J=0;J<28;J++)for(u[J]=W,V=0;V<1<<z[J];V++)k[W++]=J;for(k[W-1]=J,A=0,J=0;J<16;J++)for(f[J]=A,V=0;V<1<<S[J];V++)j[A++]=J;for(A>>=7;J<d;J++)for(f[J]=A<<7,V=0;V<1<<S[J]-7;V++)j[256+A++]=J;for(p=0;p<=E;p++)v[p]=0;for(V=0;V<=143;)i[2*V+1]=8,V++,v[8]++;for(;V<=255;)i[2*V+1]=9,V++,v[9]++;for(;V<=279;)i[2*V+1]=7,V++,v[7]++;for(;V<=287;)i[2*V+1]=8,V++,v[8]++;for(K(i,287,v),V=0;V<d;V++)l[2*V+1]=5,l[2*V]=o(V,5);U=new O(i,z,257,N,E),F=new O(l,S,0,d,E),C=new O(new Array(0),Q,0,19,7)})(),R=!0),V.l_desc=new A(V.dyn_ltree,U),V.d_desc=new A(V.dyn_dtree,F),V.bl_desc=new A(V.bl_tree,C),V.bi_buf=0,V.bi_valid=0,h(V)},V.exports._tr_stored_block=X,V.exports._tr_flush_block=(V,p,N,d)=>{let E,z,S=0;V.level>0?(2===V.strm.data_type&&(V.strm.data_type=(V=>{let p,N=4093624447;for(p=0;p<=31;p++,N>>>=1)if(1&N&&0!==V.dyn_ltree[2*p])return 0;if(0!==V.dyn_ltree[18]||0!==V.dyn_ltree[20]||0!==V.dyn_ltree[26])return 1;for(p=32;p<W;p++)if(0!==V.dyn_ltree[2*p])return 1;return 0})(V)),b(V,V.l_desc),b(V,V.d_desc),S=(V=>{let p;for(s(V,V.dyn_ltree,V.l_desc.max_code),s(V,V.dyn_dtree,V.d_desc.max_code),b(V,V.bl_desc),p=18;p>=3&&0===V.bl_tree[2*J[p]+1];p--);return V.opt_len+=3*(p+1)+5+5+4,p})(V),E=V.opt_len+3+7>>>3,z=V.static_len+3+7>>>3,z<=E&&(E=z)):E=z=N+5,N+4<=E&&-1!==p?X(V,p,N,d):4===V.strategy||z===E?(e(V,2+(d?1:0),3),P(V,i,l)):(e(V,4+(d?1:0),3),((V,p,W,N)=>{let d;for(e(V,p-257,5),e(V,W-1,5),e(V,N-4,4),d=0;d<N;d++)e(V,V.bl_tree[2*J[d]+1],3);G(V,V.dyn_ltree,p-1),G(V,V.dyn_dtree,W-1)})(V,V.l_desc.max_code+1,V.d_desc.max_code+1,S+1),P(V,V.dyn_ltree,V.dyn_dtree)),h(V),d&&L(V)},V.exports._tr_tally=(V,p,N)=>(V.pending_buf[V.d_buf+2*V.last_lit]=p>>>8&255,V.pending_buf[V.d_buf+2*V.last_lit+1]=255&p,V.pending_buf[V.l_buf+V.last_lit]=255&N,V.last_lit++,0===p?V.dyn_ltree[2*N]++:(V.matches++,p--,V.dyn_ltree[2*(k[N]+W+1)]++,V.dyn_dtree[2*v(p)]++),V.last_lit===V.lit_bufsize-1),V.exports._tr_align=V=>{e(V,2,3),Z(V,256,i),(V=>{16===V.bi_valid?(t(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):V.bi_valid>=8&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)})(V)}},11088:V=>{"use strict";V.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12157:V=>{function p(V,p,W){for(var N=V.length,d=-1/0,E=1/0,z=0;z<N;z++){var S=(W[0][z]-V[z])/p[z],Q=(W[1][z]-V[z])/p[z];if(S>Q){var J=S;S=Q,Q=J}if(Q<d||S>E)return 1/0;S>d&&(d=S),Q<E&&(E=Q)}return d>E?1/0:d}V.exports=function(V,W,N,d){var E=p(W,N,d);if(E===1/0)V=null;else{V=V||[];for(var z=0;z<W.length;z++)V[z]=W[z]+N[z]*E}return V},V.exports.distance=p},12965:(V,p,W)=>{"use strict";W.d(p,{d:()=>z});var N=W(36);const d=N.useLayoutEffect;const E=function(V){var p=(0,N.useRef)(V);return d((function(){p.current=V})),p};var z=function(V){var p=E(V);(0,N.nb)((function(){var V=function(V){var W;if(null!=p.current&&(W=p.current(V)),V.defaultPrevented&&(V.returnValue=""),"string"===typeof W)return V.returnValue=W,W};return window.addEventListener("beforeunload",V),function(){window.removeEventListener("beforeunload",V)}}),[])}},12925:(V,p,W)=>{"use strict";var N=W(12931),d=Array.prototype.concat,E=Array.prototype.slice,z=V.exports=function(V){for(var p=[],W=0,z=V.length;W<z;W++){var S=V[W];N(S)?p=d.call(p,E.call(S)):p.push(S)}return p};z.wrap=function(V){return function(){return V(z(arguments))}}},12931:V=>{V.exports=function(V){return!(!V||"string"===typeof V)&&(V instanceof Array||Array.isArray(V)||V.length>=0&&(V.splice instanceof Function||Object.getOwnPropertyDescriptor(V,V.length-1)&&"String"!==V.constructor.name))}},10811:(V,p,W)=>{var N=W(10820);function d(V){for(var p,W,d=0,E=V.length,z=0;z<V.length;){for(p=V[z],W=0;z<E&&V[z]===p;)++z,++W;d+=N.log2(W)/7|0,d+=N.log2(p>>>0)/7|0,d+=2}return d}p.size=d,p.encode=function(V,p){p||(p=new Uint8Array(d(V)));for(var W,N,E=0,z=p.length,S=0;S<V.length;){for(W=V[S],N=0;S<V.length&&V[S]===W;)++S,++N;for(;E<z&&N>=128;)p[E++]=128+(127&N),N>>>=7;if(E>=z)throw new Error("RLE buffer overflow");for(p[E++]=N,W>>>=0;E<z&&W>=128;)p[E++]=128+(127&W),W>>>=7;if(E>=z)throw new Error("RLE buffer overflow");p[E++]=W}return p},p.decode=function(V,p){for(var W,N,d,E,z=p.length,S=V.length,Q=0,J=0;J<S;){for(W=0,N=0;J<S&&V[J]>=128;)W+=(127&V[J++])<<N,N+=7;if(W+=V[J++]<<N,J>=S)throw new Error("RLE buffer underrun");if(Q+W>z)throw new Error("Chunk buffer overflow");for(d=0,N=0;J<S&&V[J]>=128;)d+=(127&V[J++])<<N,N+=7;if(J>=S)throw new Error("RLE buffer underrun");for(d+=V[J++]<<N,E=0;E<W;++E)p[Q++]=d}return p}},10820:(V,p)=>{"use strict";function W(V){var p=32;return(V&=-V)&&p--,65535&V&&(p-=16),16711935&V&&(p-=8),252645135&V&&(p-=4),858993459&V&&(p-=2),1431655765&V&&(p-=1),p}p.INT_BITS=32,p.INT_MAX=2147483647,p.INT_MIN=-1<<31,p.sign=function(V){return(V>0)-(V<0)},p.abs=function(V){var p=V>>31;return(V^p)-p},p.min=function(V,p){return p^(V^p)&-(V<p)},p.max=function(V,p){return V^(V^p)&-(V<p)},p.isPow2=function(V){return!(V&V-1)&&!!V},p.log2=function(V){var p,W;return p=(V>65535)<<4,p|=W=((V>>>=p)>255)<<3,p|=W=((V>>>=W)>15)<<2,(p|=W=((V>>>=W)>3)<<1)|(V>>>=W)>>1},p.log10=function(V){return V>=1e9?9:V>=1e8?8:V>=1e7?7:V>=1e6?6:V>=1e5?5:V>=1e4?4:V>=1e3?3:V>=100?2:V>=10?1:0},p.popCount=function(V){return 16843009*((V=(858993459&(V-=V>>>1&1431655765))+(V>>>2&858993459))+(V>>>4)&252645135)>>>24},p.countTrailingZeros=W,p.nextPow2=function(V){return V+=0===V,--V,V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)+1},p.prevPow2=function(V){return V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)-(V>>>1)},p.parity=function(V){return V^=V>>>16,V^=V>>>8,V^=V>>>4,27030>>>(V&=15)&1};var N=new Array(256);!function(V){for(var p=0;p<256;++p){var W=p,N=p,d=7;for(W>>>=1;W;W>>>=1)N<<=1,N|=1&W,--d;V[p]=N<<d&255}}(N),p.reverse=function(V){return N[255&V]<<24|N[V>>>8&255]<<16|N[V>>>16&255]<<8|N[V>>>24&255]},p.interleave2=function(V,p){return(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V&=65535)|V<<8))|V<<4))|V<<2))|V<<1))|(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p&=65535)|p<<8))|p<<4))|p<<2))|p<<1))<<1},p.deinterleave2=function(V,p){return(V=65535&((V=16711935&((V=252645135&((V=858993459&((V=V>>>p&1431655765)|V>>>1))|V>>>2))|V>>>4))|V>>>16))<<16>>16},p.interleave3=function(V,p,W){return V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2),(V|=(p=1227133513&((p=3272356035&((p=251719695&((p=4278190335&((p&=1023)|p<<16))|p<<8))|p<<4))|p<<2))<<1)|(W=1227133513&((W=3272356035&((W=251719695&((W=4278190335&((W&=1023)|W<<16))|W<<8))|W<<4))|W<<2))<<2},p.deinterleave3=function(V,p){return(V=1023&((V=4278190335&((V=251719695&((V=3272356035&((V=V>>>p&1227133513)|V>>>2))|V>>>4))|V>>>8))|V>>>16))<<22>>22},p.nextCombination=function(V){var p=V|V-1;return p+1|(~p&-~p)-1>>>W(V)+1}},11024:V=>{"use strict";V.exports=function(V,p,W,N){var d=self||window;try{try{var E;try{E=new d.Blob([V])}catch(J){(E=new(d.BlobBuilder||d.WebKitBlobBuilder||d.MozBlobBuilder||d.MSBlobBuilder)).append(V),E=E.getBlob()}var z=d.URL||d.webkitURL,S=z.createObjectURL(E),Q=new d[p](S,W);return z.revokeObjectURL(S),Q}catch(J){return new d[p]("data:application/javascript,".concat(encodeURIComponent(V)),W)}}catch(J){if(!N)throw Error("Inline worker is not supported");return new d[p](N,W)}}},12142:(V,p,W)=>{"use strict";function N(V,p,W,N,d){var E={};return Object.keys(N).forEach((function(V){E[V]=N[V]})),E.enumerable=!!E.enumerable,E.configurable=!!E.configurable,("value"in E||E.initializer)&&(E.writable=!0),E=W.slice().reverse().reduce((function(W,N){return N(V,p,W)||W}),E),d&&void 0!==E.initializer&&(E.value=E.initializer?E.initializer.call(d):void 0,E.initializer=void 0),void 0===E.initializer&&(Object.defineProperty(V,p,E),E=null),E}W.d(p,{d:()=>N})},12135:(V,p,W)=>{"use strict";function N(V,p,W,N){W&&Object.defineProperty(V,p,{enumerable:W.enumerable,configurable:W.configurable,writable:W.writable,value:W.initializer?W.initializer.call(N):void 0})}W.d(p,{e:()=>N})},12492:(V,p,W)=>{"use strict";W.d(p,{d:()=>C,e:()=>O,f:()=>U,j:()=>j,n:()=>f,q:()=>u,t:()=>k});var N=W(11218),d=W(11257),E=W(11242),z=W(11004),S=W(12498),Q=W(11529),J=W(11462),i=W(10893),l=W(11265);const j=Object.freeze(new N.f(0,0,0,0)),k=Object.freeze(N.n.Zero()),u=Object.freeze(N.k.Zero()),f=Object.freeze(J.c.Zero()),O=Object.freeze(d.c.Black()),U=Object.freeze(new d.e(0,0,0,0)),F={key:0,repeatCount:0,loopMode:2};class C{static _PrepareAnimation(V,p,W,E,z,S,Q,i){let l;if(!isNaN(parseFloat(z))&&isFinite(z)?l=C.ANIMATIONTYPE_FLOAT:z instanceof N.f?l=C.ANIMATIONTYPE_QUATERNION:z instanceof N.n?l=C.ANIMATIONTYPE_VECTOR3:z instanceof N.k?l=C.ANIMATIONTYPE_VECTOR2:z instanceof d.c?l=C.ANIMATIONTYPE_COLOR3:z instanceof d.e?l=C.ANIMATIONTYPE_COLOR4:z instanceof J.c&&(l=C.ANIMATIONTYPE_SIZE),void 0==l)return null;const j=new C(V,p,W,l,Q),k=[{frame:0,value:z},{frame:E,value:S}];return j.setKeys(k),void 0!==i&&j.setEasingFunction(i),j}static CreateAnimation(V,p,W,N){const d=new C(V+"Animation",V,W,p,C.ANIMATIONLOOPMODE_CONSTANT);return d.setEasingFunction(N),d}static CreateAndStartAnimation(V,p,W,N,d,E,z,S,Q,J,i){const l=C._PrepareAnimation(V,W,N,d,E,z,S,Q);return l?(p.va&&(i=p.va()),i?i.beginDirectAnimation(p,[l],0,d,1===l.loopMode,1,J):null):null}static CreateAndStartHierarchyAnimation(V,p,W,N,d,E,z,S,Q,J,i){const l=C._PrepareAnimation(V,N,d,E,z,S,Q,J);if(!l)return null;return p.va().beginDirectHierarchyAnimation(p,W,[l],0,E,1===l.loopMode,1,i)}static CreateMergeAndStartAnimation(V,p,W,N,d,E,z,S,Q,J){const i=C._PrepareAnimation(V,W,N,d,E,z,S,Q);return i?(p.animations.push(i),p.va().beginAnimation(p,0,d,1===i.loopMode,1,J)):null}static MakeAnimationAdditive(V,p,W){let d;d="object"===typeof p?p:{referenceFrame:p??0,range:W,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let E=V;if(d.cloneOriginalAnimation&&(E=V.clone(),E.name=d.clonedAnimationName||E.name),!E._keys.length)return E;const z=d.referenceFrame&&d.referenceFrame>=0?d.referenceFrame:0;let S=0;const Q=E._keys[0];let J=E._keys.length-1;const i=E._keys[J],l={referenceValue:Q.value,referencePosition:N.i.fb[0],referenceQuaternion:N.i.Quaternion[0],referenceScaling:N.i.fb[1],keyPosition:N.i.fb[2],keyQuaternion:N.i.Quaternion[1],keyScaling:N.i.fb[3]};let j=Q.frame,k=i.frame;if(d.range){const V=E.getRange(d.range);V&&(j=V.from,k=V.to)}else j=d.fromFrame??j,k=d.toFrame??k;if(j!==Q.frame&&(S=E.createKeyForFrame(j)),k!==i.frame&&(J=E.createKeyForFrame(k)),1===E._keys.length){const V=E._getKeyValue(E._keys[0]);l.referenceValue=V.clone?V.clone():V}else if(z<=Q.frame){const V=E._getKeyValue(Q.value);l.referenceValue=V.clone?V.clone():V}else if(z>=i.frame){const V=E._getKeyValue(i.value);l.referenceValue=V.clone?V.clone():V}else{F.key=0;const V=E._interpolate(z,F);l.referenceValue=V.clone?V.clone():V}E.dataType===C.ANIMATIONTYPE_QUATERNION?l.referenceValue.normalize().conjugateInPlace():E.dataType===C.ANIMATIONTYPE_MATRIX&&(l.referenceValue.decompose(l.referenceScaling,l.referenceQuaternion,l.referencePosition),l.referenceQuaternion.normalize().conjugateInPlace());let u=Number.MAX_VALUE;const f=d.clipKeys?[]:null;for(let O=S;O<=J;O++){let V=E._keys[O];if((f||d.cloneOriginalAnimation)&&(V={frame:V.frame,value:V.value.clone?V.value.clone():V.value,inTangent:V.inTangent,outTangent:V.outTangent,interpolation:V.interpolation,lockedTangent:V.lockedTangent},f&&(u===Number.MAX_VALUE&&(u=V.frame),V.frame-=u,f.push(V))),!O||E.dataType===C.ANIMATIONTYPE_FLOAT||V.value!==Q.value)switch(E.dataType){case C.ANIMATIONTYPE_MATRIX:V.value.decompose(l.keyScaling,l.keyQuaternion,l.keyPosition),l.keyPosition.ei(l.referencePosition),l.keyScaling.divideInPlace(l.referenceScaling),l.referenceQuaternion.multiplyToRef(l.keyQuaternion,l.keyQuaternion),N.e.ComposeToRef(l.keyScaling,l.keyQuaternion,l.keyPosition,V.value);break;case C.ANIMATIONTYPE_QUATERNION:l.referenceValue.multiplyToRef(V.value,V.value);break;case C.ANIMATIONTYPE_VECTOR2:case C.ANIMATIONTYPE_VECTOR3:case C.ANIMATIONTYPE_COLOR3:case C.ANIMATIONTYPE_COLOR4:V.value.subtractToRef(l.referenceValue,V.value);break;case C.ANIMATIONTYPE_SIZE:V.value.width-=l.referenceValue.width,V.value.height-=l.referenceValue.height;break;default:V.value-=l.referenceValue}}return f&&E.setKeys(f,!0),E}static TransitionTo(V,p,W,N,d,E,z){let S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(z<=0)return W[V]=p,S&&S(),null;const Q=d*(z/1e3);E.setKeys([{frame:0,value:W[V].clone?W[V].clone():W[V]},{frame:Q,value:p}]),W.animations||(W.animations=[]),W.animations.push(E);const J=N.beginAnimation(W,0,Q,!1);return J.onAnimationEnd=S,J}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const V of this._runtimeAnimations)if(!V.isStopped())return!0;return!1}constructor(V,p,W,N,d,E){this.name=V,this.targetProperty=p,this.framePerSecond=W,this.dataType=N,this.loopMode=d,this.enableBlending=E,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=p.split("."),this.dataType=N,this.loopMode=void 0===d?C.ANIMATIONLOOPMODE_CYCLE:d,this.uniqueId=C._UniqueIdGenerator++}toString(V){let p="Name: "+this.name+", property: "+this.targetProperty;if(p+=", datatype: "+["Float","fb","Quaternion","Matrix","gb","Vector2"][this.dataType],p+=", nKeys: "+(this._keys?this._keys.length:"none"),p+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),V){p+=", Ranges: {";let V=!0;for(const W in this._ranges)V&&(p+=", ",V=!1),p+=W;p+="}"}return p}addEvent(V){this._events.push(V),this._events.sort(((V,p)=>V.frame-p.frame))}removeEvents(V){for(let p=0;p<this._events.length;p++)this._events[p].frame===V&&(this._events.splice(p,1),p--)}getEvents(){return this._events}createRange(V,p,W){this._ranges[V]||(this._ranges[V]=new S.d(V,p,W))}deleteRange(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const W=this._ranges[V];if(W){if(p){const V=W.from,p=W.to;for(let W=this._keys.length-1;W>=0;W--)this._keys[W].frame>=V&&this._keys[W].frame<=p&&this._keys.splice(W,1)}this._ranges[V]=null}}getRange(V){return this._ranges[V]}getKeys(){return this._keys}getHighestFrame(){let V=0;for(let p=0,W=this._keys.length;p<W;p++)V<this._keys[p].frame&&(V=this._keys[p].frame);return V}getEasingFunction(){return this._easingFunction}setEasingFunction(V){this._easingFunction=V}floatInterpolateFunction(V,p,W){return(0,E.l)(V,p,W)}floatInterpolateFunctionWithTangents(V,p,W,N,d){return(0,E.e)(V,p,W,N,d)}quaternionInterpolateFunction(V,p,W){return N.f.Slerp(V,p,W)}quaternionInterpolateFunctionWithTangents(V,p,W,d,E){return N.f.Hermite(V,p,W,d,E).normalize()}vector3InterpolateFunction(V,p,W){return N.n.Lerp(V,p,W)}vector3InterpolateFunctionWithTangents(V,p,W,d,E){return N.n.Hermite(V,p,W,d,E)}vector2InterpolateFunction(V,p,W){return N.k.Lerp(V,p,W)}vector2InterpolateFunctionWithTangents(V,p,W,d,E){return N.k.Hermite(V,p,W,d,E)}sizeInterpolateFunction(V,p,W){return J.c.Lerp(V,p,W)}color3InterpolateFunction(V,p,W){return d.c.Lerp(V,p,W)}color3InterpolateFunctionWithTangents(V,p,W,N,E){return d.c.Hermite(V,p,W,N,E)}color4InterpolateFunction(V,p,W){return d.e.Lerp(V,p,W)}color4InterpolateFunctionWithTangents(V,p,W,N,E){return d.e.Hermite(V,p,W,N,E)}_getKeyValue(V){return"function"===typeof V?V():V}evaluate(V){return F.key=0,this._interpolate(V,F)}_interpolate(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(p.loopMode===C.ANIMATIONLOOPMODE_CONSTANT&&p.repeatCount>0)return p.highLimitValue.clone?p.highLimitValue.clone():p.highLimitValue;const N=this._keys,d=N.length;let E=p.key;for(;E>=0&&V<N[E].frame;)--E;for(;E+1<=d-1&&V>=N[E+1].frame;)++E;if(p.key=E,E<0)return W?void 0:this._getKeyValue(N[0].value);if(E+1>d-1)return W?void 0:this._getKeyValue(N[d-1].value);const z=N[E],S=N[E+1];if(W&&(V===z.frame||V===S.frame))return;const Q=this._getKeyValue(z.value),J=this._getKeyValue(S.value);if(1===z.interpolation)return S.frame>V?Q:J;const i=void 0!==z.outTangent&&void 0!==S.inTangent,l=S.frame-z.frame;let F=(V-z.frame)/l;const A=z.easingFunction||this.getEasingFunction();switch(null!==A&&(F=A.ease(F)),this.dataType){case C.ANIMATIONTYPE_FLOAT:{const V=i?this.floatInterpolateFunctionWithTangents(Q,z.outTangent*l,J,S.inTangent*l,F):this.floatInterpolateFunction(Q,J,F);switch(p.loopMode){case C.ANIMATIONLOOPMODE_CYCLE:case C.ANIMATIONLOOPMODE_CONSTANT:case C.ANIMATIONLOOPMODE_YOYO:return V;case C.ANIMATIONLOOPMODE_RELATIVE:case C.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(p.offsetValue??0)*p.repeatCount+V}break}case C.ANIMATIONTYPE_QUATERNION:{const V=i?this.quaternionInterpolateFunctionWithTangents(Q,z.outTangent.scale(l),J,S.inTangent.scale(l),F):this.quaternionInterpolateFunction(Q,J,F);switch(p.loopMode){case C.ANIMATIONLOOPMODE_CYCLE:case C.ANIMATIONLOOPMODE_CONSTANT:case C.ANIMATIONLOOPMODE_YOYO:return V;case C.ANIMATIONLOOPMODE_RELATIVE:case C.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.addInPlace((p.offsetValue||j).scale(p.repeatCount))}return V}case C.ANIMATIONTYPE_VECTOR3:{const V=i?this.vector3InterpolateFunctionWithTangents(Q,z.outTangent.scale(l),J,S.inTangent.scale(l),F):this.vector3InterpolateFunction(Q,J,F);switch(p.loopMode){case C.ANIMATIONLOOPMODE_CYCLE:case C.ANIMATIONLOOPMODE_CONSTANT:case C.ANIMATIONLOOPMODE_YOYO:return V;case C.ANIMATIONLOOPMODE_RELATIVE:case C.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.add((p.offsetValue||k).scale(p.repeatCount))}break}case C.ANIMATIONTYPE_VECTOR2:{const V=i?this.vector2InterpolateFunctionWithTangents(Q,z.outTangent.scale(l),J,S.inTangent.scale(l),F):this.vector2InterpolateFunction(Q,J,F);switch(p.loopMode){case C.ANIMATIONLOOPMODE_CYCLE:case C.ANIMATIONLOOPMODE_CONSTANT:case C.ANIMATIONLOOPMODE_YOYO:return V;case C.ANIMATIONLOOPMODE_RELATIVE:case C.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.add((p.offsetValue||u).scale(p.repeatCount))}break}case C.ANIMATIONTYPE_SIZE:switch(p.loopMode){case C.ANIMATIONLOOPMODE_CYCLE:case C.ANIMATIONLOOPMODE_CONSTANT:case C.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(Q,J,F);case C.ANIMATIONLOOPMODE_RELATIVE:case C.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(Q,J,F).add((p.offsetValue||f).scale(p.repeatCount))}break;case C.ANIMATIONTYPE_COLOR3:{const V=i?this.color3InterpolateFunctionWithTangents(Q,z.outTangent.scale(l),J,S.inTangent.scale(l),F):this.color3InterpolateFunction(Q,J,F);switch(p.loopMode){case C.ANIMATIONLOOPMODE_CYCLE:case C.ANIMATIONLOOPMODE_CONSTANT:case C.ANIMATIONLOOPMODE_YOYO:return V;case C.ANIMATIONLOOPMODE_RELATIVE:case C.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.add((p.offsetValue||O).scale(p.repeatCount))}break}case C.ANIMATIONTYPE_COLOR4:{const V=i?this.color4InterpolateFunctionWithTangents(Q,z.outTangent.scale(l),J,S.inTangent.scale(l),F):this.color4InterpolateFunction(Q,J,F);switch(p.loopMode){case C.ANIMATIONLOOPMODE_CYCLE:case C.ANIMATIONLOOPMODE_CONSTANT:case C.ANIMATIONLOOPMODE_YOYO:return V;case C.ANIMATIONLOOPMODE_RELATIVE:case C.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return V.add((p.offsetValue||U).scale(p.repeatCount))}break}case C.ANIMATIONTYPE_MATRIX:switch(p.loopMode){case C.ANIMATIONLOOPMODE_CYCLE:case C.ANIMATIONLOOPMODE_CONSTANT:case C.ANIMATIONLOOPMODE_YOYO:return C.AllowMatricesInterpolation?this.matrixInterpolateFunction(Q,J,F,p.workValue):Q;case C.ANIMATIONLOOPMODE_RELATIVE:case C.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return Q}}return 0}matrixInterpolateFunction(V,p,W,d){return C.AllowMatrixDecomposeForInterpolation?d?(N.e.DecomposeLerpToRef(V,p,W,d),d):N.e.DecomposeLerp(V,p,W):d?(N.e.LerpToRef(V,p,W,d),d):N.e.Lerp(V,p,W)}clone(){const V=new C(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(V.enableBlending=this.enableBlending,V.blendingSpeed=this.blendingSpeed,this._keys&&V.setKeys(this._keys),this._ranges){V._ranges={};for(const p in this._ranges){const W=this._ranges[p];W&&(V._ranges[p]=W.clone())}}return V}setKeys(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=p?V:V.slice(0)}createKeyForFrame(V){F.key=0;const p=this._interpolate(V,F,!0);if(!p)return this._keys[F.key].frame===V?F.key:F.key+1;const W={frame:V,value:p.clone?p.clone():p};return this._keys.splice(F.key+1,0,W),F.key+1}serialize(){const V={};V.name=this.name,V.property=this.targetProperty,V.framePerSecond=this.framePerSecond,V.dataType=this.dataType,V.loopBehavior=this.loopMode,V.enableBlending=this.enableBlending,V.blendingSpeed=this.blendingSpeed;const p=this.dataType;V.keys=[];const W=this.getKeys();for(let N=0;N<W.length;N++){const d=W[N],E={};switch(E.frame=d.frame,p){case C.ANIMATIONTYPE_FLOAT:E.values=[d.value],void 0!==d.inTangent&&E.values.push(d.inTangent),void 0!==d.outTangent&&(void 0===d.inTangent&&E.values.push(void 0),E.values.push(d.outTangent)),void 0!==d.interpolation&&(void 0===d.inTangent&&E.values.push(void 0),void 0===d.outTangent&&E.values.push(void 0),E.values.push(d.interpolation));break;case C.ANIMATIONTYPE_QUATERNION:case C.ANIMATIONTYPE_MATRIX:case C.ANIMATIONTYPE_VECTOR3:case C.ANIMATIONTYPE_COLOR3:case C.ANIMATIONTYPE_COLOR4:E.values=d.value.Zi(),void 0!=d.inTangent&&E.values.push(d.inTangent.Zi()),void 0!=d.outTangent&&(void 0===d.inTangent&&E.values.push(void 0),E.values.push(d.outTangent.Zi())),void 0!==d.interpolation&&(void 0===d.inTangent&&E.values.push(void 0),void 0===d.outTangent&&E.values.push(void 0),E.values.push(d.interpolation))}V.keys.push(E)}V.ranges=[];for(const N in this._ranges){const p=this._ranges[N];if(!p)continue;const W={};W.name=N,W.from=p.from,W.to=p.to,V.ranges.push(W)}return V}static _UniversalLerp(V,p,W){const N=V.constructor;return N.Lerp?N.Lerp(V,p,W):N.Slerp?N.Slerp(V,p,W):V.toFixed?V*(1-W)+W*p:p}static Parse(V){const p=new C(V.name,V.property,V.framePerSecond,V.dataType,V.loopBehavior),W=V.dataType,E=[];let z,S;for(V.enableBlending&&(p.enableBlending=V.enableBlending),V.blendingSpeed&&(p.blendingSpeed=V.blendingSpeed),S=0;S<V.keys.length;S++){const p=V.keys[S];let Q,J,i;switch(W){case C.ANIMATIONTYPE_FLOAT:z=p.values[0],p.values.length>=2&&(Q=p.values[1]),p.values.length>=3&&(J=p.values[2]),p.values.length>=4&&(i=p.values[3]);break;case C.ANIMATIONTYPE_QUATERNION:if(z=N.f.Tg(p.values),p.values.length>=8){const V=N.f.Tg(p.values.slice(4,8));V.equals(N.f.Zero())||(Q=V)}if(p.values.length>=12){const V=N.f.Tg(p.values.slice(8,12));V.equals(N.f.Zero())||(J=V)}p.values.length>=13&&(i=p.values[12]);break;case C.ANIMATIONTYPE_MATRIX:z=N.e.Tg(p.values),p.values.length>=17&&(i=p.values[16]);break;case C.ANIMATIONTYPE_COLOR3:z=d.c.Tg(p.values),p.values[3]&&(Q=d.c.Tg(p.values[3])),p.values[4]&&(J=d.c.Tg(p.values[4])),p.values[5]&&(i=p.values[5]);break;case C.ANIMATIONTYPE_COLOR4:z=d.e.Tg(p.values),p.values[4]&&(Q=d.e.Tg(p.values[4])),p.values[5]&&(J=d.e.Tg(p.values[5])),p.values[6]&&(i=d.e.Tg(p.values[6]));break;case C.ANIMATIONTYPE_VECTOR3:default:z=N.n.Tg(p.values),p.values[3]&&(Q=N.n.Tg(p.values[3])),p.values[4]&&(J=N.n.Tg(p.values[4])),p.values[5]&&(i=p.values[5])}const l={};l.frame=p.frame,l.value=z,void 0!=Q&&(l.inTangent=Q),void 0!=J&&(l.outTangent=J),void 0!=i&&(l.interpolation=i),E.push(l)}if(p.setKeys(E),V.ranges)for(S=0;S<V.ranges.length;S++)z=V.ranges[S],p.createRange(z.name,z.from,z.to);return p}static AppendSerializedAnimations(V,p){l.b.AppendSerializedAnimations(V,p)}static ParseFromFileAsync(V,p){return new Promise(((W,N)=>{const d=new i.e;d.addEventListener("readystatechange",(()=>{if(4==d.readyState)if(200==d.status){let p=JSON.parse(d.responseText);if(p.animations&&(p=p.animations),p.length){const V=[];for(const W of p)V.push(this.Parse(W));W(V)}else{const N=this.Parse(p);V&&(N.name=V),W(N)}}else N("Unable to load the animation")})),d.open("GET",p),d.send()}))}static ParseFromSnippetAsync(V){return new Promise(((p,W)=>{const N=new i.e;N.addEventListener("readystatechange",(()=>{if(4==N.readyState)if(200==N.status){const W=JSON.parse(JSON.parse(N.responseText).jsonPayload);if(W.animations){const N=JSON.parse(W.animations),d=[];for(const p of N.animations){const W=this.Parse(p);W.snippetId=V,d.push(W)}p(d)}else{const N=JSON.parse(W.animation),d=this.Parse(N);d.snippetId=V,p(d)}}else W("Unable to load the snippet "+V)})),N.open("GET",this.SnippetUrl+"/"+V.replace(/#/g,"/")),N.send()}))}}C._UniqueIdGenerator=0,C.AllowMatricesInterpolation=!1,C.AllowMatrixDecomposeForInterpolation=!0,C.SnippetUrl="https://snippet.babylonjs.com",C.ANIMATIONTYPE_FLOAT=0,C.ANIMATIONTYPE_VECTOR3=1,C.ANIMATIONTYPE_QUATERNION=2,C.ANIMATIONTYPE_MATRIX=3,C.ANIMATIONTYPE_COLOR3=4,C.ANIMATIONTYPE_COLOR4=7,C.ANIMATIONTYPE_VECTOR2=5,C.ANIMATIONTYPE_SIZE=6,C.ANIMATIONLOOPMODE_RELATIVE=0,C.ANIMATIONLOOPMODE_CYCLE=1,C.ANIMATIONLOOPMODE_CONSTANT=2,C.ANIMATIONLOOPMODE_YOYO=4,C.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,C.CreateFromSnippetAsync=C.ParseFromSnippetAsync,(0,z.d)("BABYLON.Animation",C),Q.b._AnimationRangeFactory=(V,p,W)=>new S.d(V,p,W)},12498:(V,p,W)=>{"use strict";W.d(p,{d:()=>N});class N{constructor(V,p,W){this.name=V,this.from=p,this.to=W}clone(){return new N(this.name,this.from,this.to)}}},11819:(V,p,W)=>{"use strict";var N=W(10856),d=W(10870),E=W(10941),z=W(10862);E.d.AudioEngineFactory=(V,p,W)=>new S(V,p,W);class S{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new N.b,this.onAudioLockedObservable=new N.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,z.l)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const d=document.createElement("audio");this._hostElement=V,this._audioContext=p,this._audioDestination=W;try{d&&d.canPlayType&&(d.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||d.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(E){}try{d&&d.canPlayType&&d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(E){}}lock(){this._triggerSuspendedState()}unlock(){var V,p;if("running"===(null===(V=this._audioContext)||void 0===V?void 0:V.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(p=this._audioContext)||void 0===p||p.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var V;null===(V=this._audioContext)||void 0===V||V.addEventListener("statechange",(()=>{var V;this.unlocked&&"running"!==(null===(V=this._audioContext)||void 0===V?void 0:V.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var V;return null!==(V=this._audioContext)&&void 0!==V&&V.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(V){this.canUseWebAudio=!1,d.e.Error("Web Audio: "+V.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const V=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",p=document.createElement("style");p.appendChild(document.createTextNode(V)),document.getElementsByTagName("head")[0].appendChild(p),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(V){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=V)}connectToAnalyser(V){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=V,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},12485:(V,p,W)=>{"use strict";W.d(p,{c:()=>z});var N=W(11218),d=W(11233),E=W(11529);class z extends E.b{get _matrix(){return this._compose(),this.Fj}set _matrix(V){(V.updateFlag!==this.Fj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Fj.p(V),this._markAsDirtyAndDecompose())}constructor(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(V,p.va(),!1),this.name=V,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=p,this.Fj=(null===d||void 0===d?void 0:d.clone())??N.e.Identity(),this._restMatrix=E??this.Fj.clone(),this._bindMatrix=z??this.Fj.clone(),this._index=S,this._absoluteMatrix=new N.e,this._absoluteBindMatrix=new N.e,this._absoluteInverseBindMatrix=new N.e,this._finalMatrix=new N.e,p.bones.push(this),this.setParent(W,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(V){this.setParent(V)}setParent(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==V){if(this.parent){const V=this.parent.children.indexOf(this);-1!==V&&this.parent.children.splice(V,1)}this._parentNode=V,this.parent&&this.parent.children.push(this),p&&this._updateAbsoluteBindMatrices(),this.Jg()}}getLocalMatrix(){return this._compose(),this.Fj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(V){this._restMatrix.p(V)}setRestPose(V){this.setRestMatrix(V)}getBindPose(){return this.getBindMatrix()}setBindMatrix(V){this.wj(V)}setBindPose(V){this.setBindMatrix(V)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const V=N.i.fb[0],p=N.i.Quaternion[0],W=N.i.fb[1];this.getRestMatrix().decompose(V,p,W),this._linkedTransformNode.position.p(W),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??N.f.Identity(),this._linkedTransformNode.rotationQuaternion.p(p),this._linkedTransformNode.ie.p(V)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(V){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=V,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.de}set position(V){this._decompose(),this.de.p(V),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(V){this.setRotation(V)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(V){this.setRotationQuaternion(V)}get ie(){return this.getScale()}set ie(V){this.setScale(V)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=N.n.Zero(),this._localRotation=N.f.Zero(),this.de=N.n.Zero()),this.Fj.decompose(this._localScaling,this._localRotation,this.de))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,N.e.ComposeToRef(this._localScaling,this._localRotation,this.de,this.Fj)):this._needToCompose=!1)}wj(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(V),p&&this._updateAbsoluteBindMatrices(),W?this._matrix=V:this.Jg()}_updateAbsoluteBindMatrices(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(V||(V=this._bindMatrix),this.parent?V.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(V),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),p)for(let W=0;W<this.children.length;W++)this.children[W]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Jg(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Jg(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Jg(),this._needToDecompose=!0}_updatePosition(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0,d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const E=this.getLocalMatrix();if(0==p)d?(E.addAtIndex(12,V.x),E.addAtIndex(13,V.y),E.addAtIndex(14,V.z)):E.setTranslationFromFloats(V.x,V.y,V.z);else{let p=null;W&&(p=W.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const S=z._TmpMats[0],Q=z._TmpVecs[0];this.parent?W&&p?(S.p(this.parent.getAbsoluteMatrix()),S.multiplyToRef(p,S)):S.p(this.parent.getAbsoluteMatrix()):N.e.IdentityToRef(S),d&&S.setTranslationFromFloats(0,0,0),S.invert(),N.n.TransformCoordinatesToRef(V,S,Q),d?(E.addAtIndex(12,Q.x),E.addAtIndex(13,Q.y),E.addAtIndex(14,Q.z)):E.setTranslationFromFloats(Q.x,Q.y,Q.z)}this._markAsDirtyAndDecompose()}translate(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;this._updatePosition(V,p,W,!0)}setPosition(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;this._updatePosition(V,p,W,!1)}setAbsolutePosition(V,p){this.setPosition(V,1,p)}scale(V,p,W){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=this.getLocalMatrix(),S=z._TmpMats[0];N.e.ScalingToRef(V,p,W,S),S.multiplyToRef(E,E),S.invert();for(const N of this.children){const d=N.getLocalMatrix();d.multiplyToRef(S,d),d.multiplyAtIndex(12,V),d.multiplyAtIndex(13,p),d.multiplyAtIndex(14,W),N._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),d)for(const N of this.children)N.scale(V,p,W,d)}setScale(V){this._decompose(),this._localScaling.p(V),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(V){this._decompose(),V.p(this._localScaling)}setYawPitchRoll(V,p,W){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4?arguments[4]:void 0;if(0===d){const S=z._TmpQuat;return N.f.RotationYawPitchRollToRef(V,p,W,S),void this.setRotationQuaternion(S,d,E)}const S=z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(S,E))return;const Q=z._TmpMats[1];N.e.RotationYawPitchRollToRef(V,p,W,Q),S.multiplyToRef(Q,Q),this._rotateWithMatrix(Q,d,E)}rotate(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3?arguments[3]:void 0;const E=z._TmpMats[0];E.setTranslationFromFloats(0,0,0),N.e.RotationAxisToRef(V,p,E),this._rotateWithMatrix(E,W,d)}setAxisAngle(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3?arguments[3]:void 0;if(0===W){const E=z._TmpQuat;return N.f.RotationAxisToRef(V,p,E),void this.setRotationQuaternion(E,W,d)}const E=z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,d))return;const S=z._TmpMats[1];N.e.RotationAxisToRef(V,p,S),E.multiplyToRef(S,S),this._rotateWithMatrix(S,W,d)}setRotation(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(V.y,V.x,V.z,p,W)}setRotationQuaternion(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;if(0===p)return this._decompose(),this._localRotation.p(V),void this._markAsDirtyAndCompose();const d=z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(d,W))return;const E=z._TmpMats[1];N.e.FromQuaternionToRef(V,E),d.multiplyToRef(E,E),this._rotateWithMatrix(E,p,W)}setRotationMatrix(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;if(0===p){const d=z._TmpQuat;return N.f.FromRotationMatrixToRef(V,d),void this.setRotationQuaternion(d,p,W)}const d=z._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(d,W))return;const E=z._TmpMats[1];E.p(V),d.multiplyToRef(V,E),this._rotateWithMatrix(E,p,W)}_rotateWithMatrix(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;const N=this.getLocalMatrix(),d=N.m[12],E=N.m[13],S=N.m[14],Q=this.getParent(),J=z._TmpMats[3],i=z._TmpMats[4];Q&&1==p?(W?(J.p(W.getWorldMatrix()),Q.getAbsoluteMatrix().multiplyToRef(J,J)):J.p(Q.getAbsoluteMatrix()),i.p(J),i.invert(),N.multiplyToRef(J,N),N.multiplyToRef(V,N),N.multiplyToRef(i,N)):1==p&&W?(J.p(W.getWorldMatrix()),i.p(J),i.invert(),N.multiplyToRef(J,N),N.multiplyToRef(V,N),N.multiplyToRef(i,N)):N.multiplyToRef(V,N),N.setTranslationFromFloats(d,E,S),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(V,p){const W=z._TmpMats[2];return V.p(this.getAbsoluteMatrix()),p?(V.multiplyToRef(p.getWorldMatrix(),V),N.e.ScalingToRef(p.ie.x,p.ie.y,p.ie.z,W)):N.e.IdentityToRef(W),V.invert(),!isNaN(V.m[0])&&(W.multiplyAtIndex(0,this._scalingDeterminant),V.multiplyToRef(W,V),!0)}cb(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=N.n.Zero();return this.getPositionToRef(V,p,W),W}getPositionToRef(){let V=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const V=this.getLocalMatrix();p.x=V.m[12],p.y=V.m[13],p.z=V.m[14]}else{let W=null;V&&(W=V.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let N=z._TmpMats[0];V&&W?(N.p(this.getAbsoluteMatrix()),N.multiplyToRef(W,N)):N=this.getAbsoluteMatrix(),p.x=N.m[12],p.y=N.m[13],p.z=N.m[14]}}getAbsolutePosition(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const p=N.n.Zero();return this.getPositionToRef(1,V,p),p}getAbsolutePositionToRef(V,p){this.getPositionToRef(1,V,p)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Fj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Fj);const V=this._skeleton.getPoseMatrix();V&&this._absoluteMatrix.multiplyToRef(V,this._absoluteMatrix)}const V=this.children,p=V.length;for(let W=0;W<p;W++)V[W].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Ze(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=N.n.Zero();return this.getDirectionToRef(V,p,W),W}getDirectionToRef(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,d=null;p&&(d=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const E=z._TmpMats[0];E.p(this.getAbsoluteMatrix()),p&&d&&E.multiplyToRef(d,E),N.n.TransformNormalToRef(V,E,W),W.normalize()}getRotation(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=N.n.Zero();return this.getRotationToRef(V,p,W),W}getRotationToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0;const N=z._TmpQuat;this.getRotationQuaternionToRef(V,p,N),N.toEulerAnglesToRef(W)}getRotationQuaternion(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=N.f.Identity();return this.getRotationQuaternionToRef(V,p,W),W}getRotationQuaternionToRef(){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),p.p(this._localRotation);else{const W=z._TmpMats[0],N=this.getAbsoluteMatrix();V?N.multiplyToRef(V.getWorldMatrix(),W):W.p(N),W.multiplyAtIndex(0,this._scalingDeterminant),W.multiplyAtIndex(1,this._scalingDeterminant),W.multiplyAtIndex(2,this._scalingDeterminant),W.decompose(void 0,p,void 0)}}getRotationMatrix(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1?arguments[1]:void 0;const W=N.e.Identity();return this.getRotationMatrixToRef(V,p,W),W}getRotationMatrixToRef(){let V=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(p);else{const W=z._TmpMats[0],N=this.getAbsoluteMatrix();V?N.multiplyToRef(V.getWorldMatrix(),W):W.p(N),W.multiplyAtIndex(0,this._scalingDeterminant),W.multiplyAtIndex(1,this._scalingDeterminant),W.multiplyAtIndex(2,this._scalingDeterminant),W.getRotationMatrixToRef(p)}}getAbsolutePositionFromLocal(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=N.n.Zero();return this.getAbsolutePositionFromLocalToRef(V,p,W),W}getAbsolutePositionFromLocalToRef(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,d=null;p&&(d=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const E=z._TmpMats[0];E.p(this.getAbsoluteMatrix()),p&&d&&E.multiplyToRef(d,E),N.n.TransformCoordinatesToRef(V,E,W)}getLocalPositionFromAbsolute(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=N.n.Zero();return this.getLocalPositionFromAbsoluteToRef(V,p,W),W}getLocalPositionFromAbsoluteToRef(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,d=null;p&&(d=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const E=z._TmpMats[0];E.p(this.getAbsoluteMatrix()),p&&d&&E.multiplyToRef(d,E),E.invert(),N.n.TransformCoordinatesToRef(V,E,W)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}z._TmpVecs=(0,d.e)(2,N.n.Zero),z._TmpQuat=N.f.Identity(),z._TmpMats=(0,d.e)(5,N.e.Identity)},11291:(V,p,W)=>{"use strict";W.d(p,{c:()=>E,f:()=>z});var N=W(11299),d=W(10870);class E{get u(){return this._isDisposed}constructor(V,p,W){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7?arguments[7]:void 0,J=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,V&&V.va?this._engine=V.va().getEngine():this._engine=V,this._updatable=W,this._instanced=z,this._divisor=Q||1,this._label=J,p instanceof N.e?(this._data=null,this._buffer=p):(this._data=p,this._buffer=null),this.byteStride=S?d:d*Float32Array.BYTES_PER_ELEMENT,E||this.create()}createVertexBuffer(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6?arguments[6]:void 0;const Q=E?p:p*Float32Array.BYTES_PER_ELEMENT,J=N?E?N:N*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new z(this._engine,this,V,this._updatable,!0,J,void 0===d?this._instanced:d,Q,W,void 0,void 0,!0,this._divisor||S)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!V&&this._buffer||(V=V||this._data,V&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,V),this._data=V):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(V,this._label),this._data=V):this._buffer=this._engine.createVertexBuffer(V,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.ib>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.ib,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.ib,void 0,this._label));d.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(V){this.create(V)}updateDirectly(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,V,N?p:p*Float32Array.BYTES_PER_ELEMENT,W?W*this.byteStride:void 0),this._data=0===p&&void 0===W?V:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class z{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(V){const p=0!=V;this._instanceDivisor=V,p!==this._instanced&&(this._instanced=p,this._computeHashCode())}get _maxVerticesCount(){const V=this.getData();return V?Array.isArray(V)?V.length/(this.byteStride/4)-this.byteOffset/4:(V.byteLength-this.byteOffset)/this.byteStride:0}constructor(V,p,W,N,d,S,Q,J,i,l){let j=arguments.length>10&&void 0!==arguments[10]&&arguments[10],k=arguments.length>11&&void 0!==arguments[11]&&arguments[11],u=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,f=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let O=!1;if(this.Ed=V,"object"===typeof N&&null!==N?(O=N.updatable??!1,d=N.postponeInternalCreation,S=N.stride,Q=N.instanced,J=N.offset,i=N.size,l=N.type,j=N.normalized??!1,k=N.useBytes??!1,u=N.divisor??1,f=N.takeBufferOwnership??!1,this._label=N.label):O=!!N,p instanceof E?(this._buffer=p,this._ownsBuffer=f):(this._buffer=new E(V,p,O,S,d,Q,k,u,this._label),this._ownsBuffer=!0),this.uniqueId=z._Counter++,this._kind=W,void 0===l){const V=this.getData();this.type=V?z.GetDataType(V):z.FLOAT}else this.type=l;const U=z.GetTypeByteLength(this.type);k?(this._size=i||(S?S/U:z.DeduceStride(W)),this.byteStride=S||this._buffer.byteStride||this._size*U,this.byteOffset=J||0):(this._size=i||S||z.DeduceStride(W),this.byteStride=S?S*U:this._buffer.byteStride||this._size*U,this.byteOffset=(J||0)*U),this.normalized=j,this._instanced=void 0!==Q&&Q,this._instanceDivisor=Q?u:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var V;null===(V=this._buffer)||void 0===V||V._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(V,p){const W=this.getData();return W?z.GetFloatData(W,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,V,p):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/z.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/z.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*z.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(V){this._buffer.create(V),this._alignBuffer()}update(V){this._buffer.update(V),this._alignBuffer()}updateDirectly(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(V,p,void 0,W),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(V,p){z.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,V,this.normalized,p)}_alignBuffer(){}static DeduceStride(V){switch(V){case z.UVKind:case z.UV2Kind:case z.UV3Kind:case z.UV4Kind:case z.UV5Kind:case z.UV6Kind:return 2;case z.NormalKind:case z.PositionKind:return 3;case z.ColorKind:case z.ColorInstanceKind:case z.MatricesIndicesKind:case z.MatricesIndicesExtraKind:case z.MatricesWeightsKind:case z.MatricesWeightsExtraKind:case z.TangentKind:return 4;default:throw new Error("Invalid kind '"+V+"'")}}static GetDataType(V){return V instanceof Int8Array?z.BYTE:V instanceof Uint8Array?z.UNSIGNED_BYTE:V instanceof Int16Array?z.SHORT:V instanceof Uint16Array?z.UNSIGNED_SHORT:V instanceof Int32Array?z.INT:V instanceof Uint32Array?z.UNSIGNED_INT:z.FLOAT}static GetTypeByteLength(V){switch(V){case z.BYTE:case z.UNSIGNED_BYTE:return 1;case z.SHORT:case z.UNSIGNED_SHORT:return 2;case z.INT:case z.UNSIGNED_INT:case z.FLOAT:return 4;default:throw new Error(`Invalid type '${V}'`)}}static ForEach(V,p,W,N,d,E,S,Q){if(V instanceof Array){let d=p/4;const z=W/4;for(let p=0;p<E;p+=N){for(let W=0;W<N;W++)Q(V[d+W],p+W);d+=z}}else{const J=V instanceof ArrayBuffer?new DataView(V):new DataView(V.buffer,V.byteOffset,V.byteLength),i=z.GetTypeByteLength(d);for(let V=0;V<E;V+=N){let E=p;for(let p=0;p<N;p++){Q(z._GetFloatValue(J,d,E,S),V+p),E+=i}p+=W}}}static _GetFloatValue(V,p,W,N){switch(p){case z.BYTE:{let p=V.getInt8(W);return N&&(p=Math.max(p/127,-1)),p}case z.UNSIGNED_BYTE:{let p=V.getUint8(W);return N&&(p/=255),p}case z.SHORT:{let p=V.getInt16(W,!0);return N&&(p=Math.max(p/32767,-1)),p}case z.UNSIGNED_SHORT:{let p=V.getUint16(W,!0);return N&&(p/=65535),p}case z.INT:return V.getInt32(W,!0);case z.UNSIGNED_INT:return V.getUint32(W,!0);case z.FLOAT:return V.getFloat32(W,!0);default:throw new Error(`Invalid component type ${p}`)}}static GetFloatData(V,p,W,N,E,S,Q,J){const i=p*z.GetTypeByteLength(W),l=Q*p;if(W!==z.FLOAT||E!==i){const d=new Float32Array(l);return z.ForEach(V,N,E,p,W,l,S,((V,p)=>d[p]=V)),d}if(!(V instanceof Array||V instanceof Float32Array)||0!==N||V.length!==l){if(V instanceof Array){const p=N/4;return V.slice(p,p+l)}if(V instanceof ArrayBuffer)return new Float32Array(V,N,l);{const p=V.byteOffset+N;if(0!==(3&p)&&(d.e.Warn("Float array must be aligned to 4-bytes border"),J=!0),J){const W=new Uint8Array(l*Float32Array.BYTES_PER_ELEMENT),N=new Uint8Array(V.buffer,p,W.length);return W.set(N),new Float32Array(W.buffer)}return new Float32Array(V.buffer,p,l)}}return J?V.slice():V}}z._Counter=0,z.BYTE=5120,z.UNSIGNED_BYTE=5121,z.SHORT=5122,z.UNSIGNED_SHORT=5123,z.INT=5124,z.UNSIGNED_INT=5125,z.FLOAT=5126,z.PositionKind="position",z.NormalKind="normal",z.TangentKind="tangent",z.UVKind="uv",z.UV2Kind="uv2",z.UV3Kind="uv3",z.UV4Kind="uv4",z.UV5Kind="uv5",z.UV6Kind="uv6",z.ColorKind="color",z.ColorInstanceKind="instanceColor",z.MatricesIndicesKind="matricesIndices",z.MatricesWeightsKind="matricesWeights",z.MatricesIndicesExtraKind="matricesIndicesExtra",z.MatricesWeightsExtraKind="matricesWeightsExtra"},11299:(V,p,W)=>{"use strict";W.d(p,{e:()=>N});class N{get underlyingResource(){return null}constructor(){this.references=0,this.ib=0,this.is32Bits=!1,this.uniqueId=N._Counter++}}N._Counter=0},12951:(V,p,W)=>{"use strict";W.d(p,{e:()=>P});var N=W(11167),d=W(11175),E=W(10856),z=W(11218),S=W(11529),Q=W(11510),J=W(11330),i=W(10882),l=W(11224);class j{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(V){this._zoomStopsAnimation=V}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(V){this._idleRotationSpeed=V}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(V){this._idleRotationWaitTime=V}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(V){this._idleRotationSpinupTime=V}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(V){this._attachedCamera=V;const p=this._attachedCamera.va();this._onPrePointerObservableObserver=p.onPrePointerObservable.add((V=>{V.type!==J.d.POINTERDOWN?V.type===J.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const V=i.d.Now;let p=0;null!=this._lastFrameTime&&(p=V-this._lastFrameTime),this._lastFrameTime=V,this._applyUserInteraction();const W=V-this._lastInteractionTime-this._idleRotationWaitTime,N=Math.max(Math.min(W/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*N,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(p/1e3))}))}detach(){if(!this._attachedCamera)return;const V=this._attachedCamera.va();this._onPrePointerObservableObserver&&V.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(V){this._lastInteractionTime=V??i.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<l.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let V=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(V=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?V:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=i.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}W(11764);class k{constructor(){this._easingMode=k.EASINGMODE_EASEIN}setEasingMode(V){const p=Math.min(Math.max(V,0),2);this._easingMode=p}getEasingMode(){return this._easingMode}easeInCore(V){throw new Error("You must implement this method")}ease(V){switch(this._easingMode){case k.EASINGMODE_EASEIN:return this.easeInCore(V);case k.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-V)}return V>=.5?.5*(1-this.easeInCore(2*(1-V)))+.5:.5*this.easeInCore(2*V)}}k.EASINGMODE_EASEIN=0,k.EASINGMODE_EASEOUT=1,k.EASINGMODE_EASEINOUT=2;var u=W(12492);class f{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(V){if(this._autoTransitionRange===V)return;this._autoTransitionRange=V;const p=this._attachedCamera;p&&(V?this._onMeshTargetChangedObserver=p.onMeshTargetChangedObservable.add((V=>{if(V&&(V.Dj(!0),V.getBoundingInfo)){const p=V.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*p,this.upperRadiusTransitionRange=.05*p}})):this._onMeshTargetChangedObserver&&p.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(V){this._attachedCamera=V,this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(V){return!!this._attachedCamera&&(this._attachedCamera.radius===V&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(V){if(!this._attachedCamera)return;this._radiusBounceTransition||(f.EasingFunction.setEasingMode(f.EasingMode),this._radiusBounceTransition=u.d.CreateAnimation("radius",u.d.ANIMATIONTYPE_FLOAT,60,f.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const p=u.d.TransitionTo("radius",this._attachedCamera.radius+V,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));p&&this._animatables.push(p)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}f.EasingFunction=new class extends k{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=V}easeInCore(V){const p=Math.max(0,this.amplitude);return Math.pow(V,3)-V*p*Math.sin(3.141592653589793*V)}}(.3),f.EasingMode=k.EASINGMODE_EASEOUT;class O{constructor(){this.onTargetFramingAnimationEndObservable=new E.b,this._mode=O.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(V){this._mode=V}get mode(){return this._mode}set radiusScale(V){this._radiusScale=V}get radiusScale(){return this._radiusScale}set positionScale(V){this._positionScale=V}get positionScale(){return this._positionScale}set defaultElevation(V){this._defaultElevation=V}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(V){this._elevationReturnTime=V}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(V){this._elevationReturnWaitTime=V}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(V){this._zoomStopsAnimation=V}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(V){this._framingTime=V}get framingTime(){return this._framingTime}init(){}attach(V){this._attachedCamera=V;const p=this._attachedCamera.va();O.EasingFunction.setEasingMode(O.EasingMode),this._onPrePointerObservableObserver=p.onPrePointerObservable.add((V=>{V.type!==J.d.POINTERDOWN?V.type===J.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=V.onMeshTargetChangedObservable.add((V=>{V&&V.getBoundingInfo&&this.zoomOnMesh(V,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const V=this._attachedCamera.va();this._onPrePointerObservableObserver&&V.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V.Dj(!0);const N=V.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(N.minimumWorld,N.maximumWorld,p,W)}zoomOnMeshHierarchy(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V.Dj(!0);const N=V.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(N.min,N.max,p,W)}zoomOnMeshesHierarchy(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new z.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),d=new z.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let E=0;E<V.length;E++){const p=V[E].getHierarchyBoundingVectors(!0);z.n.CheckExtends(p.min,N,d),z.n.CheckExtends(p.max,N,d)}this.zoomOnBoundingInfo(N,d,p,W)}zoomOnBoundingInfo(V,p){let W,N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const E=V.y,S=E+(p.y-E)*this._positionScale,Q=p.ed(V).scale(.5);if(N)W=new z.n(0,S,0);else{const p=V.add(Q);W=new z.n(p.x,S,p.z)}this._vectorTransition||(this._vectorTransition=u.d.CreateAnimation("target",u.d.ANIMATIONTYPE_VECTOR3,60,O.EasingFunction)),this._betaIsAnimating=!0;let J=u.d.TransitionTo("target",W,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);J&&this._animatables.push(J);let i=0;if(this._mode===O.FitFrustumSidesMode){const W=this._calculateLowerRadiusFromModelBoundingSphere(V,p);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=Q.length()+this._attachedCamera.Li),i=W}else this._mode===O.IgnoreBoundsSizeMode&&(i=this._calculateLowerRadiusFromModelBoundingSphere(V,p),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Li));if(this.autoCorrectCameraLimitsAndSensibility){const W=p.ed(V).length();this._attachedCamera.panningSensibility=5e3/W,this._attachedCamera.wheelPrecision=100/i}return this._radiusTransition||(this._radiusTransition=u.d.CreateAnimation("radius",u.d.ANIMATIONTYPE_FLOAT,60,O.EasingFunction)),J=u.d.TransitionTo("radius",i,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),d&&d(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),J&&this._animatables.push(J),!0}_calculateLowerRadiusFromModelBoundingSphere(V,p){const W=this._attachedCamera;if(!W)return 0;let N=W._calculateLowerRadiusFromModelBoundingSphere(V,p,this._radiusScale);return W.lowerRadiusLimit&&this._mode===O.IgnoreBoundsSizeMode&&(N=N<W.lowerRadiusLimit?W.lowerRadiusLimit:N),W.upperRadiusLimit&&(N=N>W.upperRadiusLimit?W.upperRadiusLimit:N),N}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const V=i.d.Now-this._lastInteractionTime,p=.5*Math.PI-this._defaultElevation,W=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>W&&V>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=u.d.CreateAnimation("beta",u.d.ANIMATIONTYPE_FLOAT,60,O.EasingFunction));const V=u.d.TransitionTo("beta",p,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));V&&this._animatables.push(V)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=i.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}O.EasingFunction=new class extends k{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=V}easeInCore(V){return this.exponent<=0?V:(Math.exp(this.exponent*V)-1)/(Math.exp(this.exponent)-1)}},O.EasingMode=k.EASINGMODE_EASEINOUT,O.IgnoreBoundsSizeMode=0,O.FitFrustumSidesMode=1;var U=W(11524),F=W(12470),C=W(12476),A=W(10848);class v{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(V){V=A.e.BackCompatCameraNoPreventDefault(arguments);const p=this.camera.getEngine(),W=p.getInputElement();let N=0,d=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=E=>{var z,S;const Q=E.event,i="touch"===Q.pointerType;if(E.type!==J.d.POINTERMOVE&&-1===this.buttons.indexOf(Q.button))return;const l=Q.target;if(this._altKey=Q.altKey,this._ctrlKey=Q.ctrlKey,this._metaKey=Q.metaKey,this._shiftKey=Q.shiftKey,this._buttonsPressed=Q.buttons,p.isPointerLock){const V=Q.movementX,p=Q.movementY;this.onTouch(null,V,p),this._pointA=null,this._pointB=null}else{if(E.type!==J.d.POINTERDOWN&&E.type!==J.d.POINTERDOUBLETAP&&i&&(null===(z=this._pointA)||void 0===z?void 0:z.pointerId)!==Q.pointerId&&(null===(S=this._pointB)||void 0===S?void 0:S.pointerId)!==Q.pointerId)return;if(E.type!==J.d.POINTERDOWN||-1!==this._currentActiveButton&&!i)if(E.type===J.d.POINTERDOUBLETAP)this.onDoubleTap(Q.pointerType);else if(E.type!==J.d.POINTERUP||this._currentActiveButton!==Q.button&&!i){if(E.type===J.d.POINTERMOVE)if(V||Q.preventDefault(),this._pointA&&null===this._pointB){const V=Q.clientX-this._pointA.x,p=Q.clientY-this._pointA.y;this._pointA.x=Q.clientX,this._pointA.y=Q.clientY,this.onTouch(this._pointA,V,p)}else if(this._pointA&&this._pointB){const V=this._pointA.pointerId===Q.pointerId?this._pointA:this._pointB;V.x=Q.clientX,V.y=Q.clientY;const p=this._pointA.x-this._pointB.x,W=this._pointA.y-this._pointB.y,z=p*p+W*W,S={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:Q.pointerId,type:E.type};this.onMultiTouch(this._pointA,this._pointB,N,z,d,S),d=S,N=z}}else{try{null===l||void 0===l||l.releasePointerCapture(Q.pointerId)}catch(j){}i||(this._pointB=null),p._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==Q.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==Q.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==N||d)&&(this.onMultiTouch(this._pointA,this._pointB,N,0,d,null),N=0,d=null),this._currentActiveButton=-1,this.onButtonUp(Q),V||Q.preventDefault()}else{try{null===l||void 0===l||l.setPointerCapture(Q.pointerId)}catch(j){}if(null===this._pointA)this._pointA={x:Q.clientX,y:Q.clientY,pointerId:Q.pointerId,type:Q.pointerType};else{if(null!==this._pointB)return;this._pointB={x:Q.clientX,y:Q.clientY,pointerId:Q.pointerId,type:Q.pointerType}}-1!==this._currentActiveButton||i||(this._currentActiveButton=Q.button),this.onButtonDown(Q),V||(Q.preventDefault(),W&&W.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,J.d.POINTERDOWN|J.d.POINTERUP|J.d.POINTERMOVE|J.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,N=0,d=null,this.onLostFocus()},this._contextMenuBind=V=>this.onContextMenu(V),W&&W.addEventListener("contextmenu",this._contextMenuBind,!1);const E=this.camera.va().getEngine().getHostWindow();E&&A.e.RegisterTopRootEvents(E,[{name:"blur",handler:this._onLostFocus}])}Hi(){if(this._onLostFocus){const V=this.camera.va().getEngine().getHostWindow();V&&A.e.UnregisterTopRootEvents(V,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const V=this.camera.va().getEngine().getInputElement();V&&V.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(V){}onTouch(V,p,W){}onMultiTouch(V,p,W,N,d,E){}onContextMenu(V){V.preventDefault()}onButtonDown(V){}onButtonUp(V){}onLostFocus(){}}(0,N.c)([(0,d.I)()],v.prototype,"buttons",void 0);class t extends v{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(V,p){if(0!==this.panningSensibility&&V&&p){const W=p.x-V.x,N=p.y-V.y;this.camera.inertialPanningX+=-W/this.panningSensibility,this.camera.inertialPanningY+=N/this.panningSensibility}}_computePinchZoom(V,p){const W=this.camera.radius||t.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=W*Math.sqrt(V)/Math.sqrt(p):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(p-V)*W*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(p-V)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(V,p,W){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-p/this.panningSensibility,this.camera.inertialPanningY+=W/this.panningSensibility):(this.camera.inertialAlphaOffset-=p/this.angularSensibilityX,this.camera.inertialBetaOffset-=W/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(V,p,W,N,d,E){0===W&&null===d||0===N&&null===E||(this.multiTouchPanAndZoom?(this._computePinchZoom(W,N),this._computeMultiTouchPanning(d,E)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(N)-Math.sqrt(W))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(W,N),this._isPinching=!0):this._computeMultiTouchPanning(d,E)):this.multiTouchPanning?this._computeMultiTouchPanning(d,E):this.pinchZoom&&this._computePinchZoom(W,N))}onButtonDown(V){this._isPanClick=V.button===this.camera._panningMouseButton}onButtonUp(V){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}t.MinimumRadiusForPinch=.001,(0,N.c)([(0,d.I)()],t.prototype,"buttons",void 0),(0,N.c)([(0,d.I)()],t.prototype,"angularSensibilityX",void 0),(0,N.c)([(0,d.I)()],t.prototype,"angularSensibilityY",void 0),(0,N.c)([(0,d.I)()],t.prototype,"pinchPrecision",void 0),(0,N.c)([(0,d.I)()],t.prototype,"pinchDeltaPercentage",void 0),(0,N.c)([(0,d.I)()],t.prototype,"useNaturalPinchZoom",void 0),(0,N.c)([(0,d.I)()],t.prototype,"pinchZoom",void 0),(0,N.c)([(0,d.I)()],t.prototype,"panningSensibility",void 0),(0,N.c)([(0,d.I)()],t.prototype,"multiTouchPanning",void 0),(0,N.c)([(0,d.I)()],t.prototype,"multiTouchPanAndZoom",void 0),C.c.ArcRotateCameraPointersInput=t;var e=W(11335);class Z{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(V){V=A.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((p=>{const W=p.event;if(!W.metaKey)if(p.type===e.e.KEYDOWN){if(this._ctrlPressed=W.ctrlKey,this._altPressed=W.altKey,-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysReset.indexOf(W.keyCode)){-1===this._keys.indexOf(W.keyCode)&&this._keys.push(W.keyCode),W.preventDefault&&(V||W.preventDefault())}}else if(-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysReset.indexOf(W.keyCode)){const p=this._keys.indexOf(W.keyCode);p>=0&&this._keys.splice(p,1),W.preventDefault&&(V||W.preventDefault())}})))}Hi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const V=this.camera;for(let p=0;p<this._keys.length;p++){const W=this._keys[p];-1!==this.keysLeft.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningX-=1/this.panningSensibility:V.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?V.inertialRadiusOffset+=1/this.zoomingSensibility:V.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningX+=1/this.panningSensibility:V.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(W)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?V.inertialRadiusOffset-=1/this.zoomingSensibility:V.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(W)&&V.useInputToRestoreState&&V.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,N.c)([(0,d.I)()],Z.prototype,"keysUp",void 0),(0,N.c)([(0,d.I)()],Z.prototype,"keysDown",void 0),(0,N.c)([(0,d.I)()],Z.prototype,"keysLeft",void 0),(0,N.c)([(0,d.I)()],Z.prototype,"keysRight",void 0),(0,N.c)([(0,d.I)()],Z.prototype,"keysReset",void 0),(0,N.c)([(0,d.I)()],Z.prototype,"panningSensibility",void 0),(0,N.c)([(0,d.I)()],Z.prototype,"zoomingSensibility",void 0),(0,N.c)([(0,d.I)()],Z.prototype,"useAltToZoom",void 0),(0,N.c)([(0,d.I)()],Z.prototype,"angularSpeed",void 0),C.c.ArcRotateCameraKeyboardMoveInput=Z;var o=W(11361),K=W(11340),h=W(11242);class L{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new z.n(0,0,0),this._globalOffset=new z.n(0,0,0),this._inertialPanning=z.n.Zero()}_computeDeltaFromMouseWheelLegacyEvent(V,p){let W=0;const N=.01*V*this.wheelDeltaPercentage*p;return W=V>0?N/(1+this.wheelDeltaPercentage):N*(1+this.wheelDeltaPercentage),W}attachControl(V){V=A.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=p=>{if(p.type!==J.d.POINTERWHEEL)return;const W=p.event;let N=0;const d=W.deltaMode===K.b.DOM_DELTA_LINE?40:1,E=-W.deltaY*d;if(this.customComputeDeltaFromMouseWheel)N=this.customComputeDeltaFromMouseWheel(E,this,W);else if(this.wheelDeltaPercentage){if(N=this._computeDeltaFromMouseWheelLegacyEvent(E,this.camera.radius),N>0){let V=this.camera.radius,p=this.camera.inertialRadiusOffset+N;for(let W=0;W<20&&Math.abs(p)>.001;W++)V-=p,p*=this.camera.inertia;V=(0,h.d)(V,0,Number.MAX_VALUE),N=this._computeDeltaFromMouseWheelLegacyEvent(E,V)}}else N=E/(40*this.wheelPrecision);N&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(N)):this.camera.inertialRadiusOffset+=N),W.preventDefault&&(V||W.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,J.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.ee(0)}Hi(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const V=this.camera;0+V.inertialAlphaOffset+V.inertialBetaOffset+V.inertialRadiusOffset&&(this._updateHitPlane(),V.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(V.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const V=this.camera,p=V.target.ed(V.position);this._hitPlane=o.b.FromPositionAndNormal(V.target,p)}_getPosition(){const V=this.camera,p=V.va(),W=p.createPickingRay(p.pointerX,p.pointerY,z.e.Identity(),V,!1);0===V.targetScreenOffset.x&&0===V.targetScreenOffset.y||(this._viewOffset.set(V.targetScreenOffset.x,V.targetScreenOffset.y,0),V.getViewMatrix().invertToRef(V._cameraTransformMatrix),this._globalOffset=z.n.TransformNormal(this._viewOffset,V._cameraTransformMatrix),W.origin.addInPlace(this._globalOffset));let N=0;return this._hitPlane&&(N=W.intersectsPlane(this._hitPlane)??0),W.origin.addInPlace(W.direction.scaleInPlace(N))}_zoomToMouse(V){const p=this.camera,W=1-p.inertia;if(p.lowerRadiusLimit){const N=p.lowerRadiusLimit??0;p.radius-(p.inertialRadiusOffset+V)/W<N&&(V=(p.radius-N)*W-p.inertialRadiusOffset)}if(p.upperRadiusLimit){const N=p.upperRadiusLimit??0;p.radius-(p.inertialRadiusOffset+V)/W>N&&(V=(p.radius-N)*W-p.inertialRadiusOffset)}const N=V/W/p.radius,d=this._getPosition(),E=z.i.fb[6];d.subtractToRef(p.target,E),E.scaleInPlace(N),E.scaleInPlace(W),this._inertialPanning.addInPlace(E),p.inertialRadiusOffset+=V}_zeroIfClose(V){Math.abs(V.x)<l.c&&(V.x=0),Math.abs(V.y)<l.c&&(V.y=0),Math.abs(V.z)<l.c&&(V.z=0)}}(0,N.c)([(0,d.I)()],L.prototype,"wheelPrecision",void 0),(0,N.c)([(0,d.I)()],L.prototype,"zoomToMouseLocation",void 0),(0,N.c)([(0,d.I)()],L.prototype,"wheelDeltaPercentage",void 0),C.c.ArcRotateCameraMouseWheelInput=L;class x extends C.d{constructor(V){super(V)}addMouseWheel(){return this.add(new L),this}addPointers(){return this.add(new t),this}addKeyboard(){return this.add(new Z),this}}var T=W(11004);S.b.AddNodeConstructor("ArcRotateCamera",((V,p)=>()=>new P(V,0,0,1,z.n.Zero(),p)));class P extends F.c{get target(){return this._target}set target(V){this.setTarget(V)}get targetHost(){return this._targetHost}set targetHost(V){V&&this.setTarget(V)}getTarget(){return this.target}get position(){return this._position}set position(V){this.setPosition(V)}set upVector(V){this._upToYMatrix||(this._yToUpMatrix=new z.e,this._upToYMatrix=new z.e,this._upVector=z.n.Zero()),V.normalize(),this._upVector.p(V),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){z.e.RotationAlignToRef(z.n.UpReadOnly,this._upVector,this._yToUpMatrix),z.e.RotationAlignToRef(this._upVector,z.n.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const V=this.inputs.attached.pointers;return V?V.angularSensibilityX:0}set angularSensibilityX(V){const p=this.inputs.attached.pointers;p&&(p.angularSensibilityX=V)}get angularSensibilityY(){const V=this.inputs.attached.pointers;return V?V.angularSensibilityY:0}set angularSensibilityY(V){const p=this.inputs.attached.pointers;p&&(p.angularSensibilityY=V)}get pinchPrecision(){const V=this.inputs.attached.pointers;return V?V.pinchPrecision:0}set pinchPrecision(V){const p=this.inputs.attached.pointers;p&&(p.pinchPrecision=V)}get pinchDeltaPercentage(){const V=this.inputs.attached.pointers;return V?V.pinchDeltaPercentage:0}set pinchDeltaPercentage(V){const p=this.inputs.attached.pointers;p&&(p.pinchDeltaPercentage=V)}get useNaturalPinchZoom(){const V=this.inputs.attached.pointers;return!!V&&V.useNaturalPinchZoom}set useNaturalPinchZoom(V){const p=this.inputs.attached.pointers;p&&(p.useNaturalPinchZoom=V)}get panningSensibility(){const V=this.inputs.attached.pointers;return V?V.panningSensibility:0}set panningSensibility(V){const p=this.inputs.attached.pointers;p&&(p.panningSensibility=V)}get keysUp(){const V=this.inputs.attached.keyboard;return V?V.keysUp:[]}set keysUp(V){const p=this.inputs.attached.keyboard;p&&(p.keysUp=V)}get keysDown(){const V=this.inputs.attached.keyboard;return V?V.keysDown:[]}set keysDown(V){const p=this.inputs.attached.keyboard;p&&(p.keysDown=V)}get keysLeft(){const V=this.inputs.attached.keyboard;return V?V.keysLeft:[]}set keysLeft(V){const p=this.inputs.attached.keyboard;p&&(p.keysLeft=V)}get keysRight(){const V=this.inputs.attached.keyboard;return V?V.keysRight:[]}set keysRight(V){const p=this.inputs.attached.keyboard;p&&(p.keysRight=V)}get wheelPrecision(){const V=this.inputs.attached.mousewheel;return V?V.wheelPrecision:0}set wheelPrecision(V){const p=this.inputs.attached.mousewheel;p&&(p.wheelPrecision=V)}get zoomToMouseLocation(){const V=this.inputs.attached.mousewheel;return!!V&&V.zoomToMouseLocation}set zoomToMouseLocation(V){const p=this.inputs.attached.mousewheel;p&&(p.zoomToMouseLocation=V)}get wheelDeltaPercentage(){const V=this.inputs.attached.mousewheel;return V?V.wheelDeltaPercentage:0}set wheelDeltaPercentage(V){const p=this.inputs.attached.mousewheel;p&&(p.wheelDeltaPercentage=V)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(V){V!==this.useBouncingBehavior&&(V?(this._bouncingBehavior=new f,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(V){V!==this.useFramingBehavior&&(V?(this._framingBehavior=new O,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(V){V!==this.useAutoRotationBehavior&&(V?(this._autoRotationBehavior=new j,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(V,p,W,N,d,S){var Q;let J=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(V,z.n.Zero(),S,J),Q=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=z.n.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=z.k.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new z.e,this.panningAxis=new z.n(1,1,0),this._transformedDirection=new z.n,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new E.b,this.checkCollisions=!1,this.collisionRadius=new z.n(.5,.5,.5),this._previousPosition=z.n.Zero(),this._collisionVelocity=z.n.Zero(),this._newPosition=z.n.Zero(),this._computationVector=z.n.Zero(),this._onCollisionPositionChange=function(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;W?(Q.setPosition(p),Q.xk&&Q.xk(W)):Q._previousPosition.p(Q._position);const N=Math.cos(Q.alpha),d=Math.sin(Q.alpha),E=Math.cos(Q.beta);let z=Math.sin(Q.beta);0===z&&(z=1e-4);const S=Q._getTargetPosition();Q._computationVector.ge(Q.radius*N*z,Q.radius*E,Q.radius*d*z),S.addToRef(Q._computationVector,Q._newPosition),Q._position.p(Q._newPosition);let J=Q.upVector;Q.allowUpsideDown&&Q.beta<0&&(J=J.clone(),J=J.negate()),Q._computeViewMatrix(Q._position,S,J),Q._viewMatrix.addAtIndex(12,Q.targetScreenOffset.x),Q._viewMatrix.addAtIndex(13,Q.targetScreenOffset.y),Q._collisionTriggered=!1},this._target=z.n.Zero(),d&&this.setTarget(d),this.alpha=p,this.beta=W,this.radius=N,this.getViewMatrix(),this.inputs=new x(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new z.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=z.k.Zero()}_updateCache(V){V||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const V=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?V.addToRef(this._targetBoundingCenter,this._target):this._target.p(V)}const V=this._getLockedTargetPosition();return V||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>l.c&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(V,p){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const d=arguments;p=A.e.BackCompatCameraNoPreventDefault(d),this._useCtrlForPanning=W,this._panningMouseButton=N,"boolean"===typeof d[0]&&(d.length>1&&(this._useCtrlForPanning=d[1]),d.length>2&&(this._panningMouseButton=d[2])),this.inputs.attachElement(p),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Hi(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const V=this._scene.getEngine().getDeltaTime()/1e3,p=1-Math.pow(2,-V/this.restoreStateInterpolationFactor);this.setTarget(z.n.Lerp(this.getTarget(),this._storedTarget,p)),z.f.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,z.i.Quaternion[0]),z.f.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,z.i.Quaternion[1]),z.f.SlerpToRef(z.i.Quaternion[1],z.i.Quaternion[0],p,z.i.Quaternion[2]),z.i.Quaternion[2].normalize(),z.i.Quaternion[2].toAlphaBetaGammaToRef(z.i.fb[0]),this.alpha=z.i.fb[0].x,this.beta=z.i.fb[0].y,this.radius+=(this._storedRadius-this.radius)*p,z.k.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,p,this.targetScreenOffset),(z.n.DistanceSquared(this.getTarget(),this._storedTarget)<l.c&&z.i.Quaternion[2].equalsWithEpsilon(z.i.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<l.c&&z.k.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<l.c||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const V=this.invertRotation?-1:1,p=this._calculateHandednessMultiplier();let W=this.inertialAlphaOffset*p;this.beta<0&&(W*=-1),this.alpha+=W*V,this.beta+=this.inertialBetaOffset*V,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<l.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<l.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*l.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const V=new z.n(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),V.multiplyInPlace(this.panningAxis),z.n.TransformNormalToRef(V,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const V=this.upVector,p=z.n.CrossToRef(this._transformedDirection,V,this._transformedDirection);z.n.CrossToRef(V,p,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);z.n.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const V=z.i.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(V),V.transposeToRef(V),z.n.TransformCoordinatesToRef(this._transformedDirection,V,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*l.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*l.c&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||z.n.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const V=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const p=Math.round((V-this.alpha)/(2*Math.PI));this.alpha+=2*p*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(V){this._position.equals(V)||(this._position.p(V),this.rebuildAnglesAndRadius())}setTarget(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(N=this.overrideCloneAlphaBetaRadius??N,V.Dj)p&&V.getBoundingInfo?this._targetBoundingCenter=V.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,V.Dj(),this._targetHost=V,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const p=V,N=this._getTargetPosition();if(N&&!W&&N.equals(p))return;this._targetHost=null,this._target=p,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}N||this.rebuildAnglesAndRadius()}_getViewMatrix(){const V=Math.cos(this.alpha),p=Math.sin(this.alpha),W=Math.cos(this.beta);let N=Math.sin(this.beta);0===N&&(N=1e-4),0===this.radius&&(this.radius=1e-4);const d=this._getTargetPosition();if(this._computationVector.ge(this.radius*V*N,this.radius*W,this.radius*p*N),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||z.n.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),d.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const V=this.va().collisionCoordinator;this._collider||(this._collider=V.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,V.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let V=this.upVector;this.allowUpsideDown&&N<0&&(V=V.negate()),this._computeViewMatrix(this._position,d,V),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=d,this._viewMatrix}zoomOn(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V=V||this.va().meshes;const W=Q.e.MinMax(V);let N=this._calculateLowerRadiusFromModelBoundingSphere(W.min,W.max);N=Math.max(Math.min(N,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=N*this.zoomOnFactor,this.focusOn({min:W.min,max:W.max,distance:N},p)}focusOn(V){let p,W,N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===V.min){const N=V||this.va().meshes;p=Q.e.MinMax(N),W=z.n.Distance(p.min,p.max)}else{p=V,W=V.distance}this._target=Q.e.Center(p),N||(this.maxZ=2*W)}createRigCamera(V,p){let W=0;switch(this.cameraRigMode){case U.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.d.RIG_MODE_VR:W=this._cameraRigParams.stereoHalfAngle*(0===p?1:-1);break;case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:W=this._cameraRigParams.stereoHalfAngle*(0===p?-1:1)}const N=new P(V,this.alpha+W,this.beta,this.radius,this._target,this.va());return N._cameraRigParams={},N.isRigCamera=!0,N.rigParent=this,N.upVector=this.upVector,N.mode=this.mode,N.orthoLeft=this.orthoLeft,N.orthoRight=this.orthoRight,N.orthoBottom=this.orthoBottom,N.orthoTop=this.orthoTop,N}_updateRigCameras(){const V=this._rigCameras[0],p=this._rigCameras[1];switch(V.beta=p.beta=this.beta,this.cameraRigMode){case U.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.d.RIG_MODE_VR:V.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,p.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:V.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,p.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const N=z.n.Distance(V,p),d=this.va().getEngine().getAspectRatio(this),E=Math.tan(this.fov/2),S=E*d,Q=.5*N*W,J=Q*Math.sqrt(1+1/(S*S)),i=Q*Math.sqrt(1+1/(E*E));return Math.max(J,i)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,N.c)([(0,d.I)()],P.prototype,"alpha",void 0),(0,N.c)([(0,d.I)()],P.prototype,"beta",void 0),(0,N.c)([(0,d.I)()],P.prototype,"radius",void 0),(0,N.c)([(0,d.I)()],P.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,N.c)([(0,d.F)("target")],P.prototype,"_target",void 0),(0,N.c)([(0,d.u)("targetHost")],P.prototype,"_targetHost",void 0),(0,N.c)([(0,d.I)()],P.prototype,"inertialAlphaOffset",void 0),(0,N.c)([(0,d.I)()],P.prototype,"inertialBetaOffset",void 0),(0,N.c)([(0,d.I)()],P.prototype,"inertialRadiusOffset",void 0),(0,N.c)([(0,d.I)()],P.prototype,"lowerAlphaLimit",void 0),(0,N.c)([(0,d.I)()],P.prototype,"upperAlphaLimit",void 0),(0,N.c)([(0,d.I)()],P.prototype,"lowerBetaLimit",void 0),(0,N.c)([(0,d.I)()],P.prototype,"upperBetaLimit",void 0),(0,N.c)([(0,d.I)()],P.prototype,"lowerRadiusLimit",void 0),(0,N.c)([(0,d.I)()],P.prototype,"upperRadiusLimit",void 0),(0,N.c)([(0,d.I)()],P.prototype,"inertialPanningX",void 0),(0,N.c)([(0,d.I)()],P.prototype,"inertialPanningY",void 0),(0,N.c)([(0,d.I)()],P.prototype,"pinchToPanMaxDistance",void 0),(0,N.c)([(0,d.I)()],P.prototype,"panningDistanceLimit",void 0),(0,N.c)([(0,d.F)()],P.prototype,"panningOriginTarget",void 0),(0,N.c)([(0,d.I)()],P.prototype,"panningInertia",void 0),(0,N.c)([(0,d.I)()],P.prototype,"zoomToMouseLocation",null),(0,N.c)([(0,d.I)()],P.prototype,"zoomOnFactor",void 0),(0,N.c)([(0,d.D)()],P.prototype,"targetScreenOffset",void 0),(0,N.c)([(0,d.I)()],P.prototype,"allowUpsideDown",void 0),(0,N.c)([(0,d.I)()],P.prototype,"useInputToRestoreState",void 0),(0,N.c)([(0,d.I)()],P.prototype,"restoreStateInterpolationFactor",void 0),(0,T.d)("BABYLON.ArcRotateCamera",P)},11524:(V,p,W)=>{"use strict";W.d(p,{d:()=>O});var N=W(11167),d=W(11175),E=W(11191),z=W(10848),S=W(10856),Q=W(11218),J=W(11529),i=W(10870),l=W(11004),j=W(10887),k=W(11538),u=W(11352),f=W(11265);class O extends J.b{get position(){return this._position}set position(V){this._position=V}set upVector(V){this._upVector=V}get upVector(){return this._upVector}get screenArea(){let V=0,p=0;if(this.mode===O.PERSPECTIVE_CAMERA)this.fovMode===O.FOVMODE_VERTICAL_FIXED?(p=2*this.Li*Math.tan(this.fov/2),V=this.getEngine().getAspectRatio(this)*p):(V=2*this.Li*Math.tan(this.fov/2),p=V/this.getEngine().getAspectRatio(this));else{const W=this.getEngine().getRenderWidth()/2,N=this.getEngine().getRenderHeight()/2;V=(this.orthoRight??W)-(this.orthoLeft??-W),p=(this.orthoTop??N)-(this.orthoBottom??-N)}return V*p}set orthoLeft(V){this._orthoLeft=V;for(const p of this._rigCameras)p.orthoLeft=V}get orthoLeft(){return this._orthoLeft}set orthoRight(V){this._orthoRight=V;for(const p of this._rigCameras)p.orthoRight=V}get orthoRight(){return this._orthoRight}set orthoBottom(V){this._orthoBottom=V;for(const p of this._rigCameras)p.orthoBottom=V}get orthoBottom(){return this._orthoBottom}set orthoTop(V){this._orthoTop=V;for(const p of this._rigCameras)p.orthoTop=V}get orthoTop(){return this._orthoTop}set mode(V){this._mode=V;for(const p of this._rigCameras)p.mode=V}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(V,p,W){let N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(V,W,!1),this._position=Q.n.Zero(),this._upVector=Q.n.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Li=1,this.maxZ=1e4,this.inertia=.9,this._mode=O.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new k.d(0,0,1,1),this.layerMask=268435455,this.fovMode=O.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=O.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new S.b,this.onProjectionMatrixChangedObservable=new S.b,this.onAfterCheckInputsObservable=new S.b,this.onRestoreStateObservable=new S.b,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new Q.e,this._postProcesses=new Array,this._activeMeshes=new E.f(256),this._globalPosition=Q.n.Zero(),this._computedViewMatrix=Q.e.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=Q.e.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=Q.f.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),N&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=p,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${V}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"ph"}toString(V){let p="Name: "+this.name;if(p+=", type: "+this.getClassName(),this.animations)for(let W=0;W<this.animations.length;W++)p+=", animation[0]: "+this.animations[W].toString(V);return p}applyVerticalCorrection(){const V=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-V.x:V.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(V){return-1!==this._activeMeshes.indexOf(V)}isReady(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(V)for(const p of this._postProcesses)if(p&&!p.isReady())return!1;return super.isReady(V)}_initCache(){super._initCache(),this._cache.position=new Q.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new Q.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Li=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(V){V||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let V=this._cache.mode===this.mode&&this._cache.Li===this.Li&&this._cache.maxZ===this.maxZ;if(!V)return!1;const p=this.getEngine();return this.mode===O.PERSPECTIVE_CAMERA?V=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===p.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(V=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===p.getRenderWidth()&&this._cache.renderHeight===p.getRenderHeight(),this.oblique&&(V=V&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),V}attachControl(V,p){}Hi(V){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==O.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let V=0;V<this._postProcesses.length;V++)if(null!==this._postProcesses[V])return this._postProcesses[V];return null}_cascadePostProcessesToRigCams(){const V=this._getFirstPostProcess();V&&V.markTextureDirty();for(let p=0,W=this._rigCameras.length;p<W;p++){const V=this._rigCameras[p],W=V._rigPostProcess;if(W){"pass"===W.getEffectName()&&(V.isIntermediate=0===this._postProcesses.length),V._postProcesses=this._postProcesses.slice(0).concat(W),W.markTextureDirty()}else V._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!V.isReusable()&&this._postProcesses.indexOf(V)>-1?(i.e.Error("You're trying to reuse a post process not defined as reusable."),0):(null==p||p<0?this._postProcesses.push(V):null===this._postProcesses[p]?this._postProcesses[p]=V:this._postProcesses.splice(p,0,V),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Jg(),this._postProcesses.indexOf(V))}detachPostProcess(V){const p=this._postProcesses.indexOf(V);-1!==p&&(this._postProcesses[p]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Jg(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return Q.e.Identity()}getViewMatrix(V){return!V&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(V){this._doNotComputeProjectionMatrix=!0,void 0!==V&&(this._projectionMatrix=V)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(V){if(this._doNotComputeProjectionMatrix||!V&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Li=this.Li,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const p=this.getEngine(),W=this.va(),N=p.useReverseDepthBuffer;if(this.mode===O.PERSPECTIVE_CAMERA){let V;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=p.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Li<=0&&(this.Li=.1),V=W.useRightHandedSystem?Q.e.PerspectiveFovRHToRef:Q.e.PerspectiveFovLHToRef,V(this.fov,p.getAspectRatio(this),N?this.maxZ:this.Li,N?this.Li:this.maxZ,this._projectionMatrix,this.fovMode===O.FOVMODE_VERTICAL_FIXED,p.isNDCHalfZRange,this.projectionPlaneTilt,N)}else{var d,E,z;const V=p.getRenderWidth()/2,S=p.getRenderHeight()/2;W.useRightHandedSystem?this.oblique?Q.e.ObliqueOffCenterRHToRef(this.orthoLeft??-V,this.orthoRight??V,this.orthoBottom??-S,this.orthoTop??S,N?this.maxZ:this.Li,N?this.Li:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,p.isNDCHalfZRange):Q.e.OrthoOffCenterRHToRef(this.orthoLeft??-V,this.orthoRight??V,this.orthoBottom??-S,this.orthoTop??S,N?this.maxZ:this.Li,N?this.Li:this.maxZ,this._projectionMatrix,p.isNDCHalfZRange):this.oblique?Q.e.ObliqueOffCenterLHToRef(this.orthoLeft??-V,this.orthoRight??V,this.orthoBottom??-S,this.orthoTop??S,N?this.maxZ:this.Li,N?this.Li:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,p.isNDCHalfZRange):Q.e.OrthoOffCenterLHToRef(this.orthoLeft??-V,this.orthoRight??V,this.orthoBottom??-S,this.orthoTop??S,N?this.maxZ:this.Li,N?this.Li:this.maxZ,this._projectionMatrix,p.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(d=this.oblique)||void 0===d?void 0:d.angle,this._cache.obliqueLength=null===(E=this.oblique)||void 0===E?void 0:E.length,this._cache.obliqueOffset=null===(z=this.oblique)||void 0===z?void 0:z.offset,this._cache.renderWidth=p.getRenderWidth(),this._cache.renderHeight=p.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(V){return(this.radius||(this.target?Q.n.Distance(this.position,this.target):this.position.length()))+V}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?u.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=u.b.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),p&&this.rigCameras.length>0){let p=!1;return this.rigCameras.forEach((W=>{W._updateFrustumPlanes(),p=p||V.isInFrustum(W._frustumPlanes)})),p}return V.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(V){return this._updateFrustumPlanes(),V.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,j.c)("Ray")}getForwardRayToRef(V){throw(0,j.c)("Ray")}dispose(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const V=this._rigCameras.pop();V&&V.dispose()}if(this._parentContainer){const V=this._parentContainer.cameras.indexOf(this);V>-1&&this._parentContainer.cameras.splice(V,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==O.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let V=this._postProcesses.length;for(;--V>=0;){const p=this._postProcesses[V];p&&p.dispose(this)}}let W=this.customRenderTargets.length;for(;--W>=0;)this.customRenderTargets[W].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(V,p)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(V,p){if(this.cameraRigMode!==V){for(;this._rigCameras.length>0;){const V=this._rigCameras.pop();V&&V.dispose()}if(this.cameraRigMode=V,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=p.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=z.e.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==O.RIG_MODE_NONE){const V=this.createRigCamera(this.name+"_L",0);V&&(V._isLeftCamera=!0);const p=this.createRigCamera(this.name+"_R",1);p&&(p._isRightCamera=!0),V&&p&&(this._rigCameras.push(V),this._rigCameras.push(p))}this._setRigMode(p),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(V){}_getVRProjectionMatrix(){return Q.e.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Li,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(V,p){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[V]=p,"interaxialDistance"===V&&(this._cameraRigParams.stereoHalfAngle=z.e.ToRadians(p/.0637))}createRigCamera(V,p){return null}_updateRigCameras(){for(let V=0;V<this._rigCameras.length;V++)this._rigCameras[V].Li=this.Li,this._rigCameras[V].maxZ=this.maxZ,this._rigCameras[V].fov=this.fov,this._rigCameras[V].upVector.p(this.upVector);this.cameraRigMode===O.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const V=f.b.Serialize(this);return V.uniqueId=this.uniqueId,V.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(V),this.inputs&&this.inputs.serialize(V),f.b.AppendSerializedAnimations(this,V),V.ranges=this.serializeAnimationRanges(),V.isEnabled=this.isEnabled(),V}clone(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=f.b.Clone(O.GetConstructorFromName(this.getClassName(),V,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return W.name=V,W.parent=p,this.onClonedObservable.notifyObservers(W),W}Ze(V){const p=Q.n.Zero();return this.getDirectionToRef(V,p),p}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(V,p){Q.n.TransformNormalToRef(V,this.getWorldMatrix(),p)}static GetConstructorFromName(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const E=J.b.Construct(V,p,W,{interaxial_distance:N,isStereoscopicSideBySide:d});return E||(()=>O._CreateDefaultParsedCamera(p,W))}Dj(){return this.getWorldMatrix()}static Parse(V,p){const W=V.type,N=O.GetConstructorFromName(W,V.name,p,V.interaxial_distance,V.isStereoscopicSideBySide),d=f.b.Parse(N,V,p);if(void 0!==V.parentId&&(d._waitingParentId=V.parentId),void 0!==V.parentInstanceIndex&&(d._waitingParentInstanceIndex=V.parentInstanceIndex),d.inputs&&(d.inputs.parse(V),d._setupInputs()),V.upVector&&(d.upVector=Q.n.Tg(V.upVector)),d.setPosition&&(d.position.ge(0,0,0),d.setPosition(Q.n.Tg(V.position))),V.target&&d.setTarget&&d.setTarget(Q.n.Tg(V.target)),V.cameraRigMode){const p=V.interaxial_distance?{interaxialDistance:V.interaxial_distance}:{};d.setCameraRigMode(V.cameraRigMode,p)}if(V.animations){for(let p=0;p<V.animations.length;p++){const W=V.animations[p],N=(0,l.b)("BABYLON.Animation");N&&d.animations.push(N.Parse(W))}J.b.ParseAnimationRanges(d,V,p)}return V.autoAnimate&&p.beginAnimation(d,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),void 0!==V.isEnabled&&d.Ab(V.isEnabled),d}_calculateHandednessMultiplier(){let V=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(V*=-1),V}}O._CreateDefaultParsedCamera=(V,p)=>{throw(0,j.c)("UniversalCamera")},O.PERSPECTIVE_CAMERA=0,O.ORTHOGRAPHIC_CAMERA=1,O.FOVMODE_VERTICAL_FIXED=0,O.FOVMODE_HORIZONTAL_FIXED=1,O.RIG_MODE_NONE=0,O.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,O.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,O.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,O.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,O.RIG_MODE_STEREOSCOPIC_INTERLACED=14,O.RIG_MODE_VR=20,O.RIG_MODE_CUSTOM=22,O.ForceAttachControlToAlwaysPreventDefault=!1,(0,N.c)([(0,d.F)("position")],O.prototype,"_position",void 0),(0,N.c)([(0,d.F)("upVector")],O.prototype,"_upVector",void 0),(0,N.c)([(0,d.I)()],O.prototype,"orthoLeft",null),(0,N.c)([(0,d.I)()],O.prototype,"orthoRight",null),(0,N.c)([(0,d.I)()],O.prototype,"orthoBottom",null),(0,N.c)([(0,d.I)()],O.prototype,"orthoTop",null),(0,N.c)([(0,d.I)()],O.prototype,"fov",void 0),(0,N.c)([(0,d.I)()],O.prototype,"projectionPlaneTilt",void 0),(0,N.c)([(0,d.I)()],O.prototype,"Li",void 0),(0,N.c)([(0,d.I)()],O.prototype,"maxZ",void 0),(0,N.c)([(0,d.I)()],O.prototype,"inertia",void 0),(0,N.c)([(0,d.I)()],O.prototype,"mode",null),(0,N.c)([(0,d.I)()],O.prototype,"layerMask",void 0),(0,N.c)([(0,d.I)()],O.prototype,"fovMode",void 0),(0,N.c)([(0,d.I)()],O.prototype,"cameraRigMode",void 0),(0,N.c)([(0,d.I)()],O.prototype,"interaxialDistance",void 0),(0,N.c)([(0,d.I)()],O.prototype,"isStereoscopicSideBySide",void 0)},12476:(V,p,W)=>{"use strict";W.d(p,{c:()=>z,d:()=>S});var N=W(10870),d=W(11265),E=W(11524),z={};class S{constructor(V){this.attachedToElement=!1,this.attached={},this.camera=V,this.checkInputs=()=>{}}add(V){const p=V.getSimpleName();this.attached[p]?N.e.Warn("camera input of type "+p+" already exists on camera"):(this.attached[p]=V,V.camera=this.camera,V.checkInputs&&(this.checkInputs=this._addCheckInputs(V.checkInputs.bind(V))),this.attachedToElement&&V.attachControl(this.noPreventDefault))}remove(V){for(const p in this.attached){const W=this.attached[p];if(W===V)return W.Hi(),W.camera=null,delete this.attached[p],void this.rebuildInputCheck()}}removeByType(V){for(const p in this.attached){const W=this.attached[p];W.getClassName()===V&&(W.Hi(),W.camera=null,delete this.attached[p],this.rebuildInputCheck())}}_addCheckInputs(V){const p=this.checkInputs;return()=>{p(),V()}}attachInput(V){this.attachedToElement&&V.attachControl(this.noPreventDefault)}attachElement(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){V=!E.d.ForceAttachControlToAlwaysPreventDefault&&V,this.attachedToElement=!0,this.noPreventDefault=V;for(const p in this.attached)this.attached[p].attachControl(V)}}detachElement(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const p in this.attached)this.attached[p].Hi(),V&&(this.attached[p].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const V in this.attached){const p=this.attached[V];p.checkInputs&&(this.checkInputs=this._addCheckInputs(p.checkInputs.bind(p)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(V){const p={};for(const W in this.attached){const V=this.attached[W],N=d.b.Serialize(V);p[V.getClassName()]=N}V.inputsmgr=p}parse(V){const p=V.inputsmgr;if(p){this.clear();for(const V in p){const W=z[V];if(W){const N=p[V],E=d.b.Parse((()=>new W),N,null);this.add(E)}}}else for(const W in this.attached){const p=z[this.attached[W].getClassName()];if(p){const N=d.b.Parse((()=>new p),V,null);this.remove(this.attached[W]),this.add(N)}}}}},12467:(V,p,W)=>{"use strict";W.d(p,{e:()=>t});var N=W(11167),d=W(11175),E=W(11218),z=W(12470),S=W(12476),Q=W(11335),J=W(10848);class i{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(V){V=J.e.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((p=>{const W=p.event;if(!W.metaKey)if(p.type===Q.e.KEYDOWN){if(-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysUpward.indexOf(W.keyCode)||-1!==this.keysDownward.indexOf(W.keyCode)||-1!==this.keysRotateLeft.indexOf(W.keyCode)||-1!==this.keysRotateRight.indexOf(W.keyCode)||-1!==this.keysRotateUp.indexOf(W.keyCode)||-1!==this.keysRotateDown.indexOf(W.keyCode)){-1===this._keys.indexOf(W.keyCode)&&this._keys.push(W.keyCode),V||W.preventDefault()}}else if(-1!==this.keysUp.indexOf(W.keyCode)||-1!==this.keysDown.indexOf(W.keyCode)||-1!==this.keysLeft.indexOf(W.keyCode)||-1!==this.keysRight.indexOf(W.keyCode)||-1!==this.keysUpward.indexOf(W.keyCode)||-1!==this.keysDownward.indexOf(W.keyCode)||-1!==this.keysRotateLeft.indexOf(W.keyCode)||-1!==this.keysRotateRight.indexOf(W.keyCode)||-1!==this.keysRotateUp.indexOf(W.keyCode)||-1!==this.keysRotateDown.indexOf(W.keyCode)){const p=this._keys.indexOf(W.keyCode);p>=0&&this._keys.splice(p,1),V||W.preventDefault()}})))}Hi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const V=this.camera;for(let p=0;p<this._keys.length;p++){const W=this._keys[p],N=V._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(W)?V._localDirection.ge(-N,0,0):-1!==this.keysUp.indexOf(W)?V._localDirection.ge(0,0,N):-1!==this.keysRight.indexOf(W)?V._localDirection.ge(N,0,0):-1!==this.keysDown.indexOf(W)?V._localDirection.ge(0,0,-N):-1!==this.keysUpward.indexOf(W)?V._localDirection.ge(0,N,0):-1!==this.keysDownward.indexOf(W)?V._localDirection.ge(0,-N,0):-1!==this.keysRotateLeft.indexOf(W)?(V._localDirection.ge(0,0,0),V.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(W)?(V._localDirection.ge(0,0,0),V.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(W)?(V._localDirection.ge(0,0,0),V.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(W)&&(V._localDirection.ge(0,0,0),V.cameraRotation.x+=this._getLocalRotation()),V.va().useRightHandedSystem&&(V._localDirection.z*=-1),V.getViewMatrix().invertToRef(V._cameraTransformMatrix),E.n.TransformNormalToRef(V._localDirection,V._cameraTransformMatrix,V._transformedDirection),V.cameraDirection.addInPlace(V._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const V=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*V}}(0,N.c)([(0,d.I)()],i.prototype,"keysUp",void 0),(0,N.c)([(0,d.I)()],i.prototype,"keysUpward",void 0),(0,N.c)([(0,d.I)()],i.prototype,"keysDown",void 0),(0,N.c)([(0,d.I)()],i.prototype,"keysDownward",void 0),(0,N.c)([(0,d.I)()],i.prototype,"keysLeft",void 0),(0,N.c)([(0,d.I)()],i.prototype,"keysRight",void 0),(0,N.c)([(0,d.I)()],i.prototype,"rotationSpeed",void 0),(0,N.c)([(0,d.I)()],i.prototype,"keysRotateLeft",void 0),(0,N.c)([(0,d.I)()],i.prototype,"keysRotateRight",void 0),(0,N.c)([(0,d.I)()],i.prototype,"keysRotateUp",void 0),(0,N.c)([(0,d.I)()],i.prototype,"keysRotateDown",void 0),S.c.FreeCameraKeyboardMoveInput=i;var l=W(10856),j=W(11330);class k{constructor(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=V,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new l.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(V){V=J.e.BackCompatCameraNoPreventDefault(arguments);const p=this.camera.getEngine(),W=p.getInputElement();this._pointerInput||(this._pointerInput=N=>{const d=N.event,E="touch"===d.pointerType;if(!this.touchEnabled&&E)return;if(N.type!==j.d.POINTERMOVE&&-1===this.buttons.indexOf(d.button))return;const z=d.target;if(N.type===j.d.POINTERDOWN){if(E&&-1!==this._activePointerId||!E&&-1!==this._currentActiveButton)return;this._activePointerId=d.pointerId;try{null===z||void 0===z||z.setPointerCapture(d.pointerId)}catch(S){}-1===this._currentActiveButton&&(this._currentActiveButton=d.button),this._previousPosition={x:d.clientX,y:d.clientY},V||(d.preventDefault(),W&&W.focus()),p.isPointerLock&&this._onMouseMove&&this._onMouseMove(N.event)}else if(N.type===j.d.POINTERUP){if(E&&this._activePointerId!==d.pointerId||!E&&this._currentActiveButton!==d.button)return;try{null===z||void 0===z||z.releasePointerCapture(d.pointerId)}catch(S){}this._currentActiveButton=-1,this._previousPosition=null,V||d.preventDefault(),this._activePointerId=-1}else if(N.type===j.d.POINTERMOVE&&(this._activePointerId===d.pointerId||!E))if(p.isPointerLock&&this._onMouseMove)this._onMouseMove(N.event);else if(this._previousPosition){const p=this.camera._calculateHandednessMultiplier(),W=(d.clientX-this._previousPosition.x)*p,N=d.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=W/this.angularSensibility,this.camera.cameraRotation.x+=N/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:W,offsetY:N}),this._previousPosition={x:d.clientX,y:d.clientY},V||d.preventDefault()}}),this._onMouseMove=W=>{if(!p.isPointerLock)return;const N=this.camera._calculateHandednessMultiplier(),d=W.movementX*N;this.camera.cameraRotation.y+=d/this.angularSensibility;const E=W.movementY;this.camera.cameraRotation.x+=E/this.angularSensibility,this._previousPosition=null,V||W.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,j.d.POINTERDOWN|j.d.POINTERUP|j.d.POINTERMOVE),W&&(this._contextMenuBind=V=>this.onContextMenu(V),W.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(V){V.preventDefault()}Hi(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const V=this.camera.getEngine().getInputElement();V&&V.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,N.c)([(0,d.I)()],k.prototype,"buttons",void 0),(0,N.c)([(0,d.I)()],k.prototype,"angularSensibility",void 0),S.c.FreeCameraMouseInput=k;var u,f=W(11340);class O{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new l.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(V){V=J.e.BackCompatCameraNoPreventDefault(arguments),this._wheel=p=>{if(p.type!==j.d.POINTERWHEEL)return;const W=p.event,N=W.deltaMode===f.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*N*W.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*N*W.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*N*W.deltaZ/this._normalize,W.preventDefault&&(V||W.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,j.d.POINTERWHEEL)}Hi(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,N.c)([(0,d.I)()],O.prototype,"wheelPrecisionX",void 0),(0,N.c)([(0,d.I)()],O.prototype,"wheelPrecisionY",void 0),(0,N.c)([(0,d.I)()],O.prototype,"wheelPrecisionZ",void 0),function(V){V[V.MoveRelative=0]="MoveRelative",V[V.RotateRelative=1]="RotateRelative",V[V.MoveScene=2]="MoveScene"}(u||(u={}));class U extends O{constructor(){super(...arguments),this._moveRelative=E.n.Zero(),this._rotateRelative=E.n.Zero(),this._moveScene=E.n.Zero(),this._wheelXAction=u.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=u.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(V){null===V&&this._wheelXAction!==u.MoveRelative||(this._wheelXAction=u.MoveRelative,this._wheelXActionCoordinate=V)}get wheelXMoveRelative(){return this._wheelXAction!==u.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(V){null===V&&this._wheelYAction!==u.MoveRelative||(this._wheelYAction=u.MoveRelative,this._wheelYActionCoordinate=V)}get wheelYMoveRelative(){return this._wheelYAction!==u.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(V){null===V&&this._wheelZAction!==u.MoveRelative||(this._wheelZAction=u.MoveRelative,this._wheelZActionCoordinate=V)}get wheelZMoveRelative(){return this._wheelZAction!==u.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(V){null===V&&this._wheelXAction!==u.RotateRelative||(this._wheelXAction=u.RotateRelative,this._wheelXActionCoordinate=V)}get wheelXRotateRelative(){return this._wheelXAction!==u.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(V){null===V&&this._wheelYAction!==u.RotateRelative||(this._wheelYAction=u.RotateRelative,this._wheelYActionCoordinate=V)}get wheelYRotateRelative(){return this._wheelYAction!==u.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(V){null===V&&this._wheelZAction!==u.RotateRelative||(this._wheelZAction=u.RotateRelative,this._wheelZActionCoordinate=V)}get wheelZRotateRelative(){return this._wheelZAction!==u.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(V){null===V&&this._wheelXAction!==u.MoveScene||(this._wheelXAction=u.MoveScene,this._wheelXActionCoordinate=V)}get wheelXMoveScene(){return this._wheelXAction!==u.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(V){null===V&&this._wheelYAction!==u.MoveScene||(this._wheelYAction=u.MoveScene,this._wheelYActionCoordinate=V)}get wheelYMoveScene(){return this._wheelYAction!==u.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(V){null===V&&this._wheelZAction!==u.MoveScene||(this._wheelZAction=u.MoveScene,this._wheelZActionCoordinate=V)}get wheelZMoveScene(){return this._wheelZAction!==u.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.ee(0),this._rotateRelative.ee(0),this._moveScene.ee(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const V=E.e.Zero();this.camera.getViewMatrix().invertToRef(V);const p=E.n.Zero();E.n.TransformNormalToRef(this._moveRelative,V,p),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(p),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(V,p,W){if(0===V)return;if(null===p||null===W)return;let N=null;switch(p){case u.MoveRelative:N=this._moveRelative;break;case u.RotateRelative:N=this._rotateRelative;break;case u.MoveScene:N=this._moveScene}switch(W){case 0:N.set(V,0,0);break;case 1:N.set(0,V,0);break;case 2:N.set(0,0,V)}}}(0,N.c)([(0,d.I)()],U.prototype,"wheelXMoveRelative",null),(0,N.c)([(0,d.I)()],U.prototype,"wheelYMoveRelative",null),(0,N.c)([(0,d.I)()],U.prototype,"wheelZMoveRelative",null),(0,N.c)([(0,d.I)()],U.prototype,"wheelXRotateRelative",null),(0,N.c)([(0,d.I)()],U.prototype,"wheelYRotateRelative",null),(0,N.c)([(0,d.I)()],U.prototype,"wheelZRotateRelative",null),(0,N.c)([(0,d.I)()],U.prototype,"wheelXMoveScene",null),(0,N.c)([(0,d.I)()],U.prototype,"wheelYMoveScene",null),(0,N.c)([(0,d.I)()],U.prototype,"wheelZMoveScene",null),S.c.FreeCameraMouseWheelInput=U;class F{constructor(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=V,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=J.e.IsSafari()}attachControl(V){V=J.e.BackCompatCameraNoPreventDefault(arguments);let p=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=W=>{const N=W.event,d="mouse"===N.pointerType||this._isSafari&&"undefined"===typeof N.pointerType;if(this.allowMouse||!d)if(W.type===j.d.POINTERDOWN){if(V||N.preventDefault(),this._pointerPressed.push(N.pointerId),1!==this._pointerPressed.length)return;p={x:N.clientX,y:N.clientY}}else if(W.type===j.d.POINTERUP){V||N.preventDefault();const W=this._pointerPressed.indexOf(N.pointerId);if(-1===W)return;if(this._pointerPressed.splice(W,1),0!=W)return;p=null,this._offsetX=null,this._offsetY=null}else if(W.type===j.d.POINTERMOVE){if(V||N.preventDefault(),!p)return;if(0!=this._pointerPressed.indexOf(N.pointerId))return;this._offsetX=N.clientX-p.x,this._offsetY=-(N.clientY-p.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,j.d.POINTERDOWN|j.d.POINTERUP|j.d.POINTERMOVE),this._onLostFocus){const V=this.camera.getEngine().getInputElement();V&&V.addEventListener("blur",this._onLostFocus)}}Hi(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const V=this.camera.getEngine().getInputElement();V&&V.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const V=this.camera,p=V._calculateHandednessMultiplier();V.cameraRotation.y=p*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)V.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const p=V._computeLocalCameraSpeed(),W=new E.n(0,0,0!==this.touchMoveSensibility?p*this._offsetY/this.touchMoveSensibility:0);E.e.RotationYawPitchRollToRef(V.rotation.y,V.rotation.x,0,V._cameraRotationMatrix),V.cameraDirection.addInPlace(E.n.TransformCoordinates(W,V._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,N.c)([(0,d.I)()],F.prototype,"touchAngularSensibility",void 0),(0,N.c)([(0,d.I)()],F.prototype,"touchMoveSensibility",void 0),S.c.FreeCameraTouchInput=F;class C extends S.d{constructor(V){super(V),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new i),this}addMouse(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new k(V),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new U,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new F),this}clear(){super.clear(),this._mouseInput=null}}var A=W(11004),v=W(10941);class t extends z.c{get angularSensibility(){const V=this.inputs.attached.mouse;return V?V.angularSensibility:0}set angularSensibility(V){const p=this.inputs.attached.mouse;p&&(p.angularSensibility=V)}get keysUp(){const V=this.inputs.attached.keyboard;return V?V.keysUp:[]}set keysUp(V){const p=this.inputs.attached.keyboard;p&&(p.keysUp=V)}get keysUpward(){const V=this.inputs.attached.keyboard;return V?V.keysUpward:[]}set keysUpward(V){const p=this.inputs.attached.keyboard;p&&(p.keysUpward=V)}get keysDown(){const V=this.inputs.attached.keyboard;return V?V.keysDown:[]}set keysDown(V){const p=this.inputs.attached.keyboard;p&&(p.keysDown=V)}get keysDownward(){const V=this.inputs.attached.keyboard;return V?V.keysDownward:[]}set keysDownward(V){const p=this.inputs.attached.keyboard;p&&(p.keysDownward=V)}get keysLeft(){const V=this.inputs.attached.keyboard;return V?V.keysLeft:[]}set keysLeft(V){const p=this.inputs.attached.keyboard;p&&(p.keysLeft=V)}get keysRight(){const V=this.inputs.attached.keyboard;return V?V.keysRight:[]}set keysRight(V){const p=this.inputs.attached.keyboard;p&&(p.keysRight=V)}get keysRotateLeft(){const V=this.inputs.attached.keyboard;return V?V.keysRotateLeft:[]}set keysRotateLeft(V){const p=this.inputs.attached.keyboard;p&&(p.keysRotateLeft=V)}get keysRotateRight(){const V=this.inputs.attached.keyboard;return V?V.keysRotateRight:[]}set keysRotateRight(V){const p=this.inputs.attached.keyboard;p&&(p.keysRotateRight=V)}get keysRotateUp(){const V=this.inputs.attached.keyboard;return V?V.keysRotateUp:[]}set keysRotateUp(V){const p=this.inputs.attached.keyboard;p&&(p.keysRotateUp=V)}get keysRotateDown(){const V=this.inputs.attached.keyboard;return V?V.keysRotateDown:[]}set keysRotateDown(V){const p=this.inputs.attached.keyboard;p&&(p.keysRotateDown=V)}constructor(V,p,W){var N;super(V,p,W,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),N=this,this.ellipsoid=new E.n(.5,1,.5),this.ellipsoidOffset=new E.n(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=E.n.Zero(),this._diffPosition=E.n.Zero(),this._newPosition=E.n.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N._newPosition.p(p),N._newPosition.subtractToRef(N._oldPosition,N._diffPosition),N._diffPosition.length()>v.d.CollisionsEpsilon&&(N.position.addToRef(N._diffPosition,N._deferredPositionUpdate),N._deferOnly?N._deferredUpdated=!0:N.position.p(N._deferredPositionUpdate),N.xk&&W&&N.xk(W))},this.inputs=new C(this),this.inputs.addKeyboard().addMouse()}attachControl(V,p){p=J.e.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(p)}Hi(){this.inputs.detachElement(),this.cameraDirection=new E.n(0,0,0),this.cameraRotation=new E.k(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(V){this._collisionMask=isNaN(V)?-1:V}_collideWithWorld(V){let p;p=this.parent?E.n.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,p.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const W=this.va().collisionCoordinator;this._collider||(this._collider=W.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let N=V;this.applyGravity&&(N=V.add(this.va().gravity)),W.getNewPosition(this._oldPosition,N,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=E.n.Zero(),this._transformedDirection=E.n.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(V){this._needMoveForGravity=V}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"hb"}}(0,N.c)([(0,d.F)()],t.prototype,"ellipsoid",void 0),(0,N.c)([(0,d.F)()],t.prototype,"ellipsoidOffset",void 0),(0,N.c)([(0,d.I)()],t.prototype,"checkCollisions",void 0),(0,N.c)([(0,d.I)()],t.prototype,"applyGravity",void 0),(0,A.d)("BABYLON.FreeCamera",t)},12470:(V,p,W)=>{"use strict";W.d(p,{c:()=>J});var N=W(11167),d=W(11175),E=W(11524),z=W(11218),S=W(11224),Q=W(11579);W(11529).b.AddNodeConstructor("TargetCamera",((V,p)=>()=>new J(V,z.n.Zero(),p)));class J extends E.d{constructor(V,p,W){super(V,p,W,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=z.n.Zero(),this._tmpTargetVector=z.n.Zero(),this.cameraDirection=new z.n(0,0,0),this.cameraRotation=new z.k(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new z.f,this.rotation=new z.n(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=z.n.Zero(),this._initialFocalDistance=1,this._viewMatrix=z.e.Zero(),this._camMatrix=z.e.Zero(),this._cameraTransformMatrix=z.e.Zero(),this._cameraRotationMatrix=z.e.Zero(),this._referencePoint=new z.n(0,0,1),this._transformedReferencePoint=z.n.Zero(),this._deferredPositionUpdate=new z.n,this._deferredRotationQuaternionUpdate=new z.f,this._deferredRotationUpdate=new z.n,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=z.n.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(V){this.getWorldMatrix();const p=this.getTarget().ed(this.position);return p.normalize(),p.scaleInPlace(V),this.globalPosition.add(p)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const V=this.lockedTarget;V.Dj().getTranslationToRef(V.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.ge(0,0,0),this.cameraRotation.ge(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new z.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new z.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new z.f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(V){V||super._updateCache();const p=this._getLockedTargetPosition();p?this._cache.lockedTarget?this._cache.lockedTarget.p(p):this._cache.lockedTarget=p.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const V=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(V):!V)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const V=this.getEngine();return this.speed*Math.sqrt(V.getDeltaTime()/(100*V.getFps()))}setTarget(V){this.upVector.normalize(),this._initialFocalDistance=V.ed(this.position).length(),this.position.z===V.z&&(this.position.z+=S.c),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),z.e.LookAtLHToRef(this.position,V,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const p=V.ed(this.position);p.x>=0?this.rotation.y=-Math.atan(p.z/p.x)+Math.PI/2:this.rotation.y=-Math.atan(p.z/p.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&z.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(V){this.setTarget(V)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(z.i.Matrix[0]),z.n.TransformNormalToRef(this.cameraDirection,z.i.Matrix[0],z.i.fb[0]),this._deferredPositionUpdate.addInPlace(z.i.fb[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const V=this.invertRotation?-this.inverseRotationSpeed:1,p=this._decideIfNeedsToMove(),W=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),p&&this._updatePosition(),W){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*V,this._deferredRotationUpdate.y+=this.cameraRotation.y*V,!this.noRotationConstraint){const V=1.570796;this._deferredRotationUpdate.x>V&&(this._deferredRotationUpdate.x=V),this._deferredRotationUpdate.x<-V&&(this._deferredRotationUpdate.x=-V)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(z.f.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}p&&(Math.abs(this.cameraDirection.x)<this.speed*S.c&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*S.c&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*S.c&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),W&&(Math.abs(this.cameraRotation.x)<this.speed*S.c&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*S.c&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):z.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return z.n.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),z.n.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?Q.e.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(z.f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),Q.e.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(V,p,W){if(this.ignoreParentScaling){if(this.parent){const N=this.parent.getWorldMatrix();z.n.TransformCoordinatesToRef(V,N,this._globalPosition),z.n.TransformCoordinatesToRef(p,N,this._tmpTargetVector),z.n.TransformNormalToRef(W,N,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(V),this._tmpTargetVector.p(p),this._tmpUpVector.p(W);this.va().useRightHandedSystem?z.e.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):z.e.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?z.e.LookAtRHToRef(V,p,W,this._viewMatrix):z.e.LookAtLHToRef(V,p,W,this._viewMatrix),this.parent){const V=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(V,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(V)}createRigCamera(V,p){if(this.cameraRigMode!==E.d.RIG_MODE_NONE){const p=new J(V,this.position.clone(),this.va());return p.isRigCamera=!0,p.rigParent=this,this.cameraRigMode===E.d.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new z.f),p._cameraRigParams={},p.rotationQuaternion=new z.f),p.mode=this.mode,p.orthoLeft=this.orthoLeft,p.orthoRight=this.orthoRight,p.orthoTop=this.orthoTop,p.orthoBottom=this.orthoBottom,p}return null}_updateRigCameras(){const V=this._rigCameras[0],p=this._rigCameras[1];switch(this.Dj(),this.cameraRigMode){case E.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case E.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case E.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case E.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case E.d.RIG_MODE_STEREOSCOPIC_INTERLACED:{const W=this.cameraRigMode===E.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,N=this.cameraRigMode===E.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*W,V),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*N,p);break}case E.d.RIG_MODE_VR:V.rotationQuaternion?(V.rotationQuaternion.p(this.rotationQuaternion),p.rotationQuaternion.p(this.rotationQuaternion)):(V.rotation.p(this.rotation),p.rotation.p(this.rotation)),V.position.p(this.position),p.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(V,p){this.getTarget().subtractToRef(this.position,J._TargetFocalPoint),J._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const W=J._TargetFocalPoint.addInPlace(this.position);z.e.TranslationToRef(-W.x,-W.y,-W.z,J._TargetTransformMatrix),J._TargetTransformMatrix.multiplyToRef(z.e.RotationAxis(p.upVector,V),J._RigCamTransformMatrix),z.e.TranslationToRef(W.x,W.y,W.z,J._TargetTransformMatrix),J._RigCamTransformMatrix.multiplyToRef(J._TargetTransformMatrix,J._RigCamTransformMatrix),z.n.TransformCoordinatesToRef(this.position,J._RigCamTransformMatrix,p.position),p.setTarget(W)}getClassName(){return"TargetCamera"}}J._RigCamTransformMatrix=new z.e,J._TargetTransformMatrix=new z.e,J._TargetFocalPoint=new z.n,(0,N.c)([(0,d.F)()],J.prototype,"rotation",void 0),(0,N.c)([(0,d.I)()],J.prototype,"speed",void 0),(0,N.c)([(0,d.u)("lockedTargetId")],J.prototype,"lockedTarget",void 0)},11394:(V,p,W)=>{"use strict";W.d(p,{d:()=>N});class N{constructor(V,p,W){this.bu=V,this.bv=p,this.distance=W,this.faceId=0,this.subMeshId=0}}},11284:(V,p,W)=>{"use strict";W.d(p,{e:()=>E});var N=W(11218),d=W(11291);class E{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var V;let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||W&&!this.pickedMesh.isVerticesDataPresent(d.f.NormalKind))return null;let E,z=this.pickedMesh.Zf();0===(null===(V=z)||void 0===V?void 0:V.length)&&(z=null);const S=N.i.fb[0],Q=N.i.fb[1],J=N.i.fb[2];if(W){const V=this.pickedMesh.getVerticesData(d.f.NormalKind);let p=z?N.n.FromArrayToRef(V,3*z[3*this.faceId],S):S.ge(V[3*this.faceId*3],V[3*this.faceId*3+1],V[3*this.faceId*3+2]),W=z?N.n.FromArrayToRef(V,3*z[3*this.faceId+1],Q):Q.ge(V[3*(3*this.faceId+1)],V[3*(3*this.faceId+1)+1],V[3*(3*this.faceId+1)+2]),i=z?N.n.FromArrayToRef(V,3*z[3*this.faceId+2],J):J.ge(V[3*(3*this.faceId+2)],V[3*(3*this.faceId+2)+1],V[3*(3*this.faceId+2)+2]);p=p.scale(this.bu),W=W.scale(this.bv),i=i.scale(1-this.bu-this.bv),E=new N.n(p.x+W.x+i.x,p.y+W.y+i.y,p.z+W.z+i.z)}else{const V=this.pickedMesh.getVerticesData(d.f.PositionKind),p=z?N.n.FromArrayToRef(V,3*z[3*this.faceId],S):S.ge(V[3*this.faceId*3],V[3*this.faceId*3+1],V[3*this.faceId*3+2]),W=z?N.n.FromArrayToRef(V,3*z[3*this.faceId+1],Q):Q.ge(V[3*(3*this.faceId+1)],V[3*(3*this.faceId+1)+1],V[3*(3*this.faceId+1)+2]),i=z?N.n.FromArrayToRef(V,3*z[3*this.faceId+2],J):J.ge(V[3*(3*this.faceId+2)],V[3*(3*this.faceId+2)+1],V[3*(3*this.faceId+2)+2]),l=p.ed(W),j=i.ed(W);E=N.n.Cross(l,j)}const i=(V,p)=>{let W=V.getWorldMatrix();V.nonUniformScaling&&(N.i.Matrix[0].p(W),W=N.i.Matrix[0],W.setTranslationFromFloats(0,0,0),W.invert(),W.transposeToRef(N.i.Matrix[1]),W=N.i.Matrix[1]),N.n.TransformNormalToRef(p,W,p)};if(p&&i(this.pickedMesh,E),this.ray){const V=N.i.fb[0].p(E);p||i(this.pickedMesh,V),N.n.Dot(V,this.ray.direction)>0&&E.negateInPlace()}return E.normalize(),E}getTextureCoordinates(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.f.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(V))return null;const p=this.pickedMesh.Zf();if(!p)return null;const W=this.pickedMesh.getVerticesData(V);if(!W)return null;let E=N.k.Tg(W,2*p[3*this.faceId]),z=N.k.Tg(W,2*p[3*this.faceId+1]),S=N.k.Tg(W,2*p[3*this.faceId+2]);return E=E.scale(this.bu),z=z.scale(this.bv),S=S.scale(1-this.bu-this.bv),new N.k(E.x+z.x+S.x,E.y+z.y+S.y)}}},11467:(V,p,W)=>{"use strict";W.d(p,{d:()=>N});let N=!1},13024:(V,p,W)=>{"use strict";W.d(p,{e:()=>E});var N=W(11191),d=W(13027);class E{constructor(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=W,this.bi=[],this._maxBlockCapacity=p||64,this._selectionContent=new N.d(1024),this._creationFunc=V}update(V,p,W){d.d._CreateBlocks(V,p,W,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}ai(V){for(let p=0;p<this.uh.length;p++){this.uh[p].addEntry(V)}}yc(V){for(let p=0;p<this.uh.length;p++){this.uh[p].removeEntry(V)}}select(V,p){this._selectionContent.reset();for(let W=0;W<this.uh.length;W++){this.uh[W].select(V,this._selectionContent,p)}return p?this._selectionContent.concat(this.bi):this._selectionContent.concatWithNoDuplicate(this.bi),this._selectionContent}intersects(V,p,W){this._selectionContent.reset();for(let N=0;N<this.uh.length;N++){this.uh[N].intersects(V,p,this._selectionContent,W)}return W?this._selectionContent.concat(this.bi):this._selectionContent.concatWithNoDuplicate(this.bi),this._selectionContent}intersectsRay(V){this._selectionContent.reset();for(let p=0;p<this.uh.length;p++){this.uh[p].intersectsRay(V,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.bi),this._selectionContent}}E.CreationFuncForMeshes=(V,p)=>{const W=V.getBoundingInfo();!V.isBlocked&&W.boundingBox.intersectsMinMax(p.fi,p.gi)&&p.entries.push(V)},E.CreationFuncForSubMeshes=(V,p)=>{V.getBoundingInfo().boundingBox.intersectsMinMax(p.fi,p.gi)&&p.entries.push(V)}},13027:(V,p,W)=>{"use strict";W.d(p,{d:()=>E});var N=W(11218),d=W(11409);class E{constructor(V,p,W,N,d,E){this.entries=[],this.hi=new Array,this._capacity=W,this._depth=N,this._maxDepth=d,this._creationFunc=E,this._minPoint=V,this._maxPoint=p,this.hi.push(V.clone()),this.hi.push(p.clone()),this.hi.push(V.clone()),this.hi[2].x=p.x,this.hi.push(V.clone()),this.hi[3].y=p.y,this.hi.push(V.clone()),this.hi[4].z=p.z,this.hi.push(p.clone()),this.hi[5].z=V.z,this.hi.push(p.clone()),this.hi[6].x=V.x,this.hi.push(p.clone()),this.hi[7].y=V.y}get ib(){return this._capacity}get fi(){return this._minPoint}get gi(){return this._maxPoint}addEntry(V){if(this.uh)for(let p=0;p<this.uh.length;p++){this.uh[p].addEntry(V)}else this._creationFunc(V,this),this.entries.length>this.ib&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(V){if(this.uh){for(let p=0;p<this.uh.length;p++){this.uh[p].removeEntry(V)}return}const p=this.entries.indexOf(V);p>-1&&this.entries.splice(p,1)}addEntries(V){for(let p=0;p<V.length;p++){const W=V[p];this.addEntry(W)}}select(V,p,W){if(d.d.IsInFrustum(this.hi,V)){if(this.uh){for(let N=0;N<this.uh.length;N++){this.uh[N].select(V,p,W)}return}W?p.concat(this.entries):p.concatWithNoDuplicate(this.entries)}}intersects(V,p,W,N){if(d.d.IntersectsSphere(this._minPoint,this._maxPoint,V,p)){if(this.uh){for(let d=0;d<this.uh.length;d++){this.uh[d].intersects(V,p,W,N)}return}N?W.concat(this.entries):W.concatWithNoDuplicate(this.entries)}}intersectsRay(V,p){if(V.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.uh){for(let W=0;W<this.uh.length;W++){this.uh[W].intersectsRay(V,p)}return}p.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){E._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(V,p,W,d,z,S,Q,J){Q.uh=new Array;const i=new N.n((p.x-V.x)/2,(p.y-V.y)/2,(p.z-V.z)/2);for(let N=0;N<2;N++)for(let p=0;p<2;p++)for(let l=0;l<2;l++){const j=V.add(i.multiplyByFloats(N,p,l)),k=V.add(i.multiplyByFloats(N+1,p+1,l+1)),u=new E(j,k,d,z+1,S,J);u.addEntries(W),Q.uh.push(u)}}}},13032:(V,p,W)=>{"use strict";W.d(p,{d:()=>i});var N=W(11200),d=W(11218),E=W(11565),z=W(11901),S=W(11321),Q=W(13024),J=W(10900);N.e.prototype.createOrUpdateSelectionOctree=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,W=this._getComponent(S.c.NAME_OCTREE);W||(W=new i(this),this.o(W)),this.$h||(this.$h=new Q.e(Q.e.CreationFuncForMeshes,V,p));const N=this.getWorldExtends();return this.$h.update(N.min,N.max,this.meshes),this.$h},Object.defineProperty(N.e.prototype,"selectionOctree",{get:function(){return this.$h},enumerable:!0,configurable:!0}),E.d.prototype.createOrUpdateSubmeshesOctree=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const W=this.va();let N=W._getComponent(S.c.NAME_OCTREE);N||(N=new i(W),W.o(N)),this._submeshesOctree||(this._submeshesOctree=new Q.e(Q.e.CreationFuncForSubMeshes,V,p)),this.Dj(!0);const d=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(d.minimumWorld,d.maximumWorld,this.dg),this._submeshesOctree};class i{constructor(V){this.name=S.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new z.d(d.n.Zero(),new d.n(1,1,1)),(V=V||J.d.LastCreatedScene)&&(this.Bc=V,this.Bc.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Bc.getActiveSubMeshCandidates=V=>this.getActiveSubMeshCandidates(V),this.Bc.getCollidingSubMeshCandidates=(V,p)=>this.getCollidingSubMeshCandidates(V,p),this.Bc.getIntersectingSubMeshCandidates=(V,p)=>this.getIntersectingSubMeshCandidates(V,p))}register(){this.Bc.onMeshRemovedObservable.add((V=>{const p=this.Bc.selectionOctree;if(void 0!==p&&null!==p){const W=p.bi.indexOf(V);-1!==W&&p.bi.splice(W,1)}})),this.Bc.onMeshImportedObservable.add((V=>{const p=this.Bc.selectionOctree;void 0!==p&&null!==p&&p.ai(V)}))}getActiveMeshCandidates(){var V;return(null===(V=this.Bc.$h)||void 0===V?void 0:V.select(this.Bc.frustumPlanes))||this.Bc._getDefaultMeshCandidates()}getActiveSubMeshCandidates(V){if(V._submeshesOctree&&V.useOctreeForRenderingSelection){return V._submeshesOctree.select(this.Bc.frustumPlanes)}return this.Bc._getDefaultSubMeshCandidates(V)}getIntersectingSubMeshCandidates(V,p){if(V._submeshesOctree&&V.useOctreeForPicking){z.d.TransformToRef(p,V.getWorldMatrix(),this._tempRay);return V._submeshesOctree.intersectsRay(this._tempRay)}return this.Bc._getDefaultSubMeshCandidates(V)}getCollidingSubMeshCandidates(V,p){if(V._submeshesOctree&&V.useOctreeForCollisions){const W=p._velocityWorldLength+Math.max(p._radius.x,p._radius.y,p._radius.z);return V._submeshesOctree.intersects(p._basePointWorld,W)}return this.Bc._getDefaultSubMeshCandidates(V)}rebuild(){}dispose(){}}},11409:(V,p,W)=>{"use strict";W.d(p,{d:()=>z});var N=W(11233),d=W(11218),E=W(11224);class z{constructor(V,p,W){this.vectors=(0,N.e)(8,d.n.Zero),this.center=d.n.Zero(),this.centerWorld=d.n.Zero(),this.extendSize=d.n.Zero(),this.extendSizeWorld=d.n.Zero(),this.directions=(0,N.e)(3,d.n.Zero),this.vectorsWorld=(0,N.e)(8,d.n.Zero),this.minimumWorld=d.n.Zero(),this.maximumWorld=d.n.Zero(),this.minimum=d.n.Zero(),this.maximum=d.n.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(V,p,W)}reConstruct(V,p,W){const N=V.x,E=V.y,z=V.z,S=p.x,Q=p.y,J=p.z,i=this.vectors;this.minimum.ge(N,E,z),this.maximum.ge(S,Q,J),i[0].ge(N,E,z),i[1].ge(S,Q,J),i[2].ge(S,E,z),i[3].ge(N,Q,z),i[4].ge(N,E,J),i[5].ge(S,Q,z),i[6].ge(N,Q,J),i[7].ge(S,E,J),p.addToRef(V,this.center).scaleInPlace(.5),p.subtractToRef(V,this.extendSize).scaleInPlace(.5),this._worldMatrix=W||d.e.IdentityReadOnly,this._update(this._worldMatrix)}scale(V){const p=z._TmpVector3,W=this.maximum.subtractToRef(this.minimum,p[0]),N=W.length();W.normalizeFromLength(N);const d=N*V,E=W.scaleInPlace(.5*d),S=this.center.subtractToRef(E,p[1]),Q=this.center.addToRef(E,p[2]);return this.reConstruct(S,Q,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(V){const p=this.minimumWorld,W=this.maximumWorld,N=this.directions,E=this.vectorsWorld,z=this.vectors;if(V.isIdentity()){p.p(this.minimum),W.p(this.maximum);for(let V=0;V<8;++V)E[V].p(z[V]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{p.ee(Number.MAX_VALUE),W.ee(-Number.MAX_VALUE);for(let N=0;N<8;++N){const S=E[N];d.n.TransformCoordinatesToRef(z[N],V,S),p.minimizeInPlace(S),W.maximizeInPlace(S)}W.subtractToRef(p,this.extendSizeWorld).scaleInPlace(.5),W.addToRef(p,this.centerWorld).scaleInPlace(.5)}d.n.FromArrayToRef(V.m,0,N[0]),d.n.FromArrayToRef(V.m,4,N[1]),d.n.FromArrayToRef(V.m,8,N[2]),this._worldMatrix=V}isInFrustum(V){return z.IsInFrustum(this.vectorsWorld,V)}isCompletelyInFrustum(V){return z.IsCompletelyInFrustum(this.vectorsWorld,V)}intersectsPoint(V){const p=this.minimumWorld,W=this.maximumWorld,N=p.x,d=p.y,z=p.z,S=W.x,Q=W.y,J=W.z,i=V.x,l=V.y,j=V.z,k=-E.c;return!(S-i<k||k>i-N)&&(!(Q-l<k||k>l-d)&&!(J-j<k||k>j-z))}intersectsSphere(V){return z.IntersectsSphere(this.minimumWorld,this.maximumWorld,V.centerWorld,V.radiusWorld)}intersectsMinMax(V,p){const W=this.minimumWorld,N=this.maximumWorld,d=W.x,E=W.y,z=W.z,S=N.x,Q=N.y,J=N.z,i=V.x,l=V.y,j=V.z,k=p.x,u=p.y,f=p.z;return!(S<i||d>k)&&(!(Q<l||E>u)&&!(J<j||z>f))}dispose(){var V,p;null===(V=this._drawWrapperFront)||void 0===V||V.dispose(),null===(p=this._drawWrapperBack)||void 0===p||p.dispose()}static Intersects(V,p){return V.intersectsMinMax(p.minimumWorld,p.maximumWorld)}static IntersectsSphere(V,p,W,N){const E=z._TmpVector3[0];d.n.ClampToRef(W,V,p,E);return d.n.DistanceSquared(W,E)<=N*N}static IsCompletelyInFrustum(V,p){for(let W=0;W<6;++W){const N=p[W];for(let p=0;p<8;++p)if(N.dotCoordinate(V[p])<0)return!1}return!0}static IsInFrustum(V,p){for(let W=0;W<6;++W){let N=!0;const d=p[W];for(let p=0;p<8;++p)if(d.dotCoordinate(V[p])>=0){N=!1;break}if(N)return!1}return!0}}z._TmpVector3=(0,N.e)(3,d.n.Zero)},11402:(V,p,W)=>{"use strict";W.d(p,{c:()=>l});var N=W(11233),d=W(11218),E=W(11409),z=W(11416);const S={min:0,max:0},Q={min:0,max:0},J=(V,p,W)=>{const N=d.n.Dot(p.centerWorld,V),E=Math.abs(d.n.Dot(p.directions[0],V))*p.extendSize.x+Math.abs(d.n.Dot(p.directions[1],V))*p.extendSize.y+Math.abs(d.n.Dot(p.directions[2],V))*p.extendSize.z;W.min=N-E,W.max=N+E},i=(V,p,W)=>(J(V,p,S),J(V,W,Q),!(S.min>Q.max||Q.min>S.max));class l{constructor(V,p,W){this._isLocked=!1,this.boundingBox=new E.d(V,p,W),this.boundingSphere=new z.e(V,p,W)}reConstruct(V,p,W){this.boundingBox.reConstruct(V,p,W),this.boundingSphere.reConstruct(V,p,W)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(V){this._isLocked=V}update(V){this._isLocked||(this.boundingBox._update(V),this.boundingSphere._update(V))}centerOn(V,p){const W=l._TmpVector3[0].p(V).ei(p),N=l._TmpVector3[1].p(V).addInPlace(p);return this.boundingBox.reConstruct(W,N,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(W,N,this.boundingBox.getWorldMatrix()),this}encapsulate(V){const p=d.n.Minimize(this.minimum,V),W=d.n.Maximize(this.maximum,V);return this.reConstruct(p,W,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(V){const p=d.i.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(p);const W=d.i.fb[0];return d.n.TransformCoordinatesToRef(V.boundingBox.minimumWorld,p,W),this.encapsulate(W),d.n.TransformCoordinatesToRef(V.boundingBox.maximumWorld,p,W),this.encapsulate(W),this}scale(V){return this.boundingBox.scale(V),this.boundingSphere.scale(V),this}isInFrustum(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===p||3===p)&&this.boundingSphere.isCenterInFrustum(V))return!0;if(!this.boundingSphere.isInFrustum(V))return!1;return!(1!==p&&3!==p)||this.boundingBox.isInFrustum(V)}get diagonalLength(){const V=this.boundingBox;return V.maximumWorld.subtractToRef(V.minimumWorld,l._TmpVector3[0]).length()}isCompletelyInFrustum(V){return this.boundingBox.isCompletelyInFrustum(V)}_checkCollision(V){return V._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(V){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(V)&&!!this.boundingBox.intersectsPoint(V))}intersects(V,p){if(!z.e.Intersects(this.boundingSphere,V.boundingSphere))return!1;if(!E.d.Intersects(this.boundingBox,V.boundingBox))return!1;if(!p)return!0;const W=this.boundingBox,N=V.boundingBox;return!!i(W.directions[0],W,N)&&(!!i(W.directions[1],W,N)&&(!!i(W.directions[2],W,N)&&(!!i(N.directions[0],W,N)&&(!!i(N.directions[1],W,N)&&(!!i(N.directions[2],W,N)&&(!!i(d.n.Cross(W.directions[0],N.directions[0]),W,N)&&(!!i(d.n.Cross(W.directions[0],N.directions[1]),W,N)&&(!!i(d.n.Cross(W.directions[0],N.directions[2]),W,N)&&(!!i(d.n.Cross(W.directions[1],N.directions[0]),W,N)&&(!!i(d.n.Cross(W.directions[1],N.directions[1]),W,N)&&(!!i(d.n.Cross(W.directions[1],N.directions[2]),W,N)&&(!!i(d.n.Cross(W.directions[2],N.directions[0]),W,N)&&(!!i(d.n.Cross(W.directions[2],N.directions[1]),W,N)&&!!i(d.n.Cross(W.directions[2],N.directions[2]),W,N))))))))))))))}}l._TmpVector3=(0,N.e)(2,d.n.Zero)},11416:(V,p,W)=>{"use strict";W.d(p,{e:()=>E});var N=W(11233),d=W(11218);class E{constructor(V,p,W){this.center=d.n.Zero(),this.centerWorld=d.n.Zero(),this.minimum=d.n.Zero(),this.maximum=d.n.Zero(),this.reConstruct(V,p,W)}reConstruct(V,p,W){this.minimum.p(V),this.maximum.p(p);const N=d.n.Distance(V,p);p.addToRef(V,this.center).scaleInPlace(.5),this.radius=.5*N,this._update(W||d.e.IdentityReadOnly)}scale(V){const p=this.radius*V,W=E._TmpVector3,N=W[0].ee(p),d=this.center.subtractToRef(N,W[1]),z=this.center.addToRef(N,W[2]);return this.reConstruct(d,z,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(V){if(V.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.radius;else{d.n.TransformCoordinatesToRef(this.center,V,this.centerWorld);const p=E._TmpVector3[0];d.n.TransformNormalFromFloatsToRef(1,1,1,V,p),this.radiusWorld=Math.max(Math.abs(p.x),Math.abs(p.y),Math.abs(p.z))*this.radius}}isInFrustum(V){const p=this.centerWorld,W=this.radiusWorld;for(let N=0;N<6;N++)if(V[N].dotCoordinate(p)<=-W)return!1;return!0}isCenterInFrustum(V){const p=this.centerWorld;for(let W=0;W<6;W++)if(V[W].dotCoordinate(p)<0)return!1;return!0}intersectsPoint(V){const p=d.n.DistanceSquared(this.centerWorld,V);return!(this.radiusWorld*this.radiusWorld<p)}static Intersects(V,p){const W=d.n.DistanceSquared(V.centerWorld,p.centerWorld),N=V.radiusWorld+p.radiusWorld;return!(N*N<W)}static CreateFromCenterAndRadius(V,p,W){this._TmpVector3[0].p(V),this._TmpVector3[1].ge(0,0,p),this._TmpVector3[2].p(V),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].ei(this._TmpVector3[1]);const N=new E(this._TmpVector3[0],this._TmpVector3[2]);return N._worldMatrix=W||d.e.Identity(),N}}E._TmpVector3=(0,N.e)(3,d.n.Zero)},11901:(V,p,W)=>{"use strict";W.d(p,{d:()=>k});var N=W(11200),d=W(11524),E=W(11224),z=W(11218),S=W(11233),Q=W(11394),J=W(11284),i=W(10900),l=W(11343);const j={internalPickerForMesh:void 0};class k{constructor(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E.c;this.origin=V,this.direction=p,this.length=W,this.epsilon=N}clone(){return new k(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const N=k._TmpVector3[0].ge(V.x-W,V.y-W,V.z-W),d=k._TmpVector3[1].ge(p.x+W,p.y+W,p.z+W);let E,z,S,Q,J=0,i=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<N.x||this.origin.x>d.x)return!1}else if(E=1/this.direction.x,z=(N.x-this.origin.x)*E,S=(d.x-this.origin.x)*E,S===-1/0&&(S=1/0),z>S&&(Q=z,z=S,S=Q),J=Math.max(z,J),i=Math.min(S,i),J>i)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<N.y||this.origin.y>d.y)return!1}else if(E=1/this.direction.y,z=(N.y-this.origin.y)*E,S=(d.y-this.origin.y)*E,S===-1/0&&(S=1/0),z>S&&(Q=z,z=S,S=Q),J=Math.max(z,J),i=Math.min(S,i),J>i)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<N.z||this.origin.z>d.z)return!1}else if(E=1/this.direction.z,z=(N.z-this.origin.z)*E,S=(d.z-this.origin.z)*E,S===-1/0&&(S=1/0),z>S&&(Q=z,z=S,S=Q),J=Math.max(z,J),i=Math.min(S,i),J>i)return!1;return!0}intersectsBox(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(V.minimum,V.maximum,p)}intersectsSphere(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=V.center.x-this.origin.x,N=V.center.y-this.origin.y,d=V.center.z-this.origin.z,E=W*W+N*N+d*d,z=V.radius+p,S=z*z;if(E<=S)return!0;const Q=W*this.direction.x+N*this.direction.y+d*this.direction.z;if(Q<0)return!1;return E-Q*Q<=S}intersectsTriangle(V,p,W){const N=k._TmpVector3[0],d=k._TmpVector3[1],E=k._TmpVector3[2],S=k._TmpVector3[3],J=k._TmpVector3[4];p.subtractToRef(V,N),W.subtractToRef(V,d),z.n.CrossToRef(this.direction,d,E);const i=z.n.Dot(N,E);if(0===i)return null;const l=1/i;this.origin.subtractToRef(V,S);const j=z.n.Dot(S,E)*l;if(j<-this.epsilon||j>1+this.epsilon)return null;z.n.CrossToRef(S,N,J);const u=z.n.Dot(this.direction,J)*l;if(u<-this.epsilon||j+u>1+this.epsilon)return null;const f=z.n.Dot(d,J)*l;return f>this.length?null:new Q.d(1-j-u,j,f)}intersectsPlane(V){let p;const W=z.n.Dot(V.k,this.direction);if(Math.abs(W)<9.99999997475243e-7)return null;{const N=z.n.Dot(V.k,this.origin);return p=(-V.d-N)/W,p<0?p<-9.99999997475243e-7?null:0:p}}intersectsAxis(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(V){case"y":{const V=(this.origin.y-p)/this.direction.y;return V>0?null:new z.n(this.origin.x+this.direction.x*-V,p,this.origin.z+this.direction.z*-V)}case"x":{const V=(this.origin.x-p)/this.direction.x;return V>0?null:new z.n(p,this.origin.y+this.direction.y*-V,this.origin.z+this.direction.z*-V)}case"z":{const V=(this.origin.z-p)/this.direction.z;return V>0?null:new z.n(this.origin.x+this.direction.x*-V,this.origin.y+this.direction.y*-V,p)}default:return null}}intersectsMesh(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const S=z.i.Matrix[0];return V.getWorldMatrix().invertToRef(S),this._tmpRay?k.TransformToRef(this,S,this._tmpRay):this._tmpRay=k.Transform(this,S),V.intersects(this._tmpRay,p,W,N,d,E)}intersectsMeshes(V,p,W){W?W.length=0:W=[];for(let N=0;N<V.length;N++){const d=this.intersectsMesh(V[N],p);d.hit&&W.push(d)}return W.sort(this._comparePickingInfo),W}_comparePickingInfo(V,p){return V.distance<p.distance?-1:V.distance>p.distance?1:0}intersectionSegment(V,p,W){const N=this.origin,d=z.i.fb[0],E=z.i.fb[1],S=z.i.fb[2],Q=z.i.fb[3];p.subtractToRef(V,d),this.direction.scaleToRef(k._Rayl,S),N.addToRef(S,E),V.subtractToRef(N,Q);const J=z.n.Dot(d,d),i=z.n.Dot(d,S),l=z.n.Dot(S,S),j=z.n.Dot(d,Q),u=z.n.Dot(S,Q),f=J*l-i*i;let O,U,F=f,C=f;f<k._Smallnum?(O=0,F=1,U=u,C=l):(O=i*u-l*j,U=J*u-i*j,O<0?(O=0,U=u,C=l):O>F&&(O=F,U=u+i,C=l)),U<0?(U=0,-j<0?O=0:-j>J?O=F:(O=-j,F=J)):U>C&&(U=C,-j+i<0?O=0:-j+i>J?O=F:(O=-j+i,F=J));const A=Math.abs(O)<k._Smallnum?0:O/F,v=Math.abs(U)<k._Smallnum?0:U/C,t=z.i.fb[4];S.scaleToRef(v,t);const e=z.i.fb[5];d.scaleToRef(A,e),e.addInPlace(Q);const Z=z.i.fb[6];e.subtractToRef(t,Z);return v>0&&v<=this.length&&Z.lengthSquared()<W*W?e.length():-1}update(V,p,W,N,d,E,S){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){k._RayDistant||(k._RayDistant=k.Zero()),k._RayDistant.unprojectRayToRef(V,p,W,N,z.e.IdentityReadOnly,E,S);const Q=z.i.Matrix[0];d.invertToRef(Q),k.TransformToRef(k._RayDistant,Q,this)}else this.unprojectRayToRef(V,p,W,N,d,E,S);return this}static Zero(){return new k(z.n.Zero(),z.n.Zero())}static CreateNew(V,p,W,N,d,E,z){return k.Zero().update(V,p,W,N,d,E,z)}static CreateNewFromTo(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.e.IdentityReadOnly;const N=new k(new z.n(0,0,0),new z.n(0,0,0));return k.CreateFromToToRef(V,p,N,W)}static CreateFromToToRef(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.e.IdentityReadOnly;W.origin.p(V);const d=p.subtractToRef(V,W.direction),E=Math.sqrt(d.x*d.x+d.y*d.y+d.z*d.z);return W.length=E,W.direction.normalize(),k.TransformToRef(W,N,W)}static Transform(V,p){const W=new k(new z.n(0,0,0),new z.n(0,0,0));return k.TransformToRef(V,p,W),W}static TransformToRef(V,p,W){z.n.TransformCoordinatesToRef(V.origin,p,W.origin),z.n.TransformNormalToRef(V.direction,p,W.direction),W.length=V.length,W.epsilon=V.epsilon;const N=W.direction,d=N.length();if(0!==d&&1!==d){const V=1/d;N.x*=V,N.y*=V,N.z*=V,W.length*=d}return W}unprojectRayToRef(V,p,W,N,d,E,S){const Q=z.i.Matrix[0];d.multiplyToRef(E,Q),Q.multiplyToRef(S,Q),Q.invert();const J=i.d.LastCreatedEngine,l=z.i.fb[0];l.x=V/W*2-1,l.y=-(p/N*2-1),l.z=null!==J&&void 0!==J&&J.useReverseDepthBuffer?1:null!==J&&void 0!==J&&J.isNDCHalfZRange?0:-1;const j=z.i.fb[1].ge(l.x,l.y,1-1e-8),k=z.i.fb[2],u=z.i.fb[3];z.n._UnprojectFromInvertedMatrixToRef(l,Q,k),z.n._UnprojectFromInvertedMatrixToRef(j,Q,u),this.origin.p(k),u.subtractToRef(k,this.direction),this.direction.normalize()}}function u(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const z=k.Zero();return f(V,p,W,N,z,d,E),z}function f(V,p,W,N,d,E){let S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const J=V.getEngine();if(!E&&!(E=V.activeCamera))return V;const i=E.viewport,l=J.getRenderHeight(),{x:j,y:k,width:u,height:f}=i.toGlobal(J.getRenderWidth(),l),O=1/J.getHardwareScalingLevel();return p=p*O-j,W=W*O-(l-k-f),d.update(p,W,u,f,N||z.e.IdentityReadOnly,S?z.e.IdentityReadOnly:E.getViewMatrix(),E.getProjectionMatrix(),Q),V}function O(V,p,W,N,d){if(!J.e)return V;const E=V.getEngine();if(!d&&!(d=V.activeCamera))throw new Error("Active camera not set");const S=d.viewport,Q=E.getRenderHeight(),{x:i,y:l,width:j,height:k}=S.toGlobal(E.getRenderWidth(),Q),u=z.e.Identity(),f=1/E.getHardwareScalingLevel();return p=p*f-i,W=W*f-(Q-l-k),N.update(p,W,j,k,u,u,d.getProjectionMatrix()),V}function U(V,p,W,N,d,E,z,S){const Q=p(N,W.enableDistantPicking),J=W.intersects(Q,d,z,E,N,S);return J&&J.hit?!d&&null!=V&&J.distance>=V.distance?null:J:null}function F(V,p,W,N,d,E){let S=null;const Q=!!(V.activeCameras&&V.activeCameras.length>1&&V.cameraToUseForPointers!==V.activeCamera),i=V.cameraToUseForPointers||V.activeCamera,l=j.internalPickerForMesh||U;for(let J=0;J<V.meshes.length;J++){const j=V.meshes[J];if(W){if(!W(j,-1))continue}else if(!j.isEnabled()||!j.isVisible||!j.sb)continue;const k=Q&&j.isWorldMatrixCameraDependent(),u=j.Dj(k,i);if(j.hasThinInstances&&j.thinInstanceEnablePicking){const V=l(S,p,j,u,!0,!0,E);if(V){if(d)return V;const Q=z.i.Matrix[1],J=j.thinInstanceGetWorldMatrices();for(let V=0;V<J.length;V++){if(W&&!W(j,V))continue;J[V].multiplyToRef(u,Q);const z=l(S,p,j,Q,N,d,E,!0);if(z&&(S=z,S.thinInstanceIndex=V,N))return S}}}else{const V=l(S,p,j,u,N,d,E);if(V&&(S=V,N))return S}}return S||new J.e}function C(V,p,W,N){if(!J.e)return null;const d=[],E=!!(V.activeCameras&&V.activeCameras.length>1&&V.cameraToUseForPointers!==V.activeCamera),S=V.cameraToUseForPointers||V.activeCamera,Q=j.internalPickerForMesh||U;for(let J=0;J<V.meshes.length;J++){const i=V.meshes[J];if(W){if(!W(i,-1))continue}else if(!i.isEnabled()||!i.isVisible||!i.sb)continue;const l=E&&i.isWorldMatrixCameraDependent(),j=i.Dj(l,S);if(i.hasThinInstances&&i.thinInstanceEnablePicking){if(Q(null,p,i,j,!0,!0,N)){const V=z.i.Matrix[1],E=i.thinInstanceGetWorldMatrices();for(let z=0;z<E.length;z++){if(W&&!W(i,z))continue;E[z].multiplyToRef(j,V);const S=Q(null,p,i,V,!1,!1,N,!0);S&&(S.thinInstanceIndex=z,d.push(S))}}}else{const V=Q(null,p,i,j,!1,!1,N);V&&d.push(V)}}return d}function A(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,N=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0;N||(N=V.getWorldMatrix()),p.length=W,d?p.origin.p(d):p.origin.p(V.position);const E=z.i.fb[2];E.set(0,0,V._scene.useRightHandedSystem?-1:1);const S=z.i.fb[3];return z.n.TransformNormalToRef(E,N,S),z.n.NormalizeToRef(S,p.direction),p}var v,t;k._TmpVector3=(0,S.e)(6,z.n.Zero),k._RayDistant=k.Zero(),k._Smallnum=1e-8,k._Rayl=1e9,v=N.e,(t=d.d)&&(t.prototype.getForwardRay=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,p=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;return A(this,new k(z.n.Zero(),z.n.Zero(),V),V,p,W)},t.prototype.getForwardRayToRef=function(V){return A(this,V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),v&&(l.e._IsPickingAvailable=!0,v.prototype.createPickingRay=function(V,p,W,N){return u(this,V,p,W,N,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),N.e.prototype.createPickingRayToRef=function(V,p,W,N,d){return f(this,V,p,W,N,d,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},N.e.prototype.createPickingRayInCameraSpace=function(V,p,W){return function(V,p,W,N){const d=k.Zero();return O(V,p,W,d,N),d}(this,V,p,W)},N.e.prototype.createPickingRayInCameraSpaceToRef=function(V,p,W,N){return O(this,V,p,W,N)},N.e.prototype.pickWithBoundingInfo=function(V,p,W,N,d){return function(V,p,W,N,d,E){if(!J.e)return null;const S=F(V,(N=>(V._tempPickingRay||(V._tempPickingRay=k.Zero()),f(V,p,W,N,V._tempPickingRay,E||null),V._tempPickingRay)),N,d,!0);return S&&(S.ray=u(V,p,W,z.e.Identity(),E||null)),S}(this,V,p,W,N,d)},N.e.prototype.dd=function(V,p,W,N,d,E){return function(V,p,W,N,d,E,S){const Q=F(V,((N,d)=>(V._tempPickingRay||(V._tempPickingRay=k.Zero()),f(V,p,W,N,V._tempPickingRay,E||null,!1,d),V._tempPickingRay)),N,d,!1,S);return Q&&(Q.ray=u(V,p,W,z.e.Identity(),E||null)),Q}(this,V,p,W,N,d,E)},N.e.prototype.pickWithRay=function(V,p,W,N){return function(V,p,W,N,d){const E=F(V,(W=>(V._pickWithRayInverseMatrix||(V._pickWithRayInverseMatrix=z.e.Identity()),W.invertToRef(V._pickWithRayInverseMatrix),V._cachedRayForTransform||(V._cachedRayForTransform=k.Zero()),k.TransformToRef(p,V._pickWithRayInverseMatrix,V._cachedRayForTransform),V._cachedRayForTransform)),W,N,!1,d);return E&&(E.ray=p),E}(this,V,p,W,N)},N.e.prototype.multiPick=function(V,p,W,N,d){return function(V,p,W,N,d,E){return C(V,(N=>u(V,p,W,N,d||null)),N,E)}(this,V,p,W,N,d)},N.e.prototype.multiPickWithRay=function(V,p,W){return function(V,p,W,N){return C(V,(W=>(V._pickWithRayInverseMatrix||(V._pickWithRayInverseMatrix=z.e.Identity()),W.invertToRef(V._pickWithRayInverseMatrix),V._cachedRayForTransform||(V._cachedRayForTransform=k.Zero()),k.TransformToRef(p,V._pickWithRayInverseMatrix,V._cachedRayForTransform),V._cachedRayForTransform)),W,N)}(this,V,p,W)}},11815:(V,p,W)=>{"use strict";var N=W(10983),d=W(10870),E=W(10902),z=W(11007),S=W(10941),Q=W(10995);S.d.prototype._partialLoadFile=function(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(V,(V=>{W[p]=V,W._internalCount++,6===W._internalCount&&N(W)}),void 0,void 0,!0,((V,p)=>{d&&V&&d(V.status+" "+V.statusText,p)}))},S.d.prototype._cascadeLoadFiles=function(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const d=[];d._internalCount=0;for(let E=0;E<6;E++)this._partialLoadFile(W[E],E,d,p,N)},S.d.prototype._cascadeLoadImgs=function(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5?arguments[5]:void 0;const z=[];z._internalCount=0;for(let S=0;S<6;S++)this._partialLoadImg(N[S],S,z,V,p,W,d,E)},S.d.prototype._partialLoadImg=function(V,p,W,N,d,S){let Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7?arguments[7]:void 0;const i=(0,z.b)();(0,E.p)(V,(V=>{W[p]=V,W._internalCount++,N&&N.removePendingData(i),6===W._internalCount&&S&&S(d,W)}),((V,p)=>{N&&N.removePendingData(i),Q&&Q(V,p)}),N?N.offlineProvider:null,J),N&&N.addPendingData(i)},S.d.prototype.createCubeTextureBase=function(V,p,W,E){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6?arguments[6]:void 0,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,k=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,O=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,U=arguments.length>14&&void 0!==arguments[14]&&arguments[14],F=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const C=u||new N.e(this,7);C.isCube=!0,C.url=V,C.generateMipMaps=!E,C._lodGenerationScale=j,C._lodGenerationOffset=k,C._useSRGBBuffer=!!U&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!E),C!==u&&(C.label=V.substring(0,60)),this._doNotHandleContextLost||(C._extension=i,C._files=W,C._buffer=F);const A=V;this._transformTextureUrl&&!u&&(V=this._transformTextureUrl(V));const v=V.split("?")[0],t=v.lastIndexOf("."),e=i||(t>-1?v.substring(t).toLowerCase():""),Z=(0,Q.b)(e),o=(N,Q)=>{V===A?S&&N&&S(N.status+" "+N.statusText,Q):(d.e.Warn(`Failed to load ${V}, falling back to the ${A}`),this.createCubeTextureBase(A,p,W,!!E,z,S,J,i,l,j,k,C,f,O,U,F))};if(Z)Z.then((N=>{const E=V=>{f&&f(C,V),N.loadCubeData(V,C,l,z,S)};F?E(F):W&&6===W.length?N.supportCascades?this._cascadeLoadFiles(p,(V=>E(V.map((V=>new Uint8Array(V))))),W,S):S?S("Textures type does not support cascades."):d.e.Warn("Texture loader does not support cascades."):this._loadFile(V,(V=>E(new Uint8Array(V))),void 0,void 0,!0,o)}));else{if(!W||0===W.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(p,C,((V,p)=>{O&&O(V,p)}),W,S)}return this._internalTexturesCache.push(C),C}},11754:(V,p,W)=>{"use strict";W(10941).d.prototype.createDepthStencilTexture=function(V,p,W){if(p.isCube){const W=V.width||V;return this._createDepthStencilCubeTexture(W,p)}return this._createDepthStencilTexture(V,p,W)}},11735:(V,p,W)=>{"use strict";W(11705).ThinEngine.prototype.setAlphaMode=function(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==V){switch(V){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}p||(this.depthCullingState.depthMask=0===V),this._alphaMode=V}else if(!p){const p=0===V;this.depthCullingState.depthMask!==p&&(this.depthCullingState.depthMask=p)}}},11696:(V,p,W)=>{"use strict";var N=W(11705);N.ThinEngine.prototype.updateDynamicIndexBuffer=function(V,p){let W;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(V),W=V.is32Bits?p instanceof Uint32Array?p:new Uint32Array(p):p instanceof Uint16Array?p:new Uint16Array(p),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,W,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},N.ThinEngine.prototype.updateDynamicVertexBuffer=function(V,p,W,N){this.bindArrayBuffer(V),void 0===W&&(W=0);const d=p.byteLength||p.length;void 0===N||N>=d&&0===W?p instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,W,new Float32Array(p)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,W,p):p instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(p).subarray(W,W+N)):(p=p instanceof ArrayBuffer?new Uint8Array(p,W,N):new Uint8Array(p.buffer,p.byteOffset+W,N),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,p)),this._resetVertexBufferBinding()}},11742:(V,p,W)=>{"use strict";var N=W(10983),d=W(10870),E=W(11705),z=W(11750);class S extends z.b{constructor(V,p,W,N,d){super(V,p,W,N),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=d}_cloneRenderTargetWrapper(){let V=null;return this._colorTextureArray&&this._depthStencilTextureArray?(V=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),V.texture.isReady=!0):V=super._cloneRenderTargetWrapper(),V}_swapRenderTargetWrapper(V){super._swapRenderTargetWrapper(V),V._framebuffer=this._framebuffer,V._depthStencilBuffer=this._depthStencilBuffer,V._MSAAFramebuffer=this._MSAAFramebuffer,V._colorTextureArray=this._colorTextureArray,V._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,E=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const V=this._engine,p=V._currentFramebuffer,W=this._context;V._bindUnboundFramebuffer(this._framebuffer),W.framebufferRenderbuffer(W.FRAMEBUFFER,W.DEPTH_STENCIL_ATTACHMENT,W.RENDERBUFFER,null),W.framebufferRenderbuffer(W.FRAMEBUFFER,W.DEPTH_ATTACHMENT,W.RENDERBUFFER,null),W.framebufferRenderbuffer(W.FRAMEBUFFER,W.STENCIL_ATTACHMENT,W.RENDERBUFFER,null),V._bindUnboundFramebuffer(p),W.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(V,p,W,N,d,E)}shareDepth(V){super.shareDepth(V);const p=this._context,W=this._depthStencilBuffer,N=V._MSAAFramebuffer||V._framebuffer,d=this._engine;V._depthStencilBuffer&&V._depthStencilBuffer!==W&&p.deleteRenderbuffer(V._depthStencilBuffer),V._depthStencilBuffer=W;const E=V._generateStencilBuffer?p.DEPTH_STENCIL_ATTACHMENT:p.DEPTH_ATTACHMENT;d._bindUnboundFramebuffer(N),p.framebufferRenderbuffer(p.FRAMEBUFFER,E,p.RENDERBUFFER,W),d._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!V._hardwareTexture)return;const d=this._framebuffer,E=this._engine,z=E._currentFramebuffer;if(E._bindUnboundFramebuffer(d),E.webGLVersion>1){const d=this._context,E=d["COLOR_ATTACHMENT"+p];var S;if(V.is2DArray||V.is3D)W=W??(null===(S=this.layerIndices)||void 0===S?void 0:S[p])??0,d.framebufferTextureLayer(d.FRAMEBUFFER,E,V._hardwareTexture.underlyingResource,N,W);else if(V.isCube){var Q;W=W??(null===(Q=this.faceIndices)||void 0===Q?void 0:Q[p])??0,d.framebufferTexture2D(d.FRAMEBUFFER,E,d.TEXTURE_CUBE_MAP_POSITIVE_X+W,V._hardwareTexture.underlyingResource,N)}else d.framebufferTexture2D(d.FRAMEBUFFER,E,d.TEXTURE_2D,V._hardwareTexture.underlyingResource,N)}else{const d=this._context,E=d["COLOR_ATTACHMENT"+p+"_WEBGL"],z=void 0!==W?d.TEXTURE_CUBE_MAP_POSITIVE_X+W:d.TEXTURE_2D;d.framebufferTexture2D(d.FRAMEBUFFER,E,z,V._hardwareTexture.underlyingResource,N)}E._bindUnboundFramebuffer(z)}setTexture(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(V,p,W),this._bindTextureRenderTarget(V,p)}setLayerAndFaceIndices(V,p){var W;if(super.setLayerAndFaceIndices(V,p),!this.textures||!this.layerIndices||!this.faceIndices)return;const N=(null===(W=this._attachments)||void 0===W?void 0:W.length)??this.textures.length;for(let d=0;d<N;d++){const V=this.textures[d];V&&(V.is2DArray||V.is3D?this._bindTextureRenderTarget(V,d,this.layerIndices[d]):V.isCube?this._bindTextureRenderTarget(V,d,this.faceIndices[d]):this._bindTextureRenderTarget(V,d))}}setLayerAndFaceIndex(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(V,p,W),!this.textures||!this.layerIndices||!this.faceIndices)return;const N=this.textures[V];N.is2DArray||N.is3D?this._bindTextureRenderTarget(this.textures[V],V,this.layerIndices[V]):N.isCube&&this._bindTextureRenderTarget(this.textures[V],V,this.faceIndices[V])}dispose(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const p=this._context;V||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(p.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(p.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(p.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(V)}}W(11754);E.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(V,p,W){const N=new S(V,p,W,this,this._gl);return this._renderTargetWrapperCache.push(N),N},E.ThinEngine.prototype.createRenderTargetTexture=function(V,p){const W=this._createHardwareRenderTargetWrapper(!1,!1,V);let N,d,E=!0,z=!1,S=!1,Q=1;void 0!==p&&"object"===typeof p&&(E=p.generateDepthBuffer??!0,z=!!p.generateStencilBuffer,S=!!p.noColorAttachment,N=p.colorAttachment,Q=p.samples??1,d=p.label);const J=N||(S?null:this._createInternalTexture(V,p,!0,5)),i=V.width||V,l=V.height||V,j=this._currentFramebuffer,k=this._gl,u=k.createFramebuffer();if(this._bindUnboundFramebuffer(u),W._depthStencilBuffer=this._setupFramebufferDepthAttachments(z,E,i,l),!J||J.is2DArray||J.is3D||k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_2D,J._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(j),W.label=d??"RenderTargetWrapper",W._framebuffer=u,W._generateDepthBuffer=E,W._generateStencilBuffer=z,W.setTextures(J),N){if(W._samples=N.samples,N.samples>1){const V=N._hardwareTexture.getMSAARenderBuffer(0);W._MSAAFramebuffer=k.createFramebuffer(),this._bindUnboundFramebuffer(W._MSAAFramebuffer),k.framebufferRenderbuffer(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.RENDERBUFFER,V),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(W,Q);return W},E.ThinEngine.prototype._createDepthStencilTexture=function(V,p,W){const E=this._gl,z=V.layers||0,S=V.depth||0;let Q=E.TEXTURE_2D;0!==z?Q=E.TEXTURE_2D_ARRAY:0!==S&&(Q=E.TEXTURE_3D);const J=new N.e(this,12);if(J.label=p.label,!this._caps.depthTextureExtension)return d.e.Error("Depth texture is not supported by your browser or hardware."),J;const i={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...p};if(this._bindTextureDirectly(Q,J,!0),this._setupDepthStencilTexture(J,V,0!==i.comparisonFunction&&i.bilinearFiltering,i.comparisonFunction,i.samples),void 0!==i.depthTextureFormat){if(15!==i.depthTextureFormat&&16!==i.depthTextureFormat&&17!==i.depthTextureFormat&&13!==i.depthTextureFormat&&14!==i.depthTextureFormat&&18!==i.depthTextureFormat)return d.e.Error(`Depth texture ${i.depthTextureFormat} format is not supported.`),J;J.format=i.depthTextureFormat}else J.format=i.generateStencil?13:16;const l=17===J.format||13===J.format||18===J.format;let j=E.UNSIGNED_INT;15===J.format?j=E.UNSIGNED_SHORT:17===J.format||13===J.format?j=E.UNSIGNED_INT_24_8:14===J.format?j=E.FLOAT:18===J.format&&(j=E.FLOAT_32_UNSIGNED_INT_24_8_REV);const k=l?E.DEPTH_STENCIL:E.DEPTH_COMPONENT,u=this._getInternalFormatFromDepthTextureFormat(J.format,!0,l);return J.is2DArray?E.texImage3D(Q,0,u,J.width,J.height,z,0,k,j,null):J.is3D?E.texImage3D(Q,0,u,J.width,J.height,S,0,k,j,null):E.texImage2D(Q,0,u,J.width,J.height,0,k,j,null),this._bindTextureDirectly(Q,null),this._internalTexturesCache.push(J),W._depthStencilBuffer&&(E.deleteRenderbuffer(W._depthStencilBuffer),W._depthStencilBuffer=null),this._bindUnboundFramebuffer(W._MSAAFramebuffer??W._framebuffer),W._generateStencilBuffer=l,W._depthStencilTextureWithStencil=l,W._depthStencilBuffer=this._setupFramebufferDepthAttachments(W._generateStencilBuffer,W._generateDepthBuffer,W.width,W.height,W.samples,J.format),this._bindUnboundFramebuffer(null),J},E.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(V,p){var W;if(this.webGLVersion<2||!V)return 1;if(V.samples===p)return p;const N=this._gl;p=Math.min(p,this.getCaps().maxMSAASamples),V._depthStencilBuffer&&(N.deleteRenderbuffer(V._depthStencilBuffer),V._depthStencilBuffer=null),V._MSAAFramebuffer&&(N.deleteFramebuffer(V._MSAAFramebuffer),V._MSAAFramebuffer=null);const d=null===(W=V.texture)||void 0===W?void 0:W._hardwareTexture;if(null===d||void 0===d||d.releaseMSAARenderBuffers(),V.texture&&p>1&&"function"===typeof N.renderbufferStorageMultisample){const W=N.createFramebuffer();if(!W)throw new Error("Unable to create multi sampled framebuffer");V._MSAAFramebuffer=W,this._bindUnboundFramebuffer(V._MSAAFramebuffer);const E=this._createRenderBuffer(V.texture.width,V.texture.height,p,-1,this._getRGBABufferInternalSizedFormat(V.texture.type,V.texture.format,V.texture._useSRGBBuffer),N.COLOR_ATTACHMENT0,!1);if(!E)throw new Error("Unable to create multi sampled framebuffer");null===d||void 0===d||d.addMSAARenderBuffer(E)}this._bindUnboundFramebuffer(V._MSAAFramebuffer??V._framebuffer),V.texture&&(V.texture.samples=p),V._samples=p;const E=V._depthStencilTexture?V._depthStencilTexture.format:void 0;return V._depthStencilBuffer=this._setupFramebufferDepthAttachments(V._generateStencilBuffer,V._generateDepthBuffer,V.width,V.height,p,E),this._bindUnboundFramebuffer(null),p},E.ThinEngine.prototype._setupDepthStencilTexture=function(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const E=p.width??p,z=p.height??p,S=p.layers||0,Q=p.depth||0;V.baseWidth=E,V.baseHeight=z,V.width=E,V.height=z,V.is2DArray=S>0,V.depth=S||Q,V.isReady=!0,V.samples=d,V.generateMipMaps=!1,V.samplingMode=W?2:1,V.type=0,V._comparisonFunction=N;const J=this._gl,i=this._getTextureTarget(V),l=this._getSamplingParameters(V.samplingMode,!1);J.texParameteri(i,J.TEXTURE_MAG_FILTER,l.mag),J.texParameteri(i,J.TEXTURE_MIN_FILTER,l.min),J.texParameteri(i,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(i,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===N?(J.texParameteri(i,J.TEXTURE_COMPARE_FUNC,515),J.texParameteri(i,J.TEXTURE_COMPARE_MODE,J.NONE)):(J.texParameteri(i,J.TEXTURE_COMPARE_FUNC,N),J.texParameteri(i,J.TEXTURE_COMPARE_MODE,J.COMPARE_REF_TO_TEXTURE)))}},10923:(V,p,W)=>{"use strict";W.d(p,{d:()=>Z,e:()=>t,g:()=>e,h:()=>P,i:()=>b});class N{constructor(){this.children=[]}isValid(V){return!0}process(V,p){let W="";if(this.line){let J=this.line;const i=p.processor;if(i){var N,d,E,z,S,Q;i.lineProcessor&&(J=i.lineProcessor(J,p.isFragment,p.processingContext));const W=(null===(N=p.processor)||void 0===N?void 0:N.attributeKeywordName)??"attribute",l=p.isFragment&&null!==(d=p.processor)&&void 0!==d&&d.varyingFragmentKeywordName?null===(E=p.processor)||void 0===E?void 0:E.varyingFragmentKeywordName:!p.isFragment&&null!==(z=p.processor)&&void 0!==z&&z.varyingVertexKeywordName?null===(S=p.processor)||void 0===S?void 0:S.varyingVertexKeywordName:"varying";if(!p.isFragment&&i.attributeProcessor&&this.line.startsWith(W))J=i.attributeProcessor(this.line,V,p.processingContext);else if(i.varyingProcessor&&(null!==(Q=i.varyingCheck)&&void 0!==Q&&Q.call(i,this.line,p.isFragment)||!i.varyingCheck&&this.line.startsWith(l)))J=i.varyingProcessor(this.line,p.isFragment,V,p.processingContext);else if(i.uniformProcessor&&i.uniformRegexp&&i.uniformRegexp.test(this.line))p.lookForClosingBracketForUniformBuffer||(J=i.uniformProcessor(this.line,p.isFragment,V,p.processingContext));else if(i.uniformBufferProcessor&&i.uniformBufferRegexp&&i.uniformBufferRegexp.test(this.line))p.lookForClosingBracketForUniformBuffer||(J=i.uniformBufferProcessor(this.line,p.isFragment,p.processingContext),p.lookForClosingBracketForUniformBuffer=!0);else if(i.textureProcessor&&i.textureRegexp&&i.textureRegexp.test(this.line))J=i.textureProcessor(this.line,p.isFragment,V,p.processingContext);else if((i.uniformProcessor||i.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!p.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?i.uniformProcessor&&(J=i.uniformProcessor(this.line,p.isFragment,V,p.processingContext)):i.uniformBufferProcessor&&(J=i.uniformBufferProcessor(this.line,p.isFragment,p.processingContext),p.lookForClosingBracketForUniformBuffer=!0)}p.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(p.lookForClosingBracketForUniformBuffer=!1,i.endOfUniformBufferProcessor&&(J=i.endOfUniformBufferProcessor(this.line,p.isFragment,p.processingContext)))}W+=J+"\n"}return this.children.forEach((N=>{W+=N.process(V,p)})),this.additionalDefineKey&&(V[this.additionalDefineKey]=this.additionalDefineValue||"true"),W}}class d{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(V){this._lines.length=0;for(const p of V){if(!p||"\r"===p)continue;if("#"===p[0]){this._lines.push(p);continue}const V=p.trim();if(!V)continue;if(V.startsWith("//")){this._lines.push(p);continue}const W=V.indexOf(";");if(-1===W)this._lines.push(V);else if(W===V.length-1)V.length>1&&this._lines.push(V);else{const V=p.split(";");for(let p=0;p<V.length;p++){let W=V[p];W&&(W=W.trim(),W&&this._lines.push(W+(p!==V.length-1?";":"")))}}}}}class E extends N{process(V,p){for(let W=0;W<this.children.length;W++){const N=this.children[W];if(N.isValid(V))return N.process(V,p)}return""}}class z extends N{isValid(V){return this.testExpression.isTrue(V)}}class S{isTrue(V){return!0}static postfixToInfix(V){const p=[];for(const W of V)if(void 0===S._OperatorPriority[W])p.push(W);else{const V=p[p.length-1],N=p[p.length-2];p.length-=2,p.push(`(${N}${W}${V})`)}return p[p.length-1]}static infixToPostfix(V){const p=S._InfixToPostfixCache.get(V);if(p)return p.accessTime=Date.now(),p.result;if(!V.includes("&&")&&!V.includes("||")&&!V.includes(")")&&!V.includes("("))return[V];const W=[];let N=-1;const d=()=>{i=i.trim(),""!==i&&(W.push(i),i="")},E=V=>{N<S._Stack.length-1&&(S._Stack[++N]=V)},z=()=>S._Stack[N],Q=()=>-1===N?"!!INVALID EXPRESSION!!":S._Stack[N--];let J=0,i="";for(;J<V.length;){const p=V.charAt(J),l=J<V.length-1?V.substring(J,2+J):"";if("("===p)i="",E(p);else if(")"===p){for(d();-1!==N&&"("!==z();)W.push(Q());Q()}else if(S._OperatorPriority[l]>1){for(d();-1!==N&&S._OperatorPriority[z()]>=S._OperatorPriority[l];)W.push(Q());E(l),J++}else i+=p;J++}for(d();-1!==N;)"("===z()?Q():W.push(Q());return S._InfixToPostfixCache.size>=S.InfixToPostfixCacheLimitSize&&S.ClearCache(),S._InfixToPostfixCache.set(V,{result:W,accessTime:Date.now()}),W}static ClearCache(){const V=Array.from(S._InfixToPostfixCache.entries()).sort(((V,p)=>V[1].accessTime-p[1].accessTime));for(let p=0;p<S.InfixToPostfixCacheCleanupSize;p++)S._InfixToPostfixCache.delete(V[p][0])}}S.InfixToPostfixCacheLimitSize=5e4,S.InfixToPostfixCacheCleanupSize=25e3,S._InfixToPostfixCache=new Map,S._OperatorPriority={")":0,"(":1,"||":2,"&&":3},S._Stack=["","","","","","","","","","","","","","","","","","","",""];class Q extends S{constructor(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=V,this.not=p}isTrue(V){let p=void 0!==V[this.define];return this.not&&(p=!p),p}}class J extends S{isTrue(V){return this.leftOperand.isTrue(V)||this.rightOperand.isTrue(V)}}class i extends S{isTrue(V){return this.leftOperand.isTrue(V)&&this.rightOperand.isTrue(V)}}class l extends S{constructor(V,p,W){super(),this.define=V,this.operand=p,this.testValue=W}isTrue(V){let p=V[this.define];void 0===p&&(p=this.define);let W=!1;const N=parseInt(p),d=parseInt(this.testValue);switch(this.operand){case">":W=N>d;break;case"<":W=N<d;break;case"<=":W=N<=d;break;case">=":W=N>=d;break;case"==":W=N===d;break;case"!=":W=N!==d}return W}}var j=W(10887),k=W(10927);const u=/defined\s*?\((.+?)\)/g,f=/defined\s*?\[(.+?)\]/g,O=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,U=/__decl__/,F=/light\{X\}.(\w*)/g,C=/\{X\}/g,A=[],v=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function t(V){V.processor&&V.processor.initializeShaders&&V.processor.initializeShaders(V.processingContext)}function e(V,p,W,N){var d;null!==(d=p.processor)&&void 0!==d&&d.preProcessShaderCode&&(V=p.processor.preProcessShaderCode(V,p.isFragment)),P(V,p,(V=>{p.processCodeAfterIncludes&&(V=p.processCodeAfterIncludes(p.isFragment?"fragment":"vertex",V,p.defines));const d=function(V,p,W){let N=function(V,p){var W;if(null!==(W=p.processor)&&void 0!==W&&W.noPrecision)return V;const N=p.shouldUseHighPrecisionShader;-1===V.indexOf("precision highp float")?V=N?"precision highp float;\n"+V:"precision mediump float;\n"+V:N||(V=V.replace("precision highp float","precision mediump float"));return V}(V,p);if(!p.processor)return N;if(0===p.processor.shaderLanguage&&-1!==N.indexOf("#version 3")&&(N=N.replace("#version 300 es",""),!p.processor.parseGLES3))return N;const d=p.defines,E=T(p,W);p.processor.preProcessor&&(N=p.processor.preProcessor(N,d,E,p.isFragment,p.processingContext));N=x(N,E,p),p.processor.postProcessor&&(N=p.processor.postProcessor(N,d,p.isFragment,p.processingContext,W?{drawBuffersExtensionDisabled:!W.getCaps().drawBuffersExtension}:{}));null!==W&&void 0!==W&&W._features.needShaderCodeInlining&&(N=W.inlineShaderCode(N));return N}(V,p,N);W(d,V)}))}function Z(V,p,W){return W.processor&&W.processor.finalizeShaders?W.processor.finalizeShaders(V,p,W.processingContext):{vertexCode:V,fragmentCode:p}}function o(V){const p=/defined\((.+)\)/.exec(V);if(p&&p.length)return new Q(p[1].trim(),"!"===V[0]);const W=["==","!=",">=","<=","<",">"];let N="",d=0;for(N of W)if(d=V.indexOf(N),d>-1)break;if(-1===d)return new Q(V);const E=V.substring(0,d).trim(),z=V.substring(d+N.length).trim();return new l(E,N,z)}function K(V,p){const W=new z,N=V.substring(0,p);let d=V.substring(p);return d=d.substring(0,(d.indexOf("//")+1||d.length+1)-1).trim(),W.testExpression="#ifdef"===N?new Q(d):"#ifndef"===N?new Q(d,!0):function(V){V=V.replace(u,"defined[$1]");const p=S.infixToPostfix(V),W=[];for(const d of p)if("||"!==d&&"&&"!==d)W.push(d);else if(W.length>=2){let V=W[W.length-1],p=W[W.length-2];W.length-=2;const N="&&"==d?new i:new J;"string"===typeof V&&(V=V.replace(f,"defined($1)")),"string"===typeof p&&(p=p.replace(f,"defined($1)")),N.leftOperand="string"===typeof p?o(p):p,N.rightOperand="string"===typeof V?o(V):V,W.push(N)}let N=W[W.length-1];return"string"===typeof N&&(N=N.replace(f,"defined($1)")),"string"===typeof N?o(N):N}(d),W}function h(V,p,W){let d=V.currentLine;for(;L(V,W);){d=V.currentLine;const E=d.substring(0,5).toLowerCase();if("#else"===E){const W=new N;return p.children.push(W),void L(V,W)}if("#elif"===E){const V=K(d,5);p.children.push(V),W=V}}}function L(V,p){for(;V.canRead;){V.lineIndex++;const W=V.currentLine;if(W.indexOf("#")>=0){const N=v.exec(W);if(N&&N.length){switch(N[0]){case"#ifdef":{const N=new E;p.children.push(N);const d=K(W,6);N.children.push(d),h(V,N,d);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const N=new E;p.children.push(N);const d=K(W,7);N.children.push(d),h(V,N,d);break}case"#if":{const N=new E,d=K(W,3);p.children.push(N),N.children.push(d),h(V,N,d);break}}continue}}const d=new N;if(d.line=W,p.children.push(d),"#"===W[0]&&"d"===W[1]){const V=W.replace(";","").split(" ");d.additionalDefineKey=V[1],3===V.length&&(d.additionalDefineValue=V[2])}}return!1}function x(V,p,W){const E=new N,z=new d;return z.lineIndex=-1,z.lines=V.split("\n"),L(z,E),E.process(p,W)}function T(V,p){var W;const N=V.defines,d={};for(const E of N){const V=E.replace("#define","").replace(";","").trim().split(" ");d[V[0]]=V.length>1?V[1]:""}return 0===(null===(W=V.processor)||void 0===W?void 0:W.shaderLanguage)&&(d.GL_ES="true"),d.__VERSION__=V.version,d[V.platformName]="true",(0,k.j)(d,null===p||void 0===p?void 0:p.isNDCHalfZRange,null===p||void 0===p?void 0:p.useReverseDepthBuffer,null===p||void 0===p?void 0:p.useExactSrgbConversions),d}function P(V,p,W){let N;for(A.length=0;null!==(N=O.exec(V));)A.push(N);let d=String(V),E=[V],z=!1;for(const S of A){let V=S[1];if(-1!==V.indexOf("__decl__")&&(V=V.replace(U,""),p.supportsUniformBuffers&&(V=V.replace("Vertex","Ubo").replace("Fragment","Ubo")),V+="Declaration"),!p.includesShadersStore[V]){const N=p.shadersRepository+"ShadersInclude/"+V+".fx";return void b.loadFile(N,(N=>{p.includesShadersStore[V]=N,P(E.join(""),p,W)}))}{let W=p.includesShadersStore[V];if(S[2]){const V=S[3].split(",");for(let p=0;p<V.length;p+=2){const N=new RegExp(V[p],"g"),d=V[p+1];W=W.replace(N,d)}}if(S[4]){const V=S[5];if(-1!==V.indexOf("..")){const N=V.split(".."),d=parseInt(N[0]);let E=parseInt(N[1]),z=W.slice(0);W="",isNaN(E)&&(E=p.indexParameters[N[1]]);for(let V=d;V<E;V++)p.supportsUniformBuffers||(z=z.replace(F,((V,p)=>p+"{X}"))),W+=z.replace(C,V.toString())+"\n"}else p.supportsUniformBuffers||(W=W.replace(F,((V,p)=>p+"{X}"))),W=W.replace(C,V)}const N=[];for(const V of E){const p=V.split(S[0]);for(let V=0;V<p.length-1;V++)N.push(p[V]),N.push(W);N.push(p[p.length-1])}E=N,z=z||W.indexOf("#include<")>=0||W.indexOf("#include <")>=0}}A.length=0,d=E.join(""),z?P(d.toString(),p,W):W(d)}const b={loadFile:(V,p,W,N,d,E)=>{throw(0,j.c)("FileTools")}}},11725:(V,p,W)=>{"use strict";W.d(p,{c:()=>N});class N{get underlyingResource(){return this._webGLTexture}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=p,!V&&(V=p.createTexture(),!V))throw new Error("Unable to create webGL texture");this.set(V)}setUsage(){}set(V){this._webGLTexture=V}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(V){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(V)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const V of this._MSAARenderBuffers)this._context.deleteRenderbuffer(V);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var V;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(V=this._MSAARenderBuffers)||void 0===V?void 0:V[p])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},10927:(V,p,W)=>{"use strict";W.d(p,{e:()=>d,g:()=>E,j:()=>S,k:()=>z,m:()=>Q});var N=W(10887);W(10862);const d={};function E(V,p){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(p?p+"\n":"")+V}function z(V,p,W,E,z,S,Q){const J=Q||d.loadFile;if(J){return J(V,p,W,E,z,S)}throw(0,N.c)("FileTools")}function S(V,p,W,N){if(V)return p?V.IS_NDC_HALF_ZRANGE="":delete V.IS_NDC_HALF_ZRANGE,W?V.USE_REVERSE_DEPTHBUFFER="":delete V.USE_REVERSE_DEPTHBUFFER,void(N?V.USE_EXACT_SRGB_CONVERSIONS="":delete V.USE_EXACT_SRGB_CONVERSIONS);{let V="";return p&&(V+="#define IS_NDC_HALF_ZRANGE"),W&&(V&&(V+="\n"),V+="#define USE_REVERSE_DEPTHBUFFER"),N&&(V&&(V+="\n"),V+="#define USE_EXACT_SRGB_CONVERSIONS"),V}}function Q(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0;switch(V){case 3:{const V=(ArrayBuffer,new Int8Array(p));return N&&V.set(new Int8Array(N)),V}case 0:{const V=(ArrayBuffer,new Uint8Array(p));return N&&V.set(new Uint8Array(N)),V}case 4:{const V=p instanceof ArrayBuffer?new Int16Array(p):new Int16Array(W?p/2:p);return N&&V.set(new Int16Array(N)),V}case 5:case 8:case 9:case 10:case 2:{const V=p instanceof ArrayBuffer?new Uint16Array(p):new Uint16Array(W?p/2:p);return N&&V.set(new Uint16Array(N)),V}case 6:{const V=p instanceof ArrayBuffer?new Int32Array(p):new Int32Array(W?p/4:p);return N&&V.set(new Int32Array(N)),V}case 7:case 11:case 12:case 13:case 14:case 15:{const V=p instanceof ArrayBuffer?new Uint32Array(p):new Uint32Array(W?p/4:p);return N&&V.set(new Uint32Array(N)),V}case 1:{const V=p instanceof ArrayBuffer?new Float32Array(p):new Float32Array(W?p/4:p);return N&&V.set(new Float32Array(N)),V}}const d=(ArrayBuffer,new Uint8Array(p));return N&&d.set(new Uint8Array(N)),d}},10941:(V,p,W)=>{"use strict";W.d(p,{d:()=>C});var N=W(10900),d=W(10870),E=W(10948),z=W(10975),S=W(10882);class Q{constructor(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,V&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(V){this._zOffset!==V&&(this._zOffset=V,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(V){this._zOffsetUnits!==V&&(this._zOffsetUnits=V,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(V){this._cullFace!==V&&(this._cullFace=V,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(V){this._cull!==V&&(this._cull=V,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(V){this._depthFunc!==V&&(this._depthFunc=V,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(V){this._depthMask!==V&&(this._depthMask=V,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(V){this._depthTest!==V&&(this._depthTest=V,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(V){this._frontFace!==V&&(this._frontFace=V,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(V){this.isDirty&&(this._isCullDirty&&(this.cull?V.enable(V.CULL_FACE):V.disable(V.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(V.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(V.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?V.enable(V.DEPTH_TEST):V.disable(V.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(V.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(V.enable(V.POLYGON_OFFSET_FILL),V.polygonOffset(this.zOffset,this.zOffsetUnits)):V.disable(V.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(V.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class J{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(V){this._func!==V&&(this._func=V,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(V){this._funcRef!==V&&(this._funcRef=V,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(V){this._funcMask!==V&&(this._funcMask=V,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(V){this._opStencilFail!==V&&(this._opStencilFail=V,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(V){this._opDepthFail!==V&&(this._opDepthFail=V,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(V){this._opStencilDepthPass!==V&&(this._opStencilDepthPass=V,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(V){this._mask!==V&&(this._mask=V,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(V){this._enabled!==V&&(this._enabled=V,this._isStencilTestDirty=!0)}constructor(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,V&&this.reset()}reset(){var V;this.stencilMaterial=void 0,null===(V=this.stencilGlobal)||void 0===V||V.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(V){var p;if(!V)return;const W=!this.useStencilGlobalOnly&&!(null===(p=this.stencilMaterial)||void 0===p||!p.enabled);this.enabled=W?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=W?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=W?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=W?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=W?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=W?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=W?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=W?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?V.enable(V.STENCIL_TEST):V.disable(V.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(V.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(V.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(V.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class i{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=i.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=i.KEEP,this.opDepthFail=i.KEEP,this.opStencilDepthPass=i.REPLACE}get stencilFunc(){return this.func}set stencilFunc(V){this.func=V}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(V){this.funcRef=V}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(V){this.funcMask=V}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(V){this.opStencilFail=V}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(V){this.opDepthFail=V}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(V){this.opStencilDepthPass=V}get stencilMask(){return this.mask}set stencilMask(V){this.mask=V}get stencilTest(){return this.enabled}set stencilTest(V){this.enabled=V}}i.ALWAYS=519,i.KEEP=7680,i.REPLACE=7681;class l{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(V){this._alphaBlend!==V&&(this._alphaBlend=V,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(V,p,W,N){this._blendConstants[0]===V&&this._blendConstants[1]===p&&this._blendConstants[2]===W&&this._blendConstants[3]===N||(this._blendConstants[0]=V,this._blendConstants[1]=p,this._blendConstants[2]=W,this._blendConstants[3]=N,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(V,p,W,N){this._blendFunctionParameters[0]===V&&this._blendFunctionParameters[1]===p&&this._blendFunctionParameters[2]===W&&this._blendFunctionParameters[3]===N||(this._blendFunctionParameters[0]=V,this._blendFunctionParameters[1]=p,this._blendFunctionParameters[2]=W,this._blendFunctionParameters[3]=N,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(V,p){this._blendEquationParameters[0]===V&&this._blendEquationParameters[1]===p||(this._blendEquationParameters[0]=V,this._blendEquationParameters[1]=p,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(V){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?V.enable(V.BLEND):V.disable(V.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(V.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(V.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(V.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var j=W(10887),k=W(10983),u=W(10862),f=W(10856),O=W(10927),U=W(10995);function F(V,p){if((0,u.l)()){const{requestAnimationFrame:W}=p||window;if("function"===typeof W)return W(V)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(V);return setTimeout(V,16)}class C{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(V){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(V){V!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=V,this._depthCullingState.depthFunc=V?518:515)}setColorWrite(V){V!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=V)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(V){if(V)return this.isNDCHalfZRange?V.IS_NDC_HALF_ZRANGE="":delete V.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?V.USE_REVERSE_DEPTHBUFFER="":delete V.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?V.USE_EXACT_SRGB_CONVERSIONS="":delete V.USE_EXACT_SRGB_CONVERSIONS);{let V="";return this.isNDCHalfZRange&&(V+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(V&&(V+="\n"),V+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(V&&(V+="\n"),V+="#define USE_EXACT_SRGB_CONVERSIONS"),V}}_rebuildInternalTextures(){const V=this._internalTexturesCache.slice();for(const p of V)p._rebuild()}_rebuildRenderTargetWrappers(){const V=this._renderTargetWrapperCache.slice();for(const p of V)p._rebuild()}_rebuildEffects(){for(const V in this._compiledEffects){const p=this._compiledEffects[V];p._pipelineContext=null,p._prepareEffect()}E.e.ResetCache()}_rebuildGraphicsResources(){var V;this.wipeCaches(!0),this._rebuildEffects(),null===(V=this._rebuildComputeEffects)||void 0===V||V.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){d.e.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(V){setTimeout((async()=>{this._clearEmptyResources();const p=this._depthCullingState.depthTest,W=this._depthCullingState.depthFunc,N=this._depthCullingState.depthMask,d=this._stencilState.stencilTest;await V(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=p,this._depthCullingState.depthFunc=W,this._depthCullingState.depthMask=N,this._stencilState.stencilTest=d,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(V){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(V){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const V=new Uint8Array(4),p=[V,V,V,V,V,V];this._emptyCubeTexture=this.createRawCubeTexture(p,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(V){if(!V)return this._activeRenderLoops.length=0,void this._cancelFrame();const p=this._activeRenderLoops.indexOf(V);p>=0&&(this._activeRenderLoops.splice(p,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const V=this._frameHandler;if(this._frameHandler=0,(0,u.l)()){const{cancelAnimationFrame:p}=this.getHostWindow()||window;if("function"===typeof p)return p(V)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(V);return clearTimeout(V)}}Vi(){this.onBeginFrameObservable.notifyObservers(this)}Wi(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let V=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(V=!1),V&&(this.Vi(),this._renderViews()||this._renderFrame(),this.Wi())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let V=0;V<this._activeRenderLoops.length;V++){(0,this._activeRenderLoops[V])()}}_renderViews(){return!1}_queueNewFrame(V,p){return F(V,p)}runRenderLoop(V){-1===this._activeRenderLoops.indexOf(V)&&(this._activeRenderLoops.push(V),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(V){this._depthCullingState.depthTest=V}setZOffset(V){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-V:V}getZOffset(){const V=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-V:V}setZOffsetUnits(V){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-V:V}getZOffsetUnits(){const V=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-V:V}getHostWindow(){return(0,u.l)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(V){this._compatibilityMode=!0}_rebuildTextures(){for(const V of this.scenes)V._rebuildTextures();for(const V of this._virtualScenes)V._rebuildTextures()}_releaseRenderTargetWrapper(V){const p=this._renderTargetWrapperCache.indexOf(V);-1!==p&&this._renderTargetWrapperCache.splice(p,1)}get currentViewport(){return this._cachedViewport}setViewport(V,p,W){const N=p||this.getRenderWidth(),d=W||this.getRenderHeight(),E=V.x||0,z=V.y||0;this._cachedViewport=V,this._viewport(E*N,z*d,N*V.width,d*V.height)}createCanvasImage(){return document.createElement("img")}get description(){let V=this.name+this.version;return this._caps.parallelShaderCompile&&(V+=" - Parallel shader compilation"),V}_createTextureBase(V,p,W,E){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7?arguments[7]:void 0,i=arguments.length>8?arguments[8]:void 0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,j=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,O=arguments.length>13?arguments[13]:void 0,F=arguments.length>14?arguments[14]:void 0,A=arguments.length>15?arguments[15]:void 0;const v="data:"===(V=V||"").substr(0,5),t="blob:"===V.substr(0,5),e=v&&-1!==V.indexOf(";base64,"),Z=j||new k.e(this,1);Z!==j&&(Z.label=V.substring(0,60));const o=V;!this._transformTextureUrl||e||j||l||(V=this._transformTextureUrl(V)),o!==V&&(Z._originalUrl=o);const K=V.lastIndexOf(".");let h=f||(K>-1?V.substring(K).toLowerCase():"");h.indexOf("?")>-1&&(h=h.split("?")[0]);const L=(0,U.b)(h,O);E&&E.addPendingData(Z),Z.url=V,Z.generateMipMaps=!p,Z.samplingMode=z,Z.invertY=W,Z._useSRGBBuffer=this._getUseSRGBBuffer(!!A,p),this._doNotHandleContextLost||(Z._buffer=l);let x=null;S&&!j&&(x=Z.onLoadedObservable.add(S)),j||this._internalTexturesCache.push(Z);const T=(W,j)=>{E&&E.removePendingData(Z),V===o?(x&&Z.onLoadedObservable.remove(x),N.d.UseFallbackTexture&&V!==N.d.FallbackTexture&&this._createTextureBase(N.d.FallbackTexture,p,Z.invertY,E,z,null,Q,J,i,l,Z),W=(W||"Unknown error")+(N.d.UseFallbackTexture?" - Fallback texture was used":""),Z.onErrorObservable.notifyObservers({message:W,exception:j}),Q&&Q(W,j)):(d.e.Warn(`Failed to load ${V}, falling back to ${o}`),this._createTextureBase(o,p,Z.invertY,E,z,S,Q,J,i,l,Z,u,f,O,F,A))};if(L){const p=async V=>{(await L).loadData(V,Z,((V,p,W,N,d,S)=>{S?T("TextureLoader failed to load data"):J(Z,h,E,{width:V,height:p},Z.invertY,!W,N,(()=>(d(),!1)),z)}),F)};l?l instanceof ArrayBuffer?p(new Uint8Array(l)):ArrayBuffer.isView(l)?p(l):Q&&Q("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(V,(V=>p(new Uint8Array(V))),void 0,E?E.offlineProvider:void 0,!0,((V,p)=>{T("Unable to load "+(V&&V.responseURL,p))}))}else{const W=V=>{t&&!this._doNotHandleContextLost&&(Z._buffer=V),J(Z,h,E,V,Z.invertY,p,!1,i,z)};!v||e?l&&("string"===typeof l.decoding||l.close)?W(l):C._FileToolsLoadImage(V||"",W,T,E?E.offlineProvider:null,O,Z.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof l||l instanceof ArrayBuffer||ArrayBuffer.isView(l)||l instanceof Blob?C._FileToolsLoadImage(l,W,T,E?E.offlineProvider:null,O,Z.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):l&&W(l)}return Z}_rebuildBuffers(){for(const V of this._uniformBuffers)V._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,u.g)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const V in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,V)&&(this._boundTexturesCache[V]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(V){this._name=V}static get NpmPackage(){return"babylonjs@7.33.0"}static get Version(){return"7.33.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(V){this._hardwareScalingLevel=V,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(V){this._doNotHandleContextLost=V}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(V,p,W){var d,E;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new Q,this._stencilStateComposer=new J,this._stencilState=new i,this._alphaState=new l,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new f.b,this.onCanvasFocusObservable=new f.b,this.onNewSceneAddedObservable=new f.b,this.onResizeObservable=new f.b,this.onCanvasPointerOutObservable=new f.b,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new f.b,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new f.b,this.onAfterShaderCompilationObservable=new f.b,this.onBeginFrameObservable=new f.b,this.onEndFrameObservable=new f.b,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new f.b,this.onContextRestoredObservable=new f.b,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.$i=new f.b,N.d.Instances.push(this),this.startTime=S.d.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,z.d.SetMatrixPrecision(!!p.useHighPrecisionMatrix),(0,u.j)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=W??!1,p.antialias=V??p.antialias,p.deterministicLockstep=p.deterministicLockstep??!1,p.lockstepMaxSteps=p.lockstepMaxSteps??4,p.timeStep=p.timeStep??1/60,p.audioEngine=p.audioEngine??!0,p.stencil=p.stencil??!0,this._audioContext=(null===(d=p.audioEngineOptions)||void 0===d?void 0:d.audioContext)??null,this._audioDestination=(null===(E=p.audioEngineOptions)||void 0===E?void 0:E.audioDestination)??null,this.premultipliedAlpha=p.premultipliedAlpha??!0,this._doNotHandleContextLost=!!p.doNotHandleContextLost,this._isStencilEnable=!!p.stencil,this.useExactSrgbConversions=p.useExactSrgbConversions??!1;const j=(0,u.l)()&&window.devicePixelRatio||1,k=p.limitDeviceRatio||j;W=W||p.adaptToDeviceRatio||!1,this._hardwareScalingLevel=W?1/Math.min(k,j):1,this._lastDevicePixelRatio=j,this._creationOptions=p}resize(){let V,p,W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const V=(0,u.l)()&&window.devicePixelRatio||1,p=this._lastDevicePixelRatio/V;this._lastDevicePixelRatio=V,this._hardwareScalingLevel*=p}if((0,u.l)()&&(0,u.g)())if(this._renderingCanvas){const W=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};V=this._renderingCanvas.clientWidth||W.width||this._renderingCanvas.width||100,p=this._renderingCanvas.clientHeight||W.height||this._renderingCanvas.height||100}else V=window.innerWidth,p=window.innerHeight;else V=this._renderingCanvas?this._renderingCanvas.width:100,p=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(V/this._hardwareScalingLevel,p/this._hardwareScalingLevel,W)}setSize(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(V|=0,p|=0,!W&&this._renderingCanvas.width===V&&this._renderingCanvas.height===p)return!1;if(this._renderingCanvas.width=V,this._renderingCanvas.height=p,this.scenes){for(let V=0;V<this.scenes.length;V++){const p=this.scenes[V];for(let V=0;V<p.cameras.length;V++){p.cameras[V]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(V,p,W,N,d,E,z,S,Q,J,i){throw(0,j.c)("engine.rawTexture")}createRawCubeTexture(V,p,W,N,d,E,z,S){throw(0,j.c)("engine.rawTexture")}createRawTexture3D(V,p,W,N,d,E,z,S,Q,J,i){throw(0,j.c)("engine.rawTexture")}createRawTexture2DArray(V,p,W,N,d,E,z,S,Q,J,i){throw(0,j.c)("engine.rawTexture")}_sharedInit(V){this._renderingCanvas=V}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const V=navigator.userAgent;this.hostInformation.isMobile=-1!==V.indexOf("Mobile")||-1!==V.indexOf("Mac")&&(0,u.g)()&&"ontouchend"in document},this._checkForMobile(),(0,u.l)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(V){return document.createElement("video")}_reportDrawCall(){var V;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(V=this._drawCalls)||void 0===V||V.addCount(p,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(V,p){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(V,p){return createImageBitmap(V,p)}resizeImageBitmap(V,p,W){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(V){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(V,p){if("undefined"===typeof document)return new OffscreenCanvas(V,p);const W=document.createElement("canvas");return W.width=V,W.height=p,W}createCanvas(V,p){return C._CreateCanvas(V,p)}static _FileToolsLoadImage(V,p,W,N,d,E){throw(0,j.c)("FileTools")}_loadFile(V,p,W,N,d,E){const z=(0,O.k)(V,p,W,N,d,E);return this._activeRequests.push(z),z.onCompleteObservable.add((()=>{const V=this._activeRequests.indexOf(z);-1!==V&&this._activeRequests.splice(V,1)})),z}static _FileToolsLoadFile(V,p,W,N,d,E){if(O.e.loadFile)return O.e.loadFile(V,p,W,N,d,E);throw(0,j.c)("FileTools")}dispose(){var V;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(V=this.releaseComputeEffects)||void 0===V||V.call(this),E.e.ResetCache();for(const W of this._activeRequests)W.abort();this._boundRenderFunction=null,this.$i.notifyObservers(this),this.$i.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,u.l)()&&window.removeEventListener("resize",this._checkForMobile);const p=N.d.Instances.indexOf(this);p>=0&&N.d.Instances.splice(p,1),N.d.Instances.length||(N.d.OnEnginesDisposedObservable.notifyObservers(this),N.d.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(V){throw(0,j.c)("LoadingScreen")}static MarkAllMaterialsAsDirty(V,p){for(let W=0;W<N.d.Instances.length;W++){const d=N.d.Instances[W];for(let W=0;W<d.scenes.length;W++)d.scenes[W].markAllMaterialsAsDirty(V,p)}}}C._RenderPassIdCounter=0,C._RescalePostProcessFactory=null,C.CollisionsEpsilon=.001,C.QueueNewFrame=F},11739:(V,p,W)=>{"use strict";W.d(p,{d:()=>Z});var N=W(10983),d=W(10900),E=W(11705),z=W(10882);class S{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new Q(V)}sampleFrame(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.d.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const p=V-this._lastFrameTimeMs;this._rollingFrameTime.add(p)}this._lastFrameTimeMs=V}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const V=this._rollingFrameTime.history(0);return 0===V?0:1e3/V}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class Q{constructor(V){this._samples=new Array(V),this.reset()}add(V){let p;if(this.isSaturated()){const V=this._samples[this._pos];p=V-this.average,this.average-=p/(this._sampleCount-1),this._m2-=p*(V-this.average)}else this._sampleCount++;p=V-this.average,this.average+=p/this._sampleCount,this._m2+=p*(V-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=V,this._pos++,this._pos%=this._samples.length}history(V){if(V>=this._sampleCount||V>=this._samples.length)return 0;const p=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(p-V)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(V){const p=this._samples.length;return(V%p+p)%p}}var J=W(11716),i=W(10870),l=W(11725),j=(W(11735),W(11016));function k(V,p,W,N){let d,E=1;1===N?d=new Float32Array(p*W*4):2===N?(d=new Uint16Array(p*W*4),E=15360):d=7===N?new Uint32Array(p*W*4):new Uint8Array(p*W*4);for(let z=0;z<p;z++)for(let N=0;N<W;N++){const W=3*(N*p+z),S=4*(N*p+z);d[S+0]=V[W+0],d[S+1]=V[W+1],d[S+2]=V[W+2],d[S+3]=E}return d}function u(V){return function(p,W,d,E,z,S,Q,J){let i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const j=V?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,k=V?10:11,u=new N.e(this,k);u.baseWidth=W,u.baseHeight=d,u.baseDepth=E,u.width=W,u.height=d,u.depth=E,u.format=z,u.type=l,u.generateMipMaps=S,u.samplingMode=J,V?u.is3D=!0:u.is2DArray=!0,this._doNotHandleContextLost||(u._bufferView=p),V?this.updateRawTexture3D(u,p,z,Q,i,l):this.updateRawTexture2DArray(u,p,z,Q,i,l),this._bindTextureDirectly(j,u,!0);const f=this._getSamplingParameters(J,S);return this._gl.texParameteri(j,this._gl.TEXTURE_MAG_FILTER,f.mag),this._gl.texParameteri(j,this._gl.TEXTURE_MIN_FILTER,f.min),S&&this._gl.generateMipmap(j),this._bindTextureDirectly(j,null),this._internalTexturesCache.push(u),u}}function f(V){return function(p,W,N,d){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const S=V?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,Q=this._getWebGLTextureType(z),J=this._getInternalFormat(N),i=this._getRGBABufferInternalSizedFormat(z,N);this._bindTextureDirectly(S,p,!0),this._unpackFlipY(void 0===d||!!d),this._doNotHandleContextLost||(p._bufferView=W,p.format=N,p.invertY=d,p._compression=E),p.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),E&&W?this._gl.compressedTexImage3D(S,0,this.getCaps().s3tc[E],p.width,p.height,p.depth,0,W):this._gl.texImage3D(S,0,i,p.width,p.height,p.depth,0,J,Q,W),p.generateMipMaps&&this._gl.generateMipmap(S),this._bindTextureDirectly(S,null),p.isReady=!0}}E.ThinEngine.prototype.updateRawTexture=function(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,z=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!V)return;const S=this._getRGBABufferInternalSizedFormat(E,W,z),Q=this._getInternalFormat(W),J=this._getWebGLTextureType(E);this._bindTextureDirectly(this._gl.TEXTURE_2D,V,!0),this._unpackFlipY(void 0===N||!!N),this._doNotHandleContextLost||(V._bufferView=p,V.format=W,V.type=E,V.invertY=N,V._compression=d),V.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),d&&p?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[d],V.width,V.height,0,p):this._gl.texImage2D(this._gl.TEXTURE_2D,0,S,V.width,V.height,0,Q,J,p),V.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),V.isReady=!0},E.ThinEngine.prototype.createRawTexture=function(V,p,W,d,E,z,S){let Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,i=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const l=new N.e(this,3);l.baseWidth=p,l.baseHeight=W,l.width=p,l.height=W,l.format=d,l.generateMipMaps=E,l.samplingMode=S,l.invertY=z,l._compression=Q,l.type=J,l._useSRGBBuffer=this._getUseSRGBBuffer(i,!E),this._doNotHandleContextLost||(l._bufferView=V),this.updateRawTexture(l,V,d,z,Q,J,l._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,l,!0);const j=this._getSamplingParameters(S,E);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,j.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,j.min),E&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(l),l},E.ThinEngine.prototype.createRawCubeTexture=function(V,p,W,d,E,z,S){let Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const J=this._gl,l=new N.e(this,8);l.isCube=!0,l.format=W,l.type=d,this._doNotHandleContextLost||(l._bufferViewArray=V);const k=this._getWebGLTextureType(d);let u=this._getInternalFormat(W);u===J.RGB&&(u=J.RGBA),k!==J.FLOAT||this._caps.textureFloatLinearFiltering?k!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?k!==J.FLOAT||this._caps.textureFloatRender?k!==J.HALF_FLOAT||this._caps.colorBufferFloat||(E=!1,i.e.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(E=!1,i.e.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(E=!1,S=1,i.e.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(E=!1,S=1,i.e.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const f=p,O=f;l.width=f,l.height=O,l.invertY=z,l._compression=Q;if(!this.needPOTTextures||(0,j.i)(l.width)&&(0,j.i)(l.height)||(E=!1),V)this.updateRawCubeTexture(l,V,W,d,z,Q);else{const V=this._getRGBABufferInternalSizedFormat(d),p=0;this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,l,!0);for(let W=0;W<6;W++)Q?J.compressedTexImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+W,p,this.getCaps().s3tc[Q],l.width,l.height,0,void 0):J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+W,p,V,l.width,l.height,0,u,k,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,l,!0),V&&E&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const U=this._getSamplingParameters(S,E);return J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,U.mag),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,U.min),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,null),l.generateMipMaps=E,l.samplingMode=S,l.isReady=!0,l},E.ThinEngine.prototype.updateRawCubeTexture=function(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;V._bufferViewArray=p,V.format=W,V.type=N,V.invertY=d,V._compression=E;const S=this._gl,Q=this._getWebGLTextureType(N);let J=this._getInternalFormat(W);const i=this._getRGBABufferInternalSizedFormat(N);let l=!1;J===S.RGB&&(J=S.RGBA,l=!0),this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,V,!0),this._unpackFlipY(void 0===d||!!d),V.width%4!==0&&S.pixelStorei(S.UNPACK_ALIGNMENT,1);for(let j=0;j<6;j++){let W=p[j];E?S.compressedTexImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+j,z,this.getCaps().s3tc[E],V.width,V.height,0,W):(l&&(W=k(W,V.width,V.height,N)),S.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+j,z,i,V.width,V.height,0,J,Q,W))}(!this.needPOTTextures||(0,j.i)(V.width)&&(0,j.i)(V.height))&&V.generateMipMaps&&0===z&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),V.isReady=!0},E.ThinEngine.prototype.createRawCubeTextureFromUrl=function(V,p,W,N,d,E,z,S){let Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,i=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,l=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const j=this._gl,u=this.createRawCubeTexture(null,W,N,d,!E,l,i,null);null===p||void 0===p||p.addPendingData(u),u.url=V,u.isReady=!1,this._internalTexturesCache.push(u);const f=V=>{const W=u.width,E=z(V);if(E){if(S){const V=this._getWebGLTextureType(d);let p=this._getInternalFormat(N);const z=this._getRGBABufferInternalSizedFormat(d);let Q=!1;p===j.RGB&&(p=j.RGBA,Q=!0),this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,u,!0),this._unpackFlipY(!1);const J=S(E);for(let N=0;N<J.length;N++){const E=W>>N;for(let W=0;W<6;W++){let S=J[N][W];Q&&(S=k(S,E,E,d)),j.texImage2D(W,N,z,E,E,0,p,V,S)}}this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(u,E,N,d,l);u.isReady=!0,null===p||void 0===p||p.removePendingData(u),u.onLoadedObservable.notifyObservers(u),u.onLoadedObservable.clear(),Q&&Q()}};return this._loadFile(V,(V=>{f(V)}),void 0,null===p||void 0===p?void 0:p.offlineProvider,!0,((V,W)=>{null===p||void 0===p||p.removePendingData(u),J&&V&&J(V.status+" "+V.statusText,W)})),u},E.ThinEngine.prototype.createRawTexture2DArray=u(!1),E.ThinEngine.prototype.createRawTexture3D=u(!0),E.ThinEngine.prototype.updateRawTexture2DArray=f(!1),E.ThinEngine.prototype.updateRawTexture3D=f(!0);var O=W(10927);E.ThinEngine.prototype._readTexturePixelsSync=function(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],S=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const i=this._gl;if(!i)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const V=i.createFramebuffer();if(!V)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=V}var l,j;(i.bindFramebuffer(i.FRAMEBUFFER,this._dummyFramebuffer),N>-1)?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+N,null===(l=V._hardwareTexture)||void 0===l?void 0:l.underlyingResource,d):i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,null===(j=V._hardwareTexture)||void 0===j?void 0:j.underlyingResource,d);let k=void 0!==V.type?this._getWebGLTextureType(V.type):i.UNSIGNED_BYTE;if(S)E||(E=(0,O.m)(V.type,4*p*W));else if(k===i.UNSIGNED_BYTE)E||(E=new Uint8Array(4*p*W)),k=i.UNSIGNED_BYTE;else E||(E=new Float32Array(4*p*W)),k=i.FLOAT;return z&&this.flushFramebuffer(),i.readPixels(Q,J,p,W,i.RGBA,k,E),i.bindFramebuffer(i.FRAMEBUFFER,this._currentFramebuffer),E},E.ThinEngine.prototype._readTexturePixels=function(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],S=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(V,p,W,N,d,E,z,S,Q,J))};W(11696);E.ThinEngine.prototype._createDepthStencilCubeTexture=function(V,p){const W=new N.e(this,12);if(W.isCube=!0,1===this.webGLVersion)return i.e.Error("Depth cube texture is not supported by WebGL 1."),W;const d={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...p},E=this._gl;this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,W,!0),this._setupDepthStencilTexture(W,V,d.bilinearFiltering,d.comparisonFunction);for(let N=0;N<6;N++)d.generateStencil?E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+N,0,E.DEPTH24_STENCIL8,V,V,0,E.DEPTH_STENCIL,E.UNSIGNED_INT_24_8,null):E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+N,0,E.DEPTH_COMPONENT24,V,V,0,E.DEPTH_COMPONENT,E.UNSIGNED_INT,null);return this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(W),W},E.ThinEngine.prototype._setCubeMapTextureParams=function(V,p,W){const N=this._gl;N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MAG_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MIN_FILTER,p?N.LINEAR_MIPMAP_LINEAR:N.LINEAR),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),V.samplingMode=p?3:2,p&&this.getCaps().textureMaxLevel&&void 0!==W&&W>0&&(N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MAX_LEVEL,W),V._maxLodLevel=W),this._bindTextureDirectly(N.TEXTURE_CUBE_MAP,null)},E.ThinEngine.prototype.createCubeTexture=function(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,k=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,u=arguments.length>13&&void 0!==arguments[13]&&arguments[13],f=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const O=this._gl;return this.createCubeTextureBase(V,p,W,!!N,d,E,z,S,Q,J,l,k,(V=>this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,V,!0)),((V,p)=>{const W=this.needPOTTextures?(0,j.g)(p[0].width,this._caps.maxCubemapTextureSize):p[0].width,E=W,S=[O.TEXTURE_CUBE_MAP_POSITIVE_X,O.TEXTURE_CUBE_MAP_POSITIVE_Y,O.TEXTURE_CUBE_MAP_POSITIVE_Z,O.TEXTURE_CUBE_MAP_NEGATIVE_X,O.TEXTURE_CUBE_MAP_NEGATIVE_Y,O.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,V,!0),this._unpackFlipY(!1);const Q=z?this._getInternalFormat(z,V._useSRGBBuffer):V._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:O.RGBA;let J=z?this._getInternalFormat(z):O.RGBA;V._useSRGBBuffer&&1===this.webGLVersion&&(J=Q);for(let N=0;N<S.length;N++)if(p[N].width!==W||p[N].height!==E){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void i.e.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=W,this._workingCanvas.height=E,this._workingContext.drawImage(p[N],0,0,p[N].width,p[N].height,0,0,W,E),O.texImage2D(S[N],0,Q,J,O.UNSIGNED_BYTE,this._workingCanvas)}else O.texImage2D(S[N],0,Q,J,O.UNSIGNED_BYTE,p[N]);N||O.generateMipmap(O.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(V,!N),V.width=W,V.height=E,V.isReady=!0,z&&(V.format=z),V.onLoadedObservable.notifyObservers(V),V.onLoadedObservable.clear(),d&&d()}),!!u,f)},E.ThinEngine.prototype.generateMipMapsForCubemap=function(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(V.generateMipMaps){const W=this._gl;this._bindTextureDirectly(W.TEXTURE_CUBE_MAP,V,!0),W.generateMipmap(W.TEXTURE_CUBE_MAP),p&&this._bindTextureDirectly(W.TEXTURE_CUBE_MAP,null)}};W(11742);E.ThinEngine.prototype.setDepthStencilTexture=function(V,p,W,N){void 0!==V&&(p&&(this._boundUniforms[V]=p),W&&W.depthStencilTexture?this._setTexture(V,W,!1,!0,N):this._setTexture(V,null,void 0,void 0,N))},E.ThinEngine.prototype.createRenderTargetCubeTexture=function(V,p){const W=this._createHardwareRenderTargetWrapper(!1,!0,V),d={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...p};d.generateStencilBuffer=d.generateDepthBuffer&&d.generateStencilBuffer,(1!==d.type||this._caps.textureFloatLinearFiltering)&&(2!==d.type||this._caps.textureHalfFloatLinearFiltering)||(d.samplingMode=1);const E=this._gl,z=new N.e(this,5);this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,z,!0);const S=this._getSamplingParameters(d.samplingMode,d.generateMipMaps);1!==d.type||this._caps.textureFloat||(d.type=0,i.e.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MAG_FILTER,S.mag),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MIN_FILTER,S.min),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE);for(let N=0;N<6;N++)E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+N,0,this._getRGBABufferInternalSizedFormat(d.type,d.format),V,V,0,this._getInternalFormat(d.format),this._getWebGLTextureType(d.type),null);const Q=E.createFramebuffer();return this._bindUnboundFramebuffer(Q),W._depthStencilBuffer=this._setupFramebufferDepthAttachments(d.generateStencilBuffer,d.generateDepthBuffer,V,V),d.generateMipMaps&&E.generateMipmap(E.TEXTURE_CUBE_MAP),this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),W._framebuffer=Q,W._generateDepthBuffer=d.generateDepthBuffer,W._generateStencilBuffer=d.generateStencilBuffer,z.width=V,z.height=V,z.isReady=!0,z.isCube=!0,z.samples=1,z.generateMipMaps=d.generateMipMaps,z.samplingMode=d.samplingMode,z.type=d.type,z.format=d.format,this._internalTexturesCache.push(z),W.setTextures(z),W};var U=W(11757),F=W(11454),C=W(11766);E.ThinEngine.prototype.createPrefilteredCubeTexture=function(V,p,W,d){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(V,p,null,!1,(V=>{if(!V)return void(E&&E(null));const z=V.texture;if(J?V.info.sphericalPolynomial&&(z._sphericalPolynomial=V.info.sphericalPolynomial):z._sphericalPolynomial=new U.i,z._source=9,this.getCaps().textureLOD)return void(E&&E(z));const S=this._gl,Q=V.width;if(!Q)return;const l=[];for(let E=0;E<3;E++){const J=1-E/2,j=d,k=Math.log2(Q)*W+d,u=j+(k-j)*J,f=Math.round(Math.min(Math.max(u,0),k)),O=new N.e(this,2);if(O.type=z.type,O.format=z.format,O.width=Math.pow(2,Math.max(Math.log2(Q)-f,0)),O.height=O.width,O.isCube=!0,O._cachedWrapU=0,O._cachedWrapV=0,this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,O,!0),O.samplingMode=2,S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MAG_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_CUBE_MAP,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),V.isDDS){const p=V.info,W=V.data;this._unpackFlipY(p.isCompressed),C.e.UploadDDSLevels(this,O,W,p,!0,6,f)}else i.e.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(S.TEXTURE_CUBE_MAP,null);const U=new F.c(p);U._isCube=!0,U._texture=O,O.isReady=!0,l.push(U)}z._lodTextureHigh=l[2],z._lodTextureMid=l[1],z._lodTextureLow=l[0],E&&E(z)}),z,S,Q,J,W,d)},E.ThinEngine.prototype.createUniformBuffer=function(V,p){const W=this._gl.createBuffer();if(!W)throw new Error("Unable to create uniform buffer");const N=new J.d(W);return this.bindUniformBuffer(N),V instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,V,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(V),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),N.references=1,N},E.ThinEngine.prototype.createDynamicUniformBuffer=function(V,p){const W=this._gl.createBuffer();if(!W)throw new Error("Unable to create dynamic uniform buffer");const N=new J.d(W);return this.bindUniformBuffer(N),V instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,V,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(V),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),N.references=1,N},E.ThinEngine.prototype.updateUniformBuffer=function(V,p,W,N){this.bindUniformBuffer(V),void 0===W&&(W=0),void 0===N?p instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,W,p):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,W,new Float32Array(p)):p instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,p.subarray(W,W+N)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(p).subarray(W,W+N)),this.bindUniformBuffer(null)},E.ThinEngine.prototype.bindUniformBuffer=function(V){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,V?V.underlyingResource:null)},E.ThinEngine.prototype.bindUniformBufferBase=function(V,p,W){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,p,V?V.underlyingResource:null)},E.ThinEngine.prototype.bindUniformBlock=function(V,p,W){const N=V.program,d=this._gl.getUniformBlockIndex(N,p);4294967295!==d&&this._gl.uniformBlockBinding(N,d,W)};var A=W(10862),v=W(10941);v.d.prototype.displayLoadingUI=function(){if(!(0,A.l)())return;const V=this.loadingScreen;V&&V.displayLoadingUI()},v.d.prototype.hideLoadingUI=function(){if(!(0,A.l)())return;const V=this._loadingScreen;V&&V.hideLoadingUI()},Object.defineProperty(v.d.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=v.d.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(V){this._loadingScreen=V},enumerable:!0,configurable:!0}),Object.defineProperty(v.d.prototype,"loadingUIText",{set:function(V){this.loadingScreen.loadingUIText=V},enumerable:!0,configurable:!0}),Object.defineProperty(v.d.prototype,"loadingUIBackgroundColor",{set:function(V){this.loadingScreen.loadingUIBackgroundColor=V},enumerable:!0,configurable:!0}),v.d.prototype.getInputElement=function(){return this._renderingCanvas},v.d.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},v.d.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},v.d.prototype.getAspectRatio=function(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const W=V.viewport;return this.getRenderWidth(p)*W.width/(this.getRenderHeight(p)*W.height)},v.d.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},v.d.prototype._verifyPointerLock=function(){var V;null===(V=this._onPointerLockChange)||void 0===V||V.call(this)},v.d.prototype.setAlphaEquation=function(V){if(this._alphaEquation!==V){switch(V){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=V}},v.d.prototype.getInputElement=function(){return this._renderingCanvas},v.d.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},v.d.prototype.setDepthFunction=function(V){this._depthCullingState.depthFunc=V},v.d.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},v.d.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},v.d.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},v.d.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},v.d.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},v.d.prototype.setDepthWrite=function(V){this._depthCullingState.depthMask=V},v.d.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},v.d.prototype.setStencilBuffer=function(V){this._stencilState.stencilTest=V},v.d.prototype.getStencilMask=function(){return this._stencilState.stencilMask},v.d.prototype.setStencilMask=function(V){this._stencilState.stencilMask=V},v.d.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},v.d.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},v.d.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},v.d.prototype.setStencilFunction=function(V){this._stencilState.stencilFunc=V},v.d.prototype.setStencilFunctionReference=function(V){this._stencilState.stencilFuncRef=V},v.d.prototype.setStencilFunctionMask=function(V){this._stencilState.stencilFuncMask=V},v.d.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},v.d.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},v.d.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},v.d.prototype.setStencilOperationFail=function(V){this._stencilState.stencilOpStencilFail=V},v.d.prototype.setStencilOperationDepthFail=function(V){this._stencilState.stencilOpDepthFail=V},v.d.prototype.setStencilOperationPass=function(V){this._stencilState.stencilOpStencilDepthPass=V},v.d.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},v.d.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},v.d.prototype.setAlphaConstants=function(V,p,W,N){this._alphaState.setAlphaBlendConstants(V,p,W,N)},v.d.prototype.getAlphaMode=function(){return this._alphaMode},v.d.prototype.getAlphaEquation=function(){return this._alphaEquation},v.d.prototype.getRenderPassNames=function(){return this._renderPassNames},v.d.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},v.d.prototype.createRenderPassId=function(V){const p=++v.d._RenderPassIdCounter;return this._renderPassNames[p]=V??"NONAME",p},v.d.prototype.releaseRenderPassId=function(V){this._renderPassNames[V]=void 0;for(let p=0;p<this.scenes.length;++p){const W=this.scenes[p];for(let p=0;p<W.meshes.length;++p){const N=W.meshes[p];if(N.dg)for(let p=0;p<N.dg.length;++p){N.dg[p]._removeDrawWrapper(V)}}}};W(11754);function t(V){if(V.requestPointerLock){const p=V.requestPointerLock();p instanceof Promise?p.then((()=>{V.focus()})).catch((()=>{})):V.focus()}}var e=W(11019);W(11819);class Z extends E.ThinEngine{static get NpmPackage(){return v.d.NpmPackage}static get Version(){return v.d.Version}static get Instances(){return d.d.Instances}static get LastCreatedEngine(){return d.d.LastCreatedEngine}static get LastCreatedScene(){return d.d.LastCreatedScene}static DefaultLoadingScreenFactory(V){return v.d.DefaultLoadingScreenFactory(V)}get _supportsHardwareTextureRescaling(){return!!Z._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(V,p,W){if(super(V,p,W,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new S,this._drawCalls=new e.b,V&&(this._features.supportRenderPasses=!0,W=this._creationOptions,V.getContext)){const p=V;this._sharedInit(p)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(V){super._sharedInit(V),function(V,p,W){V._onCanvasFocus=()=>{V.onCanvasFocusObservable.notifyObservers(V)},V._onCanvasBlur=()=>{V.onCanvasBlurObservable.notifyObservers(V)},V._onCanvasContextMenu=p=>{V.disableContextMenu&&p.preventDefault()},p.addEventListener("focus",V._onCanvasFocus),p.addEventListener("blur",V._onCanvasBlur),p.addEventListener("contextmenu",V._onCanvasContextMenu),V._onBlur=()=>{V.disablePerformanceMonitorInBackground&&V.performanceMonitor.disable(),V._windowIsBackground=!0},V._onFocus=()=>{V.disablePerformanceMonitorInBackground&&V.performanceMonitor.enable(),V._windowIsBackground=!1},V._onCanvasPointerOut=W=>{document.elementFromPoint(W.clientX,W.clientY)!==p&&V.onCanvasPointerOutObservable.notifyObservers(W)};const N=V.getHostWindow();N&&"function"===typeof N.addEventListener&&(N.addEventListener("blur",V._onBlur),N.addEventListener("focus",V._onFocus)),p.addEventListener("pointerout",V._onCanvasPointerOut),W.doNotHandleTouchAction||function(V){V&&V.setAttribute&&(V.setAttribute("touch-action","none"),V.style.touchAction="none",V.style.webkitTapHighlightColor="transparent")}(p),!v.d.audioEngine&&W.audioEngine&&v.d.AudioEngineFactory&&(v.d.audioEngine=v.d.AudioEngineFactory(V.getRenderingCanvas(),V.getAudioContext(),V.getAudioDestination())),(0,A.g)()&&(V._onFullscreenChange=()=>{V.isFullscreen=!!document.fullscreenElement,V.isFullscreen&&V._pointerLockRequested&&p&&t(p)},document.addEventListener("fullscreenchange",V._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",V._onFullscreenChange,!1),V._onPointerLockChange=()=>{V.isPointerLock=document.pointerLockElement===p},document.addEventListener("pointerlockchange",V._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",V._onPointerLockChange,!1)),V.enableOfflineSupport=void 0!==v.d.OfflineProviderFactory,V._deterministicLockstep=!!W.deterministicLockstep,V._lockstepMaxSteps=W.lockstepMaxSteps||0,V._timeStep=W.timeStep||1/60}(this,V,this._creationOptions)}resizeImageBitmap(V,p,W){return function(V,p,W,N){const d=V.createCanvas(W,N).getContext("2d");if(!d)throw new Error("Unable to get 2d context for resizeImageBitmap");return d.drawImage(p,0,0),d.getImageData(0,0,W,N).data}(this,V,p,W)}_createImageBitmapFromSource(V,p){return function(V,p,W){return new Promise(((N,d)=>{const E=new Image;E.onload=()=>{E.decode().then((()=>{V.createImageBitmap(E,W).then((V=>{N(V)}))}))},E.onerror=()=>{d(`Error loading image ${E.src}`)},E.src=p}))}(this,V,p)}switchFullscreen(V){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(V)}enterFullscreen(V){this.isFullscreen||(this._pointerLockRequested=V,this._renderingCanvas&&function(V){const p=V.requestFullscreen||V.webkitRequestFullscreen;p&&p.call(V)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const V=document;document.exitFullscreen?document.exitFullscreen():V.webkitCancelFullScreen&&V.webkitCancelFullScreen()}()}setDitheringState(V){V?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(V){V?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(V,p,W,N){const d=this._cachedViewport;return this._cachedViewport=null,this._viewport(V,p,W,N),d}scissorClear(V,p,W,N,d){this.enableScissor(V,p,W,N),this.clear(d,!0,!0,!0),this.disableScissor()}enableScissor(V,p,W,N){const d=this._gl;d.enable(d.SCISSOR_TEST),d.scissor(V,p,W,N)}disableScissor(){const V=this._gl;V.disable(V.SCISSOR_TEST)}_loadFileAsync(V,p,W){return new Promise(((N,d)=>{this._loadFile(V,(V=>{N(V)}),void 0,p,W,((V,p)=>{d(p)}))}))}getVertexShaderSource(V){const p=this._gl.getAttachedShaders(V);return p?this._gl.getShaderSource(p[0]):null}getFragmentShaderSource(V){const p=this._gl.getAttachedShaders(V);return p?this._gl.getShaderSource(p[1]):null}set framebufferDimensionsObject(V){this._framebufferDimensionsObject=V,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const V of this.scenes)V.resetCachedMaterial(),V._rebuildGeometries();for(const V of this._virtualScenes)V.resetCachedMaterial(),V._rebuildGeometries();super._rebuildBuffers()}getFontOffset(V){return function(V){const p=document.createElement("span");p.textContent="Hg",p.style.font=V;const W=document.createElement("div");W.style.display="inline-block",W.style.width="1px",W.style.height="0px",W.style.verticalAlign="bottom";const N=document.createElement("div");N.style.whiteSpace="nowrap",N.appendChild(p),N.appendChild(W),document.body.appendChild(N);let d=0,E=0;try{E=W.getBoundingClientRect().top-p.getBoundingClientRect().top,W.style.verticalAlign="baseline",d=W.getBoundingClientRect().top-p.getBoundingClientRect().top}finally{document.body.removeChild(N)}return{ascent:d,height:E,descent:E-d}}(V)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:V}=this.customAnimationFrameRequester;V&&V(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let V=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(V=!1),V&&(this.Vi(),this._renderViews()||this._renderFrame(),this.Wi())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&t(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}Vi(){this._measureFps(),super.Vi()}_deletePipelineContext(V){const p=V;p&&p.program&&p.transformFeedback&&(this.deleteTransformFeedback(p.transformFeedback),p.transformFeedback=null),super._deletePipelineContext(V)}createShaderProgram(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;d=d||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const z=super.createShaderProgram(V,p,W,N,d,E);return this.onAfterShaderCompilationObservable.notifyObservers(this),z}_createShaderProgram(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const E=N.createProgram();if(V.program=E,!E)throw new Error("Unable to create program");if(N.attachShader(E,p),N.attachShader(E,W),this.webGLVersion>1&&d){const p=this.createTransformFeedback();this.bindTransformFeedback(p),this.setTranformFeedbackVaryings(E,d),V.transformFeedback=p}return N.linkProgram(E),this.webGLVersion>1&&d&&this.bindTransformFeedback(null),V.context=N,V.vertexShader=p,V.fragmentShader=W,V.isParallelCompiled||this._finalizePipelineContext(V),E}_releaseTexture(V){super._releaseTexture(V)}_releaseRenderTargetWrapper(V){super._releaseRenderTargetWrapper(V),this.scenes.forEach((p=>{p.postProcesses.forEach((p=>{p._outputTexture===V&&(p._outputTexture=null)})),p.cameras.forEach((p=>{p._postProcesses.forEach((p=>{p&&p._outputTexture===V&&(p._outputTexture=null)}))}))}))}_rescaleTexture(V,p,W,N,d){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const E=this.createRenderTargetTexture({width:p.width,height:p.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&Z._RescalePostProcessFactory&&(this._rescalePostProcess=Z._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const z=()=>{this._rescalePostProcess.onApply=function(p){p._bindTexture("textureSampler",V)};let z=W;z||(z=this.scenes[this.scenes.length-1]),z.postProcessManager.directRender([this._rescalePostProcess],E,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,p,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,N,0,0,p.width,p.height,0),this.unBindFramebuffer(E),E.dispose(),d&&d()},S=this._rescalePostProcess.getEffect();S?S.executeWhenCompiled(z):this._rescalePostProcess.onEffectCreatedObservable.addOnce((V=>{V.executeWhenCompiled(z)}))}}wrapWebGLTexture(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const z=new l.c(V,this._gl),S=new N.e(this,0,!0);return S._hardwareTexture=z,S.baseWidth=d,S.baseHeight=E,S.width=d,S.height=E,S.isReady=!0,S.useMipMaps=p,this.updateTextureSamplingMode(W,S),S}_uploadImageToTexture(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const d=this._gl,E=this._getWebGLTextureType(V.type),z=this._getInternalFormat(V.format),S=this._getRGBABufferInternalSizedFormat(V.type,z),Q=V.isCube?d.TEXTURE_CUBE_MAP:d.TEXTURE_2D;this._bindTextureDirectly(Q,V,!0),this._unpackFlipY(V.invertY);let J=d.TEXTURE_2D;V.isCube&&(J=d.TEXTURE_CUBE_MAP_POSITIVE_X+W),d.texImage2D(J,N,S,z,E,p),this._bindTextureDirectly(Q,null,!0)}updateTextureComparisonFunction(V,p){if(1===this.webGLVersion)return void i.e.Error("WebGL 1 does not support texture comparison.");const W=this._gl;V.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,V,!0),0===p?(W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_COMPARE_FUNC,515),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_COMPARE_MODE,W.NONE)):(W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_COMPARE_FUNC,p),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_COMPARE_MODE,W.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,V,!0),0===p?(W.texParameteri(W.TEXTURE_2D,W.TEXTURE_COMPARE_FUNC,515),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_COMPARE_MODE,W.NONE)):(W.texParameteri(W.TEXTURE_2D,W.TEXTURE_COMPARE_FUNC,p),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_COMPARE_MODE,W.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),V._comparisonFunction=p}createInstancesBuffer(V){const p=this._gl.createBuffer();if(!p)throw new Error("Unable to create instance buffer");const W=new J.d(p);return W.ib=V,this.bindArrayBuffer(W),this._gl.bufferData(this._gl.ARRAY_BUFFER,V,this._gl.DYNAMIC_DRAW),W.references=1,W}deleteInstancesBuffer(V){this._gl.deleteBuffer(V)}_clientWaitAsync(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const N=this._gl;return new Promise(((d,E)=>{const z=()=>{const S=N.clientWaitSync(V,p,0);S!=N.WAIT_FAILED?S!=N.TIMEOUT_EXPIRED?d():setTimeout(z,W):E()};z()}))}_readPixelsAsync(V,p,W,N,d,E,z){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const S=this._gl,Q=S.createBuffer();S.bindBuffer(S.PIXEL_PACK_BUFFER,Q),S.bufferData(S.PIXEL_PACK_BUFFER,z.byteLength,S.STREAM_READ),S.readPixels(V,p,W,N,d,E,0),S.bindBuffer(S.PIXEL_PACK_BUFFER,null);const J=S.fenceSync(S.SYNC_GPU_COMMANDS_COMPLETE,0);return J?(S.flush(),this._clientWaitAsync(J,0,10).then((()=>(S.deleteSync(J),S.bindBuffer(S.PIXEL_PACK_BUFFER,Q),S.getBufferSubData(S.PIXEL_PACK_BUFFER,0,z),S.bindBuffer(S.PIXEL_PACK_BUFFER,null),S.deleteBuffer(Q),z)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(V,p){1===d.d.Instances.length&&v.d.audioEngine&&(v.d.audioEngine.dispose(),v.d.audioEngine=null);const W=V.getHostWindow();W&&"function"===typeof W.removeEventListener&&(W.removeEventListener("blur",V._onBlur),W.removeEventListener("focus",V._onFocus)),p&&(p.removeEventListener("focus",V._onCanvasFocus),p.removeEventListener("blur",V._onCanvasBlur),p.removeEventListener("pointerout",V._onCanvasPointerOut),p.removeEventListener("contextmenu",V._onCanvasContextMenu)),(0,A.g)()&&(document.removeEventListener("fullscreenchange",V._onFullscreenChange),document.removeEventListener("mozfullscreenchange",V._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",V._onFullscreenChange),document.removeEventListener("msfullscreenchange",V._onFullscreenChange),document.removeEventListener("pointerlockchange",V._onPointerLockChange),document.removeEventListener("mspointerlockchange",V._onPointerLockChange),document.removeEventListener("mozpointerlockchange",V._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",V._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}Z.ALPHA_DISABLE=0,Z.ALPHA_ADD=1,Z.ALPHA_COMBINE=2,Z.ALPHA_SUBTRACT=3,Z.ALPHA_MULTIPLY=4,Z.ALPHA_MAXIMIZED=5,Z.ALPHA_ONEONE=6,Z.ALPHA_PREMULTIPLIED=7,Z.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Z.ALPHA_INTERPOLATE=9,Z.ALPHA_SCREENMODE=10,Z.DELAYLOADSTATE_NONE=0,Z.DELAYLOADSTATE_LOADED=1,Z.DELAYLOADSTATE_LOADING=2,Z.DELAYLOADSTATE_NOTLOADED=4,Z.NEVER=512,Z.ALWAYS=519,Z.LESS=513,Z.EQUAL=514,Z.LEQUAL=515,Z.GREATER=516,Z.GEQUAL=518,Z.NOTEQUAL=517,Z.KEEP=7680,Z.REPLACE=7681,Z.INCR=7682,Z.DECR=7683,Z.INVERT=5386,Z.INCR_WRAP=34055,Z.DECR_WRAP=34056,Z.TEXTURE_CLAMP_ADDRESSMODE=0,Z.TEXTURE_WRAP_ADDRESSMODE=1,Z.TEXTURE_MIRROR_ADDRESSMODE=2,Z.TEXTUREFORMAT_ALPHA=0,Z.TEXTUREFORMAT_LUMINANCE=1,Z.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Z.TEXTUREFORMAT_RGB=4,Z.TEXTUREFORMAT_RGBA=5,Z.TEXTUREFORMAT_RED=6,Z.TEXTUREFORMAT_R=6,Z.TEXTUREFORMAT_RG=7,Z.TEXTUREFORMAT_RED_INTEGER=8,Z.TEXTUREFORMAT_R_INTEGER=8,Z.TEXTUREFORMAT_RG_INTEGER=9,Z.TEXTUREFORMAT_RGB_INTEGER=10,Z.TEXTUREFORMAT_RGBA_INTEGER=11,Z.TEXTURETYPE_UNSIGNED_BYTE=0,Z.TEXTURETYPE_UNSIGNED_INT=0,Z.TEXTURETYPE_FLOAT=1,Z.TEXTURETYPE_HALF_FLOAT=2,Z.TEXTURETYPE_BYTE=3,Z.TEXTURETYPE_SHORT=4,Z.TEXTURETYPE_UNSIGNED_SHORT=5,Z.TEXTURETYPE_INT=6,Z.TEXTURETYPE_UNSIGNED_INTEGER=7,Z.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Z.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Z.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Z.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Z.TEXTURETYPE_UNSIGNED_INT_24_8=12,Z.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Z.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Z.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Z.TEXTURE_NEAREST_SAMPLINGMODE=1,Z.TEXTURE_BILINEAR_SAMPLINGMODE=2,Z.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Z.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Z.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Z.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Z.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Z.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Z.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Z.TEXTURE_NEAREST_LINEAR=7,Z.TEXTURE_NEAREST_NEAREST=1,Z.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Z.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Z.TEXTURE_LINEAR_LINEAR=2,Z.TEXTURE_LINEAR_NEAREST=12,Z.TEXTURE_EXPLICIT_MODE=0,Z.TEXTURE_SPHERICAL_MODE=1,Z.TEXTURE_PLANAR_MODE=2,Z.TEXTURE_CUBIC_MODE=3,Z.TEXTURE_PROJECTION_MODE=4,Z.TEXTURE_SKYBOX_MODE=5,Z.TEXTURE_INVCUBIC_MODE=6,Z.TEXTURE_EQUIRECTANGULAR_MODE=7,Z.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Z.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Z.SCALEMODE_FLOOR=1,Z.SCALEMODE_NEAREST=2,Z.SCALEMODE_CEILING=3},10900:(V,p,W)=>{"use strict";W.d(p,{d:()=>d});var N=W(10856);class d{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}d.Instances=[],d.OnEnginesDisposedObservable=new N.b,d._LastCreatedScene=null,d.UseFallbackTexture=!0,d.FallbackTexture=""},13041:(V,p,W)=>{"use strict";W(10870);var N=W(11739);W(10983),W(11299),W(10975),W(11750),W(11709);N.d},10975:(V,p,W)=>{"use strict";W.d(p,{d:()=>N});class N{static SetMatrixPrecision(V){if(N.MatrixTrackPrecisionChange=!1,V&&!N.MatrixUse64Bits&&N.MatrixTrackedMatrices)for(let p=0;p<N.MatrixTrackedMatrices.length;++p){const V=N.MatrixTrackedMatrices[p],W=V.Ej;V.Ej=new Array(16);for(let p=0;p<16;++p)V.Ej[p]=W[p]}N.MatrixUse64Bits=V,N.MatrixCurrentType=N.MatrixUse64Bits?Array:Float32Array,N.MatrixTrackedMatrices=null}}N.MatrixUse64Bits=!1,N.MatrixTrackPrecisionChange=!0,N.MatrixCurrentType=Float32Array,N.MatrixTrackedMatrices=[]},11750:(V,p,W)=>{"use strict";W.d(p,{b:()=>N});class N{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var V;return(null===(V=this._textures)||void 0===V?void 0:V[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(V){var p,W;if(!this._textures)return-1;const N=this._textures[V],d=(null===(p=this._layerIndices)||void 0===p?void 0:p[V])??0,E=(null===(W=this._faceIndices)||void 0===W?void 0:W[V])??0;return N.isCube?6*d+E:N.is3D?0:d}get samples(){return this._samples}setSamples(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===V&&!W)return V;const N=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,V,p):this._engine.updateRenderTargetTextureSampleCount(this,V);return this._samples=V,N}constructor(V,p,W,N,d){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=V,this._isCube=p,this._size=W,this._engine=N,this._depthStencilTexture=null,this.label=d}setTextures(V){Array.isArray(V)?this._textures=V:this._textures=V?[V]:null}setTexture(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[p]!==V&&(this._textures[p]&&W&&this._textures[p].dispose(),this._textures[p]=V)}setLayerAndFaceIndices(V,p){this._layerIndices=V,this._faceIndices=p}setLayerAndFaceIndex(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==p&&p>=0&&(this._layerIndices[V]=p),void 0!==W&&W>=0&&(this._faceIndices[V]=W)}createDepthStencilTexture(){var V;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,z=arguments.length>5?arguments[5]:void 0;return null===(V=this._depthStencilTexture)||void 0===V||V.dispose(),this._depthStencilTextureWithStencil=N,this._depthStencilTextureLabel=z,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:W,comparisonFunction:p,generateStencil:N,isCube:this._isCube,samples:d,depthTextureFormat:E,label:z},this),this._depthStencilTexture}_shareDepth(V){this.shareDepth(V)}shareDepth(V){this._depthStencilTexture&&(V._depthStencilTexture&&V._depthStencilTexture.dispose(),V._depthStencilTexture=this._depthStencilTexture,V._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(V){this.texture&&this.texture._swapAndDie(V),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let V=null;if(this._isMulti){const p=this.textures;if(p&&p.length>0){let W=!1,N=p.length,d=-1;const E=p[p.length-1]._source;14!==E&&12!==E||(W=!0,d=p[p.length-1].format,N--);const z=[],S=[],Q=[],J=[],i=[],l=[],j=[],k={};for(let V=0;V<N;++V){const W=p[V];z.push(W.samplingMode),S.push(W.type),Q.push(W.format);void 0!==k[W.uniqueId]?(J.push(-1),j.push(0)):(k[W.uniqueId]=V,W.is2DArray?(J.push(35866),j.push(W.depth)):W.isCube?(J.push(34067),j.push(0)):W.is3D?(J.push(32879),j.push(W.depth)):(J.push(3553),j.push(0))),this._faceIndices&&i.push(this._faceIndices[V]??0),this._layerIndices&&l.push(this._layerIndices[V]??0)}const u={samplingModes:z,generateMipMaps:p[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:W,depthTextureFormat:d,types:S,formats:Q,textureCount:N,targetTypes:J,faceIndex:i,layerIndex:l,layerCounts:j,label:this.label},f={width:this.width,height:this.height,depth:this.depth};V=this._engine.createMultipleRenderTarget(f,u);for(let O=0;O<N;++O){if(-1!==J[O])continue;const W=k[p[O].uniqueId];V.setTexture(V.textures[W],O)}}}else{var p,W,N,d;const z={};if(z.generateDepthBuffer=this._generateDepthBuffer,z.generateMipMaps=(null===(p=this.texture)||void 0===p?void 0:p.generateMipMaps)??!1,z.generateStencilBuffer=this._generateStencilBuffer,z.samplingMode=null===(W=this.texture)||void 0===W?void 0:W.samplingMode,z.type=null===(N=this.texture)||void 0===N?void 0:N.type,z.format=null===(d=this.texture)||void 0===d?void 0:d.format,z.noColorAttachment=!this._textures,z.label=this.label,this.isCube)V=this._engine.createRenderTargetCubeTexture(this.width,z);else{var E;const p={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(E=this.texture)||void 0===E?void 0:E.depth:void 0};V=this._engine.createRenderTargetTexture(p,z)}V.texture&&(V.texture.isReady=!0)}return V}_swapRenderTargetWrapper(V){if(this._textures&&V._textures)for(let p=0;p<this._textures.length;++p)this._textures[p]._swapAndDie(V._textures[p],!1),V._textures[p].isReady=!0;this._depthStencilTexture&&V._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(V._depthStencilTexture),V._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const V=this._cloneRenderTargetWrapper();if(V){if(this._depthStencilTexture){const p=this._depthStencilTexture.samplingMode,W=this._depthStencilTexture.format,N=2===p||3===p||11===p;V.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,N,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,W,this._depthStencilTextureLabel)}this.samples>1&&V.setSamples(this.samples),V._swapRenderTargetWrapper(this),V.dispose()}}releaseTextures(){if(this._textures)for(let p=0;p<(null===(V=this._textures)||void 0===V?void 0:V.length);++p){var V;this._textures[p].dispose()}this._textures=null}dispose(){var V;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(V=this._depthStencilTexture)||void 0===V||V.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},10952:(V,p,W)=>{"use strict";W.d(p,{b:()=>N});class N{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?N.ShadersRepository:N.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?N.ShadersStore:N.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?N.IncludesShadersStore:N.IncludesShadersStoreWGSL}}N.ShadersRepository="src/Shaders/",N.ShadersStore={},N.IncludesShadersStore={},N.ShadersRepositoryWGSL="src/ShadersWGSL/",N.ShadersStoreWGSL={},N.IncludesShadersStoreWGSL={}},10967:(V,p,W)=>{"use strict";W.d(p,{b:()=>j,f:()=>F,j:()=>k,k:()=>u,o:()=>U,p:()=>l,t:()=>J,v:()=>i,x:()=>Q,z:()=>S});class N{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Ed._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(V){V&&this.program&&V(this.program)}setEngine(V){this.Ed=V}_fillEffectInformation(V,p,W,N,d,E,z,S){const Q=this.Ed;if(Q.supportsUniformBuffers)for(const i in p)V.bindUniformBlock(i,p[i]);let J;for(this.Ed.getUniforms(this,W).forEach(((V,p)=>{N[W[p]]=V})),this._uniforms=N,J=0;J<d.length;J++){null==V.getUniform(d[J])&&(d.splice(J,1),J--)}d.forEach(((V,p)=>{E[V]=p}));for(const i of Q.getAttributes(this,z))S.push(i)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(V,p){const W=this._valueCache[V],N=p.updateFlag;return(void 0===W||W!==N)&&(this._valueCache[V]=N,!0)}_cacheFloat2(V,p,W){let N=this._valueCache[V];if(!N||2!==N.length)return N=[p,W],this._valueCache[V]=N,!0;let d=!1;return N[0]!==p&&(N[0]=p,d=!0),N[1]!==W&&(N[1]=W,d=!0),d}_cacheFloat3(V,p,W,N){let d=this._valueCache[V];if(!d||3!==d.length)return d=[p,W,N],this._valueCache[V]=d,!0;let E=!1;return d[0]!==p&&(d[0]=p,E=!0),d[1]!==W&&(d[1]=W,E=!0),d[2]!==N&&(d[2]=N,E=!0),E}_cacheFloat4(V,p,W,N,d){let E=this._valueCache[V];if(!E||4!==E.length)return E=[p,W,N,d],this._valueCache[V]=E,!0;let z=!1;return E[0]!==p&&(E[0]=p,z=!0),E[1]!==W&&(E[1]=W,z=!0),E[2]!==N&&(E[2]=N,z=!0),E[3]!==d&&(E[3]=d,z=!0),z}setInt(V,p){const W=this._valueCache[V];void 0!==W&&W===p||this.Ed.setInt(this._uniforms[V],p)&&(this._valueCache[V]=p)}setInt2(V,p,W){this._cacheFloat2(V,p,W)&&(this.Ed.setInt2(this._uniforms[V],p,W)||(this._valueCache[V]=null))}setInt3(V,p,W,N){this._cacheFloat3(V,p,W,N)&&(this.Ed.setInt3(this._uniforms[V],p,W,N)||(this._valueCache[V]=null))}setInt4(V,p,W,N,d){this._cacheFloat4(V,p,W,N,d)&&(this.Ed.setInt4(this._uniforms[V],p,W,N,d)||(this._valueCache[V]=null))}setIntArray(V,p){this._valueCache[V]=null,this.Ed.setIntArray(this._uniforms[V],p)}setIntArray2(V,p){this._valueCache[V]=null,this.Ed.setIntArray2(this._uniforms[V],p)}setIntArray3(V,p){this._valueCache[V]=null,this.Ed.setIntArray3(this._uniforms[V],p)}setIntArray4(V,p){this._valueCache[V]=null,this.Ed.setIntArray4(this._uniforms[V],p)}setUInt(V,p){const W=this._valueCache[V];void 0!==W&&W===p||this.Ed.setUInt(this._uniforms[V],p)&&(this._valueCache[V]=p)}setUInt2(V,p,W){this._cacheFloat2(V,p,W)&&(this.Ed.setUInt2(this._uniforms[V],p,W)||(this._valueCache[V]=null))}setUInt3(V,p,W,N){this._cacheFloat3(V,p,W,N)&&(this.Ed.setUInt3(this._uniforms[V],p,W,N)||(this._valueCache[V]=null))}setUInt4(V,p,W,N,d){this._cacheFloat4(V,p,W,N,d)&&(this.Ed.setUInt4(this._uniforms[V],p,W,N,d)||(this._valueCache[V]=null))}setUIntArray(V,p){this._valueCache[V]=null,this.Ed.setUIntArray(this._uniforms[V],p)}setUIntArray2(V,p){this._valueCache[V]=null,this.Ed.setUIntArray2(this._uniforms[V],p)}setUIntArray3(V,p){this._valueCache[V]=null,this.Ed.setUIntArray3(this._uniforms[V],p)}setUIntArray4(V,p){this._valueCache[V]=null,this.Ed.setUIntArray4(this._uniforms[V],p)}setArray(V,p){this._valueCache[V]=null,this.Ed.setArray(this._uniforms[V],p)}setArray2(V,p){this._valueCache[V]=null,this.Ed.setArray2(this._uniforms[V],p)}setArray3(V,p){this._valueCache[V]=null,this.Ed.setArray3(this._uniforms[V],p)}setArray4(V,p){this._valueCache[V]=null,this.Ed.setArray4(this._uniforms[V],p)}setMatrices(V,p){p&&(this._valueCache[V]=null,this.Ed.setMatrices(this._uniforms[V],p))}setMatrix(V,p){this._cacheMatrix(V,p)&&(this.Ed.setMatrices(this._uniforms[V],p.Zi())||(this._valueCache[V]=null))}setMatrix3x3(V,p){this._valueCache[V]=null,this.Ed.setMatrix3x3(this._uniforms[V],p)}setMatrix2x2(V,p){this._valueCache[V]=null,this.Ed.setMatrix2x2(this._uniforms[V],p)}setFloat(V,p){const W=this._valueCache[V];void 0!==W&&W===p||this.Ed.setFloat(this._uniforms[V],p)&&(this._valueCache[V]=p)}setVector2(V,p){this._cacheFloat2(V,p.x,p.y)&&(this.Ed.setFloat2(this._uniforms[V],p.x,p.y)||(this._valueCache[V]=null))}setFloat2(V,p,W){this._cacheFloat2(V,p,W)&&(this.Ed.setFloat2(this._uniforms[V],p,W)||(this._valueCache[V]=null))}setVector3(V,p){this._cacheFloat3(V,p.x,p.y,p.z)&&(this.Ed.setFloat3(this._uniforms[V],p.x,p.y,p.z)||(this._valueCache[V]=null))}setFloat3(V,p,W,N){this._cacheFloat3(V,p,W,N)&&(this.Ed.setFloat3(this._uniforms[V],p,W,N)||(this._valueCache[V]=null))}setVector4(V,p){this._cacheFloat4(V,p.x,p.y,p.z,p.w)&&(this.Ed.setFloat4(this._uniforms[V],p.x,p.y,p.z,p.w)||(this._valueCache[V]=null))}setQuaternion(V,p){this._cacheFloat4(V,p.x,p.y,p.z,p.w)&&(this.Ed.setFloat4(this._uniforms[V],p.x,p.y,p.z,p.w)||(this._valueCache[V]=null))}setFloat4(V,p,W,N,d){this._cacheFloat4(V,p,W,N,d)&&(this.Ed.setFloat4(this._uniforms[V],p,W,N,d)||(this._valueCache[V]=null))}setColor3(V,p){this._cacheFloat3(V,p.r,p.g,p.b)&&(this.Ed.setFloat3(this._uniforms[V],p.r,p.g,p.b)||(this._valueCache[V]=null))}setColor4(V,p,W){this._cacheFloat4(V,p.r,p.g,p.b,W)&&(this.Ed.setFloat4(this._uniforms[V],p.r,p.g,p.b,W)||(this._valueCache[V]=null))}setDirectColor4(V,p){this._cacheFloat4(V,p.r,p.g,p.b,p.a)&&(this.Ed.setFloat4(this._uniforms[V],p.r,p.g,p.b,p.a)||(this._valueCache[V]=null))}_getVertexShaderCode(){return this.vertexShader?this.Ed._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Ed._getShaderSource(this.fragmentShader):null}}var d=W(10927);const E=new WeakMap,z={_webGLVersion:2,cachedPipelines:{}};function S(V){let p=E.get(V);if(!p){if(!V)return z;p={_webGLVersion:V.TEXTURE_BINDING_3D?2:1,_context:V,cachedPipelines:{}},E.set(V,p)}return p}function Q(V){E.delete(V)}function J(V,p,W,N,d,E){const z=S(N);E||(E=z._createShaderProgramInjection??j);return E(V,O(p,"vertex",N,z._contextWasLost),O(W,"fragment",N,z._contextWasLost),N,d,z.validateShaderPrograms)}function i(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6?arguments[6]:void 0;const Q=S(d);z||(z=Q._createShaderProgramInjection??j);const J=Q._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return z(V,f(p,"vertex",N,J,d,Q._contextWasLost),f(W,"fragment",N,J,d,Q._contextWasLost),d,E,Q.validateShaderPrograms)}function l(V,p){const W=new N,d=S(V);return d.parallelShaderCompile&&(W.isParallelCompiled=!0),W.context=d._context,W}function j(V,p,W,N){let d=arguments.length>5?arguments[5]:void 0;const E=N.createProgram();if(V.program=E,!E)throw new Error("Unable to create program");return N.attachShader(E,p),N.attachShader(E,W),N.linkProgram(E),V.context=N,V.vertexShader=p,V.fragmentShader=W,V.isParallelCompiled||k(V,N,d),E}function k(V,p,W){const N=V.context,d=V.vertexShader,E=V.fragmentShader,z=V.program;if(!N.getProgramParameter(z,N.LINK_STATUS)){if(!p.getShaderParameter(d,p.COMPILE_STATUS)){const W=p.getShaderInfoLog(d);if(W)throw V.vertexCompilationError=W,new Error("VERTEX SHADER "+W)}if(!p.getShaderParameter(E,p.COMPILE_STATUS)){const W=p.getShaderInfoLog(E);if(W)throw V.fragmentCompilationError=W,new Error("FRAGMENT SHADER "+W)}const W=N.getProgramInfoLog(z);if(W)throw V.programLinkError=W,new Error(W)}if(W){N.validateProgram(z);if(!N.getProgramParameter(z,N.VALIDATE_STATUS)){const p=N.getProgramInfoLog(z);if(p)throw V.programValidationError=p,new Error(p)}}N.deleteShader(d),N.deleteShader(E),V.vertexShader=void 0,V.fragmentShader=void 0,V.onCompiled&&(V.onCompiled(),V.onCompiled=void 0)}function u(V,p,W,N,d,E,z,Q,l){let j=arguments.length>10?arguments[10]:void 0,k=arguments.length>11?arguments[11]:void 0,u=arguments.length>12?arguments[12]:void 0;const f=S(V.context);k||(k=f.createRawShaderProgramInjection??J),u||(u=f.createShaderProgramInjection??i);const O=V;O.program=N?k(O,p,W,O.context,l):u(O,p,W,Q,O.context,l),O.program.__SPECTOR_rebuildProgram=z,j()}function f(V,p,W,N,E,z){return O((0,d.g)(V,W,N),p,E,z)}function O(V,p,W,N){const d=W.createShader("vertex"===p?W.VERTEX_SHADER:W.FRAGMENT_SHADER);if(!d){let V=W.NO_ERROR,d=W.NO_ERROR;for(;(d=W.getError())!==W.NO_ERROR;)V=d;throw new Error(`Something went wrong while creating a gl ${p} shader object. gl error=${V}, gl isContextLost=${W.isContextLost()}, _contextWasLost=${N}`)}return W.shaderSource(d,V),W.compileShader(d),d}function U(V,p){p.useProgram(V)}function F(V,p){const W=V;if(!W.isParallelCompiled)return void p(V);const N=W.onCompiled;W.onCompiled=()=>{null===N||void 0===N||N(),p(V)}}},11705:(V,p,W)=>{"use strict";W.r(p),W.d(p,{ThinEngine:()=>C});var N=W(10967),d=W(11709),E=W(10870),z=W(10862);class S{constructor(){this.shaderLanguage=0}postProcessor(V,p,W,N,d){if(d.drawBuffersExtensionDisabled){const p=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;V=V.replace(p,"")}return V}}const Q=/(flat\s)?\s*varying\s*.*/;class J{constructor(){this.shaderLanguage=0}attributeProcessor(V){return V.replace("attribute","in")}varyingCheck(V,p){return Q.test(V)}varyingProcessor(V,p){return V.replace("varying",p?"in":"out")}postProcessor(V,p,W){const N=-1!==V.search(/#extension.+GL_EXT_draw_buffers.+require/);if(V=(V=V.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),W){const p=-1!==V.search(/layout *\(location *= *0\) *out/g);V=(V=(V=(V=(V=(V=(V=V.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(N||p?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==p.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+V}return V}}var i=W(11716),l=W(11016),j=W(10941),k=W(11725),u=W(10983),f=W(10948),O=W(10927),U=W(10961);class F{}class C extends j.d{get name(){return this._name}set name(V){this._name=V}get version(){return this._webGLVersion}static get ShadersRepository(){return f.e.ShadersRepository}static set ShadersRepository(V){f.e.ShadersRepository=V}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(V){this._framebufferDimensionsObject=V}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(V,p,W,d){if(W=W||{},super(p??W.antialias,W,d),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!V)return;let z=null;if(V.getContext){if(z=V,this._renderingCanvas=z,void 0===W.oh&&(W.oh=!1),void 0===W.xrCompatible&&(W.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const V=navigator.userAgent;for(const p of C.ExceptionList){const N=p.key,d=p.targets;if(new RegExp(N).test(V)){if(p.capture&&p.captureConstraint){const W=p.capture,N=p.captureConstraint,d=new RegExp(W).exec(V);if(d&&d.length>0){if(parseInt(d[d.length-1])>=N)continue}}for(const V of d)switch(V){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":W.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=V=>{V.preventDefault(),this._contextWasLost=!0,E.e.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},z.addEventListener("webglcontextlost",this._onContextLost,!1),z.addEventListener("webglcontextrestored",this._onContextRestored,!1),W.powerPreference=W.powerPreference||"high-performance"),this._badDesktopOS&&(W.xrCompatible=!1),!W.disableWebGL2Support)try{this._gl=z.getContext("webgl2",W)||z.getContext("experimental-webgl2",W),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(l){}if(!this._gl){if(!z)throw new Error("The provided canvas is null or undefined.");try{this._gl=z.getContext("webgl",W)||z.getContext("experimental-webgl",W)}catch(l){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=V,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const p=this._gl.getContextAttributes();p&&(W.stencil=p.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==W.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=W.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let N=0;N<this._caps.maxVertexAttribs;N++)this._currentBufferPointers[N]=new F;this._shaderProcessor=this.webGLVersion>1?new J:new S;const Q=`Babylon.js v${C.Version}`;E.e.Log(Q+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",Q);const i=(0,N.z)(this._gl);i.validateShaderPrograms=this.validateShaderPrograms,i.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(V){return null}areAllEffectsReady(){for(const V in this._compiledEffects){if(!this._compiledEffects[V].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const V=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=V&&(this._glRenderer=this._gl.getParameter(V.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(V.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const V=this._gl.getExtension("WEBGL_draw_buffers");if(null!==V){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=V.drawBuffersWEBGL.bind(V),this._caps.maxDrawBuffers=this._gl.getParameter(V.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let p=0;p<16;p++)this._gl["COLOR_ATTACHMENT"+p+"_WEBGL"]=V["COLOR_ATTACHMENT"+p+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const V=this._gl.getExtension("WEBGL_depth_texture");null!=V&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=V.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const V=this._gl.getExtension("OES_vertex_array_object");null!=V&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=V.createVertexArrayOES.bind(V),this._gl.bindVertexArray=V.bindVertexArrayOES.bind(V),this._gl.deleteVertexArray=V.deleteVertexArrayOES.bind(V))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const V=this._gl.getExtension("ANGLE_instanced_arrays");null!=V?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=V.drawArraysInstancedANGLE.bind(V),this._gl.drawElementsInstanced=V.drawElementsInstancedANGLE.bind(V),this._gl.vertexAttribDivisor=V.vertexAttribDivisorANGLE.bind(V)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const V=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),p=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);V&&p&&(this._caps.highPrecisionShaderSupported=0!==V.precision&&0!==p.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const V=this._gl.getExtension("EXT_blend_minmax");null!=V&&(this._caps.blendMinMax=!0,this._gl.MAX=V.MAX_EXT,this._gl.MIN=V.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const V=this._gl.getExtension("EXT_sRGB");null!=V&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:V.SRGB_EXT,SRGB8:V.SRGB_ALPHA_EXT,SRGB8_ALPHA8:V.SRGB_ALPHA_EXT})}if(this._creationOptions){const V=this._creationOptions.forceSRGBBufferSupportState;void 0!==V&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&V)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let p=0;p<this._maxSimultaneousTextures;p++)this._nextFreeTextureSlots.push(p);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const V=this._workingCanvas.getContext("2d");V&&(this._workingContext=V)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const V=this.getGlInfo();return V&&V.renderer?V.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=d;let E=0;if(p&&V){let p=!0;if(this._currentRenderTarget){var z;const W=null===(z=this._currentRenderTarget.texture)||void 0===z?void 0:z.format;if(8===W||9===W||10===W||11===W){var S;const W=null===(S=this._currentRenderTarget.texture)||void 0===S?void 0:S.type;7===W||5===W?(C._TempClearColorUint32[0]=255*V.r,C._TempClearColorUint32[1]=255*V.g,C._TempClearColorUint32[2]=255*V.b,C._TempClearColorUint32[3]=255*V.a,this._gl.clearBufferuiv(this._gl.COLOR,0,C._TempClearColorUint32),p=!1):(C._TempClearColorInt32[0]=255*V.r,C._TempClearColorInt32[1]=255*V.g,C._TempClearColorInt32[2]=255*V.b,C._TempClearColorInt32[3]=255*V.a,this._gl.clearBufferiv(this._gl.COLOR,0,C._TempClearColorInt32),p=!1)}}p&&(this._gl.clearColor(V.r,V.g,V.b,void 0!==V.a?V.a:1),E|=this._gl.COLOR_BUFFER_BIT)}W&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),E|=this._gl.DEPTH_BUFFER_BIT),N&&(this._gl.clearStencil(0),E|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(E)}_viewport(V,p,W,N){V===this._viewportCached.x&&p===this._viewportCached.y&&W===this._viewportCached.z&&N===this._viewportCached.w||(this._viewportCached.x=V,this._viewportCached.y=p,this._viewportCached.z=W,this._viewportCached.w=N,this._gl.viewport(V,p,W,N))}Wi(){super.Wi(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const Q=V;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=V,this._bindUnboundFramebuffer(Q._framebuffer);const J=this._gl;var i;if(!V.isMulti)if(V.is2DArray||V.is3D)J.framebufferTextureLayer(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,null===(i=V.texture._hardwareTexture)||void 0===i?void 0:i.underlyingResource,z,S),Q._currentLOD=z;else if(V.isCube){var l;J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_CUBE_MAP_POSITIVE_X+p,null===(l=V.texture._hardwareTexture)||void 0===l?void 0:l.underlyingResource,z)}else if(Q._currentLOD!==z){var j;J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_2D,null===(j=V.texture._hardwareTexture)||void 0===j?void 0:j.underlyingResource,z),Q._currentLOD=z}const k=V._depthStencilTexture;if(k){V.is3D&&(V.texture.width===k.width&&V.texture.height===k.height&&V.texture.depth===k.depth||E.e.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const W=V._depthStencilTextureWithStencil?J.DEPTH_STENCIL_ATTACHMENT:J.DEPTH_ATTACHMENT;var u;if(V.is2DArray||V.is3D)J.framebufferTextureLayer(J.FRAMEBUFFER,W,null===(u=k._hardwareTexture)||void 0===u?void 0:u.underlyingResource,z,S);else if(V.isCube){var f;J.framebufferTexture2D(J.FRAMEBUFFER,W,J.TEXTURE_CUBE_MAP_POSITIVE_X+p,null===(f=k._hardwareTexture)||void 0===f?void 0:f.underlyingResource,z)}else{var O;J.framebufferTexture2D(J.FRAMEBUFFER,W,J.TEXTURE_2D,null===(O=k._hardwareTexture)||void 0===O?void 0:O.underlyingResource,z)}}Q._MSAAFramebuffer&&this._bindUnboundFramebuffer(Q._MSAAFramebuffer),this._cachedViewport&&!d?this.setViewport(this._cachedViewport,W,N):(W||(W=V.width,z&&(W/=Math.pow(2,z))),N||(N=V.height,z&&(N/=Math.pow(2,z))),this._viewport(0,0,W,N)),this.wipeCaches()}setState(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0,N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==V||W)&&(this._depthCullingState.cull=V);const S=this.cullBackFaces??d??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==S||W)&&(this._depthCullingState.cullFace=S),this.setZOffset(p),this.setZOffsetUnits(z);const Q=N?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==Q||W)&&(this._depthCullingState.frontFace=Q),this._stencilStateComposer.stencilMaterial=E}_bindUnboundFramebuffer(V){this._currentFramebuffer!==V&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,V),this._currentFramebuffer=V)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(V){const p=this._getTextureTarget(V);this._bindTextureDirectly(p,V,!0),this._gl.generateMipmap(p),this._bindTextureDirectly(p,null)}unBindFramebuffer(V){var p;let W=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2?arguments[2]:void 0;const d=V;this._currentRenderTarget=null;const E=this._gl;if(d._MSAAFramebuffer){if(V.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(V,W,N);E.bindFramebuffer(E.READ_FRAMEBUFFER,d._MSAAFramebuffer),E.bindFramebuffer(E.DRAW_FRAMEBUFFER,d._framebuffer),E.blitFramebuffer(0,0,V.width,V.height,0,0,V.width,V.height,E.COLOR_BUFFER_BIT,E.NEAREST)}null===(p=V.texture)||void 0===p||!p.generateMipMaps||W||V.isCube||this.generateMipmaps(V.texture),N&&(d._MSAAFramebuffer&&this._bindUnboundFramebuffer(d._framebuffer),N()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(V,p,W){return this._createVertexBuffer(V,this._gl.STATIC_DRAW)}_createVertexBuffer(V,p){const W=this._gl.createBuffer();if(!W)throw new Error("Unable to create vertex buffer");const N=new i.d(W);return this.bindArrayBuffer(N),"number"!==typeof V?V instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(V),p),N.ib=4*V.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,V,p),N.ib=V.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(V),p),N.ib=V),this._resetVertexBufferBinding(),N.references=1,N}createDynamicVertexBuffer(V,p){return this._createVertexBuffer(V,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(V,p,W){const N=this._gl.createBuffer(),d=new i.d(N);if(!N)throw new Error("Unable to create index buffer");this.bindIndexBuffer(d);const E=this._normalizeIndexData(V);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,E,p?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),d.references=1,d.is32Bits=4===E.BYTES_PER_ELEMENT,d}_normalizeIndexData(V){if(2===V.BYTES_PER_ELEMENT)return V;if(this._caps.uintIndices){if(V instanceof Uint32Array)return V;for(let p=0;p<V.length;p++)if(V[p]>=65535)return new Uint32Array(V);return new Uint16Array(V)}return new Uint16Array(V)}bindArrayBuffer(V){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(V,this._gl.ARRAY_BUFFER)}bindUniformBlock(V,p,W){const N=V.program,d=this._gl.getUniformBlockIndex(N,p);this._gl.uniformBlockBinding(N,d,W)}bindIndexBuffer(V){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(V,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(V,p){(this._vaoRecordInProgress||this._currentBoundBuffer[p]!==V)&&(this._gl.bindBuffer(p,V?V.underlyingResource:null),this._currentBoundBuffer[p]=V)}updateArrayBuffer(V){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,V)}_vertexAttribPointer(V,p,W,N,d,E,z){const S=this._currentBufferPointers[p];if(!S)return;let Q=!1;S.active?(S.buffer!==V&&(S.buffer=V,Q=!0),S.size!==W&&(S.size=W,Q=!0),S.type!==N&&(S.type=N,Q=!0),S.normalized!==d&&(S.normalized=d,Q=!0),S.stride!==E&&(S.stride=E,Q=!0),S.offset!==z&&(S.offset=z,Q=!0)):(Q=!0,S.active=!0,S.index=p,S.size=W,S.type=N,S.normalized=d,S.stride=E,S.offset=z,S.buffer=V),(Q||this._vaoRecordInProgress)&&(this.bindArrayBuffer(V),N===this._gl.UNSIGNED_INT||N===this._gl.INT?this._gl.vertexAttribIPointer(p,W,N,E,z):this._gl.vertexAttribPointer(p,W,N,d,E,z))}_bindIndexBufferWithCache(V){null!=V&&this._cachedIndexBuffer!==V&&(this._cachedIndexBuffer=V,this.bindIndexBuffer(V),this._uintIndicesCurrentlySet=V.is32Bits)}_bindVertexBuffersAttributes(V,p,W){const N=p.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let d=0;d<N.length;d++){const E=p.getAttributeLocation(d);if(E>=0){const p=N[d];let z=null;if(W&&(z=W[p]),z||(z=V[p]),!z)continue;this._gl.enableVertexAttribArray(E),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[E]=!0);const S=z.getBuffer();S&&(this._vertexAttribPointer(S,E,z.getSize(),z.type,z.normalized,z.byteStride,z.byteOffset),z.getIsInstanced()&&(this._gl.vertexAttribDivisor(E,z.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(E),this._currentInstanceBuffers.push(S))))}}}recordVertexArrayObject(V,p,W,N){const d=this._gl.createVertexArray();if(!d)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(d),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(V,W,N),this.bindIndexBuffer(p),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),d}bindVertexArrayObject(V,p){this._cachedVertexArrayObject!==V&&(this._cachedVertexArrayObject=V,this._gl.bindVertexArray(V),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=p&&p.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(V,p,W,N,d){if(this._cachedVertexBuffers!==V||this._cachedEffectForVertexBuffers!==d){this._cachedVertexBuffers=V,this._cachedEffectForVertexBuffers=d;const p=d.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let E=0;for(let z=0;z<p;z++)if(z<W.length){const p=d.getAttributeLocation(z);p>=0&&(this._gl.enableVertexAttribArray(p),this._vertexAttribArraysEnabled[p]=!0,this._vertexAttribPointer(V,p,W[z],this._gl.FLOAT,!1,N,E)),E+=4*W[z]}}this._bindIndexBufferWithCache(p)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(V,p,W,N){this._cachedVertexBuffers===V&&this._cachedEffectForVertexBuffers===W||(this._cachedVertexBuffers=V,this._cachedEffectForVertexBuffers=W,this._bindVertexBuffersAttributes(V,W,N)),this._bindIndexBufferWithCache(p)}unbindInstanceAttributes(){let V;for(let p=0,W=this._currentInstanceLocations.length;p<W;p++){const W=this._currentInstanceBuffers[p];V!=W&&W.references&&(V=W,this.bindArrayBuffer(W));const N=this._currentInstanceLocations[p];this._gl.vertexAttribDivisor(N,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(V){this._gl.deleteVertexArray(V)}_releaseBuffer(V){return V.references--,0===V.references&&(this._deleteBuffer(V),!0)}_deleteBuffer(V){this._gl.deleteBuffer(V.underlyingResource)}updateAndBindInstancesBuffer(V,p,W){if(this.bindArrayBuffer(V),p&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,p),void 0!==W[0].index)this.bindInstancesBuffer(V,W,!0);else for(let N=0;N<4;N++){const p=W[N];this._vertexAttribArraysEnabled[p]||(this._gl.enableVertexAttribArray(p),this._vertexAttribArraysEnabled[p]=!0),this._vertexAttribPointer(V,p,4,this._gl.FLOAT,!1,64,16*N),this._gl.vertexAttribDivisor(p,1),this._currentInstanceLocations.push(p),this._currentInstanceBuffers.push(V)}}bindInstancesBuffer(V,p){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(V);let N=0;if(W)for(let d=0;d<p.length;d++){N+=4*p[d].attributeSize}for(let d=0;d<p.length;d++){const W=p[d];void 0===W.index&&(W.index=this._currentEffect.getAttributeLocationByName(W.attributeName)),W.index<0||(this._vertexAttribArraysEnabled[W.index]||(this._gl.enableVertexAttribArray(W.index),this._vertexAttribArraysEnabled[W.index]=!0),this._vertexAttribPointer(V,W.index,W.attributeSize,W.attributeType||this._gl.FLOAT,W.normalized||!1,N,W.offset),this._gl.vertexAttribDivisor(W.index,void 0===W.divisor?1:W.divisor),this._currentInstanceLocations.push(W.index),this._currentInstanceBuffers.push(V))}}disableInstanceAttributeByName(V){if(!this._currentEffect)return;const p=this._currentEffect.getAttributeLocationByName(V);this.disableInstanceAttribute(p)}disableInstanceAttribute(V){let p,W=!1;for(;-1!==(p=this._currentInstanceLocations.indexOf(V));)this._currentInstanceLocations.splice(p,1),this._currentInstanceBuffers.splice(p,1),W=!0,p=this._currentInstanceLocations.indexOf(V);W&&(this._gl.vertexAttribDivisor(V,0),this.disableAttributeByIndex(V))}disableAttributeByIndex(V){this._gl.disableVertexAttribArray(V),this._vertexAttribArraysEnabled[V]=!1,this._currentBufferPointers[V].active=!1}draw(V,p,W,N){this.drawElementsType(V?0:1,p,W,N)}drawPointClouds(V,p,W){this.drawArraysType(2,V,p,W)}drawUnIndexed(V,p,W,N){this.drawArraysType(V?0:1,p,W,N)}drawElementsType(V,p,W,N){this.applyStates(),this._reportDrawCall();const d=this._drawMode(V),E=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,z=this._uintIndicesCurrentlySet?4:2;N?this._gl.drawElementsInstanced(d,W,E,p*z,N):this._gl.drawElements(d,W,E,p*z)}drawArraysType(V,p,W,N){this.applyStates(),this._reportDrawCall();const d=this._drawMode(V);N?this._gl.drawArraysInstanced(d,p,W,N):this._gl.drawArrays(d,p,W)}_drawMode(V){switch(V){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(V){this._compiledEffects[V._key]&&delete this._compiledEffects[V._key];const p=V.getPipelineContext();p&&this._deletePipelineContext(p)}_deletePipelineContext(V){const p=V;p&&p.program&&(p.program.__SPECTOR_rebuildProgram=null,(0,U.m)(p),this._gl.deleteProgram(p.program))}_getGlobalDefines(V){return(0,O.j)(V,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(V,p,W,d,E,z,S,Q,J){let i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10?arguments[10]:void 0;const j="string"===typeof V?V:V.vertexToken||V.vertexSource||V.vertexElement||V.vertex,k="string"===typeof V?V:V.fragmentToken||V.fragmentSource||V.fragmentElement||V.fragment,u=this._getGlobalDefines();let O=E??p.defines??"";u&&(O+=u);const U=j+"+"+k+"@"+O;if(this._compiledEffects[U]){const V=this._compiledEffects[U];return S&&V.isReady()&&S(V),V._refCount++,V}this._gl&&(0,N.z)(this._gl);const F=new f.e(V,p,W,d,this,E,z,S,Q,J,U,p.shaderLanguage??i,p.extraInitializationsAsync??l);return this._compiledEffects[U]=F,F}_getShaderSource(V){return this._gl.getShaderSource(V)}createRawShaderProgram(V,p,W,d){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const z=(0,N.z)(this._gl);return z._contextWasLost=this._contextWasLost,z.validateShaderPrograms=this.validateShaderPrograms,(0,N.t)(V,p,W,d||this._gl,E)}createShaderProgram(V,p,W,d,E){let z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const S=(0,N.z)(this._gl);return S._contextWasLost=this._contextWasLost,S.validateShaderPrograms=this.validateShaderPrograms,(0,N.v)(V,p,W,d,E||this._gl,z)}inlineShaderCode(V){return V}createPipelineContext(V){if(this._gl){(0,N.z)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const p=(0,N.p)(this._gl,V);return p.Ed=this,p}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(V){return(0,N.j)(V,this._gl,this.validateShaderPrograms)}_preparePipelineContext(V,p,W,d,E,z,S,Q,J,i,l){const j=(0,N.z)(this._gl);return j._contextWasLost=this._contextWasLost,j.validateShaderPrograms=this.validateShaderPrograms,j._createShaderProgramInjection=this._createShaderProgram.bind(this),j.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),j.createShaderProgramInjection=this.createShaderProgram.bind(this),j.loadFileInjection=this._loadFile.bind(this),(0,N.k)(V,p,W,d,E,z,S,Q,J,i,l)}_createShaderProgram(V,p,W,d){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,N.b)(V,p,W,d,E)}_isRenderingStateCompiled(V){const p=V;return!this._isDisposed&&!p._isDisposed&&(!!this._gl.getProgramParameter(p.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(p),!0))}_executeWhenRenderingStateIsCompiled(V,p){(0,N.f)(V,p)}getUniforms(V,p){const W=new Array,N=V;for(let d=0;d<p.length;d++)W.push(this._gl.getUniformLocation(N.program,p[d]));return W}getAttributes(V,p){const W=[],N=V;for(let E=0;E<p.length;E++)try{W.push(this._gl.getAttribLocation(N.program,p[E]))}catch(d){W.push(-1)}return W}enableEffect(V){(V=null!==V&&(0,d.d)(V)?V.effect:V)&&V!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(V),this._currentEffect=V,V.onBind&&V.onBind(V),V._onBindObservable&&V._onBindObservable.notifyObservers(V))}setInt(V,p){return!!V&&(this._gl.uniform1i(V,p),!0)}setInt2(V,p,W){return!!V&&(this._gl.uniform2i(V,p,W),!0)}setInt3(V,p,W,N){return!!V&&(this._gl.uniform3i(V,p,W,N),!0)}setInt4(V,p,W,N,d){return!!V&&(this._gl.uniform4i(V,p,W,N,d),!0)}setIntArray(V,p){return!!V&&(this._gl.uniform1iv(V,p),!0)}setIntArray2(V,p){return!(!V||p.length%2!==0)&&(this._gl.uniform2iv(V,p),!0)}setIntArray3(V,p){return!(!V||p.length%3!==0)&&(this._gl.uniform3iv(V,p),!0)}setIntArray4(V,p){return!(!V||p.length%4!==0)&&(this._gl.uniform4iv(V,p),!0)}setUInt(V,p){return!!V&&(this._gl.uniform1ui(V,p),!0)}setUInt2(V,p,W){return!!V&&(this._gl.uniform2ui(V,p,W),!0)}setUInt3(V,p,W,N){return!!V&&(this._gl.uniform3ui(V,p,W,N),!0)}setUInt4(V,p,W,N,d){return!!V&&(this._gl.uniform4ui(V,p,W,N,d),!0)}setUIntArray(V,p){return!!V&&(this._gl.uniform1uiv(V,p),!0)}setUIntArray2(V,p){return!(!V||p.length%2!==0)&&(this._gl.uniform2uiv(V,p),!0)}setUIntArray3(V,p){return!(!V||p.length%3!==0)&&(this._gl.uniform3uiv(V,p),!0)}setUIntArray4(V,p){return!(!V||p.length%4!==0)&&(this._gl.uniform4uiv(V,p),!0)}setArray(V,p){return!!V&&(!(p.length<1)&&(this._gl.uniform1fv(V,p),!0))}setArray2(V,p){return!(!V||p.length%2!==0)&&(this._gl.uniform2fv(V,p),!0)}setArray3(V,p){return!(!V||p.length%3!==0)&&(this._gl.uniform3fv(V,p),!0)}setArray4(V,p){return!(!V||p.length%4!==0)&&(this._gl.uniform4fv(V,p),!0)}setMatrices(V,p){return!!V&&(this._gl.uniformMatrix4fv(V,!1,p),!0)}setMatrix3x3(V,p){return!!V&&(this._gl.uniformMatrix3fv(V,!1,p),!0)}setMatrix2x2(V,p){return!!V&&(this._gl.uniformMatrix2fv(V,!1,p),!0)}setFloat(V,p){return!!V&&(this._gl.uniform1f(V,p),!0)}setFloat2(V,p,W){return!!V&&(this._gl.uniform2f(V,p,W),!0)}setFloat3(V,p,W,N){return!!V&&(this._gl.uniform3f(V,p,W,N),!0)}setFloat4(V,p,W,N,d){return!!V&&(this._gl.uniform4f(V,p,W,N,d),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const V=this._colorWrite;this._gl.colorMask(V,V,V,V)}}wipeCaches(V){this.preventCacheWipeBetweenFrames&&!V||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),V&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(V,p){const W=this._gl;let N=W.NEAREST,d=W.NEAREST;switch(V){case 11:N=W.LINEAR,d=p?W.LINEAR_MIPMAP_NEAREST:W.LINEAR;break;case 3:N=W.LINEAR,d=p?W.LINEAR_MIPMAP_LINEAR:W.LINEAR;break;case 8:N=W.NEAREST,d=p?W.NEAREST_MIPMAP_LINEAR:W.NEAREST;break;case 4:N=W.NEAREST,d=p?W.NEAREST_MIPMAP_NEAREST:W.NEAREST;break;case 5:N=W.NEAREST,d=p?W.LINEAR_MIPMAP_NEAREST:W.LINEAR;break;case 6:N=W.NEAREST,d=p?W.LINEAR_MIPMAP_LINEAR:W.LINEAR;break;case 7:N=W.NEAREST,d=W.LINEAR;break;case 1:N=W.NEAREST,d=W.NEAREST;break;case 9:N=W.LINEAR,d=p?W.NEAREST_MIPMAP_NEAREST:W.NEAREST;break;case 10:N=W.LINEAR,d=p?W.NEAREST_MIPMAP_LINEAR:W.NEAREST;break;case 2:N=W.LINEAR,d=W.LINEAR;break;case 12:N=W.LINEAR,d=W.NEAREST}return{min:d,mag:N}}_createTexture(){const V=this._gl.createTexture();if(!V)throw new Error("Unable to create texture");return V}_createHardwareTexture(){return new k.c(this._createTexture(),this._gl)}_createInternalTexture(V,p){let W,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=!1,z=0,S=3,Q=5,J=!1,i=1;void 0!==p&&"object"===typeof p?(d=!!p.generateMipMaps,z=void 0===p.type?0:p.type,S=void 0===p.samplingMode?3:p.samplingMode,Q=void 0===p.format?5:p.format,J=void 0!==p.useSRGBBuffer&&p.useSRGBBuffer,i=p.samples??1,W=p.label):d=!!p,J&&(J=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==z||this._caps.textureFloatLinearFiltering)&&(2!==z||this._caps.textureHalfFloatLinearFiltering)||(S=1),1!==z||this._caps.textureFloat||(z=0,E.e.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const l=this._gl,j=new u.e(this,N),k=V.width||V,f=V.height||V,O=V.depth||0,U=V.layers||0,F=this._getSamplingParameters(S,d),C=0!==U?l.TEXTURE_2D_ARRAY:0!==O?l.TEXTURE_3D:l.TEXTURE_2D,A=this._getRGBABufferInternalSizedFormat(z,Q,J),v=this._getInternalFormat(Q),t=this._getWebGLTextureType(z);return this._bindTextureDirectly(C,j),0!==U?(j.is2DArray=!0,l.texImage3D(C,0,A,k,f,U,0,v,t,null)):0!==O?(j.is3D=!0,l.texImage3D(C,0,A,k,f,O,0,v,t,null)):l.texImage2D(C,0,A,k,f,0,v,t,null),l.texParameteri(C,l.TEXTURE_MAG_FILTER,F.mag),l.texParameteri(C,l.TEXTURE_MIN_FILTER,F.min),l.texParameteri(C,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(C,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),d&&this._gl.generateMipmap(C),this._bindTextureDirectly(C,null),j._useSRGBBuffer=J,j.baseWidth=k,j.baseHeight=f,j.width=k,j.height=f,j.depth=U,j.isReady=!0,j.samples=i,j.generateMipMaps=d,j.samplingMode=S,j.type=z,j.format=Q,j.label=W,this._internalTexturesCache.push(j),j}_getUseSRGBBuffer(V,p){return V&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||p)}createTexture(V,p,W,N){var d=this;let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,j=arguments.length>11?arguments[11]:void 0,k=arguments.length>12?arguments[12]:void 0,f=arguments.length>13?arguments[13]:void 0,O=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(V,p,W,N,E,z,S,(function(){for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];return d._prepareWebGLTexture(...p,i)}),((V,p,W,d,E,z)=>{const S=this._gl,Q=W.width===V&&W.height===p;E._creationFlags=f??0;const J=this._getTexImageParametersForCreateTexture(E.format,E._useSRGBBuffer);if(Q)return S.texImage2D(S.TEXTURE_2D,0,J.internalFormat,J.format,J.type,W),!1;const i=this._caps.maxTextureSize;if(W.width>i||W.height>i||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=V,this._workingCanvas.height=p,this._workingContext.drawImage(W,0,0,W.width,W.height,0,0,V,p),S.texImage2D(S.TEXTURE_2D,0,J.internalFormat,J.format,J.type,this._workingCanvas),E.width=V,E.height=p,!1);{const V=new u.e(this,2);this._bindTextureDirectly(S.TEXTURE_2D,V,!0),S.texImage2D(S.TEXTURE_2D,0,J.internalFormat,J.format,J.type,W),this._rescaleTexture(V,E,N,J.format,(()=>{this._releaseTexture(V),this._bindTextureDirectly(S.TEXTURE_2D,E,!0),z()}))}return!0}),Q,J,i,l,j,k,O)}_getTexImageParametersForCreateTexture(V,p){let W,N;return 1===this.webGLVersion?(W=this._getInternalFormat(V,p),N=W):(W=this._getInternalFormat(V,!1),N=this._getRGBABufferInternalSizedFormat(0,V,p)),{internalFormat:N,format:W,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(V,p,W,N,d){}_unpackFlipY(V){this._unpackFlipYCached!==V&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,V?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=V))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(V){return V.isCube?this._gl.TEXTURE_CUBE_MAP:V.is3D?this._gl.TEXTURE_3D:V.is2DArray||V.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=this._getTextureTarget(p),d=this._getSamplingParameters(V,p.useMipMaps||W);this._setTextureParameterInteger(N,this._gl.TEXTURE_MAG_FILTER,d.mag,p),this._setTextureParameterInteger(N,this._gl.TEXTURE_MIN_FILTER,d.min),W&&(p.generateMipMaps=!0,this._gl.generateMipmap(N)),this._bindTextureDirectly(N,null),p.samplingMode=V}updateTextureDimensions(V,p,W){}updateTextureWrappingMode(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const d=this._getTextureTarget(V);null!==p&&(this._setTextureParameterInteger(d,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(p),V),V._cachedWrapU=p),null!==W&&(this._setTextureParameterInteger(d,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(W),V),V._cachedWrapV=W),(V.is2DArray||V.is3D)&&null!==N&&(this._setTextureParameterInteger(d,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(N),V),V._cachedWrapR=N),this._bindTextureDirectly(d,null)}_uploadCompressedDataToTextureDirectly(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const S=this._gl;let Q=S.TEXTURE_2D;if(V.isCube&&(Q=S.TEXTURE_CUBE_MAP_POSITIVE_X+E),V._useSRGBBuffer)switch(p){case 37492:case 36196:this._caps.etc2?p=S.COMPRESSED_SRGB8_ETC2:V._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?p=S.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:V._useSRGBBuffer=!1;break;case 36492:p=S.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:p=S.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?p=S.COMPRESSED_SRGB_S3TC_DXT1_EXT:V._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?p=S.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:V._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?p=S.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:V._useSRGBBuffer=!1;break;default:V._useSRGBBuffer=!1}this._gl.compressedTexImage2D(Q,z,p,W,N,0,d)}_uploadDataToTextureDirectly(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const z=this._gl,S=this._getWebGLTextureType(V.type),Q=this._getInternalFormat(V.format),J=void 0===d?this._getRGBABufferInternalSizedFormat(V.type,V.format,V._useSRGBBuffer):this._getInternalFormat(d,V._useSRGBBuffer);this._unpackFlipY(V.invertY);let i=z.TEXTURE_2D;V.isCube&&(i=z.TEXTURE_CUBE_MAP_POSITIVE_X+W);const l=Math.round(Math.log(V.width)*Math.LOG2E),j=Math.round(Math.log(V.height)*Math.LOG2E),k=E?V.width:Math.pow(2,Math.max(l-N,0)),u=E?V.height:Math.pow(2,Math.max(j-N,0));z.texImage2D(i,N,J,k,u,0,Q,S,p)}updateTextureData(V,p,W,N,d,E){let z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,Q=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const J=this._gl,i=this._getWebGLTextureType(V.type),l=this._getInternalFormat(V.format);this._unpackFlipY(V.invertY);let j=J.TEXTURE_2D,k=J.TEXTURE_2D;V.isCube&&(k=J.TEXTURE_CUBE_MAP_POSITIVE_X+z,j=J.TEXTURE_CUBE_MAP),this._bindTextureDirectly(j,V,!0),J.texSubImage2D(k,S,W,N,d,E,l,i,p),Q&&this._gl.generateMipmap(k),this._bindTextureDirectly(j,null)}_uploadArrayBufferViewToTexture(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const d=this._gl,E=V.isCube?d.TEXTURE_CUBE_MAP:d.TEXTURE_2D;this._bindTextureDirectly(E,V,!0),this._uploadDataToTextureDirectly(V,p,W,N),this._bindTextureDirectly(E,null,!0)}_prepareWebGLTextureContinuation(V,p,W,N,d){const E=this._gl;if(!E)return;const z=this._getSamplingParameters(d,!W);E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,z.mag),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,z.min),W||N||E.generateMipmap(E.TEXTURE_2D),this._bindTextureDirectly(E.TEXTURE_2D,null),p&&p.removePendingData(V),V.onLoadedObservable.notifyObservers(V),V.onLoadedObservable.clear()}_prepareWebGLTexture(V,p,W,N,d,E,z,S,Q,J){const i=this.getCaps().maxTextureSize,j=Math.min(i,this.needPOTTextures?(0,l.g)(N.width,i):N.width),k=Math.min(i,this.needPOTTextures?(0,l.g)(N.height,i):N.height),u=this._gl;u&&(V._hardwareTexture?(this._bindTextureDirectly(u.TEXTURE_2D,V,!0),this._unpackFlipY(void 0===d||!!d),V.baseWidth=N.width,V.baseHeight=N.height,V.width=j,V.height=k,V.isReady=!0,V.type=-1!==V.type?V.type:0,V.format=-1!==V.format?V.format:J??(".jpg"!==p||V._useSRGBBuffer?5:4),S(j,k,N,p,V,(()=>{this._prepareWebGLTextureContinuation(V,W,E,z,Q)}))||this._prepareWebGLTextureContinuation(V,W,E,z,Q)):W&&W.removePendingData(V))}_getInternalFormatFromDepthTextureFormat(V,p,W){const N=this._gl;if(!p)return N.STENCIL_INDEX8;let d=W?N.DEPTH_STENCIL:N.DEPTH_COMPONENT;return this.webGLVersion>1?15===V?d=N.DEPTH_COMPONENT16:16===V?d=N.DEPTH_COMPONENT24:17===V||13===V?d=W?N.DEPTH24_STENCIL8:N.DEPTH_COMPONENT24:14===V?d=N.DEPTH_COMPONENT32F:18===V&&(d=W?N.DEPTH32F_STENCIL8:N.DEPTH_COMPONENT32F):d=N.DEPTH_COMPONENT16,d}_setupFramebufferDepthAttachments(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,E=arguments.length>5?arguments[5]:void 0;const z=this._gl;E=E??(V?13:14);const S=this._getInternalFormatFromDepthTextureFormat(E,p,V);return V&&p?this._createRenderBuffer(W,N,d,z.DEPTH_STENCIL,S,z.DEPTH_STENCIL_ATTACHMENT):p?this._createRenderBuffer(W,N,d,S,S,z.DEPTH_ATTACHMENT):V?this._createRenderBuffer(W,N,d,S,S,z.STENCIL_ATTACHMENT):null}_createRenderBuffer(V,p,W,N,d,E){let z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const S=this._gl.createRenderbuffer();return this._updateRenderBuffer(S,V,p,W,N,d,E,z)}_updateRenderBuffer(V,p,W,N,d,E,z){let S=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const Q=this._gl;return Q.bindRenderbuffer(Q.RENDERBUFFER,V),N>1&&Q.renderbufferStorageMultisample?Q.renderbufferStorageMultisample(Q.RENDERBUFFER,N,E,p,W):Q.renderbufferStorage(Q.RENDERBUFFER,d,p,W),Q.framebufferRenderbuffer(Q.FRAMEBUFFER,z,Q.RENDERBUFFER,V),S&&Q.bindRenderbuffer(Q.RENDERBUFFER,null),V}_releaseTexture(V){this._deleteTexture(V._hardwareTexture),this.unbindAllTextures();const p=this._internalTexturesCache.indexOf(V);-1!==p&&this._internalTexturesCache.splice(p,1),V._lodTextureHigh&&V._lodTextureHigh.dispose(),V._lodTextureMid&&V._lodTextureMid.dispose(),V._lodTextureLow&&V._lodTextureLow.dispose(),V._irradianceTexture&&V._irradianceTexture.dispose()}_deleteTexture(V){null===V||void 0===V||V.release()}_setProgram(V){this._currentProgram!==V&&((0,N.o)(V,this._gl),this._currentProgram=V)}bindSamplers(V){const p=V.getPipelineContext();this._setProgram(p.program);const W=V.getSamplers();for(let N=0;N<W.length;N++){const p=V.getUniform(W[N]);p&&(this._boundUniforms[N]=p)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=!1;const z=p&&p._associatedChannel>-1;W&&z&&(this._activeChannel=p._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==p||N){if(this._activateCurrentTexture(),p&&p.isMultiview)throw E.e.Error(["_bindTextureDirectly called with a multiview texture!",V,p]),"_bindTextureDirectly called with a multiview texture!";var S;this._gl.bindTexture(V,(null===p||void 0===p||null===(S=p._hardwareTexture)||void 0===S?void 0:S.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=p,p&&(p._associatedChannel=this._activeChannel)}else W&&(d=!0,this._activateCurrentTexture());return z&&!W&&this._bindSamplerUniformToChannel(p._associatedChannel,this._activeChannel),d}_bindTexture(V,p,W){if(void 0===V)return;p&&(p._associatedChannel=V),this._activeChannel=V;const N=p?this._getTextureTarget(p):this._gl.TEXTURE_2D;this._bindTextureDirectly(N,p)}unbindAllTextures(){for(let V=0;V<this._maxSimultaneousTextures;V++)this._activeChannel=V,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(V,p,W,N){void 0!==V&&(p&&(this._boundUniforms[V]=p),this._setTexture(V,W))}_bindSamplerUniformToChannel(V,p){const W=this._boundUniforms[V];W&&W._currentState!==p&&(this._gl.uniform1i(W,p),W._currentState=p)}_getTextureWrapMode(V){switch(V){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(V,p){let W,N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!p)return null!=this._boundTexturesCache[V]&&(this._activeChannel=V,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(p.video){this._activeChannel=V;const W=p.getInternalTexture();W&&(W._associatedChannel=V),p.update()}else if(4===p.delayLoadState)return p.delayLoad(),!1;W=d?p.depthStencilTexture:p.isReady()?p.getInternalTexture():p.isCube?this.emptyCubeTexture:p.is3D?this.emptyTexture3D:p.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!N&&W&&(W._associatedChannel=V);let E=!0;this._boundTexturesCache[V]===W&&(N||this._bindSamplerUniformToChannel(W._associatedChannel,V),E=!1),this._activeChannel=V;const z=this._getTextureTarget(W);if(E&&this._bindTextureDirectly(z,W,N),W&&!W.isMultiview){if(W.isCube&&W._cachedCoordinatesMode!==p.coordinatesMode){W._cachedCoordinatesMode=p.coordinatesMode;const V=3!==p.coordinatesMode&&5!==p.coordinatesMode?1:0;p.wrapU=V,p.wrapV=V}W._cachedWrapU!==p.wrapU&&(W._cachedWrapU=p.wrapU,this._setTextureParameterInteger(z,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(p.wrapU),W)),W._cachedWrapV!==p.wrapV&&(W._cachedWrapV=p.wrapV,this._setTextureParameterInteger(z,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(p.wrapV),W)),W.is3D&&W._cachedWrapR!==p.wrapR&&(W._cachedWrapR=p.wrapR,this._setTextureParameterInteger(z,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(p.wrapR),W)),this._setAnisotropicLevel(z,W,p.anisotropicFilteringLevel)}return!0}setTextureArray(V,p,W,N){if(void 0!==V&&p){this._textureUnits&&this._textureUnits.length===W.length||(this._textureUnits=new Int32Array(W.length));for(let p=0;p<W.length;p++){const N=W[p].getInternalTexture();N?(this._textureUnits[p]=V+p,N._associatedChannel=V+p):this._textureUnits[p]=-1}this._gl.uniform1iv(p,this._textureUnits);for(let V=0;V<W.length;V++)this._setTexture(this._textureUnits[V],W[V],!0)}}_setAnisotropicLevel(V,p,W){const N=this._caps.textureAnisotropicFilterExtension;11!==p.samplingMode&&3!==p.samplingMode&&2!==p.samplingMode&&(W=1),N&&p._cachedAnisotropicFilteringLevel!==W&&(this._setTextureParameterFloat(V,N.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(W,this._caps.maxAnisotropy),p),p._cachedAnisotropicFilteringLevel=W)}_setTextureParameterFloat(V,p,W,N){this._bindTextureDirectly(V,N,!0,!0),this._gl.texParameterf(V,p,W)}_setTextureParameterInteger(V,p,W,N){N&&this._bindTextureDirectly(V,N,!0,!0),this._gl.texParameteri(V,p,W)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let V=0;V<this._caps.maxVertexAttribs;V++)this.disableAttributeByIndex(V)}else for(let V=0,p=this._vertexAttribArraysEnabled.length;V<p;V++)V>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[V]||this.disableAttributeByIndex(V)}releaseEffects(){const V=Object.keys(this._compiledEffects);for(const p of V){this._compiledEffects[p].dispose()}this._compiledEffects={}}dispose(){var V;((0,z.l)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(V=this._gl.getExtension("WEBGL_lose_context"))||void 0===V||V.loseContext());(0,N.x)(this._gl)}attachContextLostEvent(V){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",V,!1)}attachContextRestoredEvent(V){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",V,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(V){const p=this._gl;for(;p.getError()!==p.NO_ERROR;);let W=!0;const N=p.createTexture();p.bindTexture(p.TEXTURE_2D,N),p.texImage2D(p.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(V),1,1,0,p.RGBA,this._getWebGLTextureType(V),null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST);const d=p.createFramebuffer();p.bindFramebuffer(p.FRAMEBUFFER,d),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,N,0);const E=p.checkFramebufferStatus(p.FRAMEBUFFER);if(W=W&&E===p.FRAMEBUFFER_COMPLETE,W=W&&p.getError()===p.NO_ERROR,W&&(p.clear(p.COLOR_BUFFER_BIT),W=W&&p.getError()===p.NO_ERROR),W){p.bindFramebuffer(p.FRAMEBUFFER,null);const V=p.RGBA,N=p.UNSIGNED_BYTE,d=new Uint8Array(4);p.readPixels(0,0,1,1,V,N,d),W=W&&p.getError()===p.NO_ERROR}for(p.deleteTexture(N),p.deleteFramebuffer(d),p.bindFramebuffer(p.FRAMEBUFFER,null);!W&&p.getError()!==p.NO_ERROR;);return W}_getWebGLTextureType(V){if(1===this._webGLVersion){switch(V){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(V){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=p?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(V){case 0:W=this._gl.ALPHA;break;case 1:W=this._gl.LUMINANCE;break;case 2:W=this._gl.LUMINANCE_ALPHA;break;case 6:W=this._gl.RED;break;case 7:W=this._gl.RG;break;case 4:W=p?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:W=p?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(V){case 8:W=this._gl.RED_INTEGER;break;case 9:W=this._gl.RG_INTEGER;break;case 10:W=this._gl.RGB_INTEGER;break;case 11:W=this._gl.RGBA_INTEGER}return W}_getRGBABufferInternalSizedFormat(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==p)switch(p){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return W?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(V){case 3:switch(p){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(p){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return W?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return W?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(p){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(p){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(p){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(p){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(p){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(p){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(p){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return W?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(V,p,W,N){let d=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],E=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const z=d?4:3,S=d?this._gl.RGBA:this._gl.RGB,Q=new Uint8Array(N*W*z);return E&&this.flushFramebuffer(),this._gl.readPixels(V,p,W,N,S,this._gl.UNSIGNED_BYTE,Q),Promise.resolve(Q)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const V=j.d._CreateCanvas(1,1),p=V.getContext("webgl")||V.getContext("experimental-webgl");this._IsSupported=null!=p&&!!window.WebGLRenderingContext}catch(V){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const V=j.d._CreateCanvas(1,1),p=V.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||V.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!p}catch(V){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}C._TempClearColorUint32=new Uint32Array(4),C._TempClearColorInt32=new Int32Array(4),C.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],C._ConcatenateShader=O.g,C._IsSupported=null,C._HasMajorPerformanceCaveat=null},11340:(V,p,W)=>{"use strict";var N;W.d(p,{b:()=>d}),function(V){V[V.PointerMove=0]="PointerMove",V[V.PointerDown=1]="PointerDown",V[V.PointerUp=2]="PointerUp"}(N||(N={}));class d{}d.DOM_DELTA_PIXEL=0,d.DOM_DELTA_LINE=1,d.DOM_DELTA_PAGE=2},11335:(V,p,W)=>{"use strict";W.d(p,{e:()=>N,f:()=>E,g:()=>d});class N{}N.KEYDOWN=1,N.KEYUP=2;class d{constructor(V,p){this.type=V,this.event=p}}class E extends d{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(V){this.skipOnKeyboardObservable=V}constructor(V,p){super(V,p),this.type=V,this.event=p,this.skipOnKeyboardObservable=!1}}},11330:(V,p,W)=>{"use strict";W.d(p,{d:()=>d,h:()=>z,j:()=>S});var N=W(11218);class d{}d.POINTERDOWN=1,d.POINTERUP=2,d.POINTERMOVE=4,d.POINTERWHEEL=8,d.POINTERPICK=16,d.POINTERTAP=32,d.POINTERDOUBLETAP=64;class E{constructor(V,p){this.type=V,this.event=p}}class z extends E{constructor(V,p,W,d){super(V,p),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new N.k(W,d)}}class S extends E{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(V,p),this._pickInfo=W,this._inputManager=N}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},10839:(V,p,W)=>{"use strict";W.r(p),W.d(p,{SceneInstrumentation:()=>E});var N=W(10848),d=W(11019);class E{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(V){V!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=V,V?(this._onBeforeActiveMeshesEvaluationObserver=this.Bc.onBeforeActiveMeshesEvaluationObservable.add((()=>{N.e.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Bc.onAfterActiveMeshesEvaluationObservable.add((()=>{N.e.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Bc.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Bc.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(V){V!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=V,V?(this._onBeforeRenderTargetsRenderObserver=this.Bc.onBeforeRenderTargetsRenderObservable.add((()=>{N.e.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Bc.onAfterRenderTargetsRenderObservable.add((()=>{N.e.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Bc.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Bc.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(V){V!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=V,V?(this._onBeforeParticlesRenderingObserver=this.Bc.onBeforeParticlesRenderingObservable.add((()=>{N.e.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Bc.onAfterParticlesRenderingObservable.add((()=>{N.e.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Bc.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Bc.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(V){V!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=V,this.Bc.spriteManagers&&(V?(this._onBeforeSpritesRenderingObserver=this.Bc.onBeforeSpritesRenderingObservable.add((()=>{N.e.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Bc.onAfterSpritesRenderingObservable.add((()=>{N.e.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Bc.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Bc.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(V){V!==this._capturePhysicsTime&&this.Bc.onBeforePhysicsObservable&&(this._capturePhysicsTime=V,V?(this._onBeforePhysicsObserver=this.Bc.onBeforePhysicsObservable.add((()=>{N.e.StartPerformanceCounter("jb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Bc.onAfterPhysicsObservable.add((()=>{N.e.EndPerformanceCounter("jb"),this._physicsTime.endMonitoring()}))):(this.Bc.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Bc.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(V){V!==this._captureAnimationsTime&&(this._captureAnimationsTime=V,V?this._onAfterAnimationsObserver=this.Bc.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Bc.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(V){this._captureFrameTime=V}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(V){this._captureInterFrameTime=V}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(V){V!==this._captureRenderTime&&(this._captureRenderTime=V,V?(this._onBeforeDrawPhaseObserver=this.Bc.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),N.e.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Bc.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),N.e.EndPerformanceCounter("Main render")}))):(this.Bc.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Bc.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(V){V!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=V,V?(this._onBeforeCameraRenderObserver=this.Bc.onBeforeCameraRenderObservable.add((V=>{this._cameraRenderTime.beginMonitoring(),N.e.StartPerformanceCounter(`Rendering camera ${V.name}`)})),this._onAfterCameraRenderObserver=this.Bc.onAfterCameraRenderObservable.add((V=>{this._cameraRenderTime.endMonitoring(!1),N.e.EndPerformanceCounter(`Rendering camera ${V.name}`)}))):(this.Bc.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Bc.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Bc.getEngine()._drawCalls}constructor(V){this.Bc=V,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new d.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new d.b,this._captureFrameTime=!1,this._frameTime=new d.b,this._captureRenderTime=!1,this._renderTime=new d.b,this._captureInterFrameTime=!1,this._interFrameTime=new d.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new d.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new d.b,this._capturePhysicsTime=!1,this._physicsTime=new d.b,this._captureAnimationsTime=!1,this._animationsTime=new d.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new d.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=V.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(N.e.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Bc.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=V.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(N.e.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Wi(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Wi(),this._captureParticlesRenderTime&&this._particlesRenderTime.Wi(),this._captureSpritesRenderTime&&this._spritesRenderTime.Wi(),this._captureRenderTime&&this._renderTime.Wi(),this._captureCameraRenderTime&&this._cameraRenderTime.Wi()}))}dispose(){this.Bc.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Bc.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Bc.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Bc.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Bc.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Bc.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Bc.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Bc.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Bc.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Bc.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Bc.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Bc.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Bc.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Bc.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Bc.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Bc.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Bc.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Bc=null}}},12589:(V,p,W)=>{"use strict";W.d(p,{c:()=>i});var N=W(11167),d=W(11175),E=W(11218),z=W(11529),S=W(12542),Q=W(12591),J=W(11004);z.b.AddNodeConstructor("Light_Type_1",((V,p)=>()=>new i(V,E.n.Zero(),p)));class i extends Q.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(V){this._shadowFrustumSize=V,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(V){this._shadowOrthoScale=V,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(V){this._orthoLeft=V}get orthoRight(){return this._orthoRight}set orthoRight(V){this._orthoRight=V}get orthoTop(){return this._orthoTop}set orthoTop(V){this._orthoTop=V}get orthoBottom(){return this._orthoBottom}set orthoBottom(V){this._orthoBottom=V}constructor(V,p,W){super(V,W),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=p.scale(-1),this.direction=p}getClassName(){return"kb"}getTypeID(){return S.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(V,p,W){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(V):this._setDefaultAutoExtendShadowProjectionMatrix(V,p,W)}_setDefaultFixedFrustumShadowProjectionMatrix(V){const p=this.va().activeCamera;p&&E.e.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:p.Li,void 0!==this.shadowMaxZ?this.shadowMaxZ:p.maxZ,V,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(V,p,W){const N=this.va().activeCamera;if(!N)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const V=E.n.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let N=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let z=0;z<W.length;z++){const S=W[z];if(!S)continue;const Q=S.getBoundingInfo().boundingBox;for(let W=0;W<Q.vectorsWorld.length;W++)E.n.TransformCoordinatesToRef(Q.vectorsWorld[W],p,V),V.x<this._orthoLeft&&(this._orthoLeft=V.x),V.y<this._orthoBottom&&(this._orthoBottom=V.y),V.x>this._orthoRight&&(this._orthoRight=V.x),V.y>this._orthoTop&&(this._orthoTop=V.y),this.autoCalcShadowZBounds&&(V.z<N&&(N=V.z),V.z>d&&(d=V.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=N,this._shadowMaxZ=d)}const d=this._orthoRight-this._orthoLeft,z=this._orthoTop-this._orthoBottom,S=void 0!==this.shadowMinZ?this.shadowMinZ:N.Li,Q=void 0!==this.shadowMaxZ?this.shadowMaxZ:N.maxZ,J=this.va().getEngine().useReverseDepthBuffer;E.e.OrthoOffCenterLHToRef(this._orthoLeft-d*this.shadowOrthoScale,this._orthoRight+d*this.shadowOrthoScale,this._orthoBottom-z*this.shadowOrthoScale,this._orthoTop+z*this.shadowOrthoScale,J?Q:S,J?S:Q,V,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(V,p){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,p),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,p),this)}transferToNodeMaterialEffect(V,p){return this.computeTransformedInformation()?(V.setFloat3(p,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(V.setFloat3(p,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(V){const p=this._scene.getEngine();return!p.useReverseDepthBuffer&&p.isNDCHalfZRange?0:1}getDepthMaxZ(V){const p=this._scene.getEngine();return p.useReverseDepthBuffer&&p.isNDCHalfZRange?0:1}prepareLightSpecificDefines(V,p){V["DIRLIGHT"+p]=!0}}(0,N.c)([(0,d.I)()],i.prototype,"shadowFrustumSize",null),(0,N.c)([(0,d.I)()],i.prototype,"shadowOrthoScale",null),(0,N.c)([(0,d.I)()],i.prototype,"autoUpdateExtends",void 0),(0,N.c)([(0,d.I)()],i.prototype,"autoCalcShadowZBounds",void 0),(0,N.c)([(0,d.I)("orthoLeft")],i.prototype,"_orthoLeft",void 0),(0,N.c)([(0,d.I)("orthoRight")],i.prototype,"_orthoRight",void 0),(0,N.c)([(0,d.I)("orthoTop")],i.prototype,"_orthoTop",void 0),(0,N.c)([(0,d.I)("orthoBottom")],i.prototype,"_orthoBottom",void 0),(0,J.d)("BABYLON.DirectionalLight",i)},12957:(V,p,W)=>{"use strict";W.d(p,{b:()=>i});var N=W(11167),d=W(11175),E=W(11218),z=W(11257),S=W(11529),Q=W(12542),J=W(11004);S.b.AddNodeConstructor("Light_Type_3",((V,p)=>()=>new i(V,E.n.Zero(),p)));class i extends Q.e{constructor(V,p,W){super(V,W),this.groundColor=new z.c(0,0,0),this.direction=p||E.n.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"lb"}setDirectionToTarget(V){return this.direction=E.n.Normalize(V.ed(E.n.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(V,p){const W=E.n.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",W.x,W.y,W.z,0,p),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Pi),p),this}transferToNodeMaterialEffect(V,p){const W=E.n.Normalize(this.direction);return V.setFloat3(p,W.x,W.y,W.z),this}Dj(){return this._worldMatrix||(this._worldMatrix=E.e.Identity()),this._worldMatrix}getTypeID(){return Q.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(V,p){V["HEMILIGHT"+p]=!0}}(0,N.c)([(0,d.k)()],i.prototype,"groundColor",void 0),(0,N.c)([(0,d.F)()],i.prototype,"direction",void 0),(0,J.d)("BABYLON.HemisphericLight",i)},12542:(V,p,W)=>{"use strict";W.d(p,{e:()=>j});var N=W(11167),d=W(11175),E=W(11218),z=W(11257),S=W(11529),Q=W(11278),J=W(11004),i=W(11373),l=W(11265);class j extends S.b{get range(){return this._range}set range(V){this._range=V,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(V){this._intensityMode=V,this._computePhotometricScale()}get radius(){return this._radius}set radius(V){this._radius=V,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(V){this._shadowEnabled!==V&&(this._shadowEnabled=V,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(V){this._includedOnlyMeshes=V,this._hookArrayForIncludedOnly(V)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(V){this._excludedMeshes=V,this._hookArrayForExcluded(V)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(V){this._excludeWithLayerMask=V,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(V){this._includeOnlyWithLayerMask=V,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(V){this._lightmapMode!==V&&(this._lightmapMode=V,this._markMeshesAsLightDirty())}getViewMatrix(V){return null}getProjectionMatrix(V,p){return null}constructor(V,p){super(V,p,!1),this.qh=new z.c(1,1,1),this.rh=new z.c(1,1,1),this.falloffType=j.FALLOFF_DEFAULT,this.Pi=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=j.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new Q.c(this.va().getEngine(),void 0,void 0,V),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(V,p){return this}_bindLight(V,p,W,N){let d=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const E=V.toString();let S=!1;if(this._uniformBuffer.bindToEffect(W,"Light"+E),this._renderId!==p.getRenderId()||this._lastUseSpecular!==N||!this._uniformBuffer.useUbo){this._renderId=p.getRenderId(),this._lastUseSpecular=N;const V=this.getScaledIntensity();this.transferToEffect(W,E),this.qh.scaleToRef(V,z.g.gb[0]),this._uniformBuffer.updateColor4("vLightDiffuse",z.g.gb[0],this.range,E),N&&(this.rh.scaleToRef(V,z.g.gb[1]),this._uniformBuffer.updateColor4("vLightSpecular",z.g.gb[1],this.radius,E)),S=!0}if(this.transferTexturesToEffect(W,E),p.shadowsEnabled&&this.shadowEnabled&&d){const V=this.getShadowGenerator(p.activeCamera)??this.getShadowGenerator();V&&(V.bindShadowLight(E,W),S=!0)}S?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(V){let p="Name: "+this.name;if(p+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let W=0;W<this.animations.length;W++)p+=", animation[0]: "+this.animations[W].toString(V);return p}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Ab(V){super.Ab(V),this._resyncMeshes()}getShadowGenerator(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(V)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return E.n.Zero()}canAffectMesh(V){return!V||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(V))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(V))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&V.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&V.layerMask)))}dispose(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const V=this._shadowGenerators.values();for(let p=V.next();!0!==p.done;p=V.next()){p.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const V=this._parentContainer.lights.indexOf(this);V>-1&&this._parentContainer.lights.splice(V,1),this._parentContainer=null}for(const W of this.va().meshes)W._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(V,p)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Pi}clone(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=j.GetConstructorFromName(this.getTypeID(),V,this.va());if(!W)return null;const N=l.b.Clone(W,this);return V&&(N.name=V),p&&(N.parent=p),N.Ab(this.isEnabled()),this.onClonedObservable.notifyObservers(N),N}serialize(){const V=l.b.Serialize(this);return V.uniqueId=this.uniqueId,V.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(V),this.excludedMeshes.length>0&&(V.excludedMeshesIds=[],this.excludedMeshes.forEach((p=>{V.excludedMeshesIds.push(p.id)}))),this.includedOnlyMeshes.length>0&&(V.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((p=>{V.includedOnlyMeshesIds.push(p.id)}))),l.b.AppendSerializedAnimations(this,V),V.ranges=this.serializeAnimationRanges(),V.isEnabled=this.isEnabled(),V}static GetConstructorFromName(V,p,W){const N=S.b.Construct("Light_Type_"+V,p,W);return N||null}static Parse(V,p){const W=j.GetConstructorFromName(V.type,V.name,p);if(!W)return null;const N=l.b.Parse(W,V,p);if(V.excludedMeshesIds&&(N._excludedMeshesIds=V.excludedMeshesIds),V.includedOnlyMeshesIds&&(N._includedOnlyMeshesIds=V.includedOnlyMeshesIds),void 0!==V.parentId&&(N._waitingParentId=V.parentId),void 0!==V.parentInstanceIndex&&(N._waitingParentInstanceIndex=V.parentInstanceIndex),void 0!==V.falloffType&&(N.falloffType=V.falloffType),void 0!==V.lightmapMode&&(N.lightmapMode=V.lightmapMode),V.animations){for(let p=0;p<V.animations.length;p++){const W=V.animations[p],d=(0,J.b)("BABYLON.Animation");d&&N.animations.push(d.Parse(W))}S.b.ParseAnimationRanges(N,V,p)}return V.autoAnimate&&p.beginAnimation(N,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),void 0!==V.isEnabled&&N.Ab(V.isEnabled),N}_hookArrayForExcluded(V){var p=this;const W=V.push;V.push=function(){for(var N=arguments.length,d=new Array(N),E=0;E<N;E++)d[E]=arguments[E];const z=W.apply(V,d);for(const V of d)V._resyncLightSource(p);return z};const N=V.splice;V.splice=(p,W)=>{const d=N.apply(V,[p,W]);for(const V of d)V._resyncLightSource(this);return d};for(const d of V)d._resyncLightSource(this)}_hookArrayForIncludedOnly(V){var p=this;const W=V.push;V.push=function(){for(var N=arguments.length,d=new Array(N),E=0;E<N;E++)d[E]=arguments[E];const z=W.apply(V,d);return p._resyncMeshes(),z};const N=V.splice;V.splice=(p,W)=>{const d=N.apply(V,[p,W]);return this._resyncMeshes(),d},this._resyncMeshes()}_resyncMeshes(){for(const V of this.va().meshes)V._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const V of this.va().meshes)-1!==V.lightSources.indexOf(this)&&V._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let V=0;const p=this.getTypeID();let W=this.intensityMode;switch(W===j.INTENSITYMODE_AUTOMATIC&&(W=p===j.LIGHTTYPEID_DIRECTIONALLIGHT?j.INTENSITYMODE_ILLUMINANCE:j.INTENSITYMODE_LUMINOUSINTENSITY),p){case j.LIGHTTYPEID_POINTLIGHT:case j.LIGHTTYPEID_SPOTLIGHT:switch(W){case j.INTENSITYMODE_LUMINOUSPOWER:V=1/(4*Math.PI);break;case j.INTENSITYMODE_LUMINOUSINTENSITY:V=1;break;case j.INTENSITYMODE_LUMINANCE:V=this.radius*this.radius}break;case j.LIGHTTYPEID_DIRECTIONALLIGHT:switch(W){case j.INTENSITYMODE_ILLUMINANCE:V=1;break;case j.INTENSITYMODE_LUMINANCE:{let p=this.radius;p=Math.max(p,.001);V=2*Math.PI*(1-Math.cos(p));break}}break;case j.LIGHTTYPEID_HEMISPHERICLIGHT:V=1}return V}_reorderLightsInScene(){const V=this.va();0!=this._renderPriority&&(V.requireLightSorting=!0),this.va().sortLightsByPriority()}}j.FALLOFF_DEFAULT=i.e.FALLOFF_DEFAULT,j.FALLOFF_PHYSICAL=i.e.FALLOFF_PHYSICAL,j.FALLOFF_GLTF=i.e.FALLOFF_GLTF,j.FALLOFF_STANDARD=i.e.FALLOFF_STANDARD,j.LIGHTMAP_DEFAULT=i.e.LIGHTMAP_DEFAULT,j.LIGHTMAP_SPECULAR=i.e.LIGHTMAP_SPECULAR,j.LIGHTMAP_SHADOWSONLY=i.e.LIGHTMAP_SHADOWSONLY,j.INTENSITYMODE_AUTOMATIC=i.e.INTENSITYMODE_AUTOMATIC,j.INTENSITYMODE_LUMINOUSPOWER=i.e.INTENSITYMODE_LUMINOUSPOWER,j.INTENSITYMODE_LUMINOUSINTENSITY=i.e.INTENSITYMODE_LUMINOUSINTENSITY,j.INTENSITYMODE_ILLUMINANCE=i.e.INTENSITYMODE_ILLUMINANCE,j.INTENSITYMODE_LUMINANCE=i.e.INTENSITYMODE_LUMINANCE,j.LIGHTTYPEID_POINTLIGHT=i.e.LIGHTTYPEID_POINTLIGHT,j.LIGHTTYPEID_DIRECTIONALLIGHT=i.e.LIGHTTYPEID_DIRECTIONALLIGHT,j.LIGHTTYPEID_SPOTLIGHT=i.e.LIGHTTYPEID_SPOTLIGHT,j.LIGHTTYPEID_HEMISPHERICLIGHT=i.e.LIGHTTYPEID_HEMISPHERICLIGHT,(0,N.c)([(0,d.k)()],j.prototype,"diffuse",void 0),(0,N.c)([(0,d.k)()],j.prototype,"specular",void 0),(0,N.c)([(0,d.I)()],j.prototype,"falloffType",void 0),(0,N.c)([(0,d.I)()],j.prototype,"intensity",void 0),(0,N.c)([(0,d.I)()],j.prototype,"range",null),(0,N.c)([(0,d.I)()],j.prototype,"intensityMode",null),(0,N.c)([(0,d.I)()],j.prototype,"radius",null),(0,N.c)([(0,d.I)()],j.prototype,"_renderPriority",void 0),(0,N.c)([(0,d.d)("_reorderLightsInScene")],j.prototype,"renderPriority",void 0),(0,N.c)([(0,d.I)("shadowEnabled")],j.prototype,"_shadowEnabled",void 0),(0,N.c)([(0,d.I)("excludeWithLayerMask")],j.prototype,"_excludeWithLayerMask",void 0),(0,N.c)([(0,d.I)("includeOnlyWithLayerMask")],j.prototype,"_includeOnlyWithLayerMask",void 0),(0,N.c)([(0,d.I)("lightmapMode")],j.prototype,"_lightmapMode",void 0)},11373:(V,p,W)=>{"use strict";W.d(p,{e:()=>N});class N{static CompareLightsPriority(V,p){return V.shadowEnabled!==p.shadowEnabled?(p.shadowEnabled?1:0)-(V.shadowEnabled?1:0):p.renderPriority-V.renderPriority}}N.FALLOFF_DEFAULT=0,N.FALLOFF_PHYSICAL=1,N.FALLOFF_GLTF=2,N.FALLOFF_STANDARD=3,N.LIGHTMAP_DEFAULT=0,N.LIGHTMAP_SPECULAR=1,N.LIGHTMAP_SHADOWSONLY=2,N.INTENSITYMODE_AUTOMATIC=0,N.INTENSITYMODE_LUMINOUSPOWER=1,N.INTENSITYMODE_LUMINOUSINTENSITY=2,N.INTENSITYMODE_ILLUMINANCE=3,N.INTENSITYMODE_LUMINANCE=4,N.LIGHTTYPEID_POINTLIGHT=0,N.LIGHTTYPEID_DIRECTIONALLIGHT=1,N.LIGHTTYPEID_SPOTLIGHT=2,N.LIGHTTYPEID_HEMISPHERICLIGHT=3},12591:(V,p,W)=>{"use strict";W.d(p,{b:()=>Q});var N=W(11167),d=W(11175),E=W(11218),z=W(12542),S=W(11579);class Q extends z.e{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=E.e.Identity(),this._projectionMatrix=E.e.Identity()}_setPosition(V){this._position=V}get position(){return this._position}set position(V){this._setPosition(V)}_setDirection(V){this._direction=V}get direction(){return this._direction}set direction(V){this._setDirection(V)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(V){this._shadowMinZ=V,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(V){this._shadowMaxZ=V,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=E.n.Zero()),E.n.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=E.n.Zero()),E.n.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(V){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(V){return this.direction=E.n.Normalize(V.ed(this.position)),this.direction}getRotation(){this.direction.normalize();const V=E.n.Cross(this.direction,S.e.Y),p=E.n.Cross(V,this.direction);return E.n.RotationFromAxis(V,p,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=E.n.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Dj(V){return!V&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=E.e.Identity()),E.e.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(V){return void 0!==this.shadowMinZ?this.shadowMinZ:V.Li}getDepthMaxZ(V){return void 0!==this.shadowMaxZ?this.shadowMaxZ:V.maxZ}setShadowProjectionMatrix(V,p,W){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(p,W,V):this._setDefaultShadowProjectionMatrix(V,p,W),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(V){const p=E.i.fb[0];let W=this.position;this.computeTransformedInformation()&&(W=this.transformedPosition),E.n.NormalizeToRef(this.getShadowDirection(V),p),1===Math.abs(E.n.Dot(p,E.n.Up()))&&(p.z=1e-13);const N=E.i.fb[1];return W.addToRef(p,N),E.e.LookAtLHToRef(W,N,E.n.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(V,p){return this.setShadowProjectionMatrix(this._projectionMatrix,V??this._viewMatrix,p??[]),this._projectionMatrix}}(0,N.c)([(0,d.F)()],Q.prototype,"position",null),(0,N.c)([(0,d.F)()],Q.prototype,"direction",null),(0,N.c)([(0,d.I)()],Q.prototype,"shadowMinZ",null),(0,N.c)([(0,d.I)()],Q.prototype,"shadowMaxZ",null)},11891:(V,p,W)=>{"use strict";W.d(p,{e:()=>z,g:()=>E,h:()=>S});const N={},d={};function E(V,p){N[V]=p}function z(V,p){d[V]=p}function S(V){return d[V]?d[V]:null}},11639:(V,p,W)=>{"use strict";W.d(p,{e:()=>b,f:()=>t});var N,d=W(10848),E=W(10856),z=W(11200),S=W(10900),Q=W(10870),J=W(11559),i=W(10902),l=W(10911),j=W(11007),k=W(10941);!function(V){V[V.Clean=0]="Clean",V[V.Stop=1]="Stop",V[V.Sync=2]="Sync",V[V.NoSync=3]="NoSync"}(N||(N={}));const u=new E.b,f={};let O=!1;function U(){return f[".babylon"]}function F(V){const p=f[V];return p||(Q.e.Warn("Unable to find a plugin to load "+V+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),U())}function C(V,p,W){let N="Unable to load from "+(V.rawData?"binary data":V.url);return p?N+=`: ${p}`:W&&(N+=`: ${W}`),N}function A(V,p,W,N,d,E,z,S,Q){var J;const l="data:"===(j=V.url).substring(0,5)?j.substring(5):null;var j;if(V.rawData&&!z)throw"When using ArrayBufferView to load data the file extension must be provided.";const O=z?F(z):l?function(V){for(const p in f){const W=f[p].plugin;if(W.canDirectLoad&&W.canDirectLoad(V))return f[p]}return U()}(V.url):function(V){const p=V.indexOf("?");-1!==p&&(V=V.substring(0,p));const W=V.lastIndexOf(".");return F(V.substring(W,V.length).toLowerCase())}(V.url);if(!O)throw new Error(`No plugin or fallback for ${z??V.url}`);if(!1===(null===Q||void 0===Q||null===(J=Q[O.plugin.name])||void 0===J?void 0:J.enabled))throw new Error(`The '${O.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(V.rawData&&!O.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(V=>{if(O.plugin.createPlugin){const p=O.plugin.createPlugin(Q??{});return p instanceof Promise?(p.then(V).catch((V=>{d("Error instantiating plugin.",V)})),null):(V(p),p)}return V(O.plugin),O.plugin})((Q=>{var J;if(!Q)throw`The loader plugin corresponding to the '${z}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(u.notifyObservers(Q),l&&(Q.canDirectLoad&&Q.canDirectLoad(V.url)||!(0,i.h)(V.url))){if(Q.directLoad){const V=Q.directLoad(p,l);V instanceof Promise?V.then((V=>{W(Q,V)})).catch((V=>{d("Error in directLoad of _loadData: "+V,V)})):W(Q,V)}else W(Q,l);return}const j=O.isBinary,f=(V,N)=>{p.u?d("Scene has been disposed"):W(Q,V,N)};let U=null,F=!1;null===(J=Q.$i)||void 0===J||J.add((()=>{F=!0,U&&(U.abort(),U=null),E()}));const C=()=>{if(F)return;const W=(V,p)=>{d(null===V||void 0===V?void 0:V.statusText,p)};if(!Q.loadFile&&V.rawData)throw"Plugin does not support loading ArrayBufferView.";U=Q.loadFile?Q.loadFile(p,V.rawData||V.file||V.url,V.rootUrl,f,N,j,W,S):p._loadFile(V.file||V.url,f,N,!0,j,W)},A=p.getEngine();let v=A.enableOfflineSupport;if(v){let W=!1;for(const N of p.disableOfflineSupportExceptionRules)if(N.test(V.url)){W=!0;break}v=!W}v&&k.d.OfflineProviderFactory?p.offlineProvider=k.d.OfflineProviderFactory(V.url,C,A.disableManifestCheck):C()}))}function v(V,p){let W,N,E=null,z=null;if(p)if(p.name)W=`file:${p.name}`,N=p.name,E=p;else if(ArrayBuffer.isView(p))W="",N=(0,j.b)(),z=p;else if(p.startsWith("data:"))W=p,N="";else if(V){const E=p;if("/"===E.substring(0,1))return d.e.Error("Wrong sceneFilename parameter"),null;W=V+E,N=E}else W=p,N=d.e.GetFilename(p),V=d.e.GetFolderPath(p);else W=V,N=d.e.GetFilename(V),V=d.e.GetFolderPath(V);return{url:W,rootUrl:V,name:N,file:E,rawData:z}}function t(V){if("string"===typeof V.extensions){const p=V.extensions;f[p.toLowerCase()]={plugin:V,isBinary:!1}}else{const p=V.extensions;Object.keys(p).forEach((W=>{f[W.toLowerCase()]={plugin:V,isBinary:p[W].isBinary}}))}}function e(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.d.LastCreatedScene,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!N)return Q.e.Error("No scene available to import mesh to"),null;const k=v(p,W);if(!k)return null;const u={};N.addPendingData(u);const f=()=>{N.removePendingData(u)},O=(V,p)=>{const W=C(k,V,p);z?z(N,W,new l.i(W,l.g.SceneLoaderError,p)):Q.e.Error(W),f()},U=E?V=>{try{E(V)}catch(p){O("Error in onProgress callback: "+p,p)}}:void 0,F=(V,p,W,E,z,S,Q,J)=>{if(N.importedMeshesFiles.push(k.url),d)try{d(V,p,W,E,z,S,Q,J)}catch(i){O("Error in onSuccess callback: "+i,i)}N.removePendingData(u)};return A(k,N,((p,W,d)=>{if(p.rewriteRootURL&&(k.rootUrl=p.rewriteRootURL(k.rootUrl,d)),p.importMesh){const d=[],E=[],z=[];if(!p.importMesh(V,N,W,k.rootUrl,d,E,z,O))return;N.loadingPluginName=p.name,F(d,E,z,[],[],[],[],[])}else{p.importMeshAsync(V,N,W,k.rootUrl,U,k.name).then((V=>{N.loadingPluginName=p.name,F(V.meshes,V.fj,V.skeletons,V.animationGroups,V.transformNodes,V.geometries,V.lights,V.spriteManagers)})).catch((V=>{O(V.message,V)}))}}),U,O,f,J,i,j)}function Z(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.d.LastCreatedEngine,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return W?K(V,p,new z.e(W),N,E,Q,J,i,l):(d.e.Error("No engine available"),null)}function o(V,p,W,N,d,E,z){return new Promise(((S,Q)=>{Z(V,p,W,(V=>{S(V)}),N,((V,p,W)=>{Q(W||new Error(p))}),d,E,z)}))}function K(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.d.LastCreatedScene,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!W)return Q.e.Error("No scene available to append to"),null;const k=v(V,p);if(!k)return null;const u={};W.addPendingData(u);const f=()=>{W.removePendingData(u)};J.d.ShowLoadingScreen&&!O&&(O=!0,W.getEngine().displayLoadingUI(),W.executeWhenReady((()=>{W.getEngine().hideLoadingUI(),O=!1})));const U=(V,p)=>{const N=C(k,V,p);E?E(W,N,new l.i(N,l.g.SceneLoaderError,p)):Q.e.Error(N),f()},F=d?V=>{try{d(V)}catch(p){U("Error in onProgress callback",p)}}:void 0,t=()=>{if(N)try{N(W)}catch(V){U("Error in onSuccess callback",V)}W.removePendingData(u)};return A(k,W,((V,p)=>{if(V.load){if(!V.load(W,p,k.rootUrl,U))return;W.loadingPluginName=V.name,t()}else{V.loadAsync(W,p,k.rootUrl,F,k.name).then((()=>{W.loadingPluginName=V.name,t()})).catch((V=>{U(V.message,V)}))}}),F,U,f,z,i,j)}function h(V,p,W,N,d,E,z){return new Promise(((S,Q)=>{K(V,p,W,(V=>{S(V)}),N,((V,p,W)=>{Q(W||new Error(p))}),d,E,z)}))}function L(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.d.LastCreatedScene,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!W)return Q.e.Error("No scene available to load asset container to"),null;const j=v(V,p);if(!j)return null;const k={};W.addPendingData(k);const u=()=>{W.removePendingData(k)},f=(V,p)=>{const N=C(j,V,p);E?E(W,N,new l.i(N,l.g.SceneLoaderError,p)):Q.e.Error(N),u()},O=d?V=>{try{d(V)}catch(p){f("Error in onProgress callback",p)}}:void 0,U=V=>{if(N)try{N(V)}catch(p){f("Error in onSuccess callback",p)}W.removePendingData(k)};return A(j,W,((V,p)=>{if(V.loadAssetContainer){const N=V.loadAssetContainer(W,p,j.rootUrl,f);if(!N)return;N.populateRootNodes(),W.loadingPluginName=V.name,U(N)}else if(V.loadAssetContainerAsync){V.loadAssetContainerAsync(W,p,j.rootUrl,O,j.name).then((p=>{p.populateRootNodes(),W.loadingPluginName=V.name,U(p)})).catch((V=>{f(V.message,V)}))}else f("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),O,f,u,z,J,i)}function x(V,p,W,N,d,E,z){return new Promise(((S,Q)=>{L(V,p,W,(V=>{S(V)}),N,((V,p,W)=>{Q(W||new Error(p))}),d,E,z)}))}function T(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.d.LastCreatedScene,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,j=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",k=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!W)return void Q.e.Error("No scene available to load animations to");if(N){for(const V of W.animatables)V.reset();W.stopAllAnimations(),W.animationGroups.slice().forEach((V=>{V.dispose()}));W.getNodes().forEach((V=>{V.animations&&(V.animations=[])}))}else switch(d){case 0:W.animationGroups.slice().forEach((V=>{V.dispose()}));break;case 1:W.animationGroups.forEach((V=>{V.stop()}));break;case 2:W.animationGroups.forEach((V=>{V.reset(),V.restart()}));break;case 3:break;default:return void Q.e.Error("Unknown animation group loading mode value '"+d+"'")}const u=W.animatables.length;L(V,p,W,(V=>{V.mergeAnimationsTo(W,W.animatables.slice(u),E),V.dispose(),W.onAnimationFileImportedObservable.notifyObservers(W),z&&z(W)}),J,i,l,j,k)}function P(V,p,W,N,d,E,z,S,Q,J){return new Promise(((i,l)=>{T(V,p,W,N,d,E,(V=>{i(V)}),z,((V,p,W)=>{l(W||new Error(p))}),S,Q,J)}))}class b{static get ForceFullSceneLoadingForIncremental(){return J.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(V){J.d.ForceFullSceneLoadingForIncremental=V}static get ShowLoadingScreen(){return J.d.ShowLoadingScreen}static set ShowLoadingScreen(V){J.d.ShowLoadingScreen=V}static get loggingLevel(){return J.d.loggingLevel}static set loggingLevel(V){J.d.loggingLevel=V}static get CleanBoneMatrixWeights(){return J.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(V){J.d.CleanBoneMatrixWeights=V}static GetDefaultPlugin(){return U()}static GetPluginForExtension(V){var p;return null===(p=F(V))||void 0===p?void 0:p.plugin}static IsPluginForExtensionAvailable(V){return function(V){return!!f[V]}(V)}static RegisterPlugin(V){t(V)}static ImportMesh(V,p,W,N,d,E,z,S,Q){return e(V,p,W,N,d,E,z,S,Q)}static ImportMeshAsync(V,p,W,N,d,E,z){return function(V,p,W,N,d,E,z,S){return new Promise(((Q,J)=>{e(V,p,W,N,((V,p,W,N,d,E,z,S)=>{Q({meshes:V,fj:p,skeletons:W,animationGroups:N,transformNodes:d,geometries:E,lights:z,spriteManagers:S})}),d,((V,p,W)=>{J(W||new Error(p))}),E,z,S)}))}(V,p,W,N,d,E,z)}static Load(V,p,W,N,d,E,z,S){return Z(V,p,W,N,d,E,z,S)}static LoadAsync(V,p,W,N,d,E){return o(V,p,W,N,d,E)}static Append(V,p,W,N,d,E,z,S){return K(V,p,W,N,d,E,z,S)}static AppendAsync(V,p,W,N,d,E){return h(V,p,W,N,d,E)}static LoadAssetContainer(V,p,W,N,d,E,z,S){return L(V,p,W,N,d,E,z,S)}static LoadAssetContainerAsync(V,p,W,N,d,E){return x(V,p,W,N,d,E)}static ImportAnimations(V,p,W,N,d,E,z,S,Q,J,i){T(V,p,W,N,d,E,z,S,Q,J,i)}static ImportAnimationsAsync(V,p,W,N,d,E,z,S,Q,J,i){return P(V,p,W,N,d,E,S,J,i)}}b.NO_LOGGING=0,b.MINIMAL_LOGGING=1,b.SUMMARY_LOGGING=2,b.DETAILED_LOGGING=3,b.OnPluginActivatedObservable=u},11559:(V,p,W)=>{"use strict";W.d(p,{d:()=>N});class N{static get ForceFullSceneLoadingForIncremental(){return N._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(V){N._ForceFullSceneLoadingForIncremental=V}static get ShowLoadingScreen(){return N._ShowLoadingScreen}static set ShowLoadingScreen(V){N._ShowLoadingScreen=V}static get loggingLevel(){return N._LoggingLevel}static set loggingLevel(V){N._LoggingLevel=V}static get CleanBoneMatrixWeights(){return N._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(V){N._CleanBoneMatrixWeights=V}}N._ForceFullSceneLoadingForIncremental=!1,N._ShowLoadingScreen=!0,N._CleanBoneMatrixWeights=!1,N._LoggingLevel=0},12511:(V,p,W)=>{"use strict";W.d(p,{b:()=>Y});var N=W(11167),d=W(11175),E=W(10870),z=W(11191),S=W(12502),Q=W(11200),J=W(11218),i=W(11291),l=W(11442),j=W(11496);class k extends l.c{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class u extends j.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRBRDF",90,new k,p),this._useEnergyConservation=u.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=u.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=u.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=u.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=u.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=u.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=u.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=u.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=V._dirtyCallbacks[16],this._enable(!0)}prepareDefines(V){V.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,V.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,V.SPHERICAL_HARMONICS=this._useSphericalHarmonics,V.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}u.DEFAULT_USE_ENERGY_CONSERVATION=!0,u.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,u.DEFAULT_USE_SPHERICAL_HARMONICS=!0,u.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsMiscDirty")],u.prototype,"useEnergyConservation",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsMiscDirty")],u.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsMiscDirty")],u.prototype,"useSphericalHarmonics",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsMiscDirty")],u.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var f=W(11378),O=W(11257),U=W(11251),F=W(11387),C=W(11445),A=W(11452),v=W(11470),t=(W(12520),W(11479)),e=W(11434);class Z extends l.c{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class o extends j.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRClearCoat",100,new Z,p),this._isEnabled=!1,this.isEnabled=!1,this.Pi=1,this.roughness=0,this._indexOfRefraction=o._DefaultIndexOfRefraction,this.indexOfRefraction=o._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=O.c.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1]}isReadyForSubMesh(V,p,W){if(!this._isEnabled)return!0;const N=this._material._disableBumpMap;if(V._areTexturesDirty&&p.texturesEnabled){if(this._texture&&v.c.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&v.c.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(W.getCaps().standardDerivatives&&this._bumpTexture&&v.c.ClearCoatBumpTextureEnabled&&!N&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&v.c.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(V,p){this._isEnabled?(V.CLEARCOAT=!0,V.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,V.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,V._areTexturesDirty&&p.texturesEnabled&&(this._texture&&v.c.ClearCoatTextureEnabled?(0,e.M)(this._texture,V,"CLEARCOAT_TEXTURE"):V.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&v.c.ClearCoatTextureEnabled?(0,e.M)(this._textureRoughness,V,"CLEARCOAT_TEXTURE_ROUGHNESS"):V.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&v.c.ClearCoatBumpTextureEnabled?(0,e.M)(this._bumpTexture,V,"CLEARCOAT_BUMP"):V.CLEARCOAT_BUMP=!1,V.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===o._DefaultIndexOfRefraction,this._isTintEnabled?(V.CLEARCOAT_TINT=!0,this._tintTexture&&v.c.ClearCoatTintTextureEnabled?((0,e.M)(this._tintTexture,V,"CLEARCOAT_TINT_TEXTURE"),V.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):V.CLEARCOAT_TINT_TEXTURE=!1):(V.CLEARCOAT_TINT=!1,V.CLEARCOAT_TINT_TEXTURE=!1))):(V.CLEARCOAT=!1,V.CLEARCOAT_TEXTURE=!1,V.CLEARCOAT_TEXTURE_ROUGHNESS=!1,V.CLEARCOAT_BUMP=!1,V.CLEARCOAT_TINT=!1,V.CLEARCOAT_TINT_TEXTURE=!1,V.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,V.CLEARCOAT_DEFAULTIOR=!1,V.CLEARCOAT_TEXTUREDIRECTUV=0,V.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,V.CLEARCOAT_BUMPDIRECTUV=0,V.CLEARCOAT_REMAP_F0=!1,V.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,V.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(V,p,W,N){if(!this._isEnabled)return;const d=N.materialDefines,E=this._material.isFrozen,z=this._material._disableBumpMap,S=this._material._invertNormalMapX,Q=this._material._invertNormalMapY;if(!V.useUbo||!E||!V.isSync){var J,i,l,j;if((this._texture||this._textureRoughness)&&v.c.ClearCoatTextureEnabled)V.updateFloat4("vClearCoatInfos",(null===(J=this._texture)||void 0===J?void 0:J.coordinatesIndex)??0,(null===(i=this._texture)||void 0===i?void 0:i.level)??0,(null===(l=this._textureRoughness)||void 0===l?void 0:l.coordinatesIndex)??0,(null===(j=this._textureRoughness)||void 0===j?void 0:j.level)??0),this._texture&&(0,e.t)(this._texture,V,"clearCoat"),this._textureRoughness&&!d.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,e.t)(this._textureRoughness,V,"clearCoatRoughness");this._bumpTexture&&W.getCaps().standardDerivatives&&v.c.ClearCoatTextureEnabled&&!z&&(V.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,e.t)(this._bumpTexture,V,"clearCoatBump"),p._mirroredCameraPosition?V.updateFloat2("vClearCoatTangentSpaceParams",S?1:-1,Q?1:-1):V.updateFloat2("vClearCoatTangentSpaceParams",S?-1:1,Q?-1:1)),this._tintTexture&&v.c.ClearCoatTintTextureEnabled&&(V.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,e.t)(this._tintTexture,V,"clearCoatTint")),V.updateFloat2("vClearCoatParams",this.Pi,this.roughness);const N=1-this._indexOfRefraction,E=1+this._indexOfRefraction,k=Math.pow(-N/E,2),u=1/this._indexOfRefraction;V.updateFloat4("vClearCoatRefractionParams",k,u,N,E),this._isTintEnabled&&(V.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),V.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}p.texturesEnabled&&(this._texture&&v.c.ClearCoatTextureEnabled&&V.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!d.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&v.c.ClearCoatTextureEnabled&&V.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&W.getCaps().standardDerivatives&&v.c.ClearCoatBumpTextureEnabled&&!z&&V.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&v.c.ClearCoatTintTextureEnabled&&V.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(V){return this._texture===V||(this._textureRoughness===V||(this._bumpTexture===V||this._tintTexture===V))}getActiveTextures(V){this._texture&&V.push(this._texture),this._textureRoughness&&V.push(this._textureRoughness),this._bumpTexture&&V.push(this._bumpTexture),this._tintTexture&&V.push(this._tintTexture)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&V.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&V.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&V.push(this._tintTexture)}dispose(V){var p,W,N,d;V&&(null===(p=this._texture)||void 0===p||p.dispose(),null===(W=this._textureRoughness)||void 0===W||W.dispose(),null===(N=this._bumpTexture)||void 0===N||N.dispose(),null===(d=this._tintTexture)||void 0===d||d.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(V,p,W){return V.CLEARCOAT_BUMP&&p.addFallback(W++,"CLEARCOAT_BUMP"),V.CLEARCOAT_TINT&&p.addFallback(W++,"CLEARCOAT_TINT"),V.CLEARCOAT&&p.addFallback(W++,"CLEARCOAT"),W}getSamplers(V){V.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}o._DefaultIndexOfRefraction=1.5,(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"isEnabled",void 0),(0,N.c)([(0,d.I)()],o.prototype,"intensity",void 0),(0,N.c)([(0,d.I)()],o.prototype,"roughness",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"indexOfRefraction",void 0),(0,N.c)([(0,d.A)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"texture",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useRoughnessFromMainTexture",void 0),(0,N.c)([(0,d.A)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"textureRoughness",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"remapF0OnInterfaceChange",void 0),(0,N.c)([(0,d.A)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"bumpTexture",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"isTintEnabled",void 0),(0,N.c)([(0,d.k)()],o.prototype,"tintColor",void 0),(0,N.c)([(0,d.I)()],o.prototype,"tintColorAtDistance",void 0),(0,N.c)([(0,d.I)()],o.prototype,"tintThickness",void 0),(0,N.c)([(0,d.A)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"tintTexture",void 0);class K extends l.c{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class h extends j.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRIridescence",110,new K,p),this._isEnabled=!1,this.isEnabled=!1,this.Pi=1,this.minimumThickness=h._DefaultMinimumThickness,this.maximumThickness=h._DefaultMaximumThickness,this.indexOfRefraction=h._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1]}isReadyForSubMesh(V,p){if(!this._isEnabled)return!0;if(V._areTexturesDirty&&p.texturesEnabled){if(this._texture&&v.c.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&v.c.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(V,p){this._isEnabled?(V.IRIDESCENCE=!0,V._areTexturesDirty&&p.texturesEnabled&&(this._texture&&v.c.IridescenceTextureEnabled?(0,e.M)(this._texture,V,"IRIDESCENCE_TEXTURE"):V.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&v.c.IridescenceTextureEnabled?(0,e.M)(this._thicknessTexture,V,"IRIDESCENCE_THICKNESS_TEXTURE"):V.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(V.IRIDESCENCE=!1,V.IRIDESCENCE_TEXTURE=!1,V.IRIDESCENCE_THICKNESS_TEXTURE=!1,V.IRIDESCENCE_TEXTUREDIRECTUV=0,V.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(V,p){if(!this._isEnabled)return;const W=this._material.isFrozen;if(!V.useUbo||!W||!V.isSync){var N,d,E,z;if((this._texture||this._thicknessTexture)&&v.c.IridescenceTextureEnabled)V.updateFloat4("vIridescenceInfos",(null===(N=this._texture)||void 0===N?void 0:N.coordinatesIndex)??0,(null===(d=this._texture)||void 0===d?void 0:d.level)??0,(null===(E=this._thicknessTexture)||void 0===E?void 0:E.coordinatesIndex)??0,(null===(z=this._thicknessTexture)||void 0===z?void 0:z.level)??0),this._texture&&(0,e.t)(this._texture,V,"iridescence"),this._thicknessTexture&&(0,e.t)(this._thicknessTexture,V,"iridescenceThickness");V.updateFloat4("vIridescenceParams",this.Pi,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}p.texturesEnabled&&(this._texture&&v.c.IridescenceTextureEnabled&&V.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&v.c.IridescenceTextureEnabled&&V.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(V){return this._texture===V||this._thicknessTexture===V}getActiveTextures(V){this._texture&&V.push(this._texture),this._thicknessTexture&&V.push(this._thicknessTexture)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&V.push(this._thicknessTexture)}dispose(V){var p,W;V&&(null===(p=this._texture)||void 0===p||p.dispose(),null===(W=this._thicknessTexture)||void 0===W||W.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(V,p,W){return V.IRIDESCENCE&&p.addFallback(W++,"IRIDESCENCE"),W}getSamplers(V){V.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}h._DefaultMinimumThickness=100,h._DefaultMaximumThickness=400,h._DefaultIndexOfRefraction=1.3,(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"isEnabled",void 0),(0,N.c)([(0,d.I)()],h.prototype,"intensity",void 0),(0,N.c)([(0,d.I)()],h.prototype,"minimumThickness",void 0),(0,N.c)([(0,d.I)()],h.prototype,"maximumThickness",void 0),(0,N.c)([(0,d.I)()],h.prototype,"indexOfRefraction",void 0),(0,N.c)([(0,d.A)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"texture",void 0),(0,N.c)([(0,d.A)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"thicknessTexture",void 0);class L extends l.c{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class x extends j.c{set angle(V){this.direction.x=Math.cos(V),this.direction.y=Math.sin(V)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRAnisotropic",110,new L,p),this._isEnabled=!1,this.isEnabled=!1,this.Pi=1,this.direction=new J.k(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=V._dirtyCallbacks[16]}isReadyForSubMesh(V,p){return!this._isEnabled||!(V._areTexturesDirty&&p.texturesEnabled&&this._texture&&v.c.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(V,p,W){this._isEnabled?(V.ANISOTROPIC=this._isEnabled,this._isEnabled&&!W.isVerticesDataPresent(i.f.TangentKind)&&(V._needUVs=!0,V.MAINUV1=!0),V._areTexturesDirty&&p.texturesEnabled&&(this._texture&&v.c.AnisotropicTextureEnabled?(0,e.M)(this._texture,V,"ANISOTROPIC_TEXTURE"):V.ANISOTROPIC_TEXTURE=!1),V._areMiscDirty&&(V.ANISOTROPIC_LEGACY=this._legacy)):(V.ANISOTROPIC=!1,V.ANISOTROPIC_TEXTURE=!1,V.ANISOTROPIC_TEXTUREDIRECTUV=0,V.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(V,p){if(!this._isEnabled)return;const W=this._material.isFrozen;V.useUbo&&W&&V.isSync||(this._texture&&v.c.AnisotropicTextureEnabled&&(V.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,e.t)(this._texture,V,"anisotropy")),V.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Pi)),p.texturesEnabled&&this._texture&&v.c.AnisotropicTextureEnabled&&V.setTexture("anisotropySampler",this._texture)}hasTexture(V){return this._texture===V}getActiveTextures(V){this._texture&&V.push(this._texture)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture)}dispose(V){V&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(V,p,W){return V.ANISOTROPIC&&p.addFallback(W++,"ANISOTROPIC"),W}getSamplers(V){V.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(V,p,W){super.parse(V,p,W),void 0===V.legacy&&(this.legacy=!0)}}(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"isEnabled",void 0),(0,N.c)([(0,d.I)()],x.prototype,"intensity",void 0),(0,N.c)([(0,d.D)()],x.prototype,"direction",void 0),(0,N.c)([(0,d.A)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"texture",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsMiscDirty")],x.prototype,"legacy",void 0);class T extends l.c{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class P extends j.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"Sheen",120,new T,p),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Pi=1,this.color=O.c.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1]}isReadyForSubMesh(V,p){if(!this._isEnabled)return!0;if(V._areTexturesDirty&&p.texturesEnabled){if(this._texture&&v.c.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&v.c.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(V,p){this._isEnabled?(V.SHEEN=!0,V.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,V.SHEEN_ROUGHNESS=null!==this._roughness,V.SHEEN_ALBEDOSCALING=this._albedoScaling,V.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,V._areTexturesDirty&&p.texturesEnabled&&(this._texture&&v.c.SheenTextureEnabled?((0,e.M)(this._texture,V,"SHEEN_TEXTURE"),V.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):V.SHEEN_TEXTURE=!1,this._textureRoughness&&v.c.SheenTextureEnabled?(0,e.M)(this._textureRoughness,V,"SHEEN_TEXTURE_ROUGHNESS"):V.SHEEN_TEXTURE_ROUGHNESS=!1)):(V.SHEEN=!1,V.SHEEN_TEXTURE=!1,V.SHEEN_TEXTURE_ROUGHNESS=!1,V.SHEEN_LINKWITHALBEDO=!1,V.SHEEN_ROUGHNESS=!1,V.SHEEN_ALBEDOSCALING=!1,V.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,V.SHEEN_GAMMATEXTURE=!1,V.SHEEN_TEXTUREDIRECTUV=0,V.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(V,p,W,N){if(!this._isEnabled)return;const d=N.materialDefines,E=this._material.isFrozen;if(!V.useUbo||!E||!V.isSync){var z,S,Q,J;if((this._texture||this._textureRoughness)&&v.c.SheenTextureEnabled)V.updateFloat4("vSheenInfos",(null===(z=this._texture)||void 0===z?void 0:z.coordinatesIndex)??0,(null===(S=this._texture)||void 0===S?void 0:S.level)??0,(null===(Q=this._textureRoughness)||void 0===Q?void 0:Q.coordinatesIndex)??0,(null===(J=this._textureRoughness)||void 0===J?void 0:J.level)??0),this._texture&&(0,e.t)(this._texture,V,"sheen"),this._textureRoughness&&!d.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,e.t)(this._textureRoughness,V,"sheenRoughness");V.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Pi),null!==this._roughness&&V.updateFloat("vSheenRoughness",this._roughness)}p.texturesEnabled&&(this._texture&&v.c.SheenTextureEnabled&&V.setTexture("sheenSampler",this._texture),this._textureRoughness&&!d.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&v.c.SheenTextureEnabled&&V.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(V){return this._texture===V||this._textureRoughness===V}getActiveTextures(V){this._texture&&V.push(this._texture),this._textureRoughness&&V.push(this._textureRoughness)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&V.push(this._textureRoughness)}dispose(V){var p,W;V&&(null===(p=this._texture)||void 0===p||p.dispose(),null===(W=this._textureRoughness)||void 0===W||W.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(V,p,W){return V.SHEEN&&p.addFallback(W++,"SHEEN"),W}getSamplers(V){V.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isEnabled",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"linkSheenWithAlbedo",void 0),(0,N.c)([(0,d.I)()],P.prototype,"intensity",void 0),(0,N.c)([(0,d.k)()],P.prototype,"color",void 0),(0,N.c)([(0,d.A)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"texture",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"useRoughnessFromMainTexture",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"roughness",void 0),(0,N.c)([(0,d.A)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"textureRoughness",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"albedoScaling",void 0);class b extends l.c{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class s extends j.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(V){this._scene.enableSubSurfaceForPrePass()&&V&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(V))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(V){this._volumeIndexOfRefraction=V>=1?V:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"PBRSubSurface",130,new b,p),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=O.c.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=O.c.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=V.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=V._dirtyCallbacks[32]}isReadyForSubMesh(V,p){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(V._areTexturesDirty&&p.texturesEnabled){if(this._thicknessTexture&&v.c.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&v.c.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&v.c.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const V=this._getRefractionTexture(p);if(V&&v.c.RefractionTextureEnabled&&!V.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(V,p){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return V.SUBSURFACE=!1,V.SS_DISPERSION=!1,V.SS_TRANSLUCENCY=!1,V.SS_SCATTERING=!1,V.SS_REFRACTION=!1,V.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,V.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,V.SS_THICKNESSANDMASK_TEXTURE=!1,V.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,V.SS_HAS_THICKNESS=!1,V.SS_REFRACTIONINTENSITY_TEXTURE=!1,V.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,V.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,V.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,V.SS_REFRACTIONMAP_3D=!1,V.SS_REFRACTIONMAP_OPPOSITEZ=!1,V.SS_LODINREFRACTIONALPHA=!1,V.SS_GAMMAREFRACTION=!1,V.SS_RGBDREFRACTION=!1,V.SS_LINEARSPECULARREFRACTION=!1,V.SS_LINKREFRACTIONTOTRANSPARENCY=!1,V.SS_ALBEDOFORREFRACTIONTINT=!1,V.SS_ALBEDOFORTRANSLUCENCYTINT=!1,V.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,V.SS_USE_THICKNESS_AS_DEPTH=!1,V.SS_USE_GLTF_TEXTURES=!1,V.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(V.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(V._areTexturesDirty){if(V.SUBSURFACE=!0,V.SS_DISPERSION=this._isDispersionEnabled,V.SS_TRANSLUCENCY=this._isTranslucencyEnabled,V.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,V.SS_SCATTERING=this._isScatteringEnabled,V.SS_THICKNESSANDMASK_TEXTURE=!1,V.SS_REFRACTIONINTENSITY_TEXTURE=!1,V.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,V.SS_HAS_THICKNESS=!1,V.SS_USE_GLTF_TEXTURES=!1,V.SS_REFRACTION=!1,V.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,V.SS_REFRACTIONMAP_3D=!1,V.SS_GAMMAREFRACTION=!1,V.SS_RGBDREFRACTION=!1,V.SS_LINEARSPECULARREFRACTION=!1,V.SS_REFRACTIONMAP_OPPOSITEZ=!1,V.SS_LODINREFRACTIONALPHA=!1,V.SS_LINKREFRACTIONTOTRANSPARENCY=!1,V.SS_ALBEDOFORREFRACTIONTINT=!1,V.SS_ALBEDOFORTRANSLUCENCYTINT=!1,V.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,V.SS_USE_THICKNESS_AS_DEPTH=!1,V.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,V._areTexturesDirty&&p.texturesEnabled&&(this._thicknessTexture&&v.c.ThicknessTextureEnabled&&(0,e.M)(this._thicknessTexture,V,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&v.c.RefractionIntensityTextureEnabled&&(0,e.M)(this._refractionIntensityTexture,V,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&v.c.TranslucencyIntensityTextureEnabled&&(0,e.M)(this._translucencyIntensityTexture,V,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&v.c.TranslucencyColorTextureEnabled&&(0,e.M)(this._translucencyColorTexture,V,"SS_TRANSLUCENCYCOLOR_TEXTURE")),V.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,V.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,V.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,V.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&p.texturesEnabled){const W=this._getRefractionTexture(p);W&&v.c.RefractionTextureEnabled&&(V.SS_REFRACTION=!0,V.SS_REFRACTIONMAP_3D=W.isCube,V.SS_GAMMAREFRACTION=W.gammaSpace,V.SS_RGBDREFRACTION=W.isRGBD,V.SS_LINEARSPECULARREFRACTION=W.linearSpecularLOD,V.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&W.isCube?!W.invertZ:W.invertZ,V.SS_LODINREFRACTIONALPHA=W.lodLevelInAlpha,V.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,V.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,V.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=W.isCube&&W.boundingBoxSize,V.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(V.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(V,p,W,N){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)V.updateFloat2("vThicknessParam",0,0);else{N.getRenderingMesh().getWorldMatrix().decompose(J.i.fb[0]);const p=Math.max(Math.abs(J.i.fb[0].x),Math.abs(J.i.fb[0].y),Math.abs(J.i.fb[0].z));V.updateFloat2("vThicknessParam",this.minimumThickness*p,(this.maximumThickness-this.minimumThickness)*p)}}bindForSubMesh(V,p,W,N){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const d=N.materialDefines,E=this._material.isFrozen,z=this._material.realTimeFiltering,S=d.LODBASEDMICROSFURACE,Q=this._getRefractionTexture(p);if(!V.useUbo||!E||!V.isSync){if(this._thicknessTexture&&v.c.ThicknessTextureEnabled&&(V.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,e.t)(this._thicknessTexture,V,"thickness")),this._refractionIntensityTexture&&v.c.RefractionIntensityTextureEnabled&&d.SS_REFRACTIONINTENSITY_TEXTURE&&(V.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,e.t)(this._refractionIntensityTexture,V,"refractionIntensity")),this._translucencyColorTexture&&v.c.TranslucencyColorTextureEnabled&&d.SS_TRANSLUCENCYCOLOR_TEXTURE&&(V.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,e.t)(this._translucencyColorTexture,V,"translucencyColor")),this._translucencyIntensityTexture&&v.c.TranslucencyIntensityTextureEnabled&&d.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(V.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,e.t)(this._translucencyIntensityTexture,V,"translucencyIntensity")),Q&&v.c.RefractionTextureEnabled){V.wj("refractionMatrix",Q.getRefractionTextureMatrix());let p=1;Q.isCube||Q.depth&&(p=Q.depth);const W=Q.getSize().width,N=this.volumeIndexOfRefraction;if(V.updateFloat4("vRefractionInfos",Q.level,1/N,p,this._invertRefractionY?-1:1),V.updateFloat4("vRefractionMicrosurfaceInfos",W,Q.lodGenerationScale,Q.lodGenerationOffset,1/this.indexOfRefraction),z&&V.updateFloat2("vRefractionFilteringInfo",W,Math.log2(W)),Q.boundingBoxSize){const p=Q;V.updateVector3("vRefractionPosition",p.boundingBoxPosition),V.updateVector3("vRefractionSize",p.boundingBoxSize)}}this._isScatteringEnabled&&V.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),V.updateColor3("vDiffusionDistance",this.diffusionDistance),V.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),V.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),V.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),V.updateFloat("dispersion",this.dispersion)}p.texturesEnabled&&(this._thicknessTexture&&v.c.ThicknessTextureEnabled&&V.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&v.c.RefractionIntensityTextureEnabled&&d.SS_REFRACTIONINTENSITY_TEXTURE&&V.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&v.c.TranslucencyIntensityTextureEnabled&&d.SS_TRANSLUCENCYINTENSITY_TEXTURE&&V.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&v.c.TranslucencyColorTextureEnabled&&d.SS_TRANSLUCENCYCOLOR_TEXTURE&&V.setTexture("translucencyColorSampler",this._translucencyColorTexture),Q&&v.c.RefractionTextureEnabled&&(S?V.setTexture("refractionSampler",Q):(V.setTexture("refractionSampler",Q._lodTextureMid||Q),V.setTexture("refractionSamplerLow",Q._lodTextureLow||Q),V.setTexture("refractionSamplerHigh",Q._lodTextureHigh||Q))))}_getRefractionTexture(V){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?V.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(V){v.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&V.push(this._refractionTexture)}hasTexture(V){return this._thicknessTexture===V||(this._refractionTexture===V||(this._refractionIntensityTexture===V||(this._translucencyIntensityTexture===V||this._translucencyColorTexture===V)))}hasRenderTargetTextures(){return!!(v.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(V){this._thicknessTexture&&V.push(this._thicknessTexture),this._refractionTexture&&V.push(this._refractionTexture),this._translucencyColorTexture&&V.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&V.push(this._translucencyIntensityTexture)}getAnimatables(V){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&V.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&V.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&V.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&V.push(this._translucencyIntensityTexture)}dispose(V){V&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(V,p,W){return V.SS_SCATTERING&&p.addFallback(W++,"SS_SCATTERING"),V.SS_TRANSLUCENCY&&p.addFallback(W++,"SS_TRANSLUCENCY"),W}getSamplers(V){V.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"isRefractionEnabled",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"isTranslucencyEnabled",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"isDispersionEnabled",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markScenePrePassDirty")],s.prototype,"isScatteringEnabled",void 0),(0,N.c)([(0,d.I)()],s.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,N.c)([(0,d.I)()],s.prototype,"refractionIntensity",void 0),(0,N.c)([(0,d.I)()],s.prototype,"translucencyIntensity",void 0),(0,N.c)([(0,d.I)()],s.prototype,"useAlbedoToTintRefraction",void 0),(0,N.c)([(0,d.I)()],s.prototype,"useAlbedoToTintTranslucency",void 0),(0,N.c)([(0,d.A)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"thicknessTexture",void 0),(0,N.c)([(0,d.A)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"refractionTexture",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"indexOfRefraction",void 0),(0,N.c)([(0,d.I)()],s.prototype,"_volumeIndexOfRefraction",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"volumeIndexOfRefraction",null),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"invertRefractionY",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"linkRefractionWithTransparency",void 0),(0,N.c)([(0,d.I)()],s.prototype,"minimumThickness",void 0),(0,N.c)([(0,d.I)()],s.prototype,"maximumThickness",void 0),(0,N.c)([(0,d.I)()],s.prototype,"useThicknessAsDepth",void 0),(0,N.c)([(0,d.k)()],s.prototype,"tintColor",void 0),(0,N.c)([(0,d.I)()],s.prototype,"tintColorAtDistance",void 0),(0,N.c)([(0,d.I)()],s.prototype,"dispersion",void 0),(0,N.c)([(0,d.k)()],s.prototype,"diffusionDistance",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useMaskFromThicknessTexture",void 0),(0,N.c)([(0,d.A)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"refractionIntensityTexture",void 0),(0,N.c)([(0,d.A)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"translucencyIntensityTexture",void 0),(0,N.c)([(0,d.k)()],s.prototype,"translucencyColor",void 0),(0,N.c)([(0,d.A)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"translucencyColorTexture",void 0),(0,N.c)([(0,d.I)(),(0,d.d)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useGltfStyleTextures",void 0);var G=W(11488),R=W(11436),X=W(11501);const r={effect:null,subMesh:null};class B extends l.c{constructor(V){super(V),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class Y extends C.b{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(V){this._realTimeFiltering=V,this.Jg(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(V){this._realTimeFilteringQuality=V,this.Jg(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(V){V!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=V||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(V,p){super(V,p,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||Y.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new J.q(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=Y.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=O.c.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new O.c(0,0,0),this._albedoColor=new O.c(1,1,1),this._reflectivityColor=new O.c(1,1,1),this._reflectionColor=new O.c(1,1,1),this._emissiveColor=new O.c(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=Y.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new z.f(16),this._globalAmbientColor=new O.c(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new u(this),this.clearCoat=new o(this),this.iridescence=new h(this),this.anisotropy=new x(this),this.sheen=new P(this),this.subSurface=new s(this),this.detailMap=new G.c(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),v.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,S.e)(this.va()),this.prePassConfiguration=new f.e}get hasRenderTargetTextures(){return!!(v.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var V;return this._transparencyMode===Y.PBRMATERIAL_OPAQUE||this._transparencyMode===Y.PBRMATERIAL_ALPHATEST||(null===(V=this.subSurface)||void 0===V?void 0:V.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var V;return!!this._forceAlphaTest||(null===(V=this.subSurface)||void 0===V||!V.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===Y.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.xe&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==Y.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.xe||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(V,p,W){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const N=p._drawWrapper;if(N.effect&&this.isFrozen&&N._wasPreviouslyReady&&N._wasPreviouslyUsingInstances===W)return!0;p.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),p.materialDefines=new B(this._eventInfo.defineNames));const d=p.materialDefines;if(this._isReadyForSubMesh(p))return!0;const z=this.va(),S=z.getEngine();if(d._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,z.texturesEnabled)){if(this._albedoTexture&&v.c.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&v.c.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&v.c.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const V=this._getReflectionTexture();if(V&&v.c.ReflectionTextureEnabled){if(!V.isReadyOrNotBlocking())return!1;var Q;if(V.irradianceTexture){if(!V.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!V.sphericalPolynomial&&null!==(Q=V.getInternalTexture())&&void 0!==Q&&Q._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&v.c.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&v.c.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(v.c.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(S.getCaps().standardDerivatives&&this._bumpTexture&&v.c.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&v.c.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=d,this._eventInfo.subMesh=p,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(d._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;S.getCaps().standardDerivatives||V.isVerticesDataPresent(i.f.NormalKind)||(V.createNormals(!0),E.e.Warn("PBRMaterial: Normals have been created for the mesh: "+V.name));const J=p.effect,l=d._areLightsDisposed;let j=this._prepareEffect(V,d,this.onCompiled,this.onError,W,null,p.getRenderingMesh().hasThinInstances),k=!1;if(j)if(this._onEffectCreatedObservable&&(r.effect=j,r.subMesh=p,this._onEffectCreatedObservable.notifyObservers(r)),this.allowShaderHotSwapping&&J&&!j.isReady()){if(j=J,d.markAsUnprocessed(),k=this.isFrozen,l)return d._areLightsDisposed=!0,!1}else z.resetCachedMaterial(),p.setEffect(j,d,this._materialContext);return!(!p.effect||!p.effect.isReady())&&(d._renderId=z.getRenderId(),N._wasPreviouslyReady=!k,N._wasPreviouslyUsingInstances=!!W,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(V,p){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(V,p,E,z,S),!p.isDirty)return null;p.markAsProcessed();const Q=this.va().getEngine(),J=new t.b;let l=0;p.USESPHERICALINVERTEX&&J.addFallback(l++,"USESPHERICALINVERTEX"),p.FOG&&J.addFallback(l,"FOG"),p.SPECULARAA&&J.addFallback(l,"SPECULARAA"),p.POINTSIZE&&J.addFallback(l,"POINTSIZE"),p.LOGARITHMICDEPTH&&J.addFallback(l,"LOGARITHMICDEPTH"),p.PARALLAX&&J.addFallback(l,"PARALLAX"),p.PARALLAX_RHS&&J.addFallback(l,"PARALLAX_RHS"),p.PARALLAXOCCLUSION&&J.addFallback(l++,"PARALLAXOCCLUSION"),p.ENVIRONMENTBRDF&&J.addFallback(l++,"ENVIRONMENTBRDF"),p.TANGENT&&J.addFallback(l++,"TANGENT"),p.BUMP&&J.addFallback(l++,"BUMP"),l=(0,e.w)(p,J,this._maxSimultaneousLights,l++),p.SPECULARTERM&&J.addFallback(l++,"SPECULARTERM"),p.USESPHERICALFROMREFLECTIONMAP&&J.addFallback(l++,"USESPHERICALFROMREFLECTIONMAP"),p.USEIRRADIANCEMAP&&J.addFallback(l++,"USEIRRADIANCEMAP"),p.LIGHTMAP&&J.addFallback(l++,"LIGHTMAP"),p.NORMAL&&J.addFallback(l++,"NORMAL"),p.AMBIENT&&J.addFallback(l++,"AMBIENT"),p.EMISSIVE&&J.addFallback(l++,"EMISSIVE"),p.VERTEXCOLOR&&J.addFallback(l++,"VERTEXCOLOR"),p.MORPHTARGETS&&J.addFallback(l++,"MORPHTARGETS"),p.MULTIVIEW&&J.addFallback(0,"MULTIVIEW");const j=[i.f.PositionKind];p.NORMAL&&j.push(i.f.NormalKind),p.TANGENT&&j.push(i.f.TangentKind);for(let W=1;W<=6;++W)p["UV"+W]&&j.push(`uv${1===W?"":W}`);p.VERTEXCOLOR&&j.push(i.f.ColorKind),(0,e.A)(j,V,p,J),(0,e.B)(j,p),(0,e.C)(j,V,p),(0,e.x)(j,V,p);let k="pbr";const u=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],O=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],F=["Material","Scene","Mesh"],C={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:p.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=J,this._eventInfo.fallbackRank=l,this._eventInfo.defines=p,this._eventInfo.uniforms=u,this._eventInfo.attributes=j,this._eventInfo.samplers=O,this._eventInfo.uniformBuffersNames=F,this._eventInfo.customCode=void 0,this._eventInfo.mesh=V,this._eventInfo.indexParameters=C,this._callbackPluginEventGeneric(128,this._eventInfo),X.e.AddUniformsAndSamplers(u,O),f.e.AddUniforms(u),f.e.AddSamplers(O),(0,R.b)(u),U.c&&(U.c.PrepareUniforms(u,p),U.c.PrepareSamplers(O,p)),(0,e._)({uniformsNames:u,uniformBuffersNames:F,samplers:O,defines:p,maxSimultaneousLights:this._maxSimultaneousLights});const A={};this.customShaderNameResolve&&(k=this.customShaderNameResolve(k,u,F,O,p,j,A));const v=p.toString(),Z=Q.createEffect(k,{attributes:j,uniformsNames:u,uniformBuffersNames:F,samplers:O,defines:v,fallbacks:J,onCompiled:N,onError:d,indexParameters:C,processFinalCode:A.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:p.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([W.e(21),W.e(43)]).then(W.bind(W,13788)),Promise.all([W.e(22),W.e(44)]).then(W.bind(W,13801))]):await Promise.all([Promise.all([W.e(25),W.e(45)]).then(W.bind(W,13810)),Promise.all([W.e(27),W.e(46)]).then(W.bind(W,13825))]),this._shadersLoaded=!0}},Q);return this._eventInfo.customCode=void 0,Z}_prepareDefines(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const E=this.va(),z=E.getEngine();(0,e.I)(E,V,p,!0,this._maxSimultaneousLights,this._disableLighting),p._needNormals=!0,(0,e.S)(E,p);const S=this.needAlphaBlendingForMesh(V)&&this.va().useOrderIndependentTransparency;if((0,e.Y)(E,p,this.canRenderToMRT&&!S),(0,e.W)(E,p,S),X.e.PrepareDefines(z.currentRenderPassId,V,p),p.METALLICWORKFLOW=this.isMetallicWorkflow(),p._areTexturesDirty){p._needUVs=!1;for(let V=1;V<=6;++V)p["MAINUV"+V]=!1;if(E.texturesEnabled){p.ALBEDODIRECTUV=0,p.AMBIENTDIRECTUV=0,p.OPACITYDIRECTUV=0,p.EMISSIVEDIRECTUV=0,p.REFLECTIVITYDIRECTUV=0,p.MICROSURFACEMAPDIRECTUV=0,p.METALLIC_REFLECTANCEDIRECTUV=0,p.REFLECTANCEDIRECTUV=0,p.BUMPDIRECTUV=0,p.LIGHTMAPDIRECTUV=0,z.getCaps().textureLOD&&(p.LODBASEDMICROSFURACE=!0),this._albedoTexture&&v.c.DiffuseTextureEnabled?((0,e.M)(this._albedoTexture,p,"ALBEDO"),p.GAMMAALBEDO=this._albedoTexture.gammaSpace):p.ALBEDO=!1,this._ambientTexture&&v.c.AmbientTextureEnabled?((0,e.M)(this._ambientTexture,p,"AMBIENT"),p.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):p.AMBIENT=!1,this._opacityTexture&&v.c.OpacityTextureEnabled?((0,e.M)(this._opacityTexture,p,"OPACITY"),p.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):p.OPACITY=!1;const V=this._getReflectionTexture();if(V&&v.c.ReflectionTextureEnabled){switch(p.REFLECTION=!0,p.GAMMAREFLECTION=V.gammaSpace,p.RGBDREFLECTION=V.isRGBD,p.LODINREFLECTIONALPHA=V.lodLevelInAlpha,p.LINEARSPECULARREFLECTION=V.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(p.NUM_SAMPLES=""+this.realTimeFilteringQuality,z._features.needTypeSuffixInShaderConstants&&(p.NUM_SAMPLES=p.NUM_SAMPLES+"u"),p.REALTIME_FILTERING=!0):p.REALTIME_FILTERING=!1,p.INVERTCUBICMAP=V.coordinatesMode===A.d.INVCUBIC_MODE,p.REFLECTIONMAP_3D=V.isCube,p.REFLECTIONMAP_OPPOSITEZ=p.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!V.invertZ:V.invertZ,p.REFLECTIONMAP_CUBIC=!1,p.REFLECTIONMAP_EXPLICIT=!1,p.REFLECTIONMAP_PLANAR=!1,p.REFLECTIONMAP_PROJECTION=!1,p.REFLECTIONMAP_SKYBOX=!1,p.REFLECTIONMAP_SPHERICAL=!1,p.REFLECTIONMAP_EQUIRECTANGULAR=!1,p.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,p.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,V.coordinatesMode){case A.d.EXPLICIT_MODE:p.REFLECTIONMAP_EXPLICIT=!0;break;case A.d.PLANAR_MODE:p.REFLECTIONMAP_PLANAR=!0;break;case A.d.PROJECTION_MODE:p.REFLECTIONMAP_PROJECTION=!0;break;case A.d.SKYBOX_MODE:p.REFLECTIONMAP_SKYBOX=!0;break;case A.d.SPHERICAL_MODE:p.REFLECTIONMAP_SPHERICAL=!0;break;case A.d.EQUIRECTANGULAR_MODE:p.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case A.d.FIXED_EQUIRECTANGULAR_MODE:p.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case A.d.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:p.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case A.d.CUBIC_MODE:case A.d.INVCUBIC_MODE:default:p.REFLECTIONMAP_CUBIC=!0,p.USE_LOCAL_REFLECTIONMAP_CUBIC=!!V.boundingBoxSize}V.coordinatesMode!==A.d.SKYBOX_MODE&&(V.irradianceTexture?(p.USEIRRADIANCEMAP=!0,p.USESPHERICALFROMREFLECTIONMAP=!1):V.isCube&&(p.USESPHERICALFROMREFLECTIONMAP=!0,p.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||z.getCaps().maxVaryingVectors<=8?p.USESPHERICALINVERTEX=!1:p.USESPHERICALINVERTEX=!0))}else p.REFLECTION=!1,p.REFLECTIONMAP_3D=!1,p.REFLECTIONMAP_SPHERICAL=!1,p.REFLECTIONMAP_PLANAR=!1,p.REFLECTIONMAP_CUBIC=!1,p.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,p.REFLECTIONMAP_PROJECTION=!1,p.REFLECTIONMAP_SKYBOX=!1,p.REFLECTIONMAP_EXPLICIT=!1,p.REFLECTIONMAP_EQUIRECTANGULAR=!1,p.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,p.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,p.INVERTCUBICMAP=!1,p.USESPHERICALFROMREFLECTIONMAP=!1,p.USEIRRADIANCEMAP=!1,p.USESPHERICALINVERTEX=!1,p.REFLECTIONMAP_OPPOSITEZ=!1,p.LODINREFLECTIONALPHA=!1,p.GAMMAREFLECTION=!1,p.RGBDREFLECTION=!1,p.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&v.c.LightmapTextureEnabled?((0,e.M)(this._lightmapTexture,p,"LIGHTMAP"),p.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,p.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,p.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):p.LIGHTMAP=!1,this._emissiveTexture&&v.c.EmissiveTextureEnabled?((0,e.M)(this._emissiveTexture,p,"EMISSIVE"),p.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):p.EMISSIVE=!1,v.c.SpecularTextureEnabled?(this._metallicTexture?((0,e.M)(this._metallicTexture,p,"REFLECTIVITY"),p.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,p.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,p.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,p.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,p.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,e.M)(this._reflectivityTexture,p,"REFLECTIVITY"),p.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,p.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,p.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):p.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(p.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,e.M)(this._metallicReflectanceTexture,p,"METALLIC_REFLECTANCE"),p.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):p.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,e.M)(this._reflectanceTexture,p,"REFLECTANCE"),p.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):p.REFLECTANCE=!1):(p.METALLIC_REFLECTANCE=!1,p.REFLECTANCE=!1),this._microSurfaceTexture?(0,e.M)(this._microSurfaceTexture,p,"MICROSURFACEMAP"):p.MICROSURFACEMAP=!1):(p.REFLECTIVITY=!1,p.MICROSURFACEMAP=!1),z.getCaps().standardDerivatives&&this._bumpTexture&&v.c.BumpTextureEnabled&&!this._disableBumpMap?((0,e.M)(this._bumpTexture,p,"BUMP"),this._useParallax&&this._albedoTexture&&v.c.DiffuseTextureEnabled?(p.PARALLAX=!0,p.PARALLAX_RHS=E.useRightHandedSystem,p.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):p.PARALLAX=!1,p.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(p.BUMP=!1,p.PARALLAX=!1,p.PARALLAX_RHS=!1,p.PARALLAXOCCLUSION=!1,p.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&v.c.ReflectionTextureEnabled?(p.ENVIRONMENTBRDF=!0,p.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(p.ENVIRONMENTBRDF=!1,p.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?p.ALPHAFROMALBEDO=!0:p.ALPHAFROMALBEDO=!1}p.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===Y.LIGHTFALLOFF_STANDARD?(p.USEPHYSICALLIGHTFALLOFF=!1,p.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===Y.LIGHTFALLOFF_GLTF?(p.USEPHYSICALLIGHTFALLOFF=!1,p.USEGLTFLIGHTFALLOFF=!0):(p.USEPHYSICALLIGHTFALLOFF=!0,p.USEGLTFLIGHTFALLOFF=!1),p.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.eh&&this._twoSidedLighting?p.TWOSIDEDLIGHTING=!0:p.TWOSIDEDLIGHTING=!1,p.SPECULARAA=z.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(p._areTexturesDirty||p._areMiscDirty)&&(p.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,p.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,p.ALPHABLEND=this.needAlphaBlendingForMesh(V),p.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,p.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),p._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(p),p.FORCENORMALFORWARD=this._forceNormalForward,p.RADIANCEOCCLUSION=this._useRadianceOcclusion,p.HORIZONOCCLUSION=this._useHorizonOcclusion,p._areMiscDirty&&((0,e.O)(V,E,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(V)||this._forceAlphaTest,p,this._applyDecalMapAfterDetailMap),p.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!V.isVerticesDataPresent(i.f.NormalKind),p.DEBUGMODE=this._debugMode),(0,e.F)(E,z,this,p,!!W,N,d),this._eventInfo.defines=p,this._eventInfo.mesh=V,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,e.E)(V,p,!0,!0,!0,this._transparencyMode!==Y.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(V,p,W){const N={clipPlane:!1,useInstances:!1,...W};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const W=new B(this._eventInfo.defineNames),d=this._prepareEffect(V,W,void 0,void 0,N.useInstances,N.clipPlane,V.hasThinInstances);this._onEffectCreatedObservable&&(r.effect=d,r.subMesh=null,this._onEffectCreatedObservable.notifyObservers(r)),d.isReady()?p&&p(this):d.onCompileObservable.add((()=>{p&&p(this)}))})()}buildUniformLayout(){const V=this._uniformBuffer;V.addUniform("vAlbedoInfos",2),V.addUniform("vAmbientInfos",4),V.addUniform("vOpacityInfos",2),V.addUniform("vEmissiveInfos",2),V.addUniform("vLightmapInfos",2),V.addUniform("vReflectivityInfos",3),V.addUniform("vMicroSurfaceSamplerInfos",2),V.addUniform("vReflectionInfos",2),V.addUniform("vReflectionFilteringInfo",2),V.addUniform("vReflectionPosition",3),V.addUniform("vReflectionSize",3),V.addUniform("vBumpInfos",3),V.addUniform("albedoMatrix",16),V.addUniform("ambientMatrix",16),V.addUniform("opacityMatrix",16),V.addUniform("emissiveMatrix",16),V.addUniform("lightmapMatrix",16),V.addUniform("reflectivityMatrix",16),V.addUniform("microSurfaceSamplerMatrix",16),V.addUniform("bumpMatrix",16),V.addUniform("vTangentSpaceParams",2),V.addUniform("reflectionMatrix",16),V.addUniform("vReflectionColor",3),V.addUniform("vAlbedoColor",4),V.addUniform("vLightingIntensity",4),V.addUniform("vReflectionMicrosurfaceInfos",3),V.addUniform("pointSize",1),V.addUniform("vReflectivityColor",4),V.addUniform("vEmissiveColor",3),V.addUniform("vAmbientColor",3),V.addUniform("vDebugMode",2),V.addUniform("vMetallicReflectanceFactors",4),V.addUniform("vMetallicReflectanceInfos",2),V.addUniform("metallicReflectanceMatrix",16),V.addUniform("vReflectanceInfos",2),V.addUniform("reflectanceMatrix",16),V.addUniform("vSphericalL00",3),V.addUniform("vSphericalL1_1",3),V.addUniform("vSphericalL10",3),V.addUniform("vSphericalL11",3),V.addUniform("vSphericalL2_2",3),V.addUniform("vSphericalL2_1",3),V.addUniform("vSphericalL20",3),V.addUniform("vSphericalL21",3),V.addUniform("vSphericalL22",3),V.addUniform("vSphericalX",3),V.addUniform("vSphericalY",3),V.addUniform("vSphericalZ",3),V.addUniform("vSphericalXX_ZZ",3),V.addUniform("vSphericalYY_ZZ",3),V.addUniform("vSphericalZZ",3),V.addUniform("vSphericalXY",3),V.addUniform("vSphericalYZ",3),V.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(V,p,W){const N=this.va(),d=W.materialDefines;if(!d)return;const E=W.effect;if(!E)return;this._activeEffect=E,p.getMeshUniformBuffer().bindToEffect(E,"Mesh"),p.transferToEffect(V);const z=N.getEngine();this._uniformBuffer.bindToEffect(E,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,N,p,V,this.isFrozen),X.e.Bind(z.currentRenderPassId,this._activeEffect,p,V),this._eventInfo.subMesh=W,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),d.OBJECTSPACE_NORMALMAP&&(V.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const S=this._mustRebind(N,E,W,p.visibility);(0,e.e)(p,this._activeEffect,this.prePassConfiguration);let J=null;const i=this._uniformBuffer;if(S){if(this.bindViewProjection(E),J=this._getReflectionTexture(),!i.useUbo||!this.isFrozen||!i.isSync||W._drawWrapper._forceRebindOnNextCall){var l;if(N.texturesEnabled){if(this._albedoTexture&&v.c.DiffuseTextureEnabled&&(i.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,e.t)(this._albedoTexture,i,"albedo")),this._ambientTexture&&v.c.AmbientTextureEnabled&&(i.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,e.t)(this._ambientTexture,i,"ambient")),this._opacityTexture&&v.c.OpacityTextureEnabled&&(i.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,e.t)(this._opacityTexture,i,"opacity")),J&&v.c.ReflectionTextureEnabled){if(i.wj("reflectionMatrix",J.getReflectionTextureMatrix()),i.updateFloat2("vReflectionInfos",J.level,0),J.boundingBoxSize){const V=J;i.updateVector3("vReflectionPosition",V.boundingBoxPosition),i.updateVector3("vReflectionSize",V.boundingBoxSize)}if(this.realTimeFiltering){const V=J.getSize().width;i.updateFloat2("vReflectionFilteringInfo",V,Math.log2(V))}if(!d.USEIRRADIANCEMAP){const V=J.sphericalPolynomial;if(d.USESPHERICALFROMREFLECTIONMAP&&V)if(d.SPHERICAL_HARMONICS){const p=V.preScaledHarmonics;i.updateVector3("vSphericalL00",p.l00),i.updateVector3("vSphericalL1_1",p.l1_1),i.updateVector3("vSphericalL10",p.l10),i.updateVector3("vSphericalL11",p.l11),i.updateVector3("vSphericalL2_2",p.l2_2),i.updateVector3("vSphericalL2_1",p.l2_1),i.updateVector3("vSphericalL20",p.l20),i.updateVector3("vSphericalL21",p.l21),i.updateVector3("vSphericalL22",p.l22)}else i.updateFloat3("vSphericalX",V.x.x,V.x.y,V.x.z),i.updateFloat3("vSphericalY",V.y.x,V.y.y,V.y.z),i.updateFloat3("vSphericalZ",V.z.x,V.z.y,V.z.z),i.updateFloat3("vSphericalXX_ZZ",V.xx.x-V.zz.x,V.xx.y-V.zz.y,V.xx.z-V.zz.z),i.updateFloat3("vSphericalYY_ZZ",V.yy.x-V.zz.x,V.yy.y-V.zz.y,V.yy.z-V.zz.z),i.updateFloat3("vSphericalZZ",V.zz.x,V.zz.y,V.zz.z),i.updateFloat3("vSphericalXY",V.xy.x,V.xy.y,V.xy.z),i.updateFloat3("vSphericalYZ",V.yz.x,V.yz.y,V.yz.z),i.updateFloat3("vSphericalZX",V.zx.x,V.zx.y,V.zx.z)}i.updateFloat3("vReflectionMicrosurfaceInfos",J.getSize().width,J.lodGenerationScale,J.lodGenerationOffset)}this._emissiveTexture&&v.c.EmissiveTextureEnabled&&(i.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,e.t)(this._emissiveTexture,i,"emissive")),this._lightmapTexture&&v.c.LightmapTextureEnabled&&(i.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,e.t)(this._lightmapTexture,i,"lightmap")),v.c.SpecularTextureEnabled&&(this._metallicTexture?(i.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,e.t)(this._metallicTexture,i,"reflectivity")):this._reflectivityTexture&&(i.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,e.t)(this._reflectivityTexture,i,"reflectivity")),this._metallicReflectanceTexture&&(i.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,e.t)(this._metallicReflectanceTexture,i,"metallicReflectance")),this._reflectanceTexture&&d.REFLECTANCE&&(i.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,e.t)(this._reflectanceTexture,i,"reflectance")),this._microSurfaceTexture&&(i.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,e.t)(this._microSurfaceTexture,i,"microSurfaceSampler"))),this._bumpTexture&&z.getCaps().standardDerivatives&&v.c.BumpTextureEnabled&&!this._disableBumpMap&&(i.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,e.t)(this._bumpTexture,i,"bump"),N._mirroredCameraPosition?i.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):i.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&i.updateFloat("pointSize",this.pointSize),d.METALLICWORKFLOW){var j;O.g.gb[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,O.g.gb[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,i.updateColor4("vReflectivityColor",O.g.gb[0],1);const V=(null===(j=this.subSurface)||void 0===j?void 0:j._indexOfRefraction)??1.5,p=1,W=Math.pow((V-p)/(V+p),2);this._metallicReflectanceColor.scaleToRef(W*this._metallicF0Factor,O.g.gb[0]);const N=this._metallicF0Factor;i.updateColor4("vMetallicReflectanceFactors",O.g.gb[0],N)}else i.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);i.updateColor3("vEmissiveColor",v.c.EmissiveTextureEnabled?this._emissiveColor:O.c.BlackReadOnly),i.updateColor3("vReflectionColor",this._reflectionColor),!d.SS_REFRACTION&&null!==(l=this.subSurface)&&void 0!==l&&l._linkRefractionWithTransparency?i.updateColor4("vAlbedoColor",this._albedoColor,1):i.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*N.environmentIntensity,this._lightingInfos.w=this._specularIntensity,i.updateVector4("vLightingIntensity",this._lightingInfos),N.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),i.updateColor3("vAmbientColor",this._globalAmbientColor),i.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}N.texturesEnabled&&(this._albedoTexture&&v.c.DiffuseTextureEnabled&&i.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&v.c.AmbientTextureEnabled&&i.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&v.c.OpacityTextureEnabled&&i.setTexture("opacitySampler",this._opacityTexture),J&&v.c.ReflectionTextureEnabled&&(d.LODBASEDMICROSFURACE?i.setTexture("reflectionSampler",J):(i.setTexture("reflectionSampler",J._lodTextureMid||J),i.setTexture("reflectionSamplerLow",J._lodTextureLow||J),i.setTexture("reflectionSamplerHigh",J._lodTextureHigh||J)),d.USEIRRADIANCEMAP&&i.setTexture("irradianceSampler",J.irradianceTexture)),d.ENVIRONMENTBRDF&&i.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&v.c.EmissiveTextureEnabled&&i.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&v.c.LightmapTextureEnabled&&i.setTexture("lightmapSampler",this._lightmapTexture),v.c.SpecularTextureEnabled&&(this._metallicTexture?i.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&i.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&i.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&d.REFLECTANCE&&i.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&i.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&z.getCaps().standardDerivatives&&v.c.BumpTextureEnabled&&!this._disableBumpMap&&i.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(p)&&this.va().depthPeelingRenderer.bind(E),this._eventInfo.subMesh=W,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,R.e)(this._activeEffect,this,N),this.bindEyePosition(E)}else N.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(S||!this.isFrozen){var k;if(N.lightsEnabled&&!this._disableLighting&&(0,e.i)(N,p,this._activeEffect,d,this._maxSimultaneousLights),(N.fogEnabled&&p.applyFog&&N.fogMode!==Q.e.FOGMODE_NONE||J||this.subSurface.refractionTexture||p.receiveShadows||d.PREPASS)&&this.bindView(E),(0,e.g)(N,p,this._activeEffect,!0),d.NUM_MORPH_INFLUENCERS&&(0,e.m)(p,this._activeEffect),d.BAKED_VERTEX_ANIMATION_TEXTURE)null===(k=p.bakedVertexAnimationManager)||void 0===k||k.bind(E,d.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,e.k)(d,this._activeEffect,N)}this._afterBind(p,this._activeEffect,W),i.update()}getAnimatables(){const V=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&V.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&V.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&V.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&V.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&V.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?V.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&V.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&V.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&V.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&V.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&V.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&V.push(this._microSurfaceTexture),V}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const V=super.getActiveTextures();return this._albedoTexture&&V.push(this._albedoTexture),this._ambientTexture&&V.push(this._ambientTexture),this._opacityTexture&&V.push(this._opacityTexture),this._reflectionTexture&&V.push(this._reflectionTexture),this._emissiveTexture&&V.push(this._emissiveTexture),this._reflectivityTexture&&V.push(this._reflectivityTexture),this._metallicTexture&&V.push(this._metallicTexture),this._metallicReflectanceTexture&&V.push(this._metallicReflectanceTexture),this._reflectanceTexture&&V.push(this._reflectanceTexture),this._microSurfaceTexture&&V.push(this._microSurfaceTexture),this._bumpTexture&&V.push(this._bumpTexture),this._lightmapTexture&&V.push(this._lightmapTexture),V}hasTexture(V){return!!super.hasTexture(V)||(this._albedoTexture===V||(this._ambientTexture===V||(this._opacityTexture===V||(this._reflectionTexture===V||(this._emissiveTexture===V||(this._reflectivityTexture===V||(this._metallicTexture===V||(this._metallicReflectanceTexture===V||(this._reflectanceTexture===V||(this._microSurfaceTexture===V||(this._bumpTexture===V||this._lightmapTexture===V)))))))))))}setPrePassRenderer(){var V;if(null===(V=this.subSurface)||void 0===V||!V.isScatteringEnabled)return!1;const p=this.va().enableSubSurfaceForPrePass();return p&&(p.enabled=!0),!0}dispose(V,p){var W,N,d,E,z,S,Q,J,i,l,j,k;(this._breakShaderLoadedCheck=!0,p)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(W=this._albedoTexture)||void 0===W||W.dispose(),null===(N=this._ambientTexture)||void 0===N||N.dispose(),null===(d=this._opacityTexture)||void 0===d||d.dispose(),null===(E=this._reflectionTexture)||void 0===E||E.dispose(),null===(z=this._emissiveTexture)||void 0===z||z.dispose(),null===(S=this._metallicTexture)||void 0===S||S.dispose(),null===(Q=this._reflectivityTexture)||void 0===Q||Q.dispose(),null===(J=this._bumpTexture)||void 0===J||J.dispose(),null===(i=this._lightmapTexture)||void 0===i||i.dispose(),null===(l=this._metallicReflectanceTexture)||void 0===l||l.dispose(),null===(j=this._reflectanceTexture)||void 0===j||j.dispose(),null===(k=this._microSurfaceTexture)||void 0===k||k.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(V,p)}}Y.PBRMATERIAL_OPAQUE=F.d.MATERIAL_OPAQUE,Y.PBRMATERIAL_ALPHATEST=F.d.MATERIAL_ALPHATEST,Y.PBRMATERIAL_ALPHABLEND=F.d.MATERIAL_ALPHABLEND,Y.PBRMATERIAL_ALPHATESTANDBLEND=F.d.MATERIAL_ALPHATESTANDBLEND,Y.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,Y.LIGHTFALLOFF_PHYSICAL=0,Y.LIGHTFALLOFF_GLTF=1,Y.LIGHTFALLOFF_STANDARD=2,Y.ForceGLSL=!1,(0,N.c)([(0,d.q)()],Y.prototype,"_imageProcessingConfiguration",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"debugMode",void 0)},10995:(V,p,W)=>{"use strict";W.d(p,{b:()=>z});var N=W(10870);const d=new Map;function E(V,p){(function(V){return d.delete(V)})(V)&&N.e.Warn(`Extension with the name '${name}' already exists`),d.set(V,p)}function z(V,p){"image/ktx"!==p&&"image/ktx2"!==p||(V=".ktx"),d.has(V)||(V.endsWith(".dds")&&E(".dds",(()=>W.e(12).then(W.bind(W,13222)).then((V=>new V._DDSTextureLoader)))),V.endsWith(".basis")&&E(".basis",(()=>W.e(13).then(W.bind(W,13224)).then((V=>new V._BasisTextureLoader)))),V.endsWith(".env")&&E(".env",(()=>W.e(14).then(W.bind(W,13230)).then((V=>new V._ENVTextureLoader)))),V.endsWith(".hdr")&&E(".hdr",(()=>W.e(15).then(W.bind(W,13234)).then((V=>new V._HDRTextureLoader)))),(V.endsWith(".ktx")||V.endsWith(".ktx2"))&&(E(".ktx",(()=>W.e(16).then(W.bind(W,13237)).then((V=>new V._KTXTextureLoader)))),E(".ktx2",(()=>W.e(16).then(W.bind(W,13237)).then((V=>new V._KTXTextureLoader))))),V.endsWith(".tga")&&E(".tga",(()=>W.e(17).then(W.bind(W,13245)).then((V=>new V._TGATextureLoader)))),V.endsWith(".exr")&&E(".exr",(()=>W.e(18).then(W.bind(W,13247)).then((V=>new V._ExrTextureLoader)))));const N=d.get(V);return N?Promise.resolve(N(p)):null}},11454:(V,p,W)=>{"use strict";W.d(p,{c:()=>j});var N=W(11167),d=W(11175),E=W(10856),z=W(11218),S=W(10900),Q=W(11007),J=(W(10902),W(11462));class i{get wrapU(){return this._wrapU}set wrapU(V){this._wrapU=V}get wrapV(){return this._wrapV}set wrapV(V){this._wrapV=V}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(V){this._texture&&(this._texture.isCube=V)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(V){this._texture&&(this._texture.is3D=V)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(V){this._texture&&(this._texture.is2DArray=V)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(V){return void 0!==(null===V||void 0===V?void 0:V.shareDepth)}constructor(V){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=J.c.Zero(),this._cachedBaseSize=J.c.Zero(),this._initialSamplingMode=2,this._texture=i._IsRenderTargetWrapper(V)?V.texture:V,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(V){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(V,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var l=W(11265);class j extends i{set xe(V){this._hasAlpha!==V&&(this._hasAlpha=V,this._scene&&this._scene.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get xe(){return this._hasAlpha}set getAlphaFromRGB(V){this._getAlphaFromRGB!==V&&(this._getAlphaFromRGB=V,this._scene&&this._scene.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(V){this._coordinatesIndex!==V&&(this._coordinatesIndex=V,this._scene&&this._scene.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(V){this._coordinatesMode!==V&&(this._coordinatesMode=V,this._scene&&this._scene.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(V){this._wrapU=V}get wrapV(){return this._wrapV}set wrapV(V){this._wrapV=V}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(V){this._texture?this._texture.isCube=V:this._isCube=V}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(V){this._texture&&(this._texture.is3D=V)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(V){this._texture&&(this._texture.is2DArray=V)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(V){var p;if(this._texture){if(this._texture._gammaSpace===V)return;this._texture._gammaSpace=V}else{if(this._gammaSpace===V)return;this._gammaSpace=V}null===(p=this.va())||void 0===p||p.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(V){var p;V!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=V),null===(p=this.va())||void 0===p||p.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(V){this._texture&&(this._texture._lodGenerationOffset=V)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(V){this._texture&&(this._texture._lodGenerationScale=V)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(V){this._texture&&(this._texture._linearSpecularLOD=V)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(V){this._texture&&(this._texture._irradianceTexture=V)}get uid(){return this._uid||(this._uid=(0,Q.b)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(V){this._onDisposeObserver&&this.$i.remove(this._onDisposeObserver),this._onDisposeObserver=this.$i.add(V)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=j.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.$i=new E.b,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,V?j._IsScene(V)?this._scene=V:this._engine=V:this._scene=S.d.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=p,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return z.e.IdentityReadOnly}getReflectionTextureMatrix(){return z.e.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(V){}get canRescale(){return!1}_getFromCache(V,p,W,N,d,E){const z=this._getEngine();if(!z)return null;const S=z._getUseSRGBBuffer(!!d,p),Q=z.getLoadedTexturesCache();for(let J=0;J<Q.length;J++){const z=Q[J];if((void 0===d||S===z._useSRGBBuffer)&&(void 0===N||N===z.invertY)&&z.url===V&&z.generateMipMaps===!p&&(!W||W===z.samplingMode)&&(void 0===E||E===z.isCube))return z.incrementReferences(),z}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const V=this.va();V&&V.markAllMaterialsAsDirty(1)}readPixels(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const J=this._getEngine();if(!J)return null;const i=this.getSize();let l=i.width,j=i.height;0!==p&&(l/=Math.pow(2,p),j/=Math.pow(2,p),l=Math.round(l),j=Math.round(j)),S=Math.min(l,S),Q=Math.min(j,Q);try{return this._texture.isCube?J._readTexturePixels(this._texture,S,Q,V,p,W,N,d,E,z):J._readTexturePixels(this._texture,S,Q,-1,p,W,N,d,E,z)}catch(k){return null}}_readPixelsSync(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const E=this.getSize();let z=E.width,S=E.height;const Q=this._getEngine();if(!Q)return null;0!=p&&(z/=Math.pow(2,p),S/=Math.pow(2,p),z=Math.round(z),S=Math.round(S));try{return this._texture.isCube?Q._readTexturePixelsSync(this._texture,z,S,V,p,W,N,d):Q._readTexturePixelsSync(this._texture,z,S,-1,p,W,N,d)}catch(J){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const V=this._scene.textures.indexOf(this);if(V>=0&&this._scene.textures.splice(V,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const V=this._parentContainer.textures.indexOf(this);V>-1&&this._parentContainer.textures.splice(V,1),this._parentContainer=null}}this.$i.notifyObservers(this),this.$i.clear(),this.metadata=null,super.dispose()}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!V)return null;const p=l.b.Serialize(this);return l.b.AppendSerializedAnimations(this,p),p}static WhenAllReady(V,p){let W=V.length;if(0!==W)for(let N=0;N<V.length;N++){const d=V[N];if(d.isReady())0===--W&&p();else{const V=d.onLoadObservable;V?V.addOnce((()=>{0===--W&&p()})):0===--W&&p()}}else p()}static _IsScene(V){return"Scene"===V.getClassName()}}j.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,N.c)([(0,d.I)()],j.prototype,"uniqueId",void 0),(0,N.c)([(0,d.I)()],j.prototype,"name",void 0),(0,N.c)([(0,d.I)()],j.prototype,"metadata",void 0),(0,N.c)([(0,d.I)("xe")],j.prototype,"_hasAlpha",void 0),(0,N.c)([(0,d.I)("getAlphaFromRGB")],j.prototype,"_getAlphaFromRGB",void 0),(0,N.c)([(0,d.I)()],j.prototype,"level",void 0),(0,N.c)([(0,d.I)("coordinatesIndex")],j.prototype,"_coordinatesIndex",void 0),(0,N.c)([(0,d.I)()],j.prototype,"optimizeUVAllocation",void 0),(0,N.c)([(0,d.I)("coordinatesMode")],j.prototype,"_coordinatesMode",void 0),(0,N.c)([(0,d.I)()],j.prototype,"wrapU",null),(0,N.c)([(0,d.I)()],j.prototype,"wrapV",null),(0,N.c)([(0,d.I)()],j.prototype,"wrapR",void 0),(0,N.c)([(0,d.I)()],j.prototype,"anisotropicFilteringLevel",void 0),(0,N.c)([(0,d.I)()],j.prototype,"isCube",null),(0,N.c)([(0,d.I)()],j.prototype,"is3D",null),(0,N.c)([(0,d.I)()],j.prototype,"is2DArray",null),(0,N.c)([(0,d.I)()],j.prototype,"gammaSpace",null),(0,N.c)([(0,d.I)()],j.prototype,"invertZ",void 0),(0,N.c)([(0,d.I)()],j.prototype,"lodLevelInAlpha",void 0),(0,N.c)([(0,d.I)()],j.prototype,"lodGenerationOffset",null),(0,N.c)([(0,d.I)()],j.prototype,"lodGenerationScale",null),(0,N.c)([(0,d.I)()],j.prototype,"linearSpecularLOD",null),(0,N.c)([(0,d.A)()],j.prototype,"irradianceTexture",null),(0,N.c)([(0,d.I)()],j.prototype,"isRenderTarget",void 0)},12520:(V,p,W)=>{"use strict";var N=W(11775),d=W(11454);d.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(d.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=N.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((V=>{this._texture._sphericalPolynomial=V,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(V){this._texture&&(this._texture._sphericalPolynomial=V)},enumerable:!0,configurable:!0})},12563:(V,p,W)=>{"use strict";W.d(p,{d:()=>j});var N=W(11167),d=W(11175),E=W(10848),z=W(11218),S=W(11454),Q=W(11452),J=W(11004),i=W(10856),l=W(11265);W(11815);class j extends S.c{set boundingBoxSize(V){if(this._boundingBoxSize&&this._boundingBoxSize.equals(V))return;this._boundingBoxSize=V;const p=this.va();p&&p.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(V){this._rotationY=V,this.setReflectionTextureMatrix(z.e.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(V,p,W){let N="";return V.forEach((V=>N+=V)),new j(N,p,null,W,V)}static CreateFromPrefilteredData(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const d=p.useDelayedTextureLoading;p.useDelayedTextureLoading=!1;const E=new j(V,p,null,!1,null,null,null,void 0,!0,W,N);return p.useDelayedTextureLoading=d,E}constructor(V,p){var W;let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,j=arguments.length>8&&void 0!==arguments[8]&&arguments[8],k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,u=arguments.length>10&&void 0!==arguments[10]&&arguments[10],f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,O=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,U=arguments.length>13?arguments[13]:void 0,F=arguments.length>14?arguments[14]:void 0;super(p),this.onLoadObservable=new i.b,this.boundingBoxPosition=z.n.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new z.e,this._buffer=null,this.name=V,this.url=V,this._noMipmap=d,this.xe=!1,this.isCube=!0,this._textureMatrix=z.e.Identity(),this.coordinatesMode=Q.d.CUBIC_MODE;let C=null,A=null;null===N||Array.isArray(N)?(this._noMipmap=d,this._format=l,this._createPolynomials=u,C=N,this._loaderOptions=U,this._useSRGBBuffer=F,this._lodScale=f,this._lodOffset=O):(C=N.extensions??null,this._noMipmap=N.noMipmap??!1,E=N.files??null,A=N.buffer??null,this._format=N.format??5,j=N.prefiltered??!1,k=N.forcedExtension??null,this._createPolynomials=N.createPolynomials??!1,this._lodScale=N.lodScale??.8,this._lodOffset=N.lodOffset??0,this._loaderOptions=N.loaderOptions,this._useSRGBBuffer=N.useSRGBBuffer,S=N.X??null,J=N.onError??null),(V||E)&&this.updateURL(V,k,S,j,J,C,null===(W=this.va())||void 0===W?void 0:W.useDelayedTextureLoading,E,A)}getClassName(){return"CubeTexture"}updateURL(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=V),this.url=V,p&&(this._forcedExtension=p);const J=V.lastIndexOf("."),i=p||(J>-1?V.substring(J).toLowerCase():""),l=0===i.indexOf(".dds"),j=0===i.indexOf(".env"),k=0===i.indexOf(".basis");if(j?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=N,N&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),S)this._files=S;else if(k||j||l||E||(E=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,E){for(let p=0;p<E.length;p++)this._files.push(V+E[p]);this._extensions=E}this._buffer=Q,z?(this.delayLoadState=4,this._delayedOnLoad=W,this._delayedOnError=d):this._loadTexture(W,d)}delayLoad(V){4===this.delayLoadState&&(V&&(this._forcedExtension=V),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(V){var p,W;if(V.updateFlag===this._textureMatrix.updateFlag)return;V.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(W=this.va())||void 0===W||W.markAllMaterialsAsDirty(1,(V=>-1!==V.getActiveTextures().indexOf(this))));if(this._textureMatrix=V,null===(p=this.va())||void 0===p||!p.useRightHandedSystem)return;const N=z.i.fb[0],d=z.i.Quaternion[0],E=z.i.fb[1];this._textureMatrix.decompose(N,d,E),d.z*=-1,d.w*=-1,z.e.ComposeToRef(N,d,E,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var V;return null!==(V=this.va())&&void 0!==V&&V.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=this.va(),N=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const d=()=>{var p;(this.onLoadObservable.notifyObservers(this),N)&&(N.dispose(),null===(p=this.va())||void 0===p||p.markAllMaterialsAsDirty(1));V&&V()},z=(V,W)=>{this._loadingError=!0,this._errorObject={message:V,exception:W},p&&p(V,W),Q.d.OnTextureLoadErrorObservable.notifyObservers(this)};var S;this._texture?this._texture.isReady?E.e.SetImmediate((()=>d())):this._texture.onLoadedObservable.add((()=>d())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,W,this._lodScale,this._lodOffset,V,z,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,W,this._files,this._noMipmap,V,z,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(S=this._texture)||void 0===S||S.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(V,p,W){const N=l.b.Parse((()=>{let N=!1;return V.prefiltered&&(N=V.prefiltered),new j(W+(V.url??V.name),p,V.extensions,!1,V.files||null,null,null,void 0,N,V.forcedExtension)}),V,p);if(V.boundingBoxPosition&&(N.boundingBoxPosition=z.n.Tg(V.boundingBoxPosition)),V.boundingBoxSize&&(N.boundingBoxSize=z.n.Tg(V.boundingBoxSize)),V.animations)for(let d=0;d<V.animations.length;d++){const p=V.animations[d],W=(0,J.b)("BABYLON.Animation");W&&N.animations.push(W.Parse(p))}return N}clone(){let V=0;const p=l.b.Clone((()=>{const p=new j(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return V=p.uniqueId,p}),this);return p.uniqueId=V,p}}(0,N.c)([(0,d.I)()],j.prototype,"url",void 0),(0,N.c)([(0,d.F)()],j.prototype,"boundingBoxPosition",void 0),(0,N.c)([(0,d.F)()],j.prototype,"boundingBoxSize",null),(0,N.c)([(0,d.I)("rotationY")],j.prototype,"rotationY",null),(0,N.c)([(0,d.I)("files")],j.prototype,"_files",void 0),(0,N.c)([(0,d.I)("forcedExtension")],j.prototype,"_forcedExtension",void 0),(0,N.c)([(0,d.I)("extensions")],j.prototype,"_extensions",void 0),(0,N.c)([(0,d.t)("textureMatrix")],j.prototype,"_textureMatrix",void 0),(0,N.c)([(0,d.t)("textureMatrixRefraction")],j.prototype,"_textureMatrixRefraction",void 0),Q.d._CubeTextureParser=j.Parse,(0,J.d)("BABYLON.CubeTexture",j)},12985:(V,p,W)=>{"use strict";W.d(p,{b:()=>Q});var N=W(10870),d=W(11452),E=W(11016),z=W(11705),S=W(10983);z.ThinEngine.prototype.createDynamicTexture=function(V,p,W,N){const d=new S.e(this,4);return d.baseWidth=V,d.baseHeight=p,W&&(V=this.needPOTTextures?(0,E.g)(V,this._caps.maxTextureSize):V,p=this.needPOTTextures?(0,E.g)(p,this._caps.maxTextureSize):p),d.width=V,d.height=p,d.isReady=!1,d.generateMipMaps=W,d.samplingMode=N,this.updateTextureSamplingMode(N,d),this._internalTexturesCache.push(d),d},z.ThinEngine.prototype.updateDynamicTexture=function(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!V)return;const z=this._gl,S=z.TEXTURE_2D,Q=this._bindTextureDirectly(S,V,!0,E);this._unpackFlipY(void 0===W?V.invertY:W),N&&z.pixelStorei(z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const J=this._getWebGLTextureType(V.type),i=this._getInternalFormat(d||V.format),l=this._getRGBABufferInternalSizedFormat(V.type,i);z.texImage2D(S,0,l,i,J,p),V.generateMipMaps&&z.generateMipmap(S),Q||this._bindTextureDirectly(S,null),N&&z.pixelStorei(z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),d&&(V.format=d),V._dynamicTextureSource=p,V._premulAlpha=N,V.invertY=W||!1,V.isReady=!0};class Q extends d.d{constructor(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,S=arguments.length>6?arguments[6]:void 0;const Q=!W||W._isScene;super(null,Q?W:null===W||void 0===W?void 0:W.Bc,Q?!N:W,S,E,void 0,void 0,void 0,void 0,z),this.name=V,this.wrapU=d.d.CLAMP_ADDRESSMODE,this.wrapV=d.d.CLAMP_ADDRESSMODE,this._generateMipMaps=N;const J=this._getEngine();if(!J)return;if(p.getContext)this._canvas=p,this._ownCanvas=!1,this._texture=J.createDynamicTexture(this._canvas.width,this._canvas.height,N,E);else{this._canvas=J.createCanvas(1,1),this._ownCanvas=!0;const V=p;V.width||0===V.width?this._texture=J.createDynamicTexture(V.width,V.height,N,E):this._texture=J.createDynamicTexture(p,p,N,E)}const i=this.getSize();this._canvas.width!==i.width&&(this._canvas.width=i.width),this._canvas.height!==i.height&&(this._canvas.height=i.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(V){this._canvas.width=V.width,this._canvas.height=V.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(V.width,V.height,this._generateMipMaps,this.samplingMode)}scale(V){const p=this.getSize();p.width*=V,p.height*=V,this._recreate(p)}scaleTo(V,p){const W=this.getSize();W.width=V,W.height=p,this._recreate(W)}getContext(){return this._context}clear(V){const p=this.getSize();V&&(this._context.fillStyle=V),this._context.clearRect(0,0,p.width,p.height)}update(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===V||V,p,this._format||void 0,void 0,W)}drawText(V,p,W,N,d,E,z){let S=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const Q=this.getSize();if(E&&(this._context.fillStyle=E,this._context.fillRect(0,0,Q.width,Q.height)),this._context.font=N,null===p||void 0===p){const W=this._context.measureText(V);p=(Q.width-W.width)/2}if(null===W||void 0===W){const V=parseInt(N.replace(/\D/g,""));W=Q.height/2+V/3.65}this._context.fillStyle=d||"",this._context.fillText(V,p,W),S&&this.update(z)}dispose(){var V,p;(super.dispose(),this._ownCanvas)&&(null===(V=this._canvas)||void 0===V||null===(p=V.remove)||void 0===p||p.call(V));this._canvas=null,this._context=null}clone(){const V=this.va();if(!V)return this;const p=this.getSize(),W=new Q(this.name,p,V,this._generateMipMaps);return W.xe=this.xe,W.level=this.level,W.wrapU=this.wrapU,W.wrapV=this.wrapV,W}serialize(){const V=this.va();V&&!V.isReady()&&N.e.Warn("The scene must be ready before serializing the dynamic texture");const p=super.serialize();return Q._IsCanvasElement(this._canvas)&&(p.base64String=this._canvas.toDataURL()),p.invertY=this._invertY,p.samplingMode=this.samplingMode,p}static _IsCanvasElement(V){return void 0!==V.toDataURL}_rebuild(){this.update()}}},10983:(V,p,W)=>{"use strict";W.d(p,{e:()=>z});var N,d=W(10856),E=W(10990);!function(V){V[V.Unknown=0]="Unknown",V[V.Url=1]="Url",V[V.Temp=2]="Temp",V[V.Raw=3]="Raw",V[V.Dynamic=4]="Dynamic",V[V.RenderTarget=5]="RenderTarget",V[V.MultiRenderTarget=6]="MultiRenderTarget",V[V.Cube=7]="Cube",V[V.CubeRaw=8]="CubeRaw",V[V.CubePrefiltered=9]="CubePrefiltered",V[V.Raw3D=10]="Raw3D",V[V.Raw2DArray=11]="Raw2DArray",V[V.DepthStencil=12]="DepthStencil",V[V.CubeRawRGBD=13]="CubeRawRGBD",V[V.Depth=14]="Depth"}(N||(N={}));class z extends E.b{get useMipMaps(){return this.generateMipMaps}set useMipMaps(V){this.generateMipMaps=V}get uniqueId(){return this._uniqueId}_setUniqueId(V){this._uniqueId=V}getEngine(){return this._engine}get source(){return this._source}constructor(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new d.b,this.onErrorObservable=new d.b,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=V,this._source=p,this._uniqueId=z._Counter++,W||(this._hardwareTexture=V._createHardwareTexture())}incrementReferences(){this._references++}updateSize(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,V,p,W),this.width=V,this.height=p,this.depth=W,this.baseWidth=V,this.baseHeight=p,this.baseDepth=W,this._size=V*p*W}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const V=this.onRebuildCallback(this),p=p=>{p._swapAndDie(this,!1),this.isReady=V.isReady};return void(V.isAsync?V.proxy.then(p):p(V.proxy))}let V;switch(this.source){case 2:case 12:case 14:break;case 1:return void(V=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(V=>{V._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:V=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),V._swapAndDie(this,!1),this.isReady=!0;break;case 10:V=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),V._swapAndDie(this,!1),this.isReady=!0;break;case 11:V=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),V._swapAndDie(this,!1),this.isReady=!0;break;case 4:V=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),V._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(V=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{V._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:V=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),V._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return V=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(V=>{V&&V._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(V._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(V){var p;let W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(p=this._hardwareTexture)||void 0===p||p.setUsage(V._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),V._hardwareTexture=this._hardwareTexture,W&&(V._isRGBD=this._isRGBD),this._lodTextureHigh&&(V._lodTextureHigh&&V._lodTextureHigh.dispose(),V._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(V._lodTextureMid&&V._lodTextureMid.dispose(),V._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(V._lodTextureLow&&V._lodTextureLow.dispose(),V._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(V._irradianceTexture&&V._irradianceTexture.dispose(),V._irradianceTexture=this._irradianceTexture);const N=this._engine.getLoadedTexturesCache();let d=N.indexOf(this);-1!==d&&N.splice(d,1),d=N.indexOf(V),-1===d&&N.push(V)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}z._Counter=0},11731:(V,p,W)=>{"use strict";W.d(p,{d:()=>d});var N=W(11452);class d extends N.d{constructor(V,p,W,d,E){let z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,i=arguments.length>9?arguments[9]:void 0,l=arguments.length>10?arguments[10]:void 0;super(null,E,!z,S,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,i),this.format=d,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==J||(Q=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==J||(Q=1),this._texture=this._engine.createRawTexture(V,p,W,d,z,S,Q,null,J,i??0,l??!1),this.wrapU=N.d.CLAMP_ADDRESSMODE,this.wrapV=N.d.CLAMP_ADDRESSMODE)}update(V){this._getEngine().updateRawTexture(this._texture,V,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const V=new d(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return V._texture=this._texture,this._texture.incrementReferences(),V}static CreateLuminanceTexture(V,p,W,N){return new d(V,p,W,1,N,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(V,p,W,N){return new d(V,p,W,2,N,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(V,p,W,N){return new d(V,p,W,0,N,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(V,p,W,N){return new d(V,p,W,4,N,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(V,p,W,N){return new d(V,p,W,5,N,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(V,p,W,N){return new d(V,p,W,5,N,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(V,p,W,E){let z=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:N.d.TRILINEAR_SAMPLINGMODE;return new d(V,p,W,6,E,z,S,Q,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(V,p,W,E){let z=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:N.d.TRILINEAR_SAMPLINGMODE;return new d(V,p,W,6,E,z,S,Q,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},12087:(V,p,W)=>{"use strict";W.d(p,{d:()=>d});var N=W(11452);class d extends N.d{get depth(){return this._depth}constructor(V,p,W,d,E,z){let S=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],Q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:N.d.TRILINEAR_SAMPLINGMODE,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10?arguments[10]:void 0;super(null,z,!S,Q),this.format=E,this._texture=z.getEngine().createRawTexture2DArray(V,p,W,d,E,S,Q,J,null,i,l),this._depth=d,this.is2DArray=!0}update(V){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,V,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(V,p,W,N,E){return new d(V,p,W,N,5,E,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11789:(V,p,W)=>{"use strict";W.d(p,{c:()=>j});var N=W(10856),d=W(11218),E=W(11452),z=W(11305),S=W(11313),Q=W(11233),J=W(11016),i=W(10948),l=W(10870);i.e.prototype.setDepthStencilTexture=function(V,p){this._engine.setDepthStencilTexture(this._samplers[V],this._uniforms[V],p,V)};class j extends E.d{get renderList(){return this._renderList}set renderList(V){this._renderList!==V&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),V&&(this._unObserveRenderList=(0,Q.h)(V,this._renderListHasChanged)),this._renderList=V)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(V){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(V)}set onBeforeRender(V){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(V)}set onAfterRender(V){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(V)}set onClear(V){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(V)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(V,p){let W;W=Array.isArray(V)?V:[V];for(let N=0;N<W.length;++N)for(let V=0;V<this._renderPassIds.length;++V)W[N].setMaterialForRenderPass(this._renderPassIds[V],void 0!==p?Array.isArray(p)?p[V]:p:void 0)}get isMulti(){var V;return(null===(V=this._renderTarget)||void 0===V?void 0:V.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(V){if(this._boundingBoxSize&&this._boundingBoxSize.equals(V))return;this._boundingBoxSize=V;const p=this.va();p&&p.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var V;return(null===(V=this._renderTarget)||void 0===V?void 0:V._depthStencilTexture)??null}constructor(V,p,W){let z,Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:E.d.TRILINEAR_SAMPLINGMODE,k=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],u=arguments.length>9&&void 0!==arguments[9]&&arguments[9],f=arguments.length>10&&void 0!==arguments[10]&&arguments[10],O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,U=arguments.length>12&&void 0!==arguments[12]&&arguments[12],F=arguments.length>13?arguments[13]:void 0,C=arguments.length>14?arguments[14]:void 0,A=arguments.length>15&&void 0!==arguments[15]&&arguments[15],v=arguments.length>16&&void 0!==arguments[16]&&arguments[16],t=!0;if("object"===typeof Q){const V=Q;Q=!!V.generateMipMaps,J=V.doNotChangeAspectRatio??!0,i=V.type??0,l=!!V.isCube,j=V.samplingMode??E.d.TRILINEAR_SAMPLINGMODE,k=V.generateDepthBuffer??!0,u=!!V.generateStencilBuffer,f=!!V.isMulti,O=V.format??5,U=!!V.delayAllocation,F=V.samples,C=V.creationFlags,A=!!V.noColorAttachment,v=!!V.useSRGBBuffer,z=V.colorAttachment,t=V.gammaSpace??t}if(super(null,W,!Q,void 0,j,void 0,void 0,void 0,void 0,O),this._unObserveRenderList=null,this._renderListHasChanged=(V,p)=>{const W=this._renderList?this._renderList.length:0;var N;(0===p&&W>0||0===W)&&(null===(N=this.va())||void 0===N||N.meshes.forEach((V=>{V._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new N.b,this.onAfterUnbindObservable=new N.b,this.onBeforeRenderObservable=new N.b,this.onAfterRenderObservable=new N.b,this.onClearObservable=new N.b,this.onResizeObservable=new N.b,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=d.n.Zero(),this._dumpToolsLoading=!1,!(W=this.va()))return;const e=this.va().getEngine();this._gammaSpace=t,this._coordinatesMode=E.d.PROJECTION_MODE,this.renderList=[],this.name=V,this.isRenderTarget=!0,this._initialSizeParameter=p,this._renderPassIds=[],this._isCubeData=l,this._processSizeParameter(p),this.renderPassId=this._renderPassIds[0],this._resizeObserver=e.onResizeObservable.add((()=>{})),this._generateMipMaps=!!Q,this._doNotChangeAspectRatio=J,this._renderingManager=new S.e(W),this._renderingManager._useSceneAutoClearSetup=!0,f||(this._renderTargetOptions={generateMipMaps:Q,type:i,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:k,generateStencilBuffer:u,samples:F,creationFlags:C,noColorAttachment:A,useSRGBBuffer:v,colorAttachment:z,label:this.name},this.samplingMode===E.d.NEAREST_SAMPLINGMODE&&(this.wrapU=E.d.CLAMP_ADDRESSMODE,this.wrapV=E.d.CLAMP_ADDRESSMODE),U||(l?(this._renderTarget=W.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=E.d.INVCUBIC_MODE,this._textureMatrix=d.e.Identity()):this._renderTarget=W.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==F&&(this.samples=F)))}createDepthStencilTexture(){var V;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,z=arguments.length>5?arguments[5]:void 0;null===(V=this._renderTarget)||void 0===V||V.createDepthStencilTexture(p,W,N,d,E,z)}_releaseRenderPassId(){if(this._scene){const V=this._scene.getEngine();for(let p=0;p<this._renderPassIds.length;++p)V.releaseRenderPassId(this._renderPassIds[p])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const V=this._scene.getEngine(),p=this._isCubeData?6:this.getRenderLayers()||1;for(let W=0;W<p;++W)this._renderPassIds[W]=V.createRenderPassId(`RenderTargetTexture - ${this.name}#${W}`)}_processSizeParameter(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(V.ratio){this._sizeRatio=V.ratio;const p=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(p.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(p.getRenderHeight(),this._sizeRatio)}}else this._size=V;p&&this._createRenderPassId()}get samples(){var V;return(null===(V=this._renderTarget)||void 0===V?void 0:V.samples)??this._samples}set samples(V){this._renderTarget&&(this._samples=this._renderTarget.setSamples(V))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(V){this._refreshRate=V,this.resetRefreshCounter()}addPostProcess(V){if(!this._postProcessManager){const V=this.va();if(!V)return;this._postProcessManager=new z.c(V),this._postProcesses=new Array}this._postProcesses.push(V),this._postProcesses[0].Ii=!1}clearPostProcesses(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(V)for(const V of this._postProcesses)V.dispose();this._postProcesses=[]}}removePostProcess(V){if(!this._postProcesses)return;const p=this._postProcesses.indexOf(V);-1!==p&&(this._postProcesses.splice(p,1),this._postProcesses.length>0&&(this._postProcesses[0].Ii=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const V=this._size.layers;if(V)return V;const p=this._size.depth;return p||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(V){const p=Math.max(1,this.getRenderSize()*V);this.resize(p)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(V){var p;const W=this.isCube;null===(p=this._renderTarget)||void 0===p||p.dispose(),this._renderTarget=null;const N=this.va();N&&(this._processSizeParameter(V,!1),this._renderTarget=W?N.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):N.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(V,p)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(W.bind(W,12555)).then((V=>this._dumpTools=V))),this._render(!1,!1,!0)}_render(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=this.va();if(!N)return W;const d=N.getEngine();if(void 0!==this.useCameraPostProcesses&&(V=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let V=0;V<this._waitingRenderList.length;V++){const p=this._waitingRenderList[V],W=N.getMeshById(p);W&&this.renderList.push(W)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const V=this.va();if(!V)return W;const p=V.meshes;for(let W=0;W<p.length;W++){const V=p[W];this.renderListPredicate(V)&&this.renderList.push(V)}}const E=d.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const z=this.activeCamera??N.activeCamera,S=N.activeCamera;z&&(z!==N.activeCamera&&(N.setTransformMatrix(z.getViewMatrix(),z.getProjectionMatrix(!0)),N.activeCamera=z),d.setViewport(z.rigParent?z.rigParent.viewport:z.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let Q=W;if(W){N.getViewMatrix()||N.updateTransformMatrix();const V=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let E=0;E<V&&Q;E++){let V=null;const p=this.renderList?this.renderList:N.getActiveMeshes().data,z=this.renderList?this.renderList.length:N.getActiveMeshes().length;d.currentRenderPassId=this._renderPassIds[E],this.onBeforeRenderObservable.notifyObservers(E),this.getCustomRenderList&&(V=this.getCustomRenderList(E,p,z)),V||(V=p),this._doNotChangeAspectRatio||N.updateTransformMatrix(!0);for(let N=0;N<V.length&&Q;++N){const p=V[N];if(p.isEnabled()&&!p.isBlocked&&p.isVisible&&p.dg)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(p,this.refreshRate,W)){Q=!1;continue}}else if(!p.isReady(!0)){Q=!1;continue}}this.onAfterRenderObservable.notifyObservers(E),(this.is2DArray||this.is3D||this.isCube)&&(N.incrementRenderId(),N.resetCachedMaterial())}const p=this.particleSystemList||N.fj;for(const W of p)W.isReady()||(Q=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let J=0;J<6;J++)this._renderToTarget(J,V,p,void 0,z),N.incrementRenderId(),N.resetCachedMaterial();else this._renderToTarget(0,V,p,void 0,z);else for(let J=0;J<this.getRenderLayers();J++)this._renderToTarget(0,V,p,J,z),N.incrementRenderId(),N.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),d.currentRenderPassId=E,N.activeCamera=S,S&&(this.activeCamera&&this.activeCamera!==N.activeCamera&&N.setTransformMatrix(S.getViewMatrix(),S.getProjectionMatrix(!0)),d.setViewport(S.viewport)),N.resetCachedMaterial(),Q}_bestReflectionRenderTargetDimension(V,p){const W=V*p,N=(0,J.q)(W+16384/(128+W));return Math.min((0,J.e)(V),N)}_prepareRenderingManager(V,p,W,N){const d=this.va();if(!d)return;this._renderingManager.reset();const E=d.getRenderId();for(let S=0;S<p;S++){const p=V[S];if(p&&!p.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(p,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!p.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!p._internalAbstractMeshDataInfo._currentLODIsUpToDate&&W&&(p._internalAbstractMeshDataInfo._currentLOD=d.customLODSelector?d.customLODSelector(p,W):p.getLOD(W),p._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!p._internalAbstractMeshDataInfo._currentLOD)continue;let V,z=p._internalAbstractMeshDataInfo._currentLOD;if(z!==p&&0!==z.billboardMode&&z.Dj(),z._preActivateForIntermediateRendering(E),V=!(!N||!W)&&0===(p.layerMask&W.layerMask),p.isEnabled()&&p.isVisible&&p.dg&&!V){if(z!==p&&z._activate(E,!0),p._activate(E,!0)&&p.dg.length){p.isAnInstance?p._internalAbstractMeshDataInfo._actAsRegularMesh&&(z=p):z._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,z._internalAbstractMeshDataInfo._isActiveIntermediate=!0,d._prepareSkeleton(z);for(let V=0;V<z.dg.length;V++){const p=z.dg[V];this._renderingManager.dispatch(p,z)}}p._postActivate()}}}const z=this.particleSystemList||d.fj;for(let S=0;S<z.length;S++){const V=z[S],p=V.j;V.isStarted()&&p&&(!p.position||p.isEnabled())&&this._renderingManager.dispatchParticles(V)}}_bindFrameBuffer(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=this.va();if(!W)return;const N=W.getEngine();this._renderTarget&&N.bindFramebuffer(this._renderTarget,this.isCube?V:void 0,void 0,void 0,this.ignoreCameraViewport,0,p)}_unbindFrameBuffer(V,p){this._renderTarget&&V.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(p)}))}_prepareFrame(V,p,W,N){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):N&&V.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(p,W)}_renderToTarget(V,p,W){var N,d;let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const S=this.va();if(!S)return;const Q=S.getEngine();this._prepareFrame(S,V,E,p),null===(N=Q._debugPushGroup)||void 0===N||N.call(Q,`render to face #${V} layer #${E}`,2),this.is2DArray||this.is3D?(Q.currentRenderPassId=this._renderPassIds[E],this.onBeforeRenderObservable.notifyObservers(E)):(Q.currentRenderPassId=this._renderPassIds[V],this.onBeforeRenderObservable.notifyObservers(V));if(Q.snapshotRendering&&1===Q.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(Q):this.skipInitialClear||Q.clear(this.clearColor||S.clearColor,!0,!0,!0);else{var J;let N=null;const d=this.renderList?this.renderList:S.getActiveMeshes().data,i=this.renderList?this.renderList.length:S.getActiveMeshes().length;this.getCustomRenderList&&(N=this.getCustomRenderList(this.is2DArray||this.is3D?E:V,d,i)),N?this._prepareRenderingManager(N,N.length,z,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(d,i,z,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),N=d);for(const p of S._beforeRenderTargetClearStage)p.action(this,V,E);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(Q):this.skipInitialClear||Q.clear(this.clearColor||S.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||S.updateTransformMatrix(!0);for(const p of S._beforeRenderTargetDrawStage)p.action(this,V,E);this._renderingManager.render(this.customRenderFunction,N,this.renderParticles,this.renderSprites);for(const p of S._afterRenderTargetDrawStage)p.action(this,V,E);const j=(null===(J=this._texture)||void 0===J?void 0:J.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,V,this._postProcesses,this.ignoreCameraViewport):p&&S.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,V);for(const p of S._afterRenderTargetPostProcessStage)p.action(this,V,E);this._texture&&(this._texture.generateMipMaps=j),this._doNotChangeAspectRatio||S.updateTransformMatrix(!0),W&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),Q):l.e.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(d=Q._debugPopGroup)||void 0===d||d.call(Q,2),this._unbindFrameBuffer(Q,V),this._texture&&this.isCube&&5===V&&Q.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(V,p,W,N)}setRenderingAutoClearDepthStencil(V,p){this._renderingManager.setRenderingAutoClearDepthStencil(V,p),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const V=this.getSize(),p=new j(this.name,V,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return p.xe=this.xe,p.level=this.level,p.coordinatesMode=this.coordinatesMode,this.renderList&&(p.renderList=this.renderList.slice(0)),p}serialize(){if(!this.name)return null;const V=super.serialize();if(V.renderTargetSize=this.getRenderSize(),V.renderList=[],this.renderList)for(let p=0;p<this.renderList.length;p++)V.renderList.push(this.renderList[p].id);return V}disposeFramebufferObjects(){var V;null===(V=this._renderTarget)||void 0===V||V.dispose(!0)}releaseInternalTexture(){var V;null===(V=this._renderTarget)||void 0===V||V.releaseTextures(),this._texture=null}dispose(){var V;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const p=this.va();if(!p)return;let W=p.customRenderTargets.indexOf(this);W>=0&&p.customRenderTargets.splice(W,1);for(const N of p.cameras)W=N.customRenderTargets.indexOf(this),W>=0&&N.customRenderTargets.splice(W,1);null===(V=this._renderTarget)||void 0===V||V.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===j.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=j.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}j.REFRESHRATE_RENDER_ONCE=0,j.REFRESHRATE_RENDER_ONEVERYFRAME=1,j.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,E.d._CreateRenderTargetTexture=(V,p,W,N,d)=>new j(V,p,W,N)},11452:(V,p,W)=>{"use strict";W.d(p,{d:()=>C});var N=W(11167),d=W(11175),E=W(10856),z=W(11218),S=W(11454),Q=W(11004),J=W(10887),i=W(10935),l=W(11e3),j=W(11361),k=W(10914);function u(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=p.width,d=p.height;if(V instanceof Float32Array){let p=V.byteLength/V.BYTES_PER_ELEMENT;const W=new Uint8Array(p);for(;--p>=0;){let N=V[p];N<0?N=0:N>1&&(N=1),W[p]=255*N}V=W}const E=document.createElement("canvas");E.width=N,E.height=d;const z=E.getContext("2d");if(!z)return null;const S=z.createImageData(N,d);if(S.data.set(V),z.putImageData(S,0,0),W){const V=document.createElement("canvas");V.width=N,V.height=d;const p=V.getContext("2d");return p?(p.translate(0,d),p.scale(1,-1),p.drawImage(E,0,0),V.toDataURL("image/png")):null}return E.toDataURL("image/png")}function f(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const N=V.getInternalTexture();if(!N)return null;const d=V._readPixelsSync(p,W);return d?u(d,V.getSize(),N.invertY):null}async function O(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const N=V.getInternalTexture();if(!N)return null;const d=await V.readPixels(p,W);return d?u(d,V.getSize(),N.invertY):null}var U=W(11467),F=W(11265);class C extends S.c{static _CreateVideoTexture(V,p,W){arguments.length>5&&void 0!==arguments[5]||C.TRILINEAR_SAMPLINGMODE;throw(0,J.c)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(V){this._isBlocking=V}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(V,p,W,N){let d,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:C.TRILINEAR_SAMPLINGMODE,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],j=arguments.length>9?arguments[9]:void 0,k=arguments.length>10?arguments[10]:void 0,u=arguments.length>11?arguments[11]:void 0,f=arguments.length>12?arguments[12]:void 0,O=arguments.length>13?arguments[13]:void 0;super(p),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new E.b,this._isBlocking=!0,this.name=V||"",this.url=V;let F=!1,A=null,v=!0;"object"===typeof W&&null!==W?(d=W.noMipmap??!1,N=W.invertY??!U.d,z=W.samplingMode??C.TRILINEAR_SAMPLINGMODE,S=W.X??null,Q=W.onError??null,J=W.buffer??null,l=W.deleteBuffer??!1,j=W.format,k=W.mimeType,u=W.loaderOptions,f=W.creationFlags,F=W.useSRGBBuffer??!1,A=W.internalTexture??null,v=W.gammaSpace??v):d=!!W,this._gammaSpace=v,this._noMipmap=d,this._invertY=void 0===N?!U.d:N,this._initialSamplingMode=z,this._buffer=J,this._deleteBuffer=l,this._mimeType=k,this._loaderOptions=u,this._creationFlags=f,this._useSRGBBuffer=F,this._forcedExtension=O,j&&(this._format=j);const t=this.va(),e=this._getEngine();if(!e)return;e.onBeforeTextureInitObservable.notifyObservers(this);const Z=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),S&&S(),!this.isBlocking&&t&&t.resetCachedMaterial()},o=(V,p)=>{this._loadingError=!0,this._errorObject={message:V,exception:p},Q&&Q(V,p),C.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!A)return this._delayedOnLoad=Z,void(this._delayedOnError=o);if(this._texture=A??this._getFromCache(this.url,d,z,this._invertY,F,this.isCube),this._texture)if(this._texture.isReady)i.c.SetImmediate((()=>Z()));else{const V=this._texture.onLoadedObservable.add(Z);this._texture.onErrorObservable.add((p=>{var W;o(p.message,p.exception),null===(W=this._texture)||void 0===W||W.onLoadedObservable.remove(V)}))}else if(t&&t.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=Z,this._delayedOnError=o;else{try{this._texture=e.createTexture(this.url,d,this._invertY,t,z,Z,o,this._buffer,void 0,this._format,this._forcedExtension,k,u,f,F)}catch(K){throw o("error loading",K),K}l&&(this._buffer=null)}}updateURL(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(V=>V.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=V),this.url=V,this._buffer=p,this._forcedExtension=N,this.delayLoadState=4,W&&(this._delayedOnLoad=W),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const V=this.va();V&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?i.c.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=V.getEngine().createTexture(this.url,this._noMipmap,this._invertY,V,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(V,p,W,N){V*=this._cachedUScale,p*=this._cachedVScale,V-=this.uRotationCenter*this._cachedUScale,p-=this.vRotationCenter*this._cachedVScale,W-=this.wRotationCenter,z.n.TransformCoordinatesFromFloatsToRef(V,p,W,this._rowGenerationMatrix,N),N.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,N.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,N.z+=this.wRotationCenter}getTextureMatrix(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*V===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*V,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=z.e.Zero(),this._rowGenerationMatrix=new z.e,this._t0=z.n.Zero(),this._t1=z.n.Zero(),this._t2=z.n.Zero()),z.e.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(z.e.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,z.i.Matrix[0]),z.e.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,z.i.Matrix[1]),z.e.ScalingToRef(this._cachedUScale,this._cachedVScale,0,z.i.Matrix[2]),z.e.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,z.i.Matrix[3]),z.i.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(z.i.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(z.i.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(z.i.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.ei(this._t0),this._t2.ei(this._t0),z.e.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const p=this.va();if(!p)return this._cachedTextureMatrix;const W=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&W!==this._cachedIdentity3x2&&p.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const V=this.va();if(!V)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==C.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===V.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=z.e.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=z.e.Zero());const p=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case C.PLANAR_MODE:z.e.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case C.PROJECTION_MODE:{z.e.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const p=V.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=p.updateFlag,p.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:z.e.IdentityToRef(this._cachedReflectionTextureMatrix)}return p&&V.markAllMaterialsAsDirty(1,(V=>V.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const V={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return F.b.Clone((()=>new C(this._texture?this._texture.url:null,this.va(),V)),this)}serialize(){var V;const p=this.name;C.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const W=super.serialize(C._SerializeInternalTextureUniqueId);if(!W)return null;var N;((C.SerializeBuffers||C.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(W.base64String=this._buffer,W.name=W.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?W.base64String="data:image/png;base64,"+(0,k.k)(this._buffer):(C.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(W.base64String=!this._engine||this._engine._features.supportSyncTextureRead?f(this):O(this))),W.invertY=this._invertY,W.samplingMode=this.samplingMode,W._creationFlags=this._creationFlags,W._useSRGBBuffer=this._useSRGBBuffer,C._SerializeInternalTextureUniqueId)&&(W.internalTextureUniqueId=null===(N=this._texture)||void 0===N?void 0:N.uniqueId);return W.internalTextureLabel=null===(V=this._texture)||void 0===V?void 0:V.label,W.noMipmap=this._noMipmap,this.name=p,W}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(V,p,W){if(V.customType){const N=l.c.Instantiate(V.customType).Parse(V,p,W);return V.samplingMode&&N.updateSamplingMode&&N._samplingMode&&N._samplingMode!==V.samplingMode&&N.updateSamplingMode(V.samplingMode),N}if(V.isCube&&!V.isRenderTarget)return C._CubeTextureParser(V,p,W);const N=void 0!==V.internalTextureUniqueId;if(!V.name&&!V.isRenderTarget&&!N)return null;let d;if(N){const W=p.getEngine().getLoadedTexturesCache();for(const p of W)if(p.uniqueId===V.internalTextureUniqueId){d=p;break}}const E=p=>{if(p&&p._texture&&(p._texture._cachedWrapU=null,p._texture._cachedWrapV=null,p._texture._cachedWrapR=null),V.samplingMode){const W=V.samplingMode;p&&p.samplingMode!==W&&p.updateSamplingMode(W)}if(p&&V.animations)for(let W=0;W<V.animations.length;W++){const N=V.animations[W],d=(0,Q.b)("BABYLON.Animation");d&&p.animations.push(d.Parse(N))}p&&p._texture&&(N&&!d&&p._texture._setUniqueId(V.internalTextureUniqueId),p._texture.label=V.internalTextureLabel)};return F.b.Parse((()=>{let N=!0;if(V.noMipmap&&(N=!1),V.mirrorPlane){const W=C._CreateMirror(V.name,V.renderTargetSize,p,N);return W._waitingRenderList=V.renderList,W.mirrorPlane=j.b.Tg(V.mirrorPlane),E(W),W}if(V.isRenderTarget){let W=null;if(V.isCube){if(p.reflectionProbes)for(let N=0;N<p.reflectionProbes.length;N++){const W=p.reflectionProbes[N];if(W.name===V.name)return W.cubeTexture}}else W=C._CreateRenderTargetTexture(V.name,V.renderTargetSize,p,N,V._creationFlags??0),W._waitingRenderList=V.renderList;return E(W),W}if(V.isVideo){const d=C._CreateVideoTexture(W+(V.url||V.name),W+(V.src||V.url),p,N,V.invertY,V.samplingMode,V.settings||{});return E(d),d}{let z;if(V.base64String&&!d)z=C.CreateFromBase64String(V.base64String,V.base64String,p,!N,V.invertY,V.samplingMode,(()=>{E(z)}),V._creationFlags??0,V._useSRGBBuffer??!1),z.name=V.name;else{let S;S=V.name&&(V.name.indexOf("://")>0||V.name.startsWith("data:"))?V.name:W+V.name,V.url&&(V.url.startsWith("data:")||C.UseSerializedUrlIfAny)&&(S=V.url);const Q={noMipmap:!N,invertY:V.invertY,samplingMode:V.samplingMode,X:()=>{E(z)},internalTexture:d};z=new C(S,p,Q)}return z}}),V,p)}static CreateFromBase64String(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:C.TRILINEAR_SAMPLINGMODE;return new C("data:"+p,W,N,d,E,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4?arguments[4]:void 0,E=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:C.TRILINEAR_SAMPLINGMODE,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,i=arguments.length>10?arguments[10]:void 0,l=arguments.length>11?arguments[11]:void 0;return"data:"!==V.substring(0,5)&&(V="data:"+V),new C(V,W,d,E,z,S,Q,p,N,J,void 0,void 0,i,l)}}C.SerializeBuffers=!0,C.ForceSerializeBuffers=!1,C.OnTextureLoadErrorObservable=new E.b,C._SerializeInternalTextureUniqueId=!1,C._CubeTextureParser=(V,p,W)=>{throw(0,J.c)("CubeTexture")},C._CreateMirror=(V,p,W,N)=>{throw(0,J.c)("MirrorTexture")},C._CreateRenderTargetTexture=(V,p,W,N,d)=>{throw(0,J.c)("RenderTargetTexture")},C.NEAREST_SAMPLINGMODE=1,C.NEAREST_NEAREST_MIPLINEAR=8,C.BILINEAR_SAMPLINGMODE=2,C.LINEAR_LINEAR_MIPNEAREST=11,C.TRILINEAR_SAMPLINGMODE=3,C.LINEAR_LINEAR_MIPLINEAR=3,C.NEAREST_NEAREST_MIPNEAREST=4,C.NEAREST_LINEAR_MIPNEAREST=5,C.NEAREST_LINEAR_MIPLINEAR=6,C.NEAREST_LINEAR=7,C.NEAREST_NEAREST=1,C.LINEAR_NEAREST_MIPNEAREST=9,C.LINEAR_NEAREST_MIPLINEAR=10,C.LINEAR_LINEAR=2,C.LINEAR_NEAREST=12,C.EXPLICIT_MODE=0,C.SPHERICAL_MODE=1,C.PLANAR_MODE=2,C.CUBIC_MODE=3,C.PROJECTION_MODE=4,C.SKYBOX_MODE=5,C.INVCUBIC_MODE=6,C.EQUIRECTANGULAR_MODE=7,C.FIXED_EQUIRECTANGULAR_MODE=8,C.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,C.CLAMP_ADDRESSMODE=0,C.WRAP_ADDRESSMODE=1,C.MIRROR_ADDRESSMODE=2,C.UseSerializedUrlIfAny=!1,(0,N.c)([(0,d.I)()],C.prototype,"url",void 0),(0,N.c)([(0,d.I)()],C.prototype,"uOffset",void 0),(0,N.c)([(0,d.I)()],C.prototype,"vOffset",void 0),(0,N.c)([(0,d.I)()],C.prototype,"uScale",void 0),(0,N.c)([(0,d.I)()],C.prototype,"vScale",void 0),(0,N.c)([(0,d.I)()],C.prototype,"uAng",void 0),(0,N.c)([(0,d.I)()],C.prototype,"vAng",void 0),(0,N.c)([(0,d.I)()],C.prototype,"wAng",void 0),(0,N.c)([(0,d.I)()],C.prototype,"uRotationCenter",void 0),(0,N.c)([(0,d.I)()],C.prototype,"vRotationCenter",void 0),(0,N.c)([(0,d.I)()],C.prototype,"wRotationCenter",void 0),(0,N.c)([(0,d.I)()],C.prototype,"homogeneousRotationInUVTransform",void 0),(0,N.c)([(0,d.I)()],C.prototype,"isBlocking",null),(0,Q.d)("BABYLON.Texture",C),F.b._TextureParser=C.Parse},10990:(V,p,W)=>{"use strict";W.d(p,{b:()=>N});class N{get wrapU(){return this._cachedWrapU}set wrapU(V){this._cachedWrapU=V}get wrapV(){return this._cachedWrapV}set wrapV(V){this._cachedWrapV=V}get wrapR(){return this._cachedWrapR}set wrapR(V){this._cachedWrapR=V}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(V){this._cachedAnisotropicFilteringLevel=V}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(V){this._comparisonFunction=V}get useMipMaps(){return this._useMipMaps}set useMipMaps(V){this._useMipMaps=V}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=V,this._cachedWrapV=p,this._cachedWrapR=W,this._cachedAnisotropicFilteringLevel=N,this.samplingMode=d,this._comparisonFunction=E,this}compareSampler(V){return this._cachedWrapU===V._cachedWrapU&&this._cachedWrapV===V._cachedWrapV&&this._cachedWrapR===V._cachedWrapR&&this._cachedAnisotropicFilteringLevel===V._cachedAnisotropicFilteringLevel&&this.samplingMode===V.samplingMode&&this._comparisonFunction===V._comparisonFunction&&this._useMipMaps===V._useMipMaps}}},11436:(V,p,W)=>{"use strict";function N(V){-1===V.indexOf("vClipPlane")&&V.push("vClipPlane"),-1===V.indexOf("vClipPlane2")&&V.push("vClipPlane2"),-1===V.indexOf("vClipPlane3")&&V.push("vClipPlane3"),-1===V.indexOf("vClipPlane4")&&V.push("vClipPlane4"),-1===V.indexOf("vClipPlane5")&&V.push("vClipPlane5"),-1===V.indexOf("vClipPlane6")&&V.push("vClipPlane6")}function d(V,p,W){const N=!!(V.clipPlane??p.clipPlane),d=!!(V.clipPlane2??p.clipPlane2),E=!!(V.clipPlane3??p.clipPlane3),z=!!(V.clipPlane4??p.clipPlane4),S=!!(V.clipPlane5??p.clipPlane5),Q=!!(V.clipPlane6??p.clipPlane6);N&&W.push("#define CLIPPLANE"),d&&W.push("#define CLIPPLANE2"),E&&W.push("#define CLIPPLANE3"),z&&W.push("#define CLIPPLANE4"),S&&W.push("#define CLIPPLANE5"),Q&&W.push("#define CLIPPLANE6")}function E(V,p,W){let N=!1;const d=!!(V.clipPlane??p.clipPlane),E=!!(V.clipPlane2??p.clipPlane2),z=!!(V.clipPlane3??p.clipPlane3),S=!!(V.clipPlane4??p.clipPlane4),Q=!!(V.clipPlane5??p.clipPlane5),J=!!(V.clipPlane6??p.clipPlane6);return W.CLIPPLANE!==d&&(W.CLIPPLANE=d,N=!0),W.CLIPPLANE2!==E&&(W.CLIPPLANE2=E,N=!0),W.CLIPPLANE3!==z&&(W.CLIPPLANE3=z,N=!0),W.CLIPPLANE4!==S&&(W.CLIPPLANE4=S,N=!0),W.CLIPPLANE5!==Q&&(W.CLIPPLANE5=Q,N=!0),W.CLIPPLANE6!==J&&(W.CLIPPLANE6=J,N=!0),N}function z(V,p,W){let N=p.clipPlane??W.clipPlane;S(V,"vClipPlane",N),N=p.clipPlane2??W.clipPlane2,S(V,"vClipPlane2",N),N=p.clipPlane3??W.clipPlane3,S(V,"vClipPlane3",N),N=p.clipPlane4??W.clipPlane4,S(V,"vClipPlane4",N),N=p.clipPlane5??W.clipPlane5,S(V,"vClipPlane5",N),N=p.clipPlane6??W.clipPlane6,S(V,"vClipPlane6",N)}function S(V,p,W){W&&V.setFloat4(p,W.k.x,W.k.y,W.k.z,W.d)}W.d(p,{b:()=>N,e:()=>z,i:()=>E,l:()=>d})},11267:(V,p,W)=>{"use strict";function N(V){V.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}W.d(p,{b:()=>N})},11709:(V,p,W)=>{"use strict";function N(V){return void 0===V.getPipelineContext}W.d(p,{d:()=>N})},11431:(V,p,W)=>{"use strict";W.d(p,{e:()=>N});class N{static GetEffect(V){return void 0===V.getPipelineContext?V.effect:V}constructor(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=V.createDrawContext(),p&&(this.materialContext=V.createMaterialContext())}setEffect(V,p){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var N;(this.effect=V,void 0!==p&&(this.defines=p),W)&&(null===(N=this.drawContext)||void 0===N||N.reset())}dispose(){var V;null===(V=this.drawContext)||void 0===V||V.dispose()}}},10961:(V,p,W)=>{"use strict";W.d(p,{b:()=>l,f:()=>k,j:()=>J,m:()=>i});var N=W(10862),d=W(10967),E=W(10952),z=W(10870),S=W(10923),Q=W(10927);function J(V,p){return(0,d.z)(p).cachedPipelines[V]}function i(V){const p=V._name,W=V.context;if(p&&W){const V=(0,d.z)(W),N=V.cachedPipelines[p];null===N||void 0===N||N.dispose(),delete V.cachedPipelines[p]}}function l(V,p,W,d,E,z,Q){let J,i;const l=(0,N.l)()?null===z||void 0===z?void 0:z.getHostDocument():null;J="string"===typeof p?p:p.vertexSource?"source:"+p.vertexSource:p.vertexElement?(null===l||void 0===l?void 0:l.getElementById(p.vertexElement))||p.vertexElement:p.vertex||p,i="string"===typeof p?p:p.fragmentSource?"source:"+p.fragmentSource:p.fragmentElement?(null===l||void 0===l?void 0:l.getElementById(p.fragmentElement))||p.fragmentElement:p.fragment||p;const k=[void 0,void 0],u=()=>{if(k[0]&&k[1]){V.isFragment=!0;const[N,J]=k;(0,S.g)(J,V,((z,J)=>{Q&&(Q._fragmentSourceCodeBeforeMigration=J),W&&(z=W("fragment",z));const i=(0,S.d)(N,z,V);V=null;const l=function(V,p,W,N){if(W){return{vertexSourceCode:(1===N?"//":"")+"#define SHADER_NAME vertex:"+(W.vertexElement||W.vertex||W.spectorName||W)+"\n"+V,fragmentSourceCode:(1===N?"//":"")+"#define SHADER_NAME fragment:"+(W.fragmentElement||W.fragment||W.spectorName||W)+"\n"+p}}return{vertexSourceCode:V,fragmentSourceCode:p}}(i.vertexCode,i.fragmentCode,p,E);null===d||void 0===d||d(l.vertexSourceCode,l.fragmentSourceCode)}),z)}};j(J,"Vertex","",(p=>{(0,S.e)(V),(0,S.g)(p,V,((V,N)=>{Q&&(Q._rawVertexSourceCode=p,Q._vertexSourceCodeBeforeMigration=N),W&&(V=W("vertex",V)),k[0]=V,u()}),z)}),E),j(i,"Fragment","Pixel",(V=>{Q&&(Q._rawFragmentSourceCode=V),k[1]=V,u()}),E)}function j(V,p,W,d,z,S){if("undefined"!==typeof HTMLElement&&V instanceof HTMLElement){return void d((0,N.e)(V))}if("source:"===V.substring(0,7))return void d(V.substring(7));if("base64:"===V.substring(0,7)){return void d(window.atob(V.substring(7)))}const J=E.b.GetShadersStore(z);if(J[V+p+"Shader"])return void d(J[V+p+"Shader"]);if(W&&J[V+W+"Shader"])return void d(J[V+W+"Shader"]);let i;if(i="."===V[0]||"/"===V[0]||V.indexOf("http")>-1?V:E.b.GetShadersRepository(z)+V,!(S=S||Q.k))throw new Error("loadFileInjection is not defined");S(i+"."+p.toLowerCase()+".fx",d)}const k=(V,p,W,N)=>{try{const E=V.existingPipelineContext||p(V.shaderProcessingContext);if(E._name=V.name,V.name&&V.context){(0,d.z)(V.context).cachedPipelines[V.name]=E}return W(E,V.vertex,V.fragment,!!V.createAsRaw,"","",V.rebuildRebind,V.defines,V.transformFeedbackVaryings,"",(()=>{N(E,(()=>{var p;null===(p=V.onRenderingStateCompiled)||void 0===p||p.call(V,E)}))})),E}catch(E){throw z.e.Error("Error compiling effect"),E}}},10948:(V,p,W)=>{"use strict";W.d(p,{e:()=>S});var N=W(10856),d=W(10870),E=W(10952),z=W(10961);class S{static get ShadersRepository(){return E.b.ShadersRepository}static set ShadersRepository(V){E.b.ShadersRepository=V}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new N.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(V,p,W){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,j=arguments.length>9?arguments[9]:void 0,k=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,f=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new N.b,this.onErrorObservable=new N.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=V,this._key=k;const O=this._key.replace(/\r/g,"").replace(/\n/g,"|");let U;if(p.attributes){const V=p;if(this._engine=W,this._attributesNames=V.attributes,this._uniformsNames=V.uniformsNames.concat(V.samplers),this._samplerList=V.samplers.slice(),this.defines=V.defines,this.onError=V.onError,this.onCompiled=V.onCompiled,this._fallbacks=V.fallbacks,this._indexParameters=V.indexParameters,this._transformFeedbackVaryings=V.transformFeedbackVaryings||null,this._multiTarget=!!V.multiTarget,this._shaderLanguage=V.shaderLanguage??0,V.uniformBuffersNames){this._uniformBuffersNamesList=V.uniformBuffersNames.slice();for(let p=0;p<V.uniformBuffersNames.length;p++)this._uniformBuffersNames[V.uniformBuffersNames[p]]=p}this._processFinalCode=V.processFinalCode??null,this._processCodeAfterIncludes=V.processCodeAfterIncludes??void 0,U=V.existingPipelineContext}else this._engine=E,this.defines=null==Q?"":Q,this._uniformsNames=W.concat(d),this._samplerList=d?d.slice():[],this._attributesNames=p,this._uniformBuffersNamesList=[],this._shaderLanguage=u,this.onError=l,this.onCompiled=i,this._indexParameters=j,this._fallbacks=J;"WEBGL2"===this._engine.shaderPlatformName&&(U=(0,z.j)(O,this._engine._gl)??U),this._attributeLocationByName={},this.uniqueId=S._UniqueIdSeed++,U?(this._pipelineContext=U,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,f)}async _processShaderCodeAsync(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3?arguments[3]:void 0;N&&await N(),this._processingContext=W||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const d={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:V??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:E.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:E.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,z.b)(d,this.name,this._processFinalCode,((V,W)=>{this._vertexSourceCode=V,this._fragmentSourceCode=W,this._prepareEffect(p)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(V){return this._attributes[V]}getAttributeLocationByName(V){return this._attributeLocationByName[V]}getAttributesCount(){return this._attributes.length}getUniformIndex(V){return this._uniformsNames.indexOf(V)}getUniform(V){return this._uniforms[V]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(V){this.isReady()?V(this):(this.onCompileObservable.add((p=>{V(p)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(V){try{if(this._isReadyInternal())return}catch(p){return void this._processCompilationErrors(p,V)}this._isDisposed||setTimeout((()=>{this._checkIsReady(V)}),16)}get vertexSourceCode(){var V;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(V=this._pipelineContext)||void 0===V?void 0:V._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var V;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(V=this._pipelineContext)||void 0===V?void 0:V._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(V,p,W,N){this._isReady=!1,this._vertexSourceCodeOverride=V,this._fragmentSourceCodeOverride=p,this.onError=(V,p)=>{N&&N(p)},this.onCompiled=()=>{var V,p;const N=this.getEngine().scenes;if(N)for(let W=0;W<N.length;W++)N[W].markAllMaterialsAsDirty(63);null===(V=(p=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===V||V.call(p,W)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(V){if(this._pipelineContext=V,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let p=0;p<this._attributesNames.length;p++){const V=this._attributesNames[p];this._attributeLocationByName[V]=this._attributes[p]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),S.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=this._pipelineContext;this._isReady=!1;try{const W=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),N=W?null:this.defines,d=W?this._vertexSourceCodeOverride:this._vertexSourceCode,E=W?this._fragmentSourceCodeOverride:this._fragmentSourceCode,S=this._engine;this._pipelineContext=(0,z.f)({existingPipelineContext:V?p:null,vertex:d,fragment:E,context:"WEBGL2"===S.shaderPlatformName?S._gl:void 0,rebuildRebind:(V,p,W,N)=>this._rebuildProgram(V,p,W,N),defines:N,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:W,parallelShaderCompile:S._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:W=>{p&&!V&&this._engine._deletePipelineContext(p),W&&this._onRenderingStateCompiled(W)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(p)}catch(W){this._processCompilationErrors(W,p)}}_getShaderCodeAndErrorLine(V,p,W){const N=W?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let d=null;if(p&&V){const E=p.match(N);if(E&&2===E.length){const p=parseInt(E[1]),N=V.split("\n",-1);N.length>=p&&(d=`Offending line [${p}] in ${W?"fragment":"vertex"} code: ${N[p-1]}`)}}return[V,d]}_processCompilationErrors(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=V.message;const W=this._attributesNames,N=this._fallbacks;if(d.e.Error("Unable to compile effect:"),d.e.Error("Uniforms: "+this._uniformsNames.map((function(V){return" "+V}))),d.e.Error("Attributes: "+W.map((function(V){return" "+V}))),d.e.Error("Defines:\n"+this.defines),S.LogShaderCodeOnCompilationError){var E,z;let V=null,p=null,W=null;var Q;if(null!==(E=this._pipelineContext)&&void 0!==E&&E._getVertexShaderCode()&&([W,V]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),W&&(d.e.Error("Vertex code:"),d.e.Error(W))),null!==(z=this._pipelineContext)&&void 0!==z&&z._getFragmentShaderCode())[W,p]=this._getShaderCodeAndErrorLine(null===(Q=this._pipelineContext)||void 0===Q?void 0:Q._getFragmentShaderCode(),this._compilationError,!0),W&&(d.e.Error("Fragment code:"),d.e.Error(W));V&&d.e.Error(V),p&&d.e.Error(p)}d.e.Error("Error: "+this._compilationError);const J=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};p&&(this._pipelineContext=p,this._isReady=!0,J()),N?(this._pipelineContext=null,N.hasMoreFallbacks?(this._allFallbacksProcessed=!1,d.e.Error("Trying next fallback."),this.defines=N.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,J(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,p||J())}get isSupported(){return""===this._compilationError}_bindTexture(V,p){this._engine._bindTexture(this._samplers[V],p,V)}setTexture(V,p){this._engine.setTexture(this._samplers[V],this._uniforms[V],p,V)}setTextureArray(V,p){const W=V+"Ex";if(-1===this._samplerList.indexOf(W+"0")){const N=this._samplerList.indexOf(V);for(let V=1;V<p.length;V++){const p=W+(V-1).toString();this._samplerList.splice(N+V,0,p)}let d=0;for(const V of this._samplerList)this._samplers[V]=d,d+=1}this._engine.setTextureArray(this._samplers[V],this._uniforms[V],p,V)}bindUniformBuffer(V,p){const W=this._uniformBuffersNames[p];void 0===W||S._BaseCache[W]===V&&this._engine._features.useUBOBindingCache||(S._BaseCache[W]=V,this._engine.bindUniformBufferBase(V,W,p))}bindUniformBlock(V,p){this._engine.bindUniformBlock(this._pipelineContext,V,p)}setInt(V,p){return this._pipelineContext.setInt(V,p),this}setInt2(V,p,W){return this._pipelineContext.setInt2(V,p,W),this}setInt3(V,p,W,N){return this._pipelineContext.setInt3(V,p,W,N),this}setInt4(V,p,W,N,d){return this._pipelineContext.setInt4(V,p,W,N,d),this}setIntArray(V,p){return this._pipelineContext.setIntArray(V,p),this}setIntArray2(V,p){return this._pipelineContext.setIntArray2(V,p),this}setIntArray3(V,p){return this._pipelineContext.setIntArray3(V,p),this}setIntArray4(V,p){return this._pipelineContext.setIntArray4(V,p),this}setUInt(V,p){return this._pipelineContext.setUInt(V,p),this}setUInt2(V,p,W){return this._pipelineContext.setUInt2(V,p,W),this}setUInt3(V,p,W,N){return this._pipelineContext.setUInt3(V,p,W,N),this}setUInt4(V,p,W,N,d){return this._pipelineContext.setUInt4(V,p,W,N,d),this}setUIntArray(V,p){return this._pipelineContext.setUIntArray(V,p),this}setUIntArray2(V,p){return this._pipelineContext.setUIntArray2(V,p),this}setUIntArray3(V,p){return this._pipelineContext.setUIntArray3(V,p),this}setUIntArray4(V,p){return this._pipelineContext.setUIntArray4(V,p),this}setFloatArray(V,p){return this._pipelineContext.setArray(V,p),this}setFloatArray2(V,p){return this._pipelineContext.setArray2(V,p),this}setFloatArray3(V,p){return this._pipelineContext.setArray3(V,p),this}setFloatArray4(V,p){return this._pipelineContext.setArray4(V,p),this}setArray(V,p){return this._pipelineContext.setArray(V,p),this}setArray2(V,p){return this._pipelineContext.setArray2(V,p),this}setArray3(V,p){return this._pipelineContext.setArray3(V,p),this}setArray4(V,p){return this._pipelineContext.setArray4(V,p),this}setMatrices(V,p){return this._pipelineContext.setMatrices(V,p),this}setMatrix(V,p){return this._pipelineContext.setMatrix(V,p),this}setMatrix3x3(V,p){return this._pipelineContext.setMatrix3x3(V,p),this}setMatrix2x2(V,p){return this._pipelineContext.setMatrix2x2(V,p),this}setFloat(V,p){return this._pipelineContext.setFloat(V,p),this}setBool(V,p){return this._pipelineContext.setInt(V,p?1:0),this}setVector2(V,p){return this._pipelineContext.setVector2(V,p),this}setFloat2(V,p,W){return this._pipelineContext.setFloat2(V,p,W),this}setVector3(V,p){return this._pipelineContext.setVector3(V,p),this}setFloat3(V,p,W,N){return this._pipelineContext.setFloat3(V,p,W,N),this}setVector4(V,p){return this._pipelineContext.setVector4(V,p),this}setQuaternion(V,p){return this._pipelineContext.setQuaternion(V,p),this}setFloat4(V,p,W,N,d){return this._pipelineContext.setFloat4(V,p,W,N,d),this}setColor3(V,p){return this._pipelineContext.setColor3(V,p),this}setColor4(V,p,W){return this._pipelineContext.setColor4(V,p,W),this}setDirectColor4(V,p){return this._pipelineContext.setDirectColor4(V,p),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,z.m)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;p&&(E.b.GetShadersStore(N)[`${V}PixelShader`]=p),W&&(E.b.GetShadersStore(N)[`${V}VertexShader`]=W)}static ResetCache(){S._BaseCache={}}}S.LogShaderCodeOnCompilationError=!0,S.AutomaticallyClearCodeCache=!1,S._UniqueIdSeed=0,S._BaseCache={},S.ShadersStore=E.b.ShadersStore,S.IncludesShadersStore=E.b.IncludesShadersStore},11479:(V,p,W)=>{"use strict";W.d(p,{b:()=>N});class N{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(V,p){this._defines[V]||(V<this._currentRank&&(this._currentRank=V),V>this._maxRank&&(this._maxRank=V),this._defines[V]=new Array),this._defines[V].push(p)}addCPUSkinningFallback(V,p){this._mesh=p,V<this._currentRank&&(this._currentRank=V),V>this._maxRank&&(this._maxRank=V)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(V,p){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,V=V.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),p._bonesComputationForcedToCPU=!0;const W=this._mesh.va();for(let V=0;V<W.meshes.length;V++){const N=W.meshes[V];if(N.material){if(N.computeBonesUsingShaders&&0!==N.numBoneInfluencers)if(N.material.getEffect()===p)N.computeBonesUsingShaders=!1;else if(N.dg)for(const V of N.dg){if(V.effect===p){N.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&N.computeBonesUsingShaders&&N.numBoneInfluencers>0&&(N.computeBonesUsingShaders=!1)}}else{const p=this._defines[this._currentRank];if(p)for(let W=0;W<p.length;W++)V=V.replace("#define "+p[W],"");this._currentRank++}return V}}},11799:(V,p,W)=>{"use strict";W.d(p,{b:()=>J,d:()=>i});var N=W(11291),d=W(11538),E=W(10856),z=W(10948),S=W(11431);W(11808);const Q={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class J{constructor(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q;this._fullscreenViewport=new d.d(0,0,1,1);const W=p.xa??Q.xa,E=p.indices??Q.indices;this.Ed=V,this._vertexBuffers={[N.f.PositionKind]:new N.f(V,W,N.f.PositionKind,!1,!1,2)},this._indexBuffer=V.createIndexBuffer(E),this._onContextRestoredObserver=V.onContextRestoredObservable.add((()=>{this._indexBuffer=V.createIndexBuffer(E);for(const V in this._vertexBuffers){this._vertexBuffers[V]._rebuild()}}))}setViewport(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.Ed.setViewport(V)}bindBuffers(V){this.Ed.bindBuffers(this._vertexBuffers,this._indexBuffer,V)}applyEffectWrapper(V){this.Ed.setState(!0),this.Ed.depthCullingState.depthTest=!1,this.Ed.stencilState.stencilTest=!1,this.Ed.enableEffect(V.drawWrapper),this.bindBuffers(V.effect),V.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.Ed.depthCullingState.depthTest,this._savedStateStencilTest=this.Ed.stencilState.stencilTest}restoreStates(){this.Ed.depthCullingState.depthTest=this._savedStateDepthTest,this.Ed.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.Ed.drawElementsType(0,0,6)}_isRenderTargetTexture(V){return void 0!==V.renderTarget}render(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!V.effect.isReady())return;this.saveStates(),this.setViewport();const W=null===p?null:this._isRenderTargetTexture(p)?p.renderTarget:p;W&&this.Ed.bindFramebuffer(W),this.applyEffectWrapper(V),this.draw(),W&&this.Ed.unBindFramebuffer(W),this.restoreStates()}dispose(){const V=this._vertexBuffers[N.f.PositionKind];V&&(V.dispose(),delete this._vertexBuffers[N.f.PositionKind]),this._indexBuffer&&this.Ed._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.Ed.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class i{static RegisterShaderCodeProcessing(V,p){p?i._CustomShaderCodeProcessing[V??""]=p:delete i._CustomShaderCodeProcessing[V??""]}static _GetShaderCodeProcessing(V){return i._CustomShaderCodeProcessing[V]??i._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(V){this.options.name=V}isReady(){var V;return(null===(V=this._drawWrapper.effect)||void 0===V?void 0:V.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(V){this._drawWrapper.effect=V}constructor(V){this.alphaMode=0,this.onEffectCreatedObservable=new E.b(void 0,!0),this.onApplyObservable=new E.b,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...V,name:V.name||"effectWrapper",Ed:V.Ed,uniforms:V.uniforms||V.uniformNames||[],uniformNames:void 0,samplers:V.samplers||V.samplerNames||[],samplerNames:void 0,attributeNames:V.attributeNames||["position"],uniformBuffers:V.uniformBuffers||[],defines:V.defines||"",useShaderStore:V.useShaderStore||!1,vertexUrl:V.vertexUrl||V.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:V.fragmentShader||"pass",indexParameters:V.indexParameters,blockCompilation:V.blockCompilation||!1,shaderLanguage:V.shaderLanguage||0,onCompiled:V.onCompiled||void 0,extraInitializations:V.extraInitializations||void 0,extraInitializationsAsync:V.extraInitializationsAsync||void 0,useAsPostProcess:V.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),V.vertexUrl||V.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.Ed.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new S.e(this.options.Ed),this._webGPUReady=1===this.options.shaderLanguage;const p=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,p,this.options.extraInitializations)}_gatherImports(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(V&&this._webGPUReady?p.push(Promise.all([W.e(37).then(W.bind(W,13758))])):p.push(Promise.all([Promise.resolve().then(W.bind(W,11808))])))}_postConstructor(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,N&&this._importPromises.push(...N);const d=this.options.Ed.isWebGPU&&!i.ForceGLSL;this._gatherImports(d,this._importPromises),void 0!==W&&W(d,this._importPromises),d&&this._webGPUReady&&(this.options.shaderLanguage=1),V||this.updateEffect(p)}updateEffect(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7?arguments[7]:void 0;const J=i._GetShaderCodeProcessing(this.name);if(null!==J&&void 0!==J&&J.defineCustomBindings){var l,j;const N=(null===(l=p)||void 0===l?void 0:l.slice())??[];N.push(...this.options.uniforms);const d=(null===(j=W)||void 0===j?void 0:j.slice())??[];d.push(...this.options.samplers),V=J.defineCustomBindings(this.name,V,N,d),p=N,W=d}this.options.defines=V||"";const k=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let u;u=this.options.extraInitializationsAsync?async()=>{null===k||void 0===k||k(),await this.options.extraInitializationsAsync}:k,this.options.useShaderStore?this._drawWrapper.effect=this.options.Ed.createEffect({vertex:S??this._shaderPath.vertex,fragment:Q??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:p||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:W||this.options.samplers,defines:null!==V?V:"",fallbacks:null,onCompiled:d??this.options.onCompiled,onError:E??null,indexParameters:N||this.options.indexParameters,processCodeAfterIncludes:null!==J&&void 0!==J&&J.processCodeAfterIncludes?(V,p)=>J.processCodeAfterIncludes(this.name,V,p):null,processFinalCode:null!==J&&void 0!==J&&J.processFinalCode?(V,p)=>J.processFinalCode(this.name,V,p):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:u},this.options.Ed):this._drawWrapper.effect=new z.e(this._shaderPath,this.options.attributeNames,p||this.options.uniforms,W||this.options.samplerNames,this.options.Ed,V,void 0,d||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,u),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var V,p;this.options.useAsPostProcess&&(this.options.Ed.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(V=i._GetShaderCodeProcessing(this.name))||void 0===V||null===(p=V.bindCustomBindings)||void 0===p||p.call(V,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}i.ForceGLSL=!1,i._CustomShaderCodeProcessing={}},11276:(V,p,W)=>{"use strict";W.d(p,{e:()=>E,f:()=>d});var N=W(11267);function d(V,p){p.EXPOSURE&&V.push("exposureLinear"),p.CONTRAST&&V.push("contrast"),p.COLORGRADING&&V.push("colorTransformSettings"),(p.VIGNETTE||p.DITHER)&&V.push("vInverseScreenSize"),p.VIGNETTE&&(V.push("vignetteSettings1"),V.push("vignetteSettings2")),p.COLORCURVES&&(0,N.b)(V),p.DITHER&&V.push("ditherIntensity")}function E(V,p){p.COLORGRADING&&V.push("txColorTransform")}},11251:(V,p,W)=>{"use strict";W.d(p,{c:()=>k});var N=W(11167),d=W(11175),E=W(10856),z=W(11257),S=W(11265),Q=W(11267);class J{constructor(){this._dirty=!0,this._tempColor=new z.e(0,0,0,0),this._globalCurve=new z.e(0,0,0,0),this._highlightsCurve=new z.e(0,0,0,0),this._midtonesCurve=new z.e(0,0,0,0),this._shadowsCurve=new z.e(0,0,0,0),this._positiveCurve=new z.e(0,0,0,0),this._negativeCurve=new z.e(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(V){this._globalHue=V,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(V){this._globalDensity=V,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(V){this._globalSaturation=V,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(V){this._globalExposure=V,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(V){this._highlightsHue=V,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(V){this._highlightsDensity=V,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(V){this._highlightsSaturation=V,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(V){this._highlightsExposure=V,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(V){this._midtonesHue=V,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(V){this._midtonesDensity=V,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(V){this._midtonesSaturation=V,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(V){this._midtonesExposure=V,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(V){this._shadowsHue=V,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(V){this._shadowsDensity=V,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(V){this._shadowsSaturation=V,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(V){this._shadowsExposure=V,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";V._dirty&&(V._dirty=!1,V._getColorGradingDataToRef(V._globalHue,V._globalDensity,V._globalSaturation,V._globalExposure,V._globalCurve),V._getColorGradingDataToRef(V._highlightsHue,V._highlightsDensity,V._highlightsSaturation,V._highlightsExposure,V._tempColor),V._tempColor.multiplyToRef(V._globalCurve,V._highlightsCurve),V._getColorGradingDataToRef(V._midtonesHue,V._midtonesDensity,V._midtonesSaturation,V._midtonesExposure,V._tempColor),V._tempColor.multiplyToRef(V._globalCurve,V._midtonesCurve),V._getColorGradingDataToRef(V._shadowsHue,V._shadowsDensity,V._shadowsSaturation,V._shadowsExposure,V._tempColor),V._tempColor.multiplyToRef(V._globalCurve,V._shadowsCurve),V._highlightsCurve.subtractToRef(V._midtonesCurve,V._positiveCurve),V._midtonesCurve.subtractToRef(V._shadowsCurve,V._negativeCurve)),p&&(p.setFloat4(W,V._positiveCurve.r,V._positiveCurve.g,V._positiveCurve.b,V._positiveCurve.a),p.setFloat4(N,V._midtonesCurve.r,V._midtonesCurve.g,V._midtonesCurve.b,V._midtonesCurve.a),p.setFloat4(d,V._negativeCurve.r,V._negativeCurve.g,V._negativeCurve.b,V._negativeCurve.a))}_getColorGradingDataToRef(V,p,W,N,d){null!=V&&(V=J._Clamp(V,0,360),p=J._Clamp(p,-100,100),W=J._Clamp(W,-100,100),N=J._Clamp(N,-100,100),p=J._ApplyColorGradingSliderNonlinear(p),p*=.5,N=J._ApplyColorGradingSliderNonlinear(N),p<0&&(p*=-1,V=(V+180)%360),J._FromHSBToRef(V,p,50+.25*N,d),d.scaleToRef(2,d),d.a=1+.01*W)}static _ApplyColorGradingSliderNonlinear(V){V/=100;let p=Math.abs(V);return p=Math.pow(p,2),V<0&&(p*=-1),p*=100,p}static _FromHSBToRef(V,p,W,N){let d=J._Clamp(V,0,360);const E=J._Clamp(p/100,0,1),z=J._Clamp(W/100,0,1);if(0===E)N.r=z,N.g=z,N.b=z;else{d/=60;const V=Math.floor(d),p=d-V,W=z*(1-E),S=z*(1-E*p),Q=z*(1-E*(1-p));switch(V){case 0:N.r=z,N.g=Q,N.b=W;break;case 1:N.r=S,N.g=z,N.b=W;break;case 2:N.r=W,N.g=z,N.b=Q;break;case 3:N.r=W,N.g=S,N.b=z;break;case 4:N.r=Q,N.g=W,N.b=z;break;default:N.r=z,N.g=W,N.b=S}}N.a=1}static _Clamp(V,p,W){return Math.min(Math.max(V,p),W)}clone(){return S.b.Clone((()=>new J),this)}serialize(){return S.b.Serialize(this)}static Parse(V){return S.b.Parse((()=>new J),V,null,null)}}J.PrepareUniforms=Q.b,(0,N.c)([(0,d.I)()],J.prototype,"_globalHue",void 0),(0,N.c)([(0,d.I)()],J.prototype,"_globalDensity",void 0),(0,N.c)([(0,d.I)()],J.prototype,"_globalSaturation",void 0),(0,N.c)([(0,d.I)()],J.prototype,"_globalExposure",void 0),(0,N.c)([(0,d.I)()],J.prototype,"_highlightsHue",void 0),(0,N.c)([(0,d.I)()],J.prototype,"_highlightsDensity",void 0),(0,N.c)([(0,d.I)()],J.prototype,"_highlightsSaturation",void 0),(0,N.c)([(0,d.I)()],J.prototype,"_highlightsExposure",void 0),(0,N.c)([(0,d.I)()],J.prototype,"_midtonesHue",void 0),(0,N.c)([(0,d.I)()],J.prototype,"_midtonesDensity",void 0),(0,N.c)([(0,d.I)()],J.prototype,"_midtonesSaturation",void 0),(0,N.c)([(0,d.I)()],J.prototype,"_midtonesExposure",void 0),S.b._ColorCurvesParser=J.Parse;var i=W(11016),l=W(11276),j=W(11004);class k{constructor(){this.colorCurves=new J,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=k.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new z.e(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=k.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new E.b}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(V){this._colorCurvesEnabled!==V&&(this._colorCurvesEnabled=V,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(V){this._colorGradingTexture!==V&&(this._colorGradingTexture=V,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(V){this._colorGradingEnabled!==V&&(this._colorGradingEnabled=V,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(V){this._colorGradingWithGreenDepth!==V&&(this._colorGradingWithGreenDepth=V,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(V){this._colorGradingBGR!==V&&(this._colorGradingBGR=V,this._updateParameters())}get exposure(){return this._exposure}set exposure(V){this._exposure!==V&&(this._exposure=V,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(V){this._toneMappingEnabled!==V&&(this._toneMappingEnabled=V,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(V){this._toneMappingType!==V&&(this._toneMappingType=V,this._updateParameters())}get contrast(){return this._contrast}set contrast(V){this._contrast!==V&&(this._contrast=V,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(V){this.vignetteCenterY=V}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(V){this.vignetteCenterX=V}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(V){this._vignetteBlendMode!==V&&(this._vignetteBlendMode=V,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(V){this._vignetteEnabled!==V&&(this._vignetteEnabled=V,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(V){this._ditheringEnabled!==V&&(this._ditheringEnabled=V,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(V){this._ditheringIntensity!==V&&(this._ditheringIntensity=V,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(V){this._skipFinalColorClamp!==V&&(this._skipFinalColorClamp=V,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(V){this._applyByPostProcess!==V&&(this._applyByPostProcess=V,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(V){this._isEnabled!==V&&(this._isEnabled=V,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(V){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return V.VIGNETTE=!1,V.TONEMAPPING=0,V.CONTRAST=!1,V.EXPOSURE=!1,V.COLORCURVES=!1,V.COLORGRADING=!1,V.COLORGRADING3D=!1,V.DITHER=!1,V.IMAGEPROCESSING=!1,V.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(V.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(V.VIGNETTE=this.vignetteEnabled,V.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===k._VIGNETTEMODE_MULTIPLY,V.VIGNETTEBLENDMODEOPAQUE=!V.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case k.TONEMAPPING_KHR_PBR_NEUTRAL:V.TONEMAPPING=3;break;case k.TONEMAPPING_ACES:V.TONEMAPPING=2;break;default:V.TONEMAPPING=1}else V.TONEMAPPING=0;V.CONTRAST=1!==this.contrast,V.EXPOSURE=1!==this.exposure,V.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,V.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,V.COLORGRADING?V.COLORGRADING3D=this.colorGradingTexture.is3D:V.COLORGRADING3D=!1,V.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,V.SAMPLER3DBGRMAP=this.colorGradingBGR,V.DITHER=this._ditheringEnabled,V.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,V.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,V.IMAGEPROCESSING=V.VIGNETTE||!!V.TONEMAPPING||V.CONTRAST||V.EXPOSURE||V.COLORCURVES||V.COLORGRADING||V.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(V,p){if(this._colorCurvesEnabled&&this.colorCurves&&J.Bind(this.colorCurves,V),this._vignetteEnabled||this._ditheringEnabled){const W=1/V.getEngine().getRenderWidth(),N=1/V.getEngine().getRenderHeight();if(V.setFloat2("vInverseScreenSize",W,N),this._ditheringEnabled&&V.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const d=null!=p?p:N/W;let E=Math.tan(.5*this.vignetteCameraFov),z=E*d;const S=Math.sqrt(z*E);z=(0,i.m)(z,S,this.vignetteStretch),E=(0,i.m)(E,S,this.vignetteStretch),V.setFloat4("vignetteSettings1",z,E,-z*this.vignetteCenterX,-E*this.vignetteCenterY);const Q=-2*this.vignetteWeight;V.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,Q)}}if(V.setFloat("exposureLinear",this.exposure),V.setFloat("contrast",this.contrast),this.colorGradingTexture){V.setTexture("txColorTransform",this.colorGradingTexture);const p=this.colorGradingTexture.getSize().height;V.setFloat4("colorTransformSettings",(p-1)/p,.5/p,p,this.colorGradingTexture.level)}}clone(){return S.b.Clone((()=>new k),this)}serialize(){return S.b.Serialize(this)}static Parse(V){const p=S.b.Parse((()=>new k),V,null,null);return void 0!==V.vignetteCentreX&&(p.vignetteCenterX=V.vignetteCentreX),void 0!==V.vignetteCentreY&&(p.vignetteCenterY=V.vignetteCentreY),p}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}k.TONEMAPPING_STANDARD=0,k.TONEMAPPING_ACES=1,k.TONEMAPPING_KHR_PBR_NEUTRAL=2,k.PrepareUniforms=l.f,k.PrepareSamplers=l.e,k._VIGNETTEMODE_MULTIPLY=0,k._VIGNETTEMODE_OPAQUE=1,(0,N.c)([(0,d.h)()],k.prototype,"colorCurves",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_colorCurvesEnabled",void 0),(0,N.c)([(0,d.A)("colorGradingTexture")],k.prototype,"_colorGradingTexture",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_colorGradingEnabled",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_colorGradingWithGreenDepth",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_colorGradingBGR",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_exposure",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_toneMappingEnabled",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_toneMappingType",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_contrast",void 0),(0,N.c)([(0,d.I)()],k.prototype,"vignetteStretch",void 0),(0,N.c)([(0,d.I)()],k.prototype,"vignetteCenterX",void 0),(0,N.c)([(0,d.I)()],k.prototype,"vignetteCenterY",void 0),(0,N.c)([(0,d.I)()],k.prototype,"vignetteWeight",void 0),(0,N.c)([(0,d.m)()],k.prototype,"vignetteColor",void 0),(0,N.c)([(0,d.I)()],k.prototype,"vignetteCameraFov",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_vignetteBlendMode",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_vignetteEnabled",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_ditheringEnabled",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_ditheringIntensity",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_skipFinalColorClamp",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_applyByPostProcess",void 0),(0,N.c)([(0,d.I)()],k.prototype,"_isEnabled",void 0),S.b._ImageProcessingConfigurationParser=k.Parse,(0,j.d)("BABYLON.ImageProcessingConfiguration",k)},11488:(V,p,W)=>{"use strict";W.d(p,{c:()=>l});var N=W(11167),d=W(11387),E=W(11175),z=W(11470),S=W(11442),Q=W(11496),J=W(11434);class i extends S.c{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class l extends Q.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(V,"DetailMap",140,new i,p),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=d.d.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=V._dirtyCallbacks[1]}isReadyForSubMesh(V,p,W){return!this._isEnabled||!(V._areTexturesDirty&&p.texturesEnabled&&W.getCaps().standardDerivatives&&this._texture&&z.c.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(V,p){if(this._isEnabled){V.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const W=p.getEngine();V._areTexturesDirty&&(W.getCaps().standardDerivatives&&this._texture&&z.c.DetailTextureEnabled&&this._isEnabled?((0,J.M)(this._texture,V,"DETAIL"),V.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):V.DETAIL=!1)}else V.DETAIL=!1}bindForSubMesh(V,p){if(!this._isEnabled)return;const W=this._material.isFrozen;V.useUbo&&W&&V.isSync||this._texture&&z.c.DetailTextureEnabled&&(V.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,J.t)(this._texture,V,"detail")),p.texturesEnabled&&this._texture&&z.c.DetailTextureEnabled&&V.setTexture("detailSampler",this._texture)}hasTexture(V){return this._texture===V}getActiveTextures(V){this._texture&&V.push(this._texture)}getAnimatables(V){this._texture&&this._texture.animations&&this._texture.animations.length>0&&V.push(this._texture)}dispose(V){var p;V&&(null===(p=this._texture)||void 0===p||p.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(V){V.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,N.c)([(0,E.A)("detailTexture"),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"texture",void 0),(0,N.c)([(0,E.I)()],l.prototype,"diffuseBlendLevel",void 0),(0,N.c)([(0,E.I)()],l.prototype,"roughnessBlendLevel",void 0),(0,N.c)([(0,E.I)()],l.prototype,"bumpLevel",void 0),(0,N.c)([(0,E.I)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"normalBlendMethod",void 0),(0,N.c)([(0,E.I)(),(0,E.d)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"isEnabled",void 0)},11387:(V,p,W)=>{"use strict";W.d(p,{d:()=>O});var N=W(11167),d=W(11175),E=W(10848),z=W(10856),S=W(10900),Q=W(11390),J=W(11278),i=W(10870),l=W(11361),j=W(11431),k=W(11265);class u{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(V){this._func=V}get funcRef(){return this._funcRef}set funcRef(V){this._funcRef=V}get funcMask(){return this._funcMask}set funcMask(V){this._funcMask=V}get opStencilFail(){return this._opStencilFail}set opStencilFail(V){this._opStencilFail=V}get opDepthFail(){return this._opDepthFail}set opDepthFail(V){this._opDepthFail=V}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(V){this._opStencilDepthPass=V}get mask(){return this._mask}set mask(V){this._mask=V}get enabled(){return this._enabled}set enabled(V){this._enabled=V}getClassName(){return"MaterialStencilState"}copyTo(V){k.b.Clone((()=>V),this)}serialize(){return k.b.Serialize(this)}parse(V,p,W){k.b.Parse((()=>this),V,p,W)}}(0,N.c)([(0,d.I)()],u.prototype,"func",null),(0,N.c)([(0,d.I)()],u.prototype,"funcRef",null),(0,N.c)([(0,d.I)()],u.prototype,"funcMask",null),(0,N.c)([(0,d.I)()],u.prototype,"opStencilFail",null),(0,N.c)([(0,d.I)()],u.prototype,"opDepthFail",null),(0,N.c)([(0,d.I)()],u.prototype,"opStencilDepthPass",null),(0,N.c)([(0,d.I)()],u.prototype,"mask",null),(0,N.c)([(0,d.I)()],u.prototype,"enabled",null);var f=W(11434);class O{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(V){if(this._alpha===V)return;const p=this._alpha;this._alpha=V,1!==p&&1!==V||this.Jg(O.MiscDirtyFlag+O.PrePassDirtyFlag)}get alpha(){return this._alpha}set eh(V){this._backFaceCulling!==V&&(this._backFaceCulling=V,this.Jg(O.TextureDirtyFlag))}get eh(){return this._backFaceCulling}set cullBackFaces(V){this._cullBackFaces!==V&&(this._cullBackFaces=V,this.Jg(O.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(V){this._blockDirtyMechanism!==V&&(this._blockDirtyMechanism=V,V||this.Ui())}atomicMaterialsUpdate(V){this.blockDirtyMechanism=!0;try{V(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(V){this._onDisposeObserver&&this.$i.remove(this._onDisposeObserver),this._onDisposeObserver=this.$i.add(V)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new z.b),this._onBindObservable}set onBind(V){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(V)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new z.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new z.b),this._onEffectCreatedObservable}set alphaMode(V){this._alphaMode!==V&&(this._alphaMode=V,this.Jg(O.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(V){this._needDepthPrePass!==V&&(this._needDepthPrePass=V,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(V){this._fogEnabled!==V&&(this._fogEnabled=V,this.Jg(O.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case O.WireFrameFillMode:case O.LineListDrawMode:case O.LineLoopDrawMode:case O.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(V){this.fillMode=V?O.WireFrameFillMode:O.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case O.PointFillMode:case O.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(V){this.fillMode=V?O.PointFillMode:O.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(V){this._fillMode!==V&&(this._fillMode=V,this.Jg(O.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(V){const p=this.va().getEngine().getCaps().fragmentDepthSupported;V&&!p&&i.e.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=V&&p,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(V){this._drawWrapper=V}constructor(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.$i=new z.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new u,this._useUBO=!1,this._fillMode=O.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=V;const d=p||S.d.LastCreatedScene;d&&(this._scene=d,this._dirtyCallbacks={},this._forceGLSL=N,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=V||E.e.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new j.e(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new J.c(this._scene.getEngine(),void 0,void 0,V),this._useUBO=this.va().getEngine().supportsUniformBuffers,this._createUniformBuffer(),W||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),O.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var V;const p=this.va().getEngine();null===(V=this._uniformBuffer)||void 0===V||V.dispose(),p.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new J.c(p,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new J.c(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(V){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.Ui(),this.checkReadyOnlyOnce=!0}unfreeze(){this.Ui(),this.checkReadyOnlyOnce=!1}isReady(V,p){return!0}isReadyForSubMesh(V,p,W){const N=p.materialDefines;return!!N&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=N,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}va(){return this._scene}_getEffectiveOrientation(V){return null!==this.sideOrientation?this.sideOrientation:V.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(V){this._transparencyMode!==V&&(this._transparencyMode=V,this._forceAlphaTest=V===O.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===O.MATERIAL_OPAQUE||this._transparencyMode===O.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(V){return V.visibility<1||!this._disableAlphaBlending&&(V.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(V){return!this.needAlphaBlendingForMesh(V)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}Ui(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=this.va().meshes;for(const W of p)if(W.dg)for(const p of W.dg)if(p.Ha()===this)for(const W of p._drawWrappers)W&&this._materialContext===W.materialContext&&(W._wasPreviouslyReady=!1,W._wasPreviouslyUsingInstances=null,W._forceRebindOnNextCall=V);V&&this.Jg(O.AllDirtyFlag)}_preBind(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=this._scene.getEngine(),N=(null==p?this.sideOrientation:p)===O.ClockWiseSideOrientation;return W.enableEffect(V||this._getDrawWrapper()),W.setState(this.eh,this.zOffset,!1,N,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),N}bind(V,p){}buildUniformLayout(){const V=this._uniformBuffer;this._eventInfo.ubo=V,this._callbackPluginEventGeneric(8,this._eventInfo),V.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(V,p,W){const N=W._drawWrapper;this._eventInfo.subMesh=W,this._callbackPluginEventBindForSubMesh(this._eventInfo),N._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(V){}bindView(V){this._useUBO?this._needToBindSceneUbo=!0:V.setMatrix("view",this.va().getViewMatrix())}bindViewProjection(V){this._useUBO?this._needToBindSceneUbo=!0:(V.setMatrix("viewProjection",this.va().getTransformMatrix()),V.setMatrix("projection",this.va().getProjectionMatrix()))}bindEyePosition(V,p){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(V,p)}_afterBind(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&p&&(this._needToBindSceneUbo=!1,(0,f.p)(p,this.va().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=V?V.visibility:1,this._onBindObservable&&V&&this._onBindObservable.notifyObservers(V),this.disableDepthWrite){const V=this._scene.getEngine();this._cachedDepthWriteState=V.getDepthWrite(),V.setDepthWrite(!1)}if(this.disableColorWrite){const V=this._scene.getEngine();this._cachedColorWriteState=V.getColorWrite(),V.setColorWrite(!1)}if(0!==this.depthFunction){const V=this._scene.getEngine();this._cachedDepthFunctionState=V.getDepthFunction()||0,V.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(V){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=V,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(V){return null}_clonePlugins(V,p){const W={};if(this._serializePlugins(W),O._ParsePlugins(W,V,this._scene,p),this.pluginManager)for(const N of this.pluginManager._plugins){const p=V.pluginManager.getPlugin(N.name);p&&N.copyTo(p)}}getBindedMeshes(){if(this.meshMap){const V=[];for(const p in this.meshMap){const W=this.meshMap[p];W&&V.push(W)}return V}return this._scene.meshes.filter((V=>V.material===this))}forceCompilation(V,p,W,N){const d={clipPlane:!1,useInstances:!1,...W},E=this.va(),z=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const S=()=>{if(!this._scene||!this._scene.getEngine())return;const W=E.clipPlane;if(d.clipPlane&&(E.clipPlane=new l.b(0,0,0,1)),this._storeEffectOnSubMeshes){let W=!0,E=null;if(V.dg){const p=new Q.b(0,0,0,0,0,V,void 0,!1,!1);p.materialDefines&&(p.materialDefines._renderId=-1),this.isReadyForSubMesh(V,p,d.useInstances)||(p.effect&&p.effect.getCompilationError()&&p.effect.allFallbacksProcessed()?E=p.effect.getCompilationError():(W=!1,setTimeout(S,16)))}W&&(this.allowShaderHotSwapping=z,E&&N&&N(E),p&&p(this))}else this.isReady()?(this.allowShaderHotSwapping=z,p&&p(this)):setTimeout(S,16);d.clipPlane&&(E.clipPlane=W)};S()}forceCompilationAsync(V,p){return new Promise(((W,N)=>{this.forceCompilation(V,(()=>{W()}),p,(V=>{N(V)}))}))}Jg(V){this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(O._DirtyCallbackArray.length=0,V&O.TextureDirtyFlag&&O._DirtyCallbackArray.push(O._TextureDirtyCallBack),V&O.LightDirtyFlag&&O._DirtyCallbackArray.push(O._LightsDirtyCallBack),V&O.FresnelDirtyFlag&&O._DirtyCallbackArray.push(O._FresnelDirtyCallBack),V&O.AttributesDirtyFlag&&O._DirtyCallbackArray.push(O._AttributeDirtyCallBack),V&O.MiscDirtyFlag&&O._DirtyCallbackArray.push(O._MiscDirtyCallBack),V&O.PrePassDirtyFlag&&O._DirtyCallbackArray.push(O._PrePassDirtyCallBack),O._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(O._RunDirtyCallBacks),this.va().resetCachedMaterial())}resetDrawCache(){const V=this.va().meshes;for(const p of V)if(p.dg)for(const V of p.dg)V.Ha()===this&&V.resetDrawCache()}_markAllSubMeshesAsDirty(V){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const p=this.va().meshes;for(const W of p)if(W.dg)for(const p of W.dg)if(p.Ha(!1)===this)for(const W of p._drawWrappers)W&&W.defines&&W.defines.markAllAsDirty&&this._materialContext===W.materialContext&&V(W.defines)}_markScenePrePassDirty(){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const V=this.va().enablePrePassRenderer();V&&V.Jg()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(O._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(O._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(O._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(O._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(O._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(O._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(O._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(O._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(O._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(O._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const V=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.$i.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(V)}))}}setPrePassRenderer(V){return!1}dispose(V,p,W){const N=this.va();if(N.stopAnimation(this),N.freeProcessedMaterials(),N.removeMaterial(this),this._eventInfo.forceDisposeTextures=p,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const V=this._parentContainer.materials.indexOf(this);V>-1&&this._parentContainer.materials.splice(V,1),this._parentContainer=null}if(!0!==W)if(this.meshMap)for(const d in this.meshMap){const p=this.meshMap[d];p&&(p.material=null,this.releaseVertexArrayObject(p,V))}else{const p=N.meshes;for(const W of p)W.material!==this||W.sourceMesh||(W.material=null,this.releaseVertexArrayObject(W,V))}this._uniformBuffer.dispose(),V&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.$i.notifyObservers(this),this.$i.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(V,p){const W=V.sj;if(W)if(this._storeEffectOnSubMeshes){if(V.dg)for(const N of V.dg)W._releaseVertexArrayObject(N.effect),p&&N.effect&&N.effect.dispose()}else W._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const V=k.b.Serialize(this);return V.stencil=this.stencil.serialize(),V.uniqueId=this.uniqueId,this._serializePlugins(V),V}_serializePlugins(V){if(V.plugins={},this.pluginManager)for(const p of this.pluginManager._plugins)V.plugins[p.getClassName()]=p.serialize()}static Parse(V,p,W){if(V.customType){if("BABYLON.PBRMaterial"===V.customType&&V.overloadedAlbedo&&(V.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return i.e.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else V.customType="BABYLON.StandardMaterial";const N=E.e.Instantiate(V.customType).Parse(V,p,W);return N._loadedUniqueId=V.uniqueId,N}static _ParsePlugins(V,p,W,N){if(V.plugins)for(const S in V.plugins){var d,z;const Q=V.plugins[S];let J=null===(d=p.pluginManager)||void 0===d?void 0:d.getPlugin(Q.name);if(!J){const V=E.e.Instantiate("BABYLON."+S);V&&(J=new V(p))}null===(z=J)||void 0===z||z.parse(Q,W,N)}}}O.TriangleFillMode=0,O.WireFrameFillMode=1,O.PointFillMode=2,O.PointListDrawMode=3,O.LineListDrawMode=4,O.LineLoopDrawMode=5,O.LineStripDrawMode=6,O.TriangleStripDrawMode=7,O.TriangleFanDrawMode=8,O.ClockWiseSideOrientation=0,O.CounterClockWiseSideOrientation=1,O.TextureDirtyFlag=1,O.LightDirtyFlag=2,O.FresnelDirtyFlag=4,O.AttributesDirtyFlag=8,O.MiscDirtyFlag=16,O.PrePassDirtyFlag=32,O.AllDirtyFlag=63,O.MATERIAL_OPAQUE=0,O.MATERIAL_ALPHATEST=1,O.MATERIAL_ALPHABLEND=2,O.MATERIAL_ALPHATESTANDBLEND=3,O.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,O.MATERIAL_NORMALBLENDMETHOD_RNM=1,O.OnEventObservable=new z.b,O._AllDirtyCallBack=V=>V.markAllAsDirty(),O._ImageProcessingDirtyCallBack=V=>V.markAsImageProcessingDirty(),O._TextureDirtyCallBack=V=>V.markAsTexturesDirty(),O._FresnelDirtyCallBack=V=>V.markAsFresnelDirty(),O._MiscDirtyCallBack=V=>V.markAsMiscDirty(),O._PrePassDirtyCallBack=V=>V.markAsPrePassDirty(),O._LightsDirtyCallBack=V=>V.markAsLightDirty(),O._AttributeDirtyCallBack=V=>V.markAsAttributesDirty(),O._FresnelAndMiscDirtyCallBack=V=>{O._FresnelDirtyCallBack(V),O._MiscDirtyCallBack(V)},O._TextureAndMiscDirtyCallBack=V=>{O._TextureDirtyCallBack(V),O._MiscDirtyCallBack(V)},O._DirtyCallbackArray=[],O._RunDirtyCallBacks=V=>{for(const p of O._DirtyCallbackArray)p(V)},(0,N.c)([(0,d.I)()],O.prototype,"id",void 0),(0,N.c)([(0,d.I)()],O.prototype,"uniqueId",void 0),(0,N.c)([(0,d.I)()],O.prototype,"name",void 0),(0,N.c)([(0,d.I)()],O.prototype,"metadata",void 0),(0,N.c)([(0,d.I)()],O.prototype,"checkReadyOnEveryCall",void 0),(0,N.c)([(0,d.I)()],O.prototype,"checkReadyOnlyOnce",void 0),(0,N.c)([(0,d.I)()],O.prototype,"state",void 0),(0,N.c)([(0,d.I)("alpha")],O.prototype,"_alpha",void 0),(0,N.c)([(0,d.I)("eh")],O.prototype,"_backFaceCulling",void 0),(0,N.c)([(0,d.I)("cullBackFaces")],O.prototype,"_cullBackFaces",void 0),(0,N.c)([(0,d.I)()],O.prototype,"sideOrientation",void 0),(0,N.c)([(0,d.I)("alphaMode")],O.prototype,"_alphaMode",void 0),(0,N.c)([(0,d.I)()],O.prototype,"_needDepthPrePass",void 0),(0,N.c)([(0,d.I)()],O.prototype,"disableDepthWrite",void 0),(0,N.c)([(0,d.I)()],O.prototype,"disableColorWrite",void 0),(0,N.c)([(0,d.I)()],O.prototype,"forceDepthWrite",void 0),(0,N.c)([(0,d.I)()],O.prototype,"depthFunction",void 0),(0,N.c)([(0,d.I)()],O.prototype,"separateCullingPass",void 0),(0,N.c)([(0,d.I)("fogEnabled")],O.prototype,"_fogEnabled",void 0),(0,N.c)([(0,d.I)()],O.prototype,"pointSize",void 0),(0,N.c)([(0,d.I)()],O.prototype,"zOffset",void 0),(0,N.c)([(0,d.I)()],O.prototype,"zOffsetUnits",void 0),(0,N.c)([(0,d.I)()],O.prototype,"pointsCloud",null),(0,N.c)([(0,d.I)()],O.prototype,"fillMode",null),(0,N.c)([(0,d.I)()],O.prototype,"useLogarithmicDepth",null),(0,N.c)([(0,d.I)()],O.prototype,"transparencyMode",null)},11442:(V,p,W)=>{"use strict";W.d(p,{c:()=>N});class N{constructor(V){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=V,V)for(const p in V)Object.prototype.hasOwnProperty.call(V,p)&&this._setDefaultValue(p)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||V,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const V of Object.keys(this))"_"!==V[0]&&this._keys.push(V);if(this._externalProperties)for(const V in this._externalProperties)-1===this._keys.indexOf(V)&&this._keys.push(V)}isEqual(V){if(this._keys.length!==V._keys.length)return!1;for(let p=0;p<this._keys.length;p++){const W=this._keys[p];if(this[W]!==V[W])return!1}return!0}cloneTo(V){this._keys.length!==V._keys.length&&(V._keys=this._keys.slice(0));for(let p=0;p<this._keys.length;p++){const W=this._keys[p];V[W]=this[W]}}reset(){this._keys.forEach((V=>this._setDefaultValue(V)))}_setDefaultValue(V){var p,W,N,d;const E=(null===(p=this._externalProperties)||void 0===p||null===(W=p[V])||void 0===W?void 0:W.type)??typeof this[V],z=null===(N=this._externalProperties)||void 0===N||null===(d=N[V])||void 0===d?void 0:d.default;switch(E){case"number":this[V]=z??0;break;case"string":this[V]=z??"";break;default:this[V]=z??!1}}toString(){let V="";for(let p=0;p<this._keys.length;p++){const W=this._keys[p],N=this[W];switch(typeof N){case"number":case"string":V+="#define "+W+" "+N+"\n";break;default:N&&(V+="#define "+W+"\n")}}return V}}},11470:(V,p,W)=>{"use strict";W.d(p,{c:()=>d});var N=W(10941);class d{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(V){this._DiffuseTextureEnabled!==V&&(this._DiffuseTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(V){this._DetailTextureEnabled!==V&&(this._DetailTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(V){this._DecalMapEnabled!==V&&(this._DecalMapEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(V){this._AmbientTextureEnabled!==V&&(this._AmbientTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(V){this._OpacityTextureEnabled!==V&&(this._OpacityTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(V){this._ReflectionTextureEnabled!==V&&(this._ReflectionTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(V){this._EmissiveTextureEnabled!==V&&(this._EmissiveTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(V){this._SpecularTextureEnabled!==V&&(this._SpecularTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(V){this._BumpTextureEnabled!==V&&(this._BumpTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(V){this._LightmapTextureEnabled!==V&&(this._LightmapTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(V){this._RefractionTextureEnabled!==V&&(this._RefractionTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(V){this._ColorGradingTextureEnabled!==V&&(this._ColorGradingTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(V){this._FresnelEnabled!==V&&(this._FresnelEnabled=V,N.d.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(V){this._ClearCoatTextureEnabled!==V&&(this._ClearCoatTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(V){this._ClearCoatBumpTextureEnabled!==V&&(this._ClearCoatBumpTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(V){this._ClearCoatTintTextureEnabled!==V&&(this._ClearCoatTintTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(V){this._SheenTextureEnabled!==V&&(this._SheenTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(V){this._AnisotropicTextureEnabled!==V&&(this._AnisotropicTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(V){this._ThicknessTextureEnabled!==V&&(this._ThicknessTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(V){this._RefractionIntensityTextureEnabled!==V&&(this._RefractionIntensityTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(V){this._TranslucencyIntensityTextureEnabled!==V&&(this._TranslucencyIntensityTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(V){this._TranslucencyColorTextureEnabled!==V&&(this._TranslucencyColorTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(V){this._IridescenceTextureEnabled!==V&&(this._IridescenceTextureEnabled=V,N.d.MarkAllMaterialsAsDirty(1))}}d._DiffuseTextureEnabled=!0,d._DetailTextureEnabled=!0,d._DecalMapEnabled=!0,d._AmbientTextureEnabled=!0,d._OpacityTextureEnabled=!0,d._ReflectionTextureEnabled=!0,d._EmissiveTextureEnabled=!0,d._SpecularTextureEnabled=!0,d._BumpTextureEnabled=!0,d._LightmapTextureEnabled=!0,d._RefractionTextureEnabled=!0,d._ColorGradingTextureEnabled=!0,d._FresnelEnabled=!0,d._ClearCoatTextureEnabled=!0,d._ClearCoatBumpTextureEnabled=!0,d._ClearCoatTintTextureEnabled=!0,d._SheenTextureEnabled=!0,d._AnisotropicTextureEnabled=!0,d._ThicknessTextureEnabled=!0,d._RefractionIntensityTextureEnabled=!0,d._TranslucencyIntensityTextureEnabled=!0,d._TranslucencyColorTextureEnabled=!0,d._IridescenceTextureEnabled=!0},11434:(V,p,W)=>{"use strict";W.d(p,{A:()=>v,B:()=>t,C:()=>l,E:()=>L,F:()=>h,I:()=>o,M:()=>f,O:()=>Z,S:()=>x,W:()=>T,Y:()=>P,_:()=>s,bb:()=>j,e:()=>F,g:()=>i,i:()=>A,k:()=>J,m:()=>k,p:()=>u,t:()=>O,w:()=>e,x:()=>U});var N=W(10870),d=W(11257),E=W(10900),z=W(11373),S=W(11436);const Q=d.c.Black();function J(V,p,W){if(!V||V.LOGARITHMICDEPTH||V.indexOf&&V.indexOf("LOGARITHMICDEPTH")>=0){const V=W.activeCamera;1===V.mode&&N.e.Error("Logarithmic depth is not compatible with orthographic cameras!",20),p.setFloat("logarithmicDepthConstant",2/(Math.log(V.maxZ+1)/Math.LN2))}}function i(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];W&&V.fogEnabled&&(!p||p.applyFog)&&0!==V.fogMode&&(W.setFloat4("vFogInfos",V.fogMode,V.fogStart,V.fogEnd,V.fogDensity),N?(V.fogColor.toLinearSpaceToRef(Q,V.getEngine().useExactSrgbConversions),W.setColor3("vFogColor",Q)):W.setColor3("vFogColor",V.fogColor))}function l(V,p,W){const d=W.NUM_MORPH_INFLUENCERS;if(d>0&&E.d.LastCreatedEngine){const z=E.d.LastCreatedEngine.getCaps().maxVertexAttribs,S=p.morphTargetManager;if(null!==S&&void 0!==S&&S.isUsingTextureForTargets)return;const Q=S&&S.supportsNormals&&W.NORMAL,J=S&&S.supportsTangents&&W.TANGENT,i=S&&S.supportsUVs&&W.UV1;for(let W=0;W<d;W++)V.push("position"+W),Q&&V.push("normal"+W),J&&V.push("tangent"+W),i&&V.push("uv_"+W),V.length>z&&N.e.Error("Cannot add more vertex attributes for mesh "+p.name)}}function j(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V.push("world0"),V.push("world1"),V.push("world2"),V.push("world3"),p&&(V.push("previousWorld0"),V.push("previousWorld1"),V.push("previousWorld2"),V.push("previousWorld3"))}function k(V,p){const W=V.morphTargetManager;V&&W&&p.setFloatArray("morphTargetInfluences",W.influences)}function u(V,p){p.bindToEffect(V,"Scene")}function f(V,p,W){p._needUVs=!0,p[W]=!0,V.optimizeUVAllocation&&V.getTextureMatrix().isIdentityAs3x2()?(p[W+"DIRECTUV"]=V.coordinatesIndex+1,p["MAINUV"+(V.coordinatesIndex+1)]=!0):p[W+"DIRECTUV"]=0}function O(V,p,W){const N=V.getTextureMatrix();p.wj(W+"Matrix",N)}function U(V,p,W){W.BAKED_VERTEX_ANIMATION_TEXTURE&&W.INSTANCES&&V.push("bakedVertexAnimationSettingsInstanced")}function F(V,p,W){var N;if(p&&V&&(V.computeBonesUsingShaders&&p._bonesComputationForcedToCPU&&(V.computeBonesUsingShaders=!1),V.useBones&&V.computeBonesUsingShaders&&V.skeleton)){const d=V.skeleton;if(d.isUsingTextureForMatrices&&p.getUniformIndex("boneTextureWidth")>-1){const W=d.getTransformMatrixTexture(V);p.setTexture("boneSampler",W),p.setFloat("boneTextureWidth",4*(d.bones.length+1))}else{const E=d.getTransformMatrices(V);E&&(p.setMatrices("mBones",E),W&&V.va().prePassRenderer&&V.va().prePassRenderer.getIndex(2)&&(W.previousBones[V.uniqueId]||(W.previousBones[V.uniqueId]=E.slice()),p.setMatrices("mPreviousBones",W.previousBones[V.uniqueId]),N=E,W.previousBones[V.uniqueId].set(N)))}}}function C(V,p,W,N,d){let E=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];V._bindLight(p,W,N,d,E)}function A(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const E=Math.min(p.lightSources.length,d);for(let z=0;z<E;z++){C(p.lightSources[z],z,V,W,"boolean"===typeof N?N:N.SPECULARTERM,p.receiveShadows)}}function v(V,p,W,N){W.NUM_BONE_INFLUENCERS>0&&(N.addCPUSkinningFallback(0,p),V.push("matricesIndices"),V.push("matricesWeights"),W.NUM_BONE_INFLUENCERS>4&&(V.push("matricesIndicesExtra"),V.push("matricesWeightsExtra")))}function t(V,p){(p.INSTANCES||p.THIN_INSTANCES)&&j(V,!!p.PREPASS_VELOCITY),p.INSTANCESCOLOR&&V.push("instanceColor")}function e(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=0;for(let E=0;E<W&&V["LIGHT"+E];E++)E>0&&(d=N+E,p.addFallback(d,"LIGHT"+E)),V.SHADOWS||(V["SHADOW"+E]&&p.addFallback(N,"SHADOW"+E),V["SHADOWPCF"+E]&&p.addFallback(N,"SHADOWPCF"+E),V["SHADOWPCSS"+E]&&p.addFallback(N,"SHADOWPCSS"+E),V["SHADOWPOISSON"+E]&&p.addFallback(N,"SHADOWPOISSON"+E),V["SHADOWESM"+E]&&p.addFallback(N,"SHADOWESM"+E),V["SHADOWCLOSEESM"+E]&&p.addFallback(N,"SHADOWCLOSEESM"+E));return d++}function Z(V,p,W,N,d,E,z){let S=arguments.length>7&&void 0!==arguments[7]&&arguments[7];z._areMiscDirty&&(z.LOGARITHMICDEPTH=W,z.POINTSIZE=N,z.FOG=d&&function(V,p){return p.fogEnabled&&V.applyFog&&0!==p.fogMode}(V,p),z.NONUNIFORMSCALING=V.nonUniformScaling,z.ALPHATEST=E,z.DECAL_AFTER_DETAIL=S)}function o(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!W._areLightsDirty)return W._needNormals;let z=0;const S={needNormals:W._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(V.lightsEnabled&&!E)for(const J of p.lightSources)if(K(V,p,J,z,W,N,S),z++,z===d)break;W.SPECULARTERM=S.specularEnabled,W.SHADOWS=S.shadowEnabled;for(let J=z;J<d;J++)void 0!==W["LIGHT"+J]&&(W["LIGHT"+J]=!1,W["HEMILIGHT"+J]=!1,W["POINTLIGHT"+J]=!1,W["DIRLIGHT"+J]=!1,W["SPOTLIGHT"+J]=!1,W["SHADOW"+J]=!1,W["SHADOWCSM"+J]=!1,W["SHADOWCSMDEBUG"+J]=!1,W["SHADOWCSMNUM_CASCADES"+J]=!1,W["SHADOWCSMUSESHADOWMAXZ"+J]=!1,W["SHADOWCSMNOBLEND"+J]=!1,W["SHADOWCSM_RIGHTHANDED"+J]=!1,W["SHADOWPCF"+J]=!1,W["SHADOWPCSS"+J]=!1,W["SHADOWPOISSON"+J]=!1,W["SHADOWESM"+J]=!1,W["SHADOWCLOSEESM"+J]=!1,W["SHADOWCUBE"+J]=!1,W["SHADOWLOWQUALITY"+J]=!1,W["SHADOWMEDIUMQUALITY"+J]=!1);const Q=V.getEngine().getCaps();return void 0===W.SHADOWFLOAT&&(S.needRebuild=!0),W.SHADOWFLOAT=S.shadowEnabled&&(Q.textureFloatRender&&Q.textureFloatLinearFiltering||Q.textureHalfFloatRender&&Q.textureHalfFloatLinearFiltering),W.LIGHTMAPEXCLUDED=S.lightmapMode,S.needRebuild&&W.rebuild(),S.needNormals}function K(V,p,W,N,d,E,S){switch(S.needNormals=!0,void 0===d["LIGHT"+N]&&(S.needRebuild=!0),d["LIGHT"+N]=!0,d["SPOTLIGHT"+N]=!1,d["HEMILIGHT"+N]=!1,d["POINTLIGHT"+N]=!1,d["DIRLIGHT"+N]=!1,W.prepareLightSpecificDefines(d,N),d["LIGHT_FALLOFF_PHYSICAL"+N]=!1,d["LIGHT_FALLOFF_GLTF"+N]=!1,d["LIGHT_FALLOFF_STANDARD"+N]=!1,W.falloffType){case z.e.FALLOFF_GLTF:d["LIGHT_FALLOFF_GLTF"+N]=!0;break;case z.e.FALLOFF_PHYSICAL:d["LIGHT_FALLOFF_PHYSICAL"+N]=!0;break;case z.e.FALLOFF_STANDARD:d["LIGHT_FALLOFF_STANDARD"+N]=!0}if(E&&!W.rh.equalsFloats(0,0,0)&&(S.specularEnabled=!0),d["SHADOW"+N]=!1,d["SHADOWCSM"+N]=!1,d["SHADOWCSMDEBUG"+N]=!1,d["SHADOWCSMNUM_CASCADES"+N]=!1,d["SHADOWCSMUSESHADOWMAXZ"+N]=!1,d["SHADOWCSMNOBLEND"+N]=!1,d["SHADOWCSM_RIGHTHANDED"+N]=!1,d["SHADOWPCF"+N]=!1,d["SHADOWPCSS"+N]=!1,d["SHADOWPOISSON"+N]=!1,d["SHADOWESM"+N]=!1,d["SHADOWCLOSEESM"+N]=!1,d["SHADOWCUBE"+N]=!1,d["SHADOWLOWQUALITY"+N]=!1,d["SHADOWMEDIUMQUALITY"+N]=!1,p&&p.receiveShadows&&V.shadowsEnabled&&W.shadowEnabled){const p=W.getShadowGenerator(V.activeCamera)??W.getShadowGenerator();if(p){const V=p.getShadowMap();V&&V.renderList&&V.renderList.length>0&&(S.shadowEnabled=!0,p.prepareDefines(d,N))}}W.lightmapMode!=z.e.LIGHTMAP_DEFAULT?(S.lightmapMode=!0,d["LIGHTMAPEXCLUDED"+N]=!0,d["LIGHTMAPNOSPECULAR"+N]=W.lightmapMode==z.e.LIGHTMAP_SHADOWSONLY):(d["LIGHTMAPEXCLUDED"+N]=!1,d["LIGHTMAPNOSPECULAR"+N]=!1)}function h(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=function(V,p){let W=!1;if(V.activeCamera){const N=p.CAMERA_ORTHOGRAPHIC?1:0,d=p.CAMERA_PERSPECTIVE?1:0,E=1===V.activeCamera.mode?1:0,z=0===V.activeCamera.mode?1:0;(N^E||d^z)&&(p.CAMERA_ORTHOGRAPHIC=1===E,p.CAMERA_PERSPECTIVE=1===z,W=!0)}return W}(V,N);!1!==E&&(Q=(0,S.i)(W,V,N)),N.DEPTHPREPASS!==!p.getColorWrite()&&(N.DEPTHPREPASS=!N.DEPTHPREPASS,Q=!0),N.INSTANCES!==d&&(N.INSTANCES=d,Q=!0),N.THIN_INSTANCES!==z&&(N.THIN_INSTANCES=z,Q=!0),Q&&N.markAsUnprocessed()}function L(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],E=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],z=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!p._areAttributesDirty&&p._needNormals===p._normals&&p._needUVs===p._uvs)return!1;p._normals=p._needNormals,p._uvs=p._needUVs,p.NORMAL=p._needNormals&&V.isVerticesDataPresent("normal"),p._needNormals&&V.isVerticesDataPresent("tangent")&&(p.TANGENT=!0);for(let S=1;S<=6;++S)p["UV"+S]=!!p._needUVs&&V.isVerticesDataPresent(`uv${1===S?"":S}`);if(W){const W=V.useVertexColors&&V.isVerticesDataPresent("color");p.VERTEXCOLOR=W,p.VERTEXALPHA=V.hasVertexAlpha&&W&&E}return V.isVerticesDataPresent("instanceColor")&&(V.hasInstances||V.hasThinInstances)&&(p.INSTANCESCOLOR=!0),N&&function(V,p){if(V.useBones&&V.computeBonesUsingShaders&&V.skeleton){p.NUM_BONE_INFLUENCERS=V.numBoneInfluencers;const W=void 0!==p.BONETEXTURE;if(V.skeleton.isUsingTextureForMatrices&&W)p.BONETEXTURE=!0;else{p.BonesPerMesh=V.skeleton.bones.length+1,p.BONETEXTURE=!W&&void 0;const N=V.va().prePassRenderer;if(N&&N.enabled){const W=-1===N.excludedSkinnedMesh.indexOf(V);p.BONES_VELOCITY_ENABLED=W}}}else p.NUM_BONE_INFLUENCERS=0,p.BonesPerMesh=0,void 0!==p.BONETEXTURE&&(p.BONETEXTURE=!1)}(V,p),d&&function(V,p){const W=V.morphTargetManager;W?(p.MORPHTARGETS_UV=W.supportsUVs&&p.UV1,p.MORPHTARGETS_TANGENT=W.supportsTangents&&p.TANGENT,p.MORPHTARGETS_NORMAL=W.supportsNormals&&p.NORMAL,p.NUM_MORPH_INFLUENCERS=W.numMaxInfluencers||W.numInfluencers,p.MORPHTARGETS=p.NUM_MORPH_INFLUENCERS>0,p.MORPHTARGETS_TEXTURE=W.isUsingTextureForTargets):(p.MORPHTARGETS_UV=!1,p.MORPHTARGETS_TANGENT=!1,p.MORPHTARGETS_NORMAL=!1,p.MORPHTARGETS=!1,p.NUM_MORPH_INFLUENCERS=0)}(V,p),z&&function(V,p){const W=V.bakedVertexAnimationManager;p.BAKED_VERTEX_ANIMATION_TEXTURE=!(!W||!W.isEnabled)}(V,p),!0}function x(V,p){if(V.activeCamera){const W=p.MULTIVIEW;p.MULTIVIEW=null!==V.activeCamera.outputRenderTarget&&V.activeCamera.outputRenderTarget.getViewCount()>1,p.MULTIVIEW!=W&&p.markAsUnprocessed()}}function T(V,p,W){const N=p.ORDER_INDEPENDENT_TRANSPARENCY,d=p.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;p.ORDER_INDEPENDENT_TRANSPARENCY=V.useOrderIndependentTransparency&&W,p.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!V.getEngine().getCaps().textureFloatLinearFiltering,N===p.ORDER_INDEPENDENT_TRANSPARENCY&&d===p.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||p.markAsUnprocessed()}function P(V,p,W){const N=p.PREPASS;if(!p._arePrePassDirty)return;const d=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(V.prePassRenderer&&V.prePassRenderer.enabled&&W){p.PREPASS=!0,p.SCENE_MRT_COUNT=V.prePassRenderer.mrtCount,p.PREPASS_NORMAL_WORLDSPACE=V.prePassRenderer.generateNormalsInWorldSpace,p.PREPASS_COLOR=!0,p.PREPASS_COLOR_INDEX=0;for(let W=0;W<d.length;W++){const N=V.prePassRenderer.getIndex(d[W].type);-1!==N?(p[d[W].define]=!0,p[d[W].index]=N):p[d[W].define]=!1}}else{p.PREPASS=!1;for(let V=0;V<d.length;V++)p[d[V].define]=!1}p.PREPASS!=N&&(p.markAsUnprocessed(),p.markAsImageProcessingDirty())}function b(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];d&&d.push("Light"+V),E||(p.push("vLightData"+V,"vLightDiffuse"+V,"vLightSpecular"+V,"vLightDirection"+V,"vLightFalloff"+V,"vLightGround"+V,"lightMatrix"+V,"shadowsInfo"+V,"depthValues"+V),W.push("shadowTexture"+V),W.push("depthTexture"+V),p.push("viewFrustumZ"+V,"cascadeBlendFactor"+V,"lightSizeUVCorrection"+V,"depthCorrection"+V,"penumbraDarkness"+V,"frustumLengths"+V),N&&(W.push("projectionLightTexture"+V),p.push("textureProjectionMatrix"+V)))}function s(V,p,W){let N,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,E=null;if(V.uniformsNames){const z=V;N=z.uniformsNames,E=z.uniformBuffersNames,p=z.samplers,W=z.defines,d=z.maxSimultaneousLights||0}else N=V,p||(p=[]);for(let z=0;z<d&&W["LIGHT"+z];z++)b(z,N,p,W["PROJECTEDLIGHTTEXTURE"+z],E);W.NUM_MORPH_INFLUENCERS&&(N.push("morphTargetInfluences"),N.push("morphTargetCount")),W.BAKED_VERTEX_ANIMATION_TEXTURE&&(N.push("bakedVertexAnimationSettings"),N.push("bakedVertexAnimationTextureSizeInverted"),N.push("bakedVertexAnimationTime"),p.push("bakedVertexAnimationTexture"))}},11501:(V,p,W)=>{"use strict";W.d(p,{e:()=>E});var N,d=W(11218);!function(V){V[V.Zero=0]="Zero",V[V.One=1]="One",V[V.MaxViewZ=2]="MaxViewZ"}(N||(N={}));class E{static CreateConfiguration(V){return E._Configurations[V]={defines:{},previousWorldMatrices:{},previousViewProjection:d.e.Zero(),currentViewProjection:d.e.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},E._Configurations[V]}static DeleteConfiguration(V){delete E._Configurations[V]}static GetConfiguration(V){return E._Configurations[V]}static AddUniformsAndSamplers(V,p){V.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(V,p){for(const W of p)if(W.dg)for(const p of W.dg)p._removeDrawWrapper(V)}static PrepareDefines(V,p,W){if(!W._arePrePassDirty)return;const N=E._Configurations[V];if(!N)return;W.PREPASS=!0,W.PREPASS_COLOR=!1,W.PREPASS_COLOR_INDEX=-1;let d=0;for(let z=0;z<E.GeometryTextureDescriptions.length;z++){const V=E.GeometryTextureDescriptions[z],p=V.define,S=V.defineIndex,Q=N.defines[S];void 0!==Q?(W[p]=!0,W[S]=Q,d++):(W[p]=!1,delete W[S])}W.SCENE_MRT_COUNT=d,W.BONES_VELOCITY_ENABLED=p.useBones&&p.computeBonesUsingShaders&&p.skeleton&&!p.skeleton.isUsingTextureForMatrices&&-1===N.excludedSkinnedMesh.indexOf(p)}static Bind(V,p,W,N){const d=E._Configurations[V];if(d&&(void 0!==d.defines.PREPASS_VELOCITY_INDEX||void 0!==d.defines.PREPASS_VELOCITY_LINEAR_INDEX)){d.previousWorldMatrices[W.uniqueId]||(d.previousWorldMatrices[W.uniqueId]=N.clone());const V=W.va();d.previousViewProjection||(d.previousViewProjection=V.getTransformMatrix().clone(),d.currentViewProjection=V.getTransformMatrix().clone());const E=V.getEngine();if(d.currentViewProjection.updateFlag!==V.getTransformMatrix().updateFlag?(d.lastUpdateFrameId=E.frameId,d.previousViewProjection.p(d.currentViewProjection),d.currentViewProjection.p(V.getTransformMatrix())):d.lastUpdateFrameId!==E.frameId&&(d.lastUpdateFrameId=E.frameId,d.previousViewProjection.p(d.currentViewProjection)),p.setMatrix("previousWorld",d.previousWorldMatrices[W.uniqueId]),p.setMatrix("previousViewProjection",d.previousViewProjection),d.previousWorldMatrices[W.uniqueId]=N.clone(),W.useBones&&W.computeBonesUsingShaders&&W.skeleton){const V=W.skeleton;if(!V.isUsingTextureForMatrices||-1===p.getUniformIndex("boneTextureWidth")){const N=V.getTransformMatrices(W);N&&(d.previousBones[W.uniqueId]||(d.previousBones[W.uniqueId]=N.slice()),p.setMatrices("mPreviousBones",d.previousBones[W.uniqueId]),d.previousBones[W.uniqueId].set(N))}}}}}E.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],E._Configurations={}},11496:(V,p,W)=>{"use strict";W.d(p,{c:()=>U});var N=W(11167),d=W(11175),E=W(11387),z=W(10900),S=W(10923),Q=W(10952);const J=new RegExp("^([gimus]+)!");class i{constructor(V){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=V,this._scene=V.va(),this._engine=this._scene.getEngine()}_addPlugin(V){for(let N=0;N<this._plugins.length;++N)if(this._plugins[N].name===V.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!V.isCompatible(this._material.shaderLanguage))throw`The plugin "${V.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const p=V.getClassName();i._MaterialPluginClassToMainDefine[p]||(i._MaterialPluginClassToMainDefine[p]="MATERIALPLUGIN_"+ ++i._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(V,p)=>this._handlePluginEvent(V,p),this._plugins.push(V),this._plugins.sort(((V,p)=>V.priority-p.priority)),this._codeInjectionPoints={};const W={};W[i._MaterialPluginClassToMainDefine[p]]={type:"boolean",default:!0};for(const N of this._plugins)N.collectDefines(W),this._collectPointNames("vertex",N.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",N.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=W,!0}_activatePlugin(V){-1===this._activePlugins.indexOf(V)&&(this._activePlugins.push(V),this._activePlugins.sort(((V,p)=>V.priority-p.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),V.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(V),this._activePluginsForExtraEvents.sort(((V,p)=>V.priority-p.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(V){for(let p=0;p<this._plugins.length;++p)if(this._plugins[p].name===V)return this._plugins[p];return null}_handlePluginEventIsReadyForSubMesh(V){let p=!0;for(const W of this._activePlugins)p=p&&W.isReadyForSubMesh(V.defines,this._scene,this._engine,V.subMesh);V.isReadyForSubMesh=p}_handlePluginEventPrepareDefinesBeforeAttributes(V){for(const p of this._activePlugins)p.prepareDefinesBeforeAttributes(V.defines,this._scene,V.mesh)}_handlePluginEventPrepareDefines(V){for(const p of this._activePlugins)p.prepareDefines(V.defines,this._scene,V.mesh)}_handlePluginEventHardBindForSubMesh(V){for(const p of this._activePluginsForExtraEvents)p.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,V.subMesh)}_handlePluginEventBindForSubMesh(V){for(const p of this._activePlugins)p.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,V.subMesh)}_handlePluginEventHasRenderTargetTextures(V){let p=!1;for(const W of this._activePluginsForExtraEvents)if(p=W.hasRenderTargetTextures(),p)break;V.hasRenderTargetTextures=p}_handlePluginEventFillRenderTargetTextures(V){for(const p of this._activePluginsForExtraEvents)p.fillRenderTargetTextures(V.renderTargets)}_handlePluginEvent(V,p){switch(V){case 512:{const V=p;for(const p of this._activePlugins)p.getActiveTextures(V.activeTextures);break}case 256:{const V=p;for(const p of this._activePlugins)p.getAnimatables(V.animatables);break}case 1024:{const V=p;let W=!1;for(const p of this._activePlugins)if(W=p.hasTexture(V.texture),W)break;V.hasTexture=W;break}case 2:{const V=p;for(const p of this._plugins)p.dispose(V.forceDisposeTextures);break}case 4:p.defineNames=this._defineNamesFromPlugins;break;case 128:{const V=p;for(const p of this._activePlugins)V.fallbackRank=p.addFallbacks(V.defines,V.fallbacks,V.fallbackRank),p.getAttributes(V.attributes,this._scene,V.mesh);this._uniformList.length>0&&V.uniforms.push(...this._uniformList),this._samplerList.length>0&&V.samplers.push(...this._samplerList),this._uboList.length>0&&V.uniformBuffersNames.push(...this._uboList),V.customCode=this._injectCustomCode(V,V.customCode);break}case 8:{const V=p;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const W=1===this._material.shaderLanguage;for(const p of this._plugins){const N=p.getUniforms(this._material.shaderLanguage);if(N){if(N.ubo)for(const p of N.ubo){if(p.size&&p.type){const N=p.arraySize??0;if(V.ubo.addUniform(p.name,p.size,N),W){let V;switch(p.type){case"mat4":V="mat4x4f";break;case"float":V="f32";break;default:V=`${p.type}f`}this._uboDeclaration+=`uniform ${p.name}: ${V}${N>0?`[${N}]`:""};\n`}else this._uboDeclaration+=`${p.type} ${p.name}${N>0?`[${N}]`:""};\n`}this._uniformList.push(p.name)}N.vertex&&(this._vertexDeclaration+=N.vertex+"\n"),N.fragment&&(this._fragmentDeclaration+=N.fragment+"\n")}p.getSamplers(this._samplerList),p.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(V,p){if(p)for(const W in p)this._codeInjectionPoints[V]||(this._codeInjectionPoints[V]={}),this._codeInjectionPoints[V][W]=!0}_injectCustomCode(V,p){return(W,N)=>{var d;p&&(N=p(W,N)),this._uboDeclaration&&(N=N.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(N=N.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(N=N.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const E=null===(d=this._codeInjectionPoints)||void 0===d?void 0:d[W];if(!E)return N;let z=null;for(let p in E){let d="";for(const N of this._activePlugins){var i;let E=null===(i=N.getCustomCode(W,this._material.shaderLanguage))||void 0===i?void 0:i[p];if(E){if(N.resolveIncludes){if(null===z){const p=0;z={defines:[],indexParameters:V.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:Q.b.GetShadersRepository(p),includesShadersStore:Q.b.GetIncludesShadersStore(p),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}z.isFragment="fragment"===W,(0,S.h)(E,z,(V=>E=V))}d+=E+"\n"}}if(d.length>0)if("!"===p.charAt(0)){p=p.substring(1);let V="g";if("!"===p.charAt(0))V="",p=p.substring(1);else{const W=J.exec(p);W&&W.length>=2&&(V=W[1],p=p.substring(V.length+1))}V.indexOf("g")<0&&(V+="g");const W=N,E=new RegExp(p,V);let z=E.exec(W);for(;null!==z;){let V=d;for(let p=0;p<z.length;++p)V=V.replace("$"+p,z[p]);N=N.replace(z[0],V),z=E.exec(W)}}else{const V="#define "+p;N=N.replace(V,"\n"+d+"\n"+V)}}return N}}}i._MaterialPluginClassToMainDefine={},i._MaterialPluginCounter=0,z.d.OnEnginesDisposedObservable.add((()=>{u()}));const l=[];let j=!1,k=null;function u(){l.length=0,j=!1,E.d.OnEventObservable.remove(k),k=null}var f=W(11265),O=W(11004);class U{isCompatible(V){return 0===V}_enable(V){V&&this._pluginManager._activatePlugin(this)}constructor(V,p,W,N){let d=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],E=arguments.length>5&&void 0!==arguments[5]&&arguments[5],z=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=V,this.name=p,this.priority=W,this.resolveIncludes=z,V.pluginManager||(V.pluginManager=new i(V),V.$i.add((()=>{V.pluginManager=void 0}))),this._pluginDefineNames=N,this._pluginManager=V.pluginManager,d&&this._pluginManager._addPlugin(this),E&&this._enable(!0),this.markAllDefinesAsDirty=V._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(V,p,W,N){return!0}hardBindForSubMesh(V,p,W,N){}bindForSubMesh(V,p,W,N){}dispose(V){}getCustomCode(V){return null}collectDefines(V){if(this._pluginDefineNames)for(const p of Object.keys(this._pluginDefineNames)){if("_"===p[0])continue;const W=typeof this._pluginDefineNames[p];V[p]={type:"number"===W?"number":"string"===W?"string":"boolean"===W?"boolean":"object",default:this._pluginDefineNames[p]}}}prepareDefinesBeforeAttributes(V,p,W){}prepareDefines(V,p,W){}hasTexture(V){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(V){}getActiveTextures(V){}getAnimatables(V){}addFallbacks(V,p,W){return W}getSamplers(V){}getAttributes(V,p,W){}getUniformBuffersNames(V){}getUniforms(){return{}}copyTo(V){f.b.Clone((()=>V),this)}serialize(){return f.b.Serialize(this)}parse(V,p,W){f.b.Parse((()=>this),V,p,W)}}(0,N.c)([(0,d.I)()],U.prototype,"name",void 0),(0,N.c)([(0,d.I)()],U.prototype,"priority",void 0),(0,N.c)([(0,d.I)()],U.prototype,"resolveIncludes",void 0),(0,N.c)([(0,d.I)()],U.prototype,"registerForExtraEvents",void 0),(0,O.d)("BABYLON.MaterialPluginBase",U)},11582:(V,p,W)=>{"use strict";W.d(p,{c:()=>z});var N=W(11387),d=W(11209),E=W(11004);class z extends N.d{get eg(){return this._subMaterials}set eg(V){this._subMaterials=V,this._hookArray(V)}getChildren(){return this.eg}constructor(V,p){super(V,p,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.eg=[],this._storeEffectOnSubMeshes=!0}_hookArray(V){var p=this;const W=V.push;V.push=function(){for(var N=arguments.length,d=new Array(N),E=0;E<N;E++)d[E]=arguments[E];const z=W.apply(V,d);return p._markAllSubMeshesAsTexturesDirty(),z};const N=V.splice;V.splice=(p,W)=>{const d=N.apply(V,[p,W]);return this._markAllSubMeshesAsTexturesDirty(),d}}getSubMaterial(V){return V<0||V>=this.eg.length?this.va().defaultMaterial:this.eg[V]}getActiveTextures(){return super.getActiveTextures().concat(...this.eg.map((V=>V?V.getActiveTextures():[])))}hasTexture(V){if(super.hasTexture(V))return!0;for(let W=0;W<this.eg.length;W++){var p;if(null!==(p=this.eg[W])&&void 0!==p&&p.hasTexture(V))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(V,p,W){for(let N=0;N<this.eg.length;N++){const d=this.eg[N];if(d){if(d._storeEffectOnSubMeshes){if(!d.isReadyForSubMesh(V,p,W))return!1;continue}if(!d.isReady(V))return!1}}return!0}clone(V,p){const W=new z(V,this.va());for(let N=0;N<this.eg.length;N++){let d=null;const E=this.eg[N];d=p&&E?E.clone(V+"-"+E.name):this.eg[N],W.eg.push(d)}return W}serialize(){const V={};V.name=this.name,V.id=this.id,V.uniqueId=this.uniqueId,d.e&&(V.tags=d.e.GetTags(this)),V.materialsUniqueIds=[],V.materials=[];for(let p=0;p<this.eg.length;p++){const W=this.eg[p];W?(V.materialsUniqueIds.push(W.uniqueId),V.materials.push(W.id)):(V.materialsUniqueIds.push(null),V.materials.push(null))}return V}dispose(V,p,W){const N=this.va();if(!N)return;if(W)for(let E=0;E<this.eg.length;E++){const W=this.eg[E];W&&W.dispose(V,p)}const d=N.multiMaterials.indexOf(this);d>=0&&N.multiMaterials.splice(d,1),super.dispose(V,p)}static ParseMultiMaterial(V,p){const W=new z(V.name,p);return W.id=V.id,W._loadedUniqueId=V.uniqueId,d.e&&d.e.AddTagsTo(W,V.tags),V.materialsUniqueIds?W._waitingSubMaterialsUniqueIds=V.materialsUniqueIds:V.materials.forEach((V=>W.eg.push(p.getLastMaterialById(V)))),W}}(0,E.d)("BABYLON.MultiMaterial",z)},11378:(V,p,W)=>{"use strict";W.d(p,{e:()=>N});class N{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(V){V.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(V){}bindForSubMesh(V,p,W,N,d){if(p.prePassRenderer&&p.prePassRenderer.enabled&&p.prePassRenderer.currentRTisSceneRT&&(-1!==p.prePassRenderer.getIndex(2)||-1!==p.prePassRenderer.getIndex(11))){this.previousWorldMatrices[W.uniqueId]||(this.previousWorldMatrices[W.uniqueId]=N.clone()),this.previousViewProjection||(this.previousViewProjection=p.getTransformMatrix().clone(),this.currentViewProjection=p.getTransformMatrix().clone());const d=p.getEngine();this.currentViewProjection.updateFlag!==p.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=d.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(p.getTransformMatrix())):this._lastUpdateFrameId!==d.frameId&&(this._lastUpdateFrameId=d.frameId,this.previousViewProjection.p(this.currentViewProjection)),V.setMatrix("previousWorld",this.previousWorldMatrices[W.uniqueId]),V.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[W.uniqueId]=N.clone()}}}},11445:(V,p,W)=>{"use strict";W.d(p,{b:()=>E});var N=W(11218),d=W(11387);class E extends d.d{constructor(V,p){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(V,p,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new N.e,this._storeEffectOnSubMeshes=W}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(V,p){return!!V&&(!this._storeEffectOnSubMeshes||(!V.dg||0===V.dg.length||this.isReadyForSubMesh(V,V.dg[0],p)))}_isReadyForSubMesh(V){const p=V.materialDefines;return!(this.checkReadyOnEveryCall||!V.effect||!p||p._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(V){this._activeEffect.setMatrix("world",V)}bindOnlyNormalMatrix(V){this._activeEffect.setMatrix("normalMatrix",V)}bind(V,p){p&&this.bindForSubMesh(V,p,p.dg[0])}_afterBind(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0;super._afterBind(V,p,W),this.va()._cachedEffect=p,W?W._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return W._drawWrapper._forceRebindOnNextCall||V.isCachedMaterialInvalid(this,p,N)}dispose(V,p,W){this._activeEffect=void 0,super.dispose(V,p,W)}}},11159:(V,p,W)=>{"use strict";W.d(p,{b:()=>K});var N=W(11167),d=W(11175),E=W(11191),z=W(11200),S=W(11218),Q=W(11257),J=W(11291),i=W(11378),l=W(11251),j=W(11387),k=W(11442),u=W(11445),f=W(11452),O=W(11004),U=W(11470),F=W(11479),C=W(11488),A=W(11436),v=W(11434),t=W(11265),e=W(11501);const Z={effect:null,subMesh:null};class o extends k.c{constructor(V){super(V),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(V){const p=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const W of p)this[W]=W===V}}class K extends u.b{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(V){this._attachImageProcessingConfiguration(V),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(V){V!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=V||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(V){this.imageProcessingConfiguration.colorCurvesEnabled=V}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(V){this.imageProcessingConfiguration.colorGradingEnabled=V}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(V){this._imageProcessingConfiguration.toneMappingEnabled=V}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(V){this._imageProcessingConfiguration.exposure=V}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(V){this._imageProcessingConfiguration.contrast=V}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(V){this._imageProcessingConfiguration.colorGradingTexture=V}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(V){this._imageProcessingConfiguration.colorCurves=V}get canRenderToMRT(){return!0}constructor(V,p){super(V,p,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||K.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new Q.c(0,0,0),this.diffuseColor=new Q.c(1,1,1),this.specularColor=new Q.c(1,1,1),this.emissiveColor=new Q.c(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new E.f(16),this._worldViewProjectionMatrix=S.e.Zero(),this._globalAmbientColor=new Q.c(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new C.c(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new i.e,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),K.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),K.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(K.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(K.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"mb"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===j.d.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.xe&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==j.d.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.xe||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(V,p){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const d=p._drawWrapper;if(d.effect&&this.isFrozen&&d._wasPreviouslyReady&&d._wasPreviouslyUsingInstances===N)return!0;p.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),p.materialDefines=new o(this._eventInfo.defineNames));const E=this.va(),z=p.materialDefines;if(this._isReadyForSubMesh(p))return!0;const S=E.getEngine();z._needNormals=(0,v.I)(E,V,z,!0,this._maxSimultaneousLights,this._disableLighting),(0,v.S)(E,z);const Q=this.needAlphaBlendingForMesh(V)&&this.va().useOrderIndependentTransparency;if((0,v.Y)(E,z,this.canRenderToMRT&&!Q),(0,v.W)(E,z,Q),e.e.PrepareDefines(S.currentRenderPassId,V,z),z._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,z._needUVs=!1;for(let V=1;V<=6;++V)z["MAINUV"+V]=!1;if(E.texturesEnabled){if(z.DIFFUSEDIRECTUV=0,z.BUMPDIRECTUV=0,z.AMBIENTDIRECTUV=0,z.OPACITYDIRECTUV=0,z.EMISSIVEDIRECTUV=0,z.SPECULARDIRECTUV=0,z.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&K.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,v.M)(this._diffuseTexture,z,"DIFFUSE")}else z.DIFFUSE=!1;if(this._ambientTexture&&K.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,v.M)(this._ambientTexture,z,"AMBIENT")}else z.AMBIENT=!1;if(this._opacityTexture&&K.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,v.M)(this._opacityTexture,z,"OPACITY"),z.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else z.OPACITY=!1;if(this._reflectionTexture&&K.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(z._needNormals=!0,z.REFLECTION=!0,z.ROUGHNESS=this._roughness>0,z.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,z.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===f.d.INVCUBIC_MODE,z.REFLECTIONMAP_3D=this._reflectionTexture.isCube,z.REFLECTIONMAP_OPPOSITEZ=z.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,z.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case f.d.EXPLICIT_MODE:z.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case f.d.PLANAR_MODE:z.setReflectionMode("REFLECTIONMAP_PLANAR");break;case f.d.PROJECTION_MODE:z.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case f.d.SKYBOX_MODE:z.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case f.d.SPHERICAL_MODE:z.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case f.d.EQUIRECTANGULAR_MODE:z.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case f.d.FIXED_EQUIRECTANGULAR_MODE:z.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case f.d.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:z.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case f.d.CUBIC_MODE:case f.d.INVCUBIC_MODE:default:z.setReflectionMode("REFLECTIONMAP_CUBIC")}z.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else z.REFLECTION=!1,z.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&K.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,v.M)(this._emissiveTexture,z,"EMISSIVE")}else z.EMISSIVE=!1;if(this._lightmapTexture&&K.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,v.M)(this._lightmapTexture,z,"LIGHTMAP"),z.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,z.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else z.LIGHTMAP=!1;if(this._specularTexture&&K.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,v.M)(this._specularTexture,z,"SPECULAR"),z.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else z.SPECULAR=!1;if(E.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&K.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,v.M)(this._bumpTexture,z,"BUMP"),z.PARALLAX=this._useParallax,z.PARALLAX_RHS=E.useRightHandedSystem,z.PARALLAXOCCLUSION=this._useParallaxOcclusion,z.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else z.BUMP=!1,z.PARALLAX=!1,z.PARALLAX_RHS=!1,z.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&K.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;z._needUVs=!0,z.REFRACTION=!0,z.REFRACTIONMAP_3D=this._refractionTexture.isCube,z.RGBDREFRACTION=this._refractionTexture.isRGBD,z.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else z.REFRACTION=!1;z.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else z.DIFFUSE=!1,z.AMBIENT=!1,z.OPACITY=!1,z.REFLECTION=!1,z.EMISSIVE=!1,z.LIGHTMAP=!1,z.BUMP=!1,z.REFRACTION=!1;z.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),z.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,z.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,z.SPECULAROVERALPHA=this._useSpecularOverAlpha,z.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,z.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,z.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(V)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=z,this._eventInfo.subMesh=p,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(z._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(z),z.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,z.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}z._areFresnelDirty&&(K.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(z.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,z.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,z.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,z.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,z.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,z.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,z._needNormals=!0,z.FRESNEL=!0):z.FRESNEL=!1),(0,v.O)(V,E,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(V)||this._forceAlphaTest,z,this._applyDecalMapAfterDetailMap),(0,v.F)(E,S,this,z,N,null,p.getRenderingMesh().hasThinInstances),this._eventInfo.defines=z,this._eventInfo.mesh=V,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,v.E)(V,z,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let j=!1;if(z.isDirty){const N=z._areLightsDisposed;z.markAsProcessed();const d=new F.b;z.REFLECTION&&d.addFallback(0,"REFLECTION"),z.SPECULAR&&d.addFallback(0,"SPECULAR"),z.BUMP&&d.addFallback(0,"BUMP"),z.PARALLAX&&d.addFallback(1,"PARALLAX"),z.PARALLAX_RHS&&d.addFallback(1,"PARALLAX_RHS"),z.PARALLAXOCCLUSION&&d.addFallback(0,"PARALLAXOCCLUSION"),z.SPECULAROVERALPHA&&d.addFallback(0,"SPECULAROVERALPHA"),z.FOG&&d.addFallback(1,"FOG"),z.POINTSIZE&&d.addFallback(0,"POINTSIZE"),z.LOGARITHMICDEPTH&&d.addFallback(0,"LOGARITHMICDEPTH"),(0,v.w)(z,d,this._maxSimultaneousLights),z.SPECULARTERM&&d.addFallback(0,"SPECULARTERM"),z.DIFFUSEFRESNEL&&d.addFallback(1,"DIFFUSEFRESNEL"),z.OPACITYFRESNEL&&d.addFallback(2,"OPACITYFRESNEL"),z.REFLECTIONFRESNEL&&d.addFallback(3,"REFLECTIONFRESNEL"),z.EMISSIVEFRESNEL&&d.addFallback(4,"EMISSIVEFRESNEL"),z.FRESNEL&&d.addFallback(4,"FRESNEL"),z.MULTIVIEW&&d.addFallback(0,"MULTIVIEW");const Q=[J.f.PositionKind];z.NORMAL&&Q.push(J.f.NormalKind),z.TANGENT&&Q.push(J.f.TangentKind);for(let V=1;V<=6;++V)z["UV"+V]&&Q.push(`uv${1===V?"":V}`);z.VERTEXCOLOR&&Q.push(J.f.ColorKind),(0,v.A)(Q,V,z,d),(0,v.B)(Q,z),(0,v.C)(Q,V,z),(0,v.x)(Q,V,z);let k="default";const u=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],f=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],O=["Material","Scene","Mesh"],U={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:z.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=d,this._eventInfo.fallbackRank=0,this._eventInfo.defines=z,this._eventInfo.uniforms=u,this._eventInfo.attributes=Q,this._eventInfo.samplers=f,this._eventInfo.uniformBuffersNames=O,this._eventInfo.customCode=void 0,this._eventInfo.mesh=V,this._eventInfo.indexParameters=U,this._callbackPluginEventGeneric(128,this._eventInfo),e.e.AddUniformsAndSamplers(u,f),i.e.AddUniforms(u),i.e.AddSamplers(f),l.c&&(l.c.PrepareUniforms(u,z),l.c.PrepareSamplers(f,z)),(0,v._)({uniformsNames:u,uniformBuffersNames:O,samplers:f,defines:z,maxSimultaneousLights:this._maxSimultaneousLights}),(0,A.b)(u);const C={};this.customShaderNameResolve&&(k=this.customShaderNameResolve(k,u,O,f,z,Q,C));const t=z.toString(),o=p.effect;let K=E.getEngine().createEffect(k,{attributes:Q,uniformsNames:u,uniformBuffersNames:O,samplers:f,defines:t,fallbacks:d,onCompiled:this.onCompiled,onError:this.onError,indexParameters:U,processFinalCode:C.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:z.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([W.e(21),W.e(19)]).then(W.bind(W,13251)),Promise.all([W.e(22),W.e(20)]).then(W.bind(W,13390))]):await Promise.all([Promise.all([W.e(25),W.e(24)]).then(W.bind(W,13472)),Promise.all([W.e(27),W.e(26)]).then(W.bind(W,13618))]),this._shadersLoaded=!0}},S);if(this._eventInfo.customCode=void 0,K)if(this._onEffectCreatedObservable&&(Z.effect=K,Z.subMesh=p,this._onEffectCreatedObservable.notifyObservers(Z)),this.allowShaderHotSwapping&&o&&!K.isReady()){if(K=o,z.markAsUnprocessed(),j=this.isFrozen,N)return z._areLightsDisposed=!0,!1}else E.resetCachedMaterial(),p.setEffect(K,z,this._materialContext)}return!(!p.effect||!p.effect.isReady())&&(z._renderId=E.getRenderId(),d._wasPreviouslyReady=!j,d._wasPreviouslyUsingInstances=N,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const V=this._uniformBuffer;V.addUniform("diffuseLeftColor",4),V.addUniform("diffuseRightColor",4),V.addUniform("opacityParts",4),V.addUniform("reflectionLeftColor",4),V.addUniform("reflectionRightColor",4),V.addUniform("refractionLeftColor",4),V.addUniform("refractionRightColor",4),V.addUniform("emissiveLeftColor",4),V.addUniform("emissiveRightColor",4),V.addUniform("vDiffuseInfos",2),V.addUniform("vAmbientInfos",2),V.addUniform("vOpacityInfos",2),V.addUniform("vReflectionInfos",2),V.addUniform("vReflectionPosition",3),V.addUniform("vReflectionSize",3),V.addUniform("vEmissiveInfos",2),V.addUniform("vLightmapInfos",2),V.addUniform("vSpecularInfos",2),V.addUniform("vBumpInfos",3),V.addUniform("diffuseMatrix",16),V.addUniform("ambientMatrix",16),V.addUniform("opacityMatrix",16),V.addUniform("reflectionMatrix",16),V.addUniform("emissiveMatrix",16),V.addUniform("lightmapMatrix",16),V.addUniform("specularMatrix",16),V.addUniform("bumpMatrix",16),V.addUniform("vTangentSpaceParams",2),V.addUniform("pointSize",1),V.addUniform("alphaCutOff",1),V.addUniform("refractionMatrix",16),V.addUniform("vRefractionInfos",4),V.addUniform("vRefractionPosition",3),V.addUniform("vRefractionSize",3),V.addUniform("vSpecularColor",4),V.addUniform("vEmissiveColor",3),V.addUniform("vDiffuseColor",4),V.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(V,p,W){const N=this.va(),d=W.materialDefines;if(!d)return;const E=W.effect;if(!E)return;this._activeEffect=E,p.getMeshUniformBuffer().bindToEffect(E,"Mesh"),p.transferToEffect(V),this._uniformBuffer.bindToEffect(E,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,N,p,V,this.isFrozen),e.e.Bind(N.getEngine().currentRenderPassId,this._activeEffect,p,V),this._eventInfo.subMesh=W,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),d.OBJECTSPACE_NORMALMAP&&(V.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const S=this._mustRebind(N,E,W,p.visibility);(0,v.e)(p,E);const J=this._uniformBuffer;if(S){if(this.bindViewProjection(E),!J.useUbo||!this.isFrozen||!J.isSync||W._drawWrapper._forceRebindOnNextCall){if(K.FresnelEnabled&&d.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(J.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),J.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&J.updateColor4("opacityParts",new Q.c(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(J.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),J.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(J.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),J.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(J.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),J.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),N.texturesEnabled){if(this._diffuseTexture&&K.DiffuseTextureEnabled&&(J.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,v.t)(this._diffuseTexture,J,"diffuse")),this._ambientTexture&&K.AmbientTextureEnabled&&(J.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,v.t)(this._ambientTexture,J,"ambient")),this._opacityTexture&&K.OpacityTextureEnabled&&(J.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,v.t)(this._opacityTexture,J,"opacity")),this._hasAlphaChannel()&&J.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&K.ReflectionTextureEnabled&&(J.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),J.wj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const V=this._reflectionTexture;J.updateVector3("vReflectionPosition",V.boundingBoxPosition),J.updateVector3("vReflectionSize",V.boundingBoxSize)}if(this._emissiveTexture&&K.EmissiveTextureEnabled&&(J.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,v.t)(this._emissiveTexture,J,"emissive")),this._lightmapTexture&&K.LightmapTextureEnabled&&(J.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,v.t)(this._lightmapTexture,J,"lightmap")),this._specularTexture&&K.SpecularTextureEnabled&&(J.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,v.t)(this._specularTexture,J,"specular")),this._bumpTexture&&N.getEngine().getCaps().standardDerivatives&&K.BumpTextureEnabled&&(J.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,v.t)(this._bumpTexture,J,"bump"),N._mirroredCameraPosition?J.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):J.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&K.RefractionTextureEnabled){let V=1;if(this._refractionTexture.isCube||(J.wj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(V=this._refractionTexture.depth)),J.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,V,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const V=this._refractionTexture;J.updateVector3("vRefractionPosition",V.boundingBoxPosition),J.updateVector3("vRefractionSize",V.boundingBoxSize)}}}this.pointsCloud&&J.updateFloat("pointSize",this.pointSize),J.updateColor4("vSpecularColor",this.specularColor,this.specularPower),J.updateColor3("vEmissiveColor",K.EmissiveTextureEnabled?this.emissiveColor:Q.c.BlackReadOnly),J.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),N.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),J.updateColor3("vAmbientColor",this._globalAmbientColor)}N.texturesEnabled&&(this._diffuseTexture&&K.DiffuseTextureEnabled&&E.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&K.AmbientTextureEnabled&&E.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&K.OpacityTextureEnabled&&E.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&K.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?E.setTexture("reflectionCubeSampler",this._reflectionTexture):E.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&K.EmissiveTextureEnabled&&E.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&K.LightmapTextureEnabled&&E.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&K.SpecularTextureEnabled&&E.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&N.getEngine().getCaps().standardDerivatives&&K.BumpTextureEnabled&&E.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&K.RefractionTextureEnabled&&(this._refractionTexture.isCube?E.setTexture("refractionCubeSampler",this._refractionTexture):E.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(p)&&this.va().depthPeelingRenderer.bind(E),this._eventInfo.subMesh=W,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,A.e)(E,this,N),this.bindEyePosition(E)}else N.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(S||!this.isFrozen){var i;if(N.lightsEnabled&&!this._disableLighting&&(0,v.i)(N,p,E,d,this._maxSimultaneousLights),(N.fogEnabled&&p.applyFog&&N.fogMode!==z.e.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||p.receiveShadows||d.PREPASS)&&this.bindView(E),(0,v.g)(N,p,E),d.NUM_MORPH_INFLUENCERS&&(0,v.m)(p,E),d.BAKED_VERTEX_ANIMATION_TEXTURE)null===(i=p.bakedVertexAnimationManager)||void 0===i||i.bind(E,d.INSTANCES);this.useLogarithmicDepth&&(0,v.k)(d,E,N),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(p,this._activeEffect,W),J.update()}getAnimatables(){const V=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&V.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&V.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&V.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&V.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&V.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&V.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&V.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&V.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&V.push(this._refractionTexture),V}getActiveTextures(){const V=super.getActiveTextures();return this._diffuseTexture&&V.push(this._diffuseTexture),this._ambientTexture&&V.push(this._ambientTexture),this._opacityTexture&&V.push(this._opacityTexture),this._reflectionTexture&&V.push(this._reflectionTexture),this._emissiveTexture&&V.push(this._emissiveTexture),this._specularTexture&&V.push(this._specularTexture),this._bumpTexture&&V.push(this._bumpTexture),this._lightmapTexture&&V.push(this._lightmapTexture),this._refractionTexture&&V.push(this._refractionTexture),V}hasTexture(V){return!!super.hasTexture(V)||(this._diffuseTexture===V||(this._ambientTexture===V||(this._opacityTexture===V||(this._reflectionTexture===V||(this._emissiveTexture===V||(this._specularTexture===V||(this._bumpTexture===V||(this._lightmapTexture===V||this._refractionTexture===V))))))))}dispose(V,p){var W,N,d,E,z,S,Q,J,i;p&&(null===(W=this._diffuseTexture)||void 0===W||W.dispose(),null===(N=this._ambientTexture)||void 0===N||N.dispose(),null===(d=this._opacityTexture)||void 0===d||d.dispose(),null===(E=this._reflectionTexture)||void 0===E||E.dispose(),null===(z=this._emissiveTexture)||void 0===z||z.dispose(),null===(S=this._specularTexture)||void 0===S||S.dispose(),null===(Q=this._bumpTexture)||void 0===Q||Q.dispose(),null===(J=this._lightmapTexture)||void 0===J||J.dispose(),null===(i=this._refractionTexture)||void 0===i||i.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(V,p)}clone(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const N=t.b.Clone((()=>new K(V,this.va())),this,{cloneTexturesOnlyOnce:p});return N.name=V,N.id=V,this.stencil.copyTo(N.stencil),this._clonePlugins(N,W),N}static Parse(V,p,W){const N=t.b.Parse((()=>new K(V.name,p)),V,p,W);return V.stencil&&N.stencil.parse(V.stencil,p,W),j.d._ParsePlugins(V,N,p,W),N}static get DiffuseTextureEnabled(){return U.c.DiffuseTextureEnabled}static set DiffuseTextureEnabled(V){U.c.DiffuseTextureEnabled=V}static get DetailTextureEnabled(){return U.c.DetailTextureEnabled}static set DetailTextureEnabled(V){U.c.DetailTextureEnabled=V}static get AmbientTextureEnabled(){return U.c.AmbientTextureEnabled}static set AmbientTextureEnabled(V){U.c.AmbientTextureEnabled=V}static get OpacityTextureEnabled(){return U.c.OpacityTextureEnabled}static set OpacityTextureEnabled(V){U.c.OpacityTextureEnabled=V}static get ReflectionTextureEnabled(){return U.c.ReflectionTextureEnabled}static set ReflectionTextureEnabled(V){U.c.ReflectionTextureEnabled=V}static get EmissiveTextureEnabled(){return U.c.EmissiveTextureEnabled}static set EmissiveTextureEnabled(V){U.c.EmissiveTextureEnabled=V}static get SpecularTextureEnabled(){return U.c.SpecularTextureEnabled}static set SpecularTextureEnabled(V){U.c.SpecularTextureEnabled=V}static get BumpTextureEnabled(){return U.c.BumpTextureEnabled}static set BumpTextureEnabled(V){U.c.BumpTextureEnabled=V}static get LightmapTextureEnabled(){return U.c.LightmapTextureEnabled}static set LightmapTextureEnabled(V){U.c.LightmapTextureEnabled=V}static get RefractionTextureEnabled(){return U.c.RefractionTextureEnabled}static set RefractionTextureEnabled(V){U.c.RefractionTextureEnabled=V}static get ColorGradingTextureEnabled(){return U.c.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(V){U.c.ColorGradingTextureEnabled=V}static get FresnelEnabled(){return U.c.FresnelEnabled}static set FresnelEnabled(V){U.c.FresnelEnabled=V}}K.ForceGLSL=!1,(0,N.c)([(0,d.A)("diffuseTexture")],K.prototype,"_diffuseTexture",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],K.prototype,"diffuseTexture",void 0),(0,N.c)([(0,d.A)("ambientTexture")],K.prototype,"_ambientTexture",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"ambientTexture",void 0),(0,N.c)([(0,d.A)("opacityTexture")],K.prototype,"_opacityTexture",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],K.prototype,"opacityTexture",void 0),(0,N.c)([(0,d.A)("reflectionTexture")],K.prototype,"_reflectionTexture",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"reflectionTexture",void 0),(0,N.c)([(0,d.A)("emissiveTexture")],K.prototype,"_emissiveTexture",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"emissiveTexture",void 0),(0,N.c)([(0,d.A)("specularTexture")],K.prototype,"_specularTexture",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"specularTexture",void 0),(0,N.c)([(0,d.A)("bumpTexture")],K.prototype,"_bumpTexture",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"bumpTexture",void 0),(0,N.c)([(0,d.A)("lightmapTexture")],K.prototype,"_lightmapTexture",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"lightmapTexture",void 0),(0,N.c)([(0,d.A)("refractionTexture")],K.prototype,"_refractionTexture",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"refractionTexture",void 0),(0,N.c)([(0,d.k)("ambient")],K.prototype,"ambientColor",void 0),(0,N.c)([(0,d.k)("diffuse")],K.prototype,"diffuseColor",void 0),(0,N.c)([(0,d.k)("specular")],K.prototype,"specularColor",void 0),(0,N.c)([(0,d.k)("emissive")],K.prototype,"emissiveColor",void 0),(0,N.c)([(0,d.I)()],K.prototype,"specularPower",void 0),(0,N.c)([(0,d.I)("useAlphaFromDiffuseTexture")],K.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],K.prototype,"useAlphaFromDiffuseTexture",void 0),(0,N.c)([(0,d.I)("useEmissiveAsIllumination")],K.prototype,"_useEmissiveAsIllumination",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useEmissiveAsIllumination",void 0),(0,N.c)([(0,d.I)("linkEmissiveWithDiffuse")],K.prototype,"_linkEmissiveWithDiffuse",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"linkEmissiveWithDiffuse",void 0),(0,N.c)([(0,d.I)("useSpecularOverAlpha")],K.prototype,"_useSpecularOverAlpha",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useSpecularOverAlpha",void 0),(0,N.c)([(0,d.I)("useReflectionOverAlpha")],K.prototype,"_useReflectionOverAlpha",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useReflectionOverAlpha",void 0),(0,N.c)([(0,d.I)("disableLighting")],K.prototype,"_disableLighting",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsLightsDirty")],K.prototype,"disableLighting",void 0),(0,N.c)([(0,d.I)("useObjectSpaceNormalMap")],K.prototype,"_useObjectSpaceNormalMap",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useObjectSpaceNormalMap",void 0),(0,N.c)([(0,d.I)("useParallax")],K.prototype,"_useParallax",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useParallax",void 0),(0,N.c)([(0,d.I)("useParallaxOcclusion")],K.prototype,"_useParallaxOcclusion",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useParallaxOcclusion",void 0),(0,N.c)([(0,d.I)()],K.prototype,"parallaxScaleBias",void 0),(0,N.c)([(0,d.I)("roughness")],K.prototype,"_roughness",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"roughness",void 0),(0,N.c)([(0,d.I)()],K.prototype,"indexOfRefraction",void 0),(0,N.c)([(0,d.I)()],K.prototype,"invertRefractionY",void 0),(0,N.c)([(0,d.I)()],K.prototype,"alphaCutOff",void 0),(0,N.c)([(0,d.I)("useLightmapAsShadowmap")],K.prototype,"_useLightmapAsShadowmap",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useLightmapAsShadowmap",void 0),(0,N.c)([(0,d.n)("diffuseFresnelParameters")],K.prototype,"_diffuseFresnelParameters",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsFresnelDirty")],K.prototype,"diffuseFresnelParameters",void 0),(0,N.c)([(0,d.n)("opacityFresnelParameters")],K.prototype,"_opacityFresnelParameters",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsFresnelAndMiscDirty")],K.prototype,"opacityFresnelParameters",void 0),(0,N.c)([(0,d.n)("reflectionFresnelParameters")],K.prototype,"_reflectionFresnelParameters",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsFresnelDirty")],K.prototype,"reflectionFresnelParameters",void 0),(0,N.c)([(0,d.n)("refractionFresnelParameters")],K.prototype,"_refractionFresnelParameters",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsFresnelDirty")],K.prototype,"refractionFresnelParameters",void 0),(0,N.c)([(0,d.n)("emissiveFresnelParameters")],K.prototype,"_emissiveFresnelParameters",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsFresnelDirty")],K.prototype,"emissiveFresnelParameters",void 0),(0,N.c)([(0,d.I)("useReflectionFresnelFromSpecular")],K.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsFresnelDirty")],K.prototype,"useReflectionFresnelFromSpecular",void 0),(0,N.c)([(0,d.I)("useGlossinessFromSpecularMapAlpha")],K.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,N.c)([(0,d.I)("maxSimultaneousLights")],K.prototype,"_maxSimultaneousLights",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsLightsDirty")],K.prototype,"maxSimultaneousLights",void 0),(0,N.c)([(0,d.I)("invertNormalMapX")],K.prototype,"_invertNormalMapX",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"invertNormalMapX",void 0),(0,N.c)([(0,d.I)("invertNormalMapY")],K.prototype,"_invertNormalMapY",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"invertNormalMapY",void 0),(0,N.c)([(0,d.I)("twoSidedLighting")],K.prototype,"_twoSidedLighting",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsTexturesDirty")],K.prototype,"twoSidedLighting",void 0),(0,N.c)([(0,d.I)("applyDecalMapAfterDetailMap")],K.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,N.c)([(0,d.d)("_markAllSubMeshesAsMiscDirty")],K.prototype,"applyDecalMapAfterDetailMap",void 0),(0,O.d)("BABYLON.StandardMaterial",K),z.e.DefaultMaterialFactory=V=>new K("default material",V)},11278:(V,p,W)=>{"use strict";W.d(p,{c:()=>E});var N=W(10870),d=W(10848);class E{constructor(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=V,this._noUBO=!V.supportsUniformBuffers||d,this._dynamic=W,this._name=N??"no-name",this._data=p||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.wj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.wj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(V){let p;if(p=V<=2?V:4,this._uniformLocationPointer%p!==0){const V=this._uniformLocationPointer;this._uniformLocationPointer+=p-this._uniformLocationPointer%p;const W=this._uniformLocationPointer-V;for(let p=0;p<W;p++)this._data.push(0)}}addUniform(V,p){let W,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[V]){if(N>0){if(p instanceof Array)throw"addUniform should not be use with Array in UBO: "+V;if(this._fillAlignment(4),this._uniformArraySizes[V]={strideSize:p,arraySize:N},16==p)p*=N;else{p=p*N+(4-p)*N}W=[];for(let V=0;V<p;V++)W.push(0)}else{if(p instanceof Array)W=p,p=W.length;else{W=[];for(let V=0;V<p;V++)W.push(0)}this._fillAlignment(p)}this._uniformSizes[V]=p,this._uniformLocations[V]=this._uniformLocationPointer,this._uniformLocationPointer+=p;for(let V=0;V<p;V++)this._data.push(W[V]);this._needSync=!0}}addMatrix(V,p){this.addUniform(V,Array.prototype.slice.call(p.Zi()))}addFloat2(V,p,W){const N=[p,W];this.addUniform(V,N)}addFloat3(V,p,W,N){const d=[p,W,N];this.addUniform(V,d)}addColor3(V,p){const W=[p.r,p.g,p.b];this.addUniform(V,W)}addColor4(V,p,W){const N=[p.r,p.g,p.b,W];this.addUniform(V,N)}addVector3(V,p){const W=[p.x,p.y,p.z];this.addUniform(V,W)}addMatrix3x3(V){this.addUniform(V,12)}addMatrix2x2(V){this.addUniform(V,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const V=[];let p=0;for(const W in this._uniformLocations)if(V.push(W),10===++p)break;return V.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(V,p){for(let W=0;W<V.length;++W)if(V[W]!==p[W])return!1;return!0}_copyBuffer(V,p){for(let W=0;W<V.length;++W)p[W]=V[W]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(E._UpdatedUbosInFrame[this._name]||(E._UpdatedUbosInFrame[this._name]=0),E._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(V,p,W){this._checkNewFrame();let d=this._uniformLocations[V];if(void 0===d){if(this._buffer)return void N.e.Error("Cannot add an uniform after UBO has been created. uniformName="+V);this.addUniform(V,W),d=this._uniformLocations[V]}if(this._buffer||this.create(),this._dynamic)for(let N=0;N<W;N++)this._bufferData[d+N]=p[N];else{let V=!1;for(let N=0;N<W;N++)(16===W&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[d+N]!==Math.fround(p[N]))&&(V=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[d+N]=p[N]);this._needSync=this._needSync||V}}updateUniformArray(V,p,W){this._checkNewFrame();const E=this._uniformLocations[V];if(void 0===E)return void N.e.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const z=this._uniformArraySizes[V];if(this._dynamic)for(let N=0;N<W;N++)this._bufferData[E+N]=p[N];else{let V=!1,N=0,S=0;for(let Q=0;Q<W;Q++)if(this._bufferData[E+4*S+N]!==d.e.FloatRound(p[Q])&&(V=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[E+4*S+N]=p[Q]),N++,N===z.strideSize){for(;N<4;N++)this._bufferData[E+4*S+N]=0;N=0,S++}this._needSync=this._needSync||V}}_cacheMatrix(V,p){this._checkNewFrame();const W=this._valueCache[V],N=p.updateFlag;return(void 0===W||W!==N)&&(this._valueCache[V]=N,!0)}_updateMatrix3x3ForUniform(V,p){for(let W=0;W<3;W++)E._TempBuffer[4*W]=p[3*W],E._TempBuffer[4*W+1]=p[3*W+1],E._TempBuffer[4*W+2]=p[3*W+2],E._TempBuffer[4*W+3]=0;this.updateUniform(V,E._TempBuffer,12)}_updateMatrix3x3ForEffect(V,p){this._currentEffect.setMatrix3x3(V,p)}_updateMatrix2x2ForEffect(V,p){this._currentEffect.setMatrix2x2(V,p)}_updateMatrix2x2ForUniform(V,p){for(let W=0;W<2;W++)E._TempBuffer[4*W]=p[2*W],E._TempBuffer[4*W+1]=p[2*W+1],E._TempBuffer[4*W+2]=0,E._TempBuffer[4*W+3]=0;this.updateUniform(V,E._TempBuffer,8)}_updateFloatForEffect(V,p){this._currentEffect.setFloat(V,p)}_updateFloatForUniform(V,p){E._TempBuffer[0]=p,this.updateUniform(V,E._TempBuffer,1)}_updateFloat2ForEffect(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(V+N,p,W)}_updateFloat2ForUniform(V,p,W){E._TempBuffer[0]=p,E._TempBuffer[1]=W,this.updateUniform(V,E._TempBuffer,2)}_updateFloat3ForEffect(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(V+d,p,W,N)}_updateFloat3ForUniform(V,p,W,N){E._TempBuffer[0]=p,E._TempBuffer[1]=W,E._TempBuffer[2]=N,this.updateUniform(V,E._TempBuffer,3)}_updateFloat4ForEffect(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(V+E,p,W,N,d)}_updateFloat4ForUniform(V,p,W,N,d){E._TempBuffer[0]=p,E._TempBuffer[1]=W,E._TempBuffer[2]=N,E._TempBuffer[3]=d,this.updateUniform(V,E._TempBuffer,4)}_updateFloatArrayForEffect(V,p){this._currentEffect.setFloatArray(V,p)}_updateFloatArrayForUniform(V,p){this.updateUniformArray(V,p,p.length)}_updateArrayForEffect(V,p){this._currentEffect.setArray(V,p)}_updateArrayForUniform(V,p){this.updateUniformArray(V,p,p.length)}_updateIntArrayForEffect(V,p){this._currentEffect.setIntArray(V,p)}_updateIntArrayForUniform(V,p){E._TempBufferInt32View.set(p),this.updateUniformArray(V,E._TempBuffer,p.length)}_updateUIntArrayForEffect(V,p){this._currentEffect.setUIntArray(V,p)}_updateUIntArrayForUniform(V,p){E._TempBufferUInt32View.set(p),this.updateUniformArray(V,E._TempBuffer,p.length)}_updateMatrixForEffect(V,p){this._currentEffect.setMatrix(V,p)}_updateMatrixForUniform(V,p){this._cacheMatrix(V,p)&&this.updateUniform(V,p.Zi(),16)}_updateMatricesForEffect(V,p){this._currentEffect.setMatrices(V,p)}_updateMatricesForUniform(V,p){this.updateUniform(V,p,p.length)}_updateVector3ForEffect(V,p){this._currentEffect.setVector3(V,p)}_updateVector3ForUniform(V,p){E._TempBuffer[0]=p.x,E._TempBuffer[1]=p.y,E._TempBuffer[2]=p.z,this.updateUniform(V,E._TempBuffer,3)}_updateVector4ForEffect(V,p){this._currentEffect.setVector4(V,p)}_updateVector4ForUniform(V,p){E._TempBuffer[0]=p.x,E._TempBuffer[1]=p.y,E._TempBuffer[2]=p.z,E._TempBuffer[3]=p.w,this.updateUniform(V,E._TempBuffer,4)}_updateColor3ForEffect(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(V+W,p)}_updateColor3ForUniform(V,p){E._TempBuffer[0]=p.r,E._TempBuffer[1]=p.g,E._TempBuffer[2]=p.b,this.updateUniform(V,E._TempBuffer,3)}_updateColor4ForEffect(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(V+N,p,W)}_updateDirectColor4ForEffect(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(V+W,p)}_updateColor4ForUniform(V,p,W){E._TempBuffer[0]=p.r,E._TempBuffer[1]=p.g,E._TempBuffer[2]=p.b,E._TempBuffer[3]=W,this.updateUniform(V,E._TempBuffer,4)}_updateDirectColor4ForUniform(V,p){E._TempBuffer[0]=p.r,E._TempBuffer[1]=p.g,E._TempBuffer[2]=p.b,E._TempBuffer[3]=p.a,this.updateUniform(V,E._TempBuffer,4)}_updateIntForEffect(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(V+W,p)}_updateIntForUniform(V,p){E._TempBufferInt32View[0]=p,this.updateUniform(V,E._TempBuffer,1)}_updateInt2ForEffect(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(V+N,p,W)}_updateInt2ForUniform(V,p,W){E._TempBufferInt32View[0]=p,E._TempBufferInt32View[1]=W,this.updateUniform(V,E._TempBuffer,2)}_updateInt3ForEffect(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(V+d,p,W,N)}_updateInt3ForUniform(V,p,W,N){E._TempBufferInt32View[0]=p,E._TempBufferInt32View[1]=W,E._TempBufferInt32View[2]=N,this.updateUniform(V,E._TempBuffer,3)}_updateInt4ForEffect(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(V+E,p,W,N,d)}_updateInt4ForUniform(V,p,W,N,d){E._TempBufferInt32View[0]=p,E._TempBufferInt32View[1]=W,E._TempBufferInt32View[2]=N,E._TempBufferInt32View[3]=d,this.updateUniform(V,E._TempBuffer,4)}_updateUIntForEffect(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(V+W,p)}_updateUIntForUniform(V,p){E._TempBufferUInt32View[0]=p,this.updateUniform(V,E._TempBuffer,1)}_updateUInt2ForEffect(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(V+N,p,W)}_updateUInt2ForUniform(V,p,W){E._TempBufferUInt32View[0]=p,E._TempBufferUInt32View[1]=W,this.updateUniform(V,E._TempBuffer,2)}_updateUInt3ForEffect(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(V+d,p,W,N)}_updateUInt3ForUniform(V,p,W,N){E._TempBufferUInt32View[0]=p,E._TempBufferUInt32View[1]=W,E._TempBufferUInt32View[2]=N,this.updateUniform(V,E._TempBuffer,3)}_updateUInt4ForEffect(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(V+E,p,W,N,d)}_updateUInt4ForUniform(V,p,W,N,d){E._TempBufferUInt32View[0]=p,E._TempBufferUInt32View[1]=W,E._TempBufferUInt32View[2]=N,E._TempBufferUInt32View[3]=d,this.updateUniform(V,E._TempBuffer,4)}setTexture(V,p){this._currentEffect.setTexture(V,p)}setTextureArray(V,p){this._currentEffect.setTextureArray(V,p)}bindTexture(V,p){this._currentEffect._bindTexture(V,p)}updateUniformDirectly(V,p){this.updateUniform(V,p,p.length),this.update()}bindToEffect(V,p){this._currentEffect=V,this._currentEffectName=p}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(V){if(!this._buffers)return this._buffer===V;for(let p=0;p<this._buffers.length;++p){if(this._buffers[p][0]===V)return this._bufferIndex=p,this._buffer=V,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const V=this._engine._uniformBuffers,p=V.indexOf(this);if(-1!==p&&(V[p]=V[V.length-1],V.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let W=0;W<this._buffers.length;++W){const V=this._buffers[W][0];this._engine._releaseBuffer(V)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}E._UpdatedUbosInFrame={},E._MAX_UNIFORM_SIZE=256,E._TempBuffer=new Float32Array(E._MAX_UNIFORM_SIZE),E._TempBufferInt32View=new Int32Array(E._TempBuffer.buffer),E._TempBufferUInt32View=new Uint32Array(E._TempBuffer.buffer)},11579:(V,p,W)=>{"use strict";W.d(p,{e:()=>z,f:()=>N});var N,d,E=W(11218);!function(V){V[V.LOCAL=0]="LOCAL",V[V.WORLD=1]="WORLD",V[V.BONE=2]="BONE"}(N||(N={}));class z{}z.X=new E.n(1,0,0),z.Y=new E.n(0,1,0),z.Z=new E.n(0,0,1),function(V){V[V.X=0]="X",V[V.Y=1]="Y",V[V.Z=2]="Z"}(d||(d={}))},11257:(V,p,W)=>{"use strict";W.d(p,{c:()=>l,e:()=>j,g:()=>k});var N=W(11233),d=W(11004),E=W(11224),z=W(11242);function S(V){return Math.pow(V,E.j)}function Q(V){return V<=.04045?.0773993808*V:Math.pow(.947867299*(V+.055),2.4)}function J(V){return Math.pow(V,E.i)}function i(V){return V<=.0031308?12.92*V:1.055*Math.pow(V,.41666)-.055}class l{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=V,this.g=p,this.b=W}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"gb"}getHashCode(){let V=255*this.r|0;return V=397*V^255*this.g,V=397*V^255*this.b,V}toArray(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[p]=this.r,V[p+1]=this.g,V[p+2]=this.b,this}fd(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return l.FromArrayToRef(V,p,this),this}toColor4(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new j(this.r,this.g,this.b,V)}Zi(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(V){return new l(this.r*V.r,this.g*V.g,this.b*V.b)}multiplyToRef(V,p){return p.r=this.r*V.r,p.g=this.g*V.g,p.b=this.b*V.b,p}multiplyInPlace(V){return this.r*=V.r,this.g*=V.g,this.b*=V.b,this}multiplyByFloats(V,p,W){return new l(this.r*V,this.g*p,this.b*W)}divide(V){throw new ReferenceError("Can not divide a color")}divideToRef(V,p){throw new ReferenceError("Can not divide a color")}divideInPlace(V){throw new ReferenceError("Can not divide a color")}minimizeInPlace(V){return this.minimizeInPlaceFromFloats(V.r,V.g,V.b)}maximizeInPlace(V){return this.maximizeInPlaceFromFloats(V.r,V.g,V.b)}minimizeInPlaceFromFloats(V,p,W){return this.r=Math.min(V,this.r),this.g=Math.min(p,this.g),this.b=Math.min(W,this.b),this}maximizeInPlaceFromFloats(V,p,W){return this.r=Math.max(V,this.r),this.g=Math.max(p,this.g),this.b=Math.max(W,this.b),this}floorToRef(V){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(V){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(V){return V&&this.r===V.r&&this.g===V.g&&this.b===V.b}equalsFloats(V,p,W){return this.equalsToFloats(V,p,W)}equalsToFloats(V,p,W){return this.r===V&&this.g===p&&this.b===W}equalsWithEpsilon(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E.c;return(0,z.y)(this.r,V.r,p)&&(0,z.y)(this.g,V.g,p)&&(0,z.y)(this.b,V.b,p)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(V){throw new ReferenceError("Can not negate a color")}scale(V){return new l(this.r*V,this.g*V,this.b*V)}scaleInPlace(V){return this.r*=V,this.g*=V,this.b*=V,this}scaleToRef(V,p){return p.r=this.r*V,p.g=this.g*V,p.b=this.b*V,p}scaleAndAddToRef(V,p){return p.r+=this.r*V,p.g+=this.g*V,p.b+=this.b*V,p}clampToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2?arguments[2]:void 0;return W.r=(0,z.d)(this.r,V,p),W.g=(0,z.d)(this.g,V,p),W.b=(0,z.d)(this.b,V,p),W}add(V){return new l(this.r+V.r,this.g+V.g,this.b+V.b)}addInPlace(V){return this.r+=V.r,this.g+=V.g,this.b+=V.b,this}addInPlaceFromFloats(V,p,W){return this.r+=V,this.g+=p,this.b+=W,this}addToRef(V,p){return p.r=this.r+V.r,p.g=this.g+V.g,p.b=this.b+V.b,p}ed(V){return new l(this.r-V.r,this.g-V.g,this.b-V.b)}subtractToRef(V,p){return p.r=this.r-V.r,p.g=this.g-V.g,p.b=this.b-V.b,p}ei(V){return this.r-=V.r,this.g-=V.g,this.b-=V.b,this}subtractFromFloats(V,p,W){return new l(this.r-V,this.g-p,this.b-W)}subtractFromFloatsToRef(V,p,W,N){return N.r=this.r-V,N.g=this.g-p,N.b=this.b-W,N}clone(){return new l(this.r,this.g,this.b)}p(V){return this.r=V.r,this.g=V.g,this.b=V.b,this}ge(V,p,W){return this.r=V,this.g=p,this.b=W,this}set(V,p,W){return this.ge(V,p,W)}ee(V){return this.r=this.g=this.b=V,this}toHexString(){const V=Math.round(255*this.r),p=Math.round(255*this.g),W=Math.round(255*this.b);return"#"+(0,z.x)(V)+(0,z.x)(p)+(0,z.x)(W)}fromHexString(V){return"#"!==V.substring(0,1)||7!==V.length||(this.r=parseInt(V.substring(1,3),16)/255,this.g=parseInt(V.substring(3,5),16)/255,this.b=parseInt(V.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new l)}toHSVToRef(V){const p=this.r,W=this.g,N=this.b,d=Math.max(p,W,N),E=Math.min(p,W,N);let z=0,S=0;const Q=d,J=d-E;return 0!==d&&(S=J/d),d!=E&&(d==p?(z=(W-N)/J,W<N&&(z+=6)):d==W?z=(N-p)/J+2:d==N&&(z=(p-W)/J+4),z*=60),V.r=z,V.g=S,V.b=Q,V}toLinearSpace(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=new l;return this.toLinearSpaceToRef(p,V),p}toLinearSpaceToRef(V){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(V.r=Q(this.r),V.g=Q(this.g),V.b=Q(this.b)):(V.r=S(this.r),V.g=S(this.g),V.b=S(this.b)),this}toGammaSpace(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=new l;return this.toGammaSpaceToRef(p,V),p}toGammaSpaceToRef(V){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(V.r=i(this.r),V.g=i(this.g),V.b=i(this.b)):(V.r=J(this.r),V.g=J(this.g),V.b=J(this.b)),this}static HSVtoRGBToRef(V,p,W,N){const d=W*p,E=V/60,z=d*(1-Math.abs(E%2-1));let S=0,Q=0,J=0;E>=0&&E<=1?(S=d,Q=z):E>=1&&E<=2?(S=z,Q=d):E>=2&&E<=3?(Q=d,J=z):E>=3&&E<=4?(Q=z,J=d):E>=4&&E<=5?(S=z,J=d):E>=5&&E<=6&&(S=d,J=z);const i=W-d;return N.r=S+i,N.g=Q+i,N.b=J+i,N}static FromHSV(V,p,W){const N=new l(0,0,0);return l.HSVtoRGBToRef(V,p,W,N),N}static FromHexString(V){return new l(0,0,0).fromHexString(V)}static Tg(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new l(V[p],V[p+1],V[p+2])}static FromArrayToRef(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;W.r=V[p],W.g=V[p+1],W.b=V[p+2]}static FromInts(V,p,W){return new l(V/255,p/255,W/255)}static Lerp(V,p,W){const N=new l(0,0,0);return l.LerpToRef(V,p,W,N),N}static LerpToRef(V,p,W,N){N.r=V.r+(p.r-V.r)*W,N.g=V.g+(p.g-V.g)*W,N.b=V.b+(p.b-V.b)*W}static Hermite(V,p,W,N,d){const E=d*d,z=d*E,S=2*z-3*E+1,Q=-2*z+3*E,J=z-2*E+d,i=z-E,j=V.r*S+W.r*Q+p.r*J+N.r*i,k=V.g*S+W.g*Q+p.g*J+N.g*i,u=V.b*S+W.b*Q+p.b*J+N.b*i;return new l(j,k,u)}static Hermite1stDerivative(V,p,W,N,d){const E=l.Black();return this.Hermite1stDerivativeToRef(V,p,W,N,d,E),E}static Hermite1stDerivativeToRef(V,p,W,N,d,E){const z=d*d;E.r=6*(z-d)*V.r+(3*z-4*d+1)*p.r+6*(-z+d)*W.r+(3*z-2*d)*N.r,E.g=6*(z-d)*V.g+(3*z-4*d+1)*p.g+6*(-z+d)*W.g+(3*z-2*d)*N.g,E.b=6*(z-d)*V.b+(3*z-4*d+1)*p.b+6*(-z+d)*W.b+(3*z-2*d)*N.b}static Red(){return new l(1,0,0)}static Green(){return new l(0,1,0)}static Blue(){return new l(0,0,1)}static Black(){return new l(0,0,0)}static get BlackReadOnly(){return l._BlackReadOnly}static White(){return new l(1,1,1)}static Purple(){return new l(.5,0,.5)}static Magenta(){return new l(1,0,1)}static Yellow(){return new l(1,1,0)}static Gray(){return new l(.5,.5,.5)}static Teal(){return new l(0,1,1)}static Random(){return new l(Math.random(),Math.random(),Math.random())}}l._BlackReadOnly=l.Black(),Object.defineProperties(l.prototype,{dimension:{value:[3]},rank:{value:1}});class j{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=V,this.g=p,this.b=W,this.a=N}Zi(){return[this.r,this.g,this.b,this.a]}toArray(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[p]=this.r,V[p+1]=this.g,V[p+2]=this.b,V[p+3]=this.a,this}fd(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=V[p],this.g=V[p+1],this.b=V[p+2],this.a=V[p+3],this}equals(V){return V&&this.r===V.r&&this.g===V.g&&this.b===V.b&&this.a===V.a}add(V){return new j(this.r+V.r,this.g+V.g,this.b+V.b,this.a+V.a)}addToRef(V,p){return p.r=this.r+V.r,p.g=this.g+V.g,p.b=this.b+V.b,p.a=this.a+V.a,p}addInPlace(V){return this.r+=V.r,this.g+=V.g,this.b+=V.b,this.a+=V.a,this}addInPlaceFromFloats(V,p,W,N){return this.r+=V,this.g+=p,this.b+=W,this.a+=N,this}ed(V){return new j(this.r-V.r,this.g-V.g,this.b-V.b,this.a-V.a)}subtractToRef(V,p){return p.r=this.r-V.r,p.g=this.g-V.g,p.b=this.b-V.b,p.a=this.a-V.a,p}ei(V){return this.r-=V.r,this.g-=V.g,this.b-=V.b,this.a-=V.a,this}subtractFromFloats(V,p,W,N){return new j(this.r-V,this.g-p,this.b-W,this.a-N)}subtractFromFloatsToRef(V,p,W,N,d){return d.r=this.r-V,d.g=this.g-p,d.b=this.b-W,d.a=this.a-N,d}scale(V){return new j(this.r*V,this.g*V,this.b*V,this.a*V)}scaleInPlace(V){return this.r*=V,this.g*=V,this.b*=V,this.a*=V,this}scaleToRef(V,p){return p.r=this.r*V,p.g=this.g*V,p.b=this.b*V,p.a=this.a*V,p}scaleAndAddToRef(V,p){return p.r+=this.r*V,p.g+=this.g*V,p.b+=this.b*V,p.a+=this.a*V,p}clampToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2?arguments[2]:void 0;return W.r=(0,z.d)(this.r,V,p),W.g=(0,z.d)(this.g,V,p),W.b=(0,z.d)(this.b,V,p),W.a=(0,z.d)(this.a,V,p),W}multiply(V){return new j(this.r*V.r,this.g*V.g,this.b*V.b,this.a*V.a)}multiplyToRef(V,p){return p.r=this.r*V.r,p.g=this.g*V.g,p.b=this.b*V.b,p.a=this.a*V.a,p}multiplyInPlace(V){return this.r*=V.r,this.g*=V.g,this.b*=V.b,this.a*=V.a,this}multiplyByFloats(V,p,W,N){return new j(this.r*V,this.g*p,this.b*W,this.a*N)}divide(V){throw new ReferenceError("Can not divide a color")}divideToRef(V,p){throw new ReferenceError("Can not divide a color")}divideInPlace(V){throw new ReferenceError("Can not divide a color")}minimizeInPlace(V){return this.r=Math.min(this.r,V.r),this.g=Math.min(this.g,V.g),this.b=Math.min(this.b,V.b),this.a=Math.min(this.a,V.a),this}maximizeInPlace(V){return this.r=Math.max(this.r,V.r),this.g=Math.max(this.g,V.g),this.b=Math.max(this.b,V.b),this.a=Math.max(this.a,V.a),this}minimizeInPlaceFromFloats(V,p,W,N){return this.r=Math.min(V,this.r),this.g=Math.min(p,this.g),this.b=Math.min(W,this.b),this.a=Math.min(N,this.a),this}maximizeInPlaceFromFloats(V,p,W,N){return this.r=Math.max(V,this.r),this.g=Math.max(p,this.g),this.b=Math.max(W,this.b),this.a=Math.max(N,this.a),this}floorToRef(V){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(V){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(V){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E.c;return(0,z.y)(this.r,V.r,p)&&(0,z.y)(this.g,V.g,p)&&(0,z.y)(this.b,V.b,p)&&(0,z.y)(this.a,V.a,p)}equalsToFloats(V,p,W,N){return this.r===V&&this.g===p&&this.b===W&&this.a===N}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"ob"}getHashCode(){let V=255*this.r|0;return V=397*V^255*this.g,V=397*V^255*this.b,V=397*V^255*this.a,V}clone(){return(new j).p(this)}p(V){return this.r=V.r,this.g=V.g,this.b=V.b,this.a=V.a,this}ge(V,p,W,N){return this.r=V,this.g=p,this.b=W,this.a=N,this}set(V,p,W,N){return this.ge(V,p,W,N)}ee(V){return this.r=this.g=this.b=this.a=V,this}toHexString(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=Math.round(255*this.r),W=Math.round(255*this.g),N=Math.round(255*this.b);if(V)return"#"+(0,z.x)(p)+(0,z.x)(W)+(0,z.x)(N);const d=Math.round(255*this.a);return"#"+(0,z.x)(p)+(0,z.x)(W)+(0,z.x)(N)+(0,z.x)(d)}fromHexString(V){return"#"!==V.substring(0,1)||9!==V.length&&7!==V.length||(this.r=parseInt(V.substring(1,3),16)/255,this.g=parseInt(V.substring(3,5),16)/255,this.b=parseInt(V.substring(5,7),16)/255,9===V.length&&(this.a=parseInt(V.substring(7,9),16)/255)),this}toLinearSpace(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=new j;return this.toLinearSpaceToRef(p,V),p}toLinearSpaceToRef(V){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(V.r=Q(this.r),V.g=Q(this.g),V.b=Q(this.b)):(V.r=S(this.r),V.g=S(this.g),V.b=S(this.b)),V.a=this.a,this}toGammaSpace(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=new j;return this.toGammaSpaceToRef(p,V),p}toGammaSpaceToRef(V){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(V.r=i(this.r),V.g=i(this.g),V.b=i(this.b)):(V.r=J(this.r),V.g=J(this.g),V.b=J(this.b)),V.a=this.a,this}static FromHexString(V){return"#"!==V.substring(0,1)||9!==V.length&&7!==V.length?new j(0,0,0,0):new j(0,0,0,1).fromHexString(V)}static Lerp(V,p,W){return j.LerpToRef(V,p,W,new j)}static LerpToRef(V,p,W,N){return N.r=V.r+(p.r-V.r)*W,N.g=V.g+(p.g-V.g)*W,N.b=V.b+(p.b-V.b)*W,N.a=V.a+(p.a-V.a)*W,N}static Hermite(V,p,W,N,d){const E=d*d,z=d*E,S=2*z-3*E+1,Q=-2*z+3*E,J=z-2*E+d,i=z-E,l=V.r*S+W.r*Q+p.r*J+N.r*i,k=V.g*S+W.g*Q+p.g*J+N.g*i,u=V.b*S+W.b*Q+p.b*J+N.b*i,f=V.a*S+W.a*Q+p.a*J+N.a*i;return new j(l,k,u,f)}static Hermite1stDerivative(V,p,W,N,d){const E=new j;return this.Hermite1stDerivativeToRef(V,p,W,N,d,E),E}static Hermite1stDerivativeToRef(V,p,W,N,d,E){const z=d*d;E.r=6*(z-d)*V.r+(3*z-4*d+1)*p.r+6*(-z+d)*W.r+(3*z-2*d)*N.r,E.g=6*(z-d)*V.g+(3*z-4*d+1)*p.g+6*(-z+d)*W.g+(3*z-2*d)*N.g,E.b=6*(z-d)*V.b+(3*z-4*d+1)*p.b+6*(-z+d)*W.b+(3*z-2*d)*N.b,E.a=6*(z-d)*V.a+(3*z-4*d+1)*p.a+6*(-z+d)*W.a+(3*z-2*d)*N.a}static FromColor3(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new j(V.r,V.g,V.b,p)}static Tg(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new j(V[p],V[p+1],V[p+2],V[p+3])}static FromArrayToRef(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;W.r=V[p],W.g=V[p+1],W.b=V[p+2],W.a=V[p+3]}static FromInts(V,p,W,N){return new j(V/255,p/255,W/255,N/255)}static CheckColors4(V,p){if(V.length===3*p){const p=[];for(let W=0;W<V.length;W+=3){const N=W/3*4;p[N]=V[W],p[N+1]=V[W+1],p[N+2]=V[W+2],p[N+3]=1}return p}return V}}Object.defineProperties(j.prototype,{dimension:{value:[4]},rank:{value:1}});class k{}k.gb=(0,N.e)(3,l.Black),k.ob=(0,N.e)(3,(()=>new j(0,0,0,0))),(0,d.d)("BABYLON.Color3",l),(0,d.d)("BABYLON.Color4",j)},11224:(V,p,W)=>{"use strict";W.d(p,{c:()=>z,g:()=>E,i:()=>N,j:()=>d});const N=1/2.2,d=2.2,E=(1+Math.sqrt(5))/2,z=.001},11352:(V,p,W)=>{"use strict";W.d(p,{b:()=>d});var N=W(11361);class d{static GetPlanes(V){const p=[];for(let W=0;W<6;W++)p.push(new N.b(0,0,0,0));return d.GetPlanesToRef(V,p),p}static GetNearPlaneToRef(V,p){const W=V.m;p.k.x=W[3]+W[2],p.k.y=W[7]+W[6],p.k.z=W[11]+W[10],p.d=W[15]+W[14],p.normalize()}static GetFarPlaneToRef(V,p){const W=V.m;p.k.x=W[3]-W[2],p.k.y=W[7]-W[6],p.k.z=W[11]-W[10],p.d=W[15]-W[14],p.normalize()}static GetLeftPlaneToRef(V,p){const W=V.m;p.k.x=W[3]+W[0],p.k.y=W[7]+W[4],p.k.z=W[11]+W[8],p.d=W[15]+W[12],p.normalize()}static GetRightPlaneToRef(V,p){const W=V.m;p.k.x=W[3]-W[0],p.k.y=W[7]-W[4],p.k.z=W[11]-W[8],p.d=W[15]-W[12],p.normalize()}static GetTopPlaneToRef(V,p){const W=V.m;p.k.x=W[3]-W[1],p.k.y=W[7]-W[5],p.k.z=W[11]-W[9],p.d=W[15]-W[13],p.normalize()}static GetBottomPlaneToRef(V,p){const W=V.m;p.k.x=W[3]+W[1],p.k.y=W[7]+W[5],p.k.z=W[11]+W[9],p.d=W[15]+W[13],p.normalize()}static GetPlanesToRef(V,p){d.GetNearPlaneToRef(V,p[0]),d.GetFarPlaneToRef(V,p[1]),d.GetLeftPlaneToRef(V,p[2]),d.GetRightPlaneToRef(V,p[3]),d.GetTopPlaneToRef(V,p[4]),d.GetBottomPlaneToRef(V,p[5])}static IsPointInFrustum(V,p){for(let W=0;W<6;W++)if(p[W].dotCoordinate(V)<0)return!1;return!0}}},11422:(V,p,W)=>{"use strict";W.d(p,{d:()=>S,h:()=>Q});var N=W(11167),d=W(11218),E=W(11175);class z{static extractMinAndMaxIndexed(V,p,W,N,d,E){for(let z=W;z<W+N;z++){const W=3*p[z],N=V[W],S=V[W+1],Q=V[W+2];d.minimizeInPlaceFromFloats(N,S,Q),E.maximizeInPlaceFromFloats(N,S,Q)}}static extractMinAndMax(V,p,W,N,d,E){for(let z=p,S=p*N;z<p+W;z++,S+=N){const p=V[S],W=V[S+1],N=V[S+2];d.minimizeInPlaceFromFloats(p,W,N),E.maximizeInPlaceFromFloats(p,W,N)}}}function S(V,p,W,N){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const S=new d.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Q=new d.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return z.extractMinAndMaxIndexed(V,p,W,N,S,Q),E&&(S.x-=S.x*E.x+E.y,S.y-=S.y*E.x+E.y,S.z-=S.z*E.x+E.y,Q.x+=Q.x*E.x+E.y,Q.y+=Q.y*E.x+E.y,Q.z+=Q.z*E.x+E.y),{minimum:S,maximum:Q}}function Q(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4?arguments[4]:void 0;const S=new d.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Q=new d.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return E||(E=3),z.extractMinAndMax(V,p,W,E,S,Q),N&&(S.x-=S.x*N.x+N.y,S.y-=S.y*N.x+N.y,S.z-=S.z*N.x+N.y,Q.x+=Q.x*N.x+N.y,Q.y+=Q.y*N.x+N.y,Q.z+=Q.z*N.x+N.y),{minimum:S,maximum:Q}}(0,N.c)([E.g.filter((function(){for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];let[N,d]=p;return!Array.isArray(N)&&!Array.isArray(d)}))],z,"extractMinAndMaxIndexed",null),(0,N.c)([E.g.filter((function(){for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];let[N]=p;return!Array.isArray(N)}))],z,"extractMinAndMax",null)},11762:(V,p,W)=>{"use strict";W.d(p,{b:()=>N.i});W(11579),W(11257),W(11224),W(11352),W(11764),W(11361),W(11462);var N=W(11218);W(11538)},11764:(V,p,W)=>{"use strict";W.d(p,{d:()=>S,g:()=>i,i:()=>l});var N,d=W(11242),E=W(11218),z=W(11224);!function(V){V[V.CW=0]="CW",V[V.CCW=1]="CCW"}(N||(N={}));class S{static Interpolate(V,p,W,N,d){const E=1-3*N+3*p,z=3*N-6*p,S=3*p;let Q=V;for(let J=0;J<5;J++){const p=Q*Q;Q-=(E*(p*Q)+z*p+S*Q-V)*(1/(3*E*p+2*z*Q+S)),Q=Math.min(1,Math.max(0,Q))}return 3*Math.pow(1-Q,2)*Q*W+3*(1-Q)*Math.pow(Q,2)*d+Math.pow(Q,3)}}class Q{constructor(V){this._radians=V,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(V,p){const W=p.ed(V),N=Math.atan2(W.y,W.x);return new Q(N)}static BetweenTwoVectors(V,p){let W=V.lengthSquared()*p.lengthSquared();if(0===W)return new Q(Math.PI/2);W=Math.sqrt(W);let N=V.dot(p)/W;N=(0,d.d)(N,-1,1);const E=Math.acos(N);return new Q(E)}static FromRadians(V){return new Q(V)}static FromDegrees(V){return new Q(V*Math.PI/180)}}class J{constructor(V,p,W){this.startPoint=V,this.midPoint=p,this.endPoint=W;const N=Math.pow(p.x,2)+Math.pow(p.y,2),d=(Math.pow(V.x,2)+Math.pow(V.y,2)-N)/2,z=(N-Math.pow(W.x,2)-Math.pow(W.y,2))/2,S=(V.x-p.x)*(p.y-W.y)-(p.x-W.x)*(V.y-p.y);this.centerPoint=new E.k((d*(p.y-W.y)-z*(V.y-p.y))/S,((V.x-p.x)*z-(p.x-W.x)*d)/S),this.radius=this.centerPoint.ed(this.startPoint).length(),this.startAngle=Q.BetweenTwoPoints(this.centerPoint,this.startPoint);const J=this.startAngle.degrees();let i=Q.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=Q.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();i-J>180&&(i-=360),i-J<-180&&(i+=360),l-i>180&&(l-=360),l-i<-180&&(l+=360),this.orientation=i-J<0?0:1,this.angle=Q.FromDegrees(0===this.orientation?J-l:l-J)}}class i{constructor(V,p){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new E.k(V,p))}addLineTo(V,p){if(this.closed)return this;const W=new E.k(V,p),N=this._points[this._points.length-1];return this._points.push(W),this._length+=W.ed(N).length(),this}addArcTo(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const z=this._points[this._points.length-1],S=new E.k(V,p),Q=new E.k(W,N),i=new J(z,S,Q);let l=i.angle.radians()/d;0===i.orientation&&(l*=-1);let j=i.startAngle.radians()+l;for(let E=0;E<d;E++){const V=Math.cos(j)*i.radius+i.centerPoint.x,p=Math.sin(j)*i.radius+i.centerPoint.y;this.addLineTo(V,p),j+=l}return this}addQuadraticCurveTo(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const E=(V,p,W,N)=>(1-V)*(1-V)*p+2*V*(1-V)*W+V*V*N,z=this._points[this._points.length-1];for(let S=0;S<=d;S++){const Q=S/d,J=E(Q,z.x,V,W),i=E(Q,z.y,p,N);this.addLineTo(J,i)}return this}addBezierCurveTo(V,p,W,N,d,E){let z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const S=(V,p,W,N,d)=>(1-V)*(1-V)*(1-V)*p+3*V*(1-V)*(1-V)*W+3*V*V*(1-V)*N+V*V*V*d,Q=this._points[this._points.length-1];for(let J=0;J<=z;J++){const i=J/z,l=S(i,Q.x,V,W,d),j=S(i,Q.y,p,N,E);this.addLineTo(l,j)}return this}isPointInside(V){let p=!1;const W=this._points.length;for(let N=W-1,d=0;d<W;N=d++){let W=this._points[N],E=this._points[d],z=E.x-W.x,S=E.y-W.y;if(Math.abs(S)>Number.EPSILON){if(S<0&&(W=this._points[d],z=-z,E=this._points[N],S=-S),V.y<W.y||V.y>E.y)continue;if(V.y===W.y&&V.x===W.x)return!0;{const N=S*(V.x-W.x)-z*(V.y-W.y);if(0===N)return!0;if(N<0)continue;p=!p}}else{if(V.y!==W.y)continue;if(E.x<=V.x&&V.x<=W.x||W.x<=V.x&&V.x<=E.x)return!0}}return p}close(){return this.closed=!0,this}length(){let V=this._length;if(this.closed){const p=this._points[this._points.length-1];V+=this._points[0].ed(p).length()}return V}area(){const V=this._points.length;let p=0;for(let W=V-1,N=0;N<V;W=N++)p+=this._points[W].x*this._points[N].y-this._points[N].x*this._points[W].y;return.5*p}getPoints(){return this._points}getPointAtLengthPosition(V){if(V<0||V>1)return E.k.Zero();const p=V*this.length();let W=0;for(let N=0;N<this._points.length;N++){const V=(N+1)%this._points.length,d=this._points[N],z=this._points[V].ed(d),S=z.length()+W;if(p>=W&&p<=S){const V=z.normalize(),N=p-W;return new E.k(d.x+V.x*N,d.y+V.y*N)}W=S}return E.k.Zero()}static StartingAt(V,p){return new i(V,p)}}class l{constructor(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=V,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:E.n.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:E.e.Identity()};for(let d=0;d<V.length;d++)this._curve[d]=V[d].clone();this._raw=W||!1,this._alignTangentsWithPath=N,this._compute(p,N)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(V){return this._updatePointAtData(V).point}getTangentAt(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(V,p),p?E.n.TransformCoordinates(E.n.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(V,p),p?E.n.TransformCoordinates(E.n.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(V,p),p?E.n.TransformCoordinates(E.n.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(V){return this.length()*V}getPreviousPointIndexAt(V){return this._updatePointAtData(V),this._pointAtData.previousPointArrayIndex}getSubPositionAt(V){return this._updatePointAtData(V),this._pointAtData.subPosition}getClosestPositionTo(V){let p=Number.MAX_VALUE,W=0;for(let N=0;N<this._curve.length-1;N++){const d=this._curve[N+0],z=this._curve[N+1].ed(d).normalize(),S=this._distances[N+1]-this._distances[N+0],Q=Math.min(Math.max(E.n.Dot(z,V.ed(d).normalize()),0)*E.n.Distance(d,V)/S,1),J=E.n.Distance(d.add(z.scale(Q*S)),V);J<p&&(p=J,W=(this._distances[N+0]+S*Q)/this.length())}return W}slice(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(V<0&&(V=1- -1*V%1),p<0&&(p=1- -1*p%1),V>p){const W=V;V=p,p=W}const W=this.getCurve(),N=this.getPointAt(V);let d=this.getPreviousPointIndexAt(V);const E=this.getPointAt(p),z=this.getPreviousPointIndexAt(p)+1,S=[];return 0!==V&&(d++,S.push(N)),S.push(...W.slice(d,z)),1===p&&1!==V||S.push(E),new l(S,this.getNormalAt(V),this._raw,this._alignTangentsWithPath)}update(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let N=0;N<V.length;N++)this._curve[N].x=V[N].x,this._curve[N].y=V[N].y,this._curve[N].z=V[N].z;return this._compute(p,W),this}_compute(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const W=this._curve.length;if(W<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[W-1]=this._curve[W-1].ed(this._curve[W-2]),this._raw||this._tangents[W-1].normalize();const N=this._tangents[0],d=this._normalVector(N,V);let z,S,Q,J,i;this._normals[0]=d,this._raw||this._normals[0].normalize(),this._binormals[0]=E.n.Cross(N,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let l=1;l<W;l++)z=this._getLastNonNullVector(l),l<W-1&&(S=this._getFirstNonNullVector(l),this._tangents[l]=p?S:z.add(S),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+this._curve[l].ed(this._curve[l-1]).length(),Q=this._tangents[l],i=this._binormals[l-1],this._normals[l]=E.n.Cross(i,Q),this._raw||(0===this._normals[l].length()?(J=this._normals[l-1],this._normals[l]=J.clone()):this._normals[l].normalize()),this._binormals[l]=E.n.Cross(Q,this._normals[l]),this._raw||this._binormals[l].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(V){let p=1,W=this._curve[V+p].ed(this._curve[V]);for(;0===W.length()&&V+p+1<this._curve.length;)p++,W=this._curve[V+p].ed(this._curve[V]);return W}_getLastNonNullVector(V){let p=1,W=this._curve[V].ed(this._curve[V-p]);for(;0===W.length()&&V>p+1;)p++,W=this._curve[V].ed(this._curve[V-p]);return W}_normalVector(V,p){let W,N=V.length();if(0===N&&(N=1),void 0===p||null===p){let p;p=(0,d.y)(Math.abs(V.y)/N,1,z.c)?(0,d.y)(Math.abs(V.x)/N,1,z.c)?(0,d.y)(Math.abs(V.z)/N,1,z.c)?E.n.Zero():new E.n(0,0,1):new E.n(1,0,0):new E.n(0,-1,0),W=E.n.Cross(V,p)}else W=E.n.Cross(V,p),E.n.CrossToRef(W,V,W);return W.normalize(),W}_updatePointAtData(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===V)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=V;const W=this.getPoints();if(V<=0)return this._setPointAtData(0,0,W[0],0,p);if(V>=1)return this._setPointAtData(1,1,W[W.length-1],W.length-1,p);let N,d=W[0],z=0;const S=V*this.length();for(let Q=1;Q<W.length;Q++){N=W[Q];const J=E.n.Distance(d,N);if(z+=J,z===S)return this._setPointAtData(V,1,N,Q,p);if(z>S){const W=(z-S)/J,E=d.ed(N),i=N.add(E.scaleInPlace(W));return this._setPointAtData(V,1-W,i,Q-1,p)}d=N}return this._pointAtData}_setPointAtData(V,p,W,N,d){return this._pointAtData.point=W,this._pointAtData.position=V,this._pointAtData.subPosition=p,this._pointAtData.previousPointArrayIndex=N,this._pointAtData.interpolateReady=d,d&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=E.e.Identity();const V=this._pointAtData.previousPointArrayIndex;if(V!==this._tangents.length-1){const p=V+1,W=this._tangents[V].clone(),N=this._normals[V].clone(),d=this._binormals[V].clone(),z=this._tangents[p].clone(),S=this._normals[p].clone(),Q=this._binormals[p].clone(),J=E.f.RotationQuaternionFromAxis(N,d,W),i=E.f.RotationQuaternionFromAxis(S,Q,z);E.f.Slerp(J,i,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},11361:(V,p,W)=>{"use strict";W.d(p,{b:()=>d});var N=W(11218);class d{constructor(V,p,W,d){this.k=new N.n(V,p,W),this.d=d}Zi(){return[this.k.x,this.k.y,this.k.z,this.d]}clone(){return new d(this.k.x,this.k.y,this.k.z,this.d)}getClassName(){return"Plane"}getHashCode(){let V=this.k.getHashCode();return V=397*V^this.d,V}normalize(){const V=Math.sqrt(this.k.x*this.k.x+this.k.y*this.k.y+this.k.z*this.k.z);let p=0;return 0!==V&&(p=1/V),this.k.x*=p,this.k.y*=p,this.k.z*=p,this.d*=p,this}transform(V){const p=d._TmpMatrix;V.invertToRef(p);const W=p.m,N=this.k.x,E=this.k.y,z=this.k.z,S=this.d,Q=N*W[0]+E*W[1]+z*W[2]+S*W[3],J=N*W[4]+E*W[5]+z*W[6]+S*W[7],i=N*W[8]+E*W[9]+z*W[10]+S*W[11],l=N*W[12]+E*W[13]+z*W[14]+S*W[15];return new d(Q,J,i,l)}dotCoordinate(V){return this.k.x*V.x+this.k.y*V.y+this.k.z*V.z+this.d}copyFromPoints(V,p,W){const N=p.x-V.x,d=p.y-V.y,E=p.z-V.z,z=W.x-V.x,S=W.y-V.y,Q=W.z-V.z,J=d*Q-E*S,i=E*z-N*Q,l=N*S-d*z,j=Math.sqrt(J*J+i*i+l*l);let k;return k=0!==j?1/j:0,this.k.x=J*k,this.k.y=i*k,this.k.z=l*k,this.d=-(this.k.x*V.x+this.k.y*V.y+this.k.z*V.z),this}isFrontFacingTo(V,p){return N.n.Dot(this.k,V)<=p}signedDistanceTo(V){return N.n.Dot(V,this.k)+this.d}static Tg(V){return new d(V[0],V[1],V[2],V[3])}static FromPoints(V,p,W){const N=new d(0,0,0,0);return N.copyFromPoints(V,p,W),N}static FromPositionAndNormal(V,p){const W=new d(0,0,0,0);return this.FromPositionAndNormalToRef(V,p,W)}static FromPositionAndNormalToRef(V,p,W){return W.k.p(p),W.k.normalize(),W.d=-V.dot(W.k),W}static SignedDistanceToPlaneFromPositionAndNormal(V,p,W){const d=-(p.x*V.x+p.y*V.y+p.z*V.z);return N.n.Dot(W,p)+d}}d._TmpMatrix=N.e.Identity()},11242:(V,p,W)=>{"use strict";function N(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(V-p)<=W}function d(V,p){return V===p?V:Math.random()*(p-V)+V}function E(V,p,W){return V+(p-V)*W}function z(V,p,W,N,d){const E=d*d,z=d*E;return V*(2*z-3*E+1)+W*(-2*z+3*E)+p*(z-2*E+d)+N*(z-E)}function S(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(W,Math.max(p,V))}function Q(V){return V-=2*Math.PI*Math.floor((V+Math.PI)/(2*Math.PI))}function J(V){const p=V.toString(16);return V<=15?("0"+p).toUpperCase():p.toUpperCase()}function i(V){if(Math.log2)return Math.floor(Math.log2(V));if(V<0)return NaN;if(0===V)return-1/0;let p=0;if(V<1){for(;V<1;)p++,V*=2;p=-p}else if(V>1)for(;V>1;)p++,V=Math.floor(V/2);return p}function l(V,p){const W=V%p;return 0===W?p:l(p,W)}W.d(p,{d:()=>S,e:()=>z,i:()=>l,j:()=>i,l:()=>E,p:()=>Q,t:()=>d,x:()=>J,y:()=>N})},11462:(V,p,W)=>{"use strict";W.d(p,{c:()=>N});class N{constructor(V,p){this.width=V,this.height=p}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let V=0|this.width;return V=397*V^this.height,V}p(V){this.width=V.width,this.height=V.height}ge(V,p){return this.width=V,this.height=p,this}set(V,p){return this.ge(V,p)}multiplyByFloats(V,p){return new N(this.width*V,this.height*p)}clone(){return new N(this.width,this.height)}equals(V){return!!V&&(this.width===V.width&&this.height===V.height)}get surface(){return this.width*this.height}static Zero(){return new N(0,0)}add(V){return new N(this.width+V.width,this.height+V.height)}ed(V){return new N(this.width-V.width,this.height-V.height)}scale(V){return new N(this.width*V,this.height*V)}static Lerp(V,p,W){const d=V.width+(p.width-V.width)*W,E=V.height+(p.height-V.height)*W;return new N(d,E)}}},11218:(V,p,W)=>{"use strict";W.d(p,{e:()=>u,f:()=>k,i:()=>O,k:()=>i,n:()=>l,q:()=>j});var N=W(11224),d=W(11233),E=W(11004),z=W(10975),S=W(10900),Q=W(11242);const J=V=>parseInt(V.toString().replace(/\W/g,""));class i{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=V,this.y=p}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let V=J(this.x);return V=397*V^J(this.y),V}toArray(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[p]=this.x,V[p+1]=this.y,this}fd(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i.FromArrayToRef(V,p,this),this}Zi(){return[this.x,this.y]}p(V){return this.x=V.x,this.y=V.y,this}ge(V,p){return this.x=V,this.y=p,this}set(V,p){return this.ge(V,p)}ee(V){return this.ge(V,V)}add(V){return new i(this.x+V.x,this.y+V.y)}addToRef(V,p){return p.x=this.x+V.x,p.y=this.y+V.y,p}addInPlace(V){return this.x+=V.x,this.y+=V.y,this}addInPlaceFromFloats(V,p){return this.x+=V,this.y+=p,this}addVector3(V){return new i(this.x+V.x,this.y+V.y)}ed(V){return new i(this.x-V.x,this.y-V.y)}subtractToRef(V,p){return p.x=this.x-V.x,p.y=this.y-V.y,p}ei(V){return this.x-=V.x,this.y-=V.y,this}multiplyInPlace(V){return this.x*=V.x,this.y*=V.y,this}multiply(V){return new i(this.x*V.x,this.y*V.y)}multiplyToRef(V,p){return p.x=this.x*V.x,p.y=this.y*V.y,p}multiplyByFloats(V,p){return new i(this.x*V,this.y*p)}divide(V){return new i(this.x/V.x,this.y/V.y)}divideToRef(V,p){return p.x=this.x/V.x,p.y=this.y/V.y,p}divideInPlace(V){return this.x=this.x/V.x,this.y=this.y/V.y,this}minimizeInPlace(V){return this.minimizeInPlaceFromFloats(V.x,V.y)}maximizeInPlace(V){return this.maximizeInPlaceFromFloats(V.x,V.y)}minimizeInPlaceFromFloats(V,p){return this.x=Math.min(V,this.x),this.y=Math.min(p,this.y),this}maximizeInPlaceFromFloats(V,p){return this.x=Math.max(V,this.x),this.y=Math.max(p,this.y),this}subtractFromFloats(V,p){return new i(this.x-V,this.y-p)}subtractFromFloatsToRef(V,p,W){return W.x=this.x-V,W.y=this.y-p,W}negate(){return new i(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(V){return V.x=-this.x,V.y=-this.y,V}scaleInPlace(V){return this.x*=V,this.y*=V,this}scale(V){return new i(this.x*V,this.y*V)}scaleToRef(V,p){return p.x=this.x*V,p.y=this.y*V,p}scaleAndAddToRef(V,p){return p.x+=this.x*V,p.y+=this.y*V,p}equals(V){return V&&this.x===V.x&&this.y===V.y}equalsWithEpsilon(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.c;return V&&(0,Q.y)(this.x,V.x,p)&&(0,Q.y)(this.y,V.y,p)}equalsToFloats(V,p){return this.x===V&&this.y===p}floor(){return new i(Math.floor(this.x),Math.floor(this.y))}floorToRef(V){return V.x=Math.floor(this.x),V.y=Math.floor(this.y),V}fract(){return new i(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(V){return V.x=this.x-Math.floor(this.x),V.y=this.y-Math.floor(this.y),V}rotateToRef(V,p){const W=Math.cos(V),N=Math.sin(V),d=W*this.x-N*this.y,E=N*this.x+W*this.y;return p.x=d,p.y=E,p}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(V){return 0===V||1===V?this:this.scaleInPlace(1/V)}normalizeToNew(){const V=new i;return this.normalizeToRef(V),V}normalizeToRef(V){const p=this.length();return 0===p&&(V.x=this.x,V.y=this.y),this.scaleToRef(1/p,V)}clone(){return new i(this.x,this.y)}dot(V){return this.x*V.x+this.y*V.y}static Zero(){return new i(0,0)}static One(){return new i(1,1)}static Random(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new i((0,Q.t)(V,p),(0,Q.t)(V,p))}static RandomToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).ge((0,Q.t)(V,p),(0,Q.t)(V,p))}static get ZeroReadOnly(){return i._ZeroReadOnly}static Tg(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new i(V[p],V[p+1])}static FromArrayToRef(V,p,W){return W.x=V[p],W.y=V[p+1],W}static FromFloatsToRef(V,p,W){return W.ge(V,p),W}static CatmullRom(V,p,W,N,d){const E=d*d,z=d*E,S=.5*(2*p.x+(-V.x+W.x)*d+(2*V.x-5*p.x+4*W.x-N.x)*E+(-V.x+3*p.x-3*W.x+N.x)*z),Q=.5*(2*p.y+(-V.y+W.y)*d+(2*V.y-5*p.y+4*W.y-N.y)*E+(-V.y+3*p.y-3*W.y+N.y)*z);return new i(S,Q)}static ClampToRef(V,p,W,N){return N.x=(0,Q.d)(V.x,p.x,W.x),N.y=(0,Q.d)(V.y,p.y,W.y),N}static Clamp(V,p,W){const N=(0,Q.d)(V.x,p.x,W.x),d=(0,Q.d)(V.y,p.y,W.y);return new i(N,d)}static Hermite(V,p,W,N,d){const E=d*d,z=d*E,S=2*z-3*E+1,Q=-2*z+3*E,J=z-2*E+d,l=z-E,j=V.x*S+W.x*Q+p.x*J+N.x*l,k=V.y*S+W.y*Q+p.y*J+N.y*l;return new i(j,k)}static Hermite1stDerivative(V,p,W,N,d){return this.Hermite1stDerivativeToRef(V,p,W,N,d,new i)}static Hermite1stDerivativeToRef(V,p,W,N,d,E){const z=d*d;return E.x=6*(z-d)*V.x+(3*z-4*d+1)*p.x+6*(-z+d)*W.x+(3*z-2*d)*N.x,E.y=6*(z-d)*V.y+(3*z-4*d+1)*p.y+6*(-z+d)*W.y+(3*z-2*d)*N.y,E}static Lerp(V,p,W){return i.LerpToRef(V,p,W,new i)}static LerpToRef(V,p,W,N){return N.x=V.x+(p.x-V.x)*W,N.y=V.y+(p.y-V.y)*W,N}static Dot(V,p){return V.x*p.x+V.y*p.y}static Normalize(V){return i.NormalizeToRef(V,new i)}static NormalizeToRef(V,p){return V.normalizeToRef(p),p}static Minimize(V,p){const W=V.x<p.x?V.x:p.x,N=V.y<p.y?V.y:p.y;return new i(W,N)}static Maximize(V,p){const W=V.x>p.x?V.x:p.x,N=V.y>p.y?V.y:p.y;return new i(W,N)}static Transform(V,p){return i.TransformToRef(V,p,new i)}static TransformToRef(V,p,W){const N=p.m,d=V.x*N[0]+V.y*N[4]+N[12],E=V.x*N[1]+V.y*N[5]+N[13];return W.x=d,W.y=E,W}static PointInTriangle(V,p,W,N){const d=.5*(-W.y*N.x+p.y*(-W.x+N.x)+p.x*(W.y-N.y)+W.x*N.y),E=d<0?-1:1,z=(p.y*N.x-p.x*N.y+(N.y-p.y)*V.x+(p.x-N.x)*V.y)*E,S=(p.x*W.y-p.y*W.x+(p.y-W.y)*V.x+(W.x-p.x)*V.y)*E;return z>0&&S>0&&z+S<2*d*E}static Distance(V,p){return Math.sqrt(i.DistanceSquared(V,p))}static DistanceSquared(V,p){const W=V.x-p.x,N=V.y-p.y;return W*W+N*N}static Center(V,p){return i.CenterToRef(V,p,new i)}static CenterToRef(V,p,W){return W.ge((V.x+p.x)/2,(V.y+p.y)/2)}static DistanceOfPointFromSegment(V,p,W){const N=i.DistanceSquared(p,W);if(0===N)return i.Distance(V,p);const d=W.ed(p),E=Math.max(0,Math.min(1,i.Dot(V.ed(p),d)/N)),z=p.add(d.multiplyByFloats(E,E));return i.Distance(V,z)}}i._ZeroReadOnly=i.Zero(),Object.defineProperties(i.prototype,{dimension:{value:[2]},rank:{value:1}});class l{get x(){return this._x}set x(V){this._x=V,this._isDirty=!0}get y(){return this._y}set y(V){this._y=V,this._isDirty=!0}get z(){return this._z}set z(V){this._z=V,this._isDirty=!0}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=V,this._y=p,this._z=W}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"fb"}getHashCode(){let V=J(this._x);return V=397*V^J(this._y),V=397*V^J(this._z),V}Zi(){return[this._x,this._y,this._z]}toArray(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[p]=this._x,V[p+1]=this._y,V[p+2]=this._z,this}fd(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return l.FromArrayToRef(V,p,this),this}toQuaternion(){return k.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(V){return this._x+=V._x,this._y+=V._y,this._z+=V._z,this._isDirty=!0,this}addInPlaceFromFloats(V,p,W){return this._x+=V,this._y+=p,this._z+=W,this._isDirty=!0,this}add(V){return new l(this._x+V._x,this._y+V._y,this._z+V._z)}addToRef(V,p){return p._x=this._x+V._x,p._y=this._y+V._y,p._z=this._z+V._z,p._isDirty=!0,p}ei(V){return this._x-=V._x,this._y-=V._y,this._z-=V._z,this._isDirty=!0,this}ed(V){return new l(this._x-V._x,this._y-V._y,this._z-V._z)}subtractToRef(V,p){return this.subtractFromFloatsToRef(V._x,V._y,V._z,p)}subtractFromFloats(V,p,W){return new l(this._x-V,this._y-p,this._z-W)}subtractFromFloatsToRef(V,p,W,N){return N._x=this._x-V,N._y=this._y-p,N._z=this._z-W,N._isDirty=!0,N}negate(){return new l(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(V){return V._x=-1*this._x,V._y=-1*this._y,V._z=-1*this._z,V._isDirty=!0,V}scaleInPlace(V){return this._x*=V,this._y*=V,this._z*=V,this._isDirty=!0,this}scale(V){return new l(this._x*V,this._y*V,this._z*V)}scaleToRef(V,p){return p._x=this._x*V,p._y=this._y*V,p._z=this._z*V,p._isDirty=!0,p}getNormalToRef(V){const p=this.length();let W=Math.acos(this.y/p);const N=Math.atan2(this.z,this.x);W>Math.PI/2?W-=Math.PI/2:W+=Math.PI/2;const d=p*Math.sin(W)*Math.cos(N),E=p*Math.cos(W),z=p*Math.sin(W)*Math.sin(N);return V.set(d,E,z),V}applyRotationQuaternionToRef(V,p){const W=this._x,N=this._y,d=this._z,E=V._x,z=V._y,S=V._z,Q=V._w,J=2*(z*d-S*N),i=2*(S*W-E*d),l=2*(E*N-z*W);return p._x=W+Q*J+z*l-S*i,p._y=N+Q*i+S*J-E*l,p._z=d+Q*l+E*i-z*J,p._isDirty=!0,p}applyRotationQuaternionInPlace(V){return this.applyRotationQuaternionToRef(V,this)}applyRotationQuaternion(V){return this.applyRotationQuaternionToRef(V,new l)}scaleAndAddToRef(V,p){return p._x+=this._x*V,p._y+=this._y*V,p._z+=this._z*V,p._isDirty=!0,p}projectOnPlane(V,p){return this.projectOnPlaneToRef(V,p,new l)}projectOnPlaneToRef(V,p,W){const N=V.k,d=V.d,E=f.fb[0];this.subtractToRef(p,E),E.normalize();const z=l.Dot(E,N);if(Math.abs(z)<1e-10)W.ee(1/0);else{const V=-(l.Dot(p,N)+d)/z,S=E.scaleInPlace(V);p.addToRef(S,W)}return W}equals(V){return V&&this._x===V._x&&this._y===V._y&&this._z===V._z}equalsWithEpsilon(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.c;return V&&(0,Q.y)(this._x,V._x,p)&&(0,Q.y)(this._y,V._y,p)&&(0,Q.y)(this._z,V._z,p)}equalsToFloats(V,p,W){return this._x===V&&this._y===p&&this._z===W}multiplyInPlace(V){return this._x*=V._x,this._y*=V._y,this._z*=V._z,this._isDirty=!0,this}multiply(V){return this.multiplyByFloats(V._x,V._y,V._z)}multiplyToRef(V,p){return p._x=this._x*V._x,p._y=this._y*V._y,p._z=this._z*V._z,p._isDirty=!0,p}multiplyByFloats(V,p,W){return new l(this._x*V,this._y*p,this._z*W)}divide(V){return new l(this._x/V._x,this._y/V._y,this._z/V._z)}divideToRef(V,p){return p._x=this._x/V._x,p._y=this._y/V._y,p._z=this._z/V._z,p._isDirty=!0,p}divideInPlace(V){return this._x=this._x/V._x,this._y=this._y/V._y,this._z=this._z/V._z,this._isDirty=!0,this}minimizeInPlace(V){return this.minimizeInPlaceFromFloats(V._x,V._y,V._z)}maximizeInPlace(V){return this.maximizeInPlaceFromFloats(V._x,V._y,V._z)}minimizeInPlaceFromFloats(V,p,W){return V<this._x&&(this.x=V),p<this._y&&(this.y=p),W<this._z&&(this.z=W),this}maximizeInPlaceFromFloats(V,p,W){return V>this._x&&(this.x=V),p>this._y&&(this.y=p),W>this._z&&(this.z=W),this}isNonUniformWithinEpsilon(V){const p=Math.abs(this._x),W=Math.abs(this._y);if(!(0,Q.y)(p,W,V))return!0;const N=Math.abs(this._z);return!(0,Q.y)(p,N,V)||!(0,Q.y)(W,N,V)}get isNonUniform(){const V=Math.abs(this._x);if(V!==Math.abs(this._y))return!0;return V!==Math.abs(this._z)}floorToRef(V){return V._x=Math.floor(this._x),V._y=Math.floor(this._y),V._z=Math.floor(this._z),V._isDirty=!0,V}floor(){return new l(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(V){return V._x=this.x-Math.floor(this._x),V._y=this.y-Math.floor(this._y),V._z=this.z-Math.floor(this._z),V._isDirty=!0,V}fract(){return new l(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(V){if("xyz"===(V=V.toLowerCase()))return this;const p=f.fb[0].p(this);return this.x=p[V[0]],this.y=p[V[1]],this.z=p[V[2]],this}rotateByQuaternionToRef(V,p){return V.toRotationMatrix(f.Matrix[0]),l.TransformCoordinatesToRef(this,f.Matrix[0],p),p}rotateByQuaternionAroundPointToRef(V,p,W){return this.subtractToRef(p,f.fb[0]),f.fb[0].rotateByQuaternionToRef(V,f.fb[0]),p.addToRef(f.fb[0],W),W}cross(V){return l.CrossToRef(this,V,new l)}normalizeFromLength(V){return 0===V||1===V?this:this.scaleInPlace(1/V)}normalizeToNew(){return this.normalizeToRef(new l)}normalizeToRef(V){const p=this.length();return 0===p||1===p?(V._x=this._x,V._y=this._y,V._z=this._z,V._isDirty=!0,V):this.scaleToRef(1/p,V)}clone(){return new l(this._x,this._y,this._z)}p(V){return this.ge(V._x,V._y,V._z)}ge(V,p,W){return this._x=V,this._y=p,this._z=W,this._isDirty=!0,this}set(V,p,W){return this.ge(V,p,W)}ee(V){return this._x=this._y=this._z=V,this._isDirty=!0,this}static GetClipFactor(V,p,W,N){const d=l.Dot(V,W);return(d-N)/(d-l.Dot(p,W))}static GetAngleBetweenVectors(V,p,W){const N=V.normalizeToRef(f.fb[1]),d=p.normalizeToRef(f.fb[2]);let E=l.Dot(N,d);E=(0,Q.d)(E,-1,1);const z=Math.acos(E),S=f.fb[3];return l.CrossToRef(N,d,S),l.Dot(S,W)>0?isNaN(z)?0:z:isNaN(z)?-Math.PI:-Math.acos(E)}static GetAngleBetweenVectorsOnPlane(V,p,W){f.fb[0].p(V);const N=f.fb[0];f.fb[1].p(p);const d=f.fb[1];f.fb[2].p(W);const E=f.fb[2],z=f.fb[3],S=f.fb[4];N.normalize(),d.normalize(),E.normalize(),l.CrossToRef(E,N,z),l.CrossToRef(z,E,S);const J=Math.atan2(l.Dot(d,z),l.Dot(d,S));return(0,Q.p)(J)}static PitchYawRollToMoveBetweenPointsToRef(V,p,W){const N=O.fb[0];return p.subtractToRef(V,N),W._y=Math.atan2(N.x,N.z)||0,W._x=Math.atan2(Math.sqrt(N.x**2+N.z**2),N.y)||0,W._z=0,W._isDirty=!0,W}static PitchYawRollToMoveBetweenPoints(V,p){const W=l.Zero();return l.PitchYawRollToMoveBetweenPointsToRef(V,p,W)}static SlerpToRef(V,p,W,d){W=(0,Q.d)(W,0,1);const E=f.fb[0],z=f.fb[1];E.p(V);const S=E.length();E.normalizeFromLength(S),z.p(p);const J=z.length();z.normalizeFromLength(J);const i=l.Dot(E,z);let j,k;if(i<1-N.c){const V=Math.acos(i),p=1/Math.sin(V);j=Math.sin((1-W)*V)*p,k=Math.sin(W*V)*p}else j=1-W,k=W;return E.scaleInPlace(j),z.scaleInPlace(k),d.p(E).addInPlace(z),d.scaleInPlace((0,Q.l)(S,J,W)),d}static SmoothToRef(V,p,W,N,d){return l.SlerpToRef(V,p,0===N?1:W/N,d),d}static Tg(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new l(V[p],V[p+1],V[p+2])}static FromFloatArray(V,p){return l.Tg(V,p)}static FromArrayToRef(V,p,W){return W._x=V[p],W._y=V[p+1],W._z=V[p+2],W._isDirty=!0,W}static FromFloatArrayToRef(V,p,W){return l.FromArrayToRef(V,p,W)}static FromFloatsToRef(V,p,W,N){return N.ge(V,p,W),N}static Zero(){return new l(0,0,0)}static One(){return new l(1,1,1)}static Up(){return new l(0,1,0)}static get UpReadOnly(){return l._UpReadOnly}static get DownReadOnly(){return l._DownReadOnly}static get RightReadOnly(){return l._RightReadOnly}static get LeftReadOnly(){return l._LeftReadOnly}static get LeftHandedForwardReadOnly(){return l._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return l._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return l._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return l._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return l._ZeroReadOnly}static get OneReadOnly(){return l._OneReadOnly}static Down(){return new l(0,-1,0)}static Forward(){return new l(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new l(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new l(1,0,0)}static Left(){return new l(-1,0,0)}static Random(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new l((0,Q.t)(V,p),(0,Q.t)(V,p),(0,Q.t)(V,p))}static RandomToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).ge((0,Q.t)(V,p),(0,Q.t)(V,p),(0,Q.t)(V,p))}static TransformCoordinates(V,p){const W=l.Zero();return l.TransformCoordinatesToRef(V,p,W),W}static TransformCoordinatesToRef(V,p,W){return l.TransformCoordinatesFromFloatsToRef(V._x,V._y,V._z,p,W),W}static TransformCoordinatesFromFloatsToRef(V,p,W,N,d){const E=N.m,z=V*E[0]+p*E[4]+W*E[8]+E[12],S=V*E[1]+p*E[5]+W*E[9]+E[13],Q=V*E[2]+p*E[6]+W*E[10]+E[14],J=1/(V*E[3]+p*E[7]+W*E[11]+E[15]);return d._x=z*J,d._y=S*J,d._z=Q*J,d._isDirty=!0,d}static TransformNormal(V,p){const W=l.Zero();return l.TransformNormalToRef(V,p,W),W}static TransformNormalToRef(V,p,W){return this.TransformNormalFromFloatsToRef(V._x,V._y,V._z,p,W),W}static TransformNormalFromFloatsToRef(V,p,W,N,d){const E=N.m;return d._x=V*E[0]+p*E[4]+W*E[8],d._y=V*E[1]+p*E[5]+W*E[9],d._z=V*E[2]+p*E[6]+W*E[10],d._isDirty=!0,d}static CatmullRom(V,p,W,N,d){const E=d*d,z=d*E,S=.5*(2*p._x+(-V._x+W._x)*d+(2*V._x-5*p._x+4*W._x-N._x)*E+(-V._x+3*p._x-3*W._x+N._x)*z),Q=.5*(2*p._y+(-V._y+W._y)*d+(2*V._y-5*p._y+4*W._y-N._y)*E+(-V._y+3*p._y-3*W._y+N._y)*z),J=.5*(2*p._z+(-V._z+W._z)*d+(2*V._z-5*p._z+4*W._z-N._z)*E+(-V._z+3*p._z-3*W._z+N._z)*z);return new l(S,Q,J)}static Clamp(V,p,W){const N=new l;return l.ClampToRef(V,p,W,N),N}static ClampToRef(V,p,W,N){let d=V._x;d=d>W._x?W._x:d,d=d<p._x?p._x:d;let E=V._y;E=E>W._y?W._y:E,E=E<p._y?p._y:E;let z=V._z;return z=z>W._z?W._z:z,z=z<p._z?p._z:z,N.ge(d,E,z),N}static CheckExtends(V,p,W){p.minimizeInPlace(V),W.maximizeInPlace(V)}static Hermite(V,p,W,N,d){const E=d*d,z=d*E,S=2*z-3*E+1,Q=-2*z+3*E,J=z-2*E+d,i=z-E,j=V._x*S+W._x*Q+p._x*J+N._x*i,k=V._y*S+W._y*Q+p._y*J+N._y*i,u=V._z*S+W._z*Q+p._z*J+N._z*i;return new l(j,k,u)}static Hermite1stDerivative(V,p,W,N,d){const E=new l;return this.Hermite1stDerivativeToRef(V,p,W,N,d,E),E}static Hermite1stDerivativeToRef(V,p,W,N,d,E){const z=d*d;return E._x=6*(z-d)*V._x+(3*z-4*d+1)*p._x+6*(-z+d)*W._x+(3*z-2*d)*N._x,E._y=6*(z-d)*V._y+(3*z-4*d+1)*p._y+6*(-z+d)*W._y+(3*z-2*d)*N._y,E._z=6*(z-d)*V._z+(3*z-4*d+1)*p._z+6*(-z+d)*W._z+(3*z-2*d)*N._z,E._isDirty=!0,E}static Lerp(V,p,W){const N=new l(0,0,0);return l.LerpToRef(V,p,W,N),N}static LerpToRef(V,p,W,N){return N._x=V._x+(p._x-V._x)*W,N._y=V._y+(p._y-V._y)*W,N._z=V._z+(p._z-V._z)*W,N._isDirty=!0,N}static Dot(V,p){return V._x*p._x+V._y*p._y+V._z*p._z}dot(V){return this._x*V._x+this._y*V._y+this._z*V._z}static Cross(V,p){const W=new l;return l.CrossToRef(V,p,W),W}static CrossToRef(V,p,W){const N=V._y*p._z-V._z*p._y,d=V._z*p._x-V._x*p._z,E=V._x*p._y-V._y*p._x;return W.ge(N,d,E),W}static Normalize(V){const p=l.Zero();return l.NormalizeToRef(V,p),p}static NormalizeToRef(V,p){return V.normalizeToRef(p),p}static Project(V,p,W,N){const d=new l;return l.ProjectToRef(V,p,W,N,d),d}static ProjectToRef(V,p,W,N,d){var E;const z=N.width,Q=N.height,J=N.x,i=N.y,j=f.Matrix[1],k=null===(E=S.d.LastCreatedEngine)||void 0===E?void 0:E.isNDCHalfZRange,O=k?1:.5,U=k?0:.5;u.FromValuesToRef(z/2,0,0,0,0,-Q/2,0,0,0,0,O,0,J+z/2,Q/2+i,U,1,j);const F=f.Matrix[0];return p.multiplyToRef(W,F),F.multiplyToRef(j,F),l.TransformCoordinatesToRef(V,F,d),d}static Reflect(V,p){return this.ReflectToRef(V,p,new l)}static ReflectToRef(V,p,W){const N=O.fb[0];return N.p(p).scaleInPlace(2*l.Dot(V,p)),W.p(V).ei(N)}static _UnprojectFromInvertedMatrixToRef(V,p,W){l.TransformCoordinatesToRef(V,p,W);const N=p.m,d=V._x*N[3]+V._y*N[7]+V._z*N[11]+N[15];return(0,Q.y)(d,1)&&W.scaleInPlace(1/d),W}static UnprojectFromTransform(V,p,W,N,d){return this.Unproject(V,p,W,N,d,u.IdentityReadOnly)}static Unproject(V,p,W,N,d,E){const z=new l;return l.UnprojectToRef(V,p,W,N,d,E,z),z}static UnprojectToRef(V,p,W,N,d,E,z){return l.UnprojectFloatsToRef(V._x,V._y,V._z,p,W,N,d,E,z),z}static UnprojectFloatsToRef(V,p,W,N,d,E,z,Q,J){var i;const j=f.Matrix[0];E.multiplyToRef(z,j),j.multiplyToRef(Q,j),j.invert();const k=f.fb[0];return k.x=V/N*2-1,k.y=-(p/d*2-1),null!==(i=S.d.LastCreatedEngine)&&void 0!==i&&i.isNDCHalfZRange?k.z=W:k.z=2*W-1,l._UnprojectFromInvertedMatrixToRef(k,j,J),J}static Minimize(V,p){const W=new l;return W.p(V),W.minimizeInPlace(p),W}static Maximize(V,p){const W=new l;return W.p(V),W.maximizeInPlace(p),W}static Distance(V,p){return Math.sqrt(l.DistanceSquared(V,p))}static DistanceSquared(V,p){const W=V._x-p._x,N=V._y-p._y,d=V._z-p._z;return W*W+N*N+d*d}static ProjectOnTriangleToRef(V,p,W,d,E){const z=f.fb[0],S=f.fb[1],J=f.fb[2],i=f.fb[3],j=f.fb[4];W.subtractToRef(p,z),d.subtractToRef(p,S),d.subtractToRef(W,J);const k=z.length(),u=S.length(),O=J.length();if(k<N.c||u<N.c||O<N.c)return E.p(p),l.Distance(V,p);V.subtractToRef(p,j),l.CrossToRef(z,S,i);const U=i.length();if(U<N.c)return E.p(p),l.Distance(V,p);i.normalizeFromLength(U);let F=j.length();if(F<N.c)return E.p(p),0;j.normalizeFromLength(F);const C=l.Dot(i,j),A=f.fb[5],v=f.fb[6];A.p(i).scaleInPlace(-F*C),v.p(V).addInPlace(A);const t=f.fb[4],e=f.fb[5],Z=f.fb[7],o=f.fb[8];t.p(z).scaleInPlace(1/k),o.p(S).scaleInPlace(1/u),t.addInPlace(o).scaleInPlace(-1),e.p(z).scaleInPlace(-1/k),o.p(J).scaleInPlace(1/O),e.addInPlace(o).scaleInPlace(-1),Z.p(J).scaleInPlace(-1/O),o.p(S).scaleInPlace(-1/u),Z.addInPlace(o).scaleInPlace(-1);const K=f.fb[9];let h;K.p(v).ei(p),l.CrossToRef(t,K,o),h=l.Dot(o,i);const L=h;K.p(v).ei(W),l.CrossToRef(e,K,o),h=l.Dot(o,i);const x=h;K.p(v).ei(d),l.CrossToRef(Z,K,o),h=l.Dot(o,i);const T=h,P=f.fb[10];let b,s;L>0&&x<0?(P.p(z),b=p,s=W):x>0&&T<0?(P.p(J),b=W,s=d):(P.p(S).scaleInPlace(-1),b=d,s=p);const G=f.fb[9],R=f.fb[4];b.subtractToRef(v,o),s.subtractToRef(v,G),l.CrossToRef(o,G,R);if(!(l.Dot(R,i)<0))return E.p(v),Math.abs(F*C);const X=f.fb[5];l.CrossToRef(P,R,X),X.normalize();const r=f.fb[9];r.p(b).ei(v);const B=r.length();if(B<N.c)return E.p(b),l.Distance(V,b);r.normalizeFromLength(B);const Y=l.Dot(X,r),I=f.fb[7];I.p(v).addInPlace(X.scaleInPlace(B*Y)),o.p(I).ei(b),F=P.length(),P.normalizeFromLength(F);let c=l.Dot(o,P)/Math.max(F,N.c);return c=(0,Q.d)(c,0,1),I.p(b).addInPlace(P.scaleInPlace(c*F)),E.p(I),l.Distance(V,I)}static Center(V,p){return l.CenterToRef(V,p,l.Zero())}static CenterToRef(V,p,W){return W.ge((V._x+p._x)/2,(V._y+p._y)/2,(V._z+p._z)/2)}static RotationFromAxis(V,p,W){const N=new l;return l.RotationFromAxisToRef(V,p,W,N),N}static RotationFromAxisToRef(V,p,W,N){const d=f.Quaternion[0];return k.RotationQuaternionFromAxisToRef(V,p,W,d),d.toEulerAnglesToRef(N),N}}l._UpReadOnly=l.Up(),l._DownReadOnly=l.Down(),l._LeftHandedForwardReadOnly=l.Forward(!1),l._RightHandedForwardReadOnly=l.Forward(!0),l._LeftHandedBackwardReadOnly=l.Backward(!1),l._RightHandedBackwardReadOnly=l.Backward(!0),l._RightReadOnly=l.Right(),l._LeftReadOnly=l.Left(),l._ZeroReadOnly=l.Zero(),l._OneReadOnly=l.One(),Object.defineProperties(l.prototype,{dimension:{value:[3]},rank:{value:1}});class j{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=V,this.y=p,this.z=W,this.w=N}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let V=J(this.x);return V=397*V^J(this.y),V=397*V^J(this.z),V=397*V^J(this.w),V}Zi(){return[this.x,this.y,this.z,this.w]}toArray(V,p){return void 0===p&&(p=0),V[p]=this.x,V[p+1]=this.y,V[p+2]=this.z,V[p+3]=this.w,this}fd(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return j.FromArrayToRef(V,p,this),this}addInPlace(V){return this.x+=V.x,this.y+=V.y,this.z+=V.z,this.w+=V.w,this}addInPlaceFromFloats(V,p,W,N){return this.x+=V,this.y+=p,this.z+=W,this.w+=N,this}add(V){return new j(this.x+V.x,this.y+V.y,this.z+V.z,this.w+V.w)}addToRef(V,p){return p.x=this.x+V.x,p.y=this.y+V.y,p.z=this.z+V.z,p.w=this.w+V.w,p}ei(V){return this.x-=V.x,this.y-=V.y,this.z-=V.z,this.w-=V.w,this}ed(V){return new j(this.x-V.x,this.y-V.y,this.z-V.z,this.w-V.w)}subtractToRef(V,p){return p.x=this.x-V.x,p.y=this.y-V.y,p.z=this.z-V.z,p.w=this.w-V.w,p}subtractFromFloats(V,p,W,N){return new j(this.x-V,this.y-p,this.z-W,this.w-N)}subtractFromFloatsToRef(V,p,W,N,d){return d.x=this.x-V,d.y=this.y-p,d.z=this.z-W,d.w=this.w-N,d}negate(){return new j(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(V){return V.x=-this.x,V.y=-this.y,V.z=-this.z,V.w=-this.w,V}scaleInPlace(V){return this.x*=V,this.y*=V,this.z*=V,this.w*=V,this}scale(V){return new j(this.x*V,this.y*V,this.z*V,this.w*V)}scaleToRef(V,p){return p.x=this.x*V,p.y=this.y*V,p.z=this.z*V,p.w=this.w*V,p}scaleAndAddToRef(V,p){return p.x+=this.x*V,p.y+=this.y*V,p.z+=this.z*V,p.w+=this.w*V,p}equals(V){return V&&this.x===V.x&&this.y===V.y&&this.z===V.z&&this.w===V.w}equalsWithEpsilon(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.c;return V&&(0,Q.y)(this.x,V.x,p)&&(0,Q.y)(this.y,V.y,p)&&(0,Q.y)(this.z,V.z,p)&&(0,Q.y)(this.w,V.w,p)}equalsToFloats(V,p,W,N){return this.x===V&&this.y===p&&this.z===W&&this.w===N}multiplyInPlace(V){return this.x*=V.x,this.y*=V.y,this.z*=V.z,this.w*=V.w,this}multiply(V){return new j(this.x*V.x,this.y*V.y,this.z*V.z,this.w*V.w)}multiplyToRef(V,p){return p.x=this.x*V.x,p.y=this.y*V.y,p.z=this.z*V.z,p.w=this.w*V.w,p}multiplyByFloats(V,p,W,N){return new j(this.x*V,this.y*p,this.z*W,this.w*N)}divide(V){return new j(this.x/V.x,this.y/V.y,this.z/V.z,this.w/V.w)}divideToRef(V,p){return p.x=this.x/V.x,p.y=this.y/V.y,p.z=this.z/V.z,p.w=this.w/V.w,p}divideInPlace(V){return this.divideToRef(V,this)}minimizeInPlace(V){return V.x<this.x&&(this.x=V.x),V.y<this.y&&(this.y=V.y),V.z<this.z&&(this.z=V.z),V.w<this.w&&(this.w=V.w),this}maximizeInPlace(V){return V.x>this.x&&(this.x=V.x),V.y>this.y&&(this.y=V.y),V.z>this.z&&(this.z=V.z),V.w>this.w&&(this.w=V.w),this}minimizeInPlaceFromFloats(V,p,W,N){return this.x=Math.min(V,this.x),this.y=Math.min(p,this.y),this.z=Math.min(W,this.z),this.w=Math.min(N,this.w),this}maximizeInPlaceFromFloats(V,p,W,N){return this.x=Math.max(V,this.x),this.y=Math.max(p,this.y),this.z=Math.max(W,this.z),this.w=Math.max(N,this.w),this}floorToRef(V){return V.x=Math.floor(this.x),V.y=Math.floor(this.y),V.z=Math.floor(this.z),V.w=Math.floor(this.w),V}floor(){return new j(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(V){return V.x=this.x-Math.floor(this.x),V.y=this.y-Math.floor(this.y),V.z=this.z-Math.floor(this.z),V.w=this.w-Math.floor(this.w),V}fract(){return new j(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(V){return 0===V||1===V?this:this.scaleInPlace(1/V)}normalizeToNew(){return this.normalizeToRef(new j)}normalizeToRef(V){const p=this.length();return 0===p||1===p?(V.x=this.x,V.y=this.y,V.z=this.z,V.w=this.w,V):this.scaleToRef(1/p,V)}toVector3(){return new l(this.x,this.y,this.z)}clone(){return new j(this.x,this.y,this.z,this.w)}p(V){return this.x=V.x,this.y=V.y,this.z=V.z,this.w=V.w,this}ge(V,p,W,N){return this.x=V,this.y=p,this.z=W,this.w=N,this}set(V,p,W,N){return this.ge(V,p,W,N)}ee(V){return this.x=this.y=this.z=this.w=V,this}dot(V){return this.x*V.x+this.y*V.y+this.z*V.z+this.w*V.w}static Tg(V,p){return p||(p=0),new j(V[p],V[p+1],V[p+2],V[p+3])}static FromArrayToRef(V,p,W){return W.x=V[p],W.y=V[p+1],W.z=V[p+2],W.w=V[p+3],W}static FromFloatArrayToRef(V,p,W){return j.FromArrayToRef(V,p,W),W}static FromFloatsToRef(V,p,W,N,d){return d.x=V,d.y=p,d.z=W,d.w=N,d}static Zero(){return new j(0,0,0,0)}static One(){return new j(1,1,1,1)}static Random(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new j((0,Q.t)(V,p),(0,Q.t)(V,p),(0,Q.t)(V,p),(0,Q.t)(V,p))}static RandomToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2?arguments[2]:void 0;return W.x=(0,Q.t)(V,p),W.y=(0,Q.t)(V,p),W.z=(0,Q.t)(V,p),W.w=(0,Q.t)(V,p),W}static Clamp(V,p,W){return j.ClampToRef(V,p,W,new j)}static ClampToRef(V,p,W,N){return N.x=(0,Q.d)(V.x,p.x,W.x),N.y=(0,Q.d)(V.y,p.y,W.y),N.z=(0,Q.d)(V.z,p.z,W.z),N.w=(0,Q.d)(V.w,p.w,W.w),N}static CheckExtends(V,p,W){p.minimizeInPlace(V),W.maximizeInPlace(V)}static get ZeroReadOnly(){return j._ZeroReadOnly}static Normalize(V){return j.NormalizeToRef(V,new j)}static NormalizeToRef(V,p){return V.normalizeToRef(p),p}static Minimize(V,p){const W=new j;return W.p(V),W.minimizeInPlace(p),W}static Maximize(V,p){const W=new j;return W.p(V),W.maximizeInPlace(p),W}static Distance(V,p){return Math.sqrt(j.DistanceSquared(V,p))}static DistanceSquared(V,p){const W=V.x-p.x,N=V.y-p.y,d=V.z-p.z,E=V.w-p.w;return W*W+N*N+d*d+E*E}static Center(V,p){return j.CenterToRef(V,p,new j)}static CenterToRef(V,p,W){return W.x=(V.x+p.x)/2,W.y=(V.y+p.y)/2,W.z=(V.z+p.z)/2,W.w=(V.w+p.w)/2,W}static TransformCoordinates(V,p){return j.TransformCoordinatesToRef(V,p,new j)}static TransformCoordinatesToRef(V,p,W){return j.TransformCoordinatesFromFloatsToRef(V._x,V._y,V._z,p,W),W}static TransformCoordinatesFromFloatsToRef(V,p,W,N,d){const E=N.m,z=V*E[0]+p*E[4]+W*E[8]+E[12],S=V*E[1]+p*E[5]+W*E[9]+E[13],Q=V*E[2]+p*E[6]+W*E[10]+E[14],J=V*E[3]+p*E[7]+W*E[11]+E[15];return d.x=z,d.y=S,d.z=Q,d.w=J,d}static TransformNormal(V,p){return j.TransformNormalToRef(V,p,new j)}static TransformNormalToRef(V,p,W){const N=p.m,d=V.x*N[0]+V.y*N[4]+V.z*N[8],E=V.x*N[1]+V.y*N[5]+V.z*N[9],z=V.x*N[2]+V.y*N[6]+V.z*N[10];return W.x=d,W.y=E,W.z=z,W.w=V.w,W}static TransformNormalFromFloatsToRef(V,p,W,N,d,E){const z=d.m;return E.x=V*z[0]+p*z[4]+W*z[8],E.y=V*z[1]+p*z[5]+W*z[9],E.z=V*z[2]+p*z[6]+W*z[10],E.w=N,E}static FromVector3(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new j(V._x,V._y,V._z,p)}static Dot(V,p){return V.x*p.x+V.y*p.y+V.z*p.z+V.w*p.w}}j._ZeroReadOnly=j.Zero(),Object.defineProperties(j.prototype,{dimension:{value:[4]},rank:{value:1}});class k{get x(){return this._x}set x(V){this._x=V,this._isDirty=!0}get y(){return this._y}set y(V){this._y=V,this._isDirty=!0}get z(){return this._z}set z(V){this._z=V,this._isDirty=!0}get w(){return this._w}set w(V){this._w=V,this._isDirty=!0}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=V,this._y=p,this._z=W,this._w=N}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let V=J(this._x);return V=397*V^J(this._y),V=397*V^J(this._z),V=397*V^J(this._w),V}Zi(){return[this._x,this._y,this._z,this._w]}toArray(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return V[p]=this._x,V[p+1]=this._y,V[p+2]=this._z,V[p+3]=this._w,this}fd(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return k.FromArrayToRef(V,p,this)}equals(V){return V&&this._x===V._x&&this._y===V._y&&this._z===V._z&&this._w===V._w}equalsWithEpsilon(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.c;return V&&(0,Q.y)(this._x,V._x,p)&&(0,Q.y)(this._y,V._y,p)&&(0,Q.y)(this._z,V._z,p)&&(0,Q.y)(this._w,V._w,p)}clone(){return new k(this._x,this._y,this._z,this._w)}p(V){return this._x=V._x,this._y=V._y,this._z=V._z,this._w=V._w,this._isDirty=!0,this}ge(V,p,W,N){return this._x=V,this._y=p,this._z=W,this._w=N,this._isDirty=!0,this}set(V,p,W,N){return this.ge(V,p,W,N)}ee(V){return this.ge(V,V,V,V)}add(V){return new k(this._x+V._x,this._y+V._y,this._z+V._z,this._w+V._w)}addInPlace(V){return this._x+=V._x,this._y+=V._y,this._z+=V._z,this._w+=V._w,this._isDirty=!0,this}addToRef(V,p){return p._x=this._x+V._x,p._y=this._y+V._y,p._z=this._z+V._z,p._w=this._w+V._w,p._isDirty=!0,p}addInPlaceFromFloats(V,p,W,N){return this._x+=V,this._y+=p,this._z+=W,this._w+=N,this._isDirty=!0,this}subtractToRef(V,p){return p._x=this._x-V._x,p._y=this._y-V._y,p._z=this._z-V._z,p._w=this._w-V._w,p._isDirty=!0,p}subtractFromFloats(V,p,W,N){return this.subtractFromFloatsToRef(V,p,W,N,new k)}subtractFromFloatsToRef(V,p,W,N,d){return d._x=this._x-V,d._y=this._y-p,d._z=this._z-W,d._w=this._w-N,d._isDirty=!0,d}ed(V){return new k(this._x-V._x,this._y-V._y,this._z-V._z,this._w-V._w)}ei(V){return this._x-=V._x,this._y-=V._y,this._z-=V._z,this._w-=V._w,this._isDirty=!0,this}scale(V){return new k(this._x*V,this._y*V,this._z*V,this._w*V)}scaleToRef(V,p){return p._x=this._x*V,p._y=this._y*V,p._z=this._z*V,p._w=this._w*V,p._isDirty=!0,p}scaleInPlace(V){return this._x*=V,this._y*=V,this._z*=V,this._w*=V,this._isDirty=!0,this}scaleAndAddToRef(V,p){return p._x+=this._x*V,p._y+=this._y*V,p._z+=this._z*V,p._w+=this._w*V,p._isDirty=!0,p}multiply(V){const p=new k(0,0,0,1);return this.multiplyToRef(V,p),p}multiplyToRef(V,p){const W=this._x*V._w+this._y*V._z-this._z*V._y+this._w*V._x,N=-this._x*V._z+this._y*V._w+this._z*V._x+this._w*V._y,d=this._x*V._y-this._y*V._x+this._z*V._w+this._w*V._z,E=-this._x*V._x-this._y*V._y-this._z*V._z+this._w*V._w;return p.ge(W,N,d,E),p}multiplyInPlace(V){return this.multiplyToRef(V,this)}multiplyByFloats(V,p,W,N){return this._x*=V,this._y*=p,this._z*=W,this._w*=N,this._isDirty=!0,this}divide(V){throw new ReferenceError("Can not divide a quaternion")}divideToRef(V,p){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(V){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new k)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(V){return V._x=-this._x,V._y=-this._y,V._z=-this._z,V._w=-this._w,V._isDirty=!0,V}equalsToFloats(V,p,W,N){return this._x===V&&this._y===p&&this._z===W&&this._w===N}floorToRef(V){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(V){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(V){return V.ge(-this._x,-this._y,-this._z,this._w),V}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new k(-this._x,-this._y,-this._z,this._w)}invert(){const V=this.conjugate(),p=this.lengthSquared();return 0==p||1==p||V.scaleInPlace(1/p),V}invertInPlace(){this.conjugateInPlace();const V=this.lengthSquared();return 0==V||1==V||this.scaleInPlace(1/V),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(V){return 0===V||1===V?this:this.scaleInPlace(1/V)}normalizeToNew(){const V=new k(0,0,0,1);return this.normalizeToRef(V),V}normalizeToRef(V){const p=this.length();return 0===p||1===p?V.ge(this._x,this._y,this._z,this._w):this.scaleToRef(1/p,V)}toEulerAngles(){const V=l.Zero();return this.toEulerAnglesToRef(V),V}toEulerAnglesToRef(V){const p=this._z,W=this._x,N=this._y,d=this._w,E=N*p-W*d,z=.4999999;if(E<-z)V._y=2*Math.atan2(N,d),V._x=Math.PI/2,V._z=0,V._isDirty=!0;else if(E>z)V._y=2*Math.atan2(N,d),V._x=-Math.PI/2,V._z=0,V._isDirty=!0;else{const z=d*d,S=p*p,Q=W*W,J=N*N;V._z=Math.atan2(2*(W*N+p*d),-S-Q+J+z),V._x=Math.asin(-2*E),V._y=Math.atan2(2*(p*W+N*d),S-Q-J+z),V._isDirty=!0}return V}toAlphaBetaGammaToRef(V){const p=this._z,W=this._x,N=this._y,d=this._w,E=Math.sqrt(W*W+N*N),z=Math.sqrt(p*p+d*d),S=2*Math.atan2(E,z),Q=2*Math.atan2(p,d),J=2*Math.atan2(N,W),i=(Q+J)/2,l=(Q-J)/2;return V.set(l,S,i),V}toRotationMatrix(V){return u.FromQuaternionToRef(this,V),V}fromRotationMatrix(V){return k.FromRotationMatrixToRef(V,this),this}dot(V){return this._x*V._x+this._y*V._y+this._z*V._z+this._w*V._w}static FromRotationMatrix(V){const p=new k;return k.FromRotationMatrixToRef(V,p),p}static FromRotationMatrixToRef(V,p){const W=V.m,N=W[0],d=W[4],E=W[8],z=W[1],S=W[5],Q=W[9],J=W[2],i=W[6],l=W[10],j=N+S+l;let k;return j>0?(k=.5/Math.sqrt(j+1),p._w=.25/k,p._x=(i-Q)*k,p._y=(E-J)*k,p._z=(z-d)*k,p._isDirty=!0):N>S&&N>l?(k=2*Math.sqrt(1+N-S-l),p._w=(i-Q)/k,p._x=.25*k,p._y=(d+z)/k,p._z=(E+J)/k,p._isDirty=!0):S>l?(k=2*Math.sqrt(1+S-N-l),p._w=(E-J)/k,p._x=(d+z)/k,p._y=.25*k,p._z=(Q+i)/k,p._isDirty=!0):(k=2*Math.sqrt(1+l-N-S),p._w=(z-d)/k,p._x=(E+J)/k,p._y=(Q+i)/k,p._z=.25*k,p._isDirty=!0),p}static Dot(V,p){return V._x*p._x+V._y*p._y+V._z*p._z+V._w*p._w}static AreClose(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const N=k.Dot(V,p);return 1-N*N<=W}static SmoothToRef(V,p,W,N,d){let E=0===N?1:W/N;return E=(0,Q.d)(E,0,1),k.SlerpToRef(V,p,E,d),d}static Zero(){return new k(0,0,0,0)}static Inverse(V){return new k(-V._x,-V._y,-V._z,V._w)}static InverseToRef(V,p){return p.set(-V._x,-V._y,-V._z,V._w),p}static Identity(){return new k(0,0,0,1)}static IsIdentity(V){return V&&0===V._x&&0===V._y&&0===V._z&&1===V._w}static RotationAxis(V,p){return k.RotationAxisToRef(V,p,new k)}static RotationAxisToRef(V,p,W){W._w=Math.cos(p/2);const N=Math.sin(p/2)/V.length();return W._x=V._x*N,W._y=V._y*N,W._z=V._z*N,W._isDirty=!0,W}static Tg(V,p){return p||(p=0),new k(V[p],V[p+1],V[p+2],V[p+3])}static FromArrayToRef(V,p,W){return W._x=V[p],W._y=V[p+1],W._z=V[p+2],W._w=V[p+3],W._isDirty=!0,W}static FromFloatsToRef(V,p,W,N,d){return d.ge(V,p,W,N),d}static FromEulerAngles(V,p,W){const N=new k;return k.RotationYawPitchRollToRef(p,V,W,N),N}static FromEulerAnglesToRef(V,p,W,N){return k.RotationYawPitchRollToRef(p,V,W,N),N}static FromEulerVector(V){const p=new k;return k.RotationYawPitchRollToRef(V._y,V._x,V._z,p),p}static FromEulerVectorToRef(V,p){return k.RotationYawPitchRollToRef(V._y,V._x,V._z,p),p}static FromUnitVectorsToRef(V,p,W){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N.c;const E=l.Dot(V,p)+1;return E<d?Math.abs(V.x)>Math.abs(V.z)?W.set(-V.y,V.x,0,0):W.set(0,-V.z,V.y,0):(l.CrossToRef(V,p,O.fb[0]),W.set(O.fb[0].x,O.fb[0].y,O.fb[0].z,E)),W.normalize()}static RotationYawPitchRoll(V,p,W){const N=new k;return k.RotationYawPitchRollToRef(V,p,W,N),N}static RotationYawPitchRollToRef(V,p,W,N){const d=.5*W,E=.5*p,z=.5*V,S=Math.sin(d),Q=Math.cos(d),J=Math.sin(E),i=Math.cos(E),l=Math.sin(z),j=Math.cos(z);return N._x=j*J*Q+l*i*S,N._y=l*i*Q-j*J*S,N._z=j*i*S-l*J*Q,N._w=j*i*Q+l*J*S,N._isDirty=!0,N}static RotationAlphaBetaGamma(V,p,W){const N=new k;return k.RotationAlphaBetaGammaToRef(V,p,W,N),N}static RotationAlphaBetaGammaToRef(V,p,W,N){const d=.5*(W+V),E=.5*(W-V),z=.5*p;return N._x=Math.cos(E)*Math.sin(z),N._y=Math.sin(E)*Math.sin(z),N._z=Math.sin(d)*Math.cos(z),N._w=Math.cos(d)*Math.cos(z),N._isDirty=!0,N}static RotationQuaternionFromAxis(V,p,W){const N=new k(0,0,0,0);return k.RotationQuaternionFromAxisToRef(V,p,W,N),N}static RotationQuaternionFromAxisToRef(V,p,W,N){const d=f.Matrix[0];return V=V.normalizeToRef(f.fb[0]),p=p.normalizeToRef(f.fb[1]),W=W.normalizeToRef(f.fb[2]),u.FromXYZAxesToRef(V,p,W,d),k.FromRotationMatrixToRef(d,N),N}static FromLookDirectionLH(V,p){const W=new k;return k.FromLookDirectionLHToRef(V,p,W),W}static FromLookDirectionLHToRef(V,p,W){const N=f.Matrix[0];return u.LookDirectionLHToRef(V,p,N),k.FromRotationMatrixToRef(N,W),W}static FromLookDirectionRH(V,p){const W=new k;return k.FromLookDirectionRHToRef(V,p,W),W}static FromLookDirectionRHToRef(V,p,W){const N=f.Matrix[0];return u.LookDirectionRHToRef(V,p,N),k.FromRotationMatrixToRef(N,W)}static Slerp(V,p,W){const N=k.Identity();return k.SlerpToRef(V,p,W,N),N}static SlerpToRef(V,p,W,N){let d,E,z=V._x*p._x+V._y*p._y+V._z*p._z+V._w*p._w,S=!1;if(z<0&&(S=!0,z=-z),z>.999999)E=1-W,d=S?-W:W;else{const V=Math.acos(z),p=1/Math.sin(V);E=Math.sin((1-W)*V)*p,d=S?-Math.sin(W*V)*p:Math.sin(W*V)*p}return N._x=E*V._x+d*p._x,N._y=E*V._y+d*p._y,N._z=E*V._z+d*p._z,N._w=E*V._w+d*p._w,N._isDirty=!0,N}static Hermite(V,p,W,N,d){const E=d*d,z=d*E,S=2*z-3*E+1,Q=-2*z+3*E,J=z-2*E+d,i=z-E,l=V._x*S+W._x*Q+p._x*J+N._x*i,j=V._y*S+W._y*Q+p._y*J+N._y*i,u=V._z*S+W._z*Q+p._z*J+N._z*i,f=V._w*S+W._w*Q+p._w*J+N._w*i;return new k(l,j,u,f)}static Hermite1stDerivative(V,p,W,N,d){const E=new k;return this.Hermite1stDerivativeToRef(V,p,W,N,d,E),E}static Hermite1stDerivativeToRef(V,p,W,N,d,E){const z=d*d;return E._x=6*(z-d)*V._x+(3*z-4*d+1)*p._x+6*(-z+d)*W._x+(3*z-2*d)*N._x,E._y=6*(z-d)*V._y+(3*z-4*d+1)*p._y+6*(-z+d)*W._y+(3*z-2*d)*N._y,E._z=6*(z-d)*V._z+(3*z-4*d+1)*p._z+6*(-z+d)*W._z+(3*z-2*d)*N._z,E._w=6*(z-d)*V._w+(3*z-4*d+1)*p._w+6*(-z+d)*W._w+(3*z-2*d)*N._w,E._isDirty=!0,E}static Normalize(V){const p=k.Zero();return k.NormalizeToRef(V,p),p}static NormalizeToRef(V,p){return V.normalizeToRef(p),p}static Clamp(V,p,W){const N=new k;return k.ClampToRef(V,p,W,N),N}static ClampToRef(V,p,W,N){return N.ge((0,Q.d)(V.x,p.x,W.x),(0,Q.d)(V.y,p.y,W.y),(0,Q.d)(V.z,p.z,W.z),(0,Q.d)(V.w,p.w,W.w))}static Random(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new k((0,Q.t)(V,p),(0,Q.t)(V,p),(0,Q.t)(V,p),(0,Q.t)(V,p))}static RandomToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).ge((0,Q.t)(V,p),(0,Q.t)(V,p),(0,Q.t)(V,p),(0,Q.t)(V,p))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(V,p){return Math.sqrt(k.DistanceSquared(V,p))}static DistanceSquared(V,p){const W=V.x-p.x,N=V.y-p.y,d=V.z-p.z,E=V.w-p.w;return W*W+N*N+d*d+E*E}static Center(V,p){return k.CenterToRef(V,p,k.Zero())}static CenterToRef(V,p,W){return W.ge((V.x+p.x)/2,(V.y+p.y)/2,(V.z+p.z)/2,(V.w+p.w)/2)}}Object.defineProperties(k.prototype,{dimension:{value:[4]},rank:{value:1}});class u{static get Use64Bits(){return z.d.MatrixUse64Bits}get m(){return this.Ej}markAsUpdated(){this.updateFlag=u._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=V,this._isIdentity3x2=V||W,this._isIdentityDirty=!this._isIdentity&&p,this._isIdentity3x2Dirty=!this._isIdentity3x2&&N}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,z.d.MatrixTrackPrecisionChange&&z.d.MatrixTrackedMatrices.push(this),this.Ej=new z.d.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const V=this.Ej;this._isIdentity=1===V[0]&&0===V[1]&&0===V[2]&&0===V[3]&&0===V[4]&&1===V[5]&&0===V[6]&&0===V[7]&&0===V[8]&&0===V[9]&&1===V[10]&&0===V[11]&&0===V[12]&&0===V[13]&&0===V[14]&&1===V[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.Ej[0]||1!==this.Ej[5]||1!==this.Ej[15]||0!==this.Ej[1]||0!==this.Ej[2]||0!==this.Ej[3]||0!==this.Ej[4]||0!==this.Ej[6]||0!==this.Ej[7]||0!==this.Ej[8]||0!==this.Ej[9]||0!==this.Ej[10]||0!==this.Ej[11]||0!==this.Ej[12]||0!==this.Ej[13]||0!==this.Ej[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const V=this.Ej,p=V[0],W=V[1],N=V[2],d=V[3],E=V[4],z=V[5],S=V[6],Q=V[7],J=V[8],i=V[9],l=V[10],j=V[11],k=V[12],u=V[13],f=V[14],O=V[15],U=l*O-f*j,F=i*O-u*j,C=i*f-u*l,A=J*O-k*j,v=J*f-l*k,t=J*u-k*i;return p*+(z*U-S*F+Q*C)+W*-(E*U-S*A+Q*v)+N*+(E*F-z*A+Q*t)+d*-(E*C-z*v+S*t)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!V)return this.Ej;const W=this.Ej;for(let N=0;N<16;N++)V[p+N]=W[N];return this}Zi(){return this.Ej}fd(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u.FromArrayToRef(V,p,this)}ge(){for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];return u.FromArrayToRef(p,0,this)}set(){const V=this.Ej;for(let p=0;p<16;p++)V[p]=p<0||arguments.length<=p?void 0:arguments[p];return this.markAsUpdated(),this}ee(V){const p=this.Ej;for(let W=0;W<16;W++)p[W]=V;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return u.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(V){const p=new u;return this.addToRef(V,p),p}addToRef(V,p){const W=this.Ej,N=p.Ej,d=V.m;for(let E=0;E<16;E++)N[E]=W[E]+d[E];return p.markAsUpdated(),p}addToSelf(V){const p=this.Ej,W=V.m;return p[0]+=W[0],p[1]+=W[1],p[2]+=W[2],p[3]+=W[3],p[4]+=W[4],p[5]+=W[5],p[6]+=W[6],p[7]+=W[7],p[8]+=W[8],p[9]+=W[9],p[10]+=W[10],p[11]+=W[11],p[12]+=W[12],p[13]+=W[13],p[14]+=W[14],p[15]+=W[15],this.markAsUpdated(),this}addInPlace(V){const p=this.Ej,W=V.m;for(let N=0;N<16;N++)p[N]+=W[N];return this.markAsUpdated(),this}addInPlaceFromFloats(){const V=this.Ej;for(let p=0;p<16;p++)V[p]+=p<0||arguments.length<=p?void 0:arguments[p];return this.markAsUpdated(),this}ed(V){const p=this.Ej,W=V.m;for(let N=0;N<16;N++)p[N]-=W[N];return this.markAsUpdated(),this}subtractToRef(V,p){const W=this.Ej,N=V.m,d=p.Ej;for(let E=0;E<16;E++)d[E]=W[E]-N[E];return p.markAsUpdated(),p}ei(V){const p=this.Ej,W=V.m;for(let N=0;N<16;N++)p[N]-=W[N];return this.markAsUpdated(),this}subtractFromFloats(){for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];return this.subtractFromFloatsToRef(...p,new u)}subtractFromFloatsToRef(){for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];const N=p.pop(),d=this.Ej,E=N.Ej,z=p;for(let S=0;S<16;S++)E[S]=d[S]-z[S];return N.markAsUpdated(),N}invertToRef(V){if(!0===this._isIdentity)return u.IdentityToRef(V),V;const p=this.Ej,W=p[0],N=p[1],d=p[2],E=p[3],z=p[4],S=p[5],Q=p[6],J=p[7],i=p[8],l=p[9],j=p[10],k=p[11],f=p[12],O=p[13],U=p[14],F=p[15],C=j*F-U*k,A=l*F-O*k,v=l*U-O*j,t=i*F-f*k,e=i*U-j*f,Z=i*O-f*l,o=+(S*C-Q*A+J*v),K=-(z*C-Q*t+J*e),h=+(z*A-S*t+J*Z),L=-(z*v-S*e+Q*Z),x=W*o+N*K+d*h+E*L;if(0===x)return V.p(this),V;const T=1/x,P=Q*F-U*J,b=S*F-O*J,s=S*U-O*Q,G=z*F-f*J,R=z*U-f*Q,X=z*O-f*S,r=Q*k-j*J,B=S*k-l*J,Y=S*j-l*Q,I=z*k-i*J,c=z*j-i*Q,q=z*l-i*S,g=-(N*C-d*A+E*v),D=+(W*C-d*t+E*e),H=-(W*A-N*t+E*Z),m=+(W*v-N*e+d*Z),M=+(N*P-d*b+E*s),a=-(W*P-d*G+E*R),y=+(W*b-N*G+E*X),n=-(W*s-N*R+d*X),w=-(N*r-d*B+E*Y),VV=+(W*r-d*I+E*c),pV=-(W*B-N*I+E*q),WV=+(W*Y-N*c+d*q);return u.FromValuesToRef(o*T,g*T,M*T,w*T,K*T,D*T,a*T,VV*T,h*T,H*T,y*T,pV*T,L*T,m*T,n*T,WV*T,V),V}addAtIndex(V,p){return this.Ej[V]+=p,this.markAsUpdated(),this}multiplyAtIndex(V,p){return this.Ej[V]*=p,this.markAsUpdated(),this}setTranslationFromFloats(V,p,W){return this.Ej[12]=V,this.Ej[13]=p,this.Ej[14]=W,this.markAsUpdated(),this}addTranslationFromFloats(V,p,W){return this.Ej[12]+=V,this.Ej[13]+=p,this.Ej[14]+=W,this.markAsUpdated(),this}setTranslation(V){return this.setTranslationFromFloats(V._x,V._y,V._z)}getTranslation(){return new l(this.Ej[12],this.Ej[13],this.Ej[14])}getTranslationToRef(V){return V.x=this.Ej[12],V.y=this.Ej[13],V.z=this.Ej[14],V}removeRotationAndScaling(){const V=this.m;return u.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,V[12],V[13],V[14],V[15],this),this._updateIdentityStatus(0===V[12]&&0===V[13]&&0===V[14]&&1===V[15]),this}p(V){V.copyToArray(this.Ej);const p=V;return this.updateFlag=p.updateFlag,this._updateIdentityStatus(p._isIdentity,p._isIdentityDirty,p._isIdentity3x2,p._isIdentity3x2Dirty),this}copyToArray(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=this.Ej;return V[p]=W[0],V[p+1]=W[1],V[p+2]=W[2],V[p+3]=W[3],V[p+4]=W[4],V[p+5]=W[5],V[p+6]=W[6],V[p+7]=W[7],V[p+8]=W[8],V[p+9]=W[9],V[p+10]=W[10],V[p+11]=W[11],V[p+12]=W[12],V[p+13]=W[13],V[p+14]=W[14],V[p+15]=W[15],this}multiply(V){const p=new u;return this.multiplyToRef(V,p),p}multiplyInPlace(V){const p=this.Ej,W=V.m;for(let N=0;N<16;N++)p[N]*=W[N];return this.markAsUpdated(),this}multiplyByFloats(){const V=this.Ej;for(let p=0;p<16;p++)V[p]*=p<0||arguments.length<=p?void 0:arguments[p];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];const N=p.pop(),d=this.Ej,E=N.Ej,z=p;for(let S=0;S<16;S++)E[S]=d[S]*z[S];return N.markAsUpdated(),N}multiplyToRef(V,p){return this._isIdentity?(p.p(V),p):V._isIdentity?(p.p(this),p):(this.multiplyToArray(V,p.Ej,0),p.markAsUpdated(),p)}multiplyToArray(V,p,W){const N=this.Ej,d=V.m,E=N[0],z=N[1],S=N[2],Q=N[3],J=N[4],i=N[5],l=N[6],j=N[7],k=N[8],u=N[9],f=N[10],O=N[11],U=N[12],F=N[13],C=N[14],A=N[15],v=d[0],t=d[1],e=d[2],Z=d[3],o=d[4],K=d[5],h=d[6],L=d[7],x=d[8],T=d[9],P=d[10],b=d[11],s=d[12],G=d[13],R=d[14],X=d[15];return p[W]=E*v+z*o+S*x+Q*s,p[W+1]=E*t+z*K+S*T+Q*G,p[W+2]=E*e+z*h+S*P+Q*R,p[W+3]=E*Z+z*L+S*b+Q*X,p[W+4]=J*v+i*o+l*x+j*s,p[W+5]=J*t+i*K+l*T+j*G,p[W+6]=J*e+i*h+l*P+j*R,p[W+7]=J*Z+i*L+l*b+j*X,p[W+8]=k*v+u*o+f*x+O*s,p[W+9]=k*t+u*K+f*T+O*G,p[W+10]=k*e+u*h+f*P+O*R,p[W+11]=k*Z+u*L+f*b+O*X,p[W+12]=U*v+F*o+C*x+A*s,p[W+13]=U*t+F*K+C*T+A*G,p[W+14]=U*e+F*h+C*P+A*R,p[W+15]=U*Z+F*L+C*b+A*X,this}divide(V){return this.divideToRef(V,new u)}divideToRef(V,p){const W=this.Ej,N=V.m,d=p.Ej;for(let E=0;E<16;E++)d[E]=W[E]/N[E];return p.markAsUpdated(),p}divideInPlace(V){const p=this.Ej,W=V.m;for(let N=0;N<16;N++)p[N]/=W[N];return this.markAsUpdated(),this}minimizeInPlace(V){const p=this.Ej,W=V.m;for(let N=0;N<16;N++)p[N]=Math.min(p[N],W[N]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const V=this.Ej;for(let p=0;p<16;p++)V[p]=Math.min(V[p],p<0||arguments.length<=p?void 0:arguments[p]);return this.markAsUpdated(),this}maximizeInPlace(V){const p=this.Ej,W=V.m;for(let N=0;N<16;N++)p[N]=Math.min(p[N],W[N]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const V=this.Ej;for(let p=0;p<16;p++)V[p]=Math.min(V[p],p<0||arguments.length<=p?void 0:arguments[p]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new u)}negateInPlace(){const V=this.Ej;for(let p=0;p<16;p++)V[p]=-V[p];return this.markAsUpdated(),this}negateToRef(V){const p=this.Ej,W=V.Ej;for(let N=0;N<16;N++)W[N]=-p[N];return V.markAsUpdated(),V}equals(V){const p=V;if(!p)return!1;if((this._isIdentity||p._isIdentity)&&!this._isIdentityDirty&&!p._isIdentityDirty)return this._isIdentity&&p._isIdentity;const W=this.m,N=p.m;return W[0]===N[0]&&W[1]===N[1]&&W[2]===N[2]&&W[3]===N[3]&&W[4]===N[4]&&W[5]===N[5]&&W[6]===N[6]&&W[7]===N[7]&&W[8]===N[8]&&W[9]===N[9]&&W[10]===N[10]&&W[11]===N[11]&&W[12]===N[12]&&W[13]===N[13]&&W[14]===N[14]&&W[15]===N[15]}equalsWithEpsilon(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=this.Ej,N=V.m;for(let d=0;d<16;d++)if(!(0,Q.y)(W[d],N[d],p))return!1;return!0}equalsToFloats(){const V=this.Ej;for(let p=0;p<16;p++)if(V[p]!=(p<0||arguments.length<=p?void 0:arguments[p]))return!1;return!0}floor(){return this.floorToRef(new u)}floorToRef(V){const p=this.Ej,W=V.Ej;for(let N=0;N<16;N++)W[N]=Math.floor(p[N]);return V.markAsUpdated(),V}fract(){return this.fractToRef(new u)}fractToRef(V){const p=this.Ej,W=V.Ej;for(let N=0;N<16;N++)W[N]=p[N]-Math.floor(p[N]);return V.markAsUpdated(),V}clone(){const V=new u;return V.p(this),V}getClassName(){return"Matrix"}getHashCode(){let V=J(this.Ej[0]);for(let p=1;p<16;p++)V=397*V^J(this.Ej[p]);return V}decomposeToTransformNode(V){return V.rotationQuaternion=V.rotationQuaternion||new k,this.decompose(V.ie,V.rotationQuaternion,V.position)}decompose(V,p,W,N){let d=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return W&&W.ee(0),V&&V.ee(1),p&&p.ge(0,0,0,1),!0;const E=this.Ej;if(W&&W.ge(E[12],E[13],E[14]),(V=V||f.fb[0]).x=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]),V.y=Math.sqrt(E[4]*E[4]+E[5]*E[5]+E[6]*E[6]),V.z=Math.sqrt(E[8]*E[8]+E[9]*E[9]+E[10]*E[10]),N){const p=(d?N.absoluteScaling.x:N.ie.x)<0?-1:1,W=(d?N.absoluteScaling.y:N.ie.y)<0?-1:1,E=(d?N.absoluteScaling.z:N.ie.z)<0?-1:1;V.x*=p,V.y*=W,V.z*=E}else this.determinant()<=0&&(V.y*=-1);if(0===V._x||0===V._y||0===V._z)return p&&p.ge(0,0,0,1),!1;if(p){const W=1/V._x,N=1/V._y,d=1/V._z;u.FromValuesToRef(E[0]*W,E[1]*W,E[2]*W,0,E[4]*N,E[5]*N,E[6]*N,0,E[8]*d,E[9]*d,E[10]*d,0,0,0,0,1,f.Matrix[0]),k.FromRotationMatrixToRef(f.Matrix[0],p)}return!0}getRow(V){if(V<0||V>3)return null;const p=4*V;return new j(this.Ej[p+0],this.Ej[p+1],this.Ej[p+2],this.Ej[p+3])}getRowToRef(V,p){if(V>=0&&V<=3){const W=4*V;p.x=this.Ej[W+0],p.y=this.Ej[W+1],p.z=this.Ej[W+2],p.w=this.Ej[W+3]}return p}setRow(V,p){return this.setRowFromFloats(V,p.x,p.y,p.z,p.w)}transpose(){const V=new u;return u.TransposeToRef(this,V),V}transposeToRef(V){return u.TransposeToRef(this,V),V}setRowFromFloats(V,p,W,N,d){if(V<0||V>3)return this;const E=4*V;return this.Ej[E+0]=p,this.Ej[E+1]=W,this.Ej[E+2]=N,this.Ej[E+3]=d,this.markAsUpdated(),this}scale(V){const p=new u;return this.scaleToRef(V,p),p}scaleToRef(V,p){for(let W=0;W<16;W++)p.Ej[W]=this.Ej[W]*V;return p.markAsUpdated(),p}scaleAndAddToRef(V,p){for(let W=0;W<16;W++)p.Ej[W]+=this.Ej[W]*V;return p.markAsUpdated(),p}scaleInPlace(V){const p=this.Ej;for(let W=0;W<16;W++)p[W]*=V;return this.markAsUpdated(),this}toNormalMatrix(V){const p=f.Matrix[0];this.invertToRef(p),p.transposeToRef(V);const W=V.Ej;return u.FromValuesToRef(W[0],W[1],W[2],0,W[4],W[5],W[6],0,W[8],W[9],W[10],0,0,0,0,1,V),V}getRotationMatrix(){const V=new u;return this.getRotationMatrixToRef(V),V}getRotationMatrixToRef(V){const p=f.fb[0];if(!this.decompose(p))return u.IdentityToRef(V),V;const W=this.Ej,N=1/p._x,d=1/p._y,E=1/p._z;return u.FromValuesToRef(W[0]*N,W[1]*N,W[2]*N,0,W[4]*d,W[5]*d,W[6]*d,0,W[8]*E,W[9]*E,W[10]*E,0,0,0,0,1,V),V}toggleModelMatrixHandInPlace(){const V=this.Ej;return V[2]*=-1,V[6]*=-1,V[8]*=-1,V[9]*=-1,V[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const V=this.Ej;return V[8]*=-1,V[9]*=-1,V[10]*=-1,V[11]*=-1,this.markAsUpdated(),this}static Tg(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const W=new u;return u.FromArrayToRef(V,p,W),W}static FromArrayToRef(V,p,W){for(let N=0;N<16;N++)W.Ej[N]=V[N+p];return W.markAsUpdated(),W}static FromFloat32ArrayToRefScaled(V,p,W,N){return N.Ej[0]=V[0+p]*W,N.Ej[1]=V[1+p]*W,N.Ej[2]=V[2+p]*W,N.Ej[3]=V[3+p]*W,N.Ej[4]=V[4+p]*W,N.Ej[5]=V[5+p]*W,N.Ej[6]=V[6+p]*W,N.Ej[7]=V[7+p]*W,N.Ej[8]=V[8+p]*W,N.Ej[9]=V[9+p]*W,N.Ej[10]=V[10+p]*W,N.Ej[11]=V[11+p]*W,N.Ej[12]=V[12+p]*W,N.Ej[13]=V[13+p]*W,N.Ej[14]=V[14+p]*W,N.Ej[15]=V[15+p]*W,N.markAsUpdated(),N}static get IdentityReadOnly(){return u._IdentityReadOnly}static FromValuesToRef(V,p,W,N,d,E,z,S,Q,J,i,l,j,k,u,f,O){const U=O.Ej;U[0]=V,U[1]=p,U[2]=W,U[3]=N,U[4]=d,U[5]=E,U[6]=z,U[7]=S,U[8]=Q,U[9]=J,U[10]=i,U[11]=l,U[12]=j,U[13]=k,U[14]=u,U[15]=f,O.markAsUpdated()}static FromValues(V,p,W,N,d,E,z,S,Q,J,i,l,j,k,f,O){const U=new u,F=U.Ej;return F[0]=V,F[1]=p,F[2]=W,F[3]=N,F[4]=d,F[5]=E,F[6]=z,F[7]=S,F[8]=Q,F[9]=J,F[10]=i,F[11]=l,F[12]=j,F[13]=k,F[14]=f,F[15]=O,U.markAsUpdated(),U}static Compose(V,p,W){const N=new u;return u.ComposeToRef(V,p,W,N),N}static ComposeToRef(V,p,W,N){const d=N.Ej,E=p._x,z=p._y,S=p._z,Q=p._w,J=E+E,i=z+z,l=S+S,j=E*J,k=E*i,u=E*l,f=z*i,O=z*l,U=S*l,F=Q*J,C=Q*i,A=Q*l,v=V._x,t=V._y,e=V._z;return d[0]=(1-(f+U))*v,d[1]=(k+A)*v,d[2]=(u-C)*v,d[3]=0,d[4]=(k-A)*t,d[5]=(1-(j+U))*t,d[6]=(O+F)*t,d[7]=0,d[8]=(u+C)*e,d[9]=(O-F)*e,d[10]=(1-(j+f))*e,d[11]=0,d[12]=W._x,d[13]=W._y,d[14]=W._z,d[15]=1,N.markAsUpdated(),N}static Identity(){const V=u.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return V._updateIdentityStatus(!0),V}static IdentityToRef(V){return u.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,V),V._updateIdentityStatus(!0),V}static Zero(){const V=u.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return V._updateIdentityStatus(!1),V}static RotationX(V){const p=new u;return u.RotationXToRef(V,p),p}static Invert(V){const p=new u;return V.invertToRef(p),p}static RotationXToRef(V,p){const W=Math.sin(V),N=Math.cos(V);return u.FromValuesToRef(1,0,0,0,0,N,W,0,0,-W,N,0,0,0,0,1,p),p._updateIdentityStatus(1===N&&0===W),p}static RotationY(V){const p=new u;return u.RotationYToRef(V,p),p}static RotationYToRef(V,p){const W=Math.sin(V),N=Math.cos(V);return u.FromValuesToRef(N,0,-W,0,0,1,0,0,W,0,N,0,0,0,0,1,p),p._updateIdentityStatus(1===N&&0===W),p}static RotationZ(V){const p=new u;return u.RotationZToRef(V,p),p}static RotationZToRef(V,p){const W=Math.sin(V),N=Math.cos(V);return u.FromValuesToRef(N,W,0,0,-W,N,0,0,0,0,1,0,0,0,0,1,p),p._updateIdentityStatus(1===N&&0===W),p}static RotationAxis(V,p){const W=new u;return u.RotationAxisToRef(V,p,W),W}static RotationAxisToRef(V,p,W){const N=Math.sin(-p),d=Math.cos(-p),E=1-d;V=V.normalizeToRef(f.fb[0]);const z=W.Ej;return z[0]=V._x*V._x*E+d,z[1]=V._x*V._y*E-V._z*N,z[2]=V._x*V._z*E+V._y*N,z[3]=0,z[4]=V._y*V._x*E+V._z*N,z[5]=V._y*V._y*E+d,z[6]=V._y*V._z*E-V._x*N,z[7]=0,z[8]=V._z*V._x*E-V._y*N,z[9]=V._z*V._y*E+V._x*N,z[10]=V._z*V._z*E+d,z[11]=0,z[12]=0,z[13]=0,z[14]=0,z[15]=1,W.markAsUpdated(),W}static RotationAlignToRef(V,p,W){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=l.Dot(p,V),z=W.Ej;if(E<-1+N.c)z[0]=-1,z[1]=0,z[2]=0,z[3]=0,z[4]=0,z[5]=d?1:-1,z[6]=0,z[7]=0,z[8]=0,z[9]=0,z[10]=d?-1:1,z[11]=0;else{const W=l.Cross(p,V),N=1/(1+E);z[0]=W._x*W._x*N+E,z[1]=W._y*W._x*N-W._z,z[2]=W._z*W._x*N+W._y,z[3]=0,z[4]=W._x*W._y*N+W._z,z[5]=W._y*W._y*N+E,z[6]=W._z*W._y*N-W._x,z[7]=0,z[8]=W._x*W._z*N-W._y,z[9]=W._y*W._z*N+W._x,z[10]=W._z*W._z*N+E,z[11]=0}return z[12]=0,z[13]=0,z[14]=0,z[15]=1,W.markAsUpdated(),W}static RotationYawPitchRoll(V,p,W){const N=new u;return u.RotationYawPitchRollToRef(V,p,W,N),N}static RotationYawPitchRollToRef(V,p,W,N){return k.RotationYawPitchRollToRef(V,p,W,f.Quaternion[0]),f.Quaternion[0].toRotationMatrix(N),N}static Scaling(V,p,W){const N=new u;return u.ScalingToRef(V,p,W,N),N}static ScalingToRef(V,p,W,N){return u.FromValuesToRef(V,0,0,0,0,p,0,0,0,0,W,0,0,0,0,1,N),N._updateIdentityStatus(1===V&&1===p&&1===W),N}static Translation(V,p,W){const N=new u;return u.TranslationToRef(V,p,W,N),N}static TranslationToRef(V,p,W,N){return u.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,V,p,W,1,N),N._updateIdentityStatus(0===V&&0===p&&0===W),N}static Lerp(V,p,W){const N=new u;return u.LerpToRef(V,p,W,N),N}static LerpToRef(V,p,W,N){const d=N.Ej,E=V.m,z=p.m;for(let S=0;S<16;S++)d[S]=E[S]*(1-W)+z[S]*W;return N.markAsUpdated(),N}static DecomposeLerp(V,p,W){const N=new u;return u.DecomposeLerpToRef(V,p,W,N),N}static DecomposeLerpToRef(V,p,W,N){const d=f.fb[0],E=f.Quaternion[0],z=f.fb[1];V.decompose(d,E,z);const S=f.fb[2],Q=f.Quaternion[1],J=f.fb[3];p.decompose(S,Q,J);const i=f.fb[4];l.LerpToRef(d,S,W,i);const j=f.Quaternion[2];k.SlerpToRef(E,Q,W,j);const O=f.fb[5];return l.LerpToRef(z,J,W,O),u.ComposeToRef(i,j,O,N),N}static LookAtLH(V,p,W){const N=new u;return u.LookAtLHToRef(V,p,W,N),N}static LookAtLHToRef(V,p,W,N){const d=f.fb[0],E=f.fb[1],z=f.fb[2];p.subtractToRef(V,z),z.normalize(),l.CrossToRef(W,z,d);const S=d.lengthSquared();0===S?d.x=1:d.normalizeFromLength(Math.sqrt(S)),l.CrossToRef(z,d,E),E.normalize();const Q=-l.Dot(d,V),J=-l.Dot(E,V),i=-l.Dot(z,V);return u.FromValuesToRef(d._x,E._x,z._x,0,d._y,E._y,z._y,0,d._z,E._z,z._z,0,Q,J,i,1,N),N}static LookAtRH(V,p,W){const N=new u;return u.LookAtRHToRef(V,p,W,N),N}static LookAtRHToRef(V,p,W,N){const d=f.fb[0],E=f.fb[1],z=f.fb[2];V.subtractToRef(p,z),z.normalize(),l.CrossToRef(W,z,d);const S=d.lengthSquared();0===S?d.x=1:d.normalizeFromLength(Math.sqrt(S)),l.CrossToRef(z,d,E),E.normalize();const Q=-l.Dot(d,V),J=-l.Dot(E,V),i=-l.Dot(z,V);return u.FromValuesToRef(d._x,E._x,z._x,0,d._y,E._y,z._y,0,d._z,E._z,z._z,0,Q,J,i,1,N),N}static LookDirectionLH(V,p){const W=new u;return u.LookDirectionLHToRef(V,p,W),W}static LookDirectionLHToRef(V,p,W){const N=f.fb[0];N.p(V),N.scaleInPlace(-1);const d=f.fb[1];return l.CrossToRef(p,N,d),u.FromValuesToRef(d._x,d._y,d._z,0,p._x,p._y,p._z,0,N._x,N._y,N._z,0,0,0,0,1,W),W}static LookDirectionRH(V,p){const W=new u;return u.LookDirectionRHToRef(V,p,W),W}static LookDirectionRHToRef(V,p,W){const N=f.fb[2];return l.CrossToRef(p,V,N),u.FromValuesToRef(N._x,N._y,N._z,0,p._x,p._y,p._z,0,V._x,V._y,V._z,0,0,0,0,1,W),W}static OrthoLH(V,p,W,N,d){const E=new u;return u.OrthoLHToRef(V,p,W,N,E,d),E}static OrthoLHToRef(V,p,W,N,d,E){const z=2/V,S=2/p,Q=2/(N-W),J=-(N+W)/(N-W);return u.FromValuesToRef(z,0,0,0,0,S,0,0,0,0,Q,0,0,0,J,1,d),E&&d.multiplyToRef(U,d),d._updateIdentityStatus(1===z&&1===S&&1===Q&&0===J),d}static OrthoOffCenterLH(V,p,W,N,d,E,z){const S=new u;return u.OrthoOffCenterLHToRef(V,p,W,N,d,E,S,z),S}static OrthoOffCenterLHToRef(V,p,W,N,d,E,z,S){const Q=2/(p-V),J=2/(N-W),i=2/(E-d),l=-(E+d)/(E-d),j=(V+p)/(V-p),k=(N+W)/(W-N);return u.FromValuesToRef(Q,0,0,0,0,J,0,0,0,0,i,0,j,k,l,1,z),S&&z.multiplyToRef(U,z),z.markAsUpdated(),z}static ObliqueOffCenterLHToRef(V,p,W,N,d,E,z,S,Q,J,i){const l=-z*Math.cos(S),j=-z*Math.sin(S);return u.TranslationToRef(0,0,-Q,f.Matrix[1]),u.FromValuesToRef(1,0,0,0,0,1,0,0,l,j,1,0,0,0,0,1,f.Matrix[0]),f.Matrix[1].multiplyToRef(f.Matrix[0],f.Matrix[0]),u.TranslationToRef(0,0,Q,f.Matrix[1]),f.Matrix[0].multiplyToRef(f.Matrix[1],f.Matrix[0]),u.OrthoOffCenterLHToRef(V,p,W,N,d,E,J,i),f.Matrix[0].multiplyToRef(J,J),J}static OrthoOffCenterRH(V,p,W,N,d,E,z){const S=new u;return u.OrthoOffCenterRHToRef(V,p,W,N,d,E,S,z),S}static OrthoOffCenterRHToRef(V,p,W,N,d,E,z,S){return u.OrthoOffCenterLHToRef(V,p,W,N,d,E,z,S),z.Ej[10]*=-1,z}static ObliqueOffCenterRHToRef(V,p,W,N,d,E,z,S,Q,J,i){const l=z*Math.cos(S),j=z*Math.sin(S);return u.TranslationToRef(0,0,Q,f.Matrix[1]),u.FromValuesToRef(1,0,0,0,0,1,0,0,l,j,1,0,0,0,0,1,f.Matrix[0]),f.Matrix[1].multiplyToRef(f.Matrix[0],f.Matrix[0]),u.TranslationToRef(0,0,-Q,f.Matrix[1]),f.Matrix[0].multiplyToRef(f.Matrix[1],f.Matrix[0]),u.OrthoOffCenterRHToRef(V,p,W,N,d,E,J,i),f.Matrix[0].multiplyToRef(J,J),J}static PerspectiveLH(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const z=new u,S=2*W/V,Q=2*W/p,J=(N+W)/(N-W),i=-2*N*W/(N-W),l=Math.tan(E);return u.FromValuesToRef(S,0,0,0,0,Q,0,l,0,0,J,1,0,0,i,0,z),d&&z.multiplyToRef(U,z),z._updateIdentityStatus(!1),z}static PerspectiveFovLH(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,z=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const S=new u;return u.PerspectiveFovLHToRef(V,p,W,N,S,!0,d,E,z),S}static PerspectiveFovLHToRef(V,p,W,N,d){let E=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],z=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,Q=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const J=W,i=N,l=1/Math.tan(.5*V),j=E?l/p:l,k=E?l:l*p,f=Q&&0===J?-1:0!==i?(i+J)/(i-J):1,O=Q&&0===J?2*i:0!==i?-2*i*J/(i-J):-2*J,F=Math.tan(S);return u.FromValuesToRef(j,0,0,0,0,k,0,F,0,0,f,1,0,0,O,0,d),z&&d.multiplyToRef(U,d),d._updateIdentityStatus(!1),d}static PerspectiveFovReverseLHToRef(V,p,W,N,d){let E=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],z=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const Q=1/Math.tan(.5*V),J=E?Q/p:Q,i=E?Q:Q*p,l=Math.tan(S);return u.FromValuesToRef(J,0,0,0,0,i,0,l,0,0,-W,1,0,0,1,0,d),z&&d.multiplyToRef(U,d),d._updateIdentityStatus(!1),d}static PerspectiveFovRH(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,z=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const S=new u;return u.PerspectiveFovRHToRef(V,p,W,N,S,!0,d,E,z),S}static PerspectiveFovRHToRef(V,p,W,N,d){let E=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],z=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,Q=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const J=W,i=N,l=1/Math.tan(.5*V),j=E?l/p:l,k=E?l:l*p,f=Q&&0===J?1:0!==i?-(i+J)/(i-J):-1,O=Q&&0===J?2*i:0!==i?-2*i*J/(i-J):-2*J,F=Math.tan(S);return u.FromValuesToRef(j,0,0,0,0,k,0,F,0,0,f,-1,0,0,O,0,d),z&&d.multiplyToRef(U,d),d._updateIdentityStatus(!1),d}static PerspectiveFovReverseRHToRef(V,p,W,N,d){let E=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],z=arguments.length>6?arguments[6]:void 0,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const Q=1/Math.tan(.5*V),J=E?Q/p:Q,i=E?Q:Q*p,l=Math.tan(S);return u.FromValuesToRef(J,0,0,0,0,i,0,l,0,0,-W,-1,0,0,-1,0,d),z&&d.multiplyToRef(U,d),d._updateIdentityStatus(!1),d}static GetFinalMatrix(V,p,W,N,d,E){const z=V.width,S=V.height,Q=V.x,J=V.y,i=u.FromValues(z/2,0,0,0,0,-S/2,0,0,0,0,E-d,0,Q+z/2,S/2+J,d,1),l=new u;return p.multiplyToRef(W,l),l.multiplyToRef(N,l),l.multiplyToRef(i,l)}static GetAsMatrix2x2(V){const p=V.m,W=[p[0],p[1],p[4],p[5]];return z.d.MatrixUse64Bits?W:new Float32Array(W)}static GetAsMatrix3x3(V){const p=V.m,W=[p[0],p[1],p[2],p[4],p[5],p[6],p[8],p[9],p[10]];return z.d.MatrixUse64Bits?W:new Float32Array(W)}static Transpose(V){const p=new u;return u.TransposeToRef(V,p),p}static TransposeToRef(V,p){const W=V.m,N=W[0],d=W[4],E=W[8],z=W[12],S=W[1],Q=W[5],J=W[9],i=W[13],l=W[2],j=W[6],k=W[10],u=W[14],f=W[3],O=W[7],U=W[11],F=W[15],C=p.Ej;return C[0]=N,C[1]=d,C[2]=E,C[3]=z,C[4]=S,C[5]=Q,C[6]=J,C[7]=i,C[8]=l,C[9]=j,C[10]=k,C[11]=u,C[12]=f,C[13]=O,C[14]=U,C[15]=F,p.markAsUpdated(),p._updateIdentityStatus(V._isIdentity,V._isIdentityDirty),p}static Reflection(V){const p=new u;return u.ReflectionToRef(V,p),p}static ReflectionToRef(V,p){V.normalize();const W=V.k.x,N=V.k.y,d=V.k.z,E=-2*W,z=-2*N,S=-2*d;return u.FromValuesToRef(E*W+1,z*W,S*W,0,E*N,z*N+1,S*N,0,E*d,z*d,S*d+1,0,E*V.d,z*V.d,S*V.d,1,p),p}static FromXYZAxesToRef(V,p,W,N){return u.FromValuesToRef(V._x,V._y,V._z,0,p._x,p._y,p._z,0,W._x,W._y,W._z,0,0,0,0,1,N),N}static FromQuaternionToRef(V,p){const W=V._x*V._x,N=V._y*V._y,d=V._z*V._z,E=V._x*V._y,z=V._z*V._w,S=V._z*V._x,Q=V._y*V._w,J=V._y*V._z,i=V._x*V._w;return p.Ej[0]=1-2*(N+d),p.Ej[1]=2*(E+z),p.Ej[2]=2*(S-Q),p.Ej[3]=0,p.Ej[4]=2*(E-z),p.Ej[5]=1-2*(d+W),p.Ej[6]=2*(J+i),p.Ej[7]=0,p.Ej[8]=2*(S+Q),p.Ej[9]=2*(J-i),p.Ej[10]=1-2*(N+W),p.Ej[11]=0,p.Ej[12]=0,p.Ej[13]=0,p.Ej[14]=0,p.Ej[15]=1,p.markAsUpdated(),p}}u._UpdateFlagSeed=0,u._IdentityReadOnly=u.Identity(),Object.defineProperties(u.prototype,{dimension:{value:[4,4]},rank:{value:2}});class f{}f.fb=(0,d.f)(11,l.Zero),f.Matrix=(0,d.f)(2,u.Identity),f.Quaternion=(0,d.f)(3,k.Zero);class O{}O.Vector2=(0,d.f)(3,i.Zero),O.fb=(0,d.f)(13,l.Zero),O.Vector4=(0,d.f)(3,j.Zero),O.Quaternion=(0,d.f)(3,k.Zero),O.Matrix=(0,d.f)(8,u.Identity),(0,E.d)("BABYLON.Vector2",i),(0,E.d)("BABYLON.Vector3",l),(0,E.d)("BABYLON.Vector4",j),(0,E.d)("BABYLON.Matrix",u);const U=u.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11538:(V,p,W)=>{"use strict";W.d(p,{d:()=>N});class N{constructor(V,p,W,N){this.x=V,this.y=p,this.width=W,this.height=N}toGlobal(V,p){return new N(this.x*V,this.y*p,this.width*V,this.height*p)}toGlobalToRef(V,p,W){return W.x=this.x*V,W.y=this.y*p,W.width=this.width*V,W.height=this.height*p,this}clone(){return new N(this.x,this.y,this.width,this.height)}}},11757:(V,p,W)=>{"use strict";W.d(p,{e:()=>J,i:()=>i});var N=W(11218),d=W(11762);const E=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],z=[()=>1,V=>V.y,V=>V.z,V=>V.x,V=>V.x*V.y,V=>V.y*V.z,V=>3*V.z*V.z-1,V=>V.x*V.z,V=>V.x*V.x-V.y*V.y],S=(V,p)=>E[V]*z[V](p),Q=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class J{constructor(){this.preScaled=!1,this.l00=N.n.Zero(),this.l1_1=N.n.Zero(),this.l10=N.n.Zero(),this.l11=N.n.Zero(),this.l2_2=N.n.Zero(),this.l2_1=N.n.Zero(),this.l20=N.n.Zero(),this.l21=N.n.Zero(),this.l22=N.n.Zero()}addLight(V,p,W){d.b.fb[0].set(p.r,p.g,p.b);const N=d.b.fb[0],E=d.b.fb[1];N.scaleToRef(W,E),E.scaleToRef(S(0,V),d.b.fb[2]),this.l00.addInPlace(d.b.fb[2]),E.scaleToRef(S(1,V),d.b.fb[2]),this.l1_1.addInPlace(d.b.fb[2]),E.scaleToRef(S(2,V),d.b.fb[2]),this.l10.addInPlace(d.b.fb[2]),E.scaleToRef(S(3,V),d.b.fb[2]),this.l11.addInPlace(d.b.fb[2]),E.scaleToRef(S(4,V),d.b.fb[2]),this.l2_2.addInPlace(d.b.fb[2]),E.scaleToRef(S(5,V),d.b.fb[2]),this.l2_1.addInPlace(d.b.fb[2]),E.scaleToRef(S(6,V),d.b.fb[2]),this.l20.addInPlace(d.b.fb[2]),E.scaleToRef(S(7,V),d.b.fb[2]),this.l21.addInPlace(d.b.fb[2]),E.scaleToRef(S(8,V),d.b.fb[2]),this.l22.addInPlace(d.b.fb[2])}scaleInPlace(V){this.l00.scaleInPlace(V),this.l1_1.scaleInPlace(V),this.l10.scaleInPlace(V),this.l11.scaleInPlace(V),this.l2_2.scaleInPlace(V),this.l2_1.scaleInPlace(V),this.l20.scaleInPlace(V),this.l21.scaleInPlace(V),this.l22.scaleInPlace(V)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(Q[0]),this.l1_1.scaleInPlace(Q[1]),this.l10.scaleInPlace(Q[2]),this.l11.scaleInPlace(Q[3]),this.l2_2.scaleInPlace(Q[4]),this.l2_1.scaleInPlace(Q[5]),this.l20.scaleInPlace(Q[6]),this.l21.scaleInPlace(Q[7]),this.l22.scaleInPlace(Q[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(E[0]),this.l1_1.scaleInPlace(E[1]),this.l10.scaleInPlace(E[2]),this.l11.scaleInPlace(E[3]),this.l2_2.scaleInPlace(E[4]),this.l2_1.scaleInPlace(E[5]),this.l20.scaleInPlace(E[6]),this.l21.scaleInPlace(E[7]),this.l22.scaleInPlace(E[8])}updateFromArray(V){return N.n.FromArrayToRef(V[0],0,this.l00),N.n.FromArrayToRef(V[1],0,this.l1_1),N.n.FromArrayToRef(V[2],0,this.l10),N.n.FromArrayToRef(V[3],0,this.l11),N.n.FromArrayToRef(V[4],0,this.l2_2),N.n.FromArrayToRef(V[5],0,this.l2_1),N.n.FromArrayToRef(V[6],0,this.l20),N.n.FromArrayToRef(V[7],0,this.l21),N.n.FromArrayToRef(V[8],0,this.l22),this}updateFromFloatsArray(V){return N.n.FromFloatsToRef(V[0],V[1],V[2],this.l00),N.n.FromFloatsToRef(V[3],V[4],V[5],this.l1_1),N.n.FromFloatsToRef(V[6],V[7],V[8],this.l10),N.n.FromFloatsToRef(V[9],V[10],V[11],this.l11),N.n.FromFloatsToRef(V[12],V[13],V[14],this.l2_2),N.n.FromFloatsToRef(V[15],V[16],V[17],this.l2_1),N.n.FromFloatsToRef(V[18],V[19],V[20],this.l20),N.n.FromFloatsToRef(V[21],V[22],V[23],this.l21),N.n.FromFloatsToRef(V[24],V[25],V[26],this.l22),this}static Tg(V){return(new J).updateFromArray(V)}static FromPolynomial(V){const p=new J;return p.l00=V.xx.scale(.376127).add(V.yy.scale(.376127)).add(V.zz.scale(.376126)),p.l1_1=V.y.scale(.977204),p.l10=V.z.scale(.977204),p.l11=V.x.scale(.977204),p.l2_2=V.xy.scale(1.16538),p.l2_1=V.yz.scale(1.16538),p.l20=V.zz.scale(1.34567).ed(V.xx.scale(.672834)).ed(V.yy.scale(.672834)),p.l21=V.zx.scale(1.16538),p.l22=V.xx.scale(1.16538).ed(V.yy.scale(1.16538)),p.l1_1.scaleInPlace(-1),p.l11.scaleInPlace(-1),p.l2_1.scaleInPlace(-1),p.l21.scaleInPlace(-1),p.scaleInPlace(Math.PI),p}}class i{constructor(){this.x=N.n.Zero(),this.y=N.n.Zero(),this.z=N.n.Zero(),this.xx=N.n.Zero(),this.yy=N.n.Zero(),this.zz=N.n.Zero(),this.xy=N.n.Zero(),this.yz=N.n.Zero(),this.zx=N.n.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=J.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(V){d.b.fb[0].ge(V.r,V.g,V.b);const p=d.b.fb[0];this.xx.addInPlace(p),this.yy.addInPlace(p),this.zz.addInPlace(p)}scaleInPlace(V){this.x.scaleInPlace(V),this.y.scaleInPlace(V),this.z.scaleInPlace(V),this.xx.scaleInPlace(V),this.yy.scaleInPlace(V),this.zz.scaleInPlace(V),this.yz.scaleInPlace(V),this.zx.scaleInPlace(V),this.xy.scaleInPlace(V)}updateFromHarmonics(V){return this._harmonics=V,this.x.p(V.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(V.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(V.l10),this.z.scaleInPlace(1.02333),this.xx.p(V.l00),d.b.fb[0].p(V.l20).scaleInPlace(.247708),d.b.fb[1].p(V.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).ei(d.b.fb[0]).addInPlace(d.b.fb[1]),this.yy.p(V.l00),this.yy.scaleInPlace(.886277).ei(d.b.fb[0]).ei(d.b.fb[1]),this.zz.p(V.l00),d.b.fb[0].p(V.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(d.b.fb[0]),this.yz.p(V.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(V.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(V.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(V){return(new i).updateFromHarmonics(V)}static Tg(V){const p=new i;return N.n.FromArrayToRef(V[0],0,p.x),N.n.FromArrayToRef(V[1],0,p.y),N.n.FromArrayToRef(V[2],0,p.z),N.n.FromArrayToRef(V[3],0,p.xx),N.n.FromArrayToRef(V[4],0,p.yy),N.n.FromArrayToRef(V[5],0,p.zz),N.n.FromArrayToRef(V[6],0,p.yz),N.n.FromArrayToRef(V[7],0,p.zx),N.n.FromArrayToRef(V[8],0,p.xy),p}}},11591:(V,p,W)=>{"use strict";W.d(p,{d:()=>J});var N=W(11218),d=W(11257),E=W(11510),z=W(11544),S=W(11467);W(11600);function Q(V){let p=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const W=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],E=[];let Q=[];const J=V.width||V.size||1,i=V.height||V.size||1,l=V.depth||V.size||1,j=V.wrap||!1;let k=void 0===V.topBaseAt?1:V.topBaseAt,u=void 0===V.bottomBaseAt?0:V.bottomBaseAt;k=(k+4)%4,u=(u+4)%4;let f=[2,0,3,1][k],O=[2,0,1,3][u],U=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(j){p=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],U=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let V=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],W=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const N=[17,18,19,16],d=[22,23,20,21];for(;f>0;)V.unshift(V.pop()),N.unshift(N.pop()),f--;for(;O>0;)W.unshift(W.pop()),d.unshift(d.pop()),O--;V=V.flat(),W=W.flat(),U=U.concat(V).concat(W),p.push(N[0],N[2],N[3],N[0],N[1],N[2]),p.push(d[0],d[2],d[3],d[0],d[1],d[2])}const F=[J/2,i/2,l/2];Q=U.reduce(((V,p,W)=>V.concat(p*F[W%3])),[]);const C=0===V.sideOrientation?0:V.sideOrientation||z.b.DEFAULTSIDE,A=V.faceUV||new Array(6),v=V.faceColors,t=[];for(let z=0;z<6;z++)void 0===A[z]&&(A[z]=new N.q(0,0,1,1)),v&&void 0===v[z]&&(v[z]=new d.e(1,1,1,1));for(let N=0;N<6;N++)if(E.push(A[N].z,S.d?1-A[N].w:A[N].w),E.push(A[N].x,S.d?1-A[N].w:A[N].w),E.push(A[N].x,S.d?1-A[N].y:A[N].y),E.push(A[N].z,S.d?1-A[N].y:A[N].y),v)for(let V=0;V<4;V++)t.push(v[N].r,v[N].g,v[N].b,v[N].a);z.b._ComputeSides(C,Q,p,W,E,V.frontUVs,V.backUVs);const e=new z.b;if(e.indices=p,e.xa=Q,e.ya=W,e.Aa=E,v){const V=C===z.b.DOUBLESIDE?t.concat(t):t;e.za=V}return e}function J(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new E.e(V,W);p.sideOrientation=E.e._GetDefaultSideOrientation(p.sideOrientation),N._originalBuilderSideOrientation=p.sideOrientation;return Q(p).Ca(N,p.updatable),N}z.b.CreateBox=Q,E.e.CreateBox=function(V,p){return J(V,{size:p,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11899:(V,p,W)=>{"use strict";W.d(p,{c:()=>S});var N=W(11510),d=W(11544),E=W(11467);function z(V){const p=[],W=[],N=[],z=[],S=V.radius||.5,Q=V.tessellation||64,J=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,i=0===V.sideOrientation?0:V.sideOrientation||d.b.DEFAULTSIDE;p.push(0,0,0),z.push(.5,.5);const l=2*Math.PI*J,j=1===J?l/Q:l/(Q-1);let k=0;for(let d=0;d<Q;d++){const V=Math.cos(k),W=Math.sin(k),N=(V+1)/2,d=(1-W)/2;p.push(S*V,S*W,0),z.push(N,E.d?1-d:d),k+=j}1===J&&(p.push(p[3],p[4],p[5]),z.push(z[2],E.d?1-z[3]:z[3]));const u=p.length/3;for(let d=1;d<u-1;d++)W.push(d+1,0,d);d.b.ComputeNormals(p,W,N),d.b._ComputeSides(i,p,W,N,z,V.frontUVs,V.backUVs);const f=new d.b;return f.indices=W,f.xa=p,f.ya=N,f.Aa=z,f}function S(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new N.e(V,W);p.sideOrientation=N.e._GetDefaultSideOrientation(p.sideOrientation),d._originalBuilderSideOrientation=p.sideOrientation;return z(p).Ca(d,p.updatable),d}d.b.CreateDisc=z,N.e.CreateDisc=function(V,p,W){return S(V,{radius:p,tessellation:W,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11600:(V,p,W)=>{"use strict";W.d(p,{f:()=>O,d:()=>F,j:()=>U});var N=W(11218),d=W(11257),E=W(11510),z=W(11544),S=W(11291);E.e._GroundMeshParser=(V,p)=>Q.Parse(V,p);class Q extends E.e{constructor(V,p){super(V,p),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=V,this._subdivisionsY=V,this.subdivide(V);const W=this;W.createOrUpdateSubmeshesOctree&&W.createOrUpdateSubmeshesOctree(p)}getHeightAtCoordinates(V,p){const W=this.getWorldMatrix(),d=N.i.Matrix[5];W.invertToRef(d);const E=N.i.fb[8];if(N.n.TransformCoordinatesFromFloatsToRef(V,0,p,d,E),V=E.x,p=E.z,V<this._minX||V>=this._maxX||p<=this._minZ||p>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const z=this._getFacetAt(V,p),S=-(z.x*V+z.z*p+z.w)/z.y;return N.n.TransformCoordinatesFromFloatsToRef(0,S,0,W,E),E.y}getNormalAtCoordinates(V,p){const W=new N.n(0,1,0);return this.getNormalAtCoordinatesToRef(V,p,W),W}getNormalAtCoordinatesToRef(V,p,W){const d=this.getWorldMatrix(),E=N.i.Matrix[5];d.invertToRef(E);const z=N.i.fb[8];if(N.n.TransformCoordinatesFromFloatsToRef(V,0,p,E,z),V=z.x,p=z.z,V<this._minX||V>this._maxX||p<this._minZ||p>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const S=this._getFacetAt(V,p);return N.n.TransformNormalFromFloatsToRef(S.x,S.y,S.z,d,W),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(V,p){const W=Math.floor((V+this._maxX)*this._subdivisionsX/this._width),N=Math.floor(-(p+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),d=this._heightQuads[N*this._subdivisionsX+W];let E;return E=p<d.slope.x*V+d.slope.y?d.facet1:d.facet2,E}_initHeightQuads(){const V=this._subdivisionsX,p=this._subdivisionsY;this._heightQuads=new Array;for(let W=0;W<p;W++)for(let p=0;p<V;p++){const d={slope:N.k.Zero(),facet1:new N.q(0,0,0,0),facet2:new N.q(0,0,0,0)};this._heightQuads[W*V+p]=d}return this}_computeHeightQuads(){const V=this.getVerticesData(S.f.PositionKind);if(!V)return this;const p=N.i.fb[3],W=N.i.fb[2],d=N.i.fb[1],E=N.i.fb[0],z=N.i.fb[4],Q=N.i.fb[5],J=N.i.fb[6],i=N.i.fb[7],l=N.i.fb[8];let j=0,k=0,u=0,f=0,O=0,U=0,F=0;const C=this._subdivisionsX,A=this._subdivisionsY;for(let S=0;S<A;S++)for(let A=0;A<C;A++){j=3*A,k=S*(C+1)*3,u=(S+1)*(C+1)*3,p.x=V[k+j],p.y=V[k+j+1],p.z=V[k+j+2],W.x=V[k+j+3],W.y=V[k+j+4],W.z=V[k+j+5],d.x=V[u+j],d.y=V[u+j+1],d.z=V[u+j+2],E.x=V[u+j+3],E.y=V[u+j+4],E.z=V[u+j+5],f=(E.z-p.z)/(E.x-p.x),O=p.z-f*p.x,W.subtractToRef(p,z),d.subtractToRef(p,Q),E.subtractToRef(p,J),N.n.CrossToRef(J,Q,i),N.n.CrossToRef(z,J,l),i.normalize(),l.normalize(),U=-(i.x*p.x+i.y*p.y+i.z*p.z),F=-(l.x*W.x+l.y*W.y+l.z*W.z);const v=this._heightQuads[S*C+A];v.slope.ge(f,O),v.facet1.ge(i.x,i.y,i.z,U),v.facet2.ge(l.x,l.y,l.z,F)}return this}serialize(V){super.serialize(V),V.subdivisionsX=this._subdivisionsX,V.subdivisionsY=this._subdivisionsY,V.minX=this._minX,V.maxX=this._maxX,V.Li=this._minZ,V.maxZ=this._maxZ,V.width=this._width,V.height=this._height}static Parse(V,p){const W=new Q(V.name,p);return W._subdivisionsX=V.subdivisionsX||1,W._subdivisionsY=V.subdivisionsY||1,W._minX=V.minX,W._maxX=V.maxX,W._minZ=V.Li,W._maxZ=V.maxZ,W._width=V.width,W._height=V.height,W}}var J=W(10848),i=W(10900),l=W(11224),j=W(11467);function k(V){const p=[],W=[],d=[],E=[];let S,Q;const J=V.width||V.size||1,i=V.height||V.size||1,l=0|(V.subdivisionsX||V.subdivisions||1),k=0|(V.subdivisionsY||V.subdivisions||1);for(S=0;S<=k;S++)for(Q=0;Q<=l;Q++){const V=new N.n(Q*J/l-J/2,0,(k-S)*i/k-i/2),p=new N.n(0,1,0);W.push(V.x,V.y,V.z),d.push(p.x,p.y,p.z),E.push(Q/l,j.d?S/k:1-S/k)}for(S=0;S<k;S++)for(Q=0;Q<l;Q++)p.push(Q+1+(S+1)*(l+1)),p.push(Q+1+S*(l+1)),p.push(Q+S*(l+1)),p.push(Q+(S+1)*(l+1)),p.push(Q+1+(S+1)*(l+1)),p.push(Q+S*(l+1));const u=new z.b;return u.indices=p,u.xa=W,u.ya=d,u.Aa=E,u}function u(V){const p=void 0!==V.xmin&&null!==V.xmin?V.xmin:-1,W=void 0!==V.zmin&&null!==V.zmin?V.zmin:-1,d=void 0!==V.xmax&&null!==V.xmax?V.xmax:1,E=void 0!==V.zmax&&null!==V.zmax?V.zmax:1,S=V.subdivisions||{w:1,h:1},Q=V.precision||{w:1,h:1},J=[],i=[],l=[],j=[];let k,u,f,O;S.h=S.h<1?1:S.h,S.w=S.w<1?1:S.w,Q.w=Q.w<1?1:Q.w,Q.h=Q.h<1?1:Q.h;const U=(d-p)/S.w,F=(E-W)/S.h;function C(V,p,W,d){const E=i.length/3,z=Q.w+1;for(k=0;k<Q.h;k++)for(u=0;u<Q.w;u++){const V=[E+u+k*z,E+(u+1)+k*z,E+(u+1)+(k+1)*z,E+u+(k+1)*z];J.push(V[1]),J.push(V[2]),J.push(V[3]),J.push(V[0]),J.push(V[1]),J.push(V[3])}const S=N.n.Zero(),f=new N.n(0,1,0);for(k=0;k<=Q.h;k++)for(S.z=k*(d-p)/Q.h+p,u=0;u<=Q.w;u++)S.x=u*(W-V)/Q.w+V,S.y=0,i.push(S.x,S.y,S.z),l.push(f.x,f.y,f.z),j.push(u/Q.w,k/Q.h)}for(f=0;f<S.h;f++)for(O=0;O<S.w;O++)C(p+O*U,W+f*F,p+(O+1)*U,W+(f+1)*F);const A=new z.b;return A.indices=J,A.xa=i,A.ya=l,A.Aa=j,A}function f(V){const p=[],W=[],E=[],S=[];let Q,J;const i=V.colorFilter||new d.c(.3,.59,.11),j=V.alphaFilter||0;let k=!1;if(V.minHeight>V.maxHeight){k=!0;const p=V.maxHeight;V.maxHeight=V.minHeight,V.minHeight=p}for(Q=0;Q<=V.subdivisions;Q++)for(J=0;J<=V.subdivisions;J++){const p=new N.n(J*V.width/V.subdivisions-V.width/2,0,(V.subdivisions-Q)*V.height/V.subdivisions-V.height/2),d=4*(((p.x+V.width/2)/V.width*(V.bufferWidth-1)|0)+((1-(p.z+V.height/2)/V.height)*(V.bufferHeight-1)|0)*V.bufferWidth);let z=V.buffer[d]/255,u=V.buffer[d+1]/255,f=V.buffer[d+2]/255;const O=V.buffer[d+3]/255;k&&(z=1-z,u=1-u,f=1-f);const U=z*i.r+u*i.g+f*i.b;p.y=O>=j?V.minHeight+(V.maxHeight-V.minHeight)*U:V.minHeight-l.c,V.heightBuffer&&(V.heightBuffer[Q*(V.subdivisions+1)+J]=p.y),W.push(p.x,p.y,p.z),E.push(0,0,0),S.push(J/V.subdivisions,1-Q/V.subdivisions)}for(Q=0;Q<V.subdivisions;Q++)for(J=0;J<V.subdivisions;J++){const N=J+1+(Q+1)*(V.subdivisions+1),d=J+1+Q*(V.subdivisions+1),E=J+Q*(V.subdivisions+1),z=J+(Q+1)*(V.subdivisions+1),S=W[3*N+1]>=V.minHeight,i=W[3*d+1]>=V.minHeight,l=W[3*E+1]>=V.minHeight;S&&i&&l&&(p.push(N),p.push(d),p.push(E));W[3*z+1]>=V.minHeight&&S&&l&&(p.push(z),p.push(N),p.push(E))}z.b.ComputeNormals(W,p,E);const u=new z.b;return u.indices=p,u.xa=W,u.ya=E,u.Aa=S,u}function O(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const W=new Q(V,arguments.length>2?arguments[2]:void 0);W._setReady(!1),W._subdivisionsX=p.subdivisionsX||p.subdivisions||1,W._subdivisionsY=p.subdivisionsY||p.subdivisions||1,W._width=p.width||1,W._height=p.height||1,W._maxX=W._width/2,W._maxZ=W._height/2,W._minX=-W._maxX,W._minZ=-W._maxZ;return k(p).Ca(W,p.updatable),W._setReady(!0),W}function U(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new E.e(V,W);return u(p).Ca(N,p.updatable),N}function F(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const E=W.width||10,z=W.height||10,S=W.subdivisions||1,l=W.minHeight||0,j=W.maxHeight||1,k=W.colorFilter||new d.c(.3,.59,.11),u=W.alphaFilter||0,O=W.updatable,U=W.onReady;N=N||i.d.LastCreatedScene;const F=new Q(V,N);let C;F._subdivisionsX=S,F._subdivisionsY=S,F._width=E,F._height=z,F._maxX=F._width/2,F._maxZ=F._height/2,F._minX=-F._maxX,F._minZ=-F._maxZ,F._setReady(!1),W.passHeightBufferInCallback&&(C=new Float32Array((S+1)*(S+1)));const A=(V,p,W)=>{f({width:E,height:z,subdivisions:S,minHeight:l,maxHeight:j,colorFilter:k,buffer:V,bufferWidth:p,bufferHeight:W,alphaFilter:u,heightBuffer:C}).Ca(F,O),U&&U(F,C),F._setReady(!0)};if("string"===typeof p){const V=V=>{var p;const W=V.width,d=V.height;if(N.u)return;const E=null===(p=N)||void 0===p?void 0:p.getEngine().resizeImageBitmap(V,W,d);A(E,W,d)};J.e.LoadImage(p,V,W.onError?W.onError:()=>{},N.offlineProvider)}else A(p.data,p.width,p.height);return F}z.b.CreateGround=k,z.b.CreateTiledGround=u,z.b.CreateGroundFromHeightMap=f,E.e.CreateGround=(V,p,W,N,d,E)=>O(V,{width:p,height:W,subdivisions:N,updatable:E},d),E.e.CreateTiledGround=(V,p,W,N,d,E,z,S,Q)=>U(V,{xmin:p,zmin:W,xmax:N,zmax:d,subdivisions:E,precision:z,updatable:Q},S),E.e.CreateGroundFromHeightMap=(V,p,W,N,d,E,z,S,Q,J,i)=>F(V,p,{width:W,height:N,subdivisions:d,minHeight:E,maxHeight:z,updatable:Q,onReady:J,alphaFilter:i},S)},12981:(V,p,W)=>{"use strict";W.d(p,{c:()=>x,f:()=>h,g:()=>L});var N=W(11218),d=W(11510),E=W(11544),z=W(11257),S=W(11291),Q=W(12535),J=W(11387),i=W(11265),l=W(11200),j=W(11452),k=W(11004),u=W(11479),f=W(10893),O=W(11445),U=W(10900),F=W(11436),C=W(11434);const A={effect:null,subMesh:null};class v extends O.b{constructor(V,p,W){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(V,p,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new N.e,this._cachedWorldViewProjectionMatrix=new N.e,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=W,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","k","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...d}}get shaderPath(){return this._shaderPath}set shaderPath(V){this._shaderPath=V}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(V){-1===this._options.uniforms.indexOf(V)&&this._options.uniforms.push(V)}setTexture(V,p){return-1===this._options.samplers.indexOf(V)&&this._options.samplers.push(V),this._textures[V]=p,this}removeTexture(V){delete this._textures[V]}setTextureArray(V,p){return-1===this._options.samplers.indexOf(V)&&this._options.samplers.push(V),this._checkUniform(V),this._textureArrays[V]=p,this}setExternalTexture(V,p){return-1===this._options.externalTextures.indexOf(V)&&this._options.externalTextures.push(V),this._externalTextures[V]=p,this}setFloat(V,p){return this._checkUniform(V),this._floats[V]=p,this}setInt(V,p){return this._checkUniform(V),this._ints[V]=p,this}setUInt(V,p){return this._checkUniform(V),this._uints[V]=p,this}setFloats(V,p){return this._checkUniform(V),this._floatsArrays[V]=p,this}setColor3(V,p){return this._checkUniform(V),this._colors3[V]=p,this}setColor3Array(V,p){return this._checkUniform(V),this._colors3Arrays[V]=p.reduce(((V,p)=>(p.toArray(V,V.length),V)),[]),this}setColor4(V,p){return this._checkUniform(V),this._colors4[V]=p,this}setColor4Array(V,p){return this._checkUniform(V),this._colors4Arrays[V]=p.reduce(((V,p)=>(p.toArray(V,V.length),V)),[]),this}setVector2(V,p){return this._checkUniform(V),this._vectors2[V]=p,this}setVector3(V,p){return this._checkUniform(V),this._vectors3[V]=p,this}setVector4(V,p){return this._checkUniform(V),this._vectors4[V]=p,this}setQuaternion(V,p){return this._checkUniform(V),this._quaternions[V]=p,this}setQuaternionArray(V,p){return this._checkUniform(V),this._quaternionsArrays[V]=p.reduce(((V,p)=>(p.toArray(V,V.length),V)),[]),this}setMatrix(V,p){return this._checkUniform(V),this._matrices[V]=p,this}setMatrices(V,p){this._checkUniform(V);const W=new Float32Array(16*p.length);for(let N=0;N<p.length;N++){p[N].copyToArray(W,16*N)}return this._matrixArrays[V]=W,this}setMatrix3x3(V,p){return this._checkUniform(V),this._matrices3x3[V]=p,this}setMatrix2x2(V,p){return this._checkUniform(V),this._matrices2x2[V]=p,this}setArray2(V,p){return this._checkUniform(V),this._vectors2Arrays[V]=p,this}setArray3(V,p){return this._checkUniform(V),this._vectors3Arrays[V]=p,this}setArray4(V,p){return this._checkUniform(V),this._vectors4Arrays[V]=p,this}setUniformBuffer(V,p){return-1===this._options.uniformBuffers.indexOf(V)&&this._options.uniformBuffers.push(V),this._uniformBuffers[V]=p,this}setTextureSampler(V,p){return-1===this._options.samplerObjects.indexOf(V)&&this._options.samplerObjects.push(V),this._textureSamplers[V]=p,this}setStorageBuffer(V,p){return-1===this._options.storageBuffers.indexOf(V)&&this._options.storageBuffers.push(V),this._storageBuffers[V]=p,this}setDefine(V,p){const W=V.trimEnd()+" ",N=this.options.defines.findIndex((p=>p===V||p.startsWith(W)));return N>=0&&this.options.defines.splice(N,1),("boolean"!==typeof p||p)&&this.options.defines.push(W+p),this}isReadyForSubMesh(V,p,W){return this.isReady(V,W,p)}isReady(V,p,W){var N;const d=W&&this._storeEffectOnSubMeshes;if(this.isFrozen){const V=d?W._drawWrapper:this._drawWrapper;if(V.effect&&V._wasPreviouslyReady&&V._wasPreviouslyUsingInstances===p)return!0}const E=this.va(),z=E.getEngine(),Q=[],J=[],i=new u.b;let j=this._shaderPath,k=this._options.uniforms,f=this._options.uniformBuffers,O=this._options.samplers;z.getCaps().multiview&&E.activeCamera&&E.activeCamera.outputRenderTarget&&E.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,Q.push("#define MULTIVIEW"),-1!==k.indexOf("viewProjection")&&-1===k.indexOf("viewProjectionR")&&k.push("viewProjectionR"));for(let S=0;S<this._options.defines.length;S++){const V=0===this._options.defines[S].indexOf("#define")?this._options.defines[S]:`#define ${this._options.defines[S]}`;Q.push(V)}for(let S=0;S<this._options.attributes.length;S++)J.push(this._options.attributes[S]);if(V&&V.isVerticesDataPresent(S.f.ColorKind)&&(-1===J.indexOf(S.f.ColorKind)&&J.push(S.f.ColorKind),Q.push("#define VERTEXCOLOR")),p&&(Q.push("#define INSTANCES"),(0,C.bb)(J,this._materialHelperNeedsPreviousMatrices),null!==V&&void 0!==V&&V.hasThinInstances&&(Q.push("#define THIN_INSTANCES"),V&&V.isVerticesDataPresent(S.f.ColorInstanceKind)&&(J.push(S.f.ColorInstanceKind),Q.push("#define INSTANCESCOLOR")))),V&&V.useBones&&V.computeBonesUsingShaders&&V.skeleton){J.push(S.f.MatricesIndicesKind),J.push(S.f.MatricesWeightsKind),V.numBoneInfluencers>4&&(J.push(S.f.MatricesIndicesExtraKind),J.push(S.f.MatricesWeightsExtraKind));const p=V.skeleton;Q.push("#define NUM_BONE_INFLUENCERS "+V.numBoneInfluencers),i.addCPUSkinningFallback(0,V),p.isUsingTextureForMatrices?(Q.push("#define BONETEXTURE"),-1===k.indexOf("boneTextureWidth")&&k.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(Q.push("#define BonesPerMesh "+(p.bones.length+1)),-1===k.indexOf("mBones")&&k.push("mBones"))}else Q.push("#define NUM_BONE_INFLUENCERS 0");let U=0;const v=V?V.morphTargetManager:null;if(v){const V=v.supportsUVs&&-1!==Q.indexOf("#define UV1"),p=v.supportsTangents&&-1!==Q.indexOf("#define TANGENT"),W=v.supportsNormals&&-1!==Q.indexOf("#define NORMAL");U=v.numMaxInfluencers||v.numInfluencers,V&&Q.push("#define MORPHTARGETS_UV"),p&&Q.push("#define MORPHTARGETS_TANGENT"),W&&Q.push("#define MORPHTARGETS_NORMAL"),U>0&&Q.push("#define MORPHTARGETS"),v.isUsingTextureForTargets&&(Q.push("#define MORPHTARGETS_TEXTURE"),-1===k.indexOf("morphTargetTextureIndices")&&k.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),Q.push("#define NUM_MORPH_INFLUENCERS "+U);for(let N=0;N<U;N++)J.push(S.f.PositionKind+N),W&&J.push(S.f.NormalKind+N),p&&J.push(S.f.TangentKind+N),V&&J.push(S.f.UVKind+"_"+N);U>0&&(k=k.slice(),k.push("morphTargetInfluences"),k.push("morphTargetCount"),k.push("morphTargetTextureInfo"),k.push("morphTargetTextureIndices"))}else Q.push("#define NUM_MORPH_INFLUENCERS 0");if(V){const p=V.bakedVertexAnimationManager;p&&p.isEnabled&&(Q.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===k.indexOf("bakedVertexAnimationSettings")&&k.push("bakedVertexAnimationSettings"),-1===k.indexOf("bakedVertexAnimationTextureSizeInverted")&&k.push("bakedVertexAnimationTextureSizeInverted"),-1===k.indexOf("bakedVertexAnimationTime")&&k.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,C.x)(J,V,Q)}for(const S in this._textures)if(!this._textures[S].isReady())return!1;V&&this._shouldTurnAlphaTestOn(V)&&Q.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,F.b)(k),(0,F.l)(this,E,Q)),E.fogEnabled&&null!==V&&void 0!==V&&V.applyFog&&E.fogMode!==l.e.FOGMODE_NONE&&(Q.push("#define FOG"),-1===k.indexOf("view")&&k.push("view"),-1===k.indexOf("vFogInfos")&&k.push("vFogInfos"),-1===k.indexOf("vFogColor")&&k.push("vFogColor")),this._useLogarithmicDepth&&(Q.push("#define LOGARITHMICDEPTH"),-1===k.indexOf("logarithmicDepthConstant")&&k.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(k=k.slice(),f=f.slice(),O=O.slice(),j=this.customShaderNameResolve(this.name,k,f,O,Q,J));const t=d?W._getDrawWrapper(void 0,!0):this._drawWrapper,e=(null===t||void 0===t?void 0:t.effect)??null,Z=(null===t||void 0===t?void 0:t.defines)??null,o=Q.join("\n");let K=e;return Z!==o&&(K=z.createEffect(j,{attributes:J,uniformsNames:k,uniformBuffersNames:f,samplers:O,defines:o,fallbacks:i,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:U},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},z),d?W.setEffect(K,o,this._materialContext):t&&t.setEffect(K,o),this._onEffectCreatedObservable&&(A.effect=K,A.subMesh=W??(null===V||void 0===V?void 0:V.dg[0])??null,this._onEffectCreatedObservable.notifyObservers(A))),t._wasPreviouslyUsingInstances=!!p,!((null===(N=K)||void 0===N||!N.isReady())??1)&&(e!==K&&E.resetCachedMaterial(),t._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(V,p){const W=this.va(),N=p??this.getEffect();N&&(-1!==this._options.uniforms.indexOf("world")&&N.setMatrix("world",V),-1!==this._options.uniforms.indexOf("worldView")&&(V.multiplyToRef(W.getViewMatrix(),this._cachedWorldViewMatrix),N.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(V.multiplyToRef(W.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),N.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&N.setMatrix("view",W.getViewMatrix()))}bindForSubMesh(V,p,W){var N;this.bind(V,p,null===(N=W._drawWrapperOverride)||void 0===N?void 0:N.effect,W)}bind(V,p,W,N){const d=N&&this._storeEffectOnSubMeshes,E=W??(d?N.effect:this.getEffect());if(!E)return;const z=this.va();this._activeEffect=E,this.bindOnlyWorldMatrix(V,W);const S=this._options.uniformBuffers;let Q=!1;if(E&&S&&S.length>0&&z.getEngine().supportsUniformBuffers)for(let l=0;l<S.length;++l){switch(S[l]){case"Mesh":p&&(p.getMeshUniformBuffer().bindToEffect(E,"Mesh"),p.transferToEffect(V));break;case"Scene":(0,C.p)(E,z.getSceneUniformBuffer()),z.finalizeSceneUbo(),Q=!0}}const J=p&&d?this._mustRebind(z,E,N,p.visibility):z.getCachedMaterial()!==this;if(E&&J){let V;for(V in Q||-1===this._options.uniforms.indexOf("view")||E.setMatrix("view",z.getViewMatrix()),Q||-1===this._options.uniforms.indexOf("projection")||E.setMatrix("projection",z.getProjectionMatrix()),Q||-1===this._options.uniforms.indexOf("viewProjection")||(E.setMatrix("viewProjection",z.getTransformMatrix()),this._multiview&&E.setMatrix("viewProjectionR",z._transformMatrixR)),z.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&E.setVector3("cameraPosition",z.activeCamera.globalPosition),(0,C.e)(p,E),(0,F.e)(E,this,z),this._useLogarithmicDepth&&(0,C.k)(d?N.materialDefines:E.defines,E,z),p&&(0,C.g)(z,p,E),this._textures)E.setTexture(V,this._textures[V]);for(V in this._textureArrays)E.setTextureArray(V,this._textureArrays[V]);for(V in this._ints)E.setInt(V,this._ints[V]);for(V in this._uints)E.setUInt(V,this._uints[V]);for(V in this._floats)E.setFloat(V,this._floats[V]);for(V in this._floatsArrays)E.setArray(V,this._floatsArrays[V]);for(V in this._colors3)E.setColor3(V,this._colors3[V]);for(V in this._colors3Arrays)E.setArray3(V,this._colors3Arrays[V]);for(V in this._colors4){const p=this._colors4[V];E.setFloat4(V,p.r,p.g,p.b,p.a)}for(V in this._colors4Arrays)E.setArray4(V,this._colors4Arrays[V]);for(V in this._vectors2)E.setVector2(V,this._vectors2[V]);for(V in this._vectors3)E.setVector3(V,this._vectors3[V]);for(V in this._vectors4)E.setVector4(V,this._vectors4[V]);for(V in this._quaternions)E.setQuaternion(V,this._quaternions[V]);for(V in this._matrices)E.setMatrix(V,this._matrices[V]);for(V in this._matrixArrays)E.setMatrices(V,this._matrixArrays[V]);for(V in this._matrices3x3)E.setMatrix3x3(V,this._matrices3x3[V]);for(V in this._matrices2x2)E.setMatrix2x2(V,this._matrices2x2[V]);for(V in this._vectors2Arrays)E.setArray2(V,this._vectors2Arrays[V]);for(V in this._vectors3Arrays)E.setArray3(V,this._vectors3Arrays[V]);for(V in this._vectors4Arrays)E.setArray4(V,this._vectors4Arrays[V]);for(V in this._quaternionsArrays)E.setArray4(V,this._quaternionsArrays[V]);for(V in this._uniformBuffers){const p=this._uniformBuffers[V].getBuffer();p&&E.bindUniformBuffer(p,V)}const W=z.getEngine(),S=W.setExternalTexture;if(S)for(V in this._externalTextures)S.call(W,V,this._externalTextures[V]);const J=W.setTextureSampler;if(J)for(V in this._textureSamplers)J.call(W,V,this._textureSamplers[V]);const i=W.setStorageBuffer;if(i)for(V in this._storageBuffers)i.call(W,V,this._storageBuffers[V])}if(E&&p&&(J||!this.isFrozen)){const V=p.morphTargetManager;V&&V.numInfluencers>0&&(0,C.m)(p,E);const W=p.bakedVertexAnimationManager;if(W&&W.isEnabled){var i;const V=d?N._drawWrapper:this._drawWrapper;null===(i=p.bakedVertexAnimationManager)||void 0===i||i.bind(E,!!V._wasPreviouslyUsingInstances)}}this._afterBind(p,E,N)}getActiveTextures(){const V=super.getActiveTextures();for(const p in this._textures)V.push(this._textures[p]);for(const p in this._textureArrays){const W=this._textureArrays[p];for(let p=0;p<W.length;p++)V.push(W[p])}return V}hasTexture(V){if(super.hasTexture(V))return!0;for(const p in this._textures)if(this._textures[p]===V)return!0;for(const p in this._textureArrays){const W=this._textureArrays[p];for(let p=0;p<W.length;p++)if(W[p]===V)return!0}return!1}clone(V){const p=i.b.Clone((()=>new v(V,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);p.name=V,p.id=V,"object"===typeof p._shaderPath&&(p._shaderPath={...p._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((V=>{const p=this._options[V];Array.isArray(p)&&(this._options[V]=p.slice(0))})),this.stencil.copyTo(p.stencil);for(const W in this._textures)p.setTexture(W,this._textures[W]);for(const W in this._textureArrays)p.setTextureArray(W,this._textureArrays[W]);for(const W in this._externalTextures)p.setExternalTexture(W,this._externalTextures[W]);for(const W in this._ints)p.setInt(W,this._ints[W]);for(const W in this._uints)p.setUInt(W,this._uints[W]);for(const W in this._floats)p.setFloat(W,this._floats[W]);for(const W in this._floatsArrays)p.setFloats(W,this._floatsArrays[W]);for(const W in this._colors3)p.setColor3(W,this._colors3[W]);for(const W in this._colors3Arrays)p._colors3Arrays[W]=this._colors3Arrays[W];for(const W in this._colors4)p.setColor4(W,this._colors4[W]);for(const W in this._colors4Arrays)p._colors4Arrays[W]=this._colors4Arrays[W];for(const W in this._vectors2)p.setVector2(W,this._vectors2[W]);for(const W in this._vectors3)p.setVector3(W,this._vectors3[W]);for(const W in this._vectors4)p.setVector4(W,this._vectors4[W]);for(const W in this._quaternions)p.setQuaternion(W,this._quaternions[W]);for(const W in this._quaternionsArrays)p._quaternionsArrays[W]=this._quaternionsArrays[W];for(const W in this._matrices)p.setMatrix(W,this._matrices[W]);for(const W in this._matrixArrays)p._matrixArrays[W]=this._matrixArrays[W].slice();for(const W in this._matrices3x3)p.setMatrix3x3(W,this._matrices3x3[W]);for(const W in this._matrices2x2)p.setMatrix2x2(W,this._matrices2x2[W]);for(const W in this._vectors2Arrays)p.setArray2(W,this._vectors2Arrays[W]);for(const W in this._vectors3Arrays)p.setArray3(W,this._vectors3Arrays[W]);for(const W in this._vectors4Arrays)p.setArray4(W,this._vectors4Arrays[W]);for(const W in this._uniformBuffers)p.setUniformBuffer(W,this._uniformBuffers[W]);for(const W in this._textureSamplers)p.setTextureSampler(W,this._textureSamplers[W]);for(const W in this._storageBuffers)p.setStorageBuffer(W,this._storageBuffers[W]);return p}dispose(V,p,W){if(p){let V;for(V in this._textures)this._textures[V].dispose();for(V in this._textureArrays){const p=this._textureArrays[V];for(let V=0;V<p.length;V++)p[V].dispose()}}this._textures={},super.dispose(V,p,W)}serialize(){const V=i.b.Serialize(this);let p;for(p in V.customType="BABYLON.ShaderMaterial",V.uniqueId=this.uniqueId,V.options=this._options,V.shaderPath=this._shaderPath,V.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,V.stencil=this.stencil.serialize(),V.textures={},this._textures)V.textures[p]=this._textures[p].serialize();for(p in V.textureArrays={},this._textureArrays){V.textureArrays[p]=[];const W=this._textureArrays[p];for(let N=0;N<W.length;N++)V.textureArrays[p].push(W[N].serialize())}for(p in V.ints={},this._ints)V.ints[p]=this._ints[p];for(p in V.uints={},this._uints)V.uints[p]=this._uints[p];for(p in V.floats={},this._floats)V.floats[p]=this._floats[p];for(p in V.floatsArrays={},this._floatsArrays)V.floatsArrays[p]=this._floatsArrays[p];for(p in V.colors3={},this._colors3)V.colors3[p]=this._colors3[p].Zi();for(p in V.colors3Arrays={},this._colors3Arrays)V.colors3Arrays[p]=this._colors3Arrays[p];for(p in V.colors4={},this._colors4)V.colors4[p]=this._colors4[p].Zi();for(p in V.colors4Arrays={},this._colors4Arrays)V.colors4Arrays[p]=this._colors4Arrays[p];for(p in V.vectors2={},this._vectors2)V.vectors2[p]=this._vectors2[p].Zi();for(p in V.vectors3={},this._vectors3)V.vectors3[p]=this._vectors3[p].Zi();for(p in V.vectors4={},this._vectors4)V.vectors4[p]=this._vectors4[p].Zi();for(p in V.quaternions={},this._quaternions)V.quaternions[p]=this._quaternions[p].Zi();for(p in V.matrices={},this._matrices)V.matrices[p]=this._matrices[p].Zi();for(p in V.matrixArray={},this._matrixArrays)V.matrixArray[p]=this._matrixArrays[p];for(p in V.matrices3x3={},this._matrices3x3)V.matrices3x3[p]=this._matrices3x3[p];for(p in V.matrices2x2={},this._matrices2x2)V.matrices2x2[p]=this._matrices2x2[p];for(p in V.vectors2Arrays={},this._vectors2Arrays)V.vectors2Arrays[p]=this._vectors2Arrays[p];for(p in V.vectors3Arrays={},this._vectors3Arrays)V.vectors3Arrays[p]=this._vectors3Arrays[p];for(p in V.vectors4Arrays={},this._vectors4Arrays)V.vectors4Arrays[p]=this._vectors4Arrays[p];for(p in V.quaternionsArrays={},this._quaternionsArrays)V.quaternionsArrays[p]=this._quaternionsArrays[p];return V}static Parse(V,p,W){const d=i.b.Parse((()=>new v(V.name,p,V.shaderPath,V.options,V.storeEffectOnSubMeshes)),V,p,W);let E;for(E in V.stencil&&d.stencil.parse(V.stencil,p,W),V.textures)d.setTexture(E,j.d.Parse(V.textures[E],p,W));for(E in V.textureArrays){const N=V.textureArrays[E],z=[];for(let V=0;V<N.length;V++)z.push(j.d.Parse(N[V],p,W));d.setTextureArray(E,z)}for(E in V.ints)d.setInt(E,V.ints[E]);for(E in V.uints)d.setUInt(E,V.uints[E]);for(E in V.floats)d.setFloat(E,V.floats[E]);for(E in V.floatsArrays)d.setFloats(E,V.floatsArrays[E]);for(E in V.colors3)d.setColor3(E,z.c.Tg(V.colors3[E]));for(E in V.colors3Arrays){const p=V.colors3Arrays[E].reduce(((V,p,W)=>(W%3===0?V.push([p]):V[V.length-1].push(p),V)),[]).map((V=>z.c.Tg(V)));d.setColor3Array(E,p)}for(E in V.colors4)d.setColor4(E,z.e.Tg(V.colors4[E]));for(E in V.colors4Arrays){const p=V.colors4Arrays[E].reduce(((V,p,W)=>(W%4===0?V.push([p]):V[V.length-1].push(p),V)),[]).map((V=>z.e.Tg(V)));d.setColor4Array(E,p)}for(E in V.vectors2)d.setVector2(E,N.k.Tg(V.vectors2[E]));for(E in V.vectors3)d.setVector3(E,N.n.Tg(V.vectors3[E]));for(E in V.vectors4)d.setVector4(E,N.q.Tg(V.vectors4[E]));for(E in V.quaternions)d.setQuaternion(E,N.f.Tg(V.quaternions[E]));for(E in V.matrices)d.setMatrix(E,N.e.Tg(V.matrices[E]));for(E in V.matrixArray)d._matrixArrays[E]=new Float32Array(V.matrixArray[E]);for(E in V.matrices3x3)d.setMatrix3x3(E,V.matrices3x3[E]);for(E in V.matrices2x2)d.setMatrix2x2(E,V.matrices2x2[E]);for(E in V.vectors2Arrays)d.setArray2(E,V.vectors2Arrays[E]);for(E in V.vectors3Arrays)d.setArray3(E,V.vectors3Arrays[E]);for(E in V.vectors4Arrays)d.setArray4(E,V.vectors4Arrays[E]);for(E in V.quaternionsArrays)d.setArray4(E,V.quaternionsArrays[E]);return d}static ParseFromFileAsync(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((d,E)=>{const z=new f.e;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const p=JSON.parse(z.responseText),E=this.Parse(p,W||U.d.LastCreatedScene,N);V&&(E.name=V),d(E)}else E("Unable to load the ShaderMaterial")})),z.open("GET",p),z.send()}))}static ParseFromSnippetAsync(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((N,d)=>{const E=new f.e;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const d=JSON.parse(JSON.parse(E.responseText).jsonPayload),z=JSON.parse(d.shaderMaterial),S=this.Parse(z,p||U.d.LastCreatedScene,W);S.snippetId=V,N(S)}else d("Unable to load the snippet "+V)})),E.open("GET",this.SnippetUrl+"/"+V.replace(/#/g,"/")),E.send()}))}}v.SnippetUrl="https://snippet.babylonjs.com",v.CreateFromSnippetAsync=v.ParseFromSnippetAsync,(0,k.d)("BABYLON.ShaderMaterial",v),d.e._LinesMeshParser=(V,p)=>t.Parse(V,p);class t extends d.e{_isShaderMaterial(V){return"ShaderMaterial"===V.getClassName()}constructor(V){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>5?arguments[5]:void 0,d=arguments.length>6?arguments[6]:void 0,E=arguments.length>7?arguments[7]:void 0;super(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p,arguments.length>4?arguments[4]:void 0),this.useVertexColor=N,this.useVertexAlpha=d,this.color=new z.c(1,1,1),this.alpha=1,this._shaderLanguage=0,p&&(this.color=p.color.clone(),this.alpha=p.alpha,this.useVertexColor=p.useVertexColor,this.useVertexAlpha=p.useVertexAlpha),this.intersectionThreshold=.1;const Q={attributes:[S.f.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===d?Q.needAlphaBlending=!1:Q.defines.push("#define VERTEXALPHA"),N?(Q.defines.push("#define VERTEXCOLOR"),Q.attributes.push(S.f.ColorKind)):(Q.uniforms.push("color"),this._color4=new z.e),E)this.material=E;else{this.va().getEngine().isWebGPU&&!t.ForceGLSL&&(this._shaderLanguage=1),Q.shaderLanguage=this._shaderLanguage,Q.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([W.e(23).then(W.bind(W,13834)),W.e(47).then(W.bind(W,13838))]):await Promise.all([W.e(28).then(W.bind(W,13843)),W.e(48).then(W.bind(W,13847))])},this.material=new v("colorShader",this.va(),"color",Q,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(V){this._lineMaterial=V,this._lineMaterial.fillMode=J.d.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(V){}_bind(V,p){if(!this._geometry)return this;const W=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(p,W):this._geometry._bind(p,W,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:V,g:p,b:W}=this.color;this._color4.set(V,p,W,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(V,p,W){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const N=this.va().getEngine();return this._unIndexed?N.drawArraysType(J.d.LineListDrawMode,V.verticesStart,V.verticesCount,W):N.drawElementsType(J.d.LineListDrawMode,V.indexStart,V.indexCount,W),this}dispose(V){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(V)}clone(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0;return new t(V,this.va(),p,this,W)}createInstance(V){const p=new e(V,this);if(this.instancedBuffers){p.instancedBuffers={};for(const V in this.instancedBuffers)p.instancedBuffers[V]=this.instancedBuffers[V]}return p}serialize(V){super.serialize(V),V.color=this.color.Zi(),V.alpha=this.alpha}static Parse(V,p){const W=new t(V.name,p);return W.color=z.c.Tg(V.color),W.alpha=V.alpha,W}}t.ForceGLSL=!1;class e extends Q.b{constructor(V,p){super(V,p),this.intersectionThreshold=p.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var Z=W(10870);function o(V){const p=[],W=[],N=V.lines,d=V.za,z=[];let S=0;for(let E=0;E<N.length;E++){const V=N[E];for(let N=0;N<V.length;N++){const{x:Q,y:J,z:i}=V[N];if(W.push(Q,J,i),d){const V=d[E],{r:p,g:W,b:S,a:Q}=V[N];z.push(p,W,S,Q)}N>0&&(p.push(S-1),p.push(S)),S++}}const Q=new E.b;return Q.indices=p,Q.xa=W,d&&(Q.za=z),Q}function K(V){const p=V.dashSize||3,W=V.gapSize||1,d=V.dashNb||200,z=V.points,S=[],Q=[],J=N.n.Zero();let i=0,l=0,j=0,k=0,u=0,f=0,O=0;for(O=0;O<z.length-1;O++)z[O+1].subtractToRef(z[O],J),i+=J.length();for(j=i/d,k=p*j/(p+W),O=0;O<z.length-1;O++){z[O+1].subtractToRef(z[O],J),l=Math.floor(J.length()/j),J.normalize();for(let V=0;V<l;V++)u=j*V,S.push(z[O].x+u*J.x,z[O].y+u*J.y,z[O].z+u*J.z),S.push(z[O].x+(u+k)*J.x,z[O].y+(u+k)*J.y,z[O].z+(u+k)*J.z),Q.push(f,f+1),f+=2}const U=new E.b;return U.xa=S,U.indices=Q,U}function h(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=p.instance,d=p.lines,E=p.za;if(N){const V=N.getVerticesData(S.f.PositionKind);let p,W;E&&(p=N.getVerticesData(S.f.ColorKind));let z=0,Q=0;for(let N=0;N<d.length;N++){const S=d[N];for(let d=0;d<S.length;d++)V[z]=S[d].x,V[z+1]=S[d].y,V[z+2]=S[d].z,E&&p&&(W=E[N],p[Q]=W[d].r,p[Q+1]=W[d].g,p[Q+2]=W[d].b,p[Q+3]=W[d].a,Q+=4),z+=3}return N.updateVerticesData(S.f.PositionKind,V,!1,!1),E&&p&&N.updateVerticesData(S.f.ColorKind,p,!1,!1),N.refreshBoundingInfo(),N}const z=new t(V,W,null,void 0,void 0,!!E,p.useVertexAlpha,p.material);return o(p).Ca(z,p.updatable),z}function L(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=p.za?[p.za]:null;return h(V,{lines:[p.points],updatable:p.updatable,instance:p.instance,za:N,useVertexAlpha:p.useVertexAlpha,material:p.material},W)}function x(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=p.points,z=p.instance,S=p.gapSize||1,Q=p.dashSize||3;if(z){const V=V=>{const p=N.n.Zero(),W=V.length/6;let d=0,S=0,Q=0,J=0,i=0,l=0,j=0,k=0;for(j=0;j<E.length-1;j++)E[j+1].subtractToRef(E[j],p),d+=p.length();Q=d/W;const u=z._creationDataStorage.dashSize;for(J=u*Q/(u+z._creationDataStorage.gapSize),j=0;j<E.length-1;j++)for(E[j+1].subtractToRef(E[j],p),S=Math.floor(p.length()/Q),p.normalize(),k=0;k<S&&l<V.length;)i=Q*k,V[l]=E[j].x+i*p.x,V[l+1]=E[j].y+i*p.y,V[l+2]=E[j].z+i*p.z,V[l+3]=E[j].x+(i+J)*p.x,V[l+4]=E[j].y+(i+J)*p.y,V[l+5]=E[j].z+(i+J)*p.z,l+=6,k++;for(;l<V.length;)V[l]=E[j].x,V[l+1]=E[j].y,V[l+2]=E[j].z,l+=3};return(p.dashNb||p.dashSize||p.gapSize||p.useVertexAlpha||p.material)&&Z.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),z.updateMeshPositions(V,!1),z}const J=new t(V,W,null,void 0,void 0,void 0,p.useVertexAlpha,p.material);return K(p).Ca(J,p.updatable),J._creationDataStorage=new d.f,J._creationDataStorage.dashSize=Q,J._creationDataStorage.gapSize=S,J}E.b.CreateLineSystem=o,E.b.CreateDashedLines=K,d.e.pb=function(V,p){return L(V,{points:p,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},d.e.CreateDashedLines=function(V,p,W,N,d){return x(V,{points:p,dashSize:W,gapSize:N,dashNb:d,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11648:(V,p,W)=>{"use strict";W.d(p,{c:()=>S,d:()=>Q});var N=W(11510),d=W(11544),E=W(11467);function z(V){const p=[],W=[],N=[],z=[],S=V.width||V.size||1,Q=V.height||V.size||1,J=0===V.sideOrientation?0:V.sideOrientation||d.b.DEFAULTSIDE,i=S/2,l=Q/2;W.push(-i,-l,0),N.push(0,0,-1),z.push(0,E.d?1:0),W.push(i,-l,0),N.push(0,0,-1),z.push(1,E.d?1:0),W.push(i,l,0),N.push(0,0,-1),z.push(1,E.d?0:1),W.push(-i,l,0),N.push(0,0,-1),z.push(0,E.d?0:1),p.push(0),p.push(1),p.push(2),p.push(0),p.push(2),p.push(3),d.b._ComputeSides(J,W,p,N,z,V.frontUVs,V.backUVs);const j=new d.b;return j.indices=p,j.xa=W,j.ya=N,j.Aa=z,j}function S(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=new N.e(V,W);p.sideOrientation=N.e._GetDefaultSideOrientation(p.sideOrientation),d._originalBuilderSideOrientation=p.sideOrientation;return z(p).Ca(d,p.updatable),p.sourcePlane&&(d.translate(p.sourcePlane.k,-p.sourcePlane.d),d.setDirection(p.sourcePlane.k.scale(-1))),d}const Q={fg:S};d.b.fg=z,N.e.fg=(V,p,W,N,d)=>S(V,{size:p,width:p,height:p,sideOrientation:d,updatable:N},W)},11883:(V,p,W)=>{"use strict";W.d(p,{d:()=>Q});var N=W(11218),d=W(11510),E=W(11544),z=W(11467);function S(V){const p=0|(V.segments||32),W=V.diameterX||V.diameter||1,d=V.diameterY||V.diameter||1,S=V.diameterZ||V.diameter||1,Q=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,J=V.slice&&V.slice<=0?1:V.slice||1,i=0===V.sideOrientation?0:V.sideOrientation||E.b.DEFAULTSIDE,l=!!V.dedupTopBottomIndices,j=new N.n(W/2,d/2,S/2),k=2+p,u=2*k,f=[],O=[],U=[],F=[];for(let E=0;E<=k;E++){const V=E/k,p=V*Math.PI*J;for(let W=0;W<=u;W++){const d=W/u,E=d*Math.PI*2*Q,S=N.e.RotationZ(-p),J=N.e.RotationY(E),i=N.n.TransformCoordinates(N.n.Up(),S),l=N.n.TransformCoordinates(i,J),k=l.multiply(j),f=l.divide(j).normalize();O.push(k.x,k.y,k.z),U.push(f.x,f.y,f.z),F.push(d,z.d?1-V:V)}if(E>0){const V=O.length/3;for(let p=V-2*(u+1);p+u+2<V;p++)l?(E>1&&(f.push(p),f.push(p+1),f.push(p+u+1)),(E<k||J<1)&&(f.push(p+u+1),f.push(p+1),f.push(p+u+2))):(f.push(p),f.push(p+1),f.push(p+u+1),f.push(p+u+1),f.push(p+1),f.push(p+u+2))}}E.b._ComputeSides(i,O,f,U,F,V.frontUVs,V.backUVs);const C=new E.b;return C.indices=f,C.xa=O,C.ya=U,C.Aa=F,C}function Q(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new d.e(V,W);p.sideOrientation=d.e._GetDefaultSideOrientation(p.sideOrientation),N._originalBuilderSideOrientation=p.sideOrientation;return S(p).Ca(N,p.updatable),N}E.b.CreateSphere=S,d.e.CreateSphere=(V,p,W,N,d,E)=>Q(V,{segments:p,diameterX:W,diameterY:W,diameterZ:W,sideOrientation:E,updatable:d},N)},12578:(V,p,W)=>{"use strict";W.d(p,{e:()=>l});var N=W(10848),d=W(12587),E=W(11553),z=W(11291),S=W(11544),Q=W(10870);function J(V,p,W,N,d){let E=null,z=null,S=null;try{let Q;E=new V.Decoder,z=new V.DecoderBuffer,z.Init(p,p.byteLength);const J=E.GetEncodedGeometryType(z);switch(J){case V.TRIANGULAR_MESH:{const p=new V.Mesh;if(Q=E.DecodeBufferToMesh(z,p),!Q.ok()||0===p.ptr)throw new Error(Q.error_msg());const W=3*p.num_faces(),d=4*W,J=V._malloc(d);try{E.GetTrianglesUInt32Array(p,d,J);const z=new Uint32Array(W);z.set(new Uint32Array(V.HEAPF32.buffer,J,W)),N(z)}finally{V._free(J)}S=p;break}case V.POINT_CLOUD:{const p=new V.PointCloud;if(Q=E.DecodeBufferToPointCloud(z,p),!Q.ok()||!p.ptr)throw new Error(Q.error_msg());S=p;break}default:throw new Error(`Invalid geometry type ${J}`)}const i=S.num_points(),l=(p,W,N,E)=>{const z=E.data_type(),S=E.num_components(),Q=E.normalized(),J=E.byte_stride(),l=E.byte_offset(),j={[V.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:V.HEAPF32},[V.DT_INT8]:{typedArrayConstructor:Int8Array,heap:V.HEAP8},[V.DT_INT16]:{typedArrayConstructor:Int16Array,heap:V.HEAP16},[V.DT_INT32]:{typedArrayConstructor:Int32Array,heap:V.HEAP32},[V.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:V.HEAPU8},[V.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:V.HEAPU16},[V.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:V.HEAPU32}}[z];if(!j)throw new Error(`Invalid data type ${z}`);const k=i*S,u=k*j.typedArrayConstructor.BYTES_PER_ELEMENT,f=V._malloc(u);try{p.GetAttributeDataArrayForAllPoints(W,E,z,u,f);const V=new j.typedArrayConstructor(j.heap.buffer,f,k);d(N,V.slice(),S,l,J,Q)}finally{V._free(f)}};if(W)for(const V in W){const p=W[V],N=E.GetAttributeByUniqueId(S,p);l(E,S,V,N)}else{const p={position:V.POSITION,k:V.NORMAL,color:V.COLOR,uv:V.TEX_COORD};for(const V in p){const W=E.GetAttributeId(S,p[V]);if(-1!==W){const p=E.GetAttribute(S,W);l(E,S,V,p)}}}return i}finally{S&&V.destroy(S),z&&V.destroy(z),E&&V.destroy(E)}}function i(){let V;onmessage=p=>{const W=p.data;switch(W.id){case"init":{const p=W.decoder;p.url&&importScripts(p.url);const N=p.wasmBinary?{wasmBinary:p.wasmBinary}:{};V=DracoDecoderModule(N),postMessage({id:"initDone"});break}case"decodeMesh":if(!V)throw new Error("Draco decoder module is not available");V.then((V=>{const p=J(V,W.dataView,W.attributes,(V=>{postMessage({id:"indices",data:V},[V.buffer])}),((V,p,W,N,d,E)=>{postMessage({id:"attribute",kind:V,data:p,size:W,byteOffset:N,byteStride:d,normalized:E},[p.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:p})}))}}}class l{static get DecoderAvailable(){const V=l.Configuration.decoder;return!!(V.wasmUrl&&V.wasmBinaryUrl&&"object"===typeof WebAssembly||V.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return l._Default||(l._Default=new l),l._Default}static ResetDefault(V){l._Default&&(V||l._Default.dispose(),l._Default=null)}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.DefaultNumWorkers;const p=l.Configuration.decoder;if(p.workerPool||"object"===typeof V&&V.workerPool)this._workerPoolPromise=Promise.resolve(p.workerPool||V.workerPool);else{const W=p.wasmBinary||"object"===typeof V&&V.wasmBinary,E="number"===typeof V?V:V.numWorkers,z=E&&"function"===typeof Worker&&"function"===typeof URL,S=z||!z&&!p.jsModule,Q=p.wasmUrl&&p.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:S?N.e.GetBabylonScriptURL(p.wasmUrl,!0):"",wasmBinaryPromise:W?Promise.resolve(W):N.e.LoadFileAsync(N.e.GetBabylonScriptURL(p.wasmBinaryUrl,!0))}:{url:S?N.e.GetBabylonScriptURL(p.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};z?this._workerPoolPromise=Q.wasmBinaryPromise.then((V=>{const p=`${J}(${i})()`,W=URL.createObjectURL(new Blob([p],{type:"application/javascript"}));return new d.e(E,(()=>function(V,p,W){return new Promise(((N,d)=>{const E=p=>{V.removeEventListener("error",E),V.removeEventListener("message",z),d(p)},z=p=>{"initDone"===p.data.id&&(V.removeEventListener("error",E),V.removeEventListener("message",z),N(V))};if(V.addEventListener("error",E),V.addEventListener("message",z),p){const N=p.slice(0);V.postMessage({id:"init",decoder:{url:W,wasmBinary:N}},[N])}else V.postMessage({id:"init",decoder:{url:W}})}))}(new Worker(W),V,Q.url)))})):this._decoderModulePromise=Q.wasmBinaryPromise.then((async V=>{if("undefined"===typeof DracoDecoderModule&&!p.jsModule){if(!Q.url)throw new Error("Draco decoder module is not available");await N.e.LoadBabylonScriptAsync(Q.url)}return await(W=V,d=p.jsModule,new Promise((V=>{(d||DracoDecoderModule)({wasmBinary:W}).then((p=>{V({module:p})}))})));var W,d}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((V=>{V.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(V,p,W){const N=V instanceof ArrayBuffer?new Int8Array(V):new Int8Array(V.buffer,V.byteOffset,V.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((V=>new Promise(((d,E)=>{V.push(((V,z)=>{let S=null;const J=[],i=p=>{V.removeEventListener("error",i),V.removeEventListener("message",l),E(p),z()},l=p=>{const N=p.data;switch(N.id){case"decodeMeshDone":V.removeEventListener("error",i),V.removeEventListener("message",l),d({indices:S,attributes:J,totalVertices:N.totalVertices}),z();break;case"indices":S=N.data;break;case"attribute":J.push({kind:N.kind,data:N.data,size:N.size,byteOffset:N.byteOffset,byteStride:N.byteStride,normalized:(E=N.kind,j=N.normalized,W&&void 0!==W[E]?(j!==W[E]&&Q.e.Warn(`Normalized flag from Draco data (${j}) does not match normalized flag from glTF accessor (${W[E]}). Using flag from glTF accessor.`),W[E]):j)})}var E,j};V.addEventListener("error",i),V.addEventListener("message",l);const j=N.slice();V.postMessage({id:"decodeMesh",dataView:j,attributes:p},[j.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((V=>{let W=null;const d=[],E=J(V.module,N,p,(V=>{W=V}),((V,p,W,N,E,z)=>{d.push({kind:V,data:p,size:W,byteOffset:N,byteStride:E,normalized:z})}));return{indices:W,attributes:d,totalVertices:E}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(V,p,W,N){const d=await this.decodeMeshToMeshDataAsync(W,N),S=new E.e(V,p);d.indices&&S.setIndices(d.indices);for(const E of d.attributes)S.setVerticesBuffer(new z.f(p.getEngine(),E.data,E.kind,!1,void 0,E.byteStride,void 0,E.byteOffset,E.size,void 0,E.normalized,!0),d.totalVertices);return S}async _decodeMeshToGeometryForGltfAsync(V,p,W,N,d){const S=await this.decodeMeshToMeshDataAsync(W,N,d),Q=new E.e(V,p);S.indices&&Q.setIndices(S.indices);for(const E of S.attributes)Q.setVerticesBuffer(new z.f(p.getEngine(),E.data,E.kind,!1,void 0,E.byteStride,void 0,E.byteOffset,E.size,void 0,E.normalized,!0),S.totalVertices);return Q}async decodeMeshAsync(V,p){const W=await this.decodeMeshToMeshDataAsync(V,p),N=new S.b;W.indices&&(N.indices=W.indices);for(const d of W.attributes){const V=z.f.GetFloatData(d.data,d.size,z.f.GetDataType(d.data),d.byteOffset,d.byteStride,d.normalized,W.totalVertices);N.set(V,d.kind)}return N}}l.Configuration={decoder:{wasmUrl:`${N.e._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${N.e._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${N.e._DefaultCdnUrl}/draco_decoder_gltf.js`}},l.DefaultNumWorkers=l.GetDefaultNumWorkers(),l._Default=null},11716:(V,p,W)=>{"use strict";W.d(p,{d:()=>d});var N=W(11299);class d extends N.e{constructor(V){super(),this._buffer=V}get underlyingResource(){return this._buffer}}},11565:(V,p,W)=>{"use strict";W.d(p,{d:()=>e});var N=W(11167),d=W(10856),E=W(11218),z=W(11291),S=W(11544),Q=W(11571),J=W(11284),i=W(11402),l=W(11278);class j{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new E.n(0,0,0),this._diffPositionForCollisions=new E.n(0,0,0),this._collisionResponse=!0}}var k=W(10887),u=W(11422),f=W(11257),O=W(11224),U=W(11579),F=W(11004),C=W(11175),A=W(10941);class v{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=E.n.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class t{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new v,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new j,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class e extends Q.b{static get BILLBOARDMODE_NONE(){return Q.b.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return Q.b.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return Q.b.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return Q.b.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return Q.b.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return Q.b.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(V){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=V}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(V){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=V}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(V){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=V}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(V){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=V}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(V){this._internalAbstractMeshDataInfo._collisionRetryCount=V}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(V){this._internalAbstractMeshDataInfo._morphTargetManager!==V&&(this._internalAbstractMeshDataInfo._morphTargetManager=V,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(V){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==V&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=V,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(V){return!!super._updateNonUniformScalingState(V)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(V){this._internalAbstractMeshDataInfo._rawBoundingInfo=V}set xk(V){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(V)}set onCollisionPositionChange(V){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(V)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(V){if(this._internalAbstractMeshDataInfo._visibility===V)return;const p=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=V,(1===p&&1!==V||1!==p&&1===V)&&this._markSubMeshesAsDirty((V=>{V.markAsMiscDirty(),V.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(V){this._internalAbstractMeshDataInfo._inheritVisibility=V}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let V=this._parentNode;for(;V;){const p=V.isVisible;if("undefined"!==typeof p)return p;V=V.parent}}return this._isVisible}set isVisible(V){this._isVisible=V}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(V){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=V}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(V){this._internalAbstractMeshDataInfo._renderingGroupId=V}get material(){return this._internalAbstractMeshDataInfo._material}set material(V){this._setMaterial(V)}_setMaterial(V){this._internalAbstractMeshDataInfo._material!==V&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=V,V&&V.meshMap&&(V.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.dg&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(V){var p;return null===(p=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===p?void 0:p[V]}setMaterialForRenderPass(V,p){this.resetDrawCache(V),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[V]=p}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(V){this._internalAbstractMeshDataInfo._receiveShadows!==V&&(this._internalAbstractMeshDataInfo._receiveShadows=V,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(V){this._internalAbstractMeshDataInfo._hasVertexAlpha!==V&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=V,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(V){this._internalAbstractMeshDataInfo._useVertexColors!==V&&(this._internalAbstractMeshDataInfo._useVertexColors=V,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(V){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==V&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=V,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(V){this._internalAbstractMeshDataInfo._numBoneInfluencers!==V&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=V,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(V){this._internalAbstractMeshDataInfo._applyFog!==V&&(this._internalAbstractMeshDataInfo._applyFog=V,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(V){this._internalAbstractMeshDataInfo._enableDistantPicking=V}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(V){V!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=V,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(V){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(V)?-1:V}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(V){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=V}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(V){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(V)?-1:V}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(V){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=V}get lightSources(){return this._lightSources}set skeleton(V){const p=this._internalAbstractMeshDataInfo._skeleton;p&&p.needInitialSkinMatrix&&p._unregisterMeshWithPoseMatrix(this),V&&V.needInitialSkinMatrix&&V._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=V,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(V){var p;let W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(V,W,!1),p=this,this._internalAbstractMeshDataInfo=new t,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.ri=e.si,this.onCollideObservable=new d.b,this.onCollisionPositionChangeObservable=new d.b,this.onMaterialChangedObservable=new d.b,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.sb=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=f.c.Red(),this.outlineWidth=.02,this.overlayColor=f.c.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.qb=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new E.n(.5,1,.5),this.ellipsoidOffset=new E.n(0,0,0),this.edgesWidth=1,this.edgesColor=new f.e(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,jc:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new d.b,this._onCollisionPositionChange=function(V,W){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;W.subtractToRef(p._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,p._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),p._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>A.d.CollisionsEpsilon&&p.position.addInPlace(p._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),N&&p.onCollideObservable.notifyObservers(N),p.onCollisionPositionChangeObservable.notifyObservers(p.position)},W=this.va(),W.ai(this),this._resyncLightSources(),this._uniformBuffer=new l.c(this.va().getEngine(),void 0,void 0,V,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),W.performancePriority){case 2:this.Da=!0;case 1:this.qb=!0,this.sb=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(V){const p=this._uniformBuffer;p.wj("world",V),p.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),p.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(V){let p="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");p+=", # of submeshes: "+(this.dg?this.dg.length:0);const W=this._internalAbstractMeshDataInfo._skeleton;return W&&(p+=", skeleton: "+W.name),V&&(p+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],p+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.jc?"YES":"NO")),p}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==Q.b.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(p||this.actionManager.isRecursive)){if(!V)return this.actionManager;if(this.actionManager.hasSpecificTrigger(V))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(V,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.dg){for(const V of this.dg)V._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const V of this.va().lights)V.isEnabled()&&V.canAffectMesh(this)&&this._lightSources.push(V);this._markSubMeshesAsLightDirty()}_resyncLightSource(V){const p=V.isEnabled()&&V.canAffectMesh(this),W=this._lightSources.indexOf(V);let N=!1;if(-1===W){if(!p)return;this._lightSources.push(V)}else{if(p)return;N=!0,this._lightSources.splice(W,1)}this._markSubMeshesAsLightDirty(N)}_unBindEffect(){for(const V of this.dg)V.setEffect(null)}_removeLightSource(V,p){const W=this._lightSources.indexOf(V);-1!==W&&(this._lightSources.splice(W,1),this._markSubMeshesAsLightDirty(p))}_markSubMeshesAsDirty(V){if(this.dg)for(const p of this.dg)for(let W=0;W<p._drawWrappers.length;++W){const N=p._drawWrappers[W];N&&N.defines&&N.defines.markAllAsDirty&&V(N.defines)}}_markSubMeshesAsLightDirty(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((p=>p.markAsLightDirty(V)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((V=>V.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((V=>V.markAsMiscDirty()))}Jg(V){return this._currentRenderId=Number.MAX_VALUE,super.Jg(V),this._isDirty=!0,this}resetDrawCache(V){if(this.dg)for(const p of this.dg)p.resetDrawCache(V)}get isBlocked(){return!1}getLOD(V){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Zf(){return null}getVerticesData(V){return null}Ga(V,p,W,N){return this}updateVerticesData(V,p,W,N){return this}setIndices(V,p){return this}isVerticesDataPresent(V){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(V){return this._boundingInfo=V,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(V,p,W){return this._boundingInfo=new i.c(V,p,W),this._boundingInfo}normalizeToUnitCube(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(V,p,W)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(z.f.MatricesIndicesKind)&&this.isVerticesDataPresent(z.f.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(V){}_activate(V,p){return this._renderId=V,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===Q.b.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(V,p,W){return this.position.addInPlace(this.calcMovePOV(V,p,W)),this}calcMovePOV(V,p,W){const N=new E.e;(this.rotationQuaternion?this.rotationQuaternion:E.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(N);const d=E.n.Zero(),z=this.definedFacingForward?-1:1;return E.n.TransformCoordinatesFromFloatsToRef(V*z,p,W*z,N,d),d}rotatePOV(V,p,W){return this.rotation.addInPlace(this.calcRotatePOV(V,p,W)),this}calcRotatePOV(V,p,W){const N=this.definedFacingForward?1:-1;return new E.n(V*N,p,W*N)}Fa(V,p){if(V){const W=(0,u.h)(V,0,this.getTotalVertices(),p);this._boundingInfo?this._boundingInfo.reConstruct(W.minimum,W.maximum):this._boundingInfo=new i.c(W.minimum,W.maximum)}if(this.dg)for(let W=0;W<this.dg.length;W++)this.dg[W].refreshBoundingInfo(V);this.Ea()}_refreshBoundingInfoDirect(V){if(this._boundingInfo?this._boundingInfo.reConstruct(V.minimum,V.maximum):this._boundingInfo=new i.c(V.minimum,V.maximum),this.dg)for(let p=0;p<this.dg.length;p++)this.dg[p].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(V,p,W,N,d,S,Q){!function(V,p,W,N,d,S,Q){const J=E.i.fb[0],i=E.i.Matrix[0],l=E.i.Matrix[1],j=p===z.f.NormalKind?E.n.TransformNormalFromFloatsToRef:E.n.TransformCoordinatesFromFloatsToRef;for(let z=0,k=0;z<V.length;z+=3,k+=4){let p,u;for(i.reset(),p=0;p<4;p++)u=d[k+p],u>0&&(E.e.FromFloat32ArrayToRefScaled(W,Math.floor(16*N[k+p]),u,l),i.addToSelf(l));if(S&&Q)for(p=0;p<4;p++)u=Q[k+p],u>0&&(E.e.FromFloat32ArrayToRefScaled(W,Math.floor(16*S[k+p]),u,l),i.addToSelf(l));j(V[z],V[z+1],V[z+2],i,J),J.toArray(V,z)}}(V,p,W,N,d,S,Q)}_getData(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.f.PositionKind;const N=V.cache,d=V=>{if(N){const p=N._vertexData||(N._vertexData={});return p[V]||this.copyVerticesData(V,p),p[V]}return this.getVerticesData(V)};if(p||(p=d(W)),!p)return null;if(N?(N._outputData?N._outputData.set(p):N._outputData=new Float32Array(p),p=N._outputData):(V.applyMorph&&this.morphTargetManager||V.applySkeleton&&this.skeleton)&&(p=p.slice()),V.applyMorph&&this.morphTargetManager&&function(V,p,W){let N=null;switch(p){case z.f.PositionKind:N=V=>V.getPositions();break;case z.f.NormalKind:N=V=>V.getNormals();break;case z.f.TangentKind:N=V=>V.getTangents();break;case z.f.UVKind:N=V=>V.getUVs();break;default:return}for(let d=0;d<V.length;d++){let p=V[d];for(let E=0;E<W.numTargets;E++){const z=W.getTarget(E),S=z.influence;if(0!==S){const W=N(z);W&&(p+=(W[d]-V[d])*S)}}V[d]=p}}(p,W,this.morphTargetManager),V.applySkeleton&&this.skeleton){const V=d(z.f.MatricesIndicesKind),N=d(z.f.MatricesWeightsKind);if(N&&V){const E=this.numBoneInfluencers>4,S=E?d(z.f.MatricesIndicesExtraKind):null,Q=E?d(z.f.MatricesWeightsExtraKind):null,J=this.skeleton.getTransformMatrices(this);e._ApplySkeleton(p,W,J,V,N,S,Q)}}if(!1!==V.updatePositionsArray&&W===z.f.PositionKind){const V=this._internalAbstractMeshDataInfo._positions||[],W=V.length;if(V.length=p.length/3,W<V.length)for(let p=W;p<V.length;p++)V[p]=new E.n;for(let N=0,d=0;N<V.length;N++,d+=3)V[N].ge(p[d],p[d+1],p[d+2]);this._internalAbstractMeshDataInfo._positions=V}return p}getNormalsData(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:V,applyMorph:p,updatePositionsArray:!1},null,z.f.NormalKind)}$c(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:V,applyMorph:p,updatePositionsArray:!1},W,z.f.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new i.c(E.n.Zero(),E.n.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(V){if(!this.dg)return this;const p=this.dg.length;for(let W=0;W<p;W++){const N=this.dg[W];(p>1||!N.IsGlobal)&&N.updateBoundingInfo(V)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(V){return this.getBoundingInfo().isInFrustum(V,this.ri)}isCompletelyInFrustum(V){return this.getBoundingInfo().isCompletelyInFrustum(V)}intersectsMesh(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;const N=this.getBoundingInfo(),d=V.getBoundingInfo();if(N.intersects(d,p))return!0;if(W)for(const E of this.getChildMeshes())if(E.intersectsMesh(V,p,!0))return!0;return!1}intersectsPoint(V){return this.getBoundingInfo().intersectsPoint(V)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(V){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=V}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(V){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const p=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=p.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,p.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,V,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(V,p,W){var N;if(this._generatePointsArray(),!this._positions)return this;if(!V._lastColliderWorldVertices||!V._lastColliderTransformMatrix.equals(p)){V._lastColliderTransformMatrix=p.clone(),V._lastColliderWorldVertices=[],V._trianglePlanes=[];const W=V.verticesStart,N=V.verticesStart+V.verticesCount;for(let d=W;d<N;d++)V._lastColliderWorldVertices.push(E.n.TransformCoordinates(this._positions[d],p))}return W._collide(V._trianglePlanes,V._lastColliderWorldVertices,this.Zf(),V.indexStart,V.indexStart+V.indexCount,V.verticesStart,!!V.Ha(),this,this._shouldConvertRHS(),7===(null===(N=V.Ha())||void 0===N?void 0:N.fillMode)),this}_processCollisionsForSubMeshes(V,p){const W=this._scene.getCollidingSubMeshCandidates(this,V),N=W.length;for(let d=0;d<N;d++){const E=W.data[d];N>1&&!E._checkCollision(V)||this._collideForSubMesh(E,p,V)}return this}_shouldConvertRHS(){return!1}_checkCollision(V){if(!this.getBoundingInfo()._checkCollision(V))return this;const p=E.i.Matrix[0],W=E.i.Matrix[1];return E.e.ScalingToRef(1/V._radius.x,1/V._radius.y,1/V._radius.z,p),this.worldMatrixFromCache.multiplyToRef(p,W),this._processCollisionsForSubMeshes(V,W),this}_generatePointsArray(){return!1}intersects(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const S=new J.e,Q=this.getClassName(),i="InstancedLinesMesh"===Q||"LinesMesh"===Q||"GreasedLineMesh"===Q?this.intersectionThreshold:0,l=this.getBoundingInfo();if(!this.dg)return S;if(!z&&(!V.intersectsSphere(l.boundingSphere,i)||!V.intersectsBox(l.boundingBox,i)))return S;if(N)return S.hit=!z,S.pickedMesh=z?null:this,S.distance=z?0:E.n.Distance(V.origin,l.boundingSphere.center),S.subMeshId=0,S;if(!this._generatePointsArray())return S;let j=null;const k=this._scene.getIntersectingSubMeshCandidates(this,V),u=k.length;let f=!1;for(let E=0;E<u;E++){const V=k.data[E].Ha();if(V&&(7==V.fillMode||0==V.fillMode||1==V.fillMode||2==V.fillMode||4==V.fillMode)){f=!0;break}}if(!f)return S.hit=!0,S.pickedMesh=this,S.distance=E.n.Distance(V.origin,l.boundingSphere.center),S.subMeshId=-1,S;for(let E=0;E<u;E++){const N=k.data[E];if(u>1&&!z&&!N.canIntersects(V))continue;const d=N.intersects(V,this._positions,this.Zf(),p,W);if(d&&(p||!j||d.distance<j.distance)&&(j=d,j.subMeshId=E,p))break}if(j){const p=d??this.getWorldMatrix(),W=E.i.fb[0],N=E.i.fb[1];E.n.TransformCoordinatesToRef(V.origin,p,W),V.direction.scaleToRef(j.distance,N);const z=E.n.TransformNormal(N,p).addInPlace(W);return S.hit=!0,S.distance=E.n.Distance(W,z),S.pickedPoint=z,S.pickedMesh=this,S.bu=j.bu||0,S.bv=j.bv||0,S.subMeshFaceId=j.faceId,S.faceId=j.faceId+k.data[j.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),S.subMeshId=j.subMeshId,S}return S}clone(V,p,W){return null}releaseSubMeshes(){if(this.dg)for(;this.dg.length;)this.dg[0].dispose();else this.dg=[];return this}dispose(V){let p,W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const N=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),N.freeActiveMeshes(),N.freeRenderingGroups(),N.renderingManager.maintainStateBetweenFrames&&N.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((V=>V!==this&&V.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),p=0;p<this._intersectionsInProgress.length;p++){const V=this._intersectionsInProgress[p],W=V._intersectionsInProgress.indexOf(this);V._intersectionsInProgress.splice(W,1)}this._intersectionsInProgress.length=0;N.lights.forEach((V=>{let p=V.includedOnlyMeshes.indexOf(this);-1!==p&&V.includedOnlyMeshes.splice(p,1),p=V.excludedMeshes.indexOf(this),-1!==p&&V.excludedMeshes.splice(p,1);const W=V.getShadowGenerators();if(W){const V=W.values();for(let W=V.next();!0!==W.done;W=V.next()){const V=W.value.getShadowMap();V&&V.renderList&&(p=V.renderList.indexOf(this),-1!==p&&V.renderList.splice(p,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const d=N.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,d.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),d.wipeCaches(),N.yc(this),this._parentContainer){const V=this._parentContainer.meshes.indexOf(this);V>-1&&this._parentContainer.meshes.splice(V,1),this._parentContainer=null}if(W&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!V)for(p=0;p<N.fj.length;p++)N.fj[p].j===this&&(N.fj[p].dispose(),p--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(V,W)}_initFacetData(){const V=this._internalAbstractMeshDataInfo._facetData;V.facetNormals||(V.facetNormals=[]),V.facetPositions||(V.facetPositions=[]),V.facetPartitioning||(V.facetPartitioning=new Array),V.facetNb=this.Zf().length/3|0,V.partitioningSubdivisions=V.partitioningSubdivisions?V.partitioningSubdivisions:10,V.partitioningBBoxRatio=V.partitioningBBoxRatio?V.partitioningBBoxRatio:1.01;for(let p=0;p<V.facetNb;p++)V.facetNormals[p]=E.n.Zero(),V.facetPositions[p]=E.n.Zero();return V.facetDataEnabled=!0,this}updateFacetData(){const V=this._internalAbstractMeshDataInfo._facetData;V.facetDataEnabled||this._initFacetData();const p=this.getVerticesData(z.f.PositionKind),W=this.Zf(),N=this.getVerticesData(z.f.NormalKind),d=this.getBoundingInfo();if(V.facetDepthSort&&!V.facetDepthSortEnabled){if(V.facetDepthSortEnabled=!0,W instanceof Uint16Array)V.depthSortedIndices=new Uint16Array(W);else if(W instanceof Uint32Array)V.depthSortedIndices=new Uint32Array(W);else{let p=!1;for(let V=0;V<W.length;V++)if(W[V]>65535){p=!0;break}V.depthSortedIndices=p?new Uint32Array(W):new Uint16Array(W)}if(V.facetDepthSortFunction=function(V,p){return p.sqDistance-V.sqDistance},!V.facetDepthSortFrom){const p=this.va().activeCamera;V.facetDepthSortFrom=p?p.position:E.n.Zero()}V.depthSortedFacets=[];for(let p=0;p<V.facetNb;p++){const W={ind:3*p,sqDistance:0};V.depthSortedFacets.push(W)}V.invertedMatrix=E.e.Identity(),V.facetDepthSortOrigin=E.n.Zero()}V.bbSize.x=d.maximum.x-d.minimum.x>O.c?d.maximum.x-d.minimum.x:O.c,V.bbSize.y=d.maximum.y-d.minimum.y>O.c?d.maximum.y-d.minimum.y:O.c,V.bbSize.z=d.maximum.z-d.minimum.z>O.c?d.maximum.z-d.minimum.z:O.c;let Q=V.bbSize.x>V.bbSize.y?V.bbSize.x:V.bbSize.y;if(Q=Q>V.bbSize.z?Q:V.bbSize.z,V.subDiv.max=V.partitioningSubdivisions,V.subDiv.X=Math.floor(V.subDiv.max*V.bbSize.x/Q),V.subDiv.Y=Math.floor(V.subDiv.max*V.bbSize.y/Q),V.subDiv.Z=Math.floor(V.subDiv.max*V.bbSize.z/Q),V.subDiv.X=V.subDiv.X<1?1:V.subDiv.X,V.subDiv.Y=V.subDiv.Y<1?1:V.subDiv.Y,V.subDiv.Z=V.subDiv.Z<1?1:V.subDiv.Z,V.facetParameters.facetNormals=this.getFacetLocalNormals(),V.facetParameters.facetPositions=this.getFacetLocalPositions(),V.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),V.facetParameters.bInfo=d,V.facetParameters.bbSize=V.bbSize,V.facetParameters.subDiv=V.subDiv,V.facetParameters.ratio=this.partitioningBBoxRatio,V.facetParameters.depthSort=V.facetDepthSort,V.facetDepthSort&&V.facetDepthSortEnabled&&(this.Dj(!0),this._worldMatrix.invertToRef(V.invertedMatrix),E.n.TransformCoordinatesToRef(V.facetDepthSortFrom,V.invertedMatrix,V.facetDepthSortOrigin),V.facetParameters.distanceTo=V.facetDepthSortOrigin),V.facetParameters.depthSortedFacets=V.depthSortedFacets,N&&S.b.ComputeNormals(p,W,N,V.facetParameters),V.facetDepthSort&&V.facetDepthSortEnabled){V.depthSortedFacets.sort(V.facetDepthSortFunction);const p=V.depthSortedIndices.length/3|0;for(let N=0;N<p;N++){const p=V.depthSortedFacets[N].ind;V.depthSortedIndices[3*N]=W[p],V.depthSortedIndices[3*N+1]=W[p+1],V.depthSortedIndices[3*N+2]=W[p+2]}this.updateIndices(V.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const V=this._internalAbstractMeshDataInfo._facetData;return V.facetNormals||this.updateFacetData(),V.facetNormals}getFacetLocalPositions(){const V=this._internalAbstractMeshDataInfo._facetData;return V.facetPositions||this.updateFacetData(),V.facetPositions}getFacetLocalPartitioning(){const V=this._internalAbstractMeshDataInfo._facetData;return V.facetPartitioning||this.updateFacetData(),V.facetPartitioning}getFacetPosition(V){const p=E.n.Zero();return this.getFacetPositionToRef(V,p),p}getFacetPositionToRef(V,p){const W=this.getFacetLocalPositions()[V],N=this.getWorldMatrix();return E.n.TransformCoordinatesToRef(W,N,p),this}getFacetNormal(V){const p=E.n.Zero();return this.getFacetNormalToRef(V,p),p}getFacetNormalToRef(V,p){const W=this.getFacetLocalNormals()[V];return E.n.TransformNormalToRef(W,this.getWorldMatrix(),p),this}getFacetsAtLocalCoordinates(V,p,W){const N=this.getBoundingInfo(),d=this._internalAbstractMeshDataInfo._facetData,E=Math.floor((V-N.minimum.x*d.partitioningBBoxRatio)*d.subDiv.X*d.partitioningBBoxRatio/d.bbSize.x),z=Math.floor((p-N.minimum.y*d.partitioningBBoxRatio)*d.subDiv.Y*d.partitioningBBoxRatio/d.bbSize.y),S=Math.floor((W-N.minimum.z*d.partitioningBBoxRatio)*d.subDiv.Z*d.partitioningBBoxRatio/d.bbSize.z);return E<0||E>d.subDiv.max||z<0||z>d.subDiv.max||S<0||S>d.subDiv.max?null:d.facetPartitioning[E+d.subDiv.max*z+d.subDiv.max*d.subDiv.max*S]}getClosestFacetAtCoordinates(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const S=this.getWorldMatrix(),Q=E.i.Matrix[5];S.invertToRef(Q);const J=E.i.fb[8];E.n.TransformCoordinatesFromFloatsToRef(V,p,W,Q,J);const i=this.getClosestFacetAtLocalCoordinates(J.x,J.y,J.z,N,d,z);return N&&E.n.TransformCoordinatesFromFloatsToRef(N.x,N.y,N.z,S,N),i}getClosestFacetAtLocalCoordinates(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],E=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],z=null,S=0,Q=0,J=0,i=0,l=0,j=0,k=0,u=0;const f=this.getFacetLocalPositions(),O=this.getFacetLocalNormals(),U=this.getFacetsAtLocalCoordinates(V,p,W);if(!U)return null;let F,C,A,v=Number.MAX_VALUE,t=v;for(let e=0;e<U.length;e++)F=U[e],C=O[F],A=f[F],i=(V-A.x)*C.x+(p-A.y)*C.y+(W-A.z)*C.z,(!d||d&&E&&i>=0||d&&!E&&i<=0)&&(i=C.x*A.x+C.y*A.y+C.z*A.z,l=-(C.x*V+C.y*p+C.z*W-i)/(C.x*C.x+C.y*C.y+C.z*C.z),j=V+C.x*l,k=p+C.y*l,u=W+C.z*l,S=j-V,Q=k-p,J=u-W,t=S*S+Q*Q+J*J,t<v&&(v=t,z=F,N&&(N.x=j,N.y=k,N.z=u)));return z}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const V=this._internalAbstractMeshDataInfo._facetData;return V.facetDataEnabled&&(V.facetDataEnabled=!1,V.facetPositions=[],V.facetNormals=[],V.facetPartitioning=new Array,V.facetParameters=null,V.depthSortedIndices=new Uint32Array(0)),this}updateIndices(V,p){return this}createNormals(V){const p=this.getVerticesData(z.f.PositionKind),W=this.Zf();let N;return N=this.isVerticesDataPresent(z.f.NormalKind)?this.getVerticesData(z.f.NormalKind):[],S.b.ComputeNormals(p,W,N,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(z.f.NormalKind,N,V),this}alignWithNormal(V,p){p||(p=U.e.Y);const W=E.i.fb[0],N=E.i.fb[1];return E.n.CrossToRef(p,V,N),E.n.CrossToRef(V,N,W),this.rotationQuaternion?E.f.RotationQuaternionFromAxisToRef(W,V,N,this.rotationQuaternion):E.n.RotationFromAxisToRef(W,V,N,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,k.c)("EdgesRenderer")}enableEdgesRendering(V,p,W){throw(0,k.c)("EdgesRenderer")}gj(){return this._scene.fj.filter((V=>V.j===this))}}e.OCCLUSION_TYPE_NONE=0,e.OCCLUSION_TYPE_OPTIMISTIC=1,e.OCCLUSION_TYPE_STRICT=2,e.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,e.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,e.CULLINGSTRATEGY_STANDARD=0,e.si=1,e.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,e.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,N.c)([C.g.filter((function(){for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];let[N,d,E,z,S]=p;return!Array.isArray(N)&&!Array.isArray(d)&&!Array.isArray(E)&&!Array.isArray(z)&&!Array.isArray(S)}))],e,"_ApplySkeleton",null),(0,F.d)("BABYLON.AbstractMesh",e)},11553:(V,p,W)=>{"use strict";W.d(p,{e:()=>O});var N=W(11218),d=W(11257),E=W(11544),z=W(11291),S=W(11390),Q=W(11559),J=W(11402),i=W(10848),l=W(11209),j=W(11422),k=W(10900),u=W(11467),f=W(10870);class O{get boundingBias(){return this._boundingBias}set boundingBias(V){this._boundingBias?this._boundingBias.p(V):this._boundingBias=V.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(V){const p=new O(O.RandomId(),V.va());return p.Ca(V),p}get meshes(){return this._meshes}constructor(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=p||k.d.LastCreatedScene,this._scene&&(this.id=V,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=N,W?this.setAllVerticesData(W,N):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),d&&(this.Ca(d),d.Dj(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let V=0;V<this._meshes.length;V++)if(!this._meshes[V].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const V=new Set;for(const p in this._vertexBuffers)V.add(this._vertexBuffers[p].getWrapperBuffer());V.forEach((V=>{V._rebuild()}))}setAllVerticesData(V,p){V.applyToGeometry(this,p),this._notifyUpdate()}Ga(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0;W&&Array.isArray(p)&&(p=new Float32Array(p));const d=new z.f(this._engine,p,V,{updatable:W,postponeInternalCreation:0===this._meshes.length,stride:N,label:"Geometry_"+this.id+"_"+V});this.setVerticesBuffer(d)}removeVerticesData(V){this._vertexBuffers[V]&&(this._vertexBuffers[V].dispose(),delete this._vertexBuffers[V]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const d=V.getKind();this._vertexBuffers[d]&&W&&this._vertexBuffers[d].dispose(),V._buffer&&V._buffer._increaseReferences(),this._vertexBuffers[d]=V;const E=this._meshes,S=E.length;if(d===z.f.PositionKind){this._totalVertices=p??V._maxVerticesCount,this._updateExtend(V.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const W=this._extend&&this._extend.minimum||new N.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),d=this._extend&&this._extend.maximum||new N.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let V=0;V<S;V++){const p=E[V];p.buildBoundingInfo(W,d),p._createGlobalSubMesh(p.isUnIndexed),p.Dj(!0),p.synchronizeInstances()}}this._notifyUpdate(d)}updateVerticesDataDirectly(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=this.getVertexBuffer(V);d&&(d.updateDirectly(p,W,N),this._notifyUpdate(V))}updateVerticesData(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=this.getVertexBuffer(V);N&&(N.update(p),V===z.f.PositionKind&&this.Ea(W,p),this._notifyUpdate(V))}Ea(V,p){if(V&&this._updateExtend(p),this._resetPointsArrayCache(),V){const V=this._meshes;for(const p of V){p.hasBoundingInfo?p.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):p.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const V=p.dg;for(const p of V)p.refreshBoundingInfo()}}}_bind(V,p,W,N){if(!V)return;void 0===p&&(p=this._indexBuffer);const d=this.getVertexBuffers();if(!d)return;if(p!=this._indexBuffer||!this._vertexArrayObjects&&!N)return void this._engine.bindBuffers(d,p,V,W);const E=N||this._vertexArrayObjects,z=this._engine;E[V.key]||(E[V.key]=z.recordVertexArrayObject(d,p,V,W)),z.bindVertexArrayObject(E[V.key],p)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(V,p,W){const N=this.getVertexBuffer(V);return N?N.getFloatData(this._totalVertices,W||p&&1!==this._meshes.length):null}copyVerticesData(V,p){const W=this.getVertexBuffer(V);if(!W)return;p[V]||(p[V]=new Float32Array(this._totalVertices*W.getSize()));const N=W.getData();N&&function(V,p,W,N,d,E,S,Q){const J=p*z.f.GetTypeByteLength(W),i=S*p;if(Q.length!==i)throw new Error("Output length is not valid");if(W===z.f.FLOAT&&d===J)if(V instanceof Array){const p=N/4;Q.set(V,p)}else if(V instanceof ArrayBuffer){const p=new Float32Array(V,N,i);Q.set(p)}else{const p=V.byteOffset+N;if(p%4)return f.e.Warn("CopyFloatData: copied misaligned data."),void Q.set(new Float32Array(V.buffer.slice(p,p+4*i)));const W=new Float32Array(V.buffer,p,i);Q.set(W)}else z.f.ForEach(V,N,d,p,W,i,E,((V,p)=>Q[p]=V))}(N,W.getSize(),W.type,W.byteOffset,W.byteStride,W.normalized,this._totalVertices,p[V])}isVertexBufferUpdatable(V){const p=this._vertexBuffers[V];return!!p&&p.isUpdatable()}getVertexBuffer(V){return this.isReady()?this._vertexBuffers[V]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(V){return this._vertexBuffers?void 0!==this._vertexBuffers[V]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(V)}getVerticesDataKinds(){const V=[];let p;if(!this._vertexBuffers&&this._delayInfo)for(p in this._delayInfo)V.push(p);else for(p in this._vertexBuffers)V.push(p);return V}updateIndices(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const N=V.length!==this._indices.length;if(W||(this._indices=V.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,V,p),N)for(const V of this._meshes)V._createGlobalSubMesh(!0)}else this.setIndices(V,null,!0)}setIndexBuffer(V,p,W){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=V,this._totalVertices=p,this._totalIndices=W,V.is32Bits||(V.is32Bits=this._totalIndices>65535);for(const N of this._meshes)N._createGlobalSubMesh(!0),N.synchronizeInstances();this._notifyUpdate()}setIndices(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=V,this._indexBufferIsUpdatable=W,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,W,"Geometry_"+this.id+"_IndexBuffer")),void 0!=p&&(this._totalVertices=p);for(const d of this._meshes)d._createGlobalSubMesh(!N),d.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Zf(V,p){if(!this.isReady())return null;const W=this._indices;return p||V&&1!==this._meshes.length?W.slice():W}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;V&&this._vertexArrayObjects&&this._vertexArrayObjects[V.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[V.key]),delete this._vertexArrayObjects[V.key])}releaseForMesh(V,p){const W=this._meshes,N=W.indexOf(V);-1!==N&&(W.splice(N,1),this._vertexArrayObjects&&V._invalidateInstanceVertexArrayObject(),V._geometry=null,0===W.length&&p&&this.dispose())}Ca(V){if(V._geometry===this)return;const p=V._geometry;p&&p.releaseForMesh(V),this._vertexArrayObjects&&V._invalidateInstanceVertexArrayObject();const W=this._meshes;V._geometry=this,V._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),W.push(V),this.isReady()?this._applyToMesh(V):this._boundingInfo&&V.setBoundingInfo(this._boundingInfo)}_updateExtend(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!V&&(V=this.getVerticesData(z.f.PositionKind),!V))return;this._extend=(0,j.h)(V,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(V){const p=this._meshes.length;for(const W in this._vertexBuffers)1===p&&this._vertexBuffers[W].create(),W===z.f.PositionKind&&(this._extend||this._updateExtend(),V.buildBoundingInfo(this._extend.minimum,this._extend.maximum),V._createGlobalSubMesh(V.isUnIndexed),V.Ea());1===p&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),V._syncGeometryWithMorphTargetManager(),V.synchronizeInstances()}_notifyUpdate(V){this.onGeometryUpdated&&this.onGeometryUpdated(this,V),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const p of this._meshes)p._markSubMeshesAsAttributesDirty()}load(V,p){2!==this.delayLoadState&&(this.isReady()?p&&p():(this.delayLoadState=2,this._queueLoad(V,p)))}_queueLoad(V,p){this.delayLoadingFile&&(V.addPendingData(this),V._loadFile(this.delayLoadingFile,(W=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(W),this),this.delayLoadState=1,this._delayInfo=[],V.removePendingData(this);const N=this._meshes,d=N.length;for(let V=0;V<d;V++)this._applyToMesh(N[V]);p&&p()}),void 0,!0))}toLeftHanded(){const V=this.Zf(!1);if(null!=V&&V.length>0){for(let p=0;p<V.length;p+=3){const W=V[p+0];V[p+0]=V[p+2],V[p+2]=W}this.setIndices(V)}const p=this.getVerticesData(z.f.PositionKind,!1);if(null!=p&&p.length>0){for(let V=0;V<p.length;V+=3)p[V+2]=-p[V+2];this.Ga(z.f.PositionKind,p,!1)}const W=this.getVerticesData(z.f.NormalKind,!1);if(null!=W&&W.length>0){for(let V=0;V<W.length;V+=3)W[V+2]=-W[V+2];this.Ga(z.f.NormalKind,W,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const V=this.getVerticesData(z.f.PositionKind);if(!V||0===V.length)return!1;for(let p=3*this._positionsCache.length,W=this._positionsCache.length;p<V.length;p+=3,++W)this._positionsCache[W]=N.n.Tg(V,p);for(let p=0,W=0;p<V.length;p+=3,++W)this._positionsCache[W].set(V[0+p],V[1+p],V[2+p]);return this._positionsCache.length=V.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const W in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[W]);this._vertexArrayObjects={};const V=this._meshes,p=V.length;for(let W=0;W<p;W++)V[W]._invalidateInstanceVertexArrayObject()}}dispose(){const V=this._meshes,p=V.length;let W;for(W=0;W<p;W++)this.releaseForMesh(V[W]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const N in this._vertexBuffers)this._vertexBuffers[N].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const V=this._parentContainer.geometries.indexOf(this);V>-1&&this._parentContainer.geometries.splice(V,1),this._parentContainer=null}this._isDisposed=!0}i(V){const p=new E.b;p.indices=[];const W=this.Zf();if(W)for(let E=0;E<W.length;E++)p.indices.push(W[E]);let N,d=!1,z=!1;for(N in this._vertexBuffers){const V=this.getVerticesData(N);if(V&&(V instanceof Float32Array?p.set(new Float32Array(V),N):p.set(V.slice(0),N),!z)){const V=this.getVertexBuffer(N);V&&(d=V.isUpdatable(),z=!d)}}const S=new O(V,this._scene,p,d);for(N in S.delayLoadState=this.delayLoadState,S.delayLoadingFile=this.delayLoadingFile,S._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)S._delayInfo=S._delayInfo||[],S._delayInfo.push(N);return S._boundingInfo=new J.c(this._extend.minimum,this._extend.maximum),S}serialize(){const V={};return V.id=this.id,V.uniqueId=this.uniqueId,V.updatable=this._updatable,l.e&&l.e.HasTags(this)&&(V.tags=l.e.GetTags(this)),V}_toNumberArray(V){return Array.isArray(V)?V:Array.prototype.slice.call(V)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const V in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,V)&&(this._vertexBuffers[V]._buffer._data=null)}serializeVerticeData(){const V=this.serialize();return this.isVerticesDataPresent(z.f.PositionKind)&&(V.xa=this._toNumberArray(this.getVerticesData(z.f.PositionKind)),this.isVertexBufferUpdatable(z.f.PositionKind)&&(V.xa._updatable=!0)),this.isVerticesDataPresent(z.f.NormalKind)&&(V.ya=this._toNumberArray(this.getVerticesData(z.f.NormalKind)),this.isVertexBufferUpdatable(z.f.NormalKind)&&(V.ya._updatable=!0)),this.isVerticesDataPresent(z.f.TangentKind)&&(V.tangents=this._toNumberArray(this.getVerticesData(z.f.TangentKind)),this.isVertexBufferUpdatable(z.f.TangentKind)&&(V.tangents._updatable=!0)),this.isVerticesDataPresent(z.f.UVKind)&&(V.Aa=this._toNumberArray(this.getVerticesData(z.f.UVKind)),this.isVertexBufferUpdatable(z.f.UVKind)&&(V.Aa._updatable=!0)),this.isVerticesDataPresent(z.f.UV2Kind)&&(V.uvs2=this._toNumberArray(this.getVerticesData(z.f.UV2Kind)),this.isVertexBufferUpdatable(z.f.UV2Kind)&&(V.uvs2._updatable=!0)),this.isVerticesDataPresent(z.f.UV3Kind)&&(V.uvs3=this._toNumberArray(this.getVerticesData(z.f.UV3Kind)),this.isVertexBufferUpdatable(z.f.UV3Kind)&&(V.uvs3._updatable=!0)),this.isVerticesDataPresent(z.f.UV4Kind)&&(V.uvs4=this._toNumberArray(this.getVerticesData(z.f.UV4Kind)),this.isVertexBufferUpdatable(z.f.UV4Kind)&&(V.uvs4._updatable=!0)),this.isVerticesDataPresent(z.f.UV5Kind)&&(V.uvs5=this._toNumberArray(this.getVerticesData(z.f.UV5Kind)),this.isVertexBufferUpdatable(z.f.UV5Kind)&&(V.uvs5._updatable=!0)),this.isVerticesDataPresent(z.f.UV6Kind)&&(V.uvs6=this._toNumberArray(this.getVerticesData(z.f.UV6Kind)),this.isVertexBufferUpdatable(z.f.UV6Kind)&&(V.uvs6._updatable=!0)),this.isVerticesDataPresent(z.f.ColorKind)&&(V.za=this._toNumberArray(this.getVerticesData(z.f.ColorKind)),this.isVertexBufferUpdatable(z.f.ColorKind)&&(V.za._updatable=!0)),this.isVerticesDataPresent(z.f.MatricesIndicesKind)&&(V.matricesIndices=this._toNumberArray(this.getVerticesData(z.f.MatricesIndicesKind)),V.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(z.f.MatricesIndicesKind)&&(V.matricesIndices._updatable=!0)),this.isVerticesDataPresent(z.f.MatricesWeightsKind)&&(V.matricesWeights=this._toNumberArray(this.getVerticesData(z.f.MatricesWeightsKind)),this.isVertexBufferUpdatable(z.f.MatricesWeightsKind)&&(V.matricesWeights._updatable=!0)),V.indices=this._toNumberArray(this.Zf()),V}static ExtractFromMesh(V,p){const W=V._geometry;return W?W.i(p):null}static RandomId(){return i.e.RandomId()}static _GetGeometryByLoadedUniqueId(V,p){for(let W=0;W<p.geometries.length;W++)if(p.geometries[W]._loadedUniqueId===V)return p.geometries[W];return null}static _ImportGeometry(V,p){const W=p.va(),N=V.geometryUniqueId,E=V.geometryId;if(N||E){const V=N?this._GetGeometryByLoadedUniqueId(N,W):W.getGeometryById(E);V&&V.Ca(p)}else if(V instanceof ArrayBuffer){const W=p._binaryInfo;if(W.positionsAttrDesc&&W.positionsAttrDesc.count>0){const N=new Float32Array(V,W.positionsAttrDesc.offset,W.positionsAttrDesc.count);p.Ga(z.f.PositionKind,N,!1)}if(W.normalsAttrDesc&&W.normalsAttrDesc.count>0){const N=new Float32Array(V,W.normalsAttrDesc.offset,W.normalsAttrDesc.count);p.Ga(z.f.NormalKind,N,!1)}if(W.tangetsAttrDesc&&W.tangetsAttrDesc.count>0){const N=new Float32Array(V,W.tangetsAttrDesc.offset,W.tangetsAttrDesc.count);p.Ga(z.f.TangentKind,N,!1)}if(W.uvsAttrDesc&&W.uvsAttrDesc.count>0){const N=new Float32Array(V,W.uvsAttrDesc.offset,W.uvsAttrDesc.count);if(u.d)for(let V=1;V<N.length;V+=2)N[V]=1-N[V];p.Ga(z.f.UVKind,N,!1)}if(W.uvs2AttrDesc&&W.uvs2AttrDesc.count>0){const N=new Float32Array(V,W.uvs2AttrDesc.offset,W.uvs2AttrDesc.count);if(u.d)for(let V=1;V<N.length;V+=2)N[V]=1-N[V];p.Ga(z.f.UV2Kind,N,!1)}if(W.uvs3AttrDesc&&W.uvs3AttrDesc.count>0){const N=new Float32Array(V,W.uvs3AttrDesc.offset,W.uvs3AttrDesc.count);if(u.d)for(let V=1;V<N.length;V+=2)N[V]=1-N[V];p.Ga(z.f.UV3Kind,N,!1)}if(W.uvs4AttrDesc&&W.uvs4AttrDesc.count>0){const N=new Float32Array(V,W.uvs4AttrDesc.offset,W.uvs4AttrDesc.count);if(u.d)for(let V=1;V<N.length;V+=2)N[V]=1-N[V];p.Ga(z.f.UV4Kind,N,!1)}if(W.uvs5AttrDesc&&W.uvs5AttrDesc.count>0){const N=new Float32Array(V,W.uvs5AttrDesc.offset,W.uvs5AttrDesc.count);if(u.d)for(let V=1;V<N.length;V+=2)N[V]=1-N[V];p.Ga(z.f.UV5Kind,N,!1)}if(W.uvs6AttrDesc&&W.uvs6AttrDesc.count>0){const N=new Float32Array(V,W.uvs6AttrDesc.offset,W.uvs6AttrDesc.count);if(u.d)for(let V=1;V<N.length;V+=2)N[V]=1-N[V];p.Ga(z.f.UV6Kind,N,!1)}if(W.colorsAttrDesc&&W.colorsAttrDesc.count>0){const N=new Float32Array(V,W.colorsAttrDesc.offset,W.colorsAttrDesc.count);p.Ga(z.f.ColorKind,N,!1,W.colorsAttrDesc.stride)}if(W.matricesIndicesAttrDesc&&W.matricesIndicesAttrDesc.count>0){const N=new Int32Array(V,W.matricesIndicesAttrDesc.offset,W.matricesIndicesAttrDesc.count),d=[];for(let V=0;V<N.length;V++){const p=N[V];d.push(255&p),d.push((65280&p)>>8),d.push((16711680&p)>>16),d.push(p>>24&255)}p.Ga(z.f.MatricesIndicesKind,d,!1)}if(W.matricesIndicesExtraAttrDesc&&W.matricesIndicesExtraAttrDesc.count>0){const N=new Int32Array(V,W.matricesIndicesExtraAttrDesc.offset,W.matricesIndicesExtraAttrDesc.count),d=[];for(let V=0;V<N.length;V++){const p=N[V];d.push(255&p),d.push((65280&p)>>8),d.push((16711680&p)>>16),d.push(p>>24&255)}p.Ga(z.f.MatricesIndicesExtraKind,d,!1)}if(W.matricesWeightsAttrDesc&&W.matricesWeightsAttrDesc.count>0){const N=new Float32Array(V,W.matricesWeightsAttrDesc.offset,W.matricesWeightsAttrDesc.count);p.Ga(z.f.MatricesWeightsKind,N,!1)}if(W.indicesAttrDesc&&W.indicesAttrDesc.count>0){const N=new Int32Array(V,W.indicesAttrDesc.offset,W.indicesAttrDesc.count);p.setIndices(N,null)}if(W.subMeshesAttrDesc&&W.subMeshesAttrDesc.count>0){const N=new Int32Array(V,W.subMeshesAttrDesc.offset,5*W.subMeshesAttrDesc.count);p.dg=[];for(let V=0;V<W.subMeshesAttrDesc.count;V++){const W=N[5*V+0],d=N[5*V+1],E=N[5*V+2],z=N[5*V+3],Q=N[5*V+4];S.b.AddToMesh(W,d,E,z,Q,p)}}}else if(V.xa&&V.ya&&V.indices){if(p.Ga(z.f.PositionKind,V.xa,V.xa._updatable),p.Ga(z.f.NormalKind,V.ya,V.ya._updatable),V.tangents&&p.Ga(z.f.TangentKind,V.tangents,V.tangents._updatable),V.Aa&&p.Ga(z.f.UVKind,V.Aa,V.Aa._updatable),V.uvs2&&p.Ga(z.f.UV2Kind,V.uvs2,V.uvs2._updatable),V.uvs3&&p.Ga(z.f.UV3Kind,V.uvs3,V.uvs3._updatable),V.uvs4&&p.Ga(z.f.UV4Kind,V.uvs4,V.uvs4._updatable),V.uvs5&&p.Ga(z.f.UV5Kind,V.uvs5,V.uvs5._updatable),V.uvs6&&p.Ga(z.f.UV6Kind,V.uvs6,V.uvs6._updatable),V.za&&p.Ga(z.f.ColorKind,d.e.CheckColors4(V.za,V.xa.length/3),V.za._updatable),V.matricesIndices)if(V.matricesIndices._isExpanded)delete V.matricesIndices._isExpanded,p.Ga(z.f.MatricesIndicesKind,V.matricesIndices,V.matricesIndices._updatable);else{const W=[];for(let p=0;p<V.matricesIndices.length;p++){const N=V.matricesIndices[p];W.push(255&N),W.push((65280&N)>>8),W.push((16711680&N)>>16),W.push(N>>24&255)}p.Ga(z.f.MatricesIndicesKind,W,V.matricesIndices._updatable)}if(V.matricesIndicesExtra)if(V.matricesIndicesExtra._isExpanded)delete V.matricesIndices._isExpanded,p.Ga(z.f.MatricesIndicesExtraKind,V.matricesIndicesExtra,V.matricesIndicesExtra._updatable);else{const W=[];for(let p=0;p<V.matricesIndicesExtra.length;p++){const N=V.matricesIndicesExtra[p];W.push(255&N),W.push((65280&N)>>8),W.push((16711680&N)>>16),W.push(N>>24&255)}p.Ga(z.f.MatricesIndicesExtraKind,W,V.matricesIndicesExtra._updatable)}V.matricesWeights&&(O._CleanMatricesWeights(V,p),p.Ga(z.f.MatricesWeightsKind,V.matricesWeights,V.matricesWeights._updatable)),V.matricesWeightsExtra&&p.Ga(z.f.MatricesWeightsExtraKind,V.matricesWeightsExtra,V.matricesWeights._updatable),p.setIndices(V.indices,null)}if(V.dg){p.dg=[];for(let W=0;W<V.dg.length;W++){const N=V.dg[W];S.b.AddToMesh(N.materialIndex,N.verticesStart,N.verticesCount,N.indexStart,N.indexCount,p)}}p._shouldGenerateFlatShading&&(p.convertToFlatShadedMesh(),p._shouldGenerateFlatShading=!1),p.Dj(!0),W.onMeshImportedObservable.notifyObservers(p)}static _CleanMatricesWeights(V,p){const W=.001;if(!Q.d.CleanBoneMatrixWeights)return;let N=0;if(!(V.skeletonId>-1))return;{const W=p.va().getLastSkeletonById(V.skeletonId);if(!W)return;N=W.bones.length}const d=p.getVerticesData(z.f.MatricesIndicesKind),E=p.getVerticesData(z.f.MatricesIndicesExtraKind),S=V.matricesWeights,J=V.matricesWeightsExtra,i=V.numBoneInfluencer,l=S.length;for(let z=0;z<l;z+=4){let V=0,p=-1;for(let N=0;N<4;N++){const d=S[z+N];V+=d,d<W&&p<0&&(p=N)}if(J)for(let N=0;N<4;N++){const d=J[z+N];V+=d,d<W&&p<0&&(p=N+4)}if((p<0||p>i-1)&&(p=i-1),V>W){const p=1/V;for(let V=0;V<4;V++)S[z+V]*=p;if(J)for(let V=0;V<4;V++)J[z+V]*=p}else p>=4?(J[z+p-4]=1-V,E[z+p-4]=N):(S[z+p]=1-V,d[z+p]=N)}p.Ga(z.f.MatricesIndicesKind,d),V.matricesWeightsExtra&&p.Ga(z.f.MatricesIndicesExtraKind,E)}static Parse(V,p,W){const d=new O(V.id,p,void 0,V.updatable);return d._loadedUniqueId=V.uniqueId,l.e&&l.e.AddTagsTo(d,V.tags),V.delayLoadingFile?(d.delayLoadState=4,d.delayLoadingFile=W+V.delayLoadingFile,d._boundingInfo=new J.c(N.n.Tg(V.boundingBoxMinimum),N.n.Tg(V.boundingBoxMaximum)),d._delayInfo=[],V.hasUVs&&d._delayInfo.push(z.f.UVKind),V.hasUVs2&&d._delayInfo.push(z.f.UV2Kind),V.hasUVs3&&d._delayInfo.push(z.f.UV3Kind),V.hasUVs4&&d._delayInfo.push(z.f.UV4Kind),V.hasUVs5&&d._delayInfo.push(z.f.UV5Kind),V.hasUVs6&&d._delayInfo.push(z.f.UV6Kind),V.hasColors&&d._delayInfo.push(z.f.ColorKind),V.hasMatricesIndices&&d._delayInfo.push(z.f.MatricesIndicesKind),V.hasMatricesWeights&&d._delayInfo.push(z.f.MatricesWeightsKind),d._delayLoadingFunction=E.b.ImportVertexData):E.b.ImportVertexData(V,d),p.pushGeometry(d,!0),d}}},12535:(V,p,W)=>{"use strict";W.d(p,{b:()=>j});var N=W(11218),d=W(10870),E=W(11565),z=W(11510),S=W(10874),Q=W(11571),J=W(11291),i=W(10848),l=W(11004);z.e._instancedMeshFactory=(V,p)=>{const W=new j(V,p);if(p.instancedBuffers){W.instancedBuffers={};for(const V in p.instancedBuffers)W.instancedBuffers[V]=p.instancedBuffers[V]}return W};class j extends E.d{constructor(V,p){super(V,p.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,p.vj(this),this._sourceMesh=p,this._unIndexed=p._unIndexed,this.position.p(p.position),this.rotation.p(p.rotation),this.ie.p(p.ie),p.rotationQuaternion&&(this.rotationQuaternion=p.rotationQuaternion.clone()),this.animations=p.animations.slice();for(const W of p.getAnimationRanges())null!=W&&this.createAnimationRange(W.name,W.from,W.to);this.infiniteDistance=p.infiniteDistance,this.setPivotMatrix(p.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(V){var p;(null===(p=this._sourceMesh)||void 0===p?void 0:p.receiveShadows)!==V&&i.e.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(V){var p;(null===(p=this._sourceMesh)||void 0===p?void 0:p.material)!==V&&i.e.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(V){var p;(null===(p=this._sourceMesh)||void 0===p?void 0:p.visibility)!==V&&i.e.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(V){var p;(null===(p=this._sourceMesh)||void 0===p?void 0:p.skeleton)!==V&&i.e.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(V){this._sourceMesh&&V!==this._sourceMesh.renderingGroupId&&d.e.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(V){return this._sourceMesh.createInstance(V)}isReady(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(V,!0)}getVerticesData(V,p,W){return this._sourceMesh.getVerticesData(V,p,W)}copyVerticesData(V,p){this._sourceMesh.copyVerticesData(V,p)}Ga(V,p,W,N){return this.sourceMesh&&this.sourceMesh.Ga(V,p,W,N),this.sourceMesh}updateVerticesData(V,p,W,N){return this.sourceMesh&&this.sourceMesh.updateVerticesData(V,p,W,N),this.sourceMesh}setIndices(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(V,p),this.sourceMesh}isVerticesDataPresent(V){return this._sourceMesh.isVerticesDataPresent(V)}Zf(){return this._sourceMesh.Zf()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let V,p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;V="object"===typeof p?p:{applySkeleton:p,applyMorph:W};const N=this._sourceMesh.sj?this._sourceMesh.sj.boundingBias:null;return this.Fa(this._sourceMesh._getData(V,null,J.f.PositionKind),N),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(V,p){if(super._activate(V,p),this._sourceMesh.dg||d.e.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,V),p){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==Q.b.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new N.e);const V=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,N.i.fb[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Dj(!0)),this._currentLOD.position.p(N.i.fb[7]),this._currentLOD._masterMesh=V,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(V){if(!V)return this;const p=this.sourceMesh.getLODLevels();if(p&&0!==p.length){const p=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(V,p.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(V){return this.sourceMesh._preActivateForIntermediateRendering(V)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.dg)for(let V=0;V<this._sourceMesh.dg.length;V++)this._sourceMesh.dg[V].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0;const N=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(V);if(S.d.DeepCopy(this,N,["name","dg","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","ej","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),p&&(N.parent=p),!W)for(let d=0;d<this.va().meshes.length;d++){const V=this.va().meshes[d];V.parent===this&&V.clone(V.name,N)}return N.Dj(!0),this.onClonedObservable.notifyObservers(N),N}dispose(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.uj(this),super.dispose(V,p)}_serializeAsParent(V){super._serializeAsParent(V),V.parentId=this._sourceMesh.uniqueId,V.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;const N=this.clone("Clone of "+(this.name||this.id),V||this.parent,!0,p&&p.newSourcedMesh);N&&W&&W(this,N);for(const d of this.getChildTransformNodes(!0))d.instantiateHierarchy(N,p,W);return N}}z.e.prototype.registerInstancedBuffer=function(V,p){var W,N;if(null===(W=this._userInstancedBuffersStorage)||void 0===W||null===(N=W.vertexBuffers[V])||void 0===N||N.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const V of this.instances)V.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[V]=null,this._userInstancedBuffersStorage.strides[V]=p,this._userInstancedBuffersStorage.sizes[V]=32*p,this._userInstancedBuffersStorage.data[V]=new Float32Array(this._userInstancedBuffersStorage.sizes[V]),this._userInstancedBuffersStorage.vertexBuffers[V]=new J.f(this.getEngine(),this._userInstancedBuffersStorage.data[V],V,!0,!1,p,!0);for(const d of this.instances)d.instancedBuffers[V]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},z.e.prototype._processInstancedBuffers=function(V,p){const W=V?V.length:0;for(const N in this.instancedBuffers){let d=this._userInstancedBuffersStorage.sizes[N];const E=this._userInstancedBuffersStorage.strides[N],z=(W+1)*E;for(;d<z;)d*=2;this._userInstancedBuffersStorage.data[N].length!=d&&(this._userInstancedBuffersStorage.data[N]=new Float32Array(d),this._userInstancedBuffersStorage.sizes[N]=d,this._userInstancedBuffersStorage.vertexBuffers[N]&&(this._userInstancedBuffersStorage.vertexBuffers[N].dispose(),this._userInstancedBuffersStorage.vertexBuffers[N]=null));const S=this._userInstancedBuffersStorage.data[N];let Q=0;if(p){const V=this.instancedBuffers[N];V.toArray?V.toArray(S,Q):V.copyToArray?V.copyToArray(S,Q):S[Q]=V,Q+=E}for(let p=0;p<W;p++){const W=V[p].instancedBuffers[N];W.toArray?W.toArray(S,Q):W.copyToArray?W.copyToArray(S,Q):S[Q]=W,Q+=E}this._userInstancedBuffersStorage.vertexBuffers[N]?this._userInstancedBuffersStorage.vertexBuffers[N].updateDirectly(S,0):(this._userInstancedBuffersStorage.vertexBuffers[N]=new J.f(this.getEngine(),this._userInstancedBuffersStorage.data[N],N,!0,!1,E,!0),this._invalidateInstanceVertexArrayObject())}},z.e.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const V in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[V]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},z.e.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const V in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[V]&&this._userInstancedBuffersStorage.vertexBuffers[V].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,l.d)("BABYLON.InstancedMesh",j)},11510:(V,p,W)=>{"use strict";W.d(p,{e:()=>P,f:()=>K});var N=W(10856),d=W(10848),E=W(10874),z=W(11209),S=W(11515),Q=W(11524),J=W(11218),i=W(11257),l=W(11529),j=W(11291),k=W(11544),u=W(11553),f=W(11565),O=W(11390),U=W(11387),F=W(11582),C=W(11559),A=W(11265),v=W(10870),t=W(11004),e=W(10887),Z=W(11321);class o{constructor(V,p){this.distanceOrScreenCoverage=V,this.mesh=p}}class K{}class h{constructor(){this.visibleInstances={},this.batchCache=new L,this.batchCacheReplacementModeInFrozenMode=new L,this.instancesBufferSize=2048}}class L{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class x{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class T{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class P extends f.d{static _GetDefaultSideOrientation(V){return V||P.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(V){this._internalMeshDataInfo._useLODScreenCoverage=V,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(V){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==V&&(V&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(j.f.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(j.f.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=V,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new N.b),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new N.b),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new N.b),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new N.b),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new N.b),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(V){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(V)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(V){this._internalMeshDataInfo._forcedInstanceCount=V}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(V){this._internalMeshDataInfo._sideOrientation=V,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===V||!this._scene.useRightHandedSystem&&0===V}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(V){this.sideOrientation=V,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(V){this._internalMeshDataInfo._overrideRenderingFillMode=V}get material(){return this._internalAbstractMeshDataInfo._material}set material(V){V&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(V.sideOrientation=null),this._setMaterial(V)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(V){this._unIndexed!==V&&(this._unIndexed=V,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(V){this._instanceDataStorage.manualUpdate=V}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(V){this._instanceDataStorage.previousManualUpdate=V}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(V){this._instanceDataStorage.forceMatrixUpdates=V}_copySource(V,p){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const N=this.va();if(V._geometry&&V._geometry.Ca(this),E.d.DeepCopy(V,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","sj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","ej","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=V,N.useClonedMeshMap&&(V._internalMeshDataInfo.meshMap||(V._internalMeshDataInfo.meshMap={}),V._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=V._originalBuilderSideOrientation,this._creationDataStorage=V._creationDataStorage,V._ranges){const p=V._ranges;for(const V in p)Object.prototype.hasOwnProperty.call(p,V)&&p[V]&&this.createAnimationRange(V,p[V].from,p[V].to)}if(V.metadata&&V.metadata.clone?this.metadata=V.metadata.clone():this.metadata=V.metadata,this._internalMetadata=V._internalMetadata,z.e&&z.e.HasTags(V)&&z.e.AddTagsTo(this,z.e.GetTags(V,!0)),this.Ab(V.isEnabled(!1)),this.parent=V.parent,this.setPivotMatrix(V.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+V.id,this.material=V.material,!p){const p=V.getDescendants(!0);for(let V=0;V<p.length;V++){const W=p[V];W.clone&&W.clone(this.name+"."+W.name,this)}}if(V.morphTargetManager&&(this.morphTargetManager=V.morphTargetManager),N.getPhysicsEngine){const p=N.getPhysicsEngine();if(W&&p)if(1===p.getPluginVersion()){const W=p.getImpostorForPhysicsObject(V);W&&(this.physicsImpostor=W.clone(this))}else 2===p.getPluginVersion()&&V.physicsBody&&V.physicsBody.clone(this)}for(let d=0;d<N.fj.length;d++){const p=N.fj[d];p.j===V&&p.clone(p.name,this)}this.skeleton=V.skeleton,this.refreshBoundingInfo(!0,!0),this.Dj(!0)}constructor(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4?arguments[4]:void 0,z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(V,p),this._internalMeshDataInfo=new T,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new h,this._thinInstanceDataStorage=new x,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=P.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,p=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(V,p,W)=>{V&&W&&(this._uniformBuffer?this.transferToEffect(p):W.bindOnlyWorldMatrix(p))},d&&this._copySource(d,E,z),null!==W&&(this.parent=W),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=V=>{V.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new N.b(this._internalMeshDataInfo._onMeshReadyObserverAdded),d&&d.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;const N=0===this.getTotalVertices()||p&&p.doNotInstantiate&&(!0===p.doNotInstantiate||p.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),V||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));N.parent=V||this.parent,N.position=this.position.clone(),N.ie=this.ie.clone(),this.rotationQuaternion?N.rotationQuaternion=this.rotationQuaternion.clone():N.rotation=this.rotation.clone(),W&&W(this,N);for(const d of this.getChildTransformNodes(!0))"InstancedMesh"===d.getClassName()&&"Mesh"===N.getClassName()&&d.sourceMesh===this?d.instantiateHierarchy(N,{doNotInstantiate:p&&p.doNotInstantiate||!1,newSourcedMesh:N},W):d.instantiateHierarchy(N,p,W);return N}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(V){let p=super.toString(V);if(p+=", n vertices: "+this.getTotalVertices(),p+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let W=0;W<this.animations.length;W++)p+=", animation[0]: "+this.animations[W].toString(V);if(V)if(this._geometry){const V=this.Zf(),W=this.getVerticesData(j.f.PositionKind);W&&V&&(p+=", flat shading: "+(W.length/3===V.length?"YES":"NO"))}else p+=", flat shading: UNKNOWN";return p}_unBindEffect(){super._unBindEffect();for(const V of this.instances)V._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const V=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((p,W)=>p.distanceOrScreenCoverage<W.distanceOrScreenCoverage?V:p.distanceOrScreenCoverage>W.distanceOrScreenCoverage?-V:0))}addLODLevel(V,p){if(p&&p._masterMesh)return v.e.Warn("You cannot use a mesh as LOD level twice"),this;const W=new o(V,p);return this._internalMeshDataInfo._LODLevels.push(W),p&&(p._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(V){const p=this._internalMeshDataInfo;for(let W=0;W<p._LODLevels.length;W++){const N=p._LODLevels[W];if(N.distanceOrScreenCoverage===V)return N.mesh}return null}removeLODLevel(V){const p=this._internalMeshDataInfo;for(let W=0;W<p._LODLevels.length;W++)p._LODLevels[W].mesh===V&&(p._LODLevels.splice(W,1),V&&(V._masterMesh=null));return this._sortLODLevels(),this}getLOD(V,p){const W=this._internalMeshDataInfo;if(!W._LODLevels||0===W._LODLevels.length)return this;const N=p||this.getBoundingInfo().boundingSphere,d=V.mode===Q.d.ORTHOGRAPHIC_CAMERA?V.Li:N.centerWorld.ed(V.globalPosition).length();let E=d,z=1;if(W._useLODScreenCoverage){const p=V.screenArea;let W=N.radiusWorld*V.Li/d;W=W*W*Math.PI,E=W/p,z=-1}if(z*W._LODLevels[W._LODLevels.length-1].distanceOrScreenCoverage>z*E)return this.onLODLevelSelection&&this.onLODLevelSelection(E,this,this),this;for(let S=0;S<W._LODLevels.length;S++){const V=W._LODLevels[S];if(z*V.distanceOrScreenCoverage<z*E){if(V.mesh){if(4===V.mesh.delayLoadState)return V.mesh._checkDelayState(),this;if(2===V.mesh.delayLoadState)return this;V.mesh._preActivate(),V.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(E,this,V.mesh),V.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(E,this,this),this}get sj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(V,p,W,N){var d,E;if(!this._geometry)return null;let z=N||null===(d=this._userInstancedBuffersStorage)||void 0===d||null===(E=d.vertexBuffers[V])||void 0===E?void 0:E.getFloatData(this.instances.length+1,W||p&&1!==this._geometry.meshes.length);return z||(z=this._geometry.getVerticesData(V,p,W)),z}copyVerticesData(V,p){this._geometry&&this._geometry.copyVerticesData(V,p)}getVertexBuffer(V,p){var W;return this._geometry?(p||null===(W=this._userInstancedBuffersStorage)||void 0===W?void 0:W.vertexBuffers[V])??this._geometry.getVertexBuffer(V):null}isVerticesDataPresent(V,p){var W;return this._geometry?!p&&void 0!==(null===(W=this._userInstancedBuffersStorage)||void 0===W?void 0:W.vertexBuffers[V])||this._geometry.isVerticesDataPresent(V):!!this._delayInfo&&-1!==this._delayInfo.indexOf(V)}isVertexBufferUpdatable(V,p){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(V);if(!p){var W;const p=null===(W=this._userInstancedBuffersStorage)||void 0===W?void 0:W.vertexBuffers[V];if(p)return p.isUpdatable()}return this._geometry.isVertexBufferUpdatable(V)}getVerticesDataKinds(V){if(!this._geometry){const V=[];return this._delayInfo&&this._delayInfo.forEach((function(p){V.push(p)})),V}const p=this._geometry.getVerticesDataKinds();if(!V&&this._userInstancedBuffersStorage)for(const W in this._userInstancedBuffersStorage.vertexBuffers)-1===p.indexOf(W)&&p.push(W);return p}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Zf(V,p){return this._geometry?this._geometry.Zf(V,p):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(V))return!1;if(!this.dg||0===this.dg.length)return!0;if(!V)return!0;const W=this.getEngine(),N=this.va(),d=p||W.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Dj();const E=this.material||N.defaultMaterial;if(E)if(E._storeEffectOnSubMeshes)for(const j of this.dg){const V=j.Ha();if(V)if(V._storeEffectOnSubMeshes){if(!V.isReadyForSubMesh(this,j,d))return!1}else if(!V.isReady(this,d))return!1}else if(!E.isReady(this,d))return!1;const z=W.currentRenderPassId;for(const j of this.lightSources){const V=j.getShadowGenerators();if(!V)continue;const p=V.values();for(let N=p.next();!0!==N.done;N=p.next()){var S,Q,J,i;const V=N.value;if(V&&(null===(S=V.getShadowMap())||void 0===S||!S.renderList||null!==(Q=V.getShadowMap())&&void 0!==Q&&Q.renderList&&-1!==(null===(J=V.getShadowMap())||void 0===J||null===(i=J.renderList)||void 0===i?void 0:i.indexOf(this)))){const p=V.getShadowMap().renderPassIds??[W.currentRenderPassId];for(let N=0;N<p.length;++N){W.currentRenderPassId=p[N];for(const p of this.dg){var l;if(!V.isReady(p,d,(null===(l=p.Ha())||void 0===l?void 0:l.needAlphaBlendingForMesh(this))??!1))return W.currentRenderPassId=z,!1}}W.currentRenderPassId=z}}}for(const j of this._internalMeshDataInfo._LODLevels)if(j.mesh&&!j.mesh.isReady(d))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Dh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(V){this._instanceDataStorage.overridenInstanceCount=V}_preActivate(){const V=this._internalMeshDataInfo,p=this.va().getRenderId();return V._preActivateId===p||(V._preActivateId=p,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(V){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=V),this}_registerInstanceForRenderId(V,p){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:p,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[p]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=p,this._instanceDataStorage.visibleInstances[p]=new Array),this._instanceDataStorage.visibleInstances[p].push(V),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let V,p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;V="object"===typeof p?p:{applySkeleton:p,applyMorph:W};const N=this.sj?this.sj.boundingBias:null;return this.Fa(this._getData(V,null,j.f.PositionKind),N),this}_createGlobalSubMesh(V){const p=this.getTotalVertices();if(!p||!this.Zf())return null;if(this.dg&&this.dg.length>0){const W=this.Zf();if(!W)return null;const N=W.length;let d=!1;if(V)d=!0;else for(const V of this.dg){if(V.indexStart+V.indexCount>N){d=!0;break}if(V.verticesStart+V.verticesCount>p){d=!0;break}}if(!d)return this.dg[0]}return this.releaseSubMeshes(),new O.b(0,0,p,0,this.getTotalIndices(),this)}subdivide(V){if(V<1)return;const p=this.getTotalIndices();let W=p/V|0,N=0;for(;W%3!==0;)W++;this.releaseSubMeshes();for(let d=0;d<V&&!(N>=p);d++)O.b.CreateFromIndices(0,N,d===V-1?p-N:W,this,void 0,!1),N+=W;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(V,p,W,N);else{const N=new k.b;N.set(p,V);const d=this.va();new u.e(u.e.RandomId(),d,N,W,this)}return this}removeVerticesData(V){this._geometry&&this._geometry.removeVerticesData(V)}markVerticesDataAsUpdatable(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const W=this.getVertexBuffer(V);W&&W.isUpdatable()!==p&&this.Ga(V,this.getVerticesData(V),p)}setVerticesBuffer(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=u.e.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(V,null,p),this}updateVerticesData(V,p,W,N){return this._geometry?(N?(this.makeGeometryUnique(),this.updateVerticesData(V,p,W,!1)):this._geometry.updateVerticesData(V,p,W),this):this}updateMeshPositions(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const W=this.getVerticesData(j.f.PositionKind);if(!W)return this;if(V(W),this.updateVerticesData(j.f.PositionKind,W,!1,!1),p){const V=this.Zf(),p=this.getVerticesData(j.f.NormalKind);if(!p)return this;k.b.ComputeNormals(W,V,p),this.updateVerticesData(j.f.NormalKind,p,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const V=this._geometry,p=this._geometry.i(u.e.RandomId());return V.releaseForMesh(this,!0),p.Ca(this),this}setIndexBuffer(V,p,W){let N=this._geometry;N||(N=new u.e(u.e.RandomId(),this.va(),void 0,void 0,this)),N.setIndexBuffer(V,p,W)}setIndices(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(V,p,W,N);else{const p=new k.b;p.indices=V;const N=this.va();new u.e(u.e.RandomId(),N,p,W,this)}return this}updateIndices(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(V,p,W),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(V,p,W){let N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const d=this.va().getEngine();let E;if(this._unIndexed)if(this._getRenderingFillMode(W)===U.d.WireFrameFillMode)E=V._getLinesIndexBuffer(this.Zf(),d);else E=null;else switch(this._getRenderingFillMode(W)){case U.d.PointFillMode:E=null;break;case U.d.WireFrameFillMode:E=V._getLinesIndexBuffer(this.Zf(),d);break;default:case U.d.TriangleFillMode:E=this._geometry.getIndexBuffer()}return this._bindDirect(p,E,N)}_bindDirect(V,p){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(V),W&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(V,p,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(V,p),this):this}_draw(V,p,W){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const N=this.va().getEngine();return this._unIndexed&&p!==U.d.WireFrameFillMode||p==U.d.PointFillMode?N.drawArraysType(p,V.verticesStart,V.verticesCount,this.forcedInstanceCount||W):p==U.d.WireFrameFillMode?N.drawElementsType(p,0,V._linesIndexCount,this.forcedInstanceCount||W):N.drawElementsType(p,V.indexStart,V.indexCount,this.forcedInstanceCount||W),this}registerBeforeRender(V){return this.onBeforeRenderObservable.add(V),this}unregisterBeforeRender(V){return this.onBeforeRenderObservable.removeCallback(V),this}registerAfterRender(V){return this.onAfterRenderObservable.add(V),this}unregisterAfterRender(V){return this.onAfterRenderObservable.removeCallback(V),this}_getInstancesRenderList(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(p)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[V]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[V]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const W=this.va(),N=W._isInIntermediateRendering(),d=N?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,E=this._instanceDataStorage.batchCache;if(E.mustReturn=!1,E.renderSelf[V]=p||!d&&this.isEnabled()&&this.isVisible,E.visibleInstances[V]=null,this._instanceDataStorage.visibleInstances&&!p){const p=this._instanceDataStorage.visibleInstances,d=W.getRenderId(),z=N?p.intermediateDefaultRenderId:p.defaultRenderId;E.visibleInstances[V]=p[d],!E.visibleInstances[V]&&z&&(E.visibleInstances[V]=p[z])}return E.hardwareInstancedRendering[V]=!p&&this._instanceDataStorage.hardwareInstancedRendering&&null!==E.visibleInstances[V]&&void 0!==E.visibleInstances[V],this._instanceDataStorage.previousBatch=E,E}_renderWithInstances(V,p,W,N,d){const E=W.visibleInstances[V._id],z=E?E.length:0,S=this._instanceDataStorage,Q=S.instancesBufferSize;let i=S.instancesBuffer,l=S.instancesPreviousBuffer;const k=16*(z+1)*4;for(;S.instancesBufferSize<k;)S.instancesBufferSize*=2;S.instancesData&&Q==S.instancesBufferSize||(S.instancesData=new Float32Array(S.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!S.instancesPreviousData||Q!=S.instancesBufferSize)&&(S.instancesPreviousData=new Float32Array(S.instancesBufferSize/4));let u=0,f=0;const O=W.renderSelf[V._id],U=!i||Q!==S.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!S.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||S.isFrozen&&!U)f=(O?1:0)+z;else{const p=this.getWorldMatrix();if(O&&(this._scene.needsPreviousWorldMatrices&&(S.masterMeshPreviousWorldMatrix?(S.masterMeshPreviousWorldMatrix.copyToArray(S.instancesPreviousData,u),S.masterMeshPreviousWorldMatrix.p(p)):(S.masterMeshPreviousWorldMatrix=p.clone(),S.masterMeshPreviousWorldMatrix.copyToArray(S.instancesPreviousData,u))),p.copyToArray(S.instancesData,u),u+=16,f++),E){var F;if(P.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(F=V.Ha())&&void 0!==F&&F.needAlphaBlendingForMesh(V.getRenderingMesh())){const V=this._scene.activeCamera.globalPosition;for(let p=0;p<E.length;p++){const W=E[p];W._distanceToCamera=J.n.Distance(W.getBoundingInfo().boundingSphere.centerWorld,V)}E.sort(((V,p)=>V._distanceToCamera>p._distanceToCamera?-1:V._distanceToCamera<p._distanceToCamera?1:0))}for(let V=0;V<E.length;V++){const p=E[V],W=p.getWorldMatrix();W.copyToArray(S.instancesData,u),this._scene.needsPreviousWorldMatrices&&(p._previousWorldMatrix?(p._previousWorldMatrix.copyToArray(S.instancesPreviousData,u),p._previousWorldMatrix.p(W)):(p._previousWorldMatrix=W.clone(),p._previousWorldMatrix.copyToArray(S.instancesPreviousData,u))),u+=16,f++}}}return U?(i&&i.dispose(),l&&l.dispose(),i=new j.c(d,S.instancesData,!0,16,!1,!0),S.instancesBuffer=i,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=i.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=i.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=i.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=i.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(l=new j.c(d,S.instancesPreviousData,!0,16,!1,!0),S.instancesPreviousBuffer=l,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=l.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=l.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=l.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=l.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(i.updateDirectly(S.instancesData,0,f),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||l.updateDirectly(S.instancesPreviousData,0,f)),this._processInstancedBuffers(E,O),this.va()._activeIndices.addCount(V.indexCount*f,!1),d._currentDrawContext&&(d._currentDrawContext.useInstancing=!0),this._bind(V,N,p),this._draw(V,p,f),!this._scene.needsPreviousWorldMatrices||U||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||l.updateDirectly(S.instancesData,0,f),d.unbindInstanceAttributes(),this}_renderWithThinInstances(V,p,W,N){var d;const E=(null===(d=this._thinInstanceDataStorage)||void 0===d?void 0:d.instancesCount)??0;this.va()._activeIndices.addCount(V.indexCount*E,!1),N._currentDrawContext&&(N._currentDrawContext.useInstancing=!0),this._bind(V,W,p),this._draw(V,p,E),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,E):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),N.unbindInstanceAttributes()}_processInstancedBuffers(V,p){}_processRendering(V,p,W,N,d,E,z,S){const Q=this.va(),J=Q.getEngine();if(N=this._getRenderingFillMode(N),E&&p.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(p,N,W,J),this;if(E)this._renderWithInstances(p,N,d,W,J);else{J._currentDrawContext&&(J._currentDrawContext.useInstancing=!1);let W=0;d.renderSelf[p._id]&&(z&&z(!1,V.getWorldMatrix(),S),W++,this._draw(p,N,this._instanceDataStorage.overridenInstanceCount));const E=d.visibleInstances[p._id];if(E){const V=E.length;W+=V;for(let W=0;W<V;W++){const V=E[W].getWorldMatrix();z&&z(!0,V,S),this._draw(p,N)}}Q._activeIndices.addCount(p.indexCount*W,!1)}return this}_rebuild(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(V&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const p in this._userInstancedBuffersStorage.vertexBuffers){const W=this._userInstancedBuffersStorage.vertexBuffers[p];W&&(V&&W.dispose(),this._userInstancedBuffersStorage.vertexBuffers[p]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(V)}_freeze(){if(this.dg){for(let V=0;V<this.dg.length;V++)this._getInstancesRenderList(V);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(V,p,W,N){let d=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const E=this._scene.getEngine(),z=E.currentRenderPassId;if(void 0!==V&&(E.currentRenderPassId=V),N)(!d||d&&N.isInFrustum(this._scene._frustumPlanes))&&this.render(N,!!p,W);else for(let S=0;S<this.dg.length;S++){const V=this.dg[S];(!d||d&&V.isInFrustum(this._scene._frustumPlanes))&&this.render(V,!!p,W)}return void 0!==V&&(E.currentRenderPassId=z),this}directRender(){if(!this.dg)return this;for(const V of this.dg)this.render(V,!1);return this}render(V,p,W){var N,d,E;const z=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const S=(null===(N=z.activeCameras)||void 0===N?void 0:N.length)??0;if((S>1&&z.activeCamera===z.activeCameras[0]||S<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const Q=this._getInstancesRenderList(V._id,!!W);if(Q.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const J=z.getEngine();let i=0,l=null;this.ignoreCameraMaxZ&&z.activeCamera&&!z._isInIntermediateRendering()&&(i=z.activeCamera.maxZ,l=z.activeCamera,z.activeCamera.maxZ=0,z.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const j=V.getRenderingMesh(),k=Q.hardwareInstancedRendering[V._id]||j.hasThinInstances||!!this._userInstancedBuffersStorage&&!V.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,u=this._instanceDataStorage,f=V.Ha();if(!f)return l&&(l.maxZ=i,z.updateTransformMatrix(!0)),this;if(u.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===f){if(f._storeEffectOnSubMeshes&&(null===(d=V._drawWrapper)||void 0===d||!d._wasPreviouslyReady)||!f._storeEffectOnSubMeshes&&!f._getDrawWrapper()._wasPreviouslyReady)return l&&(l.maxZ=i,z.updateTransformMatrix(!0)),this}else{if(f._storeEffectOnSubMeshes){if(!f.isReadyForSubMesh(this,V,k))return l&&(l.maxZ=i,z.updateTransformMatrix(!0)),this}else if(!f.isReady(this,k))return l&&(l.maxZ=i,z.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=f}let O;p&&J.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),O=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?V._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const F=(null===(E=O)||void 0===E?void 0:E.effect)??null;for(const U of z._beforeRenderingMeshStage)U.action(this,V,Q,F);if(!O||!F)return l&&(l.maxZ=i,z.updateTransformMatrix(!0)),this;const C=W||this;let A;if(u.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.eh&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)A=u.sideOrientation;else{const V=C._getWorldMatrixDeterminant();A=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),V<0&&(A=A===U.d.ClockWiseSideOrientation?U.d.CounterClockWiseSideOrientation:U.d.ClockWiseSideOrientation),u.sideOrientation=A}const v=this._internalMeshDataInfo._effectiveMaterial._preBind(O,A);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&J.setDepthWrite(!0);const t=this._internalMeshDataInfo._effectiveMaterial,e=t.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),k||this._bind(V,F,e,!1);const Z=C.getWorldMatrix();t._storeEffectOnSubMeshes?t.bindForSubMesh(Z,this,V):t.bind(Z,this),!t.eh&&t.separateCullingPass&&(J.setState(!0,t.zOffset,!1,!v,t.cullBackFaces,t.stencil,t.zOffsetUnits),this._processRendering(this,V,F,e,Q,k,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),J.setState(!0,t.zOffset,!1,v,t.cullBackFaces,t.stencil,t.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(V)),this._processRendering(this,V,F,e,Q,k,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const U of z._afterRenderingMeshStage)U.action(this,V,Q,F);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),l&&(l.maxZ=i,z.updateTransformMatrix(!0)),2!==z.performancePriority||u.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(j.f.MatricesWeightsKind)&&(this.isVerticesDataPresent(j.f.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const V=this.getVerticesData(j.f.MatricesWeightsKind),p=V.length;for(let W=0;W<p;W+=4){const p=V[W]+V[W+1]+V[W+2]+V[W+3];if(0===p)V[W]=1;else{const N=1/p;V[W]*=N,V[W+1]*=N,V[W+2]*=N,V[W+3]*=N}}this.Ga(j.f.MatricesWeightsKind,V)}_normalizeSkinWeightsAndExtra(){const V=this.getVerticesData(j.f.MatricesWeightsExtraKind),p=this.getVerticesData(j.f.MatricesWeightsKind),W=p.length;for(let N=0;N<W;N+=4){let W=p[N]+p[N+1]+p[N+2]+p[N+3];if(W+=V[N]+V[N+1]+V[N+2]+V[N+3],0===W)p[N]=1;else{const d=1/W;p[N]*=d,p[N+1]*=d,p[N+2]*=d,p[N+3]*=d,V[N]*=d,V[N+1]*=d,V[N+2]*=d,V[N+3]*=d}}this.Ga(j.f.MatricesWeightsKind,p),this.Ga(j.f.MatricesWeightsKind,V)}validateSkinning(){const V=this.getVerticesData(j.f.MatricesWeightsExtraKind),p=this.getVerticesData(j.f.MatricesWeightsKind);if(null===p||null==this.skeleton)return{skinned:!1,valid:!0,Yl:"not skinned"};const W=p.length;let N=0,d=0,E=0,z=0;const S=null===V?4:8,Q=[];for(let j=0;j<=S;j++)Q[j]=0;for(let j=0;j<W;j+=4){let W=p[j],J=W,i=0===J?0:1;for(let d=1;d<S;d++){const E=d<4?p[j+d]:V[j+d-4];E>W&&N++,0!==E&&i++,J+=E,W=E}if(Q[i]++,i>E&&(E=i),0===J)d++;else{const W=1/J;let N=0;for(let d=0;d<S;d++)N+=d<4?Math.abs(p[j+d]-p[j+d]*W):Math.abs(V[j+d-4]-V[j+d-4]*W);N>.001&&z++}}const J=this.skeleton.bones.length,i=this.getVerticesData(j.f.MatricesIndicesKind),l=this.getVerticesData(j.f.MatricesIndicesExtraKind);let k=0;for(let j=0;j<W;j+=4)for(let V=0;V<S;V++){const p=V<4?i[j+V]:l[j+V-4];(p>=J||p<0)&&k++}return{skinned:!0,valid:0===d&&0===z&&0===k,Yl:"Number of Weights = "+W/4+"\nMaximum influences = "+E+"\nMissing Weights = "+d+"\nNot Sorted = "+N+"\nNot Normalized = "+z+"\nWeightCounts = ["+Q+"]\nNumber of bones = "+J+"\nBad Bone Indices = "+k}}_checkDelayState(){const V=this.va();return this._geometry?this._geometry.load(V):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(V)),this}_queueLoad(V){V.addPendingData(this);const p=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return d.e.LoadFile(this.delayLoadingFile,(p=>{p instanceof ArrayBuffer?this._delayLoadingFunction(p,this):this._delayLoadingFunction(JSON.parse(p),this),this.instances.forEach((V=>{V.refreshBoundingInfo(),V._syncSubMeshes()})),this.delayLoadState=1,V.removePendingData(this)}),(()=>{}),V.offlineProvider,p),this}isInFrustum(V){return 2!==this.delayLoadState&&(!!super.isInFrustum(V)&&(this._checkDelayState(),!0))}setMaterialById(V){const p=this.va().materials;let W;for(W=p.length-1;W>-1;W--)if(p[W].id===V)return this.material=p[W],this;const N=this.va().multiMaterials;for(W=N.length-1;W>-1;W--)if(N[W].id===V)return this.material=N[W],this;return this}getAnimatables(){const V=[];return this.material&&V.push(this.material),this.skeleton&&V.push(this.skeleton),V}bakeTransformIntoVertices(V){if(!this.isVerticesDataPresent(j.f.PositionKind))return this;const p=this.dg.splice(0);this._resetPointsArrayCache();let W=this.getVerticesData(j.f.PositionKind);const N=J.n.Zero();let d;for(d=0;d<W.length;d+=3)J.n.TransformCoordinatesFromFloatsToRef(W[d],W[d+1],W[d+2],V,N).toArray(W,d);if(this.Ga(j.f.PositionKind,W,this.getVertexBuffer(j.f.PositionKind).isUpdatable()),this.isVerticesDataPresent(j.f.NormalKind)){for(W=this.getVerticesData(j.f.NormalKind),d=0;d<W.length;d+=3)J.n.TransformNormalFromFloatsToRef(W[d],W[d+1],W[d+2],V,N).normalize().toArray(W,d);this.Ga(j.f.NormalKind,W,this.getVertexBuffer(j.f.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(j.f.TangentKind)){for(W=this.getVerticesData(j.f.TangentKind),d=0;d<W.length;d+=4)J.n.TransformNormalFromFloatsToRef(W[d],W[d+1],W[d+2],V,N).normalize().toArray(W,d);this.Ga(j.f.TangentKind,W,this.getVertexBuffer(j.f.TangentKind).isUpdatable())}return V.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.dg=p,this}bakeCurrentTransformIntoVertices(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Dj(!0)),this.resetLocalMatrix(V),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0,W=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new P(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),V,this,p,W)}dispose(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const W=this._internalMeshDataInfo;if(W._onBeforeDrawObservable&&W._onBeforeDrawObservable.clear(),W._onBeforeBindObservable&&W._onBeforeBindObservable.clear(),W._onBeforeRenderObservable&&W._onBeforeRenderObservable.clear(),W._onAfterRenderObservable&&W._onAfterRenderObservable.clear(),W._onBetweenPassObservable&&W._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(W.meshMap)for(const V in W.meshMap){const p=W.meshMap[V];p&&(p._internalMeshDataInfo._source=null,W.meshMap[V]=void 0)}W._source&&W._source._internalMeshDataInfo.meshMap&&(W._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const V=this.va().meshes;for(const p of V){const V=p;V._internalMeshDataInfo&&V._internalMeshDataInfo._source&&V._internalMeshDataInfo._source===this&&(V._internalMeshDataInfo._source=null)}}W._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(V,p)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(V,p,W,N,E,z){let S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7?arguments[7]:void 0;const J=this.va();return d.e.LoadImage(V,(V=>{const d=V.width,Q=V.height,J=this.getEngine().createCanvas(d,Q).getContext("2d");J.drawImage(V,0,0);const i=J.getImageData(0,0,d,Q).data;this.applyDisplacementMapFromBuffer(i,d,Q,p,W,E,z,S),N&&N(this)}),Q||(()=>{}),J.offlineProvider),this}applyDisplacementMapFromBuffer(V,p,W,N,d,E,z){let S=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(j.f.PositionKind)||!this.isVerticesDataPresent(j.f.NormalKind)||!this.isVerticesDataPresent(j.f.UVKind))return v.e.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const Q=this.getVerticesData(j.f.PositionKind,!0,!0),i=this.getVerticesData(j.f.NormalKind),l=this.getVerticesData(j.f.UVKind);let u=J.n.Zero();const f=J.n.Zero(),O=J.k.Zero();E=E||J.k.Zero(),z=z||new J.k(1,1);for(let j=0;j<Q.length;j+=3){J.n.FromArrayToRef(Q,j,u),J.n.FromArrayToRef(i,j,f),J.k.FromArrayToRef(l,j/3*2,O);const S=4*((Math.abs(O.x*z.x+E.x%1)*(p-1)%p|0)+(Math.abs(O.y*z.y+E.y%1)*(W-1)%W|0)*p),k=.3*(V[S]/255)+.59*(V[S+1]/255)+.11*(V[S+2]/255);f.normalize(),f.scaleInPlace(N+(d-N)*k),u=u.add(f),u.toArray(Q,j)}return k.b.ComputeNormals(Q,this.Zf(),i),S?(this.Ga(j.f.PositionKind,Q),this.Ga(j.f.NormalKind,i),this.Ga(j.f.UVKind,l)):(this.updateVerticesData(j.f.PositionKind,Q),this.updateVerticesData(j.f.NormalKind,i)),this}_getFlattenedNormals(V,p){const W=new Float32Array(3*V.length);let N=0;const d=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let E=0;E<V.length;E+=3){const z=J.n.Tg(p,3*V[E]),S=J.n.Tg(p,3*V[E+1]),Q=J.n.Tg(p,3*V[E+2]),i=z.ed(S),l=Q.ed(S),j=J.n.Normalize(J.n.Cross(i,l));d&&j.scaleInPlace(-1);for(let V=0;V<3;V++)W[N++]=j.x,W[N++]=j.y,W[N++]=j.z}return W}_convertToUnIndexedMesh(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=this.getVerticesDataKinds().filter((V=>{var p;return!(null!==(p=this.getVertexBuffer(V))&&void 0!==p&&p.getIsInstanced())})),W=this.Zf(),N={},d=(V,p)=>{const N=new Float32Array(W.length*p);let d=0;for(let E=0;E<W.length;E++)for(let z=0;z<p;z++)N[d++]=V[W[E]*p+z];return N},E=this.getBoundingInfo(),z=this.sj?this.dg.slice(0):[];for(const S of p)N[S]=this.getVerticesData(S);for(const S of p){const p=this.getVertexBuffer(S),E=p.getSize();if(V&&S===j.f.NormalKind){const V=this._getFlattenedNormals(W,N[j.f.PositionKind]);this.Ga(j.f.NormalKind,V,p.isUpdatable(),E)}else this.Ga(S,d(N[S],E),p.isUpdatable(),E)}if(this.morphTargetManager){for(let p=0;p<this.morphTargetManager.numTargets;p++){const N=this.morphTargetManager.getTarget(p),E=N.getPositions();N.setPositions(d(E,3));const z=N.getNormals();z&&N.setNormals(V?this._getFlattenedNormals(W,E):d(z,3));const S=N.getTangents();S&&N.setTangents(d(S,3));const Q=N.getUVs();Q&&N.setUVs(d(Q,2))}this.morphTargetManager.synchronize()}for(let S=0;S<W.length;S++)W[S]=S;this.setIndices(W),this._unIndexed=!0,this.releaseSubMeshes();for(const S of z){const V=S.getBoundingInfo();O.b.AddToMesh(S.materialIndex,S.indexStart,S.indexCount,S.indexStart,S.indexCount,this).setBoundingInfo(V)}return this.setBoundingInfo(E),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p=k.b.ExtractFromMesh(this);let W;if(V&&this.isVerticesDataPresent(j.f.NormalKind)&&p.ya){for(W=0;W<p.ya.length;W++)p.ya[W]*=-1;this.Ga(j.f.NormalKind,p.ya,this.isVertexBufferUpdatable(j.f.NormalKind))}if(p.indices){let V;for(W=0;W<p.indices.length;W+=3)V=p.indices[W+1],p.indices[W+1]=p.indices[W+2],p.indices[W+2]=V;this.setIndices(p.indices,null,this.isVertexBufferUpdatable(j.f.PositionKind),!0)}return this}increaseVertices(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const p=k.b.ExtractFromMesh(this),W=p.indices&&!Array.isArray(p.indices)&&Array.from?Array.from(p.indices):p.indices,N=p.xa&&!Array.isArray(p.xa)&&Array.from?Array.from(p.xa):p.xa,d=p.Aa&&!Array.isArray(p.Aa)&&Array.from?Array.from(p.Aa):p.Aa,E=p.ya&&!Array.isArray(p.ya)&&Array.from?Array.from(p.ya):p.ya;if(W&&N){p.indices=W,p.xa=N,d&&(p.Aa=d),E&&(p.ya=E);const z=V+1,S=new Array;for(let V=0;V<z+1;V++)S[V]=new Array;let Q,i;const l=new J.n(0,0,0),k=new J.n(0,0,0),u=new J.k(0,0),f=new Array,O=new Array,U=new Array;let F,C,A,v=N.length;d&&(C=d.length),E&&(A=E.length);for(let V=0;V<W.length;V+=3){O[0]=W[V],O[1]=W[V+1],O[2]=W[V+2];for(let V=0;V<3;V++)if(Q=O[V],i=O[(V+1)%3],void 0===U[Q]&&void 0===U[i]?(U[Q]=new Array,U[i]=new Array):(void 0===U[Q]&&(U[Q]=new Array),void 0===U[i]&&(U[i]=new Array)),void 0===U[Q][i]&&void 0===U[i][Q]){U[Q][i]=[],l.x=(N[3*i]-N[3*Q])/z,l.y=(N[3*i+1]-N[3*Q+1])/z,l.z=(N[3*i+2]-N[3*Q+2])/z,E&&(k.x=(E[3*i]-E[3*Q])/z,k.y=(E[3*i+1]-E[3*Q+1])/z,k.z=(E[3*i+2]-E[3*Q+2])/z),d&&(u.x=(d[2*i]-d[2*Q])/z,u.y=(d[2*i+1]-d[2*Q+1])/z),U[Q][i].push(Q);for(let V=1;V<z;V++)U[Q][i].push(N.length/3),N[v++]=N[3*Q]+V*l.x,N[v++]=N[3*Q+1]+V*l.y,N[v++]=N[3*Q+2]+V*l.z,E&&(E[A++]=E[3*Q]+V*k.x,E[A++]=E[3*Q+1]+V*k.y,E[A++]=E[3*Q+2]+V*k.z),d&&(d[C++]=d[2*Q]+V*u.x,d[C++]=d[2*Q+1]+V*u.y);U[Q][i].push(i),U[i][Q]=new Array,F=U[Q][i].length;for(let V=0;V<F;V++)U[i][Q][V]=U[Q][i][F-1-V]}S[0][0]=W[V],S[1][0]=U[W[V]][W[V+1]][1],S[1][1]=U[W[V]][W[V+2]][1];for(let p=2;p<z;p++){S[p][0]=U[W[V]][W[V+1]][p],S[p][p]=U[W[V]][W[V+2]][p],l.x=(N[3*S[p][p]]-N[3*S[p][0]])/p,l.y=(N[3*S[p][p]+1]-N[3*S[p][0]+1])/p,l.z=(N[3*S[p][p]+2]-N[3*S[p][0]+2])/p,E&&(k.x=(E[3*S[p][p]]-E[3*S[p][0]])/p,k.y=(E[3*S[p][p]+1]-E[3*S[p][0]+1])/p,k.z=(E[3*S[p][p]+2]-E[3*S[p][0]+2])/p),d&&(u.x=(d[2*S[p][p]]-d[2*S[p][0]])/p,u.y=(d[2*S[p][p]+1]-d[2*S[p][0]+1])/p);for(let V=1;V<p;V++)S[p][V]=N.length/3,N[v++]=N[3*S[p][0]]+V*l.x,N[v++]=N[3*S[p][0]+1]+V*l.y,N[v++]=N[3*S[p][0]+2]+V*l.z,E&&(E[A++]=E[3*S[p][0]]+V*k.x,E[A++]=E[3*S[p][0]+1]+V*k.y,E[A++]=E[3*S[p][0]+2]+V*k.z),d&&(d[C++]=d[2*S[p][0]]+V*u.x,d[C++]=d[2*S[p][0]+1]+V*u.y)}S[z]=U[W[V+1]][W[V+2]],f.push(S[0][0],S[1][0],S[1][1]);for(let V=1;V<z;V++){let p;for(p=0;p<V;p++)f.push(S[V][p],S[V+1][p],S[V+1][p+1]),f.push(S[V][p],S[V+1][p+1],S[V][p+1]);f.push(S[V][p],S[V+1][p],S[V+1][p+1])}}p.indices=f,p.Ca(this,this.isVertexBufferUpdatable(j.f.PositionKind))}else v.e.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const V=k.b.ExtractFromMesh(this),p=V.Aa,W=V.indices,N=V.xa,d=V.za,E=V.matricesIndices,z=V.matricesWeights,S=V.matricesIndicesExtra,Q=V.matricesWeightsExtra;if(void 0===W||void 0===N||null===W||null===N)v.e.Warn("VertexData contains empty entries");else{const J=new Array,i=new Array,l=new Array,u=new Array,f=new Array,O=new Array,U=new Array,F=new Array;let C=new Array,A=0;const v={};let t,e;for(let V=0;V<W.length;V+=3){e=[W[V],W[V+1],W[V+2]],C=[];for(let V=0;V<3;V++){C[V]="";for(let p=0;p<3;p++)Math.abs(N[3*e[V]+p])<1e-8&&(N[3*e[V]+p]=0),C[V]+=N[3*e[V]+p]+"|"}if(C[0]!=C[1]&&C[0]!=C[2]&&C[1]!=C[2])for(let V=0;V<3;V++){if(t=v[C[V]],void 0===t){v[C[V]]=A,t=A++;for(let p=0;p<3;p++)J.push(N[3*e[V]+p]);if(null!==d&&void 0!==d)for(let p=0;p<4;p++)u.push(d[4*e[V]+p]);if(null!==p&&void 0!==p)for(let W=0;W<2;W++)l.push(p[2*e[V]+W]);if(null!==E&&void 0!==E)for(let p=0;p<4;p++)f.push(E[4*e[V]+p]);if(null!==z&&void 0!==z)for(let p=0;p<4;p++)O.push(z[4*e[V]+p]);if(null!==S&&void 0!==S)for(let p=0;p<4;p++)U.push(S[4*e[V]+p]);if(null!==Q&&void 0!==Q)for(let p=0;p<4;p++)F.push(Q[4*e[V]+p])}i.push(t)}}const Z=new Array;k.b.ComputeNormals(J,i,Z),V.xa=J,V.indices=i,V.ya=Z,null!==p&&void 0!==p&&(V.Aa=l),null!==d&&void 0!==d&&(V.za=u),null!==E&&void 0!==E&&(V.matricesIndices=f),null!==z&&void 0!==z&&(V.matricesWeights=O),null!==S&&void 0!==S&&(V.matricesIndicesExtra=U),null!==z&&void 0!==z&&(V.matricesWeightsExtra=F),V.Ca(this,this.isVertexBufferUpdatable(j.f.PositionKind))}}static _instancedMeshFactory(V,p){throw(0,e.c)("InstancedMesh")}static _PhysicsImpostorParser(V,p,W){throw(0,e.c)("PhysicsImpostor")}createInstance(V){const p=P._instancedMeshFactory(V,this);return p.parent=this.parent,p}synchronizeInstances(){for(let V=0;V<this.instances.length;V++){this.instances[V]._syncSubMeshes()}return this}optimizeIndices(V){const p=this.Zf(),W=this.getVerticesData(j.f.PositionKind);if(!W||!p)return this;const N=[];for(let d=0;d<W.length;d+=3)N.push(J.n.Tg(W,d));const E=[];return d.d.SyncAsyncForLoop(N.length,40,(V=>{const p=N.length-1-V,W=N[p];for(let d=0;d<p;++d){const V=N[d];if(W.equals(V)){E[p]=d;break}}}),(()=>{for(let V=0;V<p.length;++V)p[V]=E[p[V]]||p[V];const W=this.dg.slice(0);this.setIndices(p),this.dg=W,V&&V(this)})),this}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};V.name=this.name,V.id=this.id,V.uniqueId=this.uniqueId,V.type=this.getClassName(),z.e&&z.e.HasTags(this)&&(V.tags=z.e.GetTags(this)),V.position=this.position.Zi(),this.rotationQuaternion?V.rotationQuaternion=this.rotationQuaternion.Zi():this.rotation&&(V.rotation=this.rotation.Zi()),V.ie=this.ie.Zi(),this._postMultiplyPivotMatrix?V.pivotMatrix=this.getPivotMatrix().Zi():V.localMatrix=this.getPivotMatrix().Zi(),V.isEnabled=this.isEnabled(!1),V.isVisible=this.isVisible,V.infiniteDistance=this.infiniteDistance,V.pickable=this.sb,V.receiveShadows=this.receiveShadows,V.billboardMode=this.billboardMode,V.visibility=this.visibility,V.qb=this.qb,V.checkCollisions=this.checkCollisions,V.ellipsoid=this.ellipsoid.Zi(),V.ellipsoidOffset=this.ellipsoidOffset.Zi(),V.Da=this.Da,V.isBlocker=this.isBlocker,V.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(V),V.isUnIndexed=this.isUnIndexed;const p=this._geometry;if(p&&this.dg){V.geometryUniqueId=p.uniqueId,V.geometryId=p.id,V.dg=[];for(let p=0;p<this.dg.length;p++){const W=this.dg[p];V.dg.push({materialIndex:W.materialIndex,verticesStart:W.verticesStart,verticesCount:W.verticesCount,indexStart:W.indexStart,indexCount:W.indexCount})}}if(this.material?this.material.doNotSerialize||(V.materialUniqueId=this.material.uniqueId,V.materialId=this.material.id):(this.material=null,V.materialUniqueId=this._scene.defaultMaterial.uniqueId,V.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(V.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(V.skeletonId=this.skeleton.id,V.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(Z.c.NAME_PHYSICSENGINE)){const p=this.getPhysicsImpostor();p&&(V.physicsMass=p.getParam("mass"),V.physicsFriction=p.getParam("friction"),V.physicsRestitution=p.getParam("mass"),V.physicsImpostor=p.type)}this.metadata&&(V.metadata=this.metadata),V.instances=[];for(let W=0;W<this.instances.length;W++){const p=this.instances[W];if(p.doNotSerialize)continue;const N={name:p.name,id:p.id,isEnabled:p.isEnabled(!1),isVisible:p.isVisible,sb:p.sb,checkCollisions:p.checkCollisions,position:p.position.Zi(),ie:p.ie.Zi()};if(p.parent&&p.parent._serializeAsParent(N),p.rotationQuaternion?N.rotationQuaternion=p.rotationQuaternion.Zi():p.rotation&&(N.rotation=p.rotation.Zi()),this.va()._getComponent(Z.c.NAME_PHYSICSENGINE)){const V=p.getPhysicsImpostor();V&&(N.physicsMass=V.getParam("mass"),N.physicsFriction=V.getParam("friction"),N.physicsRestitution=V.getParam("mass"),N.physicsImpostor=V.type)}p.metadata&&(N.metadata=p.metadata),p.actionManager&&(N.actions=p.actionManager.serialize(p.name)),V.instances.push(N),A.b.AppendSerializedAnimations(p,N),N.ranges=p.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(V.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const p={data:{},sizes:{},strides:{}};for(const V in this._userThinInstanceBuffersStorage.data)p.data[V]=Array.from(this._userThinInstanceBuffersStorage.data[V]),p.sizes[V]=this._userThinInstanceBuffersStorage.sizes[V],p.strides[V]=this._userThinInstanceBuffersStorage.strides[V];V.thinInstances.userThinInstance=p}return A.b.AppendSerializedAnimations(this,V),V.ranges=this.serializeAnimationRanges(),V.layerMask=this.layerMask,V.alphaIndex=this.alphaIndex,V.hasVertexAlpha=this.hasVertexAlpha,V.overlayAlpha=this.overlayAlpha,V.overlayColor=this.overlayColor.Zi(),V.renderOverlay=this.renderOverlay,V.applyFog=this.applyFog,this.actionManager&&(V.actions=this.actionManager.serialize(this.name)),V}_syncGeometryWithMorphTargetManager(){if(!this.sj)return;this._markSubMeshesAsAttributesDirty();const V=this._internalAbstractMeshDataInfo._morphTargetManager;if(V&&V.vertexCount){if(V.vertexCount!==this.getTotalVertices())return v.e.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(V.isUsingTextureForTargets)return;for(let p=0;p<V.numInfluencers;p++){const W=V.getActiveTarget(p),N=W.getPositions();if(!N)return void v.e.Error("Invalid morph target. Target must have positions.");this.sj.Ga(j.f.PositionKind+p,N,!1,3);const d=W.getNormals();d&&this.sj.Ga(j.f.NormalKind+p,d,!1,3);const E=W.getTangents();E&&this.sj.Ga(j.f.TangentKind+p,E,!1,3);const z=W.getUVs();z&&this.sj.Ga(j.f.UVKind+"_"+p,z,!1,2)}}else{let V=0;for(;this.sj.isVerticesDataPresent(j.f.PositionKind+V);)this.sj.removeVerticesData(j.f.PositionKind+V),this.sj.isVerticesDataPresent(j.f.NormalKind+V)&&this.sj.removeVerticesData(j.f.NormalKind+V),this.sj.isVerticesDataPresent(j.f.TangentKind+V)&&this.sj.removeVerticesData(j.f.TangentKind+V),this.sj.isVerticesDataPresent(j.f.UVKind+V)&&this.sj.removeVerticesData(j.f.UVKind+"_"+V),V++}}static Parse(V,p,W){let N;if(N=V.type&&"LinesMesh"===V.type?P._LinesMeshParser(V,p):V.type&&"GroundMesh"===V.type?P._GroundMeshParser(V,p):V.type&&"GoldbergMesh"===V.type?P._GoldbergMeshParser(V,p):V.type&&"GreasedLineMesh"===V.type?P._GreasedLineMeshParser(V,p):V.type&&"TrailMesh"===V.type?P._TrailMeshParser(V,p):new P(V.name,p),N.id=V.id,N._waitingParsedUniqueId=V.uniqueId,z.e&&z.e.AddTagsTo(N,V.tags),N.position=J.n.Tg(V.position),void 0!==V.metadata&&(N.metadata=V.metadata),V.rotationQuaternion?N.rotationQuaternion=J.f.Tg(V.rotationQuaternion):V.rotation&&(N.rotation=J.n.Tg(V.rotation)),N.ie=J.n.Tg(V.ie),V.localMatrix?N.setPreTransformMatrix(J.e.Tg(V.localMatrix)):V.pivotMatrix&&N.setPivotMatrix(J.e.Tg(V.pivotMatrix)),N.Ab(V.isEnabled),N.isVisible=V.isVisible,N.infiniteDistance=V.infiniteDistance,N.qb=!!V.qb,N.showBoundingBox=V.showBoundingBox,N.showSubMeshesBoundingBox=V.showSubMeshesBoundingBox,void 0!==V.applyFog&&(N.applyFog=V.applyFog),void 0!==V.pickable&&(N.sb=V.pickable),void 0!==V.alphaIndex&&(N.alphaIndex=V.alphaIndex),N.receiveShadows=V.receiveShadows,void 0!==V.billboardMode&&(N.billboardMode=V.billboardMode),void 0!==V.visibility&&(N.visibility=V.visibility),N.checkCollisions=V.checkCollisions,N.Da=!!V.Da,V.ellipsoid&&(N.ellipsoid=J.n.Tg(V.ellipsoid)),V.ellipsoidOffset&&(N.ellipsoidOffset=J.n.Tg(V.ellipsoidOffset)),null!=V.overrideMaterialSideOrientation&&(N.sideOrientation=V.overrideMaterialSideOrientation),void 0!==V.sideOrientation&&(N.sideOrientation=V.sideOrientation),void 0!==V.isBlocker&&(N.isBlocker=V.isBlocker),N._shouldGenerateFlatShading=V.useFlatShading,V.jc&&(N._waitingData.jc=V.jc),void 0!==V.parentId&&(N._waitingParentId=V.parentId),void 0!==V.parentInstanceIndex&&(N._waitingParentInstanceIndex=V.parentInstanceIndex),void 0!==V.actions&&(N._waitingData.actions=V.actions),void 0!==V.overlayAlpha&&(N.overlayAlpha=V.overlayAlpha),void 0!==V.overlayColor&&(N.overlayColor=i.c.Tg(V.overlayColor)),void 0!==V.renderOverlay&&(N.renderOverlay=V.renderOverlay),N.isUnIndexed=!!V.isUnIndexed,N.hasVertexAlpha=V.hasVertexAlpha,V.delayLoadingFile?(N.delayLoadState=4,N.delayLoadingFile=W+V.delayLoadingFile,N.buildBoundingInfo(J.n.Tg(V.boundingBoxMinimum),J.n.Tg(V.boundingBoxMaximum)),V._binaryInfo&&(N._binaryInfo=V._binaryInfo),N._delayInfo=[],V.hasUVs&&N._delayInfo.push(j.f.UVKind),V.hasUVs2&&N._delayInfo.push(j.f.UV2Kind),V.hasUVs3&&N._delayInfo.push(j.f.UV3Kind),V.hasUVs4&&N._delayInfo.push(j.f.UV4Kind),V.hasUVs5&&N._delayInfo.push(j.f.UV5Kind),V.hasUVs6&&N._delayInfo.push(j.f.UV6Kind),V.hasColors&&N._delayInfo.push(j.f.ColorKind),V.hasMatricesIndices&&N._delayInfo.push(j.f.MatricesIndicesKind),V.hasMatricesWeights&&N._delayInfo.push(j.f.MatricesWeightsKind),N._delayLoadingFunction=u.e._ImportGeometry,C.d.ForceFullSceneLoadingForIncremental&&N._checkDelayState()):u.e._ImportGeometry(V,N),V.materialUniqueId?N._waitingMaterialId=V.materialUniqueId:V.materialId&&(N._waitingMaterialId=V.materialId),V.morphTargetManagerId>-1&&(N._waitingMorphTargetManagerId=V.morphTargetManagerId),void 0!==V.skeletonId&&null!==V.skeletonId&&(N.skeleton=p.getLastSkeletonById(V.skeletonId),V.numBoneInfluencers&&(N.numBoneInfluencers=V.numBoneInfluencers)),V.animations){for(let p=0;p<V.animations.length;p++){const W=V.animations[p],d=(0,t.b)("BABYLON.Animation");d&&N.animations.push(d.Parse(W))}l.b.ParseAnimationRanges(N,V,p)}if(V.autoAnimate&&p.beginAnimation(N,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),V.layerMask&&!isNaN(V.layerMask)?N.layerMask=Math.abs(parseInt(V.layerMask)):N.layerMask=268435455,V.physicsImpostor&&(N.physicsImpostor=P._PhysicsImpostorParser(p,N,V)),V.lodMeshIds&&(N._waitingData.lods={ids:V.lodMeshIds,distances:V.lodDistances?V.lodDistances:null,coverages:V.lodCoverages?V.lodCoverages:null}),V.instances)for(let d=0;d<V.instances.length;d++){const W=V.instances[d],E=N.createInstance(W.name);if(W.id&&(E.id=W.id),z.e&&(W.tags?z.e.AddTagsTo(E,W.tags):z.e.AddTagsTo(E,V.tags)),E.position=J.n.Tg(W.position),void 0!==W.metadata&&(E.metadata=W.metadata),void 0!==W.parentId&&(E._waitingParentId=W.parentId),void 0!==W.parentInstanceIndex&&(E._waitingParentInstanceIndex=W.parentInstanceIndex),void 0!==W.isEnabled&&null!==W.isEnabled&&E.Ab(W.isEnabled),void 0!==W.isVisible&&null!==W.isVisible&&(E.isVisible=W.isVisible),void 0!==W.sb&&null!==W.sb&&(E.sb=W.sb),W.rotationQuaternion?E.rotationQuaternion=J.f.Tg(W.rotationQuaternion):W.rotation&&(E.rotation=J.n.Tg(W.rotation)),E.ie=J.n.Tg(W.ie),void 0!=W.checkCollisions&&null!=W.checkCollisions&&(E.checkCollisions=W.checkCollisions),void 0!=W.pickable&&null!=W.pickable&&(E.sb=W.pickable),void 0!=W.showBoundingBox&&null!=W.showBoundingBox&&(E.showBoundingBox=W.showBoundingBox),void 0!=W.showSubMeshesBoundingBox&&null!=W.showSubMeshesBoundingBox&&(E.showSubMeshesBoundingBox=W.showSubMeshesBoundingBox),void 0!=W.alphaIndex&&null!=W.showSubMeshesBoundingBox&&(E.alphaIndex=W.alphaIndex),W.physicsImpostor&&(E.physicsImpostor=P._PhysicsImpostorParser(p,E,W)),void 0!==W.actions&&(E._waitingData.actions=W.actions),W.animations){for(let V=0;V<W.animations.length;V++){const p=W.animations[V],N=(0,t.b)("BABYLON.Animation");N&&E.animations.push(N.Parse(p))}l.b.ParseAnimationRanges(E,W,p),W.autoAnimate&&p.beginAnimation(E,W.autoAnimateFrom,W.autoAnimateTo,W.autoAnimateLoop,W.autoAnimateSpeed||1)}}if(V.thinInstances){const p=V.thinInstances;if(N.thinInstanceEnablePicking=!!p.enablePicking,p.matrixData?(N.Cb("matrix",new Float32Array(p.matrixData),16,!1),N._thinInstanceDataStorage.matrixBufferSize=p.matrixBufferSize,N._thinInstanceDataStorage.instancesCount=p.instancesCount):N._thinInstanceDataStorage.matrixBufferSize=p.matrixBufferSize,V.thinInstances.userThinInstance){const p=V.thinInstances.userThinInstance;for(const V in p.data)N.Cb(V,new Float32Array(p.data[V]),p.strides[V],!1),N._userThinInstanceBuffersStorage.sizes[V]=p.sizes[V]}}return N}setPositionsForCPUSkinning(){const V=this._internalMeshDataInfo;if(!V._sourcePositions){const p=this.getVerticesData(j.f.PositionKind);if(!p)return V._sourcePositions;V._sourcePositions=new Float32Array(p),this.isVertexBufferUpdatable(j.f.PositionKind)||this.Ga(j.f.PositionKind,p,!0)}return V._sourcePositions}setNormalsForCPUSkinning(){const V=this._internalMeshDataInfo;if(!V._sourceNormals){const p=this.getVerticesData(j.f.NormalKind);if(!p)return V._sourceNormals;V._sourceNormals=new Float32Array(p),this.isVertexBufferUpdatable(j.f.NormalKind)||this.Ga(j.f.NormalKind,p,!0)}return V._sourceNormals}applySkeleton(V){if(!this.sj)return this;if(this.sj._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.sj._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(j.f.PositionKind))return this;if(!this.isVerticesDataPresent(j.f.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(j.f.MatricesWeightsKind))return this;const p=this.isVerticesDataPresent(j.f.NormalKind),W=this._internalMeshDataInfo;if(!W._sourcePositions){const V=this.dg.slice();this.setPositionsForCPUSkinning(),this.dg=V}p&&!W._sourceNormals&&this.setNormalsForCPUSkinning();let N=this.getVerticesData(j.f.PositionKind);if(!N)return this;N instanceof Float32Array||(N=new Float32Array(N));let d=this.getVerticesData(j.f.NormalKind);if(p){if(!d)return this;d instanceof Float32Array||(d=new Float32Array(d))}const E=this.getVerticesData(j.f.MatricesIndicesKind),z=this.getVerticesData(j.f.MatricesWeightsKind);if(!z||!E)return this;const S=this.numBoneInfluencers>4,Q=S?this.getVerticesData(j.f.MatricesIndicesExtraKind):null,i=S?this.getVerticesData(j.f.MatricesWeightsExtraKind):null,l=V.getTransformMatrices(this),k=J.n.Zero(),u=new J.e,f=new J.e;let O,U=0;for(let j=0;j<N.length;j+=3,U+=4){let V;for(O=0;O<4;O++)V=z[U+O],V>0&&(J.e.FromFloat32ArrayToRefScaled(l,Math.floor(16*E[U+O]),V,f),u.addToSelf(f));if(S)for(O=0;O<4;O++)V=i[U+O],V>0&&(J.e.FromFloat32ArrayToRefScaled(l,Math.floor(16*Q[U+O]),V,f),u.addToSelf(f));J.n.TransformCoordinatesFromFloatsToRef(W._sourcePositions[j],W._sourcePositions[j+1],W._sourcePositions[j+2],u,k),k.toArray(N,j),p&&(J.n.TransformNormalFromFloatsToRef(W._sourceNormals[j],W._sourceNormals[j+1],W._sourceNormals[j+2],u,k),k.toArray(d,j)),u.reset()}return this.updateVerticesData(j.f.PositionKind,N),p&&this.updateVerticesData(j.f.NormalKind,d),this}static MinMax(V){let p=null,W=null;return V.forEach((function(V){const N=V.getBoundingInfo().boundingBox;p&&W?(p.minimizeInPlace(N.minimumWorld),W.maximizeInPlace(N.maximumWorld)):(p=N.minimumWorld,W=N.maximumWorld)})),p&&W?{min:p,max:W}:{min:J.n.Zero(),max:J.n.Zero()}}static Center(V){const p=V instanceof Array?P.MinMax(V):V;return J.n.Center(p.min,p.max)}static MergeMeshes(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0;return(0,S.k)(P._MergeMeshesCoroutine(V,p,W,N,d,E,!1))}static MergeMeshesAsync(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0;return(0,S.h)(P._MergeMeshesCoroutine(V,p,W,N,d,E,!0),(0,S.d)())}static*_MergeMeshesCoroutine(V){let p,W=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],N=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0,z=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0;if(0===(V=V.filter(Boolean)).length)return null;if(!N){let W=0;for(p=0;p<V.length;p++)if(W+=V[p].getTotalVertices(),W>=65536)return v.e.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}z&&(E=!1);const Q=new Array,J=new Array,i=new Array,l=V[0].sideOrientation;for(p=0;p<V.length;p++){const W=V[p];if(W.isAnInstance)return v.e.Warn("Cannot merge instance meshes."),null;if(l!==W.sideOrientation)return v.e.Warn("Cannot merge meshes with different sideOrientation values."),null;if(E&&i.push(W.getTotalIndices()),z)if(W.material){const V=W.material;if(V instanceof F.c){for(let p=0;p<V.eg.length;p++)Q.indexOf(V.eg[p])<0&&Q.push(V.eg[p]);for(let p=0;p<W.dg.length;p++)J.push(Q.indexOf(V.eg[W.dg[p].materialIndex])),i.push(W.dg[p].indexCount)}else{Q.indexOf(V)<0&&Q.push(V);for(let p=0;p<W.dg.length;p++)J.push(Q.indexOf(V)),i.push(W.dg[p].indexCount)}}else for(let V=0;V<W.dg.length;V++)J.push(0),i.push(W.dg[V].indexCount)}const j=V[0],u=V=>{const p=V.Dj(!0);return{vertexData:k.b.ExtractFromMesh(V,!1,!1),transform:p}},{vertexData:f,transform:U}=u(j);S&&(yield);const C=new Array(V.length-1);for(let k=1;k<V.length;k++)C[k-1]=u(V[k]),S&&(yield);const A=f._mergeCoroutine(U,C,N,S,!W);let t=A.next();for(;!t.done;)S&&(yield),t=A.next();const e=t.value;d||(d=new P(j.name+"_merged",j.va()));const Z=e._applyToCoroutine(d,void 0,S);let o=Z.next();for(;!o.done;)S&&(yield),o=Z.next();if(d.checkCollisions=j.checkCollisions,d.sideOrientation=j.sideOrientation,W)for(p=0;p<V.length;p++)V[p].dispose();if(E||z){d.releaseSubMeshes(),p=0;let V=0;for(;p<i.length;)O.b.CreateFromIndices(0,V,i[p],d,void 0,!1),V+=i[p],p++;for(const p of d.dg)p.refreshBoundingInfo();d.Dj(!0)}if(z){const V=new F.c(j.name+"_merged",j.va());V.eg=Q;for(let p=0;p<d.dg.length;p++)d.dg[p].materialIndex=J[p];d.material=V}else d.material=j.material;return d}vj(V){V._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(V)}uj(V){const p=V._indexInSourceMeshInstanceArray;if(-1!=p){if(p!==this.instances.length-1){const V=this.instances[this.instances.length-1];this.instances[p]=V,V._indexInSourceMeshInstanceArray=p}V._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===U.d.CounterClockWiseSideOrientation}_getRenderingFillMode(V){const p=this.va();return p.forcePointsCloud?U.d.PointFillMode:p.forceWireframe?U.d.WireFrameFillMode:this.overrideRenderingFillMode??V}setMaterialByID(V){return this.setMaterialById(V)}static CreateRibbon(V,p,W,N,d,E,z,S,Q){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(V,p,W,N,d,E){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(V,p,W,N,d){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(V,p,W,N,d,E){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(V,p,W,N){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(V,p,W,N,d,E,z,S,Q){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(V,p,W,N,d,E,z){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(V,p,W,N,d,E,z,S,Q,J){throw new Error("Import MeshBuilder to populate this function")}static pb(V,p,W,N,d){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(V,p,W,N,d,E,z,S){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(V,p,W,N,d,E,z){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(V,p,W,N,d,E,z,S){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(V,p,W,N,d,E,z,S,Q,J){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(V,p,W,N,d,E,z,S,Q,J,i,l){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(V,p,W,N,d,E,z){throw new Error("Import MeshBuilder to populate this function")}static fg(V,p,W,N,d){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(V,p,W,N,d,E){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(V,p,W,N,d,E,z,S,Q){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(V,p,W,N,d,E,z,S,Q,J,i){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(V,p,W,N,d,E,z,S,Q,J){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(V,p,W){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(V,p,W){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(V,p,W,N,d,E){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(V,p,W){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(V){throw new Error("Import MeshBuilder to populate this function")}}P.FRONTSIDE=k.b.FRONTSIDE,P.BACKSIDE=k.b.BACKSIDE,P.DOUBLESIDE=k.b.DOUBLESIDE,P.DEFAULTSIDE=k.b.DEFAULTSIDE,P.NO_CAP=0,P.CAP_START=1,P.CAP_END=2,P.CAP_ALL=3,P.NO_FLIP=0,P.FLIP_TILE=1,P.ROTATE_TILE=2,P.FLIP_ROW=3,P.ROTATE_ROW=4,P.FLIP_N_ROTATE_TILE=5,P.FLIP_N_ROTATE_ROW=6,P.CENTER=0,P.LEFT=1,P.RIGHT=2,P.TOP=3,P.BOTTOM=4,P.INSTANCEDMESH_SORT_TRANSPARENT=!1,P._GroundMeshParser=(V,p)=>{throw(0,e.c)("GroundMesh")},P._GoldbergMeshParser=(V,p)=>{throw(0,e.c)("GoldbergMesh")},P._LinesMeshParser=(V,p)=>{throw(0,e.c)("LinesMesh")},P._GreasedLineMeshParser=(V,p)=>{throw(0,e.c)("GreasedLineMesh")},P._GreasedLineRibbonMeshParser=(V,p)=>{throw(0,e.c)("GreasedLineRibbonMesh")},P._TrailMeshParser=(V,p)=>{throw(0,e.c)("TrailMesh")},(0,t.d)("BABYLON.Mesh",P)},11544:(V,p,W)=>{"use strict";W.d(p,{b:()=>u});var N=W(11167),d=W(11218),E=W(11291),z=W(10887),S=W(11257),Q=W(10870),J=W(11175),i=W(11515),l=W(10911),j=W(11390);class k{}class u{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,i.g)(this._applyToCoroutine.bind(this)),this.uniqueId=u._UniqueIDGenerator,u._UniqueIDGenerator++}set(V,p){switch(V.length||Q.e.Warn(`Setting vertex data kind '${p}' with an empty array`),p){case E.f.PositionKind:this.xa=V;break;case E.f.NormalKind:this.ya=V;break;case E.f.TangentKind:this.tangents=V;break;case E.f.UVKind:this.Aa=V;break;case E.f.UV2Kind:this.uvs2=V;break;case E.f.UV3Kind:this.uvs3=V;break;case E.f.UV4Kind:this.uvs4=V;break;case E.f.UV5Kind:this.uvs5=V;break;case E.f.UV6Kind:this.uvs6=V;break;case E.f.ColorKind:this.za=V;break;case E.f.MatricesIndicesKind:this.matricesIndices=V;break;case E.f.MatricesWeightsKind:this.matricesWeights=V;break;case E.f.MatricesIndicesExtraKind:this.matricesIndicesExtra=V;break;case E.f.MatricesWeightsExtraKind:this.matricesWeightsExtra=V}}Ca(V,p){return this._applyTo(V,p,!1),this}applyToGeometry(V,p){return this._applyTo(V,p,!1),this}updateMesh(V){return this._update(V),this}updateGeometry(V){return this._update(V),this}*_applyToCoroutine(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;if(this.xa&&(V.Ga(E.f.PositionKind,this.xa,p),W&&(yield)),this.ya&&(V.Ga(E.f.NormalKind,this.ya,p),W&&(yield)),this.tangents&&(V.Ga(E.f.TangentKind,this.tangents,p),W&&(yield)),this.Aa&&(V.Ga(E.f.UVKind,this.Aa,p),W&&(yield)),this.uvs2&&(V.Ga(E.f.UV2Kind,this.uvs2,p),W&&(yield)),this.uvs3&&(V.Ga(E.f.UV3Kind,this.uvs3,p),W&&(yield)),this.uvs4&&(V.Ga(E.f.UV4Kind,this.uvs4,p),W&&(yield)),this.uvs5&&(V.Ga(E.f.UV5Kind,this.uvs5,p),W&&(yield)),this.uvs6&&(V.Ga(E.f.UV6Kind,this.uvs6,p),W&&(yield)),this.za&&(V.Ga(E.f.ColorKind,this.za,p),this.hasVertexAlpha&&void 0!==V.hasVertexAlpha&&(V.hasVertexAlpha=!0),W&&(yield)),this.matricesIndices&&(V.Ga(E.f.MatricesIndicesKind,this.matricesIndices,p),W&&(yield)),this.matricesWeights&&(V.Ga(E.f.MatricesWeightsKind,this.matricesWeights,p),W&&(yield)),this.matricesIndicesExtra&&(V.Ga(E.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,p),W&&(yield)),this.matricesWeightsExtra&&(V.Ga(E.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,p),W&&(yield)),this.indices?(V.setIndices(this.indices,null,p),W&&(yield)):V.setIndices([],null),V.dg&&this.materialInfos&&this.materialInfos.length>1){const p=V;p.dg=[];for(const V of this.materialInfos)new j.b(V.materialIndex,V.verticesStart,V.verticesCount,V.indexStart,V.indexCount,p)}return this}_update(V,p,W){return this.xa&&V.updateVerticesData(E.f.PositionKind,this.xa,p,W),this.ya&&V.updateVerticesData(E.f.NormalKind,this.ya,p,W),this.tangents&&V.updateVerticesData(E.f.TangentKind,this.tangents,p,W),this.Aa&&V.updateVerticesData(E.f.UVKind,this.Aa,p,W),this.uvs2&&V.updateVerticesData(E.f.UV2Kind,this.uvs2,p,W),this.uvs3&&V.updateVerticesData(E.f.UV3Kind,this.uvs3,p,W),this.uvs4&&V.updateVerticesData(E.f.UV4Kind,this.uvs4,p,W),this.uvs5&&V.updateVerticesData(E.f.UV5Kind,this.uvs5,p,W),this.uvs6&&V.updateVerticesData(E.f.UV6Kind,this.uvs6,p,W),this.za&&V.updateVerticesData(E.f.ColorKind,this.za,p,W),this.matricesIndices&&V.updateVerticesData(E.f.MatricesIndicesKind,this.matricesIndices,p,W),this.matricesWeights&&V.updateVerticesData(E.f.MatricesWeightsKind,this.matricesWeights,p,W),this.matricesIndicesExtra&&V.updateVerticesData(E.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,p,W),this.matricesWeightsExtra&&V.updateVerticesData(E.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,p,W),this.indices&&V.setIndices(this.indices,null),this}static _TransformVector3Coordinates(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.length;const E=d.i.fb[0],z=d.i.fb[1];for(let S=W;S<W+N;S+=3)d.n.FromArrayToRef(V,S,E),d.n.TransformCoordinatesToRef(E,p,z),V[S]=z.x,V[S+1]=z.y,V[S+2]=z.z}static _TransformVector3Normals(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.length;const E=d.i.fb[0],z=d.i.fb[1];for(let S=W;S<W+N;S+=3)d.n.FromArrayToRef(V,S,E),d.n.TransformNormalToRef(E,p,z),V[S]=z.x,V[S+1]=z.y,V[S+2]=z.z}static _TransformVector4Normals(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:V.length;const E=d.i.Vector4[0],z=d.i.Vector4[1];for(let S=W;S<W+N;S+=4)d.q.FromArrayToRef(V,S,E),d.q.TransformNormalToRef(E,p,z),V[S]=z.x,V[S+1]=z.y,V[S+2]=z.z,V[S+3]=z.w}static _FlipFaces(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.length;for(let N=p;N<p+W;N+=3){const p=V[N+1];V[N+1]=V[N+2],V[N+2]=p}}transform(V){const p=V.determinant()<0;return this.xa&&u._TransformVector3Coordinates(this.xa,V),this.ya&&u._TransformVector3Normals(this.ya,V),this.tangents&&u._TransformVector4Normals(this.tangents,V),p&&this.indices&&u._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const V=[];for(const p of this.materialInfos){const W=new u;if(this.xa&&(W.xa=this.xa.slice(3*p.verticesStart,3*(p.verticesCount+p.verticesStart))),this.ya&&(W.ya=this.ya.slice(3*p.verticesStart,3*(p.verticesCount+p.verticesStart))),this.tangents&&(W.tangents=this.tangents.slice(4*p.verticesStart,4*(p.verticesCount+p.verticesStart))),this.za&&(W.za=this.za.slice(4*p.verticesStart,4*(p.verticesCount+p.verticesStart))),this.Aa&&(W.Aa=this.Aa.slice(2*p.verticesStart,2*(p.verticesCount+p.verticesStart))),this.uvs2&&(W.uvs2=this.uvs2.slice(2*p.verticesStart,2*(p.verticesCount+p.verticesStart))),this.uvs3&&(W.uvs3=this.uvs3.slice(2*p.verticesStart,2*(p.verticesCount+p.verticesStart))),this.uvs4&&(W.uvs4=this.uvs4.slice(2*p.verticesStart,2*(p.verticesCount+p.verticesStart))),this.uvs5&&(W.uvs5=this.uvs5.slice(2*p.verticesStart,2*(p.verticesCount+p.verticesStart))),this.uvs6&&(W.uvs6=this.uvs6.slice(2*p.verticesStart,2*(p.verticesCount+p.verticesStart))),this.matricesIndices&&(W.matricesIndices=this.matricesIndices.slice(4*p.verticesStart,4*(p.verticesCount+p.verticesStart))),this.matricesIndicesExtra&&(W.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*p.verticesStart,4*(p.verticesCount+p.verticesStart))),this.matricesWeights&&(W.matricesWeights=this.matricesWeights.slice(4*p.verticesStart,4*(p.verticesCount+p.verticesStart))),this.matricesWeightsExtra&&(W.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*p.verticesStart,4*(p.verticesCount+p.verticesStart))),this.indices){W.indices=[];for(let V=p.indexStart;V<p.indexStart+p.indexCount;V++)W.indices.push(this.indices[V]-p.verticesStart)}const N=new k;N.indexStart=0,N.indexCount=W.indices?W.indices.length:0,N.materialIndex=p.materialIndex,N.verticesStart=0,N.verticesCount=(W.xa?W.xa.length:0)/3,W.materialInfos=[N],V.push(W)}return V}merge(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const E=Array.isArray(V)?V.map((V=>({vertexData:V}))):[{vertexData:V}];return(0,i.k)(this._mergeCoroutine(void 0,E,p,!1,W,N,d))}*_mergeCoroutine(V,p){var W,N;let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],J=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let i=p.map((V=>V.vertexData)),l=this;if(J)for(const E of i)E&&(E._validate(),!this.ya&&E.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&E.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&E.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&E.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&E.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&E.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&E.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&E.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&E.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&E.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&E.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&E.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&E.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const E of i)if(E)if(J)this.ya&&!E.ya&&(E.ya=new Float32Array(E.xa.length)),this.tangents&&!E.tangents&&(E.tangents=new Float32Array(E.xa.length/3*4)),this.Aa&&!E.Aa&&(E.Aa=new Float32Array(E.xa.length/3*2)),this.uvs2&&!E.uvs2&&(E.uvs2=new Float32Array(E.xa.length/3*2)),this.uvs3&&!E.uvs3&&(E.uvs3=new Float32Array(E.xa.length/3*2)),this.uvs4&&!E.uvs4&&(E.uvs4=new Float32Array(E.xa.length/3*2)),this.uvs5&&!E.uvs5&&(E.uvs5=new Float32Array(E.xa.length/3*2)),this.uvs6&&!E.uvs6&&(E.uvs6=new Float32Array(E.xa.length/3*2)),this.za&&!E.za&&(E.za=new Float32Array(E.xa.length/3*4),E.za.fill(1)),this.matricesIndices&&!E.matricesIndices&&(E.matricesIndices=new Float32Array(E.xa.length/3*4)),this.matricesWeights&&!E.matricesWeights&&(E.matricesWeights=new Float32Array(E.xa.length/3*4)),this.matricesIndicesExtra&&!E.matricesIndicesExtra&&(E.matricesIndicesExtra=new Float32Array(E.xa.length/3*4)),this.matricesWeightsExtra&&!E.matricesWeightsExtra&&(E.matricesWeightsExtra=new Float32Array(E.xa.length/3*4));else if(E._validate(),!this.ya!==!E.ya||!this.tangents!==!E.tangents||!this.Aa!==!E.Aa||!this.uvs2!==!E.uvs2||!this.uvs3!==!E.uvs3||!this.uvs4!==!E.uvs4||!this.uvs5!==!E.uvs5||!this.uvs6!==!E.uvs6||!this.za!==!E.za||!this.matricesIndices!==!E.matricesIndices||!this.matricesWeights!==!E.matricesWeights||!this.matricesIndicesExtra!==!E.matricesIndicesExtra||!this.matricesWeightsExtra!==!E.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(Q){let W=0,N=0,d=0;const E=[];let z=null;const S=[];for(const p of this.splitBasedOnMaterialID())S.push({vertexData:p,transform:V});for(const V of p)if(V.vertexData)for(const p of V.vertexData.splitBasedOnMaterialID())S.push({vertexData:p,transform:V.transform});S.sort(((V,p)=>{const W=V.vertexData.materialInfos?V.vertexData.materialInfos[0].materialIndex:0,N=p.vertexData.materialInfos?p.vertexData.materialInfos[0].materialIndex:0;return W>N?1:W===N?0:-1}));for(const V of S){const p=V.vertexData;if(W=p.materialInfos?p.materialInfos[0].materialIndex:0,z&&z.materialIndex===W)z.indexCount+=p.indices.length,z.verticesCount+=p.xa.length/3;else{const V=new k;V.materialIndex=W,V.indexStart=N,V.indexCount=p.indices.length,V.verticesStart=d,V.verticesCount=p.xa.length/3,E.push(V),z=V}N+=p.indices.length,d+=p.xa.length/3}const Q=S.splice(0,1)[0];l=Q.vertexData,V=Q.transform,i=S.map((V=>V.vertexData)),p=S,this.materialInfos=E}const j=i.reduce(((V,p)=>{var W;return V+((null===(W=p.indices)||void 0===W?void 0:W.length)??0)}),(null===(W=l.indices)||void 0===W?void 0:W.length)??0);let f=S||i.some((V=>V.indices===l.indices))?null===(N=l.indices)||void 0===N?void 0:N.slice():l.indices;if(j>0){var O;let W=(null===(O=f)||void 0===O?void 0:O.length)??0;if(f||(f=new Array(j)),f.length!==j){if(Array.isArray(f))f.length=j;else{const V=d||f instanceof Uint32Array?new Uint32Array(j):new Uint16Array(j);V.set(f),f=V}V&&V.determinant()<0&&u._FlipFaces(f,0,W)}let N=l.xa?l.xa.length/3:0;for(const{vertexData:V,transform:d}of p)if(V.indices){for(let p=0;p<V.indices.length;p++)f[W+p]=V.indices[p]+N;d&&d.determinant()<0&&u._FlipFaces(f,W,V.indices.length),N+=V.xa.length/3,W+=V.indices.length,z&&(yield)}}return this.indices=f,this.xa=u._MergeElement(E.f.PositionKind,l.xa,V,p.map((V=>[V.vertexData.xa,V.transform]))),z&&(yield),l.ya&&(this.ya=u._MergeElement(E.f.NormalKind,l.ya,V,p.map((V=>[V.vertexData.ya,V.transform]))),z&&(yield)),l.tangents&&(this.tangents=u._MergeElement(E.f.TangentKind,l.tangents,V,p.map((V=>[V.vertexData.tangents,V.transform]))),z&&(yield)),l.Aa&&(this.Aa=u._MergeElement(E.f.UVKind,l.Aa,V,p.map((V=>[V.vertexData.Aa,V.transform]))),z&&(yield)),l.uvs2&&(this.uvs2=u._MergeElement(E.f.UV2Kind,l.uvs2,V,p.map((V=>[V.vertexData.uvs2,V.transform]))),z&&(yield)),l.uvs3&&(this.uvs3=u._MergeElement(E.f.UV3Kind,l.uvs3,V,p.map((V=>[V.vertexData.uvs3,V.transform]))),z&&(yield)),l.uvs4&&(this.uvs4=u._MergeElement(E.f.UV4Kind,l.uvs4,V,p.map((V=>[V.vertexData.uvs4,V.transform]))),z&&(yield)),l.uvs5&&(this.uvs5=u._MergeElement(E.f.UV5Kind,l.uvs5,V,p.map((V=>[V.vertexData.uvs5,V.transform]))),z&&(yield)),l.uvs6&&(this.uvs6=u._MergeElement(E.f.UV6Kind,l.uvs6,V,p.map((V=>[V.vertexData.uvs6,V.transform]))),z&&(yield)),l.za&&(this.za=u._MergeElement(E.f.ColorKind,l.za,V,p.map((V=>[V.vertexData.za,V.transform]))),(void 0!==l.hasVertexAlpha||p.some((V=>void 0!==V.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=l.hasVertexAlpha||p.some((V=>V.vertexData.hasVertexAlpha))),z&&(yield)),l.matricesIndices&&(this.matricesIndices=u._MergeElement(E.f.MatricesIndicesKind,l.matricesIndices,V,p.map((V=>[V.vertexData.matricesIndices,V.transform]))),z&&(yield)),l.matricesWeights&&(this.matricesWeights=u._MergeElement(E.f.MatricesWeightsKind,l.matricesWeights,V,p.map((V=>[V.vertexData.matricesWeights,V.transform]))),z&&(yield)),l.matricesIndicesExtra&&(this.matricesIndicesExtra=u._MergeElement(E.f.MatricesIndicesExtraKind,l.matricesIndicesExtra,V,p.map((V=>[V.vertexData.matricesIndicesExtra,V.transform]))),z&&(yield)),l.matricesWeightsExtra&&(this.matricesWeightsExtra=u._MergeElement(E.f.MatricesWeightsExtraKind,l.matricesWeightsExtra,V,p.map((V=>[V.vertexData.matricesWeightsExtra,V.transform])))),this}static _MergeElement(V,p,W,N){const d=N.filter((V=>null!==V[0]&&void 0!==V[0]));if(!p&&0==d.length)return p;if(!p)return this._MergeElement(V,d[0][0],d[0][1],d.slice(1));const z=d.reduce(((V,p)=>V+p[0].length),p.length),S=V===E.f.PositionKind?u._TransformVector3Coordinates:V===E.f.NormalKind?u._TransformVector3Normals:V===E.f.TangentKind?u._TransformVector4Normals:()=>{};if(p instanceof Float32Array){const V=new Float32Array(z);V.set(p),W&&S(V,W,0,p.length);let N=p.length;for(const[p,W]of d)V.set(p,N),W&&S(V,W,N,p.length),N+=p.length;return V}{const V=new Array(z);for(let W=0;W<p.length;W++)V[W]=p[W];W&&S(V,W,0,p.length);let N=p.length;for(const[p,W]of d){for(let W=0;W<p.length;W++)V[N+W]=p[W];W&&S(V,W,N,p.length),N+=p.length}return V}}_validate(){if(!this.xa)throw new l.i("Positions are required",l.g.MeshInvalidPositionsError);const V=(V,p)=>{const W=E.f.DeduceStride(V);if(p.length%W!==0)throw new Error("The "+V+"s array count must be a multiple of "+W);return p.length/W},p=V(E.f.PositionKind,this.xa),W=(W,N)=>{const d=V(W,N);if(d!==p)throw new Error("The "+W+"s element count ("+d+") does not match the positions count ("+p+")")};this.ya&&W(E.f.NormalKind,this.ya),this.tangents&&W(E.f.TangentKind,this.tangents),this.Aa&&W(E.f.UVKind,this.Aa),this.uvs2&&W(E.f.UV2Kind,this.uvs2),this.uvs3&&W(E.f.UV3Kind,this.uvs3),this.uvs4&&W(E.f.UV4Kind,this.uvs4),this.uvs5&&W(E.f.UV5Kind,this.uvs5),this.uvs6&&W(E.f.UV6Kind,this.uvs6),this.za&&W(E.f.ColorKind,this.za),this.matricesIndices&&W(E.f.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&W(E.f.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&W(E.f.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&W(E.f.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const V=this.serialize();return u.Parse(V)}serialize(){const V={};if(this.xa&&(V.xa=Array.from(this.xa)),this.ya&&(V.ya=Array.from(this.ya)),this.tangents&&(V.tangents=Array.from(this.tangents)),this.Aa&&(V.Aa=Array.from(this.Aa)),this.uvs2&&(V.uvs2=Array.from(this.uvs2)),this.uvs3&&(V.uvs3=Array.from(this.uvs3)),this.uvs4&&(V.uvs4=Array.from(this.uvs4)),this.uvs5&&(V.uvs5=Array.from(this.uvs5)),this.uvs6&&(V.uvs6=Array.from(this.uvs6)),this.za&&(V.za=Array.from(this.za),V.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(V.matricesIndices=Array.from(this.matricesIndices),V.matricesIndices._isExpanded=!0),this.matricesWeights&&(V.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(V.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),V.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(V.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),V.indices=Array.from(this.indices),this.materialInfos){V.materialInfos=[];for(const p of this.materialInfos){const W={indexStart:p.indexStart,indexCount:p.indexCount,materialIndex:p.materialIndex,verticesStart:p.verticesStart,verticesCount:p.verticesCount};V.materialInfos.push(W)}}return V}static ExtractFromMesh(V,p,W){return u._ExtractFrom(V,p,W)}static ExtractFromGeometry(V,p,W){return u._ExtractFrom(V,p,W)}static _ExtractFrom(V,p,W){const N=new u;if(V.isVerticesDataPresent(E.f.PositionKind)&&(N.xa=V.getVerticesData(E.f.PositionKind,p,W)),V.isVerticesDataPresent(E.f.NormalKind)&&(N.ya=V.getVerticesData(E.f.NormalKind,p,W)),V.isVerticesDataPresent(E.f.TangentKind)&&(N.tangents=V.getVerticesData(E.f.TangentKind,p,W)),V.isVerticesDataPresent(E.f.UVKind)&&(N.Aa=V.getVerticesData(E.f.UVKind,p,W)),V.isVerticesDataPresent(E.f.UV2Kind)&&(N.uvs2=V.getVerticesData(E.f.UV2Kind,p,W)),V.isVerticesDataPresent(E.f.UV3Kind)&&(N.uvs3=V.getVerticesData(E.f.UV3Kind,p,W)),V.isVerticesDataPresent(E.f.UV4Kind)&&(N.uvs4=V.getVerticesData(E.f.UV4Kind,p,W)),V.isVerticesDataPresent(E.f.UV5Kind)&&(N.uvs5=V.getVerticesData(E.f.UV5Kind,p,W)),V.isVerticesDataPresent(E.f.UV6Kind)&&(N.uvs6=V.getVerticesData(E.f.UV6Kind,p,W)),V.isVerticesDataPresent(E.f.ColorKind)){const d=V.sj||V,z=d.getVertexBuffer(E.f.ColorKind),S=d.getVerticesData(E.f.ColorKind,p,W);if(3===z.getSize()){const V=new Float32Array(4*S.length/3);for(let p=0,W=0;p<S.length;p+=3,W+=4)V[W]=S[p],V[W+1]=S[p+1],V[W+2]=S[p+2],V[W+3]=1;N.za=V}else{if(4!==z.getSize())throw new Error(`Unexpected number of color components: ${z.getSize()}`);N.za=S}}return V.isVerticesDataPresent(E.f.MatricesIndicesKind)&&(N.matricesIndices=V.getVerticesData(E.f.MatricesIndicesKind,p,W)),V.isVerticesDataPresent(E.f.MatricesWeightsKind)&&(N.matricesWeights=V.getVerticesData(E.f.MatricesWeightsKind,p,W)),V.isVerticesDataPresent(E.f.MatricesIndicesExtraKind)&&(N.matricesIndicesExtra=V.getVerticesData(E.f.MatricesIndicesExtraKind,p,W)),V.isVerticesDataPresent(E.f.MatricesWeightsExtraKind)&&(N.matricesWeightsExtra=V.getVerticesData(E.f.MatricesWeightsExtraKind,p,W)),N.indices=V.Zf(p,W),N}static CreateRibbon(V){throw(0,z.c)("ribbonBuilder")}static CreateBox(V){throw(0,z.c)("boxBuilder")}static CreateTiledBox(V){throw(0,z.c)("tiledBoxBuilder")}static CreateTiledPlane(V){throw(0,z.c)("tiledPlaneBuilder")}static CreateSphere(V){throw(0,z.c)("sphereBuilder")}static CreateCylinder(V){throw(0,z.c)("cylinderBuilder")}static CreateTorus(V){throw(0,z.c)("torusBuilder")}static CreateLineSystem(V){throw(0,z.c)("linesBuilder")}static CreateDashedLines(V){throw(0,z.c)("linesBuilder")}static CreateGround(V){throw(0,z.c)("groundBuilder")}static CreateTiledGround(V){throw(0,z.c)("groundBuilder")}static CreateGroundFromHeightMap(V){throw(0,z.c)("groundBuilder")}static fg(V){throw(0,z.c)("planeBuilder")}static CreateDisc(V){throw(0,z.c)("discBuilder")}static CreatePolygon(V,p,W,N,d,E,S){throw(0,z.c)("polygonBuilder")}static CreateIcoSphere(V){throw(0,z.c)("icoSphereBuilder")}static CreatePolyhedron(V){throw(0,z.c)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||d.n.Up();throw(0,z.c)("capsuleBuilder")}static CreateTorusKnot(V){throw(0,z.c)("torusKnotBuilder")}static ComputeNormals(V,p,W,N){let E=0,z=0,S=0,Q=0,J=0,i=0,l=0,j=0,k=0,u=0,f=0,O=0,U=0,F=0,C=0,A=0,v=0,t=0,e=0,Z=0,o=!1,K=!1,h=!1,L=!1,x=1,T=0,P=null;N&&(o=!!N.facetNormals,K=!!N.facetPositions,h=!!N.facetPartitioning,x=!0===N.useRightHandedSystem?-1:1,T=N.ratio||0,L=!!N.depthSort,P=N.distanceTo,L&&void 0===P&&(P=d.n.Zero()));let b=0,s=0,G=0,R=0;for(h&&N&&N.bbSize&&(b=N.subDiv.X*T/N.bbSize.x,s=N.subDiv.Y*T/N.bbSize.y,G=N.subDiv.Z*T/N.bbSize.z,R=N.subDiv.max*N.subDiv.max,N.facetPartitioning.length=0),E=0;E<V.length;E++)W[E]=0;const X=p.length/3|0;for(E=0;E<X;E++){if(O=3*p[3*E],U=O+1,F=O+2,C=3*p[3*E+1],A=C+1,v=C+2,t=3*p[3*E+2],e=t+1,Z=t+2,z=V[O]-V[C],S=V[U]-V[A],Q=V[F]-V[v],J=V[t]-V[C],i=V[e]-V[A],l=V[Z]-V[v],j=x*(S*l-Q*i),k=x*(Q*J-z*l),u=x*(z*i-S*J),f=Math.sqrt(j*j+k*k+u*u),f=0===f?1:f,j/=f,k/=f,u/=f,o&&N&&(N.facetNormals[E].x=j,N.facetNormals[E].y=k,N.facetNormals[E].z=u),K&&N&&(N.facetPositions[E].x=(V[O]+V[C]+V[t])/3,N.facetPositions[E].y=(V[U]+V[A]+V[e])/3,N.facetPositions[E].z=(V[F]+V[v]+V[Z])/3),h&&N){const p=Math.floor((N.facetPositions[E].x-N.bInfo.minimum.x*T)*b),W=Math.floor((N.facetPositions[E].y-N.bInfo.minimum.y*T)*s),d=Math.floor((N.facetPositions[E].z-N.bInfo.minimum.z*T)*G),z=Math.floor((V[O]-N.bInfo.minimum.x*T)*b),S=Math.floor((V[U]-N.bInfo.minimum.y*T)*s),Q=Math.floor((V[F]-N.bInfo.minimum.z*T)*G),J=Math.floor((V[C]-N.bInfo.minimum.x*T)*b),i=Math.floor((V[A]-N.bInfo.minimum.y*T)*s),l=Math.floor((V[v]-N.bInfo.minimum.z*T)*G),j=Math.floor((V[t]-N.bInfo.minimum.x*T)*b),k=Math.floor((V[e]-N.bInfo.minimum.y*T)*s),u=Math.floor((V[Z]-N.bInfo.minimum.z*T)*G),f=z+N.subDiv.max*S+R*Q,o=J+N.subDiv.max*i+R*l,K=j+N.subDiv.max*k+R*u,h=p+N.subDiv.max*W+R*d;N.facetPartitioning[h]=N.facetPartitioning[h]?N.facetPartitioning[h]:new Array,N.facetPartitioning[f]=N.facetPartitioning[f]?N.facetPartitioning[f]:new Array,N.facetPartitioning[o]=N.facetPartitioning[o]?N.facetPartitioning[o]:new Array,N.facetPartitioning[K]=N.facetPartitioning[K]?N.facetPartitioning[K]:new Array,N.facetPartitioning[f].push(E),o!=f&&N.facetPartitioning[o].push(E),K!=o&&K!=f&&N.facetPartitioning[K].push(E),h!=f&&h!=o&&h!=K&&N.facetPartitioning[h].push(E)}if(L&&N&&N.facetPositions){const V=N.depthSortedFacets[E];V.ind=3*E,V.sqDistance=d.n.DistanceSquared(N.facetPositions[E],P)}W[O]+=j,W[U]+=k,W[F]+=u,W[C]+=j,W[A]+=k,W[v]+=u,W[t]+=j,W[e]+=k,W[Z]+=u}for(E=0;E<W.length/3;E++)j=W[3*E],k=W[3*E+1],u=W[3*E+2],f=Math.sqrt(j*j+k*k+u*u),f=0===f?1:f,j/=f,k/=f,u/=f,W[3*E]=j,W[3*E+1]=k,W[3*E+2]=u}static _ComputeSides(V,p,W,N,E,z,S){const Q=W.length,J=N.length;let i,l;switch(V=V||u.DEFAULTSIDE){case u.FRONTSIDE:break;case u.BACKSIDE:for(i=0;i<Q;i+=3){const V=W[i];W[i]=W[i+2],W[i+2]=V}for(l=0;l<J;l++)N[l]=-N[l];break;case u.DOUBLESIDE:{const V=p.length,j=V/3;for(let W=0;W<V;W++)p[V+W]=p[W];for(i=0;i<Q;i+=3)W[i+Q]=W[i+2]+j,W[i+1+Q]=W[i+1]+j,W[i+2+Q]=W[i]+j;for(l=0;l<J;l++)N[J+l]=-N[l];const k=E.length;let u=0;for(u=0;u<k;u++)E[u+k]=E[u];for(z=z||new d.q(0,0,1,1),S=S||new d.q(0,0,1,1),u=0,i=0;i<k/2;i++)E[u]=z.x+(z.z-z.x)*E[u],E[u+1]=z.y+(z.w-z.y)*E[u+1],E[u+k]=S.x+(S.z-S.x)*E[u+k],E[u+k+1]=S.y+(S.w-S.y)*E[u+k+1],u+=2;break}}}static Parse(V){const p=new u,W=V.xa;W&&p.set(W,E.f.PositionKind);const N=V.ya;N&&p.set(N,E.f.NormalKind);const d=V.tangents;d&&p.set(d,E.f.TangentKind);const z=V.Aa;z&&p.set(z,E.f.UVKind);const Q=V.uvs2;Q&&p.set(Q,E.f.UV2Kind);const J=V.uvs3;J&&p.set(J,E.f.UV3Kind);const i=V.uvs4;i&&p.set(i,E.f.UV4Kind);const l=V.uvs5;l&&p.set(l,E.f.UV5Kind);const j=V.uvs6;j&&p.set(j,E.f.UV6Kind);const f=V.za;f&&(p.set(S.e.CheckColors4(f,W.length/3),E.f.ColorKind),void 0!==V.hasVertexAlpha&&(p.hasVertexAlpha=V.hasVertexAlpha));const O=V.matricesIndices;O&&p.set(O,E.f.MatricesIndicesKind);const U=V.matricesWeights;U&&p.set(U,E.f.MatricesWeightsKind);const F=V.indices;F&&(p.indices=F);const C=V.materialInfos;if(C){p.materialInfos=[];for(const V of C){const W=new k;W.indexCount=V.indexCount,W.indexStart=V.indexStart,W.verticesCount=V.verticesCount,W.verticesStart=V.verticesStart,W.materialIndex=V.materialIndex,p.materialInfos.push(W)}}return p}static ImportVertexData(V,p){const W=u.Parse(V);p.setAllVerticesData(W,V.updatable)}}u.FRONTSIDE=0,u.BACKSIDE=1,u.DOUBLESIDE=2,u.DEFAULTSIDE=0,u._UniqueIDGenerator=0,(0,N.c)([J.g.filter((function(){for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];let[N]=p;return!Array.isArray(N)}))],u,"_TransformVector3Coordinates",null),(0,N.c)([J.g.filter((function(){for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];let[N]=p;return!Array.isArray(N)}))],u,"_TransformVector3Normals",null),(0,N.c)([J.g.filter((function(){for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];let[N]=p;return!Array.isArray(N)}))],u,"_TransformVector4Normals",null),(0,N.c)([J.g.filter((function(){for(var V=arguments.length,p=new Array(V),W=0;W<V;W++)p[W]=arguments[W];let[N]=p;return!Array.isArray(N)}))],u,"_FlipFaces",null)},12974:(V,p,W)=>{"use strict";W.d(p,{e:()=>fV});var N=W(11218),d=W(11510),E=W(11291),z=W(11544),S=W(11467);function Q(V){let p=V.pathArray;const W=V.closeArray||!1,N=V.closePath||!1,d=V.invertUV||!1,Q=Math.floor(p[0].length/2);let J=V.offset||Q;J=J>Q?Q:Math.floor(J);const i=0===V.sideOrientation?0:V.sideOrientation||z.b.DEFAULTSIDE,l=V.Aa,j=V.za,k=[],u=[],f=[],O=[],U=[],F=[],C=[],A=[];let v;const t=[],e=[];let Z,o,K;if(p.length<2){const V=[],W=[];for(o=0;o<p[0].length-J;o++)V.push(p[0][o]),W.push(p[0][o+J]);p=[V,W]}let h=0;const L=N?1:0,x=W?1:0;let T,P,b,s,G,R;for(v=p[0].length,Z=0;Z<p.length+x;Z++){for(C[Z]=0,U[Z]=[0],T=Z===p.length?p[0]:p[Z],P=T.length,v=v<P?v:P,K=0;K<P;)k.push(T[K].x,T[K].y,T[K].z),K>0&&(b=T[K].ed(T[K-1]).length(),s=b+C[Z],U[Z].push(s),C[Z]=s),K++;N&&(K--,k.push(T[0].x,T[0].y,T[0].z),b=T[K].ed(T[0]).length(),s=b+C[Z],U[Z].push(s),C[Z]=s),t[Z]=P+L,e[Z]=h,h+=P+L}let X,r,B=null,Y=null;for(o=0;o<v+L;o++)for(A[o]=0,F[o]=[0],Z=0;Z<p.length-1+x;Z++)G=p[Z],R=Z===p.length-1?p[0]:p[Z+1],o===v?(B=G[0],Y=R[0]):(B=G[o],Y=R[o]),b=Y.ed(B).length(),s=b+A[o],F[o].push(s),A[o]=s;if(l)for(Z=0;Z<l.length;Z++)O.push(l[Z].x,S.d?1-l[Z].y:l[Z].y);else for(Z=0;Z<p.length+x;Z++)for(o=0;o<v+L;o++)X=0!=C[Z]?U[Z][o]/C[Z]:0,r=0!=A[o]?F[o][Z]/A[o]:0,d?O.push(r,X):O.push(X,S.d?1-r:r);Z=0;let I=0,c=t[Z]-1,q=t[Z+1]-1,g=c<q?c:q,D=e[1]-e[0];const H=t.length-1;for(;I<=g&&Z<H;)u.push(I,I+D,I+1),u.push(I+D+1,I+1,I+D),I+=1,I===g&&(Z++,D=e[Z+1]-e[Z],c=t[Z]-1,q=t[Z+1]-1,I=e[Z],g=c<q?c+I:q+I);if(z.b.ComputeNormals(k,u,f),N){let V=0,W=0;for(Z=0;Z<p.length;Z++){V=3*e[Z],W=Z+1<p.length?3*(e[Z+1]-1):f.length-3,f[V]=.5*(f[V]+f[W]),f[V+1]=.5*(f[V+1]+f[W+1]),f[V+2]=.5*(f[V+2]+f[W+2]);const N=Math.sqrt(f[V]*f[V]+f[V+1]*f[V+1]+f[V+2]*f[V+2]);f[V]/=N,f[V+1]/=N,f[V+2]/=N,f[W]=f[V],f[W+1]=f[V+1],f[W+2]=f[V+2]}}if(W){let V=3*e[0],W=3*e[p.length];for(o=0;o<v+L;o++){f[V]=.5*(f[V]+f[W]),f[V+1]=.5*(f[V+1]+f[W+1]),f[V+2]=.5*(f[V+2]+f[W+2]);const p=Math.sqrt(f[V]*f[V]+f[V+1]*f[V+1]+f[V+2]*f[V+2]);f[V]/=p,f[V+1]/=p,f[V+2]/=p,f[W]=f[V],f[W+1]=f[V+1],f[W+2]=f[V+2],V+=3,W+=3}}z.b._ComputeSides(i,k,u,f,O,V.frontUVs,V.backUVs);let m=null;if(j){m=new Float32Array(4*j.length);for(let V=0;V<j.length;V++)m[4*V]=j[V].r,m[4*V+1]=j[V].g,m[4*V+2]=j[V].b,m[4*V+3]=j[V].a}const M=new z.b,a=new Float32Array(k),y=new Float32Array(f),n=new Float32Array(O);return M.indices=u,M.xa=a,M.ya=y,M.Aa=n,m&&M.set(m,E.f.ColorKind),N&&(M._idx=e),M}function J(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=p.pathArray,i=p.closeArray,l=p.closePath,j=d.e._GetDefaultSideOrientation(p.sideOrientation),k=p.instance,u=p.updatable;if(k){const V=N.i.fb[0].ee(Number.MAX_VALUE),W=N.i.fb[1].ee(-Number.MAX_VALUE),Q=p=>{let N=J[0].length;const E=k;let z=0;const S=E._originalBuilderSideOrientation===d.e.DOUBLESIDE?2:1;for(let d=1;d<=S;++d)for(let S=0;S<J.length;++S){const d=J[S],Q=d.length;N=N<Q?N:Q;for(let E=0;E<N;++E){const N=d[E];p[z]=N.x,p[z+1]=N.y,p[z+2]=N.z,V.minimizeInPlaceFromFloats(N.x,N.y,N.z),W.maximizeInPlaceFromFloats(N.x,N.y,N.z),z+=3}if(E._creationDataStorage&&E._creationDataStorage.closePath){const V=d[0];p[z]=V.x,p[z+1]=V.y,p[z+2]=V.z,z+=3}}},i=k.getVerticesData(E.f.PositionKind);if(Q(i),k.hasBoundingInfo?k.getBoundingInfo().reConstruct(V,W,k._worldMatrix):k.buildBoundingInfo(V,W,k._worldMatrix),k.updateVerticesData(E.f.PositionKind,i,!1,!1),p.za){const V=k.getVerticesData(E.f.ColorKind);for(let W=0,N=0;W<p.za.length;W++,N+=4){const d=p.za[W];V[N]=d.r,V[N+1]=d.g,V[N+2]=d.b,V[N+3]=d.a}k.updateVerticesData(E.f.ColorKind,V,!1,!1)}if(p.Aa){const V=k.getVerticesData(E.f.UVKind);for(let W=0;W<p.Aa.length;W++)V[2*W]=p.Aa[W].x,V[2*W+1]=S.d?1-p.Aa[W].y:p.Aa[W].y;k.updateVerticesData(E.f.UVKind,V,!1,!1)}if(!k.areNormalsFrozen||k.isFacetDataEnabled){const V=k.Zf(),p=k.getVerticesData(E.f.NormalKind),W=k.isFacetDataEnabled?k.getFacetDataParameters():null;if(z.b.ComputeNormals(i,V,p,W),k._creationDataStorage&&k._creationDataStorage.closePath){let V=0,W=0;for(let N=0;N<J.length;N++)V=3*k._creationDataStorage.idx[N],W=N+1<J.length?3*(k._creationDataStorage.idx[N+1]-1):p.length-3,p[V]=.5*(p[V]+p[W]),p[V+1]=.5*(p[V+1]+p[W+1]),p[V+2]=.5*(p[V+2]+p[W+2]),p[W]=p[V],p[W+1]=p[V+1],p[W+2]=p[V+2]}k.areNormalsFrozen||k.updateVerticesData(E.f.NormalKind,p,!1,!1)}return k}{const N=new d.e(V,W);N._originalBuilderSideOrientation=j,N._creationDataStorage=new d.f;const E=Q(p);return l&&(N._creationDataStorage.idx=E._idx),N._creationDataStorage.closePath=l,N._creationDataStorage.closeArray=i,E.Ca(N,u),N}}z.b.CreateRibbon=Q,d.e.CreateRibbon=function(V,p){return J(V,{pathArray:p,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var i=W(11899),l=W(11591),j=W(11257);function k(V){const p=V.pattern||d.e.NO_FLIP,W=V.tileWidth||V.tileSize||1,N=V.tileHeight||V.tileSize||1,E=V.alignHorizontal||0,S=V.alignVertical||0,Q=V.width||V.size||1,J=Math.floor(Q/W);let i=Q-J*W;const l=V.height||V.size||1,j=Math.floor(l/N);let k=l-j*N;const u=W*J/2,f=N*j/2;let O=0,U=0,F=0,C=0,A=0,v=0;if(i>0||k>0){switch(F=-u,C=-f,A=u,v=f,E){case d.e.CENTER:i/=2,F-=i,A+=i;break;case d.e.LEFT:A+=i,O=-i/2;break;case d.e.RIGHT:F-=i,O=i/2}switch(S){case d.e.CENTER:k/=2,C-=k,v+=k;break;case d.e.BOTTOM:v+=k,U=-k/2;break;case d.e.TOP:C-=k,U=k/2}}const t=[],e=[],Z=[];Z[0]=[0,0,1,0,1,1,0,1],Z[1]=[0,0,1,0,1,1,0,1],p!==d.e.ROTATE_TILE&&p!==d.e.ROTATE_ROW||(Z[1]=[1,1,0,1,0,0,1,0]),p!==d.e.FLIP_TILE&&p!==d.e.FLIP_ROW||(Z[1]=[1,0,0,0,0,1,1,1]),p!==d.e.FLIP_N_ROTATE_TILE&&p!==d.e.FLIP_N_ROTATE_ROW||(Z[1]=[0,1,1,1,1,0,0,0]);let o=[];const K=[],h=[];let L=0;for(let z=0;z<j;z++)for(let V=0;V<J;V++)t.push(V*W-u+O,z*N-f+U,0),t.push((V+1)*W-u+O,z*N-f+U,0),t.push((V+1)*W-u+O,(z+1)*N-f+U,0),t.push(V*W-u+O,(z+1)*N-f+U,0),h.push(L,L+1,L+3,L+1,L+2,L+3),o=p===d.e.FLIP_TILE||p===d.e.ROTATE_TILE||p===d.e.FLIP_N_ROTATE_TILE?o.concat(Z[(V%2+z%2)%2]):p===d.e.FLIP_ROW||p===d.e.ROTATE_ROW||p===d.e.FLIP_N_ROTATE_ROW?o.concat(Z[z%2]):o.concat(Z[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),L+=4;if(i>0||k>0){const V=k>0&&(S===d.e.CENTER||S===d.e.TOP),z=k>0&&(S===d.e.CENTER||S===d.e.BOTTOM),Q=i>0&&(E===d.e.CENTER||E===d.e.RIGHT),l=i>0&&(E===d.e.CENTER||E===d.e.LEFT);let Z,x,T,P,b=[];if(V&&Q&&(t.push(F+O,C+U,0),t.push(-u+O,C+U,0),t.push(-u+O,C+k+U,0),t.push(F+O,C+k+U,0),h.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,Z=1-i/W,x=1-k/N,T=1,P=1,b=[Z,x,T,x,T,P,Z,P],p===d.e.ROTATE_ROW&&(b=[1-Z,1-x,1-T,1-x,1-T,1-P,1-Z,1-P]),p===d.e.FLIP_ROW&&(b=[1-Z,x,1-T,x,1-T,P,1-Z,P]),p===d.e.FLIP_N_ROTATE_ROW&&(b=[Z,1-x,T,1-x,T,1-P,Z,1-P]),o=o.concat(b),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V&&l&&(t.push(u+O,C+U,0),t.push(A+O,C+U,0),t.push(A+O,C+k+U,0),t.push(u+O,C+k+U,0),h.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,Z=0,x=1-k/N,T=i/W,P=1,b=[Z,x,T,x,T,P,Z,P],(p===d.e.ROTATE_ROW||p===d.e.ROTATE_TILE&&J%2===0)&&(b=[1-Z,1-x,1-T,1-x,1-T,1-P,1-Z,1-P]),(p===d.e.FLIP_ROW||p===d.e.FLIP_TILE&&J%2===0)&&(b=[1-Z,x,1-T,x,1-T,P,1-Z,P]),(p===d.e.FLIP_N_ROTATE_ROW||p===d.e.FLIP_N_ROTATE_TILE&&J%2===0)&&(b=[Z,1-x,T,1-x,T,1-P,Z,1-P]),o=o.concat(b),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),z&&Q&&(t.push(F+O,f+U,0),t.push(-u+O,f+U,0),t.push(-u+O,v+U,0),t.push(F+O,v+U,0),h.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,Z=1-i/W,x=0,T=1,P=k/N,b=[Z,x,T,x,T,P,Z,P],(p===d.e.ROTATE_ROW&&j%2===1||p===d.e.ROTATE_TILE&&j%1===0)&&(b=[1-Z,1-x,1-T,1-x,1-T,1-P,1-Z,1-P]),(p===d.e.FLIP_ROW&&j%2===1||p===d.e.FLIP_TILE&&j%2===0)&&(b=[1-Z,x,1-T,x,1-T,P,1-Z,P]),(p===d.e.FLIP_N_ROTATE_ROW&&j%2===1||p===d.e.FLIP_N_ROTATE_TILE&&j%2===0)&&(b=[Z,1-x,T,1-x,T,1-P,Z,1-P]),o=o.concat(b),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),z&&l&&(t.push(u+O,f+U,0),t.push(A+O,f+U,0),t.push(A+O,v+U,0),t.push(u+O,v+U,0),h.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,Z=0,x=0,T=i/W,P=k/N,b=[Z,x,T,x,T,P,Z,P],(p===d.e.ROTATE_ROW&&j%2===1||p===d.e.ROTATE_TILE&&(j+J)%2===1)&&(b=[1-Z,1-x,1-T,1-x,1-T,1-P,1-Z,1-P]),(p===d.e.FLIP_ROW&&j%2===1||p===d.e.FLIP_TILE&&(j+J)%2===1)&&(b=[1-Z,x,1-T,x,1-T,P,1-Z,P]),(p===d.e.FLIP_N_ROTATE_ROW&&j%2===1||p===d.e.FLIP_N_ROTATE_TILE&&(j+J)%2===1)&&(b=[Z,1-x,T,1-x,T,1-P,Z,1-P]),o=o.concat(b),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V){const V=[];Z=0,x=1-k/N,T=1,P=1,V[0]=[Z,x,T,x,T,P,Z,P],V[1]=[Z,x,T,x,T,P,Z,P],p!==d.e.ROTATE_TILE&&p!==d.e.ROTATE_ROW||(V[1]=[1-Z,1-x,1-T,1-x,1-T,1-P,1-Z,1-P]),p!==d.e.FLIP_TILE&&p!==d.e.FLIP_ROW||(V[1]=[1-Z,x,1-T,x,1-T,P,1-Z,P]),p!==d.e.FLIP_N_ROTATE_TILE&&p!==d.e.FLIP_N_ROTATE_ROW||(V[1]=[Z,1-x,T,1-x,T,1-P,Z,1-P]);for(let N=0;N<J;N++)t.push(N*W-u+O,C+U,0),t.push((N+1)*W-u+O,C+U,0),t.push((N+1)*W-u+O,C+k+U,0),t.push(N*W-u+O,C+k+U,0),h.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,o=p===d.e.FLIP_TILE||p===d.e.ROTATE_TILE||p===d.e.FLIP_N_ROTATE_TILE?o.concat(V[(N+1)%2]):p===d.e.FLIP_ROW||p===d.e.ROTATE_ROW||p===d.e.FLIP_N_ROTATE_ROW?o.concat(V[1]):o.concat(V[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(z){const V=[];Z=0,x=0,T=1,P=k/N,V[0]=[Z,x,T,x,T,P,Z,P],V[1]=[Z,x,T,x,T,P,Z,P],p!==d.e.ROTATE_TILE&&p!==d.e.ROTATE_ROW||(V[1]=[1-Z,1-x,1-T,1-x,1-T,1-P,1-Z,1-P]),p!==d.e.FLIP_TILE&&p!==d.e.FLIP_ROW||(V[1]=[1-Z,x,1-T,x,1-T,P,1-Z,P]),p!==d.e.FLIP_N_ROTATE_TILE&&p!==d.e.FLIP_N_ROTATE_ROW||(V[1]=[Z,1-x,T,1-x,T,1-P,Z,1-P]);for(let N=0;N<J;N++)t.push(N*W-u+O,v-k+U,0),t.push((N+1)*W-u+O,v-k+U,0),t.push((N+1)*W-u+O,v+U,0),t.push(N*W-u+O,v+U,0),h.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,o=p===d.e.FLIP_TILE||p===d.e.ROTATE_TILE||p===d.e.FLIP_N_ROTATE_TILE?o.concat(V[(N+j)%2]):p===d.e.FLIP_ROW||p===d.e.ROTATE_ROW||p===d.e.FLIP_N_ROTATE_ROW?o.concat(V[j%2]):o.concat(V[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Q){const V=[];Z=1-i/W,x=0,T=1,P=1,V[0]=[Z,x,T,x,T,P,Z,P],V[1]=[Z,x,T,x,T,P,Z,P],p!==d.e.ROTATE_TILE&&p!==d.e.ROTATE_ROW||(V[1]=[1-Z,1-x,1-T,1-x,1-T,1-P,1-Z,1-P]),p!==d.e.FLIP_TILE&&p!==d.e.FLIP_ROW||(V[1]=[1-Z,x,1-T,x,1-T,P,1-Z,P]),p!==d.e.FLIP_N_ROTATE_TILE&&p!==d.e.FLIP_N_ROTATE_ROW||(V[1]=[Z,1-x,T,1-x,T,1-P,Z,1-P]);for(let W=0;W<j;W++)t.push(F+O,W*N-f+U,0),t.push(F+i+O,W*N-f+U,0),t.push(F+i+O,(W+1)*N-f+U,0),t.push(F+O,(W+1)*N-f+U,0),h.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,o=p===d.e.FLIP_TILE||p===d.e.ROTATE_TILE||p===d.e.FLIP_N_ROTATE_TILE?o.concat(V[(W+1)%2]):p===d.e.FLIP_ROW||p===d.e.ROTATE_ROW||p===d.e.FLIP_N_ROTATE_ROW?o.concat(V[W%2]):o.concat(V[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(l){const V=[];Z=0,x=0,T=i/N,P=1,V[0]=[Z,x,T,x,T,P,Z,P],V[1]=[Z,x,T,x,T,P,Z,P],p!==d.e.ROTATE_TILE&&p!==d.e.ROTATE_ROW||(V[1]=[1-Z,1-x,1-T,1-x,1-T,1-P,1-Z,1-P]),p!==d.e.FLIP_TILE&&p!==d.e.FLIP_ROW||(V[1]=[1-Z,x,1-T,x,1-T,P,1-Z,P]),p!==d.e.FLIP_N_ROTATE_TILE&&p!==d.e.FLIP_N_ROTATE_ROW||(V[1]=[Z,1-x,T,1-x,T,1-P,Z,1-P]);for(let W=0;W<j;W++)t.push(A-i+O,W*N-f+U,0),t.push(A+O,W*N-f+U,0),t.push(A+O,(W+1)*N-f+U,0),t.push(A-i+O,(W+1)*N-f+U,0),h.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,o=p===d.e.FLIP_TILE||p===d.e.ROTATE_TILE||p===d.e.FLIP_N_ROTATE_TILE?o.concat(V[(W+J)%2]):p===d.e.FLIP_ROW||p===d.e.ROTATE_ROW||p===d.e.FLIP_N_ROTATE_ROW?o.concat(V[W%2]):o.concat(V[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const x=0===V.sideOrientation?0:V.sideOrientation||z.b.DEFAULTSIDE;z.b._ComputeSides(x,t,h,e,o,V.frontUVs,V.backUVs);const T=new z.b;T.indices=h,T.xa=t,T.ya=e,T.Aa=o;const P=x===z.b.DOUBLESIDE?K.concat(K):K;return T.za=P,T}function u(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new d.e(V,W);p.sideOrientation=d.e._GetDefaultSideOrientation(p.sideOrientation),N._originalBuilderSideOrientation=p.sideOrientation;return k(p).Ca(N,p.updatable),N}function f(V){const p=V.faceUV||new Array(6),W=V.faceColors,E=V.pattern||d.e.NO_FLIP,Q=V.width||V.size||1,J=V.height||V.size||1,i=V.depth||V.size||1,l=V.tileWidth||V.tileSize||1,u=V.tileHeight||V.tileSize||1,f=V.alignHorizontal||0,O=V.alignVertical||0,U=0===V.sideOrientation?0:V.sideOrientation||z.b.DEFAULTSIDE;for(let d=0;d<6;d++)void 0===p[d]&&(p[d]=new N.q(0,0,1,1)),W&&void 0===W[d]&&(W[d]=new j.e(1,1,1,1));const F=Q/2,C=J/2,A=i/2,v=[];for(let N=0;N<2;N++)v[N]=k({pattern:E,tileWidth:l,tileHeight:u,width:Q,height:J,alignVertical:O,alignHorizontal:f,sideOrientation:U});for(let N=2;N<4;N++)v[N]=k({pattern:E,tileWidth:l,tileHeight:u,width:i,height:J,alignVertical:O,alignHorizontal:f,sideOrientation:U});let t=O;O===d.e.BOTTOM?t=d.e.TOP:O===d.e.TOP&&(t=d.e.BOTTOM);for(let N=4;N<6;N++)v[N]=k({pattern:E,tileWidth:l,tileHeight:u,width:Q,height:i,alignVertical:t,alignHorizontal:f,sideOrientation:U});let e=[],Z=[],o=[],K=[];const h=[],L=[],x=[],T=[];let P=0,b=0;for(let d=0;d<6;d++){const V=v[d].xa.length;L[d]=[],x[d]=[];for(let p=0;p<V/3;p++)L[d].push(new N.n(v[d].xa[3*p],v[d].xa[3*p+1],v[d].xa[3*p+2])),x[d].push(new N.n(v[d].ya[3*p],v[d].ya[3*p+1],v[d].ya[3*p+2]));P=v[d].Aa.length,T[d]=[];for(let W=0;W<P;W+=2)T[d][W]=p[d].x+(p[d].z-p[d].x)*v[d].Aa[W],T[d][W+1]=p[d].y+(p[d].w-p[d].y)*v[d].Aa[W+1],S.d&&(T[d][W+1]=1-T[d][W+1]);if(o=o.concat(T[d]),K=K.concat(v[d].indices.map((V=>V+b))),b+=L[d].length,W)for(let p=0;p<4;p++)h.push(W[d].r,W[d].g,W[d].b,W[d].a)}const s=new N.n(0,0,A),G=N.e.RotationY(Math.PI);e=L[0].map((V=>N.n.TransformNormal(V,G).add(s))).map((V=>[V.x,V.y,V.z])).reduce(((V,p)=>V.concat(p)),[]),Z=x[0].map((V=>N.n.TransformNormal(V,G))).map((V=>[V.x,V.y,V.z])).reduce(((V,p)=>V.concat(p)),[]),e=e.concat(L[1].map((V=>V.ed(s))).map((V=>[V.x,V.y,V.z])).reduce(((V,p)=>V.concat(p)),[])),Z=Z.concat(x[1].map((V=>[V.x,V.y,V.z])).reduce(((V,p)=>V.concat(p)),[]));const R=new N.n(F,0,0),X=N.e.RotationY(-Math.PI/2);e=e.concat(L[2].map((V=>N.n.TransformNormal(V,X).add(R))).map((V=>[V.x,V.y,V.z])).reduce(((V,p)=>V.concat(p)),[])),Z=Z.concat(x[2].map((V=>N.n.TransformNormal(V,X))).map((V=>[V.x,V.y,V.z])).reduce(((V,p)=>V.concat(p)),[]));const r=N.e.RotationY(Math.PI/2);e=e.concat(L[3].map((V=>N.n.TransformNormal(V,r).ed(R))).map((V=>[V.x,V.y,V.z])).reduce(((V,p)=>V.concat(p)),[])),Z=Z.concat(x[3].map((V=>N.n.TransformNormal(V,r))).map((V=>[V.x,V.y,V.z])).reduce(((V,p)=>V.concat(p)),[]));const B=new N.n(0,C,0),Y=N.e.RotationX(Math.PI/2);e=e.concat(L[4].map((V=>N.n.TransformNormal(V,Y).add(B))).map((V=>[V.x,V.y,V.z])).reduce(((V,p)=>V.concat(p)),[])),Z=Z.concat(x[4].map((V=>N.n.TransformNormal(V,Y))).map((V=>[V.x,V.y,V.z])).reduce(((V,p)=>V.concat(p)),[]));const I=N.e.RotationX(-Math.PI/2);e=e.concat(L[5].map((V=>N.n.TransformNormal(V,I).ed(B))).map((V=>[V.x,V.y,V.z])).reduce(((V,p)=>V.concat(p)),[])),Z=Z.concat(x[5].map((V=>N.n.TransformNormal(V,I))).map((V=>[V.x,V.y,V.z])).reduce(((V,p)=>V.concat(p)),[])),z.b._ComputeSides(U,e,K,Z,o);const c=new z.b;if(c.indices=K,c.xa=e,c.ya=Z,c.Aa=o,W){const V=U===z.b.DOUBLESIDE?h.concat(h):h;c.za=V}return c}function O(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new d.e(V,W);p.sideOrientation=d.e._GetDefaultSideOrientation(p.sideOrientation),N._originalBuilderSideOrientation=p.sideOrientation;return f(p).Ca(N,p.updatable),N}z.b.CreateTiledPlane=k;z.b.CreateTiledBox=f;var U=W(11883),F=W(11200),C=W(11579);function A(V){const p=V.height||2;let W=0===V.diameterTop?0:V.diameterTop||V.diameter||1,E=0===V.diameterBottom?0:V.diameterBottom||V.diameter||1;W=W||1e-5,E=E||1e-5;const Q=0|(V.tessellation||24),J=0|(V.subdivisions||1),i=!!V.hasRings,l=!!V.enclose,k=0===V.cap?0:V.cap||d.e.CAP_ALL,u=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,f=0===V.sideOrientation?0:V.sideOrientation||z.b.DEFAULTSIDE,O=V.faceUV||new Array(3),U=V.faceColors,F=2+(1+(1!==u&&l?2:0))*(i?J:1);let A;for(A=0;A<F;A++)U&&void 0===U[A]&&(U[A]=new j.e(1,1,1,1));for(A=0;A<F;A++)O&&void 0===O[A]&&(O[A]=new N.q(0,0,1,1));const v=[],t=[],e=[],Z=[],o=[],K=2*Math.PI*u/Q;let h,L,x;const T=(E-W)/2/p,P=N.n.Zero(),b=N.n.Zero(),s=N.n.Zero(),G=N.n.Zero(),R=N.n.Zero(),X=C.e.Y;let r,B,Y,I=1,c=1,q=0,g=0;for(r=0;r<=J;r++)for(L=r/J,x=(L*(W-E)+E)/2,I=i&&0!==r&&r!==J?2:1,Y=0;Y<I;Y++){for(i&&(c+=Y),l&&(c+=2*Y),B=0;B<=Q;B++)h=B*K,P.x=Math.cos(-h)*x,P.y=-p/2+L*p,P.z=Math.sin(-h)*x,0===W&&r===J?(b.x=e[e.length-3*(Q+1)],b.y=e[e.length-3*(Q+1)+1],b.z=e[e.length-3*(Q+1)+2]):(b.x=P.x,b.z=P.z,b.y=Math.sqrt(b.x*b.x+b.z*b.z)*T,b.normalize()),0===B&&(s.p(P),G.p(b)),t.push(P.x,P.y,P.z),e.push(b.x,b.y,b.z),g=i?q!==c?O[c].y:O[c].w:O[c].y+(O[c].w-O[c].y)*L,Z.push(O[c].x+(O[c].z-O[c].x)*B/Q,S.d?1-g:g),U&&o.push(U[c].r,U[c].g,U[c].b,U[c].a);1!==u&&l&&(t.push(P.x,P.y,P.z),t.push(0,P.y,0),t.push(0,P.y,0),t.push(s.x,s.y,s.z),N.n.CrossToRef(X,b,R),R.normalize(),e.push(R.x,R.y,R.z,R.x,R.y,R.z),N.n.CrossToRef(G,X,R),R.normalize(),e.push(R.x,R.y,R.z,R.x,R.y,R.z),g=i?q!==c?O[c+1].y:O[c+1].w:O[c+1].y+(O[c+1].w-O[c+1].y)*L,Z.push(O[c+1].x,S.d?1-g:g),Z.push(O[c+1].z,S.d?1-g:g),g=i?q!==c?O[c+2].y:O[c+2].w:O[c+2].y+(O[c+2].w-O[c+2].y)*L,Z.push(O[c+2].x,S.d?1-g:g),Z.push(O[c+2].z,S.d?1-g:g),U&&(o.push(U[c+1].r,U[c+1].g,U[c+1].b,U[c+1].a),o.push(U[c+1].r,U[c+1].g,U[c+1].b,U[c+1].a),o.push(U[c+2].r,U[c+2].g,U[c+2].b,U[c+2].a),o.push(U[c+2].r,U[c+2].g,U[c+2].b,U[c+2].a))),q!==c&&(q=c)}const D=1!==u&&l?Q+4:Q;for(r=0,c=0;c<J;c++){let V=0,p=0,W=0,N=0;for(B=0;B<Q;B++)V=r*(D+1)+B,p=(r+1)*(D+1)+B,W=r*(D+1)+(B+1),N=(r+1)*(D+1)+(B+1),v.push(V,p,W),v.push(N,W,p);1!==u&&l&&(v.push(V+2,p+2,W+2),v.push(N+2,W+2,p+2),v.push(V+4,p+4,W+4),v.push(N+4,W+4,p+4)),r=i?r+2:r+1}const H=V=>{const d=V?W/2:E/2;if(0===d)return;let z,J,i;const l=V?O[F-1]:O[0];let j=null;U&&(j=V?U[F-1]:U[0]);const k=t.length/3,f=V?p/2:-p/2,C=new N.n(0,f,0);t.push(C.x,C.y,C.z),e.push(0,V?1:-1,0);const A=l.y+.5*(l.w-l.y);Z.push(l.x+.5*(l.z-l.x),S.d?1-A:A),j&&o.push(j.r,j.g,j.b,j.a);const K=new N.k(.5,.5);for(i=0;i<=Q;i++){z=2*Math.PI*i*u/Q;const p=Math.cos(-z),W=Math.sin(-z);J=new N.n(p*d,f,W*d);const E=new N.k(p*K.x+.5,W*K.y+.5);t.push(J.x,J.y,J.z),e.push(0,V?1:-1,0);const k=l.y+(l.w-l.y)*E.y;Z.push(l.x+(l.z-l.x)*E.x,S.d?1-k:k),j&&o.push(j.r,j.g,j.b,j.a)}for(i=0;i<Q;i++)V?(v.push(k),v.push(k+(i+2)),v.push(k+(i+1))):(v.push(k),v.push(k+(i+1)),v.push(k+(i+2)))};k!==d.e.CAP_START&&k!==d.e.CAP_ALL||H(!1),k!==d.e.CAP_END&&k!==d.e.CAP_ALL||H(!0),z.b._ComputeSides(f,t,v,e,Z,V.frontUVs,V.backUVs);const m=new z.b;return m.indices=v,m.xa=t,m.ya=e,m.Aa=Z,U&&(m.za=o),m}function v(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;const N=new d.e(V,W);p.sideOrientation=d.e._GetDefaultSideOrientation(p.sideOrientation),N._originalBuilderSideOrientation=p.sideOrientation;return A(p).Ca(N,p.updatable),N}function t(V){const p=[],W=[],d=[],E=[],Q=V.diameter||1,J=V.thickness||.5,i=0|(V.tessellation||16),l=0===V.sideOrientation?0:V.sideOrientation||z.b.DEFAULTSIDE,j=i+1;for(let z=0;z<=i;z++){const V=z/i,l=z*Math.PI*2/i-Math.PI/2,k=N.e.Translation(Q/2,0,0).multiply(N.e.RotationY(l));for(let Q=0;Q<=i;Q++){const l=1-Q/i,u=Q*Math.PI*2/i+Math.PI,f=Math.cos(u),O=Math.sin(u);let U=new N.n(f,O,0),F=U.scale(J/2);const C=new N.k(V,l);F=N.n.TransformCoordinates(F,k),U=N.n.TransformNormal(U,k),W.push(F.x,F.y,F.z),d.push(U.x,U.y,U.z),E.push(C.x,S.d?1-C.y:C.y);const A=(z+1)%j,v=(Q+1)%j;p.push(z*j+Q),p.push(z*j+v),p.push(A*j+Q),p.push(z*j+v),p.push(A*j+v),p.push(A*j+Q)}}z.b._ComputeSides(l,W,p,d,E,V.frontUVs,V.backUVs);const k=new z.b;return k.indices=p,k.xa=W,k.ya=d,k.Aa=E,k}function e(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;const N=new d.e(V,W);p.sideOrientation=d.e._GetDefaultSideOrientation(p.sideOrientation),N._originalBuilderSideOrientation=p.sideOrientation;return t(p).Ca(N,p.updatable),N}z.b.CreateCylinder=A,d.e.CreateCylinder=(V,p,W,N,E,z,S,Q,J)=>{void 0!==S&&S instanceof F.e||(void 0!==S&&(J=Q||d.e.DEFAULTSIDE,Q=S),S=z,z=1);return v(V,{height:p,diameterTop:W,diameterBottom:N,tessellation:E,subdivisions:z,sideOrientation:J,updatable:Q},S)};function Z(V){const p=[],W=[],d=[],E=[],Q=V.radius||2,J=V.tube||.5,i=V.radialSegments||32,l=V.tubularSegments||32,j=V.p||2,k=V.q||3,u=0===V.sideOrientation?0:V.sideOrientation||z.b.DEFAULTSIDE,f=V=>{const p=Math.cos(V),W=Math.sin(V),d=k/j*V,E=Math.cos(d),z=Q*(2+E)*.5*p,S=Q*(2+E)*W*.5,J=Q*Math.sin(d)*.5;return new N.n(z,S,J)};let O,U;for(O=0;O<=i;O++){const V=O%i/i*2*j*Math.PI,p=f(V),d=f(V+.01),z=d.ed(p);let Q=d.add(p);const k=N.n.Cross(z,Q);for(Q=N.n.Cross(k,z),k.normalize(),Q.normalize(),U=0;U<l;U++){const V=U%l/l*2*Math.PI,N=-J*Math.cos(V),d=J*Math.sin(V);W.push(p.x+N*Q.x+d*k.x),W.push(p.y+N*Q.y+d*k.y),W.push(p.z+N*Q.z+d*k.z),E.push(O/i),E.push(S.d?1-U/l:U/l)}}for(O=0;O<i;O++)for(U=0;U<l;U++){const V=(U+1)%l,W=O*l+U,N=(O+1)*l+U,d=(O+1)*l+V,E=O*l+V;p.push(E),p.push(N),p.push(W),p.push(E),p.push(d),p.push(N)}z.b.ComputeNormals(W,p,d),z.b._ComputeSides(u,W,p,d,E,V.frontUVs,V.backUVs);const F=new z.b;return F.indices=p,F.xa=W,F.ya=d,F.Aa=E,F}function o(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2?arguments[2]:void 0;const N=new d.e(V,W);p.sideOrientation=d.e._GetDefaultSideOrientation(p.sideOrientation),N._originalBuilderSideOrientation=p.sideOrientation;return Z(p).Ca(N,p.updatable),N}z.b.CreateTorus=t,d.e.CreateTorus=(V,p,W,N,d,E,z)=>e(V,{diameter:p,thickness:W,tessellation:N,sideOrientation:z,updatable:E},d);z.b.CreateTorusKnot=Z,d.e.CreateTorusKnot=(V,p,W,N,d,E,z,S,Q,J)=>o(V,{radius:p,tube:W,radialSegments:N,tubularSegments:d,p:E,q:z,sideOrientation:J,updatable:Q},S);var K=W(12981),h=W(10870),L=W(11764),x=W(11224),T=W(10900);class P extends N.k{constructor(V,p){super(V.x,V.y),this.index=p}}class b{constructor(){this.elements=[]}add(V){const p=[];return V.forEach((V=>{const W=new P(V,this.elements.length);p.push(W),this.elements.push(W)})),p}computeBounds(){const V=new N.k(this.elements[0].x,this.elements[0].y),p=new N.k(this.elements[0].x,this.elements[0].y);return this.elements.forEach((W=>{W.x<V.x?V.x=W.x:W.x>p.x&&(p.x=W.x),W.y<V.y?V.y=W.y:W.y>p.y&&(p.y=W.y)})),{min:V,max:p,width:p.x-V.x,height:p.y-V.y}}}class s{_addToepoint(V){for(const p of V)this._epoints.push(p.x,p.y)}constructor(V,p,W){let N,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new b,this._outlinepoints=new b,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=d,this._name=V,this._scene=W||T.d.LastCreatedScene,N=p instanceof L.g?p.getPoints():p,this._addToepoint(N),this._points.add(N),this._outlinepoints.add(N),"undefined"===typeof this.bjsEarcut&&h.e.Warn("Earcut was not found, the polygon will not be built.")}addHole(V){this._points.add(V);const p=new b;return p.add(V),this._holes.push(p),this._eholes.push(this._epoints.length/2),this._addToepoint(V),this}build(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const N=new d.e(this._name,this._scene),z=this.buildVertexData(p,W);return N.Ga(E.f.PositionKind,z.xa,V),N.Ga(E.f.NormalKind,z.ya,V),N.Ga(E.f.UVKind,z.Aa,V),N.setIndices(z.indices),N}buildVertexData(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const W=new z.b,N=[],d=[],E=[],S=this._points.computeBounds();this._points.elements.forEach((V=>{N.push(0,1,0),d.push(V.x,0,V.y),E.push((V.x-S.min.x)/S.width,(V.y-S.min.y)/S.height)}));const Q=[],J=this.bjsEarcut(this._epoints,this._eholes,2);for(let z=0;z<J.length;z++)Q.push(J[z]);if(V>0){const W=d.length/3;this._points.elements.forEach((p=>{N.push(0,-1,0),d.push(p.x,-V,p.y),E.push(1-(p.x-S.min.x)/S.width,1-(p.y-S.min.y)/S.height)}));const z=Q.length;for(let V=0;V<z;V+=3){const p=Q[V+0],N=Q[V+1],d=Q[V+2];Q.push(d+W),Q.push(N+W),Q.push(p+W)}this._addSide(d,N,E,Q,S,this._outlinepoints,V,!1,p),this._holes.forEach((W=>{this._addSide(d,N,E,Q,S,W,V,!0,p)}))}return W.indices=Q,W.xa=d,W.ya=N,W.Aa=E,W}_addSide(V,p,W,d,E,z,S,Q,J){let i=V.length/3,l=0;for(let j=0;j<z.elements.length;j++){const k=z.elements[j],u=z.elements[(j+1)%z.elements.length];V.push(k.x,0,k.y),V.push(k.x,-S,k.y),V.push(u.x,0,u.y),V.push(u.x,-S,u.y);const f=z.elements[(j+z.elements.length-1)%z.elements.length],O=z.elements[(j+2)%z.elements.length];let U=new N.n(-(u.y-k.y),0,u.x-k.x),F=new N.n(-(k.y-f.y),0,k.x-f.x),C=new N.n(-(O.y-u.y),0,O.x-u.x);Q||(U=U.scale(-1),F=F.scale(-1),C=C.scale(-1));const A=U.normalizeToNew();let v=F.normalizeToNew(),t=C.normalizeToNew();const e=N.n.Dot(v,A);v=e>J?e<x.c-1?new N.n(k.x,0,k.y).ed(new N.n(u.x,0,u.y)).normalize():F.add(U).normalize():A;const Z=N.n.Dot(C,U);t=Z>J?Z<x.c-1?new N.n(u.x,0,u.y).ed(new N.n(k.x,0,k.y)).normalize():C.add(U).normalize():A,W.push(l/E.width,0),W.push(l/E.width,1),l+=U.length(),W.push(l/E.width,0),W.push(l/E.width,1),p.push(v.x,v.y,v.z),p.push(v.x,v.y,v.z),p.push(t.x,t.y,t.z),p.push(t.x,t.y,t.z),Q?(d.push(i),d.push(i+2),d.push(i+1),d.push(i+1),d.push(i+2),d.push(i+3)):(d.push(i),d.push(i+1),d.push(i+2),d.push(i+1),d.push(i+3),d.push(i+2)),i+=4}}}function G(V,p,W,d,Q,J,i){const l=W||new Array(3),k=d,u=[],f=i||!1;for(let E=0;E<3;E++)void 0===l[E]&&(l[E]=new N.q(0,0,1,1)),k&&void 0===k[E]&&(k[E]=new j.e(1,1,1,1));const O=V.getVerticesData(E.f.PositionKind),U=V.getVerticesData(E.f.NormalKind),F=V.getVerticesData(E.f.UVKind),C=V.Zf(),A=O.length/9;let v=0,t=0,e=0,Z=0,o=0;const K=[0];if(f)for(let N=A;N<O.length/3;N+=4)t=O[3*(N+2)]-O[3*N],e=O[3*(N+2)+2]-O[3*N+2],Z=Math.sqrt(t*t+e*e),o+=Z,K.push(o);let h=0,L=0;for(let N=0;N<U.length;N+=3)Math.abs(U[N+1])<.001&&(L=1),Math.abs(U[N+1]-1)<.001&&(L=0),Math.abs(U[N+1]+1)<.001&&(L=2),h=N/3,1===L?(v=h-A,F[2*h]=v%4<1.5?f?l[L].x+(l[L].z-l[L].x)*K[Math.floor(v/4)]/o:l[L].x:f?l[L].x+(l[L].z-l[L].x)*K[Math.floor(v/4)+1]/o:l[L].z,F[2*h+1]=v%2===0?S.d?1-l[L].w:l[L].w:S.d?1-l[L].y:l[L].y):(F[2*h]=(1-F[2*h])*l[L].x+F[2*h]*l[L].z,F[2*h+1]=(1-F[2*h+1])*l[L].y+F[2*h+1]*l[L].w,S.d&&(F[2*h+1]=1-F[2*h+1])),k&&u.push(k[L].r,k[L].g,k[L].b,k[L].a);z.b._ComputeSides(p,O,C,U,F,Q,J);const x=new z.b;if(x.indices=C,x.xa=O,x.ya=U,x.Aa=F,k){const V=p===z.b.DOUBLESIDE?u.concat(u):u;x.za=V}return x}function R(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;p.sideOrientation=d.e._GetDefaultSideOrientation(p.sideOrientation);const z=p.shape,S=p.holes||[],Q=p.depth||0,J=p.smoothingThreshold||2,i=[];let l=[];for(let d=0;d<z.length;d++)i[d]=new N.k(z[d].x,z[d].z);i[0].equalsWithEpsilon(i[i.length-1],1e-8)&&i.pop();const j=new s(V,i,W||T.d.LastCreatedScene,E);for(let d=0;d<S.length;d++){l=[];for(let V=0;V<S[d].length;V++)l.push(new N.k(S[d][V].x,S[d][V].z));j.addHole(l)}const k=j.build(!1,Q,J);k._originalBuilderSideOrientation=p.sideOrientation;return G(k,p.sideOrientation,p.faceUV,p.faceColors,p.frontUVs,p.backUVs,p.wrap).Ca(k,p.updatable),k}function X(V,p){return R(V,p,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function r(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=p.path,E=p.shape,z=p.scale||1,S=p.rotation||0,Q=0===p.cap?0:p.cap||d.e.NO_CAP,J=p.updatable,i=d.e._GetDefaultSideOrientation(p.sideOrientation),l=p.instance||null,j=p.invertUV||!1,k=p.closeShape||!1;return Y(V,E,N,z,S,null,null,p.closePath||!1,k,Q,!1,W,!!J,i,l,j,p.frontUVs||null,p.backUVs||null,p.firstNormal||null,!!p.adjustFrame)}function B(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=p.path,E=p.shape,z=p.scaleFunction||(()=>1),S=p.rotationFunction||(()=>0),Q=p.closePath||p.ribbonCloseArray||!1,J=p.closeShape||p.ribbonClosePath||!1,i=0===p.cap?0:p.cap||d.e.NO_CAP,l=p.updatable,j=p.firstNormal||null,k=p.adjustFrame||!1;return Y(V,E,N,null,null,z,S,Q,J,i,!0,W,!!l,d.e._GetDefaultSideOrientation(p.sideOrientation),p.instance||null,p.invertUV||!1,p.frontUVs||null,p.backUVs||null,j,k)}function Y(V,p,W,E,z,S,Q,i,l,j,k,u,f,O,U,F,C,A,v,t){const e=(V,p,W,E,z,S,Q,J,i,l,j)=>{const k=W.getTangents(),u=W.getNormals(),f=W.getBinormals(),O=W.getDistances();if(j)for(let d=0;d<k.length;d++)if(0==k[d].x&&0==k[d].y&&0==k[d].z&&k[d].p(k[d-1]),0==u[d].x&&0==u[d].y&&0==u[d].z&&u[d].p(u[d-1]),0==f[d].x&&0==f[d].y&&0==f[d].z&&f[d].p(f[d-1]),d>0){let V=k[d-1];N.n.Dot(V,k[d])<0&&k[d].scaleInPlace(-1),V=u[d-1],N.n.Dot(V,u[d])<0&&u[d].scaleInPlace(-1),V=f[d-1],N.n.Dot(V,f[d])<0&&f[d].scaleInPlace(-1)}let U=0;const F=l&&J?J:()=>null!==S?S:0,C=l&&Q?Q:()=>null!==z?z:1;let A=i===d.e.NO_CAP||i===d.e.CAP_END?0:2;const v=N.i.Matrix[0];for(let d=0;d<p.length;d++){const W=[],z=F(d,O[d]),S=C(d,O[d]);N.e.RotationAxisToRef(k[d],U,v);for(let E=0;E<V.length;E++){const z=k[d].scale(V[E].z).add(u[d].scale(V[E].x)).add(f[d].scale(V[E].y)),Q=N.n.Zero();N.n.TransformCoordinatesToRef(z,v,Q),Q.scaleInPlace(S).addInPlace(p[d]),W[E]=Q}E[A]=W,U+=z,A++}const t=V=>{const p=Array(),W=N.n.Zero();let d;for(d=0;d<V.length;d++)W.addInPlace(V[d]);for(W.scaleInPlace(1/V.length),d=0;d<V.length;d++)p.push(W);return p};switch(i){case d.e.NO_CAP:break;case d.e.CAP_START:E[0]=t(E[2]),E[1]=E[2];break;case d.e.CAP_END:E[A]=E[A-1],E[A+1]=t(E[A-1]);break;case d.e.CAP_ALL:E[0]=t(E[2]),E[1]=E[2],E[A]=E[A-1],E[A+1]=t(E[A-1])}return E};let Z,o;if(U){const V=U._creationDataStorage;return Z=v?V.path3D.update(W,v):V.path3D.update(W),o=e(p,W,V.path3D,V.pathArray,E,z,S,Q,V.cap,k,t),U=J("",{pathArray:o,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:U},u||void 0)}Z=v?new L.i(W,v):new L.i(W);o=e(p,W,Z,new Array,E,z,S,Q,j=j<0||j>3?0:j,k,t);const K=J(V,{pathArray:o,closeArray:i,closePath:l,updatable:f,sideOrientation:O,invertUV:F,frontUVs:C||void 0,backUVs:A||void 0},u);return K._creationDataStorage.pathArray=o,K._creationDataStorage.path3D=Z,K._creationDataStorage.cap=j,K}z.b.CreatePolygon=G,d.e.CreatePolygon=function(V,p,W,N,d,E){return R(V,{shape:p,holes:N,updatable:d,sideOrientation:E},W,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},d.e.ExtrudePolygon=function(V,p,W,N,d,E,z){return X(V,{shape:p,holes:d,depth:W,updatable:E,sideOrientation:z},N,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function I(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=p.arc?p.arc<=0||p.arc>1?1:p.arc:1,z=void 0===p.closed||p.closed,S=p.shape,Q=p.radius||1,i=p.tessellation||64,l=p.clip||0,j=p.updatable,k=d.e._GetDefaultSideOrientation(p.sideOrientation),u=p.cap||d.e.NO_CAP,f=2*Math.PI,O=[],U=p.invertUV||!1;let F=0,C=0;const A=f/i*E;let v,t;for(F=0;F<=i-l;F++){for(t=[],u!=d.e.CAP_START&&u!=d.e.CAP_ALL||(t.push(new N.n(0,S[0].y,0)),t.push(new N.n(Math.cos(F*A)*S[0].x*Q,S[0].y,Math.sin(F*A)*S[0].x*Q))),C=0;C<S.length;C++)v=new N.n(Math.cos(F*A)*S[C].x*Q,S[C].y,Math.sin(F*A)*S[C].x*Q),t.push(v);u!=d.e.CAP_END&&u!=d.e.CAP_ALL||(t.push(new N.n(Math.cos(F*A)*S[S.length-1].x*Q,S[S.length-1].y,Math.sin(F*A)*S[S.length-1].x*Q)),t.push(new N.n(0,S[S.length-1].y,0))),O.push(t)}return J(V,{pathArray:O,closeArray:z,sideOrientation:k,updatable:j,invertUV:U,frontUVs:p.frontUVs,backUVs:p.backUVs},W)}d.e.ExtrudeShape=function(V,p,W,N,E,z){let S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7?arguments[7]:void 0,J=arguments.length>8?arguments[8]:void 0,i=arguments.length>9?arguments[9]:void 0;return r(V,{shape:p,path:W,scale:N,rotation:E,cap:0===z?0:z||d.e.NO_CAP,sideOrientation:J,instance:i,updatable:Q},S)},d.e.ExtrudeShapeCustom=(V,p,W,N,E,z,S,Q,J,i,l,j)=>B(V,{shape:p,path:W,scaleFunction:N,rotationFunction:E,ribbonCloseArray:z,ribbonClosePath:S,cap:0===Q?0:Q||d.e.NO_CAP,sideOrientation:l,instance:j,updatable:i},J);d.e.CreateLathe=(V,p,W,N,d,E,z)=>I(V,{shape:p,radius:W,tessellation:N,sideOrientation:z,updatable:E},d);var c=W(11648),q=W(11600);function g(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=p.path;let z=p.instance,S=1;void 0!==p.radius?S=p.radius:z&&(S=z._creationDataStorage.radius);const Q=p.tessellation||64,i=p.radiusFunction||null;let l=p.cap||d.e.NO_CAP;const j=p.invertUV||!1,k=p.updatable,u=d.e._GetDefaultSideOrientation(p.sideOrientation);p.arc=p.arc&&(p.arc<=0||p.arc>1)?1:p.arc||1;const f=(V,p,W,E,z,S,Q,J)=>{const i=p.getTangents(),l=p.getNormals(),j=p.getDistances(),k=2*Math.PI/z*J,u=S||(()=>E);let f,O,U,F;const C=N.i.Matrix[0];let A=Q===d.e.NO_CAP||Q===d.e.CAP_END?0:2;for(let d=0;d<V.length;d++){O=u(d,j[d]),f=Array(),U=l[d];for(let p=0;p<z;p++)N.e.RotationAxisToRef(i[d],k*p,C),F=f[p]?f[p]:N.n.Zero(),N.n.TransformCoordinatesToRef(U,C,F),F.scaleInPlace(O).addInPlace(V[d]),f[p]=F;W[A]=f,A++}const v=(p,W)=>{const N=Array();for(let d=0;d<p;d++)N.push(V[W]);return N};switch(Q){case d.e.NO_CAP:break;case d.e.CAP_START:W[0]=v(z,0),W[1]=W[2].slice(0);break;case d.e.CAP_END:W[A]=W[A-1].slice(0),W[A+1]=v(z,V.length-1);break;case d.e.CAP_ALL:W[0]=v(z,0),W[1]=W[2].slice(0),W[A]=W[A-1].slice(0),W[A+1]=v(z,V.length-1)}return W};let O,U;if(z){const V=z._creationDataStorage,W=p.arc||V.arc;return O=V.path3D.update(E),U=f(E,O,V.pathArray,S,V.tessellation,i,V.cap,W),z=J("",{pathArray:U,instance:z}),V.path3D=O,V.pathArray=U,V.arc=W,V.radius=S,z}O=new L.i(E);l=l<0||l>3?0:l,U=f(E,O,new Array,S,Q,i,l,p.arc);const F=J(V,{pathArray:U,closePath:!0,closeArray:!1,updatable:k,sideOrientation:u,invertUV:j,frontUVs:p.frontUVs,backUVs:p.backUVs},W);return F._creationDataStorage.pathArray=U,F._creationDataStorage.path3D=O,F._creationDataStorage.tessellation=Q,F._creationDataStorage.cap=l,F._creationDataStorage.arc=p.arc,F._creationDataStorage.radius=S,F}function D(V){const p=[];p[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},p[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},p[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},p[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},p[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},p[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},p[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},p[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},p[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},p[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},p[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},p[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},p[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},p[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},p[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const W=V.type&&(V.type<0||V.type>=p.length)?0:V.type||0,d=V.size,E=V.sizeX||d||1,Q=V.sizeY||d||1,J=V.sizeZ||d||1,i=V.custom||p[W],l=i.face.length,k=V.faceUV||new Array(l),u=V.faceColors,f=void 0===V.flat||V.flat,O=0===V.sideOrientation?0:V.sideOrientation||z.b.DEFAULTSIDE,U=[],F=[],C=[],A=[],v=[];let t=0,e=0;const Z=[];let o,K,h,L,x,T,P=0,b=0;if(f)for(b=0;b<l;b++)u&&void 0===u[b]&&(u[b]=new j.e(1,1,1,1)),k&&void 0===k[b]&&(k[b]=new N.q(0,0,1,1));if(f)for(b=0;b<l;b++){const V=i.face[b].length;for(h=2*Math.PI/V,L=.5*Math.tan(h/2),x=.5,P=0;P<V;P++)U.push(i.vertex[i.face[b][P]][0]*E,i.vertex[i.face[b][P]][1]*Q,i.vertex[i.face[b][P]][2]*J),Z.push(t),t++,o=k[b].x+(k[b].z-k[b].x)*(.5+L),K=k[b].y+(k[b].w-k[b].y)*(x-.5),A.push(o,S.d?1-K:K),T=L*Math.cos(h)-x*Math.sin(h),x=L*Math.sin(h)+x*Math.cos(h),L=T,u&&v.push(u[b].r,u[b].g,u[b].b,u[b].a);for(P=0;P<V-2;P++)F.push(Z[0+e],Z[P+2+e],Z[P+1+e]);e+=V}else{for(P=0;P<i.vertex.length;P++)U.push(i.vertex[P][0]*E,i.vertex[P][1]*Q,i.vertex[P][2]*J),A.push(0,S.d?1:0);for(b=0;b<l;b++)for(P=0;P<i.face[b].length-2;P++)F.push(i.face[b][0],i.face[b][P+2],i.face[b][P+1])}z.b.ComputeNormals(U,F,C),z.b._ComputeSides(O,U,F,C,A,V.frontUVs,V.backUVs);const s=new z.b;return s.xa=U,s.indices=F,s.ya=C,s.Aa=A,u&&f&&(s.za=v),s}function H(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new d.e(V,W);p.sideOrientation=d.e._GetDefaultSideOrientation(p.sideOrientation),N._originalBuilderSideOrientation=p.sideOrientation;return D(p).Ca(N,p.updatable),N}d.e.CreateTube=(V,p,W,N,d,E,z,S,Q,J)=>g(V,{path:p,radius:W,tessellation:N,radiusFunction:d,arc:1,cap:E,updatable:S,sideOrientation:Q,instance:J},z);function m(V){const p=V.sideOrientation||z.b.DEFAULTSIDE,W=V.radius||1,d=void 0===V.flat||V.flat,E=0|(V.subdivisions||4),Q=V.radiusX||W,J=V.radiusY||W,i=V.radiusZ||W,l=(1+Math.sqrt(5))/2,j=[-1,l,-0,1,l,0,-1,-l,0,1,-l,0,0,-1,-l,0,1,-l,0,-1,l,0,1,l,l,0,1,l,0,-1,-l,0,1,-l,0,-1],k=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],u=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],f=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],O=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],U=[],F=[],C=[],A=[];let v=0;const t=new Array(3),e=new Array(3);let Z;for(Z=0;Z<3;Z++)t[Z]=N.n.Zero(),e[Z]=N.k.Zero();for(let z=0;z<20;z++){for(Z=0;Z<3;Z++){const V=k[3*z+Z];t[Z].ge(j[3*u[V]],j[3*u[V]+1],j[3*u[V]+2]),t[Z].normalize(),e[Z].ge(.134765625*f[2*V]+.05859375+-.0390625*O[z],.2333984375*f[2*V+1]+.025390625+.01953125*O[z])}const V=(V,p,W,z)=>{const l=N.n.Lerp(t[0],t[2],p/E),j=N.n.Lerp(t[1],t[2],p/E),k=E===p?t[2]:N.n.Lerp(l,j,V/(E-p));let u;if(k.normalize(),d){const V=N.n.Lerp(t[0],t[2],z/E),p=N.n.Lerp(t[1],t[2],z/E);u=N.n.Lerp(V,p,W/(E-z))}else u=new N.n(k.x,k.y,k.z);u.x/=Q,u.y/=J,u.z/=i,u.normalize();const f=N.k.Lerp(e[0],e[2],p/E),O=N.k.Lerp(e[1],e[2],p/E),Z=E===p?e[2]:N.k.Lerp(f,O,V/(E-p));F.push(k.x*Q,k.y*J,k.z*i),C.push(u.x,u.y,u.z),A.push(Z.x,S.d?1-Z.y:Z.y),U.push(v),v++};for(let p=0;p<E;p++)for(let W=0;W+p<E;W++)V(W,p,W+1/3,p+1/3),V(W+1,p,W+1/3,p+1/3),V(W,p+1,W+1/3,p+1/3),W+p+1<E&&(V(W+1,p,W+2/3,p+2/3),V(W+1,p+1,W+2/3,p+2/3),V(W,p+1,W+2/3,p+2/3))}z.b._ComputeSides(p,F,U,C,A,V.frontUVs,V.backUVs);const o=new z.b;return o.indices=U,o.xa=F,o.ya=C,o.Aa=A,o}function M(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new d.e(V,W);p.sideOrientation=d.e._GetDefaultSideOrientation(p.sideOrientation),N._originalBuilderSideOrientation=p.sideOrientation;return m(p).Ca(N,p.updatable),N}z.b.CreatePolyhedron=D,d.e.CreatePolyhedron=(V,p,W)=>H(V,p,W);z.b.CreateIcoSphere=m,d.e.CreateIcoSphere=(V,p,W)=>M(V,p,W);var a=W(11242);const y=new N.n(1,0,0),n=new N.n(-1,0,0),w=new N.n(0,1,0),VV=new N.n(0,-1,0),pV=new N.n(0,0,1),WV=new N.n(0,0,-1);class NV{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.n.Zero(),p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.n.Up(),W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N.k.Zero(),d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=V,this.k=p,this.uv=W,this.vertexIdx=d,this.vertexIdxForBones=E,this.localPositionOverride=z,this.localNormalOverride=S,this.matrixIndicesOverride=Q,this.matrixWeightsOverride=J}clone(){var V,p,W,N;return new NV(this.position.clone(),this.k.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(V=this.localPositionOverride)||void 0===V?void 0:V.slice(),null===(p=this.localNormalOverride)||void 0===p?void 0:p.slice(),null===(W=this.matrixIndicesOverride)||void 0===W?void 0:W.slice(),null===(N=this.matrixWeightsOverride)||void 0===N?void 0:N.slice())}}function dV(V,p,W){var Q,J,i,l;const j=!!p.skeleton,k=W.localMode||j,u=p.Zf(),f=j?p.$c(!0,!0):p.getVerticesData(E.f.PositionKind),O=j?p.getNormalsData(!0,!0):p.getVerticesData(E.f.NormalKind),U=k?j?p.getVerticesData(E.f.PositionKind):f:null,F=k?j?p.getVerticesData(E.f.NormalKind):O:null,C=p.getVerticesData(E.f.UVKind),A=j?p.getVerticesData(E.f.MatricesIndicesKind):null,v=j?p.getVerticesData(E.f.MatricesWeightsKind):null,t=j?p.getVerticesData(E.f.MatricesIndicesExtraKind):null,e=j?p.getVerticesData(E.f.MatricesWeightsExtraKind):null,Z=W.position||N.n.Zero();let o=W.k||N.n.Up();const K=W.size||N.n.One(),h=W.angle||0;if(!o){const V=new N.n(0,0,1),W=p.va().activeCamera,d=N.n.TransformCoordinates(V,W.getWorldMatrix());o=W.globalPosition.ed(d)}const L=-Math.atan2(o.z,o.x)-Math.PI/2,x=Math.sqrt(o.x*o.x+o.z*o.z),T=Math.atan2(o.y,x),P=new z.b;P.indices=[],P.xa=[],P.ya=[],P.Aa=[],P.matricesIndices=j?[]:null,P.matricesWeights=j?[]:null,P.matricesIndicesExtra=t?[]:null,P.matricesWeightsExtra=e?[]:null;let b=0;const s=(V,p)=>{const d=new NV;if(!u||!f||!O)return d;const E=u[V];if(d.vertexIdx=3*E,d.vertexIdxForBones=4*E,d.position=new N.n(f[3*E],f[3*E+1],f[3*E+2]),N.n.TransformCoordinatesToRef(d.position,p,d.position),d.k=new N.n(O[3*E],O[3*E+1],O[3*E+2]),N.n.TransformNormalToRef(d.k,p,d.k),W.captureUVS&&C){const V=C[2*E+1];d.uv=new N.k(C[2*E],S.d?1-V:V)}return d},G=[0,0,0,0],R=(V,p)=>{if(0===V.length)return V;const W=.5*Math.abs(N.n.Dot(K,p)),d=(V,p,W,N)=>{for(let d=0;d<N;++d)if(V[W+d]===p)return W+d;return-1},E=(V,E)=>{const z=N.n.GetClipFactor(V.position,E.position,p,W);let S=G,Q=G;if(A&&v){const p=V.matrixIndicesOverride?0:V.vertexIdxForBones,W=V.matrixIndicesOverride??A,N=V.matrixWeightsOverride??v,J=E.matrixIndicesOverride?0:E.vertexIdxForBones,i=E.matrixIndicesOverride??A,l=E.matrixWeightsOverride??v;S=[0,0,0,0],Q=[0,0,0,0];let j=0;for(let V=0;V<4;++V)if(N[p+V]>0){const E=d(i,W[p+V],J,4);S[j]=W[p+V],Q[j]=(0,a.l)(N[p+V],E>=0?l[E]:0,z),j++}for(let V=0;V<4&&j<4;++V){const N=i[J+V];-1===d(W,N,p,4)&&(S[j]=N,Q[j]=(0,a.l)(0,l[J+V],z),j++)}const k=Q[0]+Q[1]+Q[2]+Q[3];Q[0]/=k,Q[1]/=k,Q[2]/=k,Q[3]/=k}const J=V.localPositionOverride?V.localPositionOverride[0]:(null===U||void 0===U?void 0:U[V.vertexIdx])??0,i=V.localPositionOverride?V.localPositionOverride[1]:(null===U||void 0===U?void 0:U[V.vertexIdx+1])??0,l=V.localPositionOverride?V.localPositionOverride[2]:(null===U||void 0===U?void 0:U[V.vertexIdx+2])??0,j=E.localPositionOverride?E.localPositionOverride[0]:(null===U||void 0===U?void 0:U[E.vertexIdx])??0,k=E.localPositionOverride?E.localPositionOverride[1]:(null===U||void 0===U?void 0:U[E.vertexIdx+1])??0,u=E.localPositionOverride?E.localPositionOverride[2]:(null===U||void 0===U?void 0:U[E.vertexIdx+2])??0,f=V.localNormalOverride?V.localNormalOverride[0]:(null===F||void 0===F?void 0:F[V.vertexIdx])??0,O=V.localNormalOverride?V.localNormalOverride[1]:(null===F||void 0===F?void 0:F[V.vertexIdx+1])??0,C=V.localNormalOverride?V.localNormalOverride[2]:(null===F||void 0===F?void 0:F[V.vertexIdx+2])??0,t=f+((E.localNormalOverride?E.localNormalOverride[0]:(null===F||void 0===F?void 0:F[E.vertexIdx])??0)-f)*z,e=O+((E.localNormalOverride?E.localNormalOverride[1]:(null===F||void 0===F?void 0:F[E.vertexIdx+1])??0)-O)*z,Z=C+((E.localNormalOverride?E.localNormalOverride[2]:(null===F||void 0===F?void 0:F[E.vertexIdx+2])??0)-C)*z,o=Math.sqrt(t*t+e*e+Z*Z);return new NV(N.n.Lerp(V.position,E.position,z),N.n.Lerp(V.k,E.k,z).normalize(),N.k.Lerp(V.uv,E.uv,z),-1,-1,U?[J+(j-J)*z,i+(k-i)*z,l+(u-l)*z]:null,F?[t/o,e/o,Z/o]:null,S,Q)};let z=null;V.length>3&&(z=[]);for(let S=0;S<V.length;S+=3){let d=0,Q=null,J=null,i=null,l=null;const j=N.n.Dot(V[S].position,p)-W>0,k=N.n.Dot(V[S+1].position,p)-W>0,u=N.n.Dot(V[S+2].position,p)-W>0;switch(d=(j?1:0)+(k?1:0)+(u?1:0),d){case 0:V.length>3?(z.push(V[S]),z.push(V[S+1]),z.push(V[S+2])):z=V;break;case 1:if(z=z??new Array,j&&(Q=V[S+1],J=V[S+2],i=E(V[S],Q),l=E(V[S],J)),k){Q=V[S],J=V[S+2],i=E(V[S+1],Q),l=E(V[S+1],J),z.push(i),z.push(J.clone()),z.push(Q.clone()),z.push(J.clone()),z.push(i.clone()),z.push(l);break}u&&(Q=V[S],J=V[S+1],i=E(V[S+2],Q),l=E(V[S+2],J)),Q&&J&&i&&l&&(z.push(Q.clone()),z.push(J.clone()),z.push(i),z.push(l),z.push(i.clone()),z.push(J.clone()));break;case 2:z=z??new Array,j||(Q=V[S].clone(),J=E(Q,V[S+1]),i=E(Q,V[S+2]),z.push(Q),z.push(J),z.push(i)),k||(Q=V[S+1].clone(),J=E(Q,V[S+2]),i=E(Q,V[S]),z.push(Q),z.push(J),z.push(i)),u||(Q=V[S+2].clone(),J=E(Q,V[S]),i=E(Q,V[S+1]),z.push(Q),z.push(J),z.push(i))}}return z},X=p instanceof d.e?p:null,r=null===X||void 0===X?void 0:X._thinInstanceDataStorage.matrixData,B=(null===X||void 0===X?void 0:X.Ub)||1,Y=N.i.Matrix[0];Y.p(N.e.IdentityReadOnly);for(let d=0;d<B;++d){if(null!==X&&void 0!==X&&X.hasThinInstances&&r){const V=16*d;Y.setRowFromFloats(0,r[V+0],r[V+1],r[V+2],r[V+3]),Y.setRowFromFloats(1,r[V+4],r[V+5],r[V+6],r[V+7]),Y.setRowFromFloats(2,r[V+8],r[V+9],r[V+10],r[V+11]),Y.setRowFromFloats(3,r[V+12],r[V+13],r[V+14],r[V+15])}const V=N.e.RotationYawPitchRoll(L,T,h).multiply(N.e.Translation(Z.x,Z.y,Z.z)),E=N.e.Invert(V),z=p.getWorldMatrix(),Q=Y.multiply(z).multiply(E),J=new Array(3);for(let p=0;p<u.length;p+=3){let V=J;if(V[0]=s(p,Q),V[1]=s(p+1,Q),V[2]=s(p+2,Q),!(W.cullBackFaces&&-V[0].k.z<=0&&-V[1].k.z<=0&&-V[2].k.z<=0)&&(V=R(V,y),V&&(V=R(V,n),V&&(V=R(V,w),V&&(V=R(V,VV),V&&(V=R(V,pV),V&&(V=R(V,WV),V)))))))for(let p=0;p<V.length;p++){const N=V[p];if(P.indices.push(b),k?(N.localPositionOverride?(P.xa[3*b]=N.localPositionOverride[0],P.xa[3*b+1]=N.localPositionOverride[1],P.xa[3*b+2]=N.localPositionOverride[2]):U&&(P.xa[3*b]=U[N.vertexIdx],P.xa[3*b+1]=U[N.vertexIdx+1],P.xa[3*b+2]=U[N.vertexIdx+2]),N.localNormalOverride?(P.ya[3*b]=N.localNormalOverride[0],P.ya[3*b+1]=N.localNormalOverride[1],P.ya[3*b+2]=N.localNormalOverride[2]):F&&(P.ya[3*b]=F[N.vertexIdx],P.ya[3*b+1]=F[N.vertexIdx+1],P.ya[3*b+2]=F[N.vertexIdx+2])):(N.position.toArray(P.xa,3*b),N.k.toArray(P.ya,3*b)),P.matricesIndices&&P.matricesWeights&&(N.matrixIndicesOverride?(P.matricesIndices[4*b]=N.matrixIndicesOverride[0],P.matricesIndices[4*b+1]=N.matrixIndicesOverride[1],P.matricesIndices[4*b+2]=N.matrixIndicesOverride[2],P.matricesIndices[4*b+3]=N.matrixIndicesOverride[3]):(A&&(P.matricesIndices[4*b]=A[N.vertexIdxForBones],P.matricesIndices[4*b+1]=A[N.vertexIdxForBones+1],P.matricesIndices[4*b+2]=A[N.vertexIdxForBones+2],P.matricesIndices[4*b+3]=A[N.vertexIdxForBones+3]),t&&P.matricesIndicesExtra&&(P.matricesIndicesExtra[4*b]=t[N.vertexIdxForBones],P.matricesIndicesExtra[4*b+1]=t[N.vertexIdxForBones+1],P.matricesIndicesExtra[4*b+2]=t[N.vertexIdxForBones+2],P.matricesIndicesExtra[4*b+3]=t[N.vertexIdxForBones+3])),N.matrixWeightsOverride?(P.matricesWeights[4*b]=N.matrixWeightsOverride[0],P.matricesWeights[4*b+1]=N.matrixWeightsOverride[1],P.matricesWeights[4*b+2]=N.matrixWeightsOverride[2],P.matricesWeights[4*b+3]=N.matrixWeightsOverride[3]):(v&&(P.matricesWeights[4*b]=v[N.vertexIdxForBones],P.matricesWeights[4*b+1]=v[N.vertexIdxForBones+1],P.matricesWeights[4*b+2]=v[N.vertexIdxForBones+2],P.matricesWeights[4*b+3]=v[N.vertexIdxForBones+3]),e&&P.matricesWeightsExtra&&(P.matricesWeightsExtra[4*b]=e[N.vertexIdxForBones],P.matricesWeightsExtra[4*b+1]=e[N.vertexIdxForBones+1],P.matricesWeightsExtra[4*b+2]=e[N.vertexIdxForBones+2],P.matricesWeightsExtra[4*b+3]=e[N.vertexIdxForBones+3]))),W.captureUVS)N.uv.toArray(P.Aa,2*b);else{P.Aa.push(.5+N.position.x/K.x);const V=.5+N.position.y/K.y;P.Aa.push(S.d?1-V:V)}b++}}}0===P.indices.length&&(P.indices=null),0===P.xa.length&&(P.xa=null),0===P.ya.length&&(P.ya=null),0===P.Aa.length&&(P.Aa=null),0===(null===(Q=P.matricesIndices)||void 0===Q?void 0:Q.length)&&(P.matricesIndices=null),0===(null===(J=P.matricesWeights)||void 0===J?void 0:J.length)&&(P.matricesWeights=null),0===(null===(i=P.matricesIndicesExtra)||void 0===i?void 0:i.length)&&(P.matricesIndicesExtra=null),0===(null===(l=P.matricesWeightsExtra)||void 0===l?void 0:l.length)&&(P.matricesWeightsExtra=null);const I=new d.e(V,p.va());return P.Ca(I),k?(I.skeleton=p.skeleton,I.parent=p):(I.position=Z.clone(),I.rotation=new N.n(T,L,h)),I.Dj(!0),I.refreshBoundingInfo(!0,!0),I}function EV(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const p=0|Math.max(V.subdivisions?V.subdivisions:2,1),W=0|Math.max(V.tessellation?V.tessellation:16,3),d=Math.max(V.height?V.height:1,0),E=Math.max(V.radius?V.radius:.25,0),Q=0|Math.max(V.capSubdivisions?V.capSubdivisions:6,1),J=W,i=p,l=Math.max(V.radiusTop?V.radiusTop:E,0),j=Math.max(V.radiusBottom?V.radiusBottom:E,0),k=d-(l+j),u=2*Math.PI,f=Math.max(V.topCapSubdivisions?V.topCapSubdivisions:Q,1),O=Math.max(V.bottomCapSubdivisions?V.bottomCapSubdivisions:Q,1),U=Math.acos((j-l)/d);let F=[];const C=[],A=[],v=[];let t=0;const e=[],Z=.5*k,o=.5*Math.PI;let K,h;const L=N.n.Zero(),x=N.n.Zero(),T=Math.cos(U),P=Math.sin(U),b=new N.k(l*P,Z+l*T).ed(new N.k(j*P,j*T-Z)).length(),s=l*U+b+j*(o-U);let G=0;for(h=0;h<=f;h++){const V=[],p=o-U*(h/f);G+=l*U/f;const W=Math.cos(p),N=Math.sin(p),d=W*l;for(K=0;K<=J;K++){const p=K/J,E=p*u+0,z=Math.sin(E),Q=Math.cos(E);x.x=d*z,x.y=Z+N*l,x.z=d*Q,C.push(x.x,x.y,x.z),L.set(W*z,N,W*Q),A.push(L.x,L.y,L.z),v.push(p,S.d?G/s:1-G/s),V.push(t),t++}e.push(V)}const R=d-l-j+T*l-T*j,X=P*(j-l)/R;for(h=1;h<=i;h++){const V=[];G+=b/i;const p=P*(h*(j-l)/i+l);for(K=0;K<=J;K++){const W=K/J,N=W*u+0,d=Math.sin(N),E=Math.cos(N);x.x=p*d,x.y=Z+T*l-h*R/i,x.z=p*E,C.push(x.x,x.y,x.z),L.set(d,X,E).normalize(),A.push(L.x,L.y,L.z),v.push(W,S.d?G/s:1-G/s),V.push(t),t++}e.push(V)}for(h=1;h<=O;h++){const V=[],p=o-U-(Math.PI-U)*(h/O);G+=j*U/O;const W=Math.cos(p),N=Math.sin(p),d=W*j;for(K=0;K<=J;K++){const p=K/J,E=p*u+0,z=Math.sin(E),Q=Math.cos(E);x.x=d*z,x.y=N*j-Z,x.z=d*Q,C.push(x.x,x.y,x.z),L.set(W*z,N,W*Q),A.push(L.x,L.y,L.z),v.push(p,S.d?G/s:1-G/s),V.push(t),t++}e.push(V)}for(K=0;K<J;K++)for(h=0;h<f+i+O;h++){const V=e[h][K],p=e[h+1][K],W=e[h+1][K+1],N=e[h][K+1];F.push(V),F.push(p),F.push(N),F.push(p),F.push(W),F.push(N)}if(F=F.reverse(),V.orientation&&!V.orientation.equals(N.n.Up())){const p=new N.e;V.orientation.clone().scale(.5*Math.PI).cross(N.n.Up()).toQuaternion().toRotationMatrix(p);const W=N.n.Zero();for(let V=0;V<C.length;V+=3)W.set(C[V],C[V+1],C[V+2]),N.n.TransformCoordinatesToRef(W.clone(),p,W),C[V]=W.x,C[V+1]=W.y,C[V+2]=W.z}const r=new z.b;return r.xa=C,r.ya=A,r.Aa=v,r.indices=F,r}function zV(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:N.n.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new d.e(V,W);return EV(p).Ca(E,p.updatable),E}d.e.CreateDecal=(V,p,W,N,d,E)=>dV(V,p,{position:W,k:N,size:d,angle:E});d.e.CreateCapsule=(V,p,W)=>zV(V,p,W),z.b.CreateCapsule=EV;class SV{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=V,this.y=p,V!==Math.floor(V)&&(V=Math.floor(V),h.e.Warn("x is not an integer, floor(x) used")),p!==Math.floor(p)&&(p=Math.floor(p),h.e.Warn("y is not an integer, floor(y) used"))}clone(){return new SV(this.x,this.y)}rotate60About(V){const p=this.x;return this.x=V.x+V.y-this.y,this.y=p+this.y-V.x,this}rotateNeg60About(V){const p=this.x;return this.x=p+this.y-V.y,this.y=V.x+V.y-p,this}rotate120(V,p){V!==Math.floor(V)&&(V=Math.floor(V),h.e.Warn("m not an integer only floor(m) used")),p!==Math.floor(p)&&(p=Math.floor(p),h.e.Warn("n not an integer only floor(n) used"));const W=this.x;return this.x=V-W-this.y,this.y=p+W,this}rotateNeg120(V,p){V!==Math.floor(V)&&(V=Math.floor(V),h.e.Warn("m is not an integer, floor(m) used")),p!==Math.floor(p)&&(p=Math.floor(p),h.e.Warn("n is not an integer,   floor(n) used"));const W=this.x;return this.x=this.y-p,this.y=V+p-W-this.y,this}toCartesianOrigin(V,p){const W=N.n.Zero();return W.x=V.x+2*this.x*p+this.y*p,W.y=V.y+Math.sqrt(3)*this.y*p,W}static Zero(){return new SV(0,0)}}class QV{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new JV("icosahedron","Regular",[[0,x.g,-1],[-x.g,1,0],[-1,0,-x.g],[1,0,-x.g],[x.g,1,0],[0,x.g,1],[-1,0,x.g],[-x.g,-1,0],[0,-x.g,-1],[x.g,-1,0],[1,0,x.g],[0,-x.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let V=12;const p={},W=this.m,N=this.n;let d,E,z,S,Q,J=W,i=1,l=0;0!==N&&(J=(0,a.i)(W,N)),i=W/J,l=N/J;const j=SV.Zero(),k=new SV(W,N),u=new SV(-N,W+N),f=SV.Zero(),O=SV.Zero(),U=SV.Zero();let F,C,A,v,t=[];const e=[],Z=this.vertByDist,o=(W,N,d,E)=>{F=W+"|"+d,C=N+"|"+E,F in p||C in p?F in p&&!(C in p)?p[C]=p[F]:C in p&&!(F in p)&&(p[F]=p[C]):(p[F]=V,p[C]=V,V++),Z[d][0]>2?e[p[F]]=[-Z[d][0],Z[d][1],p[F]]:e[p[F]]=[t[Z[d][0]],Z[d][1],p[F]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let K=0;K<20;K++){if(t=this.IDATA.face[K],z=t[2],S=t[1],Q=t[0],A=j.x+"|"+j.y,F=K+"|"+A,F in p||(p[F]=z,e[z]=[t[Z[A][0]],Z[A][1]]),A=k.x+"|"+k.y,F=K+"|"+A,F in p||(p[F]=S,e[S]=[t[Z[A][0]],Z[A][1]]),A=u.x+"|"+u.y,F=K+"|"+A,F in p||(p[F]=Q,e[Q]=[t[Z[A][0]],Z[A][1]]),d=this.IDATA.edgematch[K][0],E=this.IDATA.edgematch[K][1],"B"===E)for(let V=1;V<J;V++)O.x=W-V*(i+l),O.y=N+V*i,U.x=-V*l,U.y=V*(i+l),A=O.x+"|"+O.y,v=U.x+"|"+U.y,o(K,d,A,v);if("O"===E)for(let V=1;V<J;V++)U.x=-V*l,U.y=V*(i+l),f.x=V*i,f.y=V*l,A=U.x+"|"+U.y,v=f.x+"|"+f.y,o(K,d,A,v);if(d=this.IDATA.edgematch[K][2],E=this.IDATA.edgematch[K][3],E&&"A"===E)for(let V=1;V<J;V++)f.x=V*i,f.y=V*l,O.x=W-(J-V)*(i+l),O.y=N+(J-V)*i,A=f.x+"|"+f.y,v=O.x+"|"+O.y,o(K,d,A,v);for(let W=0;W<this.vertices.length;W++)A=this.vertices[W].x+"|"+this.vertices[W].y,F=K+"|"+A,F in p||(p[F]=V++,Z[A][0]>2?e[p[F]]=[-Z[A][0],Z[A][1],p[F]]:e[p[F]]=[t[Z[A][0]],Z[A][1],p[F]])}this.closestTo=e,this.vecToidx=p}calcCoeffs(){const V=this.m,p=this.n,W=Math.sqrt(3)/3,N=V*V+p*p+V*p;this.coau=(V+p)/N,this.cobu=-p/N,this.coav=-W*(V-p)/N,this.cobv=W*(2*V+p)/N}createInnerFacets(){const V=this.m,p=this.n;for(let W=0;W<p+V+1;W++)for(let V=this.min[W];V<this.max[W]+1;V++)V<this.max[W]&&V<this.max[W+1]+1&&this.innerFacets.push(["|"+V+"|"+W,"|"+V+"|"+(W+1),"|"+(V+1)+"|"+W]),W>0&&V<this.max[W-1]&&V+1<this.max[W]+1&&this.innerFacets.push(["|"+V+"|"+W,"|"+(V+1)+"|"+W,"|"+(V+1)+"|"+(W-1)])}edgeVecsABOB(){const V=this.m,p=this.n,W=new SV(-p,V+p);for(let N=1;N<V+p;N++){const V=new SV(this.min[N],N),p=new SV(this.min[N-1],N-1),d=new SV(this.min[N+1],N+1),E=V.clone(),z=p.clone(),S=d.clone();E.rotate60About(W),z.rotate60About(W),S.rotate60About(W);const Q=new SV(this.max[E.y],E.y),J=new SV(this.max[E.y-1],E.y-1),i=new SV(this.max[E.y-1]-1,E.y-1);E.x===Q.x&&E.y===Q.y||(E.x!==J.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,J,i]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,i,Q])):E.y===S.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([V,p,J]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([V,J,d])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([V,p,J]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,J,Q])))}}mapABOBtoOBOA(){const V=new SV(0,0);for(let p=0;p<this.isoVecsABOB.length;p++){const W=[];for(let N=0;N<3;N++)V.x=this.isoVecsABOB[p][N].x,V.y=this.isoVecsABOB[p][N].y,0===this.vertexTypes[p][N]&&V.rotateNeg120(this.m,this.n),W.push(V.clone());this.isoVecsOBOA.push(W)}}mapABOBtoBAOA(){const V=new SV(0,0);for(let p=0;p<this.isoVecsABOB.length;p++){const W=[];for(let N=0;N<3;N++)V.x=this.isoVecsABOB[p][N].x,V.y=this.isoVecsABOB[p][N].y,1===this.vertexTypes[p][N]&&V.rotate120(this.m,this.n),W.push(V.clone());this.isoVecsBAOA.push(W)}}MapToFace(V,p){const W=this.IDATA.face[V],d=W[2],E=W[1],z=W[0],S=N.n.Tg(this.IDATA.vertex[d]),Q=N.n.Tg(this.IDATA.vertex[E]),J=N.n.Tg(this.IDATA.vertex[z]),i=Q.ed(S),l=J.ed(S),j=i.scale(this.coau).add(l.scale(this.cobu)),k=i.scale(this.coav).add(l.scale(this.cobv)),u=[];let f,O=N.i.fb[0];for(let N=0;N<this.cartesian.length;N++)O=j.scale(this.cartesian[N].x).add(k.scale(this.cartesian[N].y)).add(S),u[N]=[O.x,O.y,O.z],f=V+"|"+this.vertices[N].x+"|"+this.vertices[N].y,p.vertex[this.vecToidx[f]]=[O.x,O.y,O.z]}build(V,p){const W=[],N=SV.Zero(),d=new SV(V,p),E=new SV(-p,V+p);W.push(N,d,E);for(let A=p;A<V+1;A++)for(let p=0;p<V+1-A;p++)W.push(new SV(p,A));if(p>0){const N=(0,a.i)(V,p),d=V/N,E=p/N;for(let S=1;S<N;S++)W.push(new SV(S*d,S*E)),W.push(new SV(-S*E,S*(d+E))),W.push(new SV(V-S*(d+E),p+S*d));const z=V/p;for(let S=1;S<p;S++)for(let N=0;N<S*z;N++)W.push(new SV(N,S)),W.push(new SV(N,S).rotate120(V,p)),W.push(new SV(N,S).rotateNeg120(V,p))}W.sort(((V,p)=>V.x-p.x)),W.sort(((V,p)=>V.y-p.y));const z=new Array(V+p+1),S=new Array(V+p+1);for(let A=0;A<z.length;A++)z[A]=1/0,S[A]=-1/0;let Q=0,J=0;const i=W.length;for(let A=0;A<i;A++)J=W[A].x,Q=W[A].y,z[Q]=Math.min(J,z[Q]),S[Q]=Math.max(J,S[Q]);const l=(W,N)=>{const d=W.clone();return"A"===N&&d.rotateNeg120(V,p),"B"===N&&d.rotate120(V,p),d.x<0?d.y:d.x+d.y},j=[],k=[],u=[],f=[],O={},U=[];let F=-1,C=-1;for(let A=0;A<i;A++)j[A]=W[A].toCartesianOrigin(new SV(0,0),.5),k[A]=l(W[A],"O"),u[A]=l(W[A],"A"),f[A]=l(W[A],"B"),k[A]===u[A]&&u[A]===f[A]?(F=3,C=k[A]):k[A]===u[A]?(F=4,C=k[A]):u[A]===f[A]?(F=5,C=u[A]):f[A]===k[A]&&(F=6,C=k[A]),k[A]<u[A]&&k[A]<f[A]&&(F=2,C=k[A]),u[A]<k[A]&&u[A]<f[A]&&(F=1,C=u[A]),f[A]<u[A]&&f[A]<k[A]&&(F=0,C=f[A]),U.push([F,C,W[A].x,W[A].y]);U.sort(((V,p)=>V[2]-p[2])),U.sort(((V,p)=>V[3]-p[3])),U.sort(((V,p)=>V[1]-p[1])),U.sort(((V,p)=>V[0]-p[0]));for(let A=0;A<U.length;A++)O[U[A][2]+"|"+U[A][3]]=[U[A][0],U[A][1],A];return this.m=V,this.n=p,this.vertices=W,this.vertByDist=O,this.cartesian=j,this.min=z,this.max=S,this}}class JV{constructor(V,p,W,N){this.name=V,this.category=p,this.vertex=W,this.face=N}}class iV extends JV{innerToData(V,p){for(let W=0;W<p.innerFacets.length;W++)this.face.push(p.innerFacets[W].map((W=>p.vecToidx[V+W])))}mapABOBtoDATA(V,p){const W=p.IDATA.edgematch[V][0];for(let N=0;N<p.isoVecsABOB.length;N++){const d=[];for(let E=0;E<3;E++)0===p.vertexTypes[N][E]?d.push(V+"|"+p.isoVecsABOB[N][E].x+"|"+p.isoVecsABOB[N][E].y):d.push(W+"|"+p.isoVecsABOB[N][E].x+"|"+p.isoVecsABOB[N][E].y);this.face.push([p.vecToidx[d[0]],p.vecToidx[d[1]],p.vecToidx[d[2]]])}}mapOBOAtoDATA(V,p){const W=p.IDATA.edgematch[V][0];for(let N=0;N<p.isoVecsOBOA.length;N++){const d=[];for(let E=0;E<3;E++)1===p.vertexTypes[N][E]?d.push(V+"|"+p.isoVecsOBOA[N][E].x+"|"+p.isoVecsOBOA[N][E].y):d.push(W+"|"+p.isoVecsOBOA[N][E].x+"|"+p.isoVecsOBOA[N][E].y);this.face.push([p.vecToidx[d[0]],p.vecToidx[d[1]],p.vecToidx[d[2]]])}}mapBAOAtoDATA(V,p){const W=p.IDATA.edgematch[V][2];for(let N=0;N<p.isoVecsBAOA.length;N++){const d=[];for(let E=0;E<3;E++)1===p.vertexTypes[N][E]?d.push(V+"|"+p.isoVecsBAOA[N][E].x+"|"+p.isoVecsBAOA[N][E].y):d.push(W+"|"+p.isoVecsBAOA[N][E].x+"|"+p.isoVecsBAOA[N][E].y);this.face.push([p.vecToidx[d[0]],p.vecToidx[d[1]],p.vecToidx[d[2]]])}}orderData(V){const p=[];for(let E=0;E<13;E++)p[E]=[];const W=V.closestTo;for(let E=0;E<W.length;E++)W[E][0]>-1?W[E][1]>0&&p[W[E][0]].push([E,W[E][1]]):p[12].push([E,W[E][0]]);const N=[];for(let E=0;E<12;E++)N[E]=E;let d=12;for(let E=0;E<12;E++){p[E].sort(((V,p)=>V[1]-p[1]));for(let V=0;V<p[E].length;V++)N[p[E][V][0]]=d++}for(let E=0;E<p[12].length;E++)N[p[12][E][0]]=d++;for(let E=0;E<this.vertex.length;E++)this.vertex[E].push(N[E]);this.vertex.sort(((V,p)=>V[3]-p[3]));for(let E=0;E<this.vertex.length;E++)this.vertex[E].pop();for(let E=0;E<this.face.length;E++)for(let V=0;V<this.face[E].length;V++)this.face[E][V]=N[this.face[E][V]];this.sharedNodes=p[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(V,p){const W=[],N=[];let d=p.pop();N.push(d);let E=this.face[d].indexOf(V);E=(E+2)%3;let z=this.face[d][E];W.push(z);let S=0;for(;p.length>0;)d=p[S],this.face[d].indexOf(z)>-1?(E=(this.face[d].indexOf(z)+1)%3,z=this.face[d][E],W.push(z),N.push(d),p.splice(S,1),S=0):S++;return this.adjacentFaces.push(W),N}toGoldbergPolyhedronData(){const V=new JV("GeoDual","Goldberg",[],[]);V.name="GD dual";const p=this.vertex.length,W=new Array(p);for(let Q=0;Q<p;Q++)W[Q]=[];for(let Q=0;Q<this.face.length;Q++)for(let V=0;V<3;V++)W[this.face[Q][V]].push(Q);let N=0,d=0,E=0,z=[],S=[];this.adjacentFaces=[];for(let Q=0;Q<W.length;Q++)V.face[Q]=this.setOrder(Q,W[Q].concat([])),W[Q].forEach((p=>{N=0,d=0,E=0,z=this.face[p];for(let V=0;V<3;V++)S=this.vertex[z[V]],N+=S[0],d+=S[1],E+=S[2];V.vertex[p]=[N/3,d/3,E/3]}));return V}static BuildGeodesicData(V){const p=new iV("Geodesic-m-n","Geodesic",[[0,x.g,-1],[-x.g,1,0],[-1,0,-x.g],[1,0,-x.g],[x.g,1,0],[0,x.g,1],[-1,0,x.g],[-x.g,-1,0],[0,-x.g,-1],[x.g,-1,0],[1,0,x.g],[0,-x.g,1]],[]);V.setIndices(),V.calcCoeffs(),V.createInnerFacets(),V.edgeVecsABOB(),V.mapABOBtoOBOA(),V.mapABOBtoBAOA();for(let W=0;W<V.IDATA.face.length;W++)V.MapToFace(W,p),p.innerToData(W,V),"B"===V.IDATA.edgematch[W][1]&&p.mapABOBtoDATA(W,V),"O"===V.IDATA.edgematch[W][1]&&p.mapOBOAtoDATA(W,V),"A"===V.IDATA.edgematch[W][3]&&p.mapBAOAtoDATA(W,V);p.orderData(V);return p.vertex=p.vertex.map((function(V){const p=V[0],W=V[1],N=V[2],d=Math.sqrt(p*p+W*W+N*N);return V[0]*=1/d,V[1]*=1/d,V[2]*=1/d,V})),p}}d.e._GoldbergMeshParser=(V,p)=>lV.Parse(V,p);class lV extends d.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(V,p){return void 0===p?(V>this.goldbergData.nbUnsharedFaces-1&&(h.e.Warn("Maximum number of unshared faces used"),V=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+V):(V>11&&(h.e.Warn("Last pole used"),V=11),p>this.goldbergData.nbFacesAtPole-1&&(h.e.Warn("Maximum number of faces at a pole used"),p=this.goldbergData.nbFacesAtPole-1),12+V*this.goldbergData.nbFacesAtPole+p)}_changeGoldbergFaceColors(V){for(let W=0;W<V.length;W++){const p=V[W][0],N=V[W][1],d=V[W][2];for(let V=p;V<N+1;V++)this.goldbergData.faceColors[V]=d}const p=[];for(let W=0;W<12;W++)for(let V=0;V<5;V++)p.push(this.goldbergData.faceColors[W].r,this.goldbergData.faceColors[W].g,this.goldbergData.faceColors[W].b,this.goldbergData.faceColors[W].a);for(let W=12;W<this.goldbergData.faceColors.length;W++)for(let V=0;V<6;V++)p.push(this.goldbergData.faceColors[W].r,this.goldbergData.faceColors[W].g,this.goldbergData.faceColors[W].b,this.goldbergData.faceColors[W].a);return p}setGoldbergFaceColors(V){const p=this._changeGoldbergFaceColors(V);this.Ga(E.f.ColorKind,p)}updateGoldbergFaceColors(V){const p=this._changeGoldbergFaceColors(V);this.updateVerticesData(E.f.ColorKind,p)}_changeGoldbergFaceUVs(V){const p=this.getVerticesData(E.f.UVKind);for(let W=0;W<V.length;W++){const N=V[W][0],d=V[W][1],E=V[W][2],z=V[W][3],S=V[W][4],Q=[],J=[];let i,l;for(let V=0;V<5;V++)i=E.x+z*Math.cos(S+V*Math.PI/2.5),l=E.y+z*Math.sin(S+V*Math.PI/2.5),i<0&&(i=0),i>1&&(i=1),Q.push(i,l);for(let V=0;V<6;V++)i=E.x+z*Math.cos(S+V*Math.PI/3),l=E.y+z*Math.sin(S+V*Math.PI/3),i<0&&(i=0),i>1&&(i=1),J.push(i,l);for(let V=N;V<Math.min(12,d+1);V++)for(let W=0;W<5;W++)p[10*V+2*W]=Q[2*W],p[10*V+2*W+1]=Q[2*W+1];for(let V=Math.max(12,N);V<d+1;V++)for(let W=0;W<6;W++)p[12*V-24+2*W]=J[2*W],p[12*V-23+2*W]=J[2*W+1]}return p}setGoldbergFaceUVs(V){const p=this._changeGoldbergFaceUVs(V);this.Ga(E.f.UVKind,p)}updateGoldbergFaceUVs(V){const p=this._changeGoldbergFaceUVs(V);this.updateVerticesData(E.f.UVKind,p)}placeOnGoldbergFaceAt(V,p,W){const d=N.n.RotationFromAxis(this.goldbergData.faceXaxis[p],this.goldbergData.faceYaxis[p],this.goldbergData.faceZaxis[p]);V.rotation=d,V.position=this.goldbergData.faceCenters[p].add(this.goldbergData.faceXaxis[p].scale(W.x)).add(this.goldbergData.faceYaxis[p].scale(W.y)).add(this.goldbergData.faceZaxis[p].scale(W.z))}serialize(V){super.serialize(V),V.type="GoldbergMesh";const p={};if(p.adjacentFaces=this.goldbergData.adjacentFaces,p.nbSharedFaces=this.goldbergData.nbSharedFaces,p.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,p.nbFaces=this.goldbergData.nbFaces,p.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){p.faceColors=[];for(const V of this.goldbergData.faceColors)p.faceColors.push(V.Zi())}if(this.goldbergData.faceCenters){p.faceCenters=[];for(const V of this.goldbergData.faceCenters)p.faceCenters.push(V.Zi())}if(this.goldbergData.faceZaxis){p.faceZaxis=[];for(const V of this.goldbergData.faceZaxis)p.faceZaxis.push(V.Zi())}if(this.goldbergData.faceYaxis){p.faceYaxis=[];for(const V of this.goldbergData.faceYaxis)p.faceYaxis.push(V.Zi())}if(this.goldbergData.faceXaxis){p.faceXaxis=[];for(const V of this.goldbergData.faceXaxis)p.faceXaxis.push(V.Zi())}V.goldbergData=p}static Parse(V,p){const W=V.goldbergData;W.faceColors=W.faceColors.map((V=>j.e.Tg(V))),W.faceCenters=W.faceCenters.map((V=>N.n.Tg(V))),W.faceZaxis=W.faceZaxis.map((V=>N.n.Tg(V))),W.faceXaxis=W.faceXaxis.map((V=>N.n.Tg(V))),W.faceYaxis=W.faceYaxis.map((V=>N.n.Tg(V)));const d=new lV(V.name,p);return d.goldbergData=W,d}}var jV=W(11571);class kV{constructor(V){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=V}moveTo(V,p){this._currentPath=new L.g(V,p),this._tempPaths.push(this._currentPath)}lineTo(V,p){this._currentPath.addLineTo(V,p)}quadraticCurveTo(V,p,W,N){this._currentPath.addQuadraticCurveTo(V,p,W,N,this._resolution)}bezierCurveTo(V,p,W,N,d,E){this._currentPath.addBezierCurveTo(V,p,W,N,d,E,this._resolution)}extractHoles(){for(const V of this._tempPaths)V.area()>0?this._holes.push(V):this._paths.push(V);if(!this._paths.length&&this._holes.length){const V=this._holes;this._holes=this._paths,this._paths=V}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function uV(V,p,W,N,d,E){const z=E.glyphs[V]||E.glyphs["?"];if(!z)return null;const S=new kV(d);if(z.o){const V=z.o.split(" ");for(let d=0,E=V.length;d<E;){switch(V[d++]){case"m":{const E=parseInt(V[d++])*p+W,z=parseInt(V[d++])*p+N;S.moveTo(E,z);break}case"l":{const E=parseInt(V[d++])*p+W,z=parseInt(V[d++])*p+N;S.lineTo(E,z);break}case"q":{const E=parseInt(V[d++])*p+W,z=parseInt(V[d++])*p+N,Q=parseInt(V[d++])*p+W,J=parseInt(V[d++])*p+N;S.quadraticCurveTo(Q,J,E,z);break}case"b":{const E=parseInt(V[d++])*p+W,z=parseInt(V[d++])*p+N,Q=parseInt(V[d++])*p+W,J=parseInt(V[d++])*p+N,i=parseInt(V[d++])*p+W,l=parseInt(V[d++])*p+N;S.bezierCurveTo(Q,J,i,l,E,z);break}}}}return S.extractHoles(),{offsetX:z.ha*p,shapePath:S}}const fV={CreateBox:l.d,CreateTiledBox:O,CreateSphere:U.d,CreateDisc:i.c,CreateIcoSphere:M,CreateRibbon:J,CreateCylinder:v,CreateTorus:e,CreateTorusKnot:o,CreateLineSystem:K.f,pb:K.g,CreateDashedLines:K.c,ExtrudeShape:r,ExtrudeShapeCustom:B,CreateLathe:I,CreateTiledPlane:u,fg:c.c,CreateGround:q.f,CreateTiledGround:q.j,CreateGroundFromHeightMap:q.d,CreatePolygon:R,ExtrudePolygon:X,CreateTube:g,CreatePolyhedron:H,CreateGeodesic:function(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=p.m||1;N!==Math.floor(N)&&(N=Math.floor(N),h.e.Warn("m not an integer only floor(m) used"));let d=p.n||0;if(d!==Math.floor(d)&&(d=Math.floor(d),h.e.Warn("n not an integer only floor(n) used")),d>N){const V=d;d=N,N=V,h.e.Warn("n > m therefore m and n swapped")}const E=new QV;return E.build(N,d),H(V,{custom:iV.BuildGeodesicData(E),size:p.size,sizeX:p.sizeX,sizeY:p.sizeY,sizeZ:p.sizeZ,faceUV:p.faceUV,faceColors:p.faceColors,flat:p.flat,updatable:p.updatable,sideOrientation:p.sideOrientation,frontUVs:p.frontUVs,backUVs:p.backUVs},W)},CreateGoldberg:function(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=p.size,Q=p.sizeX||E||1,J=p.sizeY||E||1,i=p.sizeZ||E||1;let l=p.m||1;l!==Math.floor(l)&&(l=Math.floor(l),h.e.Warn("m not an integer only floor(m) used"));let k=p.n||0;if(k!==Math.floor(k)&&(k=Math.floor(k),h.e.Warn("n not an integer only floor(n) used")),k>l){const V=k;k=l,l=V,h.e.Warn("n > m therefore m and n swapped")}const u=new QV;u.build(l,k);const f=iV.BuildGeodesicData(u),O=f.toGoldbergPolyhedronData(),U=new lV(V,W);p.sideOrientation=d.e._GetDefaultSideOrientation(p.sideOrientation),U._originalBuilderSideOrientation=p.sideOrientation;(function(V,p){const W=V.size,d=V.sizeX||W||1,E=V.sizeY||W||1,Q=V.sizeZ||W||1,J=0===V.sideOrientation?0:V.sideOrientation||z.b.DEFAULTSIDE,i=[],l=[],j=[],k=[];let u=1/0,f=-1/0,O=1/0,U=-1/0;for(let N=0;N<p.vertex.length;N++)u=Math.min(u,p.vertex[N][0]*d),f=Math.max(f,p.vertex[N][0]*d),O=Math.min(O,p.vertex[N][1]*E),U=Math.max(U,p.vertex[N][1]*E);let F=0;for(let z=0;z<p.face.length;z++){const V=p.face[z],W=N.n.Tg(p.vertex[V[0]]),J=N.n.Tg(p.vertex[V[2]]),C=N.n.Tg(p.vertex[V[1]]),A=J.ed(W),v=C.ed(W),t=N.n.Cross(v,A).normalize();for(let N=0;N<V.length;N++){j.push(t.x,t.y,t.z);const W=p.vertex[V[N]];i.push(W[0]*d,W[1]*E,W[2]*Q);const z=(W[1]*E-O)/(U-O);k.push((W[0]*d-u)/(f-u),S.d?1-z:z)}for(let p=0;p<V.length-2;p++)l.push(F,F+p+2,F+p+1);F+=V.length}z.b._ComputeSides(J,i,l,j,k);const C=new z.b;return C.xa=i,C.indices=l,C.ya=j,C.Aa=k,C})(p,O).Ca(U,p.updatable),U.goldbergData.nbSharedFaces=f.sharedNodes,U.goldbergData.nbUnsharedFaces=f.poleNodes,U.goldbergData.adjacentFaces=f.adjacentFaces,U.goldbergData.nbFaces=U.goldbergData.nbSharedFaces+U.goldbergData.nbUnsharedFaces,U.goldbergData.nbFacesAtPole=(U.goldbergData.nbUnsharedFaces-12)/12;for(let d=0;d<f.vertex.length;d++)U.goldbergData.faceCenters.push(N.n.Tg(f.vertex[d])),U.goldbergData.faceCenters[d].x*=Q,U.goldbergData.faceCenters[d].y*=J,U.goldbergData.faceCenters[d].z*=i,U.goldbergData.faceColors.push(new j.e(1,1,1,1));for(let d=0;d<O.face.length;d++){const V=O.face[d],p=N.n.Tg(O.vertex[V[0]]),W=N.n.Tg(O.vertex[V[2]]),E=N.n.Tg(O.vertex[V[1]]),z=W.ed(p),S=E.ed(p),Q=N.n.Cross(S,z).normalize(),J=N.n.Cross(S,Q).normalize();U.goldbergData.faceXaxis.push(S.normalize()),U.goldbergData.faceYaxis.push(Q),U.goldbergData.faceZaxis.push(J)}return U},CreateDecal:dV,CreateCapsule:zV,CreateText:function(V,p,W){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const Q=function(V,p,W,N){const d=Array.from(V),E=p/N.resolution,z=(N.boundingBox.yMax-N.boundingBox.yMin+N.underlineThickness)*E,S=[];let Q=0,J=0;for(let i=0;i<d.length;i++){const V=d[i];if("\n"===V)Q=0,J-=z;else{const p=uV(V,E,Q,J,W,N);p&&(Q+=p.offsetX,S.push(p.shapePath))}}return S}(p,E.size||50,E.resolution||8,W),J=[];let i=0;for(const u of Q){if(!u.paths.length)continue;const p=u.holes.slice();for(const W of u.paths){var l,j;const Q=[],k=[],u=W.getPoints();for(const V of u)k.push(new N.n(V.x,0,V.y));const f=p.slice();for(const V of f){const d=V.getPoints();let E=!1;for(const V of d)if(W.isPointInside(V)){E=!0;break}if(!E)continue;const z=[];for(const V of d)z.push(new N.n(V.x,0,V.y));Q.push(z),p.splice(p.indexOf(V),1)}if(!Q.length&&p.length)for(const V of p){const p=V.getPoints(),W=[];for(const V of p)W.push(new N.n(V.x,0,V.y));Q.push(W)}const O=X(V,{shape:k,holes:Q.length?Q:void 0,depth:E.depth||1,faceUV:E.faceUV||(null===(l=E.perLetterFaceUV)||void 0===l?void 0:l.call(E,i)),faceColors:E.faceColors||(null===(j=E.perLetterFaceColors)||void 0===j?void 0:j.call(E,i)),sideOrientation:d.e._GetDefaultSideOrientation(E.sideOrientation||d.e.DOUBLESIDE)},z,S);J.push(O),i++}}const k=d.e.MergeMeshes(J,!0,!0);if(k){const p=k.getBoundingInfo().boundingBox;k.position.x+=-(p.minimumWorld.x+p.maximumWorld.x)/2,k.position.y+=-(p.minimumWorld.y+p.maximumWorld.y)/2,k.position.z+=-(p.minimumWorld.z+p.maximumWorld.z)/2+p.extendSize.z,k.name=V;const W=new jV.b("pivot",z);W.rotation.x=-Math.PI/2,k.parent=W,k.bakeCurrentTransformIntoVertices(),k.parent=null,W.dispose()}return k}}},11390:(V,p,W)=>{"use strict";W.d(p,{b:()=>Q});var N=W(11291),d=W(11394),E=W(11402),z=W(11422),S=W(11431);class Q{get materialDefines(){var V;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(V=this._getDrawWrapper())||void 0===V?void 0:V.defines}set materialDefines(V){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=V}_getDrawWrapper(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V=V??this._engine.currentRenderPassId;let W=this._drawWrappers[V];return!W&&p&&(this._drawWrappers[V]=W=new S.e(this._mesh.va().getEngine())),W}_removeDrawWrapper(V){var p;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(p=this._drawWrappers[V])||void 0===p||p.dispose());this._drawWrappers[V]=void 0}get effect(){var V;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(V=this._getDrawWrapper())||void 0===V?void 0:V.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(V){this._mainDrawWrapperOverride=V}setEffect(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2?arguments[2]:void 0,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const d=this._drawWrapper;d.setEffect(V,p,N),void 0!==W&&(d.materialContext=W),V||(d.defines=null,d.materialContext=void 0)}resetDrawCache(V){if(this._drawWrappers){if(void 0!==V)return void this._removeDrawWrapper(V);for(const V of this._drawWrappers)null===V||void 0===V||V.dispose()}this._drawWrappers=[]}static AddToMesh(V,p,W,N,d,E,z){return new Q(V,p,W,N,d,E,z,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(V,p,W,N,d,E,z){let S=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],Q=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=V,this.verticesStart=p,this.verticesCount=W,this.indexStart=N,this.indexCount=d,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=E,this._renderingMesh=z||E,Q&&E.dg.push(this),this._engine=this._mesh.va().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=E.dg.length-1,S&&(this.refreshBoundingInfo(),E.Dj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(V){return this._boundingInfo=V,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const V=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return V||this._renderingMesh}Ha(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const p=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!p)return V?this._mesh.va().defaultMaterial:null;if(this._isMultiMaterial(p)){const V=p.getSubMaterial(this.materialIndex);return this._currentMaterial!==V&&(this._currentMaterial=V,this.resetDrawCache()),V}return p}_isMultiMaterial(V){return void 0!==V.getSubMaterial}refreshBoundingInfo(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.sj)return this;if(V||(V=this._renderingMesh.getVerticesData(N.f.PositionKind)),!V)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const p=this._renderingMesh.Zf();let W;if(0===this.indexStart&&this.indexCount===p.length){const V=this._renderingMesh.getBoundingInfo();W={minimum:V.minimum.clone(),maximum:V.maximum.clone()}}else W=(0,z.d)(V,p,this.indexStart,this.indexCount,this._renderingMesh.sj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(W.minimum,W.maximum):this._boundingInfo=new E.c(W.minimum,W.maximum),this}_checkCollision(V){return this.getBoundingInfo()._checkCollision(V)}updateBoundingInfo(V){let p=this.getBoundingInfo();return p||(this.refreshBoundingInfo(),p=this.getBoundingInfo()),p&&p.update(V),this}isInFrustum(V){const p=this.getBoundingInfo();return!!p&&p.isInFrustum(V,this._mesh.ri)}isCompletelyInFrustum(V){const p=this.getBoundingInfo();return!!p&&p.isCompletelyInFrustum(V)}render(V){return this._renderingMesh.render(this,V,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(V,p){if(!this._linesIndexBuffer){const W=[];for(let p=this.indexStart;p<this.indexStart+this.indexCount;p+=3)W.push(V[p],V[p+1],V[p+1],V[p+2],V[p+2],V[p]);this._linesIndexBuffer=p.createIndexBuffer(W),this._linesIndexCount=W.length}return this._linesIndexBuffer}canIntersects(V){const p=this.getBoundingInfo();return!!p&&V.intersectsBox(p.boundingBox)}intersects(V,p,W,N,d){const E=this.Ha();if(!E)return null;let z=3,S=!1;switch(E.fillMode){case 3:case 5:case 6:case 8:return null;case 7:z=1,S=!0}return 4===E.fillMode?W.length?this._intersectLines(V,p,W,this._mesh.intersectionThreshold,N):this._intersectUnIndexedLines(V,p,W,this._mesh.intersectionThreshold,N):!W.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(V,p,W,N,d):this._intersectTriangles(V,p,W,z,S,N,d)}_intersectLines(V,p,W,N,E){let z=null;for(let S=this.indexStart;S<this.indexStart+this.indexCount;S+=2){const Q=p[W[S]],J=p[W[S+1]],i=V.intersectionSegment(Q,J,N);if(!(i<0)&&((E||!z||i<z.distance)&&(z=new d.d(null,null,i),z.faceId=S/2,E)))break}return z}_intersectUnIndexedLines(V,p,W,N,E){let z=null;for(let S=this.verticesStart;S<this.verticesStart+this.verticesCount;S+=2){const W=p[S],Q=p[S+1],J=V.intersectionSegment(W,Q,N);if(!(J<0)&&((E||!z||J<z.distance)&&(z=new d.d(null,null,J),z.faceId=S/2,E)))break}return z}_intersectTriangles(V,p,W,N,d,E,z){let S=null,Q=-1;for(let J=this.indexStart;J<this.indexStart+this.indexCount-(3-N);J+=N){Q++;const N=W[J],i=W[J+1],l=W[J+2];if(d&&4294967295===l){J+=2;continue}const j=p[N],k=p[i],u=p[l];if(!j||!k||!u)continue;if(z&&!z(j,k,u,V,N,i,l))continue;const f=V.intersectsTriangle(j,k,u);if(f){if(f.distance<0)continue;if((E||!S||f.distance<S.distance)&&(S=f,S.faceId=Q,E))break}}return S}_intersectUnIndexedTriangles(V,p,W,N,d){let E=null;for(let z=this.verticesStart;z<this.verticesStart+this.verticesCount;z+=3){const W=p[z],S=p[z+1],Q=p[z+2];if(d&&!d(W,S,Q,V,-1,-1,-1))continue;const J=V.intersectsTriangle(W,S,Q);if(J){if(J.distance<0)continue;if((N||!E||J.distance<E.distance)&&(E=J,E.faceId=z/3,N))break}}return E}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(V,p){const W=new Q(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,V,p,!1);if(!this.IsGlobal){const V=this.getBoundingInfo();if(!V)return W;W._boundingInfo=new E.c(V.minimum,V.maximum)}return W}dispose(){this._linesIndexBuffer&&(this._mesh.va().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const V=this._mesh.dg.indexOf(this);this._mesh.dg.splice(V,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(V,p,W,N,d){let E=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],z=Number.MAX_VALUE,S=-Number.MAX_VALUE;const J=(d||N).Zf();for(let Q=p;Q<p+W;Q++){const V=J[Q];V<z&&(z=V),V>S&&(S=V)}return new Q(V,z,S-z+1,p,W,N,d,E)}}},12572:(V,p,W)=>{"use strict";var N=W(11510),d=W(11291),E=W(11218),z=W(10870),S=W(11402);N.e.prototype.thinInstanceAdd=function(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return z.e.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(V)?V.length:1);const W=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(V))for(let N=0;N<V.length;++N)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,V[N],N===V.length-1&&p);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,V,p);return W},N.e.prototype.thinInstanceAddSelf=function(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(E.e.IdentityReadOnly,V)},N.e.prototype.thinInstanceRegisterAttribute=function(V,p){V===d.f.ColorKind&&(V=d.f.ColorInstanceKind),this.removeVerticesData(V),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[V]=p,this._userThinInstanceBuffersStorage.sizes[V]=p*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[V]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[V]),this._userThinInstanceBuffersStorage.vertexBuffers[V]=new d.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[V],V,!0,!1,p,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[V])},N.e.prototype.thinInstanceSetMatrixAt=function(V,p){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||V>=this._thinInstanceDataStorage.instancesCount)return!1;const N=this._thinInstanceDataStorage.matrixData;return p.copyToArray(N,16*V),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[V]=p),W&&(this.Wb("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},N.e.prototype.thinInstanceSetAttributeAt=function(V,p,W){let N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return V===d.f.ColorKind&&(V=d.f.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[V]||p>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(V,0),this._userThinInstanceBuffersStorage.data[V].set(W,p*this._userThinInstanceBuffersStorage.strides[V]),N&&this.Wb(V),!0)},Object.defineProperty(N.e.prototype,"Ub",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(V){var p;const W=this._thinInstanceDataStorage.matrixData??(null===(p=this.source)||void 0===p?void 0:p._thinInstanceDataStorage.matrixData);V<=(W?W.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=V)},enumerable:!0,configurable:!0}),N.e.prototype._thinInstanceCreateMatrixBuffer=function(V,p){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const N=new d.c(this.getEngine(),p,!W,16,!1,!0);for(let d=0;d<4;d++)this.setVerticesBuffer(N.createVertexBuffer(V+d,4*d,4));return N},N.e.prototype.Cb=function(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var E;if(W=W||16,"matrix"===V)null===(E=this._thinInstanceDataStorage.matrixBuffer)||void 0===E||E.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=p?p.length:32*W,this._thinInstanceDataStorage.matrixData=p,this._thinInstanceDataStorage.worldMatrices=null,null!==p?(this._thinInstanceDataStorage.instancesCount=p.length/W,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",p,N),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===V){var z;null===(z=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===z||z.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=p,null!==p&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",p,N))}else{var S;if(V===d.f.ColorKind&&(V=d.f.ColorInstanceKind),null===p)null!==(S=this._userThinInstanceBuffersStorage)&&void 0!==S&&S.data[V]&&(this.removeVerticesData(V),delete this._userThinInstanceBuffersStorage.data[V],delete this._userThinInstanceBuffersStorage.strides[V],delete this._userThinInstanceBuffersStorage.sizes[V],delete this._userThinInstanceBuffersStorage.vertexBuffers[V]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[V]=p,this._userThinInstanceBuffersStorage.strides[V]=W,this._userThinInstanceBuffersStorage.sizes[V]=p.length,this._userThinInstanceBuffersStorage.vertexBuffers[V]=new d.f(this.getEngine(),p,V,!N,!1,W,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[V])}},N.e.prototype.Wb=function(V){var p;if("matrix"===V)this.Bj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(V),null===(p=this._thinInstanceDataStorage.matrixBuffer)||void 0===p||p.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===V){var W;this.Bj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(V),null===(W=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===W||W.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var N;V===d.f.ColorKind&&(V=d.f.ColorInstanceKind),null!==(N=this._userThinInstanceBuffersStorage)&&void 0!==N&&N.vertexBuffers[V]&&(this.Bj&&!this._userThinInstanceBuffersStorage.vertexBuffers[V].isUpdatable()&&this._thinInstanceRecreateBuffer(V),this._userThinInstanceBuffersStorage.vertexBuffers[V].updateDirectly(this._userThinInstanceBuffersStorage.data[V],0))}},N.e.prototype.thinInstancePartialBufferUpdate=function(V,p,W){var N;"matrix"===V?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(p,W):(V===d.f.ColorKind&&(V=d.f.ColorInstanceKind),null!==(N=this._userThinInstanceBuffersStorage)&&void 0!==N&&N.vertexBuffers[V]&&this._userThinInstanceBuffersStorage.vertexBuffers[V].updateDirectly(p,W))},N.e.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const V=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let p=0;p<this._thinInstanceDataStorage.instancesCount;++p)this._thinInstanceDataStorage.worldMatrices[p]=E.e.Tg(V,16*p)}return this._thinInstanceDataStorage.worldMatrices},N.e.prototype.thinInstanceRefreshBoundingInfo=function(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const N=this._thinInstanceDataStorage.boundingVectors;if(V||!this.rawBoundingInfo){N.length=0,this.refreshBoundingInfo(p,W);const V=this.getBoundingInfo();this.rawBoundingInfo=new S.c(V.minimum,V.maximum)}const d=this.getBoundingInfo(),z=this._thinInstanceDataStorage.matrixData;if(0===N.length)for(let E=0;E<d.boundingBox.vectors.length;++E)N.push(d.boundingBox.vectors[E].clone());E.i.fb[0].ee(Number.POSITIVE_INFINITY),E.i.fb[1].ee(Number.NEGATIVE_INFINITY);for(let S=0;S<this._thinInstanceDataStorage.instancesCount;++S){E.e.FromArrayToRef(z,16*S,E.i.Matrix[0]);for(let V=0;V<N.length;++V)E.n.TransformCoordinatesToRef(N[V],E.i.Matrix[0],E.i.fb[2]),E.i.fb[0].minimizeInPlace(E.i.fb[2]),E.i.fb[1].maximizeInPlace(E.i.fb[2])}d.reConstruct(E.i.fb[0],E.i.fb[1]),this.Ea()},N.e.prototype._thinInstanceRecreateBuffer=function(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var W;if("matrix"===V)null===(W=this._thinInstanceDataStorage.matrixBuffer)||void 0===W||W.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,p);else if("previousMatrix"===V){var N;if(this._scene.needsPreviousWorldMatrices)null===(N=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===N||N.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,p)}else{var E;V===d.f.ColorKind&&(V=d.f.ColorInstanceKind),null===(E=this._userThinInstanceBuffersStorage.vertexBuffers[V])||void 0===E||E.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[V]=new d.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[V],V,!p,!1,this._userThinInstanceBuffersStorage.strides[V],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[V])}},N.e.prototype._thinInstanceUpdateBufferSize=function(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;V===d.f.ColorKind&&(V=d.f.ColorInstanceKind);const W="matrix"===V;if(!W&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[V]))return;const N=W?16:this._userThinInstanceBuffersStorage.strides[V],E=W?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[V];let z=W?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[V];const S=(this._thinInstanceDataStorage.instancesCount+p)*N;let Q=E;for(;Q<S;)Q*=2;if(!z||E!=Q){if(z){const V=new Float32Array(Q);V.set(z,0),z=V}else z=new Float32Array(Q);var J,i,l;if(W){if(null===(J=this._thinInstanceDataStorage.matrixBuffer)||void 0===J||J.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",z,!1),this._thinInstanceDataStorage.matrixData=z,this._thinInstanceDataStorage.matrixBufferSize=Q,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(i=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===i||i.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",z,!1)}else null===(l=this._userThinInstanceBuffersStorage.vertexBuffers[V])||void 0===l||l.dispose(),this._userThinInstanceBuffersStorage.data[V]=z,this._userThinInstanceBuffersStorage.sizes[V]=Q,this._userThinInstanceBuffersStorage.vertexBuffers[V]=new d.f(this.getEngine(),z,V,!0,!1,N,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[V])}},N.e.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},N.e.prototype._disposeThinInstanceSpecificData=function(){var V;null!==(V=this._thinInstanceDataStorage)&&void 0!==V&&V.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11571:(V,p,W)=>{"use strict";W.d(p,{b:()=>l});var N=W(11167),d=W(11175),E=W(11265),z=W(10856),S=W(11218),Q=W(11529),J=W(11004);const i=S.e.Compose(S.n.One(),S.f.FromEulerAngles(0,Math.PI,0),S.n.Zero());class l extends Q.b{get billboardMode(){return this._billboardMode}set billboardMode(V){this._billboardMode!==V&&(this._billboardMode=V,this._cache.useBillboardPosition=0!==(this._billboardMode&l.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(V){V!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=V,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==l.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(V){this._infiniteDistance!==V&&(this._infiniteDistance=V)}constructor(V){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new S.n(0,0,1),this._up=new S.n(0,1,0),this._right=new S.n(1,0,0),this._position=S.n.Zero(),this._rotation=S.n.Zero(),this._rotationQuaternion=null,this._scaling=S.n.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=l.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Fj=S.e.Zero(),this._usePivotMatrix=!1,this._absolutePosition=S.n.Zero(),this._absoluteScaling=S.n.Zero(),this._absoluteRotationQuaternion=S.f.Identity(),this._pivotMatrix=S.e.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new z.b,this._nonUniformScaling=!1,p&&this.va().addTransformNode(this)}getClassName(){return"tb"}get position(){return this._position}set position(V){this._position=V,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(V){this._rotation=V,this._rotationQuaternion=null,this._markAsDirtyInternal()}get ie(){return this._scaling}set ie(V){this._scaling=V,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(V){this._rotationQuaternion=V,V&&this._rotation.ee(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return S.n.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return S.n.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return S.n.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(V){return this._poseMatrix?(this._poseMatrix.p(V),this):(this._poseMatrix=V.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=S.e.Identity()),this._poseMatrix}_isSynchronized(){const V=this._cache;return this._billboardMode===V.billboardMode&&this._billboardMode===l.BILLBOARDMODE_NONE&&(!V.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const V=this._cache;V.localMatrixUpdated=!1,V.billboardMode=-1,V.infiniteDistance=!1,V.useBillboardPosition=!1,V.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(V){return this.setPivotMatrix(V,!1)}setPivotMatrix(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(V),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=p,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=S.e.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;const N=this.clone("Clone of "+(this.name||this.id),V||this.parent,!0);N&&W&&W(this,N);for(const d of this.getChildTransformNodes(!0))d.instantiateHierarchy(N,p,W);return N}jc(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return V?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.ee(0),this._rotationQuaternion=this._rotationQuaternion||S.f.Identity(),V.decompose(this._scaling,this._rotationQuaternion,this._position),this.Dj(!0)):(this._worldMatrix=V,this._absolutePosition.ge(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Dj(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Dj(!0),this}get ej(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Dj(),this._absolutePosition}setAbsolutePosition(V){if(!V)return this;let p,W,N;if(void 0===V.x){if(arguments.length<3)return this;p=arguments[0],W=arguments[1],N=arguments[2]}else p=V.x,W=V.y,N=V.z;if(this.parent){const V=S.i.Matrix[0];this.parent.getWorldMatrix().invertToRef(V),S.n.TransformCoordinatesFromFloatsToRef(p,W,N,V,this.position)}else this.position.x=p,this.position.y=W,this.position.z=N;return this._absolutePosition.p(V),this}setPositionWithLocalVector(V){return this.Dj(),this.position=S.n.TransformNormal(V,this.Fj),this}getPositionExpressedInLocalSpace(){this.Dj();const V=S.i.Matrix[0];return this.Fj.invertToRef(V),S.n.TransformNormal(this.position,V)}locallyTranslate(V){return this.Dj(!0),this.position=S.n.TransformCoordinates(V,this.Fj),this}lookAt(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const E=l._LookAtVectorCache,z=0===d?this.position:this.getAbsolutePosition();if(V.subtractToRef(z,E),this.setDirection(E,p,W,N),1===d&&this.parent)if(this.rotationQuaternion){const V=S.i.Matrix[0];this.rotationQuaternion.toRotationMatrix(V);const p=S.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(p),p.invert(),V.multiplyToRef(p,V),this.rotationQuaternion.fromRotationMatrix(V)}else{const V=S.i.Quaternion[0];S.f.FromEulerVectorToRef(this.rotation,V);const p=S.i.Matrix[0];V.toRotationMatrix(p);const W=S.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(W),W.invert(),p.multiplyToRef(W,p),V.fromRotationMatrix(p),V.toEulerAnglesToRef(this.rotation)}return this}Ze(V){const p=S.n.Zero();return this.getDirectionToRef(V,p),p}getDirectionToRef(V,p){return S.n.TransformNormalToRef(V,this.getWorldMatrix(),p),this}setDirection(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const d=-Math.atan2(V.z,V.x)+Math.PI/2,E=Math.sqrt(V.x*V.x+V.z*V.z),z=-Math.atan2(V.y,E);return this.rotationQuaternion?S.f.RotationYawPitchRollToRef(d+p,z+W,N,this.rotationQuaternion):(this.rotation.x=z+W,this.rotation.y=d+p,this.rotation.z=N),this}setPivotPoint(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Dj(!0);const W=this.getWorldMatrix();if(1==p){const p=S.i.Matrix[0];W.invertToRef(p),V=S.n.TransformCoordinates(V,p)}return this.setPivotMatrix(S.e.Translation(-V.x,-V.y,-V.z),!0)}getPivotPoint(){const V=S.n.Zero();return this.getPivotPointToRef(V),V}getPivotPointToRef(V){return V.x=-this._pivotMatrix.m[12],V.y=-this._pivotMatrix.m[13],V.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const V=S.n.Zero();return this.getAbsolutePivotPointToRef(V),V}getAbsolutePivotPointToRef(V){return this.getPivotPointToRef(V),S.n.TransformCoordinatesToRef(V,this.getWorldMatrix(),V),this}Jg(V){if(this._isDirty)return this;if(this._children)for(const p of this._children)p.Jg(V);return super.Jg(V)}setParent(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!V&&!this.parent)return this;const N=S.i.Quaternion[0],d=S.i.fb[0],E=S.i.fb[1],z=S.i.Matrix[1];S.e.IdentityToRef(z);const Q=S.i.Matrix[0];this.Dj(!0);let J=this.rotationQuaternion;return J||(J=l._TmpRotation,S.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,J)),S.e.ComposeToRef(this.ie,J,this.position,Q),this.parent&&Q.multiplyToRef(this.parent.Dj(!0),Q),V&&(V.Dj(!0).invertToRef(z),Q.multiplyToRef(z,Q)),Q.decompose(E,N,d,p?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(N):N.toEulerAnglesToRef(this.rotation),this.ie.p(E),this.position.p(d),this.parent=V,W&&this.setPivotMatrix(S.e.Identity()),this}addChild(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return V.setParent(this,p),this}removeChild(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return V.setParent(null,p),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(V){return this._nonUniformScaling!==V&&(this._nonUniformScaling=V,!0)}attachToBone(V,p){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=p,this.parent=V,V.getSkeleton().prepare(!0),V.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=V?this._currentParentWhenAttachingToBone:null,this):(V&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(V,p,W){let N;if(V.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.ee(0)),W&&0!==W){if(this.parent){const W=this.parent.getWorldMatrix(),N=S.i.Matrix[0];W.invertToRef(N),V=S.n.TransformNormal(V,N),W.determinant()<0&&(p*=-1)}N=S.f.RotationAxisToRef(V,p,l._RotationAxisCache),N.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else N=S.f.RotationAxisToRef(V,p,l._RotationAxisCache),this.rotationQuaternion.multiplyToRef(N,this.rotationQuaternion);return this}rotateAround(V,p,W){p.normalize(),this.rotationQuaternion||(this.rotationQuaternion=S.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.ee(0));const N=S.i.fb[0],d=S.i.fb[1],E=S.i.fb[2],z=S.i.Quaternion[0],Q=S.i.Matrix[0],J=S.i.Matrix[1],i=S.i.Matrix[2],l=S.i.Matrix[3];return V.subtractToRef(this.position,N),S.e.TranslationToRef(N.x,N.y,N.z,Q),S.e.TranslationToRef(-N.x,-N.y,-N.z,J),S.e.RotationAxisToRef(p,W,i),J.multiplyToRef(i,l),l.multiplyToRef(Q,l),l.decompose(d,z,E),this.position.addInPlace(E),z.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(V,p,W){const N=V.scale(p);if(W&&0!==W)this.setAbsolutePosition(this.getAbsolutePosition().add(N));else{const V=this.getPositionExpressedInLocalSpace().add(N);this.setPositionWithLocalVector(V)}return this}addRotation(V,p,W){let N;this.rotationQuaternion?N=this.rotationQuaternion:(N=S.i.Quaternion[1],S.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,N));const d=S.i.Quaternion[0];return S.f.RotationYawPitchRollToRef(p,V,W,d),N.multiplyInPlace(d),this.rotationQuaternion||N.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==l.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Dj(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const W=this.va().getRenderId();if(!this._isDirty&&!V&&(this._currentRenderId===W||this.isSynchronized()))return this._currentRenderId=W,this._worldMatrix;p=p||this.va().activeCamera,this._updateCache();const N=this._cache;N.pivotMatrixUpdated=!1,N.billboardMode=this.billboardMode,N.infiniteDistance=this.infiniteDistance,N.parent=this._parentNode,this._currentRenderId=W,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const d=this._getEffectiveParent(),E=l._TmpScaling;let z,Q=this._position;if(this._infiniteDistance&&!this.parent&&p){const V=p.getWorldMatrix(),W=new S.n(V.m[12],V.m[13],V.m[14]);Q=l._TmpTranslation,Q.ge(this._position.x+W.x,this._position.y+W.y,this._position.z+W.z)}if(E.ge(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,z=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(S.f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.ge(0,0,0))}}else z=l._TmpRotation,S.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,z);if(this._usePivotMatrix){const V=S.i.Matrix[1];S.e.ScalingToRef(E.x,E.y,E.z,V);const p=S.i.Matrix[0];z.toRotationMatrix(p),this._pivotMatrix.multiplyToRef(V,S.i.Matrix[4]),S.i.Matrix[4].multiplyToRef(p,this.Fj),this._postMultiplyPivotMatrix&&this.Fj.multiplyToRef(this._pivotMatrixInverse,this.Fj),this.Fj.addTranslationFromFloats(Q.x,Q.y,Q.z)}else S.e.ComposeToRef(E,z,Q,this.Fj);if(d&&d.getWorldMatrix){if(V&&d.Dj(V),N.useBillboardPath){if(this._transformToBoneReferal){const V=this.parent;V.getSkeleton().prepare(),V.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),S.i.Matrix[7])}else S.i.Matrix[7].p(d.getWorldMatrix());const V=S.i.fb[5],p=S.i.fb[6],W=S.i.Quaternion[0];S.i.Matrix[7].decompose(p,W,V),S.e.ScalingToRef(p.x,p.y,p.z,S.i.Matrix[7]),S.i.Matrix[7].setTranslation(V),l.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(W,V),this.Fj.setTranslation(V)),this.Fj.multiplyToRef(S.i.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const V=this.parent;V.getSkeleton().prepare(),this.Fj.multiplyToRef(V.getFinalMatrix(),S.i.Matrix[6]),S.i.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Fj.multiplyToRef(d.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Fj);if(N.useBillboardPath&&p&&this.billboardMode&&!N.useBillboardPosition){const V=S.i.fb[0];if(this._worldMatrix.getTranslationToRef(V),S.i.Matrix[1].p(p.getViewMatrix()),this._scene.useRightHandedSystem&&S.i.Matrix[1].multiplyToRef(i,S.i.Matrix[1]),S.i.Matrix[1].setTranslationFromFloats(0,0,0),S.i.Matrix[1].invertToRef(S.i.Matrix[0]),(this.billboardMode&l.BILLBOARDMODE_ALL)!==l.BILLBOARDMODE_ALL){S.i.Matrix[0].decompose(void 0,S.i.Quaternion[0],void 0);const V=S.i.fb[1];S.i.Quaternion[0].toEulerAnglesToRef(V),(this.billboardMode&l.BILLBOARDMODE_X)!==l.BILLBOARDMODE_X&&(V.x=0),(this.billboardMode&l.BILLBOARDMODE_Y)!==l.BILLBOARDMODE_Y&&(V.y=0),(this.billboardMode&l.BILLBOARDMODE_Z)!==l.BILLBOARDMODE_Z&&(V.z=0),S.e.RotationYawPitchRollToRef(V.y,V.x,V.z,S.i.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(S.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(S.i.fb[0])}else if(N.useBillboardPath&&p&&N.useBillboardPosition){const V=S.i.fb[0];this._worldMatrix.getTranslationToRef(V);const W=p.globalPosition;this._worldMatrix.invertToRef(S.i.Matrix[1]);const N=S.i.fb[1];S.n.TransformCoordinatesToRef(W,S.i.Matrix[1],N),N.normalize();const d=-Math.atan2(N.z,N.x)+Math.PI/2,E=Math.sqrt(N.x*N.x+N.z*N.z),z=-Math.atan2(N.y,E);if(S.f.RotationYawPitchRollToRef(d,z,0,S.i.Quaternion[0]),(this.billboardMode&l.BILLBOARDMODE_ALL)!==l.BILLBOARDMODE_ALL){const V=S.i.fb[1];S.i.Quaternion[0].toEulerAnglesToRef(V),(this.billboardMode&l.BILLBOARDMODE_X)!==l.BILLBOARDMODE_X&&(V.x=0),(this.billboardMode&l.BILLBOARDMODE_Y)!==l.BILLBOARDMODE_Y&&(V.y=0),(this.billboardMode&l.BILLBOARDMODE_Z)!==l.BILLBOARDMODE_Z&&(V.z=0),S.e.RotationYawPitchRollToRef(V.y,V.x,V.z,S.i.Matrix[0])}else S.e.FromQuaternionToRef(S.i.Quaternion[0],S.i.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(S.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(S.i.fb[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):d&&d._nonUniformScaling?this._updateNonUniformScalingState(d._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.ge(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=S.e.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Dj(),V){const V=this.getChildren();for(let p=0;p<V.length;++p){const W=V[p];if(W){W.Dj();const V=S.i.Matrix[0];W.Fj.multiplyToRef(this.Fj,V);const p=S.i.Quaternion[0];V.decompose(W.ie,p,W.position),W.rotationQuaternion?W.rotationQuaternion.p(p):p.toEulerAnglesToRef(W.rotation)}}}this.ie.ge(1,1,1),this.position.ge(0,0,0),this.rotation.ge(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=S.f.Identity()),this._worldMatrix=S.e.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(V){return this.onAfterWorldMatrixUpdateObservable.add(V),this}unregisterAfterWorldMatrixUpdate(V){return this.onAfterWorldMatrixUpdateObservable.removeCallback(V),this}getPositionInCameraSpace(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return V||(V=this.va().activeCamera),S.n.TransformCoordinates(this.getAbsolutePosition(),V.getViewMatrix())}getDistanceToCamera(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return V||(V=this.va().activeCamera),this.getAbsolutePosition().ed(V.globalPosition).length()}clone(V,p,W){const N=E.b.Clone((()=>new l(V,this.va())),this);if(N.name=V,N.id=V,p&&(N.parent=p),!W){const p=this.getDescendants(!0);for(let W=0;W<p.length;W++){const d=p[W];d.clone&&d.clone(V+"."+d.name,N)}}return N}serialize(V){const p=E.b.Serialize(this,V);return p.type=this.getClassName(),p.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(p),p.localMatrix=this.getPivotMatrix().Zi(),p.isEnabled=this.isEnabled(),E.b.AppendSerializedAnimations(this,p),p.ranges=this.serializeAnimationRanges(),p}static Parse(V,p,W){const N=E.b.Parse((()=>new l(V.name,p)),V,p,W);if(V.localMatrix?N.setPreTransformMatrix(S.e.Tg(V.localMatrix)):V.pivotMatrix&&N.setPivotMatrix(S.e.Tg(V.pivotMatrix)),N.Ab(V.isEnabled),N._waitingParsedUniqueId=V.uniqueId,void 0!==V.parentId&&(N._waitingParentId=V.parentId),void 0!==V.parentInstanceIndex&&(N._waitingParentInstanceIndex=V.parentInstanceIndex),V.animations){for(let p=0;p<V.animations.length;p++){const W=V.animations[p],d=(0,J.b)("BABYLON.Animation");d&&N.animations.push(d.Parse(W))}Q.b.ParseAnimationRanges(N,V,p)}return V.autoAnimate&&p.beginAnimation(N,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),N}getChildTransformNodes(V,p){const W=[];return this._getDescendants(W,V,(V=>(!p||p(V))&&V instanceof l)),W}dispose(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const V=this._parentContainer.transformNodes.indexOf(this);V>-1&&this._parentContainer.transformNodes.splice(V,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),V){const V=this.getChildTransformNodes(!0);for(const p of V)p.parent=null,p.Dj(!0)}super.dispose(V,p)}normalizeToUnitCube(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0,N=null,d=null;p&&(this.rotationQuaternion?(d=this.rotationQuaternion.clone(),this.rotationQuaternion.ge(0,0,0,1)):this.rotation&&(N=this.rotation.clone(),this.rotation.ge(0,0,0)));const E=this.getHierarchyBoundingVectors(V,W),z=E.max.ed(E.min),S=Math.max(z.x,z.y,z.z);if(0===S)return this;const Q=1/S;return this.ie.scaleInPlace(Q),p&&(this.rotationQuaternion&&d?this.rotationQuaternion.p(d):this.rotation&&N&&this.rotation.p(N)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}l.BILLBOARDMODE_NONE=0,l.BILLBOARDMODE_X=1,l.BILLBOARDMODE_Y=2,l.BILLBOARDMODE_Z=4,l.BILLBOARDMODE_ALL=7,l.BILLBOARDMODE_USE_POSITION=128,l.BillboardUseParentOrientation=!1,l._TmpRotation=S.f.Zero(),l._TmpScaling=S.n.Zero(),l._TmpTranslation=S.n.Zero(),l._LookAtVectorCache=new S.n(0,0,0),l._RotationAxisCache=new S.f,(0,N.c)([(0,d.F)("position")],l.prototype,"_position",void 0),(0,N.c)([(0,d.F)("rotation")],l.prototype,"_rotation",void 0),(0,N.c)([(0,d.y)("rotationQuaternion")],l.prototype,"_rotationQuaternion",void 0),(0,N.c)([(0,d.F)("ie")],l.prototype,"_scaling",void 0),(0,N.c)([(0,d.I)("billboardMode")],l.prototype,"_billboardMode",void 0),(0,N.c)([(0,d.I)()],l.prototype,"scalingDeterminant",void 0),(0,N.c)([(0,d.I)("infiniteDistance")],l.prototype,"_infiniteDistance",void 0),(0,N.c)([(0,d.I)()],l.prototype,"ignoreNonUniformScaling",void 0),(0,N.c)([(0,d.I)()],l.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11775:(V,p,W)=>{"use strict";W.d(p,{e:()=>J});var N=W(11218),d=W(11242),E=W(11757),z=W(11224),S=W(11257);class Q{constructor(V,p,W,N){this.name=V,this.worldAxisForNormal=p,this.worldAxisForFileX=W,this.worldAxisForFileY=N}}class J{static ConvertCubeMapTextureToSphericalPolynomial(V){var p;if(!V.isCube)return null;null===(p=V.va())||void 0===p||p.getEngine().flushFramebuffer();const W=V.getSize().width,N=V.readPixels(0,void 0,void 0,!1),d=V.readPixels(1,void 0,void 0,!1);let E,z;V.isRenderTarget?(E=V.readPixels(3,void 0,void 0,!1),z=V.readPixels(2,void 0,void 0,!1)):(E=V.readPixels(2,void 0,void 0,!1),z=V.readPixels(3,void 0,void 0,!1));const S=V.readPixels(4,void 0,void 0,!1),Q=V.readPixels(5,void 0,void 0,!1),J=V.gammaSpace;let i=0;return 1!=V.textureType&&2!=V.textureType||(i=1),new Promise((V=>{Promise.all([d,N,E,z,S,Q]).then((p=>{let[N,d,E,z,S,Q]=p;const l={size:W,right:d,left:N,up:E,down:z,front:S,back:Q,format:5,type:i,gammaSpace:J};V(this.ConvertCubeMapToSphericalPolynomial(l))}))}))}static _AreaElement(V,p){return Math.atan2(V*p,Math.sqrt(V*V+p*p+1))}static ConvertCubeMapToSphericalPolynomial(V){const p=new E.e;let W=0;const N=2/V.size,Q=N,J=.5*N,i=J-1;for(let E=0;E<6;E++){const l=this._FileFaces[E],j=V[l.name];let k=i;const u=5===V.format?4:3;for(let E=0;E<V.size;E++){let f=i;for(let Q=0;Q<V.size;Q++){const i=l.worldAxisForFileX.scale(f).add(l.worldAxisForFileY.scale(k)).add(l.worldAxisForNormal);i.normalize();const O=this._AreaElement(f-J,k-J)-this._AreaElement(f-J,k+J)-this._AreaElement(f+J,k-J)+this._AreaElement(f+J,k+J);let U=j[E*V.size*u+Q*u+0],F=j[E*V.size*u+Q*u+1],C=j[E*V.size*u+Q*u+2];isNaN(U)&&(U=0),isNaN(F)&&(F=0),isNaN(C)&&(C=0),0===V.type&&(U/=255,F/=255,C/=255),V.gammaSpace&&(U=Math.pow((0,d.d)(U),z.j),F=Math.pow((0,d.d)(F),z.j),C=Math.pow((0,d.d)(C),z.j));const A=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const V=Math.max(U,F,C);if(V>A){const p=A/V;U*=p,F*=p,C*=p}}else U=(0,d.d)(U,0,A),F=(0,d.d)(F,0,A),C=(0,d.d)(C,0,A);const v=new S.c(U,F,C);p.addLight(i,v,O),W+=O,f+=N}k+=Q}}const l=6*(4*Math.PI)/6/W;return p.scaleInPlace(l),p.convertIncidentRadianceToIrradiance(),p.convertIrradianceToLambertianRadiance(),E.i.FromHarmonics(p)}}J._FileFaces=[new Q("right",new N.n(1,0,0),new N.n(0,0,-1),new N.n(0,-1,0)),new Q("left",new N.n(-1,0,0),new N.n(0,0,1),new N.n(0,-1,0)),new Q("up",new N.n(0,1,0),new N.n(1,0,0),new N.n(0,0,1)),new Q("down",new N.n(0,-1,0),new N.n(1,0,0),new N.n(0,0,-1)),new Q("front",new N.n(0,0,1),new N.n(1,0,0),new N.n(0,-1,0)),new Q("back",new N.n(0,0,-1),new N.n(-1,0,0),new N.n(0,-1,0))],J.MAX_HDRI_VALUE=4096,J.PRESERVE_CLAMPED_COLORS=!1},11233:(V,p,W)=>{"use strict";function N(V,p){const W=[];for(let N=0;N<V;++N)W.push(p());return W}function d(V,p){return N(V,p)}W.d(p,{e:()=>N,f:()=>d,h:()=>z});const E=["push","splice","pop","shift","unshift"];function z(V,p){const W=E.map((W=>function(V,p,W){const N=V[p];if("function"!==typeof N)return null;const d=function(){const N=V.length,E=d.previous.apply(V,arguments);return W(p,N),E};return N.next=d,d.previous=N,V[p]=d,()=>{const W=d.previous;if(!W)return;const N=d.next;N?(W.next=N,N.previous=W):(W.next=void 0,V[p]=W),d.next=void 0,d.previous=void 0}}(V,W,p)));return()=>{W.forEach((V=>{null===V||void 0===V||V()}))}}},12502:(V,p,W)=>{"use strict";W.d(p,{e:()=>z});var N=W(11452),d=W(12506);let E=0;const z=V=>{if(!V.environmentBRDFTexture){const p=V.useDelayedTextureLoading;V.useDelayedTextureLoading=!1;const W=V._blockEntityCollection;V._blockEntityCollection=!1;const z=N.d.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+E++,V,!0,!1,N.d.BILINEAR_SAMPLINGMODE);V._blockEntityCollection=W;const S=V.getEngine().getLoadedTexturesCache(),Q=S.indexOf(z.getInternalTexture());-1!==Q&&S.splice(Q,1),z.isRGBD=!0,z.wrapU=N.d.CLAMP_ADDRESSMODE,z.wrapV=N.d.CLAMP_ADDRESSMODE,V.environmentBRDFTexture=z,V.useDelayedTextureLoading=p,d.e.ExpandRGBDTexture(z);const J=V.getEngine().onContextRestoredObservable.add((()=>{z.isRGBD=!0;const p=V.onBeforeRenderObservable.add((()=>{z.isReady()&&(V.onBeforeRenderObservable.remove(p),d.e.ExpandRGBDTexture(z))}))}));V.$i.add((()=>{V.getEngine().onContextRestoredObservable.remove(J)}))}return V.environmentBRDFTexture}},11515:(V,p,W)=>{"use strict";function N(V,p,W){try{const N=V.next();N.done?p(N):N.value?N.value.then((()=>{N.value=void 0,p(N)}),W):p(N)}catch(N){W(N)}}function d(){let V,p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(W,d,E)=>{const z=performance.now();void 0===V||z-V>p?(V=z,setTimeout((()=>{N(W,d,E)}),0)):N(W,d,E)}}function E(V,p,W,N,d){const E=()=>{let z;const S=V=>{V.done?W(V.value):void 0===z?z=!0:E()};do{z=void 0,d&&d.aborted?N(new Error("Aborted")):p(V,S,N),void 0===z&&(z=!1)}while(z)};E()}function z(V,p){let W;return E(V,N,(V=>W=V),(V=>{throw V}),p),W}function S(V,p,W){return new Promise(((N,d)=>{E(V,p,N,d,W)}))}function Q(V,p){return function(){return z(V(...arguments),p)}}W.d(p,{d:()=>d,g:()=>Q,h:()=>S,k:()=>z})},11766:(V,p,W)=>{"use strict";W.d(p,{e:()=>u});var N=W(11242),d=W(10870),E=W(11775),z=W(11780);W(11815);const S=131072,Q=131072;function J(V){return V.charCodeAt(0)+(V.charCodeAt(1)<<8)+(V.charCodeAt(2)<<16)+(V.charCodeAt(3)<<24)}const i=J("DXT1"),l=J("DXT3"),j=J("DXT5"),k=J("DX10");class u{static GetDDSInfo(V){const p=new Int32Array(V.buffer,V.byteOffset,31),W=new Int32Array(V.buffer,V.byteOffset,35);let N=1;p[2]&S&&(N=Math.max(1,p[7]));const d=p[21],E=d===k?W[32]:0;let z=0;switch(d){case 113:z=2;break;case 116:z=1;break;case k:if(10===E){z=2;break}if(2===E){z=1;break}}return{width:p[4],height:p[3],mipmapCount:N,isFourCC:4===(4&p[20]),isRGB:64===(64&p[20]),isLuminance:(p[20]&Q)===Q,isCube:512===(512&p[28]),isCompressed:d===i||d===l||d===j,dxgiFormat:E,textureType:z}}static _GetHalfFloatAsFloatRGBAArrayBuffer(V,p,W,N,d,E){const S=new Float32Array(N),Q=new Uint16Array(d,W);let J=0;for(let i=0;i<p;i++)for(let p=0;p<V;p++){const W=4*(p+i*V);S[J]=(0,z.g)(Q[W]),S[J+1]=(0,z.g)(Q[W+1]),S[J+2]=(0,z.g)(Q[W+2]),u.StoreLODInAlphaChannel?S[J+3]=E:S[J+3]=(0,z.g)(Q[W+3]),J+=4}return S}static _GetHalfFloatRGBAArrayBuffer(V,p,W,N,d,E){if(u.StoreLODInAlphaChannel){const S=new Uint16Array(N),Q=new Uint16Array(d,W);let J=0;for(let W=0;W<p;W++)for(let p=0;p<V;p++){const N=4*(p+W*V);S[J]=Q[N],S[J+1]=Q[N+1],S[J+2]=Q[N+2],S[J+3]=(0,z.j)(E),J+=4}return S}return new Uint16Array(d,W,N)}static _GetFloatRGBAArrayBuffer(V,p,W,N,d,E){if(u.StoreLODInAlphaChannel){const z=new Float32Array(N),S=new Float32Array(d,W);let Q=0;for(let W=0;W<p;W++)for(let p=0;p<V;p++){const N=4*(p+W*V);z[Q]=S[N],z[Q+1]=S[N+1],z[Q+2]=S[N+2],z[Q+3]=E,Q+=4}return z}return new Float32Array(d,W,N)}static _GetFloatAsHalfFloatRGBAArrayBuffer(V,p,W,N,d,E){const S=new Uint16Array(N),Q=new Float32Array(d,W);let J=0;for(let i=0;i<p;i++)for(let p=0;p<V;p++)S[J]=(0,z.j)(Q[J]),S[J+1]=(0,z.j)(Q[J+1]),S[J+2]=(0,z.j)(Q[J+2]),u.StoreLODInAlphaChannel?S[J+3]=(0,z.j)(E):S[J+3]=(0,z.j)(Q[J+3]),J+=4;return S}static _GetFloatAsUIntRGBAArrayBuffer(V,p,W,d,E,z){const S=new Uint8Array(d),Q=new Float32Array(E,W);let J=0;for(let i=0;i<p;i++)for(let p=0;p<V;p++){const W=4*(p+i*V);S[J]=255*(0,N.d)(Q[W]),S[J+1]=255*(0,N.d)(Q[W+1]),S[J+2]=255*(0,N.d)(Q[W+2]),u.StoreLODInAlphaChannel?S[J+3]=z:S[J+3]=255*(0,N.d)(Q[W+3]),J+=4}return S}static _GetHalfFloatAsUIntRGBAArrayBuffer(V,p,W,d,E,S){const Q=new Uint8Array(d),J=new Uint16Array(E,W);let i=0;for(let l=0;l<p;l++)for(let p=0;p<V;p++){const W=4*(p+l*V);Q[i]=255*(0,N.d)((0,z.g)(J[W])),Q[i+1]=255*(0,N.d)((0,z.g)(J[W+1])),Q[i+2]=255*(0,N.d)((0,z.g)(J[W+2])),u.StoreLODInAlphaChannel?Q[i+3]=S:Q[i+3]=255*(0,N.d)((0,z.g)(J[W+3])),i+=4}return Q}static _GetRGBAArrayBuffer(V,p,W,N,d,E,z,S,Q){const J=new Uint8Array(N),i=new Uint8Array(d,W);let l=0;for(let j=0;j<p;j++)for(let p=0;p<V;p++){const W=4*(p+j*V);J[l]=i[W+E],J[l+1]=i[W+z],J[l+2]=i[W+S],J[l+3]=i[W+Q],l+=4}return J}static _ExtractLongWordOrder(V){return 0===V||255===V||-16777216===V?0:1+u._ExtractLongWordOrder(V>>8)}static _GetRGBArrayBuffer(V,p,W,N,d,E,z,S){const Q=new Uint8Array(N),J=new Uint8Array(d,W);let i=0;for(let l=0;l<p;l++)for(let p=0;p<V;p++){const W=3*(p+l*V);Q[i]=J[W+E],Q[i+1]=J[W+z],Q[i+2]=J[W+S],i+=3}return Q}static _GetLuminanceArrayBuffer(V,p,W,N,d){const E=new Uint8Array(N),z=new Uint8Array(d,W);let S=0;for(let Q=0;Q<p;Q++)for(let p=0;p<V;p++){const W=p+Q*V;E[S]=z[W],S++}return E}static UploadDDSLevels(V,p,W,N,z,Q){let J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,f=arguments.length>7?arguments[7]:void 0,O=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],U=null;N.sphericalPolynomial&&(U=[]);const F=!!V.getCaps().s3tc;p.generateMipMaps=z;const C=new Int32Array(W.buffer,W.byteOffset,31);let A,v,t,e,Z,o,K,h=0,L=0,x=1;if(542327876!==C[0])return void d.e.Error("Invalid magic number in DDS header");if(!N.isFourCC&&!N.isRGB&&!N.isLuminance)return void d.e.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(N.isCompressed&&!F)return void d.e.Error("Compressed textures are not supported on this platform.");let T=C[22];e=C[1]+4;let P=!1;if(N.isFourCC)switch(A=C[21],A){case i:x=8,L=33777;break;case l:x=16,L=33778;break;case j:x=16,L=33779;break;case 113:P=!0,T=64;break;case 116:P=!0,T=128;break;case k:{e+=20;let V=!1;switch(N.dxgiFormat){case 10:P=!0,T=64,V=!0;break;case 2:P=!0,T=128,V=!0;break;case 88:N.isRGB=!0,N.isFourCC=!1,T=32,V=!0}if(V)break}default:return void d.e.Error(["Unsupported FourCC code:",(b=A,String.fromCharCode(255&b,b>>8&255,b>>16&255,b>>24&255))])}var b;const s=u._ExtractLongWordOrder(C[23]),G=u._ExtractLongWordOrder(C[24]),R=u._ExtractLongWordOrder(C[25]),X=u._ExtractLongWordOrder(C[26]);P&&(L=V._getRGBABufferInternalSizedFormat(N.textureType)),o=1,C[2]&S&&!1!==z&&(o=Math.max(1,C[7]));const r=f||0,B=V.getCaps();for(let d=r;d<Q;d++){for(v=C[4],t=C[3],K=0;K<o;++K){if(-1===J||J===K){const E=-1===J?K:0;if(!N.isCompressed&&N.isFourCC){p.format=5,h=v*t*4;let N=null;if(V._badOS||V._badDesktopOS||!B.textureHalfFloat&&!B.textureFloat)128===T?(N=u._GetFloatAsUIntRGBAArrayBuffer(v,t,W.byteOffset+e,h,W.buffer,E),U&&0==E&&U.push(u._GetFloatRGBAArrayBuffer(v,t,W.byteOffset+e,h,W.buffer,E))):64===T&&(N=u._GetHalfFloatAsUIntRGBAArrayBuffer(v,t,W.byteOffset+e,h,W.buffer,E),U&&0==E&&U.push(u._GetHalfFloatAsFloatRGBAArrayBuffer(v,t,W.byteOffset+e,h,W.buffer,E))),p.type=0;else{const V=B.textureFloat&&(O&&B.textureFloatLinearFiltering||!O),d=B.textureHalfFloat&&(O&&B.textureHalfFloatLinearFiltering||!O),z=(128===T||64===T&&!d)&&V?1:(64===T||128===T&&!V)&&d?2:0;let S,Q=null;if(128===T)switch(z){case 1:S=u._GetFloatRGBAArrayBuffer,Q=null;break;case 2:S=u._GetFloatAsHalfFloatRGBAArrayBuffer,Q=u._GetFloatRGBAArrayBuffer;break;case 0:S=u._GetFloatAsUIntRGBAArrayBuffer,Q=u._GetFloatRGBAArrayBuffer}else switch(z){case 1:S=u._GetHalfFloatAsFloatRGBAArrayBuffer,Q=null;break;case 2:S=u._GetHalfFloatRGBAArrayBuffer,Q=u._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:S=u._GetHalfFloatAsUIntRGBAArrayBuffer,Q=u._GetHalfFloatAsFloatRGBAArrayBuffer}p.type=z,N=S(v,t,W.byteOffset+e,h,W.buffer,E),U&&0==E&&U.push(Q?Q(v,t,W.byteOffset+e,h,W.buffer,E):N)}N&&V._uploadDataToTextureDirectly(p,N,d,E)}else if(N.isRGB)p.type=0,24===T?(p.format=4,h=v*t*3,Z=u._GetRGBArrayBuffer(v,t,W.byteOffset+e,h,W.buffer,s,G,R),V._uploadDataToTextureDirectly(p,Z,d,E)):(p.format=5,h=v*t*4,Z=u._GetRGBAArrayBuffer(v,t,W.byteOffset+e,h,W.buffer,s,G,R,X),V._uploadDataToTextureDirectly(p,Z,d,E));else if(N.isLuminance){const N=V._getUnpackAlignement(),z=v;h=Math.floor((v+N-1)/N)*N*(t-1)+z,Z=u._GetLuminanceArrayBuffer(v,t,W.byteOffset+e,h,W.buffer),p.format=1,p.type=0,V._uploadDataToTextureDirectly(p,Z,d,E)}else h=Math.max(4,v)/4*Math.max(4,t)/4*x,Z=new Uint8Array(W.buffer,W.byteOffset+e,h),p.type=0,V._uploadCompressedDataToTextureDirectly(p,L,v,t,Z,d,E)}e+=T?v*t*(T/8):h,v*=.5,t*=.5,v=Math.max(1,v),t=Math.max(1,t)}if(void 0!==f)break}U&&U.length>0?N.sphericalPolynomial=E.e.ConvertCubeMapToSphericalPolynomial({size:C[4],right:U[0],left:U[1],up:U[2],down:U[3],front:U[4],back:U[5],format:5,type:1,gammaSpace:!1}):N.sphericalPolynomial=void 0}}u.StoreLODInAlphaChannel=!1},11182:(V,p,W)=>{"use strict";W.d(p,{b:()=>E,d:()=>z});const N={},d={};function E(V){const p=V.getClassName();return d[p]||(d[p]={}),d[p]}function z(V){const p=V.getClassName();if(N[p])return N[p];N[p]={};const W=N[p];let E=V,z=p;for(;z;){const V=d[z];for(const d in V)W[d]=V[d];let p,N=!1;do{if(p=Object.getPrototypeOf(E),!p.getClassName){N=!0;break}if(p.getClassName()!==z)break;E=p}while(p);if(N)break;z=p.getClassName(),E=p}return W}},11175:(V,p,W)=>{"use strict";W.d(p,{A:()=>S,D:()=>i,F:()=>l,I:()=>z,d:()=>E,g:()=>F,h:()=>k,k:()=>Q,m:()=>u,n:()=>J,q:()=>f,t:()=>U,u:()=>j,y:()=>O});var N=W(11182);function d(V,p){return(W,d)=>{const E=(0,N.b)(W);E[d]||(E[d]={type:V,sourceName:p})}}function E(V){return function(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(W,N)=>{const d=p||"_"+N;Object.defineProperty(W,N,{get:function(){return this[d]},set:function(p){"function"===typeof this.equals&&this.equals(p)||this[d]!==p&&(this[d]=p,W[V].apply(this))},enumerable:!0,configurable:!0})}}(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function z(V){return d(0,V)}function S(V){return d(1,V)}function Q(V){return d(2,V)}function J(V){return d(3,V)}function i(V){return d(4,V)}function l(V){return d(5,V)}function j(V){return d(6,V)}function k(V){return d(7,V)}function u(V){return d(8,V)}function f(V){return d(9,V)}function O(V){return d(10,V)}function U(V){return d(12,V)}function F(V,p,W,N){const d=W.value;W.value=function(){let W=d;if("undefined"!==typeof _native&&_native[p]){const V=_native[p];W=N?function(){return N(...arguments)?V(...arguments):d(...arguments)}:V}return V[p]=W,W(...arguments)}}F.filter=function(V){return(p,W,N)=>F(p,W,N,V)}},11265:(V,p,W)=>{"use strict";W.d(p,{b:()=>J});var N=W(10887),d=W(11209),E=W(11257),z=W(11218),S=W(11182);const Q=function(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const E=V();d.e&&d.e.HasTags(p)&&d.e.AddTagsTo(E,d.e.GetTags(p,!0));const z=(0,S.d)(E),Q={};for(const d in z){const V=z[d],S=p[d],i=V.type;if(void 0!==S&&null!==S&&("uniqueId"!==d||J.AllowLoadingUniqueId))switch(i){case 0:case 6:case 11:E[d]=S;break;case 1:N.cloneTexturesOnlyOnce&&Q[S.uniqueId]?E[d]=Q[S.uniqueId]:(E[d]=W||S.isRenderTarget?S:S.clone(),Q[S.uniqueId]=E[d]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:E[d]=W?S:S.clone()}}return E};class J{static AppendSerializedAnimations(V,p){if(V.animations){p.animations=[];for(let W=0;W<V.animations.length;W++){const N=V.animations[W];p.animations.push(N.serialize())}}}static Serialize(V,p){p||(p={}),d.e&&(p.tags=d.e.GetTags(V));const W=(0,S.d)(V);for(const N in W){const d=W[N],E=d.sourceName||N,z=d.type,S=V[N];if(void 0!==S&&null!==S&&("uniqueId"!==N||J.AllowLoadingUniqueId))switch(z){case 0:p[E]=S;break;case 1:case 3:case 7:case 9:p[E]=S.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:p[E]=S.Zi();break;case 6:case 11:p[E]=S.id}}return p}static ParseProperties(V,p,W,N){N||(N="");const d=(0,S.d)(p);for(const S in d){const Q=d[S],i=V[Q.sourceName||S],l=Q.type;if(void 0!==i&&null!==i&&("uniqueId"!==S||J.AllowLoadingUniqueId)){const V=p;switch(l){case 0:V[S]=i;break;case 1:W&&(V[S]=J._TextureParser(i,W,N));break;case 2:V[S]=E.c.Tg(i);break;case 3:V[S]=J._FresnelParametersParser(i);break;case 4:V[S]=z.k.Tg(i);break;case 5:V[S]=z.n.Tg(i);break;case 6:W&&(V[S]=W.getLastMeshById(i));break;case 7:V[S]=J._ColorCurvesParser(i);break;case 8:V[S]=E.e.Tg(i);break;case 9:V[S]=J._ImageProcessingConfigurationParser(i);break;case 10:V[S]=z.f.Tg(i);break;case 11:W&&(V[S]=W.getCameraById(i));break;case 12:V[S]=z.e.Tg(i)}}}}static Parse(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const E=V();return d.e&&d.e.AddTagsTo(E,p.tags),J.ParseProperties(p,E,W,N),E}static Clone(V,p){return Q(V,p,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(V,p){return Q(V,p,!0)}}J.AllowLoadingUniqueId=!1,J._ImageProcessingConfigurationParser=V=>{throw(0,N.c)("ImageProcessingConfiguration")},J._FresnelParametersParser=V=>{throw(0,N.c)("FresnelParameters")},J._ColorCurvesParser=V=>{throw(0,N.c)("ColorCurves")},J._TextureParser=(V,p,W)=>{throw(0,N.c)("Texture")}},10874:(V,p,W)=>{"use strict";W.d(p,{d:()=>E});var N=W(10870);const d=(V,p,W)=>V?V.getClassName&&"Mesh"===V.getClassName()?null:!V.getClassName||"SubMesh"!==V.getClassName()&&"PhysicsBody"!==V.getClassName()?V.clone?V.clone():Array.isArray(V)?V.slice():W&&"object"===typeof V?{...V}:null:V.clone(p):null;class E{static DeepCopy(V,p,W,E){let z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const S=function(V){const p=[];do{Object.getOwnPropertyNames(V).forEach((function(V){-1===p.indexOf(V)&&p.push(V)}))}while(V=Object.getPrototypeOf(V));return p}(V);for(const J of S){if("_"===J[0]&&(!E||-1===E.indexOf(J)))continue;if(J.endsWith("Observable"))continue;if(W&&-1!==W.indexOf(J))continue;const S=V[J],i=typeof S;if("function"!==i)try{if("object"===i)if(S instanceof Uint8Array)p[J]=Uint8Array.from(S);else if(S instanceof Array){if(p[J]=[],S.length>0)if("object"==typeof S[0])for(let V=0;V<S.length;V++){const W=d(S[V],p,z);-1===p[J].indexOf(W)&&p[J].push(W)}else p[J]=S.slice(0)}else p[J]=d(S,p,z);else p[J]=S}catch(Q){N.e.Warn(Q.message)}}}}},10887:(V,p,W)=>{"use strict";W.d(p,{c:()=>d});const N={};function d(V){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!N[V])return N[V]=!0,`${V} needs to be imported before as it contains a side-effect required by your code.`}},10862:(V,p,W)=>{"use strict";function N(){return"undefined"!==typeof window}function d(){return"undefined"!==typeof navigator}function E(){return"undefined"!==typeof document}function z(V){let p="",W=V.firstChild;for(;W;)3===W.nodeType&&(p+=W.textContent),W=W.nextSibling;return p}W.d(p,{e:()=>z,g:()=>E,j:()=>d,l:()=>N})},12555:(V,p,W)=>{"use strict";W.r(p),W.d(p,{Dispose:()=>j,DumpData:()=>l,DumpDataAsync:()=>i,DumpFramebuffer:()=>J,DumpTools:()=>k});var N=W(11799),d=W(10848),E=W(11242),z=W(10900);let S,Q=null;async function J(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",E=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0;const S=await W.readPixels(0,0,V,p);l(V,p,new Uint8Array(S.buffer),N,d,E,!0,void 0,z)}function i(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",d=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5],z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7?arguments[7]:void 0;return new Promise((Q=>{l(V,p,W,(V=>Q(V)),N,d,E,z,S)}))}function l(V,p,J,i){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",k=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],f=arguments.length>7&&void 0!==arguments[7]&&arguments[7],O=arguments.length>8?arguments[8]:void 0;(async function(){return Q||(Q=new Promise(((V,p)=>{let d,E=null;const Q={oh:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(W.bind(W,11705)).then((J=>{let{ThinEngine:i}=J;try{d=new OffscreenCanvas(100,100),E=new i(d,!1,Q)}catch(k){d=document.createElement("canvas"),E=new i(d,!1,Q)}z.d.Instances.pop(),z.d.OnEnginesDisposedObservable.add((V=>{E&&V!==E&&!E.u&&0===z.d.Instances.length&&j()})),E.getCaps().parallelShaderCompile=void 0;const l=new N.b(E);W.e(34).then(W.bind(W,13748)).then((W=>{let{passPixelShader:z}=W;if(!E)return void p("Engine is not defined");const Q=new N.d({Ed:E,name:z.name,fragmentShader:z.shader,samplerNames:["textureSampler"]});S={canvas:d,Ed:E,renderer:l,wrapper:Q},V(S)}))})).catch(p)}))),await Q})().then((W=>{if(W.Ed.setSize(V,p,!0),J instanceof Float32Array){const V=new Uint8Array(J.length);let p=J.length;for(;p--;){const W=J[p];V[p]=Math.round(255*(0,E.d)(W))}J=V}const N=W.Ed.createRawTexture(J,V,p,5,!1,!u,1);W.renderer.setViewport(),W.renderer.applyEffectWrapper(W.wrapper),W.wrapper.effect._bindTexture("textureSampler",N),W.renderer.draw(),f?d.e.ToBlob(W.canvas,(V=>{const p=new FileReader;p.onload=V=>{const p=V.target.result;i&&i(p)},p.readAsArrayBuffer(V)}),l,O):d.e.EncodeScreenshotCanvasData(W.canvas,i,l,k,O),N.dispose()}))}function j(){var V;S?(S.wrapper.dispose(),S.renderer.dispose(),S.Ed.dispose()):null===(V=Q)||void 0===V||V.then((V=>{V.wrapper.dispose(),V.renderer.dispose(),V.Ed.dispose()}));Q=null,S=null}const k={DumpData:l,DumpDataAsync:i,DumpFramebuffer:J,Dispose:j};d.e.DumpData=l,d.e.DumpDataAsync=i,d.e.DumpFramebuffer=J},12553:(V,p,W)=>{"use strict";W.d(p,{e:()=>u,h:()=>U,k:()=>A,o:()=>v});var N=W(10848),d=W(11218),E=W(11242),z=W(11757),S=W(10983),Q=W(11454),J=(W(11200),W(11797)),i=W(10870);W(12506),W(12520),W(12555);const l="image/png",j=2,k=[134,22,135,150,246,214,150,54];function u(V){const p=new DataView(V.buffer,V.byteOffset,V.byteLength);let W=0;for(let z=0;z<k.length;z++)if(p.getUint8(W++)!==k[z])return i.e.Error("Not a babylon environment map"),null;let N="",d=0;for(;d=p.getUint8(W++);)N+=String.fromCharCode(d);let E=JSON.parse(N);return E=f(E),E.rh&&(E.rh.specularDataPosition=W,E.rh.lodGenerationScale=E.rh.lodGenerationScale||.8),E}function f(V){if(V.version>j)throw new Error(`Unsupported babylon environment map version "${V.version}". Latest supported version is "${j}".`);return 2===V.version?V:V={...V,version:2,imageType:l}}function O(V,p){const W=(p=f(p)).rh;let N=Math.log2(p.width);if(N=Math.round(N)+1,W.mipmaps.length!==6*N)throw new Error(`Unsupported specular mipmaps number "${W.mipmaps.length}"`);const d=new Array(N);for(let E=0;E<N;E++){d[E]=new Array(6);for(let p=0;p<6;p++){const N=W.mipmaps[6*E+p];d[E][p]=new Uint8Array(V.buffer,V.byteOffset+W.specularDataPosition+N.position,N.length)}}return d}function U(V,p,W){const N=(W=f(W)).rh;if(!N)return Promise.resolve();V._lodGenerationScale=N.lodGenerationScale;return C(V,O(p,W),W.imageType)}function F(V,p,W,N,d,E,z,S,Q,J,i){return new Promise(((l,j)=>{if(W){const W=p.createTexture(null,!0,!0,null,1,null,(V=>{j(V)}),V);null===N||void 0===N||N.onEffectCreatedObservable.addOnce((S=>{S.executeWhenCompiled((()=>{N.externalTextureSamplerBinding=!0,N.onApply=N=>{N._bindTexture("textureSampler",W),N.setFloat2("scale",1,p._features.needsInvertingBitmap&&V instanceof ImageBitmap?-1:1)},p.scenes.length&&(p.scenes[0].postProcessManager.directRender([N],J,!0,E,z),p.restoreDefaultFramebuffer(),W.dispose(),URL.revokeObjectURL(d),l())}))}))}else{if(p._uploadImageToTexture(i,V,E,z),S){const W=Q[z];W&&p._uploadImageToTexture(W._texture,V,E,0)}l()}}))}async function C(V,p){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l;if(!N.e.IsExponentOfTwo(V.width))throw new Error("Texture size must be a power of two");const z=(0,E.j)(V.width)+1,i=V.getEngine();let j=!1,k=!1,u=null,f=null,O=null;const U=i.getCaps();V.format=5,V.type=0,V.generateMipMaps=!0,V._cachedAnisotropicFilteringLevel=null,i.updateTextureSamplingMode(3,V),U.textureLOD?i._features.supportRenderAndCopyToLodForFloatTextures?U.textureHalfFloatRender&&U.textureHalfFloatLinearFiltering?(j=!0,V.type=2):U.textureFloatRender&&U.textureFloatLinearFiltering&&(j=!0,V.type=1):j=!1:(j=!1,k=!0,O={});let C=0;if(j)i.isWebGPU?(C=1,await W.e(39).then(W.bind(W,13771))):await W.e(41).then(W.bind(W,13780)),u=new J.d("rgbdDecode","rgbdDecode",null,null,1,null,3,i,!1,void 0,V.type,void 0,null,!1,void 0,C),V._isRGBD=!1,V.invertY=!1,f=i.createRenderTargetCubeTexture(V.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:V.type,format:5});else if(V._isRGBD=!0,V.invertY=!0,k){const p=3,W=V._lodGenerationScale,N=V._lodGenerationOffset;for(let d=0;d<p;d++){const E=(z-1)*W+N,J=N+(E-N)*(1-d/(p-1)),l=Math.round(Math.min(Math.max(J,0),E)),j=new S.e(i,2);j.isCube=!0,j.invertY=!0,j.generateMipMaps=!1,i.updateTextureSamplingMode(2,j);const k=new Q.c(null);switch(k._isCube=!0,k._texture=j,O[l]=k,d){case 0:V._lodTextureLow=k;break;case 1:V._lodTextureMid=k;break;case 2:V._lodTextureHigh=k}}}const A=[];for(let W=0;W<p.length;W++)for(let N=0;N<6;N++){const E=p[W][N],z=new Blob([E],{type:d}),S=URL.createObjectURL(z);let Q;if(i._features.forceBitmapOverHTMLImageElement)Q=i.createImageBitmap(z,{premultiplyAlpha:"none"}).then((p=>F(p,i,j,u,S,N,W,k,O,f,V)));else{const p=new Image;p.src=S,Q=new Promise(((d,E)=>{p.onload=()=>{F(p,i,j,u,S,N,W,k,O,f,V).then((()=>d())).catch((V=>{E(V)}))},p.onerror=V=>{E(V)}}))}A.push(Q)}if(p.length<z){let W;const N=Math.pow(2,z-1-p.length),d=N*N*4;switch(V.type){case 0:W=new Uint8Array(d);break;case 2:W=new Uint16Array(d);break;case 1:W=new Float32Array(d)}for(let E=p.length;E<z;E++)for(let p=0;p<6;p++)i._uploadArrayBufferViewToTexture(V,W,p,E)}return Promise.all(A).then((()=>{f&&(i._releaseTexture(V),f._swapAndDie(V)),u&&u.dispose(),k&&(V._lodTextureHigh&&V._lodTextureHigh._texture&&(V._lodTextureHigh._texture.isReady=!0),V._lodTextureMid&&V._lodTextureMid._texture&&(V._lodTextureMid._texture.isReady=!0),V._lodTextureLow&&V._lodTextureLow._texture&&(V._lodTextureLow._texture.isReady=!0))}))}function A(V,p){const W=(p=f(p)).irradiance;if(!W)return;const N=new z.i;d.n.FromArrayToRef(W.x,0,N.x),d.n.FromArrayToRef(W.y,0,N.y),d.n.FromArrayToRef(W.z,0,N.z),d.n.FromArrayToRef(W.xx,0,N.xx),d.n.FromArrayToRef(W.yy,0,N.yy),d.n.FromArrayToRef(W.zz,0,N.zz),d.n.FromArrayToRef(W.yz,0,N.yz),d.n.FromArrayToRef(W.zx,0,N.zx),d.n.FromArrayToRef(W.xy,0,N.xy),V._sphericalPolynomial=N}function v(V,p,W,N,d){const E=C(V.getEngine().createRawCubeTexture(null,V.width,V.format,V.type,V.generateMipMaps,V.invertY,V.samplingMode,V._compression),p).then((()=>V));return V.onRebuildCallback=V=>({proxy:E,isReady:!0,isAsync:!0}),V._source=13,V._bufferViewArrayArray=p,V._lodGenerationScale=N,V._lodGenerationOffset=d,V._sphericalPolynomial=W,C(V,p).then((()=>(V.isReady=!0,V)))}},10911:(V,p,W)=>{"use strict";W.d(p,{c:()=>N,g:()=>d,i:()=>E});class N extends Error{}N._setPrototypeOf=Object.setPrototypeOf||((V,p)=>(V.__proto__=p,V));const d={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class E extends N{constructor(V,p,W){super(V),this.errorCode=p,this.innerError=W,this.name="RuntimeError",N._setPrototypeOf(this,E.prototype)}}},10902:(V,p,W)=>{"use strict";W.d(p,{e:()=>x,f:()=>C,h:()=>h,m:()=>Z,i:()=>O,p:()=>t,t:()=>e,v:()=>o,x:()=>A});var N=W(10893),d=W(10862),E=W(10856);class z{}z.FilesToLoad={};var S=W(10911),Q=W(10914),J=W(10923),i=W(10900),l=W(10870),j=W(10935),k=W(10927),u=W(10941);const f=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class O extends S.i{constructor(V,p){super(V,S.g.LoadFileError),this.name="LoadFileError",S.c._setPrototypeOf(this,O.prototype),p instanceof N.e?this.request=p:this.file=p}}class U extends S.i{constructor(V,p){super(V,S.g.RequestFileError),this.request=p,this.name="RequestFileError",S.c._setPrototypeOf(this,U.prototype)}}class F extends S.i{constructor(V,p){super(V,S.g.ReadFileError),this.file=p,this.name="ReadFileError",S.c._setPrototypeOf(this,F.prototype)}}const C={DefaultRetryStrategy:class{static ExponentialBackoff(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(W,N,d)=>0!==N.status||d>=V||-1!==W.indexOf("file:")?-1:Math.pow(2,d)*p}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:V=>V,ScriptBaseUrl:"",ScriptPreprocessUrl:V=>V,CleanUrl:V=>V=V.replace(/#/gm,"%23")},A=(V,p)=>{if((!V||0!==V.indexOf("data:"))&&C.CorsBehavior)if("string"===typeof C.CorsBehavior||C.CorsBehavior instanceof String)p.crossOrigin=C.CorsBehavior;else{const W=C.CorsBehavior(V);W&&(p.crossOrigin=W)}},v={getRequiredSize:null},t=function(V,p,W,d){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",S=arguments.length>5?arguments[5]:void 0;const J=i.d.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===J||void 0===J||!J._features.forceBitmapOverHTMLImageElement))return W("LoadImage is only supported in web or BabylonNative environments."),null;let l,j=!1;V instanceof ArrayBuffer||ArrayBuffer.isView(V)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(l=URL.createObjectURL(new Blob([V],{type:E})),j=!0):l=`data:${E};base64,`+(0,Q.k)(V):V instanceof Blob?(l=URL.createObjectURL(V),j=!0):(l=C.CleanUrl(V),l=C.PreprocessUrl(l));const k=p=>{if(W){const N=l||V.toString();W(`Error while trying to load image: ${0===N.indexOf("http")||N.length<=128?N:N.slice(0,128)+"..."}`,p)}};if(null!==J&&void 0!==J&&J._features.forceBitmapOverHTMLImageElement)return Z(l,(N=>{J.createImageBitmap(new Blob([N],{type:E}),{premultiplyAlpha:"none",...S}).then((V=>{p(V),j&&URL.revokeObjectURL(l)})).catch((p=>{W&&W("Error while trying to load image: "+V,p)}))}),void 0,d||void 0,!0,((V,p)=>{k(p)})),null;const u=new Image;if(v.getRequiredSize){const p=v.getRequiredSize(V);p.width&&(u.width=p.width),p.height&&(u.height=p.height)}A(l,u);const f=[],O=()=>{f.forEach((V=>{V.target.removeEventListener(V.name,V.handler)})),f.length=0};f.push({target:u,name:"load",handler:()=>{O(),p(u),j&&u.src&&URL.revokeObjectURL(u.src)}}),f.push({target:u,name:"error",handler:V=>{O(),k(V),j&&u.src&&URL.revokeObjectURL(u.src)}}),f.push({target:document,name:"securitypolicyviolation",handler:V=>{if(V.blockedURI!==u.src||"Yl"===V.disposition)return;O();const p=new Error(`CSP violation of policy ${V.effectiveDirective} ${V.blockedURI}. Current policy is ${V.originalPolicy}`);i.d.UseFallbackTexture=!1,k(p),j&&u.src&&URL.revokeObjectURL(u.src),u.src=""}}),f.forEach((V=>{V.target.addEventListener(V.name,V.handler)}));const U="blob:"===l.substring(0,5),F="data:"===l.substring(0,5),t=()=>{U||F||!N.e.IsCustomRequestAvailable?u.src=l:Z(l,((V,p,W)=>{const N=new Blob([V],{type:!E&&W?W:E}),d=URL.createObjectURL(N);j=!0,u.src=d}),void 0,d||void 0,!0,((V,p)=>{k(p)}))},e=()=>{d&&d.loadImage(l,u)};if(!U&&!F&&d&&d.enableTexturesOffline)d.open(e,t);else{if(-1!==l.indexOf("file:")){const V=decodeURIComponent(l.substring(5).toLowerCase());if(z.FilesToLoad[V]&&"undefined"!==typeof URL){try{let p;try{p=URL.createObjectURL(z.FilesToLoad[V])}catch(o){p=URL.createObjectURL(z.FilesToLoad[V])}u.src=p,j=!0}catch(K){u.src=""}return u}}t()}return u},e=(V,p,W,N,d)=>{const z=new FileReader,S={onCompleteObservable:new E.b,abort:()=>z.abort()};return z.onloadend=()=>S.onCompleteObservable.notifyObservers(S),d&&(z.onerror=()=>{d(new F(`Unable to read ${V.name}`,V))}),z.onload=V=>{p(V.target.result)},W&&(z.onprogress=W),N?z.readAsArrayBuffer(V):z.readAsText(V),S},Z=(V,p,W,N,d,Q,J)=>{if(V.name)return e(V,p,W,d,Q?V=>{Q(void 0,V)}:void 0);const i=V;if(-1!==i.indexOf("file:")){let V=decodeURIComponent(i.substring(5).toLowerCase());0===V.indexOf("./")&&(V=V.substring(2));const N=z.FilesToLoad[V];if(N)return e(N,p,W,d,Q?V=>Q(void 0,new O(V.message,V.file)):void 0)}const{match:k,type:u}=L(i);if(k){const V={onCompleteObservable:new E.b,abort:()=>()=>{}};try{const V=d?x(i):T(i);p(V,void 0,u)}catch(S){Q?Q(void 0,S):l.e.Error(S.message||"Failed to parse the Data URL")}return j.c.SetImmediate((()=>{V.onCompleteObservable.notifyObservers(V)})),V}return o(i,((V,W)=>{p(V,null===W||void 0===W?void 0:W.responseURL,null===W||void 0===W?void 0:W.getResponseHeader("content-type"))}),W,N,d,Q?V=>{Q(V.request,new O(V.message,V.request))}:void 0,J)},o=(V,p,W,z,S,Q,J)=>{V=C.CleanUrl(V),V=C.PreprocessUrl(V);const i=C.BaseUrl+V;let j=!1;const k={onCompleteObservable:new E.b,abort:()=>j=!0},u=()=>{let V,E=new N.e,z=null;const u=()=>{E&&(W&&E.removeEventListener("progress",W),V&&E.removeEventListener("readystatechange",V),E.removeEventListener("loadend",f))};let f=()=>{u(),k.onCompleteObservable.notifyObservers(k),k.onCompleteObservable.clear(),W=void 0,V=null,f=null,Q=void 0,J=void 0,p=void 0};k.abort=()=>{j=!0,f&&f(),E&&E.readyState!==(XMLHttpRequest.DONE||4)&&E.abort(),null!==z&&(clearTimeout(z),z=null),E=null};const O=V=>{const p=V.message||"Unknown error";Q&&E?Q(new U(p,E)):l.e.Error(p)},F=l=>{if(E){if(E.open("GET",i),J)try{J(E)}catch(k){return void O(k)}S&&(E.responseType="arraybuffer"),W&&E.addEventListener("progress",W),f&&E.addEventListener("loadend",f),V=()=>{if(!j&&E&&E.readyState===(XMLHttpRequest.DONE||4)){if(V&&E.removeEventListener("readystatechange",V),E.status>=200&&E.status<300||0===E.status&&(!(0,d.l)()||K())){try{p&&p(S?E.response:E.responseText,E)}catch(k){O(k)}return}const W=C.DefaultRetryStrategy;if(W){const V=W(i,E,l);if(-1!==V)return u(),E=new N.e,void(z=setTimeout((()=>F(l+1)),V))}const J=new U("Error status: "+E.status+" "+E.statusText+" - Unable to load "+i,E);Q&&Q(J)}},E.addEventListener("readystatechange",V),E.send()}};F(0)};if(z&&z.enableSceneOffline){const N=V=>{V&&V.status>400?Q&&Q(V):u()},d=()=>{z&&z.loadFile(C.BaseUrl+V,(V=>{!j&&p&&p(V),k.onCompleteObservable.notifyObservers(k)}),W?V=>{!j&&W&&W(V)}:void 0,N,S)};z.open(d,N)}else u();return k},K=()=>"undefined"!==typeof location&&"file:"===location.protocol,h=V=>f.test(V),L=V=>{const p=f.exec(V);if(null===p||0===p.length)return{match:!1,type:""};return{match:!0,type:p[0].replace("data:","").replace("base64,","")}};function x(V){return(0,Q.d)(V.split(",")[1])}const T=V=>(0,Q.f)(V.split(",")[1]);let P;u.d._FileToolsLoadImage=t,k.e.loadFile=Z,J.i.loadFile=Z;((V,p,W,N,d,E,z,S,Q,J)=>{P={DecodeBase64UrlToBinary:V,DecodeBase64UrlToString:p,DefaultRetryStrategy:W.DefaultRetryStrategy,BaseUrl:W.BaseUrl,CorsBehavior:W.CorsBehavior,PreprocessUrl:W.PreprocessUrl,IsBase64DataUrl:N,IsFileURL:d,LoadFile:E,LoadImage:z,ReadFile:S,RequestFile:Q,SetCorsBehavior:J},Object.defineProperty(P,"DefaultRetryStrategy",{get:function(){return W.DefaultRetryStrategy},set:function(V){W.DefaultRetryStrategy=V}}),Object.defineProperty(P,"BaseUrl",{get:function(){return W.BaseUrl},set:function(V){W.BaseUrl=V}}),Object.defineProperty(P,"PreprocessUrl",{get:function(){return W.PreprocessUrl},set:function(V){W.PreprocessUrl=V}}),Object.defineProperty(P,"CorsBehavior",{get:function(){return W.CorsBehavior},set:function(V){W.CorsBehavior=V}})})(x,T,C,h,K,Z,t,e,o,A)},11007:(V,p,W)=>{"use strict";function N(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(V=>{const p=16*Math.random()|0;return("x"===V?p:3&p|8).toString(16)}))}W.d(p,{b:()=>N})},11e3:(V,p,W)=>{"use strict";W.d(p,{c:()=>E});var N=W(10870),d=W(11004);class E{static Instantiate(V){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[V])return this.RegisteredExternalClasses[V];const p=(0,d.b)(V);if(p)return p;N.e.Warn(V+" not found, you may have missed an import.");const W=V.split(".");let E=window||this;for(let N=0,d=W.length;N<d;N++)E=E[W[N]];return"function"!==typeof E?null:E}}E.RegisteredExternalClasses={}},10870:(V,p,W)=>{"use strict";W.d(p,{e:()=>N});class N{static _CheckLimit(V,p){let W=N._LogLimitOutputs[V];return W?W.current++:(W={limit:p,current:1},N._LogLimitOutputs[V]=W),W.current<=W.limit}static _GenerateLimitMessage(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const W=N._LogLimitOutputs[V];if(!W||!N.MessageLimitReached)return;const d=this._Levels[p];W.current===W.limit&&N[d.name](N.MessageLimitReached.replace(/%LIMIT%/g,""+W.limit).replace(/%TYPE%/g,d.name??""))}static _AddLogEntry(V){N._LogCache=V+N._LogCache,N.OnNewCacheEntry&&N.OnNewCacheEntry(V)}static _FormatMessage(V){const p=V=>V<10?"0"+V:""+V,W=new Date;return"["+p(W.getHours())+":"+p(W.getMinutes())+":"+p(W.getSeconds())+"]: "+V}static _LogDisabled(V,p){}static _LogEnabled(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;const d=Array.isArray(p)?p[0]:p;if(void 0!==W&&!N._CheckLimit(d,W))return;const E=N._FormatMessage(d),z=this._Levels[V],S=Array.isArray(p)?p.slice(1):[];z.logFunc&&z.logFunc("BJS - "+E,...S);const Q=`<div style='color:${z.color}'>${E}</div><br>`;N._AddLogEntry(Q),N._GenerateLimitMessage(d,V)}static get LogCache(){return N._LogCache}static ClearLogCache(){N._LogCache="",N._LogLimitOutputs={},N.errorsCount=0}static set LogLevels(V){N.Log=N._LogDisabled,N.Warn=N._LogDisabled,N.Error=N._LogDisabled,[N.MessageLogLevel,N.WarningLogLevel,N.ErrorLogLevel].forEach((p=>{if((V&p)===p){const V=this._Levels[p];N[V.name]=N._LogEnabled.bind(N,p)}}))}}N.NoneLogLevel=0,N.MessageLogLevel=1,N.WarningLogLevel=2,N.ErrorLogLevel=4,N.AllLogLevel=7,N.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",N._LogCache="",N._LogLimitOutputs={},N._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],N.errorsCount=0,N.Log=N._LogEnabled.bind(N,N.MessageLogLevel),N.Warn=N._LogEnabled.bind(N,N.WarningLogLevel),N.Error=N._LogEnabled.bind(N,N.ErrorLogLevel)},10856:(V,p,W)=>{"use strict";W.d(p,{b:()=>E});class N{constructor(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0;this.initialize(V,p,W,N)}initialize(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0;return this.mask=V,this.skipNextObservers=p,this.target=W,this.currentTarget=N,this}}class d{constructor(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=V,this.mask=p,this.scope=W,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class E{static FromPromise(V,p){const W=new E;return V.then((V=>{W.notifyObservers(V)})).catch((V=>{if(!p)throw V;p.notifyObservers(V)})),W}get observers(){return this._observers}constructor(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=p,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new N(0),V&&(this._onObserverAdded=V)}add(V){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],W=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!V)return null;const N=new d(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return N.unregisterOnNextCall=W,p?this._observers.unshift(N):this._observers.push(N),this._onObserverAdded&&this._onObserverAdded(N),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(N,this._lastNotifiedValue),N._remove=()=>{this.remove(N)},N}addOnce(V){return this.add(V,void 0,void 0,void 0,!0)}remove(V){if(!V)return!1;V._remove=null;return-1!==this._observers.indexOf(V)&&(this._deferUnregister(V),!0)}removeCallback(V,p){for(let W=0;W<this._observers.length;W++){const N=this._observers[W];if(!N._willBeUnregistered&&(N.callback===V&&(!p||p===N.scope)))return this._deferUnregister(N),!0}return!1}_deferUnregister(V){V._willBeUnregistered||(this._numObserversMarkedAsDeleted++,V.unregisterOnNextCall=!1,V._willBeUnregistered=!0,setTimeout((()=>{this._remove(V)}),0))}_remove(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!V)return!1;const W=this._observers.indexOf(V);return-1!==W&&(p&&this._numObserversMarkedAsDeleted--,this._observers.splice(W,1),!0)}makeObserverTopPriority(V){this._remove(V,!1),this._observers.unshift(V)}makeObserverBottomPriority(V){this._remove(V,!1),this._observers.push(V)}notifyObservers(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,W=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=V),!this._observers.length)return!0;const E=this._eventState;E.mask=p,E.target=W,E.currentTarget=N,E.skipNextObservers=!1,E.lastReturnValue=V,E.userInfo=d;for(const z of this._observers)if(!z._willBeUnregistered&&(z.mask&p&&(z.unregisterOnNextCall&&this._deferUnregister(z),z.scope?E.lastReturnValue=z.callback.apply(z.scope,[V,E]):E.lastReturnValue=z.callback(V,E)),E.skipNextObservers))return!1;return!0}notifyObserver(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=p),V._willBeUnregistered)return;const N=this._eventState;N.mask=W,N.skipNextObservers=!1,V.unregisterOnNextCall&&this._deferUnregister(V),V.callback(p,N)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const V=this._observers.pop();V&&(V._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const V=new E;return V._observers=this._observers.slice(0),V}hasSpecificMask(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const p of this._observers)if(p.mask&V||p.mask===V)return!0;return!1}}},11019:(V,p,W)=>{"use strict";W.d(p,{b:()=>d});var N=W(10882);class d{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(V,p){d.Enabled&&(this._current+=V,p&&this._fetchResult())}beginMonitoring(){d.Enabled&&(this._startMonitoringTime=N.d.Now)}endMonitoring(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!d.Enabled)return;V&&this.fetchNewFrame();const p=N.d.Now;this._current=p-this._startMonitoringTime,V&&this._fetchResult()}Wi(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const V=N.d.Now;V-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=V,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}d.Enabled=!0},10882:(V,p,W)=>{"use strict";W.d(p,{d:()=>d});var N=W(10862);class d{static get Now(){return(0,N.l)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},12506:(V,p,W)=>{"use strict";W.d(p,{e:()=>E});var N=W(11797),d=W(11780);class E{static ExpandRGBDTexture(V){const p=V._texture;if(!p||!V.isRGBD)return;const d=p.getEngine(),E=d.getCaps(),z=p.isReady;let S=!1;E.textureHalfFloatRender&&E.textureHalfFloatLinearFiltering?(S=!0,p.type=2):E.textureFloatRender&&E.textureFloatLinearFiltering&&(S=!0,p.type=1),S&&(p.isReady=!1,p._isRGBD=!1,p.invertY=!1);const Q=async()=>{const E=d.isWebGPU,z=E?1:0;p.isReady=!1,E?await Promise.all([W.e(39).then(W.bind(W,13771)),W.e(40).then(W.bind(W,13773))]):await Promise.all([W.e(41).then(W.bind(W,13780)),W.e(42).then(W.bind(W,13783))]);const S=new N.d("rgbdDecode","rgbdDecode",null,null,1,null,3,d,!1,void 0,p.type,void 0,null,!1,void 0,z);S.externalTextureSamplerBinding=!0;const Q=d.createRenderTargetTexture(p.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:p.samplingMode,type:p.type,format:5});S.onEffectCreatedObservable.addOnce((W=>{W.executeWhenCompiled((()=>{S.onApply=V=>{V._bindTexture("textureSampler",p),V.setFloat2("scale",1,1)},V.va().postProcessManager.directRender([S],Q,!0),d.restoreDefaultFramebuffer(),d._releaseTexture(p),S&&S.dispose(),Q._swapAndDie(p),p.isReady=!0}))}))};S&&(z?Q():V.onLoadObservable.addOnce(Q))}static EncodeTextureToRGBD(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,d.c)("rgbdEncode",V,p,W,1,5)}}},11191:(V,p,W)=>{"use strict";W.d(p,{d:()=>d,f:()=>N});class N{constructor(V){this.length=0,this.data=new Array(V),this._id=N._GlobalId++}push(V){this.data[this.length++]=V,this.length>this.data.length&&(this.data.length*=2)}forEach(V){for(let p=0;p<this.length;p++)V(this.data[p])}sort(V){this.data.sort(V)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(V){if(0!==V.length){this.length+V.length>this.data.length&&(this.data.length=2*(this.length+V.length));for(let p=0;p<V.length;p++)this.data[this.length++]=(V.data||V)[p]}}indexOf(V){const p=this.data.indexOf(V);return p>=this.length?-1:p}contains(V){return-1!==this.indexOf(V)}}N._GlobalId=0;class d extends N{constructor(){super(...arguments),this._duplicateId=0}push(V){super.push(V),V.__smartArrayFlags||(V.__smartArrayFlags={}),V.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(V){return(!V.__smartArrayFlags||V.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(V),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(V){if(0!==V.length){this.length+V.length>this.data.length&&(this.data.length=2*(this.length+V.length));for(let p=0;p<V.length;p++){const W=(V.data||V)[p];this.pushNoDuplicate(W)}}}}},10914:(V,p,W)=>{"use strict";W.d(p,{d:()=>z,f:()=>E,h:()=>N,k:()=>d});const N=V=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(V);let p="";for(let W=0;W<V.byteLength;W++)p+=String.fromCharCode(V[W]);return p},d=V=>{const p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let W,N,d,E,z,S,Q,J="",i=0;const l=ArrayBuffer.isView(V)?new Uint8Array(V.buffer,V.byteOffset,V.byteLength):new Uint8Array(V);for(;i<l.length;)W=l[i++],N=i<l.length?l[i++]:Number.NaN,d=i<l.length?l[i++]:Number.NaN,E=W>>2,z=(3&W)<<4|N>>4,S=(15&N)<<2|d>>6,Q=63&d,isNaN(N)?S=Q=64:isNaN(d)&&(Q=64),J+=p.charAt(E)+p.charAt(z)+p.charAt(S)+p.charAt(Q);return J},E=V=>atob(V),z=V=>{const p=E(V),W=p.length,N=new Uint8Array(new ArrayBuffer(W));for(let d=0;d<W;d++)N[d]=p.charCodeAt(d);return N.buffer}},11209:(V,p,W)=>{"use strict";W.d(p,{e:()=>d});class N{static Eval(V,p){return"true"===(V=V.match(/\([^()]*\)/g)?V.replace(/\([^()]*\)/g,(V=>(V=V.slice(1,V.length-1),N._HandleParenthesisContent(V,p)))):N._HandleParenthesisContent(V,p))||"false"!==V&&N.Eval(V,p)}static _HandleParenthesisContent(V,p){let W;p=p||(V=>"true"===V);const d=V.split("||");for(const E in d)if(Object.prototype.hasOwnProperty.call(d,E)){let V=N._SimplifyNegation(d[E].trim());const z=V.split("&&");if(z.length>1)for(let d=0;d<z.length;++d){const E=N._SimplifyNegation(z[d].trim());if(W="true"!==E&&"false"!==E?"!"===E[0]?!p(E.substring(1)):p(E):"true"===E,!W){V="false";break}}if(W||"true"===V){W=!0;break}W="true"!==V&&"false"!==V?"!"===V[0]?!p(V.substring(1)):p(V):"true"===V}return W?"true":"false"}static _SimplifyNegation(V){return"!true"===(V=(V=V.replace(/^[\s!]+/,(V=>(V=V.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?V="false":"!false"===V&&(V="true"),V}}class d{static EnableFor(V){V._tags=V._tags||{},V.hasTags=()=>d.HasTags(V),V.addTags=p=>d.AddTagsTo(V,p),V.removeTags=p=>d.RemoveTagsFrom(V,p),V.matchesTagsQuery=p=>d.MatchesQuery(V,p)}static DisableFor(V){delete V._tags,delete V.hasTags,delete V.addTags,delete V.removeTags,delete V.matchesTagsQuery}static HasTags(V){if(!V._tags)return!1;const p=V._tags;for(const W in p)if(Object.prototype.hasOwnProperty.call(p,W))return!0;return!1}static GetTags(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!V._tags)return null;if(p){const p=[];for(const W in V._tags)Object.prototype.hasOwnProperty.call(V._tags,W)&&!0===V._tags[W]&&p.push(W);return p.join(" ")}return V._tags}static AddTagsTo(V,p){if(!p)return;if("string"!==typeof p)return;p.split(" ").forEach((function(p){d._AddTagTo(V,p)}))}static _AddTagTo(V,p){""!==(p=p.trim())&&"true"!==p&&"false"!==p&&(p.match(/[\s]/)||p.match(/^([!]|([|]|[&]){2})/)||(d.EnableFor(V),V._tags[p]=!0))}static RemoveTagsFrom(V,p){if(!d.HasTags(V))return;const W=p.split(" ");for(const N in W)d._RemoveTagFrom(V,W[N])}static _RemoveTagFrom(V,p){delete V._tags[p]}static MatchesQuery(V,p){return void 0===p||(""===p?d.HasTags(V):N.Eval(p,(p=>d.HasTags(V)&&V._tags[p])))}}},11780:(V,p,W)=>{"use strict";W.d(p,{c:()=>Q,g:()=>j,j:()=>l});W(11452),W(11789);var N=W(11797),d=W(10941),E=W(11004),z=W(11265);class S extends N.d{getClassName(){return"PassPostProcess"}constructor(V,p){super(V,"pass",null,null,p,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(V,p){V?(this._webGPUReady=!0,p.push(Promise.all([W.e(33).then(W.bind(W,13742))]))):p.push(Promise.all([W.e(34).then(W.bind(W,13748))])),super._gatherImports(V,p)}static _Parse(V,p,W,N){return z.b.Parse((()=>new S(V.name,V.options,p,V.renderTargetSamplingMode,V._engine,V.reusable)),V,W,N)}}(0,E.d)("BABYLON.PassPostProcess",S);N.d;function Q(V,p,W,d,E,z,S,Q){const J=p.getEngine();return p.isReady=!1,E=E??p.samplingMode,d=d??p.type,z=z??p.format,S=S??p.width,Q=Q??p.height,-1===d&&(d=0),new Promise((i=>{const l=new N.d("postprocess",V,null,null,1,null,E,J,!1,void 0,d,void 0,null,!1,z);l.externalTextureSamplerBinding=!0;const j=J.createRenderTargetTexture({width:S,height:Q},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:E,type:d,format:z});l.onEffectCreatedObservable.addOnce((V=>{V.executeWhenCompiled((()=>{l.onApply=V=>{V._bindTexture("textureSampler",p),V.setFloat2("scale",1,1)},W.postProcessManager.directRender([l],j,!0),J.restoreDefaultFramebuffer(),J._releaseTexture(p),l&&l.dispose(),j._swapAndDie(p),p.type=d,p.format=5,p.isReady=!0,i(p)}))}))}))}let J,i;function l(V){J||(J=new Float32Array(1),i=new Int32Array(J.buffer)),J[0]=V;const p=i[0];let W=p>>16&32768,N=p>>12&2047;const d=p>>23&255;return d<103?W:d>142?(W|=31744,W|=(255==d?0:1)&&8388607&p,W):d<113?(N|=2048,W|=(N>>114-d)+(N>>113-d&1),W):(W|=d-112<<10|N>>1,W+=1&N,W)}function j(V){const p=(32768&V)>>15,W=(31744&V)>>10,N=1023&V;return 0===W?(p?-1:1)*Math.pow(2,-14)*(N/Math.pow(2,10)):31==W?N?NaN:1/0*(p?-1:1):(p?-1:1)*Math.pow(2,W-15)*(1+N/Math.pow(2,10))}d.d._RescalePostProcessFactory=V=>new S("rescale",1,null,2,V,!1,0)},10935:(V,p,W)=>{"use strict";W.d(p,{c:()=>d});var N=W(10862);class d{static SetImmediate(V){(0,N.l)()&&window.setImmediate?window.setImmediate(V):setTimeout(V,1)}}},11016:(V,p,W)=>{"use strict";function N(V){let p=1;do{p*=2}while(p<V);return p===V}function d(V,p,W){return V*(1-W)+p*W}function E(V){const p=z(V),W=S(V);return p-V>V-W?W:p}function z(V){return V--,V|=V>>1,V|=V>>2,V|=V>>4,V|=V>>8,V|=V>>16,++V}function S(V){return V|=V>>1,V|=V>>2,V|=V>>4,V|=V>>8,(V|=V>>16)-(V>>1)}function Q(V,p){let W;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:W=S(V);break;case 2:W=E(V);break;default:W=z(V)}return Math.min(W,p)}W.d(p,{e:()=>S,g:()=>Q,i:()=>N,m:()=>d,q:()=>E})},10848:(V,p,W)=>{"use strict";W.d(p,{d:()=>U,e:()=>O});var N=W(10856),d=W(10862),E=W(10870),z=W(10874),S=W(10882),Q=W(10887),J=W(10893),i=W(10900),l=W(10902),j=W(10935),k=W(11e3),u=W(11007),f=W(11016);class O{static get BaseUrl(){return l.f.BaseUrl}static set BaseUrl(V){l.f.BaseUrl=V}static get CleanUrl(){return l.f.CleanUrl}static set CleanUrl(V){l.f.CleanUrl=V}static IsAbsoluteUrl(V){return 0===V.indexOf("//")||-1!==V.indexOf("://")&&(-1!==V.indexOf(".")&&(-1!==V.indexOf("/")&&(!(V.indexOf(":")>V.indexOf("/"))&&(V.indexOf("://")<V.indexOf(".")||(0===V.indexOf("data:")||0===V.indexOf("blob:"))))))}static set ScriptBaseUrl(V){l.f.ScriptBaseUrl=V}static get ScriptBaseUrl(){return l.f.ScriptBaseUrl}static set ScriptPreprocessUrl(V){l.f.ScriptPreprocessUrl=V}static get ScriptPreprocessUrl(){return l.f.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return l.f.DefaultRetryStrategy}static set DefaultRetryStrategy(V){l.f.DefaultRetryStrategy=V}static get CorsBehavior(){return l.f.CorsBehavior}static set CorsBehavior(V){l.f.CorsBehavior=V}static get UseFallbackTexture(){return i.d.UseFallbackTexture}static set UseFallbackTexture(V){i.d.UseFallbackTexture=V}static get RegisteredExternalClasses(){return k.c.RegisteredExternalClasses}static set RegisteredExternalClasses(V){k.c.RegisteredExternalClasses=V}static get fallbackTexture(){return i.d.FallbackTexture}static set fallbackTexture(V){i.d.FallbackTexture=V}static FetchToRef(V,p,W,N,d,E){const z=4*((Math.abs(V)*W%W|0)+(Math.abs(p)*N%N|0)*W);E.r=d[z]/255,E.g=d[z+1]/255,E.b=d[z+2]/255,E.a=d[z+3]/255}static Mix(V,p,W){return 0}static Instantiate(V){return k.c.Instantiate(V)}static SetImmediate(V){j.c.SetImmediate(V)}static IsExponentOfTwo(V){return!0}static FloatRound(V){return Math.fround(V)}static GetFilename(V){const p=V.lastIndexOf("/");return p<0?V:V.substring(p+1)}static GetFolderPath(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const W=V.lastIndexOf("/");return W<0?p?V:"":V.substring(0,W+1)}static ToDegrees(V){return 180*V/Math.PI}static ToRadians(V){return V*Math.PI/180}static SmoothAngleChange(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const N=this.ToRadians(V),d=this.ToRadians(p);return this.ToDegrees(Math.atan2((1-W)*Math.sin(d)+W*Math.sin(N),(1-W)*Math.cos(d)+W*Math.cos(N)))}static MakeArray(V,p){return!0===p||void 0!==V&&null!=V?Array.isArray(V)?V:[V]:null}static GetPointerPrefix(V){return(0,d.l)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(V,p){(0,l.x)(V,p)}static SetReferrerPolicyBehavior(V,p){p.referrerPolicy=V}static get PreprocessUrl(){return l.f.PreprocessUrl}static set PreprocessUrl(V){l.f.PreprocessUrl=V}static LoadImage(V,p,W,N,d,E){return(0,l.p)(V,p,W,N,d,E)}static LoadFile(V,p,W,N,d,E){return(0,l.m)(V,p,W,N,d,E)}static LoadFileAsync(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((W,N)=>{(0,l.m)(V,(V=>{W(V)}),void 0,void 0,p,((V,p)=>{N(p)}))}))}static GetBabylonScriptURL(V,p){if(!V)return"";if(O.ScriptBaseUrl&&V.startsWith(O._DefaultCdnUrl)){const p="/"===O.ScriptBaseUrl[O.ScriptBaseUrl.length-1]?O.ScriptBaseUrl.substring(0,O.ScriptBaseUrl.length-1):O.ScriptBaseUrl;V=V.replace(O._DefaultCdnUrl,p)}return V=O.ScriptPreprocessUrl(V),p&&(V=O.GetAbsoluteUrl(V)),V}static LoadBabylonScript(V,p,W,N){V=O.GetBabylonScriptURL(V),O.LoadScript(V,p,W)}static LoadBabylonScriptAsync(V){return V=O.GetBabylonScriptURL(V),O.LoadScriptAsync(V)}static LoadScript(V,p,W,N){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(V),p&&p()}catch(Q){null===W||void 0===W||W(`Unable to load script '${V}' in worker`,Q)}return}if(!(0,d.l)())return void(null===W||void 0===W||W(`Cannot load script '${V}' outside of a window or a worker`));const z=document.getElementsByTagName("head")[0],S=document.createElement("script");E?(S.setAttribute("type","module"),S.innerText=V):(S.setAttribute("type","text/javascript"),S.setAttribute("src",V)),N&&(S.id=N),S.onload=()=>{p&&p()},S.onerror=p=>{W&&W(`Unable to load script '${V}'`,p)},z.appendChild(S)}static LoadScriptAsync(V,p){return new Promise(((W,N)=>{this.LoadScript(V,(()=>{W()}),((V,p)=>{N(p||new Error(V))}),p)}))}static ReadFileAsDataURL(V,p,W){const d=new FileReader,E={onCompleteObservable:new N.b,abort:()=>d.abort()};return d.onloadend=()=>{E.onCompleteObservable.notifyObservers(E)},d.onload=V=>{p(V.target.result)},d.onprogress=W,d.readAsDataURL(V),E}static ReadFile(V,p,W,N,d){return(0,l.t)(V,p,W,N,d)}static FileAsURL(V){const p=new Blob([V]);return window.URL.createObjectURL(p)}static Format(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return V.toFixed(p)}static DeepCopy(V,p,W,N){z.d.DeepCopy(V,p,W,N)}static IsEmpty(V){for(const p in V)if(Object.prototype.hasOwnProperty.call(V,p))return!1;return!0}static RegisterTopRootEvents(V,p){for(let N=0;N<p.length;N++){const d=p[N];V.addEventListener(d.name,d.handler,!1);try{window.parent&&window.parent.addEventListener(d.name,d.handler,!1)}catch(W){}}}static UnregisterTopRootEvents(V,p){for(let N=0;N<p.length;N++){const d=p[N];V.removeEventListener(d.name,d.handler);try{V.parent&&V.parent.removeEventListener(d.name,d.handler)}catch(W){}}}static async DumpFramebuffer(V,p,W,N){throw(0,Q.c)("DumpTools")}static DumpData(V,p,W,N){throw(0,Q.c)("DumpTools")}static DumpDataAsync(V,p,W){throw(0,Q.c)("DumpTools")}static _IsOffScreenCanvas(V){return void 0!==V.convertToBlob}static ToBlob(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",N=arguments.length>3?arguments[3]:void 0;O._IsOffScreenCanvas(V)||V.toBlob||(V.toBlob=function(V,p,W){setTimeout((()=>{const N=atob(this.toDataURL(p,W).split(",")[1]),d=N.length,E=new Uint8Array(d);for(let V=0;V<d;V++)E[V]=N.charCodeAt(V);V(new Blob([E]))}))}),O._IsOffScreenCanvas(V)?V.convertToBlob({type:W,quality:N}).then((V=>p(V))):V.toBlob((function(V){p(V)}),W,N)}static DownloadBlob(V,p){if("download"in document.createElement("a")){if(!p){const V=new Date;p="screenshot_"+((V.getFullYear()+"-"+(V.getMonth()+1)).slice(2)+"-"+V.getDate()+"_"+V.getHours()+"-"+("0"+V.getMinutes()).slice(-2))+".png"}O.Download(V,p)}else if(V&&"undefined"!==typeof URL){const p=URL.createObjectURL(V),W=window.open("");if(!W)return;const N=W.document.createElement("img");N.onload=function(){URL.revokeObjectURL(p)},N.src=p,W.document.body.appendChild(N)}}static EncodeScreenshotCanvasData(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",N=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0;if("string"!==typeof N&&p){if(p){if(O._IsOffScreenCanvas(V))return void V.convertToBlob({type:W,quality:d}).then((V=>{const W=new FileReader;W.readAsDataURL(V),W.onloadend=()=>{const V=W.result;p(V)}}));const N=V.toDataURL(W,d);p(N)}}else this.ToBlob(V,(function(V){V&&O.DownloadBlob(V,N),p&&p("")}),W,d)}static Download(V,p){if("undefined"===typeof URL)return;const W=window.URL.createObjectURL(V),N=document.createElement("a");document.body.appendChild(N),N.style.display="none",N.href=W,N.download=p,N.addEventListener("click",(()=>{N.parentElement&&N.parentElement.removeChild(N)})),N.click(),window.URL.revokeObjectURL(W)}static BackCompatCameraNoPreventDefault(V){return"boolean"===typeof V[0]?V[0]:"boolean"===typeof V[1]&&V[1]}static CreateScreenshot(V,p,W,N){throw(0,Q.c)("ScreenshotTools")}static CreateScreenshotAsync(V,p,W){throw(0,Q.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(V,p,W,N){throw(0,Q.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(V,p,W){throw(0,Q.c)("ScreenshotTools")}static RandomId(){return(0,u.b)()}static IsBase64(V){return(0,l.h)(V)}static DecodeBase64(V){return(0,l.e)(V)}static get errorsCount(){return E.e.errorsCount}static Log(V){E.e.Log(V)}static Warn(V){E.e.Warn(V)}static Error(V){E.e.Error(V)}static get LogCache(){return E.e.LogCache}static ClearLogCache(){E.e.ClearLogCache()}static set LogLevels(V){E.e.LogLevels=V}static set PerformanceLogLevel(V){return(V&O.PerformanceUserMarkLogLevel)===O.PerformanceUserMarkLogLevel?(O.StartPerformanceCounter=O._StartUserMark,void(O.EndPerformanceCounter=O._EndUserMark)):(V&O.PerformanceConsoleLogLevel)===O.PerformanceConsoleLogLevel?(O.StartPerformanceCounter=O._StartPerformanceConsole,void(O.EndPerformanceCounter=O._EndPerformanceConsole)):(O.StartPerformanceCounter=O._StartPerformanceCounterDisabled,void(O.EndPerformanceCounter=O._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(V,p){}static _EndPerformanceCounterDisabled(V,p){}static _StartUserMark(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!O._Performance){if(!(0,d.l)())return;O._Performance=window.performance}p&&O._Performance.mark&&O._Performance.mark(V+"-Begin")}static _EndUserMark(V){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&O._Performance.mark&&(O._Performance.mark(V+"-End"),O._Performance.measure(V,V+"-Begin",V+"-End"))}static _StartPerformanceConsole(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];p&&(O._StartUserMark(V,p),console.time&&console.time(V))}static _EndPerformanceConsole(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];p&&(O._EndUserMark(V,p),console.timeEnd(V))}static get Now(){return S.d.Now}static GetClassName(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=null;if(!p&&V.getClassName)W=V.getClassName();else{if(V instanceof Object){W=(p?V:Object.getPrototypeOf(V)).constructor.__bjsclassName__}W||(W=typeof V)}return W}static First(V,p){for(const W of V)if(p(W))return W;return null}static getFullClassName(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=null,N=null;if(!p&&V.getClassName)W=V.getClassName();else{if(V instanceof Object){const d=p?V:Object.getPrototypeOf(V);W=d.constructor.__bjsclassName__,N=d.constructor.__bjsmoduleName__}W||(W=typeof V)}return W?(null!=N?N+".":"")+W:null}static DelayAsync(V){return new Promise((p=>{setTimeout((()=>{p()}),V)}))}static IsSafari(){return!!(0,d.j)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}O.UseCustomRequestHeaders=!1,O.CustomRequestHeaders=J.e.CustomRequestHeaders,O.GetDOMTextContent=d.e,O._DefaultCdnUrl="https://cdn.babylonjs.com",O.GetAbsoluteUrl="object"===typeof document?V=>{const p=document.createElement("a");return p.href=V,p.href}:"function"===typeof URL&&"object"===typeof location?V=>new URL(V,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},O.NoneLogLevel=E.e.NoneLogLevel,O.MessageLogLevel=E.e.MessageLogLevel,O.WarningLogLevel=E.e.WarningLogLevel,O.ErrorLogLevel=E.e.ErrorLogLevel,O.AllLogLevel=E.e.AllLogLevel,O.IsWindowObjectExist=d.l,O.PerformanceNoneLogLevel=0,O.PerformanceUserMarkLogLevel=1,O.PerformanceConsoleLogLevel=2,O.StartPerformanceCounter=O._StartPerformanceCounterDisabled,O.EndPerformanceCounter=O._EndPerformanceCounterDisabled;class U{constructor(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=V,this.index=N-1,this._done=!1,this._fn=p,this._successCallback=W}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(V,p,W){const N=new U(V,p,W,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return N.executeNext(),N}static SyncAsyncForLoop(V,p,W,N,d){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return U.Run(Math.ceil(V/p),(N=>{d&&d()?N.breakLoop():setTimeout((()=>{for(let E=0;E<p;++E){const z=N.index*p+E;if(z>=V)break;if(W(z),d&&d()){N.breakLoop();break}}N.executeNext()}),E)}),N)}}O.Mix=f.m,O.IsExponentOfTwo=f.i,i.d.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},11004:(V,p,W)=>{"use strict";W.d(p,{b:()=>E,d:()=>d});const N={};function d(V,p){N[V]=p}function E(V){return N[V]}},11366:(V,p,W)=>{"use strict";W.d(p,{e:()=>N});class N{static get UniqueId(){const V=this._UniqueIdCounter;return this._UniqueIdCounter++,V}}N._UniqueIdCounter=1},10893:(V,p,W)=>{"use strict";W.d(p,{e:()=>N});class N{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(N.CustomRequestHeaders).length>0||N.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const V in N.CustomRequestHeaders){const p=N.CustomRequestHeaders[V];p&&this._xhr.setRequestHeader(V,p)}}_shouldSkipRequestModifications(V){return N.SkipRequestModificationForBabylonCDN&&(V.includes("preview.babylonjs.com")||V.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(V){this._xhr.onprogress=V}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(V){this._xhr.responseType=V}get timeout(){return this._xhr.timeout}set timeout(V){this._xhr.timeout=V}addEventListener(V,p,W){this._xhr.addEventListener(V,p,W)}removeEventListener(V,p,W){this._xhr.removeEventListener(V,p,W)}abort(){this._xhr.abort()}send(V){N.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(V)}open(V,p){for(const W of N.CustomRequestModifiers){if(this._shouldSkipRequestModifications(p))return;W(this._xhr,p)}p=(p=p.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=p,this._xhr.open(V,p,!0)}setRequestHeader(V,p){this._xhr.setRequestHeader(V,p)}getResponseHeader(V){return this._xhr.getResponseHeader(V)}}N.CustomRequestHeaders={},N.CustomRequestModifiers=new Array,N.SkipRequestModificationForBabylonCDN=!0},12587:(V,p,W)=>{"use strict";W.d(p,{e:()=>d});class N{constructor(V){this._pendingActions=new Array,this._workerInfos=V.map((V=>({workerPromise:Promise.resolve(V),idle:!0})))}dispose(){for(const V of this._workerInfos)V.workerPromise.then((V=>{V.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(V){this._executeOnIdleWorker(V)||this._pendingActions.push(V)}_executeOnIdleWorker(V){for(const p of this._workerInfos)if(p.idle)return this._execute(p,V),!0;return!1}_execute(V,p){V.idle=!1,V.workerPromise.then((W=>{p(W,(()=>{const p=this._pendingActions.shift();p?this._execute(V,p):V.idle=!0}))}))}}class d extends N{constructor(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.DefaultOptions;super([]),this._maxWorkers=V,this._createWorkerAsync=p,this._options=W}push(V){if(!this._executeOnIdleWorker(V))if(this._workerInfos.length<this._maxWorkers){const p={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(p),this._execute(p,V)}else this._pendingActions.push(V)}_execute(V,p){V.timeoutId&&(clearTimeout(V.timeoutId),delete V.timeoutId),super._execute(V,((W,N)=>{p(W,(()=>{N(),V.idle&&(V.timeoutId=setTimeout((()=>{V.workerPromise.then((V=>{V.terminate()}));const p=this._workerInfos.indexOf(V);-1!==p&&this._workerInfos.splice(p,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}d.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11689:(V,p,W)=>{"use strict";W.d(p,{d:()=>UV});var N=W(11218),d=W(11442);class E extends d.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var z=W(11257),S=(W(11696),W(11004));class Q{get noiseTexture(){return this._noiseTexture}set noiseTexture(V){this._noiseTexture!==V&&(this._noiseTexture=V,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(V){this._isAnimationSheetEnabled!=V&&(this._isAnimationSheetEnabled=V,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(V){this._useLogarithmicDepth=V&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:N.n.Zero()}set direction1(V){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=V)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:N.n.Zero()}set direction2(V){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=V)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:N.n.Zero()}set minEmitBox(V){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=V)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:N.n.Zero()}set maxEmitBox(V){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=V)}get billboardMode(){return this._billboardMode}set billboardMode(V){this._billboardMode!==V&&(this._billboardMode=V,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(V){this._isBillboardBased!==V&&(this._isBillboardBased=V,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(V){this._attachImageProcessingConfiguration(V)}_attachImageProcessingConfiguration(V){V!==this._imageProcessingConfiguration&&(!V&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=V)}_reset(){}_removeGradientAndTexture(V,p,W){if(!p)return this;let N=0;for(const d of p){if(d.gradient===V){p.splice(N,1);break}N++}return W&&W.dispose(),this}constructor(V){this.animations=[],this.renderingGroupId=0,this.j=N.n.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new N.n(10,10,10),this.onAnimationEnd=null,this.blendMode=Q.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new N.k(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Yf=new N.n(0,0,0),this._useLogarithmicDepth=!1,this.gravity=N.n.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new z.e(1,1,1,1),this.color2=new z.e(1,1,1,1),this.colorDead=new z.e(0,0,0,1),this.textureMask=new z.e(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new E,this.id=V,this.name=V}createPointEmitter(V,p){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new N.n(0,1,0),arguments.length>2&&void 0!==arguments[2]||new N.n(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new N.n(0,1,0),arguments.length>4&&void 0!==arguments[4]||new N.n(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new N.n(0,1,0),arguments.length>3&&void 0!==arguments[3]||new N.n(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(V,p,W,N){throw new Error("Method not implemented.")}}Q.BLENDMODE_ONEONE=0,Q.BLENDMODE_STANDARD=1,Q.BLENDMODE_ADD=2,Q.BLENDMODE_MULTIPLY=3,Q.BLENDMODE_MULTIPLYADD=4,(0,S.d)("BABYLON.BaseParticleSystem",Q);var J=W(11242),i=W(10874);class l{constructor(){this.direction1=new N.n(0,1,0),this.direction2=new N.n(0,1,0),this.minEmitBox=new N.n(-.5,-.5,-.5),this.maxEmitBox=new N.n(.5,.5,.5)}startDirectionFunction(V,p,W,d){const E=(0,J.t)(this.direction1.x,this.direction2.x),z=(0,J.t)(this.direction1.y,this.direction2.y),S=(0,J.t)(this.direction1.z,this.direction2.z);if(d)return p.x=E,p.y=z,void(p.z=S);N.n.TransformNormalFromFloatsToRef(E,z,S,V,p)}startPositionFunction(V,p,W,d){const E=(0,J.t)(this.minEmitBox.x,this.maxEmitBox.x),z=(0,J.t)(this.minEmitBox.y,this.maxEmitBox.y),S=(0,J.t)(this.minEmitBox.z,this.maxEmitBox.z);if(d)return p.x=E,p.y=z,void(p.z=S);N.n.TransformCoordinatesFromFloatsToRef(E,z,S,V,p)}clone(){const V=new l;return i.d.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2),V.setVector3("minEmitBox",this.minEmitBox),V.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3),V.addUniform("minEmitBox",3),V.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.direction1=this.direction1.Zi(),V.direction2=this.direction2.Zi(),V.minEmitBox=this.minEmitBox.Zi(),V.maxEmitBox=this.maxEmitBox.Zi(),V}parse(V){N.n.FromArrayToRef(V.direction1,0,this.direction1),N.n.FromArrayToRef(V.direction2,0,this.direction2),N.n.FromArrayToRef(V.minEmitBox,0,this.minEmitBox),N.n.FromArrayToRef(V.maxEmitBox,0,this.maxEmitBox)}}class j{get radius(){return this._radius}set radius(V){this._radius=V,this._buildHeight()}get angle(){return this._angle}set angle(V){this._angle=V,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=W,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=p,this.radius=V}startDirectionFunction(V,p,W,d){d?N.i.fb[0].p(W.de).normalize():W.position.subtractToRef(V.getTranslation(),N.i.fb[0]).normalize();const E=(0,J.t)(0,this.directionRandomizer),z=(0,J.t)(0,this.directionRandomizer),S=(0,J.t)(0,this.directionRandomizer);p.x=N.i.fb[0].x+E,p.y=N.i.fb[0].y+z,p.z=N.i.fb[0].z+S,p.normalize()}startPositionFunction(V,p,W,d){const E=(0,J.t)(0,2*Math.PI);let z;this.emitFromSpawnPointOnly?z=1e-4:(z=(0,J.t)(0,this.heightRange),z=1-z*z);let S=this._radius-(0,J.t)(0,this._radius*this.radiusRange);S*=z;const Q=S*Math.sin(E),i=S*Math.cos(E),l=z*this._height;if(d)return p.x=Q,p.y=l,void(p.z=i);N.n.TransformCoordinatesFromFloatsToRef(Q,l,i,V,p)}clone(){const V=new j(this._radius,this._angle,this.directionRandomizer);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setFloat2("radius",this._radius,this.radiusRange),V.setFloat("coneAngle",this._angle),V.setFloat2("height",this._height,this.heightRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",2),V.addUniform("coneAngle",1),V.addUniform("height",2),V.addUniform("directionRandomizer",1)}getEffectDefines(){let V="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(V+="\n#define CONEEMITTERSPAWNPOINT"),V}getClassName(){return"ConeParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this._radius,V.angle=this._angle,V.directionRandomizer=this.directionRandomizer,V.radiusRange=this.radiusRange,V.heightRange=this.heightRange,V.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,V}parse(V){this.radius=V.radius,this.angle=V.angle,this.directionRandomizer=V.directionRandomizer,this.radiusRange=void 0!==V.radiusRange?V.radiusRange:1,this.heightRange=void 0!==V.radiusRange?V.heightRange:1,this.emitFromSpawnPointOnly=void 0!==V.emitFromSpawnPointOnly&&V.emitFromSpawnPointOnly}}class k extends j{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.n(0,1,0),d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.n(0,1,0);super(V,p),this.direction1=W,this.direction2=d}startDirectionFunction(V,p){const W=(0,J.t)(this.direction1.x,this.direction2.x),d=(0,J.t)(this.direction1.y,this.direction2.y),E=(0,J.t)(this.direction1.z,this.direction2.z);N.n.TransformNormalFromFloatsToRef(W,d,E,V,p)}clone(){const V=new k(this.radius,this.angle,this.direction1,this.direction2);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.Zi(),V.direction2=this.direction2.Zi(),V}parse(V){super.parse(V),this.direction1.p(V.direction1),this.direction2.p(V.direction2)}}class u{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=V,this.height=p,this.radiusRange=W,this.directionRandomizer=d,this._tempVector=N.n.Zero()}startDirectionFunction(V,p,W,d,E){W.position.subtractToRef(V.getTranslation(),this._tempVector),this._tempVector.normalize(),N.n.TransformNormalToRef(this._tempVector,E,this._tempVector);const z=(0,J.t)(-this.directionRandomizer/2,this.directionRandomizer/2);let S=Math.atan2(this._tempVector.x,this._tempVector.z);S+=(0,J.t)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=z,this._tempVector.x=Math.sin(S),this._tempVector.z=Math.cos(S),this._tempVector.normalize(),d?p.p(this._tempVector):N.n.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,V,p)}startPositionFunction(V,p,W,d){const E=(0,J.t)(-this.height/2,this.height/2),z=(0,J.t)(0,2*Math.PI),S=(0,J.t)((1-this.radiusRange)*(1-this.radiusRange),1),Q=Math.sqrt(S)*this.radius,i=Q*Math.cos(z),l=Q*Math.sin(z);d?p.ge(i,E,l):N.n.TransformCoordinatesFromFloatsToRef(i,E,l,V,p)}clone(){const V=new u(this.radius,this.directionRandomizer);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("height",this.height),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("height",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this.radius,V.height=this.height,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.radius=V.radius,this.height=V.height,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class f extends u{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.n(0,1,0),E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.n(0,1,0);super(V,p,W),this.direction1=d,this.direction2=E}startDirectionFunction(V,p,W,d){const E=(0,J.t)(this.direction1.x,this.direction2.x),z=(0,J.t)(this.direction1.y,this.direction2.y),S=(0,J.t)(this.direction1.z,this.direction2.z);d?p.ge(E,z,S):N.n.TransformNormalFromFloatsToRef(E,z,S,V,p)}clone(){const V=new f(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("height",this.height),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("height",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.Zi(),V.direction2=this.direction2.Zi(),V}parse(V){super.parse(V),N.n.FromArrayToRef(V.direction1,0,this.direction1),N.n.FromArrayToRef(V.direction2,0,this.direction2)}}class O{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=V,this.radiusRange=p,this.directionRandomizer=W}startDirectionFunction(V,p,W,d){const E=W.position.ed(V.getTranslation()).normalize(),z=(0,J.t)(0,this.directionRandomizer),S=(0,J.t)(0,this.directionRandomizer),Q=(0,J.t)(0,this.directionRandomizer);E.x+=z,E.y+=S,E.z+=Q,E.normalize(),d?p.p(E):N.n.TransformNormalFromFloatsToRef(E.x,E.y,E.z,V,p)}startPositionFunction(V,p,W,d){const E=this.radius-(0,J.t)(0,this.radius*this.radiusRange),z=(0,J.t)(0,1),S=(0,J.t)(0,2*Math.PI),Q=Math.acos(2*z-1),i=E*Math.cos(S)*Math.sin(Q),l=E*Math.cos(Q),j=E*Math.sin(S)*Math.sin(Q);d?p.ge(i,Math.abs(l),j):N.n.TransformCoordinatesFromFloatsToRef(i,Math.abs(l),j,V,p)}clone(){const V=new O(this.radius,this.directionRandomizer);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this.radius,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.radius=V.radius,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class U{constructor(){this.direction1=new N.n(0,1,0),this.direction2=new N.n(0,1,0)}startDirectionFunction(V,p,W,d){const E=(0,J.t)(this.direction1.x,this.direction2.x),z=(0,J.t)(this.direction1.y,this.direction2.y),S=(0,J.t)(this.direction1.z,this.direction2.z);d?p.ge(E,z,S):N.n.TransformNormalFromFloatsToRef(E,z,S,V,p)}startPositionFunction(V,p,W,d){d?p.ge(0,0,0):N.n.TransformCoordinatesFromFloatsToRef(0,0,0,V,p)}clone(){const V=new U;return i.d.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.direction1=this.direction1.Zi(),V.direction2=this.direction2.Zi(),V}parse(V){N.n.FromArrayToRef(V.direction1,0,this.direction1),N.n.FromArrayToRef(V.direction2,0,this.direction2)}}class F{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=V,this.radiusRange=p,this.directionRandomizer=W}startDirectionFunction(V,p,W,d){const E=W.position.ed(V.getTranslation()).normalize(),z=(0,J.t)(0,this.directionRandomizer),S=(0,J.t)(0,this.directionRandomizer),Q=(0,J.t)(0,this.directionRandomizer);E.x+=z,E.y+=S,E.z+=Q,E.normalize(),d?p.p(E):N.n.TransformNormalFromFloatsToRef(E.x,E.y,E.z,V,p)}startPositionFunction(V,p,W,d){const E=this.radius-(0,J.t)(0,this.radius*this.radiusRange),z=(0,J.t)(0,1),S=(0,J.t)(0,2*Math.PI),Q=Math.acos(2*z-1),i=E*Math.cos(S)*Math.sin(Q),l=E*Math.cos(Q),j=E*Math.sin(S)*Math.sin(Q);d?p.ge(i,l,j):N.n.TransformCoordinatesFromFloatsToRef(i,l,j,V,p)}clone(){const V=new F(this.radius,this.directionRandomizer);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this.radius,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.radius=V.radius,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class C extends F{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.n(0,1,0),W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.n(0,1,0);super(V),this.direction1=p,this.direction2=W}startDirectionFunction(V,p){const W=(0,J.t)(this.direction1.x,this.direction2.x),d=(0,J.t)(this.direction1.y,this.direction2.y),E=(0,J.t)(this.direction1.z,this.direction2.z);N.n.TransformNormalFromFloatsToRef(W,d,E,V,p)}clone(){const V=new C(this.radius,this.direction1,this.direction2);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.Zi(),V.direction2=this.direction2.Zi(),V}parse(V){super.parse(V),this.direction1.p(V.direction1),this.direction2.p(V.direction2)}}class A{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(V,p,W,d){const E=N.i.fb[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,W,E);const V=N.i.fb[1];E.subtractToRef(W.position,V),V.scaleToRef(1/W.lifeTime,E)}else E.set(0,0,0);d?p.p(E):N.n.TransformNormalToRef(E,V,p)}startPositionFunction(V,p,W,d){const E=N.i.fb[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,W,E):E.set(0,0,0),d?p.p(E):N.n.TransformCoordinatesToRef(E,V,p)}clone(){const V=new A;return i.d.DeepCopy(this,V),V}applyToShader(V){}buildUniformLayout(V){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.particlePositionGenerator=this.particlePositionGenerator,V.particleDestinationGenerator=this.particleDestinationGenerator,V}parse(V){V.particlePositionGenerator&&(this.particlePositionGenerator=V.particlePositionGenerator),V.particleDestinationGenerator&&(this.particleDestinationGenerator=V.particleDestinationGenerator)}}var v=W(11291);class t{get mesh(){return this._mesh}set mesh(V){this._mesh!==V&&(this._mesh=V,V?(this._indices=V.Zf(),this._positions=V.getVerticesData(v.f.PositionKind),this._normals=V.getVerticesData(v.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=N.n.Zero(),this._mesh=null,this.direction1=new N.n(0,1,0),this.direction2=new N.n(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=V}startDirectionFunction(V,p,W,d){if(this.useMeshNormalsForDirection&&this._normals)return void N.n.TransformNormalToRef(this._storedNormal,V,p);const E=(0,J.t)(this.direction1.x,this.direction2.x),z=(0,J.t)(this.direction1.y,this.direction2.y),S=(0,J.t)(this.direction1.z,this.direction2.z);d?p.ge(E,z,S):N.n.TransformNormalFromFloatsToRef(E,z,S,V,p)}startPositionFunction(V,p,W,d){if(!this._indices||!this._positions)return;const E=3*Math.random()*(this._indices.length/3)|0,z=Math.random(),S=Math.random()*(1-z),Q=1-z-S,J=this._indices[E],i=this._indices[E+1],l=this._indices[E+2],j=N.i.fb[0],k=N.i.fb[1],u=N.i.fb[2],f=N.i.fb[3];N.n.FromArrayToRef(this._positions,3*J,j),N.n.FromArrayToRef(this._positions,3*i,k),N.n.FromArrayToRef(this._positions,3*l,u),f.x=z*j.x+S*k.x+Q*u.x,f.y=z*j.y+S*k.y+Q*u.y,f.z=z*j.z+S*k.z+Q*u.z,d?p.ge(f.x,f.y,f.z):N.n.TransformCoordinatesFromFloatsToRef(f.x,f.y,f.z,V,p),this.useMeshNormalsForDirection&&this._normals&&(N.n.FromArrayToRef(this._normals,3*J,j),N.n.FromArrayToRef(this._normals,3*i,k),N.n.FromArrayToRef(this._normals,3*l,u),this._storedNormal.x=z*j.x+S*k.x+Q*u.x,this._storedNormal.y=z*j.y+S*k.y+Q*u.y,this._storedNormal.z=z*j.z+S*k.z+Q*u.z)}clone(){const V=new t(this.mesh);return i.d.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var V;const p={};return p.type=this.getClassName(),p.direction1=this.direction1.Zi(),p.direction2=this.direction2.Zi(),p.meshId=null===(V=this.mesh)||void 0===V?void 0:V.id,p.useMeshNormalsForDirection=this.useMeshNormalsForDirection,p}parse(V,p){N.n.FromArrayToRef(V.direction1,0,this.direction1),N.n.FromArrayToRef(V.direction2,0,this.direction2),V.meshId&&p&&(this.mesh=p.getLastMeshById(V.meshId)),this.useMeshNormalsForDirection=V.useMeshNormalsForDirection}}var e=W(10948);class Z{_isUbo(V){return void 0!==V.addUniform}constructor(V){this._isUbo(V)?(this.setMatrix3x3=V.updateMatrix3x3.bind(V),this.setMatrix2x2=V.updateMatrix2x2.bind(V),this.setFloat=V.updateFloat.bind(V),this.setFloat2=V.updateFloat2.bind(V),this.setFloat3=V.updateFloat3.bind(V),this.setFloat4=V.updateFloat4.bind(V),this.setFloatArray=V.updateFloatArray.bind(V),this.setArray=V.updateArray.bind(V),this.setIntArray=V.updateIntArray.bind(V),this.setMatrix=V.wj.bind(V),this.setMatrices=V.updateMatrices.bind(V),this.setVector3=V.updateVector3.bind(V),this.setVector4=V.updateVector4.bind(V),this.setColor3=V.updateColor3.bind(V),this.setColor4=V.updateColor4.bind(V),this.setDirectColor4=V.updateDirectColor4.bind(V),this.setInt=V.updateInt.bind(V),this.setInt2=V.updateInt2.bind(V),this.setInt3=V.updateInt3.bind(V),this.setInt4=V.updateInt4.bind(V)):(this.setMatrix3x3=V.setMatrix3x3.bind(V),this.setMatrix2x2=V.setMatrix2x2.bind(V),this.setFloat=V.setFloat.bind(V),this.setFloat2=V.setFloat2.bind(V),this.setFloat3=V.setFloat3.bind(V),this.setFloat4=V.setFloat4.bind(V),this.setFloatArray=V.setFloatArray.bind(V),this.setArray=V.setArray.bind(V),this.setIntArray=V.setIntArray.bind(V),this.setMatrix=V.setMatrix.bind(V),this.setMatrices=V.setMatrices.bind(V),this.setVector3=V.setVector3.bind(V),this.setVector4=V.setVector4.bind(V),this.setColor3=V.setColor3.bind(V),this.setColor4=V.setColor4.bind(V),this.setDirectColor4=V.setDirectColor4.bind(V),this.setInt=V.setInt.bind(V),this.setInt2=V.setInt2.bind(V),this.setInt3=V.setInt3.bind(V),this.setInt4=V.setInt4.bind(V))}}var o=W(10952);const K="gpuUpdateParticlesPixelShader",h="#version 300 es\nvoid main() {discard;}\n";o.b.ShadersStore[K]=h;const L="gpuUpdateParticlesVertexShader",x="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";o.b.ShadersStore[L]=x;(0,S.d)("BABYLON.WebGL2ParticleSystem",class{constructor(V,p){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=V,this._engine=p,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var V;return(null===(V=this._updateEffect)||void 0===V?void 0:V.isReady())??!1}createUpdateBuffer(V){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof A&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=V,this._updateEffect=new e.e("gpuUpdateParticles",this._updateEffectOptions,this._engine),new Z(this._updateEffect)}createVertexBuffers(V,p){this._updateVAO.push(this._createUpdateVAO(V)),this._renderVAO.push(this._engine.recordVertexArrayObject(p,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=p}createParticleBuffer(V){return V}bindDrawBuffers(V,p,W){W?this._engine.bindBuffers(this._renderVertexBuffers,W,p):this._engine.bindVertexArrayObject(this._renderVAO[V],null)}preUpdateParticleBuffer(){const V=this._engine;if(this._engine.enableEffect(this._updateEffect),!V.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(V,p,W){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[V],null);const N=this._engine;N.bindTransformFeedbackBuffer(p.getBuffer()),N.setRasterizerState(!1),N.beginTransformFeedback(!0),N.drawArraysType(3,0,W),N.endTransformFeedback(),N.setRasterizerState(!0),N.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let V=0;V<this._updateVAO.length;V++)this._engine.releaseVertexArrayObject(this._updateVAO[V]);this._updateVAO.length=0;for(let V=0;V<this._renderVAO.length;V++)this._engine.releaseVertexArrayObject(this._renderVAO[V]);this._renderVAO.length=0}_createUpdateVAO(V){const p={};p.position=V.createVertexBuffer("position",0,3);let W=3;p.age=V.createVertexBuffer("age",W,1),W+=1,p.size=V.createVertexBuffer("size",W,3),W+=3,p.life=V.createVertexBuffer("life",W,1),W+=1,p.seed=V.createVertexBuffer("seed",W,4),W+=4,p.direction=V.createVertexBuffer("direction",W,3),W+=3,this._parent.particleEmitterType instanceof A&&(p.initialPosition=V.createVertexBuffer("initialPosition",W,3),W+=3),this._parent._colorGradientsTexture||(p.color=V.createVertexBuffer("color",W,4),W+=4),this._parent._isBillboardBased||(p.initialDirection=V.createVertexBuffer("initialDirection",W,3),W+=3),this._parent.noiseTexture&&(p.noiseCoordinates1=V.createVertexBuffer("noiseCoordinates1",W,3),W+=3,p.noiseCoordinates2=V.createVertexBuffer("noiseCoordinates2",W,3),W+=3),this._parent._angularSpeedGradientsTexture?(p.angle=V.createVertexBuffer("angle",W,1),W+=1):(p.angle=V.createVertexBuffer("angle",W,2),W+=2),this._parent._isAnimationSheetEnabled&&(p.cellIndex=V.createVertexBuffer("cellIndex",W,1),W+=1,this._parent.spriteRandomStartCell&&(p.cellStartOffset=V.createVertexBuffer("cellStartOffset",W,1),W+=1));const N=this._engine.recordVertexArrayObject(p,null,this._updateEffect);return this._engine.bindArrayBuffer(null),N}});class T{constructor(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,N=arguments.length>3?arguments[3]:void 0;this._engine=V,this._label=N,this._engine._storageBuffers.push(this),this._create(p,W)}_create(V,p){this._bufferSize=V,this._creationFlags=p,this._buffer=this._engine.createStorageBuffer(V,p,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(V,p,W){this._buffer&&this._engine.updateStorageBuffer(this._buffer,V,p,W)}read(V,p,W,N){return this._engine.readFromStorageBuffer(this._buffer,V,p,W,N)}dispose(){const V=this._engine._storageBuffers,p=V.indexOf(this);-1!==p&&(V[p]=V[V.length-1],V.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var P=W(11167),b=W(11175),s=W(11265),G=W(11452),R=W(11366),X=W(10870),r=W(10990),B=W(11019);class Y{constructor(){this._gpuTimeInFrameId=-1,this.counter=new B.b}_addDuration(V,p){V<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==V?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(p,!1),this._gpuTimeInFrameId=V):this.counter.addCount(p,!1))}}class I{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=V,this._engine=p,this.uniqueId=R.e.UniqueId,p.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new Y),this._engine.getCaps().supportComputeShaders?N.bindingsMapping?(this._context=p.createComputeContext(),this._shaderPath=W,this._options={bindingsMapping:{},defines:[],...N}):X.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):X.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(V,p){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const N=this._bindings[V];this._bindings[V]={type:W?0:4,object:p,indexInGroupEntries:null===N||void 0===N?void 0:N.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!N||N.object!==p||N.type!==this._bindings[V].type)}setStorageTexture(V,p){const W=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==p),this._bindings[V]={type:1,object:p,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setExternalTexture(V,p){const W=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==p),this._bindings[V]={type:6,object:p,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setVideoTexture(V,p){return!!p.externalTexture&&(this.setExternalTexture(V,p.externalTexture),!0)}setUniformBuffer(V,p){const W=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==p),this._bindings[V]={type:I._BufferIsDataBuffer(p)?7:2,object:p,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setStorageBuffer(V,p){const W=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!W||W.object!==p),this._bindings[V]={type:I._BufferIsDataBuffer(p)?7:3,object:p,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}setTextureSampler(V,p){const W=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!W||!p.compareSampler(W.object)),this._bindings[V]={type:5,object:p,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries}}isReady(){let V=this._effect;for(const d in this._bindings){const V=this._bindings[d],p=V.type,W=V.object;switch(p){case 0:case 4:case 1:if(!W.isReady())return!1;break;case 6:if(!W.isReady())return!1;break}}const p=[],W=this._shaderPath;if(this._options.defines)for(let d=0;d<this._options.defines.length;d++)p.push(this._options.defines[d]);const N=p.join("\n");return this._cachedDefines!==N&&(this._cachedDefines=N,V=this._engine.createComputeEffect(W,{defines:N,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=V),!!V.isReady()}dispatch(V,p,W){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,V,p,W,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const W=I._BufferIsDataBuffer(V)?V:V.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,W,p,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const p in this._bindings){const W=this._bindings[p];if(!this._options.bindingsMapping[p])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+p+"'");switch(W.type){case 0:{const N=this._samplers[p],d=W.object;var V;if(!N||!d._texture||!N.compareSampler(d._texture))this._samplers[p]=(new r.b).setParameters(d.wrapU,d.wrapV,d.wrapR,d.anisotropicFilteringLevel,d._texture.samplingMode,null===(V=d._texture)||void 0===V?void 0:V._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const V=W.object;V.getBuffer()!==W.buffer&&(W.buffer=V.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((d=>{const E=()=>{this.dispatch(V,p,W)?d():setTimeout(E,N)};E()}))}serialize(){const V=s.b.Serialize(this);V.options=this._options,V.shaderPath=this._shaderPath,V.mj={},V.textures={};for(const p in this._bindings){const W=this._bindings[p],N=W.object;switch(W.type){case 0:case 4:case 1:{const d=N.serialize();d&&(V.textures[p]=d,V.mj[p]={type:W.type});break}}}return V}static Parse(V,p,W){const N=s.b.Parse((()=>new I(V.name,p.getEngine(),V.shaderPath,V.options)),V,p,W);for(const d in V.textures){const E=V.mj[d],z=G.d.Parse(V.textures[d],p,W);0===E.type?N.setTexture(d,z):4===E.type?N.setTexture(d,z,!1):N.setStorageTexture(d,z)}return N}static _BufferIsDataBuffer(V){return void 0!==V.underlyingResource}}(0,P.c)([(0,b.I)()],I.prototype,"name",void 0),(0,P.c)([(0,b.I)()],I.prototype,"fastMode",void 0),(0,S.d)("BABYLON.ComputeShader",I);var c=W(11278);const q="gpuUpdateParticlesComputeShader",g="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";o.b.ShadersStoreWGSL[q]=g;(0,S.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(V,p){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=V,this._engine=p}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var V;return(null===(V=this._updateComputeShader)||void 0===V?void 0:V.isReady())??!1}createUpdateBuffer(V){var p;const W={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(W.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(W.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(W.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(W.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(W.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(W.noiseTexture={group:1,binding:11}),this._updateComputeShader=new I("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:W,defines:V.split("\n")}),null===(p=this._simParamsComputeShader)||void 0===p||p.dispose(),this._simParamsComputeShader=new c.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new Z(this._simParamsComputeShader)}createVertexBuffers(V,p){this._renderVertexBuffers.push(p)}createParticleBuffer(V){const p=new T(this._engine,4*V.length,11,"ComputeShaderParticleSystemBuffer");return p.update(V),this._bufferComputeShader.push(p),p.getBuffer()}bindDrawBuffers(V,p,W){this._engine.bindBuffers(this._renderVertexBuffers[V],W,p)}preUpdateParticleBuffer(){}updateParticleBuffer(V,p,W){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[V]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^V]),this._updateComputeShader.dispatch(Math.ceil(W/64))}releaseBuffers(){var V;for(let p=0;p<this._bufferComputeShader.length;++p)this._bufferComputeShader[p].dispose();this._bufferComputeShader.length=0,null===(V=this._simParamsComputeShader)||void 0===V||V.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class D{constructor(V,p,W){this.gradient=V,this.color1=p,this.color2=W}getColorToRef(V){this.color2?z.e.LerpToRef(this.color1,this.color2,Math.random(),V):V.p(this.color1)}}class H{constructor(V,p){this.gradient=V,this.color=p}}class m{constructor(V,p,W){this.gradient=V,this.factor1=p,this.factor2=W}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class M{static GetCurrentGradient(V,p,W){if(p[0].gradient>V)return void W(p[0],p[0],1);for(let d=0;d<p.length-1;d++){const N=p[d],E=p[d+1];if(V>=N.gradient&&V<=E.gradient){return void W(N,E,(V-N.gradient)/(E.gradient-N.gradient))}}const N=p.length-1;W(p[N],p[N],1)}}var a=W(10856),y=W(11731),n=W(10900);class w{constructor(V){this.particleSystem=V,this.position=N.n.Zero(),this.direction=N.n.Zero(),this.color=new z.e(0,0,0,0),this.colorStep=new z.e(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new N.k(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new z.e(0,0,0,0),this._currentColor2=new z.e(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=w._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let V=this.age,p=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===p?(p=1,V=this._randomCellOffset):V+=this._randomCellOffset);const W=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let N;N=this._initialSpriteCellLoop?(0,J.d)(V*p%this.lifeTime/this.lifeTime):(0,J.d)(V*p/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+N*W|0}_inheritParticleInfoToSubEmitter(V){if(V.particleSystem.j.position){const p=V.particleSystem.j;if(p.position.p(this.position),V.inheritDirection){const V=N.i.fb[0];this.direction.normalizeToRef(V),p.setDirection(V,0,Math.PI/2)}}else{V.particleSystem.j.p(this.position)}this.direction.scaleToRef(V.inheritedVelocityAmount/2,N.i.fb[0]),V.particleSystem._inheritedVelocityOffset.p(N.i.fb[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((V=>{this._inheritParticleInfoToSubEmitter(V)}))}_reset(){this.age=0,this.id=w._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(V){V.position.p(this.position),this._initialDirection?V._initialDirection?V._initialDirection.p(this._initialDirection):V._initialDirection=this._initialDirection.clone():V._initialDirection=null,V.direction.p(this.direction),this.de&&(V.de?V.de.p(this.de):V.de=this.de.clone()),V.color.p(this.color),V.colorStep.p(this.colorStep),V.lifeTime=this.lifeTime,V.age=this.age,V._randomCellOffset=this._randomCellOffset,V.size=this.size,V.scale.p(this.scale),V.angle=this.angle,V.angularSpeed=this.angularSpeed,V.particleSystem=this.particleSystem,V.cellIndex=this.cellIndex,V.id=this.id,V._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(V._currentColorGradient=this._currentColorGradient,V._currentColor1.p(this._currentColor1),V._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(V._currentSizeGradient=this._currentSizeGradient,V._currentSize1=this._currentSize1,V._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(V._currentAngularSpeedGradient=this._currentAngularSpeedGradient,V._currentAngularSpeed1=this._currentAngularSpeed1,V._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(V._currentVelocityGradient=this._currentVelocityGradient,V._currentVelocity1=this._currentVelocity1,V._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(V._currentLimitVelocityGradient=this._currentLimitVelocityGradient,V._currentLimitVelocity1=this._currentLimitVelocity1,V._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(V._currentDragGradient=this._currentDragGradient,V._currentDrag1=this._currentDrag1,V._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(V._initialStartSpriteCellID=this._initialStartSpriteCellID,V._initialEndSpriteCellID=this._initialEndSpriteCellID,V._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(V.remapData&&this.remapData?V.remapData.p(this.remapData):V.remapData=new N.q(0,0,0,0)),this._randomNoiseCoordinates1&&(V._randomNoiseCoordinates1?(V._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),V._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(V._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),V._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}w._Count=0;var VV=W(11431),pV=(W(11735),W(11436)),WV=W(11434),NV=W(11276);class dV extends Q{set onDispose(V){this._onDisposeObserver&&this.$i.remove(this._onDisposeObserver),this._onDisposeObserver=this.$i.add(V)}get useRampGradients(){return this._useRampGradients}set useRampGradients(V){this._useRampGradients!==V&&(this._useRampGradients=V,this._resetEffect())}get particles(){return this.hj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.hj.length}getClassName(){return"ub"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var V;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(V=this._customWrappers[p])||void 0===V?void 0:V.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[V]??this._customWrappers[0]}setCustomEffect(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[p]=new VV.e(this._engine),this._customWrappers[p].effect=V,this._customWrappers[p].drawContext&&(this._customWrappers[p].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new a.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(V,p,W){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]&&arguments[4],S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(V),this._emitterInverseWorldMatrix=N.e.Identity(),this._inheritedVelocityOffset=new N.n,this.$i=new a.b,this.onStoppedObservable=new a.b,this.hj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new z.e(0,0,0,0),this._colorDiff=new z.e(0,0,0,0),this._scaledDirection=N.n.Zero(),this._scaledGravity=N.n.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=V=>{},this.recycleParticle=V=>{const p=this.hj.pop();p!==V&&p.copyTo(V),this._stockParticles.push(p)},this._createParticle=()=>{let V;return 0!==this._stockParticles.length?(V=this._stockParticles.pop(),V._reset()):V=new w(this),this._prepareParticle(V),V},this._shadersLoaded=!1,this._capacity=p,this._epsilon=S,this._isAnimationSheetEnabled=E,W&&"Scene"!==W.getClassName()?(this._engine=W,this.defaultProjectionMatrix=N.e.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=W||n.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.fj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new VV.e(this._engine)},this._customWrappers[0].effect=d,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new l;let Q=null;this.updateFunction=V=>{let p=null;var W;this.noiseTexture&&(p=this.noiseTexture.getSize(),null===(W=this.noiseTexture.getContent())||void 0===W||W.then((V=>{Q=V})));const d=V===this.hj;for(let E=0;E<V.length;E++){const W=V[E];let S=this._scaledUpdateSpeed;const i=W.age;if(W.age+=S,W.age>W.lifeTime){const V=W.age-i;S=(W.lifeTime-i)*S/V,W.age=W.lifeTime}const l=W.age/W.lifeTime;this._colorGradients&&this._colorGradients.length>0?M.GetCurrentGradient(l,this._colorGradients,((V,p,N)=>{V!==W._currentColorGradient&&(W._currentColor1.p(W._currentColor2),p.getColorToRef(W._currentColor2),W._currentColorGradient=V),z.e.LerpToRef(W._currentColor1,W._currentColor2,N,W.color)})):(W.colorStep.scaleToRef(S,this._scaledColorStep),W.color.addInPlace(this._scaledColorStep),W.color.a<0&&(W.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&M.GetCurrentGradient(l,this._angularSpeedGradients,((V,p,N)=>{V!==W._currentAngularSpeedGradient&&(W._currentAngularSpeed1=W._currentAngularSpeed2,W._currentAngularSpeed2=p.getFactor(),W._currentAngularSpeedGradient=V),W.angularSpeed=(0,J.l)(W._currentAngularSpeed1,W._currentAngularSpeed2,N)})),W.angle+=W.angularSpeed*S;let j=S;if(this._velocityGradients&&this._velocityGradients.length>0&&M.GetCurrentGradient(l,this._velocityGradients,((V,p,N)=>{V!==W._currentVelocityGradient&&(W._currentVelocity1=W._currentVelocity2,W._currentVelocity2=p.getFactor(),W._currentVelocityGradient=V),j*=(0,J.l)(W._currentVelocity1,W._currentVelocity2,N)})),W.direction.scaleToRef(j,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&M.GetCurrentGradient(l,this._limitVelocityGradients,((V,p,N)=>{V!==W._currentLimitVelocityGradient&&(W._currentLimitVelocity1=W._currentLimitVelocity2,W._currentLimitVelocity2=p.getFactor(),W._currentLimitVelocityGradient=V);const d=(0,J.l)(W._currentLimitVelocity1,W._currentLimitVelocity2,N);W.direction.length()>d&&W.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&M.GetCurrentGradient(l,this._dragGradients,((V,p,N)=>{V!==W._currentDragGradient&&(W._currentDrag1=W._currentDrag2,W._currentDrag2=p.getFactor(),W._currentDragGradient=V);const d=(0,J.l)(W._currentDrag1,W._currentDrag2,N);this._scaledDirection.scaleInPlace(1-d)})),this.isLocal&&W.de?(W.de.addInPlace(this._scaledDirection),N.n.TransformCoordinatesToRef(W.de,this._emitterWorldMatrix,W.position)):W.position.addInPlace(this._scaledDirection),Q&&p&&W._randomNoiseCoordinates1){const V=this._fetchR(W._randomNoiseCoordinates1.x,W._randomNoiseCoordinates1.y,p.width,p.height,Q),d=this._fetchR(W._randomNoiseCoordinates1.z,W._randomNoiseCoordinates2.x,p.width,p.height,Q),E=this._fetchR(W._randomNoiseCoordinates2.y,W._randomNoiseCoordinates2.z,p.width,p.height,Q),z=N.i.fb[0],J=N.i.fb[1];z.ge((2*V-1)*this.noiseStrength.x,(2*d-1)*this.noiseStrength.y,(2*E-1)*this.noiseStrength.z),z.scaleToRef(S,J),W.direction.addInPlace(J)}this.gravity.scaleToRef(S,this._scaledGravity),W.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&M.GetCurrentGradient(l,this._sizeGradients,((V,p,N)=>{V!==W._currentSizeGradient&&(W._currentSize1=W._currentSize2,W._currentSize2=p.getFactor(),W._currentSizeGradient=V),W.size=(0,J.l)(W._currentSize1,W._currentSize2,N)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&M.GetCurrentGradient(l,this._colorRemapGradients,((V,p,N)=>{const d=(0,J.l)(V.factor1,p.factor1,N),E=(0,J.l)(V.factor2,p.factor2,N);W.remapData.x=d,W.remapData.y=E-d})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&M.GetCurrentGradient(l,this._alphaRemapGradients,((V,p,N)=>{const d=(0,J.l)(V.factor1,p.factor1,N),E=(0,J.l)(V.factor2,p.factor2,N);W.remapData.z=d,W.remapData.w=E-d}))),this._isAnimationSheetEnabled&&W.updateCellIndex(),W._inheritParticleInfoToSubEmitters(),W.age>=W.lifeTime&&(this._emitFromParticle(W),W._attachedSubEmitters&&(W._attachedSubEmitters.forEach((V=>{V.particleSystem.disposeOnStop=!0,V.particleSystem.stop()})),W._attachedSubEmitters=null),this.recycleParticle(W),d&&E--)}}}serialize(V){throw new Error("Method not implemented.")}clone(V,p){throw new Error("Method not implemented.")}_addFactorGradient(V,p,W,N){const d=new m(p,W,N);V.push(d),V.sort(((V,p)=>V.gradient<p.gradient?-1:V.gradient>p.gradient?1:0))}_removeFactorGradient(V,p){if(!V)return;let W=0;for(const N of V){if(N.gradient===p){V.splice(W,1);break}W++}}addLifeTimeGradient(V,p,W){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,V,p,W),this}removeLifeTimeGradient(V){return this._removeFactorGradient(this._lifeTimeGradients,V),this}addSizeGradient(V,p,W){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,V,p,W),this}removeSizeGradient(V){return this._removeFactorGradient(this._sizeGradients,V),this}addColorRemapGradient(V,p,W){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,V,p,W),this}removeColorRemapGradient(V){return this._removeFactorGradient(this._colorRemapGradients,V),this}addAlphaRemapGradient(V,p,W){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,V,p,W),this}removeAlphaRemapGradient(V){return this._removeFactorGradient(this._alphaRemapGradients,V),this}addAngularSpeedGradient(V,p,W){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,V,p,W),this}removeAngularSpeedGradient(V){return this._removeFactorGradient(this._angularSpeedGradients,V),this}addVelocityGradient(V,p,W){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,V,p,W),this}removeVelocityGradient(V){return this._removeFactorGradient(this._velocityGradients,V),this}addLimitVelocityGradient(V,p,W){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,V,p,W),this}removeLimitVelocityGradient(V){return this._removeFactorGradient(this._limitVelocityGradients,V),this}addDragGradient(V,p,W){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,V,p,W),this}removeDragGradient(V){return this._removeFactorGradient(this._dragGradients,V),this}addEmitRateGradient(V,p,W){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,V,p,W),this}removeEmitRateGradient(V){return this._removeFactorGradient(this._emitRateGradients,V),this}addStartSizeGradient(V,p,W){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,V,p,W),this}removeStartSizeGradient(V){return this._removeFactorGradient(this._startSizeGradients,V),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const V=new Uint8Array(4*this._rawTextureWidth),p=z.g.gb[0];for(let W=0;W<this._rawTextureWidth;W++){const N=W/this._rawTextureWidth;M.GetCurrentGradient(N,this._rampGradients,((N,d,E)=>{z.c.LerpToRef(N.color,d.color,E,p),V[4*W]=255*p.r,V[4*W+1]=255*p.g,V[4*W+2]=255*p.b,V[4*W+3]=255}))}this._rampGradientsTexture=y.d.CreateRGBATexture(V,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((V,p)=>V.gradient<p.gradient?-1:V.gradient>p.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(V,p){this._rampGradients||(this._rampGradients=[]);const W=new H(V,p);return this._rampGradients.push(W),this._syncRampGradientTexture(),this}removeRampGradient(V){return this._removeGradientAndTexture(V,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(V,p,W){this._colorGradients||(this._colorGradients=[]);const N=new D(V,p,W);return this._colorGradients.push(N),this._colorGradients.sort(((V,p)=>V.gradient<p.gradient?-1:V.gradient>p.gradient?1:0)),this}removeColorGradient(V){if(!this._colorGradients)return this;let p=0;for(const W of this._colorGradients){if(W.gradient===V){this._colorGradients.splice(p,1);break}p++}return this}resetDrawCache(){for(const V of this._drawWrappers)if(V)for(const p of V)null===p||void 0===p||p.dispose();this._drawWrappers=[]}_fetchR(V,p,W,N,d){return d[4*(((V=.5*Math.abs(V)+.5)*W%W|0)+((p=.5*Math.abs(p)+.5)*N%N|0)*W)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const V=this._engine,p=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*p),this._vertexBuffer=new v.c(V,this._vertexData,!0,p);let W=0;const N=this._vertexBuffer.createVertexBuffer(v.f.PositionKind,W,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[v.f.PositionKind]=N,W+=3;const d=this._vertexBuffer.createVertexBuffer(v.f.ColorKind,W,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[v.f.ColorKind]=d,W+=4;const E=this._vertexBuffer.createVertexBuffer("angle",W,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=E,W+=1;const z=this._vertexBuffer.createVertexBuffer("size",W,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=z,W+=2,this._isAnimationSheetEnabled){const V=this._vertexBuffer.createVertexBuffer("cellIndex",W,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=V,W+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const V=this._vertexBuffer.createVertexBuffer("direction",W,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=V,W+=3}if(this._useRampGradients){const V=this._vertexBuffer.createVertexBuffer("remapData",W,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=V,W+=4}let S;if(this._useInstancing){const p=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new v.c(V,p,!1,2),S=this._spriteBuffer.createVertexBuffer("offset",0,2)}else S=this._vertexBuffer.createVertexBuffer("offset",W,2,this._vertexBufferSize,this._useInstancing),W+=2;this._vertexBuffers.offset=S,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const V=[],p=[];let W=0;for(let N=0;N<this._capacity;N++)V.push(W),V.push(W+1),V.push(W+2),V.push(W),V.push(W+2),V.push(W+3),p.push(W,W+1,W+1,W+2,W+2,W+3,W+3,W,W,W+3),W+=4;this._indexBuffer=this._engine.createIndexBuffer(V),this._linesIndexBuffer=this._engine.createIndexBuffer(p)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(V)setTimeout((()=>{this.start(0)}),V);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var p;-1!==(null===(p=this.j)||void 0===p?void 0:p.getClassName().indexOf("Mesh"))&&this.j.Dj(!0);const V=this.noiseTexture;if(V&&V.onGeneratedObservable)V.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let p=0;p<this.preWarmCycles;p++)this.animate(!0),V.render()}))}));else for(let p=0;p<this.preWarmCycles;p++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(V))}_postStop(V){}reset(){this._stockParticles.length=0,this.hj.length=0}_appendParticleVertex(V,p,W,d){let E=V*this._vertexBufferSize;if(this._vertexData[E++]=p.position.x+this.Yf.x,this._vertexData[E++]=p.position.y+this.Yf.y,this._vertexData[E++]=p.position.z+this.Yf.z,this._vertexData[E++]=p.color.r,this._vertexData[E++]=p.color.g,this._vertexData[E++]=p.color.b,this._vertexData[E++]=p.color.a,this._vertexData[E++]=p.angle,this._vertexData[E++]=p.scale.x*p.size,this._vertexData[E++]=p.scale.y*p.size,this._isAnimationSheetEnabled&&(this._vertexData[E++]=p.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[E++]=p.direction.x,this._vertexData[E++]=p.direction.y,this._vertexData[E++]=p.direction.z);else if(p._initialDirection){let V=p._initialDirection;this.isLocal&&(N.n.TransformNormalToRef(V,this._emitterWorldMatrix,N.i.fb[0]),V=N.i.fb[0]),0===V.x&&0===V.z&&(V.x=.001),this._vertexData[E++]=V.x,this._vertexData[E++]=V.y,this._vertexData[E++]=V.z}else{let V=p.direction;this.isLocal&&(N.n.TransformNormalToRef(V,this._emitterWorldMatrix,N.i.fb[0]),V=N.i.fb[0]),0===V.x&&0===V.z&&(V.x=.001),this._vertexData[E++]=V.x,this._vertexData[E++]=V.y,this._vertexData[E++]=V.z}this._useRampGradients&&p.remapData&&(this._vertexData[E++]=p.remapData.x,this._vertexData[E++]=p.remapData.y,this._vertexData[E++]=p.remapData.z,this._vertexData[E++]=p.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===W?W=this._epsilon:1===W&&(W=1-this._epsilon),0===d?d=this._epsilon:1===d&&(d=1-this._epsilon)),this._vertexData[E++]=W,this._vertexData[E++]=d)}_prepareParticle(V){}_update(V){if(this._alive=this.hj.length>0,this.j.position){const V=this.j;this._emitterWorldMatrix=V.getWorldMatrix()}else{const V=this.j;this._emitterWorldMatrix=N.e.Translation(V.x,V.y,V.z)}let p;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.hj);for(let W=0;W<V&&this.hj.length!==this._capacity;W++){if(p=this._createParticle(),this.hj.push(p),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const V=(0,J.d)(this._actualFrame/this.targetStopDuration);M.GetCurrentGradient(V,this._lifeTimeGradients,((W,N)=>{const d=W,E=N,z=d.getFactor(),S=E.getFactor(),Q=(V-d.gradient)/(E.gradient-d.gradient);p.lifeTime=(0,J.l)(z,S,Q)}))}else p.lifeTime=(0,J.t)(this.minLifeTime,this.maxLifeTime);const V=(0,J.t)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,p.position,p,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,p.position,p,this.isLocal),this.isLocal&&(p.de?p.de.p(p.position):p.de=p.position.clone(),N.n.TransformCoordinatesToRef(p.de,this._emitterWorldMatrix,p.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,p.direction,p,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,p.direction,p,this.isLocal,this._emitterInverseWorldMatrix),0===V?p._initialDirection?p._initialDirection.p(p.direction):p._initialDirection=p.direction.clone():p._initialDirection=null,p.direction.scaleInPlace(V),this._sizeGradients&&0!==this._sizeGradients.length?(p._currentSizeGradient=this._sizeGradients[0],p._currentSize1=p._currentSizeGradient.getFactor(),p.size=p._currentSize1,this._sizeGradients.length>1?p._currentSize2=this._sizeGradients[1].getFactor():p._currentSize2=p._currentSize1):p.size=(0,J.t)(this.minSize,this.maxSize),p.scale.ge((0,J.t)(this.minScaleX,this.maxScaleX),(0,J.t)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const V=this._actualFrame/this.targetStopDuration;M.GetCurrentGradient(V,this._startSizeGradients,((V,W,N)=>{V!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=W.getFactor(),this._currentStartSizeGradient=V);const d=(0,J.l)(this._currentStartSize1,this._currentStartSize2,N);p.scale.scaleInPlace(d)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(p._currentAngularSpeedGradient=this._angularSpeedGradients[0],p.angularSpeed=p._currentAngularSpeedGradient.getFactor(),p._currentAngularSpeed1=p.angularSpeed,this._angularSpeedGradients.length>1?p._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():p._currentAngularSpeed2=p._currentAngularSpeed1):p.angularSpeed=(0,J.t)(this.minAngularSpeed,this.maxAngularSpeed),p.angle=(0,J.t)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(p._currentVelocityGradient=this._velocityGradients[0],p._currentVelocity1=p._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?p._currentVelocity2=this._velocityGradients[1].getFactor():p._currentVelocity2=p._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(p._currentLimitVelocityGradient=this._limitVelocityGradients[0],p._currentLimitVelocity1=p._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?p._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():p._currentLimitVelocity2=p._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(p._currentDragGradient=this._dragGradients[0],p._currentDrag1=p._currentDragGradient.getFactor(),this._dragGradients.length>1?p._currentDrag2=this._dragGradients[1].getFactor():p._currentDrag2=p._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)p._currentColorGradient=this._colorGradients[0],p._currentColorGradient.getColorToRef(p.color),p._currentColor1.p(p.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(p._currentColor2):p._currentColor2.p(p.color);else{const V=(0,J.t)(0,1);z.e.LerpToRef(this.color1,this.color2,V,p.color),this.colorDead.subtractToRef(p.color,this._colorDiff),this._colorDiff.scaleToRef(1/p.lifeTime,p.colorStep)}this._isAnimationSheetEnabled&&(p._initialStartSpriteCellID=this.startSpriteCellID,p._initialEndSpriteCellID=this.endSpriteCellID,p._initialSpriteCellLoop=this.spriteCellLoop),p.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(p.remapData=new N.q(0,1,0,1)),this.noiseTexture&&(p._randomNoiseCoordinates1?(p._randomNoiseCoordinates1.ge(Math.random(),Math.random(),Math.random()),p._randomNoiseCoordinates2.ge(Math.random(),Math.random(),Math.random())):(p._randomNoiseCoordinates1=new N.n(Math.random(),Math.random(),Math.random()),p._randomNoiseCoordinates2=new N.n(Math.random(),Math.random(),Math.random()))),p._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=[v.f.PositionKind,v.f.ColorKind,"angle","offset","size"];return V&&N.push("cellIndex"),p||N.push("direction"),W&&N.push("remapData"),N}static _GetEffectCreationOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,pV.b)(N),V&&N.push("particlesInfos"),p&&N.push("logarithmicDepthConstant"),W&&(N.push("vFogInfos"),N.push("vFogColor")),N}fillDefines(V,p){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,pV.l)(this,this._scene,V),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&V.push("#define FOG")),this._isAnimationSheetEnabled&&V.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&V.push("#define LOGARITHMICDEPTH"),p===Q.BLENDMODE_MULTIPLY&&V.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&V.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(V.push("#define BILLBOARD"),this.billboardMode){case 2:V.push("#define BILLBOARDY");break;case 8:case 9:V.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&V.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:V.push("#define BILLBOARDMODE_ALL")}W&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),V.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(V,p,W){p.push(...dV._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),V.push(...dV._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),W.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,NV.f)(V,this._imageProcessingConfigurationDefines),(0,NV.e)(W,this._imageProcessingConfigurationDefines))}_getWrapper(V){const p=this._getCustomDrawWrapper(V);if(null!==p&&void 0!==p&&p.effect)return p;const W=[];this.fillDefines(W,V);const N=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let d=this._drawWrappers[N];d||(d=this._drawWrappers[N]=[]);let E=d[V];E||(E=new VV.e(this._engine),E.drawContext&&(E.drawContext.useInstancing=this._useInstancing),d[V]=E);const z=W.join("\n");if(E.defines!==z){const V=[],p=[],W=[];this.fillUniformsAttributesAndSamplerNames(p,V,W),E.setEffect(this._engine.createEffect("particles",V,p,W,z,void 0,void 0,void 0,void 0,this._shaderLanguage),z)}return E}animate(){var V;let p,W=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!W&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(W?this.preWarmStepOffset:(null===(V=this._scene)||void 0===V?void 0:V.getAnimationRatio())||1),this.manualEmitCount>-1)p=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let V=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const p=this._actualFrame/this.targetStopDuration;M.GetCurrentGradient(p,this._emitRateGradients,((p,W,N)=>{p!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=W.getFactor(),this._currentEmitRateGradient=p),V=(0,J.l)(this._currentEmitRate1,this._currentEmitRate2,N)}))}p=V*this._scaledUpdateSpeed|0,this._newPartsExcess+=V*this._scaledUpdateSpeed-p}if(this._newPartsExcess>1&&(p+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?p=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(p),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!W){let V=0;for(let p=0;p<this.hj.length;p++){const W=this.hj[p];this._appendParticleVertices(V,W),V+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.hj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(V,p){this._appendParticleVertex(V++,p,0,0),this._useInstancing||(this._appendParticleVertex(V++,p,1,0),this._appendParticleVertex(V++,p,1,1),this._appendParticleVertex(V++,p,0,1))}rebuild(){var V;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(V=this._spriteBuffer)||void 0===V||V._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!dV.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(W.bind(W,11978)),Promise.resolve().then(W.bind(W,11928))])):await Promise.all([Promise.resolve().then(W.bind(W,11917)),Promise.resolve().then(W.bind(W,11904))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==Q.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Q.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Q.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(V){const p=this._getWrapper(V),W=p.effect,d=this._engine;d.enableEffect(p);const E=this.defaultViewMatrix??this._scene.getViewMatrix();if(W.setTexture("diffuseSampler",this.particleTexture),W.setMatrix("view",E),W.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const V=this.particleTexture.getBaseSize();W.setFloat3("particlesInfos",this.spriteCellWidth/V.width,this.spriteCellHeight/V.height,this.spriteCellWidth/V.width)}if(W.setVector2("translationPivot",this.translationPivot),W.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const V=this._scene.activeCamera;W.setVector3("eyePosition",V.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),W.setTexture("rampSampler",this._rampGradientsTexture));const z=W.defines;var S,J,i,l,j,k;(this._scene&&((0,pV.e)(W,this,this._scene),this.applyFog&&(0,WV.g)(this._scene,void 0,W)),z.indexOf("#define BILLBOARDMODE_ALL")>=0&&(E.invertToRef(N.i.Matrix[0]),W.setMatrix("invView",N.i.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?d.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,W):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,W)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?d.bindBuffers(this._vertexBuffers,null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?this._linesIndexBuffer:this._indexBuffer,W):d.bindBuffers(this._vertexBuffers,null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?this._linesIndexBufferUseInstancing:null,W);switch(this.useLogarithmicDepth&&this._scene&&(0,WV.k)(z,W,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(W),V){case Q.BLENDMODE_ADD:d.setAlphaMode(1);break;case Q.BLENDMODE_ONEONE:d.setAlphaMode(6);break;case Q.BLENDMODE_STANDARD:d.setAlphaMode(2);break;case Q.BLENDMODE_MULTIPLY:d.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(W),this._useInstancing)?null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?d.drawElementsType(6,0,10,this.hj.length):d.drawArraysType(7,0,4,this.hj.length):null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?d.drawElementsType(1,0,10*this.hj.length):d.drawElementsType(0,0,6*this.hj.length);return this.hj.length}render(){if(!this.isReady()||!this.hj.length)return 0;const V=this._engine;V.setState&&(V.setState(!1),this.forceDepthWrite&&V.setDepthWrite(!0));let p=0;return p=this.blendMode===Q.BLENDMODE_MULTIPLYADD?this._render(Q.BLENDMODE_MULTIPLY)+this._render(Q.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),p}_onDispose(){}dispose(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),V&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),V&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(p,W),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const V=this._scene.fj.indexOf(this);V>-1&&this._scene.fj.splice(V,1),this._scene._activeParticleSystems.dispose()}this.$i.notifyObservers(this),this.$i.clear(),this.onStoppedObservable.clear(),this.reset()}}dV.ForceGLSL=!1;var EV,zV=W(10887);!function(V){V[V.ATTACHED=0]="ATTACHED",V[V.END=1]="END"}(EV||(EV={}));class SV{constructor(V){if(this.particleSystem=V,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!V.j||!V.j.dispose){const p=(0,S.b)("BABYLON.AbstractMesh");V.j=new p("SubemitterSystemEmitter",V.va()),V._disposeEmitterOnDispose=!0}}clone(){let V=this.particleSystem.j;if(V){if(V instanceof N.n)V=V.clone();else if(-1!==V.getClassName().indexOf("Mesh")){V=new((0,S.b)("BABYLON.Mesh"))("",V.va()),V.isVisible=!1}}else V=new N.n;const p=new SV(this.particleSystem.clone(this.particleSystem.name,V));return p.particleSystem.name+="Clone",p.type=this.type,p.inheritDirection=this.inheritDirection,p.inheritedVelocityAmount=this.inheritedVelocityAmount,p.particleSystem._disposeEmitterOnDispose=!0,p.particleSystem.disposeOnStop=!0,p}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={};return p.type=this.type,p.inheritDirection=this.inheritDirection,p.inheritedVelocityAmount=this.inheritedVelocityAmount,p.particleSystem=this.particleSystem.serialize(V),p}static _ParseParticleSystem(V,p,W){throw(0,zV.c)("ParseParticle")}static Parse(V,p,W){const N=V.particleSystem,d=new SV(SV._ParseParticleSystem(N,p,W,!0));return d.type=V.type,d.inheritDirection=V.inheritDirection,d.inheritedVelocityAmount=V.inheritedVelocityAmount,d.particleSystem._isSubEmitter=!0,d}dispose(){this.particleSystem.dispose()}}var QV=W(10941);function JV(V,p){const W=new U;return W.direction1=V,W.direction2=p,W}function iV(){return new O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function lV(){return new F(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function jV(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.n(0,1,0),W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.n(0,1,0);return new C(V,p,W)}function kV(){return new u(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function uV(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.n(0,1,0),E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.n(0,1,0);return new f(V,p,W,d,E)}function fV(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new j(V,p)}function OV(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.n(0,1,0),d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.n(0,1,0);return new k(V,p,W,d)}class UV extends dV{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=V=>{if(!this._subEmitters||0===this._subEmitters.length)return;const p=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[p].forEach((p=>{if(1===p.type){const W=p.clone();V._inheritParticleInfoToSubEmitter(W),W.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(W.particleSystem),W.particleSystem.start()}}))}}createPointEmitter(V,p){const W=JV(V,p);return this.particleEmitterType=W,W}createHemisphericEmitter(){const V=iV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createSphereEmitter(){const V=lV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createDirectedSphereEmitter(){const V=jV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.n(0,1,0));return this.particleEmitterType=V,V}createCylinderEmitter(){const V=kV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=V,V}createDirectedCylinderEmitter(){const V=uV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.n(0,1,0));return this.particleEmitterType=V,V}createConeEmitter(){const V=fV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=V,V}createDirectedConeEmitter(){const V=OV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.n(0,1,0));return this.particleEmitterType=V,V}createBoxEmitter(V,p,W,N){const d=new l;return this.particleEmitterType=d,this.direction1=V,this.direction2=p,this.minEmitBox=W,this.maxEmitBox=N,d}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((V=>{V instanceof UV?this._subEmitters.push([new SV(V)]):V instanceof SV?this._subEmitters.push([V]):V instanceof Array&&this._subEmitters.push(V)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((V=>{V.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const V=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==V&&this._rootParticleSystem.activeSubSystems.splice(V,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(V){V&&this._stopSubEmitters()}_prepareParticle(V){if(this._subEmitters&&this._subEmitters.length>0){const p=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];V._attachedSubEmitters=[],p.forEach((p=>{if(0===p.type){const W=p.clone();V._attachedSubEmitters.push(W),W.particleSystem.start()}}))}}_onDispose(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var W;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),V)&&(null===(W=this.particles)||void 0===W||W.forEach((V=>{if(V._attachedSubEmitters)for(let p=V._attachedSubEmitters.length-1;p>=0;p-=1)V._attachedSubEmitters[p].dispose()})));if(p&&this.activeSubSystems)for(let N=this.activeSubSystems.length-1;N>=0;N-=1)this.activeSubSystems[N].dispose();if(this._subEmitters&&this._subEmitters.length){for(let V=0;V<this._subEmitters.length;V++)for(const p of this._subEmitters[V])p.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(V,p,W,d){let E;E=W instanceof QV.d?null:W;const Q=(0,S.b)("BABYLON.Texture");if(Q&&E&&(V.texture?p.particleTexture=Q.Parse(V.texture,E,d):V.textureName&&(p.particleTexture=new Q(d+V.textureName,E,!1,void 0===V.invertY||V.invertY),p.particleTexture.name=V.textureName)),V.emitterId||0===V.emitterId||void 0!==V.j?V.emitterId&&E?p.j=E.getLastMeshById(V.emitterId):p.j=N.n.Tg(V.j):p.j=N.n.Zero(),p.isLocal=!!V.isLocal,void 0!==V.renderingGroupId&&(p.renderingGroupId=V.renderingGroupId),void 0!==V.isBillboardBased&&(p.isBillboardBased=V.isBillboardBased),void 0!==V.billboardMode&&(p.billboardMode=V.billboardMode),void 0!==V.useLogarithmicDepth&&(p.useLogarithmicDepth=V.useLogarithmicDepth),V.animations){for(let W=0;W<V.animations.length;W++){const N=V.animations[W],d=(0,S.b)("BABYLON.Animation");d&&p.animations.push(d.Parse(N))}p.beginAnimationOnStart=V.beginAnimationOnStart,p.beginAnimationFrom=V.beginAnimationFrom,p.beginAnimationTo=V.beginAnimationTo,p.beginAnimationLoop=V.beginAnimationLoop}if(V.autoAnimate&&E&&E.beginAnimation(p,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),p.startDelay=0|V.startDelay,p.minAngularSpeed=V.minAngularSpeed,p.maxAngularSpeed=V.maxAngularSpeed,p.minSize=V.minSize,p.maxSize=V.maxSize,V.minScaleX&&(p.minScaleX=V.minScaleX,p.maxScaleX=V.maxScaleX,p.minScaleY=V.minScaleY,p.maxScaleY=V.maxScaleY),void 0!==V.preWarmCycles&&(p.preWarmCycles=V.preWarmCycles,p.preWarmStepOffset=V.preWarmStepOffset),void 0!==V.minInitialRotation&&(p.minInitialRotation=V.minInitialRotation,p.maxInitialRotation=V.maxInitialRotation),p.minLifeTime=V.minLifeTime,p.maxLifeTime=V.maxLifeTime,p.minEmitPower=V.minEmitPower,p.maxEmitPower=V.maxEmitPower,p.emitRate=V.emitRate,p.gravity=N.n.Tg(V.gravity),V.noiseStrength&&(p.noiseStrength=N.n.Tg(V.noiseStrength)),p.color1=z.e.Tg(V.color1),p.color2=z.e.Tg(V.color2),p.colorDead=z.e.Tg(V.colorDead),p.updateSpeed=V.updateSpeed,p.targetStopDuration=V.targetStopDuration,p.blendMode=V.blendMode,V.colorGradients)for(const N of V.colorGradients)p.addColorGradient(N.gradient,z.e.Tg(N.color1),N.color2?z.e.Tg(N.color2):void 0);if(V.rampGradients){for(const W of V.rampGradients)p.addRampGradient(W.gradient,z.c.Tg(W.color));p.useRampGradients=V.useRampGradients}if(V.colorRemapGradients)for(const N of V.colorRemapGradients)p.addColorRemapGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(V.alphaRemapGradients)for(const N of V.alphaRemapGradients)p.addAlphaRemapGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(V.sizeGradients)for(const N of V.sizeGradients)p.addSizeGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(V.angularSpeedGradients)for(const N of V.angularSpeedGradients)p.addAngularSpeedGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(V.velocityGradients)for(const N of V.velocityGradients)p.addVelocityGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(V.dragGradients)for(const N of V.dragGradients)p.addDragGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(V.emitRateGradients)for(const N of V.emitRateGradients)p.addEmitRateGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(V.startSizeGradients)for(const N of V.startSizeGradients)p.addStartSizeGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(V.lifeTimeGradients)for(const N of V.lifeTimeGradients)p.addLifeTimeGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);if(V.limitVelocityGradients){for(const W of V.limitVelocityGradients)p.addLimitVelocityGradient(W.gradient,void 0!==W.factor1?W.factor1:W.factor,W.factor2);p.limitVelocityDamping=V.limitVelocityDamping}if(V.noiseTexture&&E){const W=(0,S.b)("BABYLON.ProceduralTexture");p.noiseTexture=W.Parse(V.noiseTexture,E,d)}let J;if(V.particleEmitterType){switch(V.particleEmitterType.type){case"SphereParticleEmitter":J=new F;break;case"SphereDirectedParticleEmitter":J=new C;break;case"ConeEmitter":case"ConeParticleEmitter":J=new j;break;case"ConeDirectedParticleEmitter":J=new k;break;case"CylinderParticleEmitter":J=new u;break;case"CylinderDirectedParticleEmitter":J=new f;break;case"HemisphericParticleEmitter":J=new O;break;case"PointParticleEmitter":J=new U;break;case"MeshParticleEmitter":J=new t;break;case"CustomParticleEmitter":J=new A;break;default:J=new l}J.parse(V.particleEmitterType,E)}else J=new l,J.parse(V,E);p.particleEmitterType=J,p.startSpriteCellID=V.startSpriteCellID,p.endSpriteCellID=V.endSpriteCellID,p.spriteCellLoop=V.spriteCellLoop??!0,p.spriteCellWidth=V.spriteCellWidth,p.spriteCellHeight=V.spriteCellHeight,p.spriteCellChangeSpeed=V.spriteCellChangeSpeed,p.spriteRandomStartCell=V.spriteRandomStartCell,p.disposeOnStop=V.disposeOnStop??!1,p.manualEmitCount=V.manualEmitCount??-1}static Parse(V,p,W){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0;const S=V.name;let Q,J,i=null,l=null;if(p instanceof QV.d?Q=p:(J=p,Q=J.getEngine()),V.customShader&&Q.createEffectForParticles){l=V.customShader;const p=l.shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"";i=Q.createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,p)}const j=new UV(S,E||V.ib,p,i,V.isAnimationSheetEnabled);if(j.customShader=l,j._rootUrl=W,V.id&&(j.id=V.id),V.subEmitters){j.subEmitters=[];for(const N of V.subEmitters){const V=[];for(const d of N)V.push(SV.Parse(d,p,W));j.subEmitters.push(V)}}return UV._Parse(V,j,p,W),V.textureMask&&(j.textureMask=z.e.Tg(V.textureMask)),V.Yf&&(j.Yf=N.n.Tg(V.Yf)),V.preventAutoStart&&(j.preventAutoStart=V.preventAutoStart),d||j.preventAutoStart||j.start(),j}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={};if(UV._Serialize(p,this,V),p.textureMask=this.textureMask.Zi(),p.customShader=this.customShader,p.preventAutoStart=this.preventAutoStart,p.Yf=this.Yf.Zi(),this.subEmitters){p.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const W of this._subEmitters){const N=[];for(const p of W)N.push(p.serialize(V));p.subEmitters.push(N)}}return p}static _Serialize(V,p,W){if(V.name=p.name,V.id=p.id,V.ib=p.getCapacity(),V.disposeOnStop=p.disposeOnStop,V.manualEmitCount=p.manualEmitCount,p.j.position){const W=p.j;V.emitterId=W.id}else{const W=p.j;V.j=W.Zi()}p.particleEmitterType&&(V.particleEmitterType=p.particleEmitterType.serialize()),p.particleTexture&&(W?V.texture=p.particleTexture.serialize():(V.textureName=p.particleTexture.name,V.invertY=!!p.particleTexture._invertY)),V.isLocal=p.isLocal,s.b.AppendSerializedAnimations(p,V),V.beginAnimationOnStart=p.beginAnimationOnStart,V.beginAnimationFrom=p.beginAnimationFrom,V.beginAnimationTo=p.beginAnimationTo,V.beginAnimationLoop=p.beginAnimationLoop,V.startDelay=p.startDelay,V.renderingGroupId=p.renderingGroupId,V.isBillboardBased=p.isBillboardBased,V.billboardMode=p.billboardMode,V.minAngularSpeed=p.minAngularSpeed,V.maxAngularSpeed=p.maxAngularSpeed,V.minSize=p.minSize,V.maxSize=p.maxSize,V.minScaleX=p.minScaleX,V.maxScaleX=p.maxScaleX,V.minScaleY=p.minScaleY,V.maxScaleY=p.maxScaleY,V.minEmitPower=p.minEmitPower,V.maxEmitPower=p.maxEmitPower,V.minLifeTime=p.minLifeTime,V.maxLifeTime=p.maxLifeTime,V.emitRate=p.emitRate,V.gravity=p.gravity.Zi(),V.noiseStrength=p.noiseStrength.Zi(),V.color1=p.color1.Zi(),V.color2=p.color2.Zi(),V.colorDead=p.colorDead.Zi(),V.updateSpeed=p.updateSpeed,V.targetStopDuration=p.targetStopDuration,V.blendMode=p.blendMode,V.preWarmCycles=p.preWarmCycles,V.preWarmStepOffset=p.preWarmStepOffset,V.minInitialRotation=p.minInitialRotation,V.maxInitialRotation=p.maxInitialRotation,V.startSpriteCellID=p.startSpriteCellID,V.spriteCellLoop=p.spriteCellLoop,V.endSpriteCellID=p.endSpriteCellID,V.spriteCellChangeSpeed=p.spriteCellChangeSpeed,V.spriteCellWidth=p.spriteCellWidth,V.spriteCellHeight=p.spriteCellHeight,V.spriteRandomStartCell=p.spriteRandomStartCell,V.isAnimationSheetEnabled=p.isAnimationSheetEnabled,V.useLogarithmicDepth=p.useLogarithmicDepth;const N=p.getColorGradients();if(N){V.colorGradients=[];for(const p of N){const W={gradient:p.gradient,color1:p.color1.Zi()};p.color2?W.color2=p.color2.Zi():W.color2=p.color1.Zi(),V.colorGradients.push(W)}}const d=p.getRampGradients();if(d){V.rampGradients=[];for(const p of d){const W={gradient:p.gradient,color:p.color.Zi()};V.rampGradients.push(W)}V.useRampGradients=p.useRampGradients}const E=p.getColorRemapGradients();if(E){V.colorRemapGradients=[];for(const p of E){const W={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?W.factor2=p.factor2:W.factor2=p.factor1,V.colorRemapGradients.push(W)}}const z=p.getAlphaRemapGradients();if(z){V.alphaRemapGradients=[];for(const p of z){const W={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?W.factor2=p.factor2:W.factor2=p.factor1,V.alphaRemapGradients.push(W)}}const S=p.getSizeGradients();if(S){V.sizeGradients=[];for(const p of S){const W={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?W.factor2=p.factor2:W.factor2=p.factor1,V.sizeGradients.push(W)}}const Q=p.getAngularSpeedGradients();if(Q){V.angularSpeedGradients=[];for(const p of Q){const W={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?W.factor2=p.factor2:W.factor2=p.factor1,V.angularSpeedGradients.push(W)}}const J=p.getVelocityGradients();if(J){V.velocityGradients=[];for(const p of J){const W={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?W.factor2=p.factor2:W.factor2=p.factor1,V.velocityGradients.push(W)}}const i=p.getDragGradients();if(i){V.dragGradients=[];for(const p of i){const W={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?W.factor2=p.factor2:W.factor2=p.factor1,V.dragGradients.push(W)}}const l=p.getEmitRateGradients();if(l){V.emitRateGradients=[];for(const p of l){const W={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?W.factor2=p.factor2:W.factor2=p.factor1,V.emitRateGradients.push(W)}}const j=p.getStartSizeGradients();if(j){V.startSizeGradients=[];for(const p of j){const W={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?W.factor2=p.factor2:W.factor2=p.factor1,V.startSizeGradients.push(W)}}const k=p.getLifeTimeGradients();if(k){V.lifeTimeGradients=[];for(const p of k){const W={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?W.factor2=p.factor2:W.factor2=p.factor1,V.lifeTimeGradients.push(W)}}const u=p.getLimitVelocityGradients();if(u){V.limitVelocityGradients=[];for(const p of u){const W={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?W.factor2=p.factor2:W.factor2=p.factor1,V.limitVelocityGradients.push(W)}V.limitVelocityDamping=p.limitVelocityDamping}p.noiseTexture&&(V.noiseTexture=p.noiseTexture.serialize())}clone(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N={...this._customWrappers};let d=null;const E=this._engine;if(E.createEffectForParticles&&null!=this.customShader){d=this.customShader;const V=d.shaderOptions.defines.length>0?d.shaderOptions.defines.join("\n"):"",p=E.createEffectForParticles(d.shaderPath.fragmentElement,d.shaderOptions.uniforms,d.shaderOptions.samplers,V);N[0]?N[0].effect=p:this.setCustomEffect(p,0)}const z=this.serialize(W),S=UV.Parse(z,this._scene||this._engine,this._rootUrl);return S.name=V,S.customShader=d,S._customWrappers=N,void 0===p&&(p=this.j),this.noiseTexture&&(S.noiseTexture=this.noiseTexture.clone()),S.j=p,this.preventAutoStart||S.start(),S}}UV.BILLBOARDMODE_Y=2,UV.BILLBOARDMODE_ALL=7,UV.BILLBOARDMODE_STRETCHED=8,UV.BILLBOARDMODE_STRETCHED_LOCAL=9,SV._ParseParticleSystem=UV.Parse;var FV=W(11251),CV=W(11200),AV=W(11739);AV.d.prototype.createTransformFeedback=function(){const V=this._gl.createTransformFeedback();if(!V)throw new Error("Unable to create Transform Feedback");return V},AV.d.prototype.deleteTransformFeedback=function(V){this._gl.deleteTransformFeedback(V)},AV.d.prototype.bindTransformFeedback=function(V){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,V)},AV.d.prototype.beginTransformFeedback=function(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(V?this._gl.POINTS:this._gl.TRIANGLES)},AV.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},AV.d.prototype.setTranformFeedbackVaryings=function(V,p){this._gl.transformFeedbackVaryings(V,p,this._gl.INTERLEAVED_ATTRIBS)},AV.d.prototype.bindTransformFeedbackBuffer=function(V){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,V?V.underlyingResource:null)},AV.d.prototype.readTransformFeedbackBuffer=function(V){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,V)};const vV="clipPlaneFragmentDeclaration2",tV="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";o.b.IncludesShadersStore[vV]=tV;W(11824),W(11828),W(11835),W(11841),W(11843),W(11847),W(11856),W(11860);const eV="gpuRenderParticlesPixelShader",ZV="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";o.b.ShadersStore[eV]=ZV;const oV="clipPlaneVertexDeclaration2",KV="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";o.b.IncludesShadersStore[oV]=KV;W(11868),W(11870),W(11874),W(11880);const hV="gpuRenderParticlesVertexShader",LV="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";o.b.ShadersStore[hV]=LV;class xV extends Q{static get IsSupported(){if(!n.d.LastCreatedEngine)return!1;const V=n.d.LastCreatedEngine.getCaps();return V.supportTransformFeedbacks||V.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(V){this._maxActiveParticleCount=Math.min(V,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(V){this.maxActiveParticleCount=V}createPointEmitter(V,p){const W=JV(V,p);return this.particleEmitterType=W,W}createHemisphericEmitter(){const V=iV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createSphereEmitter(){const V=lV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createDirectedSphereEmitter(){const V=jV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.n(0,1,0));return this.particleEmitterType=V,V}createCylinderEmitter(){const V=kV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=V,V}createDirectedCylinderEmitter(){const V=uV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new N.n(0,1,0));return this.particleEmitterType=V,V}createConeEmitter(){const V=fV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=V,V}createDirectedConeEmitter(){const V=OV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new N.n(0,1,0));return this.particleEmitterType=V,V}createBoxEmitter(V,p,W,N){const d=new l;return this.particleEmitterType=d,this.direction1=V,this.direction2=p,this.minEmitBox=W,this.maxEmitBox=N,d}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==UV.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(UV.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(UV.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";V?setTimeout((()=>{this.start(0)}),V):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var V;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(V=this._customWrappers[p])||void 0===V?void 0:V.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[V]??this._customWrappers[0]}setCustomEffect(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[p]=new VV.e(this._engine),this._customWrappers[p].effect=V}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new a.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(V,p,W){return super._removeGradientAndTexture(V,p,W),this._releaseBuffers(),this}addColorGradient(V,p){this._colorGradients||(this._colorGradients=[]);const W=new D(V,p);return this._colorGradients.push(W),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(V&&this._colorGradients.sort(((V,p)=>V.gradient<p.gradient?-1:V.gradient>p.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(V){return this._removeGradientAndTexture(V,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const p in this._drawWrappers){var V;null===(V=this._drawWrappers[p].drawContext)||void 0===V||V.reset()}}_addFactorGradient(V,p,W){const N=new m(p,W);V.push(N),this._releaseBuffers()}addSizeGradient(V,p){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,V,p),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(V){return this._removeGradientAndTexture(V,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(V,p){if(!V)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&V.sort(((V,p)=>V.gradient<p.gradient?-1:V.gradient>p.gradient?1:0));const W=this;W[p]&&(W[p].dispose(),W[p]=null)}addAngularSpeedGradient(V,p){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,V,p),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(V){return this._removeGradientAndTexture(V,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(V,p){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,V,p),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(V){return this._removeGradientAndTexture(V,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(V,p){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,V,p),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(V){return this._removeGradientAndTexture(V,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(V,p){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,V,p),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(V){return this._removeGradientAndTexture(V,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(V){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(V,p,W){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(V),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.$i=new a.b,this.onStoppedObservable=new a.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,W&&"Scene"!==W.getClassName()?(this._engine=W,this.defaultProjectionMatrix=N.e.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=W||n.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.fj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,S.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,S.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,S.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,S.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new VV.e(this._engine)},this._customWrappers[0].effect=d,this._drawWrappers={0:new VV.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(p=p??{}).randomTextureSize||delete p.randomTextureSize;const z={ib:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...p},Q=p;isFinite(Q)&&(z.ib=Q),this._capacity=z.ib,this._maxActiveParticleCount=z.ib,this._currentActiveCount=0,this._isAnimationSheetEnabled=E,this.particleEmitterType=new l;const J=Math.min(this._engine.getCaps().maxTextureSize,z.randomTextureSize);let i=[];for(let N=0;N<J;++N)i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random());this._randomTexture=new y.d(new Float32Array(i),J,1,5,W,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,i=[];for(let N=0;N<J;++N)i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random());this._randomTexture2=new y.d(new Float32Array(i),J,1,5,W,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=J}_reset(){this._releaseBuffers()}_createVertexBuffers(V,p,W){const N={};N.position=p.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let d=3;N.age=p.createVertexBuffer("age",d,1,this._attributesStrideSize,!0),d+=1,N.size=p.createVertexBuffer("size",d,3,this._attributesStrideSize,!0),d+=3,N.life=p.createVertexBuffer("life",d,1,this._attributesStrideSize,!0),d+=1,d+=4,this.billboardMode===UV.BILLBOARDMODE_STRETCHED&&(N.direction=p.createVertexBuffer("direction",d,3,this._attributesStrideSize,!0)),d+=3,this._platform.alignDataInBuffer&&(d+=1),this.particleEmitterType instanceof A&&(d+=3,this._platform.alignDataInBuffer&&(d+=1)),this._colorGradientsTexture||(N.color=p.createVertexBuffer("color",d,4,this._attributesStrideSize,!0),d+=4),this._isBillboardBased||(N.initialDirection=p.createVertexBuffer("initialDirection",d,3,this._attributesStrideSize,!0),d+=3,this._platform.alignDataInBuffer&&(d+=1)),this.noiseTexture&&(N.noiseCoordinates1=p.createVertexBuffer("noiseCoordinates1",d,3,this._attributesStrideSize,!0),d+=3,this._platform.alignDataInBuffer&&(d+=1),N.noiseCoordinates2=p.createVertexBuffer("noiseCoordinates2",d,3,this._attributesStrideSize,!0),d+=3,this._platform.alignDataInBuffer&&(d+=1)),N.angle=p.createVertexBuffer("angle",d,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?d++:d+=2,this._isAnimationSheetEnabled&&(N.cellIndex=p.createVertexBuffer("cellIndex",d,1,this._attributesStrideSize,!0),d+=1,this.spriteRandomStartCell&&(N.cellStartOffset=p.createVertexBuffer("cellStartOffset",d,1,this._attributesStrideSize,!0),d+=1)),N.offset=W.createVertexBuffer("offset",0,2),N.uv=W.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(N),this._platform.createVertexBuffers(V,N),this.resetDrawCache()}_initialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!V)return;const p=this._engine,W=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof A&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const d=this.particleEmitterType instanceof A,E=N.i.fb[0];let z=0;for(let N=0;N<this._capacity;N++)if(W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(0),W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),d?(this.particleEmitterType.particleDestinationGenerator(N,null,E),W.push(E.x),W.push(E.y),W.push(E.z)):(W.push(0),W.push(0),W.push(0)),this._platform.alignDataInBuffer&&W.push(0),z+=16,d&&(this.particleEmitterType.particlePositionGenerator(N,null,E),W.push(E.x),W.push(E.y),W.push(E.z),this._platform.alignDataInBuffer&&W.push(0),z+=4),this._colorGradientsTexture||(W.push(0),W.push(0),W.push(0),W.push(0),z+=4),this.isBillboardBased||(W.push(0),W.push(0),W.push(0),this._platform.alignDataInBuffer&&W.push(0),z+=4),this.noiseTexture&&(W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),this._platform.alignDataInBuffer&&W.push(0),W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),this._platform.alignDataInBuffer&&W.push(0),z+=8),W.push(0),z+=1,this._angularSpeedGradientsTexture||(W.push(0),z+=1),this._isAnimationSheetEnabled&&(W.push(0),z+=1,this.spriteRandomStartCell&&(W.push(0),z+=1)),this._platform.alignDataInBuffer){let V=3-(z+3&3);for(z+=V;V-- >0;)W.push(0)}const S=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),Q=this._platform.createParticleBuffer(W),J=this._platform.createParticleBuffer(W);this._buffer0=new v.c(p,Q,!1,this._attributesStrideSize),this._buffer1=new v.c(p,J,!1,this._attributesStrideSize),this._spriteBuffer=new v.c(p,S,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let V=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(V+="\n#define BILLBOARD"),this._colorGradientsTexture&&(V+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(V+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(V+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(V+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(V+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(V+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(V+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(V+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(V+="\n#define NOISE"),this.isLocal&&(V+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===V||(this._cachedUpdateDefines=V,this._updateBuffer=this._platform.createUpdateBuffer(V)),this._platform.isUpdateBufferReady()}_getWrapper(V){const p=this._getCustomDrawWrapper(V);if(null!==p&&void 0!==p&&p.effect)return p;const W=[];this.fillDefines(W,V);let N=this._drawWrappers[V];N||(N=new VV.e(this._engine),N.drawContext&&(N.drawContext.useInstancing=!0),this._drawWrappers[V]=N);const d=W.join("\n");if(N.defines!==d){const V=[],p=[],W=[];this.fillUniformsAttributesAndSamplerNames(p,V,W),N.setEffect(this._engine.createEffect("gpuRenderParticles",V,p,W,d),d)}return N}static _GetAttributeNamesOrOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=[v.f.PositionKind,"age","life","size","angle"];return V||d.push(v.f.ColorKind),p&&d.push("cellIndex"),W||d.push("initialDirection"),N&&d.push("direction"),d.push("offset",v.f.UVKind),d}static _GetEffectCreationOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=["emitterWM","Yf","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,pV.b)(N),V&&N.push("sheetInfos"),p&&N.push("logarithmicDepthConstant"),W&&(N.push("vFogInfos"),N.push("vFogColor")),N}fillDefines(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,pV.l)(this,this._scene,V),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==CV.e.FOGMODE_NONE&&V.push("#define FOG")),p===UV.BLENDMODE_MULTIPLY&&V.push("#define BLENDMULTIPLYMODE"),this.isLocal&&V.push("#define LOCAL"),this.useLogarithmicDepth&&V.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(V.push("#define BILLBOARD"),this.billboardMode){case UV.BILLBOARDMODE_Y:V.push("#define BILLBOARDY");break;case UV.BILLBOARDMODE_STRETCHED:V.push("#define BILLBOARDSTRETCHED");break;case UV.BILLBOARDMODE_ALL:V.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&V.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&V.push("#define ANIMATESHEET"),W&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),V.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(V,p,W){p.push(...xV._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===UV.BILLBOARDMODE_STRETCHED)),V.push(...xV._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),W.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(FV.c.PrepareUniforms(V,this._imageProcessingConfigurationDefines),FV.c.PrepareSamplers(W,this._imageProcessingConfigurationDefines))}animate(){var V;let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(p?this.preWarmStepOffset:(null===(V=this._scene)||void 0===V?void 0:V.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(V,p){const W=this[p];if(!V||!V.length||W)return;const N=new Float32Array(this._rawTextureWidth);for(let d=0;d<this._rawTextureWidth;d++){const p=d/this._rawTextureWidth;M.GetCurrentGradient(p,V,((V,p,W)=>{N[d]=(0,J.l)(V.factor1,p.factor1,W)}))}this[p]=y.d.CreateRTexture(N,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[p].name=p.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const V=new Uint8Array(4*this._rawTextureWidth),p=z.g.ob[0];for(let W=0;W<this._rawTextureWidth;W++){const N=W/this._rawTextureWidth;M.GetCurrentGradient(N,this._colorGradients,((N,d,E)=>{z.e.LerpToRef(N.color1,d.color1,E,p),V[4*W]=255*p.r,V[4*W+1]=255*p.g,V[4*W+2]=255*p.b,V[4*W+3]=255*p.a}))}this._colorGradientsTexture=y.d.CreateRGBATexture(V,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(V,p){var W,d,E,z;const S=this._getWrapper(V),Q=S.effect;this._engine.enableEffect(S);const J=(null===(W=this._scene)||void 0===W?void 0:W.getViewMatrix())||N.e.IdentityReadOnly;if(Q.setMatrix("view",J),Q.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),Q.setTexture("diffuseSampler",this.particleTexture),Q.setVector2("translationPivot",this.translationPivot),Q.setVector3("Yf",this.Yf),this.isLocal&&Q.setMatrix("emitterWM",p),this._colorGradientsTexture?Q.setTexture("colorGradientSampler",this._colorGradientsTexture):Q.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const V=this.particleTexture.getBaseSize();Q.setFloat3("sheetInfos",this.spriteCellWidth/V.width,this.spriteCellHeight/V.height,V.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const V=this._scene.activeCamera;Q.setVector3("eyePosition",V.globalPosition)}const i=Q.defines;if(this._scene&&((0,pV.e)(Q,this,this._scene),this.applyFog&&(0,WV.g)(this._scene,void 0,Q)),i.indexOf("#define BILLBOARDMODE_ALL")>=0){const V=J.clone();V.invert(),Q.setMatrix("invView",V)}switch(this.useLogarithmicDepth&&this._scene&&(0,WV.k)(i,Q,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Q),V){case UV.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case UV.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case UV.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case UV.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,Q,null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Q),null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(z=this._scene)&&void 0!==z&&z.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(V){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!V)if(this.j.position){V=this.j.getWorldMatrix()}else{const p=this.j;V=N.i.Matrix[0],N.e.TranslationToRef(p.x,p.y,p.z,V)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",V),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const p=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=p}render(){let V,p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!p&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let V=0;V<this.preWarmCycles;V++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const V=0|this._accumulatedCount;this._accumulatedCount-=V,this._currentActiveCount+=V}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){V=this.j.getWorldMatrix()}else{const p=this.j;V=N.i.Matrix[0],N.e.TranslationToRef(p.x,p.y,p.z,V)}const d=this._engine;this.updateInAnimate||this._update(V);let E=0;return p||W||(d.setState(!1),this.forceDepthWrite&&d.setDepthWrite(!0),E=this.blendMode===UV.BLENDMODE_MULTIPLYADD?this._render(UV.BLENDMODE_MULTIPLY,V)+this._render(UV.BLENDMODE_ADD,V):this._render(this.blendMode,V),this._engine.setAlphaMode(0)),E}rebuild(){const V=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(V,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,V()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const p in this._drawWrappers){this._drawWrappers[p].dispose()}if(this._drawWrappers={},this._scene){const V=this._scene.fj.indexOf(this);V>-1&&this._scene.fj.splice(V,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let p=0;p<this._renderVertexBuffers.length;++p){const V=this._renderVertexBuffers[p];for(const p in V)V[p].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),V&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),V&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.$i.notifyObservers(this),this.$i.clear()}clone(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N={...this._customWrappers};let d=null;const E=this._engine;if(E.createEffectForParticles&&null!=this.customShader){d=this.customShader;const V=d.shaderOptions.defines.length>0?d.shaderOptions.defines.join("\n"):"";N[0]=E.createEffectForParticles(d.shaderPath.fragmentElement,d.shaderOptions.uniforms,d.shaderOptions.samplers,V,void 0,void 0,void 0,this)}const z=this.serialize(W),S=xV.Parse(z,this._scene||this._engine,this._rootUrl);return S.name=V,S.customShader=d,S._customWrappers=N,void 0===p&&(p=this.j),this.noiseTexture&&(S.noiseTexture=this.noiseTexture.clone()),S.j=p,S}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={};return UV._Serialize(p,this,V),p.activeParticleCount=this.activeParticleCount,p.randomTextureSize=this._randomTextureSize,p.customShader=this.customShader,p}static Parse(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4?arguments[4]:void 0;const E=V.name;let z,S;p instanceof QV.d?z=p:(S=p,z=S.getEngine());const Q=new xV(E,{ib:d||V.ib,randomTextureSize:V.randomTextureSize},p,null,V.isAnimationSheetEnabled);if(Q._rootUrl=W,V.customShader&&z.createEffectForParticles){const p=V.customShader,W=p.shaderOptions.defines.length>0?p.shaderOptions.defines.join("\n"):"",N=z.createEffectForParticles(p.shaderPath.fragmentElement,p.shaderOptions.uniforms,p.shaderOptions.samplers,W,void 0,void 0,void 0,Q);Q.setCustomEffect(N,0),Q.customShader=p}return V.id&&(Q.id=V.id),V.activeParticleCount&&(Q.activeParticleCount=V.activeParticleCount),UV._Parse(V,Q,p,W),V.preventAutoStart&&(Q.preventAutoStart=V.preventAutoStart),N||Q.preventAutoStart||Q.start(),Q}}var TV=W(10848),PV=W(11883),bV=W(11159);class sV{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(V){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const p of this.systems)p.j=V;this._emitterNode=V}setEmitterAsSphere(V,p,W){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:V,renderingGroupId:p};const N=(0,PV.d)("emitterSphere",{diameter:V.diameter,segments:V.segments},W);N.renderingGroupId=p;const d=new bV.b("emitterSphereMaterial",W);d.emissiveColor=V.color,N.material=d;for(const E of this.systems)E.j=N;this._emitterNode=N}start(V){for(const p of this.systems)V&&(p.j=V),p.start()}dispose(){for(const V of this.systems)V.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={systems:[]};for(const W of this.systems)p.systems.push(W.serialize(V));return this._emitterNode&&(p.j=this._emitterCreationOptions),p}static Parse(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0;const d=new sV,E=this.BaseAssetsUrl+"/textures/";p=p||n.d.LastCreatedScene;for(const z of V.systems)d.systems.push(W?xV.Parse(z,p,E,!0,N):UV.Parse(z,p,E,!0,N));if(V.j){const W=V.j.options;if("Sphere"===V.j.kind)d.setEmitterAsSphere({diameter:W.diameter,segments:W.segments,color:z.c.Tg(W.color)},V.j.renderingGroupId,p)}return d}}sV.BaseAssetsUrl="https://assets.babylonjs.com/particles";var GV=W(10893);class RV{static CreateDefault(V){let p,W=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,N=arguments.length>2?arguments[2]:void 0;return p=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new xV("default system",{ib:W},N):new UV("default system",W,N),p.j=V,p.particleTexture=new G.d("https://assets.babylonjs.com/textures/flare.png",p.va()),p.createConeEmitter(.1,Math.PI/4),p.color1=new z.e(1,1,1,1),p.color2=new z.e(1,1,1,1),p.colorDead=new z.e(1,1,1,0),p.minSize=.1,p.maxSize=.1,p.minEmitPower=2,p.maxEmitPower=2,p.updateSpeed=1/60,p.emitRate=30,p}static CreateAsync(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3?arguments[3]:void 0;p||(p=n.d.LastCreatedScene);const d={};return p.addPendingData(d),new Promise(((E,z)=>{if(W&&!xV.IsSupported)return p.removePendingData(d),z("Particle system with GPU is not supported.");TV.e.LoadFile(`${RV.BaseAssetsUrl}/systems/${V}.json`,(V=>{p.removePendingData(d);const z=JSON.parse(V.toString());return E(sV.Parse(z,p,W,N))}),void 0,void 0,void 0,(()=>(p.removePendingData(d),z(`An error occurred with the creation of your particle system. Check if your type '${V}' exists.`))))}))}static ExportSet(V){const p=new sV;for(const W of V)p.systems.push(W);return p}static ParseFromFileAsync(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",E=arguments.length>5?arguments[5]:void 0;return new Promise(((z,S)=>{const Q=new GV.e;Q.addEventListener("readystatechange",(()=>{if(4==Q.readyState)if(200==Q.status){const p=JSON.parse(Q.responseText);let S;S=N?xV.Parse(p,W,d,!1,E):UV.Parse(p,W,d,!1,E),V&&(S.name=V),z(S)}else S("Unable to load the particle system")})),Q.open("GET",p),Q.send()}))}static ParseFromSnippetAsync(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",d=arguments.length>4?arguments[4]:void 0;if("_BLANK"===V){const V=this.CreateDefault(null);return V.start(),Promise.resolve(V)}return new Promise(((E,z)=>{const S=new GV.e;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const z=JSON.parse(JSON.parse(S.responseText).jsonPayload),Q=JSON.parse(z.particleSystem);let J;J=W?xV.Parse(Q,p,N,!1,d):UV.Parse(Q,p,N,!1,d),J.snippetId=V,E(J)}else z("Unable to load the snippet "+V)})),S.open("GET",this.SnippetUrl+"/"+V.replace(/#/g,"/")),S.send()}))}}RV.BaseAssetsUrl=sV.BaseAssetsUrl,RV.SnippetUrl="https://snippet.babylonjs.com",RV.CreateFromSnippetAsync=RV.ParseFromSnippetAsync;var XV=W(11510),rV=W(11321),BV=W(11891);(0,BV.g)(rV.c.NAME_PARTICLESYSTEM,((V,p,W,N)=>{const d=(0,BV.h)(rV.c.NAME_PARTICLESYSTEM);if(d&&void 0!==V.fj&&null!==V.fj)for(let E=0,z=V.fj.length;E<z;E++){const z=V.fj[E];W.fj.push(d(z,p,N))}})),(0,BV.e)(rV.c.NAME_PARTICLESYSTEM,((V,p,W)=>{if(V.activeParticleCount){return xV.Parse(V,p,W)}return UV.Parse(V,p,W)})),QV.d.prototype.createEffectForParticles=function(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",E=arguments.length>4?arguments[4]:void 0,z=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0,Q=arguments.length>7?arguments[7]:void 0,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,i=[],l=[];const j=[];return Q?Q.fillUniformsAttributesAndSamplerNames(l,i,j):(i=UV._GetAttributeNamesOrOptions(),l=UV._GetEffectCreationOptions()),-1===d.indexOf(" BILLBOARD")&&(d+="\n#define BILLBOARD\n"),null!==Q&&void 0!==Q&&Q.isAnimationSheetEnabled&&-1===d.indexOf(" ANIMATESHEET")&&(d+="\n#define ANIMATESHEET\n"),-1===N.indexOf("diffuseSampler")&&N.push("diffuseSampler"),this.createEffect({vertex:(null===Q||void 0===Q?void 0:Q.vertexShaderName)??"particles",fragmentElement:V},i,l.concat(p),j.concat(N),d,E,z,S,void 0,J,(async()=>{0===J?await Promise.resolve().then(W.bind(W,11917)):await Promise.resolve().then(W.bind(W,11978))}))},XV.e.prototype.getEmittedParticleSystems=function(){const V=[];for(let p=0;p<this.va().fj.length;p++){const W=this.va().fj[p];W.j===this&&V.push(W)}return V},XV.e.prototype.getHierarchyEmittedParticleSystems=function(){const V=[],p=this.getDescendants();p.push(this);for(let W=0;W<this.va().fj.length;W++){const N=this.va().fj[W],d=N.j;d.position&&-1!==p.indexOf(d)&&V.push(N)}return V};W(11402),W(11416),W(11565);W(11544),W(11899),W(11579),W(11390),W(11582);W(11762);var YV;W(11901),W(11454);!function(V){V[V.Color=2]="Color",V[V.UV=1]="UV",V[V.Random=0]="Random",V[V.Stated=3]="Stated"}(YV||(YV={}));W(11904),W(11917),W(11928),W(11978)},11797:(V,p,W)=>{"use strict";W.d(p,{d:()=>u});var N=W(11167),d=W(11191),E=W(10856),z=W(11218),S=W(10948),Q=W(11175),J=W(11265),i=W(11004),l=W(10941),j=W(11016),k=W(11799);l.d.prototype.setTextureFromPostProcess=function(V,p,W){var N;let d=null;p&&(p._forcedOutputTexture?d=p._forcedOutputTexture:p._textures.data[p._currentRenderTextureInd]&&(d=p._textures.data[p._currentRenderTextureInd])),this._bindTexture(V,(null===(N=d)||void 0===N?void 0:N.texture)??null,W)},l.d.prototype.setTextureFromPostProcessOutput=function(V,p,W){var N;this._bindTexture(V,(null===p||void 0===p||null===(N=p._outputTexture)||void 0===N?void 0:N.texture)??null,W)},S.e.prototype.setTextureFromPostProcess=function(V,p){this._engine.setTextureFromPostProcess(this._samplers[V],p,V)},S.e.prototype.setTextureFromPostProcessOutput=function(V,p){this._engine.setTextureFromPostProcessOutput(this._samplers[V],p,V)};class u{static get ForceGLSL(){return k.d.ForceGLSL}static set ForceGLSL(V){k.d.ForceGLSL=V}static RegisterShaderCodeProcessing(V,p){k.d.RegisterShaderCodeProcessing(V,p)}get name(){return this._effectWrapper.name}set name(V){this._effectWrapper.name=V}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(V){this._effectWrapper.alphaMode=V}get samples(){return this._samples}set samples(V){this._samples=Math.min(V,this._engine.getCaps().maxMSAASamples),this._textures.forEach((V=>{V.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(V){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),V&&(this._onActivateObserver=this.onActivateObservable.add(V))}set onSizeChanged(V){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(V)}set onApply(V){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(V)}set onBeforeRender(V){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(V)}set onAfterRender(V){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(V)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(V){this._forcedOutputTexture=V}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.ge(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(V,p,W,N,S,Q){var J;let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,l=arguments.length>7?arguments[7]:void 0,j=arguments.length>8?arguments[8]:void 0,f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,O=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",F=arguments.length>12?arguments[12]:void 0,C=arguments.length>13&&void 0!==arguments[13]&&arguments[13],A=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,v=arguments.length>15?arguments[15]:void 0,t=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Ii=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new d.f(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new z.k(1,1),this._texelSize=z.k.Zero(),this.onActivateObservable=new E.b,this.onSizeChangedObservable=new E.b,this.onApplyObservable=new E.b,this.onBeforeRenderObservable=new E.b,this.onAfterRenderObservable=new E.b;let e,Z=1,o=null;if(W&&!Array.isArray(W)){const V=W;W=V.uniforms??null,N=V.samplers??null,Z=V.size??1,Q=V.camera??null,i=V.samplingMode??1,l=V.Ed,j=V.reusable,f=Array.isArray(V.defines)?V.defines.join("\n"):V.defines??null,O=V.textureType??0,U=V.vertexUrl??"postprocess",F=V.indexParameters,C=V.blockCompilation??!1,A=V.textureFormat??5,v=V.shaderLanguage??0,o=V.uniformBuffers??null,t=V.extraInitializations,e=V.effectWrapper}else S&&(Z="number"===typeof S?S:{width:S.width,height:S.height});const K=!!e;if(this._effectWrapper=e??new k.d({name:V,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:p,Ed:l||(null===(J=Q)||void 0===J?void 0:J.va().getEngine()),uniforms:W,samplers:N,uniformBuffers:o,defines:f,vertexUrl:U,indexParameters:F,blockCompilation:C,shaderLanguage:v,extraInitializations:t}),this.name=V,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=Q?(this._camera=Q,this._scene=Q.va(),Q.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):l&&(this._engine=l,this._engine.postProcesses.push(this)),this._options=Z,this.renderTargetSamplingMode=i||1,this._reusable=j||!1,this._textureType=O,this._textureFormat=A,this._shaderLanguage=v||0,this._samplers=N||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=p,this._vertexUrl=U,this._parameters=W||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=o||[],this._indexParameters=F,!K){this._webGPUReady=1===this._shaderLanguage;const V=[];this._gatherImports(this._engine.isWebGPU&&!u.ForceGLSL,V),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(C,f,t,V)}}_gatherImports(){let V=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?V.push(Promise.all([W.e(37).then(W.bind(W,13758))])):V.push(Promise.all([Promise.resolve().then(W.bind(W,11808))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(V){return this._disposeTextures(),this._shareOutputWithPostProcess=V,this}useOwnOutput(){0==this._textures.length&&(this._textures=new d.f(2)),this._shareOutputWithPostProcess=null}updateEffect(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0,S=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(V,p,W,N,d,E,z,S),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let d=0;d<this._textureCache.length;d++)if(this._textureCache[d].texture.width===V.width&&this._textureCache[d].texture.height===V.height&&this._textureCache[d].postProcessChannel===W&&this._textureCache[d].texture._generateDepthBuffer===p.generateDepthBuffer&&this._textureCache[d].texture.samples===p.samples)return this._textureCache[d].texture;const N=this._engine.createRenderTargetTexture(V,p);return this._textureCache.push({texture:N,postProcessChannel:W,lastUsedRenderId:-1}),N}_flushTextureCache(){const V=this._renderId;for(let p=this._textureCache.length-1;p>=0;p--)if(V-this._textureCache[p].lastUsedRenderId>100){let V=!1;for(let W=0;W<this._textures.length;W++)if(this._textures.data[W]===this._textureCache[p].texture){V=!0;break}V||(this._textureCache[p].texture.dispose(),this._textureCache.splice(p,1))}}resize(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=V,this.height=p;let E=null;if(W)for(let Q=0;Q<W._postProcesses.length;Q++)if(null!==W._postProcesses[Q]){E=W._postProcesses[Q];break}const z={width:this.width,height:this.height},S={generateMipMaps:N,generateDepthBuffer:d||E===this,generateStencilBuffer:(d||E===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(z,S,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(z,S,1)),this._texelSize.ge(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let V;if(this._shareOutputWithPostProcess)V=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)V=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let p;V=this.inputTexture;for(let W=0;W<this._textureCache.length;W++)if(this._textureCache[W].texture===V){p=this._textureCache[W];break}p&&(p.lastUsedRenderId=this._renderId)}return V}activate(V){var p,W;let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0;const E=(V=V||this._camera).va(),z=E.getEngine(),S=z.getCaps().maxTextureSize,Q=(N?N.width:this._engine.getRenderWidth(!0))*this._options|0,J=(N?N.height:this._engine.getRenderHeight(!0))*this._options|0;let i=this._options.width||Q,l=this._options.height||J;const k=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let u=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const V=z.currentViewport;V&&(i*=V.width,l*=V.height)}(k||this.alwaysForcePOT)&&(this._options.width||(i=z.needPOTTextures?(0,j.g)(i,S,this.scaleMode):i),this._options.height||(l=z.needPOTTextures?(0,j.g)(l,S,this.scaleMode):l)),this.width===i&&this.height===l&&(u=this._getTarget())||this.resize(i,l,V,k,d),this._textures.forEach((V=>{V.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(V,this.samples)})),this._flushTextureCache(),this._renderId++}return u||(u=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.ge(Q/i,J/l),this._engine.bindFramebuffer(u,0,Q,J,this.forceFullscreenViewport)):(this._scaleRatio.ge(1,1),this._engine.bindFramebuffer(u,0,void 0,void 0,this.forceFullscreenViewport)),null===(p=(W=this._engine)._debugInsertMarker)||void 0===p||p.call(W,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(V),this.Ii&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:E.clearColor,E._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),u}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let V;var p;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),V=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(p=V)||void 0===p?void 0:p.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let V=this._textureCache.length-1;V>=0;V--)this._textureCache[V].texture.dispose();this._textureCache.length=0}setPrePassRenderer(V){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=V.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(V){let p;if(V=V||this._camera,this._disposeTextures(),this._scene&&(p=this._scene.postProcesses.indexOf(this),-1!==p&&this._scene.postProcesses.splice(p,1)),this._parentContainer){const V=this._parentContainer.postProcesses.indexOf(this);V>-1&&this._parentContainer.postProcesses.splice(V,1),this._parentContainer=null}if(p=this._engine.postProcesses.indexOf(this),-1!==p&&this._engine.postProcesses.splice(p,1),V){if(V.detachPostProcess(this),p=V._postProcesses.indexOf(this),0===p&&V._postProcesses.length>0){const V=this._camera._getFirstPostProcess();V&&V.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const V=J.b.Serialize(this),p=this.getCamera()||this._scene&&this._scene.activeCamera;return V.customType="BABYLON."+this.getClassName(),V.cameraId=p?p.id:null,V.reusable=this._reusable,V.textureType=this._textureType,V.fragmentUrl=this._fragmentUrl,V.parameters=this._parameters,V.samplers=this._samplers,V.uniformBuffers=this._uniformBuffers,V.options=this._options,V.defines=this._postProcessDefines,V.textureFormat=this._textureFormat,V.vertexUrl=this._vertexUrl,V.indexParameters=this._indexParameters,V}clone(){const V=this.serialize();V._engine=this._engine,V.cameraId=null;const p=u.Parse(V,this._scene,"");return p?(p.onActivateObservable=this.onActivateObservable.clone(),p.onSizeChangedObservable=this.onSizeChangedObservable.clone(),p.onApplyObservable=this.onApplyObservable.clone(),p.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),p.onAfterRenderObservable=this.onAfterRenderObservable.clone(),p._prePassEffectConfiguration=this._prePassEffectConfiguration,p):null}static Parse(V,p,W){const N=(0,i.b)(V.customType);if(!N||!N._Parse)return null;const d=p?p.getCameraById(V.cameraId):null;return N._Parse(V,d,p,W)}static _Parse(V,p,W,N){return J.b.Parse((()=>new u(V.name,V.fragmentUrl,V.parameters,V.samplers,V.options,p,V.renderTargetSamplingMode,V._engine,V.reusable,V.defines,V.textureType,V.vertexUrl,V.indexParameters,!1,V.textureFormat)),V,W,N)}}(0,N.c)([(0,Q.I)()],u.prototype,"uniqueId",void 0),(0,N.c)([(0,Q.I)()],u.prototype,"name",null),(0,N.c)([(0,Q.I)()],u.prototype,"width",void 0),(0,N.c)([(0,Q.I)()],u.prototype,"height",void 0),(0,N.c)([(0,Q.I)()],u.prototype,"renderTargetSamplingMode",void 0),(0,N.c)([(0,Q.m)()],u.prototype,"clearColor",void 0),(0,N.c)([(0,Q.I)()],u.prototype,"Ii",void 0),(0,N.c)([(0,Q.I)()],u.prototype,"forceAutoClearInAlphaMode",void 0),(0,N.c)([(0,Q.I)()],u.prototype,"alphaMode",null),(0,N.c)([(0,Q.I)()],u.prototype,"alphaConstants",void 0),(0,N.c)([(0,Q.I)()],u.prototype,"enablePixelPerfectMode",void 0),(0,N.c)([(0,Q.I)()],u.prototype,"forceFullscreenViewport",void 0),(0,N.c)([(0,Q.I)()],u.prototype,"scaleMode",void 0),(0,N.c)([(0,Q.I)()],u.prototype,"alwaysForcePOT",void 0),(0,N.c)([(0,Q.I)("samples")],u.prototype,"_samples",void 0),(0,N.c)([(0,Q.I)()],u.prototype,"adaptScaleToCurrentViewport",void 0),(0,i.d)("BABYLON.PostProcess",u)},11305:(V,p,W)=>{"use strict";W.d(p,{c:()=>E});var N=W(11291),d=W(10856);class E{constructor(V){this._vertexBuffers={},this.onBeforeRenderObservable=new d.b,this._scene=V}_prepareBuffers(){if(this._vertexBuffers[N.f.PositionKind])return;const V=[];V.push(1,1),V.push(-1,1),V.push(-1,-1),V.push(1,-1),this._vertexBuffers[N.f.PositionKind]=new N.f(this._scene.getEngine(),V,N.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const V=[];V.push(0),V.push(1),V.push(2),V.push(0),V.push(2),V.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(V)}_rebuild(){const V=this._vertexBuffers[N.f.PositionKind];V&&(V._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=this._scene.activeCamera;return!!W&&(p=p||W._postProcesses.filter((V=>null!=V)),!(!p||0===p.length||!this._scene.postProcessesEnabled)&&(p[0].activate(W,V,null!==p&&void 0!==p),!0))}directRender(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const z=this._scene.getEngine();for(let Q=0;Q<V.length;Q++){var S;if(Q<V.length-1)V[Q+1].activate(this._scene.activeCamera,null===p||void 0===p?void 0:p.texture);else p?z.bindFramebuffer(p,N,void 0,void 0,W,d):E||z.restoreDefaultFramebuffer(),null===(S=z._debugInsertMarker)||void 0===S||S.call(z,`post process ${V[Q].name} output`);const J=V[Q],i=J.apply();i&&(J.onBeforeRenderObservable.notifyObservers(i),this._prepareBuffers(),z.bindBuffers(this._vertexBuffers,this._indexBuffer,i),z.drawElementsType(0,0,6),J.onAfterRenderObservable.notifyObservers(i))}z.setDepthBuffer(!0),z.setDepthWrite(!0)}_finalizeFrame(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const E=this._scene.activeCamera;if(!E)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(N=N||E._postProcesses.filter((V=>null!=V))).length||!this._scene.postProcessesEnabled)return;const z=this._scene.getEngine();for(let Q=0,J=N.length;Q<J;Q++){const i=N[Q];var S;if(Q<J-1)i._outputTexture=N[Q+1].activate(E,null===p||void 0===p?void 0:p.texture);else p?(z.bindFramebuffer(p,W,void 0,void 0,d),i._outputTexture=p):(z.restoreDefaultFramebuffer(),i._outputTexture=null),null===(S=z._debugInsertMarker)||void 0===S||S.call(z,`post process ${N[Q].name} output`);if(V)break;const l=i.apply();l&&(i.onBeforeRenderObservable.notifyObservers(l),this._prepareBuffers(),z.bindBuffers(this._vertexBuffers,this._indexBuffer,l),z.drawElementsType(0,0,6),i.onAfterRenderObservable.notifyObservers(l))}z.setDepthBuffer(!0),z.setDepthWrite(!0),z.setAlphaMode(0)}dispose(){const V=this._vertexBuffers[N.f.PositionKind];V&&(V.dispose(),this._vertexBuffers[N.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11313:(V,p,W)=>{"use strict";W.d(p,{e:()=>S});var N=W(11191),d=W(11218);class E{set opaqueSortCompareFn(V){this._opaqueSortCompareFn=V||E.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(V){this._alphaTestSortCompareFn=V||E.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(V){this._transparentSortCompareFn=V||E.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=V,this._opaqueSubMeshes=new N.f(256),this._transparentSubMeshes=new N.f(256),this._alphaTestSubMeshes=new N.f(256),this._depthOnlySubMeshes=new N.f(256),this._particleSystems=new N.f(256),this._spriteManagers=new N.f(256),this._empty=!0,this._edgesRenderers=new N.d(16),this._scene=p,this.opaqueSortCompareFn=W,this.alphaTestSortCompareFn=d,this.transparentSortCompareFn=E}render(V,p,W,N){if(V)return void V(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const d=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(d.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),d.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const E=d.getStencilBuffer();if(d.setStencilBuffer(!1),p&&this._renderSprites(),W&&this._renderParticles(N),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(d.setStencilBuffer(E),this._scene.useOrderIndependentTransparency){const V=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);V.length&&this._renderTransparent(V)}else this._renderTransparent(this._transparentSubMeshes);d.setAlphaMode(0)}if(d.setStencilBuffer(!1),this._edgesRenderers.length){for(let V=0;V<this._edgesRenderers.length;V++)this._edgesRenderers.data[V].render();d.setAlphaMode(0)}d.setStencilBuffer(E)}_renderOpaqueSorted(V){E._RenderSorted(V,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(V){E._RenderSorted(V,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(V){E._RenderSorted(V,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(V,p,W,N){let z,S=0;const Q=W?W.globalPosition:E._ZeroVector;if(N)for(;S<V.length;S++)z=V.data[S],z._alphaIndex=z.getMesh().alphaIndex,z._distanceToCamera=d.n.Distance(z.getBoundingInfo().boundingSphere.centerWorld,Q);const J=V.length===V.data.length?V.data:V.data.slice(0,V.length);p&&J.sort(p);const i=J[0].getMesh().va();for(S=0;S<J.length;S++)if(z=J[S],!i._activeMeshesFrozenButKeepClipping||z.isInFrustum(i._frustumPlanes)){if(N){const V=z.Ha();if(V&&V.needDepthPrePass){const p=V.va().getEngine();p.setColorWrite(!1),p.setAlphaMode(0),z.render(!1),p.setColorWrite(!0)}}z.render(N)}}static defaultTransparentSortCompare(V,p){return V._alphaIndex>p._alphaIndex?1:V._alphaIndex<p._alphaIndex?-1:E.backToFrontSortCompare(V,p)}static backToFrontSortCompare(V,p){return V._distanceToCamera<p._distanceToCamera?1:V._distanceToCamera>p._distanceToCamera?-1:0}static frontToBackSortCompare(V,p){return V._distanceToCamera<p._distanceToCamera?-1:V._distanceToCamera>p._distanceToCamera?1:0}static PainterSortCompare(V,p){const W=V.getMesh(),N=p.getMesh();return W.material&&N.material?W.material.uniqueId-N.material.uniqueId:W.uniqueId-N.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(V,p,W){void 0===p&&(p=V.getMesh()),void 0===W&&(W=V.Ha()),null!==W&&void 0!==W&&(W.needAlphaBlendingForMesh(p)?this._transparentSubMeshes.push(V):W.needAlphaTesting()?(W.needDepthPrePass&&this._depthOnlySubMeshes.push(V),this._alphaTestSubMeshes.push(V)):(W.needDepthPrePass&&this._depthOnlySubMeshes.push(V),this._opaqueSubMeshes.push(V)),p._renderingGroup=this,p._edgesRenderer&&p.isEnabled()&&p.isVisible&&p._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(p._edgesRenderer),this._empty=!1)}dispatchSprites(V){this._spriteManagers.push(V),this._empty=!1}dispatchParticles(V){this._particleSystems.push(V),this._empty=!1}_renderParticles(V){if(0===this._particleSystems.length)return;const p=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let W=0;W<this._particleSystems.length;W++){const N=this._particleSystems.data[W];if(0===(p&&p.layerMask&N.layerMask))continue;const d=N.j;d.position&&V&&-1===V.indexOf(d)||this._scene._activeParticles.addCount(N.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const V=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let p=0;p<this._spriteManagers.length;p++){const W=this._spriteManagers.data[p];0!==(V&&V.layerMask&W.layerMask)&&W.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}E._ZeroVector=d.n.Zero();class z{}class S{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(V){V!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=V,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const V of this._scene.meshes)if(V.dg)for(const p of V.dg)p._wasDispatched=!1;if(this._scene.spriteManagers)for(const V of this._scene.spriteManagers)V._wasDispatched=!1;for(const V of this._scene.fj)V._wasDispatched=!1}constructor(V){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new z,this._maintainStateBetweenFrames=!1,this._scene=V;for(let p=S.MIN_RENDERINGGROUPS;p<S.MAX_RENDERINGGROUPS;p++)this._autoClearDepthStencil[p]={Ii:!0,depth:!0,stencil:!0}}getRenderingGroup(V){const p=V||0;return this._prepareRenderingGroup(p),this._renderingGroups[p]}_clearDepthStencilBuffer(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,V,p),this._depthStencilBufferAlreadyCleaned=!0)}render(V,p,W,N){const d=this._renderingGroupInfo;if(d.Bc=this._scene,d.camera=this._scene.activeCamera,this._scene.spriteManagers&&N)for(let E=0;E<this._scene.spriteManagers.length;E++){const V=this._scene.spriteManagers[E];this.dispatchSprites(V)}for(let E=S.MIN_RENDERINGGROUPS;E<S.MAX_RENDERINGGROUPS;E++){this._depthStencilBufferAlreadyCleaned=E===S.MIN_RENDERINGGROUPS;const z=this._renderingGroups[E];if(!z||z._empty)continue;const Q=1<<E;if(d.renderingGroupId=E,this._scene.onBeforeRenderingGroupObservable.notifyObservers(d,Q),S.AUTOCLEAR){const V=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(E):this._autoClearDepthStencil[E];V&&V.Ii&&this._clearDepthStencilBuffer(V.depth,V.stencil)}for(const V of this._scene._beforeRenderingGroupDrawStage)V.action(E);z.render(V,N,W,p);for(const V of this._scene._afterRenderingGroupDrawStage)V.action(E);this._scene.onAfterRenderingGroupObservable.notifyObservers(d,Q)}}reset(){if(!this.maintainStateBetweenFrames)for(let V=S.MIN_RENDERINGGROUPS;V<S.MAX_RENDERINGGROUPS;V++){const p=this._renderingGroups[V];p&&p.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let V=S.MIN_RENDERINGGROUPS;V<S.MAX_RENDERINGGROUPS;V++){const p=this._renderingGroups[V];p&&p.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let V=S.MIN_RENDERINGGROUPS;V<S.MAX_RENDERINGGROUPS;V++){const p=this._renderingGroups[V];p&&p.dispose()}}_prepareRenderingGroup(V){void 0===this._renderingGroups[V]&&(this._renderingGroups[V]=new E(V,this._scene,this._customOpaqueSortCompareFn[V],this._customAlphaTestSortCompareFn[V],this._customTransparentSortCompareFn[V]))}dispatchSprites(V){this.maintainStateBetweenFrames&&V._wasDispatched||(V._wasDispatched=!0,this.getRenderingGroup(V.renderingGroupId).dispatchSprites(V))}dispatchParticles(V){this.maintainStateBetweenFrames&&V._wasDispatched||(V._wasDispatched=!0,this.getRenderingGroup(V.renderingGroupId).dispatchParticles(V))}dispatch(V,p,W){void 0===p&&(p=V.getMesh()),this.maintainStateBetweenFrames&&V._wasDispatched||(V._wasDispatched=!0,this.getRenderingGroup(p.renderingGroupId).dispatch(V,p,W))}setRenderingOrder(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[V]=p,this._customAlphaTestSortCompareFn[V]=W,this._customTransparentSortCompareFn[V]=N,this._renderingGroups[V]){const p=this._renderingGroups[V];p.opaqueSortCompareFn=this._customOpaqueSortCompareFn[V],p.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[V],p.transparentSortCompareFn=this._customTransparentSortCompareFn[V]}}setRenderingAutoClearDepthStencil(V,p){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[V]={Ii:p,depth:W,stencil:N}}getAutoClearDepthStencilSetup(V){return this._autoClearDepthStencil[V]}}S.MAX_RENDERINGGROUPS=4,S.MIN_RENDERINGGROUPS=0,S.AUTOCLEAR=!0},11961:(V,p,W)=>{"use strict";const N="clipPlaneFragment",d="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";W(10952).b.IncludesShadersStoreWGSL[N]=d},11931:(V,p,W)=>{"use strict";const N="clipPlaneFragmentDeclaration",d="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";W(10952).b.IncludesShadersStoreWGSL[N]=d},11997:(V,p,W)=>{"use strict";const N="clipPlaneVertex",d="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";W(10952).b.IncludesShadersStoreWGSL[N]=d},11985:(V,p,W)=>{"use strict";const N="clipPlaneVertexDeclaration",d="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";W(10952).b.IncludesShadersStoreWGSL[N]=d},11975:(V,p,W)=>{"use strict";const N="fogFragment",d="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";W(10952).b.IncludesShadersStoreWGSL[N]=d},11957:(V,p,W)=>{"use strict";const N="fogFragmentDeclaration",d="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";W(10952).b.IncludesShadersStoreWGSL[N]=d},12004:(V,p,W)=>{"use strict";const N="fogVertex",d="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";W(10952).b.IncludesShadersStoreWGSL[N]=d},11988:(V,p,W)=>{"use strict";const N="fogVertexDeclaration",d="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";W(10952).b.IncludesShadersStoreWGSL[N]=d},11944:(V,p,W)=>{"use strict";const N="helperFunctions",d="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";W(10952).b.IncludesShadersStoreWGSL[N]=d},11935:(V,p,W)=>{"use strict";const N="imageProcessingDeclaration",d="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";W(10952).b.IncludesShadersStoreWGSL[N]=d},11953:(V,p,W)=>{"use strict";const N="imageProcessingFunctions",d="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";W(10952).b.IncludesShadersStoreWGSL[N]=d},11939:(V,p,W)=>{"use strict";const N="logDepthDeclaration",d="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";W(10952).b.IncludesShadersStoreWGSL[N]=d},11969:(V,p,W)=>{"use strict";const N="logDepthFragment",d="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";W(10952).b.IncludesShadersStoreWGSL[N]=d},12009:(V,p,W)=>{"use strict";const N="logDepthVertex",d="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";W(10952).b.IncludesShadersStoreWGSL[N]=d},11928:(V,p,W)=>{"use strict";W.r(p),W.d(p,{particlesPixelShaderWGSL:()=>z});var N=W(10952);W(11931),W(11935),W(11939),W(11944),W(11953),W(11957),W(11961),W(11969),W(11975);const d="particlesPixelShader",E="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";N.b.ShadersStoreWGSL[d]=E;const z={name:d,shader:E}},11978:(V,p,W)=>{"use strict";W.r(p),W.d(p,{particlesVertexShaderWGSL:()=>z});var N=W(10952);W(11985),W(11988),W(11939),W(11997),W(12004),W(12009);const d="particlesVertexShader",E="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";N.b.ShadersStoreWGSL[d]=E;const z={name:d,shader:E}},11847:(V,p,W)=>{"use strict";const N="clipPlaneFragment",d="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";W(10952).b.IncludesShadersStore[N]=d},11911:(V,p,W)=>{"use strict";const N="clipPlaneFragmentDeclaration",d="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";W(10952).b.IncludesShadersStore[N]=d},11870:(V,p,W)=>{"use strict";const N="clipPlaneVertex",d="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";W(10952).b.IncludesShadersStore[N]=d},11923:(V,p,W)=>{"use strict";const N="clipPlaneVertexDeclaration",d="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";W(10952).b.IncludesShadersStore[N]=d},11860:(V,p,W)=>{"use strict";const N="fogFragment",d="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";W(10952).b.IncludesShadersStore[N]=d},11843:(V,p,W)=>{"use strict";const N="fogFragmentDeclaration",d="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";W(10952).b.IncludesShadersStore[N]=d},11874:(V,p,W)=>{"use strict";const N="fogVertex",d="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";W(10952).b.IncludesShadersStore[N]=d},11868:(V,p,W)=>{"use strict";const N="fogVertexDeclaration",d="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";W(10952).b.IncludesShadersStore[N]=d},11835:(V,p,W)=>{"use strict";const N="helperFunctions",d="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";W(10952).b.IncludesShadersStore[N]=d},11824:(V,p,W)=>{"use strict";const N="imageProcessingDeclaration",d="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";W(10952).b.IncludesShadersStore[N]=d},11841:(V,p,W)=>{"use strict";const N="imageProcessingFunctions",d="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";W(10952).b.IncludesShadersStore[N]=d},11828:(V,p,W)=>{"use strict";const N="logDepthDeclaration",d="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";W(10952).b.IncludesShadersStore[N]=d},11856:(V,p,W)=>{"use strict";const N="logDepthFragment",d="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";W(10952).b.IncludesShadersStore[N]=d},11880:(V,p,W)=>{"use strict";const N="logDepthVertex",d="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";W(10952).b.IncludesShadersStore[N]=d},11904:(V,p,W)=>{"use strict";W.r(p),W.d(p,{particlesPixelShader:()=>z});var N=W(10952);W(11911),W(11824),W(11828),W(11835),W(11841),W(11843),W(11847),W(11856),W(11860);const d="particlesPixelShader",E="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";N.b.ShadersStore[d]=E;const z={name:d,shader:E}},11917:(V,p,W)=>{"use strict";W.r(p),W.d(p,{particlesVertexShader:()=>z});var N=W(10952);W(11923),W(11868),W(11828),W(11870),W(11874),W(11880);const d="particlesVertexShader",E="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";N.b.ShadersStore[d]=E;const z={name:d,shader:E}},11808:(V,p,W)=>{"use strict";W.r(p),W.d(p,{postprocessVertexShader:()=>E});const N="postprocessVertexShader",d="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";W(10952).b.ShadersStore[N]=d;const E={name:N,shader:d}},11343:(V,p,W)=>{"use strict";W.d(p,{e:()=>N});class N{}N._IsPickingAvailable=!1},11529:(V,p,W)=>{"use strict";W.d(p,{b:()=>l});var N=W(11167),d=W(11218),E=W(11175),z=W(10856),S=W(10900),Q=W(10887),J=W(11265);class i{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new z.b,this._onClonedObservable=new z.b}}class l{static AddNodeConstructor(V,p){this._NodeConstructors[V]=p}static Construct(V,p,W,N){const d=this._NodeConstructors[V];return d?d(p,W,N):null}set accessibilityTag(V){this._accessibilityTag=V,this.onAccessibilityTagChangedObservable.notifyObservers(V)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(V){this._nodeDataStorage._doNotSerialize=V}u(){return this._nodeDataStorage._isDisposed}set parent(V){if(this._parentNode===V)return;const p=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const p=this._parentNode._children.indexOf(this);-1!==p&&this._parentNode._children.splice(p,1),V||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=V,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),p||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(V){V.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const V=this._scene.rootNodes,p=V.length-1;V[this._nodeDataStorage._sceneRootNodesIndex]=V[p],V[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(V){this._animationPropertiesOverride=V}getClassName(){return"Node"}set onDispose(V){this._onDisposeObserver&&this.$i.remove(this._onDisposeObserver),this._onDisposeObserver=this.$i.add(V)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new i,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new z.b,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=d.e.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.$i=new z.b,this._onDisposeObserver=null,this._behaviors=new Array,this.name=V,this.id=V,this._scene=p||S.d.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),W&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(V)||(V.init(),this._scene.isLoading&&!p?this._scene.onDataLoadedObservable.addOnce((()=>{V.attach(this)})):V.attach(this),this._behaviors.push(V)),this}removeBehavior(V){const p=this._behaviors.indexOf(V);return-1===p||(this._behaviors[p].detach(),this._behaviors.splice(p,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(V){for(const p of this._behaviors)if(p.name===V)return p;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Dj(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(V){!V&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(V){return this.parent?this.parent._getActionManagerForTrigger(V,!1):null}_updateCache(V){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Jg(V){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((V=>{V._syncParentEnabledState()}))}Ab(V){this._nodeDataStorage._isEnabled!==V&&(this._nodeDataStorage._isEnabled=V,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(V))}isDescendantOf(V){return!!this.parent&&(this.parent===V||this.parent.isDescendantOf(V))}_getDescendants(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;if(this._children)for(let N=0;N<this._children.length;N++){const d=this._children[N];W&&!W(d)||V.push(d),p||d._getDescendants(V,!1,W)}}getDescendants(V,p){const W=[];return this._getDescendants(W,V,p),W}getChildMeshes(V,p){const W=[];return this._getDescendants(W,V,(V=>(!p||p(V))&&void 0!==V.ri)),W}getChildren(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(p,V)}_setReady(V){V!==this._nodeDataStorage._isReady&&(V?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(V){for(let p=0;p<this.animations.length;p++){const W=this.animations[p];if(W.name===V)return W}return null}createAnimationRange(V,p,W){if(!this._ranges[V]){this._ranges[V]=l._AnimationRangeFactory(V,p,W);for(let N=0,d=this.animations.length;N<d;N++)this.animations[N]&&this.animations[N].createRange(V,p,W)}}deleteAnimationRange(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let W=0,N=this.animations.length;W<N;W++)this.animations[W]&&this.animations[W].deleteRange(V,p);this._ranges[V]=null}getAnimationRange(V){return this._ranges[V]||null}clone(V,p,W){const N=J.b.Clone((()=>new l(V,this.va())),this);if(p&&(N.parent=p),!W){const p=this.getDescendants(!0);for(let W=0;W<p.length;W++){const d=p[W];d.clone(V+"."+d.name,N)}}return N}getAnimationRanges(){const V=[];let p;for(p in this._ranges)V.push(this._ranges[p]);return V}beginAnimation(V,p,W,N){const d=this.getAnimationRange(V);return d?this._scene.beginAnimation(this,d.from,d.to,p,W,N):null}serializeAnimationRanges(){const V=[];for(const p in this._ranges){const W=this._ranges[p];if(!W)continue;const N={};N.name=p,N.from=W.from,N.to=W.to,V.push(N)}return V}Dj(V){return this._worldMatrix||(this._worldMatrix=d.e.Identity()),this._worldMatrix}dispose(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!V){const W=this.getDescendants(!0);for(const N of W)N.dispose(V,p)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.$i.notifyObservers(this),this.$i.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const W of this._behaviors)W.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(V,p,W){if(p.ranges)for(let N=0;N<p.ranges.length;N++){const W=p.ranges[N];V.createAnimationRange(W.name,W.from,W.to)}}getHierarchyBoundingVectors(){let V,p,W=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Dj(!0);const E=this;if(E.getBoundingInfo&&E.dg){const W=E.getBoundingInfo();V=W.boundingBox.minimumWorld.clone(),p=W.boundingBox.maximumWorld.clone()}else V=new d.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),p=new d.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(W){const W=this.getDescendants(!1);for(const E of W){const W=E;if(W.Dj(!0),N&&!N(W))continue;if(!W.getBoundingInfo||0===W.getTotalVertices())continue;const z=W.getBoundingInfo().boundingBox,S=z.minimumWorld,Q=z.maximumWorld;d.n.CheckExtends(S,V,p),d.n.CheckExtends(Q,V,p)}}return{min:V,max:p}}}l._AnimationRangeFactory=(V,p,W)=>{throw(0,Q.c)("AnimationRange")},l._NodeConstructors={},(0,N.c)([(0,E.I)()],l.prototype,"name",void 0),(0,N.c)([(0,E.I)()],l.prototype,"id",void 0),(0,N.c)([(0,E.I)()],l.prototype,"uniqueId",void 0),(0,N.c)([(0,E.I)()],l.prototype,"state",void 0),(0,N.c)([(0,E.I)()],l.prototype,"metadata",void 0)},11200:(V,p,W)=>{"use strict";W.d(p,{e:()=>VV});var N=W(10848),d=W(10882),E=W(10856),z=W(11191);class S{constructor(){this._count=0,this._data={}}p(V){this.clear(),V.forEach(((V,p)=>this.add(V,p)))}get(V){const p=this._data[V];if(void 0!==p)return p}getOrAddWithFactory(V,p){let W=this.get(V);return void 0!==W||(W=p(V),W&&this.add(V,W)),W}getOrAdd(V,p){const W=this.get(V);return void 0!==W?W:(this.add(V,p),p)}contains(V){return void 0!==this._data[V]}add(V,p){return void 0===this._data[V]&&(this._data[V]=p,++this._count,!0)}set(V,p){return void 0!==this._data[V]&&(this._data[V]=p,!0)}getAndRemove(V){const p=this.get(V);return void 0!==p?(delete this._data[V],--this._count,p):null}remove(V){return!!this.contains(V)&&(delete this._data[V],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(V){for(const p in this._data){V(p,this._data[p])}}first(V){for(const p in this._data){const W=V(p,this._data[p]);if(W)return W}return null}}var Q=W(11209),J=W(11218),i=W(11251),l=W(11278),j=W(11284);class k{constructor(V,p,W,N,d,E){this.source=V,this.pointerX=p,this.pointerY=W,this.meshUnderPointer=N,this.sourceEvent=d,this.additionalData=E}static CreateNew(V,p,W){const N=V.va();return new k(V,N.pointerX,N.pointerY,N.meshUnderPointer||V,p,W)}static CreateNewFromSprite(V,p,W,N){return new k(V,p.pointerX,p.pointerY,p.meshUnderPointer,W,N)}static CreateNewFromScene(V,p){return new k(null,V.pointerX,V.pointerY,V.meshUnderPointer,p)}static CreateNewFromPrimitive(V,p,W,N){return new k(V,p.x,p.y,null,W,N)}}var u=W(11305),f=W(11313),O=W(11321),U=W(10862),F=W(10900),C=W(10887),A=W(11330);class v{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const V in v.Triggers)if(Object.prototype.hasOwnProperty.call(v.Triggers,V))return!0;return!1}static get HasPickTriggers(){for(const V in v.Triggers)if(Object.prototype.hasOwnProperty.call(v.Triggers,V)){const p=parseInt(V);if(p>=1&&p<=7)return!0}return!1}static HasSpecificTrigger(V){for(const p in v.Triggers)if(Object.prototype.hasOwnProperty.call(v.Triggers,p)){if(parseInt(p)===V)return!0}return!1}}v.Triggers={};var t,e,Z,o,K,h,L,x=W(11335);!function(V){V[V.Generic=0]="Generic",V[V.Keyboard=1]="Keyboard",V[V.Mouse=2]="Mouse",V[V.Touch=3]="Touch",V[V.DualShock=4]="DualShock",V[V.Xbox=5]="Xbox",V[V.Switch=6]="Switch",V[V.DualSense=7]="DualSense"}(t||(t={})),function(V){V[V.Horizontal=0]="Horizontal",V[V.Vertical=1]="Vertical",V[V.LeftClick=2]="LeftClick",V[V.MiddleClick=3]="MiddleClick",V[V.RightClick=4]="RightClick",V[V.BrowserBack=5]="BrowserBack",V[V.BrowserForward=6]="BrowserForward",V[V.MouseWheelX=7]="MouseWheelX",V[V.MouseWheelY=8]="MouseWheelY",V[V.MouseWheelZ=9]="MouseWheelZ",V[V.Move=12]="Move"}(e||(e={})),function(V){V[V.Horizontal=0]="Horizontal",V[V.Vertical=1]="Vertical",V[V.LeftClick=2]="LeftClick",V[V.MiddleClick=3]="MiddleClick",V[V.RightClick=4]="RightClick",V[V.BrowserBack=5]="BrowserBack",V[V.BrowserForward=6]="BrowserForward",V[V.MouseWheelX=7]="MouseWheelX",V[V.MouseWheelY=8]="MouseWheelY",V[V.MouseWheelZ=9]="MouseWheelZ",V[V.DeltaHorizontal=10]="DeltaHorizontal",V[V.DeltaVertical=11]="DeltaVertical"}(Z||(Z={})),function(V){V[V.Cross=0]="Cross",V[V.Circle=1]="Circle",V[V.Square=2]="Square",V[V.Triangle=3]="Triangle",V[V.L1=4]="L1",V[V.R1=5]="R1",V[V.L2=6]="L2",V[V.R2=7]="R2",V[V.Share=8]="Share",V[V.Options=9]="Options",V[V.L3=10]="L3",V[V.R3=11]="R3",V[V.DPadUp=12]="DPadUp",V[V.DPadDown=13]="DPadDown",V[V.DPadLeft=14]="DPadLeft",V[V.DPadRight=15]="DPadRight",V[V.Home=16]="Home",V[V.TouchPad=17]="TouchPad",V[V.LStickXAxis=18]="LStickXAxis",V[V.LStickYAxis=19]="LStickYAxis",V[V.RStickXAxis=20]="RStickXAxis",V[V.RStickYAxis=21]="RStickYAxis"}(o||(o={})),function(V){V[V.Cross=0]="Cross",V[V.Circle=1]="Circle",V[V.Square=2]="Square",V[V.Triangle=3]="Triangle",V[V.L1=4]="L1",V[V.R1=5]="R1",V[V.L2=6]="L2",V[V.R2=7]="R2",V[V.Create=8]="Create",V[V.Options=9]="Options",V[V.L3=10]="L3",V[V.R3=11]="R3",V[V.DPadUp=12]="DPadUp",V[V.DPadDown=13]="DPadDown",V[V.DPadLeft=14]="DPadLeft",V[V.DPadRight=15]="DPadRight",V[V.Home=16]="Home",V[V.TouchPad=17]="TouchPad",V[V.LStickXAxis=18]="LStickXAxis",V[V.LStickYAxis=19]="LStickYAxis",V[V.RStickXAxis=20]="RStickXAxis",V[V.RStickYAxis=21]="RStickYAxis"}(K||(K={})),function(V){V[V.A=0]="A",V[V.B=1]="B",V[V.X=2]="X",V[V.Y=3]="Y",V[V.LB=4]="LB",V[V.RB=5]="RB",V[V.LT=6]="LT",V[V.RT=7]="RT",V[V.Back=8]="Back",V[V.Start=9]="Start",V[V.LS=10]="LS",V[V.RS=11]="RS",V[V.DPadUp=12]="DPadUp",V[V.DPadDown=13]="DPadDown",V[V.DPadLeft=14]="DPadLeft",V[V.DPadRight=15]="DPadRight",V[V.Home=16]="Home",V[V.LStickXAxis=17]="LStickXAxis",V[V.LStickYAxis=18]="LStickYAxis",V[V.RStickXAxis=19]="RStickXAxis",V[V.RStickYAxis=20]="RStickYAxis"}(h||(h={})),function(V){V[V.B=0]="B",V[V.A=1]="A",V[V.Y=2]="Y",V[V.X=3]="X",V[V.L=4]="L",V[V.R=5]="R",V[V.ZL=6]="ZL",V[V.ZR=7]="ZR",V[V.Minus=8]="Minus",V[V.Plus=9]="Plus",V[V.LS=10]="LS",V[V.RS=11]="RS",V[V.DPadUp=12]="DPadUp",V[V.DPadDown=13]="DPadDown",V[V.DPadLeft=14]="DPadLeft",V[V.DPadRight=15]="DPadRight",V[V.Home=16]="Home",V[V.Capture=17]="Capture",V[V.LStickXAxis=18]="LStickXAxis",V[V.LStickYAxis=19]="LStickYAxis",V[V.RStickXAxis=20]="RStickXAxis",V[V.RStickYAxis=21]="RStickYAxis"}(L||(L={}));var T=W(11340);class P{static CreateDeviceEvent(V,p,W,N,d,E,z){switch(V){case t.Keyboard:return this._CreateKeyboardEvent(W,N,d,E);case t.Mouse:if(W===e.MouseWheelX||W===e.MouseWheelY||W===e.MouseWheelZ)return this._CreateWheelEvent(V,p,W,N,d,E);case t.Touch:return this._CreatePointerEvent(V,p,W,N,d,E,z);default:throw`Unable to generate event for device ${t[V]}`}}static _CreatePointerEvent(V,p,W,N,d,E,z){const S=this._CreateMouseEvent(V,p,W,N,d,E);V===t.Mouse?(S.deviceType=t.Mouse,S.pointerId=1,S.pointerType="mouse"):(S.deviceType=t.Touch,S.pointerId=z??p,S.pointerType="touch");let Q=0;return Q+=d.pollInput(V,p,e.LeftClick),Q+=2*d.pollInput(V,p,e.RightClick),Q+=4*d.pollInput(V,p,e.MiddleClick),S.buttons=Q,W===e.Move?S.type="pointermove":W>=e.LeftClick&&W<=e.RightClick&&(S.type=1===N?"pointerdown":"pointerup",S.button=W-2),S}static _CreateWheelEvent(V,p,W,N,d,E){const z=this._CreateMouseEvent(V,p,W,N,d,E);switch(z.pointerId=1,z.type="wheel",z.deltaMode=T.b.DOM_DELTA_PIXEL,z.deltaX=0,z.deltaY=0,z.deltaZ=0,W){case e.MouseWheelX:z.deltaX=N;break;case e.MouseWheelY:z.deltaY=N;break;case e.MouseWheelZ:z.deltaZ=N}return z}static _CreateMouseEvent(V,p,W,N,d,E){const z=this._CreateEvent(E),S=d.pollInput(V,p,e.Horizontal),Q=d.pollInput(V,p,e.Vertical);return E?(z.movementX=0,z.movementY=0,z.offsetX=z.movementX-E.getBoundingClientRect().x,z.offsetY=z.movementY-E.getBoundingClientRect().y):(z.movementX=d.pollInput(V,p,10),z.movementY=d.pollInput(V,p,11),z.offsetX=0,z.offsetY=0),this._CheckNonCharacterKeys(z,d),z.clientX=S,z.clientY=Q,z.x=S,z.y=Q,z.deviceType=V,z.deviceSlot=p,z.inputIndex=W,z}static _CreateKeyboardEvent(V,p,W,N){const d=this._CreateEvent(N);return this._CheckNonCharacterKeys(d,W),d.deviceType=t.Keyboard,d.deviceSlot=0,d.inputIndex=V,d.type=1===p?"keydown":"keyup",d.key=String.fromCharCode(V),d.keyCode=V,d}static _CheckNonCharacterKeys(V,p){const W=p.isDeviceAvailable(t.Keyboard),N=W&&1===p.pollInput(t.Keyboard,0,18),d=W&&1===p.pollInput(t.Keyboard,0,17),E=W&&(1===p.pollInput(t.Keyboard,0,91)||1===p.pollInput(t.Keyboard,0,92)||1===p.pollInput(t.Keyboard,0,93)),z=W&&1===p.pollInput(t.Keyboard,0,16);V.altKey=N,V.ctrlKey=d,V.metaKey=E,V.shiftKey=z}static _CreateEvent(V){const p={preventDefault:()=>{}};return p.target=V,p}}class b{constructor(V,p,W){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(V,p,((V,p,N,d)=>{const E=P.CreateDeviceEvent(V,p,N,d,this);W(V,p,E)})):this._createDummyNativeInput()}pollInput(V,p,W){return this._nativeInput.pollInput(V,p,W)}isDeviceAvailable(V){return V===t.Mouse||V===t.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const s=Object.keys(e).length/2;class G{constructor(V,p,W,d){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=N.e.IsSafari(),this._usingMacOS=(0,U.j)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=V=>{},this._keyboardUpEvent=V=>{},this._keyboardBlurEvent=V=>{},this._pointerMoveEvent=V=>{},this._pointerDownEvent=V=>{},this._pointerUpEvent=V=>{},this._pointerCancelEvent=V=>{},this._pointerWheelEvent=V=>{},this._pointerBlurEvent=V=>{},this._pointerMacOSChromeOutEvent=V=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,U.j)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,U.j)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=V=>{},this._gamepadDisconnectedEvent=V=>{},this._eventPrefix=N.e.GetPointerPrefix(V),this._engine=V,this._onDeviceConnected=p,this._onDeviceDisconnected=W,this._onInputChanged=d,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(V,p,W){const d=this._inputs[V][p];if(!d)throw`Unable to find device ${t[V]}`;V>=t.DualShock&&V<=t.DualSense&&this._updateDevice(V,p,W);const E=d[W];if(void 0===E)throw`Unable to find input ${W} for device ${t[V]} in slot ${p}`;return W===e.Move&&N.e.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),E}isDeviceAvailable(V){return void 0!==this._inputs[V]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const V=null===this||void 0===this?void 0:this._engine.getInputElement();if(V&&(!this._eventsAttached||this._elementToAttachTo!==V)){if(this._disableEvents(),this._inputs)for(const V of this._inputs)if(V)for(const p in V){const W=V[+p];if(W)for(let V=0;V<W.length;V++)W[V]=0}this._elementToAttachTo=V,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const V=navigator.getGamepads();for(const p of V)p&&this._addGamePad(p)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(t.Mouse,0,0,0)}_addGamePad(V){const p=this._getGamepadDeviceType(V.id),W=V.index;this._gamepads=this._gamepads||new Array(V.index+1),this._registerDevice(p,W,V.buttons.length+V.axes.length),this._gamepads[W]=p}_addPointerDevice(V,p,W,N){this._pointerActive||(this._pointerActive=!0),this._registerDevice(V,p,s);const d=this._inputs[V][p];d[0]=W,d[1]=N}_registerDevice(V,p,W){if(void 0===p)throw`Unable to register device ${t[V]} to undefined slot.`;if(this._inputs[V]||(this._inputs[V]={}),!this._inputs[V][p]){const N=new Array(W);N.fill(0),this._inputs[V][p]=N,this._onDeviceConnected(V,p)}}_unregisterDevice(V,p){this._inputs[V][p]&&(delete this._inputs[V][p],this._onDeviceDisconnected(V,p))}_handleKeyActions(){this._keyboardDownEvent=V=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(t.Keyboard,0,255));const p=this._inputs[t.Keyboard][0];if(p){p[V.keyCode]=1;const W=V;W.inputIndex=V.keyCode,this._usingMacOS&&V.metaKey&&"Meta"!==V.key&&(this._metaKeys.includes(V.keyCode)||this._metaKeys.push(V.keyCode)),this._onInputChanged(t.Keyboard,0,W)}},this._keyboardUpEvent=V=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(t.Keyboard,0,255));const p=this._inputs[t.Keyboard][0];if(p){p[V.keyCode]=0;const W=V;if(W.inputIndex=V.keyCode,this._usingMacOS&&"Meta"===V.key&&this._metaKeys.length>0){for(const V of this._metaKeys){const W=P.CreateDeviceEvent(t.Keyboard,0,V,0,this,this._elementToAttachTo);p[V]=0,this._onInputChanged(t.Keyboard,0,W)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(t.Keyboard,0,W)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const V=this._inputs[t.Keyboard][0];for(let p=0;p<V.length;p++)if(0!==V[p]){V[p]=0;const W=P.CreateDeviceEvent(t.Keyboard,0,p,0,this,this._elementToAttachTo);this._onInputChanged(t.Keyboard,0,W)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,U.j)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let N=0;N<this._maxTouchPoints;N++)this._activeTouchIds[N]=-1;this._pointerMoveEvent=V=>{const p=this._getPointerType(V);let W=p===t.Mouse?0:this._activeTouchIds.indexOf(V.pointerId);if(p===t.Touch&&-1===W){const d=this._activeTouchIds.indexOf(-1);if(!(d>=0))return void N.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);W=d,this._activeTouchIds[d]=V.pointerId,this._onDeviceConnected(p,W)}this._inputs[p]||(this._inputs[p]={}),this._inputs[p][W]||this._addPointerDevice(p,W,V.clientX,V.clientY);const d=this._inputs[p][W];if(d){const N=V;N.inputIndex=e.Move,d[e.Horizontal]=V.clientX,d[e.Vertical]=V.clientY,p===t.Touch&&0===d[e.LeftClick]&&(d[e.LeftClick]=1),void 0===V.pointerId&&(V.pointerId=this._mouseId),this._onInputChanged(p,W,N),this._usingSafari||-1===V.button||(N.inputIndex=V.button+2,d[V.button+2]=d[V.button+2]?0:1,this._onInputChanged(p,W,N))}},this._pointerDownEvent=V=>{const p=this._getPointerType(V);let W=p===t.Mouse?0:V.pointerId;if(p===t.Touch){let p=this._activeTouchIds.indexOf(V.pointerId);if(-1===p&&(p=this._activeTouchIds.indexOf(-1)),!(p>=0))return void N.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);W=p,this._activeTouchIds[p]=V.pointerId}this._inputs[p]||(this._inputs[p]={}),this._inputs[p][W]?p===t.Touch&&this._onDeviceConnected(p,W):this._addPointerDevice(p,W,V.clientX,V.clientY);const d=this._inputs[p][W];if(d){const N=d[e.Horizontal],z=d[e.Vertical];if(p===t.Mouse){if(void 0===V.pointerId&&(V.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(E){}}else if(V.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(V.pointerId)}catch(E){}d[e.Horizontal]=V.clientX,d[e.Vertical]=V.clientY,d[V.button+2]=1;const S=V;S.inputIndex=V.button+2,this._onInputChanged(p,W,S),N===V.clientX&&z===V.clientY||(S.inputIndex=e.Move,this._onInputChanged(p,W,S))}},this._pointerUpEvent=V=>{var p;const W=this._getPointerType(V),N=W===t.Mouse?0:this._activeTouchIds.indexOf(V.pointerId);if(W===t.Touch){if(-1===N)return;this._activeTouchIds[N]=-1}const d=null===(p=this._inputs[W])||void 0===p?void 0:p[N];if(d&&0!==d[V.button+2]){var E,z,S,Q;const p=d[e.Horizontal],J=d[e.Vertical];d[e.Horizontal]=V.clientX,d[e.Vertical]=V.clientY,d[V.button+2]=0;const i=V;void 0===V.pointerId&&(V.pointerId=this._mouseId),p===V.clientX&&J===V.clientY||(i.inputIndex=e.Move,this._onInputChanged(W,N,i)),i.inputIndex=V.button+2,W===t.Mouse&&this._mouseId>=0&&null!==(E=(z=this._elementToAttachTo).hasPointerCapture)&&void 0!==E&&E.call(z,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):V.pointerId&&null!==(S=(Q=this._elementToAttachTo).hasPointerCapture)&&void 0!==S&&S.call(Q,V.pointerId)&&this._elementToAttachTo.releasePointerCapture(V.pointerId),this._onInputChanged(W,N,i),W===t.Touch&&this._onDeviceDisconnected(W,N)}},this._pointerCancelEvent=V=>{if("mouse"===V.pointerType){var p,W;const V=this._inputs[t.Mouse][0];this._mouseId>=0&&null!==(p=(W=this._elementToAttachTo).hasPointerCapture)&&void 0!==p&&p.call(W,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let p=e.LeftClick;p<=e.BrowserForward;p++)if(1===V[p]){V[p]=0;const W=P.CreateDeviceEvent(t.Mouse,0,p,0,this,this._elementToAttachTo);this._onInputChanged(t.Mouse,0,W)}}else{var N,d;const p=this._activeTouchIds.indexOf(V.pointerId);if(-1===p)return;null!==(N=(d=this._elementToAttachTo).hasPointerCapture)&&void 0!==N&&N.call(d,V.pointerId)&&this._elementToAttachTo.releasePointerCapture(V.pointerId),this._inputs[t.Touch][p][e.LeftClick]=0;const W=P.CreateDeviceEvent(t.Touch,p,e.LeftClick,0,this,this._elementToAttachTo,V.pointerId);this._onInputChanged(t.Touch,p,W),this._activeTouchIds[p]=-1,this._onDeviceDisconnected(t.Touch,p)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let V=!1;const p=function(){};try{const W=Object.defineProperty({},"passive",{get:function(){V=!0}});this._elementToAttachTo.addEventListener("test",p,W),this._elementToAttachTo.removeEventListener("test",p,W)}catch(W){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(t.Mouse)){var V,p;const W=this._inputs[t.Mouse][0];this._mouseId>=0&&null!==(V=(p=this._elementToAttachTo).hasPointerCapture)&&void 0!==V&&V.call(p,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let V=e.LeftClick;V<=e.BrowserForward;V++)if(1===W[V]){W[V]=0;const p=P.CreateDeviceEvent(t.Mouse,0,V,0,this,this._elementToAttachTo);this._onInputChanged(t.Mouse,0,p)}}if(this.isDeviceAvailable(t.Touch)){const V=this._inputs[t.Touch];for(let p=0;p<this._activeTouchIds.length;p++){var W,N,d;const E=this._activeTouchIds[p];if(null!==(W=(N=this._elementToAttachTo).hasPointerCapture)&&void 0!==W&&W.call(N,E)&&this._elementToAttachTo.releasePointerCapture(E),-1!==E&&1===(null===(d=V[p])||void 0===d?void 0:d[e.LeftClick])){V[p][e.LeftClick]=0;const W=P.CreateDeviceEvent(t.Touch,p,e.LeftClick,0,this,this._elementToAttachTo,E);this._onInputChanged(t.Touch,p,W),this._activeTouchIds[p]=-1,this._onDeviceDisconnected(t.Touch,p)}}}},this._pointerWheelEvent=V=>{const p=t.Mouse;this._inputs[p]||(this._inputs[p]=[]),this._inputs[p][0]||(this._pointerActive=!0,this._registerDevice(p,0,s));const W=this._inputs[p][0];if(W){W[e.MouseWheelX]=V.deltaX||0,W[e.MouseWheelY]=V.deltaY||V.wheelDelta||0,W[e.MouseWheelZ]=V.deltaZ||0;const N=V;void 0===V.pointerId&&(V.pointerId=this._mouseId),0!==W[e.MouseWheelX]&&(N.inputIndex=e.MouseWheelX,this._onInputChanged(p,0,N)),0!==W[e.MouseWheelY]&&(N.inputIndex=e.MouseWheelY,this._onInputChanged(p,0,N)),0!==W[e.MouseWheelZ]&&(N.inputIndex=e.MouseWheelZ,this._onInputChanged(p,0,N))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=V=>{V.buttons>1&&this._pointerCancelEvent(V)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!V&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(t.Mouse)){const V=this._inputs[t.Mouse][0];V[e.MouseWheelX]=0,V[e.MouseWheelY]=0,V[e.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=V=>{this._addGamePad(V.gamepad)},this._gamepadDisconnectedEvent=V=>{if(this._gamepads){const p=this._getGamepadDeviceType(V.gamepad.id),W=V.gamepad.index;this._unregisterDevice(p,W),delete this._gamepads[W]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(V,p,W){const N=navigator.getGamepads()[p];if(N&&V===this._gamepads[p]){const d=this._inputs[V][p];W>=N.buttons.length?d[W]=N.axes[W-N.buttons.length].valueOf():d[W]=N.buttons[W].value}}_getGamepadDeviceType(V){return-1!==V.indexOf("054c")?-1!==V.indexOf("0ce6")?t.DualSense:t.DualShock:-1!==V.indexOf("Xbox One")||-1!==V.search("Xbox 360")||-1!==V.search("xinput")?t.Xbox:-1!==V.indexOf("057e")?t.Switch:t.Generic}_getPointerType(V){let p=t.Mouse;return("touch"===V.pointerType||"pen"===V.pointerType||V.touches)&&(p=t.Touch),p}}class R{constructor(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=p,this.deviceSlot=W,this.onInputChangedObservable=new E.b,this._deviceInputSystem=V}getInput(V){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,V)}}class X{constructor(V){this._registeredManagers=new Array,this._refCount=0,this.registerManager=V=>{for(let p=0;p<this._devices.length;p++){const W=this._devices[p];for(const N in W){const W=+N;V._addDevice(new R(this._deviceInputSystem,p,W))}}this._registeredManagers.push(V)},this.unregisterManager=V=>{const p=this._registeredManagers.indexOf(V);p>-1&&this._registeredManagers.splice(p,1)};const p=Object.keys(t).length/2;this._devices=new Array(p);const W=(V,p)=>{this._devices[V]||(this._devices[V]=new Array),this._devices[V][p]||(this._devices[V][p]=p);for(const W of this._registeredManagers){const N=new R(this._deviceInputSystem,V,p);W._addDevice(N)}},N=(V,p)=>{var W;null!==(W=this._devices[V])&&void 0!==W&&W[p]&&delete this._devices[V][p];for(const N of this._registeredManagers)N._removeDevice(V,p)},d=(V,p,W)=>{if(W)for(const N of this._registeredManagers)N._onInputChanged(V,p,W)};"undefined"!==typeof _native?this._deviceInputSystem=new b(W,N,d):this._deviceInputSystem=new G(V,W,N,d)}dispose(){this._deviceInputSystem.dispose()}}class r{getDeviceSource(V,p){if(void 0===p){if(void 0===this._firstDevice[V])return null;p=this._firstDevice[V]}return this._devices[V]&&void 0!==this._devices[V][p]?this._devices[V][p]:null}getDeviceSources(V){return this._devices[V]?this._devices[V].filter((V=>!!V)):[]}constructor(V){const p=Object.keys(t).length/2;this._devices=new Array(p),this._firstDevice=new Array(p),this._engine=V,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new X(V)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new E.b((V=>{for(const p of this._devices)if(p)for(const W of p)W&&this.onDeviceConnectedObservable.notifyObserver(V,W)})),this.onDeviceDisconnectedObservable=new E.b,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=V.$i.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.$i.remove(this._onDisposeObserver)}_addDevice(V){this._devices[V.deviceType]||(this._devices[V.deviceType]=new Array),this._devices[V.deviceType][V.deviceSlot]||(this._devices[V.deviceType][V.deviceSlot]=V,this._updateFirstDevices(V.deviceType)),this.onDeviceConnectedObservable.notifyObservers(V)}_removeDevice(V,p){var W,N;const d=null===(W=this._devices[V])||void 0===W?void 0:W[p];this.onDeviceDisconnectedObservable.notifyObservers(d),null!==(N=this._devices[V])&&void 0!==N&&N[p]&&delete this._devices[V][p],this._updateFirstDevices(V)}_onInputChanged(V,p,W){var N,d;null===(N=this._devices[V])||void 0===N||null===(d=N[p])||void 0===d||d.onInputChangedObservable.notifyObservers(W)}_updateFirstDevices(V){switch(V){case t.Keyboard:case t.Mouse:this._firstDevice[V]=0;break;case t.Touch:case t.DualSense:case t.DualShock:case t.Xbox:case t.Switch:case t.Generic:{delete this._firstDevice[V];const p=this._devices[V];if(p)for(let W=0;W<p.length;W++)if(p[W]){this._firstDevice[V]=W;break}break}}}}var B=W(11343);class Y{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(V){this._singleClick=V}set doubleClick(V){this._doubleClick=V}set hasSwiped(V){this._hasSwiped=V}set ignore(V){this._ignore=V}}class I{constructor(V){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new J.k(0,0),this._previousStartingPointerPosition=new J.k(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=V||F.d.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(V){return this._meshUnderPointerId[V]||null}get unTranslatedPointer(){return new J.k(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(V){this._pointerX=V}get pointerY(){return this._pointerY}set pointerY(V){this._pointerY=V}_updatePointerPosition(V){const p=this._scene.getEngine().getInputElementClientRect();p&&(this._pointerX=V.clientX-p.left,this._pointerY=V.clientY-p.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(V,p){const W=this._scene,N=W.getEngine(),d=N.getInputElement();d&&(d.tabIndex=N.canvasTabIndex,W.doNotHandleCursors||(d.style.cursor=W.defaultCursor)),this._setCursorAndPointerOverMesh(V,p,W);for(const Q of W._pointerMoveStage){var E;const W=!(null===(E=V=V||this._pickMove(p))||void 0===E||!E.pickedMesh);V=Q.action(this._unTranslatedPointerX,this._unTranslatedPointerY,V,W,d)}const z=p.inputIndex>=e.MouseWheelX&&p.inputIndex<=e.MouseWheelZ?A.d.POINTERWHEEL:A.d.POINTERMOVE;let S;W.onPointerMove&&(V=V||this._pickMove(p),W.onPointerMove(p,V,z)),V?(S=new A.j(z,p,V),this._setRayOnPointerInfo(V,p)):(S=new A.j(z,p,null,this),this._movePointerInfo=S),W.onPointerObservable.hasObservers()&&W.onPointerObservable.notifyObservers(S,z)}_setRayOnPointerInfo(V,p){const W=this._scene;V&&B.e._IsPickingAvailable&&(V.ray||(V.ray=W.createPickingRay(p.offsetX,p.offsetY,J.e.Identity(),W.activeCamera)))}_addCameraPointerObserver(V,p){return this._cameraObserverCount++,this._scene.onPointerObservable.add(V,p)}_removeCameraPointerObserver(V){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(V)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(V,p,W){const N=this._scene,d=new A.h(W,p,this._unTranslatedPointerX,this._unTranslatedPointerY);return V&&(d.originalPickingInfo=V,d.ray=V.ray,"xr-near"===p.pointerType&&V.originMesh&&(d.nearInteractionPickingInfo=V)),N.onPrePointerObservable.notifyObservers(d,W),!!d.skipOnPointerObservable}_pickMove(V){const p=this._scene,W=p.dd(this._unTranslatedPointerX,this._unTranslatedPointerY,p.pointerMovePredicate,p.pointerMoveFastCheck,p.cameraToUseForPointers,p.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(W,V,p),W}_setCursorAndPointerOverMesh(V,p,W){const N=W.getEngine().getInputElement();if(null!==V&&void 0!==V&&V.pickedMesh){if(this.setPointerOverMesh(V.pickedMesh,p.pointerId,V,p),!W.doNotHandleCursors&&N&&this._pointerOverMesh){const V=this._pointerOverMesh._getActionManagerForTrigger();V&&V.hasPointerTriggers&&(N.style.cursor=V.hoverCursor||W.hoverCursor)}}else this.setPointerOverMesh(null,p.pointerId,V,p)}simulatePointerMove(V,p){const W=new PointerEvent("pointermove",p);W.inputIndex=e.Move,this._checkPrePointerObservable(V,W,A.d.POINTERMOVE)||this._processPointerMove(V,W)}simulatePointerDown(V,p){const W=new PointerEvent("pointerdown",p);W.inputIndex=W.button+2,this._checkPrePointerObservable(V,W,A.d.POINTERDOWN)||this._processPointerDown(V,W)}_processPointerDown(V,p){var W;const N=this._scene;if(null!==(W=V)&&void 0!==W&&W.pickedMesh){this._pickedDownMesh=V.pickedMesh;const W=V.pickedMesh._getActionManagerForTrigger();if(W){if(W.hasPickTriggers)switch(W.processTrigger(5,k.CreateNew(V.pickedMesh,p,V)),p.button){case 0:W.processTrigger(2,k.CreateNew(V.pickedMesh,p,V));break;case 1:W.processTrigger(4,k.CreateNew(V.pickedMesh,p,V));break;case 2:W.processTrigger(3,k.CreateNew(V.pickedMesh,p,V))}W.hasSpecificTrigger(8)&&window.setTimeout((()=>{const V=N.dd(this._unTranslatedPointerX,this._unTranslatedPointerY,(V=>V.sb&&V.isVisible&&V.isReady()&&V.actionManager&&V.actionManager.hasSpecificTrigger(8)&&V===this._pickedDownMesh),!1,N.cameraToUseForPointers);null!==V&&void 0!==V&&V.pickedMesh&&W&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>I.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,W.processTrigger(8,k.CreateNew(V.pickedMesh,p)))}),I.LongPressDelay)}}else for(const z of N._pointerDownStage)V=z.action(this._unTranslatedPointerX,this._unTranslatedPointerY,V,p,!1);let d;const E=A.d.POINTERDOWN;V?(N.onPointerDown&&N.onPointerDown(p,V,E),d=new A.j(E,p,V),this._setRayOnPointerInfo(V,p)):d=new A.j(E,p,null,this),N.onPointerObservable.hasObservers()&&N.onPointerObservable.notifyObservers(d,E)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(V,p,W){const N=new PointerEvent("pointerup",p);N.inputIndex=e.Move;const d=new Y;W?d.doubleClick=!0:d.singleClick=!0,this._checkPrePointerObservable(V,N,A.d.POINTERUP)||this._processPointerUp(V,N,d)}_processPointerUp(V,p,W){var N;const d=this._scene;if(null!==(N=V)&&void 0!==N&&N.pickedMesh){if(this._pickedUpMesh=V.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(d.onPointerPick&&d.onPointerPick(p,V),W.singleClick&&!W.ignore&&d.onPointerObservable.observers.length>this._cameraObserverCount)){const W=A.d.POINTERPICK,N=new A.j(W,p,V);this._setRayOnPointerInfo(V,p),d.onPointerObservable.notifyObservers(N,W)}const N=V.pickedMesh._getActionManagerForTrigger();if(N&&!W.ignore){N.processTrigger(7,k.CreateNew(V.pickedMesh,p,V)),!W.hasSwiped&&W.singleClick&&N.processTrigger(1,k.CreateNew(V.pickedMesh,p,V));const d=V.pickedMesh._getActionManagerForTrigger(6);W.doubleClick&&d&&d.processTrigger(6,k.CreateNew(V.pickedMesh,p,V))}}else if(!W.ignore)for(const E of d._pointerUpStage)V=E.action(this._unTranslatedPointerX,this._unTranslatedPointerY,V,p,W.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const V=this._pickedDownMesh._getActionManagerForTrigger(16);V&&V.processTrigger(16,k.CreateNew(this._pickedDownMesh,p))}if(!W.ignore){const N=new A.j(A.d.POINTERUP,p,V);if(this._setRayOnPointerInfo(V,p),d.onPointerObservable.notifyObservers(N,A.d.POINTERUP),d.onPointerUp&&d.onPointerUp(p,V,A.d.POINTERUP),!W.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let N=0;if(W.singleClick?N=A.d.POINTERTAP:W.doubleClick&&(N=A.d.POINTERDOUBLETAP),N){const W=new A.j(N,p,V);d.onPointerObservable.hasObservers()&&d.onPointerObservable.hasSpecificMask(N)&&d.onPointerObservable.notifyObservers(W,N)}}}}isPointerCaptured(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[V]}attachControl(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const d=this._scene,E=d.getEngine();N||(N=E.getInputElement()),this._alreadyAttached&&this.Hi(),N&&(this._alreadyAttachedTo=N),this._deviceSourceManager=new r(E),this._initActionManager=V=>{if(!this._meshPickProceed){const p=d.skipPointerUpPicking||0===d._registeredActions&&!this._checkForPicking()&&!d.onPointerUp?null:d.dd(this._unTranslatedPointerX,this._unTranslatedPointerY,d.pointerUpPredicate,d.pointerUpFastCheck,d.cameraToUseForPointers,d.pointerUpTrianglePredicate);this._currentPickResult=p,p&&(V=p.hit&&p.pickedMesh?p.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return V},this._delayedSimpleClick=(V,p,W)=>{if((Date.now()-this._previousStartingPointerTime>I.DoubleClickDelay&&!this._doubleClickOccured||V!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,p.singleClick=!0,p.ignore=!1,this._delayedClicks[V])){const p=this._delayedClicks[V].evt,W=A.d.POINTERTAP,N=new A.j(W,p,this._currentPickResult);d.onPointerObservable.hasObservers()&&d.onPointerObservable.hasSpecificMask(W)&&d.onPointerObservable.notifyObservers(N,W),this._delayedClicks[V]=null}},this._initClickEvent=(V,p,W,N)=>{const d=new Y;this._currentPickResult=null;let E=null,z=V.hasSpecificMask(A.d.POINTERPICK)||p.hasSpecificMask(A.d.POINTERPICK)||V.hasSpecificMask(A.d.POINTERTAP)||p.hasSpecificMask(A.d.POINTERTAP)||V.hasSpecificMask(A.d.POINTERDOUBLETAP)||p.hasSpecificMask(A.d.POINTERDOUBLETAP);!z&&v&&(E=this._initActionManager(E,d),E&&(z=E.hasPickTriggers));let S=!1;if(z){const z=W.button;if(d.hasSwiped=this._isPointerSwiping(),!d.hasSwiped){let i=!I.ExclusiveDoubleClickMode;if(i||(i=!V.hasSpecificMask(A.d.POINTERDOUBLETAP)&&!p.hasSpecificMask(A.d.POINTERDOUBLETAP),i&&!v.HasSpecificTrigger(6)&&(E=this._initActionManager(E,d),E&&(i=!E.hasSpecificTrigger(6)))),i)(Date.now()-this._previousStartingPointerTime>I.DoubleClickDelay||z!==this._previousButtonPressed)&&(d.singleClick=!0,N(d,this._currentPickResult),S=!0);else{const V={evt:W,clickInfo:d,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,z,d,N),I.DoubleClickDelay)};this._delayedClicks[z]=V}let l=V.hasSpecificMask(A.d.POINTERDOUBLETAP)||p.hasSpecificMask(A.d.POINTERDOUBLETAP);if(!l&&v.HasSpecificTrigger(6)&&(E=this._initActionManager(E,d),E&&(l=E.hasSpecificTrigger(6))),l)if(z===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<I.DoubleClickDelay&&!this._doubleClickOccured){if(d.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=z,I.ExclusiveDoubleClickMode){var Q;if(this._delayedClicks[z])clearTimeout(null===(Q=this._delayedClicks[z])||void 0===Q?void 0:Q.timeoutId),this._delayedClicks[z]=null;N(d,this._previousPickResult)}else N(d,this._currentPickResult);else{var J;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,d.doubleClick=!0,d.ignore=!1,I.ExclusiveDoubleClickMode&&this._delayedClicks[z])clearTimeout(null===(J=this._delayedClicks[z])||void 0===J?void 0:J.timeoutId),this._delayedClicks[z]=null;N(d,this._currentPickResult)}S=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=z}}S||N(d,this._currentPickResult)},this._onPointerMove=V=>{if(this._updatePointerPosition(V),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>I.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>I.DragMovementThreshold),E.isPointerLock&&E._verifyPointerLock(),this._checkPrePointerObservable(null,V,V.inputIndex>=e.MouseWheelX&&V.inputIndex<=e.MouseWheelZ?A.d.POINTERWHEEL:A.d.POINTERMOVE))return;if(!d.cameraToUseForPointers&&!d.activeCamera)return;if(d.Qi)return void this._processPointerMove(new j.e,V);d.pointerMovePredicate||(d.pointerMovePredicate=V=>V.sb&&V.isVisible&&V.isReady()&&V.isEnabled()&&(V.enablePointerMoveEvents||d.constantlyUpdateMeshUnderPointer||null!==V._getActionManagerForTrigger())&&(!d.cameraToUseForPointers||0!==(d.cameraToUseForPointers.layerMask&V.layerMask)));const p=d._registeredActions>0||d.constantlyUpdateMeshUnderPointer?this._pickMove(V):null;this._processPointerMove(p,V)},this._onPointerDown=V=>{const p=this._activePointerIds.indexOf(-1);if(-1===p?this._activePointerIds.push(V.pointerId):this._activePointerIds[p]=V.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,I.ExclusiveDoubleClickMode)for(let N=0;N<this._delayedClicks.length;N++)if(this._delayedClicks[N])if(V.button===N){var W;clearTimeout(null===(W=this._delayedClicks[N])||void 0===W?void 0:W.timeoutId)}else{const V=this._delayedClicks[N].clickInfo;this._doubleClickOccured=!1,V.singleClick=!0,V.ignore=!1;const p=this._delayedClicks[N].evt,W=A.d.POINTERTAP,E=new A.j(W,p,this._currentPickResult);d.onPointerObservable.hasObservers()&&d.onPointerObservable.hasSpecificMask(W)&&d.onPointerObservable.notifyObservers(E,W),this._delayedClicks[N]=null}if(this._updatePointerPosition(V),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=V.button),d.preventDefaultOnPointerDown&&N&&(V.preventDefault(),N.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,V,A.d.POINTERDOWN))return;if(!d.cameraToUseForPointers&&!d.activeCamera)return;let E;this._pointerCaptures[V.pointerId]=!0,d.pointerDownPredicate||(d.pointerDownPredicate=V=>V.sb&&V.isVisible&&V.isReady()&&V.isEnabled()&&(!d.cameraToUseForPointers||0!==(d.cameraToUseForPointers.layerMask&V.layerMask))),this._pickedDownMesh=null,E=d.skipPointerDownPicking||0===d._registeredActions&&!this._checkForPicking()&&!d.onPointerDown?new j.e:d.dd(this._unTranslatedPointerX,this._unTranslatedPointerY,d.pointerDownPredicate,d.pointerDownFastCheck,d.cameraToUseForPointers,d.pointerDownTrianglePredicate),this._processPointerDown(E,V)},this._onPointerUp=V=>{const p=this._activePointerIds.indexOf(V.pointerId);-1!==p&&(this._activePointerIds[p]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(V),d.preventDefaultOnPointerUp&&N&&(V.preventDefault(),N.focus()),this._initClickEvent(d.onPrePointerObservable,d.onPointerObservable,V,((p,W)=>{if(d.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!p.ignore)){if(this._checkPrePointerObservable(null,V,A.d.POINTERUP))return this._swipeButtonPressed===V.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===V.buttons&&(this._pointerCaptures[V.pointerId]=!1));p.hasSwiped||(p.singleClick&&d.onPrePointerObservable.hasSpecificMask(A.d.POINTERTAP)&&this._checkPrePointerObservable(null,V,A.d.POINTERTAP)&&(this._skipPointerTap=!0),p.doubleClick&&d.onPrePointerObservable.hasSpecificMask(A.d.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,V,A.d.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[V.pointerId]?(0===V.buttons&&(this._pointerCaptures[V.pointerId]=!1),(d.cameraToUseForPointers||d.activeCamera)&&(d.pointerUpPredicate||(d.pointerUpPredicate=V=>V.sb&&V.isVisible&&V.isReady()&&V.isEnabled()&&(!d.cameraToUseForPointers||0!==(d.cameraToUseForPointers.layerMask&V.layerMask))),!this._meshPickProceed&&(v&&v.HasTriggers||this._checkForPicking()||d.onPointerUp)&&this._initActionManager(null,p),W||(W=this._currentPickResult),this._processPointerUp(W,V,p),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===V.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===V.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=V=>{const p=x.e.KEYDOWN;if(d.onPreKeyboardObservable.hasObservers()){const W=new x.f(p,V);if(d.onPreKeyboardObservable.notifyObservers(W,p),W.skipOnKeyboardObservable)return}if(d.onKeyboardObservable.hasObservers()){const W=new x.g(p,V);d.onKeyboardObservable.notifyObservers(W,p)}d.actionManager&&d.actionManager.processTrigger(14,k.CreateNewFromScene(d,V))},this._onKeyUp=V=>{const p=x.e.KEYUP;if(d.onPreKeyboardObservable.hasObservers()){const W=new x.f(p,V);if(d.onPreKeyboardObservable.notifyObservers(W,p),W.skipOnKeyboardObservable)return}if(d.onKeyboardObservable.hasObservers()){const W=new x.g(p,V);d.onKeyboardObservable.notifyObservers(W,p)}d.actionManager&&d.actionManager.processTrigger(15,k.CreateNewFromScene(d,V))},this._deviceSourceManager.onDeviceConnectedObservable.add((N=>{N.deviceType===t.Mouse?N.onInputChangedObservable.add((d=>{this._originMouseEvent=d,d.inputIndex===e.LeftClick||d.inputIndex===e.MiddleClick||d.inputIndex===e.RightClick||d.inputIndex===e.BrowserBack||d.inputIndex===e.BrowserForward?p&&1===N.getInput(d.inputIndex)?this._onPointerDown(d):V&&0===N.getInput(d.inputIndex)&&this._onPointerUp(d):W&&(d.inputIndex===e.Move?this._onPointerMove(d):d.inputIndex!==e.MouseWheelX&&d.inputIndex!==e.MouseWheelY&&d.inputIndex!==e.MouseWheelZ||this._onPointerMove(d))})):N.deviceType===t.Touch?N.onInputChangedObservable.add((d=>{d.inputIndex===e.LeftClick&&(p&&1===N.getInput(d.inputIndex)?(this._onPointerDown(d),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):V&&0===N.getInput(d.inputIndex)&&(this._onPointerUp(d),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),W&&d.inputIndex===e.Move&&this._onPointerMove(d)})):N.deviceType===t.Keyboard&&N.onInputChangedObservable.add((V=>{"keydown"===V.type?this._onKeyDown(V):"keyup"===V.type&&this._onKeyUp(V)}))})),this._alreadyAttached=!0}Hi(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[p]===V&&(!V||!V._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const d=this._meshUnderPointerId[p];let E;d&&(E=d._getActionManagerForTrigger(10),E&&E.processTrigger(10,k.CreateNew(d,N,{pointerId:p}))),V?(this._meshUnderPointerId[p]=V,this._pointerOverMesh=V,E=V._getActionManagerForTrigger(9),E&&E.processTrigger(9,k.CreateNew(V,N,{pointerId:p,pickResult:W}))):(delete this._meshUnderPointerId[p],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(V){this._pointerOverMesh===V&&(this._pointerOverMesh=null),this._pickedDownMesh===V&&(this._pickedDownMesh=null),this._pickedUpMesh===V&&(this._pickedUpMesh=null);for(const p in this._meshUnderPointerId)this._meshUnderPointerId[p]===V&&delete this._meshUnderPointerId[p]}}I.DragMovementThreshold=10,I.LongPressDelay=500,I.DoubleClickDelay=300,I.ExclusiveDoubleClickMode=!1;var c=W(11019),q=W(11257),g=W(11352),D=W(11366),H=W(10902),m=W(11373),M=W(11233);class a{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.Qi=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var y,n=W(10870),w=W(11004);!function(V){V[V.BackwardCompatible=0]="BackwardCompatible",V[V.Intermediate=1]="Intermediate",V[V.Aggressive=2]="Aggressive"}(y||(y={}));class VV{static DefaultMaterialFactory(V){throw(0,C.c)("mb")}static CollisionCoordinatorFactory(){throw(0,C.c)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(V){V!==this._clearColor&&(this._clearColor=V,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(V){if(V!==this._performancePriority){switch(this._performancePriority=V,V){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Qi=!1,this.Ii=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Qi=!0,this.Ii=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.Qi=!0,this.Ii=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(V)}}set forceWireframe(V){this._forceWireframe!==V&&(this._forceWireframe=V,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(V){this._skipFrustumClipping!==V&&(this._skipFrustumClipping=V)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(V){this._forcePointsCloud!==V&&(this._forcePointsCloud=V,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(V){this._environmentTexture!==V&&(this._environmentTexture=V,this.markAllMaterialsAsDirty(1))}getNodes(){let V=[];return V=V.concat(this.meshes),V=V.concat(this.lights),V=V.concat(this.cameras),V=V.concat(this.transformNodes),this.skeletons.forEach((p=>V=V.concat(p.bones))),V}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(V){this._animationPropertiesOverride=V}set onDispose(V){this._onDisposeObserver&&this.$i.remove(this._onDisposeObserver),this._onDisposeObserver=this.$i.add(V)}set beforeRender(V){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),V&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(V))}set afterRender(V){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),V&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(V))}set beforeCameraRender(V){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(V)}set afterCameraRender(V){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(V)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(V){this._pointerPickingConfiguration.pointerDownPredicate=V}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(V){this._pointerPickingConfiguration.pointerUpPredicate=V}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(V){this._pointerPickingConfiguration.pointerMovePredicate=V}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(V){this._pointerPickingConfiguration.pointerDownFastCheck=V}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(V){this._pointerPickingConfiguration.pointerUpFastCheck=V}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(V){this._pointerPickingConfiguration.pointerMoveFastCheck=V}get Qi(){return this._pointerPickingConfiguration.Qi}set Qi(V){this._pointerPickingConfiguration.Qi=V}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(V){this._pointerPickingConfiguration.skipPointerDownPicking=V}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(V){this._pointerPickingConfiguration.skipPointerUpPicking=V}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return I.DragMovementThreshold}static set DragMovementThreshold(V){I.DragMovementThreshold=V}static get LongPressDelay(){return I.LongPressDelay}static set LongPressDelay(V){I.LongPressDelay=V}static get DoubleClickDelay(){return I.DoubleClickDelay}static set DoubleClickDelay(V){I.DoubleClickDelay=V}static get ExclusiveDoubleClickMode(){return I.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(V){I.ExclusiveDoubleClickMode=V}bindEyePosition(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const N=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,d=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return J.i.Vector4[0].set(N.x,N.y,N.z,d?-1:1),V&&(W?V.setFloat3(p,J.i.Vector4[0].x,J.i.Vector4[0].y,J.i.Vector4[0].z):V.setVector4(p,J.i.Vector4[0])),J.i.Vector4[0]}finalizeSceneUbo(){const V=this.getSceneUniformBuffer(),p=this.bindEyePosition(null);return V.updateFloat4("vEyePosition",p.x,p.y,p.z,p.w),V.update(),V}set useRightHandedSystem(V){this._useRightHandedSystem!==V&&(this._useRightHandedSystem=V,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(V){this._currentStepId=V}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(V){this._fogEnabled!==V&&(this._fogEnabled=V,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(V){this._fogMode!==V&&(this._fogMode=V,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(V){this._shadowsEnabled!==V&&(this._shadowsEnabled=V,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(V){this._lightsEnabled!==V&&(this._lightsEnabled=V,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(V){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),V&&(this._unObserveActiveCameras=(0,M.h)(V,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=V}get activeCamera(){return this._activeCamera}set activeCamera(V){V!==this._activeCamera&&(this._activeCamera=V,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this.ji||(this.ji=VV.DefaultMaterialFactory(this)),this.ji}set defaultMaterial(V){this.ji=V}set texturesEnabled(V){this._texturesEnabled!==V&&(this._texturesEnabled=V,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(V){if(this._frameGraph)return this._frameGraph=V,void(V||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=V,V&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(V){this._skeletonsEnabled!==V&&(this._skeletonsEnabled=V,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=VV.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const V of this._transientComponents)V.register();this._transientComponents.length=0}}o(V){this._components.push(V),this._transientComponents.push(V);const p=V;p.addFromContainer&&p.serialize&&this._serializableComponents.push(p)}_getComponent(V){for(const p of this._components)if(p.name===V)return p;return null}constructor(V,p){this._inputManager=new I(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Ii=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new q.e(.2,.2,.3,1),this.onClearColorChangedObservable=new E.b,this.ambientColor=new q.c(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new E.b,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.fj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.Qj=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.$i=new E.b,this._onDisposeObserver=null,this.onBeforeRenderObservable=new E.b,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new E.b,this.onAfterRenderCameraObservable=new E.b,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new E.b,this.onAfterAnimationsObservable=new E.b,this.onBeforeDrawPhaseObservable=new E.b,this.onAfterDrawPhaseObservable=new E.b,this.onReadyObservable=new E.b,this.onBeforeCameraRenderObservable=new E.b,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new E.b,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new E.b,this.onAfterActiveMeshesEvaluationObservable=new E.b,this.onBeforeParticlesRenderingObservable=new E.b,this.onAfterParticlesRenderingObservable=new E.b,this.onDataLoadedObservable=new E.b,this.onNewCameraAddedObservable=new E.b,this.onCameraRemovedObservable=new E.b,this.onNewLightAddedObservable=new E.b,this.onLightRemovedObservable=new E.b,this.onNewGeometryAddedObservable=new E.b,this.onGeometryRemovedObservable=new E.b,this.onNewTransformNodeAddedObservable=new E.b,this.onTransformNodeRemovedObservable=new E.b,this.onNewMeshAddedObservable=new E.b,this.onMeshRemovedObservable=new E.b,this.onNewSkeletonAddedObservable=new E.b,this.onSkeletonRemovedObservable=new E.b,this.onNewMaterialAddedObservable=new E.b,this.onNewMultiMaterialAddedObservable=new E.b,this.onMaterialRemovedObservable=new E.b,this.onMultiMaterialRemovedObservable=new E.b,this.onNewTextureAddedObservable=new E.b,this.onTextureRemovedObservable=new E.b,this.onBeforeRenderTargetsRenderObservable=new E.b,this.onAfterRenderTargetsRenderObservable=new E.b,this.onBeforeStepObservable=new E.b,this.onAfterStepObservable=new E.b,this.onActiveCameraChanged=new E.b,this.onActiveCamerasChanged=new E.b,this.onBeforeRenderingGroupObservable=new E.b,this.onAfterRenderingGroupObservable=new E.b,this.onMeshImportedObservable=new E.b,this.onAnimationFileImportedObservable=new E.b,this._registeredForLateAnimationBindings=new z.d(256),this._pointerPickingConfiguration=new a,this.onPrePointerObservable=new E.b,this.onPointerObservable=new E.b,this.onPreKeyboardObservable=new E.b,this.onKeyboardObservable=new E.b,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=VV.FOGMODE_NONE,this.fogColor=new q.c(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new J.n(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new z.d(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new c.b,this._activeIndices=new c.b,this._activeParticles=new c.b,this._activeBones=new c.b,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new z.f(256),this._processedMaterials=new z.f(256),this._renderTargets=new z.d(256),this._materialsRenderTargets=new z.d(256),this._activeParticleSystems=new z.f(256),this._activeSkeletons=new z.d(32),this._softwareSkinnedMeshes=new z.d(32),this._activeAnimatables=new Array,this._transformMatrix=J.e.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=O.g.Create(),this._beforeClearStage=O.g.Create(),this._beforeRenderTargetClearStage=O.g.Create(),this._gatherRenderTargetsStage=O.g.Create(),this._gatherActiveCameraRenderTargetsStage=O.g.Create(),this._isReadyForMeshStage=O.g.Create(),this._beforeEvaluateActiveMeshStage=O.g.Create(),this._evaluateSubMeshStage=O.g.Create(),this._preActiveMeshStage=O.g.Create(),this._cameraDrawRenderTargetStage=O.g.Create(),this._beforeCameraDrawStage=O.g.Create(),this._beforeRenderTargetDrawStage=O.g.Create(),this._beforeRenderingGroupDrawStage=O.g.Create(),this._beforeRenderingMeshStage=O.g.Create(),this._afterRenderingMeshStage=O.g.Create(),this._afterRenderingGroupDrawStage=O.g.Create(),this._afterCameraDrawStage=O.g.Create(),this._afterCameraPostProcessStage=O.g.Create(),this._afterRenderTargetDrawStage=O.g.Create(),this._afterRenderTargetPostProcessStage=O.g.Create(),this._afterRenderStage=O.g.Create(),this._pointerMoveStage=O.g.Create(),this._pointerDownStage=O.g.Create(),this._pointerUpStage=O.g.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const W={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...p};V=this._engine=V||F.d.LastCreatedEngine,W.virtual?V._virtualScenes.push(this):(F.d._LastCreatedScene=this,V.scenes.push(this)),this._uid=null,this._renderingManager=new f.e(this),u.c&&(this.postProcessManager=new u.c(this)),(0,U.l)()&&this.attachControl(),this._createUbo(),i.c&&(this._imageProcessingConfiguration=new i.c),this.setDefaultCandidateProviders(),W.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=W.useMaterialMeshMap,this.useClonedMeshMap=W.useClonedMeshMap,p&&p.virtual||V.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(V){return this._defaultSubMeshCandidates.data=V.dg,this._defaultSubMeshCandidates.length=V.dg.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=V=>this._getDefaultSubMeshCandidates(V),this.getIntersectingSubMeshCandidates=(V,p)=>this._getDefaultSubMeshCandidates(V),this.getCollidingSubMeshCandidates=(V,p)=>this._getDefaultSubMeshCandidates(V)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(V){this._inputManager.pointerX=V}get pointerY(){return this._inputManager.pointerY}set pointerY(V){this._inputManager.pointerY=V}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==p||this._cachedMaterial!==V||this._cachedVisibility!==W}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(V,p){return this._inputManager.simulatePointerMove(V,p),this}simulatePointerDown(V,p){return this._inputManager.simulatePointerDown(V,p),this}simulatePointerUp(V,p,W){return this._inputManager.simulatePointerUp(V,p,W),this}isPointerCaptured(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(V)}attachControl(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(V,p,W)}Hi(){this._inputManager.Hi()}isReady(){var V,p;let W,N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const d=this.getEngine(),E=d.currentRenderPassId;d.currentRenderPassId=(null===(V=this.activeCamera)||void 0===V?void 0:V.renderPassId)??E;let z=!0;for(this._pendingData.length>0&&(z=!1),null===(p=this.prePassRenderer)||void 0===p||p.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&z&&(z=this.depthPeelingRenderer.isReady()),N&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),W=0;W<this.meshes.length;W++){const V=this.meshes[W];if(!V.dg||0===V.dg.length)continue;if(!V.isReady(!0)){z=!1;continue}const p=V.hasThinInstances||"InstancedMesh"===V.getClassName()||"InstancedLinesMesh"===V.getClassName()||d.getCaps().instancedArrays&&V.instances.length>0;for(const W of this._isReadyForMeshStage)W.action(V,p)||(z=!1);if(!N)continue;const E=V.material||this.defaultMaterial;if(E)if(E._storeEffectOnSubMeshes)for(const W of V.dg){const V=W.Ha();V&&V.hasRenderTargetTextures&&null!=V.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(V)&&(this._processedMaterials.push(V),this._materialsRenderTargets.concatWithNoDuplicate(V.getRenderTargetTextures()))}else E.hasRenderTargetTextures&&null!=E.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(E)&&(this._processedMaterials.push(E),this._materialsRenderTargets.concatWithNoDuplicate(E.getRenderTargetTextures()))}if(N)for(W=0;W<this._materialsRenderTargets.length;++W){this._materialsRenderTargets.data[W].isReadyForRendering()||(z=!1)}for(W=0;W<this.geometries.length;W++){2===this.geometries[W].delayLoadState&&(z=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const S of this.activeCameras)S.isReady(!0)||(z=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(z=!1));for(const S of this.fj)S.isReady()||(z=!1);if(this.layers)for(const S of this.layers)S.isReady()||(z=!1);return d.areAllEffectsReady()||(z=!1),d.currentRenderPassId=E,z}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(V){this.onBeforeRenderObservable.add(V)}unregisterBeforeRender(V){this.onBeforeRenderObservable.removeCallback(V)}registerAfterRender(V){this.onAfterRenderObservable.add(V)}unregisterAfterRender(V){this.onAfterRenderObservable.removeCallback(V)}_executeOnceBeforeRender(V){const p=()=>{V(),setTimeout((()=>{this.unregisterBeforeRender(p)}))};this.registerBeforeRender(p)}executeOnceBeforeRender(V,p){void 0!==p?setTimeout((()=>{this._executeOnceBeforeRender(V)}),p):this._executeOnceBeforeRender(V)}addPendingData(V){this._pendingData.push(V)}removePendingData(V){const p=this.isLoading,W=this._pendingData.indexOf(V);-1!==W&&this._pendingData.splice(W,1),p&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(V),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(p)}whenReadyAsync(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((p=>{this.executeWhenReady((()=>{p()}),V)}))}_checkIsReady(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(V)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(V)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=d.d.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(V,p,W,N){W||N||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===V.updateFlag&&this._projectionUpdateFlag===p.updateFlag||(this._viewUpdateFlag=V.updateFlag,this._projectionUpdateFlag=p.updateFlag,this._viewMatrix=V,this._projectionMatrix=p,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?g.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=g.b.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(W,N):this._sceneUbo.useUbo&&(this._sceneUbo.wj("viewProjection",this._transformMatrix),this._sceneUbo.wj("view",this._viewMatrix),this._sceneUbo.wj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(V){const p=new l.c(this._engine,void 0,!1,V??"Bc");return p.addUniform("viewProjection",16),p.addUniform("view",16),p.addUniform("projection",16),p.addUniform("vEyePosition",4),p}setSceneUniformBuffer(V){this._sceneUbo=V,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return D.e.UniqueId}ai(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(V),V._resyncLightSources(),V.parent||V._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(V),p&&V.getChildMeshes().forEach((V=>{this.ai(V)})))}yc(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const W=this.meshes.indexOf(V);return-1!==W&&(this.meshes.splice(W,1),V.parent||V._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(V),this.onMeshRemovedObservable.notifyObservers(V),p&&V.getChildMeshes().forEach((V=>{this.yc(V)})),W}addTransformNode(V){this._blockEntityCollection||V.va()===this&&-1!==V._indexInSceneTransformNodesArray||(V._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(V),V.parent||V._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(V))}removeTransformNode(V){const p=V._indexInSceneTransformNodesArray;if(-1!==p){if(p!==this.transformNodes.length-1){const V=this.transformNodes[this.transformNodes.length-1];this.transformNodes[p]=V,V._indexInSceneTransformNodesArray=p}V._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),V.parent||V._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(V),p}removeSkeleton(V){const p=this.skeletons.indexOf(V);return-1!==p&&(this.skeletons.splice(p,1),this.onSkeletonRemovedObservable.notifyObservers(V),this._executeActiveContainerCleanup(this._activeSkeletons)),p}removeMorphTargetManager(V){const p=this.morphTargetManagers.indexOf(V);return-1!==p&&this.morphTargetManagers.splice(p,1),p}removeLight(V){const p=this.lights.indexOf(V);if(-1!==p){for(const p of this.meshes)p._removeLightSource(V,!1);this.lights.splice(p,1),this.sortLightsByPriority(),V.parent||V._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(V),p}removeCamera(V){const p=this.cameras.indexOf(V);if(-1!==p&&(this.cameras.splice(p,1),V.parent||V._removeFromSceneRootNodes()),this.activeCameras){const p=this.activeCameras.indexOf(V);-1!==p&&this.activeCameras.splice(p,1)}return this.activeCamera===V&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(V),p}removeParticleSystem(V){const p=this.fj.indexOf(V);return-1!==p&&(this.fj.splice(p,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),p}removeAnimation(V){const p=this.animations.indexOf(V);return-1!==p&&this.animations.splice(p,1),p}stopAnimation(V,p,W){}removeAnimationGroup(V){const p=this.animationGroups.indexOf(V);return-1!==p&&this.animationGroups.splice(p,1),p}removeMultiMaterial(V){const p=this.multiMaterials.indexOf(V);return-1!==p&&this.multiMaterials.splice(p,1),this.onMultiMaterialRemovedObservable.notifyObservers(V),p}removeMaterial(V){const p=V._indexInSceneMaterialArray;if(-1!==p&&p<this.materials.length){if(p!==this.materials.length-1){const V=this.materials[this.materials.length-1];this.materials[p]=V,V._indexInSceneMaterialArray=p}V._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(V),p}removeActionManager(V){const p=this.actionManagers.indexOf(V);return-1!==p&&this.actionManagers.splice(p,1),p}removeTexture(V){const p=this.textures.indexOf(V);return-1!==p&&this.textures.splice(p,1),this.onTextureRemovedObservable.notifyObservers(V),p}addLight(V){if(!this._blockEntityCollection){this.lights.push(V),this.sortLightsByPriority(),V.parent||V._addToSceneRootNodes();for(const p of this.meshes)-1===p.lightSources.indexOf(V)&&(p.lightSources.push(V),p._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(V)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(m.e.CompareLightsPriority)}addCamera(V){this._blockEntityCollection||(this.cameras.push(V),this.onNewCameraAddedObservable.notifyObservers(V),V.parent||V._addToSceneRootNodes())}addSkeleton(V){this._blockEntityCollection||(this.skeletons.push(V),this.onNewSkeletonAddedObservable.notifyObservers(V))}addParticleSystem(V){this._blockEntityCollection||this.fj.push(V)}addAnimation(V){this._blockEntityCollection||this.animations.push(V)}addAnimationGroup(V){this._blockEntityCollection||this.animationGroups.push(V)}addMultiMaterial(V){this._blockEntityCollection||(this.multiMaterials.push(V),this.onNewMultiMaterialAddedObservable.notifyObservers(V))}addMaterial(V){this._blockEntityCollection||V.va()===this&&-1!==V._indexInSceneMaterialArray||(V._indexInSceneMaterialArray=this.materials.length,this.materials.push(V),this.onNewMaterialAddedObservable.notifyObservers(V))}addMorphTargetManager(V){this._blockEntityCollection||this.morphTargetManagers.push(V)}addGeometry(V){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[V.uniqueId]=this.geometries.length),this.geometries.push(V))}addActionManager(V){this.actionManagers.push(V)}addTexture(V){this._blockEntityCollection||(this.textures.push(V),this.onNewTextureAddedObservable.notifyObservers(V))}switchActiveCamera(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Hi(),this.activeCamera=V,p&&V.attachControl())}setActiveCameraById(V){const p=this.getCameraById(V);return p?(this.activeCamera=p,p):null}setActiveCameraByName(V){const p=this.getCameraByName(V);return p?(this.activeCamera=p,p):null}getAnimationGroupByName(V){for(let p=0;p<this.animationGroups.length;p++)if(this.animationGroups[p].name===V)return this.animationGroups[p];return null}_getMaterial(V,p){for(let W=0;W<this.materials.length;W++){const V=this.materials[W];if(p(V))return V}if(V)for(let W=0;W<this.multiMaterials.length;W++){const V=this.multiMaterials[W];if(p(V))return V}return null}getMaterialByUniqueID(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(p,(p=>p.uniqueId===V))}getMaterialById(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(p,(p=>p.id===V))}getMaterialByName(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(p,(p=>p.name===V))}getLastMaterialById(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let W=this.materials.length-1;W>=0;W--)if(this.materials[W].id===V)return this.materials[W];if(p)for(let W=this.multiMaterials.length-1;W>=0;W--)if(this.multiMaterials[W].id===V)return this.multiMaterials[W];return null}getTextureByUniqueId(V){for(let p=0;p<this.textures.length;p++)if(this.textures[p].uniqueId===V)return this.textures[p];return null}getTextureByName(V){for(let p=0;p<this.textures.length;p++)if(this.textures[p].name===V)return this.textures[p];return null}getCameraById(V){for(let p=0;p<this.cameras.length;p++)if(this.cameras[p].id===V)return this.cameras[p];return null}getCameraByUniqueId(V){for(let p=0;p<this.cameras.length;p++)if(this.cameras[p].uniqueId===V)return this.cameras[p];return null}getCameraByName(V){for(let p=0;p<this.cameras.length;p++)if(this.cameras[p].name===V)return this.cameras[p];return null}getBoneById(V){for(let p=0;p<this.skeletons.length;p++){const W=this.skeletons[p];for(let p=0;p<W.bones.length;p++)if(W.bones[p].id===V)return W.bones[p]}return null}getBoneByName(V){for(let p=0;p<this.skeletons.length;p++){const W=this.skeletons[p];for(let p=0;p<W.bones.length;p++)if(W.bones[p].name===V)return W.bones[p]}return null}getLightByName(V){for(let p=0;p<this.lights.length;p++)if(this.lights[p].name===V)return this.lights[p];return null}getLightById(V){for(let p=0;p<this.lights.length;p++)if(this.lights[p].id===V)return this.lights[p];return null}getLightByUniqueId(V){for(let p=0;p<this.lights.length;p++)if(this.lights[p].uniqueId===V)return this.lights[p];return null}getParticleSystemById(V){for(let p=0;p<this.fj.length;p++)if(this.fj[p].id===V)return this.fj[p];return null}getGeometryById(V){for(let p=0;p<this.geometries.length;p++)if(this.geometries[p].id===V)return this.geometries[p];return null}_getGeometryByUniqueId(V){if(this._geometriesByUniqueId){const p=this._geometriesByUniqueId[V];if(void 0!==p)return this.geometries[p]}else for(let p=0;p<this.geometries.length;p++)if(this.geometries[p].uniqueId===V)return this.geometries[p];return null}pushGeometry(V,p){return!(!p&&this._getGeometryByUniqueId(V.uniqueId))&&(this.addGeometry(V),this.onNewGeometryAddedObservable.notifyObservers(V),!0)}removeGeometry(V){let p;if(this._geometriesByUniqueId){if(p=this._geometriesByUniqueId[V.uniqueId],void 0===p)return!1}else if(p=this.geometries.indexOf(V),p<0)return!1;if(p!==this.geometries.length-1){const V=this.geometries[this.geometries.length-1];V&&(this.geometries[p]=V,this._geometriesByUniqueId&&(this._geometriesByUniqueId[V.uniqueId]=p))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[V.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(V),!0}getGeometries(){return this.geometries}getMeshById(V){for(let p=0;p<this.meshes.length;p++)if(this.meshes[p].id===V)return this.meshes[p];return null}getMeshesById(V){return this.meshes.filter((function(p){return p.id===V}))}getTransformNodeById(V){for(let p=0;p<this.transformNodes.length;p++)if(this.transformNodes[p].id===V)return this.transformNodes[p];return null}getTransformNodeByUniqueId(V){for(let p=0;p<this.transformNodes.length;p++)if(this.transformNodes[p].uniqueId===V)return this.transformNodes[p];return null}getTransformNodesById(V){return this.transformNodes.filter((function(p){return p.id===V}))}getMeshByUniqueId(V){for(let p=0;p<this.meshes.length;p++)if(this.meshes[p].uniqueId===V)return this.meshes[p];return null}getLastMeshById(V){for(let p=this.meshes.length-1;p>=0;p--)if(this.meshes[p].id===V)return this.meshes[p];return null}getLastTransformNodeById(V){for(let p=this.transformNodes.length-1;p>=0;p--)if(this.transformNodes[p].id===V)return this.transformNodes[p];return null}getLastEntryById(V){let p;for(p=this.meshes.length-1;p>=0;p--)if(this.meshes[p].id===V)return this.meshes[p];for(p=this.transformNodes.length-1;p>=0;p--)if(this.transformNodes[p].id===V)return this.transformNodes[p];for(p=this.cameras.length-1;p>=0;p--)if(this.cameras[p].id===V)return this.cameras[p];for(p=this.lights.length-1;p>=0;p--)if(this.lights[p].id===V)return this.lights[p];return null}getNodeById(V){const p=this.getMeshById(V);if(p)return p;const W=this.getTransformNodeById(V);if(W)return W;const N=this.getLightById(V);if(N)return N;const d=this.getCameraById(V);if(d)return d;const E=this.getBoneById(V);return E||null}getNodeByName(V){const p=this.getMeshByName(V);if(p)return p;const W=this.getTransformNodeByName(V);if(W)return W;const N=this.getLightByName(V);if(N)return N;const d=this.getCameraByName(V);if(d)return d;const E=this.getBoneByName(V);return E||null}getMeshByName(V){for(let p=0;p<this.meshes.length;p++)if(this.meshes[p].name===V)return this.meshes[p];return null}getTransformNodeByName(V){for(let p=0;p<this.transformNodes.length;p++)if(this.transformNodes[p].name===V)return this.transformNodes[p];return null}getLastSkeletonById(V){for(let p=this.skeletons.length-1;p>=0;p--)if(this.skeletons[p].id===V)return this.skeletons[p];return null}getSkeletonByUniqueId(V){for(let p=0;p<this.skeletons.length;p++)if(this.skeletons[p].uniqueId===V)return this.skeletons[p];return null}getSkeletonById(V){for(let p=0;p<this.skeletons.length;p++)if(this.skeletons[p].id===V)return this.skeletons[p];return null}getSkeletonByName(V){for(let p=0;p<this.skeletons.length;p++)if(this.skeletons[p].name===V)return this.skeletons[p];return null}getMorphTargetManagerById(V){for(let p=0;p<this.morphTargetManagers.length;p++)if(this.morphTargetManagers[p].uniqueId===V)return this.morphTargetManagers[p];return null}getMorphTargetById(V){for(let p=0;p<this.morphTargetManagers.length;++p){const W=this.morphTargetManagers[p];for(let p=0;p<W.numTargets;++p){const N=W.getTarget(p);if(N.id===V)return N}}return null}getMorphTargetByName(V){for(let p=0;p<this.morphTargetManagers.length;++p){const W=this.morphTargetManagers[p];for(let p=0;p<W.numTargets;++p){const N=W.getTarget(p);if(N.name===V)return N}}return null}getPostProcessByName(V){for(let p=0;p<this.postProcesses.length;++p){const W=this.postProcesses[p];if(W.name===V)return W}return null}isActiveMesh(V){return-1!==this._activeMeshes.indexOf(V)}get uid(){return this._uid||(this._uid=N.e.RandomId()),this._uid}addExternalData(V,p){return this._externalData||(this._externalData=new S),this._externalData.add(V,p)}getExternalData(V){return this._externalData?this._externalData.get(V):null}getOrAddExternalDataWithFactory(V,p){return this._externalData||(this._externalData=new S),this._externalData.getOrAddWithFactory(V,p)}removeExternalData(V){return this._externalData.remove(V)}_evaluateSubMesh(V,p,W,N){if(N||V.isInFrustum(this._frustumPlanes)){for(const N of this._evaluateSubMeshStage)N.action(p,V);const W=V.Ha();null!==W&&void 0!==W&&(W.hasRenderTargetTextures&&null!=W.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(W)&&(this._processedMaterials.push(W),this._materialsRenderTargets.concatWithNoDuplicate(W.getRenderTargetTextures())),this._renderingManager.dispatch(V,p,W))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(V){this._preventFreeActiveMeshesAndRenderingGroups!==V&&(V&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=V)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let V=0;V<this.activeCameras.length;V++){const p=this.activeCameras[V];p&&p._activeMeshes&&p._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let V=0;V<this.textures.length;V++){const p=this.textures[V];p&&p.renderList&&p.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=d,this._skipEvaluateActiveMeshesCompletely=V,N)for(let V=0;V<this._activeMeshes.length;V++)this._activeMeshes.data[V]._freeze();p&&p()}else W&&W("No active camera found")})),this}unfreezeActiveMeshes(){for(let V=0;V<this.meshes.length;V++){const p=this.meshes[V];p._internalAbstractMeshDataInfo&&(p._internalAbstractMeshDataInfo._isActive=!1)}for(let V=0;V<this._activeMeshes.length;V++)this._activeMeshes.data[V]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(V){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>V.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var V;if(this._activeMeshes.length>0)null===(V=this.activeCamera)||void 0===V||V._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const V=this._activeMeshes.length;for(let p=0;p<V;p++){this._activeMeshes.data[p].Dj()}}if(this._activeParticleSystems){const V=this._activeParticleSystems.length;for(let p=0;p<V;p++)this._activeParticleSystems.data[p].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const N of this._beforeEvaluateActiveMeshStage)N.action();const p=this.getActiveMeshCandidates(),W=p.length;for(let N=0;N<W;N++){const V=p.data[N];if(V._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,V.isBlocked)continue;if(this._totalVertices.addCount(V.getTotalVertices(),!1),!V.isReady()||!V.isEnabled()||V.ie.hasAZeroComponent)continue;V.Dj(),V.actionManager&&V.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(V);let W=this.customLODSelector?this.customLODSelector(V,this.activeCamera):V.getLOD(this.activeCamera);if(V._internalAbstractMeshDataInfo._currentLOD=W,V._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==W&&null!==W&&(W!==V&&0!==W.billboardMode&&W.Dj(),V._preActivate(),V.isVisible&&V.visibility>0&&0!==(V.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||V.qb||V.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(V),this.activeCamera._activeMeshes.push(V),W!==V&&W._activate(this._renderId,!1);for(const p of this._preActiveMeshStage)p.action(V);V._activate(this._renderId,!1)&&(V.isAnInstance?V._internalAbstractMeshDataInfo._actAsRegularMesh&&(W=V):W._internalAbstractMeshDataInfo._onlyForInstances=!1,W._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(V,W)),V._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let V=0;V<this.fj.length;V++){const p=this.fj[V];if(!p.isStarted()||!p.j)continue;const W=p.j;W.position&&!W.isEnabled()||(this._activeParticleSystems.push(p),p.animate(),this._renderingManager.dispatchParticles(p))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(V){this._skeletonsEnabled&&V.skeleton&&(this._activeSkeletons.pushNoDuplicate(V.skeleton)&&(V.skeleton.prepare(),this._activeBones.addCount(V.skeleton.bones.length,!1)),V.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(V)&&this.frameGraph&&V.applySkeleton(V.skeleton))}_activeMesh(V,p){this._prepareSkeleton(p);let W=V.hasInstances||V.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||p.qb;if(p&&p.dg&&p.dg.length>0){const N=this.getActiveSubMeshCandidates(p),d=N.length;W=W||1===d;for(let E=0;E<d;E++){const d=N.data[E];this._evaluateSubMesh(d,p,V,W)}}}updateTransformMatrix(V){const p=this.activeCamera;if(p)if(p._renderingMultiview){const W=p._rigCameras[0],N=p._rigCameras[1];this.setTransformMatrix(W.getViewMatrix(),W.getProjectionMatrix(V),N.getViewMatrix(),N.getProjectionMatrix(V))}else this.setTransformMatrix(p.getViewMatrix(),p.getProjectionMatrix(V))}_bindFrameBuffer(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];V&&V._multiviewTexture?V._multiviewTexture._bindFrameBuffer():V&&V.outputRenderTarget?V.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),p&&this._clearFrameBuffer(V)}_clearFrameBuffer(V){if(V&&V._multiviewTexture);else if(V&&V.outputRenderTarget&&!V._renderingMultiview){const p=V.outputRenderTarget;p.onClearObservable.hasObservers()?p.onClearObservable.notifyObservers(this._engine):p.skipInitialClear||V.isRightCamera||(this.Ii&&this._engine.clear(p.clearColor||this._clearColor,!p._cleared,!0,!0),p._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(V,p){var W;let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(V&&V._skipRendering)return;const E=this._engine;if(this._activeCamera=V,!this.activeCamera)throw new Error("Active camera not set");if(E.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&d){let p=!0;V._renderingMultiview&&V.outputRenderTarget&&(p=V.outputRenderTarget.skipInitialClear,this.Ii&&(this._defaultFrameBufferCleared=!1,V.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),V._renderingMultiview&&V.outputRenderTarget&&(V.outputRenderTarget.skipInitialClear=p)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let N=0;N<this._softwareSkinnedMeshes.length;N++){const V=this._softwareSkinnedMeshes.data[N];V.applySkeleton(V.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),V.customRenderTargets&&V.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(V.customRenderTargets),p&&p.customRenderTargets&&p.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(p.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const N of this._gatherActiveCameraRenderTargetsStage)N.action(this._renderTargets);let z=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){N.e.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let V=0;V<this._renderTargets.length;V++){const p=this._renderTargets.data[V];if(p._shouldRender()){this._renderId++;const V=p.activeCamera&&p.activeCamera!==this.activeCamera;p.render(V,this.dumpNextRenderTargets),z=!0}}N.e.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const V of this._cameraDrawRenderTargetStage)z=V.action(this.activeCamera)||z;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(W=V.outputRenderTarget)||void 0===W?void 0:W.renderPassId)??V.renderPassId??0,z&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||V._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const N of this._beforeCameraDrawStage)N.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),E.snapshotRendering&&1===E.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const N of this._afterCameraDrawStage)N.action(this.activeCamera);if(this.postProcessManager&&!V._multiviewTexture){const p=V.outputRenderTarget?V.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(V.isIntermediate,p)}for(const N of this._afterCameraPostProcessStage)N.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===V.cameraRigMode||V._renderingMultiview)return V._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(V,void 0,p),void this.onAfterRenderCameraObservable.notifyObservers(V);if(V._useMultiviewToSingleView)this._renderMultiviewToSingleView(V);else{this.onBeforeCameraRenderObservable.notifyObservers(V);for(let p=0;p<V._rigCameras.length;p++)this._renderForCamera(V._rigCameras[p],V)}this._activeCamera=V,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(V)}_checkIntersections(){for(let V=0;V<this._meshesForIntersections.length;V++){const p=this._meshesForIntersections.data[V];if(p.actionManager)for(let V=0;p.actionManager&&V<p.actionManager.actions.length;V++){const W=p.actionManager.actions[V];if(12===W.trigger||13===W.trigger){const V=W.getTriggerParameter(),N=V.mesh?V.mesh:V,d=N.intersectsMesh(p,V.usePreciseIntersection),E=p._intersectionsInProgress.indexOf(N);d&&-1===E?12===W.trigger?(W._executeCurrent(k.CreateNew(p,void 0,N)),p._intersectionsInProgress.push(N)):13===W.trigger&&p._intersectionsInProgress.push(N):!d&&E>-1&&(13===W.trigger&&W._executeCurrent(k.CreateNew(p,void 0,N)),p.actionManager.hasSpecificTrigger(13,(V=>{const p=V.mesh?V.mesh:V;return N===p}))&&13!==W.trigger||p._intersectionsInProgress.splice(E,1))}}}}_advancePhysicsEngineStep(V){}_animate(V){}animate(){if(this._engine.isDeterministicLockStep()){let V=Math.max(VV.MinDeltaTime,Math.min(this._engine.getDeltaTime(),VV.MaxDeltaTime))+this._timeAccumulator;const p=this._engine.getTimeStep(),W=1e3/p/1e3;let N=0;const d=this._engine.getLockstepMaxSteps();let E=Math.floor(V/p);for(E=Math.min(E,d);V>0&&N<E;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=p*W,this._animate(p),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(p),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,N++,V-=p;this._timeAccumulator=V<0?0:V}else{const V=this.useConstantAnimationDeltaTime?16:Math.max(VV.MinDeltaTime,Math.min(this._engine.getDeltaTime(),VV.MaxDeltaTime));this._animationRatio=.06*V,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(V)}}_clear(){(this.autoClearDepthAndStencil||this.Ii)&&this._engine.clear(this._clearColor,this.Ii||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(V){var p;if(null===V||void 0===V||!V.outputRenderTarget||null!==V&&void 0!==V&&V.isRigCamera||(V.outputRenderTarget._cleared=!1),null!==V&&void 0!==V&&null!==(p=V.rigCameras)&&void 0!==p&&p.length)for(let W=0;W<V.rigCameras.length;++W){const p=V.rigCameras[W].outputRenderTarget;p&&(p._cleared=!1)}}resetDrawCache(V){if(this.meshes)for(const p of this.meshes)p.resetDrawCache(V)}_renderWithFrameGraph(){var V;let p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),p)for(const d of this.cameras)if(d.update(),0!==d.cameraRigMode)for(let V=0;V<d._rigCameras.length;V++)d._rigCameras[V].update();for(const d of this._beforeClearStage)d.action();const W=this.getActiveMeshCandidates(),N=W.length;for(let d=0;d<N;d++){const V=W.data[d];V.isBlocked||(this._totalVertices.addCount(V.getTotalVertices(),!1),V.isReady()&&V.isEnabled()&&!V.ie.hasAZeroComponent&&(V.Dj(),V.actionManager&&V.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(V)))}if(this.particlesEnabled)for(let d=0;d<this.fj.length;d++){const V=this.fj[d];if(!V.isStarted()||!V.j)continue;const p=V.j;p.position&&!p.isEnabled()||(this._activeParticleSystems.push(V),V.animate())}null===(V=this.frameGraph)||void 0===V||V.execute()}render(){var V;let p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(V=this.activeCameras)&&void 0!==V&&V.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),W||this.animate();for(const V of this._beforeCameraUpdateStage)V.action();if(p)if(this.activeCameras&&this.activeCameras.length>0)for(let V=0;V<this.activeCameras.length;V++){const p=this.activeCameras[V];if(p.update(),0!==p.cameraRigMode)for(let V=0;V<p._rigCameras.length;V++)p._rigCameras[V].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let V=0;V<this.activeCamera._rigCameras.length;V++)this.activeCamera._rigCameras[V].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(p,W);else{var d;const V=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const p=null!==(d=this.activeCameras)&&void 0!==d&&d.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){N.e.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let W=0;W<this.customRenderTargets.length;W++){const N=this.customRenderTargets[W];if(N._shouldRender()){if(this._renderId++,this.activeCamera=N.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");V.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),N.render(p!==this.activeCamera,this.dumpNextRenderTargets)}}N.e.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(null===p||void 0===p?void 0:p.renderPassId)??0,this.activeCamera=p,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const W of this._beforeClearStage)W.action();this._clearFrameBuffer(this.activeCamera);for(const W of this._gatherRenderTargetsStage)W.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let W=0;W<this.activeCameras.length;W++)this._processSubCameras(this.activeCameras[W],W>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const V of this._afterRenderStage)V.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let V=0;V<this._toBeDisposed.length;V++){const p=this._toBeDisposed[V];p&&p.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let V=0;V<this.materials.length;V++)this.materials[V].freeze()}unfreezeMaterials(){for(let V=0;V<this.materials.length;V++)this.materials[V].unfreeze()}dispose(){if(this.u)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((V=>{V.onAnimationEndObservable.clear(),V.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const V=this._activeRequests.slice();for(const d of V)d.abort();this._activeRequests.length=0;try{this.$i.notifyObservers(this)}catch(N){n.e.Error("An error occurred while calling onDisposeObservable!",N)}this.Hi();if(this._engine.getInputElement())for(let d=0;d<this.cameras.length;d++)this.cameras[d].Hi();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(V=>V.dispose(!0))),this._disposeList(this.transformNodes,(V=>V.dispose(!0)));const p=this.cameras;this._disposeList(p),this.ji&&this.ji.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.fj),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let W=this._engine.scenes.indexOf(this);W>-1&&this._engine.scenes.splice(W,1),F.d._LastCreatedScene===this&&(this._engine.scenes.length>0?F.d._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:F.d._LastCreatedScene=null),W=this._engine._virtualScenes.indexOf(this),W>-1&&this._engine._virtualScenes.splice(W,1),this._engine.wipeCaches(!0),this.$i.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this._isDisposed=!0}_disposeList(V,p){const W=V.slice(0);p=p??(V=>V.dispose());for(const N of W)p(N);V.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let V=0;V<this.meshes.length;V++){const p=this.meshes[V].sj;p&&p.clearCachedData()}}cleanCachedTextureBuffer(){for(const V of this.textures){V._buffer&&(V._buffer=null)}}getWorldExtends(V){const p=new J.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),W=new J.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return V=V||(()=>!0),this.meshes.filter(V).forEach((V=>{if(V.Dj(!0),!V.dg||0===V.dg.length||V.infiniteDistance)return;const N=V.getBoundingInfo(),d=N.boundingBox.minimumWorld,E=N.boundingBox.maximumWorld;J.n.CheckExtends(d,p,W),J.n.CheckExtends(E,p,W)})),{min:p,max:W}}createPickingRay(V,p,W,N){throw(0,C.c)("Ray")}createPickingRayToRef(V,p,W,N,d){throw(0,C.c)("Ray")}createPickingRayInCameraSpace(V,p,W){throw(0,C.c)("Ray")}createPickingRayInCameraSpaceToRef(V,p,W,N){throw(0,C.c)("Ray")}dd(V,p,W,N,d,E){const z=(0,C.c)("Ray",!0);return z&&n.e.Warn(z),new j.e}pickWithBoundingInfo(V,p,W,N,d){const E=(0,C.c)("Ray",!0);return E&&n.e.Warn(E),new j.e}pickWithRay(V,p,W,N){throw(0,C.c)("Ray")}multiPick(V,p,W,N,d){throw(0,C.c)("Ray")}multiPickWithRay(V,p,W){throw(0,C.c)("Ray")}setPointerOverMesh(V,p,W){this._inputManager.setPointerOverMesh(V,p,W)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const V of this.geometries)V._rebuild();for(const V of this.meshes)V._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const V of this._components)V.rebuild();for(const V of this.fj)V.rebuild();if(this.spriteManagers)for(const V of this.spriteManagers)V.rebuild()}_rebuildTextures(){for(const V of this.textures)V._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(V,p,W){if(void 0===p)return V;const N=[];for(const d in V){const E=V[d];Q.e&&Q.e.MatchesQuery(E,p)&&(!W||W(E))&&N.push(E)}return N}getMeshesByTags(V,p){return this._getByTags(this.meshes,V,p)}getCamerasByTags(V,p){return this._getByTags(this.cameras,V,p)}getLightsByTags(V,p){return this._getByTags(this.lights,V,p)}getMaterialByTags(V,p){return this._getByTags(this.materials,V,p).concat(this._getByTags(this.multiMaterials,V,p))}getTransformNodesByTags(V,p){return this._getByTags(this.transformNodes,V,p)}setRenderingOrder(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(V,p,W,N)}setRenderingAutoClearDepthStencil(V,p){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(V,p,W,N)}getAutoClearDepthStencilSetup(V){return this._renderingManager.getAutoClearDepthStencilSetup(V)}_forceBlockMaterialDirtyMechanism(V){this._blockMaterialDirtyMechanism=V}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(V){this._blockMaterialDirtyMechanism!==V&&(this._blockMaterialDirtyMechanism=V,V||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(V,p){if(!this._blockMaterialDirtyMechanism)for(const W of this.materials)p&&!p(W)||W.Jg(V)}_loadFile(V,p,W,N,d,E,z){const S=(0,H.m)(V,p,W,N?this.offlineProvider:void 0,d,E,z);return this._activeRequests.push(S),S.onCompleteObservable.add((V=>{this._activeRequests.splice(this._activeRequests.indexOf(V),1)})),S}_loadFileAsync(V,p,W,N,d){return new Promise(((E,z)=>{this._loadFile(V,(V=>{E(V)}),p,W,N,((V,p)=>{z(p)}),d)}))}_requestFile(V,p,W,N,d,E,z){const S=(0,H.v)(V,p,W,N?this.offlineProvider:void 0,d,E,z);return this._activeRequests.push(S),S.onCompleteObservable.add((V=>{this._activeRequests.splice(this._activeRequests.indexOf(V),1)})),S}_requestFileAsync(V,p,W,N,d){return new Promise(((E,z)=>{this._requestFile(V,(V=>{E(V)}),p,W,N,(V=>{z(V)}),d)}))}_readFile(V,p,W,N,d){const E=(0,H.t)(V,p,W,N,d);return this._activeRequests.push(E),E.onCompleteObservable.add((V=>{this._activeRequests.splice(this._activeRequests.indexOf(V),1)})),E}_readFileAsync(V,p,W){return new Promise(((N,d)=>{this._readFile(V,(V=>{N(V)}),p,W,(V=>{d(V)}))}))}getPerfCollector(){throw(0,C.c)("performanceViewerSceneExtension")}setActiveCameraByID(V){return this.setActiveCameraById(V)}getMaterialByID(V){return this.getMaterialById(V)}getLastMaterialByID(V){return this.getLastMaterialById(V)}getTextureByUniqueID(V){return this.getTextureByUniqueId(V)}getCameraByID(V){return this.getCameraById(V)}getCameraByUniqueID(V){return this.getCameraByUniqueId(V)}getBoneByID(V){return this.getBoneById(V)}getLightByID(V){return this.getLightById(V)}getLightByUniqueID(V){return this.getLightByUniqueId(V)}getParticleSystemByID(V){return this.getParticleSystemById(V)}getGeometryByID(V){return this.getGeometryById(V)}getMeshByID(V){return this.getMeshById(V)}getMeshByUniqueID(V){return this.getMeshByUniqueId(V)}getLastMeshByID(V){return this.getLastMeshById(V)}getMeshesByID(V){return this.getMeshesById(V)}getTransformNodeByID(V){return this.getTransformNodeById(V)}getTransformNodeByUniqueID(V){return this.getTransformNodeByUniqueId(V)}getTransformNodesByID(V){return this.getTransformNodesById(V)}getNodeByID(V){return this.getNodeById(V)}getLastEntryByID(V){return this.getLastEntryById(V)}getLastSkeletonByID(V){return this.getLastSkeletonById(V)}}VV.FOGMODE_NONE=0,VV.FOGMODE_EXP=1,VV.FOGMODE_EXP2=2,VV.FOGMODE_LINEAR=3,VV.MinDeltaTime=1,VV.MaxDeltaTime=1e3,(0,w.d)("BABYLON.Scene",VV)},11321:(V,p,W)=>{"use strict";W.d(p,{c:()=>N,g:()=>d});class N{}N.NAME_EFFECTLAYER="EffectLayer",N.NAME_LAYER="Layer",N.NAME_LENSFLARESYSTEM="LensFlareSystem",N.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",N.NAME_PARTICLESYSTEM="ub",N.NAME_GAMEPAD="Gamepad",N.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",N.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",N.NAME_PREPASSRENDERER="PrePassRenderer",N.NAME_DEPTHRENDERER="DepthRenderer",N.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",N.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",N.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",N.NAME_SPRITE="Sprite",N.NAME_SUBSURFACE="SubSurface",N.NAME_OUTLINERENDERER="Outline",N.NAME_PROCEDURALTEXTURE="ProceduralTexture",N.NAME_SHADOWGENERATOR="ShadowGenerator",N.NAME_OCTREE="wb",N.NAME_PHYSICSENGINE="PhysicsEngine",N.NAME_AUDIO="Audio",N.NAME_FLUIDRENDERER="FluidRenderer",N.STEP_ISREADYFORMESH_EFFECTLAYER=0,N.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,N.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,N.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,N.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,N.STEP_BEFORECAMERADRAW_PREPASS=0,N.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,N.STEP_BEFORECAMERADRAW_LAYER=2,N.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,N.STEP_BEFORERENDERTARGETDRAW_LAYER=1,N.STEP_BEFORERENDERINGMESH_PREPASS=0,N.STEP_BEFORERENDERINGMESH_OUTLINE=1,N.STEP_AFTERRENDERINGMESH_PREPASS=0,N.STEP_AFTERRENDERINGMESH_OUTLINE=1,N.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,N.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,N.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,N.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,N.STEP_BEFORECLEAR_PREPASS=1,N.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,N.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,N.STEP_AFTERRENDERTARGETDRAW_LAYER=1,N.STEP_AFTERCAMERADRAW_PREPASS=0,N.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,N.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,N.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,N.STEP_AFTERCAMERADRAW_LAYER=4,N.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,N.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,N.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,N.STEP_AFTERRENDER_AUDIO=0,N.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,N.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,N.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,N.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,N.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,N.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,N.STEP_POINTERMOVE_SPRITE=0,N.STEP_POINTERDOWN_SPRITE=0,N.STEP_POINTERUP_SPRITE=0;class d extends Array{constructor(V){super(...V)}static Create(){return Object.create(d.prototype)}registerStep(V,p,W){let N=0,d=Number.MAX_VALUE;for(;N<this.length;N++){if(d=this[N].index,V<d)break}this.splice(N,0,{index:V,component:p,action:W.bind(p)})}clear(){this.length=0}}},11167:(V,p,W)=>{"use strict";W.d(p,{c:()=>N});function N(V,p,W,N){var d,E=arguments.length,z=E<3?p:null===N?N=Object.getOwnPropertyDescriptor(p,W):N;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)z=Reflect.decorate(V,p,W,N);else for(var S=V.length-1;S>=0;S--)(d=V[S])&&(z=(E<3?d(z):E>3?d(p,W,z):d(p,W))||z);return E>3&&z&&Object.defineProperty(p,W,z),z}Object.create;Object.create},12459:(V,p,W)=>{"use strict";class N{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((V,p)=>{this._resolve=V,this._reject=p}))}}var d=W(11218),E=W(11257),z=W(10848),S=W(11524),Q=W(12467),J=W(12485),i=W(10856),l=W(11731),j=W(12492),k=W(12498),u=W(10900),f=W(10870),O=W(10874);class U{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(V){this._useTextureToStoreBoneMatrices=V,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(V){this._animationPropertiesOverride=V}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(V,p,W){this.name=V,this.id=p,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=d.e.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new i.b,this.bones=[],this._scene=W||u.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const N=this._scene.getEngine().getCaps();this._canUseTextureForBones=N.textureFloat&&N.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((V=>!V.getParent()))}getTransformMatrices(V){if(this.needInitialSkinMatrix){if(!V)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return V._bonesTransformMatrices||this.prepare(!0),V._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(V){return this.needInitialSkinMatrix&&V._transformMatrixTexture?V._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(V){let p=`Name: ${this.name}, nBones: ${this.bones.length}`;if(p+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,V){p+=", Ranges: {";let V=!0;for(const W in this._ranges)V&&(p+=", ",V=!1),p+=W;p+="}"}return p}getBoneIndexByName(V){for(let p=0,W=this.bones.length;p<W;p++)if(this.bones[p].name===V)return p;return-1}createAnimationRange(V,p,W){if(!this._ranges[V]){this._ranges[V]=new k.d(V,p,W);for(let N=0,d=this.bones.length;N<d;N++)this.bones[N].animations[0]&&this.bones[N].animations[0].createRange(V,p,W)}}deleteAnimationRange(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let W=0,N=this.bones.length;W<N;W++)this.bones[W].animations[0]&&this.bones[W].animations[0].deleteRange(V,p);this._ranges[V]=null}getAnimationRange(V){return this._ranges[V]||null}getAnimationRanges(){const V=[];let p;for(p in this._ranges)V.push(this._ranges[p]);return V}copyAnimationRange(V,p){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[p]||!V.getAnimationRange(p))return!1;let N=!0;const d=this._getHighestAnimationFrame()+1,E={},z=V.bones;let S,Q;for(Q=0,S=z.length;Q<S;Q++)E[z[Q].name]=z[Q];this.bones.length!==z.length&&(f.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${z.length}`),N=!1);const J=W&&this.dimensionsAtRest&&V.dimensionsAtRest?this.dimensionsAtRest.divide(V.dimensionsAtRest):null;for(Q=0,S=this.bones.length;Q<S;Q++){const V=this.bones[Q].name,z=E[V];z?N=N&&this.bones[Q].copyAnimationRange(z,p,d,W,J):(f.e.Warn("copyAnimationRange: not same rig, missing source bone "+V),N=!1)}const i=V.getAnimationRange(p);return i&&(this._ranges[p]=new k.d(p,i.from+d,i.to+d)),N}returnToRest(){for(const V of this.bones)-1!==V._index&&V.returnToRest()}_getHighestAnimationFrame(){let V=0;for(let p=0,W=this.bones.length;p<W;p++)if(this.bones[p].animations[0]){const W=this.bones[p].animations[0].getHighestFrame();V<W&&(V=W)}return V}beginAnimation(V,p,W,N){const d=this.getAnimationRange(V);return d?this._scene.beginAnimation(this,d.from,d.to,p,W,N):null}static MakeAnimationAdditive(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2?arguments[2]:void 0;const N=V.getAnimationRange(W);if(!N)return null;const d=V._scene.getAllAnimatablesByTarget(V);let E=null;for(let S=0;S<d.length;S++){const V=d[S];if(V.fromFrame===(null===N||void 0===N?void 0:N.from)&&V.toFrame===(null===N||void 0===N?void 0:N.to)){E=V;break}}const z=V.getAnimatables();for(let S=0;S<z.length;S++){const V=z[S].animations;if(V)for(let N=0;N<V.length;N++)j.d.MakeAnimationAdditive(V[N],p,W)}return E&&(E.isAdditive=!0),V}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(V){this._meshesWithPoseMatrix.push(V)}_unregisterMeshWithPoseMatrix(V){const p=this._meshesWithPoseMatrix.indexOf(V);p>-1&&this._meshesWithPoseMatrix.splice(p,1)}_computeTransformMatrices(V,p){this.onBeforeComputeObservable.notifyObservers(this);for(let W=0;W<this.bones.length;W++){const N=this.bones[W];N._childUpdateId++;const d=N.getParent();if(d?N.getLocalMatrix().multiplyToRef(d.getFinalMatrix(),N.getFinalMatrix()):p?N.getLocalMatrix().multiplyToRef(p,N.getFinalMatrix()):N.getFinalMatrix().p(N.getLocalMatrix()),-1!==N._index){const p=null===N._index?W:N._index;N.getAbsoluteInverseBindMatrix().multiplyToArray(N.getFinalMatrix(),V,16*p)}}this._identity.copyToArray(V,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const V=this.va().getRenderId();if(this._currentRenderId===V)return;this._currentRenderId=V}if(this._numBonesWithLinkedTransformNode>0)for(const V of this.bones)if(V._linkedTransformNode){const p=V._linkedTransformNode;V.position=p.position,p.rotationQuaternion?V.rotationQuaternion=p.rotationQuaternion:V.rotation=p.rotation,V.ie=p.ie}if(this.needInitialSkinMatrix)for(const V of this._meshesWithPoseMatrix){const p=V.getPoseMatrix();let W=this._isDirty;if(V._bonesTransformMatrices&&V._bonesTransformMatrices.length===16*(this.bones.length+1)||(V._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),W=!0),W){if(this._synchronizedWithMesh!==V){this._synchronizedWithMesh=V;for(const V of this.bones)if(!V.getParent()){V.getBindMatrix().multiplyToRef(p,d.i.Matrix[1]),V._updateAbsoluteBindMatrices(d.i.Matrix[1])}if(this.isUsingTextureForMatrices){const p=4*(this.bones.length+1);V._transformMatrixTexture&&V._transformMatrixTexture.getSize().width===p||(V._transformMatrixTexture&&V._transformMatrixTexture.dispose(),V._transformMatrixTexture=l.d.CreateRGBATexture(V._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(V._bonesTransformMatrices,p),this.isUsingTextureForMatrices&&V._transformMatrixTexture&&V._transformMatrixTexture.update(V._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=l.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let V=0;V<this.bones.length;V++)this._animatables.push(this.bones[V])}return this._animatables}clone(V,p){const W=new U(V,p||V,this._scene);W.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let N=0;N<this.bones.length;N++){const V=this.bones[N];let p=null;const d=V.getParent();if(d){const V=this.bones.indexOf(d);p=W.bones[V]}const E=new J.c(V.name,W,p,V.getBindMatrix().clone(),V.getRestMatrix().clone());E._index=V._index,V._linkedTransformNode&&E.linkTransformNode(V._linkedTransformNode),O.d.DeepCopy(V.animations,E.animations)}if(this._ranges){W._ranges={};for(const V in this._ranges){const p=this._ranges[V];p&&(W._ranges[V]=p.clone())}}return this._isDirty=!0,W.prepare(!0),W}enableBlending(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((p=>{p.animations.forEach((p=>{p.enableBlending=!0,p.blendingSpeed=V}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const V=this._parentContainer.skeletons.indexOf(this);V>-1&&this._parentContainer.skeletons.splice(V,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const V={};V.name=this.name,V.id=this.id,this.dimensionsAtRest&&(V.dimensionsAtRest=this.dimensionsAtRest.Zi()),V.bones=[],V.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let W=0;W<this.bones.length;W++){var p;const N=this.bones[W],d=N.getParent(),E={parentBoneIndex:d?this.bones.indexOf(d):-1,index:N.getIndex(),name:N.name,id:N.id,matrix:N.getBindMatrix().Zi(),rest:N.getRestMatrix().Zi(),linkedTransformNodeId:null===(p=N.getTransformNode())||void 0===p?void 0:p.id};V.bones.push(E),N.length&&(E.length=N.length),N.metadata&&(E.metadata=N.metadata),N.animations&&N.animations.length>0&&(E.animation=N.animations[0].serialize()),V.ranges=[];for(const p in this._ranges){const W=this._ranges[p];if(!W)continue;const N={};N.name=p,N.from=W.from,N.to=W.to,V.ranges.push(N)}}return V}static Parse(V,p){const W=new U(V.name,V.id,p);let N;for(V.dimensionsAtRest&&(W.dimensionsAtRest=d.n.Tg(V.dimensionsAtRest)),W.needInitialSkinMatrix=V.needInitialSkinMatrix,N=0;N<V.bones.length;N++){const p=V.bones[N],E=V.bones[N].index;let z=null;p.parentBoneIndex>-1&&(z=W.bones[p.parentBoneIndex]);const S=p.rest?d.e.Tg(p.rest):null,Q=new J.c(p.name,W,z,d.e.Tg(p.matrix),S,null,E);void 0!==p.id&&null!==p.id&&(Q.id=p.id),p.length&&(Q.length=p.length),p.metadata&&(Q.metadata=p.metadata),p.animation&&Q.animations.push(j.d.Parse(p.animation)),void 0!==p.linkedTransformNodeId&&null!==p.linkedTransformNodeId&&(W._hasWaitingData=!0,Q._waitingTransformNodeId=p.linkedTransformNodeId)}if(V.ranges)for(N=0;N<V.ranges.length;N++){const p=V.ranges[N];W.createAnimationRange(p.name,p.from,p.to)}return W}computeAbsoluteMatrices(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||V)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(V)}getPoseMatrix(){let V=null;return this._meshesWithPoseMatrix.length>0&&(V=this._meshesWithPoseMatrix[0].getPoseMatrix()),V}sortBones(){const V=[],p=new Array(this.bones.length);for(let W=0;W<this.bones.length;W++)this._sortBones(W,V,p);this.bones=V}_sortBones(V,p,W){if(W[V])return;W[V]=!0;const N=this.bones[V];if(!N)return;void 0===N._index&&(N._index=V);const d=N.getParent();d&&this._sortBones(this.bones.indexOf(d),p,W),p.push(N)}setCurrentPoseAsRest(){this.bones.forEach((V=>{V.setCurrentPoseAsRest()}))}}var F=W(11387),C=W(11167),A=W(11175),v=W(12502),t=W(12511),e=W(11004),Z=W(11265);class o extends t.b{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(V){this.subSurface.refractionTexture=V,V?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(V){this.subSurface.indexOfRefraction=V}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(V){this.subSurface.invertRefractionY=V}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(V){this.subSurface.linkRefractionWithTransparency=V,V&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===t.b.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(V){V!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=V?t.b.LIGHTFALLOFF_PHYSICAL:t.b.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===t.b.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(V){V!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=V?t.b.LIGHTFALLOFF_GLTF:t.b.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(V){this._attachImageProcessingConfiguration(V),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(V){this.imageProcessingConfiguration.colorCurvesEnabled=V}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(V){this.imageProcessingConfiguration.colorGradingEnabled=V}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(V){this._imageProcessingConfiguration.toneMappingEnabled=V}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(V){this._imageProcessingConfiguration.exposure=V}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(V){this._imageProcessingConfiguration.contrast=V}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(V){this._imageProcessingConfiguration.colorGradingTexture=V}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(V){this._imageProcessingConfiguration.colorCurves=V}constructor(V,p){super(V,p,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=o.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=E.c.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new E.c(0,0,0),this.albedoColor=new E.c(1,1,1),this.reflectivityColor=new E.c(1,1,1),this.reflectionColor=new E.c(1,1,1),this.emissiveColor=new E.c(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,v.e)(this.va())}getClassName(){return"PBRMaterial"}clone(V){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const N=Z.b.Clone((()=>new o(V,this.va())),this,{cloneTexturesOnlyOnce:p});return N.id=V,N.name=V,this.stencil.copyTo(N.stencil),this._clonePlugins(N,W),N}serialize(){const V=super.serialize();return V.customType="BABYLON.PBRMaterial",V}static Parse(V,p,W){const N=Z.b.Parse((()=>new o(V.name,p)),V,p,W);return V.stencil&&N.stencil.parse(V.stencil,p,W),F.d._ParsePlugins(V,N,p,W),V.clearCoat&&N.clearCoat.parse(V.clearCoat,p,W),V.anisotropy&&N.anisotropy.parse(V.anisotropy,p,W),V.brdf&&N.brdf.parse(V.brdf,p,W),V.sheen&&N.sheen.parse(V.sheen,p,W),V.subSurface&&N.subSurface.parse(V.subSurface,p,W),V.iridescence&&N.iridescence.parse(V.iridescence,p,W),N}}o.PBRMATERIAL_OPAQUE=t.b.PBRMATERIAL_OPAQUE,o.PBRMATERIAL_ALPHATEST=t.b.PBRMATERIAL_ALPHATEST,o.PBRMATERIAL_ALPHABLEND=t.b.PBRMATERIAL_ALPHABLEND,o.PBRMATERIAL_ALPHATESTANDBLEND=t.b.PBRMATERIAL_ALPHATESTANDBLEND,o.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=t.b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"directIntensity",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"emissiveIntensity",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"environmentIntensity",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"specularIntensity",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"disableBumpMap",void 0),(0,C.c)([(0,A.A)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"albedoTexture",void 0),(0,C.c)([(0,A.A)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"ambientTexture",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"ambientTextureStrength",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,C.c)([(0,A.A)(),(0,A.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],o.prototype,"opacityTexture",void 0),(0,C.c)([(0,A.A)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"reflectionTexture",void 0),(0,C.c)([(0,A.A)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"emissiveTexture",void 0),(0,C.c)([(0,A.A)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"reflectivityTexture",void 0),(0,C.c)([(0,A.A)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"metallicTexture",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"metallic",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"roughness",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"metallicF0Factor",void 0),(0,C.c)([(0,A.k)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"metallicReflectanceColor",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,C.c)([(0,A.A)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"metallicReflectanceTexture",void 0),(0,C.c)([(0,A.A)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"reflectanceTexture",void 0),(0,C.c)([(0,A.A)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"microSurfaceTexture",void 0),(0,C.c)([(0,A.A)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"bumpTexture",void 0),(0,C.c)([(0,A.A)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty",null)],o.prototype,"lightmapTexture",void 0),(0,C.c)([(0,A.k)("ambient"),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"ambientColor",void 0),(0,C.c)([(0,A.k)("albedo"),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"albedoColor",void 0),(0,C.c)([(0,A.k)("reflectivity"),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"reflectivityColor",void 0),(0,C.c)([(0,A.k)("reflection"),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"reflectionColor",void 0),(0,C.c)([(0,A.k)("emissive"),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"emissiveColor",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"microSurface",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useLightmapAsShadowmap",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],o.prototype,"useAlphaFromAlbedoTexture",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],o.prototype,"forceAlphaTest",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],o.prototype,"alphaCutOff",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useSpecularOverAlpha",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useAmbientInGrayScale",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,C.c)([(0,A.I)()],o.prototype,"usePhysicalLightFalloff",null),(0,C.c)([(0,A.I)()],o.prototype,"useGLTFLightFalloff",null),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useRadianceOverAlpha",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useObjectSpaceNormalMap",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useParallax",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useParallaxOcclusion",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"parallaxScaleBias",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsLightsDirty")],o.prototype,"disableLighting",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"forceIrradianceInFragment",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsLightsDirty")],o.prototype,"maxSimultaneousLights",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"invertNormalMapX",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"invertNormalMapY",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"twoSidedLighting",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useAlphaFresnel",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useLinearAlphaFresnel",void 0),(0,C.c)([(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"environmentBRDFTexture",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"forceNormalForward",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"enableSpecularAntiAliasing",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useHorizonOcclusion",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useRadianceOcclusion",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsMiscDirty")],o.prototype,"unlit",void 0),(0,C.c)([(0,A.I)(),(0,A.d)("_markAllSubMeshesAsMiscDirty")],o.prototype,"applyDecalMapAfterDetailMap",void 0),(0,e.d)("BABYLON.PBRMaterial",o);var K=W(11452),h=W(11571),L=W(11291),x=W(11553),T=W(11565),P=W(11510);class b{get influence(){return this._influence}set influence(V){if(this._influence===V)return;const p=this._influence;this._influence=V,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===p||0===V)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(V){this._animationPropertiesOverride=V}constructor(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=V,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new i.b,this._onDataLayoutChanged=new i.b,this._animationPropertiesOverride=null,this.id=V,this._scene=W||u.d.LastCreatedScene,this.influence=p,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(V){const p=this.hasPositions;this._positions=V,p!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(V){const p=this.hasNormals;this._normals=V,p!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(V){const p=this.hasTangents;this._tangents=V,p!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(V){const p=this.hasUVs;this._uvs=V,p!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const V=Z.b.Clone((()=>new b(this.name,this.influence,this._scene)),this);return V._positions=this._positions,V._normals=this._normals,V._tangents=this._tangents,V._uvs=this._uvs,V}serialize(){const V={};return V.name=this.name,V.influence=this.influence,V.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(V.id=this.id),this.hasNormals&&(V.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(V.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(V.Aa=Array.prototype.slice.call(this.getUVs())),Z.b.AppendSerializedAnimations(this,V),V}getClassName(){return"MorphTarget"}static Parse(V,p){const W=new b(V.name,V.influence);if(W.setPositions(V.xa),null!=V.id&&(W.id=V.id),V.ya&&W.setNormals(V.ya),V.tangents&&W.setTangents(V.tangents),V.Aa&&W.setUVs(V.Aa),V.animations){for(let p=0;p<V.animations.length;p++){const N=V.animations[p],d=(0,e.b)("BABYLON.Animation");d&&W.animations.push(d.Parse(N))}V.autoAnimate&&p&&p.beginAnimation(W,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1)}return W}static FromMesh(V,p,W){p||(p=V.name);const N=new b(p,W,V.va());return N.setPositions(V.getVerticesData(L.f.PositionKind)),V.isVerticesDataPresent(L.f.NormalKind)&&N.setNormals(V.getVerticesData(L.f.NormalKind)),V.isVerticesDataPresent(L.f.TangentKind)&&N.setTangents(V.getVerticesData(L.f.TangentKind)),V.isVerticesDataPresent(L.f.UVKind)&&N.setUVs(V.getVerticesData(L.f.UVKind)),N}}(0,C.c)([(0,A.I)()],b.prototype,"id",void 0);var s=W(11191),G=W(12087);class R{set areUpdatesFrozen(V){V?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new s.f(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,V||(V=u.d.LastCreatedScene),this._scene=V,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const V=this._scene.getEngine().getCaps();this._canUseTextureForTargets=V.canUseGLVertexID&&V.textureFloat&&V.maxVertexTextureImageUnits>0&&V.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(V){this._numMaxInfluencers!==V&&(this._numMaxInfluencers=V,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(V){this._useTextureToStoreTargets=V}get isUsingTextureForTargets(){var V;return R.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(V=this._scene)&&void 0!==V&&V.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(V){return this._activeTargets.data[V]}getTarget(V){return this._targets[V]}getTargetByName(V){for(const p of this._targets)if(p.name===V)return p;return null}addTarget(V){this._targets.push(V),this._targetInfluenceChangedObservers.push(V.onInfluenceChanged.add((V=>{this._syncActiveTargets(V)}))),this._targetDataLayoutChangedObservers.push(V._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(V){const p=this._targets.indexOf(V);p>=0&&(this._targets.splice(p,1),V.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(p,1)[0]),V._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(p,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(V)}_bind(V){V.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),V.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),V.setTexture("morphTargets",this._targetStoreTexture),V.setInt("morphTargetCount",this.numInfluencers)}clone(){const V=new R(this._scene);for(const p of this._targets)V.addTarget(p.clone());return V.enableNormalMorphing=this.enableNormalMorphing,V.enableTangentMorphing=this.enableTangentMorphing,V.enableUVMorphing=this.enableUVMorphing,V}serialize(){const V={};V.id=this.uniqueId,V.targets=[];for(const p of this._targets)V.targets.push(p.serialize());return V}_syncActiveTargets(V){if(this.areUpdatesFrozen)return;let p=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let W=-1;for(const N of this._targets){if(W++,0===N.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=R.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(N),this._morphTargetTextureIndices[p]=W,this._tempInfluences[p++]=N.influence,this._supportsNormals=this._supportsNormals&&N.hasNormals,this._supportsTangents=this._supportsTangents&&N.hasTangents,this._supportsUVs=this._supportsUVs&&N.hasUVs;const V=N.getPositions();if(V){const p=V.length/3;if(0===this._vertexCount)this._vertexCount=p;else if(this._vertexCount!==p)return void f.e.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==p&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,p)),this._influences&&this._influences.length===p||(this._influences=new Float32Array(p));for(let N=0;N<p;N++)this._influences[N]=this._tempInfluences[N];V&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const V=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>V&&(this._textureHeight=Math.ceil(this._textureWidth/V),this._textureWidth=V);let p=!0;if(this._targetStoreTexture){const V=this._targetStoreTexture.getSize();V.width===this._textureWidth&&V.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(p=!1)}if(p){this._targetStoreTexture&&this._targetStoreTexture.dispose();const V=this._targets.length,p=new Float32Array(V*this._textureWidth*this._textureHeight*4);let W=0;for(let N=0;N<V;N++){const V=this._targets[N],d=V.getPositions(),E=V.getNormals(),z=V.getUVs(),S=V.getTangents();if(!d)return void(0===N&&f.e.Error("Invalid morph target. Target must have positions."));W=N*this._textureWidth*this._textureHeight*4;for(let N=0;N<this._vertexCount;N++)p[W]=d[3*N],p[W+1]=d[3*N+1],p[W+2]=d[3*N+2],W+=4,this._supportsNormals&&E&&(p[W]=E[3*N],p[W+1]=E[3*N+1],p[W+2]=E[3*N+2],W+=4),this._supportsUVs&&z&&(p[W]=z[2*N],p[W+1]=z[2*N+1],W+=4),this._supportsTangents&&S&&(p[W]=S[3*N],p[W+1]=S[3*N+1],p[W+2]=S[3*N+2],W+=4)}this._targetStoreTexture=G.d.CreateRGBATexture(p,this._textureWidth,this._textureHeight,V,this._scene,!1,!1,1,1)}}for(const V of this._scene.meshes)V.morphTargetManager===this&&V._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const V=this._parentContainer.morphTargetManagers.indexOf(this);V>-1&&this._parentContainer.morphTargetManagers.splice(V,1),this._parentContainer=null}for(const V of this._targets)this._scene.stopAnimation(V)}}static Parse(V,p){const W=new R(p);for(const N of V.targets)W.addTarget(b.Parse(N,p));return W}}R.EnableTextureStorage=!0,R.MaxActiveMorphTargetsInVertexAttributeMode=8;var X=W(12528),r=W(10902),B=W(11402);function Y(V,p,W,N){return d.n.Tg(p,W).scaleInPlace(N)}class I{constructor(V,p,W,N){this.type=V,this.name=p,this.getValue=W,this.getStride=N}_buildAnimation(V,p,W){const N=new j.d(V,this.name,p,this.type);return N.setKeys(W),N}}class c extends I{buildAnimations(V,p,W,N,d){d(V._babylonTransformNode,this._buildAnimation(p,W,N))}}const q={translation:[new c(j.d.ANIMATIONTYPE_VECTOR3,"position",Y,(()=>3))],rotation:[new c(j.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(V,p,W,N){return d.f.Tg(p,W).scaleInPlace(N)}),(()=>4))],scale:[new c(j.d.ANIMATIONTYPE_VECTOR3,"ie",Y,(()=>3))],weights:[new class extends I{buildAnimations(V,p,W,N,d){if(V._numMorphTargets)for(let E=0;E<V._numMorphTargets;E++){const z=new j.d(`${p}_${E}`,this.name,W,this.type);if(z.setKeys(N.map((V=>({frame:V.frame,inTangent:V.inTangent?V.inTangent[E]:void 0,value:V.value[E],outTangent:V.outTangent?V.outTangent[E]:void 0,interpolation:V.interpolation})))),V._primitiveBabylonMeshes)for(const p of V._primitiveBabylonMeshes)if(p.morphTargetManager){const V=p.morphTargetManager.getTarget(E),W=z.clone();V.animations.push(W),d(V,W)}}}}(j.d.ANIMATIONTYPE_FLOAT,"influence",(function(V,p,W,N){const d=new Array(V._numMorphTargets);for(let E=0;E<d.length;E++)d[E]=p[W++]*N;return d}),(V=>V._numMorphTargets))]},g=new Map,D=g;function H(V,p,W){m(V)&&f.e.Warn(`Extension with the name '${V}' already exists`),g.set(V,{isGLTFExtension:p,factory:W})}function m(V){return g.delete(V)}function M(){const V=V=>V&&"object"===typeof V;for(var p=arguments.length,W=new Array(p),N=0;N<p;N++)W[N]=arguments[N];return W.reduce(((p,W)=>(Object.keys(W).forEach((N=>{const d=p[N],E=W[N];Array.isArray(d)&&Array.isArray(E)?p[N]=d.concat(...E):V(d)&&V(E)?p[N]=M(d,E):p[N]=E})),p)),{})}class a{static Get(V,p,W){if(!p||void 0==W||!p[W])throw new Error(`${V}: Failed to find index (${W})`);return p[W]}static TryGet(V,p){return V&&void 0!=p&&V[p]?V[p]:null}static Assign(V){if(V)for(let p=0;p<V.length;p++)V[p].index=p}}class y{static RegisterExtension(V,p){H(V,!1,p)}static UnregisterExtension(V){return m(V)}get Di(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(V){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=V}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((V=>V.dispose&&V.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(V,p,W,N,d,E){let z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=p,this._assetContainer=W,this._loadData(N);let E=null;if(V){const p={};if(this._gltf.nodes)for(const V of this._gltf.nodes)V.name&&(p[V.name]=V.index);E=(V instanceof Array?V:[V]).map((V=>{const W=p[V];if(void 0===W)throw new Error(`Failed to find node '${V}'`);return W}))}return this._loadAsync(d,z,E,(()=>({meshes:this._getMeshes(),fj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=V,this._loadData(p),this._loadAsync(W,d,null,(()=>{})))))}_loadAsync(V,p,W,N){return Promise.resolve().then((async()=>{this._rootUrl=V,this._uniqueRootUrl=!V.startsWith("file:")&&p?V:`${V}${Date.now()}/`,this._fileName=p,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const d=`${X.n[X.n.LOADING]} => ${X.n[X.n.READY]}`,E=`${X.n[X.n.LOADING]} => ${X.n[X.n.COMPLETE]}`;this._parent._startPerformanceCounter(d),this._parent._startPerformanceCounter(E),this._parent._setState(X.n.LOADING),this._extensionsOnLoading();const S=new Array;if(!this.parent.loadOnlyMaterials)if(W)S.push(this.loadSceneAsync("/nodes",{nodes:W,index:-1}));else if(void 0!=this._gltf.Bc||this._gltf.scenes&&this._gltf.scenes[0]){const V=a.Get("/scene",this._gltf.scenes,this._gltf.Bc||0);S.push(this.loadSceneAsync(`/scenes/${V.index}`,V))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let V=0;V<this._gltf.materials.length;++V){const p=this._gltf.materials[V],W="/materials/"+V,N=F.d.TriangleFillMode;S.push(this._loadMaterialAsync(W,p,null,N,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&S.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&S.push(this._compileShadowGeneratorsAsync());return Promise.all(S).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Ab(!0),this._extensionsOnReady(),this._parent._setState(X.n.READY),this._startAnimations(),N()))).then((V=>(this._parent._endPerformanceCounter(d),z.e.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(E),this._parent._setState(X.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(V=>{this._parent.onErrorObservable.notifyObservers(V),this._parent.onErrorObservable.clear(),this.dispose()}))})),V)))})).catch((V=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(V),this._parent.onErrorObservable.clear(),this.dispose()),V}))}_loadData(V){if(this._gltf=V.json,this._setupData(),V.bin){const p=this._gltf.buffers;if(p&&p[0]&&!p[0].uri){const W=p[0];(W.byteLength<V.bin.byteLength-3||W.byteLength>V.bin.byteLength)&&f.e.Warn(`Binary buffer length (${W.byteLength}) from JSON does not match chunk length (${V.bin.byteLength})`),this._bin=V.bin}else f.e.Warn("Unexpected BIN chunk")}}_setupData(){if(a.Assign(this._gltf.accessors),a.Assign(this._gltf.animations),a.Assign(this._gltf.buffers),a.Assign(this._gltf.bufferViews),a.Assign(this._gltf.cameras),a.Assign(this._gltf.images),a.Assign(this._gltf.materials),a.Assign(this._gltf.meshes),a.Assign(this._gltf.nodes),a.Assign(this._gltf.samplers),a.Assign(this._gltf.scenes),a.Assign(this._gltf.skins),a.Assign(this._gltf.textures),this._gltf.nodes){const V={};for(const W of this._gltf.nodes)if(W.children)for(const p of W.children)V[p]=W.index;const p=this._createRootNode();for(const W of this._gltf.nodes){const N=V[W.index];W.parent=void 0===N?p:this._gltf.nodes[N]}}}async _loadExtensionsAsync(){const V=[];if(D.forEach(((p,W)=>{var N;!1===(null===(N=this.parent.extensionOptions[W])||void 0===N?void 0:N.enabled)?p.isGLTFExtension&&this.isExtensionUsed(W)&&f.e.Warn(`Extension ${W} is used but has been explicitly disabled.`):p.isGLTFExtension&&!this.isExtensionUsed(W)||V.push((async()=>{const V=await p.factory(this);return V.name!==W&&f.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${V.name} !== ${W}`),this._parent.onExtensionLoadedObservable.notifyObservers(V),V})())})),this._extensions.push(...await Promise.all(V)),this._extensions.sort(((V,p)=>(V.order||Number.MAX_VALUE)-(p.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const W of this._gltf.extensionsRequired){if(!this._extensions.some((V=>V.name===W&&V.enabled))){var p;if(!1===(null===(p=this.parent.extensionOptions[W])||void 0===p?void 0:p.enabled))throw new Error(`Required extension ${W} is disabled`);throw new Error(`Required extension ${W} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new P.e("__root__",this._babylonScene);this._rootBabylonMesh=V,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Ab(!1);const p={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case X.k.AUTO:this._babylonScene.useRightHandedSystem||(p.rotation=[0,1,0,0],p.scale=[1,1,-1],y._LoadTransform(p,this._rootBabylonMesh));break;case X.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(V),p}loadSceneAsync(V,p){const W=this._extensionsLoadSceneAsync(V,p);if(W)return W;const N=new Array;if(this.logOpen(`${V} ${p.name||""}`),p.nodes)for(const d of p.nodes){const p=a.Get(`${V}/nodes/${d}`,this._gltf.nodes,d);N.push(this.loadNodeAsync(`/nodes/${p.index}`,p,(V=>{V.parent=this._rootBabylonMesh})))}for(const d of this._postSceneLoadActions)d();return N.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(N).then((()=>{}))}_forEachPrimitive(V,p){if(V._primitiveBabylonMeshes)for(const W of V._primitiveBabylonMeshes)p(W)}_getGeometries(){const V=[],p=this._gltf.nodes;if(p)for(const W of p)this._forEachPrimitive(W,(p=>{const W=p.sj;W&&-1===V.indexOf(W)&&V.push(W)}));return V}_getMeshes(){const V=[];this._rootBabylonMesh instanceof T.d&&V.push(this._rootBabylonMesh);const p=this._gltf.nodes;if(p)for(const W of p)this._forEachPrimitive(W,(p=>{V.push(p)}));return V}_getTransformNodes(){const V=[],p=this._gltf.nodes;if(p)for(const W of p)W._babylonTransformNode&&"tb"===W._babylonTransformNode.getClassName()&&V.push(W._babylonTransformNode),W._babylonTransformNodeForSkin&&V.push(W._babylonTransformNodeForSkin);return V}_getSkeletons(){const V=[],p=this._gltf.skins;if(p)for(const W of p)W._data&&V.push(W._data.babylonSkeleton);return V}_getAnimationGroups(){const V=[],p=this._gltf.animations;if(p)for(const W of p)W._babylonAnimationGroup&&V.push(W._babylonAnimationGroup);return V}_startAnimations(){switch(this._parent.animationStartMode){case X.g.NONE:break;case X.g.FIRST:{const V=this._getAnimationGroups();0!==V.length&&V[0].start(!0);break}case X.g.ALL:{const V=this._getAnimationGroups();for(const p of V)p.start(!0);break}default:return void f.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadNodeAsync(V,p,W);if(N)return N;if(p._babylonTransformNode)throw new Error(`${V}: Invalid recursive node hierarchy`);const d=new Array;this.logOpen(`${V} ${p.name||""}`);const E=N=>{if(y.AddPointerMetadata(N,V),y._LoadTransform(p,N),void 0!=p.camera){const W=a.Get(`${V}/camera`,this._gltf.cameras,p.camera);d.push(this.loadCameraAsync(`/cameras/${W.index}`,W,(V=>{V.parent=N})))}if(p.children)for(const W of p.children){const p=a.Get(`${V}/children/${W}`,this._gltf.nodes,W);d.push(this.loadNodeAsync(`/nodes/${p.index}`,p,(V=>{V.parent=N})))}W(N)},z=void 0!=p.mesh,S=this._parent.loadSkins&&void 0!=p.skin;if(!z||S){const V=p.name||`node${p.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const W=new h.b(V,this._babylonScene);W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==p.mesh?p._babylonTransformNode=W:p._babylonTransformNodeForSkin=W,E(W)}if(z)if(S){const W=a.Get(`${V}/mesh`,this._gltf.meshes,p.mesh);d.push(this._loadMeshAsync(`/meshes/${W.index}`,p,W,(W=>{const N=p._babylonTransformNodeForSkin;W.metadata=M(N.metadata,W.metadata||{});const E=a.Get(`${V}/skin`,this._gltf.skins,p.skin);d.push(this._loadSkinAsync(`/skins/${E.index}`,p,E,(V=>{this._forEachPrimitive(p,(p=>{p.skeleton=V})),this._postSceneLoadActions.push((()=>{if(void 0!=E.skeleton){const V=a.Get(`/skins/${E.index}/skeleton`,this._gltf.nodes,E.skeleton).parent;p.index===V.index?W.parent=N.parent:W.parent=V._babylonTransformNode}else W.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:N,skinnedNode:W})}))})))})))}else{const W=a.Get(`${V}/mesh`,this._gltf.meshes,p.mesh);d.push(this._loadMeshAsync(`/meshes/${W.index}`,p,W,E))}return this.logClose(),Promise.all(d).then((()=>(this._forEachPrimitive(p,(V=>{V.sj&&V.sj.useBoundingInfoFromGeometry?V.Ea():V.refreshBoundingInfo(!0,!0)})),p._babylonTransformNode)))}_loadMeshAsync(V,p,W,N){const d=W.primitives;if(!d||!d.length)throw new Error(`${V}: Primitives are missing`);void 0==d[0].index&&a.Assign(d);const E=new Array;this.logOpen(`${V} ${W.name||""}`);const z=p.name||`node${p.index}`;if(1===d.length){const N=W.primitives[0];E.push(this._loadMeshPrimitiveAsync(`${V}/primitives/${N.index}`,z,p,W,N,(V=>{p._babylonTransformNode=V,p._primitiveBabylonMeshes=[V]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,p._babylonTransformNode=new h.b(z,this._babylonScene),p._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p._primitiveBabylonMeshes=[];for(const N of d)E.push(this._loadMeshPrimitiveAsync(`${V}/primitives/${N.index}`,`${z}_primitive${N.index}`,p,W,N,(V=>{V.parent=p._babylonTransformNode,p._primitiveBabylonMeshes.push(V)})))}return N(p._babylonTransformNode),this.logClose(),Promise.all(E).then((()=>p._babylonTransformNode))}_loadMeshPrimitiveAsync(V,p,W,N,d,E){const z=this._extensionsLoadMeshPrimitiveAsync(V,p,W,N,d,E);if(z)return z;this.logOpen(`${V}`);const S=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==W.skin&&!N.primitives[0].targets;let Q,J;if(S&&d._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,Q=d._instanceData.babylonSourceMesh.createInstance(p),Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J=d._instanceData.promise;else{const E=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const z=new P.e(p,this._babylonScene);z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z.sideOrientation=this._babylonScene.useRightHandedSystem?F.d.CounterClockWiseSideOrientation:F.d.ClockWiseSideOrientation,this._createMorphTargets(V,W,N,d,z),E.push(this._loadVertexDataAsync(V,d,z).then((p=>this._loadMorphTargetsAsync(V,d,z,p).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,p.Ca(z),p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const i=y._GetDrawMode(V,d.mode);if(void 0==d.material){let V=this._defaultBabylonMaterialData[i];V||(V=this._createDefaultMaterial("__GLTFLoader._default",i),this._parent.onMaterialLoadedObservable.notifyObservers(V),this._defaultBabylonMaterialData[i]=V),z.material=V}else if(!this.parent.skipMaterials){const p=a.Get(`${V}/material`,this._gltf.materials,d.material);E.push(this._loadMaterialAsync(`/materials/${p.index}`,p,z,i,(V=>{z.material=V})))}J=Promise.all(E),S&&(d._instanceData={babylonSourceMesh:z,promise:J}),Q=z}return y.AddPointerMetadata(Q,V),this._parent.onMeshLoadedObservable.notifyObservers(Q),E(Q),this.logClose(),J.then((()=>Q))}_loadVertexDataAsync(V,p,W){const N=this._extensionsLoadVertexDataAsync(V,p,W);if(N)return N;const E=p.attributes;if(!E)throw new Error(`${V}: Attributes are missing`);const z=new Array,S=new x.e(W.name,this._babylonScene);if(void 0==p.indices)W.isUnIndexed=!0;else{const W=a.Get(`${V}/indices`,this._gltf.accessors,p.indices);z.push(this._loadIndicesAccessorAsync(`/accessors/${W.index}`,W).then((V=>{S.setIndices(V)})))}const Q=(p,N,Q)=>{if(void 0==E[p])return;W._delayInfo=W._delayInfo||[],-1===W._delayInfo.indexOf(N)&&W._delayInfo.push(N);const J=a.Get(`${V}/attributes/${p}`,this._gltf.accessors,E[p]);z.push(this._loadVertexAccessorAsync(`/accessors/${J.index}`,J,N).then((V=>{if(V.getKind()===L.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!W.skeleton&&J.min&&J.max){const V=d.i.fb[0].ge(...J.min),p=d.i.fb[1].ge(...J.max);if(J.normalized&&5126!==J.componentType){let W=1;switch(J.componentType){case 5120:W=127;break;case 5121:W=255;break;case 5122:W=32767;break;case 5123:W=65535}const N=1/W;V.scaleInPlace(N),p.scaleInPlace(N)}S._boundingInfo=new B.c(V,p),S.useBoundingInfoFromGeometry=!0}S.setVerticesBuffer(V,J.count)}))),N==L.f.MatricesIndicesExtraKind&&(W.numBoneInfluencers=8),Q&&Q(J)};return Q("POSITION",L.f.PositionKind),Q("NORMAL",L.f.NormalKind),Q("TANGENT",L.f.TangentKind),Q("TEXCOORD_0",L.f.UVKind),Q("TEXCOORD_1",L.f.UV2Kind),Q("TEXCOORD_2",L.f.UV3Kind),Q("TEXCOORD_3",L.f.UV4Kind),Q("TEXCOORD_4",L.f.UV5Kind),Q("TEXCOORD_5",L.f.UV6Kind),Q("JOINTS_0",L.f.MatricesIndicesKind),Q("WEIGHTS_0",L.f.MatricesWeightsKind),Q("JOINTS_1",L.f.MatricesIndicesExtraKind),Q("WEIGHTS_1",L.f.MatricesWeightsExtraKind),Q("COLOR_0",L.f.ColorKind,(V=>{"VEC4"===V.type&&(W.hasVertexAlpha=!0)})),Promise.all(z).then((()=>S))}_createMorphTargets(V,p,W,N,d){if(!N.targets||!this._parent.loadMorphTargets)return;if(void 0==p._numMorphTargets)p._numMorphTargets=N.targets.length;else if(N.targets.length!==p._numMorphTargets)throw new Error(`${V}: Primitives do not have the same number of targets`);const E=W.extras?W.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,d.morphTargetManager=new R(this._babylonScene),d.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d.morphTargetManager.areUpdatesFrozen=!0;for(let z=0;z<N.targets.length;z++){const V=p.weights?p.weights[z]:W.weights?W.weights[z]:0,N=E?E[z]:`morphTarget${z}`;d.morphTargetManager.addTarget(new b(N,V,d.va()))}}_loadMorphTargetsAsync(V,p,W,N){if(!p.targets||!this._parent.loadMorphTargets)return Promise.resolve();const d=new Array,E=W.morphTargetManager;for(let z=0;z<E.numTargets;z++){const W=E.getTarget(z);d.push(this._loadMorphTargetVertexDataAsync(`${V}/targets/${z}`,N,p.targets[z],W))}return Promise.all(d).then((()=>{E.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(V,p,W,N){const d=new Array,E=(N,E,z)=>{if(void 0==W[N])return;const S=p.getVertexBuffer(E);if(!S)return;const Q=a.Get(`${V}/${N}`,this._gltf.accessors,W[N]);d.push(this._loadFloatAccessorAsync(`/accessors/${Q.index}`,Q).then((V=>{z(S,V)})))};return E("POSITION",L.f.PositionKind,((V,p)=>{const W=new Float32Array(p.length);V.forEach(p.length,((V,N)=>{W[N]=p[N]+V})),N.setPositions(W)})),E("NORMAL",L.f.NormalKind,((V,p)=>{const W=new Float32Array(p.length);V.forEach(W.length,((V,N)=>{W[N]=p[N]+V})),N.setNormals(W)})),E("TANGENT",L.f.TangentKind,((V,p)=>{const W=new Float32Array(p.length/3*4);let d=0;V.forEach(p.length/3*4,((V,N)=>{(N+1)%4!==0&&(W[d]=p[d]+V,d++)})),N.setTangents(W)})),Promise.all(d).then((()=>{}))}static _LoadTransform(V,p){if(void 0!=V.skin)return;let W=d.n.Zero(),N=d.f.Identity(),E=d.n.One();if(V.matrix){d.e.Tg(V.matrix).decompose(E,N,W)}else V.translation&&(W=d.n.Tg(V.translation)),V.rotation&&(N=d.f.Tg(V.rotation)),V.scale&&(E=d.n.Tg(V.scale));p.position=W,p.rotationQuaternion=N,p.ie=E}_loadSkinAsync(V,p,W,N){if(!this._parent.loadSkins)return Promise.resolve();const d=this._extensionsLoadSkinAsync(V,p,W);if(d)return d;if(W._data)return N(W._data.babylonSkeleton),W._data.promise;const E=`skeleton${W.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const z=new U(W.name||E,E,this._babylonScene);z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(V,W,z);const S=this._loadSkinInverseBindMatricesDataAsync(V,W).then((V=>{this._updateBoneMatrices(z,V)}));return W._data={babylonSkeleton:z,promise:S},N(z),S}_loadBones(V,p,W){if(void 0==p.skeleton||this._parent.alwaysComputeSkeletonRootNode){const W=this._findSkeletonRootNode(`${V}/joints`,p.joints);if(W)if(void 0===p.skeleton)p.skeleton=W.index;else{const N=(V,p)=>{for(;p.parent;p=p.parent)if(p.parent===V)return!0;return!1},d=a.Get(`${V}/skeleton`,this._gltf.nodes,p.skeleton);d===W||N(d,W)||(f.e.Warn(`${V}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),p.skeleton=W.index)}else f.e.Warn(`${V}: Failed to find common root`)}const N={};for(const d of p.joints){const E=a.Get(`${V}/joints/${d}`,this._gltf.nodes,d);this._loadBone(E,p,W,N)}}_findSkeletonRootNode(V,p){if(0===p.length)return null;const W={};for(const d of p){const p=[];let N=a.Get(`${V}/${d}`,this._gltf.nodes,d);for(;-1!==N.index;)p.unshift(N),N=N.parent;W[d]=p}let N=null;for(let d=0;;++d){let V=W[p[0]];if(d>=V.length)return N;const E=V[d];for(let z=1;z<p.length;++z)if(V=W[p[z]],d>=V.length||E!==V[d])return N;N=E}}_loadBone(V,p,W,N){V._isJoint=!0;let d=N[V.index];if(d)return d;let E=null;V.index!==p.skeleton&&(V.parent&&-1!==V.parent.index?E=this._loadBone(V.parent,p,W,N):void 0!==p.skeleton&&f.e.Warn(`/skins/${p.index}/skeleton: Skeleton node is not a common root`));const z=p.joints.indexOf(V.index);return d=new J.c(V.name||`joint${V.index}`,W,E,this._getNodeMatrix(V),null,null,z),N[V.index]=d,this._postSceneLoadActions.push((()=>{d.linkTransformNode(V._babylonTransformNode)})),d}_loadSkinInverseBindMatricesDataAsync(V,p){if(void 0==p.inverseBindMatrices)return Promise.resolve(null);const W=a.Get(`${V}/inverseBindMatrices`,this._gltf.accessors,p.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${W.index}`,W)}_updateBoneMatrices(V,p){for(const W of V.bones){const V=d.e.Identity(),N=W._index;p&&-1!==N&&(d.e.FromArrayToRef(p,16*N,V),V.invertToRef(V));const E=W.getParent();E&&V.multiplyToRef(E.getAbsoluteInverseBindMatrix(),V),W.wj(V,!1,!1),W._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(V){return V.matrix?d.e.Tg(V.matrix):d.e.Compose(V.scale?d.n.Tg(V.scale):d.n.One(),V.rotation?d.f.Tg(V.rotation):d.f.Identity(),V.translation?d.n.Tg(V.translation):d.n.Zero())}loadCameraAsync(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadCameraAsync(V,p,W);if(N)return N;const E=new Array;this.logOpen(`${V} ${p.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const z=new Q.e(p.name||`camera${p.index}`,d.n.Zero(),this._babylonScene,!1);switch(z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z.ignoreParentScaling=!0,p._babylonCamera=z,z.rotation.set(0,Math.PI,0),p.type){case"perspective":{const W=p.perspective;if(!W)throw new Error(`${V}: Camera perspective properties are missing`);z.fov=W.yfov,z.Li=W.znear,z.maxZ=W.zfar||0;break}case"orthographic":if(!p.orthographic)throw new Error(`${V}: Camera orthographic properties are missing`);z.mode=S.d.ORTHOGRAPHIC_CAMERA,z.orthoLeft=-p.orthographic.xmag,z.orthoRight=p.orthographic.xmag,z.orthoBottom=-p.orthographic.ymag,z.orthoTop=p.orthographic.ymag,z.Li=p.orthographic.znear,z.maxZ=p.orthographic.zfar;break;default:throw new Error(`${V}: Invalid camera type (${p.type})`)}return y.AddPointerMetadata(z,V),this._parent.onCameraLoadedObservable.notifyObservers(z),W(z),this.logClose(),Promise.all(E).then((()=>z))}_loadAnimationsAsync(){const V=this._gltf.animations;if(!V)return Promise.resolve();const p=new Array;for(let W=0;W<V.length;W++){const N=V[W];p.push(this.loadAnimationAsync(`/animations/${N.index}`,N).then((V=>{0===V.targetedAnimations.length&&V.dispose()})))}return Promise.all(p).then((()=>{}))}loadAnimationAsync(V,p){const N=this._extensionsLoadAnimationAsync(V,p);return N||W.e(38).then(W.bind(W,13767)).then((W=>{let{AnimationGroup:N}=W;this._babylonScene._blockEntityCollection=!!this._assetContainer;const d=new N(p.name||`animation${p.index}`,this._babylonScene);d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p._babylonAnimationGroup=d;const E=new Array;a.Assign(p.channels),a.Assign(p.samplers);for(const z of p.channels)E.push(this._loadAnimationChannelAsync(`${V}/channels/${z.index}`,V,p,z,((V,p)=>{V.animations=V.animations||[],V.animations.push(p),d.addTargetedAnimation(p,V)})));return Promise.all(E).then((()=>(d.normalize(0),d)))}))}_loadAnimationChannelAsync(V,p,W,N,d){const E=this._extensionsLoadAnimationChannelAsync(V,p,W,N,d);if(E)return E;if(void 0==N.target.node)return Promise.resolve();const z=a.Get(`${V}/target/node`,this._gltf.nodes,N.target.node),S=N.target.path,Q="weights"===S;if(Q&&!z._numMorphTargets||!Q&&!z._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!Q&&!z._isJoint)return Promise.resolve();let J;switch(S){case"translation":J=q.translation;break;case"rotation":J=q.rotation;break;case"scale":J=q.scale;break;case"weights":J=q.weights;break;default:throw new Error(`${V}/target/path: Invalid value (${N.target.path})`)}const i={object:z,info:J};return this._loadAnimationChannelFromTargetInfoAsync(V,p,W,N,i,d)}_loadAnimationChannelFromTargetInfoAsync(V,p,W,N,d,E){const z=this.parent.targetFps,S=1/z,Q=a.Get(`${V}/sampler`,W.samplers,N.sampler);return this._loadAnimationSamplerAsync(`${p}/samplers/${N.sampler}`,Q).then((V=>{let p=0;const Q=d.object,J=d.info;for(const d of J){const J=d.getStride(Q),i=V.input,l=V.output,j=new Array(i.length);let k=0;switch(V.interpolation){case"STEP":for(let V=0;V<i.length;V++){const p=d.getValue(Q,l,k,1);k+=J,j[V]={frame:i[V]*z,value:p,interpolation:1}}break;case"CUBICSPLINE":for(let V=0;V<i.length;V++){const p=d.getValue(Q,l,k,S);k+=J;const W=d.getValue(Q,l,k,1);k+=J;const N=d.getValue(Q,l,k,S);k+=J,j[V]={frame:i[V]*z,inTangent:p,value:W,outTangent:N}}break;case"LINEAR":for(let V=0;V<i.length;V++){const p=d.getValue(Q,l,k,1);k+=J,j[V]={frame:i[V]*z,value:p}}}if(k>0){const V=`${W.name||`animation${W.index}`}_channel${N.index}_${p}`;d.buildAnimations(Q,V,z,j,((V,W)=>{++p,E(V,W)}))}}}))}_loadAnimationSamplerAsync(V,p){if(p._data)return p._data;const W=p.interpolation||"LINEAR";switch(W){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${V}/interpolation: Invalid value (${p.interpolation})`)}const N=a.Get(`${V}/input`,this._gltf.accessors,p.input),d=a.Get(`${V}/output`,this._gltf.accessors,p.output);return p._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${N.index}`,N),this._loadFloatAccessorAsync(`/accessors/${d.index}`,d)]).then((V=>{let[p,N]=V;return{input:p,interpolation:W,output:N}})),p._data}loadBufferAsync(V,p,W,N){const d=this._extensionsLoadBufferAsync(V,p,W,N);if(d)return d;if(!p._data)if(p.uri)p._data=this.loadUriAsync(`${V}/uri`,p,p.uri);else{if(!this._bin)throw new Error(`${V}: Uri is missing or the binary glTF is missing its binary chunk`);p._data=this._bin.readAsync(0,p.byteLength)}return p._data.then((p=>{try{return new Uint8Array(p.buffer,p.byteOffset+W,N)}catch(d){throw new Error(`${V}: ${d.message}`)}}))}loadBufferViewAsync(V,p){const W=this._extensionsLoadBufferViewAsync(V,p);if(W)return W;if(p._data)return p._data;const N=a.Get(`${V}/buffer`,this._gltf.buffers,p.buffer);return p._data=this.loadBufferAsync(`/buffers/${N.index}`,N,p.byteOffset||0,p.byteLength),p._data}_loadAccessorAsync(V,p,W){if(p._data)return p._data;const N=y._GetNumComponents(V,p.type),d=N*L.f.GetTypeByteLength(p.componentType),E=N*p.count;if(void 0==p.bufferView)p._data=Promise.resolve(new W(E));else{const z=a.Get(`${V}/bufferView`,this._gltf.bufferViews,p.bufferView);p._data=this.loadBufferViewAsync(`/bufferViews/${z.index}`,z).then((S=>{if(5126!==p.componentType||p.normalized||z.byteStride&&z.byteStride!==d){const V=new W(E);return L.f.ForEach(S,p.byteOffset||0,z.byteStride||d,N,p.componentType,V.length,p.normalized||!1,((p,W)=>{V[W]=p})),V}return y._GetTypedArray(V,p.componentType,S,p.byteOffset,E)}))}if(p.sparse){const E=p.sparse;p._data=p._data.then((z=>{const S=z,Q=a.Get(`${V}/sparse/indices/bufferView`,this._gltf.bufferViews,E.indices.bufferView),J=a.Get(`${V}/sparse/values/bufferView`,this._gltf.bufferViews,E.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q),this.loadBufferViewAsync(`/bufferViews/${J.index}`,J)]).then((z=>{let[Q,J]=z;const i=y._GetTypedArray(`${V}/sparse/indices`,E.indices.componentType,Q,E.indices.byteOffset,E.count),l=N*E.count;let j;if(5126!==p.componentType||p.normalized){const z=y._GetTypedArray(`${V}/sparse/values`,p.componentType,J,E.values.byteOffset,l);j=new W(l),L.f.ForEach(z,0,d,N,p.componentType,j.length,p.normalized||!1,((V,p)=>{j[p]=V}))}else j=y._GetTypedArray(`${V}/sparse/values`,p.componentType,J,E.values.byteOffset,l);let k=0;for(let V=0;V<i.length;V++){let p=i[V]*N;for(let V=0;V<N;V++)S[p++]=j[k++]}return S}))}))}return p._data}_loadFloatAccessorAsync(V,p){return this._loadAccessorAsync(V,p,Float32Array)}_loadIndicesAccessorAsync(V,p){if("SCALAR"!==p.type)throw new Error(`${V}/type: Invalid value ${p.type}`);if(5121!==p.componentType&&5123!==p.componentType&&5125!==p.componentType)throw new Error(`${V}/componentType: Invalid value ${p.componentType}`);if(p._data)return p._data;if(p.sparse){const W=y._GetTypedArrayConstructor(`${V}/componentType`,p.componentType);p._data=this._loadAccessorAsync(V,p,W)}else{const W=a.Get(`${V}/bufferView`,this._gltf.bufferViews,p.bufferView);p._data=this.loadBufferViewAsync(`/bufferViews/${W.index}`,W).then((W=>y._GetTypedArray(V,p.componentType,W,p.byteOffset,p.count)))}return p._data}_loadVertexBufferViewAsync(V){if(V._babylonBuffer)return V._babylonBuffer;const p=this._babylonScene.getEngine();return V._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${V.index}`,V).then((V=>new L.c(p,V,!1))),V._babylonBuffer}_loadVertexAccessorAsync(V,p,W){var N;if(null!==(N=p._babylonVertexBuffer)&&void 0!==N&&N[W])return p._babylonVertexBuffer[W];p._babylonVertexBuffer||(p._babylonVertexBuffer={});const d=this._babylonScene.getEngine();if(p.sparse||void 0==p.bufferView)p._babylonVertexBuffer[W]=this._loadFloatAccessorAsync(V,p).then((V=>new L.f(d,V,W,!1)));else{const N=a.Get(`${V}/bufferView`,this._gltf.bufferViews,p.bufferView);p._babylonVertexBuffer[W]=this._loadVertexBufferViewAsync(N).then((E=>{const z=y._GetNumComponents(V,p.type);return new L.f(d,E,W,!1,void 0,N.byteStride,void 0,p.byteOffset,z,p.componentType,p.normalized,!0,void 0,!0)}))}return p._babylonVertexBuffer[W]}_loadMaterialMetallicRoughnessPropertiesAsync(V,p,W){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);const N=new Array;return p&&(p.baseColorFactor?(W.albedoColor=E.c.Tg(p.baseColorFactor),W.alpha=p.baseColorFactor[3]):W.albedoColor=E.c.White(),W.metallic=void 0==p.metallicFactor?1:p.metallicFactor,W.roughness=void 0==p.roughnessFactor?1:p.roughnessFactor,p.baseColorTexture&&N.push(this.loadTextureInfoAsync(`${V}/baseColorTexture`,p.baseColorTexture,(V=>{V.name=`${W.name} (Base Color)`,W.albedoTexture=V}))),p.metallicRoughnessTexture&&(p.metallicRoughnessTexture.nonColorData=!0,N.push(this.loadTextureInfoAsync(`${V}/metallicRoughnessTexture`,p.metallicRoughnessTexture,(V=>{V.name=`${W.name} (Metallic Roughness)`,W.metallicTexture=V}))),W.useMetallnessFromMetallicTextureBlue=!0,W.useRoughnessFromMetallicTextureGreen=!0,W.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(N).then((()=>{}))}_loadMaterialAsync(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const E=this._extensionsLoadMaterialAsync(V,p,W,N,d);if(E)return E;p._data=p._data||{};let z=p._data[N];if(!z){this.logOpen(`${V} ${p.name||""}`);const W=this.createMaterial(V,p,N);z={babylonMaterial:W,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(V,p,W)},p._data[N]=z,y.AddPointerMetadata(W,V),this._parent.onMaterialLoadedObservable.notifyObservers(W),this.logClose()}return W&&(z.babylonMeshes.push(W),W.$i.addOnce((()=>{const V=z.babylonMeshes.indexOf(W);-1!==V&&z.babylonMeshes.splice(V,1)}))),d(z.babylonMaterial),z.promise.then((()=>z.babylonMaterial))}_createDefaultMaterial(V,p){this._babylonScene._blockEntityCollection=!!this._assetContainer;const W=new o(V,this._babylonScene);return W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W.fillMode=p,W.enableSpecularAntiAliasing=!0,W.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,W.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,W.transparencyMode=o.PBRMATERIAL_OPAQUE,W.metallic=1,W.roughness=1,W}createMaterial(V,p,W){const N=this._extensionsCreateMaterial(V,p,W);if(N)return N;const d=p.name||`material${p.index}`;return this._createDefaultMaterial(d,W)}loadMaterialPropertiesAsync(V,p,W){const N=this._extensionsLoadMaterialPropertiesAsync(V,p,W);if(N)return N;const d=new Array;return d.push(this.loadMaterialBasePropertiesAsync(V,p,W)),p.pbrMetallicRoughness&&d.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${V}/pbrMetallicRoughness`,p.pbrMetallicRoughness,W)),this.loadMaterialAlphaProperties(V,p,W),Promise.all(d).then((()=>{}))}loadMaterialBasePropertiesAsync(V,p,W){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);const N=new Array;return W.emissiveColor=p.emissiveFactor?E.c.Tg(p.emissiveFactor):new E.c(0,0,0),p.doubleSided&&(W.eh=!1,W.twoSidedLighting=!0),p.normalTexture&&(p.normalTexture.nonColorData=!0,N.push(this.loadTextureInfoAsync(`${V}/normalTexture`,p.normalTexture,(V=>{V.name=`${W.name} (Normal)`,W.bumpTexture=V}))),W.invertNormalMapX=!this._babylonScene.useRightHandedSystem,W.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=p.normalTexture.scale&&W.bumpTexture&&(W.bumpTexture.level=p.normalTexture.scale),W.forceIrradianceInFragment=!0),p.occlusionTexture&&(p.occlusionTexture.nonColorData=!0,N.push(this.loadTextureInfoAsync(`${V}/occlusionTexture`,p.occlusionTexture,(V=>{V.name=`${W.name} (Occlusion)`,W.ambientTexture=V}))),W.useAmbientInGrayScale=!0,void 0!=p.occlusionTexture.strength&&(W.ambientTextureStrength=p.occlusionTexture.strength)),p.emissiveTexture&&N.push(this.loadTextureInfoAsync(`${V}/emissiveTexture`,p.emissiveTexture,(V=>{V.name=`${W.name} (Emissive)`,W.emissiveTexture=V}))),Promise.all(N).then((()=>{}))}loadMaterialAlphaProperties(V,p,W){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);switch(p.alphaMode||"OPAQUE"){case"OPAQUE":W.transparencyMode=o.PBRMATERIAL_OPAQUE,W.alpha=1;break;case"MASK":W.transparencyMode=o.PBRMATERIAL_ALPHATEST,W.alphaCutOff=void 0==p.alphaCutoff?.5:p.alphaCutoff,W.albedoTexture&&(W.albedoTexture.xe=!0);break;case"BLEND":W.transparencyMode=o.PBRMATERIAL_ALPHABLEND,W.albedoTexture&&(W.albedoTexture.xe=!0,W.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${V}/alphaMode: Invalid value (${p.alphaMode})`)}}loadTextureInfoAsync(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadTextureInfoAsync(V,p,W);if(N)return N;if(this.logOpen(`${V}`),p.texCoord>=6)throw new Error(`${V}/texCoord: Invalid value (${p.texCoord})`);const d=a.Get(`${V}/index`,this._gltf.textures,p.index);d._textureInfo=p;const E=this._loadTextureAsync(`/textures/${p.index}`,d,(N=>{N.coordinatesIndex=p.texCoord||0,y.AddPointerMetadata(N,V),this._parent.onTextureLoadedObservable.notifyObservers(N),W(N)}));return this.logClose(),E}_loadTextureAsync(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const N=this._extensionsLoadTextureAsync(V,p,W);if(N)return N;this.logOpen(`${V} ${p.name||""}`);const d=void 0==p.sampler?y.DefaultSampler:a.Get(`${V}/sampler`,this._gltf.samplers,p.sampler),E=a.Get(`${V}/source`,this._gltf.images,p.source),z=this._createTextureAsync(V,d,E,W,void 0,!p._textureInfo.nonColorData);return this.logClose(),z}_createTextureAsync(V,p,W){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},E=arguments.length>4?arguments[4]:void 0,z=arguments.length>5?arguments[5]:void 0;const S=this._loadSampler(`/samplers/${p.index}`,p),Q=new Array,J=new N;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i={noMipmap:S.noMipMaps,invertY:!1,samplingMode:S.samplingMode,X:()=>{this._disposed||J.resolve()},onError:(p,W)=>{this._disposed||J.reject(new Error(`${V}: ${W&&W.message?W.message:p||"Failed to load texture"}`))},mimeType:W.mimeType,loaderOptions:E,useSRGBBuffer:!!z&&this._parent.useSRGBBuffers},l=new K.d(null,this._babylonScene,i);return l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q.push(J.promise),Q.push(this.loadImageAsync(`/images/${W.index}`,W).then((V=>{const p=W.uri||`${this._fileName}#image${W.index}`,N=`data:${this._uniqueRootUrl}${p}`;l.updateURL(N,V);const d=l.getInternalTexture();d&&(d.label=W.name)}))),l.wrapU=S.wrapU,l.wrapV=S.wrapV,d(l),this._parent.useGltfTextureNames&&(l.name=W.name||W.uri||`image${W.index}`),Promise.all(Q).then((()=>l))}_loadSampler(V,p){return p._data||(p._data={noMipMaps:9728===p.minFilter||9729===p.minFilter,samplingMode:y._GetTextureSamplingMode(V,p),wrapU:y._GetTextureWrapMode(`${V}/wrapS`,p.wrapS),wrapV:y._GetTextureWrapMode(`${V}/wrapT`,p.wrapT)}),p._data}loadImageAsync(V,p){if(!p._data){if(this.logOpen(`${V} ${p.name||""}`),p.uri)p._data=this.loadUriAsync(`${V}/uri`,p,p.uri);else{const W=a.Get(`${V}/bufferView`,this._gltf.bufferViews,p.bufferView);p._data=this.loadBufferViewAsync(`/bufferViews/${W.index}`,W)}this.logClose()}return p._data}loadUriAsync(V,p,W){const N=this._extensionsLoadUriAsync(V,p,W);if(N)return N;if(!y._ValidateUri(W))throw new Error(`${V}: '${W}' is invalid`);if((0,r.h)(W)){const p=new Uint8Array((0,r.e)(W));return this.log(`${V}: Decoded ${W.substring(0,64)}... (${p.length} bytes)`),Promise.resolve(p)}return this.log(`${V}: Loading ${W}`),this._parent.preprocessUrlAsync(this._rootUrl+W).then((p=>new Promise(((N,d)=>{this._parent._loadFile(this._babylonScene,p,(p=>{this._disposed||(this.log(`${V}: Loaded ${W} (${p.byteLength} bytes)`),N(new Uint8Array(p)))}),!0,(p=>{d(new r.i(`${V}: Failed to load '${W}'${p?": "+p.status+" "+p.statusText:""}`,p))}))}))))}static AddPointerMetadata(V,p){V.metadata=V.metadata||{};const W=V._internalMetadata=V._internalMetadata||{},N=W.Di=W.Di||{};(N.pointers=N.pointers||[]).push(p)}static _GetTextureWrapMode(V,p){switch(p=void 0==p?10497:p){case 33071:return K.d.CLAMP_ADDRESSMODE;case 33648:return K.d.MIRROR_ADDRESSMODE;case 10497:return K.d.WRAP_ADDRESSMODE;default:return f.e.Warn(`${V}: Invalid value (${p})`),K.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(V,p){const W=void 0==p.magFilter?9729:p.magFilter,N=void 0==p.minFilter?9987:p.minFilter;if(9729===W)switch(N){case 9728:return K.d.LINEAR_NEAREST;case 9729:return K.d.LINEAR_LINEAR;case 9984:return K.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return K.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return K.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return K.d.LINEAR_LINEAR_MIPLINEAR;default:return f.e.Warn(`${V}/minFilter: Invalid value (${N})`),K.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==W&&f.e.Warn(`${V}/magFilter: Invalid value (${W})`),N){case 9728:return K.d.NEAREST_NEAREST;case 9729:return K.d.NEAREST_LINEAR;case 9984:return K.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return K.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return K.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return K.d.NEAREST_LINEAR_MIPLINEAR;default:return f.e.Warn(`${V}/minFilter: Invalid value (${N})`),K.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(V,p){switch(p){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${V}: Invalid component type ${p}`)}}static _GetTypedArray(V,p,W,N,d){const E=W.buffer;N=W.byteOffset+(N||0);const z=y._GetTypedArrayConstructor(`${V}/componentType`,p),S=L.f.GetTypeByteLength(p);return N%S!==0?(f.e.Warn(`${V}: Copying buffer as byte offset (${N}) is not a multiple of component type byte length (${S})`),new z(E.slice(N,N+d*S),0)):new z(E,N,d)}static _GetNumComponents(V,p){switch(p){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${V}: Invalid type (${p})`)}static _ValidateUri(V){return z.e.IsBase64(V)||-1===V.indexOf("..")}static _GetDrawMode(V,p){switch(void 0==p&&(p=4),p){case 0:return F.d.PointListDrawMode;case 1:return F.d.LineListDrawMode;case 2:return F.d.LineLoopDrawMode;case 3:return F.d.LineStripDrawMode;case 4:return F.d.TriangleFillMode;case 5:return F.d.TriangleStripDrawMode;case 6:return F.d.TriangleFanDrawMode}throw new Error(`${V}: Invalid mesh primitive mode (${p})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const V=new Array;if(this._gltf.materials)for(const p of this._gltf.materials)if(p._data)for(const W in p._data){const N=p._data[W];for(const p of N.babylonMeshes){p.Dj(!0);const W=N.babylonMaterial;V.push(W.forceCompilationAsync(p)),V.push(W.forceCompilationAsync(p,{useInstances:!0})),this._parent.useClipPlane&&(V.push(W.forceCompilationAsync(p,{clipPlane:!0})),V.push(W.forceCompilationAsync(p,{clipPlane:!0,useInstances:!0})))}}return Promise.all(V).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const V=new Array,p=this._babylonScene.lights;for(const W of p){const p=W.getShadowGenerator();p&&V.push(p.forceCompilationAsync())}return Promise.all(V).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(V){for(const p of this._extensions)p.enabled&&V(p)}_applyExtensions(V,p,W){for(const N of this._extensions)if(N.enabled){const d=`${N.name}.${p}`,E=V;E._activeLoaderExtensionFunctions=E._activeLoaderExtensionFunctions||{};const z=E._activeLoaderExtensionFunctions;if(!z[d]){z[d]=!0;try{const V=W(N);if(V)return V}finally{delete z[d]}}}return null}_extensionsOnLoading(){this._forEachExtensions((V=>V.onLoading&&V.onLoading()))}_extensionsOnReady(){this._forEachExtensions((V=>V.onReady&&V.onReady()))}_extensionsLoadSceneAsync(V,p){return this._applyExtensions(p,"loadScene",(W=>W.loadSceneAsync&&W.loadSceneAsync(V,p)))}_extensionsLoadNodeAsync(V,p,W){return this._applyExtensions(p,"loadNode",(N=>N.loadNodeAsync&&N.loadNodeAsync(V,p,W)))}_extensionsLoadCameraAsync(V,p,W){return this._applyExtensions(p,"loadCamera",(N=>N.loadCameraAsync&&N.loadCameraAsync(V,p,W)))}_extensionsLoadVertexDataAsync(V,p,W){return this._applyExtensions(p,"loadVertexData",(N=>N._loadVertexDataAsync&&N._loadVertexDataAsync(V,p,W)))}_extensionsLoadMeshPrimitiveAsync(V,p,W,N,d,E){return this._applyExtensions(d,"loadMeshPrimitive",(z=>z._loadMeshPrimitiveAsync&&z._loadMeshPrimitiveAsync(V,p,W,N,d,E)))}_extensionsLoadMaterialAsync(V,p,W,N,d){return this._applyExtensions(p,"loadMaterial",(E=>E._loadMaterialAsync&&E._loadMaterialAsync(V,p,W,N,d)))}_extensionsCreateMaterial(V,p,W){return this._applyExtensions(p,"createMaterial",(N=>N.createMaterial&&N.createMaterial(V,p,W)))}_extensionsLoadMaterialPropertiesAsync(V,p,W){return this._applyExtensions(p,"loadMaterialProperties",(N=>N.loadMaterialPropertiesAsync&&N.loadMaterialPropertiesAsync(V,p,W)))}_extensionsLoadTextureInfoAsync(V,p,W){return this._applyExtensions(p,"loadTextureInfo",(N=>N.loadTextureInfoAsync&&N.loadTextureInfoAsync(V,p,W)))}_extensionsLoadTextureAsync(V,p,W){return this._applyExtensions(p,"loadTexture",(N=>N._loadTextureAsync&&N._loadTextureAsync(V,p,W)))}_extensionsLoadAnimationAsync(V,p){return this._applyExtensions(p,"loadAnimation",(W=>W.loadAnimationAsync&&W.loadAnimationAsync(V,p)))}_extensionsLoadAnimationChannelAsync(V,p,W,N,d){return this._applyExtensions(W,"loadAnimationChannel",(E=>E._loadAnimationChannelAsync&&E._loadAnimationChannelAsync(V,p,W,N,d)))}_extensionsLoadSkinAsync(V,p,W){return this._applyExtensions(W,"loadSkin",(N=>N._loadSkinAsync&&N._loadSkinAsync(V,p,W)))}_extensionsLoadUriAsync(V,p,W){return this._applyExtensions(p,"loadUri",(N=>N._loadUriAsync&&N._loadUriAsync(V,p,W)))}_extensionsLoadBufferViewAsync(V,p){return this._applyExtensions(p,"loadBufferView",(W=>W.loadBufferViewAsync&&W.loadBufferViewAsync(V,p)))}_extensionsLoadBufferAsync(V,p,W,N){return this._applyExtensions(p,"loadBuffer",(d=>d.loadBufferAsync&&d.loadBufferAsync(V,p,W,N)))}static LoadExtensionAsync(V,p,W,N){if(!p.extensions)return null;const d=p.extensions[W];return d?N(`${V}/extensions/${W}`,d):null}static LoadExtraAsync(V,p,W,N){if(!p.extras)return null;const d=p.extras[W];return d?N(`${V}/extras/${W}`,d):null}isExtensionUsed(V){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(V)}logOpen(V){this._parent._logOpen(V)}logClose(){this._parent._logClose()}log(V){this._parent._log(V)}startPerformanceCounter(V){this._parent._startPerformanceCounter(V)}endPerformanceCounter(V){this._parent._endPerformanceCounter(V)}}y.DefaultSampler={index:-1},X.d._CreateGLTF2Loader=V=>new y(V);var n=W(11757),w=W(12553),VV=W(12563);class pV extends VV.d{constructor(V,p,W){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5],z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",V),this._texture=V.getEngine().createRawCubeTexture(p,W,N,d,E,z,S,Q)}update(V,p,W,N){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,V,p,W,N,d)}updateRGBDAsync(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,w.o)(this._texture,V,p,W,N).then((()=>{}))}clone(){return Z.b.Clone((()=>{const V=this.va(),p=this._texture,W=new pV(V,p._bufferViewArray,p.width,p.format,p.type,p.generateMipMaps,p.invertY,p.samplingMode,p._compression);return 13===p.source&&W.updateRGBDAsync(p._bufferViewArrayArray,p._sphericalPolynomial,p._lodGenerationScale,p._lodGenerationOffset),W}),this)}}const WV="EXT_lights_image_based";class NV{constructor(V){this.name=WV,this._loader=V,this.enabled=this._loader.isExtensionUsed(WV)}dispose(){this._loader=null,delete this._lights}onLoading(){const V=this._loader.Di.extensions;if(V&&V[this.name]){const p=V[this.name];this._lights=p.lights}}loadSceneAsync(V,p){return y.LoadExtensionAsync(V,p,this.name,((W,N)=>{this._loader._allMaterialsDirtyRequired=!0;const d=new Array;d.push(this._loader.loadSceneAsync(V,p)),this._loader.logOpen(`${W}`);const E=a.Get(`${W}/light`,this._lights,N.eb);return d.push(this._loadLightAsync(`/extensions/${this.name}/lights/${N.eb}`,E).then((V=>{this._loader.babylonScene.environmentTexture=V}))),this._loader.logClose(),Promise.all(d).then((()=>{}))}))}_loadLightAsync(V,p){if(!p._loaded){const W=new Array;this._loader.logOpen(`${V}`);const N=new Array(p.specularImages.length);for(let d=0;d<p.specularImages.length;d++){const E=p.specularImages[d];N[d]=new Array(E.length);for(let p=0;p<E.length;p++){const z=`${V}/specularImages/${d}/${p}`;this._loader.logOpen(`${z}`);const S=E[p],Q=a.Get(z,this._loader.Di.images,S);W.push(this._loader.loadImageAsync(`/images/${S}`,Q).then((V=>{N[d][p]=V}))),this._loader.logClose()}}this._loader.logClose(),p._loaded=Promise.all(W).then((()=>{const W=new pV(this._loader.babylonScene,null,p.specularImageSize);if(W.name=p.name||"environment",p._babylonTexture=W,void 0!=p.Pi&&(W.level=p.Pi),p.rotation){let V=d.f.Tg(p.rotation);this._loader.babylonScene.useRightHandedSystem||(V=d.f.Inverse(V)),d.e.FromQuaternionToRef(V,W.getReflectionTextureMatrix())}if(!p.irradianceCoefficients)throw new Error(`${V}: Irradiance coefficients are missing`);const E=n.e.Tg(p.irradianceCoefficients);E.scaleInPlace(p.Pi),E.convertIrradianceToLambertianRadiance();const z=n.i.FromHarmonics(E),S=(N.length-1)/Math.log2(p.specularImageSize);return W.updateRGBDAsync(N,z,S)}))}return p._loaded.then((()=>p._babylonTexture))}}m(WV),H(WV,!0,(V=>new NV(V)));W(12572);const dV="EXT_mesh_gpu_instancing";class EV{constructor(V){this.name=dV,this._loader=V,this.enabled=this._loader.isExtensionUsed(dV)}dispose(){this._loader=null}loadNodeAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((V,N)=>{this._loader._disableInstancedMesh++;const E=this._loader.loadNodeAsync(`/nodes/${p.index}`,p,W);if(this._loader._disableInstancedMesh--,!p._primitiveBabylonMeshes)return E;const z=new Array;let S=0;const Q=p=>{if(void 0==N.attributes[p])return void z.push(Promise.resolve(null));const W=a.Get(`${V}/attributes/${p}`,this._loader.Di.accessors,N.attributes[p]);if(z.push(this._loader._loadFloatAccessorAsync(`/accessors/${W.bufferView}`,W)),0===S)S=W.count;else if(S!==W.count)throw new Error(`${V}/attributes: Instance buffer accessors do not have the same count.`)};return Q("TRANSLATION"),Q("ROTATION"),Q("SCALE"),E.then((V=>Promise.all(z).then((W=>{let[N,E,z]=W;const Q=new Float32Array(16*S);d.i.fb[0].ge(0,0,0),d.i.Quaternion[0].ge(0,0,0,1),d.i.fb[1].ge(1,1,1);for(let V=0;V<S;++V)N&&d.n.FromArrayToRef(N,3*V,d.i.fb[0]),E&&d.f.FromArrayToRef(E,4*V,d.i.Quaternion[0]),z&&d.n.FromArrayToRef(z,3*V,d.i.fb[1]),d.e.ComposeToRef(d.i.fb[1],d.i.Quaternion[0],d.i.fb[0],d.i.Matrix[0]),d.i.Matrix[0].copyToArray(Q,16*V);for(const V of p._primitiveBabylonMeshes)V.Cb("matrix",Q,16,!0);return V}))))}))}}m(dV),H(dV,!0,(V=>new EV(V)));class zV{static get Default(){return zV._Default||(zV._Default=new zV),zV._Default}constructor(){const V=zV.Configuration.decoder;this._decoderModulePromise=z.e.LoadBabylonScriptAsync(V.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(V,p,W,N,d){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const E=await MeshoptDecoder.decodeGltfBufferAsync(p,W,V,N,d);return MeshoptDecoder.useWorkers(0),E}))}}zV.Configuration={decoder:{url:`${z.e._DefaultCdnUrl}/meshopt_decoder.js`}},zV._Default=null;const SV="EXT_meshopt_compression";class QV{constructor(V){this.name=SV,this.enabled=V.isExtensionUsed(SV),this._loader=V}dispose(){this._loader=null}loadBufferViewAsync(V,p){return y.LoadExtensionAsync(V,p,this.name,((W,N)=>{const d=p;if(d._meshOptData)return d._meshOptData;const E=a.Get(`${V}/buffer`,this._loader.Di.buffers,N.buffer);return d._meshOptData=this._loader.loadBufferAsync(`/buffers/${E.index}`,E,N.byteOffset||0,N.byteLength).then((V=>zV.Default.decodeGltfBufferAsync(V,N.count,N.byteStride,N.mode,N.filter))),d._meshOptData}))}}m(SV),H(SV,!0,(V=>new QV(V)));const JV="EXT_texture_webp";class iV{constructor(V){this.name=JV,this._loader=V,this.enabled=V.isExtensionUsed(JV)}dispose(){this._loader=null}_loadTextureAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{const E=void 0==p.sampler?y.DefaultSampler:a.Get(`${V}/sampler`,this._loader.Di.samplers,p.sampler),z=a.Get(`${N}/source`,this._loader.Di.images,d.source);return this._loader._createTextureAsync(V,E,z,(V=>{W(V)}),void 0,!p._textureInfo.nonColorData)}))}}m(JV),H(JV,!0,(V=>new iV(V)));const lV="EXT_texture_avif";class jV{constructor(V){this.name=lV,this._loader=V,this.enabled=V.isExtensionUsed(lV)}dispose(){this._loader=null}_loadTextureAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{const E=void 0==p.sampler?y.DefaultSampler:a.Get(`${V}/sampler`,this._loader.Di.samplers,p.sampler),z=a.Get(`${N}/source`,this._loader.Di.images,d.source);return this._loader._createTextureAsync(V,E,z,(V=>{W(V)}),void 0,!p._textureInfo.nonColorData)}))}}m(lV),H(lV,!0,(V=>new jV(V)));var kV=W(12578);const uV="KHR_draco_mesh_compression";class fV{constructor(V){this.name=uV,this.useNormalizedFlagFromAccessor=!0,this._loader=V,this.enabled=kV.e.DecoderAvailable&&this._loader.isExtensionUsed(uV)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{if(void 0!=p.mode&&4!==p.mode&&5!==p.mode)throw new Error(`${V}: Unsupported mode ${p.mode}`);const E={},z={},S=(V,N)=>{const S=d.attributes[V];if(void 0!=S&&(W._delayInfo=W._delayInfo||[],-1===W._delayInfo.indexOf(N)&&W._delayInfo.push(N),E[N]=S,this.useNormalizedFlagFromAccessor)){const W=a.TryGet(this._loader.Di.accessors,p.attributes[V]);W&&(z[N]=W.normalized||!1)}};S("POSITION",L.f.PositionKind),S("NORMAL",L.f.NormalKind),S("TANGENT",L.f.TangentKind),S("TEXCOORD_0",L.f.UVKind),S("TEXCOORD_1",L.f.UV2Kind),S("TEXCOORD_2",L.f.UV3Kind),S("TEXCOORD_3",L.f.UV4Kind),S("TEXCOORD_4",L.f.UV5Kind),S("TEXCOORD_5",L.f.UV6Kind),S("JOINTS_0",L.f.MatricesIndicesKind),S("WEIGHTS_0",L.f.MatricesWeightsKind),S("COLOR_0",L.f.ColorKind);const Q=a.Get(N,this._loader.Di.bufferViews,d.bufferView);return Q._dracoBabylonGeometry||(Q._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q).then((p=>(this.dracoCompression||kV.e.Default)._decodeMeshToGeometryForGltfAsync(W.name,this._loader.babylonScene,p,E,z).catch((p=>{throw new Error(`${V}: ${p.message}`)}))))),Q._dracoBabylonGeometry}))}}m(uV),H(uV,!0,(V=>new fV(V)));var OV=W(12589),UV=W(11529),FV=W(12542),CV=W(12591);UV.b.AddNodeConstructor("Light_Type_0",((V,p)=>()=>new AV(V,d.n.Zero(),p)));class AV extends CV.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(V){this._shadowAngle=V,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(V){const p=this.needCube();if(this._direction=V,this.needCube()!==p&&this._shadowGenerators){const V=this._shadowGenerators.values();for(let p=V.next();!0!==p.done;p=V.next()){p.value.recreateShadowMap()}}}constructor(V,p,W){super(V,W),this._shadowAngle=Math.PI/2,this.position=p}getClassName(){return"PointLight"}getTypeID(){return FV.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(V){if(this.direction)return super.getShadowDirection(V);switch(V){case 0:return new d.n(1,0,0);case 1:return new d.n(-1,0,0);case 2:return new d.n(0,-1,0);case 3:return new d.n(0,1,0);case 4:return new d.n(0,0,1);case 5:return new d.n(0,0,-1)}return d.n.Zero()}_setDefaultShadowProjectionMatrix(V,p,W){const N=this.va().activeCamera;if(!N)return;const E=void 0!==this.shadowMinZ?this.shadowMinZ:N.Li,z=void 0!==this.shadowMaxZ?this.shadowMaxZ:N.maxZ,S=this.va().getEngine().useReverseDepthBuffer;d.e.PerspectiveFovLHToRef(this.shadowAngle,1,S?z:E,S?E:z,V,!0,this._scene.getEngine().isNDCHalfZRange,void 0,S)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(V,p){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,p):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,p),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,p),this}transferToNodeMaterialEffect(V,p){return this.computeTransformedInformation()?V.setFloat3(p,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):V.setFloat3(p,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(V,p){V["POINTLIGHT"+p]=!0}}(0,C.c)([(0,A.I)()],AV.prototype,"shadowAngle",null),(0,e.d)("BABYLON.PointLight",AV),UV.b.AddNodeConstructor("Light_Type_2",((V,p)=>()=>new vV(V,d.n.Zero(),d.n.Zero(),0,0,p)));class vV extends CV.b{get angle(){return this._angle}set angle(V){this._angle=V,this._cosHalfAngle=Math.cos(.5*V),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(V){this._innerAngle=V,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(V){this._shadowAngleScale=V,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(V){this._projectionTextureLightNear=V,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(V){this._projectionTextureLightFar=V,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(V){this._projectionTextureUpDirection=V,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(V){this._projectionTexture!==V&&(this._projectionTexture=V,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(vV._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):vV._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(V){return void 0!==V.onGeneratedObservable}static _IsTexture(V){return void 0!==V.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(V){this._projectionTextureProjectionLightMatrix=V,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(V,p,W,N,E,z){super(V,z),this._innerAngle=0,this._projectionTextureMatrix=d.e.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=d.n.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=d.n.Zero(),this._projectionTextureViewLightMatrix=d.e.Zero(),this._projectionTextureProjectionLightMatrix=d.e.Zero(),this._projectionTextureScalingMatrix=d.e.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=p,this.direction=W,this.angle=N,this.exponent=E}getClassName(){return"SpotLight"}getTypeID(){return FV.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(V){super._setDirection(V),this._projectionTextureViewLightDirty=!0}_setPosition(V){super._setPosition(V),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(V,p,W){const N=this.va().activeCamera;if(!N)return;this._shadowAngleScale=this._shadowAngleScale||1;const E=this._shadowAngleScale*this._angle,z=void 0!==this.shadowMinZ?this.shadowMinZ:N.Li,S=void 0!==this.shadowMaxZ?this.shadowMaxZ:N.maxZ,Q=this.va().getEngine().useReverseDepthBuffer;d.e.PerspectiveFovLHToRef(E,1,Q?S:z,Q?z:S,V,!0,this._scene.getEngine().isNDCHalfZRange,void 0,Q)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),d.e.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const V=this.projectionTextureLightFar,p=this.projectionTextureLightNear,W=V/(V-p),N=-W*p,E=1/Math.tan(this._angle/2);d.e.FromValuesToRef(E/1,0,0,0,0,E,0,0,0,0,W,1,0,0,N,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof K.d){const V=this._projectionTexture.uScale/2,p=this._projectionTexture.vScale/2;d.e.FromValuesToRef(V,0,0,0,0,p,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(V,p){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),V.setMatrix("textureProjectionMatrix"+p,this._projectionTextureMatrix),V.setTexture("projectionLightTexture"+p,this.projectionTexture)),this}transferToEffect(V,p){let W;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,p),W=d.n.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,p),W=d.n.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",W.x,W.y,W.z,this._cosHalfAngle,p),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,p),this}transferToNodeMaterialEffect(V,p){let W;return W=this.computeTransformedInformation()?d.n.Normalize(this.transformedDirection):d.n.Normalize(this.direction),this.va().useRightHandedSystem?V.setFloat3(p,-W.x,-W.y,-W.z):V.setFloat3(p,W.x,W.y,W.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(V){const p=this._scene.getEngine(),W=void 0!==this.shadowMinZ?this.shadowMinZ:V.Li;return p.useReverseDepthBuffer&&p.isNDCHalfZRange?W:this._scene.getEngine().isNDCHalfZRange?0:W}getDepthMaxZ(V){const p=this._scene.getEngine(),W=void 0!==this.shadowMaxZ?this.shadowMaxZ:V.maxZ;return p.useReverseDepthBuffer&&p.isNDCHalfZRange?0:W}prepareLightSpecificDefines(V,p){V["SPOTLIGHT"+p]=!0,V["PROJECTEDLIGHTTEXTURE"+p]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,C.c)([(0,A.I)()],vV.prototype,"angle",null),(0,C.c)([(0,A.I)()],vV.prototype,"innerAngle",null),(0,C.c)([(0,A.I)()],vV.prototype,"shadowAngleScale",null),(0,C.c)([(0,A.I)()],vV.prototype,"exponent",void 0),(0,C.c)([(0,A.I)()],vV.prototype,"projectionTextureLightNear",null),(0,C.c)([(0,A.I)()],vV.prototype,"projectionTextureLightFar",null),(0,C.c)([(0,A.I)()],vV.prototype,"projectionTextureUpDirection",null),(0,C.c)([(0,A.A)("projectedLightTexture")],vV.prototype,"_projectionTexture",void 0),(0,e.d)("BABYLON.SpotLight",vV);const tV="KHR_lights_punctual";class eV{constructor(V){this.name=tV,this._loader=V,this.enabled=this._loader.isExtensionUsed(tV)}dispose(){this._loader=null,delete this._lights}onLoading(){const V=this._loader.Di.extensions;if(V&&V[this.name]){const p=V[this.name];this._lights=p.lights,a.Assign(this._lights)}}loadNodeAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,z)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(V,p,(V=>{let p;const S=a.Get(N,this._lights,z.eb),Q=S.name||V.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,S.type){case"directional":{const V=new OV.c(Q,d.n.Backward(),this._loader.babylonScene);V.position.ee(0),p=V;break}case"point":p=new AV(Q,d.n.Zero(),this._loader.babylonScene);break;case"spot":{const V=new vV(Q,d.n.Zero(),d.n.Backward(),0,1,this._loader.babylonScene);V.angle=2*(S.spot&&S.spot.outerConeAngle||Math.PI/4),V.innerAngle=2*(S.spot&&S.spot.innerConeAngle||0),p=V;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${N}: Invalid light type (${S.type})`)}p._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,S._babylonLight=p,p.falloffType=FV.e.FALLOFF_GLTF,p.qh=S.color?E.c.Tg(S.color):E.c.White(),p.Pi=void 0==S.Pi?1:S.Pi,p.range=void 0==S.range?Number.MAX_VALUE:S.range,p.parent=V,this._loader._babylonLights.push(p),y.AddPointerMetadata(p,N),W(V)})))))}}m(tV),H(tV,!0,(V=>new eV(V)));const ZV="KHR_materials_pbrSpecularGlossiness";class oV{constructor(V){this.name=ZV,this.order=200,this._loader=V,this.enabled=this._loader.isExtensionUsed(ZV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{const E=new Array;return E.push(this._loader.loadMaterialBasePropertiesAsync(V,p,W)),E.push(this._loadSpecularGlossinessPropertiesAsync(N,d,W)),this._loader.loadMaterialAlphaProperties(V,p,W),Promise.all(E).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(V,p,W){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);const N=new Array;return W.metallic=null,W.roughness=null,p.diffuseFactor?(W.albedoColor=E.c.Tg(p.diffuseFactor),W.alpha=p.diffuseFactor[3]):W.albedoColor=E.c.White(),W.reflectivityColor=p.specularFactor?E.c.Tg(p.specularFactor):E.c.White(),W.microSurface=void 0==p.glossinessFactor?1:p.glossinessFactor,p.diffuseTexture&&N.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTexture`,p.diffuseTexture,(V=>{V.name=`${W.name} (Diffuse)`,W.albedoTexture=V}))),p.specularGlossinessTexture&&(N.push(this._loader.loadTextureInfoAsync(`${V}/specularGlossinessTexture`,p.specularGlossinessTexture,(V=>{V.name=`${W.name} (Specular Glossiness)`,W.reflectivityTexture=V,W.reflectivityTexture.xe=!0}))),W.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(N).then((()=>{}))}}m(ZV),H(ZV,!0,(V=>new oV(V)));const KV="KHR_materials_unlit";class hV{constructor(V){this.name=KV,this.order=210,this._loader=V,this.enabled=this._loader.isExtensionUsed(KV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,(()=>this._loadUnlitPropertiesAsync(V,p,W)))}_loadUnlitPropertiesAsync(V,p,W){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);const N=new Array;W.unlit=!0;const d=p.pbrMetallicRoughness;return d&&(d.baseColorFactor?(W.albedoColor=E.c.Tg(d.baseColorFactor),W.alpha=d.baseColorFactor[3]):W.albedoColor=E.c.White(),d.baseColorTexture&&N.push(this._loader.loadTextureInfoAsync(`${V}/baseColorTexture`,d.baseColorTexture,(V=>{V.name=`${W.name} (Base Color)`,W.albedoTexture=V})))),p.doubleSided&&(W.eh=!1,W.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(V,p,W),Promise.all(N).then((()=>{}))}}m(KV),H(KV,!0,(V=>new hV(V)));const LV="KHR_materials_clearcoat";class xV{constructor(V){this.name=LV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(LV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,p,W)),E.push(this._loadClearCoatPropertiesAsync(N,d,W)),Promise.all(E).then((()=>{}))}))}_loadClearCoatPropertiesAsync(V,p,W){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);const N=new Array;return W.clearCoat.isEnabled=!0,W.clearCoat.useRoughnessFromMainTexture=!1,W.clearCoat.remapF0OnInterfaceChange=!1,void 0!=p.clearcoatFactor?W.clearCoat.Pi=p.clearcoatFactor:W.clearCoat.Pi=0,p.clearcoatTexture&&N.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatTexture`,p.clearcoatTexture,(V=>{V.name=`${W.name} (ClearCoat)`,W.clearCoat.texture=V}))),void 0!=p.clearcoatRoughnessFactor?W.clearCoat.roughness=p.clearcoatRoughnessFactor:W.clearCoat.roughness=0,p.clearcoatRoughnessTexture&&(p.clearcoatRoughnessTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatRoughnessTexture`,p.clearcoatRoughnessTexture,(V=>{V.name=`${W.name} (ClearCoat Roughness)`,W.clearCoat.textureRoughness=V})))),p.clearcoatNormalTexture&&(p.clearcoatNormalTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatNormalTexture`,p.clearcoatNormalTexture,(V=>{V.name=`${W.name} (ClearCoat Normal)`,W.clearCoat.bumpTexture=V}))),W.invertNormalMapX=!W.va().useRightHandedSystem,W.invertNormalMapY=W.va().useRightHandedSystem,void 0!=p.clearcoatNormalTexture.scale&&(W.clearCoat.bumpTexture.level=p.clearcoatNormalTexture.scale)),Promise.all(N).then((()=>{}))}}m(LV),H(LV,!0,(V=>new xV(V)));const TV="KHR_materials_iridescence";class PV{constructor(V){this.name=TV,this.order=195,this._loader=V,this.enabled=this._loader.isExtensionUsed(TV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,p,W)),E.push(this._loadIridescencePropertiesAsync(N,d,W)),Promise.all(E).then((()=>{}))}))}_loadIridescencePropertiesAsync(V,p,W){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);const N=new Array;return W.iridescence.isEnabled=!0,W.iridescence.Pi=p.iridescenceFactor??0,W.iridescence.indexOfRefraction=p.iridescenceIor??p.iridescenceIOR??1.3,W.iridescence.minimumThickness=p.iridescenceThicknessMinimum??100,W.iridescence.maximumThickness=p.iridescenceThicknessMaximum??400,p.iridescenceTexture&&N.push(this._loader.loadTextureInfoAsync(`${V}/iridescenceTexture`,p.iridescenceTexture,(V=>{V.name=`${W.name} (Iridescence)`,W.iridescence.texture=V}))),p.iridescenceThicknessTexture&&N.push(this._loader.loadTextureInfoAsync(`${V}/iridescenceThicknessTexture`,p.iridescenceThicknessTexture,(V=>{V.name=`${W.name} (Iridescence Thickness)`,W.iridescence.thicknessTexture=V}))),Promise.all(N).then((()=>{}))}}m(TV),H(TV,!0,(V=>new PV(V)));const bV="KHR_materials_anisotropy";class sV{constructor(V){this.name=bV,this.order=195,this._loader=V,this.enabled=this._loader.isExtensionUsed(bV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,p,W)),E.push(this._loadIridescencePropertiesAsync(N,d,W)),Promise.all(E).then((()=>{}))}))}_loadIridescencePropertiesAsync(V,p,W){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);const N=new Array;return W.anisotropy.isEnabled=!0,W.anisotropy.Pi=p.anisotropyStrength??0,W.anisotropy.angle=p.anisotropyRotation??0,p.anisotropyTexture&&(p.anisotropyTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${V}/anisotropyTexture`,p.anisotropyTexture,(V=>{V.name=`${W.name} (Anisotropy Intensity)`,W.anisotropy.texture=V})))),Promise.all(N).then((()=>{}))}}m(bV),H(bV,!0,(V=>new sV(V)));const GV="KHR_materials_emissive_strength";class RV{constructor(V){this.name=GV,this.order=170,this._loader=V,this.enabled=this._loader.isExtensionUsed(GV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>this._loader.loadMaterialPropertiesAsync(V,p,W).then((()=>{this._loadEmissiveProperties(N,d,W)}))))}_loadEmissiveProperties(V,p,W){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);void 0!==p.emissiveStrength&&(W.emissiveIntensity=p.emissiveStrength)}}m(GV),H(GV,!0,(V=>new RV(V)));const XV="KHR_materials_sheen";class rV{constructor(V){this.name=XV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(XV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,p,W)),E.push(this._loadSheenPropertiesAsync(N,d,W)),Promise.all(E).then((()=>{}))}))}_loadSheenPropertiesAsync(V,p,W){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);const N=new Array;return W.sheen.isEnabled=!0,W.sheen.Pi=1,void 0!=p.sheenColorFactor?W.sheen.color=E.c.Tg(p.sheenColorFactor):W.sheen.color=E.c.Black(),p.sheenColorTexture&&N.push(this._loader.loadTextureInfoAsync(`${V}/sheenColorTexture`,p.sheenColorTexture,(V=>{V.name=`${W.name} (Sheen Color)`,W.sheen.texture=V}))),void 0!==p.sheenRoughnessFactor?W.sheen.roughness=p.sheenRoughnessFactor:W.sheen.roughness=0,p.sheenRoughnessTexture&&(p.sheenRoughnessTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${V}/sheenRoughnessTexture`,p.sheenRoughnessTexture,(V=>{V.name=`${W.name} (Sheen Roughness)`,W.sheen.textureRoughness=V})))),W.sheen.albedoScaling=!0,W.sheen.useRoughnessFromMainTexture=!1,Promise.all(N).then((()=>{}))}}m(XV),H(XV,!0,(V=>new rV(V)));const BV="KHR_materials_specular";class YV{constructor(V){this.name=BV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(BV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,p,W)),E.push(this._loadSpecularPropertiesAsync(N,d,W)),Promise.all(E).then((()=>{}))}))}_loadSpecularPropertiesAsync(V,p,W){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);const N=new Array;return void 0!==p.specularFactor&&(W.metallicF0Factor=p.specularFactor),void 0!==p.specularColorFactor&&(W.metallicReflectanceColor=E.c.Tg(p.specularColorFactor)),p.specularTexture&&(p.specularTexture.nonColorData=!0,N.push(this._loader.loadTextureInfoAsync(`${V}/specularTexture`,p.specularTexture,(V=>{V.name=`${W.name} (Specular)`,W.metallicReflectanceTexture=V,W.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),p.specularColorTexture&&N.push(this._loader.loadTextureInfoAsync(`${V}/specularColorTexture`,p.specularColorTexture,(V=>{V.name=`${W.name} (Specular Color)`,W.reflectanceTexture=V}))),Promise.all(N).then((()=>{}))}}m(BV),H(BV,!0,(V=>new YV(V)));const IV="KHR_materials_ior";class cV{constructor(V){this.name=IV,this.order=180,this._loader=V,this.enabled=this._loader.isExtensionUsed(IV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,p,W)),E.push(this._loadIorPropertiesAsync(N,d,W)),Promise.all(E).then((()=>{}))}))}_loadIorPropertiesAsync(V,p,W){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);return void 0!==p.ior?W.indexOfRefraction=p.ior:W.indexOfRefraction=cV._DEFAULT_IOR,Promise.resolve()}}cV._DEFAULT_IOR=1.5,m(IV),H(IV,!0,(V=>new cV(V)));const qV="KHR_materials_variants";class gV{constructor(V){this.name=qV,this._loader=V,this.enabled=this._loader.isExtensionUsed(qV)}dispose(){this._loader=null}static GetAvailableVariants(V){const p=this._GetExtensionMetadata(V);return p?Object.keys(p.variants):[]}getAvailableVariants(V){return gV.GetAvailableVariants(V)}static SelectVariant(V,p){const W=this._GetExtensionMetadata(V);if(!W)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${qV} extension`);const N=V=>{const p=W.variants[V];if(p)for(const W of p)W.mesh.material=W.material};if(p instanceof Array)for(const d of p)N(d);else N(p);W.lastSelected=p}selectVariant(V,p){gV.SelectVariant(V,p)}static Reset(V){const p=this._GetExtensionMetadata(V);if(!p)throw new Error(`Cannot reset on a glTF mesh that does not have the ${qV} extension`);for(const W of p.original)W.mesh.material=W.material;p.lastSelected=null}reset(V){gV.Reset(V)}static GetLastSelectedVariant(V){const p=this._GetExtensionMetadata(V);if(!p)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${qV} extension`);return p.lastSelected}getLastSelectedVariant(V){return gV.GetLastSelectedVariant(V)}static _GetExtensionMetadata(V){var p,W;return(null===V||void 0===V||null===(p=V._internalMetadata)||void 0===p||null===(W=p.Di)||void 0===W?void 0:W[qV])||null}onLoading(){const V=this._loader.Di.extensions;if(V&&V[this.name]){const p=V[this.name];this._variants=p.variants}}_loadMeshPrimitiveAsync(V,p,W,N,d,E){return y.LoadExtensionAsync(V,d,this.name,((z,S)=>{const Q=new Array;return Q.push(this._loader._loadMeshPrimitiveAsync(V,p,W,N,d,(p=>{if(E(p),p instanceof P.e){const W=y._GetDrawMode(V,d.mode),N=this._loader.rootBabylonMesh,E=N?N._internalMetadata=N._internalMetadata||{}:{},J=E.Di=E.Di||{},i=J[qV]=J[qV]||{lastSelected:null,original:[],variants:{}};i.original.push({mesh:p,material:p.material});for(let V=0;V<S.mappings.length;++V){const d=S.mappings[V],E=a.Get(`${z}/mappings/${V}/material`,this._loader.Di.materials,d.material);Q.push(this._loader._loadMaterialAsync(`#/materials/${d.material}`,E,p,W,(V=>{for(let W=0;W<d.variants.length;++W){const E=d.variants[W],z=a.Get(`/extensions/${qV}/variants/${E}`,this._variants,E);i.variants[z.name]=i.variants[z.name]||[],i.variants[z.name].push({mesh:p,material:V}),p.onClonedObservable.add((V=>{const W=V;let d=null,E=W;do{if(E=E.parent,!E)return;d=gV._GetExtensionMetadata(E)}while(null===d);if(N&&d===gV._GetExtensionMetadata(N)){E._internalMetadata={};for(const V in N._internalMetadata)E._internalMetadata[V]=N._internalMetadata[V];E._internalMetadata.Di=[];for(const V in N._internalMetadata.Di)E._internalMetadata.Di[V]=N._internalMetadata.Di[V];E._internalMetadata.Di[qV]={lastSelected:null,original:[],variants:{}};for(const V of d.original)E._internalMetadata.Di[qV].original.push({mesh:V.mesh,material:V.material});for(const V in d.variants)if(Object.prototype.hasOwnProperty.call(d.variants,V)){E._internalMetadata.Di[qV].variants[V]=[];for(const p of d.variants[V])E._internalMetadata.Di[qV].variants[V].push({mesh:p.mesh,material:p.material})}d=E._internalMetadata.Di[qV]}for(const N of d.original)N.mesh===p&&(N.mesh=W);for(const N of d.variants[z.name])N.mesh===p&&(N.mesh=W)}))}})))}}}))),Promise.all(Q).then((V=>{let[p]=V;return p}))}))}}m(qV),H(qV,!0,(V=>new gV(V)));var DV=W(11789);class HV{}HV.AUTOSAMPLERSUFFIX="Sampler",HV.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",HV.ALPHA_DISABLE=0,HV.ALPHA_ADD=1,HV.ALPHA_COMBINE=2,HV.ALPHA_SUBTRACT=3,HV.ALPHA_MULTIPLY=4,HV.ALPHA_MAXIMIZED=5,HV.ALPHA_ONEONE=6,HV.ALPHA_PREMULTIPLIED=7,HV.ALPHA_PREMULTIPLIED_PORTERDUFF=8,HV.ALPHA_INTERPOLATE=9,HV.ALPHA_SCREENMODE=10,HV.ALPHA_ONEONE_ONEONE=11,HV.ALPHA_ALPHATOCOLOR=12,HV.ALPHA_REVERSEONEMINUS=13,HV.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,HV.ALPHA_ONEONE_ONEZERO=15,HV.ALPHA_EXCLUSION=16,HV.ALPHA_LAYER_ACCUMULATE=17,HV.ALPHA_EQUATION_ADD=0,HV.ALPHA_EQUATION_SUBSTRACT=1,HV.ALPHA_EQUATION_REVERSE_SUBTRACT=2,HV.ALPHA_EQUATION_MAX=3,HV.ALPHA_EQUATION_MIN=4,HV.ALPHA_EQUATION_DARKEN=5,HV.DELAYLOADSTATE_NONE=0,HV.DELAYLOADSTATE_LOADED=1,HV.DELAYLOADSTATE_LOADING=2,HV.DELAYLOADSTATE_NOTLOADED=4,HV.NEVER=512,HV.ALWAYS=519,HV.LESS=513,HV.EQUAL=514,HV.LEQUAL=515,HV.GREATER=516,HV.GEQUAL=518,HV.NOTEQUAL=517,HV.KEEP=7680,HV.ZERO=0,HV.REPLACE=7681,HV.INCR=7682,HV.DECR=7683,HV.INVERT=5386,HV.INCR_WRAP=34055,HV.DECR_WRAP=34056,HV.TEXTURE_CLAMP_ADDRESSMODE=0,HV.TEXTURE_WRAP_ADDRESSMODE=1,HV.TEXTURE_MIRROR_ADDRESSMODE=2,HV.TEXTURE_CREATIONFLAG_STORAGE=1,HV.TEXTUREFORMAT_ALPHA=0,HV.TEXTUREFORMAT_LUMINANCE=1,HV.TEXTUREFORMAT_LUMINANCE_ALPHA=2,HV.TEXTUREFORMAT_RGB=4,HV.TEXTUREFORMAT_RGBA=5,HV.TEXTUREFORMAT_RED=6,HV.TEXTUREFORMAT_R=6,HV.TEXTUREFORMAT_RG=7,HV.TEXTUREFORMAT_RED_INTEGER=8,HV.TEXTUREFORMAT_R_INTEGER=8,HV.TEXTUREFORMAT_RG_INTEGER=9,HV.TEXTUREFORMAT_RGB_INTEGER=10,HV.TEXTUREFORMAT_RGBA_INTEGER=11,HV.TEXTUREFORMAT_BGRA=12,HV.TEXTUREFORMAT_DEPTH24_STENCIL8=13,HV.TEXTUREFORMAT_DEPTH32_FLOAT=14,HV.TEXTUREFORMAT_DEPTH16=15,HV.TEXTUREFORMAT_DEPTH24=16,HV.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,HV.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,HV.TEXTUREFORMAT_STENCIL8=19,HV.TEXTUREFORMAT_UNDEFINED=4294967295,HV.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,HV.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,HV.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,HV.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,HV.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,HV.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,HV.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,HV.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,HV.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,HV.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,HV.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,HV.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,HV.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,HV.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,HV.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,HV.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,HV.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,HV.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,HV.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,HV.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,HV.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,HV.TEXTURETYPE_UNSIGNED_BYTE=0,HV.TEXTURETYPE_UNSIGNED_INT=0,HV.TEXTURETYPE_FLOAT=1,HV.TEXTURETYPE_HALF_FLOAT=2,HV.TEXTURETYPE_BYTE=3,HV.TEXTURETYPE_SHORT=4,HV.TEXTURETYPE_UNSIGNED_SHORT=5,HV.TEXTURETYPE_INT=6,HV.TEXTURETYPE_UNSIGNED_INTEGER=7,HV.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,HV.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,HV.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,HV.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,HV.TEXTURETYPE_UNSIGNED_INT_24_8=12,HV.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,HV.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,HV.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,HV.TEXTURETYPE_UNDEFINED=16,HV.TEXTURE_2D=3553,HV.TEXTURE_2D_ARRAY=35866,HV.TEXTURE_CUBE_MAP=34067,HV.TEXTURE_CUBE_MAP_ARRAY=3735928559,HV.TEXTURE_3D=32879,HV.TEXTURE_NEAREST_SAMPLINGMODE=1,HV.TEXTURE_NEAREST_NEAREST=1,HV.TEXTURE_BILINEAR_SAMPLINGMODE=2,HV.TEXTURE_LINEAR_LINEAR=2,HV.TEXTURE_TRILINEAR_SAMPLINGMODE=3,HV.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,HV.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,HV.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,HV.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,HV.TEXTURE_NEAREST_LINEAR=7,HV.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,HV.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,HV.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,HV.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,HV.TEXTURE_LINEAR_NEAREST=12,HV.TEXTURE_EXPLICIT_MODE=0,HV.TEXTURE_SPHERICAL_MODE=1,HV.TEXTURE_PLANAR_MODE=2,HV.TEXTURE_CUBIC_MODE=3,HV.TEXTURE_PROJECTION_MODE=4,HV.TEXTURE_SKYBOX_MODE=5,HV.TEXTURE_INVCUBIC_MODE=6,HV.TEXTURE_EQUIRECTANGULAR_MODE=7,HV.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,HV.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,HV.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,HV.TEXTURE_FILTERING_QUALITY_HIGH=64,HV.TEXTURE_FILTERING_QUALITY_MEDIUM=16,HV.TEXTURE_FILTERING_QUALITY_LOW=8,HV.SCALEMODE_FLOOR=1,HV.SCALEMODE_NEAREST=2,HV.SCALEMODE_CEILING=3,HV.MATERIAL_TextureDirtyFlag=1,HV.MATERIAL_LightDirtyFlag=2,HV.MATERIAL_FresnelDirtyFlag=4,HV.MATERIAL_AttributesDirtyFlag=8,HV.MATERIAL_MiscDirtyFlag=16,HV.MATERIAL_PrePassDirtyFlag=32,HV.MATERIAL_AllDirtyFlag=63,HV.MATERIAL_TriangleFillMode=0,HV.MATERIAL_WireFrameFillMode=1,HV.MATERIAL_PointFillMode=2,HV.MATERIAL_PointListDrawMode=3,HV.MATERIAL_LineListDrawMode=4,HV.MATERIAL_LineLoopDrawMode=5,HV.MATERIAL_LineStripDrawMode=6,HV.MATERIAL_TriangleStripDrawMode=7,HV.MATERIAL_TriangleFanDrawMode=8,HV.MATERIAL_ClockWiseSideOrientation=0,HV.MATERIAL_CounterClockWiseSideOrientation=1,HV.ACTION_NothingTrigger=0,HV.ACTION_OnPickTrigger=1,HV.ACTION_OnLeftPickTrigger=2,HV.ACTION_OnRightPickTrigger=3,HV.ACTION_OnCenterPickTrigger=4,HV.ACTION_OnPickDownTrigger=5,HV.ACTION_OnDoublePickTrigger=6,HV.ACTION_OnPickUpTrigger=7,HV.ACTION_OnPickOutTrigger=16,HV.ACTION_OnLongPressTrigger=8,HV.ACTION_OnPointerOverTrigger=9,HV.ACTION_OnPointerOutTrigger=10,HV.ACTION_OnEveryFrameTrigger=11,HV.ACTION_OnIntersectionEnterTrigger=12,HV.ACTION_OnIntersectionExitTrigger=13,HV.ACTION_OnKeyDownTrigger=14,HV.ACTION_OnKeyUpTrigger=15,HV.PARTICLES_BILLBOARDMODE_Y=2,HV.PARTICLES_BILLBOARDMODE_ALL=7,HV.PARTICLES_BILLBOARDMODE_STRETCHED=8,HV.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,HV.MESHES_CULLINGSTRATEGY_STANDARD=0,HV.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,HV.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,HV.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,HV.SCENELOADER_NO_LOGGING=0,HV.SCENELOADER_MINIMAL_LOGGING=1,HV.SCENELOADER_SUMMARY_LOGGING=2,HV.SCENELOADER_DETAILED_LOGGING=3,HV.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,HV.PREPASS_POSITION_TEXTURE_TYPE=1,HV.PREPASS_VELOCITY_TEXTURE_TYPE=2,HV.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,HV.PREPASS_COLOR_TEXTURE_TYPE=4,HV.PREPASS_DEPTH_TEXTURE_TYPE=5,HV.PREPASS_NORMAL_TEXTURE_TYPE=6,HV.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,HV.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,HV.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,HV.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,HV.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,HV.PREPASS_ALBEDO_TEXTURE_TYPE=12,HV.BUFFER_CREATIONFLAG_READ=1,HV.BUFFER_CREATIONFLAG_WRITE=2,HV.BUFFER_CREATIONFLAG_READWRITE=3,HV.BUFFER_CREATIONFLAG_UNIFORM=4,HV.BUFFER_CREATIONFLAG_VERTEX=8,HV.BUFFER_CREATIONFLAG_INDEX=16,HV.BUFFER_CREATIONFLAG_STORAGE=32,HV.BUFFER_CREATIONFLAG_INDIRECT=64,HV.RENDERPASS_MAIN=0,HV.INPUT_ALT_KEY=18,HV.INPUT_CTRL_KEY=17,HV.INPUT_META_KEY1=91,HV.INPUT_META_KEY2=92,HV.INPUT_META_KEY3=93,HV.INPUT_SHIFT_KEY=16,HV.SNAPSHOTRENDERING_STANDARD=0,HV.SNAPSHOTRENDERING_FAST=1,HV.PERSPECTIVE_CAMERA=0,HV.ORTHOGRAPHIC_CAMERA=1,HV.FOVMODE_VERTICAL_FIXED=0,HV.FOVMODE_HORIZONTAL_FIXED=1,HV.RIG_MODE_NONE=0,HV.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,HV.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,HV.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,HV.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,HV.RIG_MODE_STEREOSCOPIC_INTERLACED=14,HV.RIG_MODE_VR=20,HV.RIG_MODE_CUSTOM=22,HV.MAX_SUPPORTED_UV_SETS=6,HV.GL_ALPHA_EQUATION_ADD=32774,HV.GL_ALPHA_EQUATION_MIN=32775,HV.GL_ALPHA_EQUATION_MAX=32776,HV.GL_ALPHA_EQUATION_SUBTRACT=32778,HV.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,HV.GL_ALPHA_FUNCTION_SRC=768,HV.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,HV.GL_ALPHA_FUNCTION_SRC_ALPHA=770,HV.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,HV.GL_ALPHA_FUNCTION_DST_ALPHA=772,HV.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,HV.GL_ALPHA_FUNCTION_DST_COLOR=774,HV.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,HV.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,HV.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,HV.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,HV.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,HV.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,HV.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,HV.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,HV.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,HV.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,HV.SnippetUrl="https://snippet.babylonjs.com",HV.FOGMODE_NONE=0,HV.FOGMODE_EXP=1,HV.FOGMODE_EXP2=2,HV.FOGMODE_LINEAR=3,HV.BYTE=5120,HV.UNSIGNED_BYTE=5121,HV.SHORT=5122,HV.UNSIGNED_SHORT=5123,HV.INT=5124,HV.UNSIGNED_INT=5125,HV.FLOAT=5126,HV.PositionKind="position",HV.NormalKind="k",HV.TangentKind="tangent",HV.UVKind="uv",HV.UV2Kind="uv2",HV.UV3Kind="uv3",HV.UV4Kind="uv4",HV.UV5Kind="uv5",HV.UV6Kind="uv6",HV.ColorKind="color",HV.ColorInstanceKind="instanceColor",HV.MatricesIndicesKind="matricesIndices",HV.MatricesWeightsKind="matricesWeights",HV.MatricesIndicesExtraKind="matricesIndicesExtra",HV.MatricesWeightsExtraKind="matricesWeightsExtra";class mV{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:HV.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(V,p){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...mV._GetDefaultOptions(),...V},this._scene=p,this._scene._transmissionHelper=this,this.onErrorObservable=new i.b,this._scene.$i.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(V){if(!Object.keys(V).filter((p=>this._options[p]!==V[p])).length)return;const p={...this._options,...V},W=this._options;this._options=p,p.renderSize===W.renderSize&&p.renderTargetTextureType===W.renderTargetTextureType&&p.generateMipmaps===W.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=p.samples,this._opaqueRenderTarget.lodGenerationScale=p.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=p.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(V){return!!V&&!!(V instanceof o&&V.subSurface.isRefractionEnabled)}_addMesh(V){this._materialObservers[V.uniqueId]=V.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),z.e.SetImmediate((()=>{this._shouldRenderAsTransmission(V.material)?(V.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(V)&&this._transparentMeshesCache.push(V)):-1===this._opaqueMeshesCache.indexOf(V)&&this._opaqueMeshesCache.push(V)}))}_removeMesh(V){V.onMaterialChangedObservable.remove(this._materialObservers[V.uniqueId]),delete this._materialObservers[V.uniqueId];let p=this._transparentMeshesCache.indexOf(V);-1!==p&&this._transparentMeshesCache.splice(p,1),p=this._opaqueMeshesCache.indexOf(V),-1!==p&&this._opaqueMeshesCache.splice(p,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(V){const p=this._transparentMeshesCache.indexOf(V),W=this._opaqueMeshesCache.indexOf(V);this._shouldRenderAsTransmission(V.material)?(V.material instanceof o&&(V.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==W?(this._opaqueMeshesCache.splice(W,1),this._transparentMeshesCache.push(V)):-1===p&&this._transparentMeshesCache.push(V)):-1!==p?(this._transparentMeshesCache.splice(p,1),this._opaqueMeshesCache.push(V)):-1===W&&this._opaqueMeshesCache.push(V)}_isRenderTargetValid(){var V;return null!==(null===(V=this._opaqueRenderTarget)||void 0===V?void 0:V.getInternalTexture())}_setupRenderTargets(){var V;let p,W;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new DV.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(V=this._options.clearColor)||void 0===V?void 0:V.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((V=>{W=this._scene.environmentIntensity,this._scene.environmentIntensity=1,p=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?V.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(V.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=W,this._scene.imageProcessingConfiguration._applyByPostProcess=p})),this._transparentMeshesCache.forEach((V=>{this._shouldRenderAsTransmission(V.material)&&(V.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const MV="KHR_materials_transmission";class aV{constructor(V){this.name=MV,this.order=175,this._loader=V,this.enabled=this._loader.isExtensionUsed(MV),this.enabled&&(V.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,p,W)),E.push(this._loadTransparentPropertiesAsync(N,p,W,d)),Promise.all(E).then((()=>{}))}))}_loadTransparentPropertiesAsync(V,p,W,N){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);const d=W;if(d.subSurface.isRefractionEnabled=!0,d.subSurface.volumeIndexOfRefraction=1,d.subSurface.useAlbedoToTintRefraction=!0,void 0===N.transmissionFactor)return d.subSurface.refractionIntensity=0,d.subSurface.isRefractionEnabled=!1,Promise.resolve();{var E;d.subSurface.refractionIntensity=N.transmissionFactor;const V=d.va();if(d.subSurface.refractionIntensity&&!V._transmissionHelper)new mV({},d.va());else if(d.subSurface.refractionIntensity&&(null===(E=V._transmissionHelper)||void 0===E||!E._isRenderTargetValid())){var z;null===(z=V._transmissionHelper)||void 0===z||z._setupRenderTargets()}}return d.subSurface.minimumThickness=0,d.subSurface.maximumThickness=0,N.transmissionTexture?(N.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${V}/transmissionTexture`,N.transmissionTexture,void 0).then((V=>{V.name=`${W.name} (Transmission)`,d.subSurface.refractionIntensityTexture=V,d.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}m(MV),H(MV,!0,(V=>new aV(V)));const yV="KHR_materials_diffuse_transmission";class nV{constructor(V){this.name=yV,this.order=174,this._loader=V,this.enabled=this._loader.isExtensionUsed(yV),this.enabled&&(V.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,p,W)),E.push(this._loadTranslucentPropertiesAsync(N,p,W,d)),Promise.all(E).then((()=>{}))}))}_loadTranslucentPropertiesAsync(V,p,W,N){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);const d=W;if(d.subSurface.isTranslucencyEnabled=!0,d.subSurface.volumeIndexOfRefraction=1,d.subSurface.minimumThickness=0,d.subSurface.maximumThickness=0,d.subSurface.useAlbedoToTintTranslucency=!1,void 0===N.diffuseTransmissionFactor)return d.subSurface.translucencyIntensity=0,d.subSurface.isTranslucencyEnabled=!1,Promise.resolve();d.subSurface.translucencyIntensity=N.diffuseTransmissionFactor;const z=new Array;return d.subSurface.useGltfStyleTextures=!0,N.diffuseTransmissionTexture&&(N.diffuseTransmissionTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTransmissionTexture`,N.diffuseTransmissionTexture).then((V=>{V.name=`${W.name} (Diffuse Transmission)`,d.subSurface.translucencyIntensityTexture=V})))),void 0!==N.diffuseTransmissionColorFactor?d.subSurface.translucencyColor=E.c.Tg(N.diffuseTransmissionColorFactor):d.subSurface.translucencyColor=E.c.White(),N.diffuseTransmissionColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTransmissionColorTexture`,N.diffuseTransmissionColorTexture).then((V=>{V.name=`${W.name} (Diffuse Transmission Color)`,d.subSurface.translucencyColorTexture=V}))),Promise.all(z).then((()=>{}))}}m(yV),H(yV,!0,(V=>new nV(V)));const wV="KHR_materials_volume";class Vp{constructor(V){this.name=wV,this.order=173,this._loader=V,this.enabled=this._loader.isExtensionUsed(wV),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,p,W)),E.push(this._loadVolumePropertiesAsync(N,p,W,d)),Promise.all(E).then((()=>{}))}))}_loadVolumePropertiesAsync(V,p,W,N){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);if(!W.subSurface.isRefractionEnabled&&!W.subSurface.isTranslucencyEnabled||!N.thicknessFactor)return Promise.resolve();W.subSurface.volumeIndexOfRefraction=W.indexOfRefraction;const d=void 0!==N.attenuationDistance?N.attenuationDistance:Number.MAX_VALUE;return W.subSurface.tintColorAtDistance=d,void 0!==N.attenuationColor&&3==N.attenuationColor.length&&W.subSurface.tintColor.ge(N.attenuationColor[0],N.attenuationColor[1],N.attenuationColor[2]),W.subSurface.minimumThickness=0,W.subSurface.maximumThickness=N.thicknessFactor,W.subSurface.useThicknessAsDepth=!0,N.thicknessTexture?(N.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${V}/thicknessTexture`,N.thicknessTexture).then((V=>{V.name=`${W.name} (Thickness)`,W.subSurface.thicknessTexture=V,W.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}m(wV),H(wV,!0,(V=>new Vp(V)));const pp="KHR_materials_dispersion";class Wp{constructor(V){this.name=pp,this.order=174,this._loader=V,this.enabled=this._loader.isExtensionUsed(pp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{const E=new Array;return E.push(this._loader.loadMaterialPropertiesAsync(V,p,W)),E.push(this._loadDispersionPropertiesAsync(N,p,W,d)),Promise.all(E).then((()=>{}))}))}_loadDispersionPropertiesAsync(V,p,W,N){if(!(W instanceof o))throw new Error(`${V}: Material type not supported`);return W.subSurface.isRefractionEnabled&&N.dispersion?(W.subSurface.isDispersionEnabled=!0,W.subSurface.dispersion=N.dispersion,Promise.resolve()):Promise.resolve()}}m(pp),H(pp,!0,(V=>new Wp(V)));const Np="KHR_mesh_quantization";class dp{constructor(V){this.name=Np,this.enabled=V.isExtensionUsed(Np)}dispose(){}}m(Np),H(Np,!0,(V=>new dp(V)));const Ep="KHR_texture_basisu";class zp{constructor(V){this.name=Ep,this._loader=V,this.enabled=V.isExtensionUsed(Ep)}dispose(){this._loader=null}_loadTextureAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>{const E=void 0==p.sampler?y.DefaultSampler:a.Get(`${V}/sampler`,this._loader.Di.samplers,p.sampler),z=a.Get(`${N}/source`,this._loader.Di.images,d.source);return this._loader._createTextureAsync(V,E,z,(V=>{W(V)}),p._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!p._textureInfo.nonColorData)}))}}m(Ep),H(Ep,!0,(V=>new zp(V)));const Sp="KHR_texture_transform";class Qp{constructor(V){this.name=Sp,this._loader=V,this.enabled=this._loader.isExtensionUsed(Sp)}dispose(){this._loader=null}loadTextureInfoAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((N,d)=>this._loader.loadTextureInfoAsync(V,p,(V=>{if(!(V instanceof K.d))throw new Error(`${N}: Texture type not supported`);d.offset&&(V.uOffset=d.offset[0],V.vOffset=d.offset[1]),V.uRotationCenter=0,V.vRotationCenter=0,d.rotation&&(V.wAng=-d.rotation),d.scale&&(V.uScale=d.scale[0],V.vScale=d.scale[1]),void 0!=d.texCoord&&(V.coordinatesIndex=d.texCoord),W(V)}))))}}m(Sp),H(Sp,!0,(V=>new Qp(V)));const Jp="KHR_xmp_json_ld";class ip{constructor(V){this.name=Jp,this.order=100,this._loader=V,this.enabled=this._loader.isExtensionUsed(Jp)}dispose(){this._loader=null}onLoading(){var V,p,W;if(null===this._loader.rootBabylonMesh)return;const N=null===(V=this._loader.Di.extensions)||void 0===V?void 0:V.KHR_xmp_json_ld,d=null===(p=this._loader.Di.asset)||void 0===p||null===(W=p.extensions)||void 0===W?void 0:W.KHR_xmp_json_ld;if(N&&d){const V=+d.packet;N.packets&&V<N.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=N.packets[V])}}}function lp(V,p,W,N){return E.c.Tg(p,W).scale(N)}function jp(V,p,W,N){return p[W]*N}function kp(V,p,W,N){return-p[W]*N}function up(V,p,W,N){return p[W+1]*N}function fp(V,p,W,N){return p[W]*N*2}function Op(V){return{scale:[new Fp(j.d.ANIMATIONTYPE_FLOAT,`${V}.uScale`,jp,(()=>2)),new Fp(j.d.ANIMATIONTYPE_FLOAT,`${V}.vScale`,up,(()=>2))],offset:[new Fp(j.d.ANIMATIONTYPE_FLOAT,`${V}.uOffset`,jp,(()=>2)),new Fp(j.d.ANIMATIONTYPE_FLOAT,`${V}.vOffset`,up,(()=>2))],rotation:[new Fp(j.d.ANIMATIONTYPE_FLOAT,`${V}.wAng`,kp,(()=>1))]}}m(Jp),H(Jp,!0,(V=>new ip(V)));class Up extends I{buildAnimations(V,p,W,N,d){d(V._babylonCamera,this._buildAnimation(p,W,N))}}class Fp extends I{buildAnimations(V,p,W,N,d){for(const E in V._data)d(V._data[E].babylonMaterial,this._buildAnimation(p,W,N))}}class Cp extends I{buildAnimations(V,p,W,N,d){d(V._babylonLight,this._buildAnimation(p,W,N))}}const Ap={__array__:{__target__:!0,...q}},vp={__array__:{__target__:!0,orthographic:{xmag:[new Up(j.d.ANIMATIONTYPE_FLOAT,"orthoLeft",kp,(()=>1)),new Up(j.d.ANIMATIONTYPE_FLOAT,"orthoRight",up,(()=>1))],ymag:[new Up(j.d.ANIMATIONTYPE_FLOAT,"orthoBottom",kp,(()=>1)),new Up(j.d.ANIMATIONTYPE_FLOAT,"orthoTop",up,(()=>1))],zfar:[new Up(j.d.ANIMATIONTYPE_FLOAT,"maxZ",jp,(()=>1))],znear:[new Up(j.d.ANIMATIONTYPE_FLOAT,"Li",jp,(()=>1))]},perspective:{yfov:[new Up(j.d.ANIMATIONTYPE_FLOAT,"fov",jp,(()=>1))],zfar:[new Up(j.d.ANIMATIONTYPE_FLOAT,"maxZ",jp,(()=>1))],znear:[new Up(j.d.ANIMATIONTYPE_FLOAT,"Li",jp,(()=>1))]}}},tp={nodes:Ap,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new Fp(j.d.ANIMATIONTYPE_COLOR3,"albedoColor",lp,(()=>4)),new Fp(j.d.ANIMATIONTYPE_FLOAT,"alpha",(function(V,p,W,N){return p[W+3]*N}),(()=>4))],metallicFactor:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"metallic",jp,(()=>1))],roughnessFactor:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"roughness",jp,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:Op("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Op("metallicTexture")}}},emissiveFactor:[new Fp(j.d.ANIMATIONTYPE_COLOR3,"emissiveColor",lp,(()=>3))],normalTexture:{scale:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",jp,(()=>1))],extensions:{KHR_texture_transform:Op("bumpTexture")}},occlusionTexture:{strength:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",jp,(()=>1))],extensions:{KHR_texture_transform:Op("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:Op("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",jp,(()=>1))],anisotropyRotation:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",jp,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:Op("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",jp,(()=>1))],clearcoatRoughnessFactor:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",jp,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:Op("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",jp,(()=>1))],extensions:{KHR_texture_transform:Op("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Op("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",jp,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",jp,(()=>1))]},KHR_materials_ior:{ior:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",jp,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",jp,(()=>1))],iridescenceIor:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",jp,(()=>1))],iridescenceThicknessMinimum:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",jp,(()=>1))],iridescenceThicknessMaximum:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",jp,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:Op("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Op("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new Fp(j.d.ANIMATIONTYPE_COLOR3,"sheen.color",lp,(()=>3))],sheenRoughnessFactor:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",jp,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:Op("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Op("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",jp,(()=>1))],specularColorFactor:[new Fp(j.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",lp,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:Op("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Op("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",jp,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:Op("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new Fp(j.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",lp,(()=>3))],attenuationDistance:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",jp,(()=>1))],thicknessFactor:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",jp,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:Op("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new Fp(j.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",jp,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Op("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new Fp(j.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",lp,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Op("subSurface.translucencyColorTexture")}}}}}},cameras:vp,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new Cp(j.d.ANIMATIONTYPE_COLOR3,"diffuse",lp,(()=>3))],Pi:[new Cp(j.d.ANIMATIONTYPE_FLOAT,"intensity",jp,(()=>1))],range:[new Cp(j.d.ANIMATIONTYPE_FLOAT,"range",jp,(()=>1))],spot:{innerConeAngle:[new Cp(j.d.ANIMATIONTYPE_FLOAT,"innerAngle",fp,(()=>1))],outerConeAngle:[new Cp(j.d.ANIMATIONTYPE_FLOAT,"angle",fp,(()=>1))]}}}}}};class ep{constructor(V,p){this._gltf=V,this._infoTree=p}convert(V){let p,W=this._gltf,N=this._infoTree;if(!V.startsWith("/"))throw new Error("Path must start with a /");const d=V.split("/");d.shift();for(const E of d){if(N.__array__)N=N.__array__;else if(N=N[E],!N)throw new Error(`Path ${V} is invalid`);if(void 0===W)throw new Error(`Path ${V} is invalid`);W=W[E],N.__target__&&(p=W)}return{object:p,info:N}}}const Zp="KHR_animation_pointer";class op extends ep{constructor(V){super(V,tp)}}class Kp{constructor(V){this.name=Zp,this._loader=V,this._pathToObjectConverter=new op(this._loader.Di)}get enabled(){return this._loader.isExtensionUsed(Zp)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(V,p,W,N,d){var E;const z=null===(E=N.target.extensions)||void 0===E?void 0:E.KHR_animation_pointer;if(!z||!this._pathToObjectConverter)return null;"pointer"!==N.target.path&&f.e.Warn(`${V}/target/path: Value (${N.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=N.target.node&&f.e.Warn(`${V}/target/node: Value (${N.target.node}) must not be present when using the ${this.name} extension`);const S=`${V}/extensions/${this.name}`,Q=z.pointer;if(!Q)throw new Error(`${S}: Pointer is missing`);try{const E=this._pathToObjectConverter.convert(Q);return this._loader._loadAnimationChannelFromTargetInfoAsync(V,p,W,N,E,d)}catch(J){return f.e.Warn(`${S}/pointer: Invalid pointer (${Q}) skipped`),null}}}m(Zp),H(Zp,!0,(V=>new Kp(V)));class hp{constructor(V,p,W){this.frame=V,this.action=p,this.onlyOnce=W,this.isDone=!1}_clone(){return new hp(this.frame,this.action,this.onlyOnce)}}var Lp=W(10887),xp=W(10941);class Tp{get loop(){return this._loop}set loop(V){V!==this._loop&&(this._loop=V,this.updateOptions({loop:V}))}get currentTime(){var V;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(V=xp.d.audioEngine)&&void 0!==V&&V.audioContext&&(this.isPlaying||this.isPaused)){const V=this.isPaused?0:xp.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+V}return 0}get spatialSound(){return this._spatialSound}set spatialSound(V){if(V==this._spatialSound)return;const p=this.isPlaying;this.pause(),V?(this._spatialSound=V,this._updateSpatialParameters()):this._disableSpatialSound(),p&&this.play()}constructor(V,p,W){var N;let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new i.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=d.n.Zero(),this._localDirection=new d.n(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=V,W=W||u.d.LastCreatedScene)if(this._scene=W,Tp._SceneComponentInitialization(W),this._readyToPlayCallback=E,this._customAttenuationFunction=(V,p,W,N,d)=>p<W?V*(1-p/W):0,S&&(this.autoplay=S.autoplay||!1,this._loop=S.loop||!1,void 0!==S.volume&&(this._volume=S.volume),this._spatialSound=S.spatialSound??!1,this.maxDistance=S.maxDistance??100,this.useCustomAttenuation=S.useCustomAttenuation??!1,this.rolloffFactor=S.rolloffFactor||1,this.refDistance=S.refDistance||1,this.distanceModel=S.distanceModel||"linear",this._playbackRate=S.playbackRate||1,this._streaming=S.streaming??!1,this._length=S.length,this._offset=S.offset),null!==(N=xp.d.audioEngine)&&void 0!==N&&N.canUseWebAudio&&xp.d.audioEngine.audioContext){this._soundGain=xp.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let V=!0;if(p)try{"string"===typeof p?(this._urlType="String",this._url=p):p instanceof ArrayBuffer?this._urlType="ArrayBuffer":p instanceof HTMLMediaElement?this._urlType="MediaElement":p instanceof MediaStream?this._urlType="MediaStream":p instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(p)&&(this._urlType="Array");let W=[],N=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=xp.d.audioEngine.audioContext.createMediaElementSource(p),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=xp.d.audioEngine.audioContext.createMediaStreamSource(p),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":p.byteLength>0&&(N=!0,this._soundLoaded(p));break;case"AudioBuffer":this._audioBufferLoaded(p);break;case"String":W.push(p);case"Array":0===W.length&&(W=p);for(let V=0;V<W.length;V++){const p=W[V];if(N=S&&S.skipCodecCheck||-1!==p.indexOf(".mp3",p.length-4)&&xp.d.audioEngine.isMP3supported||-1!==p.indexOf(".ogg",p.length-4)&&xp.d.audioEngine.isOGGsupported||-1!==p.indexOf(".wav",p.length-4)||-1!==p.indexOf(".m4a",p.length-4)||-1!==p.indexOf(".mp4",p.length-4)||-1!==p.indexOf("blob:"),N){this._streaming?(this._htmlAudioElement=new Audio(p),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,z.e.SetCorsBehavior(p,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(p,(V=>{this._soundLoaded(V)}),void 0,!0,!0,(V=>{V&&f.e.Error("XHR "+V.status+" error on: "+p+"."),f.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:V=!1}V?N||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):f.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(Q){f.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),xp.d.audioEngine&&!xp.d.audioEngine.WarnedWebAudioUnsupported&&(f.e.Error("Web Audio is not supported by your browser."),xp.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var V;null!==(V=xp.d.audioEngine)&&void 0!==V&&V.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(V){var p;null!==(p=xp.d.audioEngine)&&void 0!==p&&p.audioContext&&(this._audioBuffer=V,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(V){var p;null!==(p=xp.d.audioEngine)&&void 0!==p&&p.audioContext&&xp.d.audioEngine.audioContext.decodeAudioData(V,(V=>{this._audioBufferLoaded(V)}),(V=>{f.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+V)}))}setAudioBuffer(V){var p;null!==(p=xp.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&(this._audioBuffer=V,this._isReadyToPlay=!0)}updateOptions(V){V&&(this.loop=V.loop??this.loop,this.maxDistance=V.maxDistance??this.maxDistance,this.useCustomAttenuation=V.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=V.rolloffFactor??this.rolloffFactor,this.refDistance=V.refDistance??this.refDistance,this.distanceModel=V.distanceModel??this.distanceModel,this._playbackRate=V.playbackRate??this._playbackRate,this._length=V.length??void 0,this.spatialSound=V.spatialSound??this._spatialSound,this._setOffset(V.offset??void 0),this.setVolume(V.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var V;null!==(V=xp.d.audioEngine)&&void 0!==V&&V.canUseWebAudio&&xp.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??xp.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var V;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(V=this._soundPanner)||void 0===V||V.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var V;null!==(V=xp.d.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(V){var p;null!==(p=xp.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(V),this._isOutputConnected=!0)}setDirectionalCone(V,p,W){p<V?f.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=V,this._coneOuterAngle=p,this._coneOuterGain=W,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(V){if(V!=this._coneInnerAngle){var p;if(this._coneOuterAngle<V)return void f.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=V,null!==(p=xp.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(V){if(V!=this._coneOuterAngle){var p;if(V<this._coneInnerAngle)return void f.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=V,null!==(p=xp.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(V){var p;V.equals(this._position)||(this._position.p(V),null!==(p=xp.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(V){var p;this._localDirection=V,null!==(p=xp.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const V=this._connectedTransformNode.getWorldMatrix(),p=d.n.TransformNormal(this._localDirection,V);p.normalize(),this._soundPanner.orientationX.value=p.x,this._soundPanner.orientationY.value=p.y,this._soundPanner.orientationZ.value=p.z}updateDistanceFromListener(){var V;if(null!==(V=xp.d.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const V=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.ed(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,V,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(V){this._customAttenuationFunction=V}play(V,p,W){var N;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(N=xp.d.audioEngine)&&void 0!==N&&N.audioContext)try{var d,E;this._clearTimeoutsAndObservers();let N=V?(null===(d=xp.d.audioEngine)||void 0===d?void 0:d.audioContext.currentTime)+V:null===(E=xp.d.audioEngine)||void 0===E?void 0:E.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=xp.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const V=()=>{var W;if(null!==(W=xp.d.audioEngine)&&void 0!==W&&W.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=p??0;const W=this._htmlAudioElement.play();void 0!==W&&W.catch((()=>{var p,W;(null===(p=xp.d.audioEngine)||void 0===p||p.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(W=xp.d.audioEngine)||void 0===W?void 0:W.onAudioUnlockedObservable.addOnce((()=>{V()})))}))}else{var N;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(N=xp.d.audioEngine)||void 0===N?void 0:N.onAudioUnlockedObservable.addOnce((()=>{V()}))}};V()}}else{var z;const d=()=>{var d;if(null!==(d=xp.d.audioEngine)&&void 0!==d&&d.audioContext){var E;if(W=W||this._length,void 0!==p&&this._setOffset(p),this._soundSource){const V=this._soundSource;V.onended=()=>{V.disconnect()}}if(this._soundSource=null===(E=xp.d.audioEngine)||void 0===E?void 0:E.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var z;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==p&&(this._soundSource.loopStart=p),void 0!==W&&(this._soundSource.loopEnd=(0|p)+W),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},N=V?(null===(z=xp.d.audioEngine)||void 0===z?void 0:z.audioContext.currentTime)+V:xp.d.audioEngine.audioContext.currentTime;const d=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(N,d,this.loop?void 0:W)}}};"suspended"===(null===(z=xp.d.audioEngine)||void 0===z?void 0:z.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var V;"suspended"===(null===(V=xp.d.audioEngine)||void 0===V?void 0:V.audioContext.state)?(xp.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=xp.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{d()})))):d()}),500):d()}this._startTime=N,this.isPlaying=!0,this.isPaused=!1}catch(S){f.e.Error("Error while trying to play audio: "+this.name+", "+S.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(V){var p;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var W;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(W=this._streamingSource)||void 0===W||W.disconnect();this.isPlaying=!1}else if(null!==(p=xp.d.audioEngine)&&void 0!==p&&p.audioContext&&this._soundSource){const p=V?xp.d.audioEngine.audioContext.currentTime+V:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(p)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var V;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var p;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(p=this._streamingSource)||void 0===p||p.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(V=xp.d.audioEngine)&&void 0!==V&&V.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=xp.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(V,p){var W;null!==(W=xp.d.audioEngine)&&void 0!==W&&W.canUseWebAudio&&this._soundGain&&(p&&xp.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(xp.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,xp.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(V,xp.d.audioEngine.audioContext.currentTime+p)):this._soundGain.gain.value=V),this._volume=V}setPlaybackRate(V){this._playbackRate=V,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(V){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=V,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=V=>this._onRegisterAfterWorldMatrixUpdate(V),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(V){var p;if(V.getBoundingInfo){const p=V.getBoundingInfo();this.setPosition(p.boundingSphere.centerWorld)}else this.setPosition(V.absolutePosition);null!==(p=xp.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const V=()=>{this._isReadyToPlay?(W._audioBuffer=this.getAudioBuffer(),W._isReadyToPlay=!0,W.autoplay&&W.play(0,this._offset,this._length)):setTimeout(V,300)},p={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},W=new Tp(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,p);return this.useCustomAttenuation&&W.setAttenuationFunction(this._customAttenuationFunction),W.setPosition(this._position),W.setPlaybackRate(this._playbackRate),V(),W}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const V={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(V.connectedMeshId=this._connectedTransformNode.id),V.position=this._position.Zi(),V.refDistance=this.refDistance,V.distanceModel=this.distanceModel,V.isDirectional=this._isDirectional,V.localDirectionToMesh=this._localDirection.Zi(),V.coneInnerAngle=this._coneInnerAngle,V.coneOuterAngle=this._coneOuterAngle,V.coneOuterGain=this._coneOuterGain),V}static Parse(V,p,W,N){const E=V.name;let z;z=V.url?W+V.url:W+E;const S={autoplay:V.autoplay,loop:V.loop,volume:V.volume,spatialSound:V.spatialSound,maxDistance:V.maxDistance,rolloffFactor:V.rolloffFactor,refDistance:V.refDistance,distanceModel:V.distanceModel,playbackRate:V.playbackRate};let Q;if(N){const V=()=>{N._isReadyToPlay?(Q._audioBuffer=N.getAudioBuffer(),Q._isReadyToPlay=!0,Q.autoplay&&Q.play(0,Q._offset,Q._length)):setTimeout(V,300)};Q=new Tp(E,new ArrayBuffer(0),p,null,S),V()}else Q=new Tp(E,z,p,(()=>{p.removePendingData(Q)}),S),p.addPendingData(Q);if(V.position){const p=d.n.Tg(V.position);Q.setPosition(p)}if(V.isDirectional&&(Q.setDirectionalCone(V.coneInnerAngle||360,V.coneOuterAngle||360,V.coneOuterGain||0),V.localDirectionToMesh)){const p=d.n.Tg(V.localDirectionToMesh);Q.setLocalDirectionToMesh(p)}if(V.connectedMeshId){const W=p.getMeshById(V.connectedMeshId);W&&Q.attachToMesh(W)}return V.metadata&&(Q.metadata=V.metadata),Q}_setOffset(V){this._offset!==V&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=V)}_clearTimeoutsAndObservers(){var V;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(V=xp.d.audioEngine)||void 0===V||V.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Tp._SceneComponentInitialization=V=>{throw(0,Lp.c)("AudioSceneComponent")},(0,e.d)("BABYLON.Sound",Tp);class Pp{constructor(V,p,W){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],p.length!==W.length)throw new Error("Sounds length does not equal weights length");this.loop=V,this._weights=W;let N=0;for(const E of W)N+=E;const d=N>0?1/N:0;for(let E=0;E<this._weights.length;E++)this._weights[E]*=d;this._sounds=p;for(const E of this._sounds)E.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(V){if(V!==this._coneInnerAngle){if(this._coneOuterAngle<V)return void f.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=V;for(const p of this._sounds)p.directionalConeInnerAngle=V}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(V){if(V!==this._coneOuterAngle){if(V<this._coneInnerAngle)return void f.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=V;for(const p of this._sounds)p.directionalConeOuterAngle=V}}get volume(){return this._volume}set volume(V){if(V!==this._volume)for(const p of this._sounds)p.setVolume(V)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(V){if(!this.isPaused){this.stop();const V=Math.random();let p=0;for(let W=0;W<this._weights.length;W++)if(p+=this._weights[W],V<=p){this._currentIndex=W;break}}const p=this._sounds[this._currentIndex??0];p.isReady()?p.play(0,this.isPaused?void 0:V):p.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class bp{constructor(V){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(V=V||u.d.LastCreatedScene)&&(this._scene=V,this.soundCollection=[],this._options=p,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var V;null!==(V=xp.d.audioEngine)&&void 0!==V&&V.canUseWebAudio&&xp.d.audioEngine.audioContext&&(this._outputAudioNode=xp.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(xp.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(xp.d.audioEngine&&xp.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(V){var p;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(p=xp.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&V.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==V.soundTrackId&&(-1===V.soundTrackId?this._scene.mainSoundTrack.removeSound(V):this._scene.soundTracks&&this._scene.soundTracks[V.soundTrackId].removeSound(V)),this.soundCollection.push(V),V.soundTrackId=this.id}removeSound(V){const p=this.soundCollection.indexOf(V);-1!==p&&this.soundCollection.splice(p,1)}setVolume(V){var p;null!==(p=xp.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=V)}switchPanningModelToHRTF(){var V;if(null!==(V=xp.d.audioEngine)&&void 0!==V&&V.canUseWebAudio)for(let p=0;p<this.soundCollection.length;p++)this.soundCollection[p].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var V;if(null!==(V=xp.d.audioEngine)&&void 0!==V&&V.canUseWebAudio)for(let p=0;p<this.soundCollection.length;p++)this.soundCollection[p].switchPanningModelToEqualPower()}connectToAnalyser(V){var p;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=V,null!==(p=xp.d.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,xp.d.audioEngine.masterGain))}}var sp=W(11321),Gp=W(11200),Rp=(W(11819),W(10882));(0,W(11891).g)(sp.c.NAME_AUDIO,((V,p,W,N)=>{let d,E=[];if(W.Qj=W.Qj||[],void 0!==V.Qj&&null!==V.Qj)for(let S=0,Q=V.Qj.length;S<Q;S++){var z;const Q=V.Qj[S];null!==(z=xp.d.audioEngine)&&void 0!==z&&z.canUseWebAudio?(Q.url||(Q.url=Q.name),E[Q.url]?W.Qj.push(Tp.Parse(Q,p,N,E[Q.url])):(d=Tp.Parse(Q,p,N),E[Q.url]=d,W.Qj.push(d))):W.Qj.push(new Tp(Q.name,null,p))}E=[]})),Object.defineProperty(Gp.e.prototype,"mainSoundTrack",{get:function(){let V=this._getComponent(sp.c.NAME_AUDIO);return V||(V=new Xp(this),this.o(V)),this._mainSoundTrack||(this._mainSoundTrack=new bp(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Gp.e.prototype.getSoundByName=function(V){let p;for(p=0;p<this.mainSoundTrack.soundCollection.length;p++)if(this.mainSoundTrack.soundCollection[p].name===V)return this.mainSoundTrack.soundCollection[p];if(this.soundTracks)for(let W=0;W<this.soundTracks.length;W++)for(p=0;p<this.soundTracks[W].soundCollection.length;p++)if(this.soundTracks[W].soundCollection[p].name===V)return this.soundTracks[W].soundCollection[p];return null},Object.defineProperty(Gp.e.prototype,"audioEnabled",{get:function(){let V=this._getComponent(sp.c.NAME_AUDIO);return V||(V=new Xp(this),this.o(V)),V.audioEnabled},set:function(V){let p=this._getComponent(sp.c.NAME_AUDIO);p||(p=new Xp(this),this.o(p)),V?p.enableAudio():p.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Gp.e.prototype,"headphone",{get:function(){let V=this._getComponent(sp.c.NAME_AUDIO);return V||(V=new Xp(this),this.o(V)),V.headphone},set:function(V){let p=this._getComponent(sp.c.NAME_AUDIO);p||(p=new Xp(this),this.o(p)),V?p.switchAudioModeForHeadphones():p.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Gp.e.prototype,"audioListenerPositionProvider",{get:function(){let V=this._getComponent(sp.c.NAME_AUDIO);return V||(V=new Xp(this),this.o(V)),V.audioListenerPositionProvider},set:function(V){let p=this._getComponent(sp.c.NAME_AUDIO);if(p||(p=new Xp(this),this.o(p)),V&&"function"!==typeof V)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");p.audioListenerPositionProvider=V},enumerable:!0,configurable:!0}),Object.defineProperty(Gp.e.prototype,"audioListenerRotationProvider",{get:function(){let V=this._getComponent(sp.c.NAME_AUDIO);return V||(V=new Xp(this),this.o(V)),V.audioListenerRotationProvider},set:function(V){let p=this._getComponent(sp.c.NAME_AUDIO);if(p||(p=new Xp(this),this.o(p)),V&&"function"!==typeof V)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");p.audioListenerRotationProvider=V},enumerable:!0,configurable:!0}),Object.defineProperty(Gp.e.prototype,"audioPositioningRefreshRate",{get:function(){let V=this._getComponent(sp.c.NAME_AUDIO);return V||(V=new Xp(this),this.o(V)),V.audioPositioningRefreshRate},set:function(V){let p=this._getComponent(sp.c.NAME_AUDIO);p||(p=new Xp(this),this.o(p)),p.audioPositioningRefreshRate=V},enumerable:!0,configurable:!0});class Xp{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(V){this.name=sp.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new d.n,this._cachedCameraPosition=new d.n,this._lastCheck=0,this._invertMatrixTemp=new d.e,this._cameraDirectionTemp=new d.n,(V=V||u.d.LastCreatedScene)&&(this.Bc=V,V.soundTracks=[],V.Qj=[])}register(){this.Bc._afterRenderStage.registerStep(sp.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(V){if(V.Qj=[],this.Bc.soundTracks)for(let p=0;p<this.Bc.soundTracks.length;p++){const W=this.Bc.soundTracks[p];for(let p=0;p<W.soundCollection.length;p++)V.Qj.push(W.soundCollection[p].serialize())}}addFromContainer(V){V.Qj&&V.Qj.forEach((V=>{V.play(),V.autoplay=!0,this.Bc.mainSoundTrack.addSound(V)}))}removeFromContainer(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V.Qj&&V.Qj.forEach((V=>{V.stop(),V.autoplay=!1,this.Bc.mainSoundTrack.removeSound(V),p&&V.dispose()}))}dispose(){const V=this.Bc;if(V._mainSoundTrack&&V.mainSoundTrack.dispose(),V.soundTracks)for(let p=0;p<V.soundTracks.length;p++)V.soundTracks[p].dispose()}disableAudio(){const V=this.Bc;let p;for(this._audioEnabled=!1,xp.d.audioEngine&&xp.d.audioEngine.audioContext&&xp.d.audioEngine.audioContext.suspend(),p=0;p<V.mainSoundTrack.soundCollection.length;p++)V.mainSoundTrack.soundCollection[p].pause();if(V.soundTracks)for(p=0;p<V.soundTracks.length;p++)for(let W=0;W<V.soundTracks[p].soundCollection.length;W++)V.soundTracks[p].soundCollection[W].pause()}enableAudio(){const V=this.Bc;let p;for(this._audioEnabled=!0,xp.d.audioEngine&&xp.d.audioEngine.audioContext&&xp.d.audioEngine.audioContext.resume(),p=0;p<V.mainSoundTrack.soundCollection.length;p++)V.mainSoundTrack.soundCollection[p].isPaused&&V.mainSoundTrack.soundCollection[p].play();if(V.soundTracks)for(p=0;p<V.soundTracks.length;p++)for(let W=0;W<V.soundTracks[p].soundCollection.length;W++)V.soundTracks[p].soundCollection[W].isPaused&&V.soundTracks[p].soundCollection[W].play()}switchAudioModeForHeadphones(){const V=this.Bc;if(this._headphone=!0,V.mainSoundTrack.switchPanningModelToHRTF(),V.soundTracks)for(let p=0;p<V.soundTracks.length;p++)V.soundTracks[p].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const V=this.Bc;if(this._headphone=!1,V.mainSoundTrack.switchPanningModelToEqualPower(),V.soundTracks)for(let p=0;p<V.soundTracks.length;p++)V.soundTracks[p].switchPanningModelToEqualPower()}_afterRender(){const V=Rp.d.Now;if(this._lastCheck&&V-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=V;const p=this.Bc;if(!this._audioEnabled||!p._mainSoundTrack||!p.soundTracks||0===p._mainSoundTrack.soundCollection.length&&1===p.soundTracks.length)return;const W=xp.d.audioEngine;if(W&&W.audioContext){let V,N=p.activeCamera;if(p.activeCameras&&p.activeCameras.length>0&&(N=p.activeCameras[0]),this.audioListenerPositionProvider){const V=this.audioListenerPositionProvider();W.audioContext.listener.setPosition(V.x||0,V.y||0,V.z||0)}else N?this._cachedCameraPosition.equals(N.globalPosition)||(this._cachedCameraPosition.p(N.globalPosition),W.audioContext.listener.setPosition(N.globalPosition.x,N.globalPosition.y,N.globalPosition.z)):W.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const V=this.audioListenerRotationProvider();W.audioContext.listener.setOrientation(V.x||0,V.y||0,V.z||0,0,1,0)}else N?(N.rigCameras&&N.rigCameras.length>0&&(N=N.rigCameras[0]),N.getViewMatrix().invertToRef(this._invertMatrixTemp),d.n.TransformNormalToRef(Xp._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),W.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):W.audioContext.listener.setOrientation(0,0,0,0,1,0);for(V=0;V<p.mainSoundTrack.soundCollection.length;V++){const W=p.mainSoundTrack.soundCollection[V];W.useCustomAttenuation&&W.updateDistanceFromListener()}if(p.soundTracks)for(V=0;V<p.soundTracks.length;V++)for(let W=0;W<p.soundTracks[V].soundCollection.length;W++){const N=p.soundTracks[V].soundCollection[W];N.useCustomAttenuation&&N.updateDistanceFromListener()}}}}Xp._CameraDirection=new d.n(0,0,-1),Tp._SceneComponentInitialization=V=>{let p=V._getComponent(sp.c.NAME_AUDIO);p||(p=new Xp(V),V.o(p))};const rp="MSFT_audio_emitter";class Bp{constructor(V){this.name=rp,this._loader=V,this.enabled=this._loader.isExtensionUsed(rp)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const V=this._loader.Di.extensions;if(V&&V[this.name]){const p=V[this.name];this._clips=p.clips,this._emitters=p.emitters,a.Assign(this._clips),a.Assign(this._emitters)}}loadSceneAsync(V,p){return y.LoadExtensionAsync(V,p,this.name,((W,N)=>{const d=new Array;d.push(this._loader.loadSceneAsync(V,p));for(const V of N.emitters){const p=a.Get(`${W}/emitters`,this._emitters,V);if(void 0!=p.refDistance||void 0!=p.maxDistance||void 0!=p.rolloffFactor||void 0!=p.distanceModel||void 0!=p.innerAngle||void 0!=p.outerAngle)throw new Error(`${W}: Direction or Distance properties are not allowed on emitters attached to a scene`);d.push(this._loadEmitterAsync(`${W}/emitters/${p.index}`,p))}return Promise.all(d).then((()=>{}))}))}loadNodeAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((V,N)=>{const E=new Array;return this._loader.loadNodeAsync(V,p,(p=>{for(const W of N.emitters){const N=a.Get(`${V}/emitters`,this._emitters,W);E.push(this._loadEmitterAsync(`${V}/emitters/${N.index}`,N).then((()=>{for(const V of N._babylonSounds)V.attachToMesh(p),void 0==N.innerAngle&&void 0==N.outerAngle||(V.setLocalDirectionToMesh(d.n.Forward()),V.setDirectionalCone(2*z.e.ToDegrees(void 0==N.innerAngle?Math.PI:N.innerAngle),2*z.e.ToDegrees(void 0==N.outerAngle?Math.PI:N.outerAngle),0))})))}W(p)})).then((V=>Promise.all(E).then((()=>V))))}))}loadAnimationAsync(V,p){return y.LoadExtensionAsync(V,p,this.name,((W,N)=>this._loader.loadAnimationAsync(V,p).then((d=>{const E=new Array;a.Assign(N.events);for(const z of N.events)E.push(this._loadAnimationEventAsync(`${W}/events/${z.index}`,V,p,z,d));return Promise.all(E).then((()=>d))}))))}_loadClipAsync(V,p){if(p._objectURL)return p._objectURL;let W;if(p.uri)W=this._loader.loadUriAsync(V,p,p.uri);else{const N=a.Get(`${V}/bufferView`,this._loader.Di.bufferViews,p.bufferView);W=this._loader.loadBufferViewAsync(`/bufferViews/${N.index}`,N)}return p._objectURL=W.then((V=>URL.createObjectURL(new Blob([V],{type:p.mimeType})))),p._objectURL}_loadEmitterAsync(V,p){if(p._babylonSounds=p._babylonSounds||[],!p._babylonData){const V=new Array,W=p.name||`emitter${p.index}`,N={loop:!1,autoplay:!1,volume:void 0==p.volume?1:p.volume};for(let E=0;E<p.clips.length;E++){const d=`/extensions/${this.name}/clips`,z=a.Get(d,this._clips,p.clips[E].clip);V.push(this._loadClipAsync(`${d}/${p.clips[E].clip}`,z).then((V=>{const d=p._babylonSounds[E]=new Tp(W,V,this._loader.babylonScene,null,N);d.refDistance=p.refDistance||1,d.maxDistance=p.maxDistance||256,d.rolloffFactor=p.rolloffFactor||1,d.distanceModel=p.distanceModel||"exponential"})))}const d=Promise.all(V).then((()=>{const V=p.clips.map((V=>V.weight||1)),W=new Pp(p.loop||!1,p._babylonSounds,V);p.innerAngle&&(W.directionalConeInnerAngle=2*z.e.ToDegrees(p.innerAngle)),p.outerAngle&&(W.directionalConeOuterAngle=2*z.e.ToDegrees(p.outerAngle)),p.volume&&(W.volume=p.volume),p._babylonData.sound=W}));p._babylonData={loaded:d}}return p._babylonData.loaded}_getEventAction(V,p,W,N,d){switch(W){case"play":return V=>{const W=(d||0)+(V-N);p.play(W)};case"stop":return()=>{p.stop()};case"pause":return()=>{p.pause()};default:throw new Error(`${V}: Unsupported action ${W}`)}}_loadAnimationEventAsync(V,p,W,N,d){if(0==d.targetedAnimations.length)return Promise.resolve();const E=d.targetedAnimations[0],z=N.j,S=a.Get(`/extensions/${this.name}/emitters`,this._emitters,z);return this._loadEmitterAsync(V,S).then((()=>{const p=S._babylonData.sound;if(p){const W=new hp(N.time,this._getEventAction(V,p,N.action,N.time,N.startOffset));E.animation.addEvent(W),d.onAnimationGroupEndObservable.add((()=>{p.stop()})),d.onAnimationGroupPauseObservable.add((()=>{p.pause()}))}}))}}m(rp),H(rp,!0,(V=>new Bp(V)));const Yp="MSFT_lod";class Ip{constructor(V){var p;this.name=Yp,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new i.b,this.onMaterialLODsLoadedObservable=new i.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=V,this.maxLODsToLoad=(null===(p=this._loader.parent.extensionOptions[Yp])||void 0===p?void 0:p.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Yp)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let V=0;V<this._nodePromiseLODs.length;V++){const p=Promise.all(this._nodePromiseLODs[V]).then((()=>{0!==V&&(this._loader.endPerformanceCounter(`Node LOD ${V}`),this._loader.log(`Loaded node LOD ${V}`)),this.onNodeLODsLoadedObservable.notifyObservers(V),V!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${V+1}`),this._loadBufferLOD(this._nodeBufferLODs,V+1),this._nodeSignalLODs[V]&&this._nodeSignalLODs[V].resolve())}));this._loader._completePromises.push(p)}for(let V=0;V<this._materialPromiseLODs.length;V++){const p=Promise.all(this._materialPromiseLODs[V]).then((()=>{0!==V&&(this._loader.endPerformanceCounter(`Material LOD ${V}`),this._loader.log(`Loaded material LOD ${V}`)),this.onMaterialLODsLoadedObservable.notifyObservers(V),V!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${V+1}`),this._loadBufferLOD(this._materialBufferLODs,V+1),this._materialSignalLODs[V]&&this._materialSignalLODs[V].resolve())}));this._loader._completePromises.push(p)}}loadSceneAsync(V,p){const W=this._loader.loadSceneAsync(V,p);return this._loadBufferLOD(this._bufferLODs,0),W}loadNodeAsync(V,p,W){return y.LoadExtensionAsync(V,p,this.name,((V,d)=>{let E;const z=this._getLODs(V,p,this._loader.Di.nodes,d.ids);this._loader.logOpen(`${V}`);for(let p=0;p<z.length;p++){const V=z[p];0!==p&&(this._nodeIndexLOD=p,this._nodeSignalLODs[p]=this._nodeSignalLODs[p]||new N);const d=V=>{W(V),V.Ab(!1)},S=this._loader.loadNodeAsync(`/nodes/${V.index}`,V,d).then((V=>{if(0!==p){const V=z[p-1];V._babylonTransformNode&&(this._disposeTransformNode(V._babylonTransformNode),delete V._babylonTransformNode)}return V.Ab(!0),V}));this._nodePromiseLODs[p]=this._nodePromiseLODs[p]||[],0===p?E=S:(this._nodeIndexLOD=null,this._nodePromiseLODs[p].push(S))}return this._loader.logClose(),E}))}_loadMaterialAsync(V,p,W,N,d){return this._nodeIndexLOD?null:y.LoadExtensionAsync(V,p,this.name,((V,E)=>{let z;const S=this._getLODs(V,p,this._loader.Di.materials,E.ids);this._loader.logOpen(`${V}`);for(let p=0;p<S.length;p++){const V=S[p];0!==p&&(this._materialIndexLOD=p);const E=this._loader._loadMaterialAsync(`/materials/${V.index}`,V,W,N,(V=>{0===p&&d(V)})).then((V=>{if(0!==p){d(V);const W=S[p-1]._data;W[N]&&(this._disposeMaterials([W[N].babylonMaterial]),delete W[N])}return V}));this._materialPromiseLODs[p]=this._materialPromiseLODs[p]||[],0===p?z=E:(this._materialIndexLOD=null,this._materialPromiseLODs[p].push(E))}return this._loader.logClose(),z}))}_loadUriAsync(V,p,W){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const d=this._nodeIndexLOD-1;return this._nodeSignalLODs[d]=this._nodeSignalLODs[d]||new N,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(V,p,W)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const d=this._materialIndexLOD-1;return this._materialSignalLODs[d]=this._materialSignalLODs[d]||new N,this._materialSignalLODs[d].promise.then((()=>this._loader.loadUriAsync(V,p,W)))}return null}loadBufferAsync(V,p,W,d){if(this._loader.parent.useRangeRequests&&!p.uri){if(!this._loader.bin)throw new Error(`${V}: Uri is missing or the binary glTF is missing its binary chunk`);const p=(V,p)=>{const E=W,z=E+d-1;let S=V[p];return S?(S.start=Math.min(S.start,E),S.end=Math.max(S.end,z)):(S={start:E,end:z,loaded:new N},V[p]=S),S.loaded.promise.then((V=>new Uint8Array(V.buffer,V.byteOffset+W-S.start,d)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?p(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?p(this._materialBufferLODs,this._materialIndexLOD):p(this._bufferLODs,0)}return null}_loadBufferLOD(V,p){const W=V[p];W&&(this._loader.log(`Loading buffer range [${W.start}-${W.end}]`),this._loader.bin.readAsync(W.start,W.end-W.start+1).then((V=>{W.loaded.resolve(V)}),(V=>{W.loaded.reject(V)})))}_getLODs(V,p,W,N){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const d=[];for(let E=N.length-1;E>=0;E--)if(d.push(a.Get(`${V}/ids/${N[E]}`,W,N[E])),d.length===this.maxLODsToLoad)return d;return d.push(p),d}_disposeTransformNode(V){const p=[],W=V.material;W&&p.push(W);for(const d of V.getChildMeshes())d.material&&p.push(d.material);V.dispose();const N=p.filter((V=>this._loader.babylonScene.meshes.every((p=>p.material!=V))));this._disposeMaterials(N)}_disposeMaterials(V){const p={};for(const W of V){for(const V of W.getActiveTextures())p[V.uniqueId]=V;W.dispose()}for(const W in p)for(const V of this._loader.babylonScene.materials)V.hasTexture(p[W])&&delete p[W];for(const W in p)p[W].dispose()}}m(Yp),H(Yp,!0,(V=>new Ip(V)));const cp="MSFT_minecraftMesh";class qp{constructor(V){this.name=cp,this._loader=V,this.enabled=this._loader.isExtensionUsed(cp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtraAsync(V,p,this.name,((N,d)=>{if(d){if(!(W instanceof o))throw new Error(`${N}: Material type not supported`);const d=this._loader.loadMaterialPropertiesAsync(V,p,W);return W.needAlphaBlending()&&(W.forceDepthWrite=!0,W.separateCullingPass=!0),W.eh=W.forceDepthWrite,W.twoSidedLighting=!0,d}return null}))}}m(cp),H(cp,!0,(V=>new qp(V)));const gp="MSFT_sRGBFactors";class Dp{constructor(V){this.name=gp,this._loader=V,this.enabled=this._loader.isExtensionUsed(gp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,p,W){return y.LoadExtraAsync(V,p,this.name,((N,d)=>{if(d){if(!(W instanceof o))throw new Error(`${N}: Material type not supported`);const d=this._loader.loadMaterialPropertiesAsync(V,p,W),E=W.va().getEngine().useExactSrgbConversions;return W.albedoTexture||W.albedoColor.toLinearSpaceToRef(W.albedoColor,E),W.reflectivityTexture||W.reflectivityColor.toLinearSpaceToRef(W.reflectivityColor,E),d}return null}))}}m(gp),H(gp,!0,(V=>new Dp(V)));var Hp,mp=W(11007);!function(V){V[V.Input=0]="Input",V[V.Output=1]="Output"}(Hp||(Hp={}));class Mp{constructor(V,p,W){this._ownerBlock=W,this._connectedPoint=[],this.uniqueId=(0,mp.b)(),this.connectedPointIds=[],this.name=V,this._connectionType=p}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(V){if(this._connectionType===V._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||V._isSingularConnection()&&V._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(V),V._connectedPoint.push(this)}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};V.uniqueId=this.uniqueId,V.name=this.name,V._connectionType=this._connectionType,V.connectedPointIds=[],V.className=this.getClassName();for(const p of this._connectedPoint)V.connectedPointIds.push(p.uniqueId)}getClassName(){return"FGConnection"}deserialize(V){this.uniqueId=V.uniqueId,this.name=V.name,this._connectionType=V._connectionType,this.connectedPointIds=V.connectedPointIds}static Parse(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=arguments.length>1?arguments[1]:void 0;const W=new(z.e.Instantiate(V.className))(V.name,V._connectionType,p);return W.deserialize(V),W}}class ap{constructor(V){this.value=this._toInt(V)}_toInt(V){return 0|V}add(V){return new ap(this.value+V.value)}ed(V){return new ap(this.value-V.value)}multiply(V){return new ap(Math.imul(this.value,V.value))}divide(V){return new ap(this.value/V.value)}getClassName(){return ap.ClassName}equals(V){return this.value===V.value}static Parse(V){return new ap(V.value)}}ap.ClassName="FlowGraphInteger",(0,e.d)("FlowGraphInteger",ap);class yp{constructor(V,p){this.typeName=V,this.defaultValue=p}serialize(V){V.typeName=this.typeName,V.defaultValue=this.defaultValue}static Parse(V){return new yp(V.typeName,V.defaultValue)}}const np=new yp("any",void 0),wp=(new yp("string",""),new yp("number",0)),VW=new yp("boolean",!1),pW=new yp("Vector2",d.k.Zero()),WW=new yp("fb",d.n.Zero()),NW=(new yp("Vector4",d.q.Zero()),new yp("Matrix",d.e.Identity())),dW=(new yp("gb",E.c.Black()),new yp("ob",new E.e(0,0,0,0)),new yp("Quaternion",d.f.Identity()),new yp("FlowGraphInteger",new ap(0)));class EW extends Mp{constructor(V,p,W,N){super(V,p,W),this.richType=N}_isSingularConnection(){return 0===this.connectionType}setValue(V,p){p._setConnectionValue(this,V)}connectTo(V){super.connectTo(V)}_getValueOrDefault(V){return V._hasConnectionValue(this)?V._getConnectionValue(this):this.richType.defaultValue}getValue(V){return 1===this.connectionType?(V._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(V),this._getValueOrDefault(V)):this.isConnected()?this._connectedPoint[0].getValue(V):this._getValueOrDefault(V)}getClassName(){return"FGDataConnection"}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(V),V.richType={},this.richType.serialize(V.richType)}static Parse(V,p){const W=Mp.Parse(V,p);return W.richType=yp.Parse(V.richType),W}}function zW(V){return"Mesh"===V||"AbstractMesh"===V||"GroundMesh"===V||"InstanceMesh"===V||"LinesMesh"===V||"GoldbergMesh"===V||"GreasedLineMesh"===V||"TrailMesh"===V}function SW(V){return"Vector2"===V||"fb"===V||"Vector4"===V||"Quaternion"===V||"gb"===V||"ob"===V}function QW(V,p,W){var N;const d=(null===p||void 0===p||null===(N=p.getClassName)||void 0===N?void 0:N.call(p))??"";zW(d)?W[V]={name:p.name,className:d}:SW(d)?W[V]={value:p.Zi(),className:d}:W[V]=p}function JW(V,p,W){const N=p[V];let z;const S=null===N||void 0===N?void 0:N.className;return z=zW(S)?W.getMeshByName(N.name):SW(S)?function(V,p){if("Vector2"===V)return d.k.Tg(p);if("fb"===V)return d.n.Tg(p);if("Vector4"===V)return d.q.Tg(p);if("Quaternion"===V)return d.f.Tg(p);if("gb"===V)return new E.c(p[0],p[1],p[2]);if("ob"===V)return new E.e(p[0],p[1],p[2],p[3]);throw new Error(`Unknown vector class name ${V}`)}(S,N.value):"Matrix"===S?d.e.Tg(N.value):S===ap.ClassName?ap.Parse(N):N&&void 0!==N.value?N.value:N,z}(0,e.d)("FGDataConnection",EW);class iW{constructor(V){var p;this.config=V,this.uniqueId=(0,mp.b)(),this.name=(null===(p=this.config)||void 0===p?void 0:p.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(V){}registerDataInput(V,p){const W=new EW(V,0,this,p);return this.dataInputs.push(W),W}registerDataOutput(V,p){const W=new EW(V,1,this,p);return this.dataOutputs.push(W),W}getDataInput(V){return this.dataInputs.find((p=>p.name===V))}getDataOutput(V){return this.dataOutputs.find((p=>p.name===V))}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};V.uniqueId=this.uniqueId,V.config={},this.config&&(V.config.name=this.config.name),V.dataInputs=[],V.dataOutputs=[],V.className=this.getClassName();for(const p of this.dataInputs){const W={};p.serialize(W),V.dataInputs.push(W)}for(const p of this.dataOutputs){const W={};p.serialize(W),V.dataOutputs.push(W)}}getClassName(){return"FGBlock"}static Parse(V,p){const W=z.e.Instantiate(V.className),N={},d=p.valueParseFunction??JW;if(V.config)for(const z in V.config)N[z]=d(z,V.config,p.Bc);var E;("FGSetPropertyBlock"===(E=V.className)||"FGGetPropertyBlock"===E||"FGPlayAnimationBlock"===E||"FGMeshPickEventBlock"===E)&&(N.pathConverter=p.pathConverter);const S=new W(N);S.uniqueId=V.uniqueId;for(let z=0;z<V.dataInputs.length;z++){const p=S.getDataInput(V.dataInputs[z].name);if(!p)throw new Error("Could not find data input with name "+V.dataInputs[z].name+" in block "+V.className);p.deserialize(V.dataInputs[z])}for(let z=0;z<V.dataOutputs.length;z++){const p=S.getDataOutput(V.dataOutputs[z].name);if(!p)throw new Error("Could not find data output with name "+V.dataOutputs[z].name+" in block "+V.className);p.deserialize(V.dataOutputs[z])}return S.metadata=V.metadata,S.deserialize&&S.deserialize(V),S}}class lW extends Mp{_isSingularConnection(){return 1===this.connectionType}_activateSignal(V){var p;0===this.connectionType?(V._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(V,this),V._increaseExecutionId()):null===(p=this._connectedPoint[0])||void 0===p||p._activateSignal(V)}}(0,e.d)("FlowGraphSignalConnection",lW);class jW extends iW{constructor(V){super(V),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(V){const p=new lW(V,0,this);return this.signalInputs.push(p),p}_registerSignalOutput(V){const p=new lW(V,1,this);return this.signalOutputs.push(p),p}getSignalInput(V){return this.signalInputs.find((p=>p.name===V))}getSignalOutput(V){return this.signalOutputs.find((p=>p.name===V))}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(V),V.signalInputs=[],V.signalOutputs=[];for(const p of this.signalInputs){const W={};p.serialize(W),V.signalInputs.push(W)}for(const p of this.signalOutputs){const W={};p.serialize(W),V.signalOutputs.push(W)}}deserialize(V){for(let p=0;p<V.signalInputs.length;p++){const W=this.getSignalInput(V.signalInputs[p].name);if(!W)throw new Error("Could not find signal input with name "+V.signalInputs[p].name+" in block "+V.className);W.deserialize(V.signalInputs[p])}for(let p=0;p<V.signalOutputs.length;p++){const W=this.getSignalOutput(V.signalOutputs[p].name);if(!W)throw new Error("Could not find signal output with name "+V.signalOutputs[p].name+" in block "+V.className);W.deserialize(V.signalOutputs[p])}}getClassName(){return"FGExecutionBlock"}}class kW extends jW{constructor(V){super(V),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(V){this._preparePendingTasks(V),V._addPendingBlock(this)}}class uW extends kW{_execute(V){V._notifyExecuteNode(this),this.out._activateSignal(V)}}class fW{constructor(V){this.uniqueId=(0,mp.b)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new i.b,this._configuration=V}hasVariable(V){return V in this._userVariables}setVariable(V,p){this._userVariables[V]=p}getVariable(V){return this._userVariables[V]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(V,p){return`${V.uniqueId}_${p}`}_setExecutionVariable(V,p,W){this._executionVariables[this._getUniqueIdPrefixedName(V,p)]=W}_getExecutionVariable(V,p,W){return this._hasExecutionVariable(V,p)?this._executionVariables[this._getUniqueIdPrefixedName(V,p)]:W}_deleteExecutionVariable(V,p){delete this._executionVariables[this._getUniqueIdPrefixedName(V,p)]}_hasExecutionVariable(V,p){return this._getUniqueIdPrefixedName(V,p)in this._executionVariables}_hasConnectionValue(V){return V.uniqueId in this._connectionValues}_setConnectionValue(V,p){this._connectionValues[V.uniqueId]=p}_getConnectionValue(V){return this._connectionValues[V.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(V){this._pendingBlocks.push(V)}_removePendingBlock(V){const p=this._pendingBlocks.indexOf(V);-1!==p&&this._pendingBlocks.splice(p,1)}_clearPendingBlocks(){for(const V of this._pendingBlocks)V._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(V){this.onNodeExecutedObservable.notifyObservers(V)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:QW;V.uniqueId=this.uniqueId,V._userVariables={};for(const W in this._userVariables)p(W,this._userVariables[W],V._userVariables);V._connectionValues={};for(const W in this._connectionValues)p(W,this._connectionValues[W],V._connectionValues)}getClassName(){return"FGContext"}static Parse(V,p){const W=p.graph.createContext(),N=p.valueParseFunction??JW;W.uniqueId=V.uniqueId;for(const d in V._userVariables){const p=N(d,V._userVariables,W._configuration.Bc);W._userVariables[d]=p}for(const d in V._connectionValues){const p=N(d,V._connectionValues,W._configuration.Bc);W._connectionValues[d]=p}return W}}(0,C.c)([(0,A.I)()],fW.prototype,"uniqueId",void 0);var OW,UW,FW=W(11330);function CW(V,p){return!(!V.parent||V.parent!==p&&!CW(V.parent,p))}class AW extends uW{constructor(V){super(V),this.config=V}_getReferencedMesh(){const V=this.config.pathConverter.convert(this.config.path),p=V.info.getObject(V.object);if(!p||!(p instanceof T.d))throw new Error("Mesh pick event block requires a valid mesh");return p}_preparePendingTasks(V){let p=V._getExecutionVariable(this,"meshPickObserver");if(!p){const W=this._getReferencedMesh();V._setExecutionVariable(this,"mesh",W),p=W.va().onPointerObservable.add((p=>{var N,d,E;p.type===FW.d.POINTERPICK&&null!==(N=p.pickInfo)&&void 0!==N&&N.pickedMesh&&((null===(d=p.pickInfo)||void 0===d?void 0:d.pickedMesh)===W||CW(null===(E=p.pickInfo)||void 0===E?void 0:E.pickedMesh,W))&&this._execute(V)}));const N=W.$i.add((()=>this._onDispose));V._setExecutionVariable(this,"meshPickObserver",p),V._setExecutionVariable(this,"meshDisposeObserver",N)}}_onDispose(V){this._cancelPendingTasks(V),V._removePendingBlock(this)}_cancelPendingTasks(V){const p=V._getExecutionVariable(this,"mesh"),W=V._getExecutionVariable(this,"meshPickObserver"),N=V._getExecutionVariable(this,"meshDisposeObserver");p.va().onPointerObservable.remove(W),p.$i.remove(N),V._deleteExecutionVariable(this,"mesh"),V._deleteExecutionVariable(this,"meshPickObserver"),V._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return AW.ClassName}serialize(V){super.serialize(V),V.config.path=this.config.path}}AW.ClassName="FGMeshPickEventBlock",(0,e.d)(AW.ClassName,AW),function(V){V[V.Stopped=0]="Stopped",V[V.Started=1]="Started"}(OW||(OW={}));class vW{constructor(V){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=V.Bc,this._coordinator=V.coordinator,this._sceneDisposeObserver=this._scene.$i.add((()=>this.dispose()))}createContext(){const V=new fW({Bc:this._scene,coordinator:this._coordinator});return this._executionContexts.push(V),V}getContext(V){return this._executionContexts[V]}addEventBlock(V){this._eventBlocks.push(V)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const V of this._executionContexts){const p=this._getContextualOrder();for(const W of p)W._startPendingTasks(V)}}}_getContextualOrder(){const V=[];for(const p of this._eventBlocks)if(p.getClassName()===AW.ClassName){const W=p._getReferencedMesh();let N=0;for(;N<V.length;N++){const p=V[N]._getReferencedMesh();if(W&&p&&CW(W,p))break}V.splice(N,0,p)}else V.push(p);return V}dispose(){if(0!==this.state){this.state=0;for(const V of this._executionContexts)V._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.$i.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(V){const p=[],W=new Set;for(const N of this._eventBlocks)p.push(N),W.add(N.uniqueId);for(;p.length>0;){const N=p.pop();V(N);for(const V of N.dataInputs)for(const N of V._connectedPoint)W.has(N._ownerBlock.uniqueId)||(p.push(N._ownerBlock),W.add(N._ownerBlock.uniqueId));if(N instanceof jW)for(const V of N.signalOutputs)for(const N of V._connectedPoint)W.has(N._ownerBlock.uniqueId)||(p.push(N._ownerBlock),W.add(N._ownerBlock.uniqueId))}}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=arguments.length>1?arguments[1]:void 0;V.allBlocks=[],this.visitAllBlocks((p=>{const W={};p.serialize(W),V.allBlocks.push(W)})),V.executionContexts=[];for(const W of this._executionContexts){const N={};W.serialize(N,p),V.executionContexts.push(N)}}static GetDataOutConnectionByUniqueId(V,p){for(const W of V)for(const V of W.dataOutputs)if(V.uniqueId===p)return V;throw new Error("Could not find data out connection with unique id "+p)}static GetSignalInConnectionByUniqueId(V,p){for(const W of V)if(W instanceof jW)for(const V of W.signalInputs)if(V.uniqueId===p)return V;throw new Error("Could not find signal in connection with unique id "+p)}static Parse(V,p){const W=p.coordinator.createGraph(),N=[],d=p.valueParseFunction??JW;for(const E of V.allBlocks){const V=iW.Parse(E,{Bc:p.coordinator.config.Bc,pathConverter:p.pathConverter,valueParseFunction:d});N.push(V),V instanceof uW&&W.addEventBlock(V)}for(const E of N){for(const V of E.dataInputs)for(const p of V.connectedPointIds){const W=vW.GetDataOutConnectionByUniqueId(N,p);V.connectTo(W)}if(E instanceof jW)for(const V of E.signalOutputs)for(const p of V.connectedPointIds){const W=vW.GetSignalInConnectionByUniqueId(N,p);V.connectTo(W)}}for(const E of V.executionContexts)fW.Parse(E,{graph:W,valueParseFunction:d});return W}}class tW{constructor(V){this.config=V,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Bc.$i.add((()=>{this.dispose()}));(tW.SceneCoordinators.get(this.config.Bc)??[]).push(this)}createGraph(){const V=new vW({Bc:this.config.Bc,coordinator:this});return this._flowGraphs.push(V),V}removeGraph(V){const p=this._flowGraphs.indexOf(V);-1!==p&&(V.dispose(),this._flowGraphs.splice(p,1))}start(){this._flowGraphs.forEach((V=>V.start()))}dispose(){this._flowGraphs.forEach((V=>V.dispose())),this._flowGraphs.length=0;const V=tW.SceneCoordinators.get(this.config.Bc)??[],p=V.indexOf(this);-1!==p&&V.splice(p,1)}serialize(V,p){V._flowGraphs=[],this._flowGraphs.forEach((W=>{const N={};W.serialize(N,p),V._flowGraphs.push(N)}))}static Parse(V,p){var W;const N=p.valueParseFunction??JW,d=new tW({Bc:p.Bc});return null===(W=V._flowGraphs)||void 0===W||W.forEach((V=>{vW.Parse(V,{coordinator:d,valueParseFunction:N,pathConverter:p.pathConverter})})),d}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(V){let p=this._customEventsMap.get(V);return p||(p=new i.b,this._customEventsMap.set(V,p)),p}notifyCustomEvent(V,p){const W=this._customEventsMap.get(V);W&&W.notifyObservers(p)}}tW.SceneCoordinators=new Map;class eW extends uW{_preparePendingTasks(V){if(!V._getExecutionVariable(this,"sceneReadyObserver")){const p=V.configuration.Bc.onReadyObservable.add((()=>{this._execute(V)}));V._setExecutionVariable(this,"sceneReadyObserver",p)}}_cancelPendingTasks(V){const p=V._getExecutionVariable(this,"sceneReadyObserver");V.configuration.Bc.onReadyObservable.remove(p),V._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return eW.ClassName}}eW.ClassName="FGSceneReadyEventBlock",(0,e.d)("FGSceneReadyEventBlock",eW);class ZW extends uW{_preparePendingTasks(V){if(!V._getExecutionVariable(this,"sceneBeforeRender")){const p=V.configuration.Bc.onBeforeRenderObservable.add((()=>{this._execute(V)}));V._setExecutionVariable(this,"sceneBeforeRender",p)}}_cancelPendingTasks(V){const p=V._getExecutionVariable(this,"sceneBeforeRender");V.configuration.Bc.onBeforeRenderObservable.remove(p),V._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return ZW.ClassName}}ZW.ClassName="FGSceneTickEventBlock",(0,e.d)(ZW.ClassName,ZW);class oW extends jW{constructor(V){super(V),this.out=this._registerSignalOutput("out")}}class KW extends oW{constructor(V){super(V),this.message=this.registerDataInput("message",np)}_execute(V){const p=this.message.getValue(V);f.e.Log(p),this.out._activateSignal(V)}getClassName(){return KW.ClassName}}KW.ClassName="FGConsoleLogBlock",(0,e.d)(KW.ClassName,KW),function(V){V[V.INIT=0]="INIT",V[V.STARTED=1]="STARTED",V[V.ENDED=2]="ENDED"}(UW||(UW={}));class hW{constructor(V){this.onEachCountObservable=new i.b,this.onTimerAbortedObservable=new i.b,this.onTimerEndedObservable=new i.b,this.onStateChangedObservable=new i.b,this._observer=null,this._breakOnNextTick=!1,this._tick=V=>{const p=Date.now();this._timer=p-this._startTime;const W={startTime:this._startTime,currentTime:p,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:V},N=this._breakOnNextTick||this._breakCondition(W);N||this._timer>=this._timeToEnd?this._stop(W,N):this.onEachCountObservable.notifyObservers(W)},this._setState(0),this._contextObservable=V.contextObservable,this._observableParameters=V.observableParameters??{},this._breakCondition=V.breakCondition??(()=>!1),this._timeToEnd=V.timeout,V.onEnded&&this.onTimerEndedObservable.add(V.onEnded),V.Th&&this.onEachCountObservable.add(V.Th),V.onAborted&&this.onTimerAbortedObservable.add(V.onAborted)}set breakCondition(V){this._breakCondition=V}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=V,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(V){this._state=V,this.onStateChangedObservable.notifyObservers(this._state)}_stop(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),p?this.onTimerAbortedObservable.notifyObservers(V):this.onTimerEndedObservable.notifyObservers(V)}}class LW extends kW{constructor(V){super(V),this.timeout=this.registerDataInput("timeout",wp)}_preparePendingTasks(V){const p=this.timeout.getValue(V);if(void 0!==p&&p>=0){const W=V._getExecutionVariable(this,"runningTimers")||[],N=V.configuration.Bc,d=new hW({timeout:p,contextObservable:N.onBeforeRenderObservable,onEnded:()=>this._onEnded(d,V)});d.start(),W.push(d),V._setExecutionVariable(this,"runningTimers",W)}}_execute(V){this._startPendingTasks(V),this.out._activateSignal(V)}_onEnded(V,p){const W=p._getExecutionVariable(this,"runningTimers")||[],N=W.indexOf(V);-1!==N?W.splice(N,1):z.e.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),p._removePendingBlock(this),this.done._activateSignal(p)}_cancelPendingTasks(V){const p=V._getExecutionVariable(this,"runningTimers")||[];for(const W of p)W.dispose();V._deleteExecutionVariable(this,"runningTimers")}getClassName(){return LW.ClassName}}LW.ClassName="FGTimerBlock",(0,e.d)("FGTimerBlock",LW);class xW extends oW{constructor(V){super(V),this.config=V;for(let p=0;p<this.config.eventData.length;p++){const V=this.config.eventData[p];this.registerDataInput(V,np)}}_execute(V){const p=this.config.eventId,W=this.dataInputs.map((p=>p.getValue(V)));V.configuration.coordinator.notifyCustomEvent(p,W),this.out._activateSignal(V)}getClassName(){return xW.ClassName}}xW.ClassName="FGSendCustomEventBlock",(0,e.d)("FGSendCustomEventBlock",xW);class TW extends uW{constructor(V){super(V),this.config=V;for(let p=0;p<this.config.eventData.length;p++){const V=this.config.eventData[p];this.registerDataOutput(V,np)}}_preparePendingTasks(V){const p=V.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=p.add((p=>{for(let W=0;W<p.length;W++)this.dataOutputs[W].setValue(p[W],V);this._execute(V)}))}_cancelPendingTasks(V){const p=V.configuration.coordinator.getCustomEventObservable(this.config.eventId);p?p.remove(this._eventObserver):z.e.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return TW.ClassName}serialize(V){super.serialize(V),V.eventId=this.config.eventId,V.eventData=this.config.eventData}}TW.ClassName="FGReceiveCustomEventBlock",(0,e.d)(TW.ClassName,TW);class PW extends jW{constructor(V){super(V),this.config=V,this.outFlows=[];for(let p=0;p<this.config.numberOutputFlows;p++)this.outFlows.push(this._registerSignalOutput(`${p}`))}_execute(V){for(let p=0;p<this.config.numberOutputFlows;p++)this.outFlows[p]._activateSignal(V)}getClassName(){return PW.ClassName}}PW.ClassName="FGSequenceBlock",(0,e.d)(PW.ClassName,PW);const bW=new RegExp(/\{(\w+)\}/g);class sW{constructor(V,p){this.path=V,this.ownerBlock=p,this.templatedInputs=[];let W=bW.exec(V);for(;W;){const[,N]=W;this.templatedInputs.push(p.registerDataInput(N,dW)),W=bW.exec(V)}}getAccessor(V,p){let W=this.path;for(const N of this.templatedInputs){const V=N.getValue(p).value;W=W.replace(`{${N.name}}`,V.toString())}return V.convert(W)}}class GW extends iW{constructor(V){super(V),this.config=V,this.value=this.registerDataOutput("value",np),this.templateComponent=new sW(V.path,this)}_updateOutputs(V){const p=this.templateComponent.getAccessor(this.config.pathConverter,V),W=p.info.get(p.object);this.value.setValue(W,V)}getClassName(){return GW.ClassName}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(V),V.config.path=this.config.path}}GW.ClassName="FGGetPropertyBlock",(0,e.d)(GW.ClassName,GW);class RW extends oW{constructor(V){super(V),this.config=V,this.a=this.registerDataInput("a",np),this.templateComponent=new sW(V.path,this)}_execute(V){const p=this.a.getValue(V),W=this.templateComponent.getAccessor(this.config.pathConverter,V);W.info.set(p,W.object),this.out._activateSignal(V)}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(V),V.config.path=this.config.path}getClassName(){return RW.ClassName}}RW.ClassName="FGSetPropertyBlock",(0,e.d)("FGSetPropertyBlock",RW);const XW="cachedOperationValue",rW="cachedExecutionId";class BW extends iW{constructor(V,p){super(p),this.value=this.registerDataOutput("value",V)}_updateOutputs(V){const p=V._getExecutionVariable(this,rW),W=V._getExecutionVariable(this,XW);if(void 0!==W&&p===V.executionId)this.value.setValue(W,V);else{const p=this._doOperation(V);V._setExecutionVariable(this,XW,p),V._setExecutionVariable(this,rW,V.executionId),this.value.setValue(p,V)}}}class YW extends BW{constructor(V,p,W,N,d,E){super(W,E),this._operation=N,this._className=d,this.a=this.registerDataInput("a",V),this.b=this.registerDataInput("b",p)}_doOperation(V){return this._operation(this.a.getValue(V),this.b.getValue(V))}getClassName(){return this._className}}class IW extends BW{constructor(V,p,W,N){super(V,N),this._operation=p,this._className=W}_doOperation(V){return this._operation()}getClassName(){return this._className}}class cW extends BW{constructor(V,p,W,N,d){super(p,d),this._operation=W,this._className=N,this.a=this.registerDataInput("a",V)}_doOperation(V){return this._operation(this.a.getValue(V))}getClassName(){return this._className}}class qW extends BW{constructor(V,p,W,N,d,E,z){super(N,z),this._operation=d,this._className=E,this.a=this.registerDataInput("a",V),this.b=this.registerDataInput("b",p),this.c=this.registerDataInput("c",W)}_doOperation(V){return this._operation(this.a.getValue(V),this.b.getValue(V),this.c.getValue(V))}getClassName(){return this._className}}function gW(V){return V.getClassName?V.getClassName():""}function DW(V,p){return"Vector2"===V&&"Vector2"===p||"fb"===V&&"fb"===p||"Vector4"===V&&"Vector4"===p}function HW(V,p){return"Matrix"===V&&"Matrix"===p}function mW(V,p){return"FlowGraphInteger"===V&&"FlowGraphInteger"===p}class MW extends YW{constructor(V){super(np,np,np,((V,p)=>this._polymorphicAdd(V,p)),MW.ClassName,V)}_polymorphicAdd(V,p){const W=gW(V),N=gW(p);return DW(W,N)||HW(W,N)||mW(W,N)?V.add(p):V+p}}MW.ClassName="FGAddBlock",(0,e.d)(MW.ClassName,MW);class aW extends YW{constructor(V){super(np,np,np,((V,p)=>this._polymorphicAdd(V,p)),aW.ClassName,V)}_polymorphicAdd(V,p){const W=gW(V),N=gW(p);return DW(W,N)||mW(W,N)?V.ed(p):HW(W,N)?V.add(p.scale(-1)):V-p}}aW.ClassName="FGSubBlock",(0,e.d)(aW.ClassName,aW);class yW extends YW{constructor(V){super(np,np,np,((V,p)=>this._polymorphicMultiply(V,p)),yW.ClassName,V)}_polymorphicMultiply(V,p){const W=gW(V),N=gW(p);return DW(W,N)||mW(W,N)?V.multiply(p):HW(W,N)?d.e.FromValues(V.m[0]*p.m[0],V.m[4]*p.m[4],V.m[8]*p.m[8],V.m[12]*p.m[12],V.m[1]*p.m[1],V.m[5]*p.m[5],V.m[9]*p.m[9],V.m[13]*p.m[13],V.m[2]*p.m[2],V.m[6]*p.m[6],V.m[10]*p.m[10],V.m[14]*p.m[14],V.m[3]*p.m[3],V.m[7]*p.m[7],V.m[11]*p.m[11],V.m[15]*p.m[15]):V*p}}yW.ClassName="FGMultiplyBlock",(0,e.d)(yW.ClassName,yW);class nW extends YW{constructor(V){super(np,np,np,((V,p)=>this._polymorphicDivide(V,p)),nW.ClassName,V)}_polymorphicDivide(V,p){const W=gW(V),N=gW(p);return DW(W,N)||mW(W,N)?V.divide(p):HW(W,N)?d.e.FromValues(V.m[0]/p.m[0],V.m[4]/p.m[4],V.m[8]/p.m[8],V.m[12]/p.m[12],V.m[1]/p.m[1],V.m[5]/p.m[5],V.m[9]/p.m[9],V.m[13]/p.m[13],V.m[2]/p.m[2],V.m[6]/p.m[6],V.m[10]/p.m[10],V.m[14]/p.m[14],V.m[3]/p.m[3],V.m[7]/p.m[7],V.m[11]/p.m[11],V.m[15]/p.m[15]):V/p}}nW.ClassName="FGDivideBlock",(0,e.d)(nW.ClassName,nW);class wW extends IW{constructor(V){super(wp,(()=>Math.random()),wW.ClassName,V)}}wW.ClassName="FGRandomBlock",(0,e.d)(wW.ClassName,wW);class VN extends YW{constructor(V){super(np,np,wp,((V,p)=>this._polymorphicDot(V,p)),VN.ClassName,V)}_polymorphicDot(V,p){switch(gW(V)){case"Vector2":return d.k.Dot(V,p);case"fb":return d.n.Dot(V,p);case"Vector4":return d.q.Dot(V,p);default:throw new Error(`Cannot get dot product of ${V} and ${p}`)}}}VN.ClassName="FGDotBlock",(0,e.d)(VN.ClassName,VN);class pN extends IW{constructor(V){super(wp,(()=>Math.E),pN.ClassName,V)}}pN.ClassName="FGEBlock",(0,e.d)(pN.ClassName,pN);class WN extends IW{constructor(V){super(wp,(()=>Math.PI),WN.ClassName,V)}}WN.ClassName="FGPIBlock",(0,e.d)(WN.ClassName,WN);class NN extends IW{constructor(V){super(wp,(()=>Number.POSITIVE_INFINITY),NN.ClassName,V)}}NN.ClassName="FGInfBlock",(0,e.d)(NN.ClassName,NN);class dN extends IW{constructor(V){super(wp,(()=>Number.NaN),dN.ClassName,V)}}function EN(V,p){switch(gW(V)){case"FlowGraphInteger":return new ap(p(V.value));case"Vector2":return new d.k(p(V.x),p(V.y));case"fb":return new d.n(p(V.x),p(V.y),p(V.z));case"Vector4":return new d.q(p(V.x),p(V.y),p(V.z),p(V.w));case"Matrix":return d.e.FromValues(p(V.m[0]),p(V.m[4]),p(V.m[8]),p(V.m[12]),p(V.m[1]),p(V.m[5]),p(V.m[9]),p(V.m[13]),p(V.m[2]),p(V.m[6]),p(V.m[10]),p(V.m[14]),p(V.m[3]),p(V.m[7]),p(V.m[11]),p(V.m[15]));default:return p(V)}}dN.ClassName="FGNaNBlock",(0,e.d)(dN.ClassName,dN);class zN extends cW{constructor(V){super(np,np,(V=>this._polymorphicAbs(V)),zN.ClassName,V)}_polymorphicAbs(V){return EN(V,Math.abs)}}zN.ClassName="FGAbsBlock",(0,e.d)(zN.ClassName,zN);class SN extends cW{constructor(V){super(np,np,(V=>this._polymorphicSign(V)),SN.ClassName,V)}_polymorphicSign(V){return EN(V,Math.sign)}}SN.ClassName="FGSignBlock",(0,e.d)(SN.ClassName,SN);class QN extends cW{constructor(V){super(np,np,(V=>this._polymorphicTrunc(V)),QN.ClassName,V)}_polymorphicTrunc(V){return EN(V,Math.trunc)}}QN.ClassName="FGTruncBlock",(0,e.d)(QN.ClassName,QN);class JN extends cW{constructor(V){super(np,np,(V=>this._polymorphicFloor(V)),JN.ClassName,V)}_polymorphicFloor(V){return EN(V,Math.floor)}}JN.ClassName="FGFloorBlock",(0,e.d)(JN.ClassName,JN);class iN extends cW{constructor(V){super(np,np,(V=>this._polymorphicCeiling(V)),iN.ClassName,V)}_polymorphicCeiling(V){return EN(V,Math.ceil)}}iN.ClassName="FGCeilBlock",(0,e.d)(iN.ClassName,iN);class lN extends cW{constructor(V){super(np,np,(V=>this._polymorphicFract(V)),lN.ClassName,V)}_polymorphicFract(V){return EN(V,(V=>V-Math.floor(V)))}}lN.ClassName="FGFractBlock",(0,e.d)(lN.ClassName,lN);class jN extends cW{constructor(V){super(np,np,(V=>this._polymorphicNeg(V)),jN.ClassName,V)}_polymorphicNeg(V){return EN(V,(V=>-V))}}function kN(V,p,W){switch(gW(V)){case"FlowGraphInteger":return new ap(W(V.value,p.value));case"Vector2":return new d.k(W(V.x,p.x),W(V.y,p.y));case"fb":return new d.n(W(V.x,p.x),W(V.y,p.y),W(V.z,p.z));case"Vector4":return new d.q(W(V.x,p.x),W(V.y,p.y),W(V.z,p.z),W(V.w,p.w));case"Matrix":return d.e.FromValues(W(V.m[0],p.m[0]),W(V.m[4],p.m[4]),W(V.m[8],p.m[8]),W(V.m[12],p.m[12]),W(V.m[1],p.m[1]),W(V.m[5],p.m[5]),W(V.m[9],p.m[9]),W(V.m[13],p.m[13]),W(V.m[2],p.m[2]),W(V.m[6],p.m[6]),W(V.m[10],p.m[10]),W(V.m[14],p.m[14]),W(V.m[3],p.m[3]),W(V.m[7],p.m[7]),W(V.m[11],p.m[11]),W(V.m[15],p.m[15]));default:return W(V,p)}}jN.ClassName="FGNegBlock",(0,e.d)(jN.ClassName,jN);class uN extends YW{constructor(V){super(np,np,np,((V,p)=>this._polymorphicRemainder(V,p)),uN.ClassName,V)}_polymorphicRemainder(V,p){return kN(V,p,((V,p)=>V%p))}}uN.ClassName="FGRemainderBlock",(0,e.d)(uN.ClassName,uN);class fN extends YW{constructor(V){super(np,np,np,((V,p)=>this._polymorphicMin(V,p)),fN.ClassName,V)}_polymorphicMin(V,p){return kN(V,p,Math.min)}}fN.ClassName="FGMinBlock",(0,e.d)(fN.ClassName,fN);class ON extends YW{constructor(V){super(np,np,np,((V,p)=>this._polymorphicMax(V,p)),ON.ClassName,V)}_polymorphicMax(V,p){return kN(V,p,Math.max)}}function UN(V,p,W){return Math.min(Math.max(V,Math.min(p,W)),Math.max(p,W))}function FN(V,p,W,N){switch(gW(V)){case"FlowGraphInteger":return new ap(N(V.value,p.value,W.value));case"Vector2":return new d.k(N(V.x,p.x,W.x),N(V.y,p.y,W.y));case"fb":return new d.n(N(V.x,p.x,W.x),N(V.y,p.y,W.y),N(V.z,p.z,W.z));case"Vector4":return new d.q(N(V.x,p.x,W.x),N(V.y,p.y,W.y),N(V.z,p.z,W.z),N(V.w,p.w,W.w));case"Matrix":return d.e.FromValues(N(V.m[0],p.m[0],W.m[0]),N(V.m[4],p.m[4],W.m[4]),N(V.m[8],p.m[8],W.m[8]),N(V.m[12],p.m[12],W.m[12]),N(V.m[1],p.m[1],W.m[1]),N(V.m[5],p.m[5],W.m[5]),N(V.m[9],p.m[9],W.m[9]),N(V.m[13],p.m[13],W.m[13]),N(V.m[2],p.m[2],W.m[2]),N(V.m[6],p.m[6],W.m[6]),N(V.m[10],p.m[10],W.m[10]),N(V.m[14],p.m[14],W.m[14]),N(V.m[3],p.m[3],W.m[3]),N(V.m[7],p.m[7],W.m[7]),N(V.m[11],p.m[11],W.m[11]),N(V.m[15],p.m[15],W.m[15]));default:return N(V,p,W)}}ON.ClassName="FGMaxBlock",(0,e.d)(ON.ClassName,ON);class CN extends qW{constructor(V){super(np,np,np,np,((V,p,W)=>this._polymorphicClamp(V,p,W)),CN.ClassName,V)}_polymorphicClamp(V,p,W){return FN(V,p,W,UN)}}function AN(V){return Math.min(Math.max(V,0),1)}CN.ClassName="FGClampBlock",(0,e.d)(CN.ClassName,CN);class vN extends cW{constructor(V){super(np,np,(V=>this._polymorphicSaturate(V)),vN.ClassName,V)}_polymorphicSaturate(V){return EN(V,AN)}}vN.ClassName="FGSaturateBlock",(0,e.d)(vN.ClassName,vN);class tN extends qW{constructor(V){super(np,np,np,np,((V,p,W)=>this._polymorphicInterpolate(V,p,W)),tN.ClassName,V)}_interpolate(V,p,W){return(1-W)*V+W*p}_polymorphicInterpolate(V,p,W){return FN(V,p,W,this._interpolate)}}tN.ClassName="FGInterpolateBlock",(0,e.d)(tN.ClassName,tN);class eN extends YW{constructor(V){super(np,np,VW,((V,p)=>this._polymorphicEq(V,p)),eN.ClassName,V)}_polymorphicEq(V,p){const W=gW(V),N=gW(p);return DW(W,N)||HW(W,N)||mW(W,N)?V.equals(p):V===p}}function ZN(V,p,W){const N=gW(V);if(N===gW(p)){if(""===N)return W(V,p);if("FlowGraphInteger"===N)return W(V.value,p.value);throw new Error(`Cannot compare ${V} and ${p}`)}throw new Error(`${V} and ${p} are of different types.`)}eN.ClassName="FGEqBlock",(0,e.d)(eN.ClassName,eN);class oN extends YW{constructor(V){super(np,np,VW,((V,p)=>this._polymorphicLessThan(V,p)),oN.ClassName,V)}_polymorphicLessThan(V,p){return ZN(V,p,((V,p)=>V<p))}}oN.ClassName="FGLessThanBlock",(0,e.d)(oN.ClassName,oN);class KN extends YW{constructor(V){super(np,np,VW,((V,p)=>this._polymorphicLessThanOrEqual(V,p)),KN.ClassName,V)}_polymorphicLessThanOrEqual(V,p){return ZN(V,p,((V,p)=>V<=p))}}KN.ClassName="FGLessThanOrEqualBlock";class hN extends YW{constructor(V){super(np,np,VW,((V,p)=>this._polymorphicGreaterThan(V,p)),hN.ClassName,V)}_polymorphicGreaterThan(V,p){return ZN(V,p,((V,p)=>V>p))}}hN.ClassName="FGGreaterThanBlock",(0,e.d)(hN.ClassName,hN);class LN extends YW{constructor(V){super(np,np,VW,((V,p)=>this._polymorphicGreaterThanOrEqual(V,p)),LN.ClassName,V)}_polymorphicGreaterThanOrEqual(V,p){return ZN(V,p,((V,p)=>V>=p))}}LN.ClassName="FGGreaterThanOrEqualBlock",(0,e.d)(LN.ClassName,LN);class xN extends cW{constructor(V){super(np,VW,(V=>this._polymorphicIsNan(V)),xN.ClassName,V)}_polymorphicIsNan(V){const p=gW(V);if(""===p)return isNaN(V);if("FlowGraphInteger"===p)return isNaN(V.value);throw new Error(`Cannot get NaN of ${V}`)}}xN.ClassName="FGIsNanBlock",(0,e.d)(xN.ClassName,xN);class TN extends cW{constructor(V){super(np,VW,(V=>this._polymorphicIsInf(V)),TN.ClassName,V)}_polymorphicIsInf(V){const p=gW(V);if(""===p)return!isFinite(V);if("FlowGraphInteger"===p)return!isFinite(V.value);throw new Error(`Cannot get isInf of ${V}`)}}TN.ClassName="FGIsInfBlock";class PN extends cW{constructor(V){super(np,np,(V=>this._polymorphicDegToRad(V)),PN.ClassName,V)}_degToRad(V){return V*Math.PI/180}_polymorphicDegToRad(V){return EN(V,this._degToRad)}}PN.ClassName="FGDegToRadBlock",(0,e.d)(PN.ClassName,PN);class bN extends cW{constructor(V){super(np,np,(V=>this._polymorphicRadToDeg(V)),bN.ClassName,V)}_radToDeg(V){return 180*V/Math.PI}_polymorphicRadToDeg(V){return EN(V,this._radToDeg)}}bN.ClassName="FGRadToDegBlock",(0,e.d)(bN.ClassName,bN);class sN extends cW{constructor(V){super(np,np,(V=>this._polymorphicSin(V)),sN.ClassName,V)}_polymorphicSin(V){return EN(V,Math.sin)}}sN.ClassName="FGSinBlock",(0,e.d)(sN.ClassName,sN);class GN extends cW{constructor(V){super(np,np,(V=>this._polymorphicCos(V)),GN.ClassName,V)}_polymorphicCos(V){return EN(V,Math.cos)}}GN.ClassName="FGCosBlock",(0,e.d)(GN.ClassName,GN);class RN extends cW{constructor(V){super(np,np,(V=>this._polymorphicTan(V)),RN.ClassName,V)}_polymorphicTan(V){return EN(V,Math.tan)}}RN.ClassName="FGTanBlock",(0,e.d)(RN.ClassName,RN);class XN extends cW{constructor(V){super(np,np,(V=>this._polymorphicAsin(V)),XN.ClassName,V)}_polymorphicAsin(V){return EN(V,Math.asin)}}XN.ClassName="FGAsinBlock",(0,e.d)(XN.ClassName,XN);class rN extends cW{constructor(V){super(np,np,(V=>this._polymorphicAcos(V)),rN.ClassName,V)}_polymorphicAcos(V){return EN(V,Math.acos)}}rN.ClassName="FGAcosBlock",(0,e.d)(rN.ClassName,rN);class BN extends cW{constructor(V){super(np,np,(V=>this._polymorphicAtan(V)),BN.ClassName,V)}_polymorphicAtan(V){return EN(V,Math.atan)}}BN.ClassName="FGAtanBlock",(0,e.d)(BN.ClassName,BN);class YN extends YW{constructor(V){super(np,np,np,((V,p)=>this._polymorphicAtan2(V,p)),YN.ClassName,V)}_polymorphicAtan2(V,p){return kN(V,p,Math.atan2)}}YN.ClassName="FGAtan2Block",(0,e.d)(YN.ClassName,YN);class IN extends cW{constructor(V){super(np,np,(V=>this._polymorphicSinh(V)),IN.ClassName,V)}_polymorphicSinh(V){return EN(V,Math.sinh)}}IN.ClassName="FGSinhBlock",(0,e.d)(IN.ClassName,IN);class cN extends cW{constructor(V){super(np,np,(V=>this._polymorphicCosh(V)),cN.ClassName,V)}_polymorphicCosh(V){return EN(V,Math.cosh)}}cN.ClassName="FGCoshBlock",(0,e.d)(cN.ClassName,cN);class qN extends cW{constructor(V){super(np,np,(V=>this._polymorphicTanh(V)),qN.ClassName,V)}_polymorphicTanh(V){return EN(V,Math.tanh)}}qN.ClassName="FGTanhBlock",(0,e.d)(qN.ClassName,qN);class gN extends cW{constructor(V){super(np,wp,(V=>this._polymorphicAsinh(V)),gN.ClassName,V)}_polymorphicAsinh(V){return EN(V,Math.asinh)}}gN.ClassName="FGAsinhBlock",(0,e.d)(gN.ClassName,gN);class DN extends cW{constructor(V){super(np,wp,(V=>this._polymorphicAcosh(V)),DN.ClassName,V)}_polymorphicAcosh(V){return EN(V,Math.acosh)}}DN.ClassName="FGAcoshBlock",(0,e.d)(DN.ClassName,DN);class HN extends cW{constructor(V){super(np,wp,(V=>this._polymorphicAtanh(V)),HN.ClassName,V)}_polymorphicAtanh(V){return EN(V,Math.atanh)}}HN.ClassName="FGAtanhBlock",(0,e.d)(HN.ClassName,HN);class mN extends cW{constructor(V){super(np,wp,(V=>this._polymorphicExp(V)),mN.ClassName,V)}_polymorphicExp(V){return EN(V,Math.exp)}}mN.ClassName="FGExpBlock",(0,e.d)(mN.ClassName,mN);class MN extends cW{constructor(V){super(np,wp,(V=>this._polymorphicLog(V)),MN.ClassName,V)}_polymorphicLog(V){return EN(V,Math.log)}}MN.ClassName="FGLogBlock",(0,e.d)(MN.ClassName,MN);class aN extends cW{constructor(V){super(np,wp,(V=>this._polymorphicLog2(V)),aN.ClassName,V)}_polymorphicLog2(V){return EN(V,Math.log2)}}aN.ClassName="FGLog2Block",(0,e.d)(aN.ClassName,aN);class yN extends cW{constructor(V){super(np,wp,(V=>this._polymorphicLog10(V)),yN.ClassName,V)}_polymorphicLog10(V){return EN(V,Math.log10)}}yN.ClassName="FGLog10Block",(0,e.d)(yN.ClassName,yN);class nN extends cW{constructor(V){super(np,wp,(V=>this._polymorphicSqrt(V)),nN.ClassName,V)}_polymorphicSqrt(V){return EN(V,Math.sqrt)}}nN.ClassName="FGSqrtBlock",(0,e.d)(nN.ClassName,nN);class wN extends cW{constructor(V){super(np,wp,(V=>this._polymorphicCubeRoot(V)),wN.ClassName,V)}_polymorphicCubeRoot(V){return EN(V,Math.cbrt)}}wN.ClassName="FGCubeRootBlock",(0,e.d)(wN.ClassName,wN);class Vd extends YW{constructor(V){super(np,wp,wp,((V,p)=>this._polymorphicPow(V,p)),Vd.ClassName,V)}_polymorphicPow(V,p){return kN(V,p,Math.pow)}}Vd.ClassName="FGPowBlock",(0,e.d)(Vd.ClassName,Vd);class pd extends cW{constructor(V){super(np,wp,(V=>this._polymorphicLength(V)),pd.ClassName,V)}_polymorphicLength(V){switch(gW(V)){case"Vector2":case"fb":case"Vector4":return V.length();default:throw new Error(`Cannot compute length of value ${V}`)}}}pd.ClassName="FGLengthBlock",(0,e.d)(pd.ClassName,pd);class Wd extends cW{constructor(V){super(np,np,(V=>this._polymorphicNormalize(V)),Wd.ClassName,V)}_polymorphicNormalize(V){switch(gW(V)){case"Vector2":case"fb":case"Vector4":return V.normalize();default:throw new Error(`Cannot normalize value ${V}`)}}}Wd.ClassName="FGNormalizeBlock",(0,e.d)(Wd.ClassName,Wd);class Nd extends YW{constructor(V){super(WW,WW,WW,((V,p)=>d.n.Cross(V,p)),Nd.ClassName,V)}}Nd.ClassName="FGCrossBlock",(0,e.d)(Nd.ClassName,Nd);class dd extends YW{constructor(V){super(pW,wp,pW,((V,p)=>d.k.Transform(V,d.e.RotationZ(p))),dd.ClassName,V)}}dd.ClassName="FGRotate2DBlock",(0,e.d)(dd.ClassName,dd);class Ed extends qW{constructor(V){super(WW,WW,wp,WW,((V,p,W)=>d.n.TransformCoordinates(V,d.e.RotationAxis(p,W))),Ed.ClassName,V)}}Ed.ClassName="FGRotate3DBlock",(0,e.d)(Ed.ClassName,Ed);class zd extends cW{constructor(V){super(NW,NW,(V=>d.e.Transpose(V)),zd.ClassName,V)}}zd.ClassName="FGTransposeBlock",(0,e.d)(zd.ClassName,zd);class Sd extends cW{constructor(V){super(NW,wp,(V=>V.determinant()),Sd.ClassName,V)}}Sd.ClassName="FGDeterminantBlock",(0,e.d)(Sd.ClassName,Sd);class Qd extends cW{constructor(V){super(NW,NW,(V=>d.e.Invert(V)),Qd.ClassName,V)}}Qd.ClassName="FGInvertMatrixBlock",(0,e.d)(Qd.ClassName,Qd);class Jd extends YW{constructor(V){super(NW,NW,NW,((V,p)=>p.multiply(V)),Jd.ClassName,V)}}Jd.ClassName="FGMatMulBlock",(0,e.d)(Jd.ClassName,Jd);class id extends cW{constructor(V){super(dW,dW,(V=>new ap(~V.value)),id.ClassName,V)}}id.ClassName="FGBitwiseNotBlock",(0,e.d)(id.ClassName,id);class ld extends YW{constructor(V){super(dW,dW,dW,((V,p)=>new ap(V.value&p.value)),ld.ClassName,V)}}ld.ClassName="FGBitwiseAndBlock",(0,e.d)(ld.ClassName,ld);class jd extends YW{constructor(V){super(dW,dW,dW,((V,p)=>new ap(V.value|p.value)),jd.ClassName,V)}}jd.ClassName="FGBitwiseOrBlock",(0,e.d)(jd.ClassName,jd);class kd extends YW{constructor(V){super(dW,dW,dW,((V,p)=>new ap(V.value^p.value)),kd.ClassName,V)}}kd.ClassName="FGBitwiseXorBlock",(0,e.d)(kd.ClassName,kd);class ud extends YW{constructor(V){super(dW,dW,dW,((V,p)=>new ap(V.value<<p.value)),ud.ClassName,V)}}ud.ClassName="FGBitwiseLeftShiftBlock",(0,e.d)(ud.ClassName,ud);class fd extends YW{constructor(V){super(dW,dW,dW,((V,p)=>new ap(V.value>>p.value)),fd.ClassName,V)}}fd.ClassName="FGBitwiseRightShiftBlock",(0,e.d)(fd.ClassName,fd);class Od extends cW{constructor(V){super(dW,dW,(V=>new ap(Math.clz32(V.value))),Od.ClassName,V)}}Od.ClassName="FGCountLeadingZerosBlock",(0,e.d)(Od.ClassName,Od);class Ud extends cW{constructor(V){super(dW,dW,(V=>new ap(V.value?31-Math.clz32(V.value&-V.value):32)),Ud.ClassName,V)}}Ud.ClassName="FGCountTrailingZerosBlock",(0,e.d)(Ud.ClassName,Ud);class Fd extends cW{constructor(V){super(dW,dW,(V=>new ap(function(V){let p=0;for(;V;)p+=1&V,V>>=1;return p}(V.value))),Fd.ClassName,V)}}Fd.ClassName="FGCountOneBitsBlock",(0,e.d)(Fd.ClassName,Fd);class Cd extends oW{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new ap(0)};super(V),this.config=V,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",dW),this.value=this.registerDataOutput("value",dW)}_execute(V,p){if(p===this.reset)this.value.setValue(this.config.startIndex,V);else{const p=this.value.getValue(V);p.value<this.n.getValue(V).value&&(this.value.setValue(new ap(p.value+1),V),this.out._activateSignal(V))}}getClassName(){return Cd.ClassName}}Cd.ClassName="FGDoNBlock",(0,e.d)(Cd.ClassName,Cd);class Ad extends iW{constructor(V){super(V),this.config=V,this.output=this.registerDataOutput(V.variableName,np)}_updateOutputs(V){const p=this.config.variableName;V.hasVariable(p)&&this.output.setValue(V.getVariable(p),V)}getClassName(){return Ad.ClassName}serialize(V){super.serialize(V),V.config.variableName=this.config.variableName}}Ad.ClassName="FGGetVariableBlock",(0,e.d)(Ad.ClassName,Ad);class vd extends oW{constructor(V){super(V),this.config=V,this.input=this.registerDataInput(V.variableName,np)}_execute(V){const p=this.config.variableName,W=this.input.getValue(V);V.setVariable(p,W),this.out._activateSignal(V)}getClassName(){return vd.ClassName}}vd.ClassName="FGSetVariableBlock",(0,e.d)(vd.ClassName,vd);class td extends oW{constructor(V){super(V),this.config=V,this.condition=this.registerDataInput("condition",VW),this.loopBody=this._registerSignalOutput("loopBody")}_execute(V,p){var W;let N=this.condition.getValue(V);for(null!==(W=this.config)&&void 0!==W&&W.isDo&&!N&&this.loopBody._activateSignal(V);N;)this.loopBody._activateSignal(V),N=this.condition.getValue(V);this.out._activateSignal(V)}getClassName(){return td.ClassName}serialize(V){var p;super.serialize(V),V.isDo=null===(p=this.config)||void 0===p?void 0:p.isDo}}td.ClassName="FGWhileLoopBlock",(0,e.d)(td.ClassName,td);const ed={"lifecycle/onStart":eW.ClassName,"lifecycle/onTick":ZW.ClassName,log:KW.ClassName,"flow/delay":LW.ClassName,"customEvent/send":xW.ClassName,"customEvent/receive":TW.ClassName,"flow/sequence":PW.ClassName,"world/get":GW.ClassName,"world/set":RW.ClassName,"flow/doN":Cd.ClassName,"variable/get":Ad.ClassName,"variable/set":vd.ClassName,"flow/whileLoop":td.ClassName,"math/random":wW.ClassName,"math/e":pN.ClassName,"math/pi":WN.ClassName,"math/inf":NN.ClassName,"math/nan":dN.ClassName,"math/abs":zN.ClassName,"math/sign":SN.ClassName,"math/trunc":QN.ClassName,"math/floor":JN.ClassName,"math/ceil":iN.ClassName,"math/fract":lN.ClassName,"math/neg":jN.ClassName,"math/add":MW.ClassName,"math/sub":aW.ClassName,"math/mul":yW.ClassName,"math/div":nW.ClassName,"math/rem":uN.ClassName,"math/min":fN.ClassName,"math/max":ON.ClassName,"math/clamp":CN.ClassName,"math/saturate":vN.ClassName,"math/mix":tN.ClassName,"math/eq":eN.ClassName,"math/lt":oN.ClassName,"math/le":KN.ClassName,"math/gt":hN.ClassName,"math/ge":LN.ClassName,"math/isnan":xN.ClassName,"math/isinf":TN.ClassName,"math/rad":PN.ClassName,"math/deg":bN.ClassName,"math/sin":sN.ClassName,"math/cos":GN.ClassName,"math/tan":RN.ClassName,"math/asin":XN.ClassName,"math/acos":rN.ClassName,"math/atan":BN.ClassName,"math/atan2":YN.ClassName,"math/sinh":IN.ClassName,"math/cosh":cN.ClassName,"math/tanh":qN.ClassName,"math/asinh":gN.ClassName,"math/acosh":DN.ClassName,"math/atanh":HN.ClassName,"math/exp":mN.ClassName,"math/log":MN.ClassName,"math/log2":aN.ClassName,"math/log10":yN.ClassName,"math/sqrt":nN.ClassName,"math/cbrt":wN.ClassName,"math/pow":Vd.ClassName,"math/length":pd.ClassName,"math/normalize":Wd.ClassName,"math/dot":VN.ClassName,"math/cross":Nd.ClassName,"math/rotate2d":dd.ClassName,"math/rotate3d":Ed.ClassName,"math/transpose":zd.ClassName,"math/determinant":Sd.ClassName,"math/inverse":Qd.ClassName,"math/matmul":Jd.ClassName,"math/not":id.ClassName,"math/and":ld.ClassName,"math/or":jd.ClassName,"math/xor":kd.ClassName,"math/asr":fd.ClassName,"math/lsl":ud.ClassName,"math/clz":Od.ClassName,"math/ctz":Ud.ClassName,"math/popcnt":Fd.ClassName},Zd={float2:"Vector2",float3:"fb",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function od(V,p,W){if(void 0!==V.type){const N=p.types&&p.types[V.type];if(!N)throw new Error(`${W}: Unknown type: ${V.type}`);const d=N.signature;if(!d)throw new Error(`${W}: Type ${V.type} has no signature`);const E=Zd[d];return{value:V.value,className:E}}return V.value}function Kd(V,p,W){const N=ed[p.type];if(!N)throw new Error(`/extensions/KHR_interactivity/nodes/${V}: Unknown block type: ${p.type}`);const d=V.toString(),E=function(V,p,W){const N={},d=V.configuration??[];for(const E of d)if("customEvent"===E.id){const V=p.customEvents&&p.customEvents[E.value];if(!V)throw new Error(`/extensions/KHR_interactivity/nodes/${W}: Unknown custom event: ${E.value}`);N.eventId=V.id,N.eventData=V.values.map((V=>V.id))}else if("variable"===E.id){const V=p.variables&&p.variables[E.value];if(!V)throw new Error(`/extensions/KHR_interactivity/nodes/${W}: Unknown variable: ${E.value}`);N.variableName=V.id}else if("path"===E.id){const V=E.value;N.path=V}else N[E.id]=od(E,p,`/extensions/KHR_interactivity/nodes/${W}`);return N}(p,W,d);return{className:N,config:E,uniqueId:d,metadata:p.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class hd extends ep{constructor(V){super(V,xd)}}const Ld={__array__:{__target__:!0,translation:{type:"fb",get:V=>V._babylonTransformNode.position,set:(V,p)=>{p._babylonTransformNode.position=V},getObject:V=>V._babylonTransformNode}}},xd={nodes:Ld},Td="KHR_interactivity";class Pd{constructor(V){this._loader=V,this.name=Td,this.enabled=this._loader.isExtensionUsed(Td),this._pathConverter=new hd(this._loader.Di)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var V;if(!this._loader.babylonScene||!this._pathConverter)return;const p=this._loader.babylonScene,W=function(V){const p={uniqueId:(0,mp.b)(),_userVariables:{},_connectionValues:{}},W=[p],N=[];for(let E=0;E<V.nodes.length;E++){const p=Kd(E,V.nodes[E],V);N.push(p)}for(let E=0;E<V.nodes.length;E++){const W=V.nodes[E],d=N[E],z=W.flows??[];for(const V of z){const p=V.id,W={uniqueId:(0,mp.b)(),name:p,_connectionType:1,connectedPointIds:[]};d.signalOutputs.push(W);const z=V.node,S=V.socket,Q=N[z];if(!Q)throw new Error(`/extensions/KHR_interactivity/nodes/${E}: Could not find node with id ${z} that connects its input with with node ${E}'s output ${p}`);let J=Q.signalInputs.find((V=>V.name===S));J||(J={uniqueId:(0,mp.b)(),name:S,_connectionType:0,connectedPointIds:[]},Q.signalInputs.push(J)),J.connectedPointIds.push(W.uniqueId),W.connectedPointIds.push(J.uniqueId)}const S=W.values??[];for(const Q of S){const W=Q.id,z={uniqueId:(0,mp.b)(),name:W,_connectionType:0,connectedPointIds:[]};if(d.dataInputs.push(z),void 0!==Q.value){const W=od(Q,V,`/extensions/KHR_interactivity/nodes/${E}`);p._connectionValues[z.uniqueId]=W}else{if(void 0===Q.node||void 0===Q.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${E}: Invalid socket ${W} in node ${E}`);{const V=Q.node,p=Q.socket,d=N[V];if(!d)throw new Error(`/extensions/KHR_interactivity/nodes/${E}: Could not find node with id ${V} that connects its output with node${E}'s input ${W}`);let S=d.dataOutputs.find((V=>V.name===p));S||(S={uniqueId:(0,mp.b)(),name:p,_connectionType:1,connectedPointIds:[]},d.dataOutputs.push(S)),z.connectedPointIds.push(S.uniqueId),S.connectedPointIds.push(z.uniqueId)}}}}const d=V.variables??[];for(let E=0;E<d.length;E++){const W=d[E],N=W.id;p._userVariables[N]=od(W,V,`/extensions/KHR_interactivity/variables/${E}`)}return{allBlocks:N,executionContexts:W}}(null===(V=this._loader.Di.extensions)||void 0===V?void 0:V.KHR_interactivity),N=new tW({Bc:p});vW.Parse(W,{coordinator:N,pathConverter:this._pathConverter}),N.start()}}m(Td),H(Td,!0,(V=>new Pd(V)));const bd="KHR_node_visibility";class sd{constructor(V){this.name=bd,this._loader=V,this.enabled=V.isExtensionUsed(bd)}async onReady(){var V;null===(V=this._loader.Di.nodes)||void 0===V||V.forEach((V=>{var p,W,N,d;(null===(p=V._primitiveBabylonMeshes)||void 0===p||p.forEach((V=>{V.inheritVisibility=!0})),null!==(W=V.extensions)&&void 0!==W&&W.KHR_node_visibility)&&(!1===(null===(N=V.extensions)||void 0===N?void 0:N.KHR_node_visibility.visible)&&(V._babylonTransformNode&&(V._babylonTransformNode.isVisible=!1),null===(d=V._primitiveBabylonMeshes)||void 0===d||d.forEach((V=>{V.isVisible=!1}))))}))}dispose(){this._loader=null}}m(bd),H(bd,!0,(V=>new sd(V)));const Gd="ExtrasAsMetadata";class Rd{_assignExtras(V,p){if(p.extras&&Object.keys(p.extras).length>0){const W=V.metadata=V.metadata||{};(W.Di=W.Di||{}).extras=p.extras}}constructor(V){this.name=Gd,this.enabled=!0,this._loader=V}dispose(){this._loader=null}loadNodeAsync(V,p,W){return this._loader.loadNodeAsync(V,p,(V=>{this._assignExtras(V,p),W(V)}))}loadCameraAsync(V,p,W){return this._loader.loadCameraAsync(V,p,(V=>{this._assignExtras(V,p),W(V)}))}createMaterial(V,p,W){const N=this._loader.createMaterial(V,p,W);return this._assignExtras(N,p),N}}m(Gd),H(Gd,!1,(V=>new Rd(V)))},12528:(V,p,W)=>{"use strict";W.d(p,{d:()=>T,g:()=>Z,k:()=>e,n:()=>o});var N=W(10856),d=W(10848),E=W(11639),z=W(11510),S=W(11571),Q=W(11565),J=W(10870),i=W(10900),l=W(12535),j=W(12542),k=W(11524);class u{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.fj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Qj=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(V){this._environmentTexture=V}getNodes(){let V=[];return V=V.concat(this.meshes),V=V.concat(this.lights),V=V.concat(this.cameras),V=V.concat(this.transformNodes),this.skeletons.forEach((p=>V=V.concat(p.bones))),V}}class f extends u{}class O{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((V=>{V.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((V=>{V.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((V=>{V.dispose()})),this.animationGroups.length=0}}class U extends u{constructor(V){super(),this._wasAddedToScene=!1,(V=V||i.d.LastCreatedScene)&&(this.Bc=V,this.proceduralTextures=[],V.$i.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=V.getEngine().onContextRestoredObservable.add((()=>{for(const V of this.geometries)V._rebuild();for(const V of this.meshes)V._rebuild();for(const V of this.fj)V.rebuild();for(const V of this.textures)V._rebuild()})))}_topologicalSort(V){const p=new Map;for(const z of V)p.set(z.uniqueId,z);const W={dependsOn:new Map,dependedBy:new Map};for(const z of V){const V=z.uniqueId;W.dependsOn.set(V,new Set),W.dependedBy.set(V,new Set)}for(const z of V){const V=z.uniqueId,N=W.dependsOn.get(V);if(z instanceof l.b){const d=z.sourceMesh;p.has(d.uniqueId)&&(N.add(d.uniqueId),W.dependedBy.get(d.uniqueId).add(V))}const d=W.dependedBy.get(V);for(const E of z.getDescendants()){const N=E.uniqueId;if(p.has(N)){d.add(N);W.dependsOn.get(N).add(V)}}}const N=[],d=[];for(const z of V){const V=z.uniqueId;0===W.dependsOn.get(V).size&&(d.push(z),p.delete(V))}const E=d;for(;E.length>0;){const V=E.shift();N.push(V);const d=W.dependedBy.get(V.uniqueId);for(const N of Array.from(d.values())){const d=W.dependsOn.get(N);d.delete(V.uniqueId),0===d.size&&p.get(N)&&(E.push(p.get(N)),p.delete(N))}}return p.size>0&&(J.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),p.forEach((V=>J.e.Error(V.name)))),N}_addNodeAndDescendantsToList(V,p,W,N){if(W&&(!N||N(W))&&!p.has(W.uniqueId)){V.push(W),p.add(W.uniqueId);for(const d of W.getDescendants(!0))this._addNodeAndDescendantsToList(V,p,d,N)}}_isNodeInContainer(V){return V instanceof Q.d&&-1!==this.meshes.indexOf(V)||(V instanceof S.b&&-1!==this.transformNodes.indexOf(V)||(V instanceof j.e&&-1!==this.lights.indexOf(V)||V instanceof k.d&&-1!==this.cameras.indexOf(V)))}_isValidHierarchy(){for(const V of this.meshes)if(V.parent&&!this._isNodeInContainer(V.parent))return J.e.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.transformNodes)if(V.parent&&!this._isNodeInContainer(V.parent))return J.e.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.lights)if(V.parent&&!this._isNodeInContainer(V.parent))return J.e.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.cameras)if(V.parent&&!this._isNodeInContainer(V.parent))return J.e.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(V){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||d.e.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const N={},E={},S=new O,Q=[],J=[],i={doNotInstantiate:!0,...W},l=[],j=new Set;for(const d of this.transformNodes)null===d.parent&&this._addNodeAndDescendantsToList(l,j,d,i.predicate);for(const d of this.meshes)null===d.parent&&this._addNodeAndDescendantsToList(l,j,d,i.predicate);const k=this._topologicalSort(l),u=(W,d)=>{if(((p,W)=>{if(N[p.uniqueId]=W.uniqueId,E[W.uniqueId]=W,V&&(W.name=V(p.name)),W instanceof z.e){const V=W;if(V.morphTargetManager){const W=p.morphTargetManager;V.morphTargetManager=W.clone();for(let p=0;p<W.numTargets;p++){const d=W.getTarget(p),z=V.morphTargetManager.getTarget(p);N[d.uniqueId]=z.uniqueId,E[z.uniqueId]=z}}}})(W,d),W.parent){const V=N[W.parent.uniqueId],p=E[V];d.parent=p||W.parent}if(d.position&&W.position&&d.position.p(W.position),d.rotationQuaternion&&W.rotationQuaternion&&d.rotationQuaternion.p(W.rotationQuaternion),d.rotation&&W.rotation&&d.rotation.p(W.rotation),d.ie&&W.ie&&d.ie.p(W.ie),d.material){const z=d;if(z.material)if(p){const p=W.material;if(-1===J.indexOf(p)){let W=p.clone(V?V(p.name):"Clone of "+p.name);if(J.push(p),N[p.uniqueId]=W.uniqueId,E[W.uniqueId]=W,"MultiMaterial"===p.getClassName()){const d=p;for(const p of d.eg)p&&(W=p.clone(V?V(p.name):"Clone of "+p.name),J.push(p),N[p.uniqueId]=W.uniqueId,E[W.uniqueId]=W);d.eg=d.eg.map((V=>V&&E[N[V.uniqueId]]))}}"InstancedMesh"!==z.getClassName()&&(z.material=E[N[p.uniqueId]])}else"MultiMaterial"===z.material.getClassName()?-1===this.Bc.multiMaterials.indexOf(z.material)&&this.Bc.addMultiMaterial(z.material):-1===this.Bc.materials.indexOf(z.material)&&this.Bc.addMaterial(z.material)}null===d.parent&&S.rootNodes.push(d)};return k.forEach((V=>{if("InstancedMesh"===V.getClassName()){const p=V,W=p.sourceMesh,d=N[W.uniqueId],z=("number"===typeof d?E[d]:W).createInstance(p.name);u(p,z)}else{let p=!0;"tb"===V.getClassName()||"Node"===V.getClassName()||V.skeleton||!V.getTotalVertices||0===V.getTotalVertices()?p=!1:i.doNotInstantiate&&(p="function"===typeof i.doNotInstantiate?!i.doNotInstantiate(V):!i.doNotInstantiate);const W=p?V.createInstance(`instance of ${V.name}`):V.clone(`Clone of ${V.name}`,null,!0);if(!W)throw new Error(`Could not clone or instantiate node on Asset Container ${V.name}`);u(V,W)}})),this.skeletons.forEach((p=>{if(i.predicate&&!i.predicate(p))return;const W=p.clone(V?V(p.name):"Clone of "+p.name);for(const V of this.meshes)if(V.skeleton===p&&!V.isAnInstance){const p=E[N[V.uniqueId]];if(!p||p.isAnInstance)continue;if(p.skeleton=W,-1!==Q.indexOf(W))continue;Q.push(W);for(const V of W.bones)V._linkedTransformNode&&(V._linkedTransformNode=E[N[V._linkedTransformNode.uniqueId]])}S.skeletons.push(W)})),this.animationGroups.forEach((p=>{if(i.predicate&&!i.predicate(p))return;const W=p.clone(V?V(p.name):"Clone of "+p.name,(V=>E[N[V.uniqueId]]||V));S.animationGroups.push(W)})),S}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||d.e.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Bc.environmentTexture=this.environmentTexture);for(const V of this.Bc._serializableComponents)V.addFromContainer(this);this.Bc.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const p=[];this.cameras.forEach((W=>{V&&!V(W)||(this.Bc.addCamera(W),p.push(W))})),this.lights.forEach((W=>{V&&!V(W)||(this.Bc.addLight(W),p.push(W))})),this.meshes.forEach((W=>{V&&!V(W)||(this.Bc.ai(W),p.push(W))})),this.skeletons.forEach((p=>{V&&!V(p)||this.Bc.addSkeleton(p)})),this.animations.forEach((p=>{V&&!V(p)||this.Bc.addAnimation(p)})),this.animationGroups.forEach((p=>{V&&!V(p)||this.Bc.addAnimationGroup(p)})),this.multiMaterials.forEach((p=>{V&&!V(p)||this.Bc.addMultiMaterial(p)})),this.materials.forEach((p=>{V&&!V(p)||this.Bc.addMaterial(p)})),this.morphTargetManagers.forEach((p=>{V&&!V(p)||this.Bc.addMorphTargetManager(p)})),this.geometries.forEach((p=>{V&&!V(p)||this.Bc.addGeometry(p)})),this.transformNodes.forEach((W=>{V&&!V(W)||(this.Bc.addTransformNode(W),p.push(W))})),this.actionManagers.forEach((p=>{V&&!V(p)||this.Bc.addActionManager(p)})),this.textures.forEach((p=>{V&&!V(p)||this.Bc.addTexture(p)})),this.reflectionProbes.forEach((p=>{V&&!V(p)||this.Bc.addReflectionProbe(p)}));for(const W of p)W.parent&&-1===this.Bc.getNodes().indexOf(W.parent)&&(W.setParent?W.setParent(null):W.parent=null)}removeAllFromScene(){this._isValidHierarchy()||d.e.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Bc.environmentTexture&&(this.Bc.environmentTexture=null);for(const V of this.Bc._serializableComponents)V.removeFromContainer(this)}removeFromScene(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((p=>{V&&!V(p)||this.Bc.removeCamera(p)})),this.lights.forEach((p=>{V&&!V(p)||this.Bc.removeLight(p)})),this.meshes.forEach((p=>{V&&!V(p)||this.Bc.yc(p,!0)})),this.skeletons.forEach((p=>{V&&!V(p)||this.Bc.removeSkeleton(p)})),this.animations.forEach((p=>{V&&!V(p)||this.Bc.removeAnimation(p)})),this.animationGroups.forEach((p=>{V&&!V(p)||this.Bc.removeAnimationGroup(p)})),this.multiMaterials.forEach((p=>{V&&!V(p)||this.Bc.removeMultiMaterial(p)})),this.materials.forEach((p=>{V&&!V(p)||this.Bc.removeMaterial(p)})),this.morphTargetManagers.forEach((p=>{V&&!V(p)||this.Bc.removeMorphTargetManager(p)})),this.geometries.forEach((p=>{V&&!V(p)||this.Bc.removeGeometry(p)})),this.transformNodes.forEach((p=>{V&&!V(p)||this.Bc.removeTransformNode(p)})),this.actionManagers.forEach((p=>{V&&!V(p)||this.Bc.removeActionManager(p)})),this.textures.forEach((p=>{V&&!V(p)||this.Bc.removeTexture(p)})),this.reflectionProbes.forEach((p=>{V&&!V(p)||this.Bc.removeReflectionProbe(p)}))}dispose(){this.cameras.slice(0).forEach((V=>{V.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((V=>{V.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((V=>{V.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((V=>{V.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((V=>{V.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((V=>{V.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((V=>{V.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((V=>{V.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((V=>{V.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((V=>{V.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((V=>{V.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((V=>{V.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((V=>{V.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const V of this.Bc._serializableComponents)V.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Bc.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(V,p,W){if(V&&p)for(const N of V){let V=!0;if(W)for(const p of W)if(N===p){V=!1;break}V&&(p.push(N),N._parentContainer=this)}}moveAllFromScene(V){this._wasAddedToScene=!1,void 0===V&&(V=new f);for(const p in this)Object.prototype.hasOwnProperty.call(this,p)&&(this[p]=this[p]||("_environmentTexture"===p?null:[]),this._moveAssets(this.Bc[p],this[p],V[p]));this.environmentTexture=this.Bc.environmentTexture,this.removeAllFromScene()}createRootMesh(){const V=new z.e("assetContainerRootMesh",this.Bc);return this.meshes.forEach((p=>{p.parent||V.addChild(p)})),this.meshes.unshift(V),V}mergeAnimationsTo(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.d.LastCreatedScene,p=arguments.length>1?arguments[1]:void 0,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!V)return J.e.Error("No scene available to merge animations to"),[];const N=W||(p=>{let W=null;const N=p.animations.length?p.animations[0].targetProperty:"",d=p.name.split(".").join("").split("_primitive")[0];switch(N){case"position":case"rotationQuaternion":W=V.getTransformNodeByName(p.name)||V.getTransformNodeByName(d);break;case"influence":W=V.getMorphTargetByName(p.name)||V.getMorphTargetByName(d);break;default:W=V.getNodeByName(p.name)||V.getNodeByName(d)}return W});this.getNodes().forEach((V=>{const p=N(V);if(null!==p){for(const W of V.animations){const V=p.animations.filter((V=>V.targetProperty===W.targetProperty));for(const W of V){const V=p.animations.indexOf(W,0);V>-1&&p.animations.splice(V,1)}}p.animations=p.animations.concat(V.animations)}}));const d=[];return this.animationGroups.slice().forEach((V=>{d.push(V.clone(V.name,N)),V.animatables.forEach((V=>{V.stop()}))})),p.forEach((p=>{const W=N(p.target);W&&(V.beginAnimation(W,p.fromFrame,p.toFrame,p.loopAnimation,p.speedRatio,p.onAnimationEnd?p.onAnimationEnd:void 0,void 0,!0,void 0,p.onAnimationLoop?p.onAnimationLoop:void 0),V.stopAnimation(p.target))})),d}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((V=>{V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V)})),this.transformNodes.forEach((V=>{V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V)})),this.lights.forEach((V=>{V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V)})),this.cameras.forEach((V=>{V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V)}))}addAllAssetsToContainer(V){if(!V)return;const p=[],W=new Set;for(p.push(V);p.length>0;){const V=p.pop();if(V instanceof z.e?(V.sj&&-1===this.geometries.indexOf(V.sj)&&this.geometries.push(V.sj),this.meshes.push(V)):V instanceof S.b?this.transformNodes.push(V):V instanceof j.e?this.lights.push(V):V instanceof k.d&&this.cameras.push(V),V instanceof Q.d){if(V.material&&-1===this.materials.indexOf(V.material)){this.materials.push(V.material);for(const p of V.material.getActiveTextures())-1===this.textures.indexOf(p)&&this.textures.push(p)}V.skeleton&&-1===this.skeletons.indexOf(V.skeleton)&&this.skeletons.push(V.skeleton),V.morphTargetManager&&-1===this.morphTargetManagers.indexOf(V.morphTargetManager)&&this.morphTargetManagers.push(V.morphTargetManager)}for(const N of V.getChildren())W.has(N)||p.push(N);W.add(V)}this.populateRootNodes()}}var F=W(10914);class C{constructor(V){this.byteOffset=0,this.buffer=V}loadAsync(V){return this.buffer.readAsync(this.byteOffset,V).then((V=>{this._dataView=new DataView(V.buffer,V.byteOffset,V.byteLength),this._dataByteOffset=0}))}readUint32(){const V=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,V}readUint8Array(V){const p=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,V);return this._dataByteOffset+=V,this.byteOffset+=V,p}readString(V){return(0,F.h)(this.readUint8Array(V))}skipBytes(V){this._dataByteOffset+=V,this.byteOffset+=V}}var A=W(12551);const v="Z2xURg",t={name:"Di",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:V=>-1!==V.indexOf("asset")&&-1!==V.indexOf("version")||V.startsWith("data:base64,"+v)||V.startsWith("data:;base64,"+v)||V.startsWith("data:application/octet-stream;base64,"+v)||V.startsWith("data:model/gltf-binary;base64,"+v)};var e,Z,o,K=W(10902),h=W(10911);function L(V,p,W){try{return Promise.resolve(new Uint8Array(V,p,W))}catch(N){return Promise.reject(N)}}!function(V){V[V.AUTO=0]="AUTO",V[V.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(e||(e={})),function(V){V[V.NONE=0]="NONE",V[V.FIRST=1]="FIRST",V[V.ALL=2]="ALL"}(Z||(Z={})),function(V){V[V.LOADING=0]="LOADING",V[V.READY=1]="READY",V[V.COMPLETE=2]="COMPLETE"}(o||(o={}));class x{constructor(){this.coordinateSystemMode=e.AUTO,this.animationStartMode=Z.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=V=>Promise.resolve(V),this.extensionOptions={}}p(V){V&&(this.onParsed=V.onParsed,this.coordinateSystemMode=V.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=V.animationStartMode??this.animationStartMode,this.loadNodeAnimations=V.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=V.loadSkins??this.loadSkins,this.loadMorphTargets=V.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=V.compileMaterials??this.compileMaterials,this.useClipPlane=V.useClipPlane??this.useClipPlane,this.compileShadowGenerators=V.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=V.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=V.useRangeRequests??this.useRangeRequests,this.createInstances=V.createInstances??this.createInstances,this.alwaysComputeBoundingBox=V.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=V.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=V.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=V.skipMaterials??this.skipMaterials,this.useSRGBBuffers=V.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=V.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=V.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=V.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=V.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=V.customRootNode,this.onMeshLoaded=V.onMeshLoaded,this.onSkinLoaded=V.onSkinLoaded,this.onTextureLoaded=V.onTextureLoaded,this.onMaterialLoaded=V.onMaterialLoaded,this.onCameraLoaded=V.onCameraLoaded,this.extensionOptions=V.extensionOptions??this.extensionOptions)}}class T extends x{constructor(V){super(),this.onParsedObservable=new N.b,this.onMeshLoadedObservable=new N.b,this.onSkinLoadedObservable=new N.b,this.onTextureLoadedObservable=new N.b,this.onMaterialLoadedObservable=new N.b,this.onCameraLoadedObservable=new N.b,this.onCompleteObservable=new N.b,this.onErrorObservable=new N.b,this.$i=new N.b,this.onExtensionLoadedObservable=new N.b,this.validate=!1,this.onValidatedObservable=new N.b,this._loader=null,this._state=null,this._requests=new Array,this.name=t.name,this.extensions=t.extensions,this.onLoaderStateChangedObservable=new N.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(V)}set onParsed(V){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),V&&(this._onParsedObserver=this.onParsedObservable.add(V))}set onMeshLoaded(V){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),V&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(V))}set onSkinLoaded(V){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),V&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((p=>V(p.node,p.skinnedNode))))}set onTextureLoaded(V){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),V&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(V))}set onMaterialLoaded(V){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),V&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(V))}set onCameraLoaded(V){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),V&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(V))}set onComplete(V){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(V)}set onError(V){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(V)}set onDispose(V){this._onDisposeObserver&&this.$i.remove(this._onDisposeObserver),this._onDisposeObserver=this.$i.add(V)}set onExtensionLoaded(V){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(V)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(V){this._loggingEnabled!==V&&(this._loggingEnabled=V,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(V){this._capturePerformanceCounters!==V&&(this._capturePerformanceCounters=V,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(V){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(V)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const V of this._requests)V.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=V=>Promise.resolve(V),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.$i.notifyObservers(void 0),this.$i.clear()}loadFile(V,p,W,E,z,S,Q,i){if(ArrayBuffer.isView(p))return this._loadBinary(V,p,W,E,Q,i),null;this._progressCallback=z;const l=p.name||d.e.GetFilename(p);if(S){if(this.useRangeRequests){this.validate&&J.e.Warn("glTF validation is not supported when range requests are enabled");const W={abort:()=>{},onCompleteObservable:new N.b},d={readAsync:(W,N)=>new Promise(((d,E)=>{this._loadFile(V,p,(V=>{d(new Uint8Array(V))}),!0,(V=>{E(V)}),(V=>{V.setRequestHeader("Range",`bytes=${W}-${W+N-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new C(d)).then((V=>{W.onCompleteObservable.notifyObservers(W),E(V)}),Q?V=>Q(void 0,V):void 0),W}return this._loadFile(V,p,(p=>{this._validate(V,new Uint8Array(p,0,p.byteLength),W,l),this._unpackBinaryAsync(new C({readAsync:(V,W)=>L(p,V,W),byteLength:p.byteLength})).then((V=>{E(V)}),Q?V=>Q(void 0,V):void 0)}),!0,Q)}return this._loadFile(V,p,(p=>{try{this._validate(V,p,W,l),E({json:this._parseJson(p)})}catch{Q&&Q()}}),!1,Q)}_loadBinary(V,p,W,N,d,E){this._validate(V,new Uint8Array(p.buffer,p.byteOffset,p.byteLength),W,E),this._unpackBinaryAsync(new C({readAsync:(V,W)=>function(V,p,W){try{if(p<0||p>=V.byteLength)throw new RangeError("Offset is out of range.");if(p+W>V.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(V.buffer,V.byteOffset+p,W))}catch(N){return Promise.reject(N)}}(p,V,W),byteLength:p.byteLength})).then((V=>{N(V)}),d?V=>d(void 0,V):void 0)}importMeshAsync(V,p,W,N,d,E){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(W),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(W),this._loader.importMeshAsync(V,p,null,W,N,d,E))))}loadAsync(V,p,W,N,d){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(p),this.onParsedObservable.clear(),this._log(`Loading ${d||""}`),this._loader=this._getLoader(p),this._loader.loadAsync(V,p,W,N,d))))}loadAssetContainerAsync(V,p,W,N,d){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(p),this.onParsedObservable.clear(),this._log(`Loading ${d||""}`),this._loader=this._getLoader(p);const E=new U(V),z=[];this.onMaterialLoadedObservable.add((V=>{z.push(V)}));const S=[];this.onTextureLoadedObservable.add((V=>{S.push(V)}));const Q=[];this.onCameraLoadedObservable.add((V=>{Q.push(V)}));const J=[];return this.onMeshLoadedObservable.add((V=>{V.morphTargetManager&&J.push(V.morphTargetManager)})),this._loader.importMeshAsync(null,V,E,p,W,N,d).then((V=>(Array.prototype.push.apply(E.geometries,V.geometries),Array.prototype.push.apply(E.meshes,V.meshes),Array.prototype.push.apply(E.fj,V.fj),Array.prototype.push.apply(E.skeletons,V.skeletons),Array.prototype.push.apply(E.animationGroups,V.animationGroups),Array.prototype.push.apply(E.materials,z),Array.prototype.push.apply(E.textures,S),Array.prototype.push.apply(E.lights,V.lights),Array.prototype.push.apply(E.transformNodes,V.transformNodes),Array.prototype.push.apply(E.cameras,Q),Array.prototype.push.apply(E.morphTargetManagers,J),E)))}))}canDirectLoad(V){return t.canDirectLoad(V)}directLoad(V,p){if(p.startsWith("base64,"+v)||p.startsWith(";base64,"+v)||p.startsWith("application/octet-stream;base64,"+v)||p.startsWith("model/gltf-binary;base64,"+v)){const W=(0,K.e)(p);return this._validate(V,new Uint8Array(W,0,W.byteLength)),this._unpackBinaryAsync(new C({readAsync:(V,p)=>L(W,V,p),byteLength:W.byteLength}))}return this._validate(V,p),Promise.resolve({json:this._parseJson(p)})}createPlugin(V){return new T(V[t.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((V,p)=>{this.onCompleteObservable.addOnce((()=>{V()})),this.onErrorObservable.addOnce((V=>{p(V)}))}))}_setState(V){this._state!==V&&(this._state=V,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(o[this._state]))}_loadFile(V,p,W,N,d,E){const z=V._loadFile(p,W,(V=>{this._onProgress(V,z)}),!0,N,d,E);return z.onCompleteObservable.add((()=>{z._lengthComputable=!0,z._total=z._loaded})),this._requests.push(z),z}_onProgress(V,p){if(!this._progressCallback)return;p._lengthComputable=V.lengthComputable,p._loaded=V.loaded,p._total=V.total;let W=!0,N=0,d=0;for(const E of this._requests){if(void 0===E._lengthComputable||void 0===E._loaded||void 0===E._total)return;W=W&&E._lengthComputable,N+=E._loaded,d+=E._total}this._progressCallback({lengthComputable:W,loaded:N,total:W?d:0})}_validate(V,p){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),A.d.ValidateAsync(p,W,N,(p=>this.preprocessUrlAsync(W+p).then((p=>V._loadFileAsync(p,void 0,!0,!0).then((V=>new Uint8Array(V,0,V.byteLength))))))).then((V=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(V),this.onValidatedObservable.clear()}),(V=>{this._endPerformanceCounter("Validate JSON"),d.e.Warn(`Failed to validate: ${V.message}`),this.onValidatedObservable.clear()})))}_getLoader(V){const p=V.json.asset||{};this._log(`Asset version: ${p.version}`),p.minVersion&&this._log(`Asset minimum version: ${p.minVersion}`),p.generator&&this._log(`Asset generator: ${p.generator}`);const W=T._parseVersion(p.version);if(!W)throw new Error("Invalid version: "+p.version);if(void 0!==p.minVersion){const V=T._parseVersion(p.minVersion);if(!V)throw new Error("Invalid minimum version: "+p.minVersion);if(T._compareVersion(V,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+p.minVersion)}const N={1:T._CreateGLTF1Loader,2:T._CreateGLTF2Loader}[W.major];if(!N)throw new Error("Unsupported version: "+p.version);return N(this)}_parseJson(V){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${V.length}`);const p=JSON.parse(V);return this._endPerformanceCounter("Parse JSON"),p}_unpackBinaryAsync(V){return this._startPerformanceCounter("Unpack Binary"),V.loadAsync(20).then((()=>{const p=V.readUint32();if(1179937895!==p)throw new h.i("Unexpected magic: "+p,h.g.GLTFLoaderUnexpectedMagicError);const W=V.readUint32();this.loggingEnabled&&this._log(`Binary version: ${W}`);const N=V.readUint32();let d;switch(this.useRangeRequests||N===V.buffer.byteLength||J.e.Warn(`Length in header does not match actual data length: ${N} != ${V.buffer.byteLength}`),W){case 1:d=this._unpackBinaryV1Async(V,N);break;case 2:d=this._unpackBinaryV2Async(V,N);break;default:throw new Error("Unsupported version: "+W)}return this._endPerformanceCounter("Unpack Binary"),d}))}_unpackBinaryV1Async(V,p){const W=V.readUint32(),N=V.readUint32();if(0!==N)throw new Error(`Unexpected content format: ${N}`);const d=p-V.byteOffset,E={json:this._parseJson(V.readString(W)),bin:null};if(0!==d){const p=V.byteOffset;E.bin={readAsync:(W,N)=>V.buffer.readAsync(p+W,N),byteLength:d}}return Promise.resolve(E)}_unpackBinaryV2Async(V,p){const W=1313821514,N=5130562,d=V.readUint32();if(V.readUint32()!==W)throw new Error("First chunk format is not JSON");return V.byteOffset+d===p?V.loadAsync(d).then((()=>({json:this._parseJson(V.readString(d)),bin:null}))):V.loadAsync(d+8).then((()=>{const E={json:this._parseJson(V.readString(d)),bin:null},z=()=>{const d=V.readUint32();switch(V.readUint32()){case W:throw new Error("Unexpected JSON chunk");case N:{const p=V.byteOffset;E.bin={readAsync:(W,N)=>V.buffer.readAsync(p+W,N),byteLength:d},V.skipBytes(d);break}default:V.skipBytes(d)}return V.byteOffset!==p?V.loadAsync(8).then(z):Promise.resolve(E)};return z()}))}static _parseVersion(V){if("1.0"===V||"1.0.1"===V)return{major:1,minor:0};const p=(V+"").match(/^(\d+)\.(\d+)/);return p?{major:parseInt(p[1]),minor:parseInt(p[2])}:null}static _compareVersion(V,p){return V.major>p.major?1:V.major<p.major?-1:V.minor>p.minor?1:V.minor<p.minor?-1:0}_logOpen(V){this._log(V),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(V){const p=T._logSpaces.substring(0,2*this._logIndentLevel);J.e.Log(`${p}${V}`)}_logDisabled(V){}_startPerformanceCounterEnabled(V){d.e.StartPerformanceCounter(V)}_startPerformanceCounterDisabled(V){}_endPerformanceCounterEnabled(V){d.e.EndPerformanceCounter(V)}_endPerformanceCounterDisabled(V){}}T.IncrementalLoading=!0,T.HomogeneousCoordinates=!1,T._logSpaces="                                ",(0,E.f)(new T)},12551:(V,p,W)=>{"use strict";W.d(p,{d:()=>z});var N=W(10848);function d(V,p,W,N){const d={externalResourceFunction:N};return W&&(d.uri="file:"===p?W:p+W),ArrayBuffer.isView(V)?GLTFValidator.validateBytes(V,d):GLTFValidator.validateString(V,d)}function E(){const V=[];onmessage=p=>{const W=p.data;switch(W.id){case"init":importScripts(W.url);break;case"validate":d(W.data,W.rootUrl,W.fileName,(p=>new Promise(((W,N)=>{const d=V.length;V.push({resolve:W,reject:N}),postMessage({id:"getExternalResource",index:d,uri:p})})))).then((V=>{postMessage({id:"validate.resolve",value:V})}),(V=>{postMessage({id:"validate.reject",reason:V})}));break;case"getExternalResource.resolve":V[W.index].resolve(W.value);break;case"getExternalResource.reject":V[W.index].reject(W.reason)}}}class z{static ValidateAsync(V,p,W,z){return"function"===typeof Worker?new Promise(((S,Q)=>{const J=`${d}(${E})()`,i=URL.createObjectURL(new Blob([J],{type:"application/javascript"})),l=new Worker(i),j=V=>{l.removeEventListener("error",j),l.removeEventListener("message",k),Q(V)},k=V=>{const p=V.data;switch(p.id){case"getExternalResource":z(p.uri).then((V=>{l.postMessage({id:"getExternalResource.resolve",index:p.index,value:V},[V.buffer])}),(V=>{l.postMessage({id:"getExternalResource.reject",index:p.index,reason:V})}));break;case"validate.resolve":l.removeEventListener("error",j),l.removeEventListener("message",k),S(p.value),l.terminate();break;case"validate.reject":l.removeEventListener("error",j),l.removeEventListener("message",k),Q(p.reason),l.terminate()}};if(l.addEventListener("error",j),l.addEventListener("message",k),l.postMessage({id:"init",url:N.e.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(V)){const N=V.slice();l.postMessage({id:"validate",data:N,rootUrl:p,fileName:W},[N.buffer])}else l.postMessage({id:"validate",data:V,rootUrl:p,fileName:W})})):(this._LoadScriptPromise||(this._LoadScriptPromise=N.e.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>d(V,p,W,z))))}}z.Configuration={url:`${N.e._DefaultCdnUrl}/gltf_validator.js`}},12993:(V,p,W)=>{"use strict";W.d(p,{b:()=>e});var N=W(11167),d=W(11175),E=W(11265),z=W(11218),S=W(11442),Q=W(11445),J=W(11291),i=W(11200),l=W(11004),j=W(10952);W(11911),W(11828),W(11843),W(11835),W(11847),W(11856),W(11860);const k="imageProcessingCompatibility",u="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";j.b.IncludesShadersStore[k]=u;const f="skyPixelShader",O="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";j.b.ShadersStore[f]=O;W(11923),W(11868),W(11870),W(11880),W(11874);const U="skyVertexShader",F="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";j.b.ShadersStore[U]=F;var C=W(11479),A=W(11436),v=W(11434);class t extends S.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class e extends Q.b{constructor(V,p){super(V,p),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new z.n(0,100,0),this.useSunPosition=!1,this.cameraOffset=z.n.Zero(),this.up=z.n.Up(),this.dithering=!1,this._cameraPosition=z.n.Zero(),this._skyOrientation=new z.f}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(V,p){const W=p._drawWrapper;if(this.isFrozen&&W.effect&&W._wasPreviouslyReady)return!0;p.materialDefines||(p.materialDefines=new t);const N=p.materialDefines,d=this.va();if(this._isReadyForSubMesh(p))return!0;if((0,v.O)(V,d,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,N),(0,v.E)(V,N,!0,!1),N.IMAGEPROCESSINGPOSTPROCESS!==d.imageProcessingConfiguration.applyByPostProcess&&N.markAsMiscDirty(),N.DITHER!==this.dithering&&N.markAsMiscDirty(),N.isDirty){N.markAsProcessed(),d.resetCachedMaterial();const V=new C.b;N.FOG&&V.addFallback(1,"FOG"),N.IMAGEPROCESSINGPOSTPROCESS=d.imageProcessingConfiguration.applyByPostProcess,N.DITHER=this.dithering;const W=[J.f.PositionKind];N.VERTEXCOLOR&&W.push(J.f.ColorKind);const E="sky",z=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,A.b)(z);const S=N.toString();p.setEffect(d.getEngine().createEffect(E,W,z,[],S,V,this.onCompiled,this.onError),N,this._materialContext)}return!(!p.effect||!p.effect.isReady())&&(N._renderId=d.getRenderId(),W._wasPreviouslyReady=!0,!0)}bindForSubMesh(V,p,W){const N=this.va(),d=W.materialDefines;if(!d)return;const E=W.effect;if(!E)return;this._activeEffect=E,this.bindOnlyWorldMatrix(V),this._activeEffect.setMatrix("viewProjection",N.getTransformMatrix()),this._mustRebind(N,E,W)&&((0,A.e)(E,this,N),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,v.k)(d,E,N)),N.fogEnabled&&p.applyFog&&N.fogMode!==i.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",N.getViewMatrix()),(0,v.g)(N,p,this._activeEffect);const S=N.activeCamera;if(S){const V=S.getWorldMatrix();this._cameraPosition.x=V.m[12],this._cameraPosition.y=V.m[13],this._cameraPosition.z=V.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const V=Math.PI*(this.inclination-.5),p=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(p)*Math.cos(V),this.sunPosition.y=this.distance*Math.sin(-V),this.sunPosition.z=this.distance*Math.sin(p)*Math.cos(V),z.f.FromUnitVectorsToRef(z.n.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(p,this._activeEffect,W)}getAnimatables(){return[]}dispose(V){super.dispose(V)}clone(V){return E.b.Clone((()=>new e(V,this.va())),this)}serialize(){const V=super.serialize();return V.customType="BABYLON.SkyMaterial",V}getClassName(){return"SkyMaterial"}static Parse(V,p,W){return E.b.Parse((()=>new e(V.name,p)),V,p,W)}}(0,N.c)([(0,d.I)()],e.prototype,"luminance",void 0),(0,N.c)([(0,d.I)()],e.prototype,"turbidity",void 0),(0,N.c)([(0,d.I)()],e.prototype,"rayleigh",void 0),(0,N.c)([(0,d.I)()],e.prototype,"mieCoefficient",void 0),(0,N.c)([(0,d.I)()],e.prototype,"mieDirectionalG",void 0),(0,N.c)([(0,d.I)()],e.prototype,"distance",void 0),(0,N.c)([(0,d.I)()],e.prototype,"inclination",void 0),(0,N.c)([(0,d.I)()],e.prototype,"azimuth",void 0),(0,N.c)([(0,d.F)()],e.prototype,"sunPosition",void 0),(0,N.c)([(0,d.I)()],e.prototype,"useSunPosition",void 0),(0,N.c)([(0,d.F)()],e.prototype,"cameraOffset",void 0),(0,N.c)([(0,d.F)()],e.prototype,"up",void 0),(0,N.c)([(0,d.I)()],e.prototype,"dithering",void 0),(0,l.d)("BABYLON.SkyMaterial",e)},10672:(V,p,W)=>{"use strict";function N(V,p){p.headers=V.headers||{},p.statusMessage=V.statusText,p.statusCode=V.status,p.data=V.response}function d(V,p,W){return new Promise((function(d,E){W=W||{};var z,S,Q,J=new XMLHttpRequest,i=W.body,l=W.headers||{};for(z in W.timeout&&(J.timeout=W.timeout),J.ontimeout=J.onerror=function(V){V.timeout="timeout"==V.type,E(V)},J.open(V,p.href||p),J.onload=function(){for(Q=J.getAllResponseHeaders().trim().split(/[\r\n]+/),N(J,J);S=Q.shift();)S=S.split(": "),J.headers[S.shift().toLowerCase()]=S.join(": ");if((S=J.headers["content-type"])&&~S.indexOf("application/json"))try{J.data=JSON.parse(J.data,W.reviver)}catch(V){return N(J,V),E(V)}(J.status>=400?E:d)(J)},typeof FormData<"u"&&i instanceof FormData||i&&"object"==typeof i&&(l["content-type"]="application/json",i=JSON.stringify(i)),J.withCredentials=!!W.withCredentials,l)J.setRequestHeader(z,l[z]);J.send(i)}))}W.r(p),W.d(p,{del:()=>Q,get:()=>E,patch:()=>S,post:()=>z,put:()=>J,send:()=>d});var E=d.bind(d,"GET"),z=d.bind(d,"POST"),S=d.bind(d,"PATCH"),Q=d.bind(d,"DELETE"),J=d.bind(d,"PUT")},13083:(V,p,W)=>{"use strict";W.d(p,{d:()=>l});const N=.5*(Math.sqrt(3)-1),d=(3-Math.sqrt(3))/6,E=1/3,z=1/6,S=(Math.sqrt(5)-1)/4,Q=(5-Math.sqrt(5))/20,J=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),i=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const l=class{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const p="function"==typeof V?V:function(V){let p=0,W=0,N=0,d=1;const E=function(){let V=4022871197;return function(p){p=p.toString();for(let W=0;W<p.length;W++){V+=p.charCodeAt(W);let N=.02519603282416938*V;V=N>>>0,N-=V,N*=V,V=N>>>0,N-=V,V+=4294967296*N}return 2.3283064365386963e-10*(V>>>0)}}();p=E(" "),W=E(" "),N=E(" "),p-=E(V),p<0&&(p+=1);W-=E(V),W<0&&(W+=1);N-=E(V),N<0&&(N+=1);return function(){const V=2091639*p+2.3283064365386963e-10*d;return p=W,W=N,N=V-(d=0|V)}}(V);this.p=function(V){const p=new Uint8Array(256);for(let W=0;W<256;W++)p[W]=W;for(let W=0;W<255;W++){const N=W+~~(V()*(256-W)),d=p[W];p[W]=p[N],p[N]=d}return p}(p),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let W=0;W<512;W++)this.perm[W]=this.p[255&W],this.permMod12[W]=this.perm[W]%12}noise2D(V,p){const W=this.permMod12,E=this.perm;let z=0,S=0,Q=0;const i=(V+p)*N,l=Math.floor(V+i),j=Math.floor(p+i),k=(l+j)*d,u=V-(l-k),f=p-(j-k);let O,U;u>f?(O=1,U=0):(O=0,U=1);const F=u-O+d,C=f-U+d,A=u-1+2*d,v=f-1+2*d,t=255&l,e=255&j;let Z=.5-u*u-f*f;if(Z>=0){const V=3*W[t+E[e]];Z*=Z,z=Z*Z*(J[V]*u+J[V+1]*f)}let o=.5-F*F-C*C;if(o>=0){const V=3*W[t+O+E[e+U]];o*=o,S=o*o*(J[V]*F+J[V+1]*C)}let K=.5-A*A-v*v;if(K>=0){const V=3*W[t+1+E[e+1]];K*=K,Q=K*K*(J[V]*A+J[V+1]*v)}return 70*(z+S+Q)}noise3D(V,p,W){const N=this.permMod12,d=this.perm;let S,Q,i,l;const j=(V+p+W)*E,k=Math.floor(V+j),u=Math.floor(p+j),f=Math.floor(W+j),O=(k+u+f)*z,U=V-(k-O),F=p-(u-O),C=W-(f-O);let A,v,t,e,Z,o;U>=F?F>=C?(A=1,v=0,t=0,e=1,Z=1,o=0):U>=C?(A=1,v=0,t=0,e=1,Z=0,o=1):(A=0,v=0,t=1,e=1,Z=0,o=1):F<C?(A=0,v=0,t=1,e=0,Z=1,o=1):U<C?(A=0,v=1,t=0,e=0,Z=1,o=1):(A=0,v=1,t=0,e=1,Z=1,o=0);const K=U-A+z,h=F-v+z,L=C-t+z,x=U-e+2*z,T=F-Z+2*z,P=C-o+2*z,b=U-1+.5,s=F-1+.5,G=C-1+.5,R=255&k,X=255&u,r=255&f;let B=.6-U*U-F*F-C*C;if(B<0)S=0;else{const V=3*N[R+d[X+d[r]]];B*=B,S=B*B*(J[V]*U+J[V+1]*F+J[V+2]*C)}let Y=.6-K*K-h*h-L*L;if(Y<0)Q=0;else{const V=3*N[R+A+d[X+v+d[r+t]]];Y*=Y,Q=Y*Y*(J[V]*K+J[V+1]*h+J[V+2]*L)}let I=.6-x*x-T*T-P*P;if(I<0)i=0;else{const V=3*N[R+e+d[X+Z+d[r+o]]];I*=I,i=I*I*(J[V]*x+J[V+1]*T+J[V+2]*P)}let c=.6-b*b-s*s-G*G;if(c<0)l=0;else{const V=3*N[R+1+d[X+1+d[r+1]]];c*=c,l=c*c*(J[V]*b+J[V+1]*s+J[V+2]*G)}return 32*(S+Q+i+l)}noise4D(V,p,W,N){const d=this.perm;let E,z,J,l,j;const k=(V+p+W+N)*S,u=Math.floor(V+k),f=Math.floor(p+k),O=Math.floor(W+k),U=Math.floor(N+k),F=(u+f+O+U)*Q,C=V-(u-F),A=p-(f-F),v=W-(O-F),t=N-(U-F);let e=0,Z=0,o=0,K=0;C>A?e++:Z++,C>v?e++:o++,C>t?e++:K++,A>v?Z++:o++,A>t?Z++:K++,v>t?o++:K++;const h=e>=3?1:0,L=Z>=3?1:0,x=o>=3?1:0,T=K>=3?1:0,P=e>=2?1:0,b=Z>=2?1:0,s=o>=2?1:0,G=K>=2?1:0,R=e>=1?1:0,X=Z>=1?1:0,r=o>=1?1:0,B=K>=1?1:0,Y=C-h+Q,I=A-L+Q,c=v-x+Q,q=t-T+Q,g=C-P+2*Q,D=A-b+2*Q,H=v-s+2*Q,m=t-G+2*Q,M=C-R+3*Q,a=A-X+3*Q,y=v-r+3*Q,n=t-B+3*Q,w=C-1+4*Q,VV=A-1+4*Q,pV=v-1+4*Q,WV=t-1+4*Q,NV=255&u,dV=255&f,EV=255&O,zV=255&U;let SV=.6-C*C-A*A-v*v-t*t;if(SV<0)E=0;else{const V=d[NV+d[dV+d[EV+d[zV]]]]%32*4;SV*=SV,E=SV*SV*(i[V]*C+i[V+1]*A+i[V+2]*v+i[V+3]*t)}let QV=.6-Y*Y-I*I-c*c-q*q;if(QV<0)z=0;else{const V=d[NV+h+d[dV+L+d[EV+x+d[zV+T]]]]%32*4;QV*=QV,z=QV*QV*(i[V]*Y+i[V+1]*I+i[V+2]*c+i[V+3]*q)}let JV=.6-g*g-D*D-H*H-m*m;if(JV<0)J=0;else{const V=d[NV+P+d[dV+b+d[EV+s+d[zV+G]]]]%32*4;JV*=JV,J=JV*JV*(i[V]*g+i[V+1]*D+i[V+2]*H+i[V+3]*m)}let iV=.6-M*M-a*a-y*y-n*n;if(iV<0)l=0;else{const V=d[NV+R+d[dV+X+d[EV+r+d[zV+B]]]]%32*4;iV*=iV,l=iV*iV*(i[V]*M+i[V+1]*a+i[V+2]*y+i[V+3]*n)}let lV=.6-w*w-VV*VV-pV*pV-WV*WV;if(lV<0)j=0;else{const V=d[NV+1+d[dV+1+d[EV+1+d[zV+1]]]]%32*4;lV*=lV,j=lV*lV*(i[V]*w+i[V+1]*VV+i[V+2]*pV+i[V+3]*WV)}return 27*(E+z+J+l+j)}}}}]);