"use strict";(self.v2pspxy442l=self.v2pspxy442l||[]).push([[9],{12312:(l,a,N)=>{N.d(a,{d:()=>z,f:()=>q,m:()=>b,j:()=>Q,p:()=>j});class U{constructor(){this.children=[]}isValid(l){return!0}process(l,a,N){let U="";if(this.line){let N=this.line;const J=a.processor;if(J){var c,K,Z,w,S,T;J.lineProcessor&&(N=J.lineProcessor(N,a.isFragment,a.processingContext));const U=(null===(c=a.processor)||void 0===c?void 0:c.attributeKeywordName)??"attribute",n=a.isFragment&&null!==(K=a.processor)&&void 0!==K&&K.varyingFragmentKeywordName?null===(Z=a.processor)||void 0===Z?void 0:Z.varyingFragmentKeywordName:!a.isFragment&&null!==(w=a.processor)&&void 0!==w&&w.varyingVertexKeywordName?null===(S=a.processor)||void 0===S?void 0:S.varyingVertexKeywordName:"varying";if(!a.isFragment&&J.attributeProcessor&&this.line.startsWith(U))N=J.attributeProcessor(this.line,l,a.processingContext);else if(J.varyingProcessor&&(null!==(T=J.varyingCheck)&&void 0!==T&&T.call(J,this.line,a.isFragment)||!J.varyingCheck&&this.line.startsWith(n)))N=J.varyingProcessor(this.line,a.isFragment,l,a.processingContext);else if(J.uniformProcessor&&J.uniformRegexp&&J.uniformRegexp.test(this.line))a.lookForClosingBracketForUniformBuffer||(N=J.uniformProcessor(this.line,a.isFragment,l,a.processingContext));else if(J.uniformBufferProcessor&&J.uniformBufferRegexp&&J.uniformBufferRegexp.test(this.line))a.lookForClosingBracketForUniformBuffer||(N=J.uniformBufferProcessor(this.line,a.isFragment,a.processingContext),a.lookForClosingBracketForUniformBuffer=!0);else if(J.textureProcessor&&J.textureRegexp&&J.textureRegexp.test(this.line))N=J.textureProcessor(this.line,a.isFragment,l,a.processingContext);else if((J.uniformProcessor||J.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!a.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?J.uniformProcessor&&(N=J.uniformProcessor(this.line,a.isFragment,l,a.processingContext)):J.uniformBufferProcessor&&(N=J.uniformBufferProcessor(this.line,a.isFragment,a.processingContext),a.lookForClosingBracketForUniformBuffer=!0)}a.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(a.lookForClosingBracketForUniformBuffer=!1,J.endOfUniformBufferProcessor&&(N=J.endOfUniformBufferProcessor(this.line,a.isFragment,a.processingContext)))}U+=N+"\n"}for(const J of this.children)U+=J.process(l,a,N);return this.additionalDefineKey&&(l[this.additionalDefineKey]=this.additionalDefineValue||"true",N[this.additionalDefineKey]=l[this.additionalDefineKey]),U}}class c{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(l){this._lines.length=0;for(const a of l){if(!a||"\r"===a)continue;if("#"===a[0]){this._lines.push(a);continue}const l=a.trim();if(!l)continue;if(l.startsWith("//")){this._lines.push(a);continue}const N=l.indexOf(";");if(-1===N)this._lines.push(l);else if(N===l.length-1)l.length>1&&this._lines.push(l);else{const l=a.split(";");for(let a=0;a<l.length;a++){let N=l[a];N&&(N=N.trim(),N&&this._lines.push(N+(a!==l.length-1?";":"")))}}}}}class K extends U{process(l,a,N){for(let U=0;U<this.children.length;U++){const c=this.children[U];if(c.isValid(l))return c.process(l,a,N)}return""}}class Z extends U{isValid(l){return this.testExpression.isTrue(l)}}class w{isTrue(l){return!0}static postfixToInfix(l){const a=[];for(const N of l)if(void 0===w._OperatorPriority[N])a.push(N);else{const l=a[a.length-1],U=a[a.length-2];a.length-=2,a.push(`(${U}${N}${l})`)}return a[a.length-1]}static infixToPostfix(l){const a=w._InfixToPostfixCache.get(l);if(a)return a.accessTime=Date.now(),a.result;if(!l.includes("&&")&&!l.includes("||")&&!l.includes(")")&&!l.includes("("))return[l];const N=[];let U=-1;const c=()=>{J=J.trim(),""!==J&&(N.push(J),J="")},K=l=>{U<w._Stack.length-1&&(w._Stack[++U]=l)},Z=()=>w._Stack[U],S=()=>-1===U?"!!INVALID EXPRESSION!!":w._Stack[U--];let T=0,J="";for(;T<l.length;){const a=l.charAt(T),n=T<l.length-1?l.substring(T,2+T):"";if("("===a)J="",K(a);else if(")"===a){for(c();-1!==U&&"("!==Z();)N.push(S());S()}else if(w._OperatorPriority[n]>1){for(c();-1!==U&&w._OperatorPriority[Z()]>=w._OperatorPriority[n];)N.push(S());K(n),T++}else J+=a;T++}for(c();-1!==U;)"("===Z()?S():N.push(S());return w._InfixToPostfixCache.size>=w.InfixToPostfixCacheLimitSize&&w.ClearCache(),w._InfixToPostfixCache.set(l,{result:N,accessTime:Date.now()}),N}static ClearCache(){const l=Array.from(w._InfixToPostfixCache.entries()).sort(((l,a)=>l[1].accessTime-a[1].accessTime));for(let a=0;a<w.InfixToPostfixCacheCleanupSize;a++)w._InfixToPostfixCache.delete(l[a][0])}}w.InfixToPostfixCacheLimitSize=5e4,w.InfixToPostfixCacheCleanupSize=25e3,w._InfixToPostfixCache=new Map,w._OperatorPriority={")":0,"(":1,"||":2,"&&":3},w._Stack=["","","","","","","","","","","","","","","","","","","",""];class S extends w{constructor(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=l,this.not=a}isTrue(l){let a=void 0!==l[this.define];return this.not&&(a=!a),a}}class T extends w{isTrue(l){return this.leftOperand.isTrue(l)||this.rightOperand.isTrue(l)}}class J extends w{isTrue(l){return this.leftOperand.isTrue(l)&&this.rightOperand.isTrue(l)}}class n extends w{constructor(l,a,N){super(),this.define=l,this.operand=a,this.testValue=N}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(l){let a=!1;const N=parseInt(void 0!=l[this.define]?l[this.define]:this.define),U=parseInt(void 0!=l[this.testValue]?l[this.testValue]:this.testValue);if(isNaN(N)||isNaN(U))return!1;switch(this.operand){case">":a=N>U;break;case"<":a=N<U;break;case"<=":a=N<=U;break;case">=":a=N>=U;break;case"==":a=N===U;break;case"!=":a=N!==U}return a}}var y=N(12288),H=N(12319);const u=/defined\s*?\((.+?)\)/g,W=/defined\s*?\[(.+?)\]/g,B=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,Y=/__decl__/,C=/light\{X\}.(\w*)/g,M=/\{X\}/g,A=[],E=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function q(l){l.processor&&l.processor.initializeShaders&&l.processor.initializeShaders(l.processingContext)}function b(l,a,N,U){var c;null!==(c=a.processor)&&void 0!==c&&c.preProcessShaderCode&&(l=a.processor.preProcessShaderCode(l,a.isFragment)),Q(l,a,(l=>{a.processCodeAfterIncludes&&(l=a.processCodeAfterIncludes(a.isFragment?"fragment":"vertex",l,a.defines));const c=function(l,a,N){let U=function(l,a){var N;if(null!==(N=a.processor)&&void 0!==N&&N.noPrecision)return l;const U=a.shouldUseHighPrecisionShader;-1===l.indexOf("precision highp float")?l=U?"precision highp float;\n"+l:"precision mediump float;\n"+l:U||(l=l.replace("precision highp float","precision mediump float"));return l}(l,a);if(!a.processor)return U;if(0===a.processor.shaderLanguage&&-1!==U.indexOf("#version 3")&&(U=U.replace("#version 300 es",""),!a.processor.parseGLES3))return U;const c=a.defines,K=k(a,N);a.processor.preProcessor&&(U=a.processor.preProcessor(U,c,K,a.isFragment,a.processingContext));const Z={};U=i(U,K,a,Z),a.processor.postProcessor&&(U=a.processor.postProcessor(U,c,a.isFragment,a.processingContext,N?{drawBuffersExtensionDisabled:!N.getCaps().drawBuffersExtension}:{},K,Z));null!==N&&void 0!==N&&N._features.needShaderCodeInlining&&(U=N.inlineShaderCode(U));return U}(l,a,U);N(c,l)}))}function z(l,a,N){return N.processor&&N.processor.finalizeShaders?N.processor.finalizeShaders(l,a,N.processingContext):{vertexCode:l,fragmentCode:a}}function I(l){const a=/defined\((.+)\)/.exec(l);if(a&&a.length)return new S(a[1].trim(),"!"===l[0]);const N=["==","!=",">=","<=","<",">"];let U="",c=0;for(U of N)if(c=l.indexOf(U),c>-1)break;if(-1===c)return new S(l);const K=l.substring(0,c).trim(),Z=l.substring(c+U.length).trim();return new n(K,U,Z)}function t(l,a){const N=new Z,U=l.substring(0,a);let c=l.substring(a);return c=c.substring(0,(c.indexOf("//")+1||c.length+1)-1).trim(),N.testExpression="#ifdef"===U?new S(c):"#ifndef"===U?new S(c,!0):function(l){l=l.replace(u,"defined[$1]");const a=w.infixToPostfix(l),N=[];for(const c of a)if("||"!==c&&"&&"!==c)N.push(c);else if(N.length>=2){let l=N[N.length-1],a=N[N.length-2];N.length-=2;const U="&&"==c?new J:new T;"string"===typeof l&&(l=l.replace(W,"defined($1)")),"string"===typeof a&&(a=a.replace(W,"defined($1)")),U.leftOperand="string"===typeof a?I(a):a,U.rightOperand="string"===typeof l?I(l):l,N.push(U)}let U=N[N.length-1];return"string"===typeof U&&(U=U.replace(W,"defined($1)")),"string"===typeof U?I(U):U}(c),N}function O(l,a,N,c){let K=l.currentLine;for(;h(l,N,c);){K=l.currentLine;const Z=K.substring(0,5).toLowerCase();if("#else"===Z){const N=new U;return a.children.push(N),void h(l,N,c)}if("#elif"===Z){const l=t(K,5);a.children.push(l),N=l}}}function h(l,a,N){for(;l.canRead;){l.lineIndex++;const c=l.currentLine;if(c.indexOf("#")>=0){const U=E.exec(c);if(U&&U.length){switch(U[0]){case"#ifdef":{const U=new K;a.children.push(U);const Z=t(c,6);U.children.push(Z),O(l,U,Z,N);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const U=new K;a.children.push(U);const Z=t(c,7);U.children.push(Z),O(l,U,Z,N);break}case"#if":{const U=new K,Z=t(c,3);a.children.push(U),U.children.push(Z),O(l,U,Z,N);break}}continue}}const Z=new U;if(Z.line=c,a.children.push(Z),"#"===c[0]&&"d"===c[1]){const l=c.replace(";","").split(" ");Z.additionalDefineKey=l[1],3===l.length&&(Z.additionalDefineValue=l[2])}}return!1}function i(l,a,N,K){const Z=new U,w=new c;return w.lineIndex=-1,w.lines=l.split("\n"),h(w,Z,K),Z.process(a,N,K)}function k(l,a){var N;const U=l.defines,c={};for(const K of U){const l=K.replace("#define","").replace(";","").trim().split(" ");c[l[0]]=l.length>1?l[1]:""}return 0===(null===(N=l.processor)||void 0===N?void 0:N.shaderLanguage)&&(c.GL_ES="true"),c.__VERSION__=l.version,c[l.platformName]="true",(0,H.g)(c,null===a||void 0===a?void 0:a.isNDCHalfZRange,null===a||void 0===a?void 0:a.Zc,null===a||void 0===a?void 0:a.useExactSrgbConversions),c}function Q(l,a,N){let U;for(A.length=0;null!==(U=B.exec(l));)A.push(U);let c=String(l),K=[l],Z=!1;for(const w of A){let l=w[1];if(-1!==l.indexOf("__decl__")&&(l=l.replace(Y,""),a.supportsUniformBuffers&&(l=l.replace("Vertex","Ubo").replace("Fragment","Ubo")),l+="Declaration"),!a.includesShadersStore[l]){const U=a.shadersRepository+"ShadersInclude/"+l+".fx";return void j.loadFile(U,(U=>{a.includesShadersStore[l]=U,Q(K.join(""),a,N)}))}{let N=a.includesShadersStore[l];if(w[2]){const l=w[3].split(",");for(let a=0;a<l.length;a+=2){const U=new RegExp(l[a],"g"),c=l[a+1];N=N.replace(U,c)}}if(w[4]){const l=w[5];if(-1!==l.indexOf("..")){const U=l.split(".."),c=parseInt(U[0]);let K=parseInt(U[1]),Z=N.slice(0);N="",isNaN(K)&&(K=a.indexParameters[U[1]]);for(let l=c;l<K;l++)a.supportsUniformBuffers||(Z=Z.replace(C,((l,a)=>a+"{X}"))),N+=Z.replace(M,l.toString())+"\n"}else a.supportsUniformBuffers||(N=N.replace(C,((l,a)=>a+"{X}"))),N=N.replace(M,l)}const U=[];for(const l of K){const a=l.split(w[0]);for(let l=0;l<a.length-1;l++)U.push(a[l]),U.push(N);U.push(a[a.length-1])}K=U,Z=Z||N.indexOf("#include<")>=0||N.indexOf("#include <")>=0}}A.length=0,c=K.join(""),Z?Q(c.toString(),a,N):N(c)}const j={loadFile:(l,a,N,U,c,K)=>{throw(0,y.b)("FileTools")}}},12319:(l,a,N)=>{N.d(a,{b:()=>c,f:()=>K,g:()=>w,j:()=>Z,k:()=>S});var U=N(12288);N(12266);const c={};function K(l,a){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(a?a+"\n":"")+l}function Z(l,a,N,K,Z,w,S){const T=S||c.loadFile;if(T){return T(l,a,N,K,Z,w)}throw(0,U.b)("FileTools")}function w(l,a,N,U){if(l)return a?l.IS_NDC_HALF_ZRANGE="":delete l.IS_NDC_HALF_ZRANGE,N?l.USE_REVERSE_DEPTHBUFFER="":delete l.USE_REVERSE_DEPTHBUFFER,void(U?l.USE_EXACT_SRGB_CONVERSIONS="":delete l.USE_EXACT_SRGB_CONVERSIONS);{let l="";return a&&(l+="#define IS_NDC_HALF_ZRANGE"),N&&(l&&(l+="\n"),l+="#define USE_REVERSE_DEPTHBUFFER"),U&&(l&&(l+="\n"),l+="#define USE_EXACT_SRGB_CONVERSIONS"),l}}function S(l,a){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3?arguments[3]:void 0;switch(l){case 3:{const l=(ArrayBuffer,new Int8Array(a));return U&&l.set(new Int8Array(U)),l}case 0:{const l=(ArrayBuffer,new Uint8Array(a));return U&&l.set(new Uint8Array(U)),l}case 4:{const l=a instanceof ArrayBuffer?new Int16Array(a):new Int16Array(N?a/2:a);return U&&l.set(new Int16Array(U)),l}case 5:case 8:case 9:case 10:case 2:{const l=a instanceof ArrayBuffer?new Uint16Array(a):new Uint16Array(N?a/2:a);return U&&l.set(new Uint16Array(U)),l}case 6:{const l=a instanceof ArrayBuffer?new Int32Array(a):new Int32Array(N?a/4:a);return U&&l.set(new Int32Array(U)),l}case 7:case 11:case 12:case 13:case 14:case 15:{const l=a instanceof ArrayBuffer?new Uint32Array(a):new Uint32Array(N?a/4:a);return U&&l.set(new Uint32Array(U)),l}case 1:{const l=a instanceof ArrayBuffer?new Float32Array(a):new Float32Array(N?a/4:a);return U&&l.set(new Float32Array(U)),l}}const c=(ArrayBuffer,new Uint8Array(a));return U&&c.set(new Uint8Array(U)),c}},12350:(l,a,N)=>{N.d(a,{e:()=>U});class U{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?U.ShadersRepository:U.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?U.ShadersStore:U.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?U.IncludesShadersStore:U.IncludesShadersStoreWGSL}}U.ShadersRepository="src/Shaders/",U.ShadersStore={},U.IncludesShadersStore={},U.ShadersRepositoryWGSL="src/ShadersWGSL/",U.ShadersStoreWGSL={},U.IncludesShadersStoreWGSL={}},12361:(l,a,N)=>{N.d(a,{c:()=>y,g:()=>M,h:()=>u,k:()=>H,m:()=>W,q:()=>C,r:()=>n,u:()=>T,v:()=>J,x:()=>S,B:()=>w});class U{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Ha._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(l){l&&this.program&&l(this.program)}setEngine(l){this.Ha=l}_fillEffectInformation(l,a,N,U,c,K,Z,w){const S=this.Ha;if(S.supportsUniformBuffers)for(const J in a)l.bindUniformBlock(J,a[J]);let T;for(this.Ha.getUniforms(this,N).forEach(((l,a)=>{U[N[a]]=l})),this._uniforms=U,T=0;T<c.length;T++){null==l.getUniform(c[T])&&(c.splice(T,1),T--)}c.forEach(((l,a)=>{K[l]=a}));for(const J of S.getAttributes(this,Z))w.push(J)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(l,a){const N=this._valueCache[l],U=a.updateFlag;return(void 0===N||N!==U)&&(this._valueCache[l]=U,!0)}_cacheFloat2(l,a,N){let U=this._valueCache[l];if(!U||2!==U.length)return U=[a,N],this._valueCache[l]=U,!0;let c=!1;return U[0]!==a&&(U[0]=a,c=!0),U[1]!==N&&(U[1]=N,c=!0),c}_cacheFloat3(l,a,N,U){let c=this._valueCache[l];if(!c||3!==c.length)return c=[a,N,U],this._valueCache[l]=c,!0;let K=!1;return c[0]!==a&&(c[0]=a,K=!0),c[1]!==N&&(c[1]=N,K=!0),c[2]!==U&&(c[2]=U,K=!0),K}_cacheFloat4(l,a,N,U,c){let K=this._valueCache[l];if(!K||4!==K.length)return K=[a,N,U,c],this._valueCache[l]=K,!0;let Z=!1;return K[0]!==a&&(K[0]=a,Z=!0),K[1]!==N&&(K[1]=N,Z=!0),K[2]!==U&&(K[2]=U,Z=!0),K[3]!==c&&(K[3]=c,Z=!0),Z}setInt(l,a){const N=this._valueCache[l];void 0!==N&&N===a||this.Ha.setInt(this._uniforms[l],a)&&(this._valueCache[l]=a)}setInt2(l,a,N){this._cacheFloat2(l,a,N)&&(this.Ha.setInt2(this._uniforms[l],a,N)||(this._valueCache[l]=null))}setInt3(l,a,N,U){this._cacheFloat3(l,a,N,U)&&(this.Ha.setInt3(this._uniforms[l],a,N,U)||(this._valueCache[l]=null))}setInt4(l,a,N,U,c){this._cacheFloat4(l,a,N,U,c)&&(this.Ha.setInt4(this._uniforms[l],a,N,U,c)||(this._valueCache[l]=null))}setIntArray(l,a){this._valueCache[l]=null,this.Ha.setIntArray(this._uniforms[l],a)}setIntArray2(l,a){this._valueCache[l]=null,this.Ha.setIntArray2(this._uniforms[l],a)}setIntArray3(l,a){this._valueCache[l]=null,this.Ha.setIntArray3(this._uniforms[l],a)}setIntArray4(l,a){this._valueCache[l]=null,this.Ha.setIntArray4(this._uniforms[l],a)}setUInt(l,a){const N=this._valueCache[l];void 0!==N&&N===a||this.Ha.setUInt(this._uniforms[l],a)&&(this._valueCache[l]=a)}setUInt2(l,a,N){this._cacheFloat2(l,a,N)&&(this.Ha.setUInt2(this._uniforms[l],a,N)||(this._valueCache[l]=null))}setUInt3(l,a,N,U){this._cacheFloat3(l,a,N,U)&&(this.Ha.setUInt3(this._uniforms[l],a,N,U)||(this._valueCache[l]=null))}setUInt4(l,a,N,U,c){this._cacheFloat4(l,a,N,U,c)&&(this.Ha.setUInt4(this._uniforms[l],a,N,U,c)||(this._valueCache[l]=null))}setUIntArray(l,a){this._valueCache[l]=null,this.Ha.setUIntArray(this._uniforms[l],a)}setUIntArray2(l,a){this._valueCache[l]=null,this.Ha.setUIntArray2(this._uniforms[l],a)}setUIntArray3(l,a){this._valueCache[l]=null,this.Ha.setUIntArray3(this._uniforms[l],a)}setUIntArray4(l,a){this._valueCache[l]=null,this.Ha.setUIntArray4(this._uniforms[l],a)}setArray(l,a){this._valueCache[l]=null,this.Ha.setArray(this._uniforms[l],a)}setArray2(l,a){this._valueCache[l]=null,this.Ha.setArray2(this._uniforms[l],a)}setArray3(l,a){this._valueCache[l]=null,this.Ha.setArray3(this._uniforms[l],a)}setArray4(l,a){this._valueCache[l]=null,this.Ha.setArray4(this._uniforms[l],a)}setMatrices(l,a){a&&(this._valueCache[l]=null,this.Ha.setMatrices(this._uniforms[l],a))}setMatrix(l,a){this._cacheMatrix(l,a)&&(this.Ha.setMatrices(this._uniforms[l],a.Bc())||(this._valueCache[l]=null))}setMatrix3x3(l,a){this._valueCache[l]=null,this.Ha.setMatrix3x3(this._uniforms[l],a)}setMatrix2x2(l,a){this._valueCache[l]=null,this.Ha.setMatrix2x2(this._uniforms[l],a)}setFloat(l,a){const N=this._valueCache[l];void 0!==N&&N===a||this.Ha.setFloat(this._uniforms[l],a)&&(this._valueCache[l]=a)}setVector2(l,a){this._cacheFloat2(l,a.x,a.y)&&(this.Ha.setFloat2(this._uniforms[l],a.x,a.y)||(this._valueCache[l]=null))}setFloat2(l,a,N){this._cacheFloat2(l,a,N)&&(this.Ha.setFloat2(this._uniforms[l],a,N)||(this._valueCache[l]=null))}setVector3(l,a){this._cacheFloat3(l,a.x,a.y,a.z)&&(this.Ha.setFloat3(this._uniforms[l],a.x,a.y,a.z)||(this._valueCache[l]=null))}setFloat3(l,a,N,U){this._cacheFloat3(l,a,N,U)&&(this.Ha.setFloat3(this._uniforms[l],a,N,U)||(this._valueCache[l]=null))}setVector4(l,a){this._cacheFloat4(l,a.x,a.y,a.z,a.w)&&(this.Ha.setFloat4(this._uniforms[l],a.x,a.y,a.z,a.w)||(this._valueCache[l]=null))}setQuaternion(l,a){this._cacheFloat4(l,a.x,a.y,a.z,a.w)&&(this.Ha.setFloat4(this._uniforms[l],a.x,a.y,a.z,a.w)||(this._valueCache[l]=null))}setFloat4(l,a,N,U,c){this._cacheFloat4(l,a,N,U,c)&&(this.Ha.setFloat4(this._uniforms[l],a,N,U,c)||(this._valueCache[l]=null))}setColor3(l,a){this._cacheFloat3(l,a.r,a.g,a.b)&&(this.Ha.setFloat3(this._uniforms[l],a.r,a.g,a.b)||(this._valueCache[l]=null))}setColor4(l,a,N){this._cacheFloat4(l,a.r,a.g,a.b,N)&&(this.Ha.setFloat4(this._uniforms[l],a.r,a.g,a.b,N)||(this._valueCache[l]=null))}setDirectColor4(l,a){this._cacheFloat4(l,a.r,a.g,a.b,a.a)&&(this.Ha.setFloat4(this._uniforms[l],a.r,a.g,a.b,a.a)||(this._valueCache[l]=null))}_getVertexShaderCode(){return this.vertexShader?this.Ha._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Ha._getShaderSource(this.fragmentShader):null}}var c=N(12319);const K=new WeakMap,Z={_webGLVersion:2,cachedPipelines:{}};function w(l){let a=K.get(l);if(!a){if(!l)return Z;a={_webGLVersion:l.TEXTURE_BINDING_3D?2:1,_context:l,parallelShaderCompile:l.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},K.set(l,a)}return a}function S(l){K.delete(l)}function T(l,a,N,U,c,K){const Z=w(U);K||(K=Z._createShaderProgramInjection??y);return K(l,Y(a,"vertex",U,Z._contextWasLost),Y(N,"fragment",U,Z._contextWasLost),U,c,Z.validateShaderPrograms)}function J(l,a,N,U,c){let K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6?arguments[6]:void 0;const S=w(c);Z||(Z=S._createShaderProgramInjection??y);const T=S._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return Z(l,B(a,"vertex",U,T,c,S._contextWasLost),B(N,"fragment",U,T,c,S._contextWasLost),c,K,S.validateShaderPrograms)}function n(l,a){const N=new U,c=w(l);return c.parallelShaderCompile&&!c.disableParallelShaderCompile&&(N.isParallelCompiled=!0),N.context=c._context,N}function y(l,a,N,U){let c=arguments.length>5?arguments[5]:void 0;const K=U.createProgram();if(l.program=K,!K)throw new Error("Unable to create program");return U.attachShader(K,a),U.attachShader(K,N),U.linkProgram(K),l.context=U,l.vertexShader=a,l.fragmentShader=N,l.isParallelCompiled||u(l,U,c),K}function H(l,a,N){const U=l;if(U._isDisposed)return!1;const c=w(a);return!!(c&&c.parallelShaderCompile&&c.parallelShaderCompile.COMPLETION_STATUS_KHR&&U.program&&a.getProgramParameter(U.program,c.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(u(U,a,N),!0)}function u(l,a,N){const U=l.context,c=l.vertexShader,K=l.fragmentShader,Z=l.program;if(!U.getProgramParameter(Z,U.LINK_STATUS)){if(!a.getShaderParameter(c,a.COMPILE_STATUS)){const N=a.getShaderInfoLog(c);if(N)throw l.vertexCompilationError=N,new Error("VERTEX SHADER "+N)}if(!a.getShaderParameter(K,a.COMPILE_STATUS)){const N=a.getShaderInfoLog(K);if(N)throw l.fragmentCompilationError=N,new Error("FRAGMENT SHADER "+N)}const N=U.getProgramInfoLog(Z);if(N)throw l.programLinkError=N,new Error(N)}if(N){U.validateProgram(Z);if(!U.getProgramParameter(Z,U.VALIDATE_STATUS)){const a=U.getProgramInfoLog(Z);if(a)throw l.programValidationError=a,new Error(a)}}U.deleteShader(c),U.deleteShader(K),l.vertexShader=void 0,l.fragmentShader=void 0,l.onCompiled&&(l.onCompiled(),l.onCompiled=void 0)}function W(l,a,N,U,c,K,Z,S,n){let y=arguments.length>10?arguments[10]:void 0,H=arguments.length>11?arguments[11]:void 0,u=arguments.length>12?arguments[12]:void 0;const W=w(l.context);H||(H=W.createRawShaderProgramInjection??T),u||(u=W.createShaderProgramInjection??J);const B=l;B.program=U?H(B,a,N,B.context,n):u(B,a,N,S,B.context,n),B.program.__SPECTOR_rebuildProgram=Z,y()}function B(l,a,N,U,K,Z){return Y((0,c.f)(l,N,U),a,K,Z)}function Y(l,a,N,U){const c=N.createShader("vertex"===a?N.VERTEX_SHADER:N.FRAGMENT_SHADER);if(!c){let l=N.NO_ERROR,c=N.NO_ERROR;for(;(c=N.getError())!==N.NO_ERROR;)l=c;throw new Error(`Something went wrong while creating a gl ${a} shader object. gl error=${l}, gl isContextLost=${N.isContextLost()}, _contextWasLost=${U}`)}return N.shaderSource(c,l),N.compileShader(c),c}function C(l,a){a.useProgram(l)}function M(l,a){const N=l;if(!N.isParallelCompiled)return void a(l);const U=N.onCompiled;N.onCompiled=()=>{null===U||void 0===U||U(),a(l)}}},12359:(l,a,N)=>{N.d(a,{b:()=>n,c:()=>H,e:()=>T,f:()=>J});var U=N(12266),c=N(12361),K=N(12350),Z=N(12268),w=N(12312),S=N(12319);function T(l,a){return(0,c.B)(a).cachedPipelines[l]}function J(l){const a=l._name,N=l.context;if(a&&N){const l=(0,c.B)(N),U=l.cachedPipelines[a];null===U||void 0===U||U.dispose(),delete l.cachedPipelines[a]}}function n(l,a,N,c,K,Z,S){let T,J;const n=(0,U.o)()?null===Z||void 0===Z?void 0:Z.getHostDocument():null;T="string"===typeof a?a:a.vertexSource?"source:"+a.vertexSource:a.vertexElement?(null===n||void 0===n?void 0:n.getElementById(a.vertexElement))||a.vertexElement:a.vertex||a,J="string"===typeof a?a:a.fragmentSource?"source:"+a.fragmentSource:a.fragmentElement?(null===n||void 0===n?void 0:n.getElementById(a.fragmentElement))||a.fragmentElement:a.fragment||a;const H=[void 0,void 0],u=()=>{if(H[0]&&H[1]){l.isFragment=!0;const[U,T]=H;(0,w.m)(T,l,((Z,T)=>{S&&(S._fragmentSourceCodeBeforeMigration=T),N&&(Z=N("fragment",Z));const J=(0,w.d)(U,Z,l);l=null;const n=function(l,a,N,U){if(N){return{vertexSourceCode:(1===U?"//":"")+"#define SHADER_NAME vertex:"+(N.vertexElement||N.vertex||N.spectorName||N)+"\n"+l,fragmentSourceCode:(1===U?"//":"")+"#define SHADER_NAME fragment:"+(N.fragmentElement||N.fragment||N.spectorName||N)+"\n"+a}}return{vertexSourceCode:l,fragmentSourceCode:a}}(J.vertexCode,J.fragmentCode,a,K);null===c||void 0===c||c(n.vertexSourceCode,n.fragmentSourceCode)}),Z)}};y(T,"Vertex","",(a=>{(0,w.f)(l),(0,w.m)(a,l,((l,U)=>{S&&(S._rawVertexSourceCode=a,S._vertexSourceCodeBeforeMigration=U),N&&(l=N("vertex",l)),H[0]=l,u()}),Z)}),K),y(J,"Fragment","Pixel",(l=>{S&&(S._rawFragmentSourceCode=l),H[1]=l,u()}),K)}function y(l,a,N,c,Z,w){if("undefined"!==typeof HTMLElement&&l instanceof HTMLElement){return void c((0,U.d)(l))}if("source:"===l.substring(0,7))return void c(l.substring(7));if("base64:"===l.substring(0,7)){return void c(window.atob(l.substring(7)))}const T=K.e.GetShadersStore(Z);if(T[l+a+"Shader"])return void c(T[l+a+"Shader"]);if(N&&T[l+N+"Shader"])return void c(T[l+N+"Shader"]);let J;if(J="."===l[0]||"/"===l[0]||l.indexOf("http")>-1?l:K.e.GetShadersRepository(Z)+l,!(w=w||S.j))throw new Error("loadFileInjection is not defined");w(J+"."+a.toLowerCase()+".fx",c)}const H=(l,a,N,U)=>{try{const K=l.context?(0,c.B)(l.context):null;K&&(K.disableParallelShaderCompile=l.disableParallelCompilation);const Z=l.existingPipelineContext||a(l.shaderProcessingContext);return Z._name=l.name,l.name&&K&&(K.cachedPipelines[l.name]=Z),N(Z,l.vertex,l.fragment,!!l.createAsRaw,"","",l.rebuildRebind,l.defines,l.transformFeedbackVaryings,"",(()=>{U(Z,(()=>{var a;null===(a=l.onRenderingStateCompiled)||void 0===a||a.call(l,Z)}))})),Z}catch(K){throw Z.b.Error("Error compiling effect"),K}}},12344:(l,a,N)=>{N.r(a),N.d(a,{Effect:()=>S});var U=N(12260),c=N(12268),K=N(12350),Z=N(12359),w=N(12328);class S{static get ShadersRepository(){return K.e.ShadersRepository}static set ShadersRepository(l){K.e.ShadersRepository=l}get T(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new U.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(l,a,N){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,y=arguments.length>9?arguments[9]:void 0,H=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,W=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new U.e,this.onErrorObservable=new U.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=l,this._key=H;const B=this._key.replace(/\r/g,"").replace(/\n/g,"|");let Y;if(a.attributes){const l=a;if(this._engine=N,this._attributesNames=l.attributes,this._uniformsNames=l.uniformsNames.concat(l.samplers),this._samplerList=l.samplers.slice(),this.defines=l.defines,this.onError=l.onError,this.onCompiled=l.onCompiled,this._fallbacks=l.fallbacks,this._indexParameters=l.indexParameters,this._transformFeedbackVaryings=l.transformFeedbackVaryings||null,this._multiTarget=!!l.multiTarget,this._shaderLanguage=l.shaderLanguage??0,this._disableParallelShaderCompilation=!!l.disableParallelShaderCompilation,l.uniformBuffersNames){this._uniformBuffersNamesList=l.uniformBuffersNames.slice();for(let a=0;a<l.uniformBuffersNames.length;a++)this._uniformBuffersNames[l.uniformBuffersNames[a]]=a}this._processFinalCode=l.processFinalCode??null,this._processCodeAfterIncludes=l.processCodeAfterIncludes??void 0,W=l.extraInitializationsAsync,Y=l.existingPipelineContext}else this._engine=K,this.defines=null==w?"":w,this._uniformsNames=N.concat(c),this._samplerList=c?c.slice():[],this._attributesNames=a,this._uniformBuffersNamesList=[],this._shaderLanguage=u,this.onError=n,this.onCompiled=J,this._indexParameters=y,this._fallbacks=T;"WEBGL2"===this._engine.shaderPlatformName&&(Y=(0,Z.e)(B,this._engine._gl)??Y),this._attributeLocationByName={},this.uniqueId=S._UniqueIdSeed++,Y?(this._pipelineContext=Y,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,W),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.T||this.dispose(!0)}))}async _processShaderCodeAsync(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3?arguments[3]:void 0;U&&await U(),this._processingContext=N||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const c={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:l??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:K.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:K.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,Zc:this._engine.Zc,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,Z.b)(c,this.name,this._processFinalCode,((l,N)=>{this._vertexSourceCode=l,this._fragmentSourceCode=N,this._prepareEffect(a)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.T||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(l){return this._attributes[l]}getAttributeLocationByName(l){return this._attributeLocationByName[l]}getAttributesCount(){return this._attributes.length}getUniformIndex(l){return this._uniformsNames.indexOf(l)}getUniform(l){return this._uniforms[l]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((l=>{this.executeWhenCompiled(l)}))}executeWhenCompiled(l){this.isReady()?l(this):(this.onCompileObservable.add((a=>{l(a)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(l){(0,w.d)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(a=>{this._processCompilationErrors(a,l)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var l;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(l=this._pipelineContext)||void 0===l?void 0:l._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var l;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(l=this._pipelineContext)||void 0===l?void 0:l._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,Zc:this._engine.Zc,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(l,a,N,U){this._isReady=!1,this._vertexSourceCodeOverride=l,this._fragmentSourceCodeOverride=a,this.onError=(l,a)=>{U&&U(a)},this.onCompiled=()=>{var l,a;const U=this.getEngine().scenes;if(U)for(let N=0;N<U.length;N++)U[N].markAllMaterialsAsDirty(127);null===(l=(a=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===l||l.call(a,N)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(l){if(this._pipelineContext=l,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let a=0;a<this._attributesNames.length;a++){const l=this._attributesNames[a];this._attributeLocationByName[l]=this._attributes[a]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),S.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=this._pipelineContext;this._isReady=!1;try{const N=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),U=N?null:this.defines,c=N?this._vertexSourceCodeOverride:this._vertexSourceCode,K=N?this._fragmentSourceCodeOverride:this._fragmentSourceCode,w=this._engine;this._pipelineContext=(0,Z.c)({existingPipelineContext:l?a:null,vertex:c,fragment:K,context:"WEBGL2"===w.shaderPlatformName||"WEBGL1"===w.shaderPlatformName?w._gl:void 0,rebuildRebind:(l,a,N,U)=>this._rebuildProgram(l,a,N,U),defines:U,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:N,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:N=>{a&&!l&&this._engine._deletePipelineContext(a),N&&this._onRenderingStateCompiled(N)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(a)}catch(N){this._processCompilationErrors(N,a)}}_getShaderCodeAndErrorLine(l,a,N){const U=N?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let c=null;if(a&&l){const K=a.match(U);if(K&&2===K.length){const a=parseInt(K[1]),U=l.split("\n",-1);U.length>=a&&(c=`Offending line [${a}] in ${N?"fragment":"vertex"} code: ${U[a-1]}`)}}return[l,c]}_processCompilationErrors(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=l.message;const N=this._attributesNames,U=this._fallbacks;if(c.b.Error("Unable to compile effect:"),c.b.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),c.b.Error(`Attributes: ${N.join(" ")}`),c.b.Error("Defines:\n"+this.defines),S.LogShaderCodeOnCompilationError){var K,Z;let l=null,a=null,N=null;var w;if(null!==(K=this._pipelineContext)&&void 0!==K&&K._getVertexShaderCode()&&([N,l]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),N&&(c.b.Error("Vertex code:"),c.b.Error(N))),null!==(Z=this._pipelineContext)&&void 0!==Z&&Z._getFragmentShaderCode())[N,a]=this._getShaderCodeAndErrorLine(null===(w=this._pipelineContext)||void 0===w?void 0:w._getFragmentShaderCode(),this._compilationError,!0),N&&(c.b.Error("Fragment code:"),c.b.Error(N));l&&c.b.Error(l),a&&c.b.Error(a)}c.b.Error("Error: "+this._compilationError);const T=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};a&&(this._pipelineContext=a,this._isReady=!0,T()),U?(this._pipelineContext=null,U.hasMoreFallbacks?(this._allFallbacksProcessed=!1,c.b.Error("Trying next fallback."),this.defines=U.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,T(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,a||T())}get isSupported(){return""===this._compilationError}_bindTexture(l,a){this._engine._bindTexture(this._samplers[l],a,l)}setTexture(l,a){this._engine.setTexture(this._samplers[l],this._uniforms[l],a,l)}setTextureArray(l,a){const N=l+"Ex";if(-1===this._samplerList.indexOf(N+"0")){const U=this._samplerList.indexOf(l);for(let l=1;l<a.length;l++){const a=N+(l-1).toString();this._samplerList.splice(U+l,0,a)}let c=0;for(const l of this._samplerList)this._samplers[l]=c,c+=1}this._engine.setTextureArray(this._samplers[l],this._uniforms[l],a,l)}bindUniformBuffer(l,a){const N=this._uniformBuffersNames[a];void 0===N||S._BaseCache[N]===l&&this._engine._features.useUBOBindingCache||(S._BaseCache[N]=l,this._engine.bindUniformBufferBase(l,N,a))}bindUniformBlock(l,a){this._engine.bindUniformBlock(this._pipelineContext,l,a)}setInt(l,a){return this._pipelineContext.setInt(l,a),this}setInt2(l,a,N){return this._pipelineContext.setInt2(l,a,N),this}setInt3(l,a,N,U){return this._pipelineContext.setInt3(l,a,N,U),this}setInt4(l,a,N,U,c){return this._pipelineContext.setInt4(l,a,N,U,c),this}setIntArray(l,a){return this._pipelineContext.setIntArray(l,a),this}setIntArray2(l,a){return this._pipelineContext.setIntArray2(l,a),this}setIntArray3(l,a){return this._pipelineContext.setIntArray3(l,a),this}setIntArray4(l,a){return this._pipelineContext.setIntArray4(l,a),this}setUInt(l,a){return this._pipelineContext.setUInt(l,a),this}setUInt2(l,a,N){return this._pipelineContext.setUInt2(l,a,N),this}setUInt3(l,a,N,U){return this._pipelineContext.setUInt3(l,a,N,U),this}setUInt4(l,a,N,U,c){return this._pipelineContext.setUInt4(l,a,N,U,c),this}setUIntArray(l,a){return this._pipelineContext.setUIntArray(l,a),this}setUIntArray2(l,a){return this._pipelineContext.setUIntArray2(l,a),this}setUIntArray3(l,a){return this._pipelineContext.setUIntArray3(l,a),this}setUIntArray4(l,a){return this._pipelineContext.setUIntArray4(l,a),this}setFloatArray(l,a){return this._pipelineContext.setArray(l,a),this}setFloatArray2(l,a){return this._pipelineContext.setArray2(l,a),this}setFloatArray3(l,a){return this._pipelineContext.setArray3(l,a),this}setFloatArray4(l,a){return this._pipelineContext.setArray4(l,a),this}setArray(l,a){return this._pipelineContext.setArray(l,a),this}setArray2(l,a){return this._pipelineContext.setArray2(l,a),this}setArray3(l,a){return this._pipelineContext.setArray3(l,a),this}setArray4(l,a){return this._pipelineContext.setArray4(l,a),this}setMatrices(l,a){return this._pipelineContext.setMatrices(l,a),this}setMatrix(l,a){return this._pipelineContext.setMatrix(l,a),this}setMatrix3x3(l,a){return this._pipelineContext.setMatrix3x3(l,a),this}setMatrix2x2(l,a){return this._pipelineContext.setMatrix2x2(l,a),this}setFloat(l,a){return this._pipelineContext.setFloat(l,a),this}setBool(l,a){return this._pipelineContext.setInt(l,a?1:0),this}setVector2(l,a){return this._pipelineContext.setVector2(l,a),this}setFloat2(l,a,N){return this._pipelineContext.setFloat2(l,a,N),this}setVector3(l,a){return this._pipelineContext.setVector3(l,a),this}setFloat3(l,a,N,U){return this._pipelineContext.setFloat3(l,a,N,U),this}setVector4(l,a){return this._pipelineContext.setVector4(l,a),this}setQuaternion(l,a){return this._pipelineContext.setQuaternion(l,a),this}setFloat4(l,a,N,U,c){return this._pipelineContext.setFloat4(l,a,N,U,c),this}setColor3(l,a){return this._pipelineContext.setColor3(l,a),this}setColor4(l,a,N){return this._pipelineContext.setColor4(l,a,N),this}setDirectColor4(l,a){return this._pipelineContext.setDirectColor4(l,a),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(S.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,Z.f)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;a&&(K.e.GetShadersStore(U)[`${l}PixelShader`]=a),N&&(K.e.GetShadersStore(U)[`${l}VertexShader`]=N)}static ResetCache(){S._BaseCache={}}}S.LogShaderCodeOnCompilationError=!0,S.PersistentMode=!1,S.AutomaticallyClearCodeCache=!1,S._UniqueIdSeed=0,S._BaseCache={},S.ShadersStore=K.e.ShadersStore,S.IncludesShadersStore=K.e.IncludesShadersStore},12288:(l,a,N)=>{N.d(a,{b:()=>c});const U={};function c(l){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!U[l])return U[l]=!0,`${l} needs to be imported before as it contains a side-effect required by your code.`}},12266:(l,a,N)=>{function U(){return"undefined"!==typeof window}function c(){return"undefined"!==typeof navigator}function K(){return"undefined"!==typeof document}function Z(l){let a="",N=l.firstChild;for(;N;)3===N.nodeType&&(a+=N.textContent),N=N.nextSibling;return a}N.d(a,{d:()=>Z,h:()=>K,k:()=>c,o:()=>U})},12268:(l,a,N)=>{N.d(a,{b:()=>U});class U{static _CheckLimit(l,a){let N=U._LogLimitOutputs[l];return N?N.current++:(N={limit:a,current:1},U._LogLimitOutputs[l]=N),N.current<=N.limit}static _GenerateLimitMessage(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const N=U._LogLimitOutputs[l];if(!N||!U.MessageLimitReached)return;const c=this._Levels[a];N.current===N.limit&&U[c.name](U.MessageLimitReached.replace(/%LIMIT%/g,""+N.limit).replace(/%TYPE%/g,c.name??""))}static _AddLogEntry(l){U._LogCache=l+U._LogCache,U.OnNewCacheEntry&&U.OnNewCacheEntry(l)}static _FormatMessage(l){const a=l=>l<10?"0"+l:""+l,N=new Date;return"["+a(N.getHours())+":"+a(N.getMinutes())+":"+a(N.getSeconds())+"]: "+l}static _LogDisabled(l,a){}static _LogEnabled(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1?arguments[1]:void 0,N=arguments.length>2?arguments[2]:void 0;const c=Array.isArray(a)?a[0]:a;if(void 0!==N&&!U._CheckLimit(c,N))return;const K=U._FormatMessage(c),Z=this._Levels[l],w=Array.isArray(a)?a.slice(1):[];Z.logFunc&&Z.logFunc("BJS - "+K,...w);const S=`<div style='color:${Z.color}'>${K}</div><br>`;U._AddLogEntry(S),U._GenerateLimitMessage(c,l)}static get LogCache(){return U._LogCache}static ClearLogCache(){U._LogCache="",U._LogLimitOutputs={},U.errorsCount=0}static set LogLevels(l){U.Log=U._LogDisabled,U.Warn=U._LogDisabled,U.Error=U._LogDisabled;const a=[U.MessageLogLevel,U.WarningLogLevel,U.ErrorLogLevel];for(const N of a)if((l&N)===N){const l=this._Levels[N];U[l.name]=U._LogEnabled.bind(U,N)}}}U.NoneLogLevel=0,U.MessageLogLevel=1,U.WarningLogLevel=2,U.ErrorLogLevel=4,U.AllLogLevel=7,U.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",U._LogCache="",U._LogLimitOutputs={},U._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],U.errorsCount=0,U.Log=U._LogEnabled.bind(U,U.MessageLogLevel),U.Warn=U._LogEnabled.bind(U,U.WarningLogLevel),U.Error=U._LogEnabled.bind(U,U.ErrorLogLevel)},12260:(l,a,N)=>{N.d(a,{e:()=>Z});const U="undefined"!==typeof WeakRef;class c{constructor(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2?arguments[2]:void 0,U=arguments.length>3?arguments[3]:void 0;this.initialize(l,a,N,U)}initialize(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2?arguments[2]:void 0,U=arguments.length>3?arguments[3]:void 0;return this.mask=l,this.skipNextObservers=a,this.target=N,this.currentTarget=U,this}}class K{constructor(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=l,this.mask=a,this.scope=N,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(l)}}class Z{static FromPromise(l,a){const N=new Z;return l.then((l=>{N.notifyObservers(l)})).catch((l=>{if(!a)throw l;a.notifyObservers(l)})),N}get observers(){return this._observers}constructor(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=a,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new c(0),l&&(this._onObserverAdded=l)}add(l){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!l)return null;const c=new K(l,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);c.unregisterOnNextCall=N,a?this._observers.unshift(c):this._observers.push(c),this._onObserverAdded&&this._onObserverAdded(c),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(c,this._lastNotifiedValue);const Z=U?new WeakRef(this):{deref:()=>this};return c._remove=function(){let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=Z.deref();a&&(l?a.remove(c):a._remove(c))},c}addOnce(l){return this.add(l,void 0,void 0,void 0,!0)}remove(l){if(!l)return!1;l._remove=null;return-1!==this._observers.indexOf(l)&&(this._deferUnregister(l),!0)}removeCallback(l,a){for(let N=0;N<this._observers.length;N++){const U=this._observers[N];if(!U._willBeUnregistered&&(U.callback===l&&(!a||a===U.scope)))return this._deferUnregister(U),!0}return!1}_deferUnregister(l){l._willBeUnregistered||(this._numObserversMarkedAsDeleted++,l.unregisterOnNextCall=!1,l._willBeUnregistered=!0,setTimeout((()=>{this._remove(l)}),0))}_remove(l){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!l)return!1;const N=this._observers.indexOf(l);return-1!==N&&(a&&this._numObserversMarkedAsDeleted--,this._observers.splice(N,1),!0)}makeObserverTopPriority(l){this._remove(l,!1),this._observers.unshift(l)}makeObserverBottomPriority(l){this._remove(l,!1),this._observers.push(l)}notifyObservers(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,N=arguments.length>2?arguments[2]:void 0,U=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=l),!this._observers.length)return!0;const K=this._eventState;K.mask=a,K.target=N,K.currentTarget=U,K.skipNextObservers=!1,K.lastReturnValue=l,K.userInfo=c;for(const Z of this._observers)if(!Z._willBeUnregistered&&(Z.mask&a&&(Z.unregisterOnNextCall&&this._deferUnregister(Z),Z.scope?K.lastReturnValue=Z.callback.apply(Z.scope,[l,K]):K.lastReturnValue=Z.callback(l,K)),K.skipNextObservers))return!1;return!0}notifyObserver(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=a),l._willBeUnregistered)return;const U=this._eventState;U.mask=N,U.skipNextObservers=!1,l.unregisterOnNextCall&&this._deferUnregister(l),l.callback(a,U)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const l=this._observers.pop();l&&(l._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const l=new Z;return l._observers=this._observers.slice(0),l}hasSpecificMask(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const a of this._observers)if(a.mask&l||a.mask===l)return!0;return!1}}},12328:(l,a,N)=>{N.d(a,{b:()=>c,d:()=>Z});let U=[];class c{static SetImmediate(l){0===U.length&&setTimeout((()=>{const l=U;U=[];for(const a of l)a()}),1),U.push(l)}}function K(l,a,N){try{if(l())return a(),!0}catch(U){return null===N||void 0===N||N(U),!0}return!1}const Z=function(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,Z=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&K(l,a,N))return null;const w=setInterval((()=>{K(l,a,N)?clearInterval(w):(c-=U,c<0&&(clearInterval(w),null===N||void 0===N||N(new Error("Operation timed out after maximum retries. "+(Z||"")),!0)))}),U);return()=>clearInterval(w)}}}]);