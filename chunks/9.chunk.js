"use strict";(self.a14qw1h7fq=self.a14qw1h7fq||[]).push([[9],{11081:(R,J,B)=>{B.d(J,{b:()=>V,d:()=>x,h:()=>I,f:()=>p,j:()=>i});class Q{constructor(){this.children=[]}isValid(R){return!0}process(R,J,B){let Q="";if(this.line){let B=this.line;const D=J.processor;if(D){var h,y,N,r,q,e;D.lineProcessor&&(B=D.lineProcessor(B,J.isFragment,J.processingContext));const Q=(null===(h=J.processor)||void 0===h?void 0:h.attributeKeywordName)??"attribute",l=J.isFragment&&null!==(y=J.processor)&&void 0!==y&&y.varyingFragmentKeywordName?null===(N=J.processor)||void 0===N?void 0:N.varyingFragmentKeywordName:!J.isFragment&&null!==(r=J.processor)&&void 0!==r&&r.varyingVertexKeywordName?null===(q=J.processor)||void 0===q?void 0:q.varyingVertexKeywordName:"varying";if(!J.isFragment&&D.attributeProcessor&&this.line.startsWith(Q))B=D.attributeProcessor(this.line,R,J.processingContext);else if(D.varyingProcessor&&(null!==(e=D.varyingCheck)&&void 0!==e&&e.call(D,this.line,J.isFragment)||!D.varyingCheck&&this.line.startsWith(l)))B=D.varyingProcessor(this.line,J.isFragment,R,J.processingContext);else if(D.uniformProcessor&&D.uniformRegexp&&D.uniformRegexp.test(this.line))J.lookForClosingBracketForUniformBuffer||(B=D.uniformProcessor(this.line,J.isFragment,R,J.processingContext));else if(D.uniformBufferProcessor&&D.uniformBufferRegexp&&D.uniformBufferRegexp.test(this.line))J.lookForClosingBracketForUniformBuffer||(B=D.uniformBufferProcessor(this.line,J.isFragment,J.processingContext),J.lookForClosingBracketForUniformBuffer=!0);else if(D.textureProcessor&&D.textureRegexp&&D.textureRegexp.test(this.line))B=D.textureProcessor(this.line,J.isFragment,R,J.processingContext);else if((D.uniformProcessor||D.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!J.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?D.uniformProcessor&&(B=D.uniformProcessor(this.line,J.isFragment,R,J.processingContext)):D.uniformBufferProcessor&&(B=D.uniformBufferProcessor(this.line,J.isFragment,J.processingContext),J.lookForClosingBracketForUniformBuffer=!0)}J.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(J.lookForClosingBracketForUniformBuffer=!1,D.endOfUniformBufferProcessor&&(B=D.endOfUniformBufferProcessor(this.line,J.isFragment,J.processingContext)))}Q+=B+"\n"}for(const D of this.children)Q+=D.process(R,J,B);return this.additionalDefineKey&&(R[this.additionalDefineKey]=this.additionalDefineValue||"true",B[this.additionalDefineKey]=R[this.additionalDefineKey]),Q}}class h{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(R){this._lines.length=0;for(const J of R){if(!J||"\r"===J)continue;if("#"===J[0]){this._lines.push(J);continue}const R=J.trim();if(!R)continue;if(R.startsWith("//")){this._lines.push(J);continue}const B=R.indexOf(";");if(-1===B)this._lines.push(R);else if(B===R.length-1)R.length>1&&this._lines.push(R);else{const R=J.split(";");for(let J=0;J<R.length;J++){let B=R[J];B&&(B=B.trim(),B&&this._lines.push(B+(J!==R.length-1?";":"")))}}}}}class y extends Q{process(R,J,B){for(let Q=0;Q<this.children.length;Q++){const h=this.children[Q];if(h.isValid(R))return h.process(R,J,B)}return""}}class N extends Q{isValid(R){return this.testExpression.isTrue(R)}}class r{isTrue(R){return!0}static postfixToInfix(R){const J=[];for(const B of R)if(void 0===r._OperatorPriority[B])J.push(B);else{const R=J[J.length-1],Q=J[J.length-2];J.length-=2,J.push(`(${Q}${B}${R})`)}return J[J.length-1]}static infixToPostfix(R){const J=r._InfixToPostfixCache.get(R);if(J)return J.accessTime=Date.now(),J.result;if(!R.includes("&&")&&!R.includes("||")&&!R.includes(")")&&!R.includes("("))return[R];const B=[];let Q=-1;const h=()=>{D=D.trim(),""!==D&&(B.push(D),D="")},y=R=>{Q<r._Stack.length-1&&(r._Stack[++Q]=R)},N=()=>r._Stack[Q],q=()=>-1===Q?"!!INVALID EXPRESSION!!":r._Stack[Q--];let e=0,D="";for(;e<R.length;){const J=R.charAt(e),l=e<R.length-1?R.substring(e,2+e):"";if("("===J)D="",y(J);else if(")"===J){for(h();-1!==Q&&"("!==N();)B.push(q());q()}else if(r._OperatorPriority[l]>1){for(h();-1!==Q&&r._OperatorPriority[N()]>=r._OperatorPriority[l];)B.push(q());y(l),e++}else D+=J;e++}for(h();-1!==Q;)"("===N()?q():B.push(q());return r._InfixToPostfixCache.size>=r.InfixToPostfixCacheLimitSize&&r.ClearCache(),r._InfixToPostfixCache.set(R,{result:B,accessTime:Date.now()}),B}static ClearCache(){const R=Array.from(r._InfixToPostfixCache.entries()).sort(((R,J)=>R[1].accessTime-J[1].accessTime));for(let J=0;J<r.InfixToPostfixCacheCleanupSize;J++)r._InfixToPostfixCache.delete(R[J][0])}}r.InfixToPostfixCacheLimitSize=5e4,r.InfixToPostfixCacheCleanupSize=25e3,r._InfixToPostfixCache=new Map,r._OperatorPriority={")":0,"(":1,"||":2,"&&":3},r._Stack=["","","","","","","","","","","","","","","","","","","",""];class q extends r{constructor(R){let J=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=R,this.not=J}isTrue(R){let J=void 0!==R[this.define];return this.not&&(J=!J),J}}class e extends r{isTrue(R){return this.leftOperand.isTrue(R)||this.rightOperand.isTrue(R)}}class D extends r{isTrue(R){return this.leftOperand.isTrue(R)&&this.rightOperand.isTrue(R)}}class l extends r{constructor(R,J,B){super(),this.define=R,this.operand=J,this.testValue=B}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(R){let J=!1;const B=parseInt(void 0!=R[this.define]?R[this.define]:this.define),Q=parseInt(void 0!=R[this.testValue]?R[this.testValue]:this.testValue);if(isNaN(B)||isNaN(Q))return!1;switch(this.operand){case">":J=B>Q;break;case"<":J=B<Q;break;case"<=":J=B<=Q;break;case">=":J=B>=Q;break;case"==":J=B===Q;break;case"!=":J=B!==Q}return J}}var E=B(11056),O=B(11086);const n=/defined\s*?\((.+?)\)/g,P=/defined\s*?\[(.+?)\]/g,A=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,u=/__decl__/,S=/light\{X\}.(\w*)/g,f=/\{X\}/g,a=[],s=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function x(R){R.processor&&R.processor.initializeShaders&&R.processor.initializeShaders(R.processingContext)}function I(R,J,B,Q){var h;null!==(h=J.processor)&&void 0!==h&&h.preProcessShaderCode&&(R=J.processor.preProcessShaderCode(R,J.isFragment)),p(R,J,(R=>{J.processCodeAfterIncludes&&(R=J.processCodeAfterIncludes(J.isFragment?"fragment":"vertex",R,J.defines));const h=function(R,J,B){let Q=function(R,J){var B;if(null!==(B=J.processor)&&void 0!==B&&B.noPrecision)return R;const Q=J.shouldUseHighPrecisionShader;-1===R.indexOf("precision highp float")?R=Q?"precision highp float;\n"+R:"precision mediump float;\n"+R:Q||(R=R.replace("precision highp float","precision mediump float"));return R}(R,J);if(!J.processor)return Q;if(0===J.processor.shaderLanguage&&-1!==Q.indexOf("#version 3")&&(Q=Q.replace("#version 300 es",""),!J.processor.parseGLES3))return Q;const h=J.defines,y=z(J,B);J.processor.preProcessor&&(Q=J.processor.preProcessor(Q,h,y,J.isFragment,J.processingContext));const N={};Q=c(Q,y,J,N),J.processor.postProcessor&&(Q=J.processor.postProcessor(Q,h,J.isFragment,J.processingContext,B?{drawBuffersExtensionDisabled:!B.getCaps().drawBuffersExtension}:{},y,N));null!==B&&void 0!==B&&B._features.needShaderCodeInlining&&(Q=B.inlineShaderCode(Q));return Q}(R,J,Q);B(h,R)}))}function V(R,J,B){return B.processor&&B.processor.finalizeShaders?B.processor.finalizeShaders(R,J,B.processingContext):{vertexCode:R,fragmentCode:J}}function M(R){const J=/defined\((.+)\)/.exec(R);if(J&&J.length)return new q(J[1].trim(),"!"===R[0]);const B=["==","!=",">=","<=","<",">"];let Q="",h=0;for(Q of B)if(h=R.indexOf(Q),h>-1)break;if(-1===h)return new q(R);const y=R.substring(0,h).trim(),N=R.substring(h+Q.length).trim();return new l(y,Q,N)}function H(R,J){const B=new N,Q=R.substring(0,J);let h=R.substring(J);return h=h.substring(0,(h.indexOf("//")+1||h.length+1)-1).trim(),B.testExpression="#ifdef"===Q?new q(h):"#ifndef"===Q?new q(h,!0):function(R){R=R.replace(n,"defined[$1]");const J=r.infixToPostfix(R),B=[];for(const h of J)if("||"!==h&&"&&"!==h)B.push(h);else if(B.length>=2){let R=B[B.length-1],J=B[B.length-2];B.length-=2;const Q="&&"==h?new D:new e;"string"===typeof R&&(R=R.replace(P,"defined($1)")),"string"===typeof J&&(J=J.replace(P,"defined($1)")),Q.leftOperand="string"===typeof J?M(J):J,Q.rightOperand="string"===typeof R?M(R):R,B.push(Q)}let Q=B[B.length-1];return"string"===typeof Q&&(Q=Q.replace(P,"defined($1)")),"string"===typeof Q?M(Q):Q}(h),B}function d(R,J,B,h){let y=R.currentLine;for(;X(R,B,h);){y=R.currentLine;const N=y.substring(0,5).toLowerCase();if("#else"===N){const B=new Q;return J.children.push(B),void X(R,B,h)}if("#elif"===N){const R=H(y,5);J.children.push(R),B=R}}}function X(R,J,B){for(;R.canRead;){R.lineIndex++;const h=R.currentLine;if(h.indexOf("#")>=0){const Q=s.exec(h);if(Q&&Q.length){switch(Q[0]){case"#ifdef":{const Q=new y;J.children.push(Q);const N=H(h,6);Q.children.push(N),d(R,Q,N,B);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const Q=new y;J.children.push(Q);const N=H(h,7);Q.children.push(N),d(R,Q,N,B);break}case"#if":{const Q=new y,N=H(h,3);J.children.push(Q),Q.children.push(N),d(R,Q,N,B);break}}continue}}const N=new Q;if(N.line=h,J.children.push(N),"#"===h[0]&&"d"===h[1]){const R=h.replace(";","").split(" ");N.additionalDefineKey=R[1],3===R.length&&(N.additionalDefineValue=R[2])}}return!1}function c(R,J,B,y){const N=new Q,r=new h;return r.lineIndex=-1,r.lines=R.split("\n"),X(r,N,y),N.process(J,B,y)}function z(R,J){var B;const Q=R.defines,h={};for(const y of Q){const R=y.replace("#define","").replace(";","").trim().split(" ");h[R[0]]=R.length>1?R[1]:""}return 0===(null===(B=R.processor)||void 0===B?void 0:B.shaderLanguage)&&(h.GL_ES="true"),h.__VERSION__=R.version,h[R.platformName]="true",(0,O.g)(h,null===J||void 0===J?void 0:J.isNDCHalfZRange,null===J||void 0===J?void 0:J.useReverseDepthBuffer,null===J||void 0===J?void 0:J.useExactSrgbConversions),h}function p(R,J,B){let Q;for(a.length=0;null!==(Q=A.exec(R));)a.push(Q);let h=String(R),y=[R],N=!1;for(const r of a){let R=r[1];if(-1!==R.indexOf("__decl__")&&(R=R.replace(u,""),J.supportsUniformBuffers&&(R=R.replace("Vertex","Ubo").replace("Fragment","Ubo")),R+="Declaration"),!J.includesShadersStore[R]){const Q=J.shadersRepository+"ShadersInclude/"+R+".fx";return void i.loadFile(Q,(Q=>{J.includesShadersStore[R]=Q,p(y.join(""),J,B)}))}{let B=J.includesShadersStore[R];if(r[2]){const R=r[3].split(",");for(let J=0;J<R.length;J+=2){const Q=new RegExp(R[J],"g"),h=R[J+1];B=B.replace(Q,h)}}if(r[4]){const R=r[5];if(-1!==R.indexOf("..")){const Q=R.split(".."),h=parseInt(Q[0]);let y=parseInt(Q[1]),N=B.slice(0);B="",isNaN(y)&&(y=J.indexParameters[Q[1]]);for(let R=h;R<y;R++)J.supportsUniformBuffers||(N=N.replace(S,((R,J)=>J+"{X}"))),B+=N.replace(f,R.toString())+"\n"}else J.supportsUniformBuffers||(B=B.replace(S,((R,J)=>J+"{X}"))),B=B.replace(f,R)}const Q=[];for(const R of y){const J=R.split(r[0]);for(let R=0;R<J.length-1;R++)Q.push(J[R]),Q.push(B);Q.push(J[J.length-1])}y=Q,N=N||B.indexOf("#include<")>=0||B.indexOf("#include <")>=0}}a.length=0,h=y.join(""),N?p(h.toString(),J,B):B(h)}const i={loadFile:(R,J,B,Q,h,y)=>{throw(0,E.c)("FileTools")}}},11086:(R,J,B)=>{B.d(J,{c:()=>h,e:()=>y,g:()=>r,h:()=>N,i:()=>q});var Q=B(11056);B(11039);const h={};function y(R,J){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(J?J+"\n":"")+R}function N(R,J,B,y,N,r,q){const e=q||h.loadFile;if(e){return e(R,J,B,y,N,r)}throw(0,Q.c)("FileTools")}function r(R,J,B,Q){if(R)return J?R.IS_NDC_HALF_ZRANGE="":delete R.IS_NDC_HALF_ZRANGE,B?R.USE_REVERSE_DEPTHBUFFER="":delete R.USE_REVERSE_DEPTHBUFFER,void(Q?R.USE_EXACT_SRGB_CONVERSIONS="":delete R.USE_EXACT_SRGB_CONVERSIONS);{let R="";return J&&(R+="#define IS_NDC_HALF_ZRANGE"),B&&(R&&(R+="\n"),R+="#define USE_REVERSE_DEPTHBUFFER"),Q&&(R&&(R+="\n"),R+="#define USE_EXACT_SRGB_CONVERSIONS"),R}}function q(R,J){let B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3?arguments[3]:void 0;switch(R){case 3:{const R=(ArrayBuffer,new Int8Array(J));return Q&&R.set(new Int8Array(Q)),R}case 0:{const R=(ArrayBuffer,new Uint8Array(J));return Q&&R.set(new Uint8Array(Q)),R}case 4:{const R=J instanceof ArrayBuffer?new Int16Array(J):new Int16Array(B?J/2:J);return Q&&R.set(new Int16Array(Q)),R}case 5:case 8:case 9:case 10:case 2:{const R=J instanceof ArrayBuffer?new Uint16Array(J):new Uint16Array(B?J/2:J);return Q&&R.set(new Uint16Array(Q)),R}case 6:{const R=J instanceof ArrayBuffer?new Int32Array(J):new Int32Array(B?J/4:J);return Q&&R.set(new Int32Array(Q)),R}case 7:case 11:case 12:case 13:case 14:case 15:{const R=J instanceof ArrayBuffer?new Uint32Array(J):new Uint32Array(B?J/4:J);return Q&&R.set(new Uint32Array(Q)),R}case 1:{const R=J instanceof ArrayBuffer?new Float32Array(J):new Float32Array(B?J/4:J);return Q&&R.set(new Float32Array(Q)),R}}const h=(ArrayBuffer,new Uint8Array(J));return Q&&h.set(new Uint8Array(Q)),h}},11107:(R,J,B)=>{B.d(J,{c:()=>Q});class Q{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Q.ShadersRepository:Q.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Q.ShadersStore:Q.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Q.IncludesShadersStore:Q.IncludesShadersStoreWGSL}}Q.ShadersRepository="src/Shaders/",Q.ShadersStore={},Q.IncludesShadersStore={},Q.ShadersRepositoryWGSL="src/ShadersWGSL/",Q.ShadersStoreWGSL={},Q.IncludesShadersStoreWGSL={}},11114:(R,J,B)=>{B.d(J,{c:()=>E,d:()=>f,e:()=>n,g:()=>O,j:()=>P,l:()=>S,p:()=>l,s:()=>e,u:()=>D,w:()=>q,A:()=>r});class Q{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.OJ._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(R){R&&this.program&&R(this.program)}setEngine(R){this.OJ=R}_fillEffectInformation(R,J,B,Q,h,y,N,r){const q=this.OJ;if(q.supportsUniformBuffers)for(const D in J)R.bindUniformBlock(D,J[D]);let e;for(this.OJ.getUniforms(this,B).forEach(((R,J)=>{Q[B[J]]=R})),this._uniforms=Q,e=0;e<h.length;e++){null==R.getUniform(h[e])&&(h.splice(e,1),e--)}h.forEach(((R,J)=>{y[R]=J}));for(const D of q.getAttributes(this,N))r.push(D)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(R,J){const B=this._valueCache[R],Q=J.updateFlag;return(void 0===B||B!==Q)&&(this._valueCache[R]=Q,!0)}_cacheFloat2(R,J,B){let Q=this._valueCache[R];if(!Q||2!==Q.length)return Q=[J,B],this._valueCache[R]=Q,!0;let h=!1;return Q[0]!==J&&(Q[0]=J,h=!0),Q[1]!==B&&(Q[1]=B,h=!0),h}_cacheFloat3(R,J,B,Q){let h=this._valueCache[R];if(!h||3!==h.length)return h=[J,B,Q],this._valueCache[R]=h,!0;let y=!1;return h[0]!==J&&(h[0]=J,y=!0),h[1]!==B&&(h[1]=B,y=!0),h[2]!==Q&&(h[2]=Q,y=!0),y}_cacheFloat4(R,J,B,Q,h){let y=this._valueCache[R];if(!y||4!==y.length)return y=[J,B,Q,h],this._valueCache[R]=y,!0;let N=!1;return y[0]!==J&&(y[0]=J,N=!0),y[1]!==B&&(y[1]=B,N=!0),y[2]!==Q&&(y[2]=Q,N=!0),y[3]!==h&&(y[3]=h,N=!0),N}setInt(R,J){const B=this._valueCache[R];void 0!==B&&B===J||this.OJ.setInt(this._uniforms[R],J)&&(this._valueCache[R]=J)}setInt2(R,J,B){this._cacheFloat2(R,J,B)&&(this.OJ.setInt2(this._uniforms[R],J,B)||(this._valueCache[R]=null))}setInt3(R,J,B,Q){this._cacheFloat3(R,J,B,Q)&&(this.OJ.setInt3(this._uniforms[R],J,B,Q)||(this._valueCache[R]=null))}setInt4(R,J,B,Q,h){this._cacheFloat4(R,J,B,Q,h)&&(this.OJ.setInt4(this._uniforms[R],J,B,Q,h)||(this._valueCache[R]=null))}setIntArray(R,J){this._valueCache[R]=null,this.OJ.setIntArray(this._uniforms[R],J)}setIntArray2(R,J){this._valueCache[R]=null,this.OJ.setIntArray2(this._uniforms[R],J)}setIntArray3(R,J){this._valueCache[R]=null,this.OJ.setIntArray3(this._uniforms[R],J)}setIntArray4(R,J){this._valueCache[R]=null,this.OJ.setIntArray4(this._uniforms[R],J)}setUInt(R,J){const B=this._valueCache[R];void 0!==B&&B===J||this.OJ.setUInt(this._uniforms[R],J)&&(this._valueCache[R]=J)}setUInt2(R,J,B){this._cacheFloat2(R,J,B)&&(this.OJ.setUInt2(this._uniforms[R],J,B)||(this._valueCache[R]=null))}setUInt3(R,J,B,Q){this._cacheFloat3(R,J,B,Q)&&(this.OJ.setUInt3(this._uniforms[R],J,B,Q)||(this._valueCache[R]=null))}setUInt4(R,J,B,Q,h){this._cacheFloat4(R,J,B,Q,h)&&(this.OJ.setUInt4(this._uniforms[R],J,B,Q,h)||(this._valueCache[R]=null))}setUIntArray(R,J){this._valueCache[R]=null,this.OJ.setUIntArray(this._uniforms[R],J)}setUIntArray2(R,J){this._valueCache[R]=null,this.OJ.setUIntArray2(this._uniforms[R],J)}setUIntArray3(R,J){this._valueCache[R]=null,this.OJ.setUIntArray3(this._uniforms[R],J)}setUIntArray4(R,J){this._valueCache[R]=null,this.OJ.setUIntArray4(this._uniforms[R],J)}setArray(R,J){this._valueCache[R]=null,this.OJ.setArray(this._uniforms[R],J)}setArray2(R,J){this._valueCache[R]=null,this.OJ.setArray2(this._uniforms[R],J)}setArray3(R,J){this._valueCache[R]=null,this.OJ.setArray3(this._uniforms[R],J)}setArray4(R,J){this._valueCache[R]=null,this.OJ.setArray4(this._uniforms[R],J)}setMatrices(R,J){J&&(this._valueCache[R]=null,this.OJ.setMatrices(this._uniforms[R],J))}setMatrix(R,J){this._cacheMatrix(R,J)&&(this.OJ.setMatrices(this._uniforms[R],J.Ch())||(this._valueCache[R]=null))}setMatrix3x3(R,J){this._valueCache[R]=null,this.OJ.setMatrix3x3(this._uniforms[R],J)}setMatrix2x2(R,J){this._valueCache[R]=null,this.OJ.setMatrix2x2(this._uniforms[R],J)}setFloat(R,J){const B=this._valueCache[R];void 0!==B&&B===J||this.OJ.setFloat(this._uniforms[R],J)&&(this._valueCache[R]=J)}setVector2(R,J){this._cacheFloat2(R,J.x,J.y)&&(this.OJ.setFloat2(this._uniforms[R],J.x,J.y)||(this._valueCache[R]=null))}setFloat2(R,J,B){this._cacheFloat2(R,J,B)&&(this.OJ.setFloat2(this._uniforms[R],J,B)||(this._valueCache[R]=null))}setVector3(R,J){this._cacheFloat3(R,J.x,J.y,J.z)&&(this.OJ.setFloat3(this._uniforms[R],J.x,J.y,J.z)||(this._valueCache[R]=null))}setFloat3(R,J,B,Q){this._cacheFloat3(R,J,B,Q)&&(this.OJ.setFloat3(this._uniforms[R],J,B,Q)||(this._valueCache[R]=null))}setVector4(R,J){this._cacheFloat4(R,J.x,J.y,J.z,J.w)&&(this.OJ.setFloat4(this._uniforms[R],J.x,J.y,J.z,J.w)||(this._valueCache[R]=null))}setQuaternion(R,J){this._cacheFloat4(R,J.x,J.y,J.z,J.w)&&(this.OJ.setFloat4(this._uniforms[R],J.x,J.y,J.z,J.w)||(this._valueCache[R]=null))}setFloat4(R,J,B,Q,h){this._cacheFloat4(R,J,B,Q,h)&&(this.OJ.setFloat4(this._uniforms[R],J,B,Q,h)||(this._valueCache[R]=null))}setColor3(R,J){this._cacheFloat3(R,J.r,J.g,J.b)&&(this.OJ.setFloat3(this._uniforms[R],J.r,J.g,J.b)||(this._valueCache[R]=null))}setColor4(R,J,B){this._cacheFloat4(R,J.r,J.g,J.b,B)&&(this.OJ.setFloat4(this._uniforms[R],J.r,J.g,J.b,B)||(this._valueCache[R]=null))}setDirectColor4(R,J){this._cacheFloat4(R,J.r,J.g,J.b,J.a)&&(this.OJ.setFloat4(this._uniforms[R],J.r,J.g,J.b,J.a)||(this._valueCache[R]=null))}_getVertexShaderCode(){return this.vertexShader?this.OJ._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.OJ._getShaderSource(this.fragmentShader):null}}var h=B(11086);const y=new WeakMap,N={_webGLVersion:2,cachedPipelines:{}};function r(R){let J=y.get(R);if(!J){if(!R)return N;J={_webGLVersion:R.TEXTURE_BINDING_3D?2:1,_context:R,parallelShaderCompile:R.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},y.set(R,J)}return J}function q(R){y.delete(R)}function e(R,J,B,Q,h,y){const N=r(Q);y||(y=N._createShaderProgramInjection??E);return y(R,u(J,"vertex",Q,N._contextWasLost),u(B,"fragment",Q,N._contextWasLost),Q,h,N.validateShaderPrograms)}function D(R,J,B,Q,h){let y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,N=arguments.length>6?arguments[6]:void 0;const q=r(h);N||(N=q._createShaderProgramInjection??E);const e=q._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return N(R,A(J,"vertex",Q,e,h,q._contextWasLost),A(B,"fragment",Q,e,h,q._contextWasLost),h,y,q.validateShaderPrograms)}function l(R,J){const B=new Q,h=r(R);return h.parallelShaderCompile&&!h.disableParallelShaderCompile&&(B.isParallelCompiled=!0),B.context=h._context,B}function E(R,J,B,Q){let h=arguments.length>5?arguments[5]:void 0;const y=Q.createProgram();if(R.program=y,!y)throw new Error("Unable to create program");return Q.attachShader(y,J),Q.attachShader(y,B),Q.linkProgram(y),R.context=Q,R.vertexShader=J,R.fragmentShader=B,R.isParallelCompiled||n(R,Q,h),y}function O(R,J,B){const Q=R;if(Q._isDisposed)return!1;const h=r(J);return!!(h&&h.parallelShaderCompile&&h.parallelShaderCompile.COMPLETION_STATUS_KHR&&Q.program&&J.getProgramParameter(Q.program,h.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(n(Q,J,B),!0)}function n(R,J,B){const Q=R.context,h=R.vertexShader,y=R.fragmentShader,N=R.program;if(!Q.getProgramParameter(N,Q.LINK_STATUS)){if(!J.getShaderParameter(h,J.COMPILE_STATUS)){const B=J.getShaderInfoLog(h);if(B)throw R.vertexCompilationError=B,new Error("VERTEX SHADER "+B)}if(!J.getShaderParameter(y,J.COMPILE_STATUS)){const B=J.getShaderInfoLog(y);if(B)throw R.fragmentCompilationError=B,new Error("FRAGMENT SHADER "+B)}const B=Q.getProgramInfoLog(N);if(B)throw R.programLinkError=B,new Error(B)}if(B){Q.validateProgram(N);if(!Q.getProgramParameter(N,Q.VALIDATE_STATUS)){const J=Q.getProgramInfoLog(N);if(J)throw R.programValidationError=J,new Error(J)}}Q.deleteShader(h),Q.deleteShader(y),R.vertexShader=void 0,R.fragmentShader=void 0,R.onCompiled&&(R.onCompiled(),R.onCompiled=void 0)}function P(R,J,B,Q,h,y,N,q,l){let E=arguments.length>10?arguments[10]:void 0,O=arguments.length>11?arguments[11]:void 0,n=arguments.length>12?arguments[12]:void 0;const P=r(R.context);O||(O=P.createRawShaderProgramInjection??e),n||(n=P.createShaderProgramInjection??D);const A=R;A.program=Q?O(A,J,B,A.context,l):n(A,J,B,q,A.context,l),A.program.__SPECTOR_rebuildProgram=N,E()}function A(R,J,B,Q,y,N){return u((0,h.e)(R,B,Q),J,y,N)}function u(R,J,B,Q){const h=B.createShader("vertex"===J?B.VERTEX_SHADER:B.FRAGMENT_SHADER);if(!h){let R=B.NO_ERROR,h=B.NO_ERROR;for(;(h=B.getError())!==B.NO_ERROR;)R=h;throw new Error(`Something went wrong while creating a gl ${J} shader object. gl error=${R}, gl isContextLost=${B.isContextLost()}, _contextWasLost=${Q}`)}return B.shaderSource(h,R),B.compileShader(h),h}function S(R,J){J.useProgram(R)}function f(R,J){const B=R;if(!B.isParallelCompiled)return void J(R);const Q=B.onCompiled;B.onCompiled=()=>{null===Q||void 0===Q||Q(),J(R)}}},11111:(R,J,B)=>{B.d(J,{b:()=>l,e:()=>O,h:()=>e,j:()=>D});var Q=B(11039),h=B(11114),y=B(11107),N=B(11043),r=B(11081),q=B(11086);function e(R,J){return(0,h.A)(J).cachedPipelines[R]}function D(R){const J=R._name,B=R.context;if(J&&B){const R=(0,h.A)(B),Q=R.cachedPipelines[J];null===Q||void 0===Q||Q.dispose(),delete R.cachedPipelines[J]}}function l(R,J,B,h,y,N,q){let e,D;const l=(0,Q.h)()?null===N||void 0===N?void 0:N.getHostDocument():null;e="string"===typeof J?J:J.vertexSource?"source:"+J.vertexSource:J.vertexElement?(null===l||void 0===l?void 0:l.getElementById(J.vertexElement))||J.vertexElement:J.vertex||J,D="string"===typeof J?J:J.fragmentSource?"source:"+J.fragmentSource:J.fragmentElement?(null===l||void 0===l?void 0:l.getElementById(J.fragmentElement))||J.fragmentElement:J.fragment||J;const O=[void 0,void 0],n=()=>{if(O[0]&&O[1]){R.isFragment=!0;const[Q,e]=O;(0,r.h)(e,R,((N,e)=>{q&&(q._fragmentSourceCodeBeforeMigration=e),B&&(N=B("fragment",N));const D=(0,r.b)(Q,N,R);R=null;const l=function(R,J,B,Q){if(B){return{vertexSourceCode:(1===Q?"//":"")+"#define SHADER_NAME vertex:"+(B.vertexElement||B.vertex||B.spectorName||B)+"\n"+R,fragmentSourceCode:(1===Q?"//":"")+"#define SHADER_NAME fragment:"+(B.fragmentElement||B.fragment||B.spectorName||B)+"\n"+J}}return{vertexSourceCode:R,fragmentSourceCode:J}}(D.vertexCode,D.fragmentCode,J,y);null===h||void 0===h||h(l.vertexSourceCode,l.fragmentSourceCode)}),N)}};E(e,"Vertex","",(J=>{(0,r.d)(R),(0,r.h)(J,R,((R,Q)=>{q&&(q._rawVertexSourceCode=J,q._vertexSourceCodeBeforeMigration=Q),B&&(R=B("vertex",R)),O[0]=R,n()}),N)}),y),E(D,"Fragment","Pixel",(R=>{q&&(q._rawFragmentSourceCode=R),O[1]=R,n()}),y)}function E(R,J,B,h,N,r){if("undefined"!==typeof HTMLElement&&R instanceof HTMLElement){return void h((0,Q.e)(R))}if("source:"===R.substring(0,7))return void h(R.substring(7));if("base64:"===R.substring(0,7)){return void h(window.atob(R.substring(7)))}const e=y.c.GetShadersStore(N);if(e[R+J+"Shader"])return void h(e[R+J+"Shader"]);if(B&&e[R+B+"Shader"])return void h(e[R+B+"Shader"]);let D;if(D="."===R[0]||"/"===R[0]||R.indexOf("http")>-1?R:y.c.GetShadersRepository(N)+R,!(r=r||q.h))throw new Error("loadFileInjection is not defined");r(D+"."+J.toLowerCase()+".fx",h)}const O=(R,J,B,Q)=>{try{const y=R.context?(0,h.A)(R.context):null;y&&(y.disableParallelShaderCompile=R.disableParallelCompilation);const N=R.existingPipelineContext||J(R.shaderProcessingContext);return N._name=R.name,R.name&&y&&(y.cachedPipelines[R.name]=N),B(N,R.vertex,R.fragment,!!R.createAsRaw,"","",R.rebuildRebind,R.defines,R.transformFeedbackVaryings,"",(()=>{Q(N,(()=>{var J;null===(J=R.onRenderingStateCompiled)||void 0===J||J.call(R,N)}))})),N}catch(y){throw N.d.Error("Error compiling effect"),y}}},11098:(R,J,B)=>{B.r(J),B.d(J,{Effect:()=>q});var Q=B(11032),h=B(11043),y=B(11107),N=B(11111),r=B(11090);class q{static get ShadersRepository(){return y.c.ShadersRepository}static set ShadersRepository(R){y.c.ShadersRepository=R}get D(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Q.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(R,J,B){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,E=arguments.length>9?arguments[9]:void 0,O=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",n=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,P=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new Q.e,this.onErrorObservable=new Q.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=R,this._key=O;const A=this._key.replace(/\r/g,"").replace(/\n/g,"|");let u;if(J.attributes){const R=J;if(this._engine=B,this._attributesNames=R.attributes,this._uniformsNames=R.uniformsNames.concat(R.samplers),this._samplerList=R.samplers.slice(),this.defines=R.defines,this.onError=R.onError,this.onCompiled=R.onCompiled,this._fallbacks=R.fallbacks,this._indexParameters=R.indexParameters,this._transformFeedbackVaryings=R.transformFeedbackVaryings||null,this._multiTarget=!!R.multiTarget,this._shaderLanguage=R.shaderLanguage??0,this._disableParallelShaderCompilation=!!R.disableParallelShaderCompilation,R.uniformBuffersNames){this._uniformBuffersNamesList=R.uniformBuffersNames.slice();for(let J=0;J<R.uniformBuffersNames.length;J++)this._uniformBuffersNames[R.uniformBuffersNames[J]]=J}this._processFinalCode=R.processFinalCode??null,this._processCodeAfterIncludes=R.processCodeAfterIncludes??void 0,P=R.extraInitializationsAsync,u=R.existingPipelineContext}else this._engine=y,this.defines=null==r?"":r,this._uniformsNames=B.concat(h),this._samplerList=h?h.slice():[],this._attributesNames=J,this._uniformBuffersNamesList=[],this._shaderLanguage=n,this.onError=l,this.onCompiled=D,this._indexParameters=E,this._fallbacks=e;"WEBGL2"===this._engine.shaderPlatformName&&(u=(0,N.h)(A,this._engine._gl)??u),this._attributeLocationByName={},this.uniqueId=q._UniqueIdSeed++,u?(this._pipelineContext=u,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,P),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.D||this.dispose(!0)}))}async _processShaderCodeAsync(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,J=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3?arguments[3]:void 0;Q&&await Q(),this._processingContext=B||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const h={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:R??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:y.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:y.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,N.b)(h,this.name,this._processFinalCode,((R,B)=>{this._vertexSourceCode=R,this._fragmentSourceCode=B,this._prepareEffect(J)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.D||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(R){return this._attributes[R]}getAttributeLocationByName(R){return this._attributeLocationByName[R]}getAttributesCount(){return this._attributes.length}getUniformIndex(R){return this._uniformsNames.indexOf(R)}getUniform(R){return this._uniforms[R]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((R=>{this.executeWhenCompiled(R)}))}executeWhenCompiled(R){this.isReady()?R(this):(this.onCompileObservable.add((J=>{R(J)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(R){(0,r.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(J=>{this._processCompilationErrors(J,R)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var R;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(R=this._pipelineContext)||void 0===R?void 0:R._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var R;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(R=this._pipelineContext)||void 0===R?void 0:R._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(R,J,B,Q){this._isReady=!1,this._vertexSourceCodeOverride=R,this._fragmentSourceCodeOverride=J,this.onError=(R,J)=>{Q&&Q(J)},this.onCompiled=()=>{var R,J;const Q=this.getEngine().scenes;if(Q)for(let B=0;B<Q.length;B++)Q[B].markAllMaterialsAsDirty(127);null===(R=(J=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===R||R.call(J,B)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(R){if(this._pipelineContext=R,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let J=0;J<this._attributesNames.length;J++){const R=this._attributesNames[J];this._attributeLocationByName[R]=this._attributes[J]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),q.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const J=this._pipelineContext;this._isReady=!1;try{const B=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),Q=B?null:this.defines,h=B?this._vertexSourceCodeOverride:this._vertexSourceCode,y=B?this._fragmentSourceCodeOverride:this._fragmentSourceCode,r=this._engine;this._pipelineContext=(0,N.e)({existingPipelineContext:R?J:null,vertex:h,fragment:y,context:"WEBGL2"===r.shaderPlatformName||"WEBGL1"===r.shaderPlatformName?r._gl:void 0,rebuildRebind:(R,J,B,Q)=>this._rebuildProgram(R,J,B,Q),defines:Q,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:B,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:B=>{J&&!R&&this._engine._deletePipelineContext(J),B&&this._onRenderingStateCompiled(B)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(J)}catch(B){this._processCompilationErrors(B,J)}}_getShaderCodeAndErrorLine(R,J,B){const Q=B?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let h=null;if(J&&R){const y=J.match(Q);if(y&&2===y.length){const J=parseInt(y[1]),Q=R.split("\n",-1);Q.length>=J&&(h=`Offending line [${J}] in ${B?"fragment":"vertex"} code: ${Q[J-1]}`)}}return[R,h]}_processCompilationErrors(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=R.message;const B=this._attributesNames,Q=this._fallbacks;if(h.d.Error("Unable to compile effect:"),h.d.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),h.d.Error(`Attributes: ${B.join(" ")}`),h.d.Error("Defines:\n"+this.defines),q.LogShaderCodeOnCompilationError){var y,N;let R=null,J=null,B=null;var r;if(null!==(y=this._pipelineContext)&&void 0!==y&&y._getVertexShaderCode()&&([B,R]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),B&&(h.d.Error("Vertex code:"),h.d.Error(B))),null!==(N=this._pipelineContext)&&void 0!==N&&N._getFragmentShaderCode())[B,J]=this._getShaderCodeAndErrorLine(null===(r=this._pipelineContext)||void 0===r?void 0:r._getFragmentShaderCode(),this._compilationError,!0),B&&(h.d.Error("Fragment code:"),h.d.Error(B));R&&h.d.Error(R),J&&h.d.Error(J)}h.d.Error("Error: "+this._compilationError);const e=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};J&&(this._pipelineContext=J,this._isReady=!0,e()),Q?(this._pipelineContext=null,Q.hasMoreFallbacks?(this._allFallbacksProcessed=!1,h.d.Error("Trying next fallback."),this.defines=Q.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,e(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,J||e())}get isSupported(){return""===this._compilationError}_bindTexture(R,J){this._engine._bindTexture(this._samplers[R],J,R)}setTexture(R,J){this._engine.setTexture(this._samplers[R],this._uniforms[R],J,R)}setTextureArray(R,J){const B=R+"Ex";if(-1===this._samplerList.indexOf(B+"0")){const Q=this._samplerList.indexOf(R);for(let R=1;R<J.length;R++){const J=B+(R-1).toString();this._samplerList.splice(Q+R,0,J)}let h=0;for(const R of this._samplerList)this._samplers[R]=h,h+=1}this._engine.setTextureArray(this._samplers[R],this._uniforms[R],J,R)}bindUniformBuffer(R,J){const B=this._uniformBuffersNames[J];void 0===B||q._BaseCache[B]===R&&this._engine._features.useUBOBindingCache||(q._BaseCache[B]=R,this._engine.bindUniformBufferBase(R,B,J))}bindUniformBlock(R,J){this._engine.bindUniformBlock(this._pipelineContext,R,J)}setInt(R,J){return this._pipelineContext.setInt(R,J),this}setInt2(R,J,B){return this._pipelineContext.setInt2(R,J,B),this}setInt3(R,J,B,Q){return this._pipelineContext.setInt3(R,J,B,Q),this}setInt4(R,J,B,Q,h){return this._pipelineContext.setInt4(R,J,B,Q,h),this}setIntArray(R,J){return this._pipelineContext.setIntArray(R,J),this}setIntArray2(R,J){return this._pipelineContext.setIntArray2(R,J),this}setIntArray3(R,J){return this._pipelineContext.setIntArray3(R,J),this}setIntArray4(R,J){return this._pipelineContext.setIntArray4(R,J),this}setUInt(R,J){return this._pipelineContext.setUInt(R,J),this}setUInt2(R,J,B){return this._pipelineContext.setUInt2(R,J,B),this}setUInt3(R,J,B,Q){return this._pipelineContext.setUInt3(R,J,B,Q),this}setUInt4(R,J,B,Q,h){return this._pipelineContext.setUInt4(R,J,B,Q,h),this}setUIntArray(R,J){return this._pipelineContext.setUIntArray(R,J),this}setUIntArray2(R,J){return this._pipelineContext.setUIntArray2(R,J),this}setUIntArray3(R,J){return this._pipelineContext.setUIntArray3(R,J),this}setUIntArray4(R,J){return this._pipelineContext.setUIntArray4(R,J),this}setFloatArray(R,J){return this._pipelineContext.setArray(R,J),this}setFloatArray2(R,J){return this._pipelineContext.setArray2(R,J),this}setFloatArray3(R,J){return this._pipelineContext.setArray3(R,J),this}setFloatArray4(R,J){return this._pipelineContext.setArray4(R,J),this}setArray(R,J){return this._pipelineContext.setArray(R,J),this}setArray2(R,J){return this._pipelineContext.setArray2(R,J),this}setArray3(R,J){return this._pipelineContext.setArray3(R,J),this}setArray4(R,J){return this._pipelineContext.setArray4(R,J),this}setMatrices(R,J){return this._pipelineContext.setMatrices(R,J),this}setMatrix(R,J){return this._pipelineContext.setMatrix(R,J),this}setMatrix3x3(R,J){return this._pipelineContext.setMatrix3x3(R,J),this}setMatrix2x2(R,J){return this._pipelineContext.setMatrix2x2(R,J),this}setFloat(R,J){return this._pipelineContext.setFloat(R,J),this}setBool(R,J){return this._pipelineContext.setInt(R,J?1:0),this}setVector2(R,J){return this._pipelineContext.setVector2(R,J),this}setFloat2(R,J,B){return this._pipelineContext.setFloat2(R,J,B),this}setVector3(R,J){return this._pipelineContext.setVector3(R,J),this}setFloat3(R,J,B,Q){return this._pipelineContext.setFloat3(R,J,B,Q),this}setVector4(R,J){return this._pipelineContext.setVector4(R,J),this}setQuaternion(R,J){return this._pipelineContext.setQuaternion(R,J),this}setFloat4(R,J,B,Q,h){return this._pipelineContext.setFloat4(R,J,B,Q,h),this}setColor3(R,J){return this._pipelineContext.setColor3(R,J),this}setColor4(R,J,B){return this._pipelineContext.setColor4(R,J,B),this}setDirectColor4(R,J){return this._pipelineContext.setDirectColor4(R,J),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(q.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,N.j)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(R,J,B){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;J&&(y.c.GetShadersStore(Q)[`${R}PixelShader`]=J),B&&(y.c.GetShadersStore(Q)[`${R}VertexShader`]=B)}static ResetCache(){q._BaseCache={}}}q.LogShaderCodeOnCompilationError=!0,q.PersistentMode=!1,q.AutomaticallyClearCodeCache=!1,q._UniqueIdSeed=0,q._BaseCache={},q.ShadersStore=y.c.ShadersStore,q.IncludesShadersStore=y.c.IncludesShadersStore},11056:(R,J,B)=>{B.d(J,{c:()=>h});const Q={};function h(R){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!Q[R])return Q[R]=!0,`${R} needs to be imported before as it contains a side-effect required by your code.`}},11039:(R,J,B)=>{function Q(){return"undefined"!==typeof window}function h(){return"undefined"!==typeof navigator}function y(){return"undefined"!==typeof document}function N(R){let J="",B=R.firstChild;for(;B;)3===B.nodeType&&(J+=B.textContent),B=B.nextSibling;return J}B.d(J,{e:()=>N,f:()=>y,g:()=>h,h:()=>Q})},11043:(R,J,B)=>{B.d(J,{d:()=>Q});class Q{static _CheckLimit(R,J){let B=Q._LogLimitOutputs[R];return B?B.current++:(B={limit:J,current:1},Q._LogLimitOutputs[R]=B),B.current<=B.limit}static _GenerateLimitMessage(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const B=Q._LogLimitOutputs[R];if(!B||!Q.MessageLimitReached)return;const h=this._Levels[J];B.current===B.limit&&Q[h.name](Q.MessageLimitReached.replace(/%LIMIT%/g,""+B.limit).replace(/%TYPE%/g,h.name??""))}static _AddLogEntry(R){Q._LogCache=R+Q._LogCache,Q.OnNewCacheEntry&&Q.OnNewCacheEntry(R)}static _FormatMessage(R){const J=R=>R<10?"0"+R:""+R,B=new Date;return"["+J(B.getHours())+":"+J(B.getMinutes())+":"+J(B.getSeconds())+"]: "+R}static _LogDisabled(R,J){}static _LogEnabled(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,J=arguments.length>1?arguments[1]:void 0,B=arguments.length>2?arguments[2]:void 0;const h=Array.isArray(J)?J[0]:J;if(void 0!==B&&!Q._CheckLimit(h,B))return;const y=Q._FormatMessage(h),N=this._Levels[R],r=Array.isArray(J)?J.slice(1):[];N.logFunc&&N.logFunc("BJS - "+y,...r);const q=`<div style='color:${N.color}'>${y}</div><br>`;Q._AddLogEntry(q),Q._GenerateLimitMessage(h,R)}static get LogCache(){return Q._LogCache}static ClearLogCache(){Q._LogCache="",Q._LogLimitOutputs={},Q.errorsCount=0}static set LogLevels(R){Q.Log=Q._LogDisabled,Q.Warn=Q._LogDisabled,Q.Error=Q._LogDisabled;const J=[Q.MessageLogLevel,Q.WarningLogLevel,Q.ErrorLogLevel];for(const B of J)if((R&B)===B){const R=this._Levels[B];Q[R.name]=Q._LogEnabled.bind(Q,B)}}}Q.NoneLogLevel=0,Q.MessageLogLevel=1,Q.WarningLogLevel=2,Q.ErrorLogLevel=4,Q.AllLogLevel=7,Q.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",Q._LogCache="",Q._LogLimitOutputs={},Q._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],Q.errorsCount=0,Q.Log=Q._LogEnabled.bind(Q,Q.MessageLogLevel),Q.Warn=Q._LogEnabled.bind(Q,Q.WarningLogLevel),Q.Error=Q._LogEnabled.bind(Q,Q.ErrorLogLevel)},11032:(R,J,B)=>{B.d(J,{e:()=>N});const Q="undefined"!==typeof WeakRef;class h{constructor(R){let J=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2?arguments[2]:void 0,Q=arguments.length>3?arguments[3]:void 0;this.initialize(R,J,B,Q)}initialize(R){let J=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2?arguments[2]:void 0,Q=arguments.length>3?arguments[3]:void 0;return this.mask=R,this.skipNextObservers=J,this.target=B,this.currentTarget=Q,this}}class y{constructor(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=R,this.mask=J,this.scope=B,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(R)}}class N{static FromPromise(R,J){const B=new N;return R.then((R=>{B.notifyObservers(R)})).catch((R=>{if(!J)throw R;J.notifyObservers(R)})),B}get observers(){return this._observers}constructor(R){let J=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=J,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new h(0),R&&(this._onObserverAdded=R)}add(R){let J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!R)return null;const h=new y(R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);h.unregisterOnNextCall=B,J?this._observers.unshift(h):this._observers.push(h),this._onObserverAdded&&this._onObserverAdded(h),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(h,this._lastNotifiedValue);const N=Q?new WeakRef(this):{deref:()=>this};return h._remove=function(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const J=N.deref();J&&(R?J.remove(h):J._remove(h))},h}addOnce(R){return this.add(R,void 0,void 0,void 0,!0)}remove(R){if(!R)return!1;R._remove=null;return-1!==this._observers.indexOf(R)&&(this._deferUnregister(R),!0)}removeCallback(R,J){for(let B=0;B<this._observers.length;B++){const Q=this._observers[B];if(!Q._willBeUnregistered&&(Q.callback===R&&(!J||J===Q.scope)))return this._deferUnregister(Q),!0}return!1}_deferUnregister(R){R._willBeUnregistered||(this._numObserversMarkedAsDeleted++,R.unregisterOnNextCall=!1,R._willBeUnregistered=!0,setTimeout((()=>{this._remove(R)}),0))}_remove(R){let J=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!R)return!1;const B=this._observers.indexOf(R);return-1!==B&&(J&&this._numObserversMarkedAsDeleted--,this._observers.splice(B,1),!0)}makeObserverTopPriority(R){this._remove(R,!1),this._observers.unshift(R)}makeObserverBottomPriority(R){this._remove(R,!1),this._observers.push(R)}notifyObservers(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,B=arguments.length>2?arguments[2]:void 0,Q=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=R),!this._observers.length)return!0;const y=this._eventState;y.mask=J,y.target=B,y.currentTarget=Q,y.skipNextObservers=!1,y.lastReturnValue=R,y.userInfo=h;for(const N of this._observers)if(!N._willBeUnregistered&&(N.mask&J&&(N.unregisterOnNextCall&&this._deferUnregister(N),N.scope?y.lastReturnValue=N.callback.apply(N.scope,[R,y]):y.lastReturnValue=N.callback(R,y)),y.skipNextObservers))return!1;return!0}notifyObserver(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=J),R._willBeUnregistered)return;const Q=this._eventState;Q.mask=B,Q.skipNextObservers=!1,R.unregisterOnNextCall&&this._deferUnregister(R),R.callback(J,Q)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const R=this._observers.pop();R&&(R._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const R=new N;return R._observers=this._observers.slice(0),R}hasSpecificMask(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const J of this._observers)if(J.mask&R||J.mask===R)return!0;return!1}}},11090:(R,J,B)=>{B.d(J,{d:()=>h,f:()=>N});let Q=[];class h{static SetImmediate(R){0===Q.length&&setTimeout((()=>{const R=Q;Q=[];for(const J of R)J()}),1),Q.push(R)}}function y(R,J,B){try{if(R())return J(),!0}catch(Q){return null===B||void 0===B||B(Q),!0}return!1}const N=function(R,J,B){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,N=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&y(R,J,B))return null;const r=setInterval((()=>{y(R,J,B)?clearInterval(r):(h-=Q,h<0&&(clearInterval(r),null===B||void 0===B||B(new Error("Operation timed out after maximum retries. "+(N||"")),!0)))}),Q);return()=>clearInterval(r)}}}]);