"use strict";(self.b15p7b72fr8=self.b15p7b72fr8||[]).push([[9],{12461:(s,k,h)=>{h.d(k,{e:()=>Q,h:()=>u,k:()=>G,i:()=>C,l:()=>v});class A{constructor(){this.children=[]}isValid(s){return!0}process(s,k,h){let A="";if(this.line){let h=this.line;const c=k.processor;if(c){var g,ms,i,K,H,O;c.lineProcessor&&(h=c.lineProcessor(h,k.isFragment,k.processingContext));const A=(null===(g=k.processor)||void 0===g?void 0:g.attributeKeywordName)??"attribute",S=k.isFragment&&null!==(ms=k.processor)&&void 0!==ms&&ms.varyingFragmentKeywordName?null===(i=k.processor)||void 0===i?void 0:i.varyingFragmentKeywordName:!k.isFragment&&null!==(K=k.processor)&&void 0!==K&&K.varyingVertexKeywordName?null===(H=k.processor)||void 0===H?void 0:H.varyingVertexKeywordName:"varying";if(!k.isFragment&&c.attributeProcessor&&this.line.startsWith(A))h=c.attributeProcessor(this.line,s,k.processingContext);else if(c.varyingProcessor&&(null!==(O=c.varyingCheck)&&void 0!==O&&O.call(c,this.line,k.isFragment)||!c.varyingCheck&&this.line.startsWith(S)))h=c.varyingProcessor(this.line,k.isFragment,s,k.processingContext);else if(c.uniformProcessor&&c.uniformRegexp&&c.uniformRegexp.test(this.line))k.lookForClosingBracketForUniformBuffer||(h=c.uniformProcessor(this.line,k.isFragment,s,k.processingContext));else if(c.uniformBufferProcessor&&c.uniformBufferRegexp&&c.uniformBufferRegexp.test(this.line))k.lookForClosingBracketForUniformBuffer||(h=c.uniformBufferProcessor(this.line,k.isFragment,k.processingContext),k.lookForClosingBracketForUniformBuffer=!0);else if(c.textureProcessor&&c.textureRegexp&&c.textureRegexp.test(this.line))h=c.textureProcessor(this.line,k.isFragment,s,k.processingContext);else if((c.uniformProcessor||c.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!k.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?c.uniformProcessor&&(h=c.uniformProcessor(this.line,k.isFragment,s,k.processingContext)):c.uniformBufferProcessor&&(h=c.uniformBufferProcessor(this.line,k.isFragment,k.processingContext),k.lookForClosingBracketForUniformBuffer=!0)}k.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(k.lookForClosingBracketForUniformBuffer=!1,c.endOfUniformBufferProcessor&&(h=c.endOfUniformBufferProcessor(this.line,k.isFragment,k.processingContext)))}A+=h+"\n"}for(const c of this.children)A+=c.process(s,k,h);return this.additionalDefineKey&&(s[this.additionalDefineKey]=this.additionalDefineValue||"true",h[this.additionalDefineKey]=s[this.additionalDefineKey]),A}}class g{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(s){this._lines.length=0;for(const k of s){if(!k||"\r"===k)continue;if("#"===k[0]){this._lines.push(k);continue}const s=k.trim();if(!s)continue;if(s.startsWith("//")){this._lines.push(k);continue}const h=s.indexOf(";");if(-1===h)this._lines.push(s);else if(h===s.length-1)s.length>1&&this._lines.push(s);else{const s=k.split(";");for(let k=0;k<s.length;k++){let h=s[k];h&&(h=h.trim(),h&&this._lines.push(h+(k!==s.length-1?";":"")))}}}}}class ms extends A{process(s,k,h){for(let A=0;A<this.children.length;A++){const g=this.children[A];if(g.isValid(s))return g.process(s,k,h)}return""}}class i extends A{isValid(s){return this.testExpression.isTrue(s)}}class K{isTrue(s){return!0}static postfixToInfix(s){const k=[];for(const h of s)if(void 0===K._OperatorPriority[h])k.push(h);else{const s=k[k.length-1],A=k[k.length-2];k.length-=2,k.push(`(${A}${h}${s})`)}return k[k.length-1]}static infixToPostfix(s){const k=K._InfixToPostfixCache.get(s);if(k)return k.accessTime=Date.now(),k.result;if(!s.includes("&&")&&!s.includes("||")&&!s.includes(")")&&!s.includes("("))return[s];const h=[];let A=-1;const g=()=>{c=c.trim(),""!==c&&(h.push(c),c="")},ms=s=>{A<K._Stack.length-1&&(K._Stack[++A]=s)},i=()=>K._Stack[A],H=()=>-1===A?"!!INVALID EXPRESSION!!":K._Stack[A--];let O=0,c="";for(;O<s.length;){const k=s.charAt(O),S=O<s.length-1?s.substring(O,2+O):"";if("("===k)c="",ms(k);else if(")"===k){for(g();-1!==A&&"("!==i();)h.push(H());H()}else if(K._OperatorPriority[S]>1){for(g();-1!==A&&K._OperatorPriority[i()]>=K._OperatorPriority[S];)h.push(H());ms(S),O++}else c+=k;O++}for(g();-1!==A;)"("===i()?H():h.push(H());return K._InfixToPostfixCache.size>=K.InfixToPostfixCacheLimitSize&&K.ClearCache(),K._InfixToPostfixCache.set(s,{result:h,accessTime:Date.now()}),h}static ClearCache(){const s=Array.from(K._InfixToPostfixCache.entries()).sort(((s,k)=>s[1].accessTime-k[1].accessTime));for(let k=0;k<K.InfixToPostfixCacheCleanupSize;k++)K._InfixToPostfixCache.delete(s[k][0])}}K.InfixToPostfixCacheLimitSize=5e4,K.InfixToPostfixCacheCleanupSize=25e3,K._InfixToPostfixCache=new Map,K._OperatorPriority={")":0,"(":1,"||":2,"&&":3},K._Stack=["","","","","","","","","","","","","","","","","","","",""];class H extends K{constructor(s){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=s,this.not=k}isTrue(s){let k=void 0!==s[this.define];return this.not&&(k=!k),k}}class O extends K{isTrue(s){return this.leftOperand.isTrue(s)||this.rightOperand.isTrue(s)}}class c extends K{isTrue(s){return this.leftOperand.isTrue(s)&&this.rightOperand.isTrue(s)}}class S extends K{constructor(s,k,h){super(),this.define=s,this.operand=k,this.testValue=h}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(s){let k=!1;const h=parseInt(void 0!=s[this.define]?s[this.define]:this.define),A=parseInt(void 0!=s[this.testValue]?s[this.testValue]:this.testValue);if(isNaN(h)||isNaN(A))return!1;switch(this.operand){case">":k=h>A;break;case"<":k=h<A;break;case"<=":k=h<=A;break;case">=":k=h>=A;break;case"==":k=h===A;break;case"!=":k=h!==A}return k}}var a=h(12438),r=h(12467);const d=/defined\s*?\((.+?)\)/g,E=/defined\s*?\[(.+?)\]/g,j=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,P=/__decl__/,R=/light\{X\}.(\w*)/g,D=/\{X\}/g,w=[],B=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function u(s){s.processor&&s.processor.initializeShaders&&s.processor.initializeShaders(s.processingContext)}function G(s,k,h,A){var g;null!==(g=k.processor)&&void 0!==g&&g.preProcessShaderCode&&(s=k.processor.preProcessShaderCode(s,k.isFragment)),C(s,k,(s=>{k.processCodeAfterIncludes&&(s=k.processCodeAfterIncludes(k.isFragment?"fragment":"vertex",s,k.defines));const g=function(s,k,h){let A=function(s,k){var h;if(null!==(h=k.processor)&&void 0!==h&&h.noPrecision)return s;const A=k.shouldUseHighPrecisionShader;-1===s.indexOf("precision highp float")?s=A?"precision highp float;\n"+s:"precision mediump float;\n"+s:A||(s=s.replace("precision highp float","precision mediump float"));return s}(s,k);if(!k.processor)return A;if(0===k.processor.shaderLanguage&&-1!==A.indexOf("#version 3")&&(A=A.replace("#version 300 es",""),!k.processor.parseGLES3))return A;const g=k.defines,ms=z(k,h);k.processor.preProcessor&&(A=k.processor.preProcessor(A,g,ms,k.isFragment,k.processingContext));const i={};A=t(A,ms,k,i),k.processor.postProcessor&&(A=k.processor.postProcessor(A,g,k.isFragment,k.processingContext,h?{drawBuffersExtensionDisabled:!h.getCaps().drawBuffersExtension}:{},ms,i));null!==h&&void 0!==h&&h._features.needShaderCodeInlining&&(A=h.inlineShaderCode(A));return A}(s,k,A);h(g,s)}))}function Q(s,k,h){return h.processor&&h.processor.finalizeShaders?h.processor.finalizeShaders(s,k,h.processingContext):{vertexCode:s,fragmentCode:k}}function p(s){const k=/defined\((.+)\)/.exec(s);if(k&&k.length)return new H(k[1].trim(),"!"===s[0]);const h=["==","!=",">=","<=","<",">"];let A="",g=0;for(A of h)if(g=s.indexOf(A),g>-1)break;if(-1===g)return new H(s);const ms=s.substring(0,g).trim(),i=s.substring(g+A.length).trim();return new S(ms,A,i)}function I(s,k){const h=new i,A=s.substring(0,k);let g=s.substring(k);return g=g.substring(0,(g.indexOf("//")+1||g.length+1)-1).trim(),h.testExpression="#ifdef"===A?new H(g):"#ifndef"===A?new H(g,!0):function(s){s=s.replace(d,"defined[$1]");const k=K.infixToPostfix(s),h=[];for(const g of k)if("||"!==g&&"&&"!==g)h.push(g);else if(h.length>=2){let s=h[h.length-1],k=h[h.length-2];h.length-=2;const A="&&"==g?new c:new O;"string"===typeof s&&(s=s.replace(E,"defined($1)")),"string"===typeof k&&(k=k.replace(E,"defined($1)")),A.leftOperand="string"===typeof k?p(k):k,A.rightOperand="string"===typeof s?p(s):s,h.push(A)}let A=h[h.length-1];return"string"===typeof A&&(A=A.replace(E,"defined($1)")),"string"===typeof A?p(A):A}(g),h}function N(s,k,h,g){let ms=s.currentLine;for(;b(s,h,g);){ms=s.currentLine;const i=ms.substring(0,5).toLowerCase();if("#else"===i){const h=new A;return k.children.push(h),void b(s,h,g)}if("#elif"===i){const s=I(ms,5);k.children.push(s),h=s}}}function b(s,k,h){for(;s.canRead;){s.lineIndex++;const g=s.currentLine;if(g.indexOf("#")>=0){const A=B.exec(g);if(A&&A.length){switch(A[0]){case"#ifdef":{const A=new ms;k.children.push(A);const i=I(g,6);A.children.push(i),N(s,A,i,h);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const A=new ms;k.children.push(A);const i=I(g,7);A.children.push(i),N(s,A,i,h);break}case"#if":{const A=new ms,i=I(g,3);k.children.push(A),A.children.push(i),N(s,A,i,h);break}}continue}}const i=new A;if(i.line=g,k.children.push(i),"#"===g[0]&&"d"===g[1]){const s=g.replace(";","").split(" ");i.additionalDefineKey=s[1],3===s.length&&(i.additionalDefineValue=s[2])}}return!1}function t(s,k,h,ms){const i=new A,K=new g;return K.lineIndex=-1,K.lines=s.split("\n"),b(K,i,ms),i.process(k,h,ms)}function z(s,k){var h;const A=s.defines,g={};for(const ms of A){const s=ms.replace("#define","").replace(";","").trim().split(" ");g[s[0]]=s.length>1?s[1]:""}return 0===(null===(h=s.processor)||void 0===h?void 0:h.shaderLanguage)&&(g.GL_ES="true"),g.__VERSION__=s.version,g[s.platformName]="true",(0,r.g)(g,null===k||void 0===k?void 0:k.isNDCHalfZRange,null===k||void 0===k?void 0:k.rh,null===k||void 0===k?void 0:k.useExactSrgbConversions),g}function C(s,k,h){let A;for(w.length=0;null!==(A=j.exec(s));)w.push(A);let g=String(s),ms=[s],i=!1;for(const K of w){let s=K[1];if(-1!==s.indexOf("__decl__")&&(s=s.replace(P,""),k.supportsUniformBuffers&&(s=s.replace("Vertex","Ubo").replace("Fragment","Ubo")),s+="Declaration"),!k.includesShadersStore[s]){const A=k.shadersRepository+"ShadersInclude/"+s+".fx";return void v.loadFile(A,(A=>{k.includesShadersStore[s]=A,C(ms.join(""),k,h)}))}{let h=k.includesShadersStore[s];if(K[2]){const s=K[3].split(",");for(let k=0;k<s.length;k+=2){const A=new RegExp(s[k],"g"),g=s[k+1];h=h.replace(A,g)}}if(K[4]){const s=K[5];if(-1!==s.indexOf("..")){const A=s.split(".."),g=parseInt(A[0]);let ms=parseInt(A[1]),i=h.slice(0);h="",isNaN(ms)&&(ms=k.indexParameters[A[1]]);for(let s=g;s<ms;s++)k.supportsUniformBuffers||(i=i.replace(R,((s,k)=>k+"{X}"))),h+=i.replace(D,s.toString())+"\n"}else k.supportsUniformBuffers||(h=h.replace(R,((s,k)=>k+"{X}"))),h=h.replace(D,s)}const A=[];for(const s of ms){const k=s.split(K[0]);for(let s=0;s<k.length-1;s++)A.push(k[s]),A.push(h);A.push(k[k.length-1])}ms=A,i=i||h.indexOf("#include<")>=0||h.indexOf("#include <")>=0}}w.length=0,g=ms.join(""),i?C(g.toString(),k,h):h(g)}const v={loadFile:(s,k,h,A,g,ms)=>{throw(0,a.b)("FileTools")}}},12467:(s,k,h)=>{h.d(k,{b:()=>g,d:()=>ms,g:()=>K,k:()=>i,n:()=>H});var A=h(12438);h(12416);const g={};function ms(s,k){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(k?k+"\n":"")+s}function i(s,k,h,ms,i,K,H){const O=H||g.loadFile;if(O){return O(s,k,h,ms,i,K)}throw(0,A.b)("FileTools")}function K(s,k,h,A){if(s)return k?s.IS_NDC_HALF_ZRANGE="":delete s.IS_NDC_HALF_ZRANGE,h?s.USE_REVERSE_DEPTHBUFFER="":delete s.USE_REVERSE_DEPTHBUFFER,void(A?s.USE_EXACT_SRGB_CONVERSIONS="":delete s.USE_EXACT_SRGB_CONVERSIONS);{let s="";return k&&(s+="#define IS_NDC_HALF_ZRANGE"),h&&(s&&(s+="\n"),s+="#define USE_REVERSE_DEPTHBUFFER"),A&&(s&&(s+="\n"),s+="#define USE_EXACT_SRGB_CONVERSIONS"),s}}function H(s,k){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0;switch(s){case 3:{const s=(ArrayBuffer,new Int8Array(k));return A&&s.set(new Int8Array(A)),s}case 0:{const s=(ArrayBuffer,new Uint8Array(k));return A&&s.set(new Uint8Array(A)),s}case 4:{const s=k instanceof ArrayBuffer?new Int16Array(k):new Int16Array(h?k/2:k);return A&&s.set(new Int16Array(A)),s}case 5:case 8:case 9:case 10:case 2:{const s=k instanceof ArrayBuffer?new Uint16Array(k):new Uint16Array(h?k/2:k);return A&&s.set(new Uint16Array(A)),s}case 6:{const s=k instanceof ArrayBuffer?new Int32Array(k):new Int32Array(h?k/4:k);return A&&s.set(new Int32Array(A)),s}case 7:case 11:case 12:case 13:case 14:case 15:{const s=k instanceof ArrayBuffer?new Uint32Array(k):new Uint32Array(h?k/4:k);return A&&s.set(new Uint32Array(A)),s}case 1:{const s=k instanceof ArrayBuffer?new Float32Array(k):new Float32Array(h?k/4:k);return A&&s.set(new Float32Array(A)),s}}const g=(ArrayBuffer,new Uint8Array(k));return A&&g.set(new Uint8Array(A)),g}},12493:(s,k,h)=>{h.d(k,{e:()=>A});class A{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?A.ShadersRepository:A.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?A.ShadersStore:A.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?A.IncludesShadersStore:A.IncludesShadersStoreWGSL}}A.ShadersRepository="src/Shaders/",A.ShadersStore={},A.IncludesShadersStore={},A.ShadersRepositoryWGSL="src/ShadersWGSL/",A.ShadersStoreWGSL={},A.IncludesShadersStoreWGSL={}},12505:(s,k,h)=>{h.d(k,{d:()=>a,f:()=>D,i:()=>d,m:()=>r,o:()=>E,q:()=>R,s:()=>S,u:()=>O,w:()=>c,A:()=>H,B:()=>K});class A{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.jk._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(s){s&&this.program&&s(this.program)}setEngine(s){this.jk=s}_fillEffectInformation(s,k,h,A,g,ms,i,K){const H=this.jk;if(H.supportsUniformBuffers)for(const c in k)s.bindUniformBlock(c,k[c]);let O;for(this.jk.getUniforms(this,h).forEach(((s,k)=>{A[h[k]]=s})),this._uniforms=A,O=0;O<g.length;O++){null==s.getUniform(g[O])&&(g.splice(O,1),O--)}g.forEach(((s,k)=>{ms[s]=k}));for(const c of H.getAttributes(this,i))K.push(c)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(s,k){const h=this._valueCache[s],A=k.updateFlag;return(void 0===h||h!==A)&&(this._valueCache[s]=A,!0)}_cacheFloat2(s,k,h){let A=this._valueCache[s];if(!A||2!==A.length)return A=[k,h],this._valueCache[s]=A,!0;let g=!1;return A[0]!==k&&(A[0]=k,g=!0),A[1]!==h&&(A[1]=h,g=!0),g}_cacheFloat3(s,k,h,A){let g=this._valueCache[s];if(!g||3!==g.length)return g=[k,h,A],this._valueCache[s]=g,!0;let ms=!1;return g[0]!==k&&(g[0]=k,ms=!0),g[1]!==h&&(g[1]=h,ms=!0),g[2]!==A&&(g[2]=A,ms=!0),ms}_cacheFloat4(s,k,h,A,g){let ms=this._valueCache[s];if(!ms||4!==ms.length)return ms=[k,h,A,g],this._valueCache[s]=ms,!0;let i=!1;return ms[0]!==k&&(ms[0]=k,i=!0),ms[1]!==h&&(ms[1]=h,i=!0),ms[2]!==A&&(ms[2]=A,i=!0),ms[3]!==g&&(ms[3]=g,i=!0),i}setInt(s,k){const h=this._valueCache[s];void 0!==h&&h===k||this.jk.setInt(this._uniforms[s],k)&&(this._valueCache[s]=k)}setInt2(s,k,h){this._cacheFloat2(s,k,h)&&(this.jk.setInt2(this._uniforms[s],k,h)||(this._valueCache[s]=null))}setInt3(s,k,h,A){this._cacheFloat3(s,k,h,A)&&(this.jk.setInt3(this._uniforms[s],k,h,A)||(this._valueCache[s]=null))}setInt4(s,k,h,A,g){this._cacheFloat4(s,k,h,A,g)&&(this.jk.setInt4(this._uniforms[s],k,h,A,g)||(this._valueCache[s]=null))}setIntArray(s,k){this._valueCache[s]=null,this.jk.setIntArray(this._uniforms[s],k)}setIntArray2(s,k){this._valueCache[s]=null,this.jk.setIntArray2(this._uniforms[s],k)}setIntArray3(s,k){this._valueCache[s]=null,this.jk.setIntArray3(this._uniforms[s],k)}setIntArray4(s,k){this._valueCache[s]=null,this.jk.setIntArray4(this._uniforms[s],k)}setUInt(s,k){const h=this._valueCache[s];void 0!==h&&h===k||this.jk.setUInt(this._uniforms[s],k)&&(this._valueCache[s]=k)}setUInt2(s,k,h){this._cacheFloat2(s,k,h)&&(this.jk.setUInt2(this._uniforms[s],k,h)||(this._valueCache[s]=null))}setUInt3(s,k,h,A){this._cacheFloat3(s,k,h,A)&&(this.jk.setUInt3(this._uniforms[s],k,h,A)||(this._valueCache[s]=null))}setUInt4(s,k,h,A,g){this._cacheFloat4(s,k,h,A,g)&&(this.jk.setUInt4(this._uniforms[s],k,h,A,g)||(this._valueCache[s]=null))}setUIntArray(s,k){this._valueCache[s]=null,this.jk.setUIntArray(this._uniforms[s],k)}setUIntArray2(s,k){this._valueCache[s]=null,this.jk.setUIntArray2(this._uniforms[s],k)}setUIntArray3(s,k){this._valueCache[s]=null,this.jk.setUIntArray3(this._uniforms[s],k)}setUIntArray4(s,k){this._valueCache[s]=null,this.jk.setUIntArray4(this._uniforms[s],k)}setArray(s,k){this._valueCache[s]=null,this.jk.setArray(this._uniforms[s],k)}setArray2(s,k){this._valueCache[s]=null,this.jk.setArray2(this._uniforms[s],k)}setArray3(s,k){this._valueCache[s]=null,this.jk.setArray3(this._uniforms[s],k)}setArray4(s,k){this._valueCache[s]=null,this.jk.setArray4(this._uniforms[s],k)}setMatrices(s,k){k&&(this._valueCache[s]=null,this.jk.setMatrices(this._uniforms[s],k))}setMatrix(s,k){this._cacheMatrix(s,k)&&(this.jk.setMatrices(this._uniforms[s],k.yh())||(this._valueCache[s]=null))}setMatrix3x3(s,k){this._valueCache[s]=null,this.jk.setMatrix3x3(this._uniforms[s],k)}setMatrix2x2(s,k){this._valueCache[s]=null,this.jk.setMatrix2x2(this._uniforms[s],k)}setFloat(s,k){const h=this._valueCache[s];void 0!==h&&h===k||this.jk.setFloat(this._uniforms[s],k)&&(this._valueCache[s]=k)}setVector2(s,k){this._cacheFloat2(s,k.x,k.y)&&(this.jk.setFloat2(this._uniforms[s],k.x,k.y)||(this._valueCache[s]=null))}setFloat2(s,k,h){this._cacheFloat2(s,k,h)&&(this.jk.setFloat2(this._uniforms[s],k,h)||(this._valueCache[s]=null))}setVector3(s,k){this._cacheFloat3(s,k.x,k.y,k.z)&&(this.jk.setFloat3(this._uniforms[s],k.x,k.y,k.z)||(this._valueCache[s]=null))}setFloat3(s,k,h,A){this._cacheFloat3(s,k,h,A)&&(this.jk.setFloat3(this._uniforms[s],k,h,A)||(this._valueCache[s]=null))}setVector4(s,k){this._cacheFloat4(s,k.x,k.y,k.z,k.w)&&(this.jk.setFloat4(this._uniforms[s],k.x,k.y,k.z,k.w)||(this._valueCache[s]=null))}setQuaternion(s,k){this._cacheFloat4(s,k.x,k.y,k.z,k.w)&&(this.jk.setFloat4(this._uniforms[s],k.x,k.y,k.z,k.w)||(this._valueCache[s]=null))}setFloat4(s,k,h,A,g){this._cacheFloat4(s,k,h,A,g)&&(this.jk.setFloat4(this._uniforms[s],k,h,A,g)||(this._valueCache[s]=null))}setColor3(s,k){this._cacheFloat3(s,k.r,k.g,k.b)&&(this.jk.setFloat3(this._uniforms[s],k.r,k.g,k.b)||(this._valueCache[s]=null))}setColor4(s,k,h){this._cacheFloat4(s,k.r,k.g,k.b,h)&&(this.jk.setFloat4(this._uniforms[s],k.r,k.g,k.b,h)||(this._valueCache[s]=null))}setDirectColor4(s,k){this._cacheFloat4(s,k.r,k.g,k.b,k.a)&&(this.jk.setFloat4(this._uniforms[s],k.r,k.g,k.b,k.a)||(this._valueCache[s]=null))}_getVertexShaderCode(){return this.vertexShader?this.jk._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.jk._getShaderSource(this.fragmentShader):null}}var g=h(12467);const ms=new WeakMap,i={_webGLVersion:2,cachedPipelines:{}};function K(s){let k=ms.get(s);if(!k){if(!s)return i;k={_webGLVersion:s.TEXTURE_BINDING_3D?2:1,_context:s,parallelShaderCompile:s.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},ms.set(s,k)}return k}function H(s){ms.delete(s)}function O(s,k,h,A,g,ms){const i=K(A);ms||(ms=i._createShaderProgramInjection??a);return ms(s,P(k,"vertex",A,i._contextWasLost),P(h,"fragment",A,i._contextWasLost),A,g,i.validateShaderPrograms)}function c(s,k,h,A,g){let ms=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6?arguments[6]:void 0;const H=K(g);i||(i=H._createShaderProgramInjection??a);const O=H._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return i(s,j(k,"vertex",A,O,g,H._contextWasLost),j(h,"fragment",A,O,g,H._contextWasLost),g,ms,H.validateShaderPrograms)}function S(s,k){const h=new A,g=K(s);return g.parallelShaderCompile&&!g.disableParallelShaderCompile&&(h.isParallelCompiled=!0),h.context=g._context,h}function a(s,k,h,A){let g=arguments.length>5?arguments[5]:void 0;const ms=A.createProgram();if(s.program=ms,!ms)throw new Error("Unable to create program");return A.attachShader(ms,k),A.attachShader(ms,h),A.linkProgram(ms),s.context=A,s.vertexShader=k,s.fragmentShader=h,s.isParallelCompiled||d(s,A,g),ms}function r(s,k,h){const A=s;if(A._isDisposed)return!1;const g=K(k);return!!(g&&g.parallelShaderCompile&&g.parallelShaderCompile.COMPLETION_STATUS_KHR&&A.program&&k.getProgramParameter(A.program,g.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(d(A,k,h),!0)}function d(s,k,h){const A=s.context,g=s.vertexShader,ms=s.fragmentShader,i=s.program;if(!A.getProgramParameter(i,A.LINK_STATUS)){if(!k.getShaderParameter(g,k.COMPILE_STATUS)){const h=k.getShaderInfoLog(g);if(h)throw s.vertexCompilationError=h,new Error("VERTEX SHADER "+h)}if(!k.getShaderParameter(ms,k.COMPILE_STATUS)){const h=k.getShaderInfoLog(ms);if(h)throw s.fragmentCompilationError=h,new Error("FRAGMENT SHADER "+h)}const h=A.getProgramInfoLog(i);if(h)throw s.programLinkError=h,new Error(h)}if(h){A.validateProgram(i);if(!A.getProgramParameter(i,A.VALIDATE_STATUS)){const k=A.getProgramInfoLog(i);if(k)throw s.programValidationError=k,new Error(k)}}A.deleteShader(g),A.deleteShader(ms),s.vertexShader=void 0,s.fragmentShader=void 0,s.onCompiled&&(s.onCompiled(),s.onCompiled=void 0)}function E(s,k,h,A,g,ms,i,H,S){let a=arguments.length>10?arguments[10]:void 0,r=arguments.length>11?arguments[11]:void 0,d=arguments.length>12?arguments[12]:void 0;const E=K(s.context);r||(r=E.createRawShaderProgramInjection??O),d||(d=E.createShaderProgramInjection??c);const j=s;j.program=A?r(j,k,h,j.context,S):d(j,k,h,H,j.context,S),j.program.__SPECTOR_rebuildProgram=i,a()}function j(s,k,h,A,ms,i){return P((0,g.d)(s,h,A),k,ms,i)}function P(s,k,h,A){const g=h.createShader("vertex"===k?h.VERTEX_SHADER:h.FRAGMENT_SHADER);if(!g){let s=h.NO_ERROR,g=h.NO_ERROR;for(;(g=h.getError())!==h.NO_ERROR;)s=g;throw new Error(`Something went wrong while creating a gl ${k} shader object. gl error=${s}, gl isContextLost=${h.isContextLost()}, _contextWasLost=${A}`)}return h.shaderSource(g,s),h.compileShader(g),g}function R(s,k){k.useProgram(s)}function D(s,k){const h=s;if(!h.isParallelCompiled)return void k(s);const A=h.onCompiled;h.onCompiled=()=>{null===A||void 0===A||A(),k(s)}}},12501:(s,k,h)=>{h.d(k,{c:()=>S,e:()=>r,g:()=>O,i:()=>c});var A=h(12416),g=h(12505),ms=h(12493),i=h(12422),K=h(12461),H=h(12467);function O(s,k){return(0,g.B)(k).cachedPipelines[s]}function c(s){const k=s._name,h=s.context;if(k&&h){const s=(0,g.B)(h),A=s.cachedPipelines[k];null===A||void 0===A||A.dispose(),delete s.cachedPipelines[k]}}function S(s,k,h,g,ms,i,H){let O,c;const S=(0,A.i)()?null===i||void 0===i?void 0:i.getHostDocument():null;O="string"===typeof k?k:k.vertexSource?"source:"+k.vertexSource:k.vertexElement?(null===S||void 0===S?void 0:S.getElementById(k.vertexElement))||k.vertexElement:k.vertex||k,c="string"===typeof k?k:k.fragmentSource?"source:"+k.fragmentSource:k.fragmentElement?(null===S||void 0===S?void 0:S.getElementById(k.fragmentElement))||k.fragmentElement:k.fragment||k;const r=[void 0,void 0],d=()=>{if(r[0]&&r[1]){s.isFragment=!0;const[A,O]=r;(0,K.k)(O,s,((i,O)=>{H&&(H._fragmentSourceCodeBeforeMigration=O),h&&(i=h("fragment",i));const c=(0,K.e)(A,i,s);s=null;const S=function(s,k,h,A){if(h){return{vertexSourceCode:(1===A?"//":"")+"#define SHADER_NAME vertex:"+(h.vertexElement||h.vertex||h.spectorName||h)+"\n"+s,fragmentSourceCode:(1===A?"//":"")+"#define SHADER_NAME fragment:"+(h.fragmentElement||h.fragment||h.spectorName||h)+"\n"+k}}return{vertexSourceCode:s,fragmentSourceCode:k}}(c.vertexCode,c.fragmentCode,k,ms);null===g||void 0===g||g(S.vertexSourceCode,S.fragmentSourceCode)}),i)}};a(O,"Vertex","",(k=>{(0,K.h)(s),(0,K.k)(k,s,((s,A)=>{H&&(H._rawVertexSourceCode=k,H._vertexSourceCodeBeforeMigration=A),h&&(s=h("vertex",s)),r[0]=s,d()}),i)}),ms),a(c,"Fragment","Pixel",(s=>{H&&(H._rawFragmentSourceCode=s),r[1]=s,d()}),ms)}function a(s,k,h,g,i,K){if("undefined"!==typeof HTMLElement&&s instanceof HTMLElement){return void g((0,A.c)(s))}if("source:"===s.substring(0,7))return void g(s.substring(7));if("base64:"===s.substring(0,7)){return void g(window.atob(s.substring(7)))}const O=ms.e.GetShadersStore(i);if(O[s+k+"Shader"])return void g(O[s+k+"Shader"]);if(h&&O[s+h+"Shader"])return void g(O[s+h+"Shader"]);let c;if(c="."===s[0]||"/"===s[0]||s.indexOf("http")>-1?s:ms.e.GetShadersRepository(i)+s,!(K=K||H.k))throw new Error("loadFileInjection is not defined");K(c+"."+k.toLowerCase()+".fx",g)}const r=(s,k,h,A)=>{try{const ms=s.context?(0,g.B)(s.context):null;ms&&(ms.disableParallelShaderCompile=s.disableParallelCompilation);const i=s.existingPipelineContext||k(s.shaderProcessingContext);return i._name=s.name,s.name&&ms&&(ms.cachedPipelines[s.name]=i),h(i,s.vertex,s.fragment,!!s.createAsRaw,"","",s.rebuildRebind,s.defines,s.transformFeedbackVaryings,"",(()=>{A(i,(()=>{var k;null===(k=s.onRenderingStateCompiled)||void 0===k||k.call(s,i)}))})),i}catch(ms){throw i.c.Error("Error compiling effect"),ms}}},12489:(s,k,h)=>{h.r(k),h.d(k,{Effect:()=>H});var A=h(12408),g=h(12422),ms=h(12493),i=h(12501),K=h(12476);class H{static get ShadersRepository(){return ms.e.ShadersRepository}static set ShadersRepository(s){ms.e.ShadersRepository=s}get P(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new A.c),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(s,k,h){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,ms=arguments.length>4?arguments[4]:void 0,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,a=arguments.length>9?arguments[9]:void 0,r=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,E=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new A.c,this.onErrorObservable=new A.c,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=s,this._key=r;const j=this._key.replace(/\r/g,"").replace(/\n/g,"|");let P;if(k.attributes){const s=k;if(this._engine=h,this._attributesNames=s.attributes,this._uniformsNames=s.uniformsNames.concat(s.samplers),this._samplerList=s.samplers.slice(),this.defines=s.defines,this.onError=s.onError,this.onCompiled=s.onCompiled,this._fallbacks=s.fallbacks,this._indexParameters=s.indexParameters,this._transformFeedbackVaryings=s.transformFeedbackVaryings||null,this._multiTarget=!!s.multiTarget,this._shaderLanguage=s.shaderLanguage??0,this._disableParallelShaderCompilation=!!s.disableParallelShaderCompilation,s.uniformBuffersNames){this._uniformBuffersNamesList=s.uniformBuffersNames.slice();for(let k=0;k<s.uniformBuffersNames.length;k++)this._uniformBuffersNames[s.uniformBuffersNames[k]]=k}this._processFinalCode=s.processFinalCode??null,this._processCodeAfterIncludes=s.processCodeAfterIncludes??void 0,E=s.extraInitializationsAsync,P=s.existingPipelineContext}else this._engine=ms,this.defines=null==K?"":K,this._uniformsNames=h.concat(g),this._samplerList=g?g.slice():[],this._attributesNames=k,this._uniformBuffersNamesList=[],this._shaderLanguage=d,this.onError=S,this.onCompiled=c,this._indexParameters=a,this._fallbacks=O;"WEBGL2"===this._engine.shaderPlatformName&&(P=(0,i.g)(j,this._engine._gl)??P),this._attributeLocationByName={},this.uniqueId=H._UniqueIdSeed++,P?(this._pipelineContext=P,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,E),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.P||this.dispose(!0)}))}async _processShaderCodeAsync(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3?arguments[3]:void 0;A&&await A(),this._processingContext=h||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const g={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:s??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:ms.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:ms.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,rh:this._engine.rh,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,i.c)(g,this.name,this._processFinalCode,((s,h)=>{this._vertexSourceCode=s,this._fragmentSourceCode=h,this._prepareEffect(k)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.P||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(s){return this._attributes[s]}getAttributeLocationByName(s){return this._attributeLocationByName[s]}getAttributesCount(){return this._attributes.length}getUniformIndex(s){return this._uniformsNames.indexOf(s)}getUniform(s){return this._uniforms[s]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((s=>{this.executeWhenCompiled(s)}))}executeWhenCompiled(s){this.isReady()?s(this):(this.onCompileObservable.add((k=>{s(k)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(s){(0,K.e)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(k=>{this._processCompilationErrors(k,s)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var s;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(s=this._pipelineContext)||void 0===s?void 0:s._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var s;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(s=this._pipelineContext)||void 0===s?void 0:s._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,rh:this._engine.rh,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(s,k,h,A){this._isReady=!1,this._vertexSourceCodeOverride=s,this._fragmentSourceCodeOverride=k,this.onError=(s,k)=>{A&&A(k)},this.onCompiled=()=>{var s,k;const A=this.getEngine().scenes;if(A)for(let h=0;h<A.length;h++)A[h].markAllMaterialsAsDirty(127);null===(s=(k=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===s||s.call(k,h)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(s){if(this._pipelineContext=s,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let k=0;k<this._attributesNames.length;k++){const s=this._attributesNames[k];this._attributeLocationByName[s]=this._attributes[k]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),H.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const k=this._pipelineContext;this._isReady=!1;try{const h=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),A=h?null:this.defines,g=h?this._vertexSourceCodeOverride:this._vertexSourceCode,ms=h?this._fragmentSourceCodeOverride:this._fragmentSourceCode,K=this._engine;this._pipelineContext=(0,i.e)({existingPipelineContext:s?k:null,vertex:g,fragment:ms,context:"WEBGL2"===K.shaderPlatformName||"WEBGL1"===K.shaderPlatformName?K._gl:void 0,rebuildRebind:(s,k,h,A)=>this._rebuildProgram(s,k,h,A),defines:A,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:h,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:h=>{k&&!s&&this._engine._deletePipelineContext(k),h&&this._onRenderingStateCompiled(h)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(k)}catch(h){this._processCompilationErrors(h,k)}}_getShaderCodeAndErrorLine(s,k,h){const A=h?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let g=null;if(k&&s){const ms=k.match(A);if(ms&&2===ms.length){const k=parseInt(ms[1]),A=s.split("\n",-1);A.length>=k&&(g=`Offending line [${k}] in ${h?"fragment":"vertex"} code: ${A[k-1]}`)}}return[s,g]}_processCompilationErrors(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=s.message;const h=this._attributesNames,A=this._fallbacks;if(g.c.Error("Unable to compile effect:"),g.c.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),g.c.Error(`Attributes: ${h.join(" ")}`),g.c.Error("Defines:\n"+this.defines),H.LogShaderCodeOnCompilationError){var ms,i;let s=null,k=null,h=null;var K;if(null!==(ms=this._pipelineContext)&&void 0!==ms&&ms._getVertexShaderCode()&&([h,s]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),h&&(g.c.Error("Vertex code:"),g.c.Error(h))),null!==(i=this._pipelineContext)&&void 0!==i&&i._getFragmentShaderCode())[h,k]=this._getShaderCodeAndErrorLine(null===(K=this._pipelineContext)||void 0===K?void 0:K._getFragmentShaderCode(),this._compilationError,!0),h&&(g.c.Error("Fragment code:"),g.c.Error(h));s&&g.c.Error(s),k&&g.c.Error(k)}g.c.Error("Error: "+this._compilationError);const O=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};k&&(this._pipelineContext=k,this._isReady=!0,O()),A?(this._pipelineContext=null,A.hasMoreFallbacks?(this._allFallbacksProcessed=!1,g.c.Error("Trying next fallback."),this.defines=A.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,O(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,k||O())}get isSupported(){return""===this._compilationError}_bindTexture(s,k){this._engine._bindTexture(this._samplers[s],k,s)}setTexture(s,k){this._engine.setTexture(this._samplers[s],this._uniforms[s],k,s)}setTextureArray(s,k){const h=s+"Ex";if(-1===this._samplerList.indexOf(h+"0")){const A=this._samplerList.indexOf(s);for(let s=1;s<k.length;s++){const k=h+(s-1).toString();this._samplerList.splice(A+s,0,k)}let g=0;for(const s of this._samplerList)this._samplers[s]=g,g+=1}this._engine.setTextureArray(this._samplers[s],this._uniforms[s],k,s)}bindUniformBuffer(s,k){const h=this._uniformBuffersNames[k];void 0===h||H._BaseCache[h]===s&&this._engine._features.useUBOBindingCache||(H._BaseCache[h]=s,this._engine.bindUniformBufferBase(s,h,k))}bindUniformBlock(s,k){this._engine.bindUniformBlock(this._pipelineContext,s,k)}setInt(s,k){return this._pipelineContext.setInt(s,k),this}setInt2(s,k,h){return this._pipelineContext.setInt2(s,k,h),this}setInt3(s,k,h,A){return this._pipelineContext.setInt3(s,k,h,A),this}setInt4(s,k,h,A,g){return this._pipelineContext.setInt4(s,k,h,A,g),this}setIntArray(s,k){return this._pipelineContext.setIntArray(s,k),this}setIntArray2(s,k){return this._pipelineContext.setIntArray2(s,k),this}setIntArray3(s,k){return this._pipelineContext.setIntArray3(s,k),this}setIntArray4(s,k){return this._pipelineContext.setIntArray4(s,k),this}setUInt(s,k){return this._pipelineContext.setUInt(s,k),this}setUInt2(s,k,h){return this._pipelineContext.setUInt2(s,k,h),this}setUInt3(s,k,h,A){return this._pipelineContext.setUInt3(s,k,h,A),this}setUInt4(s,k,h,A,g){return this._pipelineContext.setUInt4(s,k,h,A,g),this}setUIntArray(s,k){return this._pipelineContext.setUIntArray(s,k),this}setUIntArray2(s,k){return this._pipelineContext.setUIntArray2(s,k),this}setUIntArray3(s,k){return this._pipelineContext.setUIntArray3(s,k),this}setUIntArray4(s,k){return this._pipelineContext.setUIntArray4(s,k),this}setFloatArray(s,k){return this._pipelineContext.setArray(s,k),this}setFloatArray2(s,k){return this._pipelineContext.setArray2(s,k),this}setFloatArray3(s,k){return this._pipelineContext.setArray3(s,k),this}setFloatArray4(s,k){return this._pipelineContext.setArray4(s,k),this}setArray(s,k){return this._pipelineContext.setArray(s,k),this}setArray2(s,k){return this._pipelineContext.setArray2(s,k),this}setArray3(s,k){return this._pipelineContext.setArray3(s,k),this}setArray4(s,k){return this._pipelineContext.setArray4(s,k),this}setMatrices(s,k){return this._pipelineContext.setMatrices(s,k),this}setMatrix(s,k){return this._pipelineContext.setMatrix(s,k),this}setMatrix3x3(s,k){return this._pipelineContext.setMatrix3x3(s,k),this}setMatrix2x2(s,k){return this._pipelineContext.setMatrix2x2(s,k),this}setFloat(s,k){return this._pipelineContext.setFloat(s,k),this}setBool(s,k){return this._pipelineContext.setInt(s,k?1:0),this}setVector2(s,k){return this._pipelineContext.setVector2(s,k),this}setFloat2(s,k,h){return this._pipelineContext.setFloat2(s,k,h),this}setVector3(s,k){return this._pipelineContext.setVector3(s,k),this}setFloat3(s,k,h,A){return this._pipelineContext.setFloat3(s,k,h,A),this}setVector4(s,k){return this._pipelineContext.setVector4(s,k),this}setQuaternion(s,k){return this._pipelineContext.setQuaternion(s,k),this}setFloat4(s,k,h,A,g){return this._pipelineContext.setFloat4(s,k,h,A,g),this}setColor3(s,k){return this._pipelineContext.setColor3(s,k),this}setColor4(s,k,h){return this._pipelineContext.setColor4(s,k,h),this}setDirectColor4(s,k){return this._pipelineContext.setDirectColor4(s,k),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(H.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,i.i)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(s,k,h){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;k&&(ms.e.GetShadersStore(A)[`${s}PixelShader`]=k),h&&(ms.e.GetShadersStore(A)[`${s}VertexShader`]=h)}static ResetCache(){H._BaseCache={}}}H.LogShaderCodeOnCompilationError=!0,H.PersistentMode=!1,H.AutomaticallyClearCodeCache=!1,H._UniqueIdSeed=0,H._BaseCache={},H.ShadersStore=ms.e.ShadersStore,H.IncludesShadersStore=ms.e.IncludesShadersStore},12438:(s,k,h)=>{h.d(k,{b:()=>g});const A={};function g(s){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!A[s])return A[s]=!0,`${s} needs to be imported before as it contains a side-effect required by your code.`}},12416:(s,k,h)=>{function A(){return"undefined"!==typeof window}function g(){return"undefined"!==typeof navigator}function ms(){return"undefined"!==typeof document}function i(s){let k="",h=s.firstChild;for(;h;)3===h.nodeType&&(k+=h.textContent),h=h.nextSibling;return k}h.d(k,{c:()=>i,d:()=>ms,e:()=>g,i:()=>A})},12422:(s,k,h)=>{h.d(k,{c:()=>A});class A{static _CheckLimit(s,k){let h=A._LogLimitOutputs[s];return h?h.current++:(h={limit:k,current:1},A._LogLimitOutputs[s]=h),h.current<=h.limit}static _GenerateLimitMessage(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const h=A._LogLimitOutputs[s];if(!h||!A.MessageLimitReached)return;const g=this._Levels[k];h.current===h.limit&&A[g.name](A.MessageLimitReached.replace(/%LIMIT%/g,""+h.limit).replace(/%TYPE%/g,g.name??""))}static _AddLogEntry(s){A._LogCache=s+A._LogCache,A.OnNewCacheEntry&&A.OnNewCacheEntry(s)}static _FormatMessage(s){const k=s=>s<10?"0"+s:""+s,h=new Date;return"["+k(h.getHours())+":"+k(h.getMinutes())+":"+k(h.getSeconds())+"]: "+s}static _LogDisabled(s,k){}static _LogEnabled(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,k=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;const g=Array.isArray(k)?k[0]:k;if(void 0!==h&&!A._CheckLimit(g,h))return;const ms=A._FormatMessage(g),i=this._Levels[s],K=Array.isArray(k)?k.slice(1):[];i.logFunc&&i.logFunc("BJS - "+ms,...K);const H=`<div style='color:${i.color}'>${ms}</div><br>`;A._AddLogEntry(H),A._GenerateLimitMessage(g,s)}static get LogCache(){return A._LogCache}static ClearLogCache(){A._LogCache="",A._LogLimitOutputs={},A.errorsCount=0}static set LogLevels(s){A.Log=A._LogDisabled,A.Warn=A._LogDisabled,A.Error=A._LogDisabled;const k=[A.MessageLogLevel,A.WarningLogLevel,A.ErrorLogLevel];for(const h of k)if((s&h)===h){const s=this._Levels[h];A[s.name]=A._LogEnabled.bind(A,h)}}}A.NoneLogLevel=0,A.MessageLogLevel=1,A.WarningLogLevel=2,A.ErrorLogLevel=4,A.AllLogLevel=7,A.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",A._LogCache="",A._LogLimitOutputs={},A._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],A.errorsCount=0,A.Log=A._LogEnabled.bind(A,A.MessageLogLevel),A.Warn=A._LogEnabled.bind(A,A.WarningLogLevel),A.Error=A._LogEnabled.bind(A,A.ErrorLogLevel)},12408:(s,k,h)=>{h.d(k,{c:()=>i});const A="undefined"!==typeof WeakRef;class g{constructor(s){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0,A=arguments.length>3?arguments[3]:void 0;this.initialize(s,k,h,A)}initialize(s){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0,A=arguments.length>3?arguments[3]:void 0;return this.mask=s,this.skipNextObservers=k,this.target=h,this.currentTarget=A,this}}class ms{constructor(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=s,this.mask=k,this.scope=h,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(s)}}class i{static FromPromise(s,k){const h=new i;return s.then((s=>{h.notifyObservers(s)})).catch((s=>{if(!k)throw s;k.notifyObservers(s)})),h}get observers(){return this._observers}constructor(s){let k=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=k,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new g(0),s&&(this._onObserverAdded=s)}add(s){let k=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!s)return null;const g=new ms(s,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);g.unregisterOnNextCall=h,k?this._observers.unshift(g):this._observers.push(g),this._onObserverAdded&&this._onObserverAdded(g),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(g,this._lastNotifiedValue);const i=A?new WeakRef(this):{deref:()=>this};return g._remove=function(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const k=i.deref();k&&(s?k.remove(g):k._remove(g))},g}addOnce(s){return this.add(s,void 0,void 0,void 0,!0)}remove(s){if(!s)return!1;s._remove=null;return-1!==this._observers.indexOf(s)&&(this._deferUnregister(s),!0)}removeCallback(s,k){for(let h=0;h<this._observers.length;h++){const A=this._observers[h];if(!A._willBeUnregistered&&(A.callback===s&&(!k||k===A.scope)))return this._deferUnregister(A),!0}return!1}_deferUnregister(s){s._willBeUnregistered||(this._numObserversMarkedAsDeleted++,s.unregisterOnNextCall=!1,s._willBeUnregistered=!0,setTimeout((()=>{this._remove(s)}),0))}_remove(s){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!s)return!1;const h=this._observers.indexOf(s);return-1!==h&&(k&&this._numObserversMarkedAsDeleted--,this._observers.splice(h,1),!0)}makeObserverTopPriority(s){this._remove(s,!1),this._observers.unshift(s)}makeObserverBottomPriority(s){this._remove(s,!1),this._observers.push(s)}notifyObservers(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,h=arguments.length>2?arguments[2]:void 0,A=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=s),!this._observers.length)return!0;const ms=this._eventState;ms.mask=k,ms.target=h,ms.currentTarget=A,ms.skipNextObservers=!1,ms.lastReturnValue=s,ms.userInfo=g;for(const i of this._observers)if(!i._willBeUnregistered&&(i.mask&k&&(i.unregisterOnNextCall&&this._deferUnregister(i),i.scope?ms.lastReturnValue=i.callback.apply(i.scope,[s,ms]):ms.lastReturnValue=i.callback(s,ms)),ms.skipNextObservers))return!1;return!0}notifyObserver(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=k),s._willBeUnregistered)return;const A=this._eventState;A.mask=h,A.skipNextObservers=!1,s.unregisterOnNextCall&&this._deferUnregister(s),s.callback(k,A)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const s=this._observers.pop();s&&(s._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const s=new i;return s._observers=this._observers.slice(0),s}hasSpecificMask(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const k of this._observers)if(k.mask&s||k.mask===s)return!0;return!1}}},12476:(s,k,h)=>{h.d(k,{d:()=>g,e:()=>i});let A=[];class g{static SetImmediate(s){0===A.length&&setTimeout((()=>{const s=A;A=[];for(const k of s)k()}),1),A.push(s)}}function ms(s,k,h){try{if(s())return k(),!0}catch(A){return null===h||void 0===h||h(A),!0}return!1}const i=function(s,k,h){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,i=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&ms(s,k,h))return null;const K=setInterval((()=>{ms(s,k,h)?clearInterval(K):(g-=A,g<0&&(clearInterval(K),null===h||void 0===h||h(new Error("Operation timed out after maximum retries. "+(i||"")),!0)))}),A);return()=>clearInterval(K)}}}]);