/*! For license information please see 86dvjm.9.21a1ae50.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{12549:(v,y,n)=>{"use strict";var B=n(12551),J=n(12553),P=n(12557);n.g.__TYPEDARRAY_POOL||(n.g.__TYPEDARRAY_POOL={UINT8:J([32,0]),UINT16:J([32,0]),UINT32:J([32,0]),INT8:J([32,0]),INT16:J([32,0]),INT32:J([32,0]),FLOAT:J([32,0]),DOUBLE:J([32,0]),DATA:J([32,0]),UINT8C:J([32,0]),BUFFER:J([32,0])});var b="undefined"!==typeof Uint8ClampedArray,Y=n.g.__TYPEDARRAY_POOL;Y.UINT8C||(Y.UINT8C=J([32,0])),Y.BUFFER||(Y.BUFFER=J([32,0]));var l=Y.DATA,a=Y.BUFFER;function Z(v){if(v){var y=v.length||v.byteLength,n=B.log2(y);l[n].push(v)}}function x(v){v=B.nextPow2(v);var y=B.log2(v),n=l[y];return n.length>0?n.pop():new ArrayBuffer(v)}function f(v){return new Uint8Array(x(v),0,v)}function N(v){return new Uint16Array(x(2*v),0,v)}function i(v){return new Uint32Array(x(4*v),0,v)}function g(v){return new Int8Array(x(v),0,v)}function c(v){return new Int16Array(x(2*v),0,v)}function h(v){return new Int32Array(x(4*v),0,v)}function E(v){return new Float32Array(x(4*v),0,v)}function W(v){return new Float64Array(x(8*v),0,v)}function s(v){return b?new Uint8ClampedArray(x(v),0,v):f(v)}function C(v){return new DataView(x(v),0,v)}y.free=function(v){if(P(v))a[B.log2(v.length)].push(v);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(v)&&(v=v.buffer),!v)return;var y=v.length||v.byteLength,n=0|B.log2(y);l[n].push(v)}},y.freeUint8=y.freeUint16=y.freeUint32=y.freeInt8=y.freeInt16=y.freeInt32=y.freeFloat32=y.freeFloat=y.freeFloat64=y.freeDouble=y.freeUint8Clamped=y.freeDataView=function(v){Z(v.buffer)},y.freeArrayBuffer=Z,y.freeBuffer=function(v){a[B.log2(v.length)].push(v)},y.malloc=function(v,y){if(void 0===y||"arraybuffer"===y)return x(v);switch(y){case"uint8":return f(v);case"uint16":return N(v);case"uint32":return i(v);case"int8":return g(v);case"int16":return c(v);case"int32":return h(v);case"float":case"float32":return E(v);case"double":case"float64":return W(v);case"uint8_clamped":return s(v);case"buffer":throw"Buffer not supported";case"data":case"dataview":return C(v);default:return null}return null},y.mallocArrayBuffer=x,y.mallocUint8=f,y.mallocUint16=N,y.mallocUint32=i,y.mallocInt8=g,y.mallocInt16=c,y.mallocInt32=h,y.mallocFloat32=y.mallocFloat=E,y.mallocFloat64=y.mallocDouble=W,y.mallocUint8Clamped=s,y.mallocDataView=C,y.clearCache=function(){for(var v=0;v<32;++v)Y.UINT8[v].length=0,Y.UINT16[v].length=0,Y.UINT32[v].length=0,Y.INT8[v].length=0,Y.INT16[v].length=0,Y.INT32[v].length=0,Y.FLOAT[v].length=0,Y.DOUBLE[v].length=0,Y.UINT8C[v].length=0,l[v].length=0,a[v].length=0}},12643:(v,y,n)=>{v.exports=J;var B=n(11994);function J(v,y){if(!(this instanceof J))return new J(v,y);var n=B.create();B.add(n,v,y),this.base=B.min(B.create(),v,n),this.wh=B.clone(y),this.max=B.max(B.create(),v,n),this.mag=B.length(this.wh)}var P=J.prototype;P.width=function(){return this.wh[0]},P.height=function(){return this.wh[1]},P.depth=function(){return this.wh[2]},P.x0=function(){return this.base[0]},P.y0=function(){return this.base[1]},P.z0=function(){return this.base[2]},P.x1=function(){return this.max[0]},P.y1=function(){return this.max[1]},P.z1=function(){return this.max[2]},P.translate=function(v){return B.add(this.max,this.max,v),B.add(this.base,this.base,v),this},P.setPosition=function(v){return B.add(this.max,v,this.wh),B.i(this.base,v),this},P.expand=function(v){var y=B.create(),n=B.create();return B.max(y,v.max,this.max),B.min(n,v.base,this.base),B.od(y,y,n),new J(n,y)},P.intersects=function(v){return!(v.base[0]>this.max[0])&&(!(v.base[1]>this.max[1])&&(!(v.base[2]>this.max[2])&&(!(v.max[0]<this.base[0])&&(!(v.max[1]<this.base[1])&&!(v.max[2]<this.base[2])))))},P.touches=function(v){var y=this.union(v);return null!==y&&(0==y.width()||0==y.height()||0==y.depth())},P.union=function(v){if(!this.intersects(v))return null;var y=Math.max(v.base[0],this.base[0]),n=Math.max(v.base[1],this.base[1]),B=Math.max(v.base[2],this.base[2]);return new J([y,n,B],[Math.min(v.max[0],this.max[0])-y,Math.min(v.max[1],this.max[1])-n,Math.min(v.max[2],this.max[2])-B])}},12551:(v,y)=>{"use strict";function n(v){var y=32;return(v&=-v)&&y--,65535&v&&(y-=16),16711935&v&&(y-=8),252645135&v&&(y-=4),858993459&v&&(y-=2),1431655765&v&&(y-=1),y}y.INT_BITS=32,y.INT_MAX=2147483647,y.INT_MIN=-1<<31,y.sign=function(v){return(v>0)-(v<0)},y.abs=function(v){var y=v>>31;return(v^y)-y},y.min=function(v,y){return y^(v^y)&-(v<y)},y.max=function(v,y){return v^(v^y)&-(v<y)},y.isPow2=function(v){return!(v&v-1)&&!!v},y.log2=function(v){var y,n;return y=(v>65535)<<4,y|=n=((v>>>=y)>255)<<3,y|=n=((v>>>=n)>15)<<2,(y|=n=((v>>>=n)>3)<<1)|(v>>>=n)>>1},y.log10=function(v){return v>=1e9?9:v>=1e8?8:v>=1e7?7:v>=1e6?6:v>=1e5?5:v>=1e4?4:v>=1e3?3:v>=100?2:v>=10?1:0},y.popCount=function(v){return 16843009*((v=(858993459&(v-=v>>>1&1431655765))+(v>>>2&858993459))+(v>>>4)&252645135)>>>24},y.countTrailingZeros=n,y.nextPow2=function(v){return v+=0===v,--v,v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)+1},y.prevPow2=function(v){return v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)-(v>>>1)},y.parity=function(v){return v^=v>>>16,v^=v>>>8,v^=v>>>4,27030>>>(v&=15)&1};var B=new Array(256);!function(v){for(var y=0;y<256;++y){var n=y,B=y,J=7;for(n>>>=1;n;n>>>=1)B<<=1,B|=1&n,--J;v[y]=B<<J&255}}(B),y.reverse=function(v){return B[255&v]<<24|B[v>>>8&255]<<16|B[v>>>16&255]<<8|B[v>>>24&255]},y.interleave2=function(v,y){return(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y&=65535)|y<<8))|y<<4))|y<<2))|y<<1))<<1},y.deinterleave2=function(v,y){return(v=65535&((v=16711935&((v=252645135&((v=858993459&((v=v>>>y&1431655765)|v>>>1))|v>>>2))|v>>>4))|v>>>16))<<16>>16},y.interleave3=function(v,y,n){return v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2),(v|=(y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},y.deinterleave3=function(v,y){return(v=1023&((v=4278190335&((v=251719695&((v=3272356035&((v=v>>>y&1227133513)|v>>>2))|v>>>4))|v>>>8))|v>>>16))<<22>>22},y.nextCombination=function(v){var y=v|v-1;return y+1|(~y&-~y)-1>>>n(v)+1}},12545:(v,y,n)=>{"use strict";v.exports=function(v,y,n){switch(arguments.length){case 1:return B=[],a(J=v,J,Z,!0),B;case 2:return"function"===typeof y?a(v,v,y,!0):function(v,y){return B=[],a(v,y,Z,!1),B}(v,y);case 3:return a(v,y,n,!1);default:throw new Error("box-intersect: Invalid arguments")}var J};var B,J=n(12549),P=n(12565),b=n(12575);function Y(v,y){for(var n=0;n<v;++n)if(!(y[n]<=y[n+v]))return!0;return!1}function l(v,y,n,B){for(var J=0,P=0,b=0,l=v.length;b<l;++b){var a=v[b];if(!Y(y,a)){for(var Z=0;Z<2*y;++Z)n[J++]=a[Z];B[P++]=b}}return P}function a(v,y,n,B){var Y=v.length,a=y.length;if(!(Y<=0||a<=0)){var Z=v[0].length>>>1;if(!(Z<=0)){var x,f=J.mallocDouble(2*Z*Y),N=J.mallocInt32(Y);if((Y=l(v,Z,f,N))>0){if(1===Z&&B)P.init(Y),x=P.sweepComplete(Z,n,0,Y,f,N,0,Y,f,N);else{var i=J.mallocDouble(2*Z*a),g=J.mallocInt32(a);(a=l(y,Z,i,g))>0&&(P.init(Y+a),x=1===Z?P.sweepBipartite(Z,n,0,Y,f,N,0,a,i,g):b(Z,n,B,Y,f,N,a,i,g),J.free(i),J.free(g))}J.free(f),J.free(N)}return x}}}function Z(v,y){B.push([v,y])}},12583:(v,y)=>{"use strict";var n="d",B="ax",J="fp",P="es",b="rs",Y="re",l="rb",a="bs",Z="be",x="bb",f=[n,B,"vv",b,Y,l,"ri",a,Z,x,"bi"];function N(v){var y="bruteForce"+(v?"Full":"Partial"),B=[],b=f.slice();v||b.splice(3,0,J);var Y=["function "+y+"("+b.join()+"){"];function l(y,J){var b=function(v,y,B){var J="bruteForce"+(v?"Red":"Blue")+(y?"Flip":"")+(B?"Full":""),b=["function ",J,"(",f.join(),"){","var ",P,"=2*",n,";"],Y="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",l="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(B?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return v?b.push(Y,"Q",":",l):b.push(l,"Q",":",Y),B?b.push("if(y1<x0||x1<y0)continue;"):y?b.push("if(y0<=x0||x1<y0)continue;"):b.push("if(y0<x0||x1<y0)continue;"),b.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),y?b.push("yi,xi"):b.push("xi,yi"),b.push(");if(rv!==void 0)return rv;}}}"),{name:J,code:b.join("")}}(y,J,v);B.push(b.code),Y.push("return "+b.name+"("+f.join()+");")}Y.push("if(re-rs>be-bs){"),v?(l(!0,!1),Y.push("}else{"),l(!1,!1)):(Y.push("if(fp){"),l(!0,!0),Y.push("}else{"),l(!0,!1),Y.push("}}else{if(fp){"),l(!1,!0),Y.push("}else{"),l(!1,!1),Y.push("}")),Y.push("}}return "+y);var a=B.join("")+Y.join("");return new Function(a)()}y.partial=N(!1),y.full=N(!0)},12575:(v,y,n)=>{"use strict";v.exports=function(v,y,n,P,Z,L,t,G,R){!function(v,y){var n=8*J.log2(y+1)*(v+1)|0,P=J.nextPow2(s*n);r.length<P&&(B.free(r),r=B.mallocInt32(P));var b=J.nextPow2(C*n);u.length<b&&(B.free(u),u=B.mallocDouble(b))}(v,P+t);var F,S=0,w=2*v;O(S++,0,0,P,0,t,n?16:0,-1/0,1/0),n||O(S++,0,0,t,0,P,1,-1/0,1/0);for(;S>0;){var k=(S-=1)*s,M=r[k],I=r[k+1],j=r[k+2],V=r[k+3],p=r[k+4],H=r[k+5],A=S*C,X=u[A],U=u[A+1],z=1&H,e=!!(16&H),K=Z,D=L,Q=G,o=R;if(z&&(K=G,D=R,Q=Z,o=L),!(2&H&&I>=(j=c(v,M,I,j,K,D,U)))&&!(4&H&&(I=h(v,M,I,j,K,D,X))>=j)){var T=j-I,m=p-V;if(e){if(v*T*(T+m)<N){if(void 0!==(F=l.scanComplete(v,M,y,I,j,K,D,V,p,Q,o)))return F;continue}}else{if(v*Math.min(T,m)<x){if(void 0!==(F=b(v,M,y,z,I,j,K,D,V,p,Q,o)))return F;continue}if(v*T*m<f){if(void 0!==(F=l.scanBipartite(v,M,y,z,I,j,K,D,V,p,Q,o)))return F;continue}}var vv=i(v,M,I,j,K,D,X,U);if(I<vv)if(v*(vv-I)<x){if(void 0!==(F=Y(v,M+1,y,I,vv,K,D,V,p,Q,o)))return F}else if(M===v-2){if(void 0!==(F=z?l.sweepBipartite(v,y,V,p,Q,o,I,vv,K,D):l.sweepBipartite(v,y,I,vv,K,D,V,p,Q,o)))return F}else O(S++,M+1,I,vv,V,p,z,-1/0,1/0),O(S++,M+1,V,p,I,vv,1^z,-1/0,1/0);if(vv<j){var yv=a(v,M,V,p,Q,o),nv=Q[w*yv+M],Bv=g(v,M,yv,p,Q,o,nv);if(Bv<p&&O(S++,M,vv,j,Bv,p,(4|z)+(e?16:0),nv,U),V<yv&&O(S++,M,vv,j,V,yv,(2|z)+(e?16:0),X,nv),yv+1===Bv){if(void 0!==(F=e?q(v,M,y,vv,j,K,D,yv,Q,o[yv]):d(v,M,y,z,vv,j,K,D,yv,Q,o[yv])))return F}else if(yv<Bv){var Jv;if(e){if(vv<(Jv=E(v,M,vv,j,K,D,nv))){var Pv=g(v,M,vv,Jv,K,D,nv);if(M===v-2){if(vv<Pv&&void 0!==(F=l.sweepComplete(v,y,vv,Pv,K,D,yv,Bv,Q,o)))return F;if(Pv<Jv&&void 0!==(F=l.sweepBipartite(v,y,Pv,Jv,K,D,yv,Bv,Q,o)))return F}else vv<Pv&&O(S++,M+1,vv,Pv,yv,Bv,16,-1/0,1/0),Pv<Jv&&(O(S++,M+1,Pv,Jv,yv,Bv,0,-1/0,1/0),O(S++,M+1,yv,Bv,Pv,Jv,1,-1/0,1/0))}}else vv<(Jv=z?W(v,M,vv,j,K,D,nv):E(v,M,vv,j,K,D,nv))&&(M===v-2?F=z?l.sweepBipartite(v,y,yv,Bv,Q,o,vv,Jv,K,D):l.sweepBipartite(v,y,vv,Jv,K,D,yv,Bv,Q,o):(O(S++,M+1,vv,Jv,yv,Bv,z,-1/0,1/0),O(S++,M+1,yv,Bv,vv,Jv,1^z,-1/0,1/0)))}}}}};var B=n(12549),J=n(12551),P=n(12583),b=P.partial,Y=P.full,l=n(12565),a=n(12591),Z=n(12600),x=128,f=1<<22,N=1<<22,i=Z("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),g=Z("lo===p0",["p0"]),c=Z("lo<p0",["p0"]),h=Z("hi<=p0",["p0"]),E=Z("lo<=p0&&p0<=hi",["p0"]),W=Z("lo<p0&&p0<=hi",["p0"]),s=6,C=2,r=B.mallocInt32(1024),u=B.mallocDouble(1024);function O(v,y,n,B,J,P,b,Y,l){var a=s*v;r[a]=y,r[a+1]=n,r[a+2]=B,r[a+3]=J,r[a+4]=P,r[a+5]=b;var Z=C*v;u[Z]=Y,u[Z+1]=l}function d(v,y,n,B,J,P,b,Y,l,a,Z){var x=2*v,f=l*x,N=a[f+y];v:for(var i=J,g=J*x;i<P;++i,g+=x){var c=b[g+y],h=b[g+y+v];if(!(N<c||h<N)&&(!B||N!==c)){for(var E,W=Y[i],s=y+1;s<v;++s){c=b[g+s],h=b[g+s+v];var C=a[f+s],r=a[f+s+v];if(h<C||r<c)continue v}if(void 0!==(E=B?n(Z,W):n(W,Z)))return E}}}function q(v,y,n,B,J,P,b,Y,l,a){var Z=2*v,x=Y*Z,f=l[x+y];v:for(var N=B,i=B*Z;N<J;++N,i+=Z){var g=b[N];if(g!==a){var c=P[i+y],h=P[i+y+v];if(!(f<c||h<f)){for(var E=y+1;E<v;++E){c=P[i+E],h=P[i+E+v];var W=l[x+E],s=l[x+E+v];if(h<W||s<c)continue v}var C=n(g,a);if(void 0!==C)return C}}}}},12591:(v,y,n)=>{"use strict";v.exports=function(v,y,n,b,Y,l){if(b<=n+1)return n;var a=n,Z=b,x=b+n>>>1,f=2*v,N=x,i=Y[f*x+y];for(;a<Z;){if(Z-a<J){P(v,y,a,Z,Y,l),i=Y[f*x+y];break}var g=Z-a,c=Math.random()*g+a|0,h=Y[f*c+y],E=Math.random()*g+a|0,W=Y[f*E+y],s=Math.random()*g+a|0,C=Y[f*s+y];h<=W?C>=W?(N=E,i=W):h>=C?(N=c,i=h):(N=s,i=C):W>=C?(N=E,i=W):C>=h?(N=c,i=h):(N=s,i=C);for(var r=f*(Z-1),u=f*N,O=0;O<f;++O,++r,++u){var d=Y[r];Y[r]=Y[u],Y[u]=d}var q=l[Z-1];l[Z-1]=l[N],l[N]=q;for(r=f*(Z-1),u=f*(N=B(v,y,a,Z-1,Y,l,i)),O=0;O<f;++O,++r,++u){d=Y[r];Y[r]=Y[u],Y[u]=d}q=l[Z-1];if(l[Z-1]=l[N],l[N]=q,x<N){for(Z=N-1;a<Z&&Y[f*(Z-1)+y]===i;)Z-=1;Z+=1}else{if(!(N<x))break;for(a=N+1;a<Z&&Y[f*a+y]===i;)a+=1}}return B(v,y,n,x,Y,l,Y[f*x+y])};var B=n(12600)("lo<p0",["p0"]),J=8;function P(v,y,n,B,J,P){for(var b=2*v,Y=b*(n+1)+y,l=n+1;l<B;++l,Y+=b)for(var a=J[Y],Z=l,x=b*(l-1);Z>n&&J[x+y]>a;--Z,x-=b){for(var f=x,N=x+b,i=0;i<b;++i,++f,++N){var g=J[f];J[f]=J[N],J[N]=g}var c=P[Z];P[Z]=P[Z-1],P[Z-1]=c}}},12600:v=>{"use strict";v.exports=function(v,n){var B="abcdef".split("").concat(n),J=[];v.indexOf("lo")>=0&&J.push("lo=e[k+n]");v.indexOf("hi")>=0&&J.push("hi=e[k+o]");return B.push(y.replace("_",J.join()).replace("$",v)),Function.apply(void 0,B)};var y="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12571:v=>{"use strict";v.exports=function(v,B){B<=4*y?n(0,B-1,v):a(0,B-1,v)};var y=32;function n(v,y,n){for(var B=2*(v+1),J=v+1;J<=y;++J){for(var P=n[B++],b=n[B++],Y=J,l=B-2;Y-- >v;){var a=n[l-2],Z=n[l-1];if(a<P)break;if(a===P&&Z<b)break;n[l]=a,n[l+1]=Z,l-=2}n[l]=P,n[l+1]=b}}function B(v,y,n){y*=2;var B=n[v*=2],J=n[v+1];n[v]=n[y],n[v+1]=n[y+1],n[y]=B,n[y+1]=J}function J(v,y,n){y*=2,n[v*=2]=n[y],n[v+1]=n[y+1]}function P(v,y,n,B){y*=2,n*=2;var J=B[v*=2],P=B[v+1];B[v]=B[y],B[v+1]=B[y+1],B[y]=B[n],B[y+1]=B[n+1],B[n]=J,B[n+1]=P}function b(v,y,n,B,J){y*=2,J[v*=2]=J[y],J[y]=n,J[v+1]=J[y+1],J[y+1]=B}function Y(v,y,n){y*=2;var B=n[v*=2],J=n[y];return!(B<J)&&(B!==J||n[v+1]>n[y+1])}function l(v,y,n,B){var J=B[v*=2];return J<y||J===y&&B[v+1]<n}function a(v,Z,x){var f=(Z-v+1)/6|0,N=v+f,i=Z-f,g=v+Z>>1,c=g-f,h=g+f,E=N,W=c,s=g,C=h,r=i,u=v+1,O=Z-1,d=0;Y(E,W,x)&&(d=E,E=W,W=d),Y(C,r,x)&&(d=C,C=r,r=d),Y(E,s,x)&&(d=E,E=s,s=d),Y(W,s,x)&&(d=W,W=s,s=d),Y(E,C,x)&&(d=E,E=C,C=d),Y(s,C,x)&&(d=s,s=C,C=d),Y(W,r,x)&&(d=W,W=r,r=d),Y(W,s,x)&&(d=W,W=s,s=d),Y(C,r,x)&&(d=C,C=r,r=d);for(var q=x[2*W],L=x[2*W+1],t=x[2*C],G=x[2*C+1],R=2*E,F=2*s,S=2*r,w=2*N,k=2*g,M=2*i,I=0;I<2;++I){var j=x[R+I],V=x[F+I],p=x[S+I];x[w+I]=j,x[k+I]=V,x[M+I]=p}J(c,v,x),J(h,Z,x);for(var H=u;H<=O;++H)if(l(H,q,L,x))H!==u&&B(H,u,x),++u;else if(!l(H,t,G,x))for(;;){if(l(O,t,G,x)){l(O,q,L,x)?(P(H,u,O,x),++u,--O):(B(H,O,x),--O);break}if(--O<H)break}b(v,u-1,q,L,x),b(Z,O+1,t,G,x),u-2-v<=y?n(v,u-2,x):a(v,u-2,x),Z-(O+2)<=y?n(O+2,Z,x):a(O+2,Z,x),O-u<=y?n(u,O,x):a(u,O,x)}},12565:(v,y,n)=>{"use strict";v.exports={init:function(v){var y=J.nextPow2(v);l.length<y&&(B.free(l),l=B.mallocInt32(y));a.length<y&&(B.free(a),a=B.mallocInt32(y));Z.length<y&&(B.free(Z),Z=B.mallocInt32(y));x.length<y&&(B.free(x),x=B.mallocInt32(y));f.length<y&&(B.free(f),f=B.mallocInt32(y));N.length<y&&(B.free(N),N=B.mallocInt32(y));var n=8*y;i.length<n&&(B.free(i),i=B.mallocDouble(n))},sweepBipartite:function(v,y,n,B,J,Y,f,N,h,E){for(var W=0,s=2*v,C=v-1,r=s-1,u=n;u<B;++u){var O=Y[u],d=s*u;i[W++]=J[d+C],i[W++]=-(O+1),i[W++]=J[d+r],i[W++]=O}for(u=f;u<N;++u){O=E[u]+b;var q=s*u;i[W++]=h[q+C],i[W++]=-O,i[W++]=h[q+r],i[W++]=O}var L=W>>>1;P(i,L);var t=0,G=0;for(u=0;u<L;++u){var R=0|i[2*u+1];if(R>=b)g(Z,x,G--,R=R-b|0);else if(R>=0)g(l,a,t--,R);else if(R<=-b){R=-R-b|0;for(var F=0;F<t;++F){if(void 0!==(S=y(l[F],R)))return S}c(Z,x,G++,R)}else{R=-R-1|0;for(F=0;F<G;++F){var S;if(void 0!==(S=y(R,Z[F])))return S}c(l,a,t++,R)}}},sweepComplete:function(v,y,n,B,J,b,Y,h,E,W){for(var s=0,C=2*v,r=v-1,u=C-1,O=n;O<B;++O){var d=b[O]+1<<1,q=C*O;i[s++]=J[q+r],i[s++]=-d,i[s++]=J[q+u],i[s++]=d}for(O=Y;O<h;++O){d=W[O]+1<<1;var L=C*O;i[s++]=E[L+r],i[s++]=1|-d,i[s++]=E[L+u],i[s++]=1|d}var t=s>>>1;P(i,t);var G=0,R=0,F=0;for(O=0;O<t;++O){var S=0|i[2*O+1],w=1&S;if(O<t-1&&S>>1===i[2*O+3]>>1&&(w=2,O+=1),S<0){for(var k=-(S>>1)-1,M=0;M<F;++M){if(void 0!==(I=y(f[M],k)))return I}if(0!==w)for(M=0;M<G;++M){if(void 0!==(I=y(l[M],k)))return I}if(1!==w)for(M=0;M<R;++M){var I;if(void 0!==(I=y(Z[M],k)))return I}0===w?c(l,a,G++,k):1===w?c(Z,x,R++,k):2===w&&c(f,N,F++,k)}else{k=(S>>1)-1;0===w?g(l,a,G--,k):1===w?g(Z,x,R--,k):2===w&&g(f,N,F--,k)}}},scanBipartite:function(v,y,n,B,J,Y,Z,x,f,N,h,E){var W=0,s=2*v,C=y,r=y+v,u=1,O=1;B?O=b:u=b;for(var d=J;d<Y;++d){var q=d+u,L=s*d;i[W++]=Z[L+C],i[W++]=-q,i[W++]=Z[L+r],i[W++]=q}for(d=f;d<N;++d){q=d+O;var t=s*d;i[W++]=h[t+C],i[W++]=-q}var G=W>>>1;P(i,G);var R=0;for(d=0;d<G;++d){var F=0|i[2*d+1];if(F<0){var S=!1;if((q=-F)>=b?(S=!B,q-=b):(S=!!B,q-=1),S)c(l,a,R++,q);else{var w=E[q],k=s*q,M=h[k+y+1],I=h[k+y+1+v];v:for(var j=0;j<R;++j){var V=l[j],p=s*V;if(!(I<Z[p+y+1]||Z[p+y+1+v]<M)){for(var H=y+2;H<v;++H)if(h[k+H+v]<Z[p+H]||Z[p+H+v]<h[k+H])continue v;var A,X=x[V];if(void 0!==(A=B?n(w,X):n(X,w)))return A}}}}else g(l,a,R--,F-u)}},scanComplete:function(v,y,n,B,J,Y,a,Z,x,f,N){for(var g=0,c=2*v,h=y,E=y+v,W=B;W<J;++W){var s=W+b,C=c*W;i[g++]=Y[C+h],i[g++]=-s,i[g++]=Y[C+E],i[g++]=s}for(W=Z;W<x;++W){s=W+1;var r=c*W;i[g++]=f[r+h],i[g++]=-s}var u=g>>>1;P(i,u);var O=0;for(W=0;W<u;++W){var d=0|i[2*W+1];if(d<0){if((s=-d)>=b)l[O++]=s-b;else{var q=N[s-=1],L=c*s,t=f[L+y+1],G=f[L+y+1+v];v:for(var R=0;R<O;++R){var F=l[R],S=a[F];if(S===q)break;var w=c*F;if(!(G<Y[w+y+1]||Y[w+y+1+v]<t)){for(var k=y+2;k<v;++k)if(f[L+k+v]<Y[w+k]||Y[w+k+v]<f[L+k])continue v;var M=n(S,q);if(void 0!==M)return M}}}}else{for(s=d-b,R=O-1;R>=0;--R)if(l[R]===s){for(k=R+1;k<O;++k)l[k-1]=l[k];break}--O}}}};var B=n(12549),J=n(12551),P=n(12571),b=1<<28,Y=1024,l=B.mallocInt32(Y),a=B.mallocInt32(Y),Z=B.mallocInt32(Y),x=B.mallocInt32(Y),f=B.mallocInt32(Y),N=B.mallocInt32(Y),i=B.mallocDouble(8192);function g(v,y,n,B){var J=y[B],P=v[n-1];v[J]=P,y[P]=J}function c(v,y,n,B){v[n]=B,y[B]=n}},12553:v=>{"use strict";function y(v,n,B){var J=0|v[B];if(J<=0)return[];var P,b=new Array(J);if(B===v.length-1)for(P=0;P<J;++P)b[P]=n;else for(P=0;P<J;++P)b[P]=y(v,n,B+1);return b}v.exports=function(v,n){switch("undefined"===typeof n&&(n=0),typeof v){case"number":if(v>0)return function(v,y){var n,B;for(n=new Array(v),B=0;B<v;++B)n[B]=y;return n}(0|v,n);break;case"object":if("number"===typeof v.length)return y(v,n,0)}return[]}},12516:(v,y,n)=>{v.exports=function(){var v=this;this.components={},this.comps=this.components;var y=this.components,n=1,J={},P=[],b=[],Y={timeout:!1,removals:[],multiComps:[]};function l(v,n){var B=y[n],P=J[n],b=P.hash[v];b&&(P.remove(v),B.ab&&(B.multi?(b.forEach((y=>{y&&B.ab(v,y)})),b.length=0):B.ab(v,b)),Y.removals.push(P),a())}function a(){Y.timeout||(Y.timeout=!0,setTimeout(Z,1))}function Z(){Y.timeout=!1,x()}function x(){Y.multiComps.length&&function(v){for(var y=0;y<v.length;y++){var{entID:n,data:B}=v[y],J=B.hash[n];if(J){for(var P=0;P<J.length;P++)J[P]||(J.splice(P,1),P--);0===J.length&&(B.remove(n),Y.removals.push(B))}}v.length=0}(Y.multiComps),Y.removals.length&&function(v){for(var y=0;y<v.length;y++){v[y].flush()}v.length=0}(Y.removals)}this.Qi=J,this._systems=P,this._renderSystems=b,this.Bh=function(y){var B=n++;return Array.isArray(y)&&y.forEach((y=>v.Ff(B,y))),B},this.deleteEntity=function(y){return Object.keys(J).forEach((v=>{J[v].hash[y]&&l(y,v)})),v},this.Vh=function(v){if(!v)throw new Error("Missing component definition");var n=v.name;if(!n)throw new Error("Component definition must have a name property.");if("string"!==typeof n)throw new Error("Component name must be a string.");if(""===n)throw new Error("Component name must be a non-empty string.");if(J[n])throw new Error(`Component ${n} already exists.`);var Y={};return Y.name=n,Y.multi=!!v.multi,Y.order=isNaN(v.order)?99:v.order,Y.stateConstructor=v.stateConstructor||null,Y.state=v.state||{},Y.ge=v.ge||null,Y.ab=v.ab||null,Y.system=v.system||null,Y.qe=v.qe||null,y[n]=Y,J[n]=new B,J[n]._pendingMultiCleanup=!1,J[n]._multiCleanupIDs=Y.multi?[]:null,Y.system&&(P.push(n),P.sort(((v,n)=>y[v].order-y[n].order))),Y.qe&&(b.push(n),b.sort(((v,n)=>y[v].order-y[n].order))),n},this.overwriteComponent=function(v,n){var B=y[v];if(!B)throw new Error(`Unknown component: ${v}`);if(!n)throw new Error("Missing component definition");if(B.name!==n.name)throw new Error("Overwriting component must use the same name property.");var Y={};Y.name=v,Y.multi=!!n.multi,Y.order=isNaN(n.order)?99:n.order,Y.state=n.state||{},Y.ge=n.ge||null,Y.ab=n.ab||null,Y.system=n.system||null,Y.qe=n.qe||null,y[v]=Y,J[v]._pendingMultiCleanup=!1,J[v]._multiCleanupIDs=Y.multi?[]:null;var l=P.indexOf(v);Y.system&&l<0&&P.push(v),!Y.system&&l>=0&&P.splice(l,1),P.sort(((v,n)=>y[v].order-y[n].order));var a=b.indexOf(v);Y.qe&&a<0&&b.push(v),!Y.qe&&a>=0&&b.splice(a,1),b.sort(((v,n)=>y[v].order-y[n].order));var Z=Y.state;return this.Yg(v).forEach((v=>{for(var y in Z)y in v||(v[y]=Z[y]);Y.ge&&Y.ge(v.oe,v)})),v},this.deleteComponent=function(n){var B=J[n];if(!B)throw new Error(`Unknown component: ${n}`);B.flush(),B.list.forEach((v=>{v&&l(v.oe||v[0].oe,n)}));var Y=P.indexOf(n),a=b.indexOf(n);return Y>-1&&P.splice(Y,1),a>-1&&b.splice(a,1),J[n].dispose(),delete J[n],delete y[n],v},this.Ff=function(v,n,B){var P,b=y[n],Y=J[n];if(!Y)throw new Error(`Unknown component: ${n}.`);if(Y.hash[v]&&!b.multi)throw new Error(`Entity ${v} already has component: ${n}.`);if(b.stateConstructor){if(!(P=new b.stateConstructor).hasOwnProperty("oe"))throw new Error(`Component ${b.name} stateConstructor type does not have property __id`)}else P=Object.assign({},{oe:v},b.state,B);if(P.oe=v,b.multi){var l=Y.hash[v];l||(l=[],Y.add(v,l)),l.push(P)}else Y.add(v,P);return b.ge&&b.ge(v,P),this},this.Tf=function(v,y){var n=J[y];if(!n)throw new Error(`Unknown component: ${y}.`);return!!n.hash[v]},this.Mf=function(y,n){if(!J[n])throw new Error(`Unknown component: ${n}.`);return l(y,n),v},this.getState=function(v,y){var n=J[y];if(!n)throw new Error(`Unknown component: ${y}.`);return n.hash[v]},this.Yg=function(v){var y=J[v];if(!y)throw new Error(`Unknown component: ${v}.`);return x(),y.list},this.Lk=function(v){if(!J[v])throw new Error(`Unknown component: ${v}.`);var y=J[v].hash;return v=>y[v]},this.Ok=function(v){if(!J[v])throw new Error(`Unknown component: ${v}.`);var y=J[v].hash;return v=>!!y[v]},this.fe=function(n){x();for(var B=0;B<P.length;B++){var b=P[B],Y=y[b],l=J[b];Y.system(n,l.list),x()}return v},this.render=function(n){x();for(var B=0;B<b.length;B++){var P=b[B],Y=y[P],l=J[P];Y.qe(n,l.list),x()}return v},this.removeMultiComponent=function(n,B,P){var b=y[B],l=J[B];if(!l)throw new Error(`Unknown component: ${B}.`);if(!b.multi)throw new Error("removeMultiComponent called on non-multi component");return function(v,y,n,B){var J=n.hash[v];if(J){var P=J[B];P&&(J[B]=null,y.ab&&y.ab(v,P),Y.multiComps.push({entID:v,data:n}),a())}}(n,b,l,P),v}};var B=n(12518)},12518:v=>{function y(v,y){var n=v._map[y];if(delete v.hash[y],delete v._map[y],n===v.list.length-1)v.list.pop();else{var B=v.list.pop();if(v.list[n]=B,null===B||null===B[0]){var J=v.list.length;for(var P in v._map)if(v._map[P]===J)return void(v._map[P]=n)}else{var b=B.oe||B[0].oe;v._map[b]=n}}}v.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(v,y){if("number"===typeof this._map[v]){var n=this._map[v];this.hash[v]=y,this.list[n]=y}else this._map[v]=this.list.length,this.hash[v]=y,this.list.push(y)}remove(v){var y=this._map[v];this.hash[v]=null,this.list[y]=null,this._pendingRemovals.push(v)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var v=0;v<this._pendingRemovals.length;v++){var n=this._pendingRemovals[v];null===this.hash[n]&&y(this,n)}this._pendingRemovals.length=0}}},12474:v=>{"use strict";var y,n="object"===typeof Reflect?Reflect:null,B=function(v,y,n){return Function.prototype.apply.call(v,y,n)};y=n&&"function"===typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:function(v){return Object.getOwnPropertyNames(v)};var J=Number.isNaN||function(v){return v!==v};function P(){P.init.call(this)}v.exports=P,v.exports.once=function(v,y){return new Promise((function(n,B){function J(n){v.removeListener(y,P),B(n)}function P(){"function"===typeof v.removeListener&&v.removeListener("error",J),n([].slice.call(arguments))}g(v,y,P,{once:!0}),"error"!==y&&function(v,y,n){"function"===typeof v.on&&g(v,"error",y,n)}(v,J,{once:!0})}))},P.EventEmitter=P,P.prototype._events=void 0,P.prototype._eventsCount=0,P.prototype._maxListeners=void 0;var b=10;function Y(v){if("function"!==typeof v)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof v)}function l(v){return void 0===v._maxListeners?P.defaultMaxListeners:v._maxListeners}function a(v,y,n,B){var J,P,b,a;if(Y(n),void 0===(P=v._events)?(P=v._events=Object.create(null),v._eventsCount=0):(void 0!==P.newListener&&(v.emit("newListener",y,n.listener?n.listener:n),P=v._events),b=P[y]),void 0===b)b=P[y]=n,++v._eventsCount;else if("function"===typeof b?b=P[y]=B?[n,b]:[b,n]:B?b.unshift(n):b.push(n),(J=l(v))>0&&b.length>J&&!b.warned){b.warned=!0;var Z=new Error("Possible EventEmitter memory leak detected. "+b.length+" "+String(y)+" listeners added. Use emitter.setMaxListeners() to increase limit");Z.name="MaxListenersExceededWarning",Z.j=v,Z.type=y,Z.count=b.length,a=Z,console&&console.warn&&console.warn(a)}return v}function Z(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function x(v,y,n){var B={fired:!1,wrapFn:void 0,target:v,type:y,listener:n},J=Z.bind(B);return J.listener=n,B.wrapFn=J,J}function f(v,y,n){var B=v._events;if(void 0===B)return[];var J=B[y];return void 0===J?[]:"function"===typeof J?n?[J.listener||J]:[J]:n?function(v){for(var y=new Array(v.length),n=0;n<y.length;++n)y[n]=v[n].listener||v[n];return y}(J):i(J,J.length)}function N(v){var y=this._events;if(void 0!==y){var n=y[v];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function i(v,y){for(var n=new Array(y),B=0;B<y;++B)n[B]=v[B];return n}function g(v,y,n,B){if("function"===typeof v.on)B.once?v.once(y,n):v.on(y,n);else{if("function"!==typeof v.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof v);v.addEventListener(y,(function J(P){B.once&&v.removeEventListener(y,J),n(P)}))}}Object.defineProperty(P,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(v){if("number"!==typeof v||v<0||J(v))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+v+".");b=v}}),P.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},P.prototype.setMaxListeners=function(v){if("number"!==typeof v||v<0||J(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this},P.prototype.getMaxListeners=function(){return l(this)},P.prototype.emit=function(v){for(var y=[],n=1;n<arguments.length;n++)y.push(arguments[n]);var J="error"===v,P=this._events;if(void 0!==P)J=J&&void 0===P.error;else if(!J)return!1;if(J){var b;if(y.length>0&&(b=y[0]),b instanceof Error)throw b;var Y=new Error("Unhandled error."+(b?" ("+b.message+")":""));throw Y.context=b,Y}var l=P[v];if(void 0===l)return!1;if("function"===typeof l)B(l,this,y);else{var a=l.length,Z=i(l,a);for(n=0;n<a;++n)B(Z[n],this,y)}return!0},P.prototype.addListener=function(v,y){return a(this,v,y,!1)},P.prototype.on=P.prototype.addListener,P.prototype.prependListener=function(v,y){return a(this,v,y,!0)},P.prototype.once=function(v,y){return Y(y),this.on(v,x(this,v,y)),this},P.prototype.prependOnceListener=function(v,y){return Y(y),this.prependListener(v,x(this,v,y)),this},P.prototype.removeListener=function(v,y){var n,B,J,P,b;if(Y(y),void 0===(B=this._events))return this;if(void 0===(n=B[v]))return this;if(n===y||n.listener===y)0===--this._eventsCount?this._events=Object.create(null):(delete B[v],B.removeListener&&this.emit("removeListener",v,n.listener||y));else if("function"!==typeof n){for(J=-1,P=n.length-1;P>=0;P--)if(n[P]===y||n[P].listener===y){b=n[P].listener,J=P;break}if(J<0)return this;0===J?n.shift():function(v,y){for(;y+1<v.length;y++)v[y]=v[y+1];v.pop()}(n,J),1===n.length&&(B[v]=n[0]),void 0!==B.removeListener&&this.emit("removeListener",v,b||y)}return this},P.prototype.off=P.prototype.removeListener,P.prototype.removeAllListeners=function(v){var y,n,B;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[v]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[v]),this;if(0===arguments.length){var J,P=Object.keys(n);for(B=0;B<P.length;++B)"removeListener"!==(J=P[B])&&this.removeAllListeners(J);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(y=n[v]))this.removeListener(v,y);else if(void 0!==y)for(B=y.length-1;B>=0;B--)this.removeListener(v,y[B]);return this},P.prototype.listeners=function(v){return f(this,v,!0)},P.prototype.rawListeners=function(v){return f(this,v,!1)},P.listenerCount=function(v,y){return"function"===typeof v.listenerCount?v.listenerCount(y):N.call(v,y)},P.prototype.listenerCount=N,P.prototype.eventNames=function(){return this._eventsCount>0?y(this._events):[]}},12801:v=>{"use strict";v.exports=function(v,y,n,B,J,P){var b=+y[0],Y=+y[1],l=+y[2],a=+n[0],Z=+n[1],x=+n[2],f=Math.sqrt(a*a+Z*Z+x*x);if(0===f)throw new Error("Can't raycast along a zero vector");return function(v,y,n,B,J,P,b,Y,l,a){for(var Z=0,x=Math.floor,f=0|x(y),N=0|x(n),i=0|x(B),g=J>0?1:-1,c=P>0?1:-1,h=b>0?1:-1,E=Math.abs(1/J),W=Math.abs(1/P),s=Math.abs(1/b),C=E<1/0?E*(g>0?f+1-y:y-f):1/0,r=W<1/0?W*(c>0?N+1-n:n-N):1/0,u=s<1/0?s*(h>0?i+1-B:B-i):1/0,O=-1;Z<=Y;){var d=v(f,N,i);if(d)return l&&(l[0]=y+Z*J,l[1]=n+Z*P,l[2]=B+Z*b),a&&(a[0]=a[1]=a[2]=0,0===O&&(a[0]=-g),1===O&&(a[1]=-c),2===O&&(a[2]=-h)),d;C<r?C<u?(f+=g,Z=C,C+=E,O=0):(i+=h,Z=u,u+=s,O=2):r<u?(N+=c,Z=r,r+=W,O=1):(i+=h,Z=u,u+=s,O=2)}return l&&(l[0]=y+Z*J,l[1]=n+Z*P,l[2]=B+Z*b),a&&(a[0]=a[1]=a[2]=0),0}(v,b,Y,l,a/=f,Z/=f,x/=f,B="undefined"===typeof B?64:+B,J,P)}},12842:(v,y,n)=>{"use strict";n.d(y,{c:()=>P});var B=n(12474);function J(){this.Jj=!1,this.stopPropagation=!1,this.Kj=!1,this.disabled=!1}class P{constructor(v,y){this.version="0.7.0";var n=Object.assign({},new J,y||{});this.element=v||document,this.Jj=!!n.Jj,this.stopPropagation=!!n.stopPropagation,this.Kj=!!n.Kj,this.disabled=!!n.disabled,this.filterEvents=(v,y)=>!0,this.down=new B.EventEmitter,this.up=new B.EventEmitter,this.state={},this.Qg={dx:0,dy:0,Ck:0,Og:0,Dk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?Y(this):document.addEventListener("DOMContentLoaded",(v=>{Y(this)}),{once:!0})}bind(v){for(var y=arguments.length,n=new Array(y>1?y-1:0),B=1;B<y;B++)n[B-1]=arguments[B];n.forEach((y=>{var n=this._keyBindmap[y]||[];n.includes(v)||(n.push(v),this._keyBindmap[y]=n)})),this.state[v]=!!this.state[v],this.pressCount[v]=this.pressCount[v]||0,this.releaseCount[v]=this.releaseCount[v]||0}unbind(v){for(var y in this._keyBindmap){var n=this._keyBindmap[y],B=n.indexOf(v);B>-1&&n.splice(B,1)}}getBindings(){var v={};for(var y in this._keyBindmap){this._keyBindmap[y].forEach((n=>{v[n]=v[n]||[],v[n].push(y)}))}return v}fe(){b(this.Qg),b(this.pressCount),b(this.releaseCount)}}function b(v){for(var y in v)v[y]=0}function Y(v){window.addEventListener("keydown",i.bind(null,v,!0),!1),window.addEventListener("keyup",i.bind(null,v,!1),!1);var y={passive:!0};v.element.addEventListener("touchstart",x.bind(void 0,v),{passive:!1}),v.element.addEventListener("touchend",N.bind(void 0,v),y),v.element.addEventListener("mousedown",g.bind(null,v,!0),y),window.document.addEventListener("mouseup",g.bind(null,v,!1),y),v.element.addEventListener("touchmove",c.bind(null,v),y),v.element.addEventListener("mousemove",c.bind(null,v),y),window.PointerEvent,v.element.addEventListener("wheel",h.bind(null,v),y),v.element.addEventListener("contextmenu",E.bind(null,v),!1),window.addEventListener("blur",W.bind(null,v),!1)}var l=0,a=0,Z=null;function x(v,y){y.preventDefault(),f(y)}function f(v){let y=!1;for(let n=0;n<v.touches.length;++n)if(v.touches[n].identifier===Z){y=!0;break}if(!y){const y=v.changedTouches[0];l=y.clientX,a=y.clientY,Z=y.identifier}}function N(v,y){for(var n=y.changedTouches,B=0;B<n.length;++B)n[B].identifier===Z&&(Z=null)}function i(v,y,n){s(n.code,y,v,n)}function g(v,y,n){if("pointerId"in n)if(y){if(null!==v._touches.currID)return;v._touches.currID=n.pointerId}else{if(v._touches.currID!==n.pointerId)return;v._touches.currID=null}return s("Mouse"+("button"in n?n.button+1:1),y,v,n),!1}function c(v,y){var n=y.movementX||y.mozMovementX||0,B=y.movementY||y.mozMovementY||0;if(y.touches&&0===(n|B)){var J=function(v){f(v);for(let y=0;y<v.changedTouches.length;++y)if(v.changedTouches[y].identifier==Z){const n=v.changedTouches[y],B=[n.clientX-l,n.clientY-a];return l=n.clientX,a=n.clientY,B}return console.error(`Did not find touch id ${Z}`),[0,0]}(y);n=J[0],B=J[1]}v.Qg.dx+=n,v.Qg.dy+=B}function h(v,y){var n=1;switch(y.deltaMode){case 0:n=1;break;case 1:n=12;break;case 2:n=v.element.clientHeight||window.innerHeight}v.Qg.Ck+=(y.deltaX||0)*n,v.Qg.Og+=(y.deltaY||0)*n,v.Qg.Dk+=(y.deltaZ||0)*n}function E(v,y){if(!v.Kj)return y.preventDefault(),!1}function W(v){for(var y in v._keyStates)v._keyStates[y]&&(/^Mouse\d/.test(y)||s(y,!1,v,{code:y,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function s(v,y,n,B){var J=n._keyBindmap[v];J&&(C(n._keyStates[v],y)&&(n._keyStates[v]=y,J.forEach((v=>{(!n.filterEvents||n.filterEvents(B,v))&&function(v,y,n,B){var J=y?n.pressCount:n.releaseCount;J[v]=(J[v]||0)+1;var P=n._bindPressCount[v]||0;(P+=y?1:-1)<0&&(P=0);n._bindPressCount[v]=P;var b=n.state[v];if(C(b,P)){n.state[v]=P>0;var Y=y?n.down:n.up;n.disabled||Y.emit(v,B)}}(v,y,n,B)}))),"button"in B||(n.Jj&&!B.defaultPrevented&&B.preventDefault(),n.stopPropagation&&B.stopPropagation()))}function C(v,y){return v?!y:y}},12052:v=>{v.exports=function(v,y,n){return v[0]=y[0]+n[0],v[1]=y[1]+n[1],v[2]=y[2]+n[2],v}},12012:(v,y,n)=>{v.exports=function(v,y){var n=B(v[0],v[1],v[2]),b=B(y[0],y[1],y[2]);J(n,n),J(b,b);var Y=P(n,b);return Y>1?0:Math.acos(Y)};var B=n(12021),J=n(12024),P=n(12029)},12104:v=>{v.exports=function(v,y){return v[0]=Math.ceil(y[0]),v[1]=Math.ceil(y[1]),v[2]=Math.ceil(y[2]),v}},12008:v=>{v.exports=function(v){var y=new Float32Array(3);return y[0]=v[0],y[1]=v[1],y[2]=v[2],y}},12034:v=>{v.exports=function(v,y){return v[0]=y[0],v[1]=y[1],v[2]=y[2],v}},12003:v=>{v.exports=function(){var v=new Float32Array(3);return v[0]=0,v[1]=0,v[2]=0,v}},12189:v=>{v.exports=function(v,y,n){var B=y[0],J=y[1],P=y[2],b=n[0],Y=n[1],l=n[2];return v[0]=J*l-P*Y,v[1]=P*b-B*l,v[2]=B*Y-J*b,v}},12131:(v,y,n)=>{v.exports=n(12126)},12126:v=>{v.exports=function(v,y){var n=y[0]-v[0],B=y[1]-v[1],J=y[2]-v[2];return Math.sqrt(n*n+B*B+J*J)}},12081:(v,y,n)=>{v.exports=n(12077)},12077:v=>{v.exports=function(v,y,n){return v[0]=y[0]/n[0],v[1]=y[1]/n[1],v[2]=y[2]/n[2],v}},12029:v=>{v.exports=function(v,y){return v[0]*y[0]+v[1]*y[1]+v[2]*y[2]}},12e3:v=>{v.exports=1e-6},12045:(v,y,n)=>{v.exports=function(v,y){var n=v[0],J=v[1],P=v[2],b=y[0],Y=y[1],l=y[2];return Math.abs(n-b)<=B*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(J-Y)<=B*Math.max(1,Math.abs(J),Math.abs(Y))&&Math.abs(P-l)<=B*Math.max(1,Math.abs(P),Math.abs(l))};var B=n(12e3)},12049:v=>{v.exports=function(v,y){return v[0]===y[0]&&v[1]===y[1]&&v[2]===y[2]}},12100:v=>{v.exports=function(v,y){return v[0]=Math.floor(y[0]),v[1]=Math.floor(y[1]),v[2]=Math.floor(y[2]),v}},12234:(v,y,n)=>{v.exports=function(v,y,n,J,P,b){var Y,l;y||(y=3);n||(n=0);l=J?Math.min(J*y+n,v.length):v.length;for(Y=n;Y<l;Y+=y)B[0]=v[Y],B[1]=v[Y+1],B[2]=v[Y+2],P(B,B,b),v[Y]=B[0],v[Y+1]=B[1],v[Y+2]=B[2];return v};var B=n(12003)()},12021:v=>{v.exports=function(v,y,n){var B=new Float32Array(3);return B[0]=v,B[1]=y,B[2]=n,B}},11994:(v,y,n)=>{v.exports={EPSILON:n(12e3),create:n(12003),clone:n(12008),angle:n(12012),Qd:n(12021),i:n(12034),set:n(12041),equals:n(12045),exactEquals:n(12049),add:n(12052),od:n(12059),sub:n(12061),multiply:n(12070),mul:n(12074),divide:n(12077),div:n(12081),min:n(12087),max:n(12092),floor:n(12100),ceil:n(12104),round:n(12107),scale:n(12110),Rd:n(12118),distance:n(12126),dist:n(12131),squaredDistance:n(12140),sqrDist:n(12144),length:n(12147),len:n(12151),squaredLength:n(12159),Vd:n(12168),negate:n(12174),inverse:n(12180),normalize:n(12024),dot:n(12029),cross:n(12189),Fd:n(12198),random:n(12204),transformMat4:n(12207),transformMat3:n(12213),transformQuat:n(12218),Wd:n(12221),Yd:n(12224),ae:n(12229),forEach:n(12234)}},12180:v=>{v.exports=function(v,y){return v[0]=1/y[0],v[1]=1/y[1],v[2]=1/y[2],v}},12151:(v,y,n)=>{v.exports=n(12147)},12147:v=>{v.exports=function(v){var y=v[0],n=v[1],B=v[2];return Math.sqrt(y*y+n*n+B*B)}},12198:v=>{v.exports=function(v,y,n,B){var J=y[0],P=y[1],b=y[2];return v[0]=J+B*(n[0]-J),v[1]=P+B*(n[1]-P),v[2]=b+B*(n[2]-b),v}},12092:v=>{v.exports=function(v,y,n){return v[0]=Math.max(y[0],n[0]),v[1]=Math.max(y[1],n[1]),v[2]=Math.max(y[2],n[2]),v}},12087:v=>{v.exports=function(v,y,n){return v[0]=Math.min(y[0],n[0]),v[1]=Math.min(y[1],n[1]),v[2]=Math.min(y[2],n[2]),v}},12074:(v,y,n)=>{v.exports=n(12070)},12070:v=>{v.exports=function(v,y,n){return v[0]=y[0]*n[0],v[1]=y[1]*n[1],v[2]=y[2]*n[2],v}},12174:v=>{v.exports=function(v,y){return v[0]=-y[0],v[1]=-y[1],v[2]=-y[2],v}},12024:v=>{v.exports=function(v,y){var n=y[0],B=y[1],J=y[2],P=n*n+B*B+J*J;P>0&&(P=1/Math.sqrt(P),v[0]=y[0]*P,v[1]=y[1]*P,v[2]=y[2]*P);return v}},12204:v=>{v.exports=function(v,y){y=y||1;var n=2*Math.random()*Math.PI,B=2*Math.random()-1,J=Math.sqrt(1-B*B)*y;return v[0]=Math.cos(n)*J,v[1]=Math.sin(n)*J,v[2]=B*y,v}},12221:v=>{v.exports=function(v,y,n,B){var J=n[1],P=n[2],b=y[1]-J,Y=y[2]-P,l=Math.sin(B),a=Math.cos(B);return v[0]=y[0],v[1]=J+b*a-Y*l,v[2]=P+b*l+Y*a,v}},12224:v=>{v.exports=function(v,y,n,B){var J=n[0],P=n[2],b=y[0]-J,Y=y[2]-P,l=Math.sin(B),a=Math.cos(B);return v[0]=J+Y*l+b*a,v[1]=y[1],v[2]=P+Y*a-b*l,v}},12229:v=>{v.exports=function(v,y,n,B){var J=n[0],P=n[1],b=y[0]-J,Y=y[1]-P,l=Math.sin(B),a=Math.cos(B);return v[0]=J+b*a-Y*l,v[1]=P+b*l+Y*a,v[2]=y[2],v}},12107:v=>{v.exports=function(v,y){return v[0]=Math.round(y[0]),v[1]=Math.round(y[1]),v[2]=Math.round(y[2]),v}},12110:v=>{v.exports=function(v,y,n){return v[0]=y[0]*n,v[1]=y[1]*n,v[2]=y[2]*n,v}},12118:v=>{v.exports=function(v,y,n,B){return v[0]=y[0]+n[0]*B,v[1]=y[1]+n[1]*B,v[2]=y[2]+n[2]*B,v}},12041:v=>{v.exports=function(v,y,n,B){return v[0]=y,v[1]=n,v[2]=B,v}},12144:(v,y,n)=>{v.exports=n(12140)},12168:(v,y,n)=>{v.exports=n(12159)},12140:v=>{v.exports=function(v,y){var n=y[0]-v[0],B=y[1]-v[1],J=y[2]-v[2];return n*n+B*B+J*J}},12159:v=>{v.exports=function(v){var y=v[0],n=v[1],B=v[2];return y*y+n*n+B*B}},12061:(v,y,n)=>{v.exports=n(12059)},12059:v=>{v.exports=function(v,y,n){return v[0]=y[0]-n[0],v[1]=y[1]-n[1],v[2]=y[2]-n[2],v}},12213:v=>{v.exports=function(v,y,n){var B=y[0],J=y[1],P=y[2];return v[0]=B*n[0]+J*n[3]+P*n[6],v[1]=B*n[1]+J*n[4]+P*n[7],v[2]=B*n[2]+J*n[5]+P*n[8],v}},12207:v=>{v.exports=function(v,y,n){var B=y[0],J=y[1],P=y[2],b=n[3]*B+n[7]*J+n[11]*P+n[15];return b=b||1,v[0]=(n[0]*B+n[4]*J+n[8]*P+n[12])/b,v[1]=(n[1]*B+n[5]*J+n[9]*P+n[13])/b,v[2]=(n[2]*B+n[6]*J+n[10]*P+n[14])/b,v}},12218:v=>{v.exports=function(v,y,n){var B=y[0],J=y[1],P=y[2],b=n[0],Y=n[1],l=n[2],a=n[3],Z=a*B+Y*P-l*J,x=a*J+l*B-b*P,f=a*P+b*J-Y*B,N=-b*B-Y*J-l*P;return v[0]=Z*a+N*-b+x*-l-f*-Y,v[1]=x*a+N*-Y+f*-b-Z*-l,v[2]=f*a+N*-l+Z*-Y-x*-b,v}},12500:v=>{"use strict";v.exports=function(v){for(var y=new Array(v),n=0;n<v;++n)y[n]=n;return y}},12557:v=>{v.exports=function(v){return null!=v&&null!=v.constructor&&"function"===typeof v.constructor.isBuffer&&v.constructor.isBuffer(v)}},12804:(v,y,n)=>{"use strict";n.d(y,{c:()=>B});class B{constructor(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.ni=!1,this.oi=!1,this.li=30,this.mi=0,this.xi=!1,this.fullscreen=!1,this.qi=function(v){},this.ri=function(){},this.ui=function(){},this.bb=function(){},this.si=function(v){},this.onFullscreenChanged=function(v){},a((()=>{!function(v,y){v._nowObject=performance||Date,v._lastTick=0,v._renderAccum=0,v._rt=0,v._frameCB=Y.bind(null,v),requestAnimationFrame(v._frameCB),y>0&&(v._intervalCB=b.bind(null,v),v._interval=setInterval(v._intervalCB,Math.max(y,1e3/v.li/2)))}(this,y),function(v,y){if(!y)return;var n=!1,B=!1;document.addEventListener("pointerlockchange",(B=>{n=document.pointerLockElement===y,v.si(n)})),document.addEventListener("fullscreenchange",(n=>{B=document.fullscreenElement===y,v.onFullscreenChanged(B)})),Object.defineProperty(v,"xi",{get:()=>n,set:v=>{v&&!n?l(y):n&&!v&&function(v){v.exitPointerLock&&v.exitPointerLock()}(document)}}),Object.defineProperty(v,"fullscreen",{get:()=>B,set:v=>{v&&!B?y.requestFullscreen():B&&!v&&document.exitFullscreen()}}),y.addEventListener("click",(J=>{v.ni&&!n&&l(y),v.oi&&!B&&y.requestFullscreen()}));var J=()=>v.bb();if(window.ResizeObserver){new ResizeObserver(J).observe(y)}else window.addEventListener("resize",J)}(this,v),this.ui()}))}}var J=3,P=20;function b(v){for(var y=1e3/v.li,n=v._nowObject.now()+P,B=0;v._nowObject.now()>=v._lastTick+y&&v._nowObject.now()<n&&++B<=J;)v.qi(y),v._lastTick+=y;var b=5*(y+5),Y=v._nowObject.now();if(Y-v._lastTick>b)for(;Y>=v._lastTick+y;)v._lastTick+=y}function Y(v){requestAnimationFrame(v._frameCB),b(v);var y=v._nowObject.now(),n=y-v._rt;if(v._rt=y,v.mi>0){v._renderAccum+=n;var B=1e3/v.mi;if(v._renderAccum<B)return;v._renderAccum=Math.min(v._renderAccum-B,B)}var J=1e3/v.li,P=(y-v._lastTick)/J;v.ri(n,P,J)}function l(v){v.requestPointerLock&&v.requestPointerLock()}var a=v=>{if("loading"===document.readyState){var y=()=>{document.removeEventListener("readystatechange",y),v()};document.addEventListener("readystatechange",y)}else setTimeout(v,1)}},12495:(v,y,n)=>{var B=n(12500),J=n(12505),P="undefined"!==typeof Float64Array;function b(v,y){return v[0]-y[0]}function Y(){var v,y=this.stride,n=new Array(y.length);for(v=0;v<n.length;++v)n[v]=[Math.abs(y[v]),v];n.sort(b);var B=new Array(n.length);for(v=0;v<B.length;++v)B[v]=n[v][1];return B}function l(v,y){var n=["View",y,"d",v].join("");y<0&&(n="View_Nil"+v);var J="generic"===v;if(-1===y){var P="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+v+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(P)()}if(0===y){P="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+v+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(J?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(J?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",P)(a[v][0])}P=["'use strict'"];var b=B(y),l=b.map((function(v){return"i"+v})),Z="this.offset+"+b.map((function(v){return"this.stride["+v+"]*i"+v})).join("+"),x=b.map((function(v){return"b"+v})).join(","),f=b.map((function(v){return"c"+v})).join(",");P.push("function "+n+"(a,"+x+","+f+",d){this.data=a","this.shape=["+x+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+v+"'","proto.dimension="+y),P.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+b.map((function(v){return"this.shape["+v+"]"})).join("*"),"}})"),1===y?P.push("proto.order=[0]"):(P.push("Object.defineProperty(proto,'order',{get:"),y<4?(P.push("function "+n+"_order(){"),2===y?P.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===y&&P.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):P.push("ORDER})")),P.push("proto.set=function "+n+"_set("+l.join(",")+",v){"),J?P.push("return this.data.set("+Z+",v)}"):P.push("return this.data["+Z+"]=v}"),P.push("proto.get=function "+n+"_get("+l.join(",")+"){"),J?P.push("return this.data.get("+Z+")}"):P.push("return this.data["+Z+"]}"),P.push("proto.index=function "+n+"_index(",l.join(),"){return "+Z+"}"),P.push("proto.hi=function "+n+"_hi("+l.join(",")+"){return new "+n+"(this.data,"+b.map((function(v){return["(typeof i",v,"!=='number'||i",v,"<0)?this.shape[",v,"]:i",v,"|0"].join("")})).join(",")+","+b.map((function(v){return"this.stride["+v+"]"})).join(",")+",this.offset)}");var N=b.map((function(v){return"a"+v+"=this.shape["+v+"]"})),i=b.map((function(v){return"c"+v+"=this.stride["+v+"]"}));P.push("proto.lo=function "+n+"_lo("+l.join(",")+"){var b=this.offset,d=0,"+N.join(",")+","+i.join(","));for(var g=0;g<y;++g)P.push("if(typeof i"+g+"==='number'&&i"+g+">=0){d=i"+g+"|0;b+=c"+g+"*d;a"+g+"-=d}");P.push("return new "+n+"(this.data,"+b.map((function(v){return"a"+v})).join(",")+","+b.map((function(v){return"c"+v})).join(",")+",b)}"),P.push("proto.step=function "+n+"_step("+l.join(",")+"){var "+b.map((function(v){return"a"+v+"=this.shape["+v+"]"})).join(",")+","+b.map((function(v){return"b"+v+"=this.stride["+v+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(g=0;g<y;++g)P.push("if(typeof i"+g+"==='number'){d=i"+g+"|0;if(d<0){c+=b"+g+"*(a"+g+"-1);a"+g+"=ceil(-a"+g+"/d)}else{a"+g+"=ceil(a"+g+"/d)}b"+g+"*=d}");P.push("return new "+n+"(this.data,"+b.map((function(v){return"a"+v})).join(",")+","+b.map((function(v){return"b"+v})).join(",")+",c)}");var c=new Array(y),h=new Array(y);for(g=0;g<y;++g)c[g]="a[i"+g+"]",h[g]="b[i"+g+"]";P.push("proto.transpose=function "+n+"_transpose("+l+"){"+l.map((function(v,y){return v+"=("+v+"===undefined?"+y+":"+v+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+c.join(",")+","+h.join(",")+",this.offset)}"),P.push("proto.pick=function "+n+"_pick("+l+"){var a=[],b=[],c=this.offset");for(g=0;g<y;++g)P.push("if(typeof i"+g+"==='number'&&i"+g+">=0){c=(c+this.stride["+g+"]*i"+g+")|0}else{a.push(this.shape["+g+"]);b.push(this.stride["+g+"])}");return P.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),P.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+b.map((function(v){return"shape["+v+"]"})).join(",")+","+b.map((function(v){return"stride["+v+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",P.join("\n"))(a[v],Y)}var a={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};v.exports=function(v,y,n,B){if(void 0===v)return(0,a.array[0])([]);"number"===typeof v&&(v=[v]),void 0===y&&(y=[v.length]);var b=y.length;if(void 0===n){n=new Array(b);for(var Y=b-1,Z=1;Y>=0;--Y)n[Y]=Z,Z*=y[Y]}if(void 0===B){B=0;for(Y=0;Y<b;++Y)n[Y]<0&&(B-=(y[Y]-1)*n[Y])}for(var x=function(v){if(J(v))return"buffer";if(P)switch(Object.prototype.toString.call(v)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(v)?"array":"generic"}(v),f=a[x];f.length<=b+1;)f.push(l(x,f.length-1));return(0,f[b+1])(v,y,n,B)}},12505:v=>{function y(v){return!!v.constructor&&"function"===typeof v.constructor.isBuffer&&v.constructor.isBuffer(v)}v.exports=function(v){return null!=v&&(y(v)||function(v){return"function"===typeof v.readFloatLE&&"function"===typeof v.slice&&y(v.slice(0,0))}(v)||!!v._isBuffer)}},12652:v=>{"use strict";var y=[],n=[],B=[],J=[],P=[],b=[],Y=[],l=[],a=[],Z=[],x=[],f=[];v.exports=function(v,N,i,g,c,h){for(var E=Y,W=a,s=Z,C=f,r=0;r<3;r++)E[r]=+i[r],s[r]=+N.max[r],W[r]=+N.base[r];h||(h=1e-10);var u=function(v,Y,a,Z,f,N){var i=y,g=n,c=B,h=J,E=P,W=b,s=l,C=Math.floor,r=0,u=0,O=0,d=0,q=0;if(L(),0===O)return 0;for(d=R();u<=O;){if(t(d)&&G())return r;d=R()}for(r+=O,q=0;q<3;q++)Z[q]+=a[q],f[q]+=a[q];return r;function L(){if(u=0,0!==(O=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])))for(var v=0;v<3;v++){var y=a[v]>=0;h[v]=y?1:-1;var n=y?f[v]:Z[v];i[v]=y?Z[v]:f[v],g[v]=F(n,h[v]),c[v]=S(i[v],h[v]),s[v]=a[v]/O,E[v]=Math.abs(1/s[v]);var B=y?g[v]+1-n:n-g[v];W[v]=E[v]<1/0?E[v]*B:1/0}}function t(y){for(var n=h[0],B=0===y?g[0]:c[0],J=g[0]+n,P=h[1],b=1===y?g[1]:c[1],Y=g[1]+P,l=h[2],a=2===y?g[2]:c[2],Z=g[2]+l,x=B;x!=J;x+=n)for(var f=b;f!=Y;f+=P)for(var N=a;N!=Z;N+=l)if(v(x,f,N))return!0;return!1}function G(){r+=u;var v=h[d],y=u/O,n=x;for(q=0;q<3;q++){var B=a[q]*y;Z[q]+=B,f[q]+=B,n[q]=a[q]-B}if(v>0?f[d]=Math.round(f[d]):Z[d]=Math.round(Z[d]),Y(r,d,v,n))return!0;for(q=0;q<3;q++)a[q]=n[q];return L(),0===O}function R(){var v=W[0]<W[1]?W[0]<W[2]?0:2:W[1]<W[2]?1:2,y=W[v]-u;for(u=W[v],g[v]+=h[v],W[v]+=E[v],q=0;q<3;q++)i[q]+=y*s[q],c[q]=S(i[q],h[q]);return v}function F(v,y){return C(v-y*N)}function S(v,y){return C(v+y*N)}}(v,g,E,W,s,h);if(!c){for(r=0;r<3;r++)C[r]=i[r]>0?s[r]-N.max[r]:W[r]-N.base[r];N.translate(C)}return u}},12848:(v,y,n)=>{"use strict";n.d(y,{d:()=>x});var B=n(12643),J=n(11994);class P{constructor(v,y,n,P,b,Y,l){this.Xg=new B(v.base,v.wh),this.mass=y,this.friction=n,this.restitution=P,this.td=b,this.Wk=Y,this.ud=!!l,this.sh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Il=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.ng=J.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=J.create(),this._impulses=J.create(),this._sleepFrameCount=10}loadFromCopy(v){J.i(this.Xg.base,v.Xg.base),J.i(this.Xg.wh,v.Xg.wh),J.i(this.Xg.max,v.Xg.max),this.Xg.mag=v.Xg.mag,this.mass=v.mass,this.friction=v.friction,this.restitution=v.restitution,this.td=v.td,this.Wk=v.Wk,this.ud=v.ud,this.sh=v.sh,this.fluidDrag=v.fluidDrag,this.Il=v.Il,this.preventFallOffEdge=v.preventFallOffEdge,this.rolledBackLastTick=v.rolledBackLastTick,J.i(this.ng,v.ng),J.i(this.resting,v.resting),this.inFluid=v.inFluid,this._ratioInFluid=v._ratioInFluid,J.i(this._forces,v._forces),J.i(this._impulses,v._impulses),this._sleepFrameCount=v._sleepFrameCount}setPosition(v){b(v),J.od(v,v,this.Xg.base),this.Xg.translate(v),this.tg()}cb(){return J.clone(this.Xg.base)}applyForce(v){b(v),J.add(this._forces,this._forces,v),this.tg()}applyImpulse(v){b(v),J.add(this._impulses,this._impulses,v),this.tg()}tg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var b=v=>{};var Y=n(12643),l=n(11994),a=n(12652);function Z(){this.sh=.1,this.fluidDrag=.4,this.Ed=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function x(v,y,n){v=Object.assign(new Z,v),this.gravity=v.gravity||[0,-10,0],this.sh=v.sh||.1,this.Ed=v.Ed||2,this.fluidDrag=v.fluidDrag||.4,this.minBounceImpulse=v.minBounceImpulse,this.bodies=[],this.sk=v.sk,this.testSolid=y,this.testFluid=n}x.prototype.bl=function(v,y,n,B,J,b){v=v||new Y([0,0,0],[1,1,1]),"undefined"==typeof y&&(y=1),"undefined"==typeof n&&(n=1),"undefined"==typeof B&&(B=0),"undefined"==typeof J&&(J=1);var l=new P(v,y,n,B,J,b);return this.bodies.push(l),l},x.prototype.cl=function(v){var y=this.bodies.indexOf(v);y<0||(this.bodies.splice(y,1),v.Xg=v.Wk=null)};var f=l.create(),N=l.create(),i=l.create(),g=l.create(),c=l.create(),h=l.create(),E=l.create(),W=new Y([0,0,0],[1,1,1]),s=new P(W,1,1,0,1,(()=>{}),!1);function C(v,y,n){return y=n,y*=1-(1-v.ratioInFluid)**2}x.prototype.fe=function(v){v/=1e3;var y=j(0,l.squaredLength(this.gravity));this.bodies.forEach((n=>function(v,y,n,B){l.i(c,y.resting),v.sk&&s.loadFromCopy(y);if(y.mass<=0)return l.set(y.ng,0,0,0),l.set(y._forces,0,0,0),void l.set(y._impulses,0,0,0);var J=B||0===y.td;if(function(v,y,n,B){if(y._sleepFrameCount>0)return!1;if(B)return!0;var J=!1,P=.5*n*n*y.td;return l.scale(I,v.gravity,P),a(v.testSolid,y.Xg,I,(function(){return J=!0,!0}),!0),J}(v,y,n,J))return;y._sleepFrameCount--,function(v,y){var n=y.Xg,B=Math.floor(n.base[0]),J=Math.floor(n.base[2]),P=Math.floor(n.base[1]),b=Math.floor(n.max[1]);if(!v.testFluid(B,P,J))return y.inFluid=!1,void(y.ratioInFluid=0);var Y=1,a=P+1;for(;a<=b&&v.testFluid(B,a,J);)Y++,a++;var Z=(P+Y-n.base[1])/n.wh[1];Z>1&&(Z=1);var x=n.wh[0]*n.wh[1]*n.wh[2]*Z,f=u;l.scale(f,v.gravity,-v.Ed*x*y.td),y.applyForce(f),y.inFluid=!0,y.ratioInFluid=Z}(v,y),p(y._forces),p(y._impulses),p(y.ng),p(y.resting),l.scale(f,y._forces,1/y.mass),l.Rd(f,f,v.gravity,y.td),l.scale(N,y._impulses,1/y.mass),l.Rd(N,N,f,n),l.add(y.ng,y.ng,N),y.friction&&(O(v,0,y,N,n),O(v,1,y,N,n),O(v,2,y,N,n));var P=y.fluidDrag>=0?y.fluidDrag:v.fluidDrag,b=y.sh>=0?y.sh:v.sh,Y=b,Z=b;y.inFluid&&(Y=C(y,Y,y.fluidDragHoriz>=0?y.fluidDragHoriz:P),Z=C(y,Z,y.fluidDragVert>=0?y.fluidDragVert:P));Y=Math.max(1-Y*n/y.mass,0),Z=Math.max(1-Z*n/y.mass,0),l.set(r,Y,Z,Y),l.multiply(y.ng,y.ng,r),l.scale(i,y.ng,n),l.set(y._forces,0,0,0),l.set(y._impulses,0,0,0),y.ud&&V(L,y.Xg);l.i(h,i),l.set(E,0,0,0),y.preventFallOffEdge&&function(v,y,n,B){if(!y.resting[1]||n[1]>0)return;var J=w;V(J,y.Xg);for(var P=0;P<3;P+=2){l.set(S,0,0,0),S[P]=n[P];var b=!0;(b=(b=(b=(b=b&&!M(v,J.base[0]+S[0]+1e-5,J.base[1],J.base[2]+S[2]+1e-5))&&!M(v,J.max[0]+S[0]-1e-5,J.base[1],J.base[2]+S[2]+1e-5))&&!M(v,J.base[0]+S[0]+1e-5,J.base[1],J.max[2]+S[2]-1e-5))&&!M(v,J.max[0]+S[0]-1e-5,J.base[1],J.max[2]+S[2]-1e-5))?(B[P]=n[P]>0?1:-1,n[P]=0):0===P&&(l.set(k,n[0],0,0),q(v,J,k,B,y.slideOnCollision))}}(v,y,i,E);q(v,y.Xg,i,y.resting,y.slideOnCollision),y.ud&&function(v,y,n,B){if(y.resting[1]>=0&&!y.inFluid)return;var J=0!==y.resting[0],P=0!==y.resting[2];if(!J&&!P)return;var b=Math.abs(B[0]/B[2]),Y=4;if(!J&&b>Y)return;if(!P&&b<1/Y)return;l.add(G,n.base,B);var Z=v.testSolid;a(Z,n,B,(function(v,y,n,B){if(1!==y)return!0;B[y]=0}));var x=n.base[1],f=y.inFluid?1.951:1.001,N=Math.floor(x+f)-x;l.set(R,0,N,0);var i=!1;if(a(Z,n,R,(function(v,y,n,B){return i=!0,!0})),i)return;l.od(F,G,n.base),F[1]=0,q(v,n,F,t,!0);var g=j(n.base[0],G[0]),c=j(n.base[2],G[2]);if(J&&!g&&(!c||!P))return;if(P&&(!g||!J)&&!c)return;var h=!0;if(h=h&&!M(v,n.base[0]+1e-5,n.base[1],n.base[2]+1e-5),h=h&&!M(v,n.max[0]-1e-5,n.base[1],n.base[2]+1e-5),h=h&&!M(v,n.base[0]+1e-5,n.base[1],n.max[2]-1e-5),h=h&&!M(v,n.max[0]-1e-5,n.base[1],n.max[2]-1e-5),h)return;V(y.Xg,n),y.resting[0]=t[0],y.resting[2]=t[2],y.Il&&y.Il()}(v,y,L,h);for(var x=0;x<3;++x)y.resting[x]=y.resting[x]||E[x],g[x]=0,y.resting[x]&&(c[x]||(g[x]=-y.ng[x]),y.ng[x]=0);var W=l.length(g);W>.001&&(l.scale(g,g,y.mass),y.Wk&&y.Wk(g),y.restitution>0&&W>v.minBounceImpulse&&(l.scale(g,g,y.restitution),y.applyImpulse(g)));var d=l.squaredLength(y.ng);d>1e-5&&y.tg();v.sk&&v.sk(y)?(y.loadFromCopy(s),y.rolledBackLastTick=!0):y.rolledBackLastTick=!1}(this,n,v,y)))};var r=l.create([0,0,0]);var u=l.create();function O(v,y,n,B,J){var P=n.resting[y],b=B[y];if(!n.alwaysApplyHorizFriction||1!==y){if(0===P)return;if(P*b<=0)return}l.i(d,n.ng),d[y]=0;var Y=l.length(d);if(!j(Y,0)){var a=Math.abs(n.friction*v.gravity[y]*J),Z=Y>a?(Y-a)/Y:0;n.ng[(y+1)%3]*=Z,n.ng[(y+2)%3]*=Z}}var d=l.create();function q(v,y,n,B,J){return l.set(B,0,0,0),a(v.testSolid,y,n,(function(v,y,n,P){B[y]=n,P[y]=0,J||(P[0]=0,P[1]=0,P[2]=0)}))}var L=new Y([],[]),t=l.create(),G=l.create(),R=l.create(),F=l.create();var S=l.create(),w=new Y([],[]),k=l.create();function M(v,y,n,B){return v.testSolid(Math.floor(y),Math.floor(n-1),Math.floor(B))}var I=l.create();function j(v,y){return Math.abs(v-y)<1e-5}function V(v,y){for(var n=0;n<3;n++)v.base[n]=y.base[n],v.max[n]=y.max[n],v.wh[n]=y.wh[n]}var p=function(v){}},10702:function(v,y){!function(v){"use strict";var y=function(v,n){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,y){v.__proto__=y}||function(v,y){for(var n in y)Object.prototype.hasOwnProperty.call(y,n)&&(v[n]=y[n])},y(v,n)};function n(v,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function B(){this.constructor=v}y(v,n),v.prototype=null===n?Object.create(n):(B.prototype=n.prototype,new B)}function B(v,y,n,B){var J,P=arguments.length,b=P<3?y:null===B?B=Object.getOwnPropertyDescriptor(y,n):B;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)b=Reflect.decorate(v,y,n,B);else for(var Y=v.length-1;Y>=0;Y--)(J=v[Y])&&(b=(P<3?J(b):P>3?J(y,n,b):J(y,n))||b);return P>3&&b&&Object.defineProperty(y,n,b),b}function J(v,y,n){if(n||2===arguments.length)for(var B,J=0,P=y.length;J<P;J++)!B&&J in y||(B||(B=Array.prototype.slice.call(y,0,J)),B[J]=y[J]);return v.concat(B||Array.prototype.slice.call(y))}var P,b=255,Y=213;v.OPERATION=void 0,(P=v.OPERATION||(v.OPERATION={}))[P.ADD=128]="ADD",P[P.REPLACE=0]="REPLACE",P[P.DELETE=64]="DELETE",P[P.DELETE_AND_ADD=192]="DELETE_AND_ADD",P[P.TOUCH=1]="TOUCH",P[P.CLEAR=10]="CLEAR";var l=function(){function y(v,y,n){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=v,this.setParent(y,n)}return y.prototype.setParent=function(v,y,n){var B=this;if(this.indexes||(this.indexes=this.ref instanceof Fv?this.ref._definition.indexes:{}),this.parent=v,this.parentIndex=n,y)if(this.root=y,this.ref instanceof Fv){var J=this.ref._definition;for(var P in J.schema){var b=this.ref[P];if(b&&b.$changes){var Y=J.indexes[P];b.$changes.setParent(this.ref,y,Y)}}}else"object"===typeof this.ref&&this.ref.forEach((function(v,y){if(v instanceof Fv){var n=v.$changes,J=B.ref.$changes.indexes[y];n.setParent(B.ref,B.root,J)}}))},y.prototype.operation=function(v){this.changes.set(--this.currentCustomOperation,v)},y.prototype.change=function(y,n){void 0===n&&(n=v.OPERATION.ADD);var B="number"===typeof y?y:this.indexes[y];this.assertValidIndex(B,y);var J=this.changes.get(B);J&&J.op!==v.OPERATION.DELETE&&J.op!==v.OPERATION.TOUCH||this.changes.set(B,{op:J&&J.op===v.OPERATION.DELETE?v.OPERATION.DELETE_AND_ADD:n,index:B}),this.allChanges.add(B),this.changed=!0,this.touchParents()},y.prototype.touch=function(y){var n="number"===typeof y?y:this.indexes[y];this.assertValidIndex(n,y),this.changes.has(n)||this.changes.set(n,{op:v.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},y.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},y.prototype.getType=function(v){if(this.ref._definition)return(y=this.ref._definition).schema[y.fieldsByIndex[v]];var y,n=(y=this.parent._definition).schema[y.fieldsByIndex[this.parentIndex]];return Object.values(n)[0]},y.prototype.getChildrenFilter=function(){var v=this.parent._definition.childFilters;return v&&v[this.parentIndex]},y.prototype.getValue=function(v){return this.ref.getByIndex(v)},y.prototype.delete=function(y){var n="number"===typeof y?y:this.indexes[y];if(void 0!==n){var B=this.getValue(n);this.changes.set(n,{op:v.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],B&&B.$changes&&(B.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(y," (").concat(n,")"))},y.prototype.discard=function(y,n){var B=this;void 0===y&&(y=!1),void 0===n&&(n=!1),this.ref instanceof Fv||this.changes.forEach((function(y){if(y.op===v.OPERATION.DELETE){var n=B.ref.getIndex(y.index);delete B.indexes[n]}})),this.changes.clear(),this.changed=y,n&&this.allChanges.clear(),this.currentCustomOperation=0},y.prototype.discardAll=function(){var v=this;this.changes.forEach((function(y){var n=v.getValue(y.index);n&&n.$changes&&n.$changes.discardAll()})),this.discard()},y.prototype.cache=function(v,y){this.caches[v]=y},y.prototype.clone=function(){return new y(this.ref,this.parent,this.root)},y.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},y.prototype.assertValidIndex=function(v,y){if(void 0===v)throw new Error('ChangeTree: missing index for field "'.concat(y,'"'))},y}();function a(v,y,n,B){return v[y]||(v[y]=[]),v[y].push(n),null===B||void 0===B||B.forEach((function(v,y){return n(v,y)})),function(){return x(v[y],v[y].indexOf(n))}}function Z(y){var n=this,B="string"!==typeof this.$changes.getType();this.$items.forEach((function(J,P){y.push({refId:n.$changes.refId,op:v.OPERATION.DELETE,field:P,value:void 0,previousValue:J}),B&&n.$changes.root.removeRef(J.$changes.refId)}))}function x(v,y){if(-1===y||y>=v.length)return!1;for(var n=v.length-1,B=y;B<n;B++)v[B]=v[B+1];return v.length=n,!0}var f=function(v,y){var n=v.toString(),B=y.toString();return n<B?-1:n>B?1:0};function N(v){return v.$proxy=!0,v=new Proxy(v,{get:function(v,y){return"symbol"===typeof y||isNaN(y)?v[y]:v.at(y)},set:function(v,y,n){if("symbol"===typeof y||isNaN(y))v[y]=n;else{var B=Array.from(v.$items.keys()),J=parseInt(B[y]||y);void 0===n||null===n?v.deleteAt(J):v.setAt(J,n)}return!0},deleteProperty:function(v,y){return"number"===typeof y?v.deleteAt(y):delete v[y],!0}})}var i=function(){function y(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];this.$changes=new l(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,v)}return y.prototype.ge=function(y,n){return void 0===n&&(n=!0),a(this.$callbacks||(this.$callbacks=[]),v.OPERATION.ADD,y,n?this.$items:void 0)},y.prototype.ab=function(y){return a(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,y)},y.prototype.onChange=function(y){return a(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,y)},y.is=function(v){return Array.isArray(v)||void 0!==v.array},Object.defineProperty(y.prototype,"length",{get:function(){return this.$items.size},set:function(v){0===v?this.clear():this.splice(v,this.length-v)},enumerable:!1,configurable:!0}),y.prototype.push=function(){for(var v,y=this,n=[],B=0;B<arguments.length;B++)n[B]=arguments[B];return n.forEach((function(n){v=y.$refId++,y.setAt(v,n)})),v},y.prototype.pop=function(){var v=Array.from(this.$indexes.values()).pop();if(void 0!==v){this.$changes.delete(v),this.$indexes.delete(v);var y=this.$items.get(v);return this.$items.delete(v),y}},y.prototype.at=function(v){var y=Array.from(this.$items.keys())[v];return this.$items.get(y)},y.prototype.setAt=function(y,n){var B,J;if(void 0!==n&&null!==n){if(this.$items.get(y)!==n){void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,y);var P=null!==(J=null===(B=this.$changes.indexes[y])||void 0===B?void 0:B.op)&&void 0!==J?J:v.OPERATION.ADD;this.$changes.indexes[y]=y,this.$indexes.set(y,y),this.$items.set(y,n),this.$changes.change(y,P)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},y.prototype.deleteAt=function(v){var y=Array.from(this.$items.keys())[v];return void 0!==y&&this.$deleteAt(y)},y.prototype.$deleteAt=function(v){return this.$changes.delete(v),this.$indexes.delete(v),this.$items.delete(v)},y.prototype.clear=function(y){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),y&&Z.call(this,y),this.$items.clear(),this.$changes.operation({index:0,op:v.OPERATION.CLEAR}),this.$changes.touchParents()},y.prototype.concat=function(){for(var v,n=[],B=0;B<arguments.length;B++)n[B]=arguments[B];return new(y.bind.apply(y,J([void 0],(v=Array.from(this.$items.values())).concat.apply(v,n),!1)))},y.prototype.join=function(v){return Array.from(this.$items.values()).join(v)},y.prototype.reverse=function(){var v=this,y=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(n,B){v.setAt(y[B],n)})),this},y.prototype.shift=function(){var v=Array.from(this.$items.keys()).shift();if(void 0!==v){var y=this.$items.get(v);return this.$deleteAt(v),y}},y.prototype.slice=function(v,n){var B=new y;return B.push.apply(B,Array.from(this.$items.values()).slice(v,n)),B},y.prototype.sort=function(v){var y=this;void 0===v&&(v=f);var n=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(v).forEach((function(v,B){y.setAt(n[B],v)})),this},y.prototype.splice=function(v,y){void 0===y&&(y=this.length-v);for(var n=Array.from(this.$items.keys()),B=[],J=v;J<v+y;J++)B.push(this.$items.get(n[J])),this.$deleteAt(n[J]);return B},y.prototype.unshift=function(){for(var v=this,y=[],n=0;n<arguments.length;n++)y[n]=arguments[n];var B=this.length,J=y.length,P=Array.from(this.$items.values());return y.forEach((function(y,n){v.setAt(n,y)})),P.forEach((function(y,n){v.setAt(J+n,y)})),B+J},y.prototype.indexOf=function(v,y){return Array.from(this.$items.values()).indexOf(v,y)},y.prototype.lastIndexOf=function(v,y){return void 0===y&&(y=this.length-1),Array.from(this.$items.values()).lastIndexOf(v,y)},y.prototype.every=function(v,y){return Array.from(this.$items.values()).every(v,y)},y.prototype.some=function(v,y){return Array.from(this.$items.values()).some(v,y)},y.prototype.forEach=function(v,y){Array.from(this.$items.values()).forEach(v,y)},y.prototype.map=function(v,y){return Array.from(this.$items.values()).map(v,y)},y.prototype.filter=function(v,y){return Array.from(this.$items.values()).filter(v,y)},y.prototype.reduce=function(v,y){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},y.prototype.reduceRight=function(v,y){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},y.prototype.find=function(v,y){return Array.from(this.$items.values()).find(v,y)},y.prototype.findIndex=function(v,y){return Array.from(this.$items.values()).findIndex(v,y)},y.prototype.fill=function(v,y,n){throw new Error("ArraySchema#fill() not implemented")},y.prototype.copyWithin=function(v,y,n){throw new Error("ArraySchema#copyWithin() not implemented")},y.prototype.toString=function(){return this.$items.toString()},y.prototype.toLocaleString=function(){return this.$items.toLocaleString()},y.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(y,Symbol.species,{get:function(){return y},enumerable:!1,configurable:!0}),y.prototype.entries=function(){return this.$items.entries()},y.prototype.keys=function(){return this.$items.keys()},y.prototype.values=function(){return this.$items.values()},y.prototype.includes=function(v,y){return Array.from(this.$items.values()).includes(v,y)},y.prototype.flatMap=function(v,y){throw new Error("ArraySchema#flatMap() is not supported.")},y.prototype.flat=function(v){throw new Error("ArraySchema#flat() is not supported.")},y.prototype.findLast=function(){var v=Array.from(this.$items.values());return v.findLast.apply(v,arguments)},y.prototype.findLastIndex=function(){var v=Array.from(this.$items.values());return v.findLastIndex.apply(v,arguments)},y.prototype.setIndex=function(v,y){this.$indexes.set(v,y)},y.prototype.getIndex=function(v){return this.$indexes.get(v)},y.prototype.getByIndex=function(v){return this.$items.get(this.$indexes.get(v))},y.prototype.deleteByIndex=function(v){var y=this.$indexes.get(v);this.$items.delete(y),this.$indexes.delete(v)},y.prototype.toArray=function(){return Array.from(this.$items.values())},y.prototype.toJSON=function(){return this.toArray().map((function(v){return"function"===typeof v.toJSON?v.toJSON():v}))},y.prototype.clone=function(v){return v?new(y.bind.apply(y,J([void 0],Array.from(this.$items.values()),!1))):new(y.bind.apply(y,J([void 0],this.map((function(v){return v.$changes?v.clone():v})),!1)))},y}();function g(v){return v.$proxy=!0,v=new Proxy(v,{get:function(v,y){return"symbol"!==typeof y&&"undefined"===typeof v[y]?v.get(y):v[y]},set:function(v,y,n){return"symbol"!==typeof y&&-1===y.indexOf("$")&&"ge"!==y&&"ab"!==y&&"onChange"!==y?v.set(y,n):v[y]=n,!0},deleteProperty:function(v,y){return v.delete(y),!0}})}var c=function(){function y(v){var n=this;if(this.$changes=new l(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,v)if(v instanceof Map||v instanceof y)v.forEach((function(v,y){return n.set(y,v)}));else for(var B in v)this.set(B,v[B])}return y.prototype.ge=function(y,n){return void 0===n&&(n=!0),a(this.$callbacks||(this.$callbacks=[]),v.OPERATION.ADD,y,n?this.$items:void 0)},y.prototype.ab=function(y){return a(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,y)},y.prototype.onChange=function(y){return a(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,y)},y.is=function(v){return void 0!==v.map},y.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(y.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(y,Symbol.species,{get:function(){return y},enumerable:!1,configurable:!0}),y.prototype.set=function(y,n){if(void 0===n||null===n)throw new Error("MapSchema#set('".concat(y,"', ").concat(n,"): trying to set ").concat(n," value on '").concat(y,"'."));y=y.toString();var B="undefined"!==typeof this.$changes.indexes[y],J=B?this.$changes.indexes[y]:this.$refId++,P=B?v.OPERATION.REPLACE:v.OPERATION.ADD,b=void 0!==n.$changes;if(b&&n.$changes.setParent(this,this.$changes.root,J),B){if(!b&&this.$items.get(y)===n)return;b&&this.$items.get(y)!==n&&(P=v.OPERATION.ADD)}else this.$changes.indexes[y]=J,this.$indexes.set(J,y);return this.$items.set(y,n),this.$changes.change(y,P),this},y.prototype.get=function(v){return this.$items.get(v)},y.prototype.delete=function(v){return this.$changes.delete(v),this.$items.delete(v)},y.prototype.clear=function(y){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),y&&Z.call(this,y),this.$items.clear(),this.$changes.operation({index:0,op:v.OPERATION.CLEAR}),this.$changes.touchParents()},y.prototype.has=function(v){return this.$items.has(v)},y.prototype.forEach=function(v){this.$items.forEach(v)},y.prototype.entries=function(){return this.$items.entries()},y.prototype.keys=function(){return this.$items.keys()},y.prototype.values=function(){return this.$items.values()},Object.defineProperty(y.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),y.prototype.setIndex=function(v,y){this.$indexes.set(v,y)},y.prototype.getIndex=function(v){return this.$indexes.get(v)},y.prototype.getByIndex=function(v){return this.$items.get(this.$indexes.get(v))},y.prototype.deleteByIndex=function(v){var y=this.$indexes.get(v);this.$items.delete(y),this.$indexes.delete(v)},y.prototype.toJSON=function(){var v={};return this.forEach((function(y,n){v[n]="function"===typeof y.toJSON?y.toJSON():y})),v},y.prototype.clone=function(v){var n;return v?n=Object.assign(new y,this):(n=new y,this.forEach((function(v,y){v.$changes?n.set(y,v.clone()):n.set(y,v)}))),n},y}(),h={};function E(v,y){h[v]=y}function W(v){return h[v]}var s=function(){function v(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return v.create=function(y){var n=new v;return n.schema=Object.assign({},y&&y.schema||{}),n.indexes=Object.assign({},y&&y.indexes||{}),n.fieldsByIndex=Object.assign({},y&&y.fieldsByIndex||{}),n.descriptors=Object.assign({},y&&y.descriptors||{}),n.deprecated=Object.assign({},y&&y.deprecated||{}),n},v.prototype.addField=function(v,y){var n=this.getNextFieldIndex();this.fieldsByIndex[n]=v,this.indexes[v]=n,this.schema[v]=Array.isArray(y)?{array:y[0]}:y},v.prototype.hasField=function(v){return void 0!==this.indexes[v]},v.prototype.addFilter=function(v,y){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[v]]=y,this.indexesWithFilters.push(this.indexes[v]),!0},v.prototype.addChildrenFilter=function(v,y){var n=this.indexes[v],B=this.schema[v];if(W(Object.keys(B)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[n]=y,!0;console.warn("@filterChildren: field '".concat(v,"' can't have children. Ignoring filter."))},v.prototype.getChildrenFilter=function(v){return this.childFilters&&this.childFilters[this.indexes[v]]},v.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},v}();function C(v){return v._context&&v._context.useFilters}var r=function(){function v(){this.types={},this.schemas=new Map,this.useFilters=!1}return v.prototype.has=function(v){return this.schemas.has(v)},v.prototype.get=function(v){return this.types[v]},v.prototype.add=function(v,y){void 0===y&&(y=this.schemas.size),v._definition=s.create(v._definition),v._typeid=y,this.types[y]=v,this.schemas.set(v,y)},v.create=function(y){return void 0===y&&(y={}),function(n){return y.context||(y.context=new v),O(n,y)}},v}(),u=new r;function O(v,y){return void 0===y&&(y={}),function(n,B){var P=y.context||u,b=n.constructor;if(b._context=P,!v)throw new Error("".concat(b.name,': @type() reference provided for "').concat(B,"\" is undefined. Make sure you don't have any circular dependencies."));P.has(b)||P.add(b);var Y=b._definition;if(Y.addField(B,v),Y.descriptors[B]){if(Y.deprecated[B])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(B,"' definition on '").concat(b.name,"'.\nCheck @type() annotation"))}catch(h){var l=h.stack.split("\n")[4].trim();throw new Error("".concat(h.message," ").concat(l))}}var a=i.is(v),Z=!a&&c.is(v);if("string"!==typeof v&&!Fv.is(v)){var x=Object.values(v)[0];"string"===typeof x||P.has(x)||P.add(x)}if(y.manual)Y.descriptors[B]={enumerable:!0,configurable:!0,writable:!0};else{var f="_".concat(B);Y.descriptors[f]={enumerable:!1,configurable:!1,writable:!0},Y.descriptors[B]={get:function(){return this[f]},set:function(v){v!==this[f]&&(void 0!==v&&null!==v?(!a||v instanceof i||(v=new(i.bind.apply(i,J([void 0],v,!1)))),!Z||v instanceof c||(v=new c(v)),void 0===v.$proxy&&(Z?v=g(v):a&&(v=N(v))),this.$changes.change(B),v.$changes&&v.$changes.setParent(this,this.$changes.root,this._definition.indexes[B])):this[f]&&this.$changes.delete(B),this[f]=v)},enumerable:!0,configurable:!0}}}}function d(v){return function(y,n){var B=y.constructor;B._definition.addFilter(n,v)&&(B._context.useFilters=!0)}}function q(v){return function(y,n){var B=y.constructor;B._definition.addChildrenFilter(n,v)&&(B._context.useFilters=!0)}}function L(v){return void 0===v&&(v=!0),function(y,n){var B=y.constructor._definition;B.deprecated[n]=!0,v&&(B.descriptors[n]={get:function(){throw new Error("".concat(n," is deprecated."))},set:function(v){},enumerable:!1,configurable:!0})}}function t(v,y,n){for(var B in void 0===n&&(n={}),n.context||(n.context=v._context||n.context||u),y)O(y[B],n)(v.prototype,B);return v}function G(v){for(var y=0,n=0,B=0,J=v.length;B<J;B++)(y=v.charCodeAt(B))<128?n+=1:y<2048?n+=2:y<55296||y>=57344?n+=3:(B++,n+=4);return n}function R(v,y,n){for(var B=0,J=0,P=n.length;J<P;J++)(B=n.charCodeAt(J))<128?v[y++]=B:B<2048?(v[y++]=192|B>>6,v[y++]=128|63&B):B<55296||B>=57344?(v[y++]=224|B>>12,v[y++]=128|B>>6&63,v[y++]=128|63&B):(J++,B=65536+((1023&B)<<10|1023&n.charCodeAt(J)),v[y++]=240|B>>18,v[y++]=128|B>>12&63,v[y++]=128|B>>6&63,v[y++]=128|63&B)}function F(v,y){v.push(255&y)}function S(v,y){v.push(255&y)}function w(v,y){v.push(255&y),v.push(y>>8&255)}function k(v,y){v.push(255&y),v.push(y>>8&255)}function M(v,y){v.push(255&y),v.push(y>>8&255),v.push(y>>16&255),v.push(y>>24&255)}function I(v,y){var n=y>>24,B=y>>16,J=y>>8,P=y;v.push(255&P),v.push(255&J),v.push(255&B),v.push(255&n)}function j(v,y){var n=Math.floor(y/Math.pow(2,32));I(v,y>>>0),I(v,n)}function V(v,y){var n=y/Math.pow(2,32)|0;I(v,y>>>0),I(v,n)}function p(v,y){z(v,y)}function H(v,y){e(v,y)}var A=new Int32Array(2),X=new Float32Array(A.buffer),U=new Float64Array(A.buffer);function z(v,y){X[0]=y,M(v,A[0])}function e(v,y){U[0]=y,M(v,A[0]),M(v,A[1])}function K(v,y){return S(v,y?1:0)}function D(v,y){y||(y="");var n=G(y),B=0;if(n<32)v.push(160|n),B=1;else if(n<256)v.push(217),S(v,n),B=2;else if(n<65536)v.push(218),k(v,n),B=3;else{if(!(n<4294967296))throw new Error("String too long");v.push(219),I(v,n),B=5}return R(v,v.length,y),B+n}function Q(v,y){return isNaN(y)?Q(v,0):isFinite(y)?y!==(0|y)?(v.push(203),e(v,y),9):y>=0?y<128?(S(v,y),1):y<256?(v.push(204),S(v,y),2):y<65536?(v.push(205),k(v,y),3):y<4294967296?(v.push(206),I(v,y),5):(v.push(207),V(v,y),9):y>=-32?(v.push(224|y+32),1):y>=-128?(v.push(208),F(v,y),2):y>=-32768?(v.push(209),w(v,y),3):y>=-2147483648?(v.push(210),M(v,y),5):(v.push(211),j(v,y),9):Q(v,y>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var o=Object.freeze({__proto__:null,utf8Write:R,int8:F,uint8:S,int16:w,uint16:k,int32:M,uint32:I,int64:j,uint64:V,float32:p,float64:H,writeFloat32:z,writeFloat64:e,boolean:K,string:D,number:Q});function T(v,y,n){for(var B="",J=0,P=y,b=y+n;P<b;P++){var Y=v[P];0!==(128&Y)?192!==(224&Y)?224!==(240&Y)?240!==(248&Y)?console.error("Invalid byte "+Y.toString(16)):(J=(7&Y)<<18|(63&v[++P])<<12|(63&v[++P])<<6|63&v[++P])>=65536?(J-=65536,B+=String.fromCharCode(55296+(J>>>10),56320+(1023&J))):B+=String.fromCharCode(J):B+=String.fromCharCode((15&Y)<<12|(63&v[++P])<<6|63&v[++P]):B+=String.fromCharCode((31&Y)<<6|63&v[++P]):B+=String.fromCharCode(Y)}return B}function m(v,y){return vv(v,y)<<24>>24}function vv(v,y){return v[y.offset++]}function yv(v,y){return nv(v,y)<<16>>16}function nv(v,y){return v[y.offset++]|v[y.offset++]<<8}function Bv(v,y){return v[y.offset++]|v[y.offset++]<<8|v[y.offset++]<<16|v[y.offset++]<<24}function Jv(v,y){return Bv(v,y)>>>0}function Pv(v,y){return fv(v,y)}function bv(v,y){return Nv(v,y)}function Yv(v,y){var n=Jv(v,y);return Bv(v,y)*Math.pow(2,32)+n}function lv(v,y){var n=Jv(v,y);return Jv(v,y)*Math.pow(2,32)+n}var av=new Int32Array(2),Zv=new Float32Array(av.buffer),xv=new Float64Array(av.buffer);function fv(v,y){return av[0]=Bv(v,y),Zv[0]}function Nv(v,y){return av[0]=Bv(v,y),av[1]=Bv(v,y),xv[0]}function iv(v,y){return vv(v,y)>0}function gv(v,y){var n,B=v[y.offset++];B<192?n=31&B:217===B?n=vv(v,y):218===B?n=nv(v,y):219===B&&(n=Jv(v,y));var J=T(v,y.offset,n);return y.offset+=n,J}function cv(v,y){var n=v[y.offset];return n<192&&n>160||217===n||218===n||219===n}function hv(v,y){var n=v[y.offset++];return n<128?n:202===n?fv(v,y):203===n?Nv(v,y):204===n?vv(v,y):205===n?nv(v,y):206===n?Jv(v,y):207===n?lv(v,y):208===n?m(v,y):209===n?yv(v,y):210===n?Bv(v,y):211===n?Yv(v,y):n>223?-1*(255-n+1):void 0}function Ev(v,y){var n=v[y.offset];return n<128||n>=202&&n<=211}function Wv(v,y){return v[y.offset]<160}function sv(v,y){return v[y.offset-1]===b&&(v[y.offset]<128||v[y.offset]>=202&&v[y.offset]<=211)}var Cv=Object.freeze({__proto__:null,int8:m,uint8:vv,int16:yv,uint16:nv,int32:Bv,uint32:Jv,float32:Pv,float64:bv,int64:Yv,uint64:lv,readFloat32:fv,readFloat64:Nv,boolean:iv,string:gv,stringCheck:cv,number:hv,numberCheck:Ev,arrayCheck:Wv,switchStructureCheck:sv}),rv=function(){function y(v){var y=this;this.$changes=new l(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,v&&v.forEach((function(v){return y.add(v)}))}return y.prototype.ge=function(y,n){return void 0===n&&(n=!0),a(this.$callbacks||(this.$callbacks=[]),v.OPERATION.ADD,y,n?this.$items:void 0)},y.prototype.ab=function(y){return a(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,y)},y.prototype.onChange=function(y){return a(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,y)},y.is=function(v){return void 0!==v.collection},y.prototype.add=function(v){var y=this.$refId++;return void 0!==v.$changes&&v.$changes.setParent(this,this.$changes.root,y),this.$changes.indexes[y]=y,this.$indexes.set(y,y),this.$items.set(y,v),this.$changes.change(y),y},y.prototype.at=function(v){var y=Array.from(this.$items.keys())[v];return this.$items.get(y)},y.prototype.entries=function(){return this.$items.entries()},y.prototype.delete=function(v){for(var y,n,B=this.$items.entries();(n=B.next())&&!n.done;)if(v===n.value[1]){y=n.value[0];break}return void 0!==y&&(this.$changes.delete(y),this.$indexes.delete(y),this.$items.delete(y))},y.prototype.clear=function(y){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),y&&Z.call(this,y),this.$items.clear(),this.$changes.operation({index:0,op:v.OPERATION.CLEAR}),this.$changes.touchParents()},y.prototype.has=function(v){return Array.from(this.$items.values()).some((function(y){return y===v}))},y.prototype.forEach=function(v){var y=this;this.$items.forEach((function(n,B,J){return v(n,B,y)}))},y.prototype.values=function(){return this.$items.values()},Object.defineProperty(y.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),y.prototype.setIndex=function(v,y){this.$indexes.set(v,y)},y.prototype.getIndex=function(v){return this.$indexes.get(v)},y.prototype.getByIndex=function(v){return this.$items.get(this.$indexes.get(v))},y.prototype.deleteByIndex=function(v){var y=this.$indexes.get(v);this.$items.delete(y),this.$indexes.delete(v)},y.prototype.toArray=function(){return Array.from(this.$items.values())},y.prototype.toJSON=function(){var v=[];return this.forEach((function(y,n){v.push("function"===typeof y.toJSON?y.toJSON():y)})),v},y.prototype.clone=function(v){var n;return v?n=Object.assign(new y,this):(n=new y,this.forEach((function(v){v.$changes?n.add(v.clone()):n.add(v)}))),n},y}(),uv=function(){function y(v){var y=this;this.$changes=new l(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,v&&v.forEach((function(v){return y.add(v)}))}return y.prototype.ge=function(y,n){return void 0===n&&(n=!0),a(this.$callbacks||(this.$callbacks=[]),v.OPERATION.ADD,y,n?this.$items:void 0)},y.prototype.ab=function(y){return a(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,y)},y.prototype.onChange=function(y){return a(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,y)},y.is=function(v){return void 0!==v.set},y.prototype.add=function(y){var n,B;if(this.has(y))return!1;var J=this.$refId++;void 0!==y.$changes&&y.$changes.setParent(this,this.$changes.root,J);var P=null!==(B=null===(n=this.$changes.indexes[J])||void 0===n?void 0:n.op)&&void 0!==B?B:v.OPERATION.ADD;return this.$changes.indexes[J]=J,this.$indexes.set(J,J),this.$items.set(J,y),this.$changes.change(J,P),J},y.prototype.entries=function(){return this.$items.entries()},y.prototype.delete=function(v){for(var y,n,B=this.$items.entries();(n=B.next())&&!n.done;)if(v===n.value[1]){y=n.value[0];break}return void 0!==y&&(this.$changes.delete(y),this.$indexes.delete(y),this.$items.delete(y))},y.prototype.clear=function(y){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),y&&Z.call(this,y),this.$items.clear(),this.$changes.operation({index:0,op:v.OPERATION.CLEAR}),this.$changes.touchParents()},y.prototype.has=function(v){for(var y,n=this.$items.values(),B=!1;(y=n.next())&&!y.done;)if(v===y.value){B=!0;break}return B},y.prototype.forEach=function(v){var y=this;this.$items.forEach((function(n,B,J){return v(n,B,y)}))},y.prototype.values=function(){return this.$items.values()},Object.defineProperty(y.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),y.prototype.setIndex=function(v,y){this.$indexes.set(v,y)},y.prototype.getIndex=function(v){return this.$indexes.get(v)},y.prototype.getByIndex=function(v){return this.$items.get(this.$indexes.get(v))},y.prototype.deleteByIndex=function(v){var y=this.$indexes.get(v);this.$items.delete(y),this.$indexes.delete(v)},y.prototype.toArray=function(){return Array.from(this.$items.values())},y.prototype.toJSON=function(){var v=[];return this.forEach((function(y,n){v.push("function"===typeof y.toJSON?y.toJSON():y)})),v},y.prototype.clone=function(v){var n;return v?n=Object.assign(new y,this):(n=new y,this.forEach((function(v){v.$changes?n.add(v.clone()):n.add(v)}))),n},y}(),Ov=function(){function v(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return v.prototype.addRefId=function(v){this.refIds.has(v)||(this.refIds.add(v),this.containerIndexes.set(v,new Set))},v.get=function(y){return void 0===y.$filterState&&(y.$filterState=new v),y.$filterState},v}(),dv=function(){function v(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return v.prototype.getNextUniqueId=function(){return this.nextUniqueId++},v.prototype.addRef=function(v,y,n){void 0===n&&(n=!0),this.refs.set(v,y),n&&(this.refCounts[v]=(this.refCounts[v]||0)+1)},v.prototype.removeRef=function(v){this.refCounts[v]=this.refCounts[v]-1,this.deletedRefs.add(v)},v.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},v.prototype.garbageCollectDeletedRefs=function(){var v=this;this.deletedRefs.forEach((function(y){if(!(v.refCounts[y]>0)){var n=v.refs.get(y);if(n instanceof Fv)for(var B in n._definition.schema)"string"!==typeof n._definition.schema[B]&&n[B]&&n[B].$changes&&v.removeRef(n[B].$changes.refId);else{var J=n.$changes.parent._definition,P=J.schema[J.fieldsByIndex[n.$changes.parentIndex]];"function"===typeof Object.values(P)[0]&&Array.from(n.values()).forEach((function(y){return v.removeRef(y.$changes.refId)}))}v.refs.delete(y),delete v.refCounts[y]}})),this.deletedRefs.clear()},v}(),qv=function(v){function y(){return null!==v&&v.apply(this,arguments)||this}return n(y,v),y}(Error);function Lv(v,y,n,B){var J,P=!1;switch(y){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":J="number",isNaN(v)&&console.log('trying to encode "NaN" in '.concat(n.constructor.name,"#").concat(B));break;case"string":J="string",P=!0;break;case"boolean":return}if(typeof v!==J&&(!P||P&&null!==v)){var b="'".concat(JSON.stringify(v),"'").concat(v&&v.constructor&&" (".concat(v.constructor.name,")")||"");throw new qv("a '".concat(J,"' was expected, but ").concat(b," was provided in ").concat(n.constructor.name,"#").concat(B))}}function tv(v,y,n,B){if(!(v instanceof y))throw new qv("a '".concat(y.name,"' was expected, but '").concat(v.constructor.name,"' was provided in ").concat(n.constructor.name,"#").concat(B))}function Gv(v,y,n,B,J){Lv(n,v,B,J);var P=o[v];if(!P)throw new qv("a '".concat(v,"' was expected, but ").concat(n," was provided in ").concat(B.constructor.name,"#").concat(J));P(y,n)}function Rv(v,y,n){return Cv[v](y,n)}var Fv=function(){function y(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];Object.defineProperties(this,{$changes:{value:new l(this,void 0,new dv),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var n=this._definition.descriptors;n&&Object.defineProperties(this,n),v[0]&&this.assign(v[0])}return y.onError=function(v){console.error(v)},y.is=function(v){return v._definition&&void 0!==v._definition.schema},y.prototype.onChange=function(y){return a(this.$callbacks||(this.$callbacks=[]),v.OPERATION.REPLACE,y)},y.prototype.ab=function(y){return a(this.$callbacks||(this.$callbacks=[]),v.OPERATION.DELETE,y)},y.prototype.assign=function(v){return Object.assign(this,v),this},Object.defineProperty(y.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),y.prototype.setDirty=function(v,y){this.$changes.change(v,y)},y.prototype.listen=function(v,y,n){var B=this;return void 0===n&&(n=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[v]||(this.$callbacks[v]=[]),this.$callbacks[v].push(y),n&&void 0!==this[v]&&y(this[v],void 0),function(){return x(B.$callbacks[v],B.$callbacks[v].indexOf(y))}},y.prototype.decode=function(n,B,J){var P;void 0===B&&(B={offset:0}),void 0===J&&(J=this);var Y=[],l=this.$changes.root,a=n.length,Z=0;for(l.refs.set(Z,this);B.offset<a;){var x=n[B.offset++];if(x!=b){var f=J.$changes,N=void 0!==J._definition,g=N?x>>6<<6:x;if(g!==v.OPERATION.CLEAR){var h=N?x%(g||255):hv(n,B),E=N?J._definition.fieldsByIndex[h]:"",s=f.getType(h),C=void 0,r=void 0,u=void 0;if(N?r=J["_".concat(E)]:(r=J.getByIndex(h),(g&v.OPERATION.ADD)===v.OPERATION.ADD?(u=J instanceof c?gv(n,B):h,J.setIndex(h,u)):u=J.getIndex(h)),(g&v.OPERATION.DELETE)===v.OPERATION.DELETE&&(g!==v.OPERATION.DELETE_AND_ADD&&J.deleteByIndex(h),r&&r.$changes&&l.removeRef(r.$changes.refId),C=null),void 0!==E){if(g===v.OPERATION.DELETE);else if(y.is(s)){var O=hv(n,B);if(C=l.refs.get(O),g!==v.OPERATION.REPLACE){var d=this.getSchemaType(n,B,s);C||((C=this.createTypeInstance(d)).$changes.refId=O,r&&(C.$callbacks=r.$callbacks,r.$changes.refId&&O!==r.$changes.refId&&l.removeRef(r.$changes.refId))),l.addRef(O,C,C!==r)}}else if("string"===typeof s)C=Rv(s,n,B);else{var q=W(Object.keys(s)[0]),L=hv(n,B),t=l.refs.has(L)?r||l.refs.get(L):new q.constructor;if((C=t.clone(!0)).$changes.refId=L,r&&(C.$callbacks=r.$callbacks,r.$changes.refId&&L!==r.$changes.refId)){l.removeRef(r.$changes.refId);for(var G=r.entries(),R=void 0;(R=G.next())&&!R.done;){var F=(P=R.value)[0],S=P[1];Y.push({refId:L,op:v.OPERATION.DELETE,field:F,value:void 0,previousValue:S})}}l.addRef(L,C,t!==r)}if(null!==C&&void 0!==C)if(C.$changes&&C.$changes.setParent(f.ref,f.root,h),J instanceof y)J[E]=C;else if(J instanceof c)F=u,J.$items.set(F,C),J.$changes.allChanges.add(h);else if(J instanceof i)J.setAt(h,C);else if(J instanceof rv){var w=J.add(C);J.setIndex(h,w)}else J instanceof uv&&!1!==(w=J.add(C))&&J.setIndex(h,w);r!==C&&Y.push({refId:Z,op:g,field:E,dynamicIndex:u,value:C,previousValue:r})}else{console.warn("@colyseus/schema: definition mismatch");for(var k={offset:B.offset};B.offset<a&&(!sv(n,B)||(k.offset=B.offset+1,!l.refs.has(hv(n,k))));)B.offset++}}else J.clear(Y)}else{Z=hv(n,B);var M=l.refs.get(Z);if(!M)throw new Error('"refId" not found: '.concat(Z));J=M}}return this._triggerChanges(Y),l.garbageCollectDeletedRefs(),Y},y.prototype.encode=function(n,B,J){void 0===n&&(n=!1),void 0===B&&(B=[]),void 0===J&&(J=!1);for(var P=this.$changes,Y=new WeakSet,l=[P],a=1,Z=0;Z<a;Z++){var x=l[Z],f=x.ref,N=f instanceof y;x.ensureRefId(),Y.add(x),x!==P&&(x.changed||n)&&(S(B,b),Q(B,x.refId));for(var i=n?Array.from(x.allChanges):Array.from(x.changes.values()),g=0,h=i.length;g<h;g++){var E=n?{op:v.OPERATION.ADD,index:i[g]}:i[g],s=E.index,C=N?f._definition.fieldsByIndex&&f._definition.fieldsByIndex[s]:s,r=B.length;if(E.op!==v.OPERATION.TOUCH)if(N)S(B,s|E.op);else{if(S(B,E.op),E.op===v.OPERATION.CLEAR)continue;Q(B,s)}if(N||(E.op&v.OPERATION.ADD)!=v.OPERATION.ADD||f instanceof c&&D(B,x.ref.$indexes.get(s)),E.op!==v.OPERATION.DELETE){var u=x.getType(s),O=x.getValue(s);if(O&&O.$changes&&!Y.has(O.$changes)&&(l.push(O.$changes),O.$changes.ensureRefId(),a++),E.op!==v.OPERATION.TOUCH){if(y.is(u))tv(O,u,f,C),Q(B,O.$changes.refId),(E.op&v.OPERATION.ADD)===v.OPERATION.ADD&&this.tryEncodeTypeId(B,u,O.constructor);else if("string"===typeof u)Gv(u,B,O,f,C);else{var d=W(Object.keys(u)[0]);tv(f["_".concat(C)],d.constructor,f,C),Q(B,O.$changes.refId)}J&&x.cache(s,B.slice(r))}}}n||J||x.discard()}return B},y.prototype.encodeAll=function(v){return this.encode(!0,[],v)},y.prototype.applyFilters=function(n,B){var J,P;void 0===B&&(B=!1);for(var Y=this,l=new Set,a=Ov.get(n),Z=[this.$changes],x=1,f=[],N=function(N){var i=Z[N];if(l.has(i.refId))return"continue";var g=i.ref,h=g instanceof y;S(f,b),Q(f,i.refId);var E=a.refIds.has(i),W=B||!E;a.addRefId(i);var s=a.containerIndexes.get(i),C=W?Array.from(i.allChanges):Array.from(i.changes.values());!B&&h&&g._definition.indexesWithFilters&&g._definition.indexesWithFilters.forEach((function(y){!s.has(y)&&i.allChanges.has(y)&&(W?C.push(y):C.push({op:v.OPERATION.ADD,index:y}))}));for(var r=0,u=C.length;r<u;r++){var O=W?{op:v.OPERATION.ADD,index:C[r]}:C[r];if(O.op!==v.OPERATION.CLEAR){var d=O.index;if(O.op!==v.OPERATION.DELETE){var q=i.getValue(d),L=i.getType(d);if(h){if((t=g._definition.filters&&g._definition.filters[d])&&!t.call(g,n,q,Y)){q&&q.$changes&&l.add(q.$changes.refId);continue}}else{var t,G=i.parent;if((t=i.getChildrenFilter())&&!t.call(G,n,g.$indexes.get(d),q,Y)){q&&q.$changes&&l.add(q.$changes.refId);continue}}if(q.$changes&&(Z.push(q.$changes),x++),O.op!==v.OPERATION.TOUCH)if(O.op===v.OPERATION.ADD||h)f.push.apply(f,null!==(J=i.caches[d])&&void 0!==J?J:[]),s.add(d);else if(s.has(d))f.push.apply(f,null!==(P=i.caches[d])&&void 0!==P?P:[]);else{if(s.add(d),S(f,v.OPERATION.ADD),Q(f,d),g instanceof c){var R=i.ref.$indexes.get(d);D(f,R)}q.$changes?Q(f,q.$changes.refId):o[L](f,q)}else q.$changes&&!h&&(S(f,v.OPERATION.ADD),Q(f,d),g instanceof c&&(R=i.ref.$indexes.get(d),D(f,R)),Q(f,q.$changes.refId))}else h?S(f,O.op|d):(S(f,O.op),Q(f,d))}else S(f,O.op)}},i=0;i<x;i++)N(i);return f},y.prototype.clone=function(){var v,y=new this.constructor,n=this._definition.schema;for(var B in n)"object"===typeof this[B]&&"function"===typeof(null===(v=this[B])||void 0===v?void 0:v.clone)?y[B]=this[B].clone():y[B]=this[B];return y},y.prototype.toJSON=function(){var v=this._definition.schema,y=this._definition.deprecated,n={};for(var B in v)y[B]||null===this[B]||"undefined"===typeof this[B]||(n[B]="function"===typeof this[B].toJSON?this[B].toJSON():this["_".concat(B)]);return n},y.prototype.discardAllChanges=function(){this.$changes.discardAll()},y.prototype.getByIndex=function(v){return this[this._definition.fieldsByIndex[v]]},y.prototype.deleteByIndex=function(v){this[this._definition.fieldsByIndex[v]]=void 0},y.prototype.tryEncodeTypeId=function(v,y,n){y._typeid!==n._typeid&&(S(v,Y),Q(v,n._typeid))},y.prototype.getSchemaType=function(v,y,n){var B;return v[y.offset]===Y&&(y.offset++,B=this.constructor._context.get(hv(v,y))),B||n},y.prototype.createTypeInstance=function(v){var y=new v;return y.$changes.root=this.$changes.root,y},y.prototype._triggerChanges=function(n){for(var B,J,P,b,Y,l,a,Z,x,f=new Set,N=this.$changes.root.refs,i=function(i){var g=n[i],c=g.refId,h=N.get(c),E=h.$callbacks;if((g.op&v.OPERATION.DELETE)===v.OPERATION.DELETE&&g.previousValue instanceof y&&(null===(J=null===(B=g.previousValue.$callbacks)||void 0===B?void 0:B[v.OPERATION.DELETE])||void 0===J||J.forEach((function(v){return v()}))),!E)return"continue";if(h instanceof y){if(!f.has(c))try{null===(P=null===E||void 0===E?void 0:E[v.OPERATION.REPLACE])||void 0===P||P.forEach((function(v){return v()}))}catch(W){y.onError(W)}try{E.hasOwnProperty(g.field)&&(null===(b=E[g.field])||void 0===b||b.forEach((function(v){return v(g.value,g.previousValue)})))}catch(W){y.onError(W)}}else g.op===v.OPERATION.ADD&&void 0===g.previousValue?null===(Y=E[v.OPERATION.ADD])||void 0===Y||Y.forEach((function(v){var y;return v(g.value,null!==(y=g.dynamicIndex)&&void 0!==y?y:g.field)})):g.op===v.OPERATION.DELETE?void 0!==g.previousValue&&(null===(l=E[v.OPERATION.DELETE])||void 0===l||l.forEach((function(v){var y;return v(g.previousValue,null!==(y=g.dynamicIndex)&&void 0!==y?y:g.field)}))):g.op===v.OPERATION.DELETE_AND_ADD&&(void 0!==g.previousValue&&(null===(a=E[v.OPERATION.DELETE])||void 0===a||a.forEach((function(v){var y;return v(g.previousValue,null!==(y=g.dynamicIndex)&&void 0!==y?y:g.field)}))),null===(Z=E[v.OPERATION.ADD])||void 0===Z||Z.forEach((function(v){var y;return v(g.value,null!==(y=g.dynamicIndex)&&void 0!==y?y:g.field)}))),g.value!==g.previousValue&&(null===(x=E[v.OPERATION.REPLACE])||void 0===x||x.forEach((function(v){var y;return v(g.value,null!==(y=g.dynamicIndex)&&void 0!==y?y:g.field)})));f.add(c)},g=0;g<n.length;g++)i(g)},y._definition=s.create(),y}();function Sv(v){for(var y=[v.$changes],n=1,B={},J=B,P=function(v){var n=y[v];n.changes.forEach((function(v){var y=n.ref,B=v.index,P=y._definition?y._definition.fieldsByIndex[B]:y.$indexes.get(B);J[P]=n.getValue(B)}))},b=0;b<n;b++)P(b);return B}var wv={context:new r},kv=function(v){function y(){return null!==v&&v.apply(this,arguments)||this}return n(y,v),B([O("string",wv)],y.prototype,"name",void 0),B([O("string",wv)],y.prototype,"type",void 0),B([O("number",wv)],y.prototype,"referencedType",void 0),y}(Fv),Mv=function(v){function y(){var y=null!==v&&v.apply(this,arguments)||this;return y.fields=new i,y}return n(y,v),B([O("number",wv)],y.prototype,"id",void 0),B([O([kv],wv)],y.prototype,"fields",void 0),y}(Fv),Iv=function(v){function y(){var y=null!==v&&v.apply(this,arguments)||this;return y.types=new i,y}return n(y,v),y.encode=function(v){var n=v.constructor,B=new y;B.rootType=n._typeid;var J=function(v,y){for(var n in y){var J=new kv;J.name=n;var P=void 0;if("string"===typeof y[n])P=y[n];else{var b=y[n],Y=void 0;Fv.is(b)?(P="ref",Y=y[n]):"string"===typeof b[P=Object.keys(b)[0]]?P+=":"+b[P]:Y=b[P],J.referencedType=Y?Y._typeid:-1}J.type=P,v.fields.push(J)}B.types.push(v)},P=n._context.types;for(var b in P){var Y=new Mv;Y.id=Number(b),J(Y,P[b]._definition.schema)}return B.encodeAll()},y.decode=function(v,B){var J=new r,P=new y;P.decode(v,B);var b=P.types.reduce((function(v,y){var B=function(v){function y(){return null!==v&&v.apply(this,arguments)||this}return n(y,v),y}(Fv),P=y.id;return v[P]=B,J.add(B,P),v}),{});P.types.forEach((function(v){var y=b[v.id];v.fields.forEach((function(v){var n;if(void 0!==v.referencedType){var B=v.type,P=b[v.referencedType];if(!P){var Y=v.type.split(":");B=Y[0],P=Y[1]}"ref"===B?O(P,{context:J})(y.prototype,v.name):O(((n={})[B]=P,n),{context:J})(y.prototype,v.name)}else O(v.type,{context:J})(y.prototype,v.name)}))}));var Y=b[P.rootType],l=new Y;for(var a in Y._definition.schema){var Z=Y._definition.schema[a];"string"!==typeof Z&&(l[a]="function"===typeof Z?new Z:new(W(Object.keys(Z)[0]).constructor))}return l},B([O([Mv],wv)],y.prototype,"types",void 0),B([O("number",wv)],y.prototype,"rootType",void 0),y}(Fv);E("map",{constructor:c}),E("array",{constructor:i}),E("set",{constructor:uv}),E("collection",{constructor:rv}),v.ArraySchema=i,v.CollectionSchema=rv,v.Context=r,v.MapSchema=c,v.Reflection=Iv,v.ReflectionField=kv,v.ReflectionType=Mv,v.Schema=Fv,v.SchemaDefinition=s,v.SetSchema=uv,v.decode=Cv,v.defineTypes=t,v.deprecated=L,v.dumpChanges=Sv,v.encode=o,v.filter=d,v.filterChildren=q,v.hasFilter=C,v.registerType=E,v.type=O,Object.defineProperty(v,"__esModule",{value:!0})}(y)},12708:v=>{"use strict";v.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12703:(v,y,n)=>{var B=n(12708),J=n(12713),P=Object.hasOwnProperty,b=Object.create(null);for(var Y in B)P.call(B,Y)&&(b[B[Y]]=Y);var l=v.exports={to:{},get:{}};function a(v,y,n){return Math.min(Math.max(y,v),n)}function Z(v){var y=Math.round(v).toString(16).toUpperCase();return y.length<2?"0"+y:y}l.get=function(v){var y,n;switch(v.substring(0,3).toLowerCase()){case"hsl":y=l.get.hsl(v),n="hsl";break;case"hwb":y=l.get.hwb(v),n="hwb";break;default:y=l.get.rgb(v),n="rgb"}return y?{model:n,value:y}:null},l.get.rgb=function(v){if(!v)return null;var y,n,J,b=[0,0,0,1];if(y=v.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(J=y[2],y=y[1],n=0;n<3;n++){var Y=2*n;b[n]=parseInt(y.slice(Y,Y+2),16)}J&&(b[3]=parseInt(J,16)/255)}else if(y=v.match(/^#([a-f0-9]{3,4})$/i)){for(J=(y=y[1])[3],n=0;n<3;n++)b[n]=parseInt(y[n]+y[n],16);J&&(b[3]=parseInt(J+J,16)/255)}else if(y=v.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(n=0;n<3;n++)b[n]=parseInt(y[n+1],0);y[4]&&(y[5]?b[3]=.01*parseFloat(y[4]):b[3]=parseFloat(y[4]))}else{if(!(y=v.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(y=v.match(/^(\w+)$/))?"transparent"===y[1]?[0,0,0,0]:P.call(B,y[1])?((b=B[y[1]])[3]=1,b):null:null;for(n=0;n<3;n++)b[n]=Math.round(2.55*parseFloat(y[n+1]));y[4]&&(y[5]?b[3]=.01*parseFloat(y[4]):b[3]=parseFloat(y[4]))}for(n=0;n<3;n++)b[n]=a(b[n],0,255);return b[3]=a(b[3],0,1),b},l.get.hsl=function(v){if(!v)return null;var y=v.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(y){var n=parseFloat(y[4]);return[(parseFloat(y[1])%360+360)%360,a(parseFloat(y[2]),0,100),a(parseFloat(y[3]),0,100),a(isNaN(n)?1:n,0,1)]}return null},l.get.hwb=function(v){if(!v)return null;var y=v.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(y){var n=parseFloat(y[4]);return[(parseFloat(y[1])%360+360)%360,a(parseFloat(y[2]),0,100),a(parseFloat(y[3]),0,100),a(isNaN(n)?1:n,0,1)]}return null},l.to.hex=function(){var v=J(arguments);return"#"+Z(v[0])+Z(v[1])+Z(v[2])+(v[3]<1?Z(Math.round(255*v[3])):"")},l.to.rgb=function(){var v=J(arguments);return v.length<4||1===v[3]?"rgb("+Math.round(v[0])+", "+Math.round(v[1])+", "+Math.round(v[2])+")":"rgba("+Math.round(v[0])+", "+Math.round(v[1])+", "+Math.round(v[2])+", "+v[3]+")"},l.to.rgb.percent=function(){var v=J(arguments),y=Math.round(v[0]/255*100),n=Math.round(v[1]/255*100),B=Math.round(v[2]/255*100);return v.length<4||1===v[3]?"rgb("+y+"%, "+n+"%, "+B+"%)":"rgba("+y+"%, "+n+"%, "+B+"%, "+v[3]+")"},l.to.hsl=function(){var v=J(arguments);return v.length<4||1===v[3]?"hsl("+v[0]+", "+v[1]+"%, "+v[2]+"%)":"hsla("+v[0]+", "+v[1]+"%, "+v[2]+"%, "+v[3]+")"},l.to.hwb=function(){var v=J(arguments),y="";return v.length>=4&&1!==v[3]&&(y=", "+v[3]),"hwb("+v[0]+", "+v[1]+"%, "+v[2]+"%"+y+")"},l.to.keyword=function(v){return b[v.slice(0,3)]}},12697:(v,y,n)=>{const B=n(12703),J=n(12728),P=["keyword","gray","hex"],b={};for(const N of Object.keys(J))b[[...J[N].labels].sort().join("")]=N;const Y={};function l(v,y){if(!(this instanceof l))return new l(v,y);if(y&&y in P&&(y=null),y&&!(y in J))throw new Error("Unknown model: "+y);let n,a;if(null==v)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(v instanceof l)this.model=v.model,this.color=[...v.color],this.valpha=v.valpha;else if("string"===typeof v){const y=B.get(v);if(null===y)throw new Error("Unable to parse color from string: "+v);this.model=y.model,a=J[this.model].channels,this.color=y.value.slice(0,a),this.valpha="number"===typeof y.value[a]?y.value[a]:1}else if(v.length>0){this.model=y||"rgb",a=J[this.model].channels;const n=Array.prototype.slice.call(v,0,a);this.color=f(n,a),this.valpha="number"===typeof v[a]?v[a]:1}else if("number"===typeof v)this.model="rgb",this.color=[v>>16&255,v>>8&255,255&v],this.valpha=1;else{this.valpha=1;const y=Object.keys(v);"alpha"in v&&(y.splice(y.indexOf("alpha"),1),this.valpha="number"===typeof v.alpha?v.alpha:0);const B=y.sort().join("");if(!(B in b))throw new Error("Unable to parse color from object: "+JSON.stringify(v));this.model=b[B];const{labels:P}=J[this.model],Y=[];for(n=0;n<P.length;n++)Y.push(v[P[n]]);this.color=f(Y)}if(Y[this.model])for(a=J[this.model].channels,n=0;n<a;n++){const v=Y[this.model][n];v&&(this.color[n]=v(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}l.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(v){let y=this.model in B.to?this:this.rgb();y=y.round("number"===typeof v?v:1);const n=1===y.valpha?y.color:[...y.color,this.valpha];return B.to[y.model](n)},percentString(v){const y=this.rgb().round("number"===typeof v?v:1),n=1===y.valpha?y.color:[...y.color,this.valpha];return B.to.rgb.percent(n)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const v={},{channels:y}=J[this.model],{labels:n}=J[this.model];for(let B=0;B<y;B++)v[n[B]]=this.color[B];return 1!==this.valpha&&(v.alpha=this.valpha),v},unitArray(){const v=this.rgb().color;return v[0]/=255,v[1]/=255,v[2]/=255,1!==this.valpha&&v.push(this.valpha),v},unitObject(){const v=this.rgb().object();return v.r/=255,v.g/=255,v.b/=255,1!==this.valpha&&(v.alpha=this.valpha),v},round(v){return v=Math.max(v||0,0),new l([...this.color.map(a(v)),this.valpha],this.model)},alpha(v){return void 0!==v?new l([...this.color,Math.max(0,Math.min(1,v))],this.model):this.valpha},red:Z("rgb",0,x(255)),green:Z("rgb",1,x(255)),blue:Z("rgb",2,x(255)),hue:Z(["hsl","hsv","hsl","hwb","hcg"],0,(v=>(v%360+360)%360)),saturationl:Z("hsl",1,x(100)),lightness:Z("hsl",2,x(100)),saturationv:Z("hsv",1,x(100)),value:Z("hsv",2,x(100)),chroma:Z("hcg",1,x(100)),gray:Z("hcg",2,x(100)),white:Z("hwb",1,x(100)),wblack:Z("hwb",2,x(100)),cyan:Z("cmyk",0,x(100)),magenta:Z("cmyk",1,x(100)),yellow:Z("cmyk",2,x(100)),black:Z("cmyk",3,x(100)),x:Z("xyz",0,x(95.047)),y:Z("xyz",1,x(100)),z:Z("xyz",2,x(108.833)),l:Z("lab",0,x(100)),a:Z("lab",1),b:Z("lab",2),keyword(v){return void 0!==v?new l(v):J[this.model].keyword(this.color)},hex(v){return void 0!==v?new l(v):B.to.hex(this.rgb().round().color)},hexa(v){if(void 0!==v)return new l(v);const y=this.rgb().round().color;let n=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===n.length&&(n="0"+n),B.to.hex(y)+n},rgbNumber(){const v=this.rgb().color;return(255&v[0])<<16|(255&v[1])<<8|255&v[2]},luminosity(){const v=this.rgb().color,y=[];for(const[n,B]of v.entries()){const v=B/255;y[n]=v<=.04045?v/12.92:((v+.055)/1.055)**2.4}return.2126*y[0]+.7152*y[1]+.0722*y[2]},contrast(v){const y=this.luminosity(),n=v.luminosity();return y>n?(y+.05)/(n+.05):(n+.05)/(y+.05)},level(v){const y=this.contrast(v);return y>=7?"AAA":y>=4.5?"AA":""},isDark(){const v=this.rgb().color;return(2126*v[0]+7152*v[1]+722*v[2])/1e4<128},isLight(){return!this.isDark()},negate(){const v=this.rgb();for(let y=0;y<3;y++)v.color[y]=255-v.color[y];return v},lighten(v){const y=this.hsl();return y.color[2]+=y.color[2]*v,y},darken(v){const y=this.hsl();return y.color[2]-=y.color[2]*v,y},saturate(v){const y=this.hsl();return y.color[1]+=y.color[1]*v,y},desaturate(v){const y=this.hsl();return y.color[1]-=y.color[1]*v,y},whiten(v){const y=this.hwb();return y.color[1]+=y.color[1]*v,y},blacken(v){const y=this.hwb();return y.color[2]+=y.color[2]*v,y},grayscale(){const v=this.rgb().color,y=.3*v[0]+.59*v[1]+.11*v[2];return l.rgb(y,y,y)},fade(v){return this.alpha(this.valpha-this.valpha*v)},opaquer(v){return this.alpha(this.valpha+this.valpha*v)},rotate(v){const y=this.hsl();let n=y.color[0];return n=(n+v)%360,n=n<0?360+n:n,y.color[0]=n,y},mix(v,y){if(!v||!v.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof v);const n=v.rgb(),B=this.rgb(),J=void 0===y?.5:y,P=2*J-1,b=n.alpha()-B.alpha(),Y=((P*b===-1?P:(P+b)/(1+P*b))+1)/2,a=1-Y;return l.rgb(Y*n.red()+a*B.red(),Y*n.green()+a*B.green(),Y*n.blue()+a*B.blue(),n.alpha()*J+B.alpha()*(1-J))}};for(const N of Object.keys(J)){if(P.includes(N))continue;const{channels:v}=J[N];l.prototype[N]=function(){if(this.model===N)return new l(this);for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];return y.length>0?new l(y,N):new l([...(B=J[this.model][N].raw(this.color),Array.isArray(B)?B:[B]),this.valpha],N);var B},l[N]=function(){for(var y=arguments.length,n=new Array(y),B=0;B<y;B++)n[B]=arguments[B];let J=n[0];return"number"===typeof J&&(J=f(n,v)),new l(J,N)}}function a(v){return function(y){return function(v,y){return Number(v.toFixed(y))}(y,v)}}function Z(v,y,n){v=Array.isArray(v)?v:[v];for(const B of v)(Y[B]||(Y[B]=[]))[y]=n;return v=v[0],function(B){let J;return void 0!==B?(n&&(B=n(B)),J=this[v](),J.color[y]=B,J):(J=this[v]().color[y],n&&(J=n(J)),J)}}function x(v){return function(y){return Math.max(0,Math.min(v,y))}}function f(v,y){for(let n=0;n<y;n++)"number"!==typeof v[n]&&(v[n]=0);return v}v.exports=l},12736:(v,y,n)=>{const B=n(12744),J={};for(const b of Object.keys(B))J[B[b]]=b;const P={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};v.exports=P;for(const b of Object.keys(P)){if(!("channels"in P[b]))throw new Error("missing channels property: "+b);if(!("labels"in P[b]))throw new Error("missing channel labels property: "+b);if(P[b].labels.length!==P[b].channels)throw new Error("channel and label counts mismatch: "+b);const{channels:v,labels:y}=P[b];delete P[b].channels,delete P[b].labels,Object.defineProperty(P[b],"channels",{value:v}),Object.defineProperty(P[b],"labels",{value:y})}P.rgb.hsl=function(v){const y=v[0]/255,n=v[1]/255,B=v[2]/255,J=Math.min(y,n,B),P=Math.max(y,n,B),b=P-J;let Y,l;P===J?Y=0:y===P?Y=(n-B)/b:n===P?Y=2+(B-y)/b:B===P&&(Y=4+(y-n)/b),Y=Math.min(60*Y,360),Y<0&&(Y+=360);const a=(J+P)/2;return l=P===J?0:a<=.5?b/(P+J):b/(2-P-J),[Y,100*l,100*a]},P.rgb.hsv=function(v){let y,n,B,J,P;const b=v[0]/255,Y=v[1]/255,l=v[2]/255,a=Math.max(b,Y,l),Z=a-Math.min(b,Y,l),x=function(v){return(a-v)/6/Z+.5};return 0===Z?(J=0,P=0):(P=Z/a,y=x(b),n=x(Y),B=x(l),b===a?J=B-n:Y===a?J=1/3+y-B:l===a&&(J=2/3+n-y),J<0?J+=1:J>1&&(J-=1)),[360*J,100*P,100*a]},P.rgb.hwb=function(v){const y=v[0],n=v[1];let B=v[2];const J=P.rgb.hsl(v)[0],b=1/255*Math.min(y,Math.min(n,B));return B=1-1/255*Math.max(y,Math.max(n,B)),[J,100*b,100*B]},P.rgb.cmyk=function(v){const y=v[0]/255,n=v[1]/255,B=v[2]/255,J=Math.min(1-y,1-n,1-B);return[100*((1-y-J)/(1-J)||0),100*((1-n-J)/(1-J)||0),100*((1-B-J)/(1-J)||0),100*J]},P.rgb.keyword=function(v){const y=J[v];if(y)return y;let n,P=1/0;for(const J of Object.keys(B)){const y=B[J],l=(Y=y,((b=v)[0]-Y[0])**2+(b[1]-Y[1])**2+(b[2]-Y[2])**2);l<P&&(P=l,n=J)}var b,Y;return n},P.keyword.rgb=function(v){return B[v]},P.rgb.xyz=function(v){let y=v[0]/255,n=v[1]/255,B=v[2]/255;y=y>.04045?((y+.055)/1.055)**2.4:y/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92,B=B>.04045?((B+.055)/1.055)**2.4:B/12.92;return[100*(.4124*y+.3576*n+.1805*B),100*(.2126*y+.7152*n+.0722*B),100*(.0193*y+.1192*n+.9505*B)]},P.rgb.lab=function(v){const y=P.rgb.xyz(v);let n=y[0],B=y[1],J=y[2];n/=95.047,B/=100,J/=108.883,n=n>.008856?n**(1/3):7.787*n+16/116,B=B>.008856?B**(1/3):7.787*B+16/116,J=J>.008856?J**(1/3):7.787*J+16/116;return[116*B-16,500*(n-B),200*(B-J)]},P.hsl.rgb=function(v){const y=v[0]/360,n=v[1]/100,B=v[2]/100;let J,P,b;if(0===n)return b=255*B,[b,b,b];J=B<.5?B*(1+n):B+n-B*n;const Y=2*B-J,l=[0,0,0];for(let a=0;a<3;a++)P=y+1/3*-(a-1),P<0&&P++,P>1&&P--,b=6*P<1?Y+6*(J-Y)*P:2*P<1?J:3*P<2?Y+(J-Y)*(2/3-P)*6:Y,l[a]=255*b;return l},P.hsl.hsv=function(v){const y=v[0];let n=v[1]/100,B=v[2]/100,J=n;const P=Math.max(B,.01);B*=2,n*=B<=1?B:2-B,J*=P<=1?P:2-P;return[y,100*(0===B?2*J/(P+J):2*n/(B+n)),100*((B+n)/2)]},P.hsv.rgb=function(v){const y=v[0]/60,n=v[1]/100;let B=v[2]/100;const J=Math.floor(y)%6,P=y-Math.floor(y),b=255*B*(1-n),Y=255*B*(1-n*P),l=255*B*(1-n*(1-P));switch(B*=255,J){case 0:return[B,l,b];case 1:return[Y,B,b];case 2:return[b,B,l];case 3:return[b,Y,B];case 4:return[l,b,B];case 5:return[B,b,Y]}},P.hsv.hsl=function(v){const y=v[0],n=v[1]/100,B=v[2]/100,J=Math.max(B,.01);let P,b;b=(2-n)*B;const Y=(2-n)*J;return P=n*J,P/=Y<=1?Y:2-Y,P=P||0,b/=2,[y,100*P,100*b]},P.hwb.rgb=function(v){const y=v[0]/360;let n=v[1]/100,B=v[2]/100;const J=n+B;let P;J>1&&(n/=J,B/=J);const b=Math.floor(6*y),Y=1-B;P=6*y-b,0!==(1&b)&&(P=1-P);const l=n+P*(Y-n);let a,Z,x;switch(b){default:case 6:case 0:a=Y,Z=l,x=n;break;case 1:a=l,Z=Y,x=n;break;case 2:a=n,Z=Y,x=l;break;case 3:a=n,Z=l,x=Y;break;case 4:a=l,Z=n,x=Y;break;case 5:a=Y,Z=n,x=l}return[255*a,255*Z,255*x]},P.cmyk.rgb=function(v){const y=v[0]/100,n=v[1]/100,B=v[2]/100,J=v[3]/100;return[255*(1-Math.min(1,y*(1-J)+J)),255*(1-Math.min(1,n*(1-J)+J)),255*(1-Math.min(1,B*(1-J)+J))]},P.xyz.rgb=function(v){const y=v[0]/100,n=v[1]/100,B=v[2]/100;let J,P,b;return J=3.2406*y+-1.5372*n+-.4986*B,P=-.9689*y+1.8758*n+.0415*B,b=.0557*y+-.204*n+1.057*B,J=J>.0031308?1.055*J**(1/2.4)-.055:12.92*J,P=P>.0031308?1.055*P**(1/2.4)-.055:12.92*P,b=b>.0031308?1.055*b**(1/2.4)-.055:12.92*b,J=Math.min(Math.max(0,J),1),P=Math.min(Math.max(0,P),1),b=Math.min(Math.max(0,b),1),[255*J,255*P,255*b]},P.xyz.lab=function(v){let y=v[0],n=v[1],B=v[2];y/=95.047,n/=100,B/=108.883,y=y>.008856?y**(1/3):7.787*y+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,B=B>.008856?B**(1/3):7.787*B+16/116;return[116*n-16,500*(y-n),200*(n-B)]},P.lab.xyz=function(v){let y,n,B;n=(v[0]+16)/116,y=v[1]/500+n,B=n-v[2]/200;const J=n**3,P=y**3,b=B**3;return n=J>.008856?J:(n-16/116)/7.787,y=P>.008856?P:(y-16/116)/7.787,B=b>.008856?b:(B-16/116)/7.787,y*=95.047,n*=100,B*=108.883,[y,n,B]},P.lab.lch=function(v){const y=v[0],n=v[1],B=v[2];let J;J=360*Math.atan2(B,n)/2/Math.PI,J<0&&(J+=360);return[y,Math.sqrt(n*n+B*B),J]},P.lch.lab=function(v){const y=v[0],n=v[1],B=v[2]/360*2*Math.PI;return[y,n*Math.cos(B),n*Math.sin(B)]},P.rgb.ansi16=function(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[n,B,J]=v;let b=null===y?P.rgb.hsv(v)[2]:y;if(b=Math.round(b/50),0===b)return 30;let Y=30+(Math.round(J/255)<<2|Math.round(B/255)<<1|Math.round(n/255));return 2===b&&(Y+=60),Y},P.hsv.ansi16=function(v){return P.rgb.ansi16(P.hsv.rgb(v),v[2])},P.rgb.ansi256=function(v){const y=v[0],n=v[1],B=v[2];if(y===n&&n===B)return y<8?16:y>248?231:Math.round((y-8)/247*24)+232;return 16+36*Math.round(y/255*5)+6*Math.round(n/255*5)+Math.round(B/255*5)},P.ansi16.rgb=function(v){let y=v%10;if(0===y||7===y)return v>50&&(y+=3.5),y=y/10.5*255,[y,y,y];const n=.5*(1+~~(v>50));return[(1&y)*n*255,(y>>1&1)*n*255,(y>>2&1)*n*255]},P.ansi256.rgb=function(v){if(v>=232){const y=10*(v-232)+8;return[y,y,y]}let y;v-=16;return[Math.floor(v/36)/5*255,Math.floor((y=v%36)/6)/5*255,y%6/5*255]},P.rgb.hex=function(v){const y=(((255&Math.round(v[0]))<<16)+((255&Math.round(v[1]))<<8)+(255&Math.round(v[2]))).toString(16).toUpperCase();return"000000".substring(y.length)+y},P.hex.rgb=function(v){const y=v.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!y)return[0,0,0];let n=y[0];3===y[0].length&&(n=n.split("").map((v=>v+v)).join(""));const B=parseInt(n,16);return[B>>16&255,B>>8&255,255&B]},P.rgb.hcg=function(v){const y=v[0]/255,n=v[1]/255,B=v[2]/255,J=Math.max(Math.max(y,n),B),P=Math.min(Math.min(y,n),B),b=J-P;let Y,l;return Y=b<1?P/(1-b):0,l=b<=0?0:J===y?(n-B)/b%6:J===n?2+(B-y)/b:4+(y-n)/b,l/=6,l%=1,[360*l,100*b,100*Y]},P.hsl.hcg=function(v){const y=v[1]/100,n=v[2]/100,B=n<.5?2*y*n:2*y*(1-n);let J=0;return B<1&&(J=(n-.5*B)/(1-B)),[v[0],100*B,100*J]},P.hsv.hcg=function(v){const y=v[1]/100,n=v[2]/100,B=y*n;let J=0;return B<1&&(J=(n-B)/(1-B)),[v[0],100*B,100*J]},P.hcg.rgb=function(v){const y=v[0]/360,n=v[1]/100,B=v[2]/100;if(0===n)return[255*B,255*B,255*B];const J=[0,0,0],P=y%1*6,b=P%1,Y=1-b;let l=0;switch(Math.floor(P)){case 0:J[0]=1,J[1]=b,J[2]=0;break;case 1:J[0]=Y,J[1]=1,J[2]=0;break;case 2:J[0]=0,J[1]=1,J[2]=b;break;case 3:J[0]=0,J[1]=Y,J[2]=1;break;case 4:J[0]=b,J[1]=0,J[2]=1;break;default:J[0]=1,J[1]=0,J[2]=Y}return l=(1-n)*B,[255*(n*J[0]+l),255*(n*J[1]+l),255*(n*J[2]+l)]},P.hcg.hsv=function(v){const y=v[1]/100,n=y+v[2]/100*(1-y);let B=0;return n>0&&(B=y/n),[v[0],100*B,100*n]},P.hcg.hsl=function(v){const y=v[1]/100,n=v[2]/100*(1-y)+.5*y;let B=0;return n>0&&n<.5?B=y/(2*n):n>=.5&&n<1&&(B=y/(2*(1-n))),[v[0],100*B,100*n]},P.hcg.hwb=function(v){const y=v[1]/100,n=y+v[2]/100*(1-y);return[v[0],100*(n-y),100*(1-n)]},P.hwb.hcg=function(v){const y=v[1]/100,n=1-v[2]/100,B=n-y;let J=0;return B<1&&(J=(n-B)/(1-B)),[v[0],100*B,100*J]},P.apple.rgb=function(v){return[v[0]/65535*255,v[1]/65535*255,v[2]/65535*255]},P.rgb.apple=function(v){return[v[0]/255*65535,v[1]/255*65535,v[2]/255*65535]},P.gray.rgb=function(v){return[v[0]/100*255,v[0]/100*255,v[0]/100*255]},P.gray.hsl=function(v){return[0,0,v[0]]},P.gray.hsv=P.gray.hsl,P.gray.hwb=function(v){return[0,100,v[0]]},P.gray.cmyk=function(v){return[0,0,0,v[0]]},P.gray.lab=function(v){return[v[0],0,0]},P.gray.hex=function(v){const y=255&Math.round(v[0]/100*255),n=((y<<16)+(y<<8)+y).toString(16).toUpperCase();return"000000".substring(n.length)+n},P.rgb.gray=function(v){return[(v[0]+v[1]+v[2])/3/255*100]}},12728:(v,y,n)=>{const B=n(12736),J=n(12748),P={};Object.keys(B).forEach((v=>{P[v]={},Object.defineProperty(P[v],"channels",{value:B[v].channels}),Object.defineProperty(P[v],"labels",{value:B[v].labels});const y=J(v);Object.keys(y).forEach((n=>{const B=y[n];P[v][n]=function(v){const y=function(){for(var y=arguments.length,n=new Array(y),B=0;B<y;B++)n[B]=arguments[B];const J=n[0];if(void 0===J||null===J)return J;J.length>1&&(n=J);const P=v(n);if("object"===typeof P)for(let v=P.length,b=0;b<v;b++)P[b]=Math.round(P[b]);return P};return"conversion"in v&&(y.conversion=v.conversion),y}(B),P[v][n].raw=function(v){const y=function(){for(var y=arguments.length,n=new Array(y),B=0;B<y;B++)n[B]=arguments[B];const J=n[0];return void 0===J||null===J?J:(J.length>1&&(n=J),v(n))};return"conversion"in v&&(y.conversion=v.conversion),y}(B)}))})),v.exports=P},12748:(v,y,n)=>{const B=n(12736);function J(v){const y=function(){const v={},y=Object.keys(B);for(let n=y.length,B=0;B<n;B++)v[y[B]]={distance:-1,parent:null};return v}(),n=[v];for(y[v].distance=0;n.length;){const v=n.pop(),J=Object.keys(B[v]);for(let B=J.length,P=0;P<B;P++){const B=J[P],b=y[B];-1===b.distance&&(b.distance=y[v].distance+1,b.parent=v,n.unshift(B))}}return y}function P(v,y){return function(n){return y(v(n))}}function b(v,y){const n=[y[v].parent,v];let J=B[y[v].parent][v],b=y[v].parent;for(;y[b].parent;)n.unshift(y[b].parent),J=P(B[y[b].parent][b],J),b=y[b].parent;return J.conversion=n,J}v.exports=function(v){const y=J(v),n={},B=Object.keys(y);for(let J=B.length,P=0;P<J;P++){const v=B[P];null!==y[v].parent&&(n[v]=b(v,y))}return n}},12744:v=>{"use strict";v.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},10707:function(v,y,n){"use strict";var B=this&&this.__createBinding||(Object.create?function(v,y,n,B){void 0===B&&(B=n);var J=Object.getOwnPropertyDescriptor(y,n);J&&!("get"in J?!y.__esModule:J.writable||J.configurable)||(J={enumerable:!0,get:function(){return y[n]}}),Object.defineProperty(v,B,J)}:function(v,y,n,B){void 0===B&&(B=n),v[B]=y[n]}),J=this&&this.__setModuleDefault||(Object.create?function(v,y){Object.defineProperty(v,"default",{enumerable:!0,value:y})}:function(v,y){v.default=y}),P=this&&this.__importStar||function(v){if(v&&v.__esModule)return v;var y={};if(null!=v)for(var n in v)"default"!==n&&Object.prototype.hasOwnProperty.call(v,n)&&B(y,v,n);return J(y,v),y},b=this&&this.__awaiter||function(v,y,n,B){return new(n||(n=Promise))((function(J,P){function b(v){try{l(B.next(v))}catch(y){P(y)}}function Y(v){try{l(B.throw(v))}catch(y){P(y)}}function l(v){var y;v.done?J(v.value):(y=v.value,y instanceof n?y:new n((function(v){v(y)}))).then(b,Y)}l((B=B.apply(v,y||[])).next())}))};Object.defineProperty(y,"__esModule",{value:!0}),y.Auth=y.Platform=void 0;const Y=P(n(10648)),l=n(10712),a="colyseus-auth-token";!function(v){v.ios="ios",v.android="android"}(y.Platform||(y.Platform={}));y.Auth=class{constructor(v){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=v.replace("ws","http"),(0,l.getItem)(a,(v=>this.token=v))}get hasToken(){return!!this.token}login(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return b(this,void 0,void 0,(function*(){const y=Object.assign({},v);this.hasToken&&(y.token=this.token);const n=yield this.request("post","/auth",y);this.token=n.token,(0,l.setItem)(a,this.token);for(let v in n)this.hasOwnProperty(v)&&(this[v]=n[v]);return this.registerPingService(),this}))}save(){return b(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return b(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return b(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return b(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(v){return b(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:v})}))}acceptFriendRequest(v){return b(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:v})}))}declineFriendRequest(v){return b(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:v})}))}blockUser(v){return b(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:v})}))}unblockUser(v){return b(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:v})}))}request(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},B=arguments.length>3?arguments[3]:void 0,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return b(this,void 0,void 0,(function*(){J.Accept="application/json",this.hasToken&&(J.Authorization="Bearer "+this.token);const P=[];for(const v in n)P.push(`${v}=${n[v]}`);const b=P.length>0?`?${P.join("&")}`:"",l={headers:J};return B&&(l.body=B),(yield Y[v](`${this.endpoint}${y}${b}`,l)).data}))}logout(){this.token=void 0,(0,l.removeItem)(a),this.unregisterPingService()}registerPingService(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),v)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},10645:function(v,y,n){"use strict";var B,J=this&&this.__awaiter||function(v,y,n,B){return new(n||(n=Promise))((function(J,P){function b(v){try{l(B.next(v))}catch(y){P(y)}}function Y(v){try{l(B.throw(v))}catch(y){P(y)}}function l(v){var y;v.done?J(v.value):(y=v.value,y instanceof n?y:new n((function(v){v(y)}))).then(b,Y)}l((B=B.apply(v,y||[])).next())}))};Object.defineProperty(y,"__esModule",{value:!0}),y.Client=y.MatchMakeError=void 0;const P=n(10648),b=n(10652),Y=n(10655);class l extends Error{constructor(v,y){super(v),this.code=y,Object.setPrototypeOf(this,l.prototype)}}y.MatchMakeError=l;const a="undefined"!==typeof window&&"undefined"!==typeof(null===(B=null===window||void 0===window?void 0:window.location)||void 0===B?void 0:B.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";y.Client=class{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;if("string"===typeof v){const y=new URL(v),n="https:"===y.protocol||"wss:"===y.protocol,B=Number(y.port||(n?443:80));this.settings={hostname:y.hostname,pathname:"/"!==y.pathname?y.pathname:"",port:B,secure:n}}else void 0===v.port&&(v.port=v.secure?443:80),void 0===v.pathname&&(v.pathname=""),this.settings=v}joinOrCreate(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return J(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",v,y,n)}))}create(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return J(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",v,y,n)}))}join(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return J(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",v,y,n)}))}joinById(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return J(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",v,y,n)}))}reconnect(v,y){return J(this,void 0,void 0,(function*(){if("string"===typeof v&&"string"===typeof y)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[n,B]=v.split(":");return yield this.createMatchMakeRequest("reconnect",n,{reconnectionToken:B},y)}))}getAvailableRooms(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return J(this,void 0,void 0,(function*(){return(yield(0,P.get)(this.getHttpEndpoint(`${v}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(v,y,n){return J(this,void 0,void 0,(function*(){const B=this.createRoom(v.room.name,y);B.roomId=v.room.roomId,B.sessionId=v.sessionId;const P={sessionId:B.sessionId};v.reconnectionToken&&(P.reconnectionToken=v.reconnectionToken);const Y=n||B;return B.connect(this.buildEndpoint(v.room,P),v.devMode&&(()=>J(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${B.roomId}'...`);let n=0;const P=()=>J(this,void 0,void 0,(function*(){n++;try{yield this.consumeSeatReservation(v,y,Y),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${B.roomId}'`)}catch(J){n<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${n} out of 8)`),setTimeout(P,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(P,2e3)}))),Y),new Promise(((v,y)=>{const n=(v,n)=>y(new b.ServerError(v,n));Y.onError.once(n),Y.onJoin.once((()=>{Y.onError.remove(n),v(Y)}))}))}))}createMatchMakeRequest(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},B=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0;return J(this,void 0,void 0,(function*(){const J=(yield(0,P.post)(this.getHttpEndpoint(`${v}/${y}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})).data;if(J.error)throw new l(J.error,J.code);return"reconnect"===v&&(J.reconnectionToken=n.reconnectionToken),yield this.consumeSeatReservation(J,B,b)}))}createRoom(v,y){return new Y.Room(v,y)}buildEndpoint(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=[];for(const J in y)y.hasOwnProperty(J)&&n.push(`${J}=${y[J]}`);let B=this.settings.secure?"wss://":"ws://";return v.publicAddress?B+=`${v.publicAddress}`:B+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${B}/${v.processId}/${v.roomId}?${n.join("&")}`}getHttpEndpoint(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${v}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},10667:(v,y,n)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.Connection=void 0;const B=n(10672);y.Connection=class{constructor(){this.events={},this.transport=new B.WebSocketTransport(this.events)}send(v){this.transport.send(v)}connect(v){this.transport.connect(v)}close(v,y){this.transport.close(v,y)}get isOpen(){return this.transport.isOpen}}},10681:(v,y)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.utf8Length=y.utf8Read=y.ErrorCode=y.Protocol=void 0,function(v){v[v.HANDSHAKE=9]="HANDSHAKE",v[v.JOIN_ROOM=10]="JOIN_ROOM",v[v.ERROR=11]="ERROR",v[v.LEAVE_ROOM=12]="LEAVE_ROOM",v[v.ROOM_DATA=13]="ROOM_DATA",v[v.ROOM_STATE=14]="ROOM_STATE",v[v.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",v[v.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",v[v.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(y.Protocol||(y.Protocol={})),function(v){v[v.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",v[v.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",v[v.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",v[v.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",v[v.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",v[v.AUTH_FAILED=4215]="AUTH_FAILED",v[v.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(y.ErrorCode||(y.ErrorCode={})),y.utf8Read=function(v,y){const n=v[y++];for(var B="",J=0,P=y,b=y+n;P<b;P++){var Y=v[P];if(0!==(128&Y))if(192!==(224&Y))if(224!==(240&Y)){if(240!==(248&Y))throw new Error("Invalid byte "+Y.toString(16));(J=(7&Y)<<18|(63&v[++P])<<12|(63&v[++P])<<6|63&v[++P])>=65536?(J-=65536,B+=String.fromCharCode(55296+(J>>>10),56320+(1023&J))):B+=String.fromCharCode(J)}else B+=String.fromCharCode((15&Y)<<12|(63&v[++P])<<6|63&v[++P]);else B+=String.fromCharCode((31&Y)<<6|63&v[++P]);else B+=String.fromCharCode(Y)}return B},y.utf8Length=function(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",y=0,n=0;for(let B=0,J=v.length;B<J;B++)y=v.charCodeAt(B),y<128?n+=1:y<2048?n+=2:y<55296||y>=57344?n+=3:(B++,n+=4);return n+1}},10655:function(v,y,n){"use strict";var B=this&&this.__createBinding||(Object.create?function(v,y,n,B){void 0===B&&(B=n);var J=Object.getOwnPropertyDescriptor(y,n);J&&!("get"in J?!y.__esModule:J.writable||J.configurable)||(J={enumerable:!0,get:function(){return y[n]}}),Object.defineProperty(v,B,J)}:function(v,y,n,B){void 0===B&&(B=n),v[B]=y[n]}),J=this&&this.__setModuleDefault||(Object.create?function(v,y){Object.defineProperty(v,"default",{enumerable:!0,value:y})}:function(v,y){v.default=y}),P=this&&this.__importStar||function(v){if(v&&v.__esModule)return v;var y={};if(null!=v)for(var n in v)"default"!==n&&Object.prototype.hasOwnProperty.call(v,n)&&B(y,v,n);return J(y,v),y};Object.defineProperty(y,"__esModule",{value:!0}),y.Room=void 0;const b=P(n(10659)),Y=n(10667),l=n(10681),a=n(10684),Z=n(10690),x=n(10697),f=n(10702),N=n(10652);class i{constructor(v,y){this.onStateChange=(0,x.createSignal)(),this.onError=(0,x.createSignal)(),this.onLeave=(0,x.createSignal)(),this.onJoin=(0,x.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,Z.createNanoEvents)(),this.roomId=null,this.name=v,y&&(this.serializer=new((0,a.getSerializer)("schema")),this.rootSchema=y,this.serializer.state=new y),this.onError(((v,y)=>{var n;return null===(n=console.warn)||void 0===n?void 0:n.call(console,`colyseus.js - onError => (${v}) ${y}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const B=new Y.Connection;n.connection=B,B.events.onmessage=i.prototype.onMessageCallback.bind(n),B.events.onclose=function(v){var B;if(!n.hasJoined)return null===(B=console.warn)||void 0===B||B.call(console,`Room connection was closed unexpectedly (${v.code}): ${v.reason}`),void n.onError.invoke(v.code,v.reason);v.code===N.CloseCode.DEVMODE_RESTART&&y?y():(n.onLeave.invoke(v.code),n.destroy())},B.events.onerror=function(v){var y;null===(y=console.warn)||void 0===y||y.call(console,`Room, onError (${v.code}): ${v.reason}`),n.onError.invoke(v.code,v.reason)},B.connect(v)}leave(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((y=>{this.onLeave((v=>y(v))),this.connection?v?this.connection.send([l.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(N.CloseCode.CONSENTED)}))}onMessage(v,y){return this.onMessageHandlers.on(this.getMessageHandlerKey(v),y)}send(v,y){const n=[l.Protocol.ROOM_DATA];let B;if("string"===typeof v?f.encode.string(n,v):f.encode.number(n,v),void 0!==y){const v=b.encode(y);B=new Uint8Array(n.length+v.byteLength),B.set(new Uint8Array(n),0),B.set(new Uint8Array(v),n.length)}else B=new Uint8Array(n);this.connection.send(B.buffer)}sendBytes(v,y){const n=[l.Protocol.ROOM_DATA_BYTES];let B;"string"===typeof v?f.encode.string(n,v):f.encode.number(n,v),B=new Uint8Array(n.length+(y.byteLength||y.length)),B.set(new Uint8Array(n),0),B.set(new Uint8Array(y),n.length),this.connection.send(B.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(v){const y=Array.from(new Uint8Array(v.data)),n=y[0];if(n===l.Protocol.JOIN_ROOM){let v=1;const n=(0,l.utf8Read)(y,v);if(v+=(0,l.utf8Length)(n),this.serializerId=(0,l.utf8Read)(y,v),v+=(0,l.utf8Length)(this.serializerId),!this.serializer){const v=(0,a.getSerializer)(this.serializerId);this.serializer=new v}y.length>v&&this.serializer.handshake&&this.serializer.handshake(y,{offset:v}),this.reconnectionToken=`${this.roomId}:${n}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([l.Protocol.JOIN_ROOM])}else if(n===l.Protocol.ERROR){const v={offset:1},n=f.decode.number(y,v),B=f.decode.string(y,v);this.onError.invoke(n,B)}else if(n===l.Protocol.LEAVE_ROOM)this.leave();else if(n===l.Protocol.ROOM_DATA_SCHEMA){const v={offset:1},n=this.serializer.getState().constructor._context.get(f.decode.number(y,v)),B=new n;B.decode(y,v),this.dispatchMessage(n,B)}else if(n===l.Protocol.ROOM_STATE)y.shift(),this.setState(y);else if(n===l.Protocol.ROOM_STATE_PATCH)y.shift(),this.patch(y);else if(n===l.Protocol.ROOM_DATA){const n={offset:1},B=f.decode.stringCheck(y,n)?f.decode.string(y,n):f.decode.number(y,n),J=y.length>n.offset?b.decode(v.data,n.offset):void 0;this.dispatchMessage(B,J)}else if(n===l.Protocol.ROOM_DATA_BYTES){const v={offset:1},n=f.decode.stringCheck(y,v)?f.decode.string(y,v):f.decode.number(y,v);this.dispatchMessage(n,new Uint8Array(y.slice(v.offset)))}}setState(v){this.serializer.setState(v),this.onStateChange.invoke(this.serializer.getState())}patch(v){this.serializer.patch(v),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(v,y){var n;const B=this.getMessageHandlerKey(v);this.onMessageHandlers.events[B]?this.onMessageHandlers.emit(B,y):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",v,y):null===(n=console.warn)||void 0===n||n.call(console,`colyseus.js: onMessage() not registered for type '${v}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(v){switch(typeof v){case"function":return`$${v._typeid}`;case"string":return v;case"number":return`i${v}`;default:throw new Error("invalid message type.")}}}y.Room=i},10712:(v,y)=>{"use strict";let n;function B(){return n||(n="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(v,y){this.cache[v]=y},getItem:function(v){this.cache[v]},removeItem:function(v){delete this.cache[v]}}),n}Object.defineProperty(y,"__esModule",{value:!0}),y.getItem=y.removeItem=y.setItem=void 0,y.setItem=function(v,y){B().setItem(v,y)},y.removeItem=function(v){B().removeItem(v)},y.getItem=function(v,y){const n=B().getItem(v);"undefined"!==typeof Promise&&n instanceof Promise?n.then((v=>y(v))):y(n)}},10690:(v,y)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.createNanoEvents=void 0;y.createNanoEvents=()=>({emit(v){let y=this.events[v]||[];for(var n=arguments.length,B=new Array(n>1?n-1:0),J=1;J<n;J++)B[J-1]=arguments[J];for(let P=0,b=y.length;P<b;P++)y[P](...B)},events:{},on(v,y){var n;return(null===(n=this.events[v])||void 0===n?void 0:n.push(y))||(this.events[v]=[y]),()=>{var n;this.events[v]=null===(n=this.events[v])||void 0===n?void 0:n.filter((v=>y!==v))}}})},10697:(v,y)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.createSignal=y.EventEmitter=void 0;class n{constructor(){this.handlers=[]}register(v){return this.handlers.push(v),this}invoke(){for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];this.handlers.forEach((v=>v.apply(this,y)))}invokeAsync(){for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];return Promise.all(this.handlers.map((v=>v.apply(this,y))))}remove(v){const y=this.handlers.indexOf(v);this.handlers[y]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}y.EventEmitter=n,y.createSignal=function(){const v=new n;function y(y){return v.register(y,null===this)}return y.once=y=>{const n=function(){for(var B=arguments.length,J=new Array(B),P=0;P<B;P++)J[P]=arguments[P];y.apply(this,J),v.remove(n)};v.register(n)},y.remove=y=>v.remove(y),y.invoke=function(){return v.invoke(...arguments)},y.invokeAsync=function(){return v.invokeAsync(...arguments)},y.clear=()=>v.clear(),y}},10652:(v,y)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.ServerError=y.CloseCode=void 0,function(v){v[v.CONSENTED=4e3]="CONSENTED",v[v.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(y.CloseCode||(y.CloseCode={}));class n extends Error{constructor(v,y){super(y),this.name="ServerError",this.code=v}}y.ServerError=n},10628:(v,y,n)=>{"use strict";y.e=void 0,n(10636);var B=n(10645);Object.defineProperty(y,"e",{enumerable:!0,get:function(){return B.Client}});var J=n(10681);var P=n(10655);var b=n(10707);const Y=n(10719);const l=n(10727),a=n(10684);(0,a.registerSerializer)("schema",Y.SchemaSerializer),(0,a.registerSerializer)("none",l.NoneSerializer)},10636:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=v=>null!==v&&"object"===typeof v&&v.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},10659:(v,y)=>{"use strict";function n(v,y){if(this._offset=y,v instanceof ArrayBuffer)this._buffer=v,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(v))throw new Error("Invalid argument");this._buffer=v.buffer,this._view=new DataView(this._buffer,v.byteOffset,v.byteLength)}}Object.defineProperty(y,"__esModule",{value:!0}),y.decode=y.encode=void 0,n.prototype._array=function(v){for(var y=new Array(v),n=0;n<v;n++)y[n]=this._parse();return y},n.prototype._map=function(v){for(var y={},n=0;n<v;n++)y[this._parse()]=this._parse();return y},n.prototype._str=function(v){var y=function(v,y,n){for(var B="",J=0,P=y,b=y+n;P<b;P++){var Y=v.getUint8(P);if(0!==(128&Y))if(192!==(224&Y))if(224!==(240&Y)){if(240!==(248&Y))throw new Error("Invalid byte "+Y.toString(16));(J=(7&Y)<<18|(63&v.getUint8(++P))<<12|(63&v.getUint8(++P))<<6|63&v.getUint8(++P))>=65536?(J-=65536,B+=String.fromCharCode(55296+(J>>>10),56320+(1023&J))):B+=String.fromCharCode(J)}else B+=String.fromCharCode((15&Y)<<12|(63&v.getUint8(++P))<<6|63&v.getUint8(++P));else B+=String.fromCharCode((31&Y)<<6|63&v.getUint8(++P));else B+=String.fromCharCode(Y)}return B}(this._view,this._offset,v);return this._offset+=v,y},n.prototype._bin=function(v){var y=this._buffer.slice(this._offset,this._offset+v);return this._offset+=v,y},n.prototype._parse=function(){var v,y=this._view.getUint8(this._offset++),n=0,B=0,J=0,P=0;if(y<192)return y<128?y:y<144?this._map(15&y):y<160?this._array(15&y):this._str(31&y);if(y>223)return-1*(255-y+1);switch(y){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:if(n=this._view.getUint8(this._offset),B=this._view.getInt8(this._offset+1),this._offset+=2,-1===B){var b=this._view.getUint32(this._offset);return J=this._view.getInt32(this._offset+4),P=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*J+P)+b/1e6)}return[B,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),B=this._view.getInt8(this._offset+2),this._offset+=3,[B,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),B=this._view.getInt8(this._offset+4),this._offset+=5,[B,this._bin(n)];case 202:return v=this._view.getFloat32(this._offset),this._offset+=4,v;case 203:return v=this._view.getFloat64(this._offset),this._offset+=8,v;case 204:return v=this._view.getUint8(this._offset),this._offset+=1,v;case 205:return v=this._view.getUint16(this._offset),this._offset+=2,v;case 206:return v=this._view.getUint32(this._offset),this._offset+=4,v;case 207:return J=this._view.getUint32(this._offset)*Math.pow(2,32),P=this._view.getUint32(this._offset+4),this._offset+=8,J+P;case 208:return v=this._view.getInt8(this._offset),this._offset+=1,v;case 209:return v=this._view.getInt16(this._offset),this._offset+=2,v;case 210:return v=this._view.getInt32(this._offset),this._offset+=4,v;case 211:return J=this._view.getInt32(this._offset)*Math.pow(2,32),P=this._view.getUint32(this._offset+4),this._offset+=8,J+P;case 212:return B=this._view.getInt8(this._offset),this._offset+=1,0===B?void(this._offset+=1):[B,this._bin(1)];case 213:return B=this._view.getInt8(this._offset),this._offset+=1,[B,this._bin(2)];case 214:return B=this._view.getInt8(this._offset),this._offset+=1,-1===B?(v=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*v)):[B,this._bin(4)];case 215:return B=this._view.getInt8(this._offset),this._offset+=1,0===B?(J=this._view.getInt32(this._offset)*Math.pow(2,32),P=this._view.getUint32(this._offset+4),this._offset+=8,new Date(J+P)):-1===B?(J=this._view.getUint32(this._offset),P=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&J)+P)+(J>>>2)/1e6)):[B,this._bin(8)];case 216:return B=this._view.getInt8(this._offset),this._offset+=1,[B,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw new Error("Could not parse")},y.decode=function(v){var y=new n(v,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),B=y._parse();if(y._offset!==v.byteLength)throw new Error(v.byteLength-y._offset+" trailing bytes");return B};function B(v,y,n){for(var B=0,J=0,P=n.length;J<P;J++)(B=n.charCodeAt(J))<128?v.setUint8(y++,B):B<2048?(v.setUint8(y++,192|B>>6),v.setUint8(y++,128|63&B)):B<55296||B>=57344?(v.setUint8(y++,224|B>>12),v.setUint8(y++,128|B>>6&63),v.setUint8(y++,128|63&B)):(J++,B=65536+((1023&B)<<10|1023&n.charCodeAt(J)),v.setUint8(y++,240|B>>18),v.setUint8(y++,128|B>>12&63),v.setUint8(y++,128|B>>6&63),v.setUint8(y++,128|63&B))}function J(v,y,n){var B=typeof n,P=0,b=0,Y=0,l=0,a=0,Z=0;if("string"===B){if(a=function(v){for(var y=0,n=0,B=0,J=v.length;B<J;B++)(y=v.charCodeAt(B))<128?n+=1:y<2048?n+=2:y<55296||y>=57344?n+=3:(B++,n+=4);return n}(n),a<32)v.push(160|a),Z=1;else if(a<256)v.push(217,a),Z=2;else if(a<65536)v.push(218,a>>8,a),Z=3;else{if(!(a<4294967296))throw new Error("String too long");v.push(219,a>>24,a>>16,a>>8,a),Z=5}return y.push({_str:n,_length:a,_offset:v.length}),Z+a}if("number"===B)return Math.floor(n)===n&&isFinite(n)?n>=0?n<128?(v.push(n),1):n<256?(v.push(204,n),2):n<65536?(v.push(205,n>>8,n),3):n<4294967296?(v.push(206,n>>24,n>>16,n>>8,n),5):(Y=n/Math.pow(2,32)|0,l=n>>>0,v.push(207,Y>>24,Y>>16,Y>>8,Y,l>>24,l>>16,l>>8,l),9):n>=-32?(v.push(n),1):n>=-128?(v.push(208,n),2):n>=-32768?(v.push(209,n>>8,n),3):n>=-2147483648?(v.push(210,n>>24,n>>16,n>>8,n),5):(Y=Math.floor(n/Math.pow(2,32)),l=n>>>0,v.push(211,Y>>24,Y>>16,Y>>8,Y,l>>24,l>>16,l>>8,l),9):(v.push(203),y.push({_float:n,_length:8,_offset:v.length}),9);if("object"===B){if(null===n)return v.push(192),1;if(Array.isArray(n)){if((a=n.length)<16)v.push(144|a),Z=1;else if(a<65536)v.push(220,a>>8,a),Z=3;else{if(!(a<4294967296))throw new Error("Array too large");v.push(221,a>>24,a>>16,a>>8,a),Z=5}for(P=0;P<a;P++)Z+=J(v,y,n[P]);return Z}if(n instanceof Date){var x=n.getTime(),f=Math.floor(x/1e3),N=1e6*(x-1e3*f);return f>=0&&N>=0&&f<=17179869183?0===N&&f<=4294967295?(v.push(214,255,f>>24,f>>16,f>>8,f),6):(Y=f/4294967296,l=4294967295&f,v.push(215,255,N>>22,N>>14,N>>6,Y,l>>24,l>>16,l>>8,l),10):(Y=Math.floor(f/4294967296),l=f>>>0,v.push(199,12,255,N>>24,N>>16,N>>8,N,Y>>24,Y>>16,Y>>8,Y,l>>24,l>>16,l>>8,l),15)}if(n instanceof ArrayBuffer){if((a=n.byteLength)<256)v.push(196,a),Z=2;else if(a<65536)v.push(197,a>>8,a),Z=3;else{if(!(a<4294967296))throw new Error("Buffer too large");v.push(198,a>>24,a>>16,a>>8,a),Z=5}return y.push({_bin:n,_length:a,_offset:v.length}),Z+a}if("function"===typeof n.toJSON)return J(v,y,n.toJSON());var i=[],g="",c=Object.keys(n);for(P=0,b=c.length;P<b;P++)void 0!==n[g=c[P]]&&"function"!==typeof n[g]&&i.push(g);if((a=i.length)<16)v.push(128|a),Z=1;else if(a<65536)v.push(222,a>>8,a),Z=3;else{if(!(a<4294967296))throw new Error("Object too large");v.push(223,a>>24,a>>16,a>>8,a),Z=5}for(P=0;P<a;P++)Z+=J(v,y,g=i[P]),Z+=J(v,y,n[g]);return Z}if("boolean"===B)return v.push(n?195:194),1;if("undefined"===B)return v.push(192),1;if("function"===typeof n.toJSON)return J(v,y,n.toJSON());throw new Error("Could not encode")}y.encode=function(v){var y=[],n=[],P=J(y,n,v),b=new ArrayBuffer(P),Y=new DataView(b),l=0,a=0,Z=-1;n.length>0&&(Z=n[0]._offset);for(var x,f=0,N=0,i=0,g=y.length;i<g;i++)if(Y.setUint8(a+i,y[i]),i+1===Z){if(f=(x=n[l])._length,N=a+Z,x._bin)for(var c=new Uint8Array(x._bin),h=0;h<f;h++)Y.setUint8(N+h,c[h]);else x._str?B(Y,N,x._str):void 0!==x._float&&Y.setFloat64(N,x._float);a+=f,n[++l]&&(Z=n[l]._offset)}return b}},10727:(v,y)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.NoneSerializer=void 0;y.NoneSerializer=class{setState(v){}getState(){return null}patch(v){}teardown(){}handshake(v){}}},10719:(v,y,n)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.SchemaSerializer=void 0;const B=n(10702);y.SchemaSerializer=class{setState(v){return this.state.decode(v)}getState(){return this.state}patch(v){return this.state.decode(v)}teardown(){var v,y;null===(y=null===(v=this.state)||void 0===v?void 0:v.$changes)||void 0===y||y.root.clearRefs()}handshake(v,y){if(this.state){(new B.Reflection).decode(v,y)}else this.state=B.Reflection.decode(v,y)}}},10684:(v,y)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.getSerializer=y.registerSerializer=void 0;const n={};y.registerSerializer=function(v,y){n[v]=y},y.getSerializer=function(v){const y=n[v];if(!y)throw new Error("missing serializer: "+v);return y}},10672:function(v,y,n){"use strict";var B=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(y,"__esModule",{value:!0}),y.WebSocketTransport=void 0;const J=B(n(10676)),P=globalThis.WebSocket||J.default;y.WebSocketTransport=class{constructor(v){this.events=v}send(v){v instanceof ArrayBuffer?this.ws.send(v):Array.isArray(v)&&this.ws.send(new Uint8Array(v).buffer)}connect(v){this.ws=new P(v,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(v,y){this.ws.close(v,y)}get isOpen(){return this.ws.readyState===P.OPEN}}},10676:v=>{"use strict";v.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},10772:v=>{"use strict";v.exports=function(v){for(var y=new Array(v),n=0;n<v;++n)y[n]=n;return y}},10781:v=>{function y(v){return!!v.constructor&&"function"===typeof v.constructor.isBuffer&&v.constructor.isBuffer(v)}v.exports=function(v){return null!=v&&(y(v)||function(v){return"function"===typeof v.readFloatLE&&"function"===typeof v.slice&&y(v.slice(0,0))}(v)||!!v._isBuffer)}},10765:(v,y,n)=>{var B=n(10772),J=n(10781),P="undefined"!==typeof Float64Array;function b(v,y){return v[0]-y[0]}function Y(){var v,y=this.stride,n=new Array(y.length);for(v=0;v<n.length;++v)n[v]=[Math.abs(y[v]),v];n.sort(b);var B=new Array(n.length);for(v=0;v<B.length;++v)B[v]=n[v][1];return B}function l(v,y){var n=["View",y,"d",v].join("");y<0&&(n="View_Nil"+v);var J="generic"===v;if(-1===y){var P="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+v+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(P)()}if(0===y){P="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+v+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(J?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(J?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",P)(a[v][0])}P=["'use strict'"];var b=B(y),l=b.map((function(v){return"i"+v})),Z="this.offset+"+b.map((function(v){return"this.stride["+v+"]*i"+v})).join("+"),x=b.map((function(v){return"b"+v})).join(","),f=b.map((function(v){return"c"+v})).join(",");P.push("function "+n+"(a,"+x+","+f+",d){this.data=a","this.shape=["+x+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+v+"'","proto.dimension="+y),P.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+b.map((function(v){return"this.shape["+v+"]"})).join("*"),"}})"),1===y?P.push("proto.order=[0]"):(P.push("Object.defineProperty(proto,'order',{get:"),y<4?(P.push("function "+n+"_order(){"),2===y?P.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===y&&P.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):P.push("ORDER})")),P.push("proto.set=function "+n+"_set("+l.join(",")+",v){"),J?P.push("return this.data.set("+Z+",v)}"):P.push("return this.data["+Z+"]=v}"),P.push("proto.get=function "+n+"_get("+l.join(",")+"){"),J?P.push("return this.data.get("+Z+")}"):P.push("return this.data["+Z+"]}"),P.push("proto.index=function "+n+"_index(",l.join(),"){return "+Z+"}"),P.push("proto.hi=function "+n+"_hi("+l.join(",")+"){return new "+n+"(this.data,"+b.map((function(v){return["(typeof i",v,"!=='number'||i",v,"<0)?this.shape[",v,"]:i",v,"|0"].join("")})).join(",")+","+b.map((function(v){return"this.stride["+v+"]"})).join(",")+",this.offset)}");var N=b.map((function(v){return"a"+v+"=this.shape["+v+"]"})),i=b.map((function(v){return"c"+v+"=this.stride["+v+"]"}));P.push("proto.lo=function "+n+"_lo("+l.join(",")+"){var b=this.offset,d=0,"+N.join(",")+","+i.join(","));for(var g=0;g<y;++g)P.push("if(typeof i"+g+"==='number'&&i"+g+">=0){d=i"+g+"|0;b+=c"+g+"*d;a"+g+"-=d}");P.push("return new "+n+"(this.data,"+b.map((function(v){return"a"+v})).join(",")+","+b.map((function(v){return"c"+v})).join(",")+",b)}"),P.push("proto.step=function "+n+"_step("+l.join(",")+"){var "+b.map((function(v){return"a"+v+"=this.shape["+v+"]"})).join(",")+","+b.map((function(v){return"b"+v+"=this.stride["+v+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(g=0;g<y;++g)P.push("if(typeof i"+g+"==='number'){d=i"+g+"|0;if(d<0){c+=b"+g+"*(a"+g+"-1);a"+g+"=ceil(-a"+g+"/d)}else{a"+g+"=ceil(a"+g+"/d)}b"+g+"*=d}");P.push("return new "+n+"(this.data,"+b.map((function(v){return"a"+v})).join(",")+","+b.map((function(v){return"b"+v})).join(",")+",c)}");var c=new Array(y),h=new Array(y);for(g=0;g<y;++g)c[g]="a[i"+g+"]",h[g]="b[i"+g+"]";P.push("proto.transpose=function "+n+"_transpose("+l+"){"+l.map((function(v,y){return v+"=("+v+"===undefined?"+y+":"+v+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+c.join(",")+","+h.join(",")+",this.offset)}"),P.push("proto.pick=function "+n+"_pick("+l+"){var a=[],b=[],c=this.offset");for(g=0;g<y;++g)P.push("if(typeof i"+g+"==='number'&&i"+g+">=0){c=(c+this.stride["+g+"]*i"+g+")|0}else{a.push(this.shape["+g+"]);b.push(this.stride["+g+"])}");return P.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),P.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+b.map((function(v){return"shape["+v+"]"})).join(",")+","+b.map((function(v){return"stride["+v+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",P.join("\n"))(a[v],Y)}var a={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};v.exports=function(v,y,n,B){if(void 0===v)return(0,a.array[0])([]);"number"===typeof v&&(v=[v]),void 0===y&&(y=[v.length]);var b=y.length;if(void 0===n){n=new Array(b);for(var Y=b-1,Z=1;Y>=0;--Y)n[Y]=Z,Z*=y[Y]}if(void 0===B){B=0;for(Y=0;Y<b;++Y)n[Y]<0&&(B-=(y[Y]-1)*n[Y])}for(var x=function(v){if(J(v))return"buffer";if(P)switch(Object.prototype.toString.call(v)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(v)?"array":"generic"}(v),f=a[x];f.length<=b+1;)f.push(l(x,f.length-1));return(0,f[b+1])(v,y,n,B)}},10743:v=>{var y;self,y=()=>(()=>{"use strict";var v={d:(y,n)=>{for(var B in n)v.o(n,B)&&!v.o(y,B)&&Object.defineProperty(y,B,{enumerable:!0,get:n[B]})},o:(v,y)=>Object.prototype.hasOwnProperty.call(v,y)},y={};v.d(y,{default:()=>S});var n,B=function(v,y){var n=y.x-v.x,B=y.y-v.y;return Math.sqrt(n*n+B*B)},J=function(v){return v*(Math.PI/180)},P=new Map,b=function(v){P.has(v)&&clearTimeout(P.get(v)),P.set(v,setTimeout(v,100))},Y=function(v,y,n){for(var B,J=y.split(/[ ,]+/g),P=0;P<J.length;P+=1)B=J[P],v.addEventListener?v.addEventListener(B,n,!1):v.attachEvent&&v.attachEvent(B,n)},l=function(v,y,n){for(var B,J=y.split(/[ ,]+/g),P=0;P<J.length;P+=1)B=J[P],v.removeEventListener?v.removeEventListener(B,n):v.detachEvent&&v.detachEvent(B,n)},a=function(v){return v.preventDefault(),v.type.match(/^touch/)?v.changedTouches:v},Z=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},x=function(v,y){y.top||y.right||y.bottom||y.left?(v.style.top=y.top,v.style.right=y.right,v.style.bottom=y.bottom,v.style.left=y.left):(v.style.left=y.x+"px",v.style.top=y.y+"px")},f=function(v,y,n){var B=N(v);for(var J in B)if(B.hasOwnProperty(J))if("string"==typeof y)B[J]=y+" "+n;else{for(var P="",b=0,Y=y.length;b<Y;b+=1)P+=y[b]+" "+n+", ";B[J]=P.slice(0,-2)}return B},N=function(v){var y={};return y[v]="",["webkit","Moz","o"].forEach((function(n){y[n+v.charAt(0).toUpperCase()+v.slice(1)]=""})),y},i=function(v,y){for(var n in y)y.hasOwnProperty(n)&&(v[n]=y[n]);return v},g=function(v,y){if(v.length)for(var n=0,B=v.length;n<B;n+=1)y(v[n]);else y(v)},c="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,h=window.matchMedia("(any-hover: none)").matches,E=!!("ontouchstart"in window),W=!!window.PointerEvent,s=!!window.MSPointerEvent,C={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},r={start:"mousedown",move:"mousemove",end:"mouseup"},u={};function O(){}c&&!h?n=C:W?n={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:s?n={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:E?(n=C,u=r):n=r,O.prototype.on=function(v,y){var n,B=this,J=v.split(/[ ,]+/g);B._handlers_=B._handlers_||{};for(var P=0;P<J.length;P+=1)n=J[P],B._handlers_[n]=B._handlers_[n]||[],B._handlers_[n].push(y);return B},O.prototype.off=function(v,y){var n=this;return n._handlers_=n._handlers_||{},void 0===v?n._handlers_={}:void 0===y?n._handlers_[v]=null:n._handlers_[v]&&n._handlers_[v].indexOf(y)>=0&&n._handlers_[v].splice(n._handlers_[v].indexOf(y),1),n},O.prototype.trigger=function(v,y){var n,B=this,J=v.split(/[ ,]+/g);B._handlers_=B._handlers_||{};for(var P=0;P<J.length;P+=1)n=J[P],B._handlers_[n]&&B._handlers_[n].length&&B._handlers_[n].forEach((function(v){v.call(B,{type:n,target:B},y)}))},O.prototype.config=function(v){var y=this;y.options=y.defaults||{},v&&(y.options=function(v,y){var n={};for(var B in v)v.hasOwnProperty(B)&&y.hasOwnProperty(B)?n[B]=y[B]:v.hasOwnProperty(B)&&(n[B]=v[B]);return n}(y.options,v))},O.prototype.bindEvt=function(v,y){var B=this;return B._domHandlers_=B._domHandlers_||{},B._domHandlers_[y]=function(){"function"==typeof B["on"+y]?B["on"+y].apply(B,arguments):console.warn('[WARNING] : Missing "on'+y+'" handler.')},Y(v,n[y],B._domHandlers_[y]),u[y]&&Y(v,u[y],B._domHandlers_[y]),B},O.prototype.unbindEvt=function(v,y){var B=this;return B._domHandlers_=B._domHandlers_||{},l(v,n[y],B._domHandlers_[y]),u[y]&&l(v,u[y],B._domHandlers_[y]),delete B._domHandlers_[y],this};const d=O;function q(v,y){return this.identifier=y.identifier,this.position=y.position,this.frontPosition=y.frontPosition,this.collection=v,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(y),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=q.id,q.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}q.prototype=new d,q.constructor=q,q.id=0,q.prototype.buildEl=function(v){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},q.prototype.stylize=function(){if(this.options.dataOnly)return this;var v=this.options.fadeTime+"ms",y=function(){var v=N("borderRadius");for(var y in v)v.hasOwnProperty(y)&&(v[y]="50%");return v}(),n=f("transition","opacity",v),B={};return B.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},B.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},B.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},i(B.el,n),"circle"===this.options.shape&&i(B.back,y),i(B.front,y),this.applyStyles(B),this},q.prototype.applyStyles=function(v){for(var y in this.ui)if(this.ui.hasOwnProperty(y))for(var n in v[y])this.ui[y].style[n]=v[y][n];return this},q.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},q.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},q.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},q.prototype.show=function(v){var y=this;return y.options.dataOnly||(clearTimeout(y.removeTimeout),clearTimeout(y.showTimeout),clearTimeout(y.restTimeout),y.addToDom(),y.restCallback(),setTimeout((function(){y.ui.el.style.opacity=1}),0),y.showTimeout=setTimeout((function(){y.trigger("shown",y.instance),"function"==typeof v&&v.call(this)}),y.options.fadeTime)),y},q.prototype.hide=function(v){var y=this;if(y.options.dataOnly)return y;if(y.ui.el.style.opacity=y.options.restOpacity,clearTimeout(y.removeTimeout),clearTimeout(y.showTimeout),clearTimeout(y.restTimeout),y.removeTimeout=setTimeout((function(){var n="dynamic"===y.options.mode?"none":"block";y.ui.el.style.display=n,"function"==typeof v&&v.call(y),y.trigger("hidden",y.instance)}),y.options.fadeTime),y.options.restJoystick){var n=y.options.restJoystick,B={};B.x=!0===n||!1!==n.x?0:y.instance.frontPosition.x,B.y=!0===n||!1!==n.y?0:y.instance.frontPosition.y,y.setPosition(v,B)}return y},q.prototype.setPosition=function(v,y){var n=this;n.frontPosition={x:y.x,y:y.y};var B=n.options.fadeTime+"ms",J={};J.front=f("transition",["transform"],B);var P={front:{}};P.front={transform:"translate("+n.frontPosition.x+"px,"+n.frontPosition.y+"px)"},n.applyStyles(J),n.applyStyles(P),n.restTimeout=setTimeout((function(){"function"==typeof v&&v.call(n),n.restCallback()}),n.options.fadeTime)},q.prototype.restCallback=function(){var v=this,y={};y.front=f("transition","none",""),v.applyStyles(y),v.trigger("rested",v.instance)},q.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},q.prototype.computeDirection=function(v){var y,n,B,J=v.angle.radian,P=Math.PI/4,b=Math.PI/2;if(J>P&&J<3*P&&!v.lockX?y="up":J>-P&&J<=P&&!v.lockY?y="left":J>3*-P&&J<=-P&&!v.lockX?y="down":v.lockY||(y="right"),v.lockY||(n=J>-b&&J<b?"left":"right"),v.lockX||(B=J>0?"up":"down"),v.force>this.options.threshold){var Y,l={};for(Y in this.direction)this.direction.hasOwnProperty(Y)&&(l[Y]=this.direction[Y]);var a={};for(Y in this.direction={x:n,y:B,angle:y},v.direction=this.direction,l)l[Y]===this.direction[Y]&&(a[Y]=!0);if(a.x&&a.y&&a.angle)return v;a.x&&a.y||this.trigger("plain",v),a.x||this.trigger("plain:"+n,v),a.y||this.trigger("plain:"+B,v),a.angle||this.trigger("dir dir:"+y,v)}else this.resetDirection();return v};const L=q;function t(v,y){var n=this;n.nipples=[],n.idles=[],n.actives=[],n.ids=[],n.pressureIntervals={},n.manager=v,n.id=t.id,t.id+=1,n.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},n.config(y),"static"!==n.options.mode&&"semi"!==n.options.mode||(n.options.multitouch=!1),n.options.multitouch||(n.options.maxNumberOfNipples=1);var B=getComputedStyle(n.options.zone.parentElement);return B&&"flex"===B.display&&(n.parentIsFlex=!0),n.updateBox(),n.prepareNipples(),n.Lj(),n.begin(),n.nipples}t.prototype=new d,t.constructor=t,t.id=0,t.prototype.prepareNipples=function(){var v=this,y=v.nipples;y.on=v.on.bind(v),y.off=v.off.bind(v),y.options=v.options,y.destroy=v.destroy.bind(v),y.ids=v.ids,y.id=v.id,y.processOnMove=v.processOnMove.bind(v),y.processOnEnd=v.processOnEnd.bind(v),y.get=function(v){if(void 0===v)return y[0];for(var n=0,B=y.length;n<B;n+=1)if(y[n].identifier===v)return y[n];return!1}},t.prototype.Lj=function(){var v=this;v.bindEvt(v.options.zone,"start"),v.options.zone.style.touchAction="none",v.options.zone.style.msTouchAction="none"},t.prototype.begin=function(){var v=this,y=v.options;if("static"===y.mode){var n=v.createNipple(y.position,v.manager.getIdentifier());n.add(),v.idles.push(n)}},t.prototype.createNipple=function(v,y){var n=this,B=n.manager.scroll,J={},P=n.options,b=n.parentIsFlex?B.x:B.x+n.box.left,Y=n.parentIsFlex?B.y:B.y+n.box.top;if(v.x&&v.y)J={x:v.x-b,y:v.y-Y};else if(v.top||v.right||v.bottom||v.left){var l=document.createElement("DIV");l.style.display="hidden",l.style.top=v.top,l.style.right=v.right,l.style.bottom=v.bottom,l.style.left=v.left,l.style.position="absolute",P.zone.appendChild(l);var a=l.getBoundingClientRect();P.zone.removeChild(l),J=v,v={x:a.left+B.x,y:a.top+B.y}}var Z=new L(n,{color:P.color,size:P.size,threshold:P.threshold,fadeTime:P.fadeTime,dataOnly:P.dataOnly,restJoystick:P.restJoystick,restOpacity:P.restOpacity,mode:P.mode,identifier:y,position:v,zone:P.zone,frontPosition:{x:0,y:0},shape:P.shape});return P.dataOnly||(x(Z.ui.el,J),x(Z.ui.front,Z.frontPosition)),n.nipples.push(Z),n.trigger("added "+Z.identifier+":added",Z),n.manager.trigger("added "+Z.identifier+":added",Z),n.bindNipple(Z),Z},t.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},t.prototype.bindNipple=function(v){var y,n=this,B=function(v,B){y=v.type+" "+B.id+":"+v.type,n.trigger(y,B)};v.on("destroyed",n.onDestroyed.bind(n)),v.on("shown hidden rested dir plain",B),v.on("dir:up dir:right dir:down dir:left",B),v.on("plain:up plain:right plain:down plain:left",B)},t.prototype.pressureFn=function(v,y,n){var B=this,J=0;clearInterval(B.pressureIntervals[n]),B.pressureIntervals[n]=setInterval(function(){var n=v.force||v.pressure||v.webkitForce||0;n!==J&&(y.trigger("pressure",n),B.trigger("pressure "+y.identifier+":pressure",n),J=n)}.bind(B),100)},t.prototype.onstart=function(v){var y=this,n=y.options,B=v;return v=a(v),y.updateBox(),g(v,(function(J){y.actives.length<n.maxNumberOfNipples?y.processOnStart(J):B.type.match(/^touch/)&&(Object.keys(y.manager.ids).forEach((function(n){if(Object.values(B.touches).findIndex((function(v){return v.identifier===n}))<0){var J=[v[0]];J.identifier=n,y.processOnEnd(J)}})),y.actives.length<n.maxNumberOfNipples&&y.processOnStart(J))})),y.manager.bindDocument(),!1},t.prototype.processOnStart=function(v){var y,n=this,J=n.options,P=n.manager.getIdentifier(v),b=v.force||v.pressure||v.webkitForce||0,Y={x:v.pageX,y:v.pageY},l=n.getOrCreate(P,Y);l.identifier!==P&&n.manager.removeIdentifier(l.identifier),l.identifier=P;var a=function(y){y.trigger("start",y),n.trigger("start "+y.id+":start",y),y.show(),b>0&&n.pressureFn(v,y,y.identifier),n.processOnMove(v)};if((y=n.idles.indexOf(l))>=0&&n.idles.splice(y,1),n.actives.push(l),n.ids.push(l.identifier),"semi"!==J.mode)a(l);else{if(!(B(Y,l.position)<=J.catchDistance))return l.destroy(),void n.processOnStart(v);a(l)}return l},t.prototype.getOrCreate=function(v,y){var n,B=this,J=B.options;return/(semi|static)/.test(J.mode)?(n=B.idles[0])?(B.idles.splice(0,1),n):"semi"===J.mode?B.createNipple(y,v):(console.warn("Coudln't find the needed nipple."),!1):n=B.createNipple(y,v)},t.prototype.processOnMove=function(v){var y=this,n=y.options,P=y.manager.getIdentifier(v),b=y.nipples.get(P),Y=y.manager.scroll;if(function(v){return isNaN(v.buttons)?0!==v.pressure:0!==v.buttons}(v)){if(!b)return console.error("Found zombie joystick with ID "+P),void y.manager.removeIdentifier(P);if(n.dynamicPage){var l=b.el.getBoundingClientRect();b.position={x:Y.x+l.left,y:Y.y+l.top}}b.identifier=P;var a=b.options.size/2,Z={x:v.pageX,y:v.pageY};n.lockX&&(Z.y=b.position.y),n.lockY&&(Z.x=b.position.x);var x,f,N,i,g,c,h,E,W,s,C=B(Z,b.position),r=(x=Z,N=(f=b.position).x-x.x,i=f.y-x.y,function(v){return v*(180/Math.PI)}(Math.atan2(i,N))),u=J(r),O=C/a,d={distance:C,position:Z};if("circle"===b.options.shape?(g=Math.min(C,a),h=b.position,E=g,s={x:0,y:0},W=J(W=r),s.x=h.x-E*Math.cos(W),s.y=h.y-E*Math.sin(W),c=s):(c=function(v,y,n){return{x:Math.min(Math.max(v.x,y.x-n),y.x+n),y:Math.min(Math.max(v.y,y.y-n),y.y+n)}}(Z,b.position,a),g=B(c,b.position)),n.follow){if(C>a){var q=Z.x-c.x,L=Z.y-c.y;b.position.x+=q,b.position.y+=L,b.el.style.top=b.position.y-(y.box.top+Y.y)+"px",b.el.style.left=b.position.x-(y.box.left+Y.x)+"px",C=B(Z,b.position)}}else Z=c,C=g;var t=Z.x-b.position.x,G=Z.y-b.position.y;b.frontPosition={x:t,y:G},n.dataOnly||(b.ui.front.style.transform="translate("+t+"px,"+G+"px)");var R={identifier:b.identifier,position:Z,force:O,pressure:v.force||v.pressure||v.webkitForce||0,distance:C,angle:{radian:u,degree:r},vector:{x:t/a,y:-G/a},raw:d,instance:b,lockX:n.lockX,lockY:n.lockY};(R=b.computeDirection(R)).angle={radian:J(180-r),degree:180-r},b.trigger("move",R),y.trigger("move "+b.id+":move",R)}else this.processOnEnd(v)},t.prototype.processOnEnd=function(v){var y=this,n=y.options,B=y.manager.getIdentifier(v),J=y.nipples.get(B),P=y.manager.removeIdentifier(J.identifier);J&&(n.dataOnly||J.hide((function(){"dynamic"===n.mode&&(J.trigger("removed",J),y.trigger("removed "+J.id+":removed",J),y.manager.trigger("removed "+J.id+":removed",J),J.destroy())})),clearInterval(y.pressureIntervals[J.identifier]),J.resetDirection(),J.trigger("end",J),y.trigger("end "+J.id+":end",J),y.ids.indexOf(J.identifier)>=0&&y.ids.splice(y.ids.indexOf(J.identifier),1),y.actives.indexOf(J)>=0&&y.actives.splice(y.actives.indexOf(J),1),/(semi|static)/.test(n.mode)?y.idles.push(J):y.nipples.indexOf(J)>=0&&y.nipples.splice(y.nipples.indexOf(J),1),y.manager.unbindDocument(),/(semi|static)/.test(n.mode)&&(y.manager.ids[P.id]=P.identifier))},t.prototype.onDestroyed=function(v,y){var n=this;n.nipples.indexOf(y)>=0&&n.nipples.splice(n.nipples.indexOf(y),1),n.actives.indexOf(y)>=0&&n.actives.splice(n.actives.indexOf(y),1),n.idles.indexOf(y)>=0&&n.idles.splice(n.idles.indexOf(y),1),n.ids.indexOf(y.identifier)>=0&&n.ids.splice(n.ids.indexOf(y.identifier),1),n.manager.removeIdentifier(y.identifier),n.manager.unbindDocument()},t.prototype.destroy=function(){var v=this;for(var y in v.unbindEvt(v.options.zone,"start"),v.nipples.forEach((function(v){v.destroy()})),v.pressureIntervals)v.pressureIntervals.hasOwnProperty(y)&&clearInterval(v.pressureIntervals[y]);v.trigger("destroyed",v.nipples),v.manager.unbindDocument(),v.off()};const G=t;function R(v){var y=this;y.ids={},y.index=0,y.collections=[],y.scroll=Z(),y.config(v),y.prepareCollections();var n=function(){var v;y.collections.forEach((function(n){n.forEach((function(n){v=n.el.getBoundingClientRect(),n.position={x:y.scroll.x+v.left,y:y.scroll.y+v.top}}))}))};Y(window,"resize",(function(){b(n)}));var B=function(){y.scroll=Z()};return Y(window,"scroll",(function(){b(B)})),y.collections}R.prototype=new d,R.constructor=R,R.prototype.prepareCollections=function(){var v=this;v.collections.create=v.create.bind(v),v.collections.on=v.on.bind(v),v.collections.off=v.off.bind(v),v.collections.destroy=v.destroy.bind(v),v.collections.get=function(y){var n;return v.collections.every((function(v){return!(n=v.get(y))})),n}},R.prototype.create=function(v){return this.createCollection(v)},R.prototype.createCollection=function(v){var y=this,n=new G(y,v);return y.bindCollection(n),y.collections.push(n),n},R.prototype.bindCollection=function(v){var y,n=this,B=function(v,B){y=v.type+" "+B.id+":"+v.type,n.trigger(y,B)};v.on("destroyed",n.onDestroyed.bind(n)),v.on("shown hidden rested dir plain",B),v.on("dir:up dir:right dir:down dir:left",B),v.on("plain:up plain:right plain:down plain:left",B)},R.prototype.bindDocument=function(){var v=this;v.binded||(v.bindEvt(document,"move").bindEvt(document,"end"),v.binded=!0)},R.prototype.unbindDocument=function(v){var y=this;Object.keys(y.ids).length&&!0!==v||(y.unbindEvt(document,"move").unbindEvt(document,"end"),y.binded=!1)},R.prototype.getIdentifier=function(v){var y;return v?void 0===(y=void 0===v.identifier?v.pointerId:v.identifier)&&(y=this.latest||0):y=this.index,void 0===this.ids[y]&&(this.ids[y]=this.index,this.index+=1),this.latest=y,this.ids[y]},R.prototype.removeIdentifier=function(v){var y={};for(var n in this.ids)if(this.ids[n]===v){y.id=n,y.identifier=this.ids[n],delete this.ids[n];break}return y},R.prototype.onmove=function(v){return this.onAny("move",v),!1},R.prototype.onend=function(v){return this.onAny("end",v),!1},R.prototype.oncancel=function(v){return this.onAny("end",v),!1},R.prototype.onAny=function(v,y){var n,B=this,J="processOn"+v.charAt(0).toUpperCase()+v.slice(1);y=a(y);var P=function(v,y,n){n.ids.indexOf(y)>=0&&(n[J](v),v._found_=!0)};return g(y,(function(v){n=B.getIdentifier(v),g(B.collections,P.bind(null,v,n)),v._found_||B.removeIdentifier(n)})),!1},R.prototype.destroy=function(){var v=this;v.unbindDocument(!0),v.ids={},v.index=0,v.collections.forEach((function(v){v.destroy()})),v.off()},R.prototype.onDestroyed=function(v,y){var n=this;if(n.collections.indexOf(y)<0)return!1;n.collections.splice(n.collections.indexOf(y),1)};var F=new R;const S={create:function(v){return F.create(v)},factory:F};return y.default})(),v.exports=y()},10925:(v,y,n)=>{"use strict";const{Deflate:B,deflate:J,deflateRaw:P,gzip:b}=n(10930),{Inflate:Y,inflate:l,inflateRaw:a,ungzip:Z}=n(10986),x=n(10958);v.exports.Deflate=B,v.exports.deflate=J,v.exports.deflateRaw=P,v.exports.gzip=b,v.exports.Inflate=Y,v.exports.inflate=l,v.exports.inflateRaw=a,v.exports.ungzip=Z,v.exports.constants=x},10930:(v,y,n)=>{"use strict";const B=n(10938),J=n(10964),P=n(10972),b=n(10954),Y=n(10980),l=Object.prototype.toString,{Z_NO_FLUSH:a,Z_SYNC_FLUSH:Z,Z_FULL_FLUSH:x,Z_FINISH:f,Z_OK:N,Z_STREAM_END:i,Z_DEFAULT_COMPRESSION:g,Z_DEFAULT_STRATEGY:c,Z_DEFLATED:h}=n(10958);function E(v){this.options=J.assign({level:g,method:h,Ja:16384,windowBits:15,memLevel:8,strategy:c},v||{});let y=this.options;y.raw&&y.windowBits>0?y.windowBits=-y.windowBits:y.gzip&&y.windowBits>0&&y.windowBits<16&&(y.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Y,this.strm.avail_out=0;let n=B.deflateInit2(this.strm,y.level,y.method,y.windowBits,y.memLevel,y.strategy);if(n!==N)throw new Error(b[n]);if(y.header&&B.deflateSetHeader(this.strm,y.header),y.dictionary){let v;if(v="string"===typeof y.dictionary?P.string2buf(y.dictionary):"[object ArrayBuffer]"===l.call(y.dictionary)?new Uint8Array(y.dictionary):y.dictionary,n=B.deflateSetDictionary(this.strm,v),n!==N)throw new Error(b[n]);this._dict_set=!0}}function W(v,y){const n=new E(y);if(n.push(v,!0),n.err)throw n.msg||b[n.err];return n.result}E.prototype.push=function(v,y){const n=this.strm,J=this.options.Ja;let b,Y;if(this.ended)return!1;for(Y=y===~~y?y:!0===y?f:a,"string"===typeof v?n.input=P.string2buf(v):"[object ArrayBuffer]"===l.call(v)?n.input=new Uint8Array(v):n.input=v,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(J),n.next_out=0,n.avail_out=J),(Y===Z||Y===x)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(b=B.deflate(n,Y),b===i)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),b=B.deflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===N;if(0!==n.avail_out){if(Y>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},E.prototype.onData=function(v){this.chunks.push(v)},E.prototype.onEnd=function(v){v===N&&(this.result=J.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},v.exports.Deflate=E,v.exports.deflate=W,v.exports.deflateRaw=function(v,y){return(y=y||{}).raw=!0,W(v,y)},v.exports.gzip=function(v,y){return(y=y||{}).gzip=!0,W(v,y)},v.exports.constants=n(10958)},10986:(v,y,n)=>{"use strict";const B=n(10991),J=n(10964),P=n(10972),b=n(10954),Y=n(10980),l=n(11006),a=Object.prototype.toString,{Z_NO_FLUSH:Z,Z_FINISH:x,Z_OK:f,Z_STREAM_END:N,Z_NEED_DICT:i,Z_STREAM_ERROR:g,Z_DATA_ERROR:c,Z_MEM_ERROR:h}=n(10958);function E(v){this.options=J.assign({Ja:65536,windowBits:15,to:""},v||{});const y=this.options;y.raw&&y.windowBits>=0&&y.windowBits<16&&(y.windowBits=-y.windowBits,0===y.windowBits&&(y.windowBits=-15)),!(y.windowBits>=0&&y.windowBits<16)||v&&v.windowBits||(y.windowBits+=32),y.windowBits>15&&y.windowBits<48&&0===(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Y,this.strm.avail_out=0;let n=B.inflateInit2(this.strm,y.windowBits);if(n!==f)throw new Error(b[n]);if(this.header=new l,B.inflateGetHeader(this.strm,this.header),y.dictionary&&("string"===typeof y.dictionary?y.dictionary=P.string2buf(y.dictionary):"[object ArrayBuffer]"===a.call(y.dictionary)&&(y.dictionary=new Uint8Array(y.dictionary)),y.raw&&(n=B.inflateSetDictionary(this.strm,y.dictionary),n!==f)))throw new Error(b[n])}function W(v,y){const n=new E(y);if(n.push(v),n.err)throw n.msg||b[n.err];return n.result}E.prototype.push=function(v,y){const n=this.strm,J=this.options.Ja,b=this.options.dictionary;let Y,l,E;if(this.ended)return!1;for(l=y===~~y?y:!0===y?x:Z,"[object ArrayBuffer]"===a.call(v)?n.input=new Uint8Array(v):n.input=v,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(J),n.next_out=0,n.avail_out=J),Y=B.inflate(n,l),Y===i&&b&&(Y=B.inflateSetDictionary(n,b),Y===f?Y=B.inflate(n,l):Y===c&&(Y=i));n.avail_in>0&&Y===N&&n.state.wrap>0&&0!==v[n.next_in];)B.inflateReset(n),Y=B.inflate(n,l);switch(Y){case g:case c:case i:case h:return this.onEnd(Y),this.ended=!0,!1}if(E=n.avail_out,n.next_out&&(0===n.avail_out||Y===N))if("string"===this.options.to){let v=P.utf8border(n.output,n.next_out),y=n.next_out-v,B=P.buf2string(n.output,v);n.next_out=y,n.avail_out=J-y,y&&n.output.set(n.output.subarray(v,v+y),0),this.onData(B)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(Y!==f||0!==E){if(Y===N)return Y=B.inflateEnd(this.strm),this.onEnd(Y),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},E.prototype.onData=function(v){this.chunks.push(v)},E.prototype.onEnd=function(v){v===f&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=J.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},v.exports.Inflate=E,v.exports.inflate=W,v.exports.inflateRaw=function(v,y){return(y=y||{}).raw=!0,W(v,y)},v.exports.ungzip=W,v.exports.constants=n(10958)},10964:v=>{"use strict";const y=(v,y)=>Object.prototype.hasOwnProperty.call(v,y);v.exports.assign=function(v){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const B=n.shift();if(B){if("object"!==typeof B)throw new TypeError(B+"must be non-object");for(const n in B)y(B,n)&&(v[n]=B[n])}}return v},v.exports.flattenChunks=v=>{let y=0;for(let B=0,J=v.length;B<J;B++)y+=v[B].length;const n=new Uint8Array(y);for(let B=0,J=0,P=v.length;B<P;B++){let y=v[B];n.set(y,J),J+=y.length}return n}},10972:v=>{"use strict";let y=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(B){y=!1}const n=new Uint8Array(256);for(let J=0;J<256;J++)n[J]=J>=252?6:J>=248?5:J>=240?4:J>=224?3:J>=192?2:1;n[254]=n[254]=1,v.exports.string2buf=v=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(v);let y,n,B,J,P,b=v.length,Y=0;for(J=0;J<b;J++)n=v.charCodeAt(J),55296===(64512&n)&&J+1<b&&(B=v.charCodeAt(J+1),56320===(64512&B)&&(n=65536+(n-55296<<10)+(B-56320),J++)),Y+=n<128?1:n<2048?2:n<65536?3:4;for(y=new Uint8Array(Y),P=0,J=0;P<Y;J++)n=v.charCodeAt(J),55296===(64512&n)&&J+1<b&&(B=v.charCodeAt(J+1),56320===(64512&B)&&(n=65536+(n-55296<<10)+(B-56320),J++)),n<128?y[P++]=n:n<2048?(y[P++]=192|n>>>6,y[P++]=128|63&n):n<65536?(y[P++]=224|n>>>12,y[P++]=128|n>>>6&63,y[P++]=128|63&n):(y[P++]=240|n>>>18,y[P++]=128|n>>>12&63,y[P++]=128|n>>>6&63,y[P++]=128|63&n);return y};v.exports.buf2string=(v,B)=>{const J=B||v.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(v.subarray(0,B));let P,b;const Y=new Array(2*J);for(b=0,P=0;P<J;){let y=v[P++];if(y<128){Y[b++]=y;continue}let B=n[y];if(B>4)Y[b++]=65533,P+=B-1;else{for(y&=2===B?31:3===B?15:7;B>1&&P<J;)y=y<<6|63&v[P++],B--;B>1?Y[b++]=65533:y<65536?Y[b++]=y:(y-=65536,Y[b++]=55296|y>>10&1023,Y[b++]=56320|1023&y)}}return((v,n)=>{if(n<65534&&v.subarray&&y)return String.fromCharCode.apply(null,v.length===n?v:v.subarray(0,n));let B="";for(let y=0;y<n;y++)B+=String.fromCharCode(v[y]);return B})(Y,b)},v.exports.utf8border=(v,y)=>{(y=y||v.length)>v.length&&(y=v.length);let B=y-1;for(;B>=0&&128===(192&v[B]);)B--;return B<0||0===B?y:B+n[v[B]]>y?B:y}},10948:v=>{"use strict";v.exports=(v,y,n,B)=>{let J=65535&v,P=v>>>16&65535,b=0;for(;0!==n;){b=n>2e3?2e3:n,n-=b;do{J=J+y[B++]|0,P=P+J|0}while(--b);J%=65521,P%=65521}return J|P<<16}},10958:v=>{"use strict";v.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},10951:v=>{"use strict";const y=new Uint32Array((()=>{let v,y=[];for(var n=0;n<256;n++){v=n;for(var B=0;B<8;B++)v=1&v?3988292384^v>>>1:v>>>1;y[n]=v}return y})());v.exports=(v,n,B,J)=>{const P=y,b=J+B;v^=-1;for(let y=J;y<b;y++)v=v>>>8^P[255&(v^n[y])];return~v}},10938:(v,y,n)=>{"use strict";const{_tr_init:B,_tr_stored_block:J,_tr_flush_block:P,_tr_tally:b,_tr_align:Y}=n(10946),l=n(10948),a=n(10951),Z=n(10954),{Z_NO_FLUSH:x,Z_PARTIAL_FLUSH:f,Z_FULL_FLUSH:N,Z_FINISH:i,Z_BLOCK:g,Z_OK:c,Z_STREAM_END:h,Z_STREAM_ERROR:E,Z_DATA_ERROR:W,Z_BUF_ERROR:s,Z_DEFAULT_COMPRESSION:C,Z_FILTERED:r,Z_HUFFMAN_ONLY:u,Z_RLE:O,Z_FIXED:d,Z_DEFAULT_STRATEGY:q,Z_UNKNOWN:L,Z_DEFLATED:t}=n(10958),G=258,R=262,F=103,S=113,w=666,k=(v,y)=>(v.msg=Z[y],y),M=v=>(v<<1)-(v>4?9:0),I=v=>{let y=v.length;for(;--y>=0;)v[y]=0};let j=(v,y,n)=>(y<<v.hash_shift^n)&v.hash_mask;const V=v=>{const y=v.state;let n=y.pending;n>v.avail_out&&(n=v.avail_out),0!==n&&(v.output.set(y.pending_buf.subarray(y.pending_out,y.pending_out+n),v.next_out),v.next_out+=n,y.pending_out+=n,v.total_out+=n,v.avail_out-=n,y.pending-=n,0===y.pending&&(y.pending_out=0))},p=(v,y)=>{P(v,v.block_start>=0?v.block_start:-1,v.strstart-v.block_start,y),v.block_start=v.strstart,V(v.strm)},H=(v,y)=>{v.pending_buf[v.pending++]=y},A=(v,y)=>{v.pending_buf[v.pending++]=y>>>8&255,v.pending_buf[v.pending++]=255&y},X=(v,y,n,B)=>{let J=v.avail_in;return J>B&&(J=B),0===J?0:(v.avail_in-=J,y.set(v.input.subarray(v.next_in,v.next_in+J),n),1===v.state.wrap?v.adler=l(v.adler,y,J,n):2===v.state.wrap&&(v.adler=a(v.adler,y,J,n)),v.next_in+=J,v.total_in+=J,J)},U=(v,y)=>{let n,B,J=v.max_chain_length,P=v.strstart,b=v.prev_length,Y=v.nice_match;const l=v.strstart>v.w_size-R?v.strstart-(v.w_size-R):0,a=v.window,Z=v.w_mask,x=v.prev,f=v.strstart+G;let N=a[P+b-1],i=a[P+b];v.prev_length>=v.good_match&&(J>>=2),Y>v.lookahead&&(Y=v.lookahead);do{if(n=y,a[n+b]===i&&a[n+b-1]===N&&a[n]===a[P]&&a[++n]===a[P+1]){P+=2,n++;do{}while(a[++P]===a[++n]&&a[++P]===a[++n]&&a[++P]===a[++n]&&a[++P]===a[++n]&&a[++P]===a[++n]&&a[++P]===a[++n]&&a[++P]===a[++n]&&a[++P]===a[++n]&&P<f);if(B=G-(f-P),P=f-G,B>b){if(v.match_start=y,b=B,B>=Y)break;N=a[P+b-1],i=a[P+b]}}}while((y=x[y&Z])>l&&0!==--J);return b<=v.lookahead?b:v.lookahead},z=v=>{const y=v.w_size;let n,B,J,P,b;do{if(P=v.window_size-v.lookahead-v.strstart,v.strstart>=y+(y-R)){v.window.set(v.window.subarray(y,y+y),0),v.match_start-=y,v.strstart-=y,v.block_start-=y,B=v.hash_size,n=B;do{J=v.head[--n],v.head[n]=J>=y?J-y:0}while(--B);B=y,n=B;do{J=v.prev[--n],v.prev[n]=J>=y?J-y:0}while(--B);P+=y}if(0===v.strm.avail_in)break;if(B=X(v.strm,v.window,v.strstart+v.lookahead,P),v.lookahead+=B,v.lookahead+v.insert>=3)for(b=v.strstart-v.insert,v.ins_h=v.window[b],v.ins_h=j(v,v.ins_h,v.window[b+1]);v.insert&&(v.ins_h=j(v,v.ins_h,v.window[b+3-1]),v.prev[b&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=b,b++,v.insert--,!(v.lookahead+v.insert<3)););}while(v.lookahead<R&&0!==v.strm.avail_in)},e=(v,y)=>{let n,B;for(;;){if(v.lookahead<R){if(z(v),v.lookahead<R&&y===x)return 1;if(0===v.lookahead)break}if(n=0,v.lookahead>=3&&(v.ins_h=j(v,v.ins_h,v.window[v.strstart+3-1]),n=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),0!==n&&v.strstart-n<=v.w_size-R&&(v.match_length=U(v,n)),v.match_length>=3)if(B=b(v,v.strstart-v.match_start,v.match_length-3),v.lookahead-=v.match_length,v.match_length<=v.max_lazy_match&&v.lookahead>=3){v.match_length--;do{v.strstart++,v.ins_h=j(v,v.ins_h,v.window[v.strstart+3-1]),n=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart}while(0!==--v.match_length);v.strstart++}else v.strstart+=v.match_length,v.match_length=0,v.ins_h=v.window[v.strstart],v.ins_h=j(v,v.ins_h,v.window[v.strstart+1]);else B=b(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++;if(B&&(p(v,!1),0===v.strm.avail_out))return 1}return v.insert=v.strstart<2?v.strstart:2,y===i?(p(v,!0),0===v.strm.avail_out?3:4):v.last_lit&&(p(v,!1),0===v.strm.avail_out)?1:2},K=(v,y)=>{let n,B,J;for(;;){if(v.lookahead<R){if(z(v),v.lookahead<R&&y===x)return 1;if(0===v.lookahead)break}if(n=0,v.lookahead>=3&&(v.ins_h=j(v,v.ins_h,v.window[v.strstart+3-1]),n=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),v.prev_length=v.match_length,v.prev_match=v.match_start,v.match_length=2,0!==n&&v.prev_length<v.max_lazy_match&&v.strstart-n<=v.w_size-R&&(v.match_length=U(v,n),v.match_length<=5&&(v.strategy===r||3===v.match_length&&v.strstart-v.match_start>4096)&&(v.match_length=2)),v.prev_length>=3&&v.match_length<=v.prev_length){J=v.strstart+v.lookahead-3,B=b(v,v.strstart-1-v.prev_match,v.prev_length-3),v.lookahead-=v.prev_length-1,v.prev_length-=2;do{++v.strstart<=J&&(v.ins_h=j(v,v.ins_h,v.window[v.strstart+3-1]),n=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart)}while(0!==--v.prev_length);if(v.match_available=0,v.match_length=2,v.strstart++,B&&(p(v,!1),0===v.strm.avail_out))return 1}else if(v.match_available){if(B=b(v,0,v.window[v.strstart-1]),B&&p(v,!1),v.strstart++,v.lookahead--,0===v.strm.avail_out)return 1}else v.match_available=1,v.strstart++,v.lookahead--}return v.match_available&&(B=b(v,0,v.window[v.strstart-1]),v.match_available=0),v.insert=v.strstart<2?v.strstart:2,y===i?(p(v,!0),0===v.strm.avail_out?3:4):v.last_lit&&(p(v,!1),0===v.strm.avail_out)?1:2};function D(v,y,n,B,J){this.good_length=v,this.max_lazy=y,this.nice_length=n,this.max_chain=B,this.func=J}const Q=[new D(0,0,0,0,((v,y)=>{let n=65535;for(n>v.pending_buf_size-5&&(n=v.pending_buf_size-5);;){if(v.lookahead<=1){if(z(v),0===v.lookahead&&y===x)return 1;if(0===v.lookahead)break}v.strstart+=v.lookahead,v.lookahead=0;const B=v.block_start+n;if((0===v.strstart||v.strstart>=B)&&(v.lookahead=v.strstart-B,v.strstart=B,p(v,!1),0===v.strm.avail_out))return 1;if(v.strstart-v.block_start>=v.w_size-R&&(p(v,!1),0===v.strm.avail_out))return 1}return v.insert=0,y===i?(p(v,!0),0===v.strm.avail_out?3:4):(v.strstart>v.block_start&&(p(v,!1),v.strm.avail_out),1)})),new D(4,4,8,4,e),new D(4,5,16,8,e),new D(4,6,32,32,e),new D(4,4,16,16,K),new D(8,16,32,32,K),new D(8,16,128,128,K),new D(8,32,128,256,K),new D(32,128,258,1024,K),new D(32,258,258,4096,K)];function o(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=t,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),I(this.dyn_ltree),I(this.dyn_dtree),I(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),I(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),I(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const T=v=>{if(!v||!v.state)return k(v,E);v.total_in=v.total_out=0,v.data_type=L;const y=v.state;return y.pending=0,y.pending_out=0,y.wrap<0&&(y.wrap=-y.wrap),y.status=y.wrap?42:S,v.adler=2===y.wrap?0:1,y.last_flush=x,B(y),c},m=v=>{const y=T(v);var n;return y===c&&((n=v.state).window_size=2*n.w_size,I(n.head),n.max_lazy_match=Q[n.level].max_lazy,n.good_match=Q[n.level].good_length,n.nice_match=Q[n.level].nice_length,n.max_chain_length=Q[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),y},vv=(v,y,n,B,J,P)=>{if(!v)return E;let b=1;if(y===C&&(y=6),B<0?(b=0,B=-B):B>15&&(b=2,B-=16),J<1||J>9||n!==t||B<8||B>15||y<0||y>9||P<0||P>d)return k(v,E);8===B&&(B=9);const Y=new o;return v.state=Y,Y.strm=v,Y.wrap=b,Y.gzhead=null,Y.w_bits=B,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=J+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+3-1)/3),Y.window=new Uint8Array(2*Y.w_size),Y.head=new Uint16Array(Y.hash_size),Y.prev=new Uint16Array(Y.w_size),Y.lit_bufsize=1<<J+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new Uint8Array(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=y,Y.strategy=P,Y.method=n,m(v)};v.exports.deflateInit=(v,y)=>vv(v,y,t,15,8,q),v.exports.deflateInit2=vv,v.exports.deflateReset=m,v.exports.deflateResetKeep=T,v.exports.deflateSetHeader=(v,y)=>v&&v.state?2!==v.state.wrap?E:(v.state.gzhead=y,c):E,v.exports.deflate=(v,y)=>{let n,B;if(!v||!v.state||y>g||y<0)return v?k(v,E):E;const P=v.state;if(!v.output||!v.input&&0!==v.avail_in||P.status===w&&y!==i)return k(v,0===v.avail_out?s:E);P.strm=v;const l=P.last_flush;if(P.last_flush=y,42===P.status)if(2===P.wrap)v.adler=0,H(P,31),H(P,139),H(P,8),P.gzhead?(H(P,(P.gzhead.text?1:0)+(P.gzhead.hcrc?2:0)+(P.gzhead.extra?4:0)+(P.gzhead.name?8:0)+(P.gzhead.comment?16:0)),H(P,255&P.gzhead.time),H(P,P.gzhead.time>>8&255),H(P,P.gzhead.time>>16&255),H(P,P.gzhead.time>>24&255),H(P,9===P.level?2:P.strategy>=u||P.level<2?4:0),H(P,255&P.gzhead.os),P.gzhead.extra&&P.gzhead.extra.length&&(H(P,255&P.gzhead.extra.length),H(P,P.gzhead.extra.length>>8&255)),P.gzhead.hcrc&&(v.adler=a(v.adler,P.pending_buf,P.pending,0)),P.gzindex=0,P.status=69):(H(P,0),H(P,0),H(P,0),H(P,0),H(P,0),H(P,9===P.level?2:P.strategy>=u||P.level<2?4:0),H(P,3),P.status=S);else{let y=t+(P.w_bits-8<<4)<<8,n=-1;n=P.strategy>=u||P.level<2?0:P.level<6?1:6===P.level?2:3,y|=n<<6,0!==P.strstart&&(y|=32),y+=31-y%31,P.status=S,A(P,y),0!==P.strstart&&(A(P,v.adler>>>16),A(P,65535&v.adler)),v.adler=1}if(69===P.status)if(P.gzhead.extra){for(n=P.pending;P.gzindex<(65535&P.gzhead.extra.length)&&(P.pending!==P.pending_buf_size||(P.gzhead.hcrc&&P.pending>n&&(v.adler=a(v.adler,P.pending_buf,P.pending-n,n)),V(v),n=P.pending,P.pending!==P.pending_buf_size));)H(P,255&P.gzhead.extra[P.gzindex]),P.gzindex++;P.gzhead.hcrc&&P.pending>n&&(v.adler=a(v.adler,P.pending_buf,P.pending-n,n)),P.gzindex===P.gzhead.extra.length&&(P.gzindex=0,P.status=73)}else P.status=73;if(73===P.status)if(P.gzhead.name){n=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>n&&(v.adler=a(v.adler,P.pending_buf,P.pending-n,n)),V(v),n=P.pending,P.pending===P.pending_buf_size)){B=1;break}B=P.gzindex<P.gzhead.name.length?255&P.gzhead.name.charCodeAt(P.gzindex++):0,H(P,B)}while(0!==B);P.gzhead.hcrc&&P.pending>n&&(v.adler=a(v.adler,P.pending_buf,P.pending-n,n)),0===B&&(P.gzindex=0,P.status=91)}else P.status=91;if(91===P.status)if(P.gzhead.comment){n=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>n&&(v.adler=a(v.adler,P.pending_buf,P.pending-n,n)),V(v),n=P.pending,P.pending===P.pending_buf_size)){B=1;break}B=P.gzindex<P.gzhead.comment.length?255&P.gzhead.comment.charCodeAt(P.gzindex++):0,H(P,B)}while(0!==B);P.gzhead.hcrc&&P.pending>n&&(v.adler=a(v.adler,P.pending_buf,P.pending-n,n)),0===B&&(P.status=F)}else P.status=F;if(P.status===F&&(P.gzhead.hcrc?(P.pending+2>P.pending_buf_size&&V(v),P.pending+2<=P.pending_buf_size&&(H(P,255&v.adler),H(P,v.adler>>8&255),v.adler=0,P.status=S)):P.status=S),0!==P.pending){if(V(v),0===v.avail_out)return P.last_flush=-1,c}else if(0===v.avail_in&&M(y)<=M(l)&&y!==i)return k(v,s);if(P.status===w&&0!==v.avail_in)return k(v,s);if(0!==v.avail_in||0!==P.lookahead||y!==x&&P.status!==w){let n=P.strategy===u?((v,y)=>{let n;for(;;){if(0===v.lookahead&&(z(v),0===v.lookahead)){if(y===x)return 1;break}if(v.match_length=0,n=b(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++,n&&(p(v,!1),0===v.strm.avail_out))return 1}return v.insert=0,y===i?(p(v,!0),0===v.strm.avail_out?3:4):v.last_lit&&(p(v,!1),0===v.strm.avail_out)?1:2})(P,y):P.strategy===O?((v,y)=>{let n,B,J,P;const Y=v.window;for(;;){if(v.lookahead<=G){if(z(v),v.lookahead<=G&&y===x)return 1;if(0===v.lookahead)break}if(v.match_length=0,v.lookahead>=3&&v.strstart>0&&(J=v.strstart-1,B=Y[J],B===Y[++J]&&B===Y[++J]&&B===Y[++J])){P=v.strstart+G;do{}while(B===Y[++J]&&B===Y[++J]&&B===Y[++J]&&B===Y[++J]&&B===Y[++J]&&B===Y[++J]&&B===Y[++J]&&B===Y[++J]&&J<P);v.match_length=G-(P-J),v.match_length>v.lookahead&&(v.match_length=v.lookahead)}if(v.match_length>=3?(n=b(v,1,v.match_length-3),v.lookahead-=v.match_length,v.strstart+=v.match_length,v.match_length=0):(n=b(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++),n&&(p(v,!1),0===v.strm.avail_out))return 1}return v.insert=0,y===i?(p(v,!0),0===v.strm.avail_out?3:4):v.last_lit&&(p(v,!1),0===v.strm.avail_out)?1:2})(P,y):Q[P.level].func(P,y);if(3!==n&&4!==n||(P.status=w),1===n||3===n)return 0===v.avail_out&&(P.last_flush=-1),c;if(2===n&&(y===f?Y(P):y!==g&&(J(P,0,0,!1),y===N&&(I(P.head),0===P.lookahead&&(P.strstart=0,P.block_start=0,P.insert=0))),V(v),0===v.avail_out))return P.last_flush=-1,c}return y!==i?c:P.wrap<=0?h:(2===P.wrap?(H(P,255&v.adler),H(P,v.adler>>8&255),H(P,v.adler>>16&255),H(P,v.adler>>24&255),H(P,255&v.total_in),H(P,v.total_in>>8&255),H(P,v.total_in>>16&255),H(P,v.total_in>>24&255)):(A(P,v.adler>>>16),A(P,65535&v.adler)),V(v),P.wrap>0&&(P.wrap=-P.wrap),0!==P.pending?c:h)},v.exports.deflateEnd=v=>{if(!v||!v.state)return E;const y=v.state.status;return 42!==y&&69!==y&&73!==y&&91!==y&&y!==F&&y!==S&&y!==w?k(v,E):(v.state=null,y===S?k(v,W):c)},v.exports.deflateSetDictionary=(v,y)=>{let n=y.length;if(!v||!v.state)return E;const B=v.state,J=B.wrap;if(2===J||1===J&&42!==B.status||B.lookahead)return E;if(1===J&&(v.adler=l(v.adler,y,n,0)),B.wrap=0,n>=B.w_size){0===J&&(I(B.head),B.strstart=0,B.block_start=0,B.insert=0);let v=new Uint8Array(B.w_size);v.set(y.subarray(n-B.w_size,n),0),y=v,n=B.w_size}const P=v.avail_in,b=v.next_in,Y=v.input;for(v.avail_in=n,v.next_in=0,v.input=y,z(B);B.lookahead>=3;){let v=B.strstart,y=B.lookahead-2;do{B.ins_h=j(B,B.ins_h,B.window[v+3-1]),B.prev[v&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=v,v++}while(--y);B.strstart=v,B.lookahead=2,z(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=2,B.match_available=0,v.next_in=b,v.input=Y,v.avail_in=P,B.wrap=J,c},v.exports.deflateInfo="pako deflate (from Nodeca project)"},11006:v=>{"use strict";v.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},10997:v=>{"use strict";v.exports=function(v,y){let n,B,J,P,b,Y,l,a,Z,x,f,N,i,g,c,h,E,W,s,C,r,u,O,d;const q=v.state;n=v.next_in,O=v.input,B=n+(v.avail_in-5),J=v.next_out,d=v.output,P=J-(y-v.avail_out),b=J+(v.avail_out-257),Y=q.dmax,l=q.wsize,a=q.whave,Z=q.wnext,x=q.window,f=q.hold,N=q.bits,i=q.lencode,g=q.distcode,c=(1<<q.lenbits)-1,h=(1<<q.distbits)-1;v:do{N<15&&(f+=O[n++]<<N,N+=8,f+=O[n++]<<N,N+=8),E=i[f&c];y:for(;;){if(W=E>>>24,f>>>=W,N-=W,W=E>>>16&255,0===W)d[J++]=65535&E;else{if(!(16&W)){if(0===(64&W)){E=i[(65535&E)+(f&(1<<W)-1)];continue y}if(32&W){q.mode=12;break v}v.msg="invalid literal/length code",q.mode=30;break v}s=65535&E,W&=15,W&&(N<W&&(f+=O[n++]<<N,N+=8),s+=f&(1<<W)-1,f>>>=W,N-=W),N<15&&(f+=O[n++]<<N,N+=8,f+=O[n++]<<N,N+=8),E=g[f&h];n:for(;;){if(W=E>>>24,f>>>=W,N-=W,W=E>>>16&255,!(16&W)){if(0===(64&W)){E=g[(65535&E)+(f&(1<<W)-1)];continue n}v.msg="invalid distance code",q.mode=30;break v}if(C=65535&E,W&=15,N<W&&(f+=O[n++]<<N,N+=8,N<W&&(f+=O[n++]<<N,N+=8)),C+=f&(1<<W)-1,C>Y){v.msg="invalid distance too far back",q.mode=30;break v}if(f>>>=W,N-=W,W=J-P,C>W){if(W=C-W,W>a&&q.sane){v.msg="invalid distance too far back",q.mode=30;break v}if(r=0,u=x,0===Z){if(r+=l-W,W<s){s-=W;do{d[J++]=x[r++]}while(--W);r=J-C,u=d}}else if(Z<W){if(r+=l+Z-W,W-=Z,W<s){s-=W;do{d[J++]=x[r++]}while(--W);if(r=0,Z<s){W=Z,s-=W;do{d[J++]=x[r++]}while(--W);r=J-C,u=d}}}else if(r+=Z-W,W<s){s-=W;do{d[J++]=x[r++]}while(--W);r=J-C,u=d}for(;s>2;)d[J++]=u[r++],d[J++]=u[r++],d[J++]=u[r++],s-=3;s&&(d[J++]=u[r++],s>1&&(d[J++]=u[r++]))}else{r=J-C;do{d[J++]=d[r++],d[J++]=d[r++],d[J++]=d[r++],s-=3}while(s>2);s&&(d[J++]=d[r++],s>1&&(d[J++]=d[r++]))}break}}break}}while(n<B&&J<b);s=N>>3,n-=s,N-=s<<3,f&=(1<<N)-1,v.next_in=n,v.next_out=J,v.avail_in=n<B?B-n+5:5-(n-B),v.avail_out=J<b?b-J+257:257-(J-b),q.hold=f,q.bits=N}},10991:(v,y,n)=>{"use strict";const B=n(10948),J=n(10951),P=n(10997),b=n(11004),{Z_FINISH:Y,Z_BLOCK:l,Z_TREES:a,Z_OK:Z,Z_STREAM_END:x,Z_NEED_DICT:f,Z_STREAM_ERROR:N,Z_DATA_ERROR:i,Z_MEM_ERROR:g,Z_BUF_ERROR:c,Z_DEFLATED:h}=n(10958),E=12,W=30,s=v=>(v>>>24&255)+(v>>>8&65280)+((65280&v)<<8)+((255&v)<<24);function C(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const r=v=>{if(!v||!v.state)return N;const y=v.state;return v.total_in=v.total_out=y.total=0,v.msg="",y.wrap&&(v.adler=1&y.wrap),y.mode=1,y.last=0,y.havedict=0,y.dmax=32768,y.head=null,y.hold=0,y.bits=0,y.lencode=y.lendyn=new Int32Array(852),y.distcode=y.distdyn=new Int32Array(592),y.sane=1,y.back=-1,Z},u=v=>{if(!v||!v.state)return N;const y=v.state;return y.wsize=0,y.whave=0,y.wnext=0,r(v)},O=(v,y)=>{let n;if(!v||!v.state)return N;const B=v.state;return y<0?(n=0,y=-y):(n=1+(y>>4),y<48&&(y&=15)),y&&(y<8||y>15)?N:(null!==B.window&&B.wbits!==y&&(B.window=null),B.wrap=n,B.wbits=y,u(v))},d=(v,y)=>{if(!v)return N;const n=new C;v.state=n,n.window=null;const B=O(v,y);return B!==Z&&(v.state=null),B};let q,L,t=!0;const G=v=>{if(t){q=new Int32Array(512),L=new Int32Array(32);let y=0;for(;y<144;)v.lens[y++]=8;for(;y<256;)v.lens[y++]=9;for(;y<280;)v.lens[y++]=7;for(;y<288;)v.lens[y++]=8;for(b(1,v.lens,0,288,q,0,v.work,{bits:9}),y=0;y<32;)v.lens[y++]=5;b(2,v.lens,0,32,L,0,v.work,{bits:5}),t=!1}v.lencode=q,v.lenbits=9,v.distcode=L,v.distbits=5},R=(v,y,n,B)=>{let J;const P=v.state;return null===P.window&&(P.wsize=1<<P.wbits,P.wnext=0,P.whave=0,P.window=new Uint8Array(P.wsize)),B>=P.wsize?(P.window.set(y.subarray(n-P.wsize,n),0),P.wnext=0,P.whave=P.wsize):(J=P.wsize-P.wnext,J>B&&(J=B),P.window.set(y.subarray(n-B,n-B+J),P.wnext),(B-=J)?(P.window.set(y.subarray(n-B,n),0),P.wnext=B,P.whave=P.wsize):(P.wnext+=J,P.wnext===P.wsize&&(P.wnext=0),P.whave<P.wsize&&(P.whave+=J))),0};v.exports.inflateReset=u,v.exports.inflateReset2=O,v.exports.inflateResetKeep=r,v.exports.inflateInit=v=>d(v,15),v.exports.inflateInit2=d,v.exports.inflate=(v,y)=>{let n,C,r,u,O,d,q,L,t,F,S,w,k,M,I,j,V,p,H,A,X,U,z=0;const e=new Uint8Array(4);let K,D;const Q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!v||!v.state||!v.output||!v.input&&0!==v.avail_in)return N;n=v.state,n.mode===E&&(n.mode=13),O=v.next_out,r=v.output,q=v.avail_out,u=v.next_in,C=v.input,d=v.avail_in,L=n.hold,t=n.bits,F=d,S=q,U=Z;v:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;t<16;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}if(2&n.wrap&&35615===L){n.check=0,e[0]=255&L,e[1]=L>>>8&255,n.check=J(n.check,e,2,0),L=0,t=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&L)<<8)+(L>>8))%31){v.msg="incorrect header check",n.mode=W;break}if((15&L)!==h){v.msg="unknown compression method",n.mode=W;break}if(L>>>=4,t-=4,X=8+(15&L),0===n.wbits)n.wbits=X;else if(X>n.wbits){v.msg="invalid window size",n.mode=W;break}n.dmax=1<<n.wbits,v.adler=n.check=1,n.mode=512&L?10:E,L=0,t=0;break;case 2:for(;t<16;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}if(n.flags=L,(255&n.flags)!==h){v.msg="unknown compression method",n.mode=W;break}if(57344&n.flags){v.msg="unknown header flags set",n.mode=W;break}n.head&&(n.head.text=L>>8&1),512&n.flags&&(e[0]=255&L,e[1]=L>>>8&255,n.check=J(n.check,e,2,0)),L=0,t=0,n.mode=3;case 3:for(;t<32;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}n.head&&(n.head.time=L),512&n.flags&&(e[0]=255&L,e[1]=L>>>8&255,e[2]=L>>>16&255,e[3]=L>>>24&255,n.check=J(n.check,e,4,0)),L=0,t=0,n.mode=4;case 4:for(;t<16;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}n.head&&(n.head.xflags=255&L,n.head.os=L>>8),512&n.flags&&(e[0]=255&L,e[1]=L>>>8&255,n.check=J(n.check,e,2,0)),L=0,t=0,n.mode=5;case 5:if(1024&n.flags){for(;t<16;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}n.length=L,n.head&&(n.head.extra_len=L),512&n.flags&&(e[0]=255&L,e[1]=L>>>8&255,n.check=J(n.check,e,2,0)),L=0,t=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(w=n.length,w>d&&(w=d),w&&(n.head&&(X=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(C.subarray(u,u+w),X)),512&n.flags&&(n.check=J(n.check,C,w,u)),d-=w,u+=w,n.length-=w),n.length))break v;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===d)break v;w=0;do{X=C[u+w++],n.head&&X&&n.length<65536&&(n.head.name+=String.fromCharCode(X))}while(X&&w<d);if(512&n.flags&&(n.check=J(n.check,C,w,u)),d-=w,u+=w,X)break v}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===d)break v;w=0;do{X=C[u+w++],n.head&&X&&n.length<65536&&(n.head.comment+=String.fromCharCode(X))}while(X&&w<d);if(512&n.flags&&(n.check=J(n.check,C,w,u)),d-=w,u+=w,X)break v}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;t<16;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}if(L!==(65535&n.check)){v.msg="header crc mismatch",n.mode=W;break}L=0,t=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),v.adler=n.check=0,n.mode=E;break;case 10:for(;t<32;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}v.adler=n.check=s(L),L=0,t=0,n.mode=11;case 11:if(0===n.havedict)return v.next_out=O,v.avail_out=q,v.next_in=u,v.avail_in=d,n.hold=L,n.bits=t,f;v.adler=n.check=1,n.mode=E;case E:if(y===l||y===a)break v;case 13:if(n.last){L>>>=7&t,t-=7&t,n.mode=27;break}for(;t<3;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}switch(n.last=1&L,L>>>=1,t-=1,3&L){case 0:n.mode=14;break;case 1:if(G(n),n.mode=20,y===a){L>>>=2,t-=2;break v}break;case 2:n.mode=17;break;case 3:v.msg="invalid block type",n.mode=W}L>>>=2,t-=2;break;case 14:for(L>>>=7&t,t-=7&t;t<32;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}if((65535&L)!==(L>>>16^65535)){v.msg="invalid stored block lengths",n.mode=W;break}if(n.length=65535&L,L=0,t=0,n.mode=15,y===a)break v;case 15:n.mode=16;case 16:if(w=n.length,w){if(w>d&&(w=d),w>q&&(w=q),0===w)break v;r.set(C.subarray(u,u+w),O),d-=w,u+=w,q-=w,O+=w,n.length-=w;break}n.mode=E;break;case 17:for(;t<14;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}if(n.nlen=257+(31&L),L>>>=5,t-=5,n.ndist=1+(31&L),L>>>=5,t-=5,n.ncode=4+(15&L),L>>>=4,t-=4,n.nlen>286||n.ndist>30){v.msg="too many length or distance symbols",n.mode=W;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;t<3;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}n.lens[Q[n.have++]]=7&L,L>>>=3,t-=3}for(;n.have<19;)n.lens[Q[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,K={bits:n.lenbits},U=b(0,n.lens,0,19,n.lencode,0,n.work,K),n.lenbits=K.bits,U){v.msg="invalid code lengths set",n.mode=W;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;z=n.lencode[L&(1<<n.lenbits)-1],I=z>>>24,j=z>>>16&255,V=65535&z,!(I<=t);){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}if(V<16)L>>>=I,t-=I,n.lens[n.have++]=V;else{if(16===V){for(D=I+2;t<D;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}if(L>>>=I,t-=I,0===n.have){v.msg="invalid bit length repeat",n.mode=W;break}X=n.lens[n.have-1],w=3+(3&L),L>>>=2,t-=2}else if(17===V){for(D=I+3;t<D;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}L>>>=I,t-=I,X=0,w=3+(7&L),L>>>=3,t-=3}else{for(D=I+7;t<D;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}L>>>=I,t-=I,X=0,w=11+(127&L),L>>>=7,t-=7}if(n.have+w>n.nlen+n.ndist){v.msg="invalid bit length repeat",n.mode=W;break}for(;w--;)n.lens[n.have++]=X}}if(n.mode===W)break;if(0===n.lens[256]){v.msg="invalid code -- missing end-of-block",n.mode=W;break}if(n.lenbits=9,K={bits:n.lenbits},U=b(1,n.lens,0,n.nlen,n.lencode,0,n.work,K),n.lenbits=K.bits,U){v.msg="invalid literal/lengths set",n.mode=W;break}if(n.distbits=6,n.distcode=n.distdyn,K={bits:n.distbits},U=b(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,K),n.distbits=K.bits,U){v.msg="invalid distances set",n.mode=W;break}if(n.mode=20,y===a)break v;case 20:n.mode=21;case 21:if(d>=6&&q>=258){v.next_out=O,v.avail_out=q,v.next_in=u,v.avail_in=d,n.hold=L,n.bits=t,P(v,S),O=v.next_out,r=v.output,q=v.avail_out,u=v.next_in,C=v.input,d=v.avail_in,L=n.hold,t=n.bits,n.mode===E&&(n.back=-1);break}for(n.back=0;z=n.lencode[L&(1<<n.lenbits)-1],I=z>>>24,j=z>>>16&255,V=65535&z,!(I<=t);){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}if(j&&0===(240&j)){for(p=I,H=j,A=V;z=n.lencode[A+((L&(1<<p+H)-1)>>p)],I=z>>>24,j=z>>>16&255,V=65535&z,!(p+I<=t);){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}L>>>=p,t-=p,n.back+=p}if(L>>>=I,t-=I,n.back+=I,n.length=V,0===j){n.mode=26;break}if(32&j){n.back=-1,n.mode=E;break}if(64&j){v.msg="invalid literal/length code",n.mode=W;break}n.extra=15&j,n.mode=22;case 22:if(n.extra){for(D=n.extra;t<D;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}n.length+=L&(1<<n.extra)-1,L>>>=n.extra,t-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;z=n.distcode[L&(1<<n.distbits)-1],I=z>>>24,j=z>>>16&255,V=65535&z,!(I<=t);){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}if(0===(240&j)){for(p=I,H=j,A=V;z=n.distcode[A+((L&(1<<p+H)-1)>>p)],I=z>>>24,j=z>>>16&255,V=65535&z,!(p+I<=t);){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}L>>>=p,t-=p,n.back+=p}if(L>>>=I,t-=I,n.back+=I,64&j){v.msg="invalid distance code",n.mode=W;break}n.offset=V,n.extra=15&j,n.mode=24;case 24:if(n.extra){for(D=n.extra;t<D;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}n.offset+=L&(1<<n.extra)-1,L>>>=n.extra,t-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){v.msg="invalid distance too far back",n.mode=W;break}n.mode=25;case 25:if(0===q)break v;if(w=S-q,n.offset>w){if(w=n.offset-w,w>n.whave&&n.sane){v.msg="invalid distance too far back",n.mode=W;break}w>n.wnext?(w-=n.wnext,k=n.wsize-w):k=n.wnext-w,w>n.length&&(w=n.length),M=n.window}else M=r,k=O-n.offset,w=n.length;w>q&&(w=q),q-=w,n.length-=w;do{r[O++]=M[k++]}while(--w);0===n.length&&(n.mode=21);break;case 26:if(0===q)break v;r[O++]=n.length,q--,n.mode=21;break;case 27:if(n.wrap){for(;t<32;){if(0===d)break v;d--,L|=C[u++]<<t,t+=8}if(S-=q,v.total_out+=S,n.total+=S,S&&(v.adler=n.check=n.flags?J(n.check,r,S,O-S):B(n.check,r,S,O-S)),S=q,(n.flags?L:s(L))!==n.check){v.msg="incorrect data check",n.mode=W;break}L=0,t=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;t<32;){if(0===d)break v;d--,L+=C[u++]<<t,t+=8}if(L!==(4294967295&n.total)){v.msg="incorrect length check",n.mode=W;break}L=0,t=0}n.mode=29;case 29:U=x;break v;case W:U=i;break v;case 31:return g;default:return N}return v.next_out=O,v.avail_out=q,v.next_in=u,v.avail_in=d,n.hold=L,n.bits=t,(n.wsize||S!==v.avail_out&&n.mode<W&&(n.mode<27||y!==Y))&&R(v,v.output,v.next_out,S-v.avail_out)?(n.mode=31,g):(F-=v.avail_in,S-=v.avail_out,v.total_in+=F,v.total_out+=S,n.total+=S,n.wrap&&S&&(v.adler=n.check=n.flags?J(n.check,r,S,v.next_out-S):B(n.check,r,S,v.next_out-S)),v.data_type=n.bits+(n.last?64:0)+(n.mode===E?128:0)+(20===n.mode||15===n.mode?256:0),(0===F&&0===S||y===Y)&&U===Z&&(U=c),U)},v.exports.inflateEnd=v=>{if(!v||!v.state)return N;let y=v.state;return y.window&&(y.window=null),v.state=null,Z},v.exports.inflateGetHeader=(v,y)=>{if(!v||!v.state)return N;const n=v.state;return 0===(2&n.wrap)?N:(n.head=y,y.done=!1,Z)},v.exports.inflateSetDictionary=(v,y)=>{const n=y.length;let J,P,b;return v&&v.state?(J=v.state,0!==J.wrap&&11!==J.mode?N:11===J.mode&&(P=1,P=B(P,y,n,0),P!==J.check)?i:(b=R(v,y,n,n),b?(J.mode=31,g):(J.havedict=1,Z))):N},v.exports.inflateInfo="pako inflate (from Nodeca project)"},11004:v=>{"use strict";const y=15,n=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),B=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),J=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),P=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);v.exports=(v,b,Y,l,a,Z,x,f)=>{const N=f.bits;let i,g,c,h,E,W,s=0,C=0,r=0,u=0,O=0,d=0,q=0,L=0,t=0,G=0,R=null,F=0;const S=new Uint16Array(16),w=new Uint16Array(16);let k,M,I,j=null,V=0;for(s=0;s<=y;s++)S[s]=0;for(C=0;C<l;C++)S[b[Y+C]]++;for(O=N,u=y;u>=1&&0===S[u];u--);if(O>u&&(O=u),0===u)return a[Z++]=20971520,a[Z++]=20971520,f.bits=1,0;for(r=1;r<u&&0===S[r];r++);for(O<r&&(O=r),L=1,s=1;s<=y;s++)if(L<<=1,L-=S[s],L<0)return-1;if(L>0&&(0===v||1!==u))return-1;for(w[1]=0,s=1;s<y;s++)w[s+1]=w[s]+S[s];for(C=0;C<l;C++)0!==b[Y+C]&&(x[w[b[Y+C]]++]=C);if(0===v?(R=j=x,W=19):1===v?(R=n,F-=257,j=B,V-=257,W=256):(R=J,j=P,W=-1),G=0,C=0,s=r,E=Z,d=O,q=0,c=-1,t=1<<O,h=t-1,1===v&&t>852||2===v&&t>592)return 1;for(;;){k=s-q,x[C]<W?(M=0,I=x[C]):x[C]>W?(M=j[V+x[C]],I=R[F+x[C]]):(M=96,I=0),i=1<<s-q,g=1<<d,r=g;do{g-=i,a[E+(G>>q)+g]=k<<24|M<<16|I}while(0!==g);for(i=1<<s-1;G&i;)i>>=1;if(0!==i?(G&=i-1,G+=i):G=0,C++,0===--S[s]){if(s===u)break;s=b[Y+x[C]]}if(s>O&&(G&h)!==c){for(0===q&&(q=O),E+=r,d=s-q,L=1<<d;d+q<u&&(L-=S[d+q],!(L<=0));)d++,L<<=1;if(t+=1<<d,1===v&&t>852||2===v&&t>592)return 1;c=G&h,a[c]=O<<24|d<<16|E-Z}}return 0!==G&&(a[E+G]=s-q<<24|64<<16),f.bits=O,0}},10954:v=>{"use strict";v.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},10946:v=>{"use strict";function y(v){let y=v.length;for(;--y>=0;)v[y]=0}const n=256,B=286,J=30,P=15,b=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Y=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),l=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),a=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Z=new Array(576);y(Z);const x=new Array(60);y(x);const f=new Array(512);y(f);const N=new Array(256);y(N);const i=new Array(29);y(i);const g=new Array(J);function c(v,y,n,B,J){this.static_tree=v,this.extra_bits=y,this.extra_base=n,this.elems=B,this.max_length=J,this.has_stree=v&&v.length}let h,E,W;function s(v,y){this.dyn_tree=v,this.max_code=0,this.stat_desc=y}y(g);const C=v=>v<256?f[v]:f[256+(v>>>7)],r=(v,y)=>{v.pending_buf[v.pending++]=255&y,v.pending_buf[v.pending++]=y>>>8&255},u=(v,y,n)=>{v.bi_valid>16-n?(v.bi_buf|=y<<v.bi_valid&65535,r(v,v.bi_buf),v.bi_buf=y>>16-v.bi_valid,v.bi_valid+=n-16):(v.bi_buf|=y<<v.bi_valid&65535,v.bi_valid+=n)},O=(v,y,n)=>{u(v,n[2*y],n[2*y+1])},d=(v,y)=>{let n=0;do{n|=1&v,v>>>=1,n<<=1}while(--y>0);return n>>>1},q=(v,y,n)=>{const B=new Array(16);let J,b,Y=0;for(J=1;J<=P;J++)B[J]=Y=Y+n[J-1]<<1;for(b=0;b<=y;b++){let y=v[2*b+1];0!==y&&(v[2*b]=d(B[y]++,y))}},L=v=>{let y;for(y=0;y<B;y++)v.dyn_ltree[2*y]=0;for(y=0;y<J;y++)v.dyn_dtree[2*y]=0;for(y=0;y<19;y++)v.bl_tree[2*y]=0;v.dyn_ltree[512]=1,v.opt_len=v.static_len=0,v.last_lit=v.matches=0},t=v=>{v.bi_valid>8?r(v,v.bi_buf):v.bi_valid>0&&(v.pending_buf[v.pending++]=v.bi_buf),v.bi_buf=0,v.bi_valid=0},G=(v,y,n,B)=>{const J=2*y,P=2*n;return v[J]<v[P]||v[J]===v[P]&&B[y]<=B[n]},R=(v,y,n)=>{const B=v.heap[n];let J=n<<1;for(;J<=v.heap_len&&(J<v.heap_len&&G(y,v.heap[J+1],v.heap[J],v.depth)&&J++,!G(y,B,v.heap[J],v.depth));)v.heap[n]=v.heap[J],n=J,J<<=1;v.heap[n]=B},F=(v,y,B)=>{let J,P,l,a,Z=0;if(0!==v.last_lit)do{J=v.pending_buf[v.d_buf+2*Z]<<8|v.pending_buf[v.d_buf+2*Z+1],P=v.pending_buf[v.l_buf+Z],Z++,0===J?O(v,P,y):(l=N[P],O(v,l+n+1,y),a=b[l],0!==a&&(P-=i[l],u(v,P,a)),J--,l=C(J),O(v,l,B),a=Y[l],0!==a&&(J-=g[l],u(v,J,a)))}while(Z<v.last_lit);O(v,256,y)},S=(v,y)=>{const n=y.dyn_tree,B=y.stat_desc.static_tree,J=y.stat_desc.has_stree,b=y.stat_desc.elems;let Y,l,a,Z=-1;for(v.heap_len=0,v.heap_max=573,Y=0;Y<b;Y++)0!==n[2*Y]?(v.heap[++v.heap_len]=Z=Y,v.depth[Y]=0):n[2*Y+1]=0;for(;v.heap_len<2;)a=v.heap[++v.heap_len]=Z<2?++Z:0,n[2*a]=1,v.depth[a]=0,v.opt_len--,J&&(v.static_len-=B[2*a+1]);for(y.max_code=Z,Y=v.heap_len>>1;Y>=1;Y--)R(v,n,Y);a=b;do{Y=v.heap[1],v.heap[1]=v.heap[v.heap_len--],R(v,n,1),l=v.heap[1],v.heap[--v.heap_max]=Y,v.heap[--v.heap_max]=l,n[2*a]=n[2*Y]+n[2*l],v.depth[a]=(v.depth[Y]>=v.depth[l]?v.depth[Y]:v.depth[l])+1,n[2*Y+1]=n[2*l+1]=a,v.heap[1]=a++,R(v,n,1)}while(v.heap_len>=2);v.heap[--v.heap_max]=v.heap[1],((v,y)=>{const n=y.dyn_tree,B=y.max_code,J=y.stat_desc.static_tree,b=y.stat_desc.has_stree,Y=y.stat_desc.extra_bits,l=y.stat_desc.extra_base,a=y.stat_desc.max_length;let Z,x,f,N,i,g,c=0;for(N=0;N<=P;N++)v.bl_count[N]=0;for(n[2*v.heap[v.heap_max]+1]=0,Z=v.heap_max+1;Z<573;Z++)x=v.heap[Z],N=n[2*n[2*x+1]+1]+1,N>a&&(N=a,c++),n[2*x+1]=N,x>B||(v.bl_count[N]++,i=0,x>=l&&(i=Y[x-l]),g=n[2*x],v.opt_len+=g*(N+i),b&&(v.static_len+=g*(J[2*x+1]+i)));if(0!==c){do{for(N=a-1;0===v.bl_count[N];)N--;v.bl_count[N]--,v.bl_count[N+1]+=2,v.bl_count[a]--,c-=2}while(c>0);for(N=a;0!==N;N--)for(x=v.bl_count[N];0!==x;)f=v.heap[--Z],f>B||(n[2*f+1]!==N&&(v.opt_len+=(N-n[2*f+1])*n[2*f],n[2*f+1]=N),x--)}})(v,y),q(n,Z,v.bl_count)},w=(v,y,n)=>{let B,J,P=-1,b=y[1],Y=0,l=7,a=4;for(0===b&&(l=138,a=3),y[2*(n+1)+1]=65535,B=0;B<=n;B++)J=b,b=y[2*(B+1)+1],++Y<l&&J===b||(Y<a?v.bl_tree[2*J]+=Y:0!==J?(J!==P&&v.bl_tree[2*J]++,v.bl_tree[32]++):Y<=10?v.bl_tree[34]++:v.bl_tree[36]++,Y=0,P=J,0===b?(l=138,a=3):J===b?(l=6,a=3):(l=7,a=4))},k=(v,y,n)=>{let B,J,P=-1,b=y[1],Y=0,l=7,a=4;for(0===b&&(l=138,a=3),B=0;B<=n;B++)if(J=b,b=y[2*(B+1)+1],!(++Y<l&&J===b)){if(Y<a)do{O(v,J,v.bl_tree)}while(0!==--Y);else 0!==J?(J!==P&&(O(v,J,v.bl_tree),Y--),O(v,16,v.bl_tree),u(v,Y-3,2)):Y<=10?(O(v,17,v.bl_tree),u(v,Y-3,3)):(O(v,18,v.bl_tree),u(v,Y-11,7));Y=0,P=J,0===b?(l=138,a=3):J===b?(l=6,a=3):(l=7,a=4)}};let M=!1;const I=(v,y,n,B)=>{u(v,0+(B?1:0),3),((v,y,n,B)=>{t(v),B&&(r(v,n),r(v,~n)),v.pending_buf.set(v.window.subarray(y,y+n),v.pending),v.pending+=n})(v,y,n,!0)};v.exports._tr_init=v=>{M||((()=>{let v,y,n,a,s;const C=new Array(16);for(n=0,a=0;a<28;a++)for(i[a]=n,v=0;v<1<<b[a];v++)N[n++]=a;for(N[n-1]=a,s=0,a=0;a<16;a++)for(g[a]=s,v=0;v<1<<Y[a];v++)f[s++]=a;for(s>>=7;a<J;a++)for(g[a]=s<<7,v=0;v<1<<Y[a]-7;v++)f[256+s++]=a;for(y=0;y<=P;y++)C[y]=0;for(v=0;v<=143;)Z[2*v+1]=8,v++,C[8]++;for(;v<=255;)Z[2*v+1]=9,v++,C[9]++;for(;v<=279;)Z[2*v+1]=7,v++,C[7]++;for(;v<=287;)Z[2*v+1]=8,v++,C[8]++;for(q(Z,287,C),v=0;v<J;v++)x[2*v+1]=5,x[2*v]=d(v,5);h=new c(Z,b,257,B,P),E=new c(x,Y,0,J,P),W=new c(new Array(0),l,0,19,7)})(),M=!0),v.l_desc=new s(v.dyn_ltree,h),v.d_desc=new s(v.dyn_dtree,E),v.bl_desc=new s(v.bl_tree,W),v.bi_buf=0,v.bi_valid=0,L(v)},v.exports._tr_stored_block=I,v.exports._tr_flush_block=(v,y,B,J)=>{let P,b,Y=0;v.level>0?(2===v.strm.data_type&&(v.strm.data_type=(v=>{let y,B=4093624447;for(y=0;y<=31;y++,B>>>=1)if(1&B&&0!==v.dyn_ltree[2*y])return 0;if(0!==v.dyn_ltree[18]||0!==v.dyn_ltree[20]||0!==v.dyn_ltree[26])return 1;for(y=32;y<n;y++)if(0!==v.dyn_ltree[2*y])return 1;return 0})(v)),S(v,v.l_desc),S(v,v.d_desc),Y=(v=>{let y;for(w(v,v.dyn_ltree,v.l_desc.max_code),w(v,v.dyn_dtree,v.d_desc.max_code),S(v,v.bl_desc),y=18;y>=3&&0===v.bl_tree[2*a[y]+1];y--);return v.opt_len+=3*(y+1)+5+5+4,y})(v),P=v.opt_len+3+7>>>3,b=v.static_len+3+7>>>3,b<=P&&(P=b)):P=b=B+5,B+4<=P&&-1!==y?I(v,y,B,J):4===v.strategy||b===P?(u(v,2+(J?1:0),3),F(v,Z,x)):(u(v,4+(J?1:0),3),((v,y,n,B)=>{let J;for(u(v,y-257,5),u(v,n-1,5),u(v,B-4,4),J=0;J<B;J++)u(v,v.bl_tree[2*a[J]+1],3);k(v,v.dyn_ltree,y-1),k(v,v.dyn_dtree,n-1)})(v,v.l_desc.max_code+1,v.d_desc.max_code+1,Y+1),F(v,v.dyn_ltree,v.dyn_dtree)),L(v),J&&t(v)},v.exports._tr_tally=(v,y,B)=>(v.pending_buf[v.d_buf+2*v.last_lit]=y>>>8&255,v.pending_buf[v.d_buf+2*v.last_lit+1]=255&y,v.pending_buf[v.l_buf+v.last_lit]=255&B,v.last_lit++,0===y?v.dyn_ltree[2*B]++:(v.matches++,y--,v.dyn_ltree[2*(N[B]+n+1)]++,v.dyn_dtree[2*C(y)]++),v.last_lit===v.lit_bufsize-1),v.exports._tr_align=v=>{u(v,2,3),O(v,256,Z),(v=>{16===v.bi_valid?(r(v,v.bi_buf),v.bi_buf=0,v.bi_valid=0):v.bi_valid>=8&&(v.pending_buf[v.pending++]=255&v.bi_buf,v.bi_buf>>=8,v.bi_valid-=8)})(v)}},10980:v=>{"use strict";v.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11983:v=>{function y(v,y,n){for(var B=v.length,J=-1/0,P=1/0,b=0;b<B;b++){var Y=(n[0][b]-v[b])/y[b],l=(n[1][b]-v[b])/y[b];if(Y>l){var a=Y;Y=l,l=a}if(l<J||Y>P)return 1/0;Y>J&&(J=Y),l<P&&(P=l)}return J>P?1/0:J}v.exports=function(v,n,B,J){var P=y(n,B,J);if(P===1/0)v=null;else{v=v||[];for(var b=0;b<n.length;b++)v[b]=n[b]+B[b]*P}return v},v.exports.distance=y},12757:(v,y,n)=>{"use strict";n.d(y,{b:()=>b});var B=n(29);const J=B.useLayoutEffect;const P=function(v){var y=(0,B.useRef)(v);return J((function(){y.current=v})),y};var b=function(v){var y=P(v);(0,B.qb)((function(){var v=function(v){var n;if(null!=y.current&&(n=y.current(v)),v.defaultPrevented&&(v.returnValue=""),"string"===typeof n)return v.returnValue=n,n};return window.addEventListener("beforeunload",v),function(){window.removeEventListener("beforeunload",v)}}),[])}},12713:(v,y,n)=>{"use strict";var B=n(12720),J=Array.prototype.concat,P=Array.prototype.slice,b=v.exports=function(v){for(var y=[],n=0,b=v.length;n<b;n++){var Y=v[n];B(Y)?y=J.call(y,P.call(Y)):y.push(Y)}return y};b.wrap=function(v){return function(){return v(b(arguments))}}},12720:v=>{v.exports=function(v){return!(!v||"string"===typeof v)&&(v instanceof Array||Array.isArray(v)||v.length>=0&&(v.splice instanceof Function||Object.getOwnPropertyDescriptor(v,v.length-1)&&"String"!==v.constructor.name))}},10756:(v,y,n)=>{var B=n(10760);function J(v){for(var y,n,J=0,P=v.length,b=0;b<v.length;){for(y=v[b],n=0;b<P&&v[b]===y;)++b,++n;J+=B.log2(n)/7|0,J+=B.log2(y>>>0)/7|0,J+=2}return J}y.size=J,y.encode=function(v,y){y||(y=new Uint8Array(J(v)));for(var n,B,P=0,b=y.length,Y=0;Y<v.length;){for(n=v[Y],B=0;Y<v.length&&v[Y]===n;)++Y,++B;for(;P<b&&B>=128;)y[P++]=128+(127&B),B>>>=7;if(P>=b)throw new Error("RLE buffer overflow");for(y[P++]=B,n>>>=0;P<b&&n>=128;)y[P++]=128+(127&n),n>>>=7;if(P>=b)throw new Error("RLE buffer overflow");y[P++]=n}return y},y.decode=function(v,y){for(var n,B,J,P,b=y.length,Y=v.length,l=0,a=0;a<Y;){for(n=0,B=0;a<Y&&v[a]>=128;)n+=(127&v[a++])<<B,B+=7;if(n+=v[a++]<<B,a>=Y)throw new Error("RLE buffer underrun");if(l+n>b)throw new Error("Chunk buffer overflow");for(J=0,B=0;a<Y&&v[a]>=128;)J+=(127&v[a++])<<B,B+=7;if(a>=Y)throw new Error("RLE buffer underrun");for(J+=v[a++]<<B,P=0;P<n;++P)y[l++]=J}return y}},10760:(v,y)=>{"use strict";function n(v){var y=32;return(v&=-v)&&y--,65535&v&&(y-=16),16711935&v&&(y-=8),252645135&v&&(y-=4),858993459&v&&(y-=2),1431655765&v&&(y-=1),y}y.INT_BITS=32,y.INT_MAX=2147483647,y.INT_MIN=-1<<31,y.sign=function(v){return(v>0)-(v<0)},y.abs=function(v){var y=v>>31;return(v^y)-y},y.min=function(v,y){return y^(v^y)&-(v<y)},y.max=function(v,y){return v^(v^y)&-(v<y)},y.isPow2=function(v){return!(v&v-1)&&!!v},y.log2=function(v){var y,n;return y=(v>65535)<<4,y|=n=((v>>>=y)>255)<<3,y|=n=((v>>>=n)>15)<<2,(y|=n=((v>>>=n)>3)<<1)|(v>>>=n)>>1},y.log10=function(v){return v>=1e9?9:v>=1e8?8:v>=1e7?7:v>=1e6?6:v>=1e5?5:v>=1e4?4:v>=1e3?3:v>=100?2:v>=10?1:0},y.popCount=function(v){return 16843009*((v=(858993459&(v-=v>>>1&1431655765))+(v>>>2&858993459))+(v>>>4)&252645135)>>>24},y.countTrailingZeros=n,y.nextPow2=function(v){return v+=0===v,--v,v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)+1},y.prevPow2=function(v){return v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)-(v>>>1)},y.parity=function(v){return v^=v>>>16,v^=v>>>8,v^=v>>>4,27030>>>(v&=15)&1};var B=new Array(256);!function(v){for(var y=0;y<256;++y){var n=y,B=y,J=7;for(n>>>=1;n;n>>>=1)B<<=1,B|=1&n,--J;v[y]=B<<J&255}}(B),y.reverse=function(v){return B[255&v]<<24|B[v>>>8&255]<<16|B[v>>>16&255]<<8|B[v>>>24&255]},y.interleave2=function(v,y){return(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y&=65535)|y<<8))|y<<4))|y<<2))|y<<1))<<1},y.deinterleave2=function(v,y){return(v=65535&((v=16711935&((v=252645135&((v=858993459&((v=v>>>y&1431655765)|v>>>1))|v>>>2))|v>>>4))|v>>>16))<<16>>16},y.interleave3=function(v,y,n){return v=1227133513&((v=3272356035&((v=251719695&((v=4278190335&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2),(v|=(y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},y.deinterleave3=function(v,y){return(v=1023&((v=4278190335&((v=251719695&((v=3272356035&((v=v>>>y&1227133513)|v>>>2))|v>>>4))|v>>>8))|v>>>16))<<22>>22},y.nextCombination=function(v){var y=v|v-1;return y+1|(~y&-~y)-1>>>n(v)+1}},10921:v=>{"use strict";v.exports=function(v,y,n,B){var J=self||window;try{try{var P;try{P=new J.Blob([v])}catch(a){(P=new(J.BlobBuilder||J.WebKitBlobBuilder||J.MozBlobBuilder||J.MSBlobBuilder)).append(v),P=P.getBlob()}var b=J.URL||J.webkitURL,Y=b.createObjectURL(P),l=new J[y](Y,n);return b.revokeObjectURL(Y),l}catch(a){return new J[y]("data:application/javascript,".concat(encodeURIComponent(v)),n)}}catch(a){if(!B)throw Error("Inline worker is not supported");return new J[y](B,n)}}},11972:(v,y,n)=>{"use strict";function B(v,y,n,B,J){var P={};return Object.keys(B).forEach((function(v){P[v]=B[v]})),P.enumerable=!!P.enumerable,P.configurable=!!P.configurable,("value"in P||P.initializer)&&(P.writable=!0),P=n.slice().reverse().reduce((function(n,B){return B(v,y,n)||n}),P),J&&void 0!==P.initializer&&(P.value=P.initializer?P.initializer.call(J):void 0,P.initializer=void 0),void 0===P.initializer&&(Object.defineProperty(v,y,P),P=null),P}n.d(y,{b:()=>B})},11966:(v,y,n)=>{"use strict";function B(v,y,n,B){n&&Object.defineProperty(v,y,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(B):void 0})}n.d(y,{b:()=>B})},12275:(v,y,n)=>{"use strict";n.d(y,{c:()=>W,e:()=>c,h:()=>h,l:()=>f,n:()=>g,q:()=>i,t:()=>N});var B=n(11081),J=n(11103),P=n(11091),b=n(10908),Y=n(12278),l=n(11351),a=n(11289),Z=n(10816),x=n(11110);const f=Object.freeze(new B.g(0,0,0,0)),N=Object.freeze(B.n.Zero()),i=Object.freeze(B.j.Zero()),g=Object.freeze(a.c.Zero()),c=Object.freeze(J.d.Black()),h=Object.freeze(new J.e(0,0,0,0)),E={key:0,repeatCount:0,loopMode:2};class W{static _PrepareAnimation(v,y,n,P,b,Y,l,Z){let x;if(!isNaN(parseFloat(b))&&isFinite(b)?x=W.ANIMATIONTYPE_FLOAT:b instanceof B.g?x=W.ANIMATIONTYPE_QUATERNION:b instanceof B.n?x=W.ANIMATIONTYPE_VECTOR3:b instanceof B.j?x=W.ANIMATIONTYPE_VECTOR2:b instanceof J.d?x=W.ANIMATIONTYPE_COLOR3:b instanceof J.e?x=W.ANIMATIONTYPE_COLOR4:b instanceof a.c&&(x=W.ANIMATIONTYPE_SIZE),void 0==x)return null;const f=new W(v,y,n,x,l),N=[{frame:0,value:b},{frame:P,value:Y}];return f.setKeys(N),void 0!==Z&&f.setEasingFunction(Z),f}static CreateAnimation(v,y,n,B){const J=new W(v+"Animation",v,n,y,W.ANIMATIONLOOPMODE_CONSTANT);return J.setEasingFunction(B),J}static CreateAndStartAnimation(v,y,n,B,J,P,b,Y,l,a,Z){const x=W._PrepareAnimation(v,n,B,J,P,b,Y,l);return x?(y.va&&(Z=y.va()),Z?Z.beginDirectAnimation(y,[x],0,J,1===x.loopMode,1,a):null):null}static CreateAndStartHierarchyAnimation(v,y,n,B,J,P,b,Y,l,a,Z){const x=W._PrepareAnimation(v,B,J,P,b,Y,l,a);if(!x)return null;return y.va().beginDirectHierarchyAnimation(y,n,[x],0,P,1===x.loopMode,1,Z)}static CreateMergeAndStartAnimation(v,y,n,B,J,P,b,Y,l,a){const Z=W._PrepareAnimation(v,n,B,J,P,b,Y,l);return Z?(y.animations.push(Z),y.va().beginAnimation(y,0,J,1===Z.loopMode,1,a)):null}static MakeAnimationAdditive(v,y,n){let J;J="object"===typeof y?y:{referenceFrame:y??0,range:n,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let P=v;if(J.cloneOriginalAnimation&&(P=v.clone(),P.name=J.clonedAnimationName||P.name),!P._keys.length)return P;const b=J.referenceFrame&&J.referenceFrame>=0?J.referenceFrame:0;let Y=0;const l=P._keys[0];let a=P._keys.length-1;const Z=P._keys[a],x={referenceValue:l.value,referencePosition:B.i.o[0],referenceQuaternion:B.i.Quaternion[0],referenceScaling:B.i.o[1],keyPosition:B.i.o[2],keyQuaternion:B.i.Quaternion[1],keyScaling:B.i.o[3]};let f=l.frame,N=Z.frame;if(J.range){const v=P.getRange(J.range);v&&(f=v.from,N=v.to)}else f=J.fromFrame??f,N=J.toFrame??N;if(f!==l.frame&&(Y=P.createKeyForFrame(f)),N!==Z.frame&&(a=P.createKeyForFrame(N)),1===P._keys.length){const v=P._getKeyValue(P._keys[0]);x.referenceValue=v.clone?v.clone():v}else if(b<=l.frame){const v=P._getKeyValue(l.value);x.referenceValue=v.clone?v.clone():v}else if(b>=Z.frame){const v=P._getKeyValue(Z.value);x.referenceValue=v.clone?v.clone():v}else{E.key=0;const v=P._interpolate(b,E);x.referenceValue=v.clone?v.clone():v}P.dataType===W.ANIMATIONTYPE_QUATERNION?x.referenceValue.normalize().conjugateInPlace():P.dataType===W.ANIMATIONTYPE_MATRIX&&(x.referenceValue.decompose(x.referenceScaling,x.referenceQuaternion,x.referencePosition),x.referenceQuaternion.normalize().conjugateInPlace());let i=Number.MAX_VALUE;const g=J.clipKeys?[]:null;for(let c=Y;c<=a;c++){let v=P._keys[c];if((g||J.cloneOriginalAnimation)&&(v={frame:v.frame,value:v.value.clone?v.value.clone():v.value,inTangent:v.inTangent,outTangent:v.outTangent,interpolation:v.interpolation,lockedTangent:v.lockedTangent},g&&(i===Number.MAX_VALUE&&(i=v.frame),v.frame-=i,g.push(v))),!c||P.dataType===W.ANIMATIONTYPE_FLOAT||v.value!==l.value)switch(P.dataType){case W.ANIMATIONTYPE_MATRIX:v.value.decompose(x.keyScaling,x.keyQuaternion,x.keyPosition),x.keyPosition.Ei(x.referencePosition),x.keyScaling.divideInPlace(x.referenceScaling),x.referenceQuaternion.multiplyToRef(x.keyQuaternion,x.keyQuaternion),B.d.ComposeToRef(x.keyScaling,x.keyQuaternion,x.keyPosition,v.value);break;case W.ANIMATIONTYPE_QUATERNION:x.referenceValue.multiplyToRef(v.value,v.value);break;case W.ANIMATIONTYPE_VECTOR2:case W.ANIMATIONTYPE_VECTOR3:case W.ANIMATIONTYPE_COLOR3:case W.ANIMATIONTYPE_COLOR4:v.value.subtractToRef(x.referenceValue,v.value);break;case W.ANIMATIONTYPE_SIZE:v.value.width-=x.referenceValue.width,v.value.height-=x.referenceValue.height;break;default:v.value-=x.referenceValue}}return g&&P.setKeys(g,!0),P}static TransitionTo(v,y,n,B,J,P,b){let Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(b<=0)return n[v]=y,Y&&Y(),null;const l=J*(b/1e3);P.setKeys([{frame:0,value:n[v].clone?n[v].clone():n[v]},{frame:l,value:y}]),n.animations||(n.animations=[]),n.animations.push(P);const a=B.beginAnimation(n,0,l,!1);return a.onAnimationEnd=Y,a}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const v of this._runtimeAnimations)if(!v.isStopped())return!0;return!1}constructor(v,y,n,B,J,P){this.name=v,this.targetProperty=y,this.framePerSecond=n,this.dataType=B,this.loopMode=J,this.enableBlending=P,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=y.split("."),this.dataType=B,this.loopMode=void 0===J?W.ANIMATIONLOOPMODE_CYCLE:J,this.uniqueId=W._UniqueIdGenerator++}toString(v){let y="Name: "+this.name+", property: "+this.targetProperty;if(y+=", datatype: "+["Float","o","Quaternion","Matrix","ib","Vector2"][this.dataType],y+=", nKeys: "+(this._keys?this._keys.length:"none"),y+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),v){y+=", Ranges: {";let v=!0;for(const n in this._ranges)v&&(y+=", ",v=!1),y+=n;y+="}"}return y}addEvent(v){this._events.push(v),this._events.sort(((v,y)=>v.frame-y.frame))}removeEvents(v){for(let y=0;y<this._events.length;y++)this._events[y].frame===v&&(this._events.splice(y,1),y--)}getEvents(){return this._events}createRange(v,y,n){this._ranges[v]||(this._ranges[v]=new Y.b(v,y,n))}deleteRange(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this._ranges[v];if(n){if(y){const v=n.from,y=n.to;for(let n=this._keys.length-1;n>=0;n--)this._keys[n].frame>=v&&this._keys[n].frame<=y&&this._keys.splice(n,1)}this._ranges[v]=null}}getRange(v){return this._ranges[v]}getKeys(){return this._keys}getHighestFrame(){let v=0;for(let y=0,n=this._keys.length;y<n;y++)v<this._keys[y].frame&&(v=this._keys[y].frame);return v}getEasingFunction(){return this._easingFunction}setEasingFunction(v){this._easingFunction=v}floatInterpolateFunction(v,y,n){return(0,P.k)(v,y,n)}floatInterpolateFunctionWithTangents(v,y,n,B,J){return(0,P.d)(v,y,n,B,J)}quaternionInterpolateFunction(v,y,n){return B.g.Slerp(v,y,n)}quaternionInterpolateFunctionWithTangents(v,y,n,J,P){return B.g.Hermite(v,y,n,J,P).normalize()}vector3InterpolateFunction(v,y,n){return B.n.Lerp(v,y,n)}vector3InterpolateFunctionWithTangents(v,y,n,J,P){return B.n.Hermite(v,y,n,J,P)}vector2InterpolateFunction(v,y,n){return B.j.Lerp(v,y,n)}vector2InterpolateFunctionWithTangents(v,y,n,J,P){return B.j.Hermite(v,y,n,J,P)}sizeInterpolateFunction(v,y,n){return a.c.Lerp(v,y,n)}color3InterpolateFunction(v,y,n){return J.d.Lerp(v,y,n)}color3InterpolateFunctionWithTangents(v,y,n,B,P){return J.d.Hermite(v,y,n,B,P)}color4InterpolateFunction(v,y,n){return J.e.Lerp(v,y,n)}color4InterpolateFunctionWithTangents(v,y,n,B,P){return J.e.Hermite(v,y,n,B,P)}_getKeyValue(v){return"function"===typeof v?v():v}evaluate(v){return E.key=0,this._interpolate(v,E)}_interpolate(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(y.loopMode===W.ANIMATIONLOOPMODE_CONSTANT&&y.repeatCount>0)return y.highLimitValue.clone?y.highLimitValue.clone():y.highLimitValue;const B=this._keys,J=B.length;let P=y.key;for(;P>=0&&v<B[P].frame;)--P;for(;P+1<=J-1&&v>=B[P+1].frame;)++P;if(y.key=P,P<0)return n?void 0:this._getKeyValue(B[0].value);if(P+1>J-1)return n?void 0:this._getKeyValue(B[J-1].value);const b=B[P],Y=B[P+1];if(n&&(v===b.frame||v===Y.frame))return;const l=this._getKeyValue(b.value),a=this._getKeyValue(Y.value);if(1===b.interpolation)return Y.frame>v?l:a;const Z=void 0!==b.outTangent&&void 0!==Y.inTangent,x=Y.frame-b.frame;let E=(v-b.frame)/x;const s=b.easingFunction||this.getEasingFunction();switch(null!==s&&(E=s.ease(E)),this.dataType){case W.ANIMATIONTYPE_FLOAT:{const v=Z?this.floatInterpolateFunctionWithTangents(l,b.outTangent*x,a,Y.inTangent*x,E):this.floatInterpolateFunction(l,a,E);switch(y.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:case W.ANIMATIONLOOPMODE_YOYO:return v;case W.ANIMATIONLOOPMODE_RELATIVE:case W.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(y.offsetValue??0)*y.repeatCount+v}break}case W.ANIMATIONTYPE_QUATERNION:{const v=Z?this.quaternionInterpolateFunctionWithTangents(l,b.outTangent.scale(x),a,Y.inTangent.scale(x),E):this.quaternionInterpolateFunction(l,a,E);switch(y.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:case W.ANIMATIONLOOPMODE_YOYO:return v;case W.ANIMATIONLOOPMODE_RELATIVE:case W.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return v.addInPlace((y.offsetValue||f).scale(y.repeatCount))}return v}case W.ANIMATIONTYPE_VECTOR3:{const v=Z?this.vector3InterpolateFunctionWithTangents(l,b.outTangent.scale(x),a,Y.inTangent.scale(x),E):this.vector3InterpolateFunction(l,a,E);switch(y.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:case W.ANIMATIONLOOPMODE_YOYO:return v;case W.ANIMATIONLOOPMODE_RELATIVE:case W.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return v.add((y.offsetValue||N).scale(y.repeatCount))}break}case W.ANIMATIONTYPE_VECTOR2:{const v=Z?this.vector2InterpolateFunctionWithTangents(l,b.outTangent.scale(x),a,Y.inTangent.scale(x),E):this.vector2InterpolateFunction(l,a,E);switch(y.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:case W.ANIMATIONLOOPMODE_YOYO:return v;case W.ANIMATIONLOOPMODE_RELATIVE:case W.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return v.add((y.offsetValue||i).scale(y.repeatCount))}break}case W.ANIMATIONTYPE_SIZE:switch(y.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:case W.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(l,a,E);case W.ANIMATIONLOOPMODE_RELATIVE:case W.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(l,a,E).add((y.offsetValue||g).scale(y.repeatCount))}break;case W.ANIMATIONTYPE_COLOR3:{const v=Z?this.color3InterpolateFunctionWithTangents(l,b.outTangent.scale(x),a,Y.inTangent.scale(x),E):this.color3InterpolateFunction(l,a,E);switch(y.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:case W.ANIMATIONLOOPMODE_YOYO:return v;case W.ANIMATIONLOOPMODE_RELATIVE:case W.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return v.add((y.offsetValue||c).scale(y.repeatCount))}break}case W.ANIMATIONTYPE_COLOR4:{const v=Z?this.color4InterpolateFunctionWithTangents(l,b.outTangent.scale(x),a,Y.inTangent.scale(x),E):this.color4InterpolateFunction(l,a,E);switch(y.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:case W.ANIMATIONLOOPMODE_YOYO:return v;case W.ANIMATIONLOOPMODE_RELATIVE:case W.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return v.add((y.offsetValue||h).scale(y.repeatCount))}break}case W.ANIMATIONTYPE_MATRIX:switch(y.loopMode){case W.ANIMATIONLOOPMODE_CYCLE:case W.ANIMATIONLOOPMODE_CONSTANT:case W.ANIMATIONLOOPMODE_YOYO:return W.AllowMatricesInterpolation?this.matrixInterpolateFunction(l,a,E,y.workValue):l;case W.ANIMATIONLOOPMODE_RELATIVE:case W.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return l}}return 0}matrixInterpolateFunction(v,y,n,J){return W.AllowMatrixDecomposeForInterpolation?J?(B.d.DecomposeLerpToRef(v,y,n,J),J):B.d.DecomposeLerp(v,y,n):J?(B.d.LerpToRef(v,y,n,J),J):B.d.Lerp(v,y,n)}clone(){const v=new W(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(v.enableBlending=this.enableBlending,v.blendingSpeed=this.blendingSpeed,this._keys&&v.setKeys(this._keys),this._ranges){v._ranges={};for(const y in this._ranges){const n=this._ranges[y];n&&(v._ranges[y]=n.clone())}}return v}setKeys(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=y?v:v.slice(0)}createKeyForFrame(v){E.key=0;const y=this._interpolate(v,E,!0);if(!y)return this._keys[E.key].frame===v?E.key:E.key+1;const n={frame:v,value:y.clone?y.clone():y};return this._keys.splice(E.key+1,0,n),E.key+1}serialize(){const v={};v.name=this.name,v.property=this.targetProperty,v.framePerSecond=this.framePerSecond,v.dataType=this.dataType,v.loopBehavior=this.loopMode,v.enableBlending=this.enableBlending,v.blendingSpeed=this.blendingSpeed;const y=this.dataType;v.keys=[];const n=this.getKeys();for(let B=0;B<n.length;B++){const J=n[B],P={};switch(P.frame=J.frame,y){case W.ANIMATIONTYPE_FLOAT:P.values=[J.value],void 0!==J.inTangent&&P.values.push(J.inTangent),void 0!==J.outTangent&&(void 0===J.inTangent&&P.values.push(void 0),P.values.push(J.outTangent)),void 0!==J.interpolation&&(void 0===J.inTangent&&P.values.push(void 0),void 0===J.outTangent&&P.values.push(void 0),P.values.push(J.interpolation));break;case W.ANIMATIONTYPE_QUATERNION:case W.ANIMATIONTYPE_MATRIX:case W.ANIMATIONTYPE_VECTOR3:case W.ANIMATIONTYPE_COLOR3:case W.ANIMATIONTYPE_COLOR4:P.values=J.value.wj(),void 0!=J.inTangent&&P.values.push(J.inTangent.wj()),void 0!=J.outTangent&&(void 0===J.inTangent&&P.values.push(void 0),P.values.push(J.outTangent.wj())),void 0!==J.interpolation&&(void 0===J.inTangent&&P.values.push(void 0),void 0===J.outTangent&&P.values.push(void 0),P.values.push(J.interpolation))}v.keys.push(P)}v.ranges=[];for(const B in this._ranges){const y=this._ranges[B];if(!y)continue;const n={};n.name=B,n.from=y.from,n.to=y.to,v.ranges.push(n)}return v}static _UniversalLerp(v,y,n){const B=v.constructor;return B.Lerp?B.Lerp(v,y,n):B.Slerp?B.Slerp(v,y,n):v.toFixed?v*(1-n)+n*y:y}static Parse(v){const y=new W(v.name,v.property,v.framePerSecond,v.dataType,v.loopBehavior),n=v.dataType,P=[];let b,Y;for(v.enableBlending&&(y.enableBlending=v.enableBlending),v.blendingSpeed&&(y.blendingSpeed=v.blendingSpeed),Y=0;Y<v.keys.length;Y++){const y=v.keys[Y];let l,a,Z;switch(n){case W.ANIMATIONTYPE_FLOAT:b=y.values[0],y.values.length>=2&&(l=y.values[1]),y.values.length>=3&&(a=y.values[2]),y.values.length>=4&&(Z=y.values[3]);break;case W.ANIMATIONTYPE_QUATERNION:if(b=B.g.qh(y.values),y.values.length>=8){const v=B.g.qh(y.values.slice(4,8));v.equals(B.g.Zero())||(l=v)}if(y.values.length>=12){const v=B.g.qh(y.values.slice(8,12));v.equals(B.g.Zero())||(a=v)}y.values.length>=13&&(Z=y.values[12]);break;case W.ANIMATIONTYPE_MATRIX:b=B.d.qh(y.values),y.values.length>=17&&(Z=y.values[16]);break;case W.ANIMATIONTYPE_COLOR3:b=J.d.qh(y.values),y.values[3]&&(l=J.d.qh(y.values[3])),y.values[4]&&(a=J.d.qh(y.values[4])),y.values[5]&&(Z=y.values[5]);break;case W.ANIMATIONTYPE_COLOR4:b=J.e.qh(y.values),y.values[4]&&(l=J.e.qh(y.values[4])),y.values[5]&&(a=J.e.qh(y.values[5])),y.values[6]&&(Z=J.e.qh(y.values[6]));break;case W.ANIMATIONTYPE_VECTOR3:default:b=B.n.qh(y.values),y.values[3]&&(l=B.n.qh(y.values[3])),y.values[4]&&(a=B.n.qh(y.values[4])),y.values[5]&&(Z=y.values[5])}const x={};x.frame=y.frame,x.value=b,void 0!=l&&(x.inTangent=l),void 0!=a&&(x.outTangent=a),void 0!=Z&&(x.interpolation=Z),P.push(x)}if(y.setKeys(P),v.ranges)for(Y=0;Y<v.ranges.length;Y++)b=v.ranges[Y],y.createRange(b.name,b.from,b.to);return y}static AppendSerializedAnimations(v,y){x.d.AppendSerializedAnimations(v,y)}static ParseFromFileAsync(v,y){return new Promise(((n,B)=>{const J=new Z.c;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){let y=JSON.parse(J.responseText);if(y.animations&&(y=y.animations),y.length){const v=[];for(const n of y)v.push(this.Parse(n));n(v)}else{const B=this.Parse(y);v&&(B.name=v),n(B)}}else B("Unable to load the animation")})),J.open("GET",y),J.send()}))}static ParseFromSnippetAsync(v){return new Promise(((y,n)=>{const B=new Z.c;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const n=JSON.parse(JSON.parse(B.responseText).jsonPayload);if(n.animations){const B=JSON.parse(n.animations),J=[];for(const y of B.animations){const n=this.Parse(y);n.snippetId=v,J.push(n)}y(J)}else{const B=JSON.parse(n.animation),J=this.Parse(B);J.snippetId=v,y(J)}}else n("Unable to load the snippet "+v)})),B.open("GET",this.SnippetUrl+"/"+v.replace(/#/g,"/")),B.send()}))}}W._UniqueIdGenerator=0,W.AllowMatricesInterpolation=!1,W.AllowMatrixDecomposeForInterpolation=!0,W.SnippetUrl="https://snippet.babylonjs.com",W.ANIMATIONTYPE_FLOAT=0,W.ANIMATIONTYPE_VECTOR3=1,W.ANIMATIONTYPE_QUATERNION=2,W.ANIMATIONTYPE_MATRIX=3,W.ANIMATIONTYPE_COLOR3=4,W.ANIMATIONTYPE_COLOR4=7,W.ANIMATIONTYPE_VECTOR2=5,W.ANIMATIONTYPE_SIZE=6,W.ANIMATIONLOOPMODE_RELATIVE=0,W.ANIMATIONLOOPMODE_CYCLE=1,W.ANIMATIONLOOPMODE_CONSTANT=2,W.ANIMATIONLOOPMODE_YOYO=4,W.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,W.CreateFromSnippetAsync=W.ParseFromSnippetAsync,(0,b.g)("BABYLON.Animation",W),l.c._AnimationRangeFactory=(v,y,n)=>new Y.b(v,y,n)},12278:(v,y,n)=>{"use strict";n.d(y,{b:()=>B});class B{constructor(v,y,n){this.name=v,this.from=y,this.to=n}clone(){return new B(this.name,this.from,this.to)}}},11630:(v,y,n)=>{"use strict";var B=n(10795),J=n(10801),P=n(10849),b=n(10797);P.c.AudioEngineFactory=(v,y,n)=>new Y(v,y,n);class Y{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new B.e,this.onAudioLockedObservable=new B.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,b.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const J=document.createElement("audio");this._hostElement=v,this._audioContext=y,this._audioDestination=n;try{J&&J.canPlayType&&(J.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||J.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(P){}try{J&&J.canPlayType&&J.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(P){}}lock(){this._triggerSuspendedState()}unlock(){var v,y;if("running"===(null===(v=this._audioContext)||void 0===v?void 0:v.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(y=this._audioContext)||void 0===y||y.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var v;null===(v=this._audioContext)||void 0===v||v.addEventListener("statechange",(()=>{var v;this.unlocked&&"running"!==(null===(v=this._audioContext)||void 0===v?void 0:v.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var v;return null!==(v=this._audioContext)&&void 0!==v&&v.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(v){this.canUseWebAudio=!1,J.e.Error("Web Audio: "+v.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const v=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",y=document.createElement("style");y.appendChild(document.createTextNode(v)),document.getElementsByTagName("head")[0].appendChild(y),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(v){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=v)}connectToAnalyser(v){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=v,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},12270:(v,y,n)=>{"use strict";n.d(y,{c:()=>b});var B=n(11081),J=n(11088),P=n(11351);class b extends P.c{get _matrix(){return this._compose(),this.ck}set _matrix(v){(v.updateFlag!==this.ck.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.ck.p(v),this._markAsDirtyAndDecompose())}constructor(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(v,y.va(),!1),this.name=v,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=y,this.ck=(null===J||void 0===J?void 0:J.clone())??B.d.Identity(),this._restMatrix=P??this.ck.clone(),this._bindMatrix=b??this.ck.clone(),this._index=Y,this._absoluteMatrix=new B.d,this._absoluteBindMatrix=new B.d,this._absoluteInverseBindMatrix=new B.d,this._finalMatrix=new B.d,y.bones.push(this),this.setParent(n,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(v){this.setParent(v)}setParent(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==v){if(this.parent){const v=this.parent.children.indexOf(this);-1!==v&&this.parent.children.splice(v,1)}this._parentNode=v,this.parent&&this.parent.children.push(this),y&&this._updateAbsoluteBindMatrices(),this.eh()}}getLocalMatrix(){return this._compose(),this.ck}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(v){this._restMatrix.p(v)}setRestPose(v){this.setRestMatrix(v)}getBindPose(){return this.getBindMatrix()}setBindMatrix(v){this.Vj(v)}setBindPose(v){this.setBindMatrix(v)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const v=B.i.o[0],y=B.i.Quaternion[0],n=B.i.o[1];this.getRestMatrix().decompose(v,y,n),this._linkedTransformNode.position.p(n),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??B.g.Identity(),this._linkedTransformNode.rotationQuaternion.p(y),this._linkedTransformNode.Be.p(v)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(v){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=v,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.we}set position(v){this._decompose(),this.we.p(v),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(v){this.setRotation(v)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(v){this.setRotationQuaternion(v)}get Be(){return this.getScale()}set Be(v){this.setScale(v)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=B.n.Zero(),this._localRotation=B.g.Zero(),this.we=B.n.Zero()),this.ck.decompose(this._localScaling,this._localRotation,this.we))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,B.d.ComposeToRef(this._localScaling,this._localRotation,this.we,this.ck)):this._needToCompose=!1)}Vj(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(v),y&&this._updateAbsoluteBindMatrices(),n?this._matrix=v:this.eh()}_updateAbsoluteBindMatrices(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(v||(v=this._bindMatrix),this.parent?v.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(v),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),y)for(let n=0;n<this.children.length;n++)this.children[n]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}eh(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.eh(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.eh(),this._needToDecompose=!0}_updatePosition(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const P=this.getLocalMatrix();if(0==y)J?(P.addAtIndex(12,v.x),P.addAtIndex(13,v.y),P.addAtIndex(14,v.z)):P.setTranslationFromFloats(v.x,v.y,v.z);else{let y=null;n&&(y=n.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Y=b._TmpMats[0],l=b._TmpVecs[0];this.parent?n&&y?(Y.p(this.parent.getAbsoluteMatrix()),Y.multiplyToRef(y,Y)):Y.p(this.parent.getAbsoluteMatrix()):B.d.IdentityToRef(Y),J&&Y.setTranslationFromFloats(0,0,0),Y.invert(),B.n.TransformCoordinatesToRef(v,Y,l),J?(P.addAtIndex(12,l.x),P.addAtIndex(13,l.y),P.addAtIndex(14,l.z)):P.setTranslationFromFloats(l.x,l.y,l.z)}this._markAsDirtyAndDecompose()}translate(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this._updatePosition(v,y,n,!0)}setPosition(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this._updatePosition(v,y,n,!1)}setAbsolutePosition(v,y){this.setPosition(v,1,y)}scale(v,y,n){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const P=this.getLocalMatrix(),Y=b._TmpMats[0];B.d.ScalingToRef(v,y,n,Y),Y.multiplyToRef(P,P),Y.invert();for(const B of this.children){const J=B.getLocalMatrix();J.multiplyToRef(Y,J),J.multiplyAtIndex(12,v),J.multiplyAtIndex(13,y),J.multiplyAtIndex(14,n),B._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),J)for(const B of this.children)B.scale(v,y,n,J)}setScale(v){this._decompose(),this._localScaling.p(v),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(v){this._decompose(),v.p(this._localScaling)}setYawPitchRoll(v,y,n){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,P=arguments.length>4?arguments[4]:void 0;if(0===J){const Y=b._TmpQuat;return B.g.RotationYawPitchRollToRef(v,y,n,Y),void this.setRotationQuaternion(Y,J,P)}const Y=b._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Y,P))return;const l=b._TmpMats[1];B.d.RotationYawPitchRollToRef(v,y,n,l),Y.multiplyToRef(l,l),this._rotateWithMatrix(l,J,P)}rotate(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3?arguments[3]:void 0;const P=b._TmpMats[0];P.setTranslationFromFloats(0,0,0),B.d.RotationAxisToRef(v,y,P),this._rotateWithMatrix(P,n,J)}setAxisAngle(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3?arguments[3]:void 0;if(0===n){const P=b._TmpQuat;return B.g.RotationAxisToRef(v,y,P),void this.setRotationQuaternion(P,n,J)}const P=b._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(P,J))return;const Y=b._TmpMats[1];B.d.RotationAxisToRef(v,y,Y),P.multiplyToRef(Y,Y),this._rotateWithMatrix(Y,n,J)}setRotation(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(v.y,v.x,v.z,y,n)}setRotationQuaternion(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(0===y)return this._decompose(),this._localRotation.p(v),void this._markAsDirtyAndCompose();const J=b._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(J,n))return;const P=b._TmpMats[1];B.d.FromQuaternionToRef(v,P),J.multiplyToRef(P,P),this._rotateWithMatrix(P,y,n)}setRotationMatrix(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(0===y){const J=b._TmpQuat;return B.g.FromRotationMatrixToRef(v,J),void this.setRotationQuaternion(J,y,n)}const J=b._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(J,n))return;const P=b._TmpMats[1];P.p(v),J.multiplyToRef(v,P),this._rotateWithMatrix(P,y,n)}_rotateWithMatrix(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const B=this.getLocalMatrix(),J=B.m[12],P=B.m[13],Y=B.m[14],l=this.getParent(),a=b._TmpMats[3],Z=b._TmpMats[4];l&&1==y?(n?(a.p(n.getWorldMatrix()),l.getAbsoluteMatrix().multiplyToRef(a,a)):a.p(l.getAbsoluteMatrix()),Z.p(a),Z.invert(),B.multiplyToRef(a,B),B.multiplyToRef(v,B),B.multiplyToRef(Z,B)):1==y&&n?(a.p(n.getWorldMatrix()),Z.p(a),Z.invert(),B.multiplyToRef(a,B),B.multiplyToRef(v,B),B.multiplyToRef(Z,B)):B.multiplyToRef(v,B),B.setTranslationFromFloats(J,P,Y),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(v,y){const n=b._TmpMats[2];return v.p(this.getAbsoluteMatrix()),y?(v.multiplyToRef(y.getWorldMatrix(),v),B.d.ScalingToRef(y.Be.x,y.Be.y,y.Be.z,n)):B.d.IdentityToRef(n),v.invert(),!isNaN(v.m[0])&&(n.multiplyAtIndex(0,this._scalingDeterminant),v.multiplyToRef(n,v),!0)}cb(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=B.n.Zero();return this.getPositionToRef(v,y,n),n}getPositionToRef(){let v=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const v=this.getLocalMatrix();y.x=v.m[12],y.y=v.m[13],y.z=v.m[14]}else{let n=null;v&&(n=v.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let B=b._TmpMats[0];v&&n?(B.p(this.getAbsoluteMatrix()),B.multiplyToRef(n,B)):B=this.getAbsoluteMatrix(),y.x=B.m[12],y.y=B.m[13],y.z=B.m[14]}}getAbsolutePosition(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const y=B.n.Zero();return this.getPositionToRef(1,v,y),y}getAbsolutePositionToRef(v,y){this.getPositionToRef(1,v,y)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.ck.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.ck);const v=this._skeleton.getPoseMatrix();v&&this._absoluteMatrix.multiplyToRef(v,this._absoluteMatrix)}const v=this.children,y=v.length;for(let n=0;n<y;n++)v[n].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}uf(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=B.n.Zero();return this.getDirectionToRef(v,y,n),n}getDirectionToRef(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,J=null;y&&(J=y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const P=b._TmpMats[0];P.p(this.getAbsoluteMatrix()),y&&J&&P.multiplyToRef(J,P),B.n.TransformNormalToRef(v,P,n),n.normalize()}getRotation(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=B.n.Zero();return this.getRotationToRef(v,y,n),n}getRotationToRef(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;const B=b._TmpQuat;this.getRotationQuaternionToRef(v,y,B),B.toEulerAnglesToRef(n)}getRotationQuaternion(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=B.g.Identity();return this.getRotationQuaternionToRef(v,y,n),n}getRotationQuaternionToRef(){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),y.p(this._localRotation);else{const n=b._TmpMats[0],B=this.getAbsoluteMatrix();v?B.multiplyToRef(v.getWorldMatrix(),n):n.p(B),n.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyAtIndex(1,this._scalingDeterminant),n.multiplyAtIndex(2,this._scalingDeterminant),n.decompose(void 0,y,void 0)}}getRotationMatrix(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1?arguments[1]:void 0;const n=B.d.Identity();return this.getRotationMatrixToRef(v,y,n),n}getRotationMatrixToRef(){let v=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(y);else{const n=b._TmpMats[0],B=this.getAbsoluteMatrix();v?B.multiplyToRef(v.getWorldMatrix(),n):n.p(B),n.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyAtIndex(1,this._scalingDeterminant),n.multiplyAtIndex(2,this._scalingDeterminant),n.getRotationMatrixToRef(y)}}getAbsolutePositionFromLocal(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=B.n.Zero();return this.getAbsolutePositionFromLocalToRef(v,y,n),n}getAbsolutePositionFromLocalToRef(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,J=null;y&&(J=y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const P=b._TmpMats[0];P.p(this.getAbsoluteMatrix()),y&&J&&P.multiplyToRef(J,P),B.n.TransformCoordinatesToRef(v,P,n)}getLocalPositionFromAbsolute(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=B.n.Zero();return this.getLocalPositionFromAbsoluteToRef(v,y,n),n}getLocalPositionFromAbsoluteToRef(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,J=null;y&&(J=y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const P=b._TmpMats[0];P.p(this.getAbsoluteMatrix()),y&&J&&P.multiplyToRef(J,P),P.invert(),B.n.TransformCoordinatesToRef(v,P,n)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}b._TmpVecs=(0,J.c)(2,B.n.Zero),b._TmpQuat=B.g.Identity(),b._TmpMats=(0,J.c)(5,B.d.Identity)},11127:(v,y,n)=>{"use strict";n.d(y,{e:()=>P,i:()=>b});var B=n(11129),J=n(10801);class P{get u(){return this._isDisposed}constructor(v,y,n){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,P=arguments.length>4&&void 0!==arguments[4]&&arguments[4],b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7?arguments[7]:void 0,a=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,v&&v.va?this._engine=v.va().getEngine():this._engine=v,this._updatable=n,this._instanced=b,this._divisor=l||1,this._label=a,y instanceof B.b?(this._data=null,this._buffer=y):(this._data=y,this._buffer=null),this.byteStride=Y?J:J*Float32Array.BYTES_PER_ELEMENT,P||this.create()}createVertexBuffer(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6?arguments[6]:void 0;const l=P?y:y*Float32Array.BYTES_PER_ELEMENT,a=B?P?B:B*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new b(this._engine,this,v,this._updatable,!0,a,void 0===J?this._instanced:J,l,n,void 0,void 0,!0,this._divisor||Y)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!v&&this._buffer||(v=v||this._data,v&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,v),this._data=v):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(v,this._label),this._data=v):this._buffer=this._engine.createVertexBuffer(v,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.ob>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.ob,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.ob,void 0,this._label));J.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(v){this.create(v)}updateDirectly(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,v,B?y:y*Float32Array.BYTES_PER_ELEMENT,n?n*this.byteStride:void 0),this._data=0===y&&void 0===n?v:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class b{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(v){const y=0!=v;this._instanceDivisor=v,y!==this._instanced&&(this._instanced=y,this._computeHashCode())}get _maxVerticesCount(){const v=this.getData();return v?Array.isArray(v)?v.length/(this.byteStride/4)-this.byteOffset/4:(v.byteLength-this.byteOffset)/this.byteStride:0}constructor(v,y,n,B,J,Y,l,a,Z,x){let f=arguments.length>10&&void 0!==arguments[10]&&arguments[10],N=arguments.length>11&&void 0!==arguments[11]&&arguments[11],i=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,g=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let c=!1;if(this.Od=v,"object"===typeof B&&null!==B?(c=B.updatable??!1,J=B.postponeInternalCreation,Y=B.stride,l=B.instanced,a=B.offset,Z=B.size,x=B.type,f=B.normalized??!1,N=B.useBytes??!1,i=B.divisor??1,g=B.takeBufferOwnership??!1,this._label=B.label):c=!!B,y instanceof P?(this._buffer=y,this._ownsBuffer=g):(this._buffer=new P(v,y,c,Y,J,l,N,i,this._label),this._ownsBuffer=!0),this.uniqueId=b._Counter++,this._kind=n,void 0===x){const v=this.getData();this.type=v?b.GetDataType(v):b.FLOAT}else this.type=x;const h=b.GetTypeByteLength(this.type);N?(this._size=Z||(Y?Y/h:b.DeduceStride(n)),this.byteStride=Y||this._buffer.byteStride||this._size*h,this.byteOffset=a||0):(this._size=Z||Y||b.DeduceStride(n),this.byteStride=Y?Y*h:this._buffer.byteStride||this._size*h,this.byteOffset=(a||0)*h),this.normalized=f,this._instanced=void 0!==l&&l,this._instanceDivisor=l?i:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var v;null===(v=this._buffer)||void 0===v||v._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(v,y){const n=this.getData();return n?b.GetFloatData(n,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,v,y):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/b.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/b.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*b.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(v){this._buffer.create(v),this._alignBuffer()}update(v){this._buffer.update(v),this._alignBuffer()}updateDirectly(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(v,y,void 0,n),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(v,y){b.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,v,this.normalized,y)}_alignBuffer(){}static DeduceStride(v){switch(v){case b.UVKind:case b.UV2Kind:case b.UV3Kind:case b.UV4Kind:case b.UV5Kind:case b.UV6Kind:return 2;case b.NormalKind:case b.PositionKind:return 3;case b.ColorKind:case b.ColorInstanceKind:case b.MatricesIndicesKind:case b.MatricesIndicesExtraKind:case b.MatricesWeightsKind:case b.MatricesWeightsExtraKind:case b.TangentKind:return 4;default:throw new Error("Invalid kind '"+v+"'")}}static GetDataType(v){return v instanceof Int8Array?b.BYTE:v instanceof Uint8Array?b.UNSIGNED_BYTE:v instanceof Int16Array?b.SHORT:v instanceof Uint16Array?b.UNSIGNED_SHORT:v instanceof Int32Array?b.INT:v instanceof Uint32Array?b.UNSIGNED_INT:b.FLOAT}static GetTypeByteLength(v){switch(v){case b.BYTE:case b.UNSIGNED_BYTE:return 1;case b.SHORT:case b.UNSIGNED_SHORT:return 2;case b.INT:case b.UNSIGNED_INT:case b.FLOAT:return 4;default:throw new Error(`Invalid type '${v}'`)}}static ForEach(v,y,n,B,J,P,Y,l){if(v instanceof Array){let J=y/4;const b=n/4;for(let y=0;y<P;y+=B){for(let n=0;n<B;n++)l(v[J+n],y+n);J+=b}}else{const a=v instanceof ArrayBuffer?new DataView(v):new DataView(v.buffer,v.byteOffset,v.byteLength),Z=b.GetTypeByteLength(J);for(let v=0;v<P;v+=B){let P=y;for(let y=0;y<B;y++){l(b._GetFloatValue(a,J,P,Y),v+y),P+=Z}y+=n}}}static _GetFloatValue(v,y,n,B){switch(y){case b.BYTE:{let y=v.getInt8(n);return B&&(y=Math.max(y/127,-1)),y}case b.UNSIGNED_BYTE:{let y=v.getUint8(n);return B&&(y/=255),y}case b.SHORT:{let y=v.getInt16(n,!0);return B&&(y=Math.max(y/32767,-1)),y}case b.UNSIGNED_SHORT:{let y=v.getUint16(n,!0);return B&&(y/=65535),y}case b.INT:return v.getInt32(n,!0);case b.UNSIGNED_INT:return v.getUint32(n,!0);case b.FLOAT:return v.getFloat32(n,!0);default:throw new Error(`Invalid component type ${y}`)}}static GetFloatData(v,y,n,B,P,Y,l,a){const Z=y*b.GetTypeByteLength(n),x=l*y;if(n!==b.FLOAT||P!==Z){const J=new Float32Array(x);return b.ForEach(v,B,P,y,n,x,Y,((v,y)=>J[y]=v)),J}if(!(v instanceof Array||v instanceof Float32Array)||0!==B||v.length!==x){if(v instanceof Array){const y=B/4;return v.slice(y,y+x)}if(v instanceof ArrayBuffer)return new Float32Array(v,B,x);{const y=v.byteOffset+B;if(0!==(3&y)&&(J.e.Warn("Float array must be aligned to 4-bytes border"),a=!0),a){const n=new Uint8Array(x*Float32Array.BYTES_PER_ELEMENT),B=new Uint8Array(v.buffer,y,n.length);return n.set(B),new Float32Array(n.buffer)}return new Float32Array(v.buffer,y,x)}}return a?v.slice():v}}b._Counter=0,b.BYTE=5120,b.UNSIGNED_BYTE=5121,b.SHORT=5122,b.UNSIGNED_SHORT=5123,b.INT=5124,b.UNSIGNED_INT=5125,b.FLOAT=5126,b.PositionKind="position",b.NormalKind="normal",b.TangentKind="tangent",b.UVKind="uv",b.UV2Kind="uv2",b.UV3Kind="uv3",b.UV4Kind="uv4",b.UV5Kind="uv5",b.UV6Kind="uv6",b.ColorKind="color",b.ColorInstanceKind="instanceColor",b.MatricesIndicesKind="matricesIndices",b.MatricesWeightsKind="matricesWeights",b.MatricesIndicesExtraKind="matricesIndicesExtra",b.MatricesWeightsExtraKind="matricesWeightsExtra"},11129:(v,y,n)=>{"use strict";n.d(y,{b:()=>B});class B{get underlyingResource(){return null}constructor(){this.references=0,this.ob=0,this.is32Bits=!1,this.uniqueId=B._Counter++}}B._Counter=0},12750:(v,y,n)=>{"use strict";n.d(y,{c:()=>F});var B=n(11050),J=n(11055),P=n(10795),b=n(11081),Y=n(11351),l=n(11338),a=n(11151),Z=n(10805),x=n(11086);class f{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(v){this._zoomStopsAnimation=v}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(v){this._idleRotationSpeed=v}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(v){this._idleRotationWaitTime=v}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(v){this._idleRotationSpinupTime=v}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(v){this._attachedCamera=v;const y=this._attachedCamera.va();this._onPrePointerObservableObserver=y.onPrePointerObservable.add((v=>{v.type!==a.d.POINTERDOWN?v.type===a.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=v.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const v=Z.d.Now;let y=0;null!=this._lastFrameTime&&(y=v-this._lastFrameTime),this._lastFrameTime=v,this._applyUserInteraction();const n=v-this._lastInteractionTime-this._idleRotationWaitTime,B=Math.max(Math.min(n/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*B,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(y/1e3))}))}detach(){if(!this._attachedCamera)return;const v=this._attachedCamera.va();this._onPrePointerObservableObserver&&v.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(v){this._lastInteractionTime=v??Z.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<x.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let v=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(v=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?v:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Z.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}n(11567);class N{constructor(){this._easingMode=N.EASINGMODE_EASEIN}setEasingMode(v){const y=Math.min(Math.max(v,0),2);this._easingMode=y}getEasingMode(){return this._easingMode}easeInCore(v){throw new Error("You must implement this method")}ease(v){switch(this._easingMode){case N.EASINGMODE_EASEIN:return this.easeInCore(v);case N.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-v)}return v>=.5?.5*(1-this.easeInCore(2*(1-v)))+.5:.5*this.easeInCore(2*v)}}N.EASINGMODE_EASEIN=0,N.EASINGMODE_EASEOUT=1,N.EASINGMODE_EASEINOUT=2;var i=n(12275);class g{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(v){if(this._autoTransitionRange===v)return;this._autoTransitionRange=v;const y=this._attachedCamera;y&&(v?this._onMeshTargetChangedObserver=y.onMeshTargetChangedObservable.add((v=>{if(v&&(v.ak(!0),v.getBoundingInfo)){const y=v.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*y,this.upperRadiusTransitionRange=.05*y}})):this._onMeshTargetChangedObserver&&y.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(v){this._attachedCamera=v,this._onAfterCheckInputsObserver=v.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(v){return!!this._attachedCamera&&(this._attachedCamera.radius===v&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(v){if(!this._attachedCamera)return;this._radiusBounceTransition||(g.EasingFunction.setEasingMode(g.EasingMode),this._radiusBounceTransition=i.c.CreateAnimation("radius",i.c.ANIMATIONTYPE_FLOAT,60,g.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const y=i.c.TransitionTo("radius",this._attachedCamera.radius+v,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));y&&this._animatables.push(y)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}g.EasingFunction=new class extends N{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=v}easeInCore(v){const y=Math.max(0,this.amplitude);return Math.pow(v,3)-v*y*Math.sin(3.141592653589793*v)}}(.3),g.EasingMode=N.EASINGMODE_EASEOUT;class c{constructor(){this.onTargetFramingAnimationEndObservable=new P.e,this._mode=c.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(v){this._mode=v}get mode(){return this._mode}set radiusScale(v){this._radiusScale=v}get radiusScale(){return this._radiusScale}set positionScale(v){this._positionScale=v}get positionScale(){return this._positionScale}set defaultElevation(v){this._defaultElevation=v}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(v){this._elevationReturnTime=v}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(v){this._elevationReturnWaitTime=v}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(v){this._zoomStopsAnimation=v}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(v){this._framingTime=v}get framingTime(){return this._framingTime}init(){}attach(v){this._attachedCamera=v;const y=this._attachedCamera.va();c.EasingFunction.setEasingMode(c.EasingMode),this._onPrePointerObservableObserver=y.onPrePointerObservable.add((v=>{v.type!==a.d.POINTERDOWN?v.type===a.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=v.onMeshTargetChangedObservable.add((v=>{v&&v.getBoundingInfo&&this.zoomOnMesh(v,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=v.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const v=this._attachedCamera.va();this._onPrePointerObservableObserver&&v.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;v.ak(!0);const B=v.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(B.minimumWorld,B.maximumWorld,y,n)}zoomOnMeshHierarchy(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;v.ak(!0);const B=v.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(B.min,B.max,y,n)}zoomOnMeshesHierarchy(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new b.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),J=new b.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let P=0;P<v.length;P++){const y=v[P].getHierarchyBoundingVectors(!0);b.n.CheckExtends(y.min,B,J),b.n.CheckExtends(y.max,B,J)}this.zoomOnBoundingInfo(B,J,y,n)}zoomOnBoundingInfo(v,y){let n,B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const P=v.y,Y=P+(y.y-P)*this._positionScale,l=y.od(v).scale(.5);if(B)n=new b.n(0,Y,0);else{const y=v.add(l);n=new b.n(y.x,Y,y.z)}this._vectorTransition||(this._vectorTransition=i.c.CreateAnimation("target",i.c.ANIMATIONTYPE_VECTOR3,60,c.EasingFunction)),this._betaIsAnimating=!0;let a=i.c.TransitionTo("target",n,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);a&&this._animatables.push(a);let Z=0;if(this._mode===c.FitFrustumSidesMode){const n=this._calculateLowerRadiusFromModelBoundingSphere(v,y);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=l.length()+this._attachedCamera.ij),Z=n}else this._mode===c.IgnoreBoundsSizeMode&&(Z=this._calculateLowerRadiusFromModelBoundingSphere(v,y),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ij));if(this.autoCorrectCameraLimitsAndSensibility){const n=y.od(v).length();this._attachedCamera.panningSensibility=5e3/n,this._attachedCamera.wheelPrecision=100/Z}return this._radiusTransition||(this._radiusTransition=i.c.CreateAnimation("radius",i.c.ANIMATIONTYPE_FLOAT,60,c.EasingFunction)),a=i.c.TransitionTo("radius",Z,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),J&&J(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),a&&this._animatables.push(a),!0}_calculateLowerRadiusFromModelBoundingSphere(v,y){const n=this._attachedCamera;if(!n)return 0;let B=n._calculateLowerRadiusFromModelBoundingSphere(v,y,this._radiusScale);return n.lowerRadiusLimit&&this._mode===c.IgnoreBoundsSizeMode&&(B=B<n.lowerRadiusLimit?n.lowerRadiusLimit:B),n.upperRadiusLimit&&(B=B>n.upperRadiusLimit?n.upperRadiusLimit:B),B}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const v=Z.d.Now-this._lastInteractionTime,y=.5*Math.PI-this._defaultElevation,n=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>n&&v>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=i.c.CreateAnimation("beta",i.c.ANIMATIONTYPE_FLOAT,60,c.EasingFunction));const v=i.c.TransitionTo("beta",y,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));v&&this._animatables.push(v)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=Z.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}c.EasingFunction=new class extends N{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=v}easeInCore(v){return this.exponent<=0?v:(Math.exp(this.exponent*v)-1)/(Math.exp(this.exponent)-1)}},c.EasingMode=N.EASINGMODE_EASEINOUT,c.IgnoreBoundsSizeMode=0,c.FitFrustumSidesMode=1;var h=n(11348),E=n(12259),W=n(12263),s=n(10791);class C{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(v){v=s.g.BackCompatCameraNoPreventDefault(arguments);const y=this.camera.getEngine(),n=y.getInputElement();let B=0,J=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=P=>{var b,Y;const l=P.event,Z="touch"===l.pointerType;if(P.type!==a.d.POINTERMOVE&&-1===this.buttons.indexOf(l.button))return;const x=l.target;if(this._altKey=l.altKey,this._ctrlKey=l.ctrlKey,this._metaKey=l.metaKey,this._shiftKey=l.shiftKey,this._buttonsPressed=l.buttons,y.isPointerLock){const v=l.movementX,y=l.movementY;this.onTouch(null,v,y),this._pointA=null,this._pointB=null}else{if(P.type!==a.d.POINTERDOWN&&P.type!==a.d.POINTERDOUBLETAP&&Z&&(null===(b=this._pointA)||void 0===b?void 0:b.pointerId)!==l.pointerId&&(null===(Y=this._pointB)||void 0===Y?void 0:Y.pointerId)!==l.pointerId)return;if(P.type!==a.d.POINTERDOWN||-1!==this._currentActiveButton&&!Z)if(P.type===a.d.POINTERDOUBLETAP)this.onDoubleTap(l.pointerType);else if(P.type!==a.d.POINTERUP||this._currentActiveButton!==l.button&&!Z){if(P.type===a.d.POINTERMOVE)if(v||l.preventDefault(),this._pointA&&null===this._pointB){const v=l.clientX-this._pointA.x,y=l.clientY-this._pointA.y;this._pointA.x=l.clientX,this._pointA.y=l.clientY,this.onTouch(this._pointA,v,y)}else if(this._pointA&&this._pointB){const v=this._pointA.pointerId===l.pointerId?this._pointA:this._pointB;v.x=l.clientX,v.y=l.clientY;const y=this._pointA.x-this._pointB.x,n=this._pointA.y-this._pointB.y,b=y*y+n*n,Y={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:l.pointerId,type:P.type};this.onMultiTouch(this._pointA,this._pointB,B,b,J,Y),J=Y,B=b}}else{try{null===x||void 0===x||x.releasePointerCapture(l.pointerId)}catch(f){}Z||(this._pointB=null),y._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==l.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==l.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==B||J)&&(this.onMultiTouch(this._pointA,this._pointB,B,0,J,null),B=0,J=null),this._currentActiveButton=-1,this.onButtonUp(l),v||l.preventDefault()}else{try{null===x||void 0===x||x.setPointerCapture(l.pointerId)}catch(f){}if(null===this._pointA)this._pointA={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType};else{if(null!==this._pointB)return;this._pointB={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType}}-1!==this._currentActiveButton||Z||(this._currentActiveButton=l.button),this.onButtonDown(l),v||(l.preventDefault(),n&&n.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,a.d.POINTERDOWN|a.d.POINTERUP|a.d.POINTERMOVE|a.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,B=0,J=null,this.onLostFocus()},this._contextMenuBind=v=>this.onContextMenu(v),n&&n.addEventListener("contextmenu",this._contextMenuBind,!1);const P=this.camera.va().getEngine().getHostWindow();P&&s.g.RegisterTopRootEvents(P,[{name:"blur",handler:this._onLostFocus}])}ej(){if(this._onLostFocus){const v=this.camera.va().getEngine().getHostWindow();v&&s.g.UnregisterTopRootEvents(v,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const v=this.camera.va().getEngine().getInputElement();v&&v.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(v){}onTouch(v,y,n){}onMultiTouch(v,y,n,B,J,P){}onContextMenu(v){v.preventDefault()}onButtonDown(v){}onButtonUp(v){}onLostFocus(){}}(0,B.c)([(0,J.M)()],C.prototype,"buttons",void 0);class r extends C{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(v,y){if(0!==this.panningSensibility&&v&&y){const n=y.x-v.x,B=y.y-v.y;this.camera.inertialPanningX+=-n/this.panningSensibility,this.camera.inertialPanningY+=B/this.panningSensibility}}_computePinchZoom(v,y){const n=this.camera.radius||r.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=n*Math.sqrt(v)/Math.sqrt(y):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(y-v)*n*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(y-v)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(v,y,n){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-y/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility):(this.camera.inertialAlphaOffset-=y/this.angularSensibilityX,this.camera.inertialBetaOffset-=n/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(v,y,n,B,J,P){0===n&&null===J||0===B&&null===P||(this.multiTouchPanAndZoom?(this._computePinchZoom(n,B),this._computeMultiTouchPanning(J,P)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(B)-Math.sqrt(n))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(n,B),this._isPinching=!0):this._computeMultiTouchPanning(J,P)):this.multiTouchPanning?this._computeMultiTouchPanning(J,P):this.pinchZoom&&this._computePinchZoom(n,B))}onButtonDown(v){this._isPanClick=v.button===this.camera._panningMouseButton}onButtonUp(v){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}r.MinimumRadiusForPinch=.001,(0,B.c)([(0,J.M)()],r.prototype,"buttons",void 0),(0,B.c)([(0,J.M)()],r.prototype,"angularSensibilityX",void 0),(0,B.c)([(0,J.M)()],r.prototype,"angularSensibilityY",void 0),(0,B.c)([(0,J.M)()],r.prototype,"pinchPrecision",void 0),(0,B.c)([(0,J.M)()],r.prototype,"pinchDeltaPercentage",void 0),(0,B.c)([(0,J.M)()],r.prototype,"useNaturalPinchZoom",void 0),(0,B.c)([(0,J.M)()],r.prototype,"pinchZoom",void 0),(0,B.c)([(0,J.M)()],r.prototype,"panningSensibility",void 0),(0,B.c)([(0,J.M)()],r.prototype,"multiTouchPanning",void 0),(0,B.c)([(0,J.M)()],r.prototype,"multiTouchPanAndZoom",void 0),W.c.ArcRotateCameraPointersInput=r;var u=n(11160);class O{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(v){v=s.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((y=>{const n=y.event;if(!n.metaKey)if(y.type===u.b.KEYDOWN){if(this._ctrlPressed=n.ctrlKey,this._altPressed=n.altKey,-1!==this.keysUp.indexOf(n.keyCode)||-1!==this.keysDown.indexOf(n.keyCode)||-1!==this.keysLeft.indexOf(n.keyCode)||-1!==this.keysRight.indexOf(n.keyCode)||-1!==this.keysReset.indexOf(n.keyCode)){-1===this._keys.indexOf(n.keyCode)&&this._keys.push(n.keyCode),n.preventDefault&&(v||n.preventDefault())}}else if(-1!==this.keysUp.indexOf(n.keyCode)||-1!==this.keysDown.indexOf(n.keyCode)||-1!==this.keysLeft.indexOf(n.keyCode)||-1!==this.keysRight.indexOf(n.keyCode)||-1!==this.keysReset.indexOf(n.keyCode)){const y=this._keys.indexOf(n.keyCode);y>=0&&this._keys.splice(y,1),n.preventDefault&&(v||n.preventDefault())}})))}ej(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const v=this.camera;for(let y=0;y<this._keys.length;y++){const n=this._keys[y];-1!==this.keysLeft.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?v.inertialPanningX-=1/this.panningSensibility:v.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?v.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?v.inertialRadiusOffset+=1/this.zoomingSensibility:v.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?v.inertialPanningX+=1/this.panningSensibility:v.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?v.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?v.inertialRadiusOffset-=1/this.zoomingSensibility:v.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(n)&&v.useInputToRestoreState&&v.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,B.c)([(0,J.M)()],O.prototype,"keysUp",void 0),(0,B.c)([(0,J.M)()],O.prototype,"keysDown",void 0),(0,B.c)([(0,J.M)()],O.prototype,"keysLeft",void 0),(0,B.c)([(0,J.M)()],O.prototype,"keysRight",void 0),(0,B.c)([(0,J.M)()],O.prototype,"keysReset",void 0),(0,B.c)([(0,J.M)()],O.prototype,"panningSensibility",void 0),(0,B.c)([(0,J.M)()],O.prototype,"zoomingSensibility",void 0),(0,B.c)([(0,J.M)()],O.prototype,"useAltToZoom",void 0),(0,B.c)([(0,J.M)()],O.prototype,"angularSpeed",void 0),W.c.ArcRotateCameraKeyboardMoveInput=O;var d=n(11180),q=n(11162),L=n(11091);class t{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new b.n(0,0,0),this._globalOffset=new b.n(0,0,0),this._inertialPanning=b.n.Zero()}_computeDeltaFromMouseWheelLegacyEvent(v,y){let n=0;const B=.01*v*this.wheelDeltaPercentage*y;return n=v>0?B/(1+this.wheelDeltaPercentage):B*(1+this.wheelDeltaPercentage),n}attachControl(v){v=s.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=y=>{if(y.type!==a.d.POINTERWHEEL)return;const n=y.event;let B=0;const J=n.deltaMode===q.e.DOM_DELTA_LINE?40:1,P=-n.deltaY*J;if(this.customComputeDeltaFromMouseWheel)B=this.customComputeDeltaFromMouseWheel(P,this,n);else if(this.wheelDeltaPercentage){if(B=this._computeDeltaFromMouseWheelLegacyEvent(P,this.camera.radius),B>0){let v=this.camera.radius,y=this.camera.inertialRadiusOffset+B;for(let n=0;n<20&&Math.abs(y)>.001;n++)v-=y,y*=this.camera.inertia;v=(0,L.c)(v,0,Number.MAX_VALUE),B=this._computeDeltaFromMouseWheelLegacyEvent(P,v)}}else B=P/(40*this.wheelPrecision);B&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(B)):this.camera.inertialRadiusOffset+=B),n.preventDefault&&(v||n.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,a.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.xe(0)}ej(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const v=this.camera;0+v.inertialAlphaOffset+v.inertialBetaOffset+v.inertialRadiusOffset&&(this._updateHitPlane(),v.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(v.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const v=this.camera,y=v.target.od(v.position);this._hitPlane=d.e.FromPositionAndNormal(v.target,y)}_getPosition(){const v=this.camera,y=v.va(),n=y.createPickingRay(y.pointerX,y.pointerY,b.d.Identity(),v,!1);0===v.targetScreenOffset.x&&0===v.targetScreenOffset.y||(this._viewOffset.set(v.targetScreenOffset.x,v.targetScreenOffset.y,0),v.getViewMatrix().invertToRef(v._cameraTransformMatrix),this._globalOffset=b.n.TransformNormal(this._viewOffset,v._cameraTransformMatrix),n.origin.addInPlace(this._globalOffset));let B=0;return this._hitPlane&&(B=n.intersectsPlane(this._hitPlane)??0),n.origin.addInPlace(n.direction.scaleInPlace(B))}_zoomToMouse(v){const y=this.camera,n=1-y.inertia;if(y.lowerRadiusLimit){const B=y.lowerRadiusLimit??0;y.radius-(y.inertialRadiusOffset+v)/n<B&&(v=(y.radius-B)*n-y.inertialRadiusOffset)}if(y.upperRadiusLimit){const B=y.upperRadiusLimit??0;y.radius-(y.inertialRadiusOffset+v)/n>B&&(v=(y.radius-B)*n-y.inertialRadiusOffset)}const B=v/n/y.radius,J=this._getPosition(),P=b.i.o[6];J.subtractToRef(y.target,P),P.scaleInPlace(B),P.scaleInPlace(n),this._inertialPanning.addInPlace(P),y.inertialRadiusOffset+=v}_zeroIfClose(v){Math.abs(v.x)<x.b&&(v.x=0),Math.abs(v.y)<x.b&&(v.y=0),Math.abs(v.z)<x.b&&(v.z=0)}}(0,B.c)([(0,J.M)()],t.prototype,"wheelPrecision",void 0),(0,B.c)([(0,J.M)()],t.prototype,"zoomToMouseLocation",void 0),(0,B.c)([(0,J.M)()],t.prototype,"wheelDeltaPercentage",void 0),W.c.ArcRotateCameraMouseWheelInput=t;class G extends W.g{constructor(v){super(v)}addMouseWheel(){return this.add(new t),this}addPointers(){return this.add(new r),this}addKeyboard(){return this.add(new O),this}}var R=n(10908);Y.c.AddNodeConstructor("ArcRotateCamera",((v,y)=>()=>new F(v,0,0,1,b.n.Zero(),y)));class F extends E.e{get target(){return this._target}set target(v){this.setTarget(v)}get targetHost(){return this._targetHost}set targetHost(v){v&&this.setTarget(v)}getTarget(){return this.target}get position(){return this._position}set position(v){this.setPosition(v)}set upVector(v){this._upToYMatrix||(this._yToUpMatrix=new b.d,this._upToYMatrix=new b.d,this._upVector=b.n.Zero()),v.normalize(),this._upVector.p(v),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){b.d.RotationAlignToRef(b.n.UpReadOnly,this._upVector,this._yToUpMatrix),b.d.RotationAlignToRef(this._upVector,b.n.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const v=this.inputs.attached.pointers;return v?v.angularSensibilityX:0}set angularSensibilityX(v){const y=this.inputs.attached.pointers;y&&(y.angularSensibilityX=v)}get angularSensibilityY(){const v=this.inputs.attached.pointers;return v?v.angularSensibilityY:0}set angularSensibilityY(v){const y=this.inputs.attached.pointers;y&&(y.angularSensibilityY=v)}get pinchPrecision(){const v=this.inputs.attached.pointers;return v?v.pinchPrecision:0}set pinchPrecision(v){const y=this.inputs.attached.pointers;y&&(y.pinchPrecision=v)}get pinchDeltaPercentage(){const v=this.inputs.attached.pointers;return v?v.pinchDeltaPercentage:0}set pinchDeltaPercentage(v){const y=this.inputs.attached.pointers;y&&(y.pinchDeltaPercentage=v)}get useNaturalPinchZoom(){const v=this.inputs.attached.pointers;return!!v&&v.useNaturalPinchZoom}set useNaturalPinchZoom(v){const y=this.inputs.attached.pointers;y&&(y.useNaturalPinchZoom=v)}get panningSensibility(){const v=this.inputs.attached.pointers;return v?v.panningSensibility:0}set panningSensibility(v){const y=this.inputs.attached.pointers;y&&(y.panningSensibility=v)}get keysUp(){const v=this.inputs.attached.keyboard;return v?v.keysUp:[]}set keysUp(v){const y=this.inputs.attached.keyboard;y&&(y.keysUp=v)}get keysDown(){const v=this.inputs.attached.keyboard;return v?v.keysDown:[]}set keysDown(v){const y=this.inputs.attached.keyboard;y&&(y.keysDown=v)}get keysLeft(){const v=this.inputs.attached.keyboard;return v?v.keysLeft:[]}set keysLeft(v){const y=this.inputs.attached.keyboard;y&&(y.keysLeft=v)}get keysRight(){const v=this.inputs.attached.keyboard;return v?v.keysRight:[]}set keysRight(v){const y=this.inputs.attached.keyboard;y&&(y.keysRight=v)}get wheelPrecision(){const v=this.inputs.attached.mousewheel;return v?v.wheelPrecision:0}set wheelPrecision(v){const y=this.inputs.attached.mousewheel;y&&(y.wheelPrecision=v)}get zoomToMouseLocation(){const v=this.inputs.attached.mousewheel;return!!v&&v.zoomToMouseLocation}set zoomToMouseLocation(v){const y=this.inputs.attached.mousewheel;y&&(y.zoomToMouseLocation=v)}get wheelDeltaPercentage(){const v=this.inputs.attached.mousewheel;return v?v.wheelDeltaPercentage:0}set wheelDeltaPercentage(v){const y=this.inputs.attached.mousewheel;y&&(y.wheelDeltaPercentage=v)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(v){v!==this.useBouncingBehavior&&(v?(this._bouncingBehavior=new g,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(v){v!==this.useFramingBehavior&&(v?(this._framingBehavior=new c,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(v){v!==this.useAutoRotationBehavior&&(v?(this._autoRotationBehavior=new f,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(v,y,n,B,J,Y){var l;let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(v,b.n.Zero(),Y,a),l=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=b.n.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=b.j.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new b.d,this.panningAxis=new b.n(1,1,0),this._transformedDirection=new b.n,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new P.e,this.checkCollisions=!1,this.collisionRadius=new b.n(.5,.5,.5),this._previousPosition=b.n.Zero(),this._collisionVelocity=b.n.Zero(),this._newPosition=b.n.Zero(),this._computationVector=b.n.Zero(),this._onCollisionPositionChange=function(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n?(l.setPosition(y),l.Wk&&l.Wk(n)):l._previousPosition.p(l._position);const B=Math.cos(l.alpha),J=Math.sin(l.alpha),P=Math.cos(l.beta);let b=Math.sin(l.beta);0===b&&(b=1e-4);const Y=l._getTargetPosition();l._computationVector.Ae(l.radius*B*b,l.radius*P,l.radius*J*b),Y.addToRef(l._computationVector,l._newPosition),l._position.p(l._newPosition);let a=l.upVector;l.allowUpsideDown&&l.beta<0&&(a=a.clone(),a=a.negate()),l._computeViewMatrix(l._position,Y,a),l._viewMatrix.addAtIndex(12,l.targetScreenOffset.x),l._viewMatrix.addAtIndex(13,l.targetScreenOffset.y),l._collisionTriggered=!1},this._target=b.n.Zero(),J&&this.setTarget(J),this.alpha=y,this.beta=n,this.radius=B,this.getViewMatrix(),this.inputs=new G(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new b.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=b.j.Zero()}_updateCache(v){v||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const v=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?v.addToRef(this._targetBoundingCenter,this._target):this._target.p(v)}const v=this._getLockedTargetPosition();return v||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>x.b&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(v,y){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const J=arguments;y=s.g.BackCompatCameraNoPreventDefault(J),this._useCtrlForPanning=n,this._panningMouseButton=B,"boolean"===typeof J[0]&&(J.length>1&&(this._useCtrlForPanning=J[1]),J.length>2&&(this._panningMouseButton=J[2])),this.inputs.attachElement(y),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}ej(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const v=this._scene.getEngine().getDeltaTime()/1e3,y=1-Math.pow(2,-v/this.restoreStateInterpolationFactor);this.setTarget(b.n.Lerp(this.getTarget(),this._storedTarget,y)),b.g.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,b.i.Quaternion[0]),b.g.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,b.i.Quaternion[1]),b.g.SlerpToRef(b.i.Quaternion[1],b.i.Quaternion[0],y,b.i.Quaternion[2]),b.i.Quaternion[2].normalize(),b.i.Quaternion[2].toAlphaBetaGammaToRef(b.i.o[0]),this.alpha=b.i.o[0].x,this.beta=b.i.o[0].y,this.radius+=(this._storedRadius-this.radius)*y,b.j.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,y,this.targetScreenOffset),(b.n.DistanceSquared(this.getTarget(),this._storedTarget)<x.b&&b.i.Quaternion[2].equalsWithEpsilon(b.i.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<x.b&&b.j.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<x.b||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const v=this.invertRotation?-1:1,y=this._calculateHandednessMultiplier();let n=this.inertialAlphaOffset*y;this.beta<0&&(n*=-1),this.alpha+=n*v,this.beta+=this.inertialBetaOffset*v,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<x.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<x.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*x.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const v=new b.n(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),v.multiplyInPlace(this.panningAxis),b.n.TransformNormalToRef(v,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const v=this.upVector,y=b.n.CrossToRef(this._transformedDirection,v,this._transformedDirection);b.n.CrossToRef(v,y,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);b.n.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const v=b.i.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(v),v.transposeToRef(v),b.n.TransformCoordinatesToRef(this._transformedDirection,v,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*x.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*x.b&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||b.n.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const v=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const y=Math.round((v-this.alpha)/(2*Math.PI));this.alpha+=2*y*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(v){this._position.equals(v)||(this._position.p(v),this.rebuildAnglesAndRadius())}setTarget(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(B=this.overrideCloneAlphaBetaRadius??B,v.ak)y&&v.getBoundingInfo?this._targetBoundingCenter=v.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,v.ak(),this._targetHost=v,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const y=v,B=this._getTargetPosition();if(B&&!n&&B.equals(y))return;this._targetHost=null,this._target=y,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}B||this.rebuildAnglesAndRadius()}_getViewMatrix(){const v=Math.cos(this.alpha),y=Math.sin(this.alpha),n=Math.cos(this.beta);let B=Math.sin(this.beta);0===B&&(B=1e-4),0===this.radius&&(this.radius=1e-4);const J=this._getTargetPosition();if(this._computationVector.Ae(this.radius*v*B,this.radius*n,this.radius*y*B),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||b.n.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),J.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const v=this.va().collisionCoordinator;this._collider||(this._collider=v.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,v.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let v=this.upVector;this.allowUpsideDown&&B<0&&(v=v.negate()),this._computeViewMatrix(this._position,J,v),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=J,this._viewMatrix}zoomOn(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v=v||this.va().meshes;const n=l.d.MinMax(v);let B=this._calculateLowerRadiusFromModelBoundingSphere(n.min,n.max);B=Math.max(Math.min(B,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=B*this.zoomOnFactor,this.focusOn({min:n.min,max:n.max,distance:B},y)}focusOn(v){let y,n,B=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===v.min){const B=v||this.va().meshes;y=l.d.MinMax(B),n=b.n.Distance(y.min,y.max)}else{y=v,n=v.distance}this._target=l.d.Center(y),B||(this.maxZ=2*n)}createRigCamera(v,y){let n=0;switch(this.cameraRigMode){case h.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case h.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case h.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case h.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case h.c.RIG_MODE_VR:n=this._cameraRigParams.stereoHalfAngle*(0===y?1:-1);break;case h.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:n=this._cameraRigParams.stereoHalfAngle*(0===y?-1:1)}const B=new F(v,this.alpha+n,this.beta,this.radius,this._target,this.va());return B._cameraRigParams={},B.isRigCamera=!0,B.rigParent=this,B.upVector=this.upVector,B.mode=this.mode,B.orthoLeft=this.orthoLeft,B.orthoRight=this.orthoRight,B.orthoBottom=this.orthoBottom,B.orthoTop=this.orthoTop,B}_updateRigCameras(){const v=this._rigCameras[0],y=this._rigCameras[1];switch(v.beta=y.beta=this.beta,this.cameraRigMode){case h.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case h.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case h.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case h.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case h.c.RIG_MODE_VR:v.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,y.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case h.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:v.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,y.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const B=b.n.Distance(v,y),J=this.va().getEngine().getAspectRatio(this),P=Math.tan(this.fov/2),Y=P*J,l=.5*B*n,a=l*Math.sqrt(1+1/(Y*Y)),Z=l*Math.sqrt(1+1/(P*P));return Math.max(a,Z)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,B.c)([(0,J.M)()],F.prototype,"alpha",void 0),(0,B.c)([(0,J.M)()],F.prototype,"beta",void 0),(0,B.c)([(0,J.M)()],F.prototype,"radius",void 0),(0,B.c)([(0,J.M)()],F.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,B.c)([(0,J.I)("target")],F.prototype,"_target",void 0),(0,B.c)([(0,J.x)("targetHost")],F.prototype,"_targetHost",void 0),(0,B.c)([(0,J.M)()],F.prototype,"inertialAlphaOffset",void 0),(0,B.c)([(0,J.M)()],F.prototype,"inertialBetaOffset",void 0),(0,B.c)([(0,J.M)()],F.prototype,"inertialRadiusOffset",void 0),(0,B.c)([(0,J.M)()],F.prototype,"lowerAlphaLimit",void 0),(0,B.c)([(0,J.M)()],F.prototype,"upperAlphaLimit",void 0),(0,B.c)([(0,J.M)()],F.prototype,"lowerBetaLimit",void 0),(0,B.c)([(0,J.M)()],F.prototype,"upperBetaLimit",void 0),(0,B.c)([(0,J.M)()],F.prototype,"lowerRadiusLimit",void 0),(0,B.c)([(0,J.M)()],F.prototype,"upperRadiusLimit",void 0),(0,B.c)([(0,J.M)()],F.prototype,"inertialPanningX",void 0),(0,B.c)([(0,J.M)()],F.prototype,"inertialPanningY",void 0),(0,B.c)([(0,J.M)()],F.prototype,"pinchToPanMaxDistance",void 0),(0,B.c)([(0,J.M)()],F.prototype,"panningDistanceLimit",void 0),(0,B.c)([(0,J.I)()],F.prototype,"panningOriginTarget",void 0),(0,B.c)([(0,J.M)()],F.prototype,"panningInertia",void 0),(0,B.c)([(0,J.M)()],F.prototype,"zoomToMouseLocation",null),(0,B.c)([(0,J.M)()],F.prototype,"zoomOnFactor",void 0),(0,B.c)([(0,J.H)()],F.prototype,"targetScreenOffset",void 0),(0,B.c)([(0,J.M)()],F.prototype,"allowUpsideDown",void 0),(0,B.c)([(0,J.M)()],F.prototype,"useInputToRestoreState",void 0),(0,B.c)([(0,J.M)()],F.prototype,"restoreStateInterpolationFactor",void 0),(0,R.g)("BABYLON.ArcRotateCamera",F)},11348:(v,y,n)=>{"use strict";n.d(y,{c:()=>c});var B=n(11050),J=n(11055),P=n(11065),b=n(10791),Y=n(10795),l=n(11081),a=n(11351),Z=n(10801),x=n(10908),f=n(10811),N=n(11355),i=n(11171),g=n(11110);class c extends a.c{get position(){return this._position}set position(v){this._position=v}set upVector(v){this._upVector=v}get upVector(){return this._upVector}get screenArea(){let v=0,y=0;if(this.mode===c.PERSPECTIVE_CAMERA)this.fovMode===c.FOVMODE_VERTICAL_FIXED?(y=2*this.ij*Math.tan(this.fov/2),v=this.getEngine().getAspectRatio(this)*y):(v=2*this.ij*Math.tan(this.fov/2),y=v/this.getEngine().getAspectRatio(this));else{const n=this.getEngine().getRenderWidth()/2,B=this.getEngine().getRenderHeight()/2;v=(this.orthoRight??n)-(this.orthoLeft??-n),y=(this.orthoTop??B)-(this.orthoBottom??-B)}return v*y}set orthoLeft(v){this._orthoLeft=v;for(const y of this._rigCameras)y.orthoLeft=v}get orthoLeft(){return this._orthoLeft}set orthoRight(v){this._orthoRight=v;for(const y of this._rigCameras)y.orthoRight=v}get orthoRight(){return this._orthoRight}set orthoBottom(v){this._orthoBottom=v;for(const y of this._rigCameras)y.orthoBottom=v}get orthoBottom(){return this._orthoBottom}set orthoTop(v){this._orthoTop=v;for(const y of this._rigCameras)y.orthoTop=v}get orthoTop(){return this._orthoTop}set mode(v){this._mode=v;for(const y of this._rigCameras)y.mode=v}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(v,y,n){let B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(v,n,!1),this._position=l.n.Zero(),this._upVector=l.n.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.ij=1,this.maxZ=1e4,this.inertia=.9,this._mode=c.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new N.c(0,0,1,1),this.layerMask=268435455,this.fovMode=c.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=c.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new Y.e,this.onProjectionMatrixChangedObservable=new Y.e,this.onAfterCheckInputsObservable=new Y.e,this.onRestoreStateObservable=new Y.e,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new l.d,this._postProcesses=new Array,this._activeMeshes=new P.e(256),this._globalPosition=l.n.Zero(),this._computedViewMatrix=l.d.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=l.d.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=l.g.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),B&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=y,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${v}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Ph"}toString(v){let y="Name: "+this.name;if(y+=", type: "+this.getClassName(),this.animations)for(let n=0;n<this.animations.length;n++)y+=", animation[0]: "+this.animations[n].toString(v);return y}applyVerticalCorrection(){const v=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-v.x:v.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(v){return-1!==this._activeMeshes.indexOf(v)}isReady(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(v)for(const y of this._postProcesses)if(y&&!y.isReady())return!1;return super.isReady(v)}_initCache(){super._initCache(),this._cache.position=new l.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new l.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.ij=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(v){v||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let v=this._cache.mode===this.mode&&this._cache.ij===this.ij&&this._cache.maxZ===this.maxZ;if(!v)return!1;const y=this.getEngine();return this.mode===c.PERSPECTIVE_CAMERA?v=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===y.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(v=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===y.getRenderWidth()&&this._cache.renderHeight===y.getRenderHeight(),this.oblique&&(v=v&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),v}attachControl(v,y){}ej(v){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==c.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let v=0;v<this._postProcesses.length;v++)if(null!==this._postProcesses[v])return this._postProcesses[v];return null}_cascadePostProcessesToRigCams(){const v=this._getFirstPostProcess();v&&v.markTextureDirty();for(let y=0,n=this._rigCameras.length;y<n;y++){const v=this._rigCameras[y],n=v._rigPostProcess;if(n){"pass"===n.getEffectName()&&(v.isIntermediate=0===this._postProcesses.length),v._postProcesses=this._postProcesses.slice(0).concat(n),n.markTextureDirty()}else v._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!v.isReusable()&&this._postProcesses.indexOf(v)>-1?(Z.e.Error("You're trying to reuse a post process not defined as reusable."),0):(null==y||y<0?this._postProcesses.push(v):null===this._postProcesses[y]?this._postProcesses[y]=v:this._postProcesses.splice(y,0,v),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.eh(),this._postProcesses.indexOf(v))}detachPostProcess(v){const y=this._postProcesses.indexOf(v);-1!==y&&(this._postProcesses[y]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.eh(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return l.d.Identity()}getViewMatrix(v){return!v&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(v){this._doNotComputeProjectionMatrix=!0,void 0!==v&&(this._projectionMatrix=v)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(v){if(this._doNotComputeProjectionMatrix||!v&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.ij=this.ij,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const y=this.getEngine(),n=this.va(),B=y.useReverseDepthBuffer;if(this.mode===c.PERSPECTIVE_CAMERA){let v;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=y.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.ij<=0&&(this.ij=.1),v=n.useRightHandedSystem?l.d.PerspectiveFovRHToRef:l.d.PerspectiveFovLHToRef,v(this.fov,y.getAspectRatio(this),B?this.maxZ:this.ij,B?this.ij:this.maxZ,this._projectionMatrix,this.fovMode===c.FOVMODE_VERTICAL_FIXED,y.isNDCHalfZRange,this.projectionPlaneTilt,B)}else{var J,P,b;const v=y.getRenderWidth()/2,Y=y.getRenderHeight()/2;n.useRightHandedSystem?this.oblique?l.d.ObliqueOffCenterRHToRef(this.orthoLeft??-v,this.orthoRight??v,this.orthoBottom??-Y,this.orthoTop??Y,B?this.maxZ:this.ij,B?this.ij:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,y.isNDCHalfZRange):l.d.OrthoOffCenterRHToRef(this.orthoLeft??-v,this.orthoRight??v,this.orthoBottom??-Y,this.orthoTop??Y,B?this.maxZ:this.ij,B?this.ij:this.maxZ,this._projectionMatrix,y.isNDCHalfZRange):this.oblique?l.d.ObliqueOffCenterLHToRef(this.orthoLeft??-v,this.orthoRight??v,this.orthoBottom??-Y,this.orthoTop??Y,B?this.maxZ:this.ij,B?this.ij:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,y.isNDCHalfZRange):l.d.OrthoOffCenterLHToRef(this.orthoLeft??-v,this.orthoRight??v,this.orthoBottom??-Y,this.orthoTop??Y,B?this.maxZ:this.ij,B?this.ij:this.maxZ,this._projectionMatrix,y.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(J=this.oblique)||void 0===J?void 0:J.angle,this._cache.obliqueLength=null===(P=this.oblique)||void 0===P?void 0:P.length,this._cache.obliqueOffset=null===(b=this.oblique)||void 0===b?void 0:b.offset,this._cache.renderWidth=y.getRenderWidth(),this._cache.renderHeight=y.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(v){return(this.radius||(this.target?l.n.Distance(this.position,this.target):this.position.length()))+v}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?i.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=i.e.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),y&&this.rigCameras.length>0){let y=!1;return this.rigCameras.forEach((n=>{n._updateFrustumPlanes(),y=y||v.isInFrustum(n._frustumPlanes)})),y}return v.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(v){return this._updateFrustumPlanes(),v.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,f.e)("Ray")}getForwardRayToRef(v){throw(0,f.e)("Ray")}dispose(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const v=this._rigCameras.pop();v&&v.dispose()}if(this._parentContainer){const v=this._parentContainer.cameras.indexOf(this);v>-1&&this._parentContainer.cameras.splice(v,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==c.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let v=this._postProcesses.length;for(;--v>=0;){const y=this._postProcesses[v];y&&y.dispose(this)}}let n=this.customRenderTargets.length;for(;--n>=0;)this.customRenderTargets[n].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(v,y)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(v,y){if(this.cameraRigMode!==v){for(;this._rigCameras.length>0;){const v=this._rigCameras.pop();v&&v.dispose()}if(this.cameraRigMode=v,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=y.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=b.g.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==c.RIG_MODE_NONE){const v=this.createRigCamera(this.name+"_L",0);v&&(v._isLeftCamera=!0);const y=this.createRigCamera(this.name+"_R",1);y&&(y._isRightCamera=!0),v&&y&&(this._rigCameras.push(v),this._rigCameras.push(y))}this._setRigMode(y),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(v){}_getVRProjectionMatrix(){return l.d.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.ij,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(v,y){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[v]=y,"interaxialDistance"===v&&(this._cameraRigParams.stereoHalfAngle=b.g.ToRadians(y/.0637))}createRigCamera(v,y){return null}_updateRigCameras(){for(let v=0;v<this._rigCameras.length;v++)this._rigCameras[v].ij=this.ij,this._rigCameras[v].maxZ=this.maxZ,this._rigCameras[v].fov=this.fov,this._rigCameras[v].upVector.p(this.upVector);this.cameraRigMode===c.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const v=g.d.Serialize(this);return v.uniqueId=this.uniqueId,v.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(v),this.inputs&&this.inputs.serialize(v),g.d.AppendSerializedAnimations(this,v),v.ranges=this.serializeAnimationRanges(),v.isEnabled=this.isEnabled(),v}clone(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=g.d.Clone(c.GetConstructorFromName(this.getClassName(),v,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return n.name=v,n.parent=y,this.onClonedObservable.notifyObservers(n),n}uf(v){const y=l.n.Zero();return this.getDirectionToRef(v,y),y}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(v,y){l.n.TransformNormalToRef(v,this.getWorldMatrix(),y)}static GetConstructorFromName(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,J=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const P=a.c.Construct(v,y,n,{interaxial_distance:B,isStereoscopicSideBySide:J});return P||(()=>c._CreateDefaultParsedCamera(y,n))}ak(){return this.getWorldMatrix()}static Parse(v,y){const n=v.type,B=c.GetConstructorFromName(n,v.name,y,v.interaxial_distance,v.isStereoscopicSideBySide),J=g.d.Parse(B,v,y);if(void 0!==v.parentId&&(J._waitingParentId=v.parentId),void 0!==v.parentInstanceIndex&&(J._waitingParentInstanceIndex=v.parentInstanceIndex),J.inputs&&(J.inputs.parse(v),J._setupInputs()),v.upVector&&(J.upVector=l.n.qh(v.upVector)),J.setPosition&&(J.position.Ae(0,0,0),J.setPosition(l.n.qh(v.position))),v.target&&J.setTarget&&J.setTarget(l.n.qh(v.target)),v.cameraRigMode){const y=v.interaxial_distance?{interaxialDistance:v.interaxial_distance}:{};J.setCameraRigMode(v.cameraRigMode,y)}if(v.animations){for(let y=0;y<v.animations.length;y++){const n=v.animations[y],B=(0,x.d)("BABYLON.Animation");B&&J.animations.push(B.Parse(n))}a.c.ParseAnimationRanges(J,v,y)}return v.autoAnimate&&y.beginAnimation(J,v.autoAnimateFrom,v.autoAnimateTo,v.autoAnimateLoop,v.autoAnimateSpeed||1),void 0!==v.isEnabled&&J.Nb(v.isEnabled),J}_calculateHandednessMultiplier(){let v=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(v*=-1),v}}c._CreateDefaultParsedCamera=(v,y)=>{throw(0,f.e)("UniversalCamera")},c.PERSPECTIVE_CAMERA=0,c.ORTHOGRAPHIC_CAMERA=1,c.FOVMODE_VERTICAL_FIXED=0,c.FOVMODE_HORIZONTAL_FIXED=1,c.RIG_MODE_NONE=0,c.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,c.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,c.RIG_MODE_STEREOSCOPIC_INTERLACED=14,c.RIG_MODE_VR=20,c.RIG_MODE_CUSTOM=22,c.ForceAttachControlToAlwaysPreventDefault=!1,(0,B.c)([(0,J.I)("position")],c.prototype,"_position",void 0),(0,B.c)([(0,J.I)("upVector")],c.prototype,"_upVector",void 0),(0,B.c)([(0,J.M)()],c.prototype,"orthoLeft",null),(0,B.c)([(0,J.M)()],c.prototype,"orthoRight",null),(0,B.c)([(0,J.M)()],c.prototype,"orthoBottom",null),(0,B.c)([(0,J.M)()],c.prototype,"orthoTop",null),(0,B.c)([(0,J.M)()],c.prototype,"fov",void 0),(0,B.c)([(0,J.M)()],c.prototype,"projectionPlaneTilt",void 0),(0,B.c)([(0,J.M)()],c.prototype,"ij",void 0),(0,B.c)([(0,J.M)()],c.prototype,"maxZ",void 0),(0,B.c)([(0,J.M)()],c.prototype,"inertia",void 0),(0,B.c)([(0,J.M)()],c.prototype,"mode",null),(0,B.c)([(0,J.M)()],c.prototype,"layerMask",void 0),(0,B.c)([(0,J.M)()],c.prototype,"fovMode",void 0),(0,B.c)([(0,J.M)()],c.prototype,"cameraRigMode",void 0),(0,B.c)([(0,J.M)()],c.prototype,"interaxialDistance",void 0),(0,B.c)([(0,J.M)()],c.prototype,"isStereoscopicSideBySide",void 0)},12263:(v,y,n)=>{"use strict";n.d(y,{c:()=>b,g:()=>Y});var B=n(10801),J=n(11110),P=n(11348),b={};class Y{constructor(v){this.attachedToElement=!1,this.attached={},this.camera=v,this.checkInputs=()=>{}}add(v){const y=v.getSimpleName();this.attached[y]?B.e.Warn("camera input of type "+y+" already exists on camera"):(this.attached[y]=v,v.camera=this.camera,v.checkInputs&&(this.checkInputs=this._addCheckInputs(v.checkInputs.bind(v))),this.attachedToElement&&v.attachControl(this.noPreventDefault))}remove(v){for(const y in this.attached){const n=this.attached[y];if(n===v)return n.ej(),n.camera=null,delete this.attached[y],void this.rebuildInputCheck()}}removeByType(v){for(const y in this.attached){const n=this.attached[y];n.getClassName()===v&&(n.ej(),n.camera=null,delete this.attached[y],this.rebuildInputCheck())}}_addCheckInputs(v){const y=this.checkInputs;return()=>{y(),v()}}attachInput(v){this.attachedToElement&&v.attachControl(this.noPreventDefault)}attachElement(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){v=!P.c.ForceAttachControlToAlwaysPreventDefault&&v,this.attachedToElement=!0,this.noPreventDefault=v;for(const y in this.attached)this.attached[y].attachControl(v)}}detachElement(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const y in this.attached)this.attached[y].ej(),v&&(this.attached[y].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const v in this.attached){const y=this.attached[v];y.checkInputs&&(this.checkInputs=this._addCheckInputs(y.checkInputs.bind(y)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(v){const y={};for(const n in this.attached){const v=this.attached[n],B=J.d.Serialize(v);y[v.getClassName()]=B}v.inputsmgr=y}parse(v){const y=v.inputsmgr;if(y){this.clear();for(const v in y){const n=b[v];if(n){const B=y[v],P=J.d.Parse((()=>new n),B,null);this.add(P)}}}else for(const n in this.attached){const y=b[this.attached[n].getClassName()];if(y){const B=J.d.Parse((()=>new y),v,null);this.remove(this.attached[n]),this.add(B)}}}}},12253:(v,y,n)=>{"use strict";n.d(y,{b:()=>r});var B=n(11050),J=n(11055),P=n(11081),b=n(12259),Y=n(12263),l=n(11160),a=n(10791);class Z{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(v){v=a.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((y=>{const n=y.event;if(!n.metaKey)if(y.type===l.b.KEYDOWN){if(-1!==this.keysUp.indexOf(n.keyCode)||-1!==this.keysDown.indexOf(n.keyCode)||-1!==this.keysLeft.indexOf(n.keyCode)||-1!==this.keysRight.indexOf(n.keyCode)||-1!==this.keysUpward.indexOf(n.keyCode)||-1!==this.keysDownward.indexOf(n.keyCode)||-1!==this.keysRotateLeft.indexOf(n.keyCode)||-1!==this.keysRotateRight.indexOf(n.keyCode)||-1!==this.keysRotateUp.indexOf(n.keyCode)||-1!==this.keysRotateDown.indexOf(n.keyCode)){-1===this._keys.indexOf(n.keyCode)&&this._keys.push(n.keyCode),v||n.preventDefault()}}else if(-1!==this.keysUp.indexOf(n.keyCode)||-1!==this.keysDown.indexOf(n.keyCode)||-1!==this.keysLeft.indexOf(n.keyCode)||-1!==this.keysRight.indexOf(n.keyCode)||-1!==this.keysUpward.indexOf(n.keyCode)||-1!==this.keysDownward.indexOf(n.keyCode)||-1!==this.keysRotateLeft.indexOf(n.keyCode)||-1!==this.keysRotateRight.indexOf(n.keyCode)||-1!==this.keysRotateUp.indexOf(n.keyCode)||-1!==this.keysRotateDown.indexOf(n.keyCode)){const y=this._keys.indexOf(n.keyCode);y>=0&&this._keys.splice(y,1),v||n.preventDefault()}})))}ej(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const v=this.camera;for(let y=0;y<this._keys.length;y++){const n=this._keys[y],B=v._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(n)?v._localDirection.Ae(-B,0,0):-1!==this.keysUp.indexOf(n)?v._localDirection.Ae(0,0,B):-1!==this.keysRight.indexOf(n)?v._localDirection.Ae(B,0,0):-1!==this.keysDown.indexOf(n)?v._localDirection.Ae(0,0,-B):-1!==this.keysUpward.indexOf(n)?v._localDirection.Ae(0,B,0):-1!==this.keysDownward.indexOf(n)?v._localDirection.Ae(0,-B,0):-1!==this.keysRotateLeft.indexOf(n)?(v._localDirection.Ae(0,0,0),v.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(n)?(v._localDirection.Ae(0,0,0),v.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(n)?(v._localDirection.Ae(0,0,0),v.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(n)&&(v._localDirection.Ae(0,0,0),v.cameraRotation.x+=this._getLocalRotation()),v.va().useRightHandedSystem&&(v._localDirection.z*=-1),v.getViewMatrix().invertToRef(v._cameraTransformMatrix),P.n.TransformNormalToRef(v._localDirection,v._cameraTransformMatrix,v._transformedDirection),v.cameraDirection.addInPlace(v._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const v=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*v}}(0,B.c)([(0,J.M)()],Z.prototype,"keysUp",void 0),(0,B.c)([(0,J.M)()],Z.prototype,"keysUpward",void 0),(0,B.c)([(0,J.M)()],Z.prototype,"keysDown",void 0),(0,B.c)([(0,J.M)()],Z.prototype,"keysDownward",void 0),(0,B.c)([(0,J.M)()],Z.prototype,"keysLeft",void 0),(0,B.c)([(0,J.M)()],Z.prototype,"keysRight",void 0),(0,B.c)([(0,J.M)()],Z.prototype,"rotationSpeed",void 0),(0,B.c)([(0,J.M)()],Z.prototype,"keysRotateLeft",void 0),(0,B.c)([(0,J.M)()],Z.prototype,"keysRotateRight",void 0),(0,B.c)([(0,J.M)()],Z.prototype,"keysRotateUp",void 0),(0,B.c)([(0,J.M)()],Z.prototype,"keysRotateDown",void 0),Y.c.FreeCameraKeyboardMoveInput=Z;var x=n(10795),f=n(11151);class N{constructor(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=v,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new x.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(v){v=a.g.BackCompatCameraNoPreventDefault(arguments);const y=this.camera.getEngine(),n=y.getInputElement();this._pointerInput||(this._pointerInput=B=>{const J=B.event,P="touch"===J.pointerType;if(!this.touchEnabled&&P)return;if(B.type!==f.d.POINTERMOVE&&-1===this.buttons.indexOf(J.button))return;const b=J.target;if(B.type===f.d.POINTERDOWN){if(P&&-1!==this._activePointerId||!P&&-1!==this._currentActiveButton)return;this._activePointerId=J.pointerId;try{null===b||void 0===b||b.setPointerCapture(J.pointerId)}catch(Y){}-1===this._currentActiveButton&&(this._currentActiveButton=J.button),this._previousPosition={x:J.clientX,y:J.clientY},v||(J.preventDefault(),n&&n.focus()),y.isPointerLock&&this._onMouseMove&&this._onMouseMove(B.event)}else if(B.type===f.d.POINTERUP){if(P&&this._activePointerId!==J.pointerId||!P&&this._currentActiveButton!==J.button)return;try{null===b||void 0===b||b.releasePointerCapture(J.pointerId)}catch(Y){}this._currentActiveButton=-1,this._previousPosition=null,v||J.preventDefault(),this._activePointerId=-1}else if(B.type===f.d.POINTERMOVE&&(this._activePointerId===J.pointerId||!P))if(y.isPointerLock&&this._onMouseMove)this._onMouseMove(B.event);else if(this._previousPosition){const y=this.camera._calculateHandednessMultiplier(),n=(J.clientX-this._previousPosition.x)*y,B=J.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=n/this.angularSensibility,this.camera.cameraRotation.x+=B/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:n,offsetY:B}),this._previousPosition={x:J.clientX,y:J.clientY},v||J.preventDefault()}}),this._onMouseMove=n=>{if(!y.isPointerLock)return;const B=this.camera._calculateHandednessMultiplier(),J=n.movementX*B;this.camera.cameraRotation.y+=J/this.angularSensibility;const P=n.movementY;this.camera.cameraRotation.x+=P/this.angularSensibility,this._previousPosition=null,v||n.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,f.d.POINTERDOWN|f.d.POINTERUP|f.d.POINTERMOVE),n&&(this._contextMenuBind=v=>this.onContextMenu(v),n.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(v){v.preventDefault()}ej(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const v=this.camera.getEngine().getInputElement();v&&v.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,B.c)([(0,J.M)()],N.prototype,"buttons",void 0),(0,B.c)([(0,J.M)()],N.prototype,"angularSensibility",void 0),Y.c.FreeCameraMouseInput=N;var i,g=n(11162);class c{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new x.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(v){v=a.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=y=>{if(y.type!==f.d.POINTERWHEEL)return;const n=y.event,B=n.deltaMode===g.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*B*n.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*B*n.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*B*n.deltaZ/this._normalize,n.preventDefault&&(v||n.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,f.d.POINTERWHEEL)}ej(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,B.c)([(0,J.M)()],c.prototype,"wheelPrecisionX",void 0),(0,B.c)([(0,J.M)()],c.prototype,"wheelPrecisionY",void 0),(0,B.c)([(0,J.M)()],c.prototype,"wheelPrecisionZ",void 0),function(v){v[v.MoveRelative=0]="MoveRelative",v[v.RotateRelative=1]="RotateRelative",v[v.MoveScene=2]="MoveScene"}(i||(i={}));class h extends c{constructor(){super(...arguments),this._moveRelative=P.n.Zero(),this._rotateRelative=P.n.Zero(),this._moveScene=P.n.Zero(),this._wheelXAction=i.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=i.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(v){null===v&&this._wheelXAction!==i.MoveRelative||(this._wheelXAction=i.MoveRelative,this._wheelXActionCoordinate=v)}get wheelXMoveRelative(){return this._wheelXAction!==i.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(v){null===v&&this._wheelYAction!==i.MoveRelative||(this._wheelYAction=i.MoveRelative,this._wheelYActionCoordinate=v)}get wheelYMoveRelative(){return this._wheelYAction!==i.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(v){null===v&&this._wheelZAction!==i.MoveRelative||(this._wheelZAction=i.MoveRelative,this._wheelZActionCoordinate=v)}get wheelZMoveRelative(){return this._wheelZAction!==i.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(v){null===v&&this._wheelXAction!==i.RotateRelative||(this._wheelXAction=i.RotateRelative,this._wheelXActionCoordinate=v)}get wheelXRotateRelative(){return this._wheelXAction!==i.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(v){null===v&&this._wheelYAction!==i.RotateRelative||(this._wheelYAction=i.RotateRelative,this._wheelYActionCoordinate=v)}get wheelYRotateRelative(){return this._wheelYAction!==i.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(v){null===v&&this._wheelZAction!==i.RotateRelative||(this._wheelZAction=i.RotateRelative,this._wheelZActionCoordinate=v)}get wheelZRotateRelative(){return this._wheelZAction!==i.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(v){null===v&&this._wheelXAction!==i.MoveScene||(this._wheelXAction=i.MoveScene,this._wheelXActionCoordinate=v)}get wheelXMoveScene(){return this._wheelXAction!==i.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(v){null===v&&this._wheelYAction!==i.MoveScene||(this._wheelYAction=i.MoveScene,this._wheelYActionCoordinate=v)}get wheelYMoveScene(){return this._wheelYAction!==i.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(v){null===v&&this._wheelZAction!==i.MoveScene||(this._wheelZAction=i.MoveScene,this._wheelZActionCoordinate=v)}get wheelZMoveScene(){return this._wheelZAction!==i.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.xe(0),this._rotateRelative.xe(0),this._moveScene.xe(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const v=P.d.Zero();this.camera.getViewMatrix().invertToRef(v);const y=P.n.Zero();P.n.TransformNormalToRef(this._moveRelative,v,y),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(y),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(v,y,n){if(0===v)return;if(null===y||null===n)return;let B=null;switch(y){case i.MoveRelative:B=this._moveRelative;break;case i.RotateRelative:B=this._rotateRelative;break;case i.MoveScene:B=this._moveScene}switch(n){case 0:B.set(v,0,0);break;case 1:B.set(0,v,0);break;case 2:B.set(0,0,v)}}}(0,B.c)([(0,J.M)()],h.prototype,"wheelXMoveRelative",null),(0,B.c)([(0,J.M)()],h.prototype,"wheelYMoveRelative",null),(0,B.c)([(0,J.M)()],h.prototype,"wheelZMoveRelative",null),(0,B.c)([(0,J.M)()],h.prototype,"wheelXRotateRelative",null),(0,B.c)([(0,J.M)()],h.prototype,"wheelYRotateRelative",null),(0,B.c)([(0,J.M)()],h.prototype,"wheelZRotateRelative",null),(0,B.c)([(0,J.M)()],h.prototype,"wheelXMoveScene",null),(0,B.c)([(0,J.M)()],h.prototype,"wheelYMoveScene",null),(0,B.c)([(0,J.M)()],h.prototype,"wheelZMoveScene",null),Y.c.FreeCameraMouseWheelInput=h;class E{constructor(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=v,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=a.g.IsSafari()}attachControl(v){v=a.g.BackCompatCameraNoPreventDefault(arguments);let y=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=n=>{const B=n.event,J="mouse"===B.pointerType||this._isSafari&&"undefined"===typeof B.pointerType;if(this.allowMouse||!J)if(n.type===f.d.POINTERDOWN){if(v||B.preventDefault(),this._pointerPressed.push(B.pointerId),1!==this._pointerPressed.length)return;y={x:B.clientX,y:B.clientY}}else if(n.type===f.d.POINTERUP){v||B.preventDefault();const n=this._pointerPressed.indexOf(B.pointerId);if(-1===n)return;if(this._pointerPressed.splice(n,1),0!=n)return;y=null,this._offsetX=null,this._offsetY=null}else if(n.type===f.d.POINTERMOVE){if(v||B.preventDefault(),!y)return;if(0!=this._pointerPressed.indexOf(B.pointerId))return;this._offsetX=B.clientX-y.x,this._offsetY=-(B.clientY-y.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,f.d.POINTERDOWN|f.d.POINTERUP|f.d.POINTERMOVE),this._onLostFocus){const v=this.camera.getEngine().getInputElement();v&&v.addEventListener("blur",this._onLostFocus)}}ej(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const v=this.camera.getEngine().getInputElement();v&&v.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const v=this.camera,y=v._calculateHandednessMultiplier();v.cameraRotation.y=y*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)v.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const y=v._computeLocalCameraSpeed(),n=new P.n(0,0,0!==this.touchMoveSensibility?y*this._offsetY/this.touchMoveSensibility:0);P.d.RotationYawPitchRollToRef(v.rotation.y,v.rotation.x,0,v._cameraRotationMatrix),v.cameraDirection.addInPlace(P.n.TransformCoordinates(n,v._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,B.c)([(0,J.M)()],E.prototype,"touchAngularSensibility",void 0),(0,B.c)([(0,J.M)()],E.prototype,"touchMoveSensibility",void 0),Y.c.FreeCameraTouchInput=E;class W extends Y.g{constructor(v){super(v),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new Z),this}addMouse(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new N(v),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new h,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new E),this}clear(){super.clear(),this._mouseInput=null}}var s=n(10908),C=n(10849);class r extends b.e{get angularSensibility(){const v=this.inputs.attached.mouse;return v?v.angularSensibility:0}set angularSensibility(v){const y=this.inputs.attached.mouse;y&&(y.angularSensibility=v)}get keysUp(){const v=this.inputs.attached.keyboard;return v?v.keysUp:[]}set keysUp(v){const y=this.inputs.attached.keyboard;y&&(y.keysUp=v)}get keysUpward(){const v=this.inputs.attached.keyboard;return v?v.keysUpward:[]}set keysUpward(v){const y=this.inputs.attached.keyboard;y&&(y.keysUpward=v)}get keysDown(){const v=this.inputs.attached.keyboard;return v?v.keysDown:[]}set keysDown(v){const y=this.inputs.attached.keyboard;y&&(y.keysDown=v)}get keysDownward(){const v=this.inputs.attached.keyboard;return v?v.keysDownward:[]}set keysDownward(v){const y=this.inputs.attached.keyboard;y&&(y.keysDownward=v)}get keysLeft(){const v=this.inputs.attached.keyboard;return v?v.keysLeft:[]}set keysLeft(v){const y=this.inputs.attached.keyboard;y&&(y.keysLeft=v)}get keysRight(){const v=this.inputs.attached.keyboard;return v?v.keysRight:[]}set keysRight(v){const y=this.inputs.attached.keyboard;y&&(y.keysRight=v)}get keysRotateLeft(){const v=this.inputs.attached.keyboard;return v?v.keysRotateLeft:[]}set keysRotateLeft(v){const y=this.inputs.attached.keyboard;y&&(y.keysRotateLeft=v)}get keysRotateRight(){const v=this.inputs.attached.keyboard;return v?v.keysRotateRight:[]}set keysRotateRight(v){const y=this.inputs.attached.keyboard;y&&(y.keysRotateRight=v)}get keysRotateUp(){const v=this.inputs.attached.keyboard;return v?v.keysRotateUp:[]}set keysRotateUp(v){const y=this.inputs.attached.keyboard;y&&(y.keysRotateUp=v)}get keysRotateDown(){const v=this.inputs.attached.keyboard;return v?v.keysRotateDown:[]}set keysRotateDown(v){const y=this.inputs.attached.keyboard;y&&(y.keysRotateDown=v)}constructor(v,y,n){var B;super(v,y,n,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),B=this,this.ellipsoid=new P.n(.5,1,.5),this.ellipsoidOffset=new P.n(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=P.n.Zero(),this._diffPosition=P.n.Zero(),this._newPosition=P.n.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;B._newPosition.p(y),B._newPosition.subtractToRef(B._oldPosition,B._diffPosition),B._diffPosition.length()>C.c.CollisionsEpsilon&&(B.position.addToRef(B._diffPosition,B._deferredPositionUpdate),B._deferOnly?B._deferredUpdated=!0:B.position.p(B._deferredPositionUpdate),B.Wk&&n&&B.Wk(n))},this.inputs=new W(this),this.inputs.addKeyboard().addMouse()}attachControl(v,y){y=a.g.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(y)}ej(){this.inputs.detachElement(),this.cameraDirection=new P.n(0,0,0),this.cameraRotation=new P.j(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(v){this._collisionMask=isNaN(v)?-1:v}_collideWithWorld(v){let y;y=this.parent?P.n.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,y.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const n=this.va().collisionCoordinator;this._collider||(this._collider=n.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let B=v;this.applyGravity&&(B=v.add(this.va().gravity)),n.getNewPosition(this._oldPosition,B,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=P.n.Zero(),this._transformedDirection=P.n.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(v){this._needMoveForGravity=v}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"jb"}}(0,B.c)([(0,J.I)()],r.prototype,"ellipsoid",void 0),(0,B.c)([(0,J.I)()],r.prototype,"ellipsoidOffset",void 0),(0,B.c)([(0,J.M)()],r.prototype,"checkCollisions",void 0),(0,B.c)([(0,J.M)()],r.prototype,"applyGravity",void 0),(0,s.g)("BABYLON.FreeCamera",r)},12259:(v,y,n)=>{"use strict";n.d(y,{e:()=>a});var B=n(11050),J=n(11055),P=n(11348),b=n(11081),Y=n(11086),l=n(11390);n(11351).c.AddNodeConstructor("TargetCamera",((v,y)=>()=>new a(v,b.n.Zero(),y)));class a extends P.c{constructor(v,y,n){super(v,y,n,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=b.n.Zero(),this._tmpTargetVector=b.n.Zero(),this.cameraDirection=new b.n(0,0,0),this.cameraRotation=new b.j(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new b.g,this.rotation=new b.n(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=b.n.Zero(),this._initialFocalDistance=1,this._viewMatrix=b.d.Zero(),this._camMatrix=b.d.Zero(),this._cameraTransformMatrix=b.d.Zero(),this._cameraRotationMatrix=b.d.Zero(),this._referencePoint=new b.n(0,0,1),this._transformedReferencePoint=b.n.Zero(),this._deferredPositionUpdate=new b.n,this._deferredRotationQuaternionUpdate=new b.g,this._deferredRotationUpdate=new b.n,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=b.n.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(v){this.getWorldMatrix();const y=this.getTarget().od(this.position);return y.normalize(),y.scaleInPlace(v),this.globalPosition.add(y)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const v=this.lockedTarget;v.ak().getTranslationToRef(v.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Ae(0,0,0),this.cameraRotation.Ae(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new b.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new b.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new b.g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(v){v||super._updateCache();const y=this._getLockedTargetPosition();y?this._cache.lockedTarget?this._cache.lockedTarget.p(y):this._cache.lockedTarget=y.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const v=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(v):!v)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const v=this.getEngine();return this.speed*Math.sqrt(v.getDeltaTime()/(100*v.getFps()))}setTarget(v){this.upVector.normalize(),this._initialFocalDistance=v.od(this.position).length(),this.position.z===v.z&&(this.position.z+=Y.b),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),b.d.LookAtLHToRef(this.position,v,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const y=v.od(this.position);y.x>=0?this.rotation.y=-Math.atan(y.z/y.x)+Math.PI/2:this.rotation.y=-Math.atan(y.z/y.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&b.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(v){this.setTarget(v)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(b.i.Matrix[0]),b.n.TransformNormalToRef(this.cameraDirection,b.i.Matrix[0],b.i.o[0]),this._deferredPositionUpdate.addInPlace(b.i.o[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const v=this.invertRotation?-this.inverseRotationSpeed:1,y=this._decideIfNeedsToMove(),n=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),y&&this._updatePosition(),n){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*v,this._deferredRotationUpdate.y+=this.cameraRotation.y*v,!this.noRotationConstraint){const v=1.570796;this._deferredRotationUpdate.x>v&&(this._deferredRotationUpdate.x=v),this._deferredRotationUpdate.x<-v&&(this._deferredRotationUpdate.x=-v)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(b.g.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}y&&(Math.abs(this.cameraDirection.x)<this.speed*Y.b&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*Y.b&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*Y.b&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),n&&(Math.abs(this.cameraRotation.x)<this.speed*Y.b&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*Y.b&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):b.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return b.n.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),b.n.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?l.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(b.g.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),l.c.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(v,y,n){if(this.ignoreParentScaling){if(this.parent){const B=this.parent.getWorldMatrix();b.n.TransformCoordinatesToRef(v,B,this._globalPosition),b.n.TransformCoordinatesToRef(y,B,this._tmpTargetVector),b.n.TransformNormalToRef(n,B,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(v),this._tmpTargetVector.p(y),this._tmpUpVector.p(n);this.va().useRightHandedSystem?b.d.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):b.d.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?b.d.LookAtRHToRef(v,y,n,this._viewMatrix):b.d.LookAtLHToRef(v,y,n,this._viewMatrix),this.parent){const v=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(v,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(v)}createRigCamera(v,y){if(this.cameraRigMode!==P.c.RIG_MODE_NONE){const y=new a(v,this.position.clone(),this.va());return y.isRigCamera=!0,y.rigParent=this,this.cameraRigMode===P.c.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new b.g),y._cameraRigParams={},y.rotationQuaternion=new b.g),y.mode=this.mode,y.orthoLeft=this.orthoLeft,y.orthoRight=this.orthoRight,y.orthoTop=this.orthoTop,y.orthoBottom=this.orthoBottom,y}return null}_updateRigCameras(){const v=this._rigCameras[0],y=this._rigCameras[1];switch(this.ak(),this.cameraRigMode){case P.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case P.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case P.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case P.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case P.c.RIG_MODE_STEREOSCOPIC_INTERLACED:{const n=this.cameraRigMode===P.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,B=this.cameraRigMode===P.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*n,v),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*B,y);break}case P.c.RIG_MODE_VR:v.rotationQuaternion?(v.rotationQuaternion.p(this.rotationQuaternion),y.rotationQuaternion.p(this.rotationQuaternion)):(v.rotation.p(this.rotation),y.rotation.p(this.rotation)),v.position.p(this.position),y.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(v,y){this.getTarget().subtractToRef(this.position,a._TargetFocalPoint),a._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const n=a._TargetFocalPoint.addInPlace(this.position);b.d.TranslationToRef(-n.x,-n.y,-n.z,a._TargetTransformMatrix),a._TargetTransformMatrix.multiplyToRef(b.d.RotationAxis(y.upVector,v),a._RigCamTransformMatrix),b.d.TranslationToRef(n.x,n.y,n.z,a._TargetTransformMatrix),a._RigCamTransformMatrix.multiplyToRef(a._TargetTransformMatrix,a._RigCamTransformMatrix),b.n.TransformCoordinatesToRef(this.position,a._RigCamTransformMatrix,y.position),y.setTarget(n)}getClassName(){return"TargetCamera"}}a._RigCamTransformMatrix=new b.d,a._TargetTransformMatrix=new b.d,a._TargetFocalPoint=new b.n,(0,B.c)([(0,J.I)()],a.prototype,"rotation",void 0),(0,B.c)([(0,J.M)()],a.prototype,"speed",void 0),(0,B.c)([(0,J.x)("lockedTargetId")],a.prototype,"lockedTarget",void 0)},11208:(v,y,n)=>{"use strict";n.d(y,{b:()=>B});class B{constructor(v,y,n){this.bu=v,this.bv=y,this.distance=n,this.faceId=0,this.subMeshId=0}}},11125:(v,y,n)=>{"use strict";n.d(y,{c:()=>P});var B=n(11081),J=n(11127);class P{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var v;let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||n&&!this.pickedMesh.isVerticesDataPresent(J.i.NormalKind))return null;let P,b=this.pickedMesh.wg();0===(null===(v=b)||void 0===v?void 0:v.length)&&(b=null);const Y=B.i.o[0],l=B.i.o[1],a=B.i.o[2];if(n){const v=this.pickedMesh.getVerticesData(J.i.NormalKind);let y=b?B.n.FromArrayToRef(v,3*b[3*this.faceId],Y):Y.Ae(v[3*this.faceId*3],v[3*this.faceId*3+1],v[3*this.faceId*3+2]),n=b?B.n.FromArrayToRef(v,3*b[3*this.faceId+1],l):l.Ae(v[3*(3*this.faceId+1)],v[3*(3*this.faceId+1)+1],v[3*(3*this.faceId+1)+2]),Z=b?B.n.FromArrayToRef(v,3*b[3*this.faceId+2],a):a.Ae(v[3*(3*this.faceId+2)],v[3*(3*this.faceId+2)+1],v[3*(3*this.faceId+2)+2]);y=y.scale(this.bu),n=n.scale(this.bv),Z=Z.scale(1-this.bu-this.bv),P=new B.n(y.x+n.x+Z.x,y.y+n.y+Z.y,y.z+n.z+Z.z)}else{const v=this.pickedMesh.getVerticesData(J.i.PositionKind),y=b?B.n.FromArrayToRef(v,3*b[3*this.faceId],Y):Y.Ae(v[3*this.faceId*3],v[3*this.faceId*3+1],v[3*this.faceId*3+2]),n=b?B.n.FromArrayToRef(v,3*b[3*this.faceId+1],l):l.Ae(v[3*(3*this.faceId+1)],v[3*(3*this.faceId+1)+1],v[3*(3*this.faceId+1)+2]),Z=b?B.n.FromArrayToRef(v,3*b[3*this.faceId+2],a):a.Ae(v[3*(3*this.faceId+2)],v[3*(3*this.faceId+2)+1],v[3*(3*this.faceId+2)+2]),x=y.od(n),f=Z.od(n);P=B.n.Cross(x,f)}const Z=(v,y)=>{let n=v.getWorldMatrix();v.nonUniformScaling&&(B.i.Matrix[0].p(n),n=B.i.Matrix[0],n.setTranslationFromFloats(0,0,0),n.invert(),n.transposeToRef(B.i.Matrix[1]),n=B.i.Matrix[1]),B.n.TransformNormalToRef(y,n,y)};if(y&&Z(this.pickedMesh,P),this.ray){const v=B.i.o[0].p(P);y||Z(this.pickedMesh,v),B.n.Dot(v,this.ray.direction)>0&&P.negateInPlace()}return P.normalize(),P}getTextureCoordinates(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.i.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(v))return null;const y=this.pickedMesh.wg();if(!y)return null;const n=this.pickedMesh.getVerticesData(v);if(!n)return null;let P=B.j.qh(n,2*y[3*this.faceId]),b=B.j.qh(n,2*y[3*this.faceId+1]),Y=B.j.qh(n,2*y[3*this.faceId+2]);return P=P.scale(this.bu),b=b.scale(this.bv),Y=Y.scale(1-this.bu-this.bv),new B.j(P.x+b.x+Y.x,P.y+b.y+Y.y)}}},11295:(v,y,n)=>{"use strict";n.d(y,{e:()=>B});let B=!1},12813:(v,y,n)=>{"use strict";n.d(y,{e:()=>P});var B=n(11065),J=n(12818);class P{constructor(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=n,this.Bi=[],this._maxBlockCapacity=y||64,this._selectionContent=new B.b(1024),this._creationFunc=v}update(v,y,n){J.e._CreateBlocks(v,y,n,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Ai(v){for(let y=0;y<this.Uh.length;y++){this.Uh[y].addEntry(v)}}sd(v){for(let y=0;y<this.Uh.length;y++){this.Uh[y].removeEntry(v)}}select(v,y){this._selectionContent.reset();for(let n=0;n<this.Uh.length;n++){this.Uh[n].select(v,this._selectionContent,y)}return y?this._selectionContent.concat(this.Bi):this._selectionContent.concatWithNoDuplicate(this.Bi),this._selectionContent}intersects(v,y,n){this._selectionContent.reset();for(let B=0;B<this.Uh.length;B++){this.Uh[B].intersects(v,y,this._selectionContent,n)}return n?this._selectionContent.concat(this.Bi):this._selectionContent.concatWithNoDuplicate(this.Bi),this._selectionContent}intersectsRay(v){this._selectionContent.reset();for(let y=0;y<this.Uh.length;y++){this.Uh[y].intersectsRay(v,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Bi),this._selectionContent}}P.CreationFuncForMeshes=(v,y)=>{const n=v.getBoundingInfo();!v.isBlocked&&n.boundingBox.intersectsMinMax(y.Fi,y.Gi)&&y.entries.push(v)},P.CreationFuncForSubMeshes=(v,y)=>{v.getBoundingInfo().boundingBox.intersectsMinMax(y.Fi,y.Gi)&&y.entries.push(v)}},12818:(v,y,n)=>{"use strict";n.d(y,{e:()=>P});var B=n(11081),J=n(11225);class P{constructor(v,y,n,B,J,P){this.entries=[],this.Hi=new Array,this._capacity=n,this._depth=B,this._maxDepth=J,this._creationFunc=P,this._minPoint=v,this._maxPoint=y,this.Hi.push(v.clone()),this.Hi.push(y.clone()),this.Hi.push(v.clone()),this.Hi[2].x=y.x,this.Hi.push(v.clone()),this.Hi[3].y=y.y,this.Hi.push(v.clone()),this.Hi[4].z=y.z,this.Hi.push(y.clone()),this.Hi[5].z=v.z,this.Hi.push(y.clone()),this.Hi[6].x=v.x,this.Hi.push(y.clone()),this.Hi[7].y=v.y}get ob(){return this._capacity}get Fi(){return this._minPoint}get Gi(){return this._maxPoint}addEntry(v){if(this.Uh)for(let y=0;y<this.Uh.length;y++){this.Uh[y].addEntry(v)}else this._creationFunc(v,this),this.entries.length>this.ob&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(v){if(this.Uh){for(let y=0;y<this.Uh.length;y++){this.Uh[y].removeEntry(v)}return}const y=this.entries.indexOf(v);y>-1&&this.entries.splice(y,1)}addEntries(v){for(let y=0;y<v.length;y++){const n=v[y];this.addEntry(n)}}select(v,y,n){if(J.c.IsInFrustum(this.Hi,v)){if(this.Uh){for(let B=0;B<this.Uh.length;B++){this.Uh[B].select(v,y,n)}return}n?y.concat(this.entries):y.concatWithNoDuplicate(this.entries)}}intersects(v,y,n,B){if(J.c.IntersectsSphere(this._minPoint,this._maxPoint,v,y)){if(this.Uh){for(let J=0;J<this.Uh.length;J++){this.Uh[J].intersects(v,y,n,B)}return}B?n.concat(this.entries):n.concatWithNoDuplicate(this.entries)}}intersectsRay(v,y){if(v.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Uh){for(let n=0;n<this.Uh.length;n++){this.Uh[n].intersectsRay(v,y)}return}y.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){P._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(v,y,n,J,b,Y,l,a){l.Uh=new Array;const Z=new B.n((y.x-v.x)/2,(y.y-v.y)/2,(y.z-v.z)/2);for(let B=0;B<2;B++)for(let y=0;y<2;y++)for(let x=0;x<2;x++){const f=v.add(Z.multiplyByFloats(B,y,x)),N=v.add(Z.multiplyByFloats(B+1,y+1,x+1)),i=new P(f,N,J,b+1,Y,a);i.addEntries(n),l.Uh.push(i)}}}},12826:(v,y,n)=>{"use strict";n.d(y,{e:()=>Z});var B=n(11070),J=n(11081),P=n(11383),b=n(11728),Y=n(11149),l=n(12813),a=n(10820);B.e.prototype.createOrUpdateSelectionOctree=function(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=this._getComponent(Y.b.NAME_OCTREE);n||(n=new Z(this),this.fb(n)),this.yi||(this.yi=new l.e(l.e.CreationFuncForMeshes,v,y));const B=this.getWorldExtends();return this.yi.update(B.min,B.max,this.meshes),this.yi},Object.defineProperty(B.e.prototype,"selectionOctree",{get:function(){return this.yi},enumerable:!0,configurable:!0}),P.d.prototype.createOrUpdateSubmeshesOctree=function(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const n=this.va();let B=n._getComponent(Y.b.NAME_OCTREE);B||(B=new Z(n),n.fb(B)),this._submeshesOctree||(this._submeshesOctree=new l.e(l.e.CreationFuncForSubMeshes,v,y)),this.ak(!0);const J=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(J.minimumWorld,J.maximumWorld,this.Ag),this._submeshesOctree};class Z{constructor(v){this.name=Y.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new b.c(J.n.Zero(),new J.n(1,1,1)),(v=v||a.b.LastCreatedScene)&&(this.$d=v,this.$d.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.$d.getActiveSubMeshCandidates=v=>this.getActiveSubMeshCandidates(v),this.$d.getCollidingSubMeshCandidates=(v,y)=>this.getCollidingSubMeshCandidates(v,y),this.$d.getIntersectingSubMeshCandidates=(v,y)=>this.getIntersectingSubMeshCandidates(v,y))}register(){this.$d.onMeshRemovedObservable.add((v=>{const y=this.$d.selectionOctree;if(void 0!==y&&null!==y){const n=y.Bi.indexOf(v);-1!==n&&y.Bi.splice(n,1)}})),this.$d.onMeshImportedObservable.add((v=>{const y=this.$d.selectionOctree;void 0!==y&&null!==y&&y.Ai(v)}))}getActiveMeshCandidates(){var v;return(null===(v=this.$d.yi)||void 0===v?void 0:v.select(this.$d.frustumPlanes))||this.$d._getDefaultMeshCandidates()}getActiveSubMeshCandidates(v){if(v._submeshesOctree&&v.useOctreeForRenderingSelection){return v._submeshesOctree.select(this.$d.frustumPlanes)}return this.$d._getDefaultSubMeshCandidates(v)}getIntersectingSubMeshCandidates(v,y){if(v._submeshesOctree&&v.useOctreeForPicking){b.c.TransformToRef(y,v.getWorldMatrix(),this._tempRay);return v._submeshesOctree.intersectsRay(this._tempRay)}return this.$d._getDefaultSubMeshCandidates(v)}getCollidingSubMeshCandidates(v,y){if(v._submeshesOctree&&v.useOctreeForCollisions){const n=y._velocityWorldLength+Math.max(y._radius.x,y._radius.y,y._radius.z);return v._submeshesOctree.intersects(y._basePointWorld,n)}return this.$d._getDefaultSubMeshCandidates(v)}rebuild(){}dispose(){}}},11225:(v,y,n)=>{"use strict";n.d(y,{c:()=>b});var B=n(11088),J=n(11081),P=n(11086);class b{constructor(v,y,n){this.vectors=(0,B.c)(8,J.n.Zero),this.center=J.n.Zero(),this.centerWorld=J.n.Zero(),this.extendSize=J.n.Zero(),this.extendSizeWorld=J.n.Zero(),this.directions=(0,B.c)(3,J.n.Zero),this.vectorsWorld=(0,B.c)(8,J.n.Zero),this.minimumWorld=J.n.Zero(),this.maximumWorld=J.n.Zero(),this.minimum=J.n.Zero(),this.maximum=J.n.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(v,y,n)}reConstruct(v,y,n){const B=v.x,P=v.y,b=v.z,Y=y.x,l=y.y,a=y.z,Z=this.vectors;this.minimum.Ae(B,P,b),this.maximum.Ae(Y,l,a),Z[0].Ae(B,P,b),Z[1].Ae(Y,l,a),Z[2].Ae(Y,P,b),Z[3].Ae(B,l,b),Z[4].Ae(B,P,a),Z[5].Ae(Y,l,b),Z[6].Ae(B,l,a),Z[7].Ae(Y,P,a),y.addToRef(v,this.center).scaleInPlace(.5),y.subtractToRef(v,this.extendSize).scaleInPlace(.5),this._worldMatrix=n||J.d.IdentityReadOnly,this._update(this._worldMatrix)}scale(v){const y=b._TmpVector3,n=this.maximum.subtractToRef(this.minimum,y[0]),B=n.length();n.normalizeFromLength(B);const J=B*v,P=n.scaleInPlace(.5*J),Y=this.center.subtractToRef(P,y[1]),l=this.center.addToRef(P,y[2]);return this.reConstruct(Y,l,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(v){const y=this.minimumWorld,n=this.maximumWorld,B=this.directions,P=this.vectorsWorld,b=this.vectors;if(v.isIdentity()){y.p(this.minimum),n.p(this.maximum);for(let v=0;v<8;++v)P[v].p(b[v]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{y.xe(Number.MAX_VALUE),n.xe(-Number.MAX_VALUE);for(let B=0;B<8;++B){const Y=P[B];J.n.TransformCoordinatesToRef(b[B],v,Y),y.minimizeInPlace(Y),n.maximizeInPlace(Y)}n.subtractToRef(y,this.extendSizeWorld).scaleInPlace(.5),n.addToRef(y,this.centerWorld).scaleInPlace(.5)}J.n.FromArrayToRef(v.m,0,B[0]),J.n.FromArrayToRef(v.m,4,B[1]),J.n.FromArrayToRef(v.m,8,B[2]),this._worldMatrix=v}isInFrustum(v){return b.IsInFrustum(this.vectorsWorld,v)}isCompletelyInFrustum(v){return b.IsCompletelyInFrustum(this.vectorsWorld,v)}intersectsPoint(v){const y=this.minimumWorld,n=this.maximumWorld,B=y.x,J=y.y,b=y.z,Y=n.x,l=n.y,a=n.z,Z=v.x,x=v.y,f=v.z,N=-P.b;return!(Y-Z<N||N>Z-B)&&(!(l-x<N||N>x-J)&&!(a-f<N||N>f-b))}intersectsSphere(v){return b.IntersectsSphere(this.minimumWorld,this.maximumWorld,v.centerWorld,v.radiusWorld)}intersectsMinMax(v,y){const n=this.minimumWorld,B=this.maximumWorld,J=n.x,P=n.y,b=n.z,Y=B.x,l=B.y,a=B.z,Z=v.x,x=v.y,f=v.z,N=y.x,i=y.y,g=y.z;return!(Y<Z||J>N)&&(!(l<x||P>i)&&!(a<f||b>g))}dispose(){var v,y;null===(v=this._drawWrapperFront)||void 0===v||v.dispose(),null===(y=this._drawWrapperBack)||void 0===y||y.dispose()}static Intersects(v,y){return v.intersectsMinMax(y.minimumWorld,y.maximumWorld)}static IntersectsSphere(v,y,n,B){const P=b._TmpVector3[0];J.n.ClampToRef(n,v,y,P);return J.n.DistanceSquared(n,P)<=B*B}static IsCompletelyInFrustum(v,y){for(let n=0;n<6;++n){const B=y[n];for(let y=0;y<8;++y)if(B.dotCoordinate(v[y])<0)return!1}return!0}static IsInFrustum(v,y){for(let n=0;n<6;++n){let B=!0;const J=y[n];for(let y=0;y<8;++y)if(J.dotCoordinate(v[y])>=0){B=!1;break}if(B)return!1}return!0}}b._TmpVector3=(0,B.c)(3,J.n.Zero)},11216:(v,y,n)=>{"use strict";n.d(y,{c:()=>x});var B=n(11088),J=n(11081),P=n(11225),b=n(11233);const Y={min:0,max:0},l={min:0,max:0},a=(v,y,n)=>{const B=J.n.Dot(y.centerWorld,v),P=Math.abs(J.n.Dot(y.directions[0],v))*y.extendSize.x+Math.abs(J.n.Dot(y.directions[1],v))*y.extendSize.y+Math.abs(J.n.Dot(y.directions[2],v))*y.extendSize.z;n.min=B-P,n.max=B+P},Z=(v,y,n)=>(a(v,y,Y),a(v,n,l),!(Y.min>l.max||l.min>Y.max));class x{constructor(v,y,n){this._isLocked=!1,this.boundingBox=new P.c(v,y,n),this.boundingSphere=new b.b(v,y,n)}reConstruct(v,y,n){this.boundingBox.reConstruct(v,y,n),this.boundingSphere.reConstruct(v,y,n)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(v){this._isLocked=v}update(v){this._isLocked||(this.boundingBox._update(v),this.boundingSphere._update(v))}centerOn(v,y){const n=x._TmpVector3[0].p(v).Ei(y),B=x._TmpVector3[1].p(v).addInPlace(y);return this.boundingBox.reConstruct(n,B,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(n,B,this.boundingBox.getWorldMatrix()),this}encapsulate(v){const y=J.n.Minimize(this.minimum,v),n=J.n.Maximize(this.maximum,v);return this.reConstruct(y,n,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(v){const y=J.i.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(y);const n=J.i.o[0];return J.n.TransformCoordinatesToRef(v.boundingBox.minimumWorld,y,n),this.encapsulate(n),J.n.TransformCoordinatesToRef(v.boundingBox.maximumWorld,y,n),this.encapsulate(n),this}scale(v){return this.boundingBox.scale(v),this.boundingSphere.scale(v),this}isInFrustum(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===y||3===y)&&this.boundingSphere.isCenterInFrustum(v))return!0;if(!this.boundingSphere.isInFrustum(v))return!1;return!(1!==y&&3!==y)||this.boundingBox.isInFrustum(v)}get diagonalLength(){const v=this.boundingBox;return v.maximumWorld.subtractToRef(v.minimumWorld,x._TmpVector3[0]).length()}isCompletelyInFrustum(v){return this.boundingBox.isCompletelyInFrustum(v)}_checkCollision(v){return v._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(v){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(v)&&!!this.boundingBox.intersectsPoint(v))}intersects(v,y){if(!b.b.Intersects(this.boundingSphere,v.boundingSphere))return!1;if(!P.c.Intersects(this.boundingBox,v.boundingBox))return!1;if(!y)return!0;const n=this.boundingBox,B=v.boundingBox;return!!Z(n.directions[0],n,B)&&(!!Z(n.directions[1],n,B)&&(!!Z(n.directions[2],n,B)&&(!!Z(B.directions[0],n,B)&&(!!Z(B.directions[1],n,B)&&(!!Z(B.directions[2],n,B)&&(!!Z(J.n.Cross(n.directions[0],B.directions[0]),n,B)&&(!!Z(J.n.Cross(n.directions[0],B.directions[1]),n,B)&&(!!Z(J.n.Cross(n.directions[0],B.directions[2]),n,B)&&(!!Z(J.n.Cross(n.directions[1],B.directions[0]),n,B)&&(!!Z(J.n.Cross(n.directions[1],B.directions[1]),n,B)&&(!!Z(J.n.Cross(n.directions[1],B.directions[2]),n,B)&&(!!Z(J.n.Cross(n.directions[2],B.directions[0]),n,B)&&(!!Z(J.n.Cross(n.directions[2],B.directions[1]),n,B)&&!!Z(J.n.Cross(n.directions[2],B.directions[2]),n,B))))))))))))))}}x._TmpVector3=(0,B.c)(2,J.n.Zero)},11233:(v,y,n)=>{"use strict";n.d(y,{b:()=>P});var B=n(11088),J=n(11081);class P{constructor(v,y,n){this.center=J.n.Zero(),this.centerWorld=J.n.Zero(),this.minimum=J.n.Zero(),this.maximum=J.n.Zero(),this.reConstruct(v,y,n)}reConstruct(v,y,n){this.minimum.p(v),this.maximum.p(y);const B=J.n.Distance(v,y);y.addToRef(v,this.center).scaleInPlace(.5),this.radius=.5*B,this._update(n||J.d.IdentityReadOnly)}scale(v){const y=this.radius*v,n=P._TmpVector3,B=n[0].xe(y),J=this.center.subtractToRef(B,n[1]),b=this.center.addToRef(B,n[2]);return this.reConstruct(J,b,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(v){if(v.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.radius;else{J.n.TransformCoordinatesToRef(this.center,v,this.centerWorld);const y=P._TmpVector3[0];J.n.TransformNormalFromFloatsToRef(1,1,1,v,y),this.radiusWorld=Math.max(Math.abs(y.x),Math.abs(y.y),Math.abs(y.z))*this.radius}}isInFrustum(v){const y=this.centerWorld,n=this.radiusWorld;for(let B=0;B<6;B++)if(v[B].dotCoordinate(y)<=-n)return!1;return!0}isCenterInFrustum(v){const y=this.centerWorld;for(let n=0;n<6;n++)if(v[n].dotCoordinate(y)<0)return!1;return!0}intersectsPoint(v){const y=J.n.DistanceSquared(this.centerWorld,v);return!(this.radiusWorld*this.radiusWorld<y)}static Intersects(v,y){const n=J.n.DistanceSquared(v.centerWorld,y.centerWorld),B=v.radiusWorld+y.radiusWorld;return!(B*B<n)}static CreateFromCenterAndRadius(v,y,n){this._TmpVector3[0].p(v),this._TmpVector3[1].Ae(0,0,y),this._TmpVector3[2].p(v),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Ei(this._TmpVector3[1]);const B=new P(this._TmpVector3[0],this._TmpVector3[2]);return B._worldMatrix=n||J.d.Identity(),B}}P._TmpVector3=(0,B.c)(3,J.n.Zero)},11728:(v,y,n)=>{"use strict";n.d(y,{c:()=>N});var B=n(11070),J=n(11348),P=n(11086),b=n(11081),Y=n(11088),l=n(11208),a=n(11125),Z=n(10820),x=n(11166);const f={internalPickerForMesh:void 0};class N{constructor(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P.b;this.origin=v,this.direction=y,this.length=n,this.epsilon=B}clone(){return new N(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const B=N._TmpVector3[0].Ae(v.x-n,v.y-n,v.z-n),J=N._TmpVector3[1].Ae(y.x+n,y.y+n,y.z+n);let P,b,Y,l,a=0,Z=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<B.x||this.origin.x>J.x)return!1}else if(P=1/this.direction.x,b=(B.x-this.origin.x)*P,Y=(J.x-this.origin.x)*P,Y===-1/0&&(Y=1/0),b>Y&&(l=b,b=Y,Y=l),a=Math.max(b,a),Z=Math.min(Y,Z),a>Z)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<B.y||this.origin.y>J.y)return!1}else if(P=1/this.direction.y,b=(B.y-this.origin.y)*P,Y=(J.y-this.origin.y)*P,Y===-1/0&&(Y=1/0),b>Y&&(l=b,b=Y,Y=l),a=Math.max(b,a),Z=Math.min(Y,Z),a>Z)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<B.z||this.origin.z>J.z)return!1}else if(P=1/this.direction.z,b=(B.z-this.origin.z)*P,Y=(J.z-this.origin.z)*P,Y===-1/0&&(Y=1/0),b>Y&&(l=b,b=Y,Y=l),a=Math.max(b,a),Z=Math.min(Y,Z),a>Z)return!1;return!0}intersectsBox(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(v.minimum,v.maximum,y)}intersectsSphere(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=v.center.x-this.origin.x,B=v.center.y-this.origin.y,J=v.center.z-this.origin.z,P=n*n+B*B+J*J,b=v.radius+y,Y=b*b;if(P<=Y)return!0;const l=n*this.direction.x+B*this.direction.y+J*this.direction.z;if(l<0)return!1;return P-l*l<=Y}intersectsTriangle(v,y,n){const B=N._TmpVector3[0],J=N._TmpVector3[1],P=N._TmpVector3[2],Y=N._TmpVector3[3],a=N._TmpVector3[4];y.subtractToRef(v,B),n.subtractToRef(v,J),b.n.CrossToRef(this.direction,J,P);const Z=b.n.Dot(B,P);if(0===Z)return null;const x=1/Z;this.origin.subtractToRef(v,Y);const f=b.n.Dot(Y,P)*x;if(f<-this.epsilon||f>1+this.epsilon)return null;b.n.CrossToRef(Y,B,a);const i=b.n.Dot(this.direction,a)*x;if(i<-this.epsilon||f+i>1+this.epsilon)return null;const g=b.n.Dot(J,a)*x;return g>this.length?null:new l.b(1-f-i,f,g)}intersectsPlane(v){let y;const n=b.n.Dot(v.k,this.direction);if(Math.abs(n)<9.99999997475243e-7)return null;{const B=b.n.Dot(v.k,this.origin);return y=(-v.d-B)/n,y<0?y<-9.99999997475243e-7?null:0:y}}intersectsAxis(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(v){case"y":{const v=(this.origin.y-y)/this.direction.y;return v>0?null:new b.n(this.origin.x+this.direction.x*-v,y,this.origin.z+this.direction.z*-v)}case"x":{const v=(this.origin.x-y)/this.direction.x;return v>0?null:new b.n(y,this.origin.y+this.direction.y*-v,this.origin.z+this.direction.z*-v)}case"z":{const v=(this.origin.z-y)/this.direction.z;return v>0?null:new b.n(this.origin.x+this.direction.x*-v,this.origin.y+this.direction.y*-v,y)}default:return null}}intersectsMesh(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=b.i.Matrix[0];return v.getWorldMatrix().invertToRef(Y),this._tmpRay?N.TransformToRef(this,Y,this._tmpRay):this._tmpRay=N.Transform(this,Y),v.intersects(this._tmpRay,y,n,B,J,P)}intersectsMeshes(v,y,n){n?n.length=0:n=[];for(let B=0;B<v.length;B++){const J=this.intersectsMesh(v[B],y);J.hit&&n.push(J)}return n.sort(this._comparePickingInfo),n}_comparePickingInfo(v,y){return v.distance<y.distance?-1:v.distance>y.distance?1:0}intersectionSegment(v,y,n){const B=this.origin,J=b.i.o[0],P=b.i.o[1],Y=b.i.o[2],l=b.i.o[3];y.subtractToRef(v,J),this.direction.scaleToRef(N._Rayl,Y),B.addToRef(Y,P),v.subtractToRef(B,l);const a=b.n.Dot(J,J),Z=b.n.Dot(J,Y),x=b.n.Dot(Y,Y),f=b.n.Dot(J,l),i=b.n.Dot(Y,l),g=a*x-Z*Z;let c,h,E=g,W=g;g<N._Smallnum?(c=0,E=1,h=i,W=x):(c=Z*i-x*f,h=a*i-Z*f,c<0?(c=0,h=i,W=x):c>E&&(c=E,h=i+Z,W=x)),h<0?(h=0,-f<0?c=0:-f>a?c=E:(c=-f,E=a)):h>W&&(h=W,-f+Z<0?c=0:-f+Z>a?c=E:(c=-f+Z,E=a));const s=Math.abs(c)<N._Smallnum?0:c/E,C=Math.abs(h)<N._Smallnum?0:h/W,r=b.i.o[4];Y.scaleToRef(C,r);const u=b.i.o[5];J.scaleToRef(s,u),u.addInPlace(l);const O=b.i.o[6];u.subtractToRef(r,O);return C>0&&C<=this.length&&O.lengthSquared()<n*n?u.length():-1}update(v,y,n,B,J,P,Y){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){N._RayDistant||(N._RayDistant=N.Zero()),N._RayDistant.unprojectRayToRef(v,y,n,B,b.d.IdentityReadOnly,P,Y);const l=b.i.Matrix[0];J.invertToRef(l),N.TransformToRef(N._RayDistant,l,this)}else this.unprojectRayToRef(v,y,n,B,J,P,Y);return this}static Zero(){return new N(b.n.Zero(),b.n.Zero())}static CreateNew(v,y,n,B,J,P,b){return N.Zero().update(v,y,n,B,J,P,b)}static CreateNewFromTo(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.d.IdentityReadOnly;const B=new N(new b.n(0,0,0),new b.n(0,0,0));return N.CreateFromToToRef(v,y,B,n)}static CreateFromToToRef(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b.d.IdentityReadOnly;n.origin.p(v);const J=y.subtractToRef(v,n.direction),P=Math.sqrt(J.x*J.x+J.y*J.y+J.z*J.z);return n.length=P,n.direction.normalize(),N.TransformToRef(n,B,n)}static Transform(v,y){const n=new N(new b.n(0,0,0),new b.n(0,0,0));return N.TransformToRef(v,y,n),n}static TransformToRef(v,y,n){b.n.TransformCoordinatesToRef(v.origin,y,n.origin),b.n.TransformNormalToRef(v.direction,y,n.direction),n.length=v.length,n.epsilon=v.epsilon;const B=n.direction,J=B.length();if(0!==J&&1!==J){const v=1/J;B.x*=v,B.y*=v,B.z*=v,n.length*=J}return n}unprojectRayToRef(v,y,n,B,J,P,Y){const l=b.i.Matrix[0];J.multiplyToRef(P,l),l.multiplyToRef(Y,l),l.invert();const a=Z.b.LastCreatedEngine,x=b.i.o[0];x.x=v/n*2-1,x.y=-(y/B*2-1),x.z=null!==a&&void 0!==a&&a.useReverseDepthBuffer?1:null!==a&&void 0!==a&&a.isNDCHalfZRange?0:-1;const f=b.i.o[1].Ae(x.x,x.y,1-1e-8),N=b.i.o[2],i=b.i.o[3];b.n._UnprojectFromInvertedMatrixToRef(x,l,N),b.n._UnprojectFromInvertedMatrixToRef(f,l,i),this.origin.p(N),i.subtractToRef(N,this.direction),this.direction.normalize()}}function i(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const b=N.Zero();return g(v,y,n,B,b,J,P),b}function g(v,y,n,B,J,P){let Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const a=v.getEngine();if(!P&&!(P=v.activeCamera))return v;const Z=P.viewport,x=a.getRenderHeight(),{x:f,y:N,width:i,height:g}=Z.toGlobal(a.getRenderWidth(),x),c=1/a.getHardwareScalingLevel();return y=y*c-f,n=n*c-(x-N-g),J.update(y,n,i,g,B||b.d.IdentityReadOnly,Y?b.d.IdentityReadOnly:P.getViewMatrix(),P.getProjectionMatrix(),l),v}function c(v,y,n,B,J){if(!a.c)return v;const P=v.getEngine();if(!J&&!(J=v.activeCamera))throw new Error("Active camera not set");const Y=J.viewport,l=P.getRenderHeight(),{x:Z,y:x,width:f,height:N}=Y.toGlobal(P.getRenderWidth(),l),i=b.d.Identity(),g=1/P.getHardwareScalingLevel();return y=y*g-Z,n=n*g-(l-x-N),B.update(y,n,f,N,i,i,J.getProjectionMatrix()),v}function h(v,y,n,B,J,P,b,Y){const l=y(B,n.enableDistantPicking),a=n.intersects(l,J,b,P,B,Y);return a&&a.hit?!J&&null!=v&&a.distance>=v.distance?null:a:null}function E(v,y,n,B,J,P){let Y=null;const l=!!(v.activeCameras&&v.activeCameras.length>1&&v.cameraToUseForPointers!==v.activeCamera),Z=v.cameraToUseForPointers||v.activeCamera,x=f.internalPickerForMesh||h;for(let a=0;a<v.meshes.length;a++){const f=v.meshes[a];if(n){if(!n(f,-1))continue}else if(!f.isEnabled()||!f.isVisible||!f.Kb)continue;const N=l&&f.isWorldMatrixCameraDependent(),i=f.ak(N,Z);if(f.hasThinInstances&&f.thinInstanceEnablePicking){const v=x(Y,y,f,i,!0,!0,P);if(v){if(J)return v;const l=b.i.Matrix[1],a=f.thinInstanceGetWorldMatrices();for(let v=0;v<a.length;v++){if(n&&!n(f,v))continue;a[v].multiplyToRef(i,l);const b=x(Y,y,f,l,B,J,P,!0);if(b&&(Y=b,Y.thinInstanceIndex=v,B))return Y}}}else{const v=x(Y,y,f,i,B,J,P);if(v&&(Y=v,B))return Y}}return Y||new a.c}function W(v,y,n,B){if(!a.c)return null;const J=[],P=!!(v.activeCameras&&v.activeCameras.length>1&&v.cameraToUseForPointers!==v.activeCamera),Y=v.cameraToUseForPointers||v.activeCamera,l=f.internalPickerForMesh||h;for(let a=0;a<v.meshes.length;a++){const Z=v.meshes[a];if(n){if(!n(Z,-1))continue}else if(!Z.isEnabled()||!Z.isVisible||!Z.Kb)continue;const x=P&&Z.isWorldMatrixCameraDependent(),f=Z.ak(x,Y);if(Z.hasThinInstances&&Z.thinInstanceEnablePicking){if(l(null,y,Z,f,!0,!0,B)){const v=b.i.Matrix[1],P=Z.thinInstanceGetWorldMatrices();for(let b=0;b<P.length;b++){if(n&&!n(Z,b))continue;P[b].multiplyToRef(f,v);const Y=l(null,y,Z,v,!1,!1,B,!0);Y&&(Y.thinInstanceIndex=b,J.push(Y))}}}else{const v=l(null,y,Z,f,!1,!1,B);v&&J.push(v)}}return J}function s(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,B=arguments.length>3?arguments[3]:void 0,J=arguments.length>4?arguments[4]:void 0;B||(B=v.getWorldMatrix()),y.length=n,J?y.origin.p(J):y.origin.p(v.position);const P=b.i.o[2];P.set(0,0,v._scene.useRightHandedSystem?-1:1);const Y=b.i.o[3];return b.n.TransformNormalToRef(P,B,Y),b.n.NormalizeToRef(Y,y.direction),y}var C,r;N._TmpVector3=(0,Y.c)(6,b.n.Zero),N._RayDistant=N.Zero(),N._Smallnum=1e-8,N._Rayl=1e9,C=B.e,(r=J.c)&&(r.prototype.getForwardRay=function(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,y=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return s(this,new N(b.n.Zero(),b.n.Zero(),v),v,y,n)},r.prototype.getForwardRayToRef=function(v){return s(this,v,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),C&&(x.b._IsPickingAvailable=!0,C.prototype.createPickingRay=function(v,y,n,B){return i(this,v,y,n,B,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),B.e.prototype.createPickingRayToRef=function(v,y,n,B,J){return g(this,v,y,n,B,J,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},B.e.prototype.createPickingRayInCameraSpace=function(v,y,n){return function(v,y,n,B){const J=N.Zero();return c(v,y,n,J,B),J}(this,v,y,n)},B.e.prototype.createPickingRayInCameraSpaceToRef=function(v,y,n,B){return c(this,v,y,n,B)},B.e.prototype.pickWithBoundingInfo=function(v,y,n,B,J){return function(v,y,n,B,J,P){if(!a.c)return null;const Y=E(v,(B=>(v._tempPickingRay||(v._tempPickingRay=N.Zero()),g(v,y,n,B,v._tempPickingRay,P||null),v._tempPickingRay)),B,J,!0);return Y&&(Y.ray=i(v,y,n,b.d.Identity(),P||null)),Y}(this,v,y,n,B,J)},B.e.prototype.nd=function(v,y,n,B,J,P){return function(v,y,n,B,J,P,Y){const l=E(v,((B,J)=>(v._tempPickingRay||(v._tempPickingRay=N.Zero()),g(v,y,n,B,v._tempPickingRay,P||null,!1,J),v._tempPickingRay)),B,J,!1,Y);return l&&(l.ray=i(v,y,n,b.d.Identity(),P||null)),l}(this,v,y,n,B,J,P)},B.e.prototype.pickWithRay=function(v,y,n,B){return function(v,y,n,B,J){const P=E(v,(n=>(v._pickWithRayInverseMatrix||(v._pickWithRayInverseMatrix=b.d.Identity()),n.invertToRef(v._pickWithRayInverseMatrix),v._cachedRayForTransform||(v._cachedRayForTransform=N.Zero()),N.TransformToRef(y,v._pickWithRayInverseMatrix,v._cachedRayForTransform),v._cachedRayForTransform)),n,B,!1,J);return P&&(P.ray=y),P}(this,v,y,n,B)},B.e.prototype.multiPick=function(v,y,n,B,J){return function(v,y,n,B,J,P){return W(v,(B=>i(v,y,n,B,J||null)),B,P)}(this,v,y,n,B,J)},B.e.prototype.multiPickWithRay=function(v,y,n){return function(v,y,n,B){return W(v,(n=>(v._pickWithRayInverseMatrix||(v._pickWithRayInverseMatrix=b.d.Identity()),n.invertToRef(v._pickWithRayInverseMatrix),v._cachedRayForTransform||(v._cachedRayForTransform=N.Zero()),N.TransformToRef(y,v._pickWithRayInverseMatrix,v._cachedRayForTransform),v._cachedRayForTransform)),n,B)}(this,v,y,n)}},11624:(v,y,n)=>{"use strict";var B=n(10885),J=n(10801),P=n(10828),b=n(10911),Y=n(10849),l=n(10894);Y.c.prototype._partialLoadFile=function(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(v,(v=>{n[y]=v,n._internalCount++,6===n._internalCount&&B(n)}),void 0,void 0,!0,((v,y)=>{J&&v&&J(v.status+" "+v.statusText,y)}))},Y.c.prototype._cascadeLoadFiles=function(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const J=[];J._internalCount=0;for(let P=0;P<6;P++)this._partialLoadFile(n[P],P,J,y,B)},Y.c.prototype._cascadeLoadImgs=function(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5?arguments[5]:void 0;const b=[];b._internalCount=0;for(let Y=0;Y<6;Y++)this._partialLoadImg(B[Y],Y,b,v,y,n,J,P)},Y.c.prototype._partialLoadImg=function(v,y,n,B,J,Y){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7?arguments[7]:void 0;const Z=(0,b.b)();(0,P.s)(v,(v=>{n[y]=v,n._internalCount++,B&&B.removePendingData(Z),6===n._internalCount&&Y&&Y(J,n)}),((v,y)=>{B&&B.removePendingData(Z),l&&l(v,y)}),B?B.offlineProvider:null,a),B&&B.addPendingData(Z)},Y.c.prototype.createCubeTextureBase=function(v,y,n,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6?arguments[6]:void 0,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]&&arguments[8],f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,N=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,i=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,g=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,c=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,h=arguments.length>14&&void 0!==arguments[14]&&arguments[14],E=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const W=i||new B.b(this,7);W.isCube=!0,W.url=v,W.generateMipMaps=!P,W._lodGenerationScale=f,W._lodGenerationOffset=N,W._useSRGBBuffer=!!h&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!P),W!==i&&(W.label=v.substring(0,60)),this._doNotHandleContextLost||(W._extension=Z,W._files=n,W._buffer=E);const s=v;this._transformTextureUrl&&!i&&(v=this._transformTextureUrl(v));const C=v.split("?")[0],r=C.lastIndexOf("."),u=Z||(r>-1?C.substring(r).toLowerCase():""),O=(0,l.c)(u),d=(B,l)=>{v===s?Y&&B&&Y(B.status+" "+B.statusText,l):(J.e.Warn(`Failed to load ${v}, falling back to the ${s}`),this.createCubeTextureBase(s,y,n,!!P,b,Y,a,Z,x,f,N,W,g,c,h,E))};if(O)O.then((B=>{const P=v=>{g&&g(W,v),B.loadCubeData(v,W,x,b,Y)};E?P(E):n&&6===n.length?B.supportCascades?this._cascadeLoadFiles(y,(v=>P(v.map((v=>new Uint8Array(v))))),n,Y):Y?Y("Textures type does not support cascades."):J.e.Warn("Texture loader does not support cascades."):this._loadFile(v,(v=>P(new Uint8Array(v))),void 0,void 0,!0,d)}));else{if(!n||0===n.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(y,W,((v,y)=>{c&&c(v,y)}),n,Y)}return this._internalTexturesCache.push(W),W}},11555:(v,y,n)=>{"use strict";n(10849).c.prototype.createDepthStencilTexture=function(v,y,n){if(y.isCube){const n=v.width||v;return this._createDepthStencilCubeTexture(n,y)}return this._createDepthStencilTexture(v,y,n)}},11531:(v,y,n)=>{"use strict";n(11503).ThinEngine.prototype.setAlphaMode=function(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==v){switch(v){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}y||(this.depthCullingState.depthMask=0===v),this._alphaMode=v}else if(!y){const y=0===v;this.depthCullingState.depthMask!==y&&(this.depthCullingState.depthMask=y)}}},11500:(v,y,n)=>{"use strict";var B=n(11503);B.ThinEngine.prototype.updateDynamicIndexBuffer=function(v,y){let n;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(v),n=v.is32Bits?y instanceof Uint32Array?y:new Uint32Array(y):y instanceof Uint16Array?y:new Uint16Array(y),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},B.ThinEngine.prototype.updateDynamicVertexBuffer=function(v,y,n,B){this.bindArrayBuffer(v),void 0===n&&(n=0);const J=y.byteLength||y.length;void 0===B||B>=J&&0===n?y instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,n,new Float32Array(y)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,n,y):y instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(y).subarray(n,n+B)):(y=y instanceof ArrayBuffer?new Uint8Array(y,n,B):new Uint8Array(y.buffer,y.byteOffset+n,B),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,y)),this._resetVertexBufferBinding()}},11540:(v,y,n)=>{"use strict";var B=n(10885),J=n(10801),P=n(11503),b=n(11546);class Y extends b.e{constructor(v,y,n,B,J){super(v,y,n,B),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=J}_cloneRenderTargetWrapper(){let v=null;return this._colorTextureArray&&this._depthStencilTextureArray?(v=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),v.texture.isReady=!0):v=super._cloneRenderTargetWrapper(),v}_swapRenderTargetWrapper(v){super._swapRenderTargetWrapper(v),v._framebuffer=this._framebuffer,v._depthStencilBuffer=this._depthStencilBuffer,v._MSAAFramebuffer=this._MSAAFramebuffer,v._colorTextureArray=this._colorTextureArray,v._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,P=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const v=this._engine,y=v._currentFramebuffer,n=this._context;v._bindUnboundFramebuffer(this._framebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,null),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,null),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.STENCIL_ATTACHMENT,n.RENDERBUFFER,null),v._bindUnboundFramebuffer(y),n.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(v,y,n,B,J,P)}shareDepth(v){super.shareDepth(v);const y=this._context,n=this._depthStencilBuffer,B=v._MSAAFramebuffer||v._framebuffer,J=this._engine;v._depthStencilBuffer&&v._depthStencilBuffer!==n&&y.deleteRenderbuffer(v._depthStencilBuffer),v._depthStencilBuffer=n;const P=v._generateStencilBuffer?y.DEPTH_STENCIL_ATTACHMENT:y.DEPTH_ATTACHMENT;J._bindUnboundFramebuffer(B),y.framebufferRenderbuffer(y.FRAMEBUFFER,P,y.RENDERBUFFER,n),J._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!v._hardwareTexture)return;const J=this._framebuffer,P=this._engine,b=P._currentFramebuffer;if(P._bindUnboundFramebuffer(J),P.webGLVersion>1){const J=this._context,P=J["COLOR_ATTACHMENT"+y];var Y;if(v.is2DArray||v.is3D)n=n??(null===(Y=this.layerIndices)||void 0===Y?void 0:Y[y])??0,J.framebufferTextureLayer(J.FRAMEBUFFER,P,v._hardwareTexture.underlyingResource,B,n);else if(v.isCube){var l;n=n??(null===(l=this.faceIndices)||void 0===l?void 0:l[y])??0,J.framebufferTexture2D(J.FRAMEBUFFER,P,J.TEXTURE_CUBE_MAP_POSITIVE_X+n,v._hardwareTexture.underlyingResource,B)}else J.framebufferTexture2D(J.FRAMEBUFFER,P,J.TEXTURE_2D,v._hardwareTexture.underlyingResource,B)}else{const J=this._context,P=J["COLOR_ATTACHMENT"+y+"_WEBGL"],b=void 0!==n?J.TEXTURE_CUBE_MAP_POSITIVE_X+n:J.TEXTURE_2D;J.framebufferTexture2D(J.FRAMEBUFFER,P,b,v._hardwareTexture.underlyingResource,B)}P._bindUnboundFramebuffer(b)}setTexture(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(v,y,n),this._bindTextureRenderTarget(v,y)}setLayerAndFaceIndices(v,y){var n;if(super.setLayerAndFaceIndices(v,y),!this.textures||!this.layerIndices||!this.faceIndices)return;const B=(null===(n=this._attachments)||void 0===n?void 0:n.length)??this.textures.length;for(let J=0;J<B;J++){const v=this.textures[J];v&&(v.is2DArray||v.is3D?this._bindTextureRenderTarget(v,J,this.layerIndices[J]):v.isCube?this._bindTextureRenderTarget(v,J,this.faceIndices[J]):this._bindTextureRenderTarget(v,J))}}setLayerAndFaceIndex(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(v,y,n),!this.textures||!this.layerIndices||!this.faceIndices)return;const B=this.textures[v];B.is2DArray||B.is3D?this._bindTextureRenderTarget(this.textures[v],v,this.layerIndices[v]):B.isCube&&this._bindTextureRenderTarget(this.textures[v],v,this.faceIndices[v])}dispose(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const y=this._context;v||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(y.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(y.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(y.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(v)}}n(11555);P.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(v,y,n){const B=new Y(v,y,n,this,this._gl);return this._renderTargetWrapperCache.push(B),B},P.ThinEngine.prototype.createRenderTargetTexture=function(v,y){const n=this._createHardwareRenderTargetWrapper(!1,!1,v);let B,J,P=!0,b=!1,Y=!1,l=1;void 0!==y&&"object"===typeof y&&(P=y.generateDepthBuffer??!0,b=!!y.generateStencilBuffer,Y=!!y.noColorAttachment,B=y.colorAttachment,l=y.samples??1,J=y.label);const a=B||(Y?null:this._createInternalTexture(v,y,!0,5)),Z=v.width||v,x=v.height||v,f=this._currentFramebuffer,N=this._gl,i=N.createFramebuffer();if(this._bindUnboundFramebuffer(i),n._depthStencilBuffer=this._setupFramebufferDepthAttachments(b,P,Z,x),!a||a.is2DArray||a.is3D||N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_2D,a._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(f),n.label=J??"RenderTargetWrapper",n._framebuffer=i,n._generateDepthBuffer=P,n._generateStencilBuffer=b,n.setTextures(a),B){if(n._samples=B.samples,B.samples>1){const v=B._hardwareTexture.getMSAARenderBuffer(0);n._MSAAFramebuffer=N.createFramebuffer(),this._bindUnboundFramebuffer(n._MSAAFramebuffer),N.framebufferRenderbuffer(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.RENDERBUFFER,v),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(n,l);return n},P.ThinEngine.prototype._createDepthStencilTexture=function(v,y,n){const P=this._gl,b=v.layers||0,Y=v.depth||0;let l=P.TEXTURE_2D;0!==b?l=P.TEXTURE_2D_ARRAY:0!==Y&&(l=P.TEXTURE_3D);const a=new B.b(this,12);if(a.label=y.label,!this._caps.depthTextureExtension)return J.e.Error("Depth texture is not supported by your browser or hardware."),a;const Z={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...y};if(this._bindTextureDirectly(l,a,!0),this._setupDepthStencilTexture(a,v,0!==Z.comparisonFunction&&Z.bilinearFiltering,Z.comparisonFunction,Z.samples),void 0!==Z.depthTextureFormat){if(15!==Z.depthTextureFormat&&16!==Z.depthTextureFormat&&17!==Z.depthTextureFormat&&13!==Z.depthTextureFormat&&14!==Z.depthTextureFormat&&18!==Z.depthTextureFormat)return J.e.Error(`Depth texture ${Z.depthTextureFormat} format is not supported.`),a;a.format=Z.depthTextureFormat}else a.format=Z.generateStencil?13:16;const x=17===a.format||13===a.format||18===a.format;let f=P.UNSIGNED_INT;15===a.format?f=P.UNSIGNED_SHORT:17===a.format||13===a.format?f=P.UNSIGNED_INT_24_8:14===a.format?f=P.FLOAT:18===a.format&&(f=P.FLOAT_32_UNSIGNED_INT_24_8_REV);const N=x?P.DEPTH_STENCIL:P.DEPTH_COMPONENT,i=this._getInternalFormatFromDepthTextureFormat(a.format,!0,x);return a.is2DArray?P.texImage3D(l,0,i,a.width,a.height,b,0,N,f,null):a.is3D?P.texImage3D(l,0,i,a.width,a.height,Y,0,N,f,null):P.texImage2D(l,0,i,a.width,a.height,0,N,f,null),this._bindTextureDirectly(l,null),this._internalTexturesCache.push(a),n._depthStencilBuffer&&(P.deleteRenderbuffer(n._depthStencilBuffer),n._depthStencilBuffer=null),this._bindUnboundFramebuffer(n._MSAAFramebuffer??n._framebuffer),n._generateStencilBuffer=x,n._depthStencilTextureWithStencil=x,n._depthStencilBuffer=this._setupFramebufferDepthAttachments(n._generateStencilBuffer,n._generateDepthBuffer,n.width,n.height,n.samples,a.format),this._bindUnboundFramebuffer(null),a},P.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(v,y){var n;if(this.webGLVersion<2||!v)return 1;if(v.samples===y)return y;const B=this._gl;y=Math.min(y,this.getCaps().maxMSAASamples),v._depthStencilBuffer&&(B.deleteRenderbuffer(v._depthStencilBuffer),v._depthStencilBuffer=null),v._MSAAFramebuffer&&(B.deleteFramebuffer(v._MSAAFramebuffer),v._MSAAFramebuffer=null);const J=null===(n=v.texture)||void 0===n?void 0:n._hardwareTexture;if(null===J||void 0===J||J.releaseMSAARenderBuffers(),v.texture&&y>1&&"function"===typeof B.renderbufferStorageMultisample){const n=B.createFramebuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");v._MSAAFramebuffer=n,this._bindUnboundFramebuffer(v._MSAAFramebuffer);const P=this._createRenderBuffer(v.texture.width,v.texture.height,y,-1,this._getRGBABufferInternalSizedFormat(v.texture.type,v.texture.format,v.texture._useSRGBBuffer),B.COLOR_ATTACHMENT0,!1);if(!P)throw new Error("Unable to create multi sampled framebuffer");null===J||void 0===J||J.addMSAARenderBuffer(P)}this._bindUnboundFramebuffer(v._MSAAFramebuffer??v._framebuffer),v.texture&&(v.texture.samples=y),v._samples=y;const P=v._depthStencilTexture?v._depthStencilTexture.format:void 0;return v._depthStencilBuffer=this._setupFramebufferDepthAttachments(v._generateStencilBuffer,v._generateDepthBuffer,v.width,v.height,y,P),this._bindUnboundFramebuffer(null),y},P.ThinEngine.prototype._setupDepthStencilTexture=function(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const P=y.width??y,b=y.height??y,Y=y.layers||0,l=y.depth||0;v.baseWidth=P,v.baseHeight=b,v.width=P,v.height=b,v.is2DArray=Y>0,v.depth=Y||l,v.isReady=!0,v.samples=J,v.generateMipMaps=!1,v.samplingMode=n?2:1,v.type=0,v._comparisonFunction=B;const a=this._gl,Z=this._getTextureTarget(v),x=this._getSamplingParameters(v.samplingMode,!1);a.texParameteri(Z,a.TEXTURE_MAG_FILTER,x.mag),a.texParameteri(Z,a.TEXTURE_MIN_FILTER,x.min),a.texParameteri(Z,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(Z,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===B?(a.texParameteri(Z,a.TEXTURE_COMPARE_FUNC,515),a.texParameteri(Z,a.TEXTURE_COMPARE_MODE,a.NONE)):(a.texParameteri(Z,a.TEXTURE_COMPARE_FUNC,B),a.texParameteri(Z,a.TEXTURE_COMPARE_MODE,a.COMPARE_REF_TO_TEXTURE)))}},10841:(v,y,n)=>{"use strict";n.d(y,{b:()=>O,f:()=>r,g:()=>u,j:()=>F,l:()=>S});class B{constructor(){this.children=[]}isValid(v){return!0}process(v,y){let n="";if(this.line){let a=this.line;const Z=y.processor;if(Z){var B,J,P,b,Y,l;Z.lineProcessor&&(a=Z.lineProcessor(a,y.isFragment,y.processingContext));const n=(null===(B=y.processor)||void 0===B?void 0:B.attributeKeywordName)??"attribute",x=y.isFragment&&null!==(J=y.processor)&&void 0!==J&&J.varyingFragmentKeywordName?null===(P=y.processor)||void 0===P?void 0:P.varyingFragmentKeywordName:!y.isFragment&&null!==(b=y.processor)&&void 0!==b&&b.varyingVertexKeywordName?null===(Y=y.processor)||void 0===Y?void 0:Y.varyingVertexKeywordName:"varying";if(!y.isFragment&&Z.attributeProcessor&&this.line.startsWith(n))a=Z.attributeProcessor(this.line,v,y.processingContext);else if(Z.varyingProcessor&&(null!==(l=Z.varyingCheck)&&void 0!==l&&l.call(Z,this.line,y.isFragment)||!Z.varyingCheck&&this.line.startsWith(x)))a=Z.varyingProcessor(this.line,y.isFragment,v,y.processingContext);else if(Z.uniformProcessor&&Z.uniformRegexp&&Z.uniformRegexp.test(this.line))y.lookForClosingBracketForUniformBuffer||(a=Z.uniformProcessor(this.line,y.isFragment,v,y.processingContext));else if(Z.uniformBufferProcessor&&Z.uniformBufferRegexp&&Z.uniformBufferRegexp.test(this.line))y.lookForClosingBracketForUniformBuffer||(a=Z.uniformBufferProcessor(this.line,y.isFragment,y.processingContext),y.lookForClosingBracketForUniformBuffer=!0);else if(Z.textureProcessor&&Z.textureRegexp&&Z.textureRegexp.test(this.line))a=Z.textureProcessor(this.line,y.isFragment,v,y.processingContext);else if((Z.uniformProcessor||Z.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!y.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?Z.uniformProcessor&&(a=Z.uniformProcessor(this.line,y.isFragment,v,y.processingContext)):Z.uniformBufferProcessor&&(a=Z.uniformBufferProcessor(this.line,y.isFragment,y.processingContext),y.lookForClosingBracketForUniformBuffer=!0)}y.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(y.lookForClosingBracketForUniformBuffer=!1,Z.endOfUniformBufferProcessor&&(a=Z.endOfUniformBufferProcessor(this.line,y.isFragment,y.processingContext)))}n+=a+"\n"}return this.children.forEach((B=>{n+=B.process(v,y)})),this.additionalDefineKey&&(v[this.additionalDefineKey]=this.additionalDefineValue||"true"),n}}class J{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(v){this._lines.length=0;for(const y of v){if(!y||"\r"===y)continue;if("#"===y[0]){this._lines.push(y);continue}const v=y.trim();if(!v)continue;if(v.startsWith("//")){this._lines.push(y);continue}const n=v.indexOf(";");if(-1===n)this._lines.push(v);else if(n===v.length-1)v.length>1&&this._lines.push(v);else{const v=y.split(";");for(let y=0;y<v.length;y++){let n=v[y];n&&(n=n.trim(),n&&this._lines.push(n+(y!==v.length-1?";":"")))}}}}}class P extends B{process(v,y){for(let n=0;n<this.children.length;n++){const B=this.children[n];if(B.isValid(v))return B.process(v,y)}return""}}class b extends B{isValid(v){return this.testExpression.isTrue(v)}}class Y{isTrue(v){return!0}static postfixToInfix(v){const y=[];for(const n of v)if(void 0===Y._OperatorPriority[n])y.push(n);else{const v=y[y.length-1],B=y[y.length-2];y.length-=2,y.push(`(${B}${n}${v})`)}return y[y.length-1]}static infixToPostfix(v){const y=Y._InfixToPostfixCache.get(v);if(y)return y.accessTime=Date.now(),y.result;if(!v.includes("&&")&&!v.includes("||")&&!v.includes(")")&&!v.includes("("))return[v];const n=[];let B=-1;const J=()=>{Z=Z.trim(),""!==Z&&(n.push(Z),Z="")},P=v=>{B<Y._Stack.length-1&&(Y._Stack[++B]=v)},b=()=>Y._Stack[B],l=()=>-1===B?"!!INVALID EXPRESSION!!":Y._Stack[B--];let a=0,Z="";for(;a<v.length;){const y=v.charAt(a),x=a<v.length-1?v.substring(a,2+a):"";if("("===y)Z="",P(y);else if(")"===y){for(J();-1!==B&&"("!==b();)n.push(l());l()}else if(Y._OperatorPriority[x]>1){for(J();-1!==B&&Y._OperatorPriority[b()]>=Y._OperatorPriority[x];)n.push(l());P(x),a++}else Z+=y;a++}for(J();-1!==B;)"("===b()?l():n.push(l());return Y._InfixToPostfixCache.size>=Y.InfixToPostfixCacheLimitSize&&Y.ClearCache(),Y._InfixToPostfixCache.set(v,{result:n,accessTime:Date.now()}),n}static ClearCache(){const v=Array.from(Y._InfixToPostfixCache.entries()).sort(((v,y)=>v[1].accessTime-y[1].accessTime));for(let y=0;y<Y.InfixToPostfixCacheCleanupSize;y++)Y._InfixToPostfixCache.delete(v[y][0])}}Y.InfixToPostfixCacheLimitSize=5e4,Y.InfixToPostfixCacheCleanupSize=25e3,Y._InfixToPostfixCache=new Map,Y._OperatorPriority={")":0,"(":1,"||":2,"&&":3},Y._Stack=["","","","","","","","","","","","","","","","","","","",""];class l extends Y{constructor(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=v,this.not=y}isTrue(v){let y=void 0!==v[this.define];return this.not&&(y=!y),y}}class a extends Y{isTrue(v){return this.leftOperand.isTrue(v)||this.rightOperand.isTrue(v)}}class Z extends Y{isTrue(v){return this.leftOperand.isTrue(v)&&this.rightOperand.isTrue(v)}}class x extends Y{constructor(v,y,n){super(),this.define=v,this.operand=y,this.testValue=n}isTrue(v){let y=v[this.define];void 0===y&&(y=this.define);let n=!1;const B=parseInt(y),J=parseInt(this.testValue);switch(this.operand){case">":n=B>J;break;case"<":n=B<J;break;case"<=":n=B<=J;break;case">=":n=B>=J;break;case"==":n=B===J;break;case"!=":n=B!==J}return n}}var f=n(10811),N=n(10845);const i=/defined\s*?\((.+?)\)/g,g=/defined\s*?\[(.+?)\]/g,c=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,h=/__decl__/,E=/light\{X\}.(\w*)/g,W=/\{X\}/g,s=[],C=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function r(v){v.processor&&v.processor.initializeShaders&&v.processor.initializeShaders(v.processingContext)}function u(v,y,n,B){var J;null!==(J=y.processor)&&void 0!==J&&J.preProcessShaderCode&&(v=y.processor.preProcessShaderCode(v,y.isFragment)),F(v,y,(v=>{y.processCodeAfterIncludes&&(v=y.processCodeAfterIncludes(y.isFragment?"fragment":"vertex",v,y.defines));const J=function(v,y,n){let B=function(v,y){var n;if(null!==(n=y.processor)&&void 0!==n&&n.noPrecision)return v;const B=y.shouldUseHighPrecisionShader;-1===v.indexOf("precision highp float")?v=B?"precision highp float;\n"+v:"precision mediump float;\n"+v:B||(v=v.replace("precision highp float","precision mediump float"));return v}(v,y);if(!y.processor)return B;if(0===y.processor.shaderLanguage&&-1!==B.indexOf("#version 3")&&(B=B.replace("#version 300 es",""),!y.processor.parseGLES3))return B;const J=y.defines,P=R(y,n);y.processor.preProcessor&&(B=y.processor.preProcessor(B,J,P,y.isFragment,y.processingContext));B=G(B,P,y),y.processor.postProcessor&&(B=y.processor.postProcessor(B,J,y.isFragment,y.processingContext,n?{drawBuffersExtensionDisabled:!n.getCaps().drawBuffersExtension}:{}));null!==n&&void 0!==n&&n._features.needShaderCodeInlining&&(B=n.inlineShaderCode(B));return B}(v,y,B);n(J,v)}))}function O(v,y,n){return n.processor&&n.processor.finalizeShaders?n.processor.finalizeShaders(v,y,n.processingContext):{vertexCode:v,fragmentCode:y}}function d(v){const y=/defined\((.+)\)/.exec(v);if(y&&y.length)return new l(y[1].trim(),"!"===v[0]);const n=["==","!=",">=","<=","<",">"];let B="",J=0;for(B of n)if(J=v.indexOf(B),J>-1)break;if(-1===J)return new l(v);const P=v.substring(0,J).trim(),b=v.substring(J+B.length).trim();return new x(P,B,b)}function q(v,y){const n=new b,B=v.substring(0,y);let J=v.substring(y);return J=J.substring(0,(J.indexOf("//")+1||J.length+1)-1).trim(),n.testExpression="#ifdef"===B?new l(J):"#ifndef"===B?new l(J,!0):function(v){v=v.replace(i,"defined[$1]");const y=Y.infixToPostfix(v),n=[];for(const J of y)if("||"!==J&&"&&"!==J)n.push(J);else if(n.length>=2){let v=n[n.length-1],y=n[n.length-2];n.length-=2;const B="&&"==J?new Z:new a;"string"===typeof v&&(v=v.replace(g,"defined($1)")),"string"===typeof y&&(y=y.replace(g,"defined($1)")),B.leftOperand="string"===typeof y?d(y):y,B.rightOperand="string"===typeof v?d(v):v,n.push(B)}let B=n[n.length-1];return"string"===typeof B&&(B=B.replace(g,"defined($1)")),"string"===typeof B?d(B):B}(J),n}function L(v,y,n){let J=v.currentLine;for(;t(v,n);){J=v.currentLine;const P=J.substring(0,5).toLowerCase();if("#else"===P){const n=new B;return y.children.push(n),void t(v,n)}if("#elif"===P){const v=q(J,5);y.children.push(v),n=v}}}function t(v,y){for(;v.canRead;){v.lineIndex++;const n=v.currentLine;if(n.indexOf("#")>=0){const B=C.exec(n);if(B&&B.length){switch(B[0]){case"#ifdef":{const B=new P;y.children.push(B);const J=q(n,6);B.children.push(J),L(v,B,J);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const B=new P;y.children.push(B);const J=q(n,7);B.children.push(J),L(v,B,J);break}case"#if":{const B=new P,J=q(n,3);y.children.push(B),B.children.push(J),L(v,B,J);break}}continue}}const J=new B;if(J.line=n,y.children.push(J),"#"===n[0]&&"d"===n[1]){const v=n.replace(";","").split(" ");J.additionalDefineKey=v[1],3===v.length&&(J.additionalDefineValue=v[2])}}return!1}function G(v,y,n){const P=new B,b=new J;return b.lineIndex=-1,b.lines=v.split("\n"),t(b,P),P.process(y,n)}function R(v,y){var n;const B=v.defines,J={};for(const P of B){const v=P.replace("#define","").replace(";","").trim().split(" ");J[v[0]]=v.length>1?v[1]:""}return 0===(null===(n=v.processor)||void 0===n?void 0:n.shaderLanguage)&&(J.GL_ES="true"),J.__VERSION__=v.version,J[v.platformName]="true",(0,N.i)(J,null===y||void 0===y?void 0:y.isNDCHalfZRange,null===y||void 0===y?void 0:y.useReverseDepthBuffer,null===y||void 0===y?void 0:y.useExactSrgbConversions),J}function F(v,y,n){let B;for(s.length=0;null!==(B=c.exec(v));)s.push(B);let J=String(v),P=[v],b=!1;for(const Y of s){let v=Y[1];if(-1!==v.indexOf("__decl__")&&(v=v.replace(h,""),y.supportsUniformBuffers&&(v=v.replace("Vertex","Ubo").replace("Fragment","Ubo")),v+="Declaration"),!y.includesShadersStore[v]){const B=y.shadersRepository+"ShadersInclude/"+v+".fx";return void S.loadFile(B,(B=>{y.includesShadersStore[v]=B,F(P.join(""),y,n)}))}{let n=y.includesShadersStore[v];if(Y[2]){const v=Y[3].split(",");for(let y=0;y<v.length;y+=2){const B=new RegExp(v[y],"g"),J=v[y+1];n=n.replace(B,J)}}if(Y[4]){const v=Y[5];if(-1!==v.indexOf("..")){const B=v.split(".."),J=parseInt(B[0]);let P=parseInt(B[1]),b=n.slice(0);n="",isNaN(P)&&(P=y.indexParameters[B[1]]);for(let v=J;v<P;v++)y.supportsUniformBuffers||(b=b.replace(E,((v,y)=>y+"{X}"))),n+=b.replace(W,v.toString())+"\n"}else y.supportsUniformBuffers||(n=n.replace(E,((v,y)=>y+"{X}"))),n=n.replace(W,v)}const B=[];for(const v of P){const y=v.split(Y[0]);for(let v=0;v<y.length-1;v++)B.push(y[v]),B.push(n);B.push(y[y.length-1])}P=B,b=b||n.indexOf("#include<")>=0||n.indexOf("#include <")>=0}}s.length=0,J=P.join(""),b?F(J.toString(),y,n):n(J)}const S={loadFile:(v,y,n,B,J,P)=>{throw(0,f.e)("FileTools")}}},11517:(v,y,n)=>{"use strict";n.d(y,{b:()=>B});class B{get underlyingResource(){return this._webGLTexture}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,y=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=y,!v&&(v=y.createTexture(),!v))throw new Error("Unable to create webGL texture");this.set(v)}setUsage(){}set(v){this._webGLTexture=v}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(v){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(v)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const v of this._MSAARenderBuffers)this._context.deleteRenderbuffer(v);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var v;let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(v=this._MSAARenderBuffers)||void 0===v?void 0:v[y])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},10845:(v,y,n)=>{"use strict";n.d(y,{c:()=>J,g:()=>P,i:()=>Y,l:()=>b,m:()=>l});var B=n(10811);n(10797);const J={};function P(v,y){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(y?y+"\n":"")+v}function b(v,y,n,P,b,Y,l){const a=l||J.loadFile;if(a){return a(v,y,n,P,b,Y)}throw(0,B.e)("FileTools")}function Y(v,y,n,B){if(v)return y?v.IS_NDC_HALF_ZRANGE="":delete v.IS_NDC_HALF_ZRANGE,n?v.USE_REVERSE_DEPTHBUFFER="":delete v.USE_REVERSE_DEPTHBUFFER,void(B?v.USE_EXACT_SRGB_CONVERSIONS="":delete v.USE_EXACT_SRGB_CONVERSIONS);{let v="";return y&&(v+="#define IS_NDC_HALF_ZRANGE"),n&&(v&&(v+="\n"),v+="#define USE_REVERSE_DEPTHBUFFER"),B&&(v&&(v+="\n"),v+="#define USE_EXACT_SRGB_CONVERSIONS"),v}}function l(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;switch(v){case 3:{const v=(ArrayBuffer,new Int8Array(y));return B&&v.set(new Int8Array(B)),v}case 0:{const v=(ArrayBuffer,new Uint8Array(y));return B&&v.set(new Uint8Array(B)),v}case 4:{const v=y instanceof ArrayBuffer?new Int16Array(y):new Int16Array(n?y/2:y);return B&&v.set(new Int16Array(B)),v}case 5:case 8:case 9:case 10:case 2:{const v=y instanceof ArrayBuffer?new Uint16Array(y):new Uint16Array(n?y/2:y);return B&&v.set(new Uint16Array(B)),v}case 6:{const v=y instanceof ArrayBuffer?new Int32Array(y):new Int32Array(n?y/4:y);return B&&v.set(new Int32Array(B)),v}case 7:case 11:case 12:case 13:case 14:case 15:{const v=y instanceof ArrayBuffer?new Uint32Array(y):new Uint32Array(n?y/4:y);return B&&v.set(new Uint32Array(B)),v}case 1:{const v=y instanceof ArrayBuffer?new Float32Array(y):new Float32Array(n?y/4:y);return B&&v.set(new Float32Array(B)),v}}const J=(ArrayBuffer,new Uint8Array(y));return B&&J.set(new Uint8Array(B)),J}},10849:(v,y,n)=>{"use strict";n.d(y,{c:()=>W});var B=n(10820),J=n(10801),P=n(10857),b=n(10882),Y=n(10805);class l{constructor(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,v&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(v){this._zOffset!==v&&(this._zOffset=v,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(v){this._zOffsetUnits!==v&&(this._zOffsetUnits=v,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(v){this._cullFace!==v&&(this._cullFace=v,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(v){this._cull!==v&&(this._cull=v,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(v){this._depthFunc!==v&&(this._depthFunc=v,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(v){this._depthMask!==v&&(this._depthMask=v,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(v){this._depthTest!==v&&(this._depthTest=v,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(v){this._frontFace!==v&&(this._frontFace=v,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(v){this.isDirty&&(this._isCullDirty&&(this.cull?v.enable(v.CULL_FACE):v.disable(v.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(v.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(v.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?v.enable(v.DEPTH_TEST):v.disable(v.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(v.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(v.enable(v.POLYGON_OFFSET_FILL),v.polygonOffset(this.zOffset,this.zOffsetUnits)):v.disable(v.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(v.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class a{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(v){this._func!==v&&(this._func=v,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(v){this._funcRef!==v&&(this._funcRef=v,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(v){this._funcMask!==v&&(this._funcMask=v,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(v){this._opStencilFail!==v&&(this._opStencilFail=v,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(v){this._opDepthFail!==v&&(this._opDepthFail=v,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(v){this._opStencilDepthPass!==v&&(this._opStencilDepthPass=v,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(v){this._mask!==v&&(this._mask=v,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(v){this._enabled!==v&&(this._enabled=v,this._isStencilTestDirty=!0)}constructor(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,v&&this.reset()}reset(){var v;this.stencilMaterial=void 0,null===(v=this.stencilGlobal)||void 0===v||v.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(v){var y;if(!v)return;const n=!this.useStencilGlobalOnly&&!(null===(y=this.stencilMaterial)||void 0===y||!y.enabled);this.enabled=n?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=n?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=n?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=n?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=n?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=n?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=n?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=n?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?v.enable(v.STENCIL_TEST):v.disable(v.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(v.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(v.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(v.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class Z{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=Z.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=Z.KEEP,this.opDepthFail=Z.KEEP,this.opStencilDepthPass=Z.REPLACE}get stencilFunc(){return this.func}set stencilFunc(v){this.func=v}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(v){this.funcRef=v}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(v){this.funcMask=v}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(v){this.opStencilFail=v}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(v){this.opDepthFail=v}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(v){this.opStencilDepthPass=v}get stencilMask(){return this.mask}set stencilMask(v){this.mask=v}get stencilTest(){return this.enabled}set stencilTest(v){this.enabled=v}}Z.ALWAYS=519,Z.KEEP=7680,Z.REPLACE=7681;class x{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(v){this._alphaBlend!==v&&(this._alphaBlend=v,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(v,y,n,B){this._blendConstants[0]===v&&this._blendConstants[1]===y&&this._blendConstants[2]===n&&this._blendConstants[3]===B||(this._blendConstants[0]=v,this._blendConstants[1]=y,this._blendConstants[2]=n,this._blendConstants[3]=B,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(v,y,n,B){this._blendFunctionParameters[0]===v&&this._blendFunctionParameters[1]===y&&this._blendFunctionParameters[2]===n&&this._blendFunctionParameters[3]===B||(this._blendFunctionParameters[0]=v,this._blendFunctionParameters[1]=y,this._blendFunctionParameters[2]=n,this._blendFunctionParameters[3]=B,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(v,y){this._blendEquationParameters[0]===v&&this._blendEquationParameters[1]===y||(this._blendEquationParameters[0]=v,this._blendEquationParameters[1]=y,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(v){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?v.enable(v.BLEND):v.disable(v.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(v.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(v.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(v.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var f=n(10811),N=n(10885),i=n(10797),g=n(10795),c=n(10845),h=n(10894);function E(v,y){if((0,i.k)()){const{requestAnimationFrame:n}=y||window;if("function"===typeof n)return n(v)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(v);return setTimeout(v,16)}class W{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(v){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(v){v!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=v,this._depthCullingState.depthFunc=v?518:515)}setColorWrite(v){v!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=v)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(v){if(v)return this.isNDCHalfZRange?v.IS_NDC_HALF_ZRANGE="":delete v.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?v.USE_REVERSE_DEPTHBUFFER="":delete v.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?v.USE_EXACT_SRGB_CONVERSIONS="":delete v.USE_EXACT_SRGB_CONVERSIONS);{let v="";return this.isNDCHalfZRange&&(v+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(v&&(v+="\n"),v+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(v&&(v+="\n"),v+="#define USE_EXACT_SRGB_CONVERSIONS"),v}}_rebuildInternalTextures(){const v=this._internalTexturesCache.slice();for(const y of v)y._rebuild()}_rebuildRenderTargetWrappers(){const v=this._renderTargetWrapperCache.slice();for(const y of v)y._rebuild()}_rebuildEffects(){for(const v in this._compiledEffects){const y=this._compiledEffects[v];y._pipelineContext=null,y._prepareEffect()}P.b.ResetCache()}_rebuildGraphicsResources(){var v;this.wipeCaches(!0),this._rebuildEffects(),null===(v=this._rebuildComputeEffects)||void 0===v||v.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){J.e.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(v){setTimeout((async()=>{this._clearEmptyResources();const y=this._depthCullingState.depthTest,n=this._depthCullingState.depthFunc,B=this._depthCullingState.depthMask,J=this._stencilState.stencilTest;await v(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=y,this._depthCullingState.depthFunc=n,this._depthCullingState.depthMask=B,this._stencilState.stencilTest=J,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(v){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(v){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const v=new Uint8Array(4),y=[v,v,v,v,v,v];this._emptyCubeTexture=this.createRawCubeTexture(y,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(v){if(!v)return this._activeRenderLoops.length=0,void this._cancelFrame();const y=this._activeRenderLoops.indexOf(v);y>=0&&(this._activeRenderLoops.splice(y,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const v=this._frameHandler;if(this._frameHandler=0,(0,i.k)()){const{cancelAnimationFrame:y}=this.getHostWindow()||window;if("function"===typeof y)return y(v)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(v);return clearTimeout(v)}}sj(){this.onBeginFrameObservable.notifyObservers(this)}tj(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let v=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(v=!1),v&&(this.sj(),this._renderViews()||this._renderFrame(),this.tj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let v=0;v<this._activeRenderLoops.length;v++){(0,this._activeRenderLoops[v])()}}_renderViews(){return!1}_queueNewFrame(v,y){return E(v,y)}runRenderLoop(v){-1===this._activeRenderLoops.indexOf(v)&&(this._activeRenderLoops.push(v),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(v){this._depthCullingState.depthTest=v}setZOffset(v){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-v:v}getZOffset(){const v=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-v:v}setZOffsetUnits(v){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-v:v}getZOffsetUnits(){const v=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-v:v}getHostWindow(){return(0,i.k)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(v){this._compatibilityMode=!0}_rebuildTextures(){for(const v of this.scenes)v._rebuildTextures();for(const v of this._virtualScenes)v._rebuildTextures()}_releaseRenderTargetWrapper(v){const y=this._renderTargetWrapperCache.indexOf(v);-1!==y&&this._renderTargetWrapperCache.splice(y,1)}get currentViewport(){return this._cachedViewport}setViewport(v,y,n){const B=y||this.getRenderWidth(),J=n||this.getRenderHeight(),P=v.x||0,b=v.y||0;this._cachedViewport=v,this._viewport(P*B,b*J,B*v.width,J*v.height)}createCanvasImage(){return document.createElement("img")}get description(){let v=this.name+this.version;return this._caps.parallelShaderCompile&&(v+=" - Parallel shader compilation"),v}_createTextureBase(v,y,n,P){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7?arguments[7]:void 0,Z=arguments.length>8?arguments[8]:void 0,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,i=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,g=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,c=arguments.length>13?arguments[13]:void 0,E=arguments.length>14?arguments[14]:void 0,s=arguments.length>15?arguments[15]:void 0;const C="data:"===(v=v||"").substr(0,5),r="blob:"===v.substr(0,5),u=C&&-1!==v.indexOf(";base64,"),O=f||new N.b(this,1);O!==f&&(O.label=v.substring(0,60));const d=v;!this._transformTextureUrl||u||f||x||(v=this._transformTextureUrl(v)),d!==v&&(O._originalUrl=d);const q=v.lastIndexOf(".");let L=g||(q>-1?v.substring(q).toLowerCase():"");L.indexOf("?")>-1&&(L=L.split("?")[0]);const t=(0,h.c)(L,c);P&&P.addPendingData(O),O.url=v,O.generateMipMaps=!y,O.samplingMode=b,O.invertY=n,O._useSRGBBuffer=this._getUseSRGBBuffer(!!s,y),this._doNotHandleContextLost||(O._buffer=x);let G=null;Y&&!f&&(G=O.onLoadedObservable.add(Y)),f||this._internalTexturesCache.push(O);const R=(n,f)=>{P&&P.removePendingData(O),v===d?(G&&O.onLoadedObservable.remove(G),B.b.UseFallbackTexture&&v!==B.b.FallbackTexture&&this._createTextureBase(B.b.FallbackTexture,y,O.invertY,P,b,null,l,a,Z,x,O),n=(n||"Unknown error")+(B.b.UseFallbackTexture?" - Fallback texture was used":""),O.onErrorObservable.notifyObservers({message:n,exception:f}),l&&l(n,f)):(J.e.Warn(`Failed to load ${v}, falling back to ${d}`),this._createTextureBase(d,y,O.invertY,P,b,Y,l,a,Z,x,O,i,g,c,E,s))};if(t){const y=async v=>{(await t).loadData(v,O,((v,y,n,B,J,Y)=>{Y?R("TextureLoader failed to load data"):a(O,L,P,{width:v,height:y},O.invertY,!n,B,(()=>(J(),!1)),b)}),E)};x?x instanceof ArrayBuffer?y(new Uint8Array(x)):ArrayBuffer.isView(x)?y(x):l&&l("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(v,(v=>y(new Uint8Array(v))),void 0,P?P.offlineProvider:void 0,!0,((v,y)=>{R("Unable to load "+(v&&v.responseURL,y))}))}else{const n=v=>{r&&!this._doNotHandleContextLost&&(O._buffer=v),a(O,L,P,v,O.invertY,y,!1,Z,b)};!C||u?x&&("string"===typeof x.decoding||x.close)?n(x):W._FileToolsLoadImage(v||"",n,R,P?P.offlineProvider:null,c,O.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof x||x instanceof ArrayBuffer||ArrayBuffer.isView(x)||x instanceof Blob?W._FileToolsLoadImage(x,n,R,P?P.offlineProvider:null,c,O.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):x&&n(x)}return O}_rebuildBuffers(){for(const v of this._uniformBuffers)v._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,i.g)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const v in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,v)&&(this._boundTexturesCache[v]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(v){this._name=v}static get NpmPackage(){return"babylonjs@7.33.0"}static get Version(){return"7.33.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(v){this._hardwareScalingLevel=v,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(v){this._doNotHandleContextLost=v}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(v,y,n){var J,P;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new l,this._stencilStateComposer=new a,this._stencilState=new Z,this._alphaState=new x,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new g.e,this.onCanvasFocusObservable=new g.e,this.onNewSceneAddedObservable=new g.e,this.onResizeObservable=new g.e,this.onCanvasPointerOutObservable=new g.e,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new g.e,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new g.e,this.onAfterShaderCompilationObservable=new g.e,this.onBeginFrameObservable=new g.e,this.onEndFrameObservable=new g.e,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new g.e,this.onContextRestoredObservable=new g.e,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.xj=new g.e,B.b.Instances.push(this),this.startTime=Y.d.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,b.d.SetMatrixPrecision(!!y.useHighPrecisionMatrix),(0,i.h)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=n??!1,y.antialias=v??y.antialias,y.deterministicLockstep=y.deterministicLockstep??!1,y.lockstepMaxSteps=y.lockstepMaxSteps??4,y.timeStep=y.timeStep??1/60,y.audioEngine=y.audioEngine??!0,y.stencil=y.stencil??!0,this._audioContext=(null===(J=y.audioEngineOptions)||void 0===J?void 0:J.audioContext)??null,this._audioDestination=(null===(P=y.audioEngineOptions)||void 0===P?void 0:P.audioDestination)??null,this.premultipliedAlpha=y.premultipliedAlpha??!0,this._doNotHandleContextLost=!!y.doNotHandleContextLost,this._isStencilEnable=!!y.stencil,this.useExactSrgbConversions=y.useExactSrgbConversions??!1;const f=(0,i.k)()&&window.devicePixelRatio||1,N=y.limitDeviceRatio||f;n=n||y.adaptToDeviceRatio||!1,this._hardwareScalingLevel=n?1/Math.min(N,f):1,this._lastDevicePixelRatio=f,this._creationOptions=y}resize(){let v,y,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const v=(0,i.k)()&&window.devicePixelRatio||1,y=this._lastDevicePixelRatio/v;this._lastDevicePixelRatio=v,this._hardwareScalingLevel*=y}if((0,i.k)()&&(0,i.g)())if(this._renderingCanvas){const n=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};v=this._renderingCanvas.clientWidth||n.width||this._renderingCanvas.width||100,y=this._renderingCanvas.clientHeight||n.height||this._renderingCanvas.height||100}else v=window.innerWidth,y=window.innerHeight;else v=this._renderingCanvas?this._renderingCanvas.width:100,y=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(v/this._hardwareScalingLevel,y/this._hardwareScalingLevel,n)}setSize(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(v|=0,y|=0,!n&&this._renderingCanvas.width===v&&this._renderingCanvas.height===y)return!1;if(this._renderingCanvas.width=v,this._renderingCanvas.height=y,this.scenes){for(let v=0;v<this.scenes.length;v++){const y=this.scenes[v];for(let v=0;v<y.cameras.length;v++){y.cameras[v]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(v,y,n,B,J,P,b,Y,l,a,Z){throw(0,f.e)("engine.rawTexture")}createRawCubeTexture(v,y,n,B,J,P,b,Y){throw(0,f.e)("engine.rawTexture")}createRawTexture3D(v,y,n,B,J,P,b,Y,l,a,Z){throw(0,f.e)("engine.rawTexture")}createRawTexture2DArray(v,y,n,B,J,P,b,Y,l,a,Z){throw(0,f.e)("engine.rawTexture")}_sharedInit(v){this._renderingCanvas=v}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const v=navigator.userAgent;this.hostInformation.isMobile=-1!==v.indexOf("Mobile")||-1!==v.indexOf("Mac")&&(0,i.g)()&&"ontouchend"in document},this._checkForMobile(),(0,i.k)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(v){return document.createElement("video")}_reportDrawCall(){var v;let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(v=this._drawCalls)||void 0===v||v.addCount(y,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(v,y){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(v,y){return createImageBitmap(v,y)}resizeImageBitmap(v,y,n){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(v){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(v,y){if("undefined"===typeof document)return new OffscreenCanvas(v,y);const n=document.createElement("canvas");return n.width=v,n.height=y,n}createCanvas(v,y){return W._CreateCanvas(v,y)}static _FileToolsLoadImage(v,y,n,B,J,P){throw(0,f.e)("FileTools")}_loadFile(v,y,n,B,J,P){const b=(0,c.l)(v,y,n,B,J,P);return this._activeRequests.push(b),b.onCompleteObservable.add((()=>{const v=this._activeRequests.indexOf(b);-1!==v&&this._activeRequests.splice(v,1)})),b}static _FileToolsLoadFile(v,y,n,B,J,P){if(c.c.loadFile)return c.c.loadFile(v,y,n,B,J,P);throw(0,f.e)("FileTools")}dispose(){var v;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(v=this.releaseComputeEffects)||void 0===v||v.call(this),P.b.ResetCache();for(const n of this._activeRequests)n.abort();this._boundRenderFunction=null,this.xj.notifyObservers(this),this.xj.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,i.k)()&&window.removeEventListener("resize",this._checkForMobile);const y=B.b.Instances.indexOf(this);y>=0&&B.b.Instances.splice(y,1),B.b.Instances.length||(B.b.OnEnginesDisposedObservable.notifyObservers(this),B.b.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(v){throw(0,f.e)("LoadingScreen")}static MarkAllMaterialsAsDirty(v,y){for(let n=0;n<B.b.Instances.length;n++){const J=B.b.Instances[n];for(let n=0;n<J.scenes.length;n++)J.scenes[n].markAllMaterialsAsDirty(v,y)}}}W._RenderPassIdCounter=0,W._RescalePostProcessFactory=null,W.CollisionsEpsilon=.001,W.QueueNewFrame=E},11538:(v,y,n)=>{"use strict";n.d(y,{b:()=>O});var B=n(10885),J=n(10820),P=n(11503),b=n(10805);class Y{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new l(v)}sampleFrame(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.d.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const y=v-this._lastFrameTimeMs;this._rollingFrameTime.add(y)}this._lastFrameTimeMs=v}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const v=this._rollingFrameTime.history(0);return 0===v?0:1e3/v}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class l{constructor(v){this._samples=new Array(v),this.reset()}add(v){let y;if(this.isSaturated()){const v=this._samples[this._pos];y=v-this.average,this.average-=y/(this._sampleCount-1),this._m2-=y*(v-this.average)}else this._sampleCount++;y=v-this.average,this.average+=y/this._sampleCount,this._m2+=y*(v-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=v,this._pos++,this._pos%=this._samples.length}history(v){if(v>=this._sampleCount||v>=this._samples.length)return 0;const y=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(y-v)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(v){const y=this._samples.length;return(v%y+y)%y}}var a=n(11510),Z=n(10801),x=n(11517),f=(n(11531),n(10914));function N(v,y,n,B){let J,P=1;1===B?J=new Float32Array(y*n*4):2===B?(J=new Uint16Array(y*n*4),P=15360):J=7===B?new Uint32Array(y*n*4):new Uint8Array(y*n*4);for(let b=0;b<y;b++)for(let B=0;B<n;B++){const n=3*(B*y+b),Y=4*(B*y+b);J[Y+0]=v[n+0],J[Y+1]=v[n+1],J[Y+2]=v[n+2],J[Y+3]=P}return J}function i(v){return function(y,n,J,P,b,Y,l,a){let Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const f=v?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,N=v?10:11,i=new B.b(this,N);i.baseWidth=n,i.baseHeight=J,i.baseDepth=P,i.width=n,i.height=J,i.depth=P,i.format=b,i.type=x,i.generateMipMaps=Y,i.samplingMode=a,v?i.is3D=!0:i.is2DArray=!0,this._doNotHandleContextLost||(i._bufferView=y),v?this.updateRawTexture3D(i,y,b,l,Z,x):this.updateRawTexture2DArray(i,y,b,l,Z,x),this._bindTextureDirectly(f,i,!0);const g=this._getSamplingParameters(a,Y);return this._gl.texParameteri(f,this._gl.TEXTURE_MAG_FILTER,g.mag),this._gl.texParameteri(f,this._gl.TEXTURE_MIN_FILTER,g.min),Y&&this._gl.generateMipmap(f),this._bindTextureDirectly(f,null),this._internalTexturesCache.push(i),i}}function g(v){return function(y,n,B,J){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const Y=v?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,l=this._getWebGLTextureType(b),a=this._getInternalFormat(B),Z=this._getRGBABufferInternalSizedFormat(b,B);this._bindTextureDirectly(Y,y,!0),this._unpackFlipY(void 0===J||!!J),this._doNotHandleContextLost||(y._bufferView=n,y.format=B,y.invertY=J,y._compression=P),y.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),P&&n?this._gl.compressedTexImage3D(Y,0,this.getCaps().s3tc[P],y.width,y.height,y.depth,0,n):this._gl.texImage3D(Y,0,Z,y.width,y.height,y.depth,0,a,l,n),y.generateMipMaps&&this._gl.generateMipmap(Y),this._bindTextureDirectly(Y,null),y.isReady=!0}}P.ThinEngine.prototype.updateRawTexture=function(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!v)return;const Y=this._getRGBABufferInternalSizedFormat(P,n,b),l=this._getInternalFormat(n),a=this._getWebGLTextureType(P);this._bindTextureDirectly(this._gl.TEXTURE_2D,v,!0),this._unpackFlipY(void 0===B||!!B),this._doNotHandleContextLost||(v._bufferView=y,v.format=n,v.type=P,v.invertY=B,v._compression=J),v.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),J&&y?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[J],v.width,v.height,0,y):this._gl.texImage2D(this._gl.TEXTURE_2D,0,Y,v.width,v.height,0,l,a,y),v.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),v.isReady=!0},P.ThinEngine.prototype.createRawTexture=function(v,y,n,J,P,b,Y){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Z=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const x=new B.b(this,3);x.baseWidth=y,x.baseHeight=n,x.width=y,x.height=n,x.format=J,x.generateMipMaps=P,x.samplingMode=Y,x.invertY=b,x._compression=l,x.type=a,x._useSRGBBuffer=this._getUseSRGBBuffer(Z,!P),this._doNotHandleContextLost||(x._bufferView=v),this.updateRawTexture(x,v,J,b,l,a,x._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,x,!0);const f=this._getSamplingParameters(Y,P);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,f.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,f.min),P&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(x),x},P.ThinEngine.prototype.createRawCubeTexture=function(v,y,n,J,P,b,Y){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const a=this._gl,x=new B.b(this,8);x.isCube=!0,x.format=n,x.type=J,this._doNotHandleContextLost||(x._bufferViewArray=v);const N=this._getWebGLTextureType(J);let i=this._getInternalFormat(n);i===a.RGB&&(i=a.RGBA),N!==a.FLOAT||this._caps.textureFloatLinearFiltering?N!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?N!==a.FLOAT||this._caps.textureFloatRender?N!==a.HALF_FLOAT||this._caps.colorBufferFloat||(P=!1,Z.e.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(P=!1,Z.e.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(P=!1,Y=1,Z.e.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(P=!1,Y=1,Z.e.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const g=y,c=g;x.width=g,x.height=c,x.invertY=b,x._compression=l;if(!this.needPOTTextures||(0,f.j)(x.width)&&(0,f.j)(x.height)||(P=!1),v)this.updateRawCubeTexture(x,v,n,J,b,l);else{const v=this._getRGBABufferInternalSizedFormat(J),y=0;this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,x,!0);for(let n=0;n<6;n++)l?a.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+n,y,this.getCaps().s3tc[l],x.width,x.height,0,void 0):a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+n,y,v,x.width,x.height,0,i,N,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,x,!0),v&&P&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const h=this._getSamplingParameters(Y,P);return a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,h.mag),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,h.min),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),x.generateMipMaps=P,x.samplingMode=Y,x.isReady=!0,x},P.ThinEngine.prototype.updateRawCubeTexture=function(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;v._bufferViewArray=y,v.format=n,v.type=B,v.invertY=J,v._compression=P;const Y=this._gl,l=this._getWebGLTextureType(B);let a=this._getInternalFormat(n);const Z=this._getRGBABufferInternalSizedFormat(B);let x=!1;a===Y.RGB&&(a=Y.RGBA,x=!0),this._bindTextureDirectly(Y.TEXTURE_CUBE_MAP,v,!0),this._unpackFlipY(void 0===J||!!J),v.width%4!==0&&Y.pixelStorei(Y.UNPACK_ALIGNMENT,1);for(let f=0;f<6;f++){let n=y[f];P?Y.compressedTexImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+f,b,this.getCaps().s3tc[P],v.width,v.height,0,n):(x&&(n=N(n,v.width,v.height,B)),Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+f,b,Z,v.width,v.height,0,a,l,n))}(!this.needPOTTextures||(0,f.j)(v.width)&&(0,f.j)(v.height))&&v.generateMipMaps&&0===b&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),v.isReady=!0},P.ThinEngine.prototype.createRawCubeTextureFromUrl=function(v,y,n,B,J,P,b,Y){let l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,x=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const f=this._gl,i=this.createRawCubeTexture(null,n,B,J,!P,x,Z,null);null===y||void 0===y||y.addPendingData(i),i.url=v,i.isReady=!1,this._internalTexturesCache.push(i);const g=v=>{const n=i.width,P=b(v);if(P){if(Y){const v=this._getWebGLTextureType(J);let y=this._getInternalFormat(B);const b=this._getRGBABufferInternalSizedFormat(J);let l=!1;y===f.RGB&&(y=f.RGBA,l=!0),this._bindTextureDirectly(f.TEXTURE_CUBE_MAP,i,!0),this._unpackFlipY(!1);const a=Y(P);for(let B=0;B<a.length;B++){const P=n>>B;for(let n=0;n<6;n++){let Y=a[B][n];l&&(Y=N(Y,P,P,J)),f.texImage2D(n,B,b,P,P,0,y,v,Y)}}this._bindTextureDirectly(f.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(i,P,B,J,x);i.isReady=!0,null===y||void 0===y||y.removePendingData(i),i.onLoadedObservable.notifyObservers(i),i.onLoadedObservable.clear(),l&&l()}};return this._loadFile(v,(v=>{g(v)}),void 0,null===y||void 0===y?void 0:y.offlineProvider,!0,((v,n)=>{null===y||void 0===y||y.removePendingData(i),a&&v&&a(v.status+" "+v.statusText,n)})),i},P.ThinEngine.prototype.createRawTexture2DArray=i(!1),P.ThinEngine.prototype.createRawTexture3D=i(!0),P.ThinEngine.prototype.updateRawTexture2DArray=g(!1),P.ThinEngine.prototype.updateRawTexture3D=g(!0);var c=n(10845);P.ThinEngine.prototype._readTexturePixelsSync=function(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],Y=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const Z=this._gl;if(!Z)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const v=Z.createFramebuffer();if(!v)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=v}var x,f;(Z.bindFramebuffer(Z.FRAMEBUFFER,this._dummyFramebuffer),B>-1)?Z.framebufferTexture2D(Z.FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Z.TEXTURE_CUBE_MAP_POSITIVE_X+B,null===(x=v._hardwareTexture)||void 0===x?void 0:x.underlyingResource,J):Z.framebufferTexture2D(Z.FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Z.TEXTURE_2D,null===(f=v._hardwareTexture)||void 0===f?void 0:f.underlyingResource,J);let N=void 0!==v.type?this._getWebGLTextureType(v.type):Z.UNSIGNED_BYTE;if(Y)P||(P=(0,c.m)(v.type,4*y*n));else if(N===Z.UNSIGNED_BYTE)P||(P=new Uint8Array(4*y*n)),N=Z.UNSIGNED_BYTE;else P||(P=new Float32Array(4*y*n)),N=Z.FLOAT;return b&&this.flushFramebuffer(),Z.readPixels(l,a,y,n,Z.RGBA,N,P),Z.bindFramebuffer(Z.FRAMEBUFFER,this._currentFramebuffer),P},P.ThinEngine.prototype._readTexturePixels=function(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],Y=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(v,y,n,B,J,P,b,Y,l,a))};n(11500);P.ThinEngine.prototype._createDepthStencilCubeTexture=function(v,y){const n=new B.b(this,12);if(n.isCube=!0,1===this.webGLVersion)return Z.e.Error("Depth cube texture is not supported by WebGL 1."),n;const J={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...y},P=this._gl;this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,n,!0),this._setupDepthStencilTexture(n,v,J.bilinearFiltering,J.comparisonFunction);for(let B=0;B<6;B++)J.generateStencil?P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+B,0,P.DEPTH24_STENCIL8,v,v,0,P.DEPTH_STENCIL,P.UNSIGNED_INT_24_8,null):P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+B,0,P.DEPTH_COMPONENT24,v,v,0,P.DEPTH_COMPONENT,P.UNSIGNED_INT,null);return this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(n),n},P.ThinEngine.prototype._setCubeMapTextureParams=function(v,y,n){const B=this._gl;B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MAG_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MIN_FILTER,y?B.LINEAR_MIPMAP_LINEAR:B.LINEAR),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),v.samplingMode=y?3:2,y&&this.getCaps().textureMaxLevel&&void 0!==n&&n>0&&(B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MAX_LEVEL,n),v._maxLodLevel=n),this._bindTextureDirectly(B.TEXTURE_CUBE_MAP,null)},P.ThinEngine.prototype.createCubeTexture=function(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6?arguments[6]:void 0,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,N=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,i=arguments.length>13&&void 0!==arguments[13]&&arguments[13],g=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const c=this._gl;return this.createCubeTextureBase(v,y,n,!!B,J,P,b,Y,l,a,x,N,(v=>this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,v,!0)),((v,y)=>{const n=this.needPOTTextures?(0,f.g)(y[0].width,this._caps.maxCubemapTextureSize):y[0].width,P=n,Y=[c.TEXTURE_CUBE_MAP_POSITIVE_X,c.TEXTURE_CUBE_MAP_POSITIVE_Y,c.TEXTURE_CUBE_MAP_POSITIVE_Z,c.TEXTURE_CUBE_MAP_NEGATIVE_X,c.TEXTURE_CUBE_MAP_NEGATIVE_Y,c.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,v,!0),this._unpackFlipY(!1);const l=b?this._getInternalFormat(b,v._useSRGBBuffer):v._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:c.RGBA;let a=b?this._getInternalFormat(b):c.RGBA;v._useSRGBBuffer&&1===this.webGLVersion&&(a=l);for(let B=0;B<Y.length;B++)if(y[B].width!==n||y[B].height!==P){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void Z.e.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=n,this._workingCanvas.height=P,this._workingContext.drawImage(y[B],0,0,y[B].width,y[B].height,0,0,n,P),c.texImage2D(Y[B],0,l,a,c.UNSIGNED_BYTE,this._workingCanvas)}else c.texImage2D(Y[B],0,l,a,c.UNSIGNED_BYTE,y[B]);B||c.generateMipmap(c.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(v,!B),v.width=n,v.height=P,v.isReady=!0,b&&(v.format=b),v.onLoadedObservable.notifyObservers(v),v.onLoadedObservable.clear(),J&&J()}),!!i,g)},P.ThinEngine.prototype.generateMipMapsForCubemap=function(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(v.generateMipMaps){const n=this._gl;this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,v,!0),n.generateMipmap(n.TEXTURE_CUBE_MAP),y&&this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null)}};n(11540);P.ThinEngine.prototype.setDepthStencilTexture=function(v,y,n,B){void 0!==v&&(y&&(this._boundUniforms[v]=y),n&&n.depthStencilTexture?this._setTexture(v,n,!1,!0,B):this._setTexture(v,null,void 0,void 0,B))},P.ThinEngine.prototype.createRenderTargetCubeTexture=function(v,y){const n=this._createHardwareRenderTargetWrapper(!1,!0,v),J={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...y};J.generateStencilBuffer=J.generateDepthBuffer&&J.generateStencilBuffer,(1!==J.type||this._caps.textureFloatLinearFiltering)&&(2!==J.type||this._caps.textureHalfFloatLinearFiltering)||(J.samplingMode=1);const P=this._gl,b=new B.b(this,5);this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,b,!0);const Y=this._getSamplingParameters(J.samplingMode,J.generateMipMaps);1!==J.type||this._caps.textureFloat||(J.type=0,Z.e.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_MAG_FILTER,Y.mag),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_MIN_FILTER,Y.min),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE);for(let B=0;B<6;B++)P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+B,0,this._getRGBABufferInternalSizedFormat(J.type,J.format),v,v,0,this._getInternalFormat(J.format),this._getWebGLTextureType(J.type),null);const l=P.createFramebuffer();return this._bindUnboundFramebuffer(l),n._depthStencilBuffer=this._setupFramebufferDepthAttachments(J.generateStencilBuffer,J.generateDepthBuffer,v,v),J.generateMipMaps&&P.generateMipmap(P.TEXTURE_CUBE_MAP),this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),n._framebuffer=l,n._generateDepthBuffer=J.generateDepthBuffer,n._generateStencilBuffer=J.generateStencilBuffer,b.width=v,b.height=v,b.isReady=!0,b.isCube=!0,b.samples=1,b.generateMipMaps=J.generateMipMaps,b.samplingMode=J.samplingMode,b.type=J.type,b.format=J.format,this._internalTexturesCache.push(b),n.setTextures(b),n};var h=n(11559),E=n(11283),W=n(11576);P.ThinEngine.prototype.createPrefilteredCubeTexture=function(v,y,n,J){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6?arguments[6]:void 0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(v,y,null,!1,(v=>{if(!v)return void(P&&P(null));const b=v.texture;if(a?v.info.sphericalPolynomial&&(b._sphericalPolynomial=v.info.sphericalPolynomial):b._sphericalPolynomial=new h.f,b._source=9,this.getCaps().textureLOD)return void(P&&P(b));const Y=this._gl,l=v.width;if(!l)return;const x=[];for(let P=0;P<3;P++){const a=1-P/2,f=J,N=Math.log2(l)*n+J,i=f+(N-f)*a,g=Math.round(Math.min(Math.max(i,0),N)),c=new B.b(this,2);if(c.type=b.type,c.format=b.format,c.width=Math.pow(2,Math.max(Math.log2(l)-g,0)),c.height=c.width,c.isCube=!0,c._cachedWrapU=0,c._cachedWrapV=0,this._bindTextureDirectly(Y.TEXTURE_CUBE_MAP,c,!0),c.samplingMode=2,Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),v.isDDS){const y=v.info,n=v.data;this._unpackFlipY(y.isCompressed),W.e.UploadDDSLevels(this,c,n,y,!0,6,g)}else Z.e.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(Y.TEXTURE_CUBE_MAP,null);const h=new E.b(y);h._isCube=!0,h._texture=c,c.isReady=!0,x.push(h)}b._lodTextureHigh=x[2],b._lodTextureMid=x[1],b._lodTextureLow=x[0],P&&P(b)}),b,Y,l,a,n,J)},P.ThinEngine.prototype.createUniformBuffer=function(v,y){const n=this._gl.createBuffer();if(!n)throw new Error("Unable to create uniform buffer");const B=new a.c(n);return this.bindUniformBuffer(B),v instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,v,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(v),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),B.references=1,B},P.ThinEngine.prototype.createDynamicUniformBuffer=function(v,y){const n=this._gl.createBuffer();if(!n)throw new Error("Unable to create dynamic uniform buffer");const B=new a.c(n);return this.bindUniformBuffer(B),v instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,v,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(v),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),B.references=1,B},P.ThinEngine.prototype.updateUniformBuffer=function(v,y,n,B){this.bindUniformBuffer(v),void 0===n&&(n=0),void 0===B?y instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,n,y):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,n,new Float32Array(y)):y instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,y.subarray(n,n+B)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(y).subarray(n,n+B)),this.bindUniformBuffer(null)},P.ThinEngine.prototype.bindUniformBuffer=function(v){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,v?v.underlyingResource:null)},P.ThinEngine.prototype.bindUniformBufferBase=function(v,y,n){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,y,v?v.underlyingResource:null)},P.ThinEngine.prototype.bindUniformBlock=function(v,y,n){const B=v.program,J=this._gl.getUniformBlockIndex(B,y);4294967295!==J&&this._gl.uniformBlockBinding(B,J,n)};var s=n(10797),C=n(10849);C.c.prototype.displayLoadingUI=function(){if(!(0,s.k)())return;const v=this.loadingScreen;v&&v.displayLoadingUI()},C.c.prototype.hideLoadingUI=function(){if(!(0,s.k)())return;const v=this._loadingScreen;v&&v.hideLoadingUI()},Object.defineProperty(C.c.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=C.c.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(v){this._loadingScreen=v},enumerable:!0,configurable:!0}),Object.defineProperty(C.c.prototype,"loadingUIText",{set:function(v){this.loadingScreen.loadingUIText=v},enumerable:!0,configurable:!0}),Object.defineProperty(C.c.prototype,"loadingUIBackgroundColor",{set:function(v){this.loadingScreen.loadingUIBackgroundColor=v},enumerable:!0,configurable:!0}),C.c.prototype.getInputElement=function(){return this._renderingCanvas},C.c.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},C.c.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},C.c.prototype.getAspectRatio=function(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=v.viewport;return this.getRenderWidth(y)*n.width/(this.getRenderHeight(y)*n.height)},C.c.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},C.c.prototype._verifyPointerLock=function(){var v;null===(v=this._onPointerLockChange)||void 0===v||v.call(this)},C.c.prototype.setAlphaEquation=function(v){if(this._alphaEquation!==v){switch(v){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=v}},C.c.prototype.getInputElement=function(){return this._renderingCanvas},C.c.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},C.c.prototype.setDepthFunction=function(v){this._depthCullingState.depthFunc=v},C.c.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},C.c.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},C.c.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},C.c.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},C.c.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},C.c.prototype.setDepthWrite=function(v){this._depthCullingState.depthMask=v},C.c.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},C.c.prototype.setStencilBuffer=function(v){this._stencilState.stencilTest=v},C.c.prototype.getStencilMask=function(){return this._stencilState.stencilMask},C.c.prototype.setStencilMask=function(v){this._stencilState.stencilMask=v},C.c.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},C.c.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},C.c.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},C.c.prototype.setStencilFunction=function(v){this._stencilState.stencilFunc=v},C.c.prototype.setStencilFunctionReference=function(v){this._stencilState.stencilFuncRef=v},C.c.prototype.setStencilFunctionMask=function(v){this._stencilState.stencilFuncMask=v},C.c.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},C.c.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},C.c.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},C.c.prototype.setStencilOperationFail=function(v){this._stencilState.stencilOpStencilFail=v},C.c.prototype.setStencilOperationDepthFail=function(v){this._stencilState.stencilOpDepthFail=v},C.c.prototype.setStencilOperationPass=function(v){this._stencilState.stencilOpStencilDepthPass=v},C.c.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},C.c.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},C.c.prototype.setAlphaConstants=function(v,y,n,B){this._alphaState.setAlphaBlendConstants(v,y,n,B)},C.c.prototype.getAlphaMode=function(){return this._alphaMode},C.c.prototype.getAlphaEquation=function(){return this._alphaEquation},C.c.prototype.getRenderPassNames=function(){return this._renderPassNames},C.c.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},C.c.prototype.createRenderPassId=function(v){const y=++C.c._RenderPassIdCounter;return this._renderPassNames[y]=v??"NONAME",y},C.c.prototype.releaseRenderPassId=function(v){this._renderPassNames[v]=void 0;for(let y=0;y<this.scenes.length;++y){const n=this.scenes[y];for(let y=0;y<n.meshes.length;++y){const B=n.meshes[y];if(B.Ag)for(let y=0;y<B.Ag.length;++y){B.Ag[y]._removeDrawWrapper(v)}}}};n(11555);function r(v){if(v.requestPointerLock){const y=v.requestPointerLock();y instanceof Promise?y.then((()=>{v.focus()})).catch((()=>{})):v.focus()}}var u=n(10919);n(11630);class O extends P.ThinEngine{static get NpmPackage(){return C.c.NpmPackage}static get Version(){return C.c.Version}static get Instances(){return J.b.Instances}static get LastCreatedEngine(){return J.b.LastCreatedEngine}static get LastCreatedScene(){return J.b.LastCreatedScene}static DefaultLoadingScreenFactory(v){return C.c.DefaultLoadingScreenFactory(v)}get _supportsHardwareTextureRescaling(){return!!O._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(v,y,n){if(super(v,y,n,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new Y,this._drawCalls=new u.c,v&&(this._features.supportRenderPasses=!0,n=this._creationOptions,v.getContext)){const y=v;this._sharedInit(y)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(v){super._sharedInit(v),function(v,y,n){v._onCanvasFocus=()=>{v.onCanvasFocusObservable.notifyObservers(v)},v._onCanvasBlur=()=>{v.onCanvasBlurObservable.notifyObservers(v)},v._onCanvasContextMenu=y=>{v.disableContextMenu&&y.preventDefault()},y.addEventListener("focus",v._onCanvasFocus),y.addEventListener("blur",v._onCanvasBlur),y.addEventListener("contextmenu",v._onCanvasContextMenu),v._onBlur=()=>{v.disablePerformanceMonitorInBackground&&v.performanceMonitor.disable(),v._windowIsBackground=!0},v._onFocus=()=>{v.disablePerformanceMonitorInBackground&&v.performanceMonitor.enable(),v._windowIsBackground=!1},v._onCanvasPointerOut=n=>{document.elementFromPoint(n.clientX,n.clientY)!==y&&v.onCanvasPointerOutObservable.notifyObservers(n)};const B=v.getHostWindow();B&&"function"===typeof B.addEventListener&&(B.addEventListener("blur",v._onBlur),B.addEventListener("focus",v._onFocus)),y.addEventListener("pointerout",v._onCanvasPointerOut),n.doNotHandleTouchAction||function(v){v&&v.setAttribute&&(v.setAttribute("touch-action","none"),v.style.touchAction="none",v.style.webkitTapHighlightColor="transparent")}(y),!C.c.audioEngine&&n.audioEngine&&C.c.AudioEngineFactory&&(C.c.audioEngine=C.c.AudioEngineFactory(v.getRenderingCanvas(),v.getAudioContext(),v.getAudioDestination())),(0,s.g)()&&(v._onFullscreenChange=()=>{v.isFullscreen=!!document.fullscreenElement,v.isFullscreen&&v._pointerLockRequested&&y&&r(y)},document.addEventListener("fullscreenchange",v._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",v._onFullscreenChange,!1),v._onPointerLockChange=()=>{v.isPointerLock=document.pointerLockElement===y},document.addEventListener("pointerlockchange",v._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",v._onPointerLockChange,!1)),v.enableOfflineSupport=void 0!==C.c.OfflineProviderFactory,v._deterministicLockstep=!!n.deterministicLockstep,v._lockstepMaxSteps=n.lockstepMaxSteps||0,v._timeStep=n.timeStep||1/60}(this,v,this._creationOptions)}resizeImageBitmap(v,y,n){return function(v,y,n,B){const J=v.createCanvas(n,B).getContext("2d");if(!J)throw new Error("Unable to get 2d context for resizeImageBitmap");return J.drawImage(y,0,0),J.getImageData(0,0,n,B).data}(this,v,y,n)}_createImageBitmapFromSource(v,y){return function(v,y,n){return new Promise(((B,J)=>{const P=new Image;P.onload=()=>{P.decode().then((()=>{v.createImageBitmap(P,n).then((v=>{B(v)}))}))},P.onerror=()=>{J(`Error loading image ${P.src}`)},P.src=y}))}(this,v,y)}switchFullscreen(v){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(v)}enterFullscreen(v){this.isFullscreen||(this._pointerLockRequested=v,this._renderingCanvas&&function(v){const y=v.requestFullscreen||v.webkitRequestFullscreen;y&&y.call(v)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const v=document;document.exitFullscreen?document.exitFullscreen():v.webkitCancelFullScreen&&v.webkitCancelFullScreen()}()}setDitheringState(v){v?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(v){v?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(v,y,n,B){const J=this._cachedViewport;return this._cachedViewport=null,this._viewport(v,y,n,B),J}scissorClear(v,y,n,B,J){this.enableScissor(v,y,n,B),this.clear(J,!0,!0,!0),this.disableScissor()}enableScissor(v,y,n,B){const J=this._gl;J.enable(J.SCISSOR_TEST),J.scissor(v,y,n,B)}disableScissor(){const v=this._gl;v.disable(v.SCISSOR_TEST)}_loadFileAsync(v,y,n){return new Promise(((B,J)=>{this._loadFile(v,(v=>{B(v)}),void 0,y,n,((v,y)=>{J(y)}))}))}getVertexShaderSource(v){const y=this._gl.getAttachedShaders(v);return y?this._gl.getShaderSource(y[0]):null}getFragmentShaderSource(v){const y=this._gl.getAttachedShaders(v);return y?this._gl.getShaderSource(y[1]):null}set framebufferDimensionsObject(v){this._framebufferDimensionsObject=v,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const v of this.scenes)v.resetCachedMaterial(),v._rebuildGeometries();for(const v of this._virtualScenes)v.resetCachedMaterial(),v._rebuildGeometries();super._rebuildBuffers()}getFontOffset(v){return function(v){const y=document.createElement("span");y.textContent="Hg",y.style.font=v;const n=document.createElement("div");n.style.display="inline-block",n.style.width="1px",n.style.height="0px",n.style.verticalAlign="bottom";const B=document.createElement("div");B.style.whiteSpace="nowrap",B.appendChild(y),B.appendChild(n),document.body.appendChild(B);let J=0,P=0;try{P=n.getBoundingClientRect().top-y.getBoundingClientRect().top,n.style.verticalAlign="baseline",J=n.getBoundingClientRect().top-y.getBoundingClientRect().top}finally{document.body.removeChild(B)}return{ascent:J,height:P,descent:P-J}}(v)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:v}=this.customAnimationFrameRequester;v&&v(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let v=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(v=!1),v&&(this.sj(),this._renderViews()||this._renderFrame(),this.tj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&r(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}sj(){this._measureFps(),super.sj()}_deletePipelineContext(v){const y=v;y&&y.program&&y.transformFeedback&&(this.deleteTransformFeedback(y.transformFeedback),y.transformFeedback=null),super._deletePipelineContext(v)}createShaderProgram(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;J=J||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const b=super.createShaderProgram(v,y,n,B,J,P);return this.onAfterShaderCompilationObservable.notifyObservers(this),b}_createShaderProgram(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const P=B.createProgram();if(v.program=P,!P)throw new Error("Unable to create program");if(B.attachShader(P,y),B.attachShader(P,n),this.webGLVersion>1&&J){const y=this.createTransformFeedback();this.bindTransformFeedback(y),this.setTranformFeedbackVaryings(P,J),v.transformFeedback=y}return B.linkProgram(P),this.webGLVersion>1&&J&&this.bindTransformFeedback(null),v.context=B,v.vertexShader=y,v.fragmentShader=n,v.isParallelCompiled||this._finalizePipelineContext(v),P}_releaseTexture(v){super._releaseTexture(v)}_releaseRenderTargetWrapper(v){super._releaseRenderTargetWrapper(v),this.scenes.forEach((y=>{y.postProcesses.forEach((y=>{y._outputTexture===v&&(y._outputTexture=null)})),y.cameras.forEach((y=>{y._postProcesses.forEach((y=>{y&&y._outputTexture===v&&(y._outputTexture=null)}))}))}))}_rescaleTexture(v,y,n,B,J){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const P=this.createRenderTargetTexture({width:y.width,height:y.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&O._RescalePostProcessFactory&&(this._rescalePostProcess=O._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const b=()=>{this._rescalePostProcess.onApply=function(y){y._bindTexture("textureSampler",v)};let b=n;b||(b=this.scenes[this.scenes.length-1]),b.postProcessManager.directRender([this._rescalePostProcess],P,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,y,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,B,0,0,y.width,y.height,0),this.unBindFramebuffer(P),P.dispose(),J&&J()},Y=this._rescalePostProcess.getEffect();Y?Y.executeWhenCompiled(b):this._rescalePostProcess.onEffectCreatedObservable.addOnce((v=>{v.executeWhenCompiled(b)}))}}wrapWebGLTexture(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const b=new x.b(v,this._gl),Y=new B.b(this,0,!0);return Y._hardwareTexture=b,Y.baseWidth=J,Y.baseHeight=P,Y.width=J,Y.height=P,Y.isReady=!0,Y.useMipMaps=y,this.updateTextureSamplingMode(n,Y),Y}_uploadImageToTexture(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const J=this._gl,P=this._getWebGLTextureType(v.type),b=this._getInternalFormat(v.format),Y=this._getRGBABufferInternalSizedFormat(v.type,b),l=v.isCube?J.TEXTURE_CUBE_MAP:J.TEXTURE_2D;this._bindTextureDirectly(l,v,!0),this._unpackFlipY(v.invertY);let a=J.TEXTURE_2D;v.isCube&&(a=J.TEXTURE_CUBE_MAP_POSITIVE_X+n),J.texImage2D(a,B,Y,b,P,y),this._bindTextureDirectly(l,null,!0)}updateTextureComparisonFunction(v,y){if(1===this.webGLVersion)return void Z.e.Error("WebGL 1 does not support texture comparison.");const n=this._gl;v.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,v,!0),0===y?(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,515),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,y),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,v,!0),0===y?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,515),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,y),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),v._comparisonFunction=y}createInstancesBuffer(v){const y=this._gl.createBuffer();if(!y)throw new Error("Unable to create instance buffer");const n=new a.c(y);return n.ob=v,this.bindArrayBuffer(n),this._gl.bufferData(this._gl.ARRAY_BUFFER,v,this._gl.DYNAMIC_DRAW),n.references=1,n}deleteInstancesBuffer(v){this._gl.deleteBuffer(v)}_clientWaitAsync(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const B=this._gl;return new Promise(((J,P)=>{const b=()=>{const Y=B.clientWaitSync(v,y,0);Y!=B.WAIT_FAILED?Y!=B.TIMEOUT_EXPIRED?J():setTimeout(b,n):P()};b()}))}_readPixelsAsync(v,y,n,B,J,P,b){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const Y=this._gl,l=Y.createBuffer();Y.bindBuffer(Y.PIXEL_PACK_BUFFER,l),Y.bufferData(Y.PIXEL_PACK_BUFFER,b.byteLength,Y.STREAM_READ),Y.readPixels(v,y,n,B,J,P,0),Y.bindBuffer(Y.PIXEL_PACK_BUFFER,null);const a=Y.fenceSync(Y.SYNC_GPU_COMMANDS_COMPLETE,0);return a?(Y.flush(),this._clientWaitAsync(a,0,10).then((()=>(Y.deleteSync(a),Y.bindBuffer(Y.PIXEL_PACK_BUFFER,l),Y.getBufferSubData(Y.PIXEL_PACK_BUFFER,0,b),Y.bindBuffer(Y.PIXEL_PACK_BUFFER,null),Y.deleteBuffer(l),b)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(v,y){1===J.b.Instances.length&&C.c.audioEngine&&(C.c.audioEngine.dispose(),C.c.audioEngine=null);const n=v.getHostWindow();n&&"function"===typeof n.removeEventListener&&(n.removeEventListener("blur",v._onBlur),n.removeEventListener("focus",v._onFocus)),y&&(y.removeEventListener("focus",v._onCanvasFocus),y.removeEventListener("blur",v._onCanvasBlur),y.removeEventListener("pointerout",v._onCanvasPointerOut),y.removeEventListener("contextmenu",v._onCanvasContextMenu)),(0,s.g)()&&(document.removeEventListener("fullscreenchange",v._onFullscreenChange),document.removeEventListener("mozfullscreenchange",v._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",v._onFullscreenChange),document.removeEventListener("msfullscreenchange",v._onFullscreenChange),document.removeEventListener("pointerlockchange",v._onPointerLockChange),document.removeEventListener("mspointerlockchange",v._onPointerLockChange),document.removeEventListener("mozpointerlockchange",v._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",v._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}O.ALPHA_DISABLE=0,O.ALPHA_ADD=1,O.ALPHA_COMBINE=2,O.ALPHA_SUBTRACT=3,O.ALPHA_MULTIPLY=4,O.ALPHA_MAXIMIZED=5,O.ALPHA_ONEONE=6,O.ALPHA_PREMULTIPLIED=7,O.ALPHA_PREMULTIPLIED_PORTERDUFF=8,O.ALPHA_INTERPOLATE=9,O.ALPHA_SCREENMODE=10,O.DELAYLOADSTATE_NONE=0,O.DELAYLOADSTATE_LOADED=1,O.DELAYLOADSTATE_LOADING=2,O.DELAYLOADSTATE_NOTLOADED=4,O.NEVER=512,O.ALWAYS=519,O.LESS=513,O.EQUAL=514,O.LEQUAL=515,O.GREATER=516,O.GEQUAL=518,O.NOTEQUAL=517,O.KEEP=7680,O.REPLACE=7681,O.INCR=7682,O.DECR=7683,O.INVERT=5386,O.INCR_WRAP=34055,O.DECR_WRAP=34056,O.TEXTURE_CLAMP_ADDRESSMODE=0,O.TEXTURE_WRAP_ADDRESSMODE=1,O.TEXTURE_MIRROR_ADDRESSMODE=2,O.TEXTUREFORMAT_ALPHA=0,O.TEXTUREFORMAT_LUMINANCE=1,O.TEXTUREFORMAT_LUMINANCE_ALPHA=2,O.TEXTUREFORMAT_RGB=4,O.TEXTUREFORMAT_RGBA=5,O.TEXTUREFORMAT_RED=6,O.TEXTUREFORMAT_R=6,O.TEXTUREFORMAT_RG=7,O.TEXTUREFORMAT_RED_INTEGER=8,O.TEXTUREFORMAT_R_INTEGER=8,O.TEXTUREFORMAT_RG_INTEGER=9,O.TEXTUREFORMAT_RGB_INTEGER=10,O.TEXTUREFORMAT_RGBA_INTEGER=11,O.TEXTURETYPE_UNSIGNED_BYTE=0,O.TEXTURETYPE_UNSIGNED_INT=0,O.TEXTURETYPE_FLOAT=1,O.TEXTURETYPE_HALF_FLOAT=2,O.TEXTURETYPE_BYTE=3,O.TEXTURETYPE_SHORT=4,O.TEXTURETYPE_UNSIGNED_SHORT=5,O.TEXTURETYPE_INT=6,O.TEXTURETYPE_UNSIGNED_INTEGER=7,O.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,O.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,O.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,O.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,O.TEXTURETYPE_UNSIGNED_INT_24_8=12,O.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,O.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,O.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,O.TEXTURE_NEAREST_SAMPLINGMODE=1,O.TEXTURE_BILINEAR_SAMPLINGMODE=2,O.TEXTURE_TRILINEAR_SAMPLINGMODE=3,O.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,O.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,O.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,O.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,O.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,O.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,O.TEXTURE_NEAREST_LINEAR=7,O.TEXTURE_NEAREST_NEAREST=1,O.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,O.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,O.TEXTURE_LINEAR_LINEAR=2,O.TEXTURE_LINEAR_NEAREST=12,O.TEXTURE_EXPLICIT_MODE=0,O.TEXTURE_SPHERICAL_MODE=1,O.TEXTURE_PLANAR_MODE=2,O.TEXTURE_CUBIC_MODE=3,O.TEXTURE_PROJECTION_MODE=4,O.TEXTURE_SKYBOX_MODE=5,O.TEXTURE_INVCUBIC_MODE=6,O.TEXTURE_EQUIRECTANGULAR_MODE=7,O.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,O.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,O.SCALEMODE_FLOOR=1,O.SCALEMODE_NEAREST=2,O.SCALEMODE_CEILING=3},10820:(v,y,n)=>{"use strict";n.d(y,{b:()=>J});var B=n(10795);class J{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}J.Instances=[],J.OnEnginesDisposedObservable=new B.e,J._LastCreatedScene=null,J.UseFallbackTexture=!0,J.FallbackTexture=""},12834:(v,y,n)=>{"use strict";n(10801);var B=n(11538);n(10885),n(11129),n(10882),n(11546),n(11507);B.b},10882:(v,y,n)=>{"use strict";n.d(y,{d:()=>B});class B{static SetMatrixPrecision(v){if(B.MatrixTrackPrecisionChange=!1,v&&!B.MatrixUse64Bits&&B.MatrixTrackedMatrices)for(let y=0;y<B.MatrixTrackedMatrices.length;++y){const v=B.MatrixTrackedMatrices[y],n=v.bk;v.bk=new Array(16);for(let y=0;y<16;++y)v.bk[y]=n[y]}B.MatrixUse64Bits=v,B.MatrixCurrentType=B.MatrixUse64Bits?Array:Float32Array,B.MatrixTrackedMatrices=null}}B.MatrixUse64Bits=!1,B.MatrixTrackPrecisionChange=!0,B.MatrixCurrentType=Float32Array,B.MatrixTrackedMatrices=[]},11546:(v,y,n)=>{"use strict";n.d(y,{e:()=>B});class B{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var v;return(null===(v=this._textures)||void 0===v?void 0:v[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(v){var y,n;if(!this._textures)return-1;const B=this._textures[v],J=(null===(y=this._layerIndices)||void 0===y?void 0:y[v])??0,P=(null===(n=this._faceIndices)||void 0===n?void 0:n[v])??0;return B.isCube?6*J+P:B.is3D?0:J}get samples(){return this._samples}setSamples(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===v&&!n)return v;const B=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,v,y):this._engine.updateRenderTargetTextureSampleCount(this,v);return this._samples=v,B}constructor(v,y,n,B,J){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=v,this._isCube=y,this._size=n,this._engine=B,this._depthStencilTexture=null,this.label=J}setTextures(v){Array.isArray(v)?this._textures=v:this._textures=v?[v]:null}setTexture(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[y]!==v&&(this._textures[y]&&n&&this._textures[y].dispose(),this._textures[y]=v)}setLayerAndFaceIndices(v,y){this._layerIndices=v,this._faceIndices=y}setLayerAndFaceIndex(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==y&&y>=0&&(this._layerIndices[v]=y),void 0!==n&&n>=0&&(this._faceIndices[v]=n)}createDepthStencilTexture(){var v;let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,b=arguments.length>5?arguments[5]:void 0;return null===(v=this._depthStencilTexture)||void 0===v||v.dispose(),this._depthStencilTextureWithStencil=B,this._depthStencilTextureLabel=b,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:n,comparisonFunction:y,generateStencil:B,isCube:this._isCube,samples:J,depthTextureFormat:P,label:b},this),this._depthStencilTexture}_shareDepth(v){this.shareDepth(v)}shareDepth(v){this._depthStencilTexture&&(v._depthStencilTexture&&v._depthStencilTexture.dispose(),v._depthStencilTexture=this._depthStencilTexture,v._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(v){this.texture&&this.texture._swapAndDie(v),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let v=null;if(this._isMulti){const y=this.textures;if(y&&y.length>0){let n=!1,B=y.length,J=-1;const P=y[y.length-1]._source;14!==P&&12!==P||(n=!0,J=y[y.length-1].format,B--);const b=[],Y=[],l=[],a=[],Z=[],x=[],f=[],N={};for(let v=0;v<B;++v){const n=y[v];b.push(n.samplingMode),Y.push(n.type),l.push(n.format);void 0!==N[n.uniqueId]?(a.push(-1),f.push(0)):(N[n.uniqueId]=v,n.is2DArray?(a.push(35866),f.push(n.depth)):n.isCube?(a.push(34067),f.push(0)):n.is3D?(a.push(32879),f.push(n.depth)):(a.push(3553),f.push(0))),this._faceIndices&&Z.push(this._faceIndices[v]??0),this._layerIndices&&x.push(this._layerIndices[v]??0)}const i={samplingModes:b,generateMipMaps:y[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:n,depthTextureFormat:J,types:Y,formats:l,textureCount:B,targetTypes:a,faceIndex:Z,layerIndex:x,layerCounts:f,label:this.label},g={width:this.width,height:this.height,depth:this.depth};v=this._engine.createMultipleRenderTarget(g,i);for(let c=0;c<B;++c){if(-1!==a[c])continue;const n=N[y[c].uniqueId];v.setTexture(v.textures[n],c)}}}else{var y,n,B,J;const b={};if(b.generateDepthBuffer=this._generateDepthBuffer,b.generateMipMaps=(null===(y=this.texture)||void 0===y?void 0:y.generateMipMaps)??!1,b.generateStencilBuffer=this._generateStencilBuffer,b.samplingMode=null===(n=this.texture)||void 0===n?void 0:n.samplingMode,b.type=null===(B=this.texture)||void 0===B?void 0:B.type,b.format=null===(J=this.texture)||void 0===J?void 0:J.format,b.noColorAttachment=!this._textures,b.label=this.label,this.isCube)v=this._engine.createRenderTargetCubeTexture(this.width,b);else{var P;const y={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(P=this.texture)||void 0===P?void 0:P.depth:void 0};v=this._engine.createRenderTargetTexture(y,b)}v.texture&&(v.texture.isReady=!0)}return v}_swapRenderTargetWrapper(v){if(this._textures&&v._textures)for(let y=0;y<this._textures.length;++y)this._textures[y]._swapAndDie(v._textures[y],!1),v._textures[y].isReady=!0;this._depthStencilTexture&&v._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(v._depthStencilTexture),v._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const v=this._cloneRenderTargetWrapper();if(v){if(this._depthStencilTexture){const y=this._depthStencilTexture.samplingMode,n=this._depthStencilTexture.format,B=2===y||3===y||11===y;v.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,B,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,n,this._depthStencilTextureLabel)}this.samples>1&&v.setSamples(this.samples),v._swapRenderTargetWrapper(this),v.dispose()}}releaseTextures(){if(this._textures)for(let y=0;y<(null===(v=this._textures)||void 0===v?void 0:v.length);++y){var v;this._textures[y].dispose()}this._textures=null}dispose(){var v;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(v=this._depthStencilTexture)||void 0===v||v.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},10866:(v,y,n)=>{"use strict";n.d(y,{b:()=>B});class B{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.ShadersRepository:B.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.ShadersStore:B.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?B.IncludesShadersStore:B.IncludesShadersStoreWGSL}}B.ShadersRepository="src/Shaders/",B.ShadersStore={},B.IncludesShadersStore={},B.ShadersRepositoryWGSL="src/ShadersWGSL/",B.ShadersStoreWGSL={},B.IncludesShadersStoreWGSL={}},10880:(v,y,n)=>{"use strict";n.d(y,{e:()=>f,i:()=>E,k:()=>N,m:()=>i,o:()=>h,q:()=>x,u:()=>a,w:()=>Z,A:()=>l,C:()=>Y});class B{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Od._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(v){v&&this.program&&v(this.program)}setEngine(v){this.Od=v}_fillEffectInformation(v,y,n,B,J,P,b,Y){const l=this.Od;if(l.supportsUniformBuffers)for(const Z in y)v.bindUniformBlock(Z,y[Z]);let a;for(this.Od.getUniforms(this,n).forEach(((v,y)=>{B[n[y]]=v})),this._uniforms=B,a=0;a<J.length;a++){null==v.getUniform(J[a])&&(J.splice(a,1),a--)}J.forEach(((v,y)=>{P[v]=y}));for(const Z of l.getAttributes(this,b))Y.push(Z)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(v,y){const n=this._valueCache[v],B=y.updateFlag;return(void 0===n||n!==B)&&(this._valueCache[v]=B,!0)}_cacheFloat2(v,y,n){let B=this._valueCache[v];if(!B||2!==B.length)return B=[y,n],this._valueCache[v]=B,!0;let J=!1;return B[0]!==y&&(B[0]=y,J=!0),B[1]!==n&&(B[1]=n,J=!0),J}_cacheFloat3(v,y,n,B){let J=this._valueCache[v];if(!J||3!==J.length)return J=[y,n,B],this._valueCache[v]=J,!0;let P=!1;return J[0]!==y&&(J[0]=y,P=!0),J[1]!==n&&(J[1]=n,P=!0),J[2]!==B&&(J[2]=B,P=!0),P}_cacheFloat4(v,y,n,B,J){let P=this._valueCache[v];if(!P||4!==P.length)return P=[y,n,B,J],this._valueCache[v]=P,!0;let b=!1;return P[0]!==y&&(P[0]=y,b=!0),P[1]!==n&&(P[1]=n,b=!0),P[2]!==B&&(P[2]=B,b=!0),P[3]!==J&&(P[3]=J,b=!0),b}setInt(v,y){const n=this._valueCache[v];void 0!==n&&n===y||this.Od.setInt(this._uniforms[v],y)&&(this._valueCache[v]=y)}setInt2(v,y,n){this._cacheFloat2(v,y,n)&&(this.Od.setInt2(this._uniforms[v],y,n)||(this._valueCache[v]=null))}setInt3(v,y,n,B){this._cacheFloat3(v,y,n,B)&&(this.Od.setInt3(this._uniforms[v],y,n,B)||(this._valueCache[v]=null))}setInt4(v,y,n,B,J){this._cacheFloat4(v,y,n,B,J)&&(this.Od.setInt4(this._uniforms[v],y,n,B,J)||(this._valueCache[v]=null))}setIntArray(v,y){this._valueCache[v]=null,this.Od.setIntArray(this._uniforms[v],y)}setIntArray2(v,y){this._valueCache[v]=null,this.Od.setIntArray2(this._uniforms[v],y)}setIntArray3(v,y){this._valueCache[v]=null,this.Od.setIntArray3(this._uniforms[v],y)}setIntArray4(v,y){this._valueCache[v]=null,this.Od.setIntArray4(this._uniforms[v],y)}setUInt(v,y){const n=this._valueCache[v];void 0!==n&&n===y||this.Od.setUInt(this._uniforms[v],y)&&(this._valueCache[v]=y)}setUInt2(v,y,n){this._cacheFloat2(v,y,n)&&(this.Od.setUInt2(this._uniforms[v],y,n)||(this._valueCache[v]=null))}setUInt3(v,y,n,B){this._cacheFloat3(v,y,n,B)&&(this.Od.setUInt3(this._uniforms[v],y,n,B)||(this._valueCache[v]=null))}setUInt4(v,y,n,B,J){this._cacheFloat4(v,y,n,B,J)&&(this.Od.setUInt4(this._uniforms[v],y,n,B,J)||(this._valueCache[v]=null))}setUIntArray(v,y){this._valueCache[v]=null,this.Od.setUIntArray(this._uniforms[v],y)}setUIntArray2(v,y){this._valueCache[v]=null,this.Od.setUIntArray2(this._uniforms[v],y)}setUIntArray3(v,y){this._valueCache[v]=null,this.Od.setUIntArray3(this._uniforms[v],y)}setUIntArray4(v,y){this._valueCache[v]=null,this.Od.setUIntArray4(this._uniforms[v],y)}setArray(v,y){this._valueCache[v]=null,this.Od.setArray(this._uniforms[v],y)}setArray2(v,y){this._valueCache[v]=null,this.Od.setArray2(this._uniforms[v],y)}setArray3(v,y){this._valueCache[v]=null,this.Od.setArray3(this._uniforms[v],y)}setArray4(v,y){this._valueCache[v]=null,this.Od.setArray4(this._uniforms[v],y)}setMatrices(v,y){y&&(this._valueCache[v]=null,this.Od.setMatrices(this._uniforms[v],y))}setMatrix(v,y){this._cacheMatrix(v,y)&&(this.Od.setMatrices(this._uniforms[v],y.wj())||(this._valueCache[v]=null))}setMatrix3x3(v,y){this._valueCache[v]=null,this.Od.setMatrix3x3(this._uniforms[v],y)}setMatrix2x2(v,y){this._valueCache[v]=null,this.Od.setMatrix2x2(this._uniforms[v],y)}setFloat(v,y){const n=this._valueCache[v];void 0!==n&&n===y||this.Od.setFloat(this._uniforms[v],y)&&(this._valueCache[v]=y)}setVector2(v,y){this._cacheFloat2(v,y.x,y.y)&&(this.Od.setFloat2(this._uniforms[v],y.x,y.y)||(this._valueCache[v]=null))}setFloat2(v,y,n){this._cacheFloat2(v,y,n)&&(this.Od.setFloat2(this._uniforms[v],y,n)||(this._valueCache[v]=null))}setVector3(v,y){this._cacheFloat3(v,y.x,y.y,y.z)&&(this.Od.setFloat3(this._uniforms[v],y.x,y.y,y.z)||(this._valueCache[v]=null))}setFloat3(v,y,n,B){this._cacheFloat3(v,y,n,B)&&(this.Od.setFloat3(this._uniforms[v],y,n,B)||(this._valueCache[v]=null))}setVector4(v,y){this._cacheFloat4(v,y.x,y.y,y.z,y.w)&&(this.Od.setFloat4(this._uniforms[v],y.x,y.y,y.z,y.w)||(this._valueCache[v]=null))}setQuaternion(v,y){this._cacheFloat4(v,y.x,y.y,y.z,y.w)&&(this.Od.setFloat4(this._uniforms[v],y.x,y.y,y.z,y.w)||(this._valueCache[v]=null))}setFloat4(v,y,n,B,J){this._cacheFloat4(v,y,n,B,J)&&(this.Od.setFloat4(this._uniforms[v],y,n,B,J)||(this._valueCache[v]=null))}setColor3(v,y){this._cacheFloat3(v,y.r,y.g,y.b)&&(this.Od.setFloat3(this._uniforms[v],y.r,y.g,y.b)||(this._valueCache[v]=null))}setColor4(v,y,n){this._cacheFloat4(v,y.r,y.g,y.b,n)&&(this.Od.setFloat4(this._uniforms[v],y.r,y.g,y.b,n)||(this._valueCache[v]=null))}setDirectColor4(v,y){this._cacheFloat4(v,y.r,y.g,y.b,y.a)&&(this.Od.setFloat4(this._uniforms[v],y.r,y.g,y.b,y.a)||(this._valueCache[v]=null))}_getVertexShaderCode(){return this.vertexShader?this.Od._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Od._getShaderSource(this.fragmentShader):null}}var J=n(10845);const P=new WeakMap,b={_webGLVersion:2,cachedPipelines:{}};function Y(v){let y=P.get(v);if(!y){if(!v)return b;y={_webGLVersion:v.TEXTURE_BINDING_3D?2:1,_context:v,cachedPipelines:{}},P.set(v,y)}return y}function l(v){P.delete(v)}function a(v,y,n,B,J,P){const b=Y(B);P||(P=b._createShaderProgramInjection??f);return P(v,c(y,"vertex",B,b._contextWasLost),c(n,"fragment",B,b._contextWasLost),B,J,b.validateShaderPrograms)}function Z(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6?arguments[6]:void 0;const l=Y(J);b||(b=l._createShaderProgramInjection??f);const a=l._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return b(v,g(y,"vertex",B,a,J,l._contextWasLost),g(n,"fragment",B,a,J,l._contextWasLost),J,P,l.validateShaderPrograms)}function x(v,y){const n=new B,J=Y(v);return J.parallelShaderCompile&&(n.isParallelCompiled=!0),n.context=J._context,n}function f(v,y,n,B){let J=arguments.length>5?arguments[5]:void 0;const P=B.createProgram();if(v.program=P,!P)throw new Error("Unable to create program");return B.attachShader(P,y),B.attachShader(P,n),B.linkProgram(P),v.context=B,v.vertexShader=y,v.fragmentShader=n,v.isParallelCompiled||N(v,B,J),P}function N(v,y,n){const B=v.context,J=v.vertexShader,P=v.fragmentShader,b=v.program;if(!B.getProgramParameter(b,B.LINK_STATUS)){if(!y.getShaderParameter(J,y.COMPILE_STATUS)){const n=y.getShaderInfoLog(J);if(n)throw v.vertexCompilationError=n,new Error("VERTEX SHADER "+n)}if(!y.getShaderParameter(P,y.COMPILE_STATUS)){const n=y.getShaderInfoLog(P);if(n)throw v.fragmentCompilationError=n,new Error("FRAGMENT SHADER "+n)}const n=B.getProgramInfoLog(b);if(n)throw v.programLinkError=n,new Error(n)}if(n){B.validateProgram(b);if(!B.getProgramParameter(b,B.VALIDATE_STATUS)){const y=B.getProgramInfoLog(b);if(y)throw v.programValidationError=y,new Error(y)}}B.deleteShader(J),B.deleteShader(P),v.vertexShader=void 0,v.fragmentShader=void 0,v.onCompiled&&(v.onCompiled(),v.onCompiled=void 0)}function i(v,y,n,B,J,P,b,l,x){let f=arguments.length>10?arguments[10]:void 0,N=arguments.length>11?arguments[11]:void 0,i=arguments.length>12?arguments[12]:void 0;const g=Y(v.context);N||(N=g.createRawShaderProgramInjection??a),i||(i=g.createShaderProgramInjection??Z);const c=v;c.program=B?N(c,y,n,c.context,x):i(c,y,n,l,c.context,x),c.program.__SPECTOR_rebuildProgram=b,f()}function g(v,y,n,B,P,b){return c((0,J.g)(v,n,B),y,P,b)}function c(v,y,n,B){const J=n.createShader("vertex"===y?n.VERTEX_SHADER:n.FRAGMENT_SHADER);if(!J){let v=n.NO_ERROR,J=n.NO_ERROR;for(;(J=n.getError())!==n.NO_ERROR;)v=J;throw new Error(`Something went wrong while creating a gl ${y} shader object. gl error=${v}, gl isContextLost=${n.isContextLost()}, _contextWasLost=${B}`)}return n.shaderSource(J,v),n.compileShader(J),J}function h(v,y){y.useProgram(v)}function E(v,y){const n=v;if(!n.isParallelCompiled)return void y(v);const B=n.onCompiled;n.onCompiled=()=>{null===B||void 0===B||B(),y(v)}}},11503:(v,y,n)=>{"use strict";n.r(y),n.d(y,{ThinEngine:()=>W});var B=n(10880),J=n(11507),P=n(10801),b=n(10797);class Y{constructor(){this.shaderLanguage=0}postProcessor(v,y,n,B,J){if(J.drawBuffersExtensionDisabled){const y=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;v=v.replace(y,"")}return v}}const l=/(flat\s)?\s*varying\s*.*/;class a{constructor(){this.shaderLanguage=0}attributeProcessor(v){return v.replace("attribute","in")}varyingCheck(v,y){return l.test(v)}varyingProcessor(v,y){return v.replace("varying",y?"in":"out")}postProcessor(v,y,n){const B=-1!==v.search(/#extension.+GL_EXT_draw_buffers.+require/);if(v=(v=v.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),n){const y=-1!==v.search(/layout *\(location *= *0\) *out/g);v=(v=(v=(v=(v=(v=(v=v.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(B||y?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==y.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+v}return v}}var Z=n(11510),x=n(10914),f=n(10849),N=n(11517),i=n(10885),g=n(10857),c=n(10845),h=n(10871);class E{}class W extends f.c{get name(){return this._name}set name(v){this._name=v}get version(){return this._webGLVersion}static get ShadersRepository(){return g.b.ShadersRepository}static set ShadersRepository(v){g.b.ShadersRepository=v}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(v){this._framebufferDimensionsObject=v}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(v,y,n,J){if(n=n||{},super(y??n.antialias,n,J),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!v)return;let b=null;if(v.getContext){if(b=v,this._renderingCanvas=b,void 0===n.Oh&&(n.Oh=!1),void 0===n.xrCompatible&&(n.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const v=navigator.userAgent;for(const y of W.ExceptionList){const B=y.key,J=y.targets;if(new RegExp(B).test(v)){if(y.capture&&y.captureConstraint){const n=y.capture,B=y.captureConstraint,J=new RegExp(n).exec(v);if(J&&J.length>0){if(parseInt(J[J.length-1])>=B)continue}}for(const v of J)switch(v){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":n.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=v=>{v.preventDefault(),this._contextWasLost=!0,P.e.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},b.addEventListener("webglcontextlost",this._onContextLost,!1),b.addEventListener("webglcontextrestored",this._onContextRestored,!1),n.powerPreference=n.powerPreference||"high-performance"),this._badDesktopOS&&(n.xrCompatible=!1),!n.disableWebGL2Support)try{this._gl=b.getContext("webgl2",n)||b.getContext("experimental-webgl2",n),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(x){}if(!this._gl){if(!b)throw new Error("The provided canvas is null or undefined.");try{this._gl=b.getContext("webgl",n)||b.getContext("experimental-webgl",n)}catch(x){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=v,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const y=this._gl.getContextAttributes();y&&(n.stencil=y.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==n.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=n.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let B=0;B<this._caps.maxVertexAttribs;B++)this._currentBufferPointers[B]=new E;this._shaderProcessor=this.webGLVersion>1?new a:new Y;const l=`Babylon.js v${W.Version}`;P.e.Log(l+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",l);const Z=(0,B.C)(this._gl);Z.validateShaderPrograms=this.validateShaderPrograms,Z.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(v){return null}areAllEffectsReady(){for(const v in this._compiledEffects){if(!this._compiledEffects[v].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const v=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=v&&(this._glRenderer=this._gl.getParameter(v.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(v.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const v=this._gl.getExtension("WEBGL_draw_buffers");if(null!==v){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=v.drawBuffersWEBGL.bind(v),this._caps.maxDrawBuffers=this._gl.getParameter(v.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let y=0;y<16;y++)this._gl["COLOR_ATTACHMENT"+y+"_WEBGL"]=v["COLOR_ATTACHMENT"+y+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const v=this._gl.getExtension("WEBGL_depth_texture");null!=v&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=v.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const v=this._gl.getExtension("OES_vertex_array_object");null!=v&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=v.createVertexArrayOES.bind(v),this._gl.bindVertexArray=v.bindVertexArrayOES.bind(v),this._gl.deleteVertexArray=v.deleteVertexArrayOES.bind(v))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const v=this._gl.getExtension("ANGLE_instanced_arrays");null!=v?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=v.drawArraysInstancedANGLE.bind(v),this._gl.drawElementsInstanced=v.drawElementsInstancedANGLE.bind(v),this._gl.vertexAttribDivisor=v.vertexAttribDivisorANGLE.bind(v)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const v=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),y=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);v&&y&&(this._caps.highPrecisionShaderSupported=0!==v.precision&&0!==y.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const v=this._gl.getExtension("EXT_blend_minmax");null!=v&&(this._caps.blendMinMax=!0,this._gl.MAX=v.MAX_EXT,this._gl.MIN=v.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const v=this._gl.getExtension("EXT_sRGB");null!=v&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:v.SRGB_EXT,SRGB8:v.SRGB_ALPHA_EXT,SRGB8_ALPHA8:v.SRGB_ALPHA_EXT})}if(this._creationOptions){const v=this._creationOptions.forceSRGBBufferSupportState;void 0!==v&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&v)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let y=0;y<this._maxSimultaneousTextures;y++)this._nextFreeTextureSlots.push(y);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const v=this._workingCanvas.getContext("2d");v&&(this._workingContext=v)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const v=this.getGlInfo();return v&&v.renderer?v.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const J=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=J;let P=0;if(y&&v){let y=!0;if(this._currentRenderTarget){var b;const n=null===(b=this._currentRenderTarget.texture)||void 0===b?void 0:b.format;if(8===n||9===n||10===n||11===n){var Y;const n=null===(Y=this._currentRenderTarget.texture)||void 0===Y?void 0:Y.type;7===n||5===n?(W._TempClearColorUint32[0]=255*v.r,W._TempClearColorUint32[1]=255*v.g,W._TempClearColorUint32[2]=255*v.b,W._TempClearColorUint32[3]=255*v.a,this._gl.clearBufferuiv(this._gl.COLOR,0,W._TempClearColorUint32),y=!1):(W._TempClearColorInt32[0]=255*v.r,W._TempClearColorInt32[1]=255*v.g,W._TempClearColorInt32[2]=255*v.b,W._TempClearColorInt32[3]=255*v.a,this._gl.clearBufferiv(this._gl.COLOR,0,W._TempClearColorInt32),y=!1)}}y&&(this._gl.clearColor(v.r,v.g,v.b,void 0!==v.a?v.a:1),P|=this._gl.COLOR_BUFFER_BIT)}n&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),P|=this._gl.DEPTH_BUFFER_BIT),B&&(this._gl.clearStencil(0),P|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(P)}_viewport(v,y,n,B){v===this._viewportCached.x&&y===this._viewportCached.y&&n===this._viewportCached.z&&B===this._viewportCached.w||(this._viewportCached.x=v,this._viewportCached.y=y,this._viewportCached.z=n,this._viewportCached.w=B,this._gl.viewport(v,y,n,B))}tj(){super.tj(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0,J=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const l=v;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=v,this._bindUnboundFramebuffer(l._framebuffer);const a=this._gl;var Z;if(!v.isMulti)if(v.is2DArray||v.is3D)a.framebufferTextureLayer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,null===(Z=v.texture._hardwareTexture)||void 0===Z?void 0:Z.underlyingResource,b,Y),l._currentLOD=b;else if(v.isCube){var x;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+y,null===(x=v.texture._hardwareTexture)||void 0===x?void 0:x.underlyingResource,b)}else if(l._currentLOD!==b){var f;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null===(f=v.texture._hardwareTexture)||void 0===f?void 0:f.underlyingResource,b),l._currentLOD=b}const N=v._depthStencilTexture;if(N){v.is3D&&(v.texture.width===N.width&&v.texture.height===N.height&&v.texture.depth===N.depth||P.e.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const n=v._depthStencilTextureWithStencil?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;var i;if(v.is2DArray||v.is3D)a.framebufferTextureLayer(a.FRAMEBUFFER,n,null===(i=N._hardwareTexture)||void 0===i?void 0:i.underlyingResource,b,Y);else if(v.isCube){var g;a.framebufferTexture2D(a.FRAMEBUFFER,n,a.TEXTURE_CUBE_MAP_POSITIVE_X+y,null===(g=N._hardwareTexture)||void 0===g?void 0:g.underlyingResource,b)}else{var c;a.framebufferTexture2D(a.FRAMEBUFFER,n,a.TEXTURE_2D,null===(c=N._hardwareTexture)||void 0===c?void 0:c.underlyingResource,b)}}l._MSAAFramebuffer&&this._bindUnboundFramebuffer(l._MSAAFramebuffer),this._cachedViewport&&!J?this.setViewport(this._cachedViewport,n,B):(n||(n=v.width,b&&(n/=Math.pow(2,b))),B||(B=v.height,b&&(B/=Math.pow(2,b))),this._viewport(0,0,n,B)),this.wipeCaches()}setState(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==v||n)&&(this._depthCullingState.cull=v);const Y=this.cullBackFaces??J??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==Y||n)&&(this._depthCullingState.cullFace=Y),this.setZOffset(y),this.setZOffsetUnits(b);const l=B?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==l||n)&&(this._depthCullingState.frontFace=l),this._stencilStateComposer.stencilMaterial=P}_bindUnboundFramebuffer(v){this._currentFramebuffer!==v&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,v),this._currentFramebuffer=v)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(v){const y=this._getTextureTarget(v);this._bindTextureDirectly(y,v,!0),this._gl.generateMipmap(y),this._bindTextureDirectly(y,null)}unBindFramebuffer(v){var y;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],B=arguments.length>2?arguments[2]:void 0;const J=v;this._currentRenderTarget=null;const P=this._gl;if(J._MSAAFramebuffer){if(v.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(v,n,B);P.bindFramebuffer(P.READ_FRAMEBUFFER,J._MSAAFramebuffer),P.bindFramebuffer(P.DRAW_FRAMEBUFFER,J._framebuffer),P.blitFramebuffer(0,0,v.width,v.height,0,0,v.width,v.height,P.COLOR_BUFFER_BIT,P.NEAREST)}null===(y=v.texture)||void 0===y||!y.generateMipMaps||n||v.isCube||this.generateMipmaps(v.texture),B&&(J._MSAAFramebuffer&&this._bindUnboundFramebuffer(J._framebuffer),B()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(v,y,n){return this._createVertexBuffer(v,this._gl.STATIC_DRAW)}_createVertexBuffer(v,y){const n=this._gl.createBuffer();if(!n)throw new Error("Unable to create vertex buffer");const B=new Z.c(n);return this.bindArrayBuffer(B),"number"!==typeof v?v instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(v),y),B.ob=4*v.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,v,y),B.ob=v.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(v),y),B.ob=v),this._resetVertexBufferBinding(),B.references=1,B}createDynamicVertexBuffer(v,y){return this._createVertexBuffer(v,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(v,y,n){const B=this._gl.createBuffer(),J=new Z.c(B);if(!B)throw new Error("Unable to create index buffer");this.bindIndexBuffer(J);const P=this._normalizeIndexData(v);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,P,y?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),J.references=1,J.is32Bits=4===P.BYTES_PER_ELEMENT,J}_normalizeIndexData(v){if(2===v.BYTES_PER_ELEMENT)return v;if(this._caps.uintIndices){if(v instanceof Uint32Array)return v;for(let y=0;y<v.length;y++)if(v[y]>=65535)return new Uint32Array(v);return new Uint16Array(v)}return new Uint16Array(v)}bindArrayBuffer(v){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(v,this._gl.ARRAY_BUFFER)}bindUniformBlock(v,y,n){const B=v.program,J=this._gl.getUniformBlockIndex(B,y);this._gl.uniformBlockBinding(B,J,n)}bindIndexBuffer(v){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(v,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(v,y){(this._vaoRecordInProgress||this._currentBoundBuffer[y]!==v)&&(this._gl.bindBuffer(y,v?v.underlyingResource:null),this._currentBoundBuffer[y]=v)}updateArrayBuffer(v){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,v)}_vertexAttribPointer(v,y,n,B,J,P,b){const Y=this._currentBufferPointers[y];if(!Y)return;let l=!1;Y.active?(Y.buffer!==v&&(Y.buffer=v,l=!0),Y.size!==n&&(Y.size=n,l=!0),Y.type!==B&&(Y.type=B,l=!0),Y.normalized!==J&&(Y.normalized=J,l=!0),Y.stride!==P&&(Y.stride=P,l=!0),Y.offset!==b&&(Y.offset=b,l=!0)):(l=!0,Y.active=!0,Y.index=y,Y.size=n,Y.type=B,Y.normalized=J,Y.stride=P,Y.offset=b,Y.buffer=v),(l||this._vaoRecordInProgress)&&(this.bindArrayBuffer(v),B===this._gl.UNSIGNED_INT||B===this._gl.INT?this._gl.vertexAttribIPointer(y,n,B,P,b):this._gl.vertexAttribPointer(y,n,B,J,P,b))}_bindIndexBufferWithCache(v){null!=v&&this._cachedIndexBuffer!==v&&(this._cachedIndexBuffer=v,this.bindIndexBuffer(v),this._uintIndicesCurrentlySet=v.is32Bits)}_bindVertexBuffersAttributes(v,y,n){const B=y.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let J=0;J<B.length;J++){const P=y.getAttributeLocation(J);if(P>=0){const y=B[J];let b=null;if(n&&(b=n[y]),b||(b=v[y]),!b)continue;this._gl.enableVertexAttribArray(P),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[P]=!0);const Y=b.getBuffer();Y&&(this._vertexAttribPointer(Y,P,b.getSize(),b.type,b.normalized,b.byteStride,b.byteOffset),b.getIsInstanced()&&(this._gl.vertexAttribDivisor(P,b.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(P),this._currentInstanceBuffers.push(Y))))}}}recordVertexArrayObject(v,y,n,B){const J=this._gl.createVertexArray();if(!J)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(J),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(v,n,B),this.bindIndexBuffer(y),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),J}bindVertexArrayObject(v,y){this._cachedVertexArrayObject!==v&&(this._cachedVertexArrayObject=v,this._gl.bindVertexArray(v),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=y&&y.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(v,y,n,B,J){if(this._cachedVertexBuffers!==v||this._cachedEffectForVertexBuffers!==J){this._cachedVertexBuffers=v,this._cachedEffectForVertexBuffers=J;const y=J.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let P=0;for(let b=0;b<y;b++)if(b<n.length){const y=J.getAttributeLocation(b);y>=0&&(this._gl.enableVertexAttribArray(y),this._vertexAttribArraysEnabled[y]=!0,this._vertexAttribPointer(v,y,n[b],this._gl.FLOAT,!1,B,P)),P+=4*n[b]}}this._bindIndexBufferWithCache(y)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(v,y,n,B){this._cachedVertexBuffers===v&&this._cachedEffectForVertexBuffers===n||(this._cachedVertexBuffers=v,this._cachedEffectForVertexBuffers=n,this._bindVertexBuffersAttributes(v,n,B)),this._bindIndexBufferWithCache(y)}unbindInstanceAttributes(){let v;for(let y=0,n=this._currentInstanceLocations.length;y<n;y++){const n=this._currentInstanceBuffers[y];v!=n&&n.references&&(v=n,this.bindArrayBuffer(n));const B=this._currentInstanceLocations[y];this._gl.vertexAttribDivisor(B,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(v){this._gl.deleteVertexArray(v)}_releaseBuffer(v){return v.references--,0===v.references&&(this._deleteBuffer(v),!0)}_deleteBuffer(v){this._gl.deleteBuffer(v.underlyingResource)}updateAndBindInstancesBuffer(v,y,n){if(this.bindArrayBuffer(v),y&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,y),void 0!==n[0].index)this.bindInstancesBuffer(v,n,!0);else for(let B=0;B<4;B++){const y=n[B];this._vertexAttribArraysEnabled[y]||(this._gl.enableVertexAttribArray(y),this._vertexAttribArraysEnabled[y]=!0),this._vertexAttribPointer(v,y,4,this._gl.FLOAT,!1,64,16*B),this._gl.vertexAttribDivisor(y,1),this._currentInstanceLocations.push(y),this._currentInstanceBuffers.push(v)}}bindInstancesBuffer(v,y){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(v);let B=0;if(n)for(let J=0;J<y.length;J++){B+=4*y[J].attributeSize}for(let J=0;J<y.length;J++){const n=y[J];void 0===n.index&&(n.index=this._currentEffect.getAttributeLocationByName(n.attributeName)),n.index<0||(this._vertexAttribArraysEnabled[n.index]||(this._gl.enableVertexAttribArray(n.index),this._vertexAttribArraysEnabled[n.index]=!0),this._vertexAttribPointer(v,n.index,n.attributeSize,n.attributeType||this._gl.FLOAT,n.normalized||!1,B,n.offset),this._gl.vertexAttribDivisor(n.index,void 0===n.divisor?1:n.divisor),this._currentInstanceLocations.push(n.index),this._currentInstanceBuffers.push(v))}}disableInstanceAttributeByName(v){if(!this._currentEffect)return;const y=this._currentEffect.getAttributeLocationByName(v);this.disableInstanceAttribute(y)}disableInstanceAttribute(v){let y,n=!1;for(;-1!==(y=this._currentInstanceLocations.indexOf(v));)this._currentInstanceLocations.splice(y,1),this._currentInstanceBuffers.splice(y,1),n=!0,y=this._currentInstanceLocations.indexOf(v);n&&(this._gl.vertexAttribDivisor(v,0),this.disableAttributeByIndex(v))}disableAttributeByIndex(v){this._gl.disableVertexAttribArray(v),this._vertexAttribArraysEnabled[v]=!1,this._currentBufferPointers[v].active=!1}draw(v,y,n,B){this.drawElementsType(v?0:1,y,n,B)}drawPointClouds(v,y,n){this.drawArraysType(2,v,y,n)}drawUnIndexed(v,y,n,B){this.drawArraysType(v?0:1,y,n,B)}drawElementsType(v,y,n,B){this.applyStates(),this._reportDrawCall();const J=this._drawMode(v),P=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,b=this._uintIndicesCurrentlySet?4:2;B?this._gl.drawElementsInstanced(J,n,P,y*b,B):this._gl.drawElements(J,n,P,y*b)}drawArraysType(v,y,n,B){this.applyStates(),this._reportDrawCall();const J=this._drawMode(v);B?this._gl.drawArraysInstanced(J,y,n,B):this._gl.drawArrays(J,y,n)}_drawMode(v){switch(v){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(v){this._compiledEffects[v._key]&&delete this._compiledEffects[v._key];const y=v.getPipelineContext();y&&this._deletePipelineContext(y)}_deletePipelineContext(v){const y=v;y&&y.program&&(y.program.__SPECTOR_rebuildProgram=null,(0,h.i)(y),this._gl.deleteProgram(y.program))}_getGlobalDefines(v){return(0,c.i)(v,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(v,y,n,J,P,b,Y,l,a){let Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,x=arguments.length>10?arguments[10]:void 0;const f="string"===typeof v?v:v.vertexToken||v.vertexSource||v.vertexElement||v.vertex,N="string"===typeof v?v:v.fragmentToken||v.fragmentSource||v.fragmentElement||v.fragment,i=this._getGlobalDefines();let c=P??y.defines??"";i&&(c+=i);const h=f+"+"+N+"@"+c;if(this._compiledEffects[h]){const v=this._compiledEffects[h];return Y&&v.isReady()&&Y(v),v._refCount++,v}this._gl&&(0,B.C)(this._gl);const E=new g.b(v,y,n,J,this,P,b,Y,l,a,h,y.shaderLanguage??Z,y.extraInitializationsAsync??x);return this._compiledEffects[h]=E,E}_getShaderSource(v){return this._gl.getShaderSource(v)}createRawShaderProgram(v,y,n,J){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const b=(0,B.C)(this._gl);return b._contextWasLost=this._contextWasLost,b.validateShaderPrograms=this.validateShaderPrograms,(0,B.u)(v,y,n,J||this._gl,P)}createShaderProgram(v,y,n,J,P){let b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const Y=(0,B.C)(this._gl);return Y._contextWasLost=this._contextWasLost,Y.validateShaderPrograms=this.validateShaderPrograms,(0,B.w)(v,y,n,J,P||this._gl,b)}inlineShaderCode(v){return v}createPipelineContext(v){if(this._gl){(0,B.C)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const y=(0,B.q)(this._gl,v);return y.Od=this,y}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(v){return(0,B.k)(v,this._gl,this.validateShaderPrograms)}_preparePipelineContext(v,y,n,J,P,b,Y,l,a,Z,x){const f=(0,B.C)(this._gl);return f._contextWasLost=this._contextWasLost,f.validateShaderPrograms=this.validateShaderPrograms,f._createShaderProgramInjection=this._createShaderProgram.bind(this),f.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),f.createShaderProgramInjection=this.createShaderProgram.bind(this),f.loadFileInjection=this._loadFile.bind(this),(0,B.m)(v,y,n,J,P,b,Y,l,a,Z,x)}_createShaderProgram(v,y,n,J){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,B.e)(v,y,n,J,P)}_isRenderingStateCompiled(v){const y=v;return!this._isDisposed&&!y._isDisposed&&(!!this._gl.getProgramParameter(y.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(y),!0))}_executeWhenRenderingStateIsCompiled(v,y){(0,B.i)(v,y)}getUniforms(v,y){const n=new Array,B=v;for(let J=0;J<y.length;J++)n.push(this._gl.getUniformLocation(B.program,y[J]));return n}getAttributes(v,y){const n=[],B=v;for(let P=0;P<y.length;P++)try{n.push(this._gl.getAttribLocation(B.program,y[P]))}catch(J){n.push(-1)}return n}enableEffect(v){(v=null!==v&&(0,J.b)(v)?v.effect:v)&&v!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(v),this._currentEffect=v,v.onBind&&v.onBind(v),v._onBindObservable&&v._onBindObservable.notifyObservers(v))}setInt(v,y){return!!v&&(this._gl.uniform1i(v,y),!0)}setInt2(v,y,n){return!!v&&(this._gl.uniform2i(v,y,n),!0)}setInt3(v,y,n,B){return!!v&&(this._gl.uniform3i(v,y,n,B),!0)}setInt4(v,y,n,B,J){return!!v&&(this._gl.uniform4i(v,y,n,B,J),!0)}setIntArray(v,y){return!!v&&(this._gl.uniform1iv(v,y),!0)}setIntArray2(v,y){return!(!v||y.length%2!==0)&&(this._gl.uniform2iv(v,y),!0)}setIntArray3(v,y){return!(!v||y.length%3!==0)&&(this._gl.uniform3iv(v,y),!0)}setIntArray4(v,y){return!(!v||y.length%4!==0)&&(this._gl.uniform4iv(v,y),!0)}setUInt(v,y){return!!v&&(this._gl.uniform1ui(v,y),!0)}setUInt2(v,y,n){return!!v&&(this._gl.uniform2ui(v,y,n),!0)}setUInt3(v,y,n,B){return!!v&&(this._gl.uniform3ui(v,y,n,B),!0)}setUInt4(v,y,n,B,J){return!!v&&(this._gl.uniform4ui(v,y,n,B,J),!0)}setUIntArray(v,y){return!!v&&(this._gl.uniform1uiv(v,y),!0)}setUIntArray2(v,y){return!(!v||y.length%2!==0)&&(this._gl.uniform2uiv(v,y),!0)}setUIntArray3(v,y){return!(!v||y.length%3!==0)&&(this._gl.uniform3uiv(v,y),!0)}setUIntArray4(v,y){return!(!v||y.length%4!==0)&&(this._gl.uniform4uiv(v,y),!0)}setArray(v,y){return!!v&&(!(y.length<1)&&(this._gl.uniform1fv(v,y),!0))}setArray2(v,y){return!(!v||y.length%2!==0)&&(this._gl.uniform2fv(v,y),!0)}setArray3(v,y){return!(!v||y.length%3!==0)&&(this._gl.uniform3fv(v,y),!0)}setArray4(v,y){return!(!v||y.length%4!==0)&&(this._gl.uniform4fv(v,y),!0)}setMatrices(v,y){return!!v&&(this._gl.uniformMatrix4fv(v,!1,y),!0)}setMatrix3x3(v,y){return!!v&&(this._gl.uniformMatrix3fv(v,!1,y),!0)}setMatrix2x2(v,y){return!!v&&(this._gl.uniformMatrix2fv(v,!1,y),!0)}setFloat(v,y){return!!v&&(this._gl.uniform1f(v,y),!0)}setFloat2(v,y,n){return!!v&&(this._gl.uniform2f(v,y,n),!0)}setFloat3(v,y,n,B){return!!v&&(this._gl.uniform3f(v,y,n,B),!0)}setFloat4(v,y,n,B,J){return!!v&&(this._gl.uniform4f(v,y,n,B,J),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const v=this._colorWrite;this._gl.colorMask(v,v,v,v)}}wipeCaches(v){this.preventCacheWipeBetweenFrames&&!v||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),v&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(v,y){const n=this._gl;let B=n.NEAREST,J=n.NEAREST;switch(v){case 11:B=n.LINEAR,J=y?n.LINEAR_MIPMAP_NEAREST:n.LINEAR;break;case 3:B=n.LINEAR,J=y?n.LINEAR_MIPMAP_LINEAR:n.LINEAR;break;case 8:B=n.NEAREST,J=y?n.NEAREST_MIPMAP_LINEAR:n.NEAREST;break;case 4:B=n.NEAREST,J=y?n.NEAREST_MIPMAP_NEAREST:n.NEAREST;break;case 5:B=n.NEAREST,J=y?n.LINEAR_MIPMAP_NEAREST:n.LINEAR;break;case 6:B=n.NEAREST,J=y?n.LINEAR_MIPMAP_LINEAR:n.LINEAR;break;case 7:B=n.NEAREST,J=n.LINEAR;break;case 1:B=n.NEAREST,J=n.NEAREST;break;case 9:B=n.LINEAR,J=y?n.NEAREST_MIPMAP_NEAREST:n.NEAREST;break;case 10:B=n.LINEAR,J=y?n.NEAREST_MIPMAP_LINEAR:n.NEAREST;break;case 2:B=n.LINEAR,J=n.LINEAR;break;case 12:B=n.LINEAR,J=n.NEAREST}return{min:J,mag:B}}_createTexture(){const v=this._gl.createTexture();if(!v)throw new Error("Unable to create texture");return v}_createHardwareTexture(){return new N.b(this._createTexture(),this._gl)}_createInternalTexture(v,y){let n,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,J=!1,b=0,Y=3,l=5,a=!1,Z=1;void 0!==y&&"object"===typeof y?(J=!!y.generateMipMaps,b=void 0===y.type?0:y.type,Y=void 0===y.samplingMode?3:y.samplingMode,l=void 0===y.format?5:y.format,a=void 0!==y.useSRGBBuffer&&y.useSRGBBuffer,Z=y.samples??1,n=y.label):J=!!y,a&&(a=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==b||this._caps.textureFloatLinearFiltering)&&(2!==b||this._caps.textureHalfFloatLinearFiltering)||(Y=1),1!==b||this._caps.textureFloat||(b=0,P.e.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const x=this._gl,f=new i.b(this,B),N=v.width||v,g=v.height||v,c=v.depth||0,h=v.layers||0,E=this._getSamplingParameters(Y,J),W=0!==h?x.TEXTURE_2D_ARRAY:0!==c?x.TEXTURE_3D:x.TEXTURE_2D,s=this._getRGBABufferInternalSizedFormat(b,l,a),C=this._getInternalFormat(l),r=this._getWebGLTextureType(b);return this._bindTextureDirectly(W,f),0!==h?(f.is2DArray=!0,x.texImage3D(W,0,s,N,g,h,0,C,r,null)):0!==c?(f.is3D=!0,x.texImage3D(W,0,s,N,g,c,0,C,r,null)):x.texImage2D(W,0,s,N,g,0,C,r,null),x.texParameteri(W,x.TEXTURE_MAG_FILTER,E.mag),x.texParameteri(W,x.TEXTURE_MIN_FILTER,E.min),x.texParameteri(W,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(W,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),J&&this._gl.generateMipmap(W),this._bindTextureDirectly(W,null),f._useSRGBBuffer=a,f.baseWidth=N,f.baseHeight=g,f.width=N,f.height=g,f.depth=h,f.isReady=!0,f.samples=Z,f.generateMipMaps=J,f.samplingMode=Y,f.type=b,f.format=l,f.label=n,this._internalTexturesCache.push(f),f}_getUseSRGBBuffer(v,y){return v&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||y)}createTexture(v,y,n,B){var J=this;let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,f=arguments.length>11?arguments[11]:void 0,N=arguments.length>12?arguments[12]:void 0,g=arguments.length>13?arguments[13]:void 0,c=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(v,y,n,B,P,b,Y,(function(){for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];return J._prepareWebGLTexture(...y,Z)}),((v,y,n,J,P,b)=>{const Y=this._gl,l=n.width===v&&n.height===y;P._creationFlags=g??0;const a=this._getTexImageParametersForCreateTexture(P.format,P._useSRGBBuffer);if(l)return Y.texImage2D(Y.TEXTURE_2D,0,a.internalFormat,a.format,a.type,n),!1;const Z=this._caps.maxTextureSize;if(n.width>Z||n.height>Z||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=v,this._workingCanvas.height=y,this._workingContext.drawImage(n,0,0,n.width,n.height,0,0,v,y),Y.texImage2D(Y.TEXTURE_2D,0,a.internalFormat,a.format,a.type,this._workingCanvas),P.width=v,P.height=y,!1);{const v=new i.b(this,2);this._bindTextureDirectly(Y.TEXTURE_2D,v,!0),Y.texImage2D(Y.TEXTURE_2D,0,a.internalFormat,a.format,a.type,n),this._rescaleTexture(v,P,B,a.format,(()=>{this._releaseTexture(v),this._bindTextureDirectly(Y.TEXTURE_2D,P,!0),b()}))}return!0}),l,a,Z,x,f,N,c)}_getTexImageParametersForCreateTexture(v,y){let n,B;return 1===this.webGLVersion?(n=this._getInternalFormat(v,y),B=n):(n=this._getInternalFormat(v,!1),B=this._getRGBABufferInternalSizedFormat(0,v,y)),{internalFormat:B,format:n,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(v,y,n,B,J){}_unpackFlipY(v){this._unpackFlipYCached!==v&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,v?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=v))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(v){return v.isCube?this._gl.TEXTURE_CUBE_MAP:v.is3D?this._gl.TEXTURE_3D:v.is2DArray||v.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=this._getTextureTarget(y),J=this._getSamplingParameters(v,y.useMipMaps||n);this._setTextureParameterInteger(B,this._gl.TEXTURE_MAG_FILTER,J.mag,y),this._setTextureParameterInteger(B,this._gl.TEXTURE_MIN_FILTER,J.min),n&&(y.generateMipMaps=!0,this._gl.generateMipmap(B)),this._bindTextureDirectly(B,null),y.samplingMode=v}updateTextureDimensions(v,y,n){}updateTextureWrappingMode(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const J=this._getTextureTarget(v);null!==y&&(this._setTextureParameterInteger(J,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(y),v),v._cachedWrapU=y),null!==n&&(this._setTextureParameterInteger(J,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(n),v),v._cachedWrapV=n),(v.is2DArray||v.is3D)&&null!==B&&(this._setTextureParameterInteger(J,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(B),v),v._cachedWrapR=B),this._bindTextureDirectly(J,null)}_uploadCompressedDataToTextureDirectly(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const Y=this._gl;let l=Y.TEXTURE_2D;if(v.isCube&&(l=Y.TEXTURE_CUBE_MAP_POSITIVE_X+P),v._useSRGBBuffer)switch(y){case 37492:case 36196:this._caps.etc2?y=Y.COMPRESSED_SRGB8_ETC2:v._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?y=Y.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:v._useSRGBBuffer=!1;break;case 36492:y=Y.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:y=Y.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?y=Y.COMPRESSED_SRGB_S3TC_DXT1_EXT:v._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?y=Y.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:v._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?y=Y.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:v._useSRGBBuffer=!1;break;default:v._useSRGBBuffer=!1}this._gl.compressedTexImage2D(l,b,y,n,B,0,J)}_uploadDataToTextureDirectly(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,J=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const b=this._gl,Y=this._getWebGLTextureType(v.type),l=this._getInternalFormat(v.format),a=void 0===J?this._getRGBABufferInternalSizedFormat(v.type,v.format,v._useSRGBBuffer):this._getInternalFormat(J,v._useSRGBBuffer);this._unpackFlipY(v.invertY);let Z=b.TEXTURE_2D;v.isCube&&(Z=b.TEXTURE_CUBE_MAP_POSITIVE_X+n);const x=Math.round(Math.log(v.width)*Math.LOG2E),f=Math.round(Math.log(v.height)*Math.LOG2E),N=P?v.width:Math.pow(2,Math.max(x-B,0)),i=P?v.height:Math.pow(2,Math.max(f-B,0));b.texImage2D(Z,B,a,N,i,0,l,Y,y)}updateTextureData(v,y,n,B,J,P){let b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const a=this._gl,Z=this._getWebGLTextureType(v.type),x=this._getInternalFormat(v.format);this._unpackFlipY(v.invertY);let f=a.TEXTURE_2D,N=a.TEXTURE_2D;v.isCube&&(N=a.TEXTURE_CUBE_MAP_POSITIVE_X+b,f=a.TEXTURE_CUBE_MAP),this._bindTextureDirectly(f,v,!0),a.texSubImage2D(N,Y,n,B,J,P,x,Z,y),l&&this._gl.generateMipmap(N),this._bindTextureDirectly(f,null)}_uploadArrayBufferViewToTexture(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const J=this._gl,P=v.isCube?J.TEXTURE_CUBE_MAP:J.TEXTURE_2D;this._bindTextureDirectly(P,v,!0),this._uploadDataToTextureDirectly(v,y,n,B),this._bindTextureDirectly(P,null,!0)}_prepareWebGLTextureContinuation(v,y,n,B,J){const P=this._gl;if(!P)return;const b=this._getSamplingParameters(J,!n);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,b.mag),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,b.min),n||B||P.generateMipmap(P.TEXTURE_2D),this._bindTextureDirectly(P.TEXTURE_2D,null),y&&y.removePendingData(v),v.onLoadedObservable.notifyObservers(v),v.onLoadedObservable.clear()}_prepareWebGLTexture(v,y,n,B,J,P,b,Y,l,a){const Z=this.getCaps().maxTextureSize,f=Math.min(Z,this.needPOTTextures?(0,x.g)(B.width,Z):B.width),N=Math.min(Z,this.needPOTTextures?(0,x.g)(B.height,Z):B.height),i=this._gl;i&&(v._hardwareTexture?(this._bindTextureDirectly(i.TEXTURE_2D,v,!0),this._unpackFlipY(void 0===J||!!J),v.baseWidth=B.width,v.baseHeight=B.height,v.width=f,v.height=N,v.isReady=!0,v.type=-1!==v.type?v.type:0,v.format=-1!==v.format?v.format:a??(".jpg"!==y||v._useSRGBBuffer?5:4),Y(f,N,B,y,v,(()=>{this._prepareWebGLTextureContinuation(v,n,P,b,l)}))||this._prepareWebGLTextureContinuation(v,n,P,b,l)):n&&n.removePendingData(v))}_getInternalFormatFromDepthTextureFormat(v,y,n){const B=this._gl;if(!y)return B.STENCIL_INDEX8;let J=n?B.DEPTH_STENCIL:B.DEPTH_COMPONENT;return this.webGLVersion>1?15===v?J=B.DEPTH_COMPONENT16:16===v?J=B.DEPTH_COMPONENT24:17===v||13===v?J=n?B.DEPTH24_STENCIL8:B.DEPTH_COMPONENT24:14===v?J=B.DEPTH_COMPONENT32F:18===v&&(J=n?B.DEPTH32F_STENCIL8:B.DEPTH_COMPONENT32F):J=B.DEPTH_COMPONENT16,J}_setupFramebufferDepthAttachments(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,P=arguments.length>5?arguments[5]:void 0;const b=this._gl;P=P??(v?13:14);const Y=this._getInternalFormatFromDepthTextureFormat(P,y,v);return v&&y?this._createRenderBuffer(n,B,J,b.DEPTH_STENCIL,Y,b.DEPTH_STENCIL_ATTACHMENT):y?this._createRenderBuffer(n,B,J,Y,Y,b.DEPTH_ATTACHMENT):v?this._createRenderBuffer(n,B,J,Y,Y,b.STENCIL_ATTACHMENT):null}_createRenderBuffer(v,y,n,B,J,P){let b=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const Y=this._gl.createRenderbuffer();return this._updateRenderBuffer(Y,v,y,n,B,J,P,b)}_updateRenderBuffer(v,y,n,B,J,P,b){let Y=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const l=this._gl;return l.bindRenderbuffer(l.RENDERBUFFER,v),B>1&&l.renderbufferStorageMultisample?l.renderbufferStorageMultisample(l.RENDERBUFFER,B,P,y,n):l.renderbufferStorage(l.RENDERBUFFER,J,y,n),l.framebufferRenderbuffer(l.FRAMEBUFFER,b,l.RENDERBUFFER,v),Y&&l.bindRenderbuffer(l.RENDERBUFFER,null),v}_releaseTexture(v){this._deleteTexture(v._hardwareTexture),this.unbindAllTextures();const y=this._internalTexturesCache.indexOf(v);-1!==y&&this._internalTexturesCache.splice(y,1),v._lodTextureHigh&&v._lodTextureHigh.dispose(),v._lodTextureMid&&v._lodTextureMid.dispose(),v._lodTextureLow&&v._lodTextureLow.dispose(),v._irradianceTexture&&v._irradianceTexture.dispose()}_deleteTexture(v){null===v||void 0===v||v.release()}_setProgram(v){this._currentProgram!==v&&((0,B.o)(v,this._gl),this._currentProgram=v)}bindSamplers(v){const y=v.getPipelineContext();this._setProgram(y.program);const n=v.getSamplers();for(let B=0;B<n.length;B++){const y=v.getUniform(n[B]);y&&(this._boundUniforms[B]=y)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=!1;const b=y&&y._associatedChannel>-1;n&&b&&(this._activeChannel=y._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==y||B){if(this._activateCurrentTexture(),y&&y.isMultiview)throw P.e.Error(["_bindTextureDirectly called with a multiview texture!",v,y]),"_bindTextureDirectly called with a multiview texture!";var Y;this._gl.bindTexture(v,(null===y||void 0===y||null===(Y=y._hardwareTexture)||void 0===Y?void 0:Y.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=y,y&&(y._associatedChannel=this._activeChannel)}else n&&(J=!0,this._activateCurrentTexture());return b&&!n&&this._bindSamplerUniformToChannel(y._associatedChannel,this._activeChannel),J}_bindTexture(v,y,n){if(void 0===v)return;y&&(y._associatedChannel=v),this._activeChannel=v;const B=y?this._getTextureTarget(y):this._gl.TEXTURE_2D;this._bindTextureDirectly(B,y)}unbindAllTextures(){for(let v=0;v<this._maxSimultaneousTextures;v++)this._activeChannel=v,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(v,y,n,B){void 0!==v&&(y&&(this._boundUniforms[v]=y),this._setTexture(v,n))}_bindSamplerUniformToChannel(v,y){const n=this._boundUniforms[v];n&&n._currentState!==y&&(this._gl.uniform1i(n,y),n._currentState=y)}_getTextureWrapMode(v){switch(v){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(v,y){let n,B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!y)return null!=this._boundTexturesCache[v]&&(this._activeChannel=v,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(y.video){this._activeChannel=v;const n=y.getInternalTexture();n&&(n._associatedChannel=v),y.update()}else if(4===y.delayLoadState)return y.delayLoad(),!1;n=J?y.depthStencilTexture:y.isReady()?y.getInternalTexture():y.isCube?this.emptyCubeTexture:y.is3D?this.emptyTexture3D:y.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!B&&n&&(n._associatedChannel=v);let P=!0;this._boundTexturesCache[v]===n&&(B||this._bindSamplerUniformToChannel(n._associatedChannel,v),P=!1),this._activeChannel=v;const b=this._getTextureTarget(n);if(P&&this._bindTextureDirectly(b,n,B),n&&!n.isMultiview){if(n.isCube&&n._cachedCoordinatesMode!==y.coordinatesMode){n._cachedCoordinatesMode=y.coordinatesMode;const v=3!==y.coordinatesMode&&5!==y.coordinatesMode?1:0;y.wrapU=v,y.wrapV=v}n._cachedWrapU!==y.wrapU&&(n._cachedWrapU=y.wrapU,this._setTextureParameterInteger(b,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(y.wrapU),n)),n._cachedWrapV!==y.wrapV&&(n._cachedWrapV=y.wrapV,this._setTextureParameterInteger(b,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(y.wrapV),n)),n.is3D&&n._cachedWrapR!==y.wrapR&&(n._cachedWrapR=y.wrapR,this._setTextureParameterInteger(b,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(y.wrapR),n)),this._setAnisotropicLevel(b,n,y.anisotropicFilteringLevel)}return!0}setTextureArray(v,y,n,B){if(void 0!==v&&y){this._textureUnits&&this._textureUnits.length===n.length||(this._textureUnits=new Int32Array(n.length));for(let y=0;y<n.length;y++){const B=n[y].getInternalTexture();B?(this._textureUnits[y]=v+y,B._associatedChannel=v+y):this._textureUnits[y]=-1}this._gl.uniform1iv(y,this._textureUnits);for(let v=0;v<n.length;v++)this._setTexture(this._textureUnits[v],n[v],!0)}}_setAnisotropicLevel(v,y,n){const B=this._caps.textureAnisotropicFilterExtension;11!==y.samplingMode&&3!==y.samplingMode&&2!==y.samplingMode&&(n=1),B&&y._cachedAnisotropicFilteringLevel!==n&&(this._setTextureParameterFloat(v,B.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n,this._caps.maxAnisotropy),y),y._cachedAnisotropicFilteringLevel=n)}_setTextureParameterFloat(v,y,n,B){this._bindTextureDirectly(v,B,!0,!0),this._gl.texParameterf(v,y,n)}_setTextureParameterInteger(v,y,n,B){B&&this._bindTextureDirectly(v,B,!0,!0),this._gl.texParameteri(v,y,n)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let v=0;v<this._caps.maxVertexAttribs;v++)this.disableAttributeByIndex(v)}else for(let v=0,y=this._vertexAttribArraysEnabled.length;v<y;v++)v>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[v]||this.disableAttributeByIndex(v)}releaseEffects(){const v=Object.keys(this._compiledEffects);for(const y of v){this._compiledEffects[y].dispose()}this._compiledEffects={}}dispose(){var v;((0,b.k)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(v=this._gl.getExtension("WEBGL_lose_context"))||void 0===v||v.loseContext());(0,B.A)(this._gl)}attachContextLostEvent(v){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",v,!1)}attachContextRestoredEvent(v){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",v,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(v){const y=this._gl;for(;y.getError()!==y.NO_ERROR;);let n=!0;const B=y.createTexture();y.bindTexture(y.TEXTURE_2D,B),y.texImage2D(y.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(v),1,1,0,y.RGBA,this._getWebGLTextureType(v),null),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.NEAREST),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.NEAREST);const J=y.createFramebuffer();y.bindFramebuffer(y.FRAMEBUFFER,J),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,B,0);const P=y.checkFramebufferStatus(y.FRAMEBUFFER);if(n=n&&P===y.FRAMEBUFFER_COMPLETE,n=n&&y.getError()===y.NO_ERROR,n&&(y.clear(y.COLOR_BUFFER_BIT),n=n&&y.getError()===y.NO_ERROR),n){y.bindFramebuffer(y.FRAMEBUFFER,null);const v=y.RGBA,B=y.UNSIGNED_BYTE,J=new Uint8Array(4);y.readPixels(0,0,1,1,v,B,J),n=n&&y.getError()===y.NO_ERROR}for(y.deleteTexture(B),y.deleteFramebuffer(J),y.bindFramebuffer(y.FRAMEBUFFER,null);!n&&y.getError()!==y.NO_ERROR;);return n}_getWebGLTextureType(v){if(1===this._webGLVersion){switch(v){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(v){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=y?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(v){case 0:n=this._gl.ALPHA;break;case 1:n=this._gl.LUMINANCE;break;case 2:n=this._gl.LUMINANCE_ALPHA;break;case 6:n=this._gl.RED;break;case 7:n=this._gl.RG;break;case 4:n=y?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:n=y?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(v){case 8:n=this._gl.RED_INTEGER;break;case 9:n=this._gl.RG_INTEGER;break;case 10:n=this._gl.RGB_INTEGER;break;case 11:n=this._gl.RGBA_INTEGER}return n}_getRGBABufferInternalSizedFormat(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==y)switch(y){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return n?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(v){case 3:switch(y){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(y){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return n?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return n?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(y){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(y){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(y){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(y){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(y){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(y){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(y){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return n?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(v,y,n,B){let J=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const b=J?4:3,Y=J?this._gl.RGBA:this._gl.RGB,l=new Uint8Array(B*n*b);return P&&this.flushFramebuffer(),this._gl.readPixels(v,y,n,B,Y,this._gl.UNSIGNED_BYTE,l),Promise.resolve(l)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const v=f.c._CreateCanvas(1,1),y=v.getContext("webgl")||v.getContext("experimental-webgl");this._IsSupported=null!=y&&!!window.WebGLRenderingContext}catch(v){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const v=f.c._CreateCanvas(1,1),y=v.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||v.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!y}catch(v){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}W._TempClearColorUint32=new Uint32Array(4),W._TempClearColorInt32=new Int32Array(4),W.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],W._ConcatenateShader=c.g,W._IsSupported=null,W._HasMajorPerformanceCaveat=null},11162:(v,y,n)=>{"use strict";var B;n.d(y,{e:()=>J}),function(v){v[v.PointerMove=0]="PointerMove",v[v.PointerDown=1]="PointerDown",v[v.PointerUp=2]="PointerUp"}(B||(B={}));class J{}J.DOM_DELTA_PIXEL=0,J.DOM_DELTA_LINE=1,J.DOM_DELTA_PAGE=2},11160:(v,y,n)=>{"use strict";n.d(y,{b:()=>B,d:()=>P,g:()=>J});class B{}B.KEYDOWN=1,B.KEYUP=2;class J{constructor(v,y){this.type=v,this.event=y}}class P extends J{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(v){this.skipOnKeyboardObservable=v}constructor(v,y){super(v,y),this.type=v,this.event=y,this.skipOnKeyboardObservable=!1}}},11151:(v,y,n)=>{"use strict";n.d(y,{d:()=>J,e:()=>b,i:()=>Y});var B=n(11081);class J{}J.POINTERDOWN=1,J.POINTERUP=2,J.POINTERMOVE=4,J.POINTERWHEEL=8,J.POINTERPICK=16,J.POINTERTAP=32,J.POINTERDOUBLETAP=64;class P{constructor(v,y){this.type=v,this.event=y}}class b extends P{constructor(v,y,n,J){super(v,y),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new B.j(n,J)}}class Y extends P{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(v,y),this._pickInfo=n,this._inputManager=B}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},10785:(v,y,n)=>{"use strict";n.r(y),n.d(y,{SceneInstrumentation:()=>P});var B=n(10791),J=n(10919);class P{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(v){v!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=v,v?(this._onBeforeActiveMeshesEvaluationObserver=this.$d.onBeforeActiveMeshesEvaluationObservable.add((()=>{B.g.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.$d.onAfterActiveMeshesEvaluationObservable.add((()=>{B.g.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.$d.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.$d.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(v){v!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=v,v?(this._onBeforeRenderTargetsRenderObserver=this.$d.onBeforeRenderTargetsRenderObservable.add((()=>{B.g.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.$d.onAfterRenderTargetsRenderObservable.add((()=>{B.g.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.$d.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.$d.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(v){v!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=v,v?(this._onBeforeParticlesRenderingObserver=this.$d.onBeforeParticlesRenderingObservable.add((()=>{B.g.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.$d.onAfterParticlesRenderingObservable.add((()=>{B.g.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.$d.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.$d.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(v){v!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=v,this.$d.spriteManagers&&(v?(this._onBeforeSpritesRenderingObserver=this.$d.onBeforeSpritesRenderingObservable.add((()=>{B.g.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.$d.onAfterSpritesRenderingObservable.add((()=>{B.g.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.$d.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.$d.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(v){v!==this._capturePhysicsTime&&this.$d.onBeforePhysicsObservable&&(this._capturePhysicsTime=v,v?(this._onBeforePhysicsObserver=this.$d.onBeforePhysicsObservable.add((()=>{B.g.StartPerformanceCounter("kb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.$d.onAfterPhysicsObservable.add((()=>{B.g.EndPerformanceCounter("kb"),this._physicsTime.endMonitoring()}))):(this.$d.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.$d.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(v){v!==this._captureAnimationsTime&&(this._captureAnimationsTime=v,v?this._onAfterAnimationsObserver=this.$d.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.$d.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(v){this._captureFrameTime=v}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(v){this._captureInterFrameTime=v}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(v){v!==this._captureRenderTime&&(this._captureRenderTime=v,v?(this._onBeforeDrawPhaseObserver=this.$d.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),B.g.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.$d.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),B.g.EndPerformanceCounter("Main render")}))):(this.$d.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.$d.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(v){v!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=v,v?(this._onBeforeCameraRenderObserver=this.$d.onBeforeCameraRenderObservable.add((v=>{this._cameraRenderTime.beginMonitoring(),B.g.StartPerformanceCounter(`Rendering camera ${v.name}`)})),this._onAfterCameraRenderObserver=this.$d.onAfterCameraRenderObservable.add((v=>{this._cameraRenderTime.endMonitoring(!1),B.g.EndPerformanceCounter(`Rendering camera ${v.name}`)}))):(this.$d.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.$d.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.$d.getEngine()._drawCalls}constructor(v){this.$d=v,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new J.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new J.c,this._captureFrameTime=!1,this._frameTime=new J.c,this._captureRenderTime=!1,this._renderTime=new J.c,this._captureInterFrameTime=!1,this._interFrameTime=new J.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new J.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new J.c,this._capturePhysicsTime=!1,this._physicsTime=new J.c,this._captureAnimationsTime=!1,this._animationsTime=new J.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new J.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=v.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(B.g.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.$d.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=v.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(B.g.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.tj(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.tj(),this._captureParticlesRenderTime&&this._particlesRenderTime.tj(),this._captureSpritesRenderTime&&this._spritesRenderTime.tj(),this._captureRenderTime&&this._renderTime.tj(),this._captureCameraRenderTime&&this._cameraRenderTime.tj()}))}dispose(){this.$d.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.$d.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.$d.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.$d.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.$d.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.$d.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.$d.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.$d.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.$d.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.$d.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.$d.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.$d.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.$d.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.$d.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.$d.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.$d.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.$d.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.$d=null}}},12359:(v,y,n)=>{"use strict";n.d(y,{d:()=>Z});var B=n(11050),J=n(11055),P=n(11081),b=n(11351),Y=n(12306),l=n(12368),a=n(10908);b.c.AddNodeConstructor("Light_Type_1",((v,y)=>()=>new Z(v,P.n.Zero(),y)));class Z extends l.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(v){this._shadowFrustumSize=v,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(v){this._shadowOrthoScale=v,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(v){this._orthoLeft=v}get orthoRight(){return this._orthoRight}set orthoRight(v){this._orthoRight=v}get orthoTop(){return this._orthoTop}set orthoTop(v){this._orthoTop=v}get orthoBottom(){return this._orthoBottom}set orthoBottom(v){this._orthoBottom=v}constructor(v,y,n){super(v,n),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=y.scale(-1),this.direction=y}getClassName(){return"lb"}getTypeID(){return Y.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(v,y,n){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(v):this._setDefaultAutoExtendShadowProjectionMatrix(v,y,n)}_setDefaultFixedFrustumShadowProjectionMatrix(v){const y=this.va().activeCamera;y&&P.d.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:y.ij,void 0!==this.shadowMaxZ?this.shadowMaxZ:y.maxZ,v,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(v,y,n){const B=this.va().activeCamera;if(!B)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const v=P.n.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let B=Number.MAX_VALUE,J=-Number.MAX_VALUE;for(let b=0;b<n.length;b++){const Y=n[b];if(!Y)continue;const l=Y.getBoundingInfo().boundingBox;for(let n=0;n<l.vectorsWorld.length;n++)P.n.TransformCoordinatesToRef(l.vectorsWorld[n],y,v),v.x<this._orthoLeft&&(this._orthoLeft=v.x),v.y<this._orthoBottom&&(this._orthoBottom=v.y),v.x>this._orthoRight&&(this._orthoRight=v.x),v.y>this._orthoTop&&(this._orthoTop=v.y),this.autoCalcShadowZBounds&&(v.z<B&&(B=v.z),v.z>J&&(J=v.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=B,this._shadowMaxZ=J)}const J=this._orthoRight-this._orthoLeft,b=this._orthoTop-this._orthoBottom,Y=void 0!==this.shadowMinZ?this.shadowMinZ:B.ij,l=void 0!==this.shadowMaxZ?this.shadowMaxZ:B.maxZ,a=this.va().getEngine().useReverseDepthBuffer;P.d.OrthoOffCenterLHToRef(this._orthoLeft-J*this.shadowOrthoScale,this._orthoRight+J*this.shadowOrthoScale,this._orthoBottom-b*this.shadowOrthoScale,this._orthoTop+b*this.shadowOrthoScale,a?l:Y,a?Y:l,v,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(v,y){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,y),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,y),this)}transferToNodeMaterialEffect(v,y){return this.computeTransformedInformation()?(v.setFloat3(y,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(v.setFloat3(y,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(v){const y=this._scene.getEngine();return!y.useReverseDepthBuffer&&y.isNDCHalfZRange?0:1}getDepthMaxZ(v){const y=this._scene.getEngine();return y.useReverseDepthBuffer&&y.isNDCHalfZRange?0:1}prepareLightSpecificDefines(v,y){v["DIRLIGHT"+y]=!0}}(0,B.c)([(0,J.M)()],Z.prototype,"shadowFrustumSize",null),(0,B.c)([(0,J.M)()],Z.prototype,"shadowOrthoScale",null),(0,B.c)([(0,J.M)()],Z.prototype,"autoUpdateExtends",void 0),(0,B.c)([(0,J.M)()],Z.prototype,"autoCalcShadowZBounds",void 0),(0,B.c)([(0,J.M)("orthoLeft")],Z.prototype,"_orthoLeft",void 0),(0,B.c)([(0,J.M)("orthoRight")],Z.prototype,"_orthoRight",void 0),(0,B.c)([(0,J.M)("orthoTop")],Z.prototype,"_orthoTop",void 0),(0,B.c)([(0,J.M)("orthoBottom")],Z.prototype,"_orthoBottom",void 0),(0,a.g)("BABYLON.DirectionalLight",Z)},12755:(v,y,n)=>{"use strict";n.d(y,{c:()=>Z});var B=n(11050),J=n(11055),P=n(11081),b=n(11103),Y=n(11351),l=n(12306),a=n(10908);Y.c.AddNodeConstructor("Light_Type_3",((v,y)=>()=>new Z(v,P.n.Zero(),y)));class Z extends l.d{constructor(v,y,n){super(v,n),this.groundColor=new b.d(0,0,0),this.direction=y||P.n.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"mb"}setDirectionToTarget(v){return this.direction=P.n.Normalize(v.od(P.n.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(v,y){const n=P.n.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",n.x,n.y,n.z,0,y),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.mj),y),this}transferToNodeMaterialEffect(v,y){const n=P.n.Normalize(this.direction);return v.setFloat3(y,n.x,n.y,n.z),this}ak(){return this._worldMatrix||(this._worldMatrix=P.d.Identity()),this._worldMatrix}getTypeID(){return l.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(v,y){v["HEMILIGHT"+y]=!0}}(0,B.c)([(0,J.j)()],Z.prototype,"groundColor",void 0),(0,B.c)([(0,J.I)()],Z.prototype,"direction",void 0),(0,a.g)("BABYLON.HemisphericLight",Z)},12306:(v,y,n)=>{"use strict";n.d(y,{d:()=>f});var B=n(11050),J=n(11055),P=n(11081),b=n(11103),Y=n(11351),l=n(11120),a=n(10908),Z=n(11186),x=n(11110);class f extends Y.c{get range(){return this._range}set range(v){this._range=v,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(v){this._intensityMode=v,this._computePhotometricScale()}get radius(){return this._radius}set radius(v){this._radius=v,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(v){this._shadowEnabled!==v&&(this._shadowEnabled=v,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(v){this._includedOnlyMeshes=v,this._hookArrayForIncludedOnly(v)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(v){this._excludedMeshes=v,this._hookArrayForExcluded(v)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(v){this._excludeWithLayerMask=v,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(v){this._includeOnlyWithLayerMask=v,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(v){this._lightmapMode!==v&&(this._lightmapMode=v,this._markMeshesAsLightDirty())}getViewMatrix(v){return null}getProjectionMatrix(v,y){return null}constructor(v,y){super(v,y,!1),this.Qh=new b.d(1,1,1),this.Rh=new b.d(1,1,1),this.falloffType=f.FALLOFF_DEFAULT,this.mj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=f.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new l.b(this.va().getEngine(),void 0,void 0,v),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(v,y){return this}_bindLight(v,y,n,B){let J=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const P=v.toString();let Y=!1;if(this._uniformBuffer.bindToEffect(n,"Light"+P),this._renderId!==y.getRenderId()||this._lastUseSpecular!==B||!this._uniformBuffer.useUbo){this._renderId=y.getRenderId(),this._lastUseSpecular=B;const v=this.getScaledIntensity();this.transferToEffect(n,P),this.Qh.scaleToRef(v,b.h.ib[0]),this._uniformBuffer.updateColor4("vLightDiffuse",b.h.ib[0],this.range,P),B&&(this.Rh.scaleToRef(v,b.h.ib[1]),this._uniformBuffer.updateColor4("vLightSpecular",b.h.ib[1],this.radius,P)),Y=!0}if(this.transferTexturesToEffect(n,P),y.shadowsEnabled&&this.shadowEnabled&&J){const v=this.getShadowGenerator(y.activeCamera)??this.getShadowGenerator();v&&(v.bindShadowLight(P,n),Y=!0)}Y?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(v){let y="Name: "+this.name;if(y+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let n=0;n<this.animations.length;n++)y+=", animation[0]: "+this.animations[n].toString(v);return y}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Nb(v){super.Nb(v),this._resyncMeshes()}getShadowGenerator(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(v)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return P.n.Zero()}canAffectMesh(v){return!v||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(v))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(v))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&v.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&v.layerMask)))}dispose(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const v=this._shadowGenerators.values();for(let y=v.next();!0!==y.done;y=v.next()){y.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const v=this._parentContainer.lights.indexOf(this);v>-1&&this._parentContainer.lights.splice(v,1),this._parentContainer=null}for(const n of this.va().meshes)n._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(v,y)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.mj}clone(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=f.GetConstructorFromName(this.getTypeID(),v,this.va());if(!n)return null;const B=x.d.Clone(n,this);return v&&(B.name=v),y&&(B.parent=y),B.Nb(this.isEnabled()),this.onClonedObservable.notifyObservers(B),B}serialize(){const v=x.d.Serialize(this);return v.uniqueId=this.uniqueId,v.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(v),this.excludedMeshes.length>0&&(v.excludedMeshesIds=[],this.excludedMeshes.forEach((y=>{v.excludedMeshesIds.push(y.id)}))),this.includedOnlyMeshes.length>0&&(v.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((y=>{v.includedOnlyMeshesIds.push(y.id)}))),x.d.AppendSerializedAnimations(this,v),v.ranges=this.serializeAnimationRanges(),v.isEnabled=this.isEnabled(),v}static GetConstructorFromName(v,y,n){const B=Y.c.Construct("Light_Type_"+v,y,n);return B||null}static Parse(v,y){const n=f.GetConstructorFromName(v.type,v.name,y);if(!n)return null;const B=x.d.Parse(n,v,y);if(v.excludedMeshesIds&&(B._excludedMeshesIds=v.excludedMeshesIds),v.includedOnlyMeshesIds&&(B._includedOnlyMeshesIds=v.includedOnlyMeshesIds),void 0!==v.parentId&&(B._waitingParentId=v.parentId),void 0!==v.parentInstanceIndex&&(B._waitingParentInstanceIndex=v.parentInstanceIndex),void 0!==v.falloffType&&(B.falloffType=v.falloffType),void 0!==v.lightmapMode&&(B.lightmapMode=v.lightmapMode),v.animations){for(let y=0;y<v.animations.length;y++){const n=v.animations[y],J=(0,a.d)("BABYLON.Animation");J&&B.animations.push(J.Parse(n))}Y.c.ParseAnimationRanges(B,v,y)}return v.autoAnimate&&y.beginAnimation(B,v.autoAnimateFrom,v.autoAnimateTo,v.autoAnimateLoop,v.autoAnimateSpeed||1),void 0!==v.isEnabled&&B.Nb(v.isEnabled),B}_hookArrayForExcluded(v){var y=this;const n=v.push;v.push=function(){for(var B=arguments.length,J=new Array(B),P=0;P<B;P++)J[P]=arguments[P];const b=n.apply(v,J);for(const v of J)v._resyncLightSource(y);return b};const B=v.splice;v.splice=(y,n)=>{const J=B.apply(v,[y,n]);for(const v of J)v._resyncLightSource(this);return J};for(const J of v)J._resyncLightSource(this)}_hookArrayForIncludedOnly(v){var y=this;const n=v.push;v.push=function(){for(var B=arguments.length,J=new Array(B),P=0;P<B;P++)J[P]=arguments[P];const b=n.apply(v,J);return y._resyncMeshes(),b};const B=v.splice;v.splice=(y,n)=>{const J=B.apply(v,[y,n]);return this._resyncMeshes(),J},this._resyncMeshes()}_resyncMeshes(){for(const v of this.va().meshes)v._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const v of this.va().meshes)-1!==v.lightSources.indexOf(this)&&v._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let v=0;const y=this.getTypeID();let n=this.intensityMode;switch(n===f.INTENSITYMODE_AUTOMATIC&&(n=y===f.LIGHTTYPEID_DIRECTIONALLIGHT?f.INTENSITYMODE_ILLUMINANCE:f.INTENSITYMODE_LUMINOUSINTENSITY),y){case f.LIGHTTYPEID_POINTLIGHT:case f.LIGHTTYPEID_SPOTLIGHT:switch(n){case f.INTENSITYMODE_LUMINOUSPOWER:v=1/(4*Math.PI);break;case f.INTENSITYMODE_LUMINOUSINTENSITY:v=1;break;case f.INTENSITYMODE_LUMINANCE:v=this.radius*this.radius}break;case f.LIGHTTYPEID_DIRECTIONALLIGHT:switch(n){case f.INTENSITYMODE_ILLUMINANCE:v=1;break;case f.INTENSITYMODE_LUMINANCE:{let y=this.radius;y=Math.max(y,.001);v=2*Math.PI*(1-Math.cos(y));break}}break;case f.LIGHTTYPEID_HEMISPHERICLIGHT:v=1}return v}_reorderLightsInScene(){const v=this.va();0!=this._renderPriority&&(v.requireLightSorting=!0),this.va().sortLightsByPriority()}}f.FALLOFF_DEFAULT=Z.e.FALLOFF_DEFAULT,f.FALLOFF_PHYSICAL=Z.e.FALLOFF_PHYSICAL,f.FALLOFF_GLTF=Z.e.FALLOFF_GLTF,f.FALLOFF_STANDARD=Z.e.FALLOFF_STANDARD,f.LIGHTMAP_DEFAULT=Z.e.LIGHTMAP_DEFAULT,f.LIGHTMAP_SPECULAR=Z.e.LIGHTMAP_SPECULAR,f.LIGHTMAP_SHADOWSONLY=Z.e.LIGHTMAP_SHADOWSONLY,f.INTENSITYMODE_AUTOMATIC=Z.e.INTENSITYMODE_AUTOMATIC,f.INTENSITYMODE_LUMINOUSPOWER=Z.e.INTENSITYMODE_LUMINOUSPOWER,f.INTENSITYMODE_LUMINOUSINTENSITY=Z.e.INTENSITYMODE_LUMINOUSINTENSITY,f.INTENSITYMODE_ILLUMINANCE=Z.e.INTENSITYMODE_ILLUMINANCE,f.INTENSITYMODE_LUMINANCE=Z.e.INTENSITYMODE_LUMINANCE,f.LIGHTTYPEID_POINTLIGHT=Z.e.LIGHTTYPEID_POINTLIGHT,f.LIGHTTYPEID_DIRECTIONALLIGHT=Z.e.LIGHTTYPEID_DIRECTIONALLIGHT,f.LIGHTTYPEID_SPOTLIGHT=Z.e.LIGHTTYPEID_SPOTLIGHT,f.LIGHTTYPEID_HEMISPHERICLIGHT=Z.e.LIGHTTYPEID_HEMISPHERICLIGHT,(0,B.c)([(0,J.j)()],f.prototype,"diffuse",void 0),(0,B.c)([(0,J.j)()],f.prototype,"specular",void 0),(0,B.c)([(0,J.M)()],f.prototype,"falloffType",void 0),(0,B.c)([(0,J.M)()],f.prototype,"intensity",void 0),(0,B.c)([(0,J.M)()],f.prototype,"range",null),(0,B.c)([(0,J.M)()],f.prototype,"intensityMode",null),(0,B.c)([(0,J.M)()],f.prototype,"radius",null),(0,B.c)([(0,J.M)()],f.prototype,"_renderPriority",void 0),(0,B.c)([(0,J.d)("_reorderLightsInScene")],f.prototype,"renderPriority",void 0),(0,B.c)([(0,J.M)("shadowEnabled")],f.prototype,"_shadowEnabled",void 0),(0,B.c)([(0,J.M)("excludeWithLayerMask")],f.prototype,"_excludeWithLayerMask",void 0),(0,B.c)([(0,J.M)("includeOnlyWithLayerMask")],f.prototype,"_includeOnlyWithLayerMask",void 0),(0,B.c)([(0,J.M)("lightmapMode")],f.prototype,"_lightmapMode",void 0)},11186:(v,y,n)=>{"use strict";n.d(y,{e:()=>B});class B{static CompareLightsPriority(v,y){return v.shadowEnabled!==y.shadowEnabled?(y.shadowEnabled?1:0)-(v.shadowEnabled?1:0):y.renderPriority-v.renderPriority}}B.FALLOFF_DEFAULT=0,B.FALLOFF_PHYSICAL=1,B.FALLOFF_GLTF=2,B.FALLOFF_STANDARD=3,B.LIGHTMAP_DEFAULT=0,B.LIGHTMAP_SPECULAR=1,B.LIGHTMAP_SHADOWSONLY=2,B.INTENSITYMODE_AUTOMATIC=0,B.INTENSITYMODE_LUMINOUSPOWER=1,B.INTENSITYMODE_LUMINOUSINTENSITY=2,B.INTENSITYMODE_ILLUMINANCE=3,B.INTENSITYMODE_LUMINANCE=4,B.LIGHTTYPEID_POINTLIGHT=0,B.LIGHTTYPEID_DIRECTIONALLIGHT=1,B.LIGHTTYPEID_SPOTLIGHT=2,B.LIGHTTYPEID_HEMISPHERICLIGHT=3},12368:(v,y,n)=>{"use strict";n.d(y,{c:()=>l});var B=n(11050),J=n(11055),P=n(11081),b=n(12306),Y=n(11390);class l extends b.d{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=P.d.Identity(),this._projectionMatrix=P.d.Identity()}_setPosition(v){this._position=v}get position(){return this._position}set position(v){this._setPosition(v)}_setDirection(v){this._direction=v}get direction(){return this._direction}set direction(v){this._setDirection(v)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(v){this._shadowMinZ=v,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(v){this._shadowMaxZ=v,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=P.n.Zero()),P.n.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=P.n.Zero()),P.n.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(v){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(v){return this.direction=P.n.Normalize(v.od(this.position)),this.direction}getRotation(){this.direction.normalize();const v=P.n.Cross(this.direction,Y.c.Y),y=P.n.Cross(v,this.direction);return P.n.RotationFromAxis(v,y,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=P.n.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}ak(v){return!v&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=P.d.Identity()),P.d.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(v){return void 0!==this.shadowMinZ?this.shadowMinZ:v.ij}getDepthMaxZ(v){return void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ}setShadowProjectionMatrix(v,y,n){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(y,n,v):this._setDefaultShadowProjectionMatrix(v,y,n),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(v){const y=P.i.o[0];let n=this.position;this.computeTransformedInformation()&&(n=this.transformedPosition),P.n.NormalizeToRef(this.getShadowDirection(v),y),1===Math.abs(P.n.Dot(y,P.n.Up()))&&(y.z=1e-13);const B=P.i.o[1];return n.addToRef(y,B),P.d.LookAtLHToRef(n,B,P.n.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(v,y){return this.setShadowProjectionMatrix(this._projectionMatrix,v??this._viewMatrix,y??[]),this._projectionMatrix}}(0,B.c)([(0,J.I)()],l.prototype,"position",null),(0,B.c)([(0,J.I)()],l.prototype,"direction",null),(0,B.c)([(0,J.M)()],l.prototype,"shadowMinZ",null),(0,B.c)([(0,J.M)()],l.prototype,"shadowMaxZ",null)},11712:(v,y,n)=>{"use strict";n.d(y,{b:()=>b,f:()=>P,i:()=>Y});const B={},J={};function P(v,y){B[v]=y}function b(v,y){J[v]=y}function Y(v){return J[v]?J[v]:null}},11445:(v,y,n)=>{"use strict";n.d(y,{d:()=>S,g:()=>r});var B,J=n(10791),P=n(10795),b=n(11070),Y=n(10820),l=n(10801),a=n(11374),Z=n(10828),x=n(10831),f=n(10911),N=n(10849);!function(v){v[v.Clean=0]="Clean",v[v.Stop=1]="Stop",v[v.Sync=2]="Sync",v[v.NoSync=3]="NoSync"}(B||(B={}));const i=new P.e,g={};let c=!1;function h(){return g[".babylon"]}function E(v){const y=g[v];return y||(l.e.Warn("Unable to find a plugin to load "+v+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),h())}function W(v,y,n){let B="Unable to load from "+(v.rawData?"binary data":v.url);return y?B+=`: ${y}`:n&&(B+=`: ${n}`),B}function s(v,y,n,B,J,P,b,Y,l){var a;const x="data:"===(f=v.url).substring(0,5)?f.substring(5):null;var f;if(v.rawData&&!b)throw"When using ArrayBufferView to load data the file extension must be provided.";const c=b?E(b):x?function(v){for(const y in g){const n=g[y].plugin;if(n.canDirectLoad&&n.canDirectLoad(v))return g[y]}return h()}(v.url):function(v){const y=v.indexOf("?");-1!==y&&(v=v.substring(0,y));const n=v.lastIndexOf(".");return E(v.substring(n,v.length).toLowerCase())}(v.url);if(!c)throw new Error(`No plugin or fallback for ${b??v.url}`);if(!1===(null===l||void 0===l||null===(a=l[c.plugin.name])||void 0===a?void 0:a.enabled))throw new Error(`The '${c.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(v.rawData&&!c.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(v=>{if(c.plugin.createPlugin){const y=c.plugin.createPlugin(l??{});return y instanceof Promise?(y.then(v).catch((v=>{J("Error instantiating plugin.",v)})),null):(v(y),y)}return v(c.plugin),c.plugin})((l=>{var a;if(!l)throw`The loader plugin corresponding to the '${b}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(i.notifyObservers(l),x&&(l.canDirectLoad&&l.canDirectLoad(v.url)||!(0,Z.i)(v.url))){if(l.directLoad){const v=l.directLoad(y,x);v instanceof Promise?v.then((v=>{n(l,v)})).catch((v=>{J("Error in directLoad of _loadData: "+v,v)})):n(l,v)}else n(l,x);return}const f=c.isBinary,g=(v,B)=>{y.u?J("Scene has been disposed"):n(l,v,B)};let h=null,E=!1;null===(a=l.xj)||void 0===a||a.add((()=>{E=!0,h&&(h.abort(),h=null),P()}));const W=()=>{if(E)return;const n=(v,y)=>{J(null===v||void 0===v?void 0:v.statusText,y)};if(!l.loadFile&&v.rawData)throw"Plugin does not support loading ArrayBufferView.";h=l.loadFile?l.loadFile(y,v.rawData||v.file||v.url,v.rootUrl,g,B,f,n,Y):y._loadFile(v.file||v.url,g,B,!0,f,n)},s=y.getEngine();let C=s.enableOfflineSupport;if(C){let n=!1;for(const B of y.disableOfflineSupportExceptionRules)if(B.test(v.url)){n=!0;break}C=!n}C&&N.c.OfflineProviderFactory?y.offlineProvider=N.c.OfflineProviderFactory(v.url,W,s.disableManifestCheck):W()}))}function C(v,y){let n,B,P=null,b=null;if(y)if(y.name)n=`file:${y.name}`,B=y.name,P=y;else if(ArrayBuffer.isView(y))n="",B=(0,f.b)(),b=y;else if(y.startsWith("data:"))n=y,B="";else if(v){const P=y;if("/"===P.substring(0,1))return J.g.Error("Wrong sceneFilename parameter"),null;n=v+P,B=P}else n=y,B=J.g.GetFilename(y),v=J.g.GetFolderPath(y);else n=v,B=J.g.GetFilename(v),v=J.g.GetFolderPath(v);return{url:n,rootUrl:v,name:B,file:P,rawData:b}}function r(v){if("string"===typeof v.extensions){const y=v.extensions;g[y.toLowerCase()]={plugin:v,isBinary:!1}}else{const y=v.extensions;Object.keys(y).forEach((n=>{g[n.toLowerCase()]={plugin:v,isBinary:y[n].isBinary}}))}}function u(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Y.b.LastCreatedScene,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!B)return l.e.Error("No scene available to import mesh to"),null;const N=C(y,n);if(!N)return null;const i={};B.addPendingData(i);const g=()=>{B.removePendingData(i)},c=(v,y)=>{const n=W(N,v,y);b?b(B,n,new x.j(n,x.f.SceneLoaderError,y)):l.e.Error(n),g()},h=P?v=>{try{P(v)}catch(y){c("Error in onProgress callback: "+y,y)}}:void 0,E=(v,y,n,P,b,Y,l,a)=>{if(B.importedMeshesFiles.push(N.url),J)try{J(v,y,n,P,b,Y,l,a)}catch(Z){c("Error in onSuccess callback: "+Z,Z)}B.removePendingData(i)};return s(N,B,((y,n,J)=>{if(y.rewriteRootURL&&(N.rootUrl=y.rewriteRootURL(N.rootUrl,J)),y.importMesh){const J=[],P=[],b=[];if(!y.importMesh(v,B,n,N.rootUrl,J,P,b,c))return;B.loadingPluginName=y.name,E(J,P,b,[],[],[],[],[])}else{y.importMeshAsync(v,B,n,N.rootUrl,h,N.name).then((v=>{B.loadingPluginName=y.name,E(v.meshes,v.Ej,v.skeletons,v.animationGroups,v.transformNodes,v.geometries,v.lights,v.spriteManagers)})).catch((v=>{c(v.message,v)}))}}),h,c,g,a,Z,f)}function O(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.b.LastCreatedEngine,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return n?q(v,y,new b.e(n),B,P,l,a,Z,x):(J.g.Error("No engine available"),null)}function d(v,y,n,B,J,P,b){return new Promise(((Y,l)=>{O(v,y,n,(v=>{Y(v)}),B,((v,y,n)=>{l(n||new Error(y))}),J,P,b)}))}function q(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.b.LastCreatedScene,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!n)return l.e.Error("No scene available to append to"),null;const N=C(v,y);if(!N)return null;const i={};n.addPendingData(i);const g=()=>{n.removePendingData(i)};a.c.ShowLoadingScreen&&!c&&(c=!0,n.getEngine().displayLoadingUI(),n.executeWhenReady((()=>{n.getEngine().hideLoadingUI(),c=!1})));const h=(v,y)=>{const B=W(N,v,y);P?P(n,B,new x.j(B,x.f.SceneLoaderError,y)):l.e.Error(B),g()},E=J?v=>{try{J(v)}catch(y){h("Error in onProgress callback",y)}}:void 0,r=()=>{if(B)try{B(n)}catch(v){h("Error in onSuccess callback",v)}n.removePendingData(i)};return s(N,n,((v,y)=>{if(v.load){if(!v.load(n,y,N.rootUrl,h))return;n.loadingPluginName=v.name,r()}else{v.loadAsync(n,y,N.rootUrl,E,N.name).then((()=>{n.loadingPluginName=v.name,r()})).catch((v=>{h(v.message,v)}))}}),E,h,g,b,Z,f)}function L(v,y,n,B,J,P,b){return new Promise(((Y,l)=>{q(v,y,n,(v=>{Y(v)}),B,((v,y,n)=>{l(n||new Error(y))}),J,P,b)}))}function t(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.b.LastCreatedScene,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!n)return l.e.Error("No scene available to load asset container to"),null;const f=C(v,y);if(!f)return null;const N={};n.addPendingData(N);const i=()=>{n.removePendingData(N)},g=(v,y)=>{const B=W(f,v,y);P?P(n,B,new x.j(B,x.f.SceneLoaderError,y)):l.e.Error(B),i()},c=J?v=>{try{J(v)}catch(y){g("Error in onProgress callback",y)}}:void 0,h=v=>{if(B)try{B(v)}catch(y){g("Error in onSuccess callback",y)}n.removePendingData(N)};return s(f,n,((v,y)=>{if(v.loadAssetContainer){const B=v.loadAssetContainer(n,y,f.rootUrl,g);if(!B)return;B.populateRootNodes(),n.loadingPluginName=v.name,h(B)}else if(v.loadAssetContainerAsync){v.loadAssetContainerAsync(n,y,f.rootUrl,c,f.name).then((y=>{y.populateRootNodes(),n.loadingPluginName=v.name,h(y)})).catch((v=>{g(v.message,v)}))}else g("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),c,g,i,b,a,Z)}function G(v,y,n,B,J,P,b){return new Promise(((Y,l)=>{t(v,y,n,(v=>{Y(v)}),B,((v,y,n)=>{l(n||new Error(y))}),J,P,b)}))}function R(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.b.LastCreatedScene,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",N=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!n)return void l.e.Error("No scene available to load animations to");if(B){for(const v of n.animatables)v.reset();n.stopAllAnimations(),n.animationGroups.slice().forEach((v=>{v.dispose()}));n.getNodes().forEach((v=>{v.animations&&(v.animations=[])}))}else switch(J){case 0:n.animationGroups.slice().forEach((v=>{v.dispose()}));break;case 1:n.animationGroups.forEach((v=>{v.stop()}));break;case 2:n.animationGroups.forEach((v=>{v.reset(),v.restart()}));break;case 3:break;default:return void l.e.Error("Unknown animation group loading mode value '"+J+"'")}const i=n.animatables.length;t(v,y,n,(v=>{v.mergeAnimationsTo(n,n.animatables.slice(i),P),v.dispose(),n.onAnimationFileImportedObservable.notifyObservers(n),b&&b(n)}),a,Z,x,f,N)}function F(v,y,n,B,J,P,b,Y,l,a){return new Promise(((Z,x)=>{R(v,y,n,B,J,P,(v=>{Z(v)}),b,((v,y,n)=>{x(n||new Error(y))}),Y,l,a)}))}class S{static get ForceFullSceneLoadingForIncremental(){return a.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(v){a.c.ForceFullSceneLoadingForIncremental=v}static get ShowLoadingScreen(){return a.c.ShowLoadingScreen}static set ShowLoadingScreen(v){a.c.ShowLoadingScreen=v}static get loggingLevel(){return a.c.loggingLevel}static set loggingLevel(v){a.c.loggingLevel=v}static get CleanBoneMatrixWeights(){return a.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(v){a.c.CleanBoneMatrixWeights=v}static GetDefaultPlugin(){return h()}static GetPluginForExtension(v){var y;return null===(y=E(v))||void 0===y?void 0:y.plugin}static IsPluginForExtensionAvailable(v){return function(v){return!!g[v]}(v)}static RegisterPlugin(v){r(v)}static ImportMesh(v,y,n,B,J,P,b,Y,l){return u(v,y,n,B,J,P,b,Y,l)}static ImportMeshAsync(v,y,n,B,J,P,b){return function(v,y,n,B,J,P,b,Y){return new Promise(((l,a)=>{u(v,y,n,B,((v,y,n,B,J,P,b,Y)=>{l({meshes:v,Ej:y,skeletons:n,animationGroups:B,transformNodes:J,geometries:P,lights:b,spriteManagers:Y})}),J,((v,y,n)=>{a(n||new Error(y))}),P,b,Y)}))}(v,y,n,B,J,P,b)}static Load(v,y,n,B,J,P,b,Y){return O(v,y,n,B,J,P,b,Y)}static LoadAsync(v,y,n,B,J,P){return d(v,y,n,B,J,P)}static Append(v,y,n,B,J,P,b,Y){return q(v,y,n,B,J,P,b,Y)}static AppendAsync(v,y,n,B,J,P){return L(v,y,n,B,J,P)}static LoadAssetContainer(v,y,n,B,J,P,b,Y){return t(v,y,n,B,J,P,b,Y)}static LoadAssetContainerAsync(v,y,n,B,J,P){return G(v,y,n,B,J,P)}static ImportAnimations(v,y,n,B,J,P,b,Y,l,a,Z){R(v,y,n,B,J,P,b,Y,l,a,Z)}static ImportAnimationsAsync(v,y,n,B,J,P,b,Y,l,a,Z){return F(v,y,n,B,J,P,Y,a,Z)}}S.NO_LOGGING=0,S.MINIMAL_LOGGING=1,S.SUMMARY_LOGGING=2,S.DETAILED_LOGGING=3,S.OnPluginActivatedObservable=i},11374:(v,y,n)=>{"use strict";n.d(y,{c:()=>B});class B{static get ForceFullSceneLoadingForIncremental(){return B._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(v){B._ForceFullSceneLoadingForIncremental=v}static get ShowLoadingScreen(){return B._ShowLoadingScreen}static set ShowLoadingScreen(v){B._ShowLoadingScreen=v}static get loggingLevel(){return B._LoggingLevel}static set loggingLevel(v){B._LoggingLevel=v}static get CleanBoneMatrixWeights(){return B._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(v){B._CleanBoneMatrixWeights=v}}B._ForceFullSceneLoadingForIncremental=!1,B._ShowLoadingScreen=!0,B._CleanBoneMatrixWeights=!1,B._LoggingLevel=0},12291:(v,y,n)=>{"use strict";n.d(y,{b:()=>p});var B=n(11050),J=n(11055),P=n(10801),b=n(11065),Y=n(12284),l=n(11070),a=n(11081),Z=n(11127),x=n(11267),f=n(11327);class N extends x.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class i extends f.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(v,"PBRBRDF",90,new N,y),this._useEnergyConservation=i.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=i.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=i.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=i.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=v._dirtyCallbacks[16],this._enable(!0)}prepareDefines(v){v.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,v.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,v.SPHERICAL_HARMONICS=this._useSphericalHarmonics,v.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}i.DEFAULT_USE_ENERGY_CONSERVATION=!0,i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,i.DEFAULT_USE_SPHERICAL_HARMONICS=!0,i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useEnergyConservation",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSphericalHarmonics",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var g=n(11193),c=n(11103),h=n(11094),E=n(11200),W=n(11275),s=n(11281),C=n(11303),r=(n(12293),n(11311)),u=n(11256);class O extends x.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class d extends f.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(v,"PBRClearCoat",100,new O,y),this._isEnabled=!1,this.isEnabled=!1,this.mj=1,this.roughness=0,this._indexOfRefraction=d._DefaultIndexOfRefraction,this.indexOfRefraction=d._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=c.d.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1]}isReadyForSubMesh(v,y,n){if(!this._isEnabled)return!0;const B=this._material._disableBumpMap;if(v._areTexturesDirty&&y.texturesEnabled){if(this._texture&&C.b.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&C.b.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(n.getCaps().standardDerivatives&&this._bumpTexture&&C.b.ClearCoatBumpTextureEnabled&&!B&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&C.b.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(v,y){this._isEnabled?(v.CLEARCOAT=!0,v.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,v.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,v._areTexturesDirty&&y.texturesEnabled&&(this._texture&&C.b.ClearCoatTextureEnabled?(0,u.T)(this._texture,v,"CLEARCOAT_TEXTURE"):v.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&C.b.ClearCoatTextureEnabled?(0,u.T)(this._textureRoughness,v,"CLEARCOAT_TEXTURE_ROUGHNESS"):v.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&C.b.ClearCoatBumpTextureEnabled?(0,u.T)(this._bumpTexture,v,"CLEARCOAT_BUMP"):v.CLEARCOAT_BUMP=!1,v.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===d._DefaultIndexOfRefraction,this._isTintEnabled?(v.CLEARCOAT_TINT=!0,this._tintTexture&&C.b.ClearCoatTintTextureEnabled?((0,u.T)(this._tintTexture,v,"CLEARCOAT_TINT_TEXTURE"),v.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):v.CLEARCOAT_TINT_TEXTURE=!1):(v.CLEARCOAT_TINT=!1,v.CLEARCOAT_TINT_TEXTURE=!1))):(v.CLEARCOAT=!1,v.CLEARCOAT_TEXTURE=!1,v.CLEARCOAT_TEXTURE_ROUGHNESS=!1,v.CLEARCOAT_BUMP=!1,v.CLEARCOAT_TINT=!1,v.CLEARCOAT_TINT_TEXTURE=!1,v.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,v.CLEARCOAT_DEFAULTIOR=!1,v.CLEARCOAT_TEXTUREDIRECTUV=0,v.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,v.CLEARCOAT_BUMPDIRECTUV=0,v.CLEARCOAT_REMAP_F0=!1,v.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,v.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(v,y,n,B){if(!this._isEnabled)return;const J=B.materialDefines,P=this._material.isFrozen,b=this._material._disableBumpMap,Y=this._material._invertNormalMapX,l=this._material._invertNormalMapY;if(!v.useUbo||!P||!v.isSync){var a,Z,x,f;if((this._texture||this._textureRoughness)&&C.b.ClearCoatTextureEnabled)v.updateFloat4("vClearCoatInfos",(null===(a=this._texture)||void 0===a?void 0:a.coordinatesIndex)??0,(null===(Z=this._texture)||void 0===Z?void 0:Z.level)??0,(null===(x=this._textureRoughness)||void 0===x?void 0:x.coordinatesIndex)??0,(null===(f=this._textureRoughness)||void 0===f?void 0:f.level)??0),this._texture&&(0,u.w)(this._texture,v,"clearCoat"),this._textureRoughness&&!J.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,u.w)(this._textureRoughness,v,"clearCoatRoughness");this._bumpTexture&&n.getCaps().standardDerivatives&&C.b.ClearCoatTextureEnabled&&!b&&(v.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,u.w)(this._bumpTexture,v,"clearCoatBump"),y._mirroredCameraPosition?v.updateFloat2("vClearCoatTangentSpaceParams",Y?1:-1,l?1:-1):v.updateFloat2("vClearCoatTangentSpaceParams",Y?-1:1,l?-1:1)),this._tintTexture&&C.b.ClearCoatTintTextureEnabled&&(v.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,u.w)(this._tintTexture,v,"clearCoatTint")),v.updateFloat2("vClearCoatParams",this.mj,this.roughness);const B=1-this._indexOfRefraction,P=1+this._indexOfRefraction,N=Math.pow(-B/P,2),i=1/this._indexOfRefraction;v.updateFloat4("vClearCoatRefractionParams",N,i,B,P),this._isTintEnabled&&(v.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),v.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}y.texturesEnabled&&(this._texture&&C.b.ClearCoatTextureEnabled&&v.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!J.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&C.b.ClearCoatTextureEnabled&&v.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&n.getCaps().standardDerivatives&&C.b.ClearCoatBumpTextureEnabled&&!b&&v.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&C.b.ClearCoatTintTextureEnabled&&v.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(v){return this._texture===v||(this._textureRoughness===v||(this._bumpTexture===v||this._tintTexture===v))}getActiveTextures(v){this._texture&&v.push(this._texture),this._textureRoughness&&v.push(this._textureRoughness),this._bumpTexture&&v.push(this._bumpTexture),this._tintTexture&&v.push(this._tintTexture)}getAnimatables(v){this._texture&&this._texture.animations&&this._texture.animations.length>0&&v.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&v.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&v.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&v.push(this._tintTexture)}dispose(v){var y,n,B,J;v&&(null===(y=this._texture)||void 0===y||y.dispose(),null===(n=this._textureRoughness)||void 0===n||n.dispose(),null===(B=this._bumpTexture)||void 0===B||B.dispose(),null===(J=this._tintTexture)||void 0===J||J.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(v,y,n){return v.CLEARCOAT_BUMP&&y.addFallback(n++,"CLEARCOAT_BUMP"),v.CLEARCOAT_TINT&&y.addFallback(n++,"CLEARCOAT_TINT"),v.CLEARCOAT&&y.addFallback(n++,"CLEARCOAT"),n}getSamplers(v){v.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}d._DefaultIndexOfRefraction=1.5,(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"isEnabled",void 0),(0,B.c)([(0,J.M)()],d.prototype,"intensity",void 0),(0,B.c)([(0,J.M)()],d.prototype,"roughness",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"indexOfRefraction",void 0),(0,B.c)([(0,J.E)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"texture",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useRoughnessFromMainTexture",void 0),(0,B.c)([(0,J.E)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"textureRoughness",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"remapF0OnInterfaceChange",void 0),(0,B.c)([(0,J.E)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"bumpTexture",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"isTintEnabled",void 0),(0,B.c)([(0,J.j)()],d.prototype,"tintColor",void 0),(0,B.c)([(0,J.M)()],d.prototype,"tintColorAtDistance",void 0),(0,B.c)([(0,J.M)()],d.prototype,"tintThickness",void 0),(0,B.c)([(0,J.E)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"tintTexture",void 0);class q extends x.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class L extends f.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(v,"PBRIridescence",110,new q,y),this._isEnabled=!1,this.isEnabled=!1,this.mj=1,this.minimumThickness=L._DefaultMinimumThickness,this.maximumThickness=L._DefaultMaximumThickness,this.indexOfRefraction=L._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1]}isReadyForSubMesh(v,y){if(!this._isEnabled)return!0;if(v._areTexturesDirty&&y.texturesEnabled){if(this._texture&&C.b.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&C.b.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(v,y){this._isEnabled?(v.IRIDESCENCE=!0,v._areTexturesDirty&&y.texturesEnabled&&(this._texture&&C.b.IridescenceTextureEnabled?(0,u.T)(this._texture,v,"IRIDESCENCE_TEXTURE"):v.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&C.b.IridescenceTextureEnabled?(0,u.T)(this._thicknessTexture,v,"IRIDESCENCE_THICKNESS_TEXTURE"):v.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(v.IRIDESCENCE=!1,v.IRIDESCENCE_TEXTURE=!1,v.IRIDESCENCE_THICKNESS_TEXTURE=!1,v.IRIDESCENCE_TEXTUREDIRECTUV=0,v.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(v,y){if(!this._isEnabled)return;const n=this._material.isFrozen;if(!v.useUbo||!n||!v.isSync){var B,J,P,b;if((this._texture||this._thicknessTexture)&&C.b.IridescenceTextureEnabled)v.updateFloat4("vIridescenceInfos",(null===(B=this._texture)||void 0===B?void 0:B.coordinatesIndex)??0,(null===(J=this._texture)||void 0===J?void 0:J.level)??0,(null===(P=this._thicknessTexture)||void 0===P?void 0:P.coordinatesIndex)??0,(null===(b=this._thicknessTexture)||void 0===b?void 0:b.level)??0),this._texture&&(0,u.w)(this._texture,v,"iridescence"),this._thicknessTexture&&(0,u.w)(this._thicknessTexture,v,"iridescenceThickness");v.updateFloat4("vIridescenceParams",this.mj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}y.texturesEnabled&&(this._texture&&C.b.IridescenceTextureEnabled&&v.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&C.b.IridescenceTextureEnabled&&v.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(v){return this._texture===v||this._thicknessTexture===v}getActiveTextures(v){this._texture&&v.push(this._texture),this._thicknessTexture&&v.push(this._thicknessTexture)}getAnimatables(v){this._texture&&this._texture.animations&&this._texture.animations.length>0&&v.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&v.push(this._thicknessTexture)}dispose(v){var y,n;v&&(null===(y=this._texture)||void 0===y||y.dispose(),null===(n=this._thicknessTexture)||void 0===n||n.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(v,y,n){return v.IRIDESCENCE&&y.addFallback(n++,"IRIDESCENCE"),n}getSamplers(v){v.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}L._DefaultMinimumThickness=100,L._DefaultMaximumThickness=400,L._DefaultIndexOfRefraction=1.3,(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"isEnabled",void 0),(0,B.c)([(0,J.M)()],L.prototype,"intensity",void 0),(0,B.c)([(0,J.M)()],L.prototype,"minimumThickness",void 0),(0,B.c)([(0,J.M)()],L.prototype,"maximumThickness",void 0),(0,B.c)([(0,J.M)()],L.prototype,"indexOfRefraction",void 0),(0,B.c)([(0,J.E)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"texture",void 0),(0,B.c)([(0,J.E)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"thicknessTexture",void 0);class t extends x.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class G extends f.c{set angle(v){this.direction.x=Math.cos(v),this.direction.y=Math.sin(v)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(v,"PBRAnisotropic",110,new t,y),this._isEnabled=!1,this.isEnabled=!1,this.mj=1,this.direction=new a.j(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=v._dirtyCallbacks[16]}isReadyForSubMesh(v,y){return!this._isEnabled||!(v._areTexturesDirty&&y.texturesEnabled&&this._texture&&C.b.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(v,y,n){this._isEnabled?(v.ANISOTROPIC=this._isEnabled,this._isEnabled&&!n.isVerticesDataPresent(Z.i.TangentKind)&&(v._needUVs=!0,v.MAINUV1=!0),v._areTexturesDirty&&y.texturesEnabled&&(this._texture&&C.b.AnisotropicTextureEnabled?(0,u.T)(this._texture,v,"ANISOTROPIC_TEXTURE"):v.ANISOTROPIC_TEXTURE=!1),v._areMiscDirty&&(v.ANISOTROPIC_LEGACY=this._legacy)):(v.ANISOTROPIC=!1,v.ANISOTROPIC_TEXTURE=!1,v.ANISOTROPIC_TEXTUREDIRECTUV=0,v.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(v,y){if(!this._isEnabled)return;const n=this._material.isFrozen;v.useUbo&&n&&v.isSync||(this._texture&&C.b.AnisotropicTextureEnabled&&(v.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,u.w)(this._texture,v,"anisotropy")),v.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.mj)),y.texturesEnabled&&this._texture&&C.b.AnisotropicTextureEnabled&&v.setTexture("anisotropySampler",this._texture)}hasTexture(v){return this._texture===v}getActiveTextures(v){this._texture&&v.push(this._texture)}getAnimatables(v){this._texture&&this._texture.animations&&this._texture.animations.length>0&&v.push(this._texture)}dispose(v){v&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(v,y,n){return v.ANISOTROPIC&&y.addFallback(n++,"ANISOTROPIC"),n}getSamplers(v){v.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(v,y,n){super.parse(v,y,n),void 0===v.legacy&&(this.legacy=!0)}}(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"isEnabled",void 0),(0,B.c)([(0,J.M)()],G.prototype,"intensity",void 0),(0,B.c)([(0,J.H)()],G.prototype,"direction",void 0),(0,B.c)([(0,J.E)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"texture",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsMiscDirty")],G.prototype,"legacy",void 0);class R extends x.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class F extends f.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(v,"Sheen",120,new R,y),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.mj=1,this.color=c.d.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1]}isReadyForSubMesh(v,y){if(!this._isEnabled)return!0;if(v._areTexturesDirty&&y.texturesEnabled){if(this._texture&&C.b.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&C.b.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(v,y){this._isEnabled?(v.SHEEN=!0,v.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,v.SHEEN_ROUGHNESS=null!==this._roughness,v.SHEEN_ALBEDOSCALING=this._albedoScaling,v.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,v._areTexturesDirty&&y.texturesEnabled&&(this._texture&&C.b.SheenTextureEnabled?((0,u.T)(this._texture,v,"SHEEN_TEXTURE"),v.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):v.SHEEN_TEXTURE=!1,this._textureRoughness&&C.b.SheenTextureEnabled?(0,u.T)(this._textureRoughness,v,"SHEEN_TEXTURE_ROUGHNESS"):v.SHEEN_TEXTURE_ROUGHNESS=!1)):(v.SHEEN=!1,v.SHEEN_TEXTURE=!1,v.SHEEN_TEXTURE_ROUGHNESS=!1,v.SHEEN_LINKWITHALBEDO=!1,v.SHEEN_ROUGHNESS=!1,v.SHEEN_ALBEDOSCALING=!1,v.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,v.SHEEN_GAMMATEXTURE=!1,v.SHEEN_TEXTUREDIRECTUV=0,v.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(v,y,n,B){if(!this._isEnabled)return;const J=B.materialDefines,P=this._material.isFrozen;if(!v.useUbo||!P||!v.isSync){var b,Y,l,a;if((this._texture||this._textureRoughness)&&C.b.SheenTextureEnabled)v.updateFloat4("vSheenInfos",(null===(b=this._texture)||void 0===b?void 0:b.coordinatesIndex)??0,(null===(Y=this._texture)||void 0===Y?void 0:Y.level)??0,(null===(l=this._textureRoughness)||void 0===l?void 0:l.coordinatesIndex)??0,(null===(a=this._textureRoughness)||void 0===a?void 0:a.level)??0),this._texture&&(0,u.w)(this._texture,v,"sheen"),this._textureRoughness&&!J.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,u.w)(this._textureRoughness,v,"sheenRoughness");v.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.mj),null!==this._roughness&&v.updateFloat("vSheenRoughness",this._roughness)}y.texturesEnabled&&(this._texture&&C.b.SheenTextureEnabled&&v.setTexture("sheenSampler",this._texture),this._textureRoughness&&!J.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&C.b.SheenTextureEnabled&&v.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(v){return this._texture===v||this._textureRoughness===v}getActiveTextures(v){this._texture&&v.push(this._texture),this._textureRoughness&&v.push(this._textureRoughness)}getAnimatables(v){this._texture&&this._texture.animations&&this._texture.animations.length>0&&v.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&v.push(this._textureRoughness)}dispose(v){var y,n;v&&(null===(y=this._texture)||void 0===y||y.dispose(),null===(n=this._textureRoughness)||void 0===n||n.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(v,y,n){return v.SHEEN&&y.addFallback(n++,"SHEEN"),n}getSamplers(v){v.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"isEnabled",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"linkSheenWithAlbedo",void 0),(0,B.c)([(0,J.M)()],F.prototype,"intensity",void 0),(0,B.c)([(0,J.j)()],F.prototype,"color",void 0),(0,B.c)([(0,J.E)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"texture",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useRoughnessFromMainTexture",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"roughness",void 0),(0,B.c)([(0,J.E)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"textureRoughness",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"albedoScaling",void 0);class S extends x.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class w extends f.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(v){this._scene.enableSubSurfaceForPrePass()&&v&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(v))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(v){this._volumeIndexOfRefraction=v>=1?v:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(v,"PBRSubSurface",130,new S,y),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=c.d.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=c.d.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=v.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=v._dirtyCallbacks[32]}isReadyForSubMesh(v,y){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(v._areTexturesDirty&&y.texturesEnabled){if(this._thicknessTexture&&C.b.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&C.b.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&C.b.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const v=this._getRefractionTexture(y);if(v&&C.b.RefractionTextureEnabled&&!v.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(v,y){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return v.SUBSURFACE=!1,v.SS_DISPERSION=!1,v.SS_TRANSLUCENCY=!1,v.SS_SCATTERING=!1,v.SS_REFRACTION=!1,v.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,v.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,v.SS_THICKNESSANDMASK_TEXTURE=!1,v.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,v.SS_HAS_THICKNESS=!1,v.SS_REFRACTIONINTENSITY_TEXTURE=!1,v.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,v.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,v.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,v.SS_REFRACTIONMAP_3D=!1,v.SS_REFRACTIONMAP_OPPOSITEZ=!1,v.SS_LODINREFRACTIONALPHA=!1,v.SS_GAMMAREFRACTION=!1,v.SS_RGBDREFRACTION=!1,v.SS_LINEARSPECULARREFRACTION=!1,v.SS_LINKREFRACTIONTOTRANSPARENCY=!1,v.SS_ALBEDOFORREFRACTIONTINT=!1,v.SS_ALBEDOFORTRANSLUCENCYTINT=!1,v.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,v.SS_USE_THICKNESS_AS_DEPTH=!1,v.SS_USE_GLTF_TEXTURES=!1,v.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(v.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(v._areTexturesDirty){if(v.SUBSURFACE=!0,v.SS_DISPERSION=this._isDispersionEnabled,v.SS_TRANSLUCENCY=this._isTranslucencyEnabled,v.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,v.SS_SCATTERING=this._isScatteringEnabled,v.SS_THICKNESSANDMASK_TEXTURE=!1,v.SS_REFRACTIONINTENSITY_TEXTURE=!1,v.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,v.SS_HAS_THICKNESS=!1,v.SS_USE_GLTF_TEXTURES=!1,v.SS_REFRACTION=!1,v.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,v.SS_REFRACTIONMAP_3D=!1,v.SS_GAMMAREFRACTION=!1,v.SS_RGBDREFRACTION=!1,v.SS_LINEARSPECULARREFRACTION=!1,v.SS_REFRACTIONMAP_OPPOSITEZ=!1,v.SS_LODINREFRACTIONALPHA=!1,v.SS_LINKREFRACTIONTOTRANSPARENCY=!1,v.SS_ALBEDOFORREFRACTIONTINT=!1,v.SS_ALBEDOFORTRANSLUCENCYTINT=!1,v.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,v.SS_USE_THICKNESS_AS_DEPTH=!1,v.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,v._areTexturesDirty&&y.texturesEnabled&&(this._thicknessTexture&&C.b.ThicknessTextureEnabled&&(0,u.T)(this._thicknessTexture,v,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&C.b.RefractionIntensityTextureEnabled&&(0,u.T)(this._refractionIntensityTexture,v,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&C.b.TranslucencyIntensityTextureEnabled&&(0,u.T)(this._translucencyIntensityTexture,v,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&C.b.TranslucencyColorTextureEnabled&&(0,u.T)(this._translucencyColorTexture,v,"SS_TRANSLUCENCYCOLOR_TEXTURE")),v.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,v.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,v.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,v.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&y.texturesEnabled){const n=this._getRefractionTexture(y);n&&C.b.RefractionTextureEnabled&&(v.SS_REFRACTION=!0,v.SS_REFRACTIONMAP_3D=n.isCube,v.SS_GAMMAREFRACTION=n.gammaSpace,v.SS_RGBDREFRACTION=n.isRGBD,v.SS_LINEARSPECULARREFRACTION=n.linearSpecularLOD,v.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&n.isCube?!n.invertZ:n.invertZ,v.SS_LODINREFRACTIONALPHA=n.lodLevelInAlpha,v.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,v.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,v.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=n.isCube&&n.boundingBoxSize,v.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(v.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(v,y,n,B){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)v.updateFloat2("vThicknessParam",0,0);else{B.getRenderingMesh().getWorldMatrix().decompose(a.i.o[0]);const y=Math.max(Math.abs(a.i.o[0].x),Math.abs(a.i.o[0].y),Math.abs(a.i.o[0].z));v.updateFloat2("vThicknessParam",this.minimumThickness*y,(this.maximumThickness-this.minimumThickness)*y)}}bindForSubMesh(v,y,n,B){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const J=B.materialDefines,P=this._material.isFrozen,b=this._material.realTimeFiltering,Y=J.LODBASEDMICROSFURACE,l=this._getRefractionTexture(y);if(!v.useUbo||!P||!v.isSync){if(this._thicknessTexture&&C.b.ThicknessTextureEnabled&&(v.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,u.w)(this._thicknessTexture,v,"thickness")),this._refractionIntensityTexture&&C.b.RefractionIntensityTextureEnabled&&J.SS_REFRACTIONINTENSITY_TEXTURE&&(v.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,u.w)(this._refractionIntensityTexture,v,"refractionIntensity")),this._translucencyColorTexture&&C.b.TranslucencyColorTextureEnabled&&J.SS_TRANSLUCENCYCOLOR_TEXTURE&&(v.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,u.w)(this._translucencyColorTexture,v,"translucencyColor")),this._translucencyIntensityTexture&&C.b.TranslucencyIntensityTextureEnabled&&J.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(v.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,u.w)(this._translucencyIntensityTexture,v,"translucencyIntensity")),l&&C.b.RefractionTextureEnabled){v.Vj("refractionMatrix",l.getRefractionTextureMatrix());let y=1;l.isCube||l.depth&&(y=l.depth);const n=l.getSize().width,B=this.volumeIndexOfRefraction;if(v.updateFloat4("vRefractionInfos",l.level,1/B,y,this._invertRefractionY?-1:1),v.updateFloat4("vRefractionMicrosurfaceInfos",n,l.lodGenerationScale,l.lodGenerationOffset,1/this.indexOfRefraction),b&&v.updateFloat2("vRefractionFilteringInfo",n,Math.log2(n)),l.boundingBoxSize){const y=l;v.updateVector3("vRefractionPosition",y.boundingBoxPosition),v.updateVector3("vRefractionSize",y.boundingBoxSize)}}this._isScatteringEnabled&&v.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),v.updateColor3("vDiffusionDistance",this.diffusionDistance),v.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),v.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),v.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),v.updateFloat("dispersion",this.dispersion)}y.texturesEnabled&&(this._thicknessTexture&&C.b.ThicknessTextureEnabled&&v.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&C.b.RefractionIntensityTextureEnabled&&J.SS_REFRACTIONINTENSITY_TEXTURE&&v.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&C.b.TranslucencyIntensityTextureEnabled&&J.SS_TRANSLUCENCYINTENSITY_TEXTURE&&v.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&C.b.TranslucencyColorTextureEnabled&&J.SS_TRANSLUCENCYCOLOR_TEXTURE&&v.setTexture("translucencyColorSampler",this._translucencyColorTexture),l&&C.b.RefractionTextureEnabled&&(Y?v.setTexture("refractionSampler",l):(v.setTexture("refractionSampler",l._lodTextureMid||l),v.setTexture("refractionSamplerLow",l._lodTextureLow||l),v.setTexture("refractionSamplerHigh",l._lodTextureHigh||l))))}_getRefractionTexture(v){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?v.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(v){C.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&v.push(this._refractionTexture)}hasTexture(v){return this._thicknessTexture===v||(this._refractionTexture===v||(this._refractionIntensityTexture===v||(this._translucencyIntensityTexture===v||this._translucencyColorTexture===v)))}hasRenderTargetTextures(){return!!(C.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(v){this._thicknessTexture&&v.push(this._thicknessTexture),this._refractionTexture&&v.push(this._refractionTexture),this._translucencyColorTexture&&v.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&v.push(this._translucencyIntensityTexture)}getAnimatables(v){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&v.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&v.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&v.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&v.push(this._translucencyIntensityTexture)}dispose(v){v&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(v,y,n){return v.SS_SCATTERING&&y.addFallback(n++,"SS_SCATTERING"),v.SS_TRANSLUCENCY&&y.addFallback(n++,"SS_TRANSLUCENCY"),n}getSamplers(v){v.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"isRefractionEnabled",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"isTranslucencyEnabled",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"isDispersionEnabled",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markScenePrePassDirty")],w.prototype,"isScatteringEnabled",void 0),(0,B.c)([(0,J.M)()],w.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,B.c)([(0,J.M)()],w.prototype,"refractionIntensity",void 0),(0,B.c)([(0,J.M)()],w.prototype,"translucencyIntensity",void 0),(0,B.c)([(0,J.M)()],w.prototype,"useAlbedoToTintRefraction",void 0),(0,B.c)([(0,J.M)()],w.prototype,"useAlbedoToTintTranslucency",void 0),(0,B.c)([(0,J.E)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"thicknessTexture",void 0),(0,B.c)([(0,J.E)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"refractionTexture",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"indexOfRefraction",void 0),(0,B.c)([(0,J.M)()],w.prototype,"_volumeIndexOfRefraction",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"volumeIndexOfRefraction",null),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"invertRefractionY",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"linkRefractionWithTransparency",void 0),(0,B.c)([(0,J.M)()],w.prototype,"minimumThickness",void 0),(0,B.c)([(0,J.M)()],w.prototype,"maximumThickness",void 0),(0,B.c)([(0,J.M)()],w.prototype,"useThicknessAsDepth",void 0),(0,B.c)([(0,J.j)()],w.prototype,"tintColor",void 0),(0,B.c)([(0,J.M)()],w.prototype,"tintColorAtDistance",void 0),(0,B.c)([(0,J.M)()],w.prototype,"dispersion",void 0),(0,B.c)([(0,J.j)()],w.prototype,"diffusionDistance",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useMaskFromThicknessTexture",void 0),(0,B.c)([(0,J.E)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"refractionIntensityTexture",void 0),(0,B.c)([(0,J.E)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"translucencyIntensityTexture",void 0),(0,B.c)([(0,J.j)()],w.prototype,"translucencyColor",void 0),(0,B.c)([(0,J.E)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"translucencyColorTexture",void 0),(0,B.c)([(0,J.M)(),(0,J.d)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"useGltfStyleTextures",void 0);var k=n(11320),M=n(11262),I=n(11336);const j={effect:null,subMesh:null};class V extends x.d{constructor(v){super(v),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class p extends W.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(v){this._realTimeFiltering=v,this.eh(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(v){this._realTimeFilteringQuality=v,this.eh(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(v){v!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=v||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(v,y){super(v,y,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||p.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new a.p(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=p.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=c.d.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new c.d(0,0,0),this._albedoColor=new c.d(1,1,1),this._reflectivityColor=new c.d(1,1,1),this._reflectionColor=new c.d(1,1,1),this._emissiveColor=new c.d(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=p.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new b.e(16),this._globalAmbientColor=new c.d(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new i(this),this.clearCoat=new d(this),this.iridescence=new L(this),this.anisotropy=new G(this),this.sheen=new F(this),this.subSurface=new w(this),this.detailMap=new k.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),C.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,Y.c)(this.va()),this.prePassConfiguration=new g.d}get hasRenderTargetTextures(){return!!(C.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var v;return this._transparencyMode===p.PBRMATERIAL_OPAQUE||this._transparencyMode===p.PBRMATERIAL_ALPHATEST||(null===(v=this.subSurface)||void 0===v?void 0:v.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var v;return!!this._forceAlphaTest||(null===(v=this.subSurface)||void 0===v||!v.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===p.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Pe&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==p.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Pe||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(v,y,n){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const B=y._drawWrapper;if(B.effect&&this.isFrozen&&B._wasPreviouslyReady&&B._wasPreviouslyUsingInstances===n)return!0;y.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),y.materialDefines=new V(this._eventInfo.defineNames));const J=y.materialDefines;if(this._isReadyForSubMesh(y))return!0;const b=this.va(),Y=b.getEngine();if(J._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,b.texturesEnabled)){if(this._albedoTexture&&C.b.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&C.b.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&C.b.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const v=this._getReflectionTexture();if(v&&C.b.ReflectionTextureEnabled){if(!v.isReadyOrNotBlocking())return!1;var l;if(v.irradianceTexture){if(!v.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!v.sphericalPolynomial&&null!==(l=v.getInternalTexture())&&void 0!==l&&l._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&C.b.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&C.b.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(C.b.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(Y.getCaps().standardDerivatives&&this._bumpTexture&&C.b.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&C.b.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=J,this._eventInfo.subMesh=y,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(J._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;Y.getCaps().standardDerivatives||v.isVerticesDataPresent(Z.i.NormalKind)||(v.createNormals(!0),P.e.Warn("PBRMaterial: Normals have been created for the mesh: "+v.name));const a=y.effect,x=J._areLightsDisposed;let f=this._prepareEffect(v,J,this.onCompiled,this.onError,n,null,y.getRenderingMesh().hasThinInstances),N=!1;if(f)if(this._onEffectCreatedObservable&&(j.effect=f,j.subMesh=y,this._onEffectCreatedObservable.notifyObservers(j)),this.allowShaderHotSwapping&&a&&!f.isReady()){if(f=a,J.markAsUnprocessed(),N=this.isFrozen,x)return J._areLightsDisposed=!0,!1}else b.resetCachedMaterial(),y.setEffect(f,J,this._materialContext);return!(!y.effect||!y.effect.isReady())&&(J._renderId=b.getRenderId(),B._wasPreviouslyReady=!N,B._wasPreviouslyUsingInstances=!!n,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(v,y){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(v,y,P,b,Y),!y.isDirty)return null;y.markAsProcessed();const l=this.va().getEngine(),a=new r.e;let x=0;y.USESPHERICALINVERTEX&&a.addFallback(x++,"USESPHERICALINVERTEX"),y.FOG&&a.addFallback(x,"FOG"),y.SPECULARAA&&a.addFallback(x,"SPECULARAA"),y.POINTSIZE&&a.addFallback(x,"POINTSIZE"),y.LOGARITHMICDEPTH&&a.addFallback(x,"LOGARITHMICDEPTH"),y.PARALLAX&&a.addFallback(x,"PARALLAX"),y.PARALLAX_RHS&&a.addFallback(x,"PARALLAX_RHS"),y.PARALLAXOCCLUSION&&a.addFallback(x++,"PARALLAXOCCLUSION"),y.ENVIRONMENTBRDF&&a.addFallback(x++,"ENVIRONMENTBRDF"),y.TANGENT&&a.addFallback(x++,"TANGENT"),y.BUMP&&a.addFallback(x++,"BUMP"),x=(0,u.y)(y,a,this._maxSimultaneousLights,x++),y.SPECULARTERM&&a.addFallback(x++,"SPECULARTERM"),y.USESPHERICALFROMREFLECTIONMAP&&a.addFallback(x++,"USESPHERICALFROMREFLECTIONMAP"),y.USEIRRADIANCEMAP&&a.addFallback(x++,"USEIRRADIANCEMAP"),y.LIGHTMAP&&a.addFallback(x++,"LIGHTMAP"),y.NORMAL&&a.addFallback(x++,"NORMAL"),y.AMBIENT&&a.addFallback(x++,"AMBIENT"),y.EMISSIVE&&a.addFallback(x++,"EMISSIVE"),y.VERTEXCOLOR&&a.addFallback(x++,"VERTEXCOLOR"),y.MORPHTARGETS&&a.addFallback(x++,"MORPHTARGETS"),y.MULTIVIEW&&a.addFallback(0,"MULTIVIEW");const f=[Z.i.PositionKind];y.NORMAL&&f.push(Z.i.NormalKind),y.TANGENT&&f.push(Z.i.TangentKind);for(let n=1;n<=6;++n)y["UV"+n]&&f.push(`uv${1===n?"":n}`);y.VERTEXCOLOR&&f.push(Z.i.ColorKind),(0,u.D)(f,v,y,a),(0,u.H)(f,y),(0,u.K)(f,v,y),(0,u.z)(f,v,y);let N="pbr";const i=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],c=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],E=["Material","Scene","Mesh"],W={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:y.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=a,this._eventInfo.fallbackRank=x,this._eventInfo.defines=y,this._eventInfo.uniforms=i,this._eventInfo.attributes=f,this._eventInfo.samplers=c,this._eventInfo.uniformBuffersNames=E,this._eventInfo.customCode=void 0,this._eventInfo.mesh=v,this._eventInfo.indexParameters=W,this._callbackPluginEventGeneric(128,this._eventInfo),I.b.AddUniformsAndSamplers(i,c),g.d.AddUniforms(i),g.d.AddSamplers(c),(0,M.e)(i),h.e&&(h.e.PrepareUniforms(i,y),h.e.PrepareSamplers(c,y)),(0,u.gb)({uniformsNames:i,uniformBuffersNames:E,samplers:c,defines:y,maxSimultaneousLights:this._maxSimultaneousLights});const s={};this.customShaderNameResolve&&(N=this.customShaderNameResolve(N,i,E,c,y,f,s));const C=y.toString(),O=l.createEffect(N,{attributes:f,uniformsNames:i,uniformBuffersNames:E,samplers:c,defines:C,fallbacks:a,onCompiled:B,onError:J,indexParameters:W,processFinalCode:s.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:y.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([n.e(21),n.e(43)]).then(n.bind(n,13592)),Promise.all([n.e(22),n.e(44)]).then(n.bind(n,13604))]):await Promise.all([Promise.all([n.e(25),n.e(45)]).then(n.bind(n,13606)),Promise.all([n.e(27),n.e(46)]).then(n.bind(n,13624))]),this._shadersLoaded=!0}},l);return this._eventInfo.customCode=void 0,O}_prepareDefines(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const P=this.va(),b=P.getEngine();(0,u.Q)(P,v,y,!0,this._maxSimultaneousLights,this._disableLighting),y._needNormals=!0,(0,u._)(P,y);const Y=this.needAlphaBlendingForMesh(v)&&this.va().useOrderIndependentTransparency;if((0,u.fb)(P,y,this.canRenderToMRT&&!Y),(0,u.bb)(P,y,Y),I.b.PrepareDefines(b.currentRenderPassId,v,y),y.METALLICWORKFLOW=this.isMetallicWorkflow(),y._areTexturesDirty){y._needUVs=!1;for(let v=1;v<=6;++v)y["MAINUV"+v]=!1;if(P.texturesEnabled){y.ALBEDODIRECTUV=0,y.AMBIENTDIRECTUV=0,y.OPACITYDIRECTUV=0,y.EMISSIVEDIRECTUV=0,y.REFLECTIVITYDIRECTUV=0,y.MICROSURFACEMAPDIRECTUV=0,y.METALLIC_REFLECTANCEDIRECTUV=0,y.REFLECTANCEDIRECTUV=0,y.BUMPDIRECTUV=0,y.LIGHTMAPDIRECTUV=0,b.getCaps().textureLOD&&(y.LODBASEDMICROSFURACE=!0),this._albedoTexture&&C.b.DiffuseTextureEnabled?((0,u.T)(this._albedoTexture,y,"ALBEDO"),y.GAMMAALBEDO=this._albedoTexture.gammaSpace):y.ALBEDO=!1,this._ambientTexture&&C.b.AmbientTextureEnabled?((0,u.T)(this._ambientTexture,y,"AMBIENT"),y.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):y.AMBIENT=!1,this._opacityTexture&&C.b.OpacityTextureEnabled?((0,u.T)(this._opacityTexture,y,"OPACITY"),y.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):y.OPACITY=!1;const v=this._getReflectionTexture();if(v&&C.b.ReflectionTextureEnabled){switch(y.REFLECTION=!0,y.GAMMAREFLECTION=v.gammaSpace,y.RGBDREFLECTION=v.isRGBD,y.LODINREFLECTIONALPHA=v.lodLevelInAlpha,y.LINEARSPECULARREFLECTION=v.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(y.NUM_SAMPLES=""+this.realTimeFilteringQuality,b._features.needTypeSuffixInShaderConstants&&(y.NUM_SAMPLES=y.NUM_SAMPLES+"u"),y.REALTIME_FILTERING=!0):y.REALTIME_FILTERING=!1,y.INVERTCUBICMAP=v.coordinatesMode===s.b.INVCUBIC_MODE,y.REFLECTIONMAP_3D=v.isCube,y.REFLECTIONMAP_OPPOSITEZ=y.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!v.invertZ:v.invertZ,y.REFLECTIONMAP_CUBIC=!1,y.REFLECTIONMAP_EXPLICIT=!1,y.REFLECTIONMAP_PLANAR=!1,y.REFLECTIONMAP_PROJECTION=!1,y.REFLECTIONMAP_SKYBOX=!1,y.REFLECTIONMAP_SPHERICAL=!1,y.REFLECTIONMAP_EQUIRECTANGULAR=!1,y.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,y.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,v.coordinatesMode){case s.b.EXPLICIT_MODE:y.REFLECTIONMAP_EXPLICIT=!0;break;case s.b.PLANAR_MODE:y.REFLECTIONMAP_PLANAR=!0;break;case s.b.PROJECTION_MODE:y.REFLECTIONMAP_PROJECTION=!0;break;case s.b.SKYBOX_MODE:y.REFLECTIONMAP_SKYBOX=!0;break;case s.b.SPHERICAL_MODE:y.REFLECTIONMAP_SPHERICAL=!0;break;case s.b.EQUIRECTANGULAR_MODE:y.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case s.b.FIXED_EQUIRECTANGULAR_MODE:y.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case s.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:y.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case s.b.CUBIC_MODE:case s.b.INVCUBIC_MODE:default:y.REFLECTIONMAP_CUBIC=!0,y.USE_LOCAL_REFLECTIONMAP_CUBIC=!!v.boundingBoxSize}v.coordinatesMode!==s.b.SKYBOX_MODE&&(v.irradianceTexture?(y.USEIRRADIANCEMAP=!0,y.USESPHERICALFROMREFLECTIONMAP=!1):v.isCube&&(y.USESPHERICALFROMREFLECTIONMAP=!0,y.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||b.getCaps().maxVaryingVectors<=8?y.USESPHERICALINVERTEX=!1:y.USESPHERICALINVERTEX=!0))}else y.REFLECTION=!1,y.REFLECTIONMAP_3D=!1,y.REFLECTIONMAP_SPHERICAL=!1,y.REFLECTIONMAP_PLANAR=!1,y.REFLECTIONMAP_CUBIC=!1,y.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,y.REFLECTIONMAP_PROJECTION=!1,y.REFLECTIONMAP_SKYBOX=!1,y.REFLECTIONMAP_EXPLICIT=!1,y.REFLECTIONMAP_EQUIRECTANGULAR=!1,y.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,y.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,y.INVERTCUBICMAP=!1,y.USESPHERICALFROMREFLECTIONMAP=!1,y.USEIRRADIANCEMAP=!1,y.USESPHERICALINVERTEX=!1,y.REFLECTIONMAP_OPPOSITEZ=!1,y.LODINREFLECTIONALPHA=!1,y.GAMMAREFLECTION=!1,y.RGBDREFLECTION=!1,y.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&C.b.LightmapTextureEnabled?((0,u.T)(this._lightmapTexture,y,"LIGHTMAP"),y.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,y.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,y.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):y.LIGHTMAP=!1,this._emissiveTexture&&C.b.EmissiveTextureEnabled?((0,u.T)(this._emissiveTexture,y,"EMISSIVE"),y.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):y.EMISSIVE=!1,C.b.SpecularTextureEnabled?(this._metallicTexture?((0,u.T)(this._metallicTexture,y,"REFLECTIVITY"),y.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,y.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,y.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,y.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,y.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,u.T)(this._reflectivityTexture,y,"REFLECTIVITY"),y.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,y.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,y.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):y.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(y.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,u.T)(this._metallicReflectanceTexture,y,"METALLIC_REFLECTANCE"),y.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):y.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,u.T)(this._reflectanceTexture,y,"REFLECTANCE"),y.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):y.REFLECTANCE=!1):(y.METALLIC_REFLECTANCE=!1,y.REFLECTANCE=!1),this._microSurfaceTexture?(0,u.T)(this._microSurfaceTexture,y,"MICROSURFACEMAP"):y.MICROSURFACEMAP=!1):(y.REFLECTIVITY=!1,y.MICROSURFACEMAP=!1),b.getCaps().standardDerivatives&&this._bumpTexture&&C.b.BumpTextureEnabled&&!this._disableBumpMap?((0,u.T)(this._bumpTexture,y,"BUMP"),this._useParallax&&this._albedoTexture&&C.b.DiffuseTextureEnabled?(y.PARALLAX=!0,y.PARALLAX_RHS=P.useRightHandedSystem,y.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):y.PARALLAX=!1,y.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(y.BUMP=!1,y.PARALLAX=!1,y.PARALLAX_RHS=!1,y.PARALLAXOCCLUSION=!1,y.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&C.b.ReflectionTextureEnabled?(y.ENVIRONMENTBRDF=!0,y.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(y.ENVIRONMENTBRDF=!1,y.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?y.ALPHAFROMALBEDO=!0:y.ALPHAFROMALBEDO=!1}y.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===p.LIGHTFALLOFF_STANDARD?(y.USEPHYSICALLIGHTFALLOFF=!1,y.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===p.LIGHTFALLOFF_GLTF?(y.USEPHYSICALLIGHTFALLOFF=!1,y.USEGLTFLIGHTFALLOFF=!0):(y.USEPHYSICALLIGHTFALLOFF=!0,y.USEGLTFLIGHTFALLOFF=!1),y.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Ch&&this._twoSidedLighting?y.TWOSIDEDLIGHTING=!0:y.TWOSIDEDLIGHTING=!1,y.SPECULARAA=b.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(y._areTexturesDirty||y._areMiscDirty)&&(y.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,y.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,y.ALPHABLEND=this.needAlphaBlendingForMesh(v),y.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,y.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),y._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(y),y.FORCENORMALFORWARD=this._forceNormalForward,y.RADIANCEOCCLUSION=this._useRadianceOcclusion,y.HORIZONOCCLUSION=this._useHorizonOcclusion,y._areMiscDirty&&((0,u.X)(v,P,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(v)||this._forceAlphaTest,y,this._applyDecalMapAfterDetailMap),y.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!v.isVerticesDataPresent(Z.i.NormalKind),y.DEBUGMODE=this._debugMode),(0,u.N)(P,b,this,y,!!n,B,J),this._eventInfo.defines=y,this._eventInfo.mesh=v,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,u.M)(v,y,!0,!0,!0,this._transparencyMode!==p.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(v,y,n){const B={clipPlane:!1,useInstances:!1,...n};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const n=new V(this._eventInfo.defineNames),J=this._prepareEffect(v,n,void 0,void 0,B.useInstances,B.clipPlane,v.hasThinInstances);this._onEffectCreatedObservable&&(j.effect=J,j.subMesh=null,this._onEffectCreatedObservable.notifyObservers(j)),J.isReady()?y&&y(this):J.onCompileObservable.add((()=>{y&&y(this)}))})()}buildUniformLayout(){const v=this._uniformBuffer;v.addUniform("vAlbedoInfos",2),v.addUniform("vAmbientInfos",4),v.addUniform("vOpacityInfos",2),v.addUniform("vEmissiveInfos",2),v.addUniform("vLightmapInfos",2),v.addUniform("vReflectivityInfos",3),v.addUniform("vMicroSurfaceSamplerInfos",2),v.addUniform("vReflectionInfos",2),v.addUniform("vReflectionFilteringInfo",2),v.addUniform("vReflectionPosition",3),v.addUniform("vReflectionSize",3),v.addUniform("vBumpInfos",3),v.addUniform("albedoMatrix",16),v.addUniform("ambientMatrix",16),v.addUniform("opacityMatrix",16),v.addUniform("emissiveMatrix",16),v.addUniform("lightmapMatrix",16),v.addUniform("reflectivityMatrix",16),v.addUniform("microSurfaceSamplerMatrix",16),v.addUniform("bumpMatrix",16),v.addUniform("vTangentSpaceParams",2),v.addUniform("reflectionMatrix",16),v.addUniform("vReflectionColor",3),v.addUniform("vAlbedoColor",4),v.addUniform("vLightingIntensity",4),v.addUniform("vReflectionMicrosurfaceInfos",3),v.addUniform("pointSize",1),v.addUniform("vReflectivityColor",4),v.addUniform("vEmissiveColor",3),v.addUniform("vAmbientColor",3),v.addUniform("vDebugMode",2),v.addUniform("vMetallicReflectanceFactors",4),v.addUniform("vMetallicReflectanceInfos",2),v.addUniform("metallicReflectanceMatrix",16),v.addUniform("vReflectanceInfos",2),v.addUniform("reflectanceMatrix",16),v.addUniform("vSphericalL00",3),v.addUniform("vSphericalL1_1",3),v.addUniform("vSphericalL10",3),v.addUniform("vSphericalL11",3),v.addUniform("vSphericalL2_2",3),v.addUniform("vSphericalL2_1",3),v.addUniform("vSphericalL20",3),v.addUniform("vSphericalL21",3),v.addUniform("vSphericalL22",3),v.addUniform("vSphericalX",3),v.addUniform("vSphericalY",3),v.addUniform("vSphericalZ",3),v.addUniform("vSphericalXX_ZZ",3),v.addUniform("vSphericalYY_ZZ",3),v.addUniform("vSphericalZZ",3),v.addUniform("vSphericalXY",3),v.addUniform("vSphericalYZ",3),v.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(v,y,n){const B=this.va(),J=n.materialDefines;if(!J)return;const P=n.effect;if(!P)return;this._activeEffect=P,y.getMeshUniformBuffer().bindToEffect(P,"Mesh"),y.transferToEffect(v);const b=B.getEngine();this._uniformBuffer.bindToEffect(P,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,B,y,v,this.isFrozen),I.b.Bind(b.currentRenderPassId,this._activeEffect,y,v),this._eventInfo.subMesh=n,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),J.OBJECTSPACE_NORMALMAP&&(v.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const Y=this._mustRebind(B,P,n,y.visibility);(0,u.e)(y,this._activeEffect,this.prePassConfiguration);let a=null;const Z=this._uniformBuffer;if(Y){if(this.bindViewProjection(P),a=this._getReflectionTexture(),!Z.useUbo||!this.isFrozen||!Z.isSync||n._drawWrapper._forceRebindOnNextCall){var x;if(B.texturesEnabled){if(this._albedoTexture&&C.b.DiffuseTextureEnabled&&(Z.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,u.w)(this._albedoTexture,Z,"albedo")),this._ambientTexture&&C.b.AmbientTextureEnabled&&(Z.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,u.w)(this._ambientTexture,Z,"ambient")),this._opacityTexture&&C.b.OpacityTextureEnabled&&(Z.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,u.w)(this._opacityTexture,Z,"opacity")),a&&C.b.ReflectionTextureEnabled){if(Z.Vj("reflectionMatrix",a.getReflectionTextureMatrix()),Z.updateFloat2("vReflectionInfos",a.level,0),a.boundingBoxSize){const v=a;Z.updateVector3("vReflectionPosition",v.boundingBoxPosition),Z.updateVector3("vReflectionSize",v.boundingBoxSize)}if(this.realTimeFiltering){const v=a.getSize().width;Z.updateFloat2("vReflectionFilteringInfo",v,Math.log2(v))}if(!J.USEIRRADIANCEMAP){const v=a.sphericalPolynomial;if(J.USESPHERICALFROMREFLECTIONMAP&&v)if(J.SPHERICAL_HARMONICS){const y=v.preScaledHarmonics;Z.updateVector3("vSphericalL00",y.l00),Z.updateVector3("vSphericalL1_1",y.l1_1),Z.updateVector3("vSphericalL10",y.l10),Z.updateVector3("vSphericalL11",y.l11),Z.updateVector3("vSphericalL2_2",y.l2_2),Z.updateVector3("vSphericalL2_1",y.l2_1),Z.updateVector3("vSphericalL20",y.l20),Z.updateVector3("vSphericalL21",y.l21),Z.updateVector3("vSphericalL22",y.l22)}else Z.updateFloat3("vSphericalX",v.x.x,v.x.y,v.x.z),Z.updateFloat3("vSphericalY",v.y.x,v.y.y,v.y.z),Z.updateFloat3("vSphericalZ",v.z.x,v.z.y,v.z.z),Z.updateFloat3("vSphericalXX_ZZ",v.xx.x-v.zz.x,v.xx.y-v.zz.y,v.xx.z-v.zz.z),Z.updateFloat3("vSphericalYY_ZZ",v.yy.x-v.zz.x,v.yy.y-v.zz.y,v.yy.z-v.zz.z),Z.updateFloat3("vSphericalZZ",v.zz.x,v.zz.y,v.zz.z),Z.updateFloat3("vSphericalXY",v.xy.x,v.xy.y,v.xy.z),Z.updateFloat3("vSphericalYZ",v.yz.x,v.yz.y,v.yz.z),Z.updateFloat3("vSphericalZX",v.zx.x,v.zx.y,v.zx.z)}Z.updateFloat3("vReflectionMicrosurfaceInfos",a.getSize().width,a.lodGenerationScale,a.lodGenerationOffset)}this._emissiveTexture&&C.b.EmissiveTextureEnabled&&(Z.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,u.w)(this._emissiveTexture,Z,"emissive")),this._lightmapTexture&&C.b.LightmapTextureEnabled&&(Z.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,u.w)(this._lightmapTexture,Z,"lightmap")),C.b.SpecularTextureEnabled&&(this._metallicTexture?(Z.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,u.w)(this._metallicTexture,Z,"reflectivity")):this._reflectivityTexture&&(Z.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,u.w)(this._reflectivityTexture,Z,"reflectivity")),this._metallicReflectanceTexture&&(Z.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,u.w)(this._metallicReflectanceTexture,Z,"metallicReflectance")),this._reflectanceTexture&&J.REFLECTANCE&&(Z.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,u.w)(this._reflectanceTexture,Z,"reflectance")),this._microSurfaceTexture&&(Z.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,u.w)(this._microSurfaceTexture,Z,"microSurfaceSampler"))),this._bumpTexture&&b.getCaps().standardDerivatives&&C.b.BumpTextureEnabled&&!this._disableBumpMap&&(Z.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,u.w)(this._bumpTexture,Z,"bump"),B._mirroredCameraPosition?Z.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):Z.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&Z.updateFloat("pointSize",this.pointSize),J.METALLICWORKFLOW){var f;c.h.ib[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,c.h.ib[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,Z.updateColor4("vReflectivityColor",c.h.ib[0],1);const v=(null===(f=this.subSurface)||void 0===f?void 0:f._indexOfRefraction)??1.5,y=1,n=Math.pow((v-y)/(v+y),2);this._metallicReflectanceColor.scaleToRef(n*this._metallicF0Factor,c.h.ib[0]);const B=this._metallicF0Factor;Z.updateColor4("vMetallicReflectanceFactors",c.h.ib[0],B)}else Z.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);Z.updateColor3("vEmissiveColor",C.b.EmissiveTextureEnabled?this._emissiveColor:c.d.BlackReadOnly),Z.updateColor3("vReflectionColor",this._reflectionColor),!J.SS_REFRACTION&&null!==(x=this.subSurface)&&void 0!==x&&x._linkRefractionWithTransparency?Z.updateColor4("vAlbedoColor",this._albedoColor,1):Z.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*B.environmentIntensity,this._lightingInfos.w=this._specularIntensity,Z.updateVector4("vLightingIntensity",this._lightingInfos),B.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),Z.updateColor3("vAmbientColor",this._globalAmbientColor),Z.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}B.texturesEnabled&&(this._albedoTexture&&C.b.DiffuseTextureEnabled&&Z.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&C.b.AmbientTextureEnabled&&Z.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&C.b.OpacityTextureEnabled&&Z.setTexture("opacitySampler",this._opacityTexture),a&&C.b.ReflectionTextureEnabled&&(J.LODBASEDMICROSFURACE?Z.setTexture("reflectionSampler",a):(Z.setTexture("reflectionSampler",a._lodTextureMid||a),Z.setTexture("reflectionSamplerLow",a._lodTextureLow||a),Z.setTexture("reflectionSamplerHigh",a._lodTextureHigh||a)),J.USEIRRADIANCEMAP&&Z.setTexture("irradianceSampler",a.irradianceTexture)),J.ENVIRONMENTBRDF&&Z.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&C.b.EmissiveTextureEnabled&&Z.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&C.b.LightmapTextureEnabled&&Z.setTexture("lightmapSampler",this._lightmapTexture),C.b.SpecularTextureEnabled&&(this._metallicTexture?Z.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&Z.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&Z.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&J.REFLECTANCE&&Z.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&Z.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&b.getCaps().standardDerivatives&&C.b.BumpTextureEnabled&&!this._disableBumpMap&&Z.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(y)&&this.va().depthPeelingRenderer.bind(P),this._eventInfo.subMesh=n,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,M.h)(this._activeEffect,this,B),this.bindEyePosition(P)}else B.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(Y||!this.isFrozen){var N;if(B.lightsEnabled&&!this._disableLighting&&(0,u.j)(B,y,this._activeEffect,J,this._maxSimultaneousLights),(B.fogEnabled&&y.applyFog&&B.fogMode!==l.e.FOGMODE_NONE||a||this.subSurface.refractionTexture||y.receiveShadows||J.PREPASS)&&this.bindView(P),(0,u.h)(B,y,this._activeEffect,!0),J.NUM_MORPH_INFLUENCERS&&(0,u.q)(y,this._activeEffect),J.BAKED_VERTEX_ANIMATION_TEXTURE)null===(N=y.bakedVertexAnimationManager)||void 0===N||N.bind(P,J.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,u.m)(J,this._activeEffect,B)}this._afterBind(y,this._activeEffect,n),Z.update()}getAnimatables(){const v=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&v.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&v.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&v.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&v.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&v.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?v.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&v.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&v.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&v.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&v.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&v.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&v.push(this._microSurfaceTexture),v}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const v=super.getActiveTextures();return this._albedoTexture&&v.push(this._albedoTexture),this._ambientTexture&&v.push(this._ambientTexture),this._opacityTexture&&v.push(this._opacityTexture),this._reflectionTexture&&v.push(this._reflectionTexture),this._emissiveTexture&&v.push(this._emissiveTexture),this._reflectivityTexture&&v.push(this._reflectivityTexture),this._metallicTexture&&v.push(this._metallicTexture),this._metallicReflectanceTexture&&v.push(this._metallicReflectanceTexture),this._reflectanceTexture&&v.push(this._reflectanceTexture),this._microSurfaceTexture&&v.push(this._microSurfaceTexture),this._bumpTexture&&v.push(this._bumpTexture),this._lightmapTexture&&v.push(this._lightmapTexture),v}hasTexture(v){return!!super.hasTexture(v)||(this._albedoTexture===v||(this._ambientTexture===v||(this._opacityTexture===v||(this._reflectionTexture===v||(this._emissiveTexture===v||(this._reflectivityTexture===v||(this._metallicTexture===v||(this._metallicReflectanceTexture===v||(this._reflectanceTexture===v||(this._microSurfaceTexture===v||(this._bumpTexture===v||this._lightmapTexture===v)))))))))))}setPrePassRenderer(){var v;if(null===(v=this.subSurface)||void 0===v||!v.isScatteringEnabled)return!1;const y=this.va().enableSubSurfaceForPrePass();return y&&(y.enabled=!0),!0}dispose(v,y){var n,B,J,P,b,Y,l,a,Z,x,f,N;(this._breakShaderLoadedCheck=!0,y)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(n=this._albedoTexture)||void 0===n||n.dispose(),null===(B=this._ambientTexture)||void 0===B||B.dispose(),null===(J=this._opacityTexture)||void 0===J||J.dispose(),null===(P=this._reflectionTexture)||void 0===P||P.dispose(),null===(b=this._emissiveTexture)||void 0===b||b.dispose(),null===(Y=this._metallicTexture)||void 0===Y||Y.dispose(),null===(l=this._reflectivityTexture)||void 0===l||l.dispose(),null===(a=this._bumpTexture)||void 0===a||a.dispose(),null===(Z=this._lightmapTexture)||void 0===Z||Z.dispose(),null===(x=this._metallicReflectanceTexture)||void 0===x||x.dispose(),null===(f=this._reflectanceTexture)||void 0===f||f.dispose(),null===(N=this._microSurfaceTexture)||void 0===N||N.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(v,y)}}p.PBRMATERIAL_OPAQUE=E.d.MATERIAL_OPAQUE,p.PBRMATERIAL_ALPHATEST=E.d.MATERIAL_ALPHATEST,p.PBRMATERIAL_ALPHABLEND=E.d.MATERIAL_ALPHABLEND,p.PBRMATERIAL_ALPHATESTANDBLEND=E.d.MATERIAL_ALPHATESTANDBLEND,p.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,p.LIGHTFALLOFF_PHYSICAL=0,p.LIGHTFALLOFF_GLTF=1,p.LIGHTFALLOFF_STANDARD=2,p.ForceGLSL=!1,(0,B.c)([(0,J.q)()],p.prototype,"_imageProcessingConfiguration",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsMiscDirty")],p.prototype,"debugMode",void 0)},10894:(v,y,n)=>{"use strict";n.d(y,{c:()=>b});var B=n(10801);const J=new Map;function P(v,y){(function(v){return J.delete(v)})(v)&&B.e.Warn(`Extension with the name '${name}' already exists`),J.set(v,y)}function b(v,y){"image/ktx"!==y&&"image/ktx2"!==y||(v=".ktx"),J.has(v)||(v.endsWith(".dds")&&P(".dds",(()=>n.e(12).then(n.bind(n,13025)).then((v=>new v._DDSTextureLoader)))),v.endsWith(".basis")&&P(".basis",(()=>n.e(13).then(n.bind(n,13033)).then((v=>new v._BasisTextureLoader)))),v.endsWith(".env")&&P(".env",(()=>n.e(14).then(n.bind(n,13038)).then((v=>new v._ENVTextureLoader)))),v.endsWith(".hdr")&&P(".hdr",(()=>n.e(15).then(n.bind(n,13043)).then((v=>new v._HDRTextureLoader)))),(v.endsWith(".ktx")||v.endsWith(".ktx2"))&&(P(".ktx",(()=>n.e(16).then(n.bind(n,13050)).then((v=>new v._KTXTextureLoader)))),P(".ktx2",(()=>n.e(16).then(n.bind(n,13050)).then((v=>new v._KTXTextureLoader))))),v.endsWith(".tga")&&P(".tga",(()=>n.e(17).then(n.bind(n,13057)).then((v=>new v._TGATextureLoader)))),v.endsWith(".exr")&&P(".exr",(()=>n.e(18).then(n.bind(n,13064)).then((v=>new v._ExrTextureLoader)))));const B=J.get(v);return B?Promise.resolve(B(y)):null}},11283:(v,y,n)=>{"use strict";n.d(y,{b:()=>f});var B=n(11050),J=n(11055),P=n(10795),b=n(11081),Y=n(10820),l=n(10911),a=(n(10828),n(11289));class Z{get wrapU(){return this._wrapU}set wrapU(v){this._wrapU=v}get wrapV(){return this._wrapV}set wrapV(v){this._wrapV=v}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(v){this._texture&&(this._texture.isCube=v)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(v){this._texture&&(this._texture.is3D=v)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(v){this._texture&&(this._texture.is2DArray=v)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(v){return void 0!==(null===v||void 0===v?void 0:v.shareDepth)}constructor(v){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=a.c.Zero(),this._cachedBaseSize=a.c.Zero(),this._initialSamplingMode=2,this._texture=Z._IsRenderTargetWrapper(v)?v.texture:v,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(v){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(v,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var x=n(11110);class f extends Z{set Pe(v){this._hasAlpha!==v&&(this._hasAlpha=v,this._scene&&this._scene.markAllMaterialsAsDirty(1,(v=>v.hasTexture(this))))}get Pe(){return this._hasAlpha}set getAlphaFromRGB(v){this._getAlphaFromRGB!==v&&(this._getAlphaFromRGB=v,this._scene&&this._scene.markAllMaterialsAsDirty(1,(v=>v.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(v){this._coordinatesIndex!==v&&(this._coordinatesIndex=v,this._scene&&this._scene.markAllMaterialsAsDirty(1,(v=>v.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(v){this._coordinatesMode!==v&&(this._coordinatesMode=v,this._scene&&this._scene.markAllMaterialsAsDirty(1,(v=>v.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(v){this._wrapU=v}get wrapV(){return this._wrapV}set wrapV(v){this._wrapV=v}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(v){this._texture?this._texture.isCube=v:this._isCube=v}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(v){this._texture&&(this._texture.is3D=v)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(v){this._texture&&(this._texture.is2DArray=v)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(v){var y;if(this._texture){if(this._texture._gammaSpace===v)return;this._texture._gammaSpace=v}else{if(this._gammaSpace===v)return;this._gammaSpace=v}null===(y=this.va())||void 0===y||y.markAllMaterialsAsDirty(1,(v=>v.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(v){var y;v!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=v),null===(y=this.va())||void 0===y||y.markAllMaterialsAsDirty(1,(v=>v.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(v){this._texture&&(this._texture._lodGenerationOffset=v)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(v){this._texture&&(this._texture._lodGenerationScale=v)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(v){this._texture&&(this._texture._linearSpecularLOD=v)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(v){this._texture&&(this._texture._irradianceTexture=v)}get uid(){return this._uid||(this._uid=(0,l.b)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(v){this._onDisposeObserver&&this.xj.remove(this._onDisposeObserver),this._onDisposeObserver=this.xj.add(v)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=f.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.xj=new P.e,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,v?f._IsScene(v)?this._scene=v:this._engine=v:this._scene=Y.b.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=y,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return b.d.IdentityReadOnly}getReflectionTextureMatrix(){return b.d.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(v){}get canRescale(){return!1}_getFromCache(v,y,n,B,J,P){const b=this._getEngine();if(!b)return null;const Y=b._getUseSRGBBuffer(!!J,y),l=b.getLoadedTexturesCache();for(let a=0;a<l.length;a++){const b=l[a];if((void 0===J||Y===b._useSRGBBuffer)&&(void 0===B||B===b.invertY)&&b.url===v&&b.generateMipMaps===!y&&(!n||n===b.samplingMode)&&(void 0===P||P===b.isCube))return b.incrementReferences(),b}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const v=this.va();v&&v.markAllMaterialsAsDirty(1)}readPixels(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],J=arguments.length>4&&void 0!==arguments[4]&&arguments[4],P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const a=this._getEngine();if(!a)return null;const Z=this.getSize();let x=Z.width,f=Z.height;0!==y&&(x/=Math.pow(2,y),f/=Math.pow(2,y),x=Math.round(x),f=Math.round(f)),Y=Math.min(x,Y),l=Math.min(f,l);try{return this._texture.isCube?a._readTexturePixels(this._texture,Y,l,v,y,n,B,J,P,b):a._readTexturePixels(this._texture,Y,l,-1,y,n,B,J,P,b)}catch(N){return null}}_readPixelsSync(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],J=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const P=this.getSize();let b=P.width,Y=P.height;const l=this._getEngine();if(!l)return null;0!=y&&(b/=Math.pow(2,y),Y/=Math.pow(2,y),b=Math.round(b),Y=Math.round(Y));try{return this._texture.isCube?l._readTexturePixelsSync(this._texture,b,Y,v,y,n,B,J):l._readTexturePixelsSync(this._texture,b,Y,-1,y,n,B,J)}catch(a){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const v=this._scene.textures.indexOf(this);if(v>=0&&this._scene.textures.splice(v,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const v=this._parentContainer.textures.indexOf(this);v>-1&&this._parentContainer.textures.splice(v,1),this._parentContainer=null}}this.xj.notifyObservers(this),this.xj.clear(),this.metadata=null,super.dispose()}serialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!v)return null;const y=x.d.Serialize(this);return x.d.AppendSerializedAnimations(this,y),y}static WhenAllReady(v,y){let n=v.length;if(0!==n)for(let B=0;B<v.length;B++){const J=v[B];if(J.isReady())0===--n&&y();else{const v=J.onLoadObservable;v?v.addOnce((()=>{0===--n&&y()})):0===--n&&y()}}else y()}static _IsScene(v){return"Scene"===v.getClassName()}}f.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,B.c)([(0,J.M)()],f.prototype,"uniqueId",void 0),(0,B.c)([(0,J.M)()],f.prototype,"name",void 0),(0,B.c)([(0,J.M)()],f.prototype,"metadata",void 0),(0,B.c)([(0,J.M)("Pe")],f.prototype,"_hasAlpha",void 0),(0,B.c)([(0,J.M)("getAlphaFromRGB")],f.prototype,"_getAlphaFromRGB",void 0),(0,B.c)([(0,J.M)()],f.prototype,"level",void 0),(0,B.c)([(0,J.M)("coordinatesIndex")],f.prototype,"_coordinatesIndex",void 0),(0,B.c)([(0,J.M)()],f.prototype,"optimizeUVAllocation",void 0),(0,B.c)([(0,J.M)("coordinatesMode")],f.prototype,"_coordinatesMode",void 0),(0,B.c)([(0,J.M)()],f.prototype,"wrapU",null),(0,B.c)([(0,J.M)()],f.prototype,"wrapV",null),(0,B.c)([(0,J.M)()],f.prototype,"wrapR",void 0),(0,B.c)([(0,J.M)()],f.prototype,"anisotropicFilteringLevel",void 0),(0,B.c)([(0,J.M)()],f.prototype,"isCube",null),(0,B.c)([(0,J.M)()],f.prototype,"is3D",null),(0,B.c)([(0,J.M)()],f.prototype,"is2DArray",null),(0,B.c)([(0,J.M)()],f.prototype,"gammaSpace",null),(0,B.c)([(0,J.M)()],f.prototype,"invertZ",void 0),(0,B.c)([(0,J.M)()],f.prototype,"lodLevelInAlpha",void 0),(0,B.c)([(0,J.M)()],f.prototype,"lodGenerationOffset",null),(0,B.c)([(0,J.M)()],f.prototype,"lodGenerationScale",null),(0,B.c)([(0,J.M)()],f.prototype,"linearSpecularLOD",null),(0,B.c)([(0,J.E)()],f.prototype,"irradianceTexture",null),(0,B.c)([(0,J.M)()],f.prototype,"isRenderTarget",void 0)},12293:(v,y,n)=>{"use strict";var B=n(11585),J=n(11283);J.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(J.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=B.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((v=>{this._texture._sphericalPolynomial=v,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(v){this._texture&&(this._texture._sphericalPolynomial=v)},enumerable:!0,configurable:!0})},12330:(v,y,n)=>{"use strict";n.d(y,{c:()=>f});var B=n(11050),J=n(11055),P=n(10791),b=n(11081),Y=n(11283),l=n(11281),a=n(10908),Z=n(10795),x=n(11110);n(11624);class f extends Y.b{set boundingBoxSize(v){if(this._boundingBoxSize&&this._boundingBoxSize.equals(v))return;this._boundingBoxSize=v;const y=this.va();y&&y.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(v){this._rotationY=v,this.setReflectionTextureMatrix(b.d.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(v,y,n){let B="";return v.forEach((v=>B+=v)),new f(B,y,null,n,v)}static CreateFromPrefilteredData(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const J=y.useDelayedTextureLoading;y.useDelayedTextureLoading=!1;const P=new f(v,y,null,!1,null,null,null,void 0,!0,n,B);return y.useDelayedTextureLoading=J,P}constructor(v,y){var n;let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,f=arguments.length>8&&void 0!==arguments[8]&&arguments[8],N=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,i=arguments.length>10&&void 0!==arguments[10]&&arguments[10],g=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,h=arguments.length>13?arguments[13]:void 0,E=arguments.length>14?arguments[14]:void 0;super(y),this.onLoadObservable=new Z.e,this.boundingBoxPosition=b.n.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new b.d,this._buffer=null,this.name=v,this.url=v,this._noMipmap=J,this.Pe=!1,this.isCube=!0,this._textureMatrix=b.d.Identity(),this.coordinatesMode=l.b.CUBIC_MODE;let W=null,s=null;null===B||Array.isArray(B)?(this._noMipmap=J,this._format=x,this._createPolynomials=i,W=B,this._loaderOptions=h,this._useSRGBBuffer=E,this._lodScale=g,this._lodOffset=c):(W=B.extensions??null,this._noMipmap=B.noMipmap??!1,P=B.files??null,s=B.buffer??null,this._format=B.format??5,f=B.prefiltered??!1,N=B.forcedExtension??null,this._createPolynomials=B.createPolynomials??!1,this._lodScale=B.lodScale??.8,this._lodOffset=B.lodOffset??0,this._loaderOptions=B.loaderOptions,this._useSRGBBuffer=B.useSRGBBuffer,Y=B.X??null,a=B.onError??null),(v||P)&&this.updateURL(v,N,Y,f,a,W,null===(n=this.va())||void 0===n?void 0:n.useDelayedTextureLoading,P,s)}getClassName(){return"CubeTexture"}updateURL(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=v),this.url=v,y&&(this._forcedExtension=y);const a=v.lastIndexOf("."),Z=y||(a>-1?v.substring(a).toLowerCase():""),x=0===Z.indexOf(".dds"),f=0===Z.indexOf(".env"),N=0===Z.indexOf(".basis");if(f?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=B,B&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),Y)this._files=Y;else if(N||f||x||P||(P=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,P){for(let y=0;y<P.length;y++)this._files.push(v+P[y]);this._extensions=P}this._buffer=l,b?(this.delayLoadState=4,this._delayedOnLoad=n,this._delayedOnError=J):this._loadTexture(n,J)}delayLoad(v){4===this.delayLoadState&&(v&&(this._forcedExtension=v),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(v){var y,n;if(v.updateFlag===this._textureMatrix.updateFlag)return;v.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(n=this.va())||void 0===n||n.markAllMaterialsAsDirty(1,(v=>-1!==v.getActiveTextures().indexOf(this))));if(this._textureMatrix=v,null===(y=this.va())||void 0===y||!y.useRightHandedSystem)return;const B=b.i.o[0],J=b.i.Quaternion[0],P=b.i.o[1];this._textureMatrix.decompose(B,J,P),J.z*=-1,J.w*=-1,b.d.ComposeToRef(B,J,P,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var v;return null!==(v=this.va())&&void 0!==v&&v.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.va(),B=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const J=()=>{var y;(this.onLoadObservable.notifyObservers(this),B)&&(B.dispose(),null===(y=this.va())||void 0===y||y.markAllMaterialsAsDirty(1));v&&v()},b=(v,n)=>{this._loadingError=!0,this._errorObject={message:v,exception:n},y&&y(v,n),l.b.OnTextureLoadErrorObservable.notifyObservers(this)};var Y;this._texture?this._texture.isReady?P.g.SetImmediate((()=>J())):this._texture.onLoadedObservable.add((()=>J())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,n,this._lodScale,this._lodOffset,v,b,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,n,this._files,this._noMipmap,v,b,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(Y=this._texture)||void 0===Y||Y.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(v,y,n){const B=x.d.Parse((()=>{let B=!1;return v.prefiltered&&(B=v.prefiltered),new f(n+(v.url??v.name),y,v.extensions,!1,v.files||null,null,null,void 0,B,v.forcedExtension)}),v,y);if(v.boundingBoxPosition&&(B.boundingBoxPosition=b.n.qh(v.boundingBoxPosition)),v.boundingBoxSize&&(B.boundingBoxSize=b.n.qh(v.boundingBoxSize)),v.animations)for(let J=0;J<v.animations.length;J++){const y=v.animations[J],n=(0,a.d)("BABYLON.Animation");n&&B.animations.push(n.Parse(y))}return B}clone(){let v=0;const y=x.d.Clone((()=>{const y=new f(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return v=y.uniqueId,y}),this);return y.uniqueId=v,y}}(0,B.c)([(0,J.M)()],f.prototype,"url",void 0),(0,B.c)([(0,J.I)()],f.prototype,"boundingBoxPosition",void 0),(0,B.c)([(0,J.I)()],f.prototype,"boundingBoxSize",null),(0,B.c)([(0,J.M)("rotationY")],f.prototype,"rotationY",null),(0,B.c)([(0,J.M)("files")],f.prototype,"_files",void 0),(0,B.c)([(0,J.M)("forcedExtension")],f.prototype,"_forcedExtension",void 0),(0,B.c)([(0,J.M)("extensions")],f.prototype,"_extensions",void 0),(0,B.c)([(0,J.t)("textureMatrix")],f.prototype,"_textureMatrix",void 0),(0,B.c)([(0,J.t)("textureMatrixRefraction")],f.prototype,"_textureMatrixRefraction",void 0),l.b._CubeTextureParser=f.Parse,(0,a.g)("BABYLON.CubeTexture",f)},12776:(v,y,n)=>{"use strict";n.d(y,{b:()=>l});var B=n(10801),J=n(11281),P=n(10914),b=n(11503),Y=n(10885);b.ThinEngine.prototype.createDynamicTexture=function(v,y,n,B){const J=new Y.b(this,4);return J.baseWidth=v,J.baseHeight=y,n&&(v=this.needPOTTextures?(0,P.g)(v,this._caps.maxTextureSize):v,y=this.needPOTTextures?(0,P.g)(y,this._caps.maxTextureSize):y),J.width=v,J.height=y,J.isReady=!1,J.generateMipMaps=n,J.samplingMode=B,this.updateTextureSamplingMode(B,J),this._internalTexturesCache.push(J),J},b.ThinEngine.prototype.updateDynamicTexture=function(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!v)return;const b=this._gl,Y=b.TEXTURE_2D,l=this._bindTextureDirectly(Y,v,!0,P);this._unpackFlipY(void 0===n?v.invertY:n),B&&b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const a=this._getWebGLTextureType(v.type),Z=this._getInternalFormat(J||v.format),x=this._getRGBABufferInternalSizedFormat(v.type,Z);b.texImage2D(Y,0,x,Z,a,y),v.generateMipMaps&&b.generateMipmap(Y),l||this._bindTextureDirectly(Y,null),B&&b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),J&&(v.format=J),v._dynamicTextureSource=y,v._premulAlpha=B,v.invertY=n||!1,v.isReady=!0};class l extends J.b{constructor(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,Y=arguments.length>6?arguments[6]:void 0;const l=!n||n._isScene;super(null,l?n:null===n||void 0===n?void 0:n.$d,l?!B:n,Y,P,void 0,void 0,void 0,void 0,b),this.name=v,this.wrapU=J.b.CLAMP_ADDRESSMODE,this.wrapV=J.b.CLAMP_ADDRESSMODE,this._generateMipMaps=B;const a=this._getEngine();if(!a)return;if(y.getContext)this._canvas=y,this._ownCanvas=!1,this._texture=a.createDynamicTexture(this._canvas.width,this._canvas.height,B,P);else{this._canvas=a.createCanvas(1,1),this._ownCanvas=!0;const v=y;v.width||0===v.width?this._texture=a.createDynamicTexture(v.width,v.height,B,P):this._texture=a.createDynamicTexture(y,y,B,P)}const Z=this.getSize();this._canvas.width!==Z.width&&(this._canvas.width=Z.width),this._canvas.height!==Z.height&&(this._canvas.height=Z.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(v){this._canvas.width=v.width,this._canvas.height=v.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(v.width,v.height,this._generateMipMaps,this.samplingMode)}scale(v){const y=this.getSize();y.width*=v,y.height*=v,this._recreate(y)}scaleTo(v,y){const n=this.getSize();n.width=v,n.height=y,this._recreate(n)}getContext(){return this._context}clear(v){const y=this.getSize();v&&(this._context.fillStyle=v),this._context.clearRect(0,0,y.width,y.height)}update(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===v||v,y,this._format||void 0,void 0,n)}drawText(v,y,n,B,J,P,b){let Y=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const l=this.getSize();if(P&&(this._context.fillStyle=P,this._context.fillRect(0,0,l.width,l.height)),this._context.font=B,null===y||void 0===y){const n=this._context.measureText(v);y=(l.width-n.width)/2}if(null===n||void 0===n){const v=parseInt(B.replace(/\D/g,""));n=l.height/2+v/3.65}this._context.fillStyle=J||"",this._context.fillText(v,y,n),Y&&this.update(b)}dispose(){var v,y;(super.dispose(),this._ownCanvas)&&(null===(v=this._canvas)||void 0===v||null===(y=v.remove)||void 0===y||y.call(v));this._canvas=null,this._context=null}clone(){const v=this.va();if(!v)return this;const y=this.getSize(),n=new l(this.name,y,v,this._generateMipMaps);return n.Pe=this.Pe,n.level=this.level,n.wrapU=this.wrapU,n.wrapV=this.wrapV,n}serialize(){const v=this.va();v&&!v.isReady()&&B.e.Warn("The scene must be ready before serializing the dynamic texture");const y=super.serialize();return l._IsCanvasElement(this._canvas)&&(y.base64String=this._canvas.toDataURL()),y.invertY=this._invertY,y.samplingMode=this.samplingMode,y}static _IsCanvasElement(v){return void 0!==v.toDataURL}_rebuild(){this.update()}}},10885:(v,y,n)=>{"use strict";n.d(y,{b:()=>b});var B,J=n(10795),P=n(10891);!function(v){v[v.Unknown=0]="Unknown",v[v.Url=1]="Url",v[v.Temp=2]="Temp",v[v.Raw=3]="Raw",v[v.Dynamic=4]="Dynamic",v[v.RenderTarget=5]="RenderTarget",v[v.MultiRenderTarget=6]="MultiRenderTarget",v[v.Cube=7]="Cube",v[v.CubeRaw=8]="CubeRaw",v[v.CubePrefiltered=9]="CubePrefiltered",v[v.Raw3D=10]="Raw3D",v[v.Raw2DArray=11]="Raw2DArray",v[v.DepthStencil=12]="DepthStencil",v[v.CubeRawRGBD=13]="CubeRawRGBD",v[v.Depth=14]="Depth"}(B||(B={}));class b extends P.e{get useMipMaps(){return this.generateMipMaps}set useMipMaps(v){this.generateMipMaps=v}get uniqueId(){return this._uniqueId}_setUniqueId(v){this._uniqueId=v}getEngine(){return this._engine}get source(){return this._source}constructor(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new J.e,this.onErrorObservable=new J.e,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=v,this._source=y,this._uniqueId=b._Counter++,n||(this._hardwareTexture=v._createHardwareTexture())}incrementReferences(){this._references++}updateSize(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,v,y,n),this.width=v,this.height=y,this.depth=n,this.baseWidth=v,this.baseHeight=y,this.baseDepth=n,this._size=v*y*n}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const v=this.onRebuildCallback(this),y=y=>{y._swapAndDie(this,!1),this.isReady=v.isReady};return void(v.isAsync?v.proxy.then(y):y(v.proxy))}let v;switch(this.source){case 2:case 12:case 14:break;case 1:return void(v=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(v=>{v._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:v=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),v._swapAndDie(this,!1),this.isReady=!0;break;case 10:v=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),v._swapAndDie(this,!1),this.isReady=!0;break;case 11:v=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),v._swapAndDie(this,!1),this.isReady=!0;break;case 4:v=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),v._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(v=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{v._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:v=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),v._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return v=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(v=>{v&&v._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(v._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(v){var y;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(y=this._hardwareTexture)||void 0===y||y.setUsage(v._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),v._hardwareTexture=this._hardwareTexture,n&&(v._isRGBD=this._isRGBD),this._lodTextureHigh&&(v._lodTextureHigh&&v._lodTextureHigh.dispose(),v._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(v._lodTextureMid&&v._lodTextureMid.dispose(),v._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(v._lodTextureLow&&v._lodTextureLow.dispose(),v._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(v._irradianceTexture&&v._irradianceTexture.dispose(),v._irradianceTexture=this._irradianceTexture);const B=this._engine.getLoadedTexturesCache();let J=B.indexOf(this);-1!==J&&B.splice(J,1),J=B.indexOf(v),-1===J&&B.push(v)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}b._Counter=0},11523:(v,y,n)=>{"use strict";n.d(y,{e:()=>J});var B=n(11281);class J extends B.b{constructor(v,y,n,J,P){let b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Z=arguments.length>9?arguments[9]:void 0,x=arguments.length>10?arguments[10]:void 0;super(null,P,!b,Y,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Z),this.format=J,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==a||(l=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==a||(l=1),this._texture=this._engine.createRawTexture(v,y,n,J,b,Y,l,null,a,Z??0,x??!1),this.wrapU=B.b.CLAMP_ADDRESSMODE,this.wrapV=B.b.CLAMP_ADDRESSMODE)}update(v){this._getEngine().updateRawTexture(this._texture,v,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const v=new J(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return v._texture=this._texture,this._texture.incrementReferences(),v}static CreateLuminanceTexture(v,y,n,B){return new J(v,y,n,1,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(v,y,n,B){return new J(v,y,n,2,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(v,y,n,B){return new J(v,y,n,0,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(v,y,n,B){return new J(v,y,n,4,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(v,y,n,B){return new J(v,y,n,5,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(v,y,n,B){return new J(v,y,n,5,B,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(v,y,n,P){let b=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:B.b.TRILINEAR_SAMPLINGMODE;return new J(v,y,n,6,P,b,Y,l,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(v,y,n,P){let b=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:B.b.TRILINEAR_SAMPLINGMODE;return new J(v,y,n,6,P,b,Y,l,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11919:(v,y,n)=>{"use strict";n.d(y,{c:()=>J});var B=n(11281);class J extends B.b{get depth(){return this._depth}constructor(v,y,n,J,P,b){let Y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:B.b.TRILINEAR_SAMPLINGMODE,Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,x=arguments.length>10?arguments[10]:void 0;super(null,b,!Y,l),this.format=P,this._texture=b.getEngine().createRawTexture2DArray(v,y,n,J,P,Y,l,a,null,Z,x),this._depth=J,this.is2DArray=!0}update(v){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,v,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(v,y,n,B,P){return new J(v,y,n,B,5,P,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11602:(v,y,n)=>{"use strict";n.d(y,{e:()=>f});var B=n(10795),J=n(11081),P=n(11281),b=n(11133),Y=n(11142),l=n(11088),a=n(10914),Z=n(10857),x=n(10801);Z.b.prototype.setDepthStencilTexture=function(v,y){this._engine.setDepthStencilTexture(this._samplers[v],this._uniforms[v],y,v)};class f extends P.b{get renderList(){return this._renderList}set renderList(v){this._renderList!==v&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),v&&(this._unObserveRenderList=(0,l.g)(v,this._renderListHasChanged)),this._renderList=v)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(v){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(v)}set onBeforeRender(v){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(v)}set onAfterRender(v){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(v)}set onClear(v){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(v)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(v,y){let n;n=Array.isArray(v)?v:[v];for(let B=0;B<n.length;++B)for(let v=0;v<this._renderPassIds.length;++v)n[B].setMaterialForRenderPass(this._renderPassIds[v],void 0!==y?Array.isArray(y)?y[v]:y:void 0)}get isMulti(){var v;return(null===(v=this._renderTarget)||void 0===v?void 0:v.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(v){if(this._boundingBoxSize&&this._boundingBoxSize.equals(v))return;this._boundingBoxSize=v;const y=this.va();y&&y.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var v;return(null===(v=this._renderTarget)||void 0===v?void 0:v._depthStencilTexture)??null}constructor(v,y,n){let b,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,x=arguments.length>6&&void 0!==arguments[6]&&arguments[6],f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:P.b.TRILINEAR_SAMPLINGMODE,N=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],i=arguments.length>9&&void 0!==arguments[9]&&arguments[9],g=arguments.length>10&&void 0!==arguments[10]&&arguments[10],c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,h=arguments.length>12&&void 0!==arguments[12]&&arguments[12],E=arguments.length>13?arguments[13]:void 0,W=arguments.length>14?arguments[14]:void 0,s=arguments.length>15&&void 0!==arguments[15]&&arguments[15],C=arguments.length>16&&void 0!==arguments[16]&&arguments[16],r=!0;if("object"===typeof l){const v=l;l=!!v.generateMipMaps,a=v.doNotChangeAspectRatio??!0,Z=v.type??0,x=!!v.isCube,f=v.samplingMode??P.b.TRILINEAR_SAMPLINGMODE,N=v.generateDepthBuffer??!0,i=!!v.generateStencilBuffer,g=!!v.isMulti,c=v.format??5,h=!!v.delayAllocation,E=v.samples,W=v.creationFlags,s=!!v.noColorAttachment,C=!!v.useSRGBBuffer,b=v.colorAttachment,r=v.gammaSpace??r}if(super(null,n,!l,void 0,f,void 0,void 0,void 0,void 0,c),this._unObserveRenderList=null,this._renderListHasChanged=(v,y)=>{const n=this._renderList?this._renderList.length:0;var B;(0===y&&n>0||0===n)&&(null===(B=this.va())||void 0===B||B.meshes.forEach((v=>{v._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new B.e,this.onAfterUnbindObservable=new B.e,this.onBeforeRenderObservable=new B.e,this.onAfterRenderObservable=new B.e,this.onClearObservable=new B.e,this.onResizeObservable=new B.e,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=J.n.Zero(),this._dumpToolsLoading=!1,!(n=this.va()))return;const u=this.va().getEngine();this._gammaSpace=r,this._coordinatesMode=P.b.PROJECTION_MODE,this.renderList=[],this.name=v,this.isRenderTarget=!0,this._initialSizeParameter=y,this._renderPassIds=[],this._isCubeData=x,this._processSizeParameter(y),this.renderPassId=this._renderPassIds[0],this._resizeObserver=u.onResizeObservable.add((()=>{})),this._generateMipMaps=!!l,this._doNotChangeAspectRatio=a,this._renderingManager=new Y.b(n),this._renderingManager._useSceneAutoClearSetup=!0,g||(this._renderTargetOptions={generateMipMaps:l,type:Z,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:N,generateStencilBuffer:i,samples:E,creationFlags:W,noColorAttachment:s,useSRGBBuffer:C,colorAttachment:b,label:this.name},this.samplingMode===P.b.NEAREST_SAMPLINGMODE&&(this.wrapU=P.b.CLAMP_ADDRESSMODE,this.wrapV=P.b.CLAMP_ADDRESSMODE),h||(x?(this._renderTarget=n.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=P.b.INVCUBIC_MODE,this._textureMatrix=J.d.Identity()):this._renderTarget=n.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==E&&(this.samples=E)))}createDepthStencilTexture(){var v;let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,b=arguments.length>5?arguments[5]:void 0;null===(v=this._renderTarget)||void 0===v||v.createDepthStencilTexture(y,n,B,J,P,b)}_releaseRenderPassId(){if(this._scene){const v=this._scene.getEngine();for(let y=0;y<this._renderPassIds.length;++y)v.releaseRenderPassId(this._renderPassIds[y])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const v=this._scene.getEngine(),y=this._isCubeData?6:this.getRenderLayers()||1;for(let n=0;n<y;++n)this._renderPassIds[n]=v.createRenderPassId(`RenderTargetTexture - ${this.name}#${n}`)}_processSizeParameter(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(v.ratio){this._sizeRatio=v.ratio;const y=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(y.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(y.getRenderHeight(),this._sizeRatio)}}else this._size=v;y&&this._createRenderPassId()}get samples(){var v;return(null===(v=this._renderTarget)||void 0===v?void 0:v.samples)??this._samples}set samples(v){this._renderTarget&&(this._samples=this._renderTarget.setSamples(v))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(v){this._refreshRate=v,this.resetRefreshCounter()}addPostProcess(v){if(!this._postProcessManager){const v=this.va();if(!v)return;this._postProcessManager=new b.c(v),this._postProcesses=new Array}this._postProcesses.push(v),this._postProcesses[0].fj=!1}clearPostProcesses(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(v)for(const v of this._postProcesses)v.dispose();this._postProcesses=[]}}removePostProcess(v){if(!this._postProcesses)return;const y=this._postProcesses.indexOf(v);-1!==y&&(this._postProcesses.splice(y,1),this._postProcesses.length>0&&(this._postProcesses[0].fj=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const v=this._size.layers;if(v)return v;const y=this._size.depth;return y||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(v){const y=Math.max(1,this.getRenderSize()*v);this.resize(y)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(v){var y;const n=this.isCube;null===(y=this._renderTarget)||void 0===y||y.dispose(),this._renderTarget=null;const B=this.va();B&&(this._processSizeParameter(v,!1),this._renderTarget=n?B.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):B.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(v,y)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(n.bind(n,12321)).then((v=>this._dumpTools=v))),this._render(!1,!1,!0)}_render(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=this.va();if(!B)return n;const J=B.getEngine();if(void 0!==this.useCameraPostProcesses&&(v=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let v=0;v<this._waitingRenderList.length;v++){const y=this._waitingRenderList[v],n=B.getMeshById(y);n&&this.renderList.push(n)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const v=this.va();if(!v)return n;const y=v.meshes;for(let n=0;n<y.length;n++){const v=y[n];this.renderListPredicate(v)&&this.renderList.push(v)}}const P=J.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const b=this.activeCamera??B.activeCamera,Y=B.activeCamera;b&&(b!==B.activeCamera&&(B.setTransformMatrix(b.getViewMatrix(),b.getProjectionMatrix(!0)),B.activeCamera=b),J.setViewport(b.rigParent?b.rigParent.viewport:b.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let l=n;if(n){B.getViewMatrix()||B.updateTransformMatrix();const v=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let P=0;P<v&&l;P++){let v=null;const y=this.renderList?this.renderList:B.getActiveMeshes().data,b=this.renderList?this.renderList.length:B.getActiveMeshes().length;J.currentRenderPassId=this._renderPassIds[P],this.onBeforeRenderObservable.notifyObservers(P),this.getCustomRenderList&&(v=this.getCustomRenderList(P,y,b)),v||(v=y),this._doNotChangeAspectRatio||B.updateTransformMatrix(!0);for(let B=0;B<v.length&&l;++B){const y=v[B];if(y.isEnabled()&&!y.isBlocked&&y.isVisible&&y.Ag)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(y,this.refreshRate,n)){l=!1;continue}}else if(!y.isReady(!0)){l=!1;continue}}this.onAfterRenderObservable.notifyObservers(P),(this.is2DArray||this.is3D||this.isCube)&&(B.incrementRenderId(),B.resetCachedMaterial())}const y=this.particleSystemList||B.Ej;for(const n of y)n.isReady()||(l=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let a=0;a<6;a++)this._renderToTarget(a,v,y,void 0,b),B.incrementRenderId(),B.resetCachedMaterial();else this._renderToTarget(0,v,y,void 0,b);else for(let a=0;a<this.getRenderLayers();a++)this._renderToTarget(0,v,y,a,b),B.incrementRenderId(),B.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),J.currentRenderPassId=P,B.activeCamera=Y,Y&&(this.activeCamera&&this.activeCamera!==B.activeCamera&&B.setTransformMatrix(Y.getViewMatrix(),Y.getProjectionMatrix(!0)),J.setViewport(Y.viewport)),B.resetCachedMaterial(),l}_bestReflectionRenderTargetDimension(v,y){const n=v*y,B=(0,a.p)(n+16384/(128+n));return Math.min((0,a.e)(v),B)}_prepareRenderingManager(v,y,n,B){const J=this.va();if(!J)return;this._renderingManager.reset();const P=J.getRenderId();for(let Y=0;Y<y;Y++){const y=v[Y];if(y&&!y.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(y,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!y.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!y._internalAbstractMeshDataInfo._currentLODIsUpToDate&&n&&(y._internalAbstractMeshDataInfo._currentLOD=J.customLODSelector?J.customLODSelector(y,n):y.getLOD(n),y._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!y._internalAbstractMeshDataInfo._currentLOD)continue;let v,b=y._internalAbstractMeshDataInfo._currentLOD;if(b!==y&&0!==b.billboardMode&&b.ak(),b._preActivateForIntermediateRendering(P),v=!(!B||!n)&&0===(y.layerMask&n.layerMask),y.isEnabled()&&y.isVisible&&y.Ag&&!v){if(b!==y&&b._activate(P,!0),y._activate(P,!0)&&y.Ag.length){y.isAnInstance?y._internalAbstractMeshDataInfo._actAsRegularMesh&&(b=y):b._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,b._internalAbstractMeshDataInfo._isActiveIntermediate=!0,J._prepareSkeleton(b);for(let v=0;v<b.Ag.length;v++){const y=b.Ag[v];this._renderingManager.dispatch(y,b)}}y._postActivate()}}}const b=this.particleSystemList||J.Ej;for(let Y=0;Y<b.length;Y++){const v=b[Y],y=v.j;v.isStarted()&&y&&(!y.position||y.isEnabled())&&this._renderingManager.dispatchParticles(v)}}_bindFrameBuffer(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.va();if(!n)return;const B=n.getEngine();this._renderTarget&&B.bindFramebuffer(this._renderTarget,this.isCube?v:void 0,void 0,void 0,this.ignoreCameraViewport,0,y)}_unbindFrameBuffer(v,y){this._renderTarget&&v.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(y)}))}_prepareFrame(v,y,n,B){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):B&&v.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(y,n)}_renderToTarget(v,y,n){var B,J;let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const Y=this.va();if(!Y)return;const l=Y.getEngine();this._prepareFrame(Y,v,P,y),null===(B=l._debugPushGroup)||void 0===B||B.call(l,`render to face #${v} layer #${P}`,2),this.is2DArray||this.is3D?(l.currentRenderPassId=this._renderPassIds[P],this.onBeforeRenderObservable.notifyObservers(P)):(l.currentRenderPassId=this._renderPassIds[v],this.onBeforeRenderObservable.notifyObservers(v));if(l.snapshotRendering&&1===l.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(l):this.skipInitialClear||l.clear(this.clearColor||Y.clearColor,!0,!0,!0);else{var a;let B=null;const J=this.renderList?this.renderList:Y.getActiveMeshes().data,Z=this.renderList?this.renderList.length:Y.getActiveMeshes().length;this.getCustomRenderList&&(B=this.getCustomRenderList(this.is2DArray||this.is3D?P:v,J,Z)),B?this._prepareRenderingManager(B,B.length,b,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(J,Z,b,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),B=J);for(const y of Y._beforeRenderTargetClearStage)y.action(this,v,P);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(l):this.skipInitialClear||l.clear(this.clearColor||Y.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||Y.updateTransformMatrix(!0);for(const y of Y._beforeRenderTargetDrawStage)y.action(this,v,P);this._renderingManager.render(this.customRenderFunction,B,this.renderParticles,this.renderSprites);for(const y of Y._afterRenderTargetDrawStage)y.action(this,v,P);const f=(null===(a=this._texture)||void 0===a?void 0:a.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,v,this._postProcesses,this.ignoreCameraViewport):y&&Y.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,v);for(const y of Y._afterRenderTargetPostProcessStage)y.action(this,v,P);this._texture&&(this._texture.generateMipMaps=f),this._doNotChangeAspectRatio||Y.updateTransformMatrix(!0),n&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),l):x.e.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(J=l._debugPopGroup)||void 0===J||J.call(l,2),this._unbindFrameBuffer(l,v),this._texture&&this.isCube&&5===v&&l.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(v,y,n,B)}setRenderingAutoClearDepthStencil(v,y){this._renderingManager.setRenderingAutoClearDepthStencil(v,y),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const v=this.getSize(),y=new f(this.name,v,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return y.Pe=this.Pe,y.level=this.level,y.coordinatesMode=this.coordinatesMode,this.renderList&&(y.renderList=this.renderList.slice(0)),y}serialize(){if(!this.name)return null;const v=super.serialize();if(v.renderTargetSize=this.getRenderSize(),v.renderList=[],this.renderList)for(let y=0;y<this.renderList.length;y++)v.renderList.push(this.renderList[y].id);return v}disposeFramebufferObjects(){var v;null===(v=this._renderTarget)||void 0===v||v.dispose(!0)}releaseInternalTexture(){var v;null===(v=this._renderTarget)||void 0===v||v.releaseTextures(),this._texture=null}dispose(){var v;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const y=this.va();if(!y)return;let n=y.customRenderTargets.indexOf(this);n>=0&&y.customRenderTargets.splice(n,1);for(const B of y.cameras)n=B.customRenderTargets.indexOf(this),n>=0&&B.customRenderTargets.splice(n,1);null===(v=this._renderTarget)||void 0===v||v.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===f.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=f.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}f.REFRESHRATE_RENDER_ONCE=0,f.REFRESHRATE_RENDER_ONEVERYFRAME=1,f.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,P.b._CreateRenderTargetTexture=(v,y,n,B,J)=>new f(v,y,n,B)},11281:(v,y,n)=>{"use strict";n.d(y,{b:()=>W});var B=n(11050),J=n(11055),P=n(10795),b=n(11081),Y=n(11283),l=n(10908),a=n(10811),Z=n(10847),x=n(10899),f=n(11180),N=n(10835);function i(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=y.width,J=y.height;if(v instanceof Float32Array){let y=v.byteLength/v.BYTES_PER_ELEMENT;const n=new Uint8Array(y);for(;--y>=0;){let B=v[y];B<0?B=0:B>1&&(B=1),n[y]=255*B}v=n}const P=document.createElement("canvas");P.width=B,P.height=J;const b=P.getContext("2d");if(!b)return null;const Y=b.createImageData(B,J);if(Y.data.set(v),b.putImageData(Y,0,0),n){const v=document.createElement("canvas");v.width=B,v.height=J;const y=v.getContext("2d");return y?(y.translate(0,J),y.scale(1,-1),y.drawImage(P,0,0),v.toDataURL("image/png")):null}return P.toDataURL("image/png")}function g(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const B=v.getInternalTexture();if(!B)return null;const J=v._readPixelsSync(y,n);return J?i(J,v.getSize(),B.invertY):null}async function c(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const B=v.getInternalTexture();if(!B)return null;const J=await v.readPixels(y,n);return J?i(J,v.getSize(),B.invertY):null}var h=n(11295),E=n(11110);class W extends Y.b{static _CreateVideoTexture(v,y,n){arguments.length>5&&void 0!==arguments[5]||W.TRILINEAR_SAMPLINGMODE;throw(0,a.e)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(v){this._isBlocking=v}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(v,y,n,B){let J,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:W.TRILINEAR_SAMPLINGMODE,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]&&arguments[8],f=arguments.length>9?arguments[9]:void 0,N=arguments.length>10?arguments[10]:void 0,i=arguments.length>11?arguments[11]:void 0,g=arguments.length>12?arguments[12]:void 0,c=arguments.length>13?arguments[13]:void 0;super(y),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new P.e,this._isBlocking=!0,this.name=v||"",this.url=v;let E=!1,s=null,C=!0;"object"===typeof n&&null!==n?(J=n.noMipmap??!1,B=n.invertY??!h.e,b=n.samplingMode??W.TRILINEAR_SAMPLINGMODE,Y=n.X??null,l=n.onError??null,a=n.buffer??null,x=n.deleteBuffer??!1,f=n.format,N=n.mimeType,i=n.loaderOptions,g=n.creationFlags,E=n.useSRGBBuffer??!1,s=n.internalTexture??null,C=n.gammaSpace??C):J=!!n,this._gammaSpace=C,this._noMipmap=J,this._invertY=void 0===B?!h.e:B,this._initialSamplingMode=b,this._buffer=a,this._deleteBuffer=x,this._mimeType=N,this._loaderOptions=i,this._creationFlags=g,this._useSRGBBuffer=E,this._forcedExtension=c,f&&(this._format=f);const r=this.va(),u=this._getEngine();if(!u)return;u.onBeforeTextureInitObservable.notifyObservers(this);const O=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),Y&&Y(),!this.isBlocking&&r&&r.resetCachedMaterial()},d=(v,y)=>{this._loadingError=!0,this._errorObject={message:v,exception:y},l&&l(v,y),W.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!s)return this._delayedOnLoad=O,void(this._delayedOnError=d);if(this._texture=s??this._getFromCache(this.url,J,b,this._invertY,E,this.isCube),this._texture)if(this._texture.isReady)Z.c.SetImmediate((()=>O()));else{const v=this._texture.onLoadedObservable.add(O);this._texture.onErrorObservable.add((y=>{var n;d(y.message,y.exception),null===(n=this._texture)||void 0===n||n.onLoadedObservable.remove(v)}))}else if(r&&r.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=O,this._delayedOnError=d;else{try{this._texture=u.createTexture(this.url,J,this._invertY,r,b,O,d,this._buffer,void 0,this._format,this._forcedExtension,N,i,g,E)}catch(q){throw d("error loading",q),q}x&&(this._buffer=null)}}updateURL(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(v=>v.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=v),this.url=v,this._buffer=y,this._forcedExtension=B,this.delayLoadState=4,n&&(this._delayedOnLoad=n),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const v=this.va();v&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?Z.c.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=v.getEngine().createTexture(this.url,this._noMipmap,this._invertY,v,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(v,y,n,B){v*=this._cachedUScale,y*=this._cachedVScale,v-=this.uRotationCenter*this._cachedUScale,y-=this.vRotationCenter*this._cachedVScale,n-=this.wRotationCenter,b.n.TransformCoordinatesFromFloatsToRef(v,y,n,this._rowGenerationMatrix,B),B.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,B.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,B.z+=this.wRotationCenter}getTextureMatrix(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*v===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*v,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=b.d.Zero(),this._rowGenerationMatrix=new b.d,this._t0=b.n.Zero(),this._t1=b.n.Zero(),this._t2=b.n.Zero()),b.d.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(b.d.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,b.i.Matrix[0]),b.d.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,b.i.Matrix[1]),b.d.ScalingToRef(this._cachedUScale,this._cachedVScale,0,b.i.Matrix[2]),b.d.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,b.i.Matrix[3]),b.i.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(b.i.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(b.i.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(b.i.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.Ei(this._t0),this._t2.Ei(this._t0),b.d.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const y=this.va();if(!y)return this._cachedTextureMatrix;const n=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&n!==this._cachedIdentity3x2&&y.markAllMaterialsAsDirty(1,(v=>v.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const v=this.va();if(!v)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==W.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===v.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=b.d.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=b.d.Zero());const y=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case W.PLANAR_MODE:b.d.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case W.PROJECTION_MODE:{b.d.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const y=v.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=y.updateFlag,y.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:b.d.IdentityToRef(this._cachedReflectionTextureMatrix)}return y&&v.markAllMaterialsAsDirty(1,(v=>v.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const v={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return E.d.Clone((()=>new W(this._texture?this._texture.url:null,this.va(),v)),this)}serialize(){var v;const y=this.name;W.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const n=super.serialize(W._SerializeInternalTextureUniqueId);if(!n)return null;var B;((W.SerializeBuffers||W.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(n.base64String=this._buffer,n.name=n.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?n.base64String="data:image/png;base64,"+(0,N.n)(this._buffer):(W.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(n.base64String=!this._engine||this._engine._features.supportSyncTextureRead?g(this):c(this))),n.invertY=this._invertY,n.samplingMode=this.samplingMode,n._creationFlags=this._creationFlags,n._useSRGBBuffer=this._useSRGBBuffer,W._SerializeInternalTextureUniqueId)&&(n.internalTextureUniqueId=null===(B=this._texture)||void 0===B?void 0:B.uniqueId);return n.internalTextureLabel=null===(v=this._texture)||void 0===v?void 0:v.label,n.noMipmap=this._noMipmap,this.name=y,n}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(v,y,n){if(v.customType){const B=x.b.Instantiate(v.customType).Parse(v,y,n);return v.samplingMode&&B.updateSamplingMode&&B._samplingMode&&B._samplingMode!==v.samplingMode&&B.updateSamplingMode(v.samplingMode),B}if(v.isCube&&!v.isRenderTarget)return W._CubeTextureParser(v,y,n);const B=void 0!==v.internalTextureUniqueId;if(!v.name&&!v.isRenderTarget&&!B)return null;let J;if(B){const n=y.getEngine().getLoadedTexturesCache();for(const y of n)if(y.uniqueId===v.internalTextureUniqueId){J=y;break}}const P=y=>{if(y&&y._texture&&(y._texture._cachedWrapU=null,y._texture._cachedWrapV=null,y._texture._cachedWrapR=null),v.samplingMode){const n=v.samplingMode;y&&y.samplingMode!==n&&y.updateSamplingMode(n)}if(y&&v.animations)for(let n=0;n<v.animations.length;n++){const B=v.animations[n],J=(0,l.d)("BABYLON.Animation");J&&y.animations.push(J.Parse(B))}y&&y._texture&&(B&&!J&&y._texture._setUniqueId(v.internalTextureUniqueId),y._texture.label=v.internalTextureLabel)};return E.d.Parse((()=>{let B=!0;if(v.noMipmap&&(B=!1),v.mirrorPlane){const n=W._CreateMirror(v.name,v.renderTargetSize,y,B);return n._waitingRenderList=v.renderList,n.mirrorPlane=f.e.qh(v.mirrorPlane),P(n),n}if(v.isRenderTarget){let n=null;if(v.isCube){if(y.reflectionProbes)for(let B=0;B<y.reflectionProbes.length;B++){const n=y.reflectionProbes[B];if(n.name===v.name)return n.cubeTexture}}else n=W._CreateRenderTargetTexture(v.name,v.renderTargetSize,y,B,v._creationFlags??0),n._waitingRenderList=v.renderList;return P(n),n}if(v.isVideo){const J=W._CreateVideoTexture(n+(v.url||v.name),n+(v.src||v.url),y,B,v.invertY,v.samplingMode,v.settings||{});return P(J),J}{let b;if(v.base64String&&!J)b=W.CreateFromBase64String(v.base64String,v.base64String,y,!B,v.invertY,v.samplingMode,(()=>{P(b)}),v._creationFlags??0,v._useSRGBBuffer??!1),b.name=v.name;else{let Y;Y=v.name&&(v.name.indexOf("://")>0||v.name.startsWith("data:"))?v.name:n+v.name,v.url&&(v.url.startsWith("data:")||W.UseSerializedUrlIfAny)&&(Y=v.url);const l={noMipmap:!B,invertY:v.invertY,samplingMode:v.samplingMode,X:()=>{P(b)},internalTexture:J};b=new W(Y,y,l)}return b}}),v,y)}static CreateFromBase64String(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:W.TRILINEAR_SAMPLINGMODE;return new W("data:"+y,n,B,J,P,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4?arguments[4]:void 0,P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:W.TRILINEAR_SAMPLINGMODE,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,Z=arguments.length>10?arguments[10]:void 0,x=arguments.length>11?arguments[11]:void 0;return"data:"!==v.substring(0,5)&&(v="data:"+v),new W(v,n,J,P,b,Y,l,y,B,a,void 0,void 0,Z,x)}}W.SerializeBuffers=!0,W.ForceSerializeBuffers=!1,W.OnTextureLoadErrorObservable=new P.e,W._SerializeInternalTextureUniqueId=!1,W._CubeTextureParser=(v,y,n)=>{throw(0,a.e)("CubeTexture")},W._CreateMirror=(v,y,n,B)=>{throw(0,a.e)("MirrorTexture")},W._CreateRenderTargetTexture=(v,y,n,B,J)=>{throw(0,a.e)("RenderTargetTexture")},W.NEAREST_SAMPLINGMODE=1,W.NEAREST_NEAREST_MIPLINEAR=8,W.BILINEAR_SAMPLINGMODE=2,W.LINEAR_LINEAR_MIPNEAREST=11,W.TRILINEAR_SAMPLINGMODE=3,W.LINEAR_LINEAR_MIPLINEAR=3,W.NEAREST_NEAREST_MIPNEAREST=4,W.NEAREST_LINEAR_MIPNEAREST=5,W.NEAREST_LINEAR_MIPLINEAR=6,W.NEAREST_LINEAR=7,W.NEAREST_NEAREST=1,W.LINEAR_NEAREST_MIPNEAREST=9,W.LINEAR_NEAREST_MIPLINEAR=10,W.LINEAR_LINEAR=2,W.LINEAR_NEAREST=12,W.EXPLICIT_MODE=0,W.SPHERICAL_MODE=1,W.PLANAR_MODE=2,W.CUBIC_MODE=3,W.PROJECTION_MODE=4,W.SKYBOX_MODE=5,W.INVCUBIC_MODE=6,W.EQUIRECTANGULAR_MODE=7,W.FIXED_EQUIRECTANGULAR_MODE=8,W.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,W.CLAMP_ADDRESSMODE=0,W.WRAP_ADDRESSMODE=1,W.MIRROR_ADDRESSMODE=2,W.UseSerializedUrlIfAny=!1,(0,B.c)([(0,J.M)()],W.prototype,"url",void 0),(0,B.c)([(0,J.M)()],W.prototype,"uOffset",void 0),(0,B.c)([(0,J.M)()],W.prototype,"vOffset",void 0),(0,B.c)([(0,J.M)()],W.prototype,"uScale",void 0),(0,B.c)([(0,J.M)()],W.prototype,"vScale",void 0),(0,B.c)([(0,J.M)()],W.prototype,"uAng",void 0),(0,B.c)([(0,J.M)()],W.prototype,"vAng",void 0),(0,B.c)([(0,J.M)()],W.prototype,"wAng",void 0),(0,B.c)([(0,J.M)()],W.prototype,"uRotationCenter",void 0),(0,B.c)([(0,J.M)()],W.prototype,"vRotationCenter",void 0),(0,B.c)([(0,J.M)()],W.prototype,"wRotationCenter",void 0),(0,B.c)([(0,J.M)()],W.prototype,"homogeneousRotationInUVTransform",void 0),(0,B.c)([(0,J.M)()],W.prototype,"isBlocking",null),(0,l.g)("BABYLON.Texture",W),E.d._TextureParser=W.Parse},10891:(v,y,n)=>{"use strict";n.d(y,{e:()=>B});class B{get wrapU(){return this._cachedWrapU}set wrapU(v){this._cachedWrapU=v}get wrapV(){return this._cachedWrapV}set wrapV(v){this._cachedWrapV=v}get wrapR(){return this._cachedWrapR}set wrapR(v){this._cachedWrapR=v}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(v){this._cachedAnisotropicFilteringLevel=v}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(v){this._comparisonFunction=v}get useMipMaps(){return this._useMipMaps}set useMipMaps(v){this._useMipMaps=v}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=v,this._cachedWrapV=y,this._cachedWrapR=n,this._cachedAnisotropicFilteringLevel=B,this.samplingMode=J,this._comparisonFunction=P,this}compareSampler(v){return this._cachedWrapU===v._cachedWrapU&&this._cachedWrapV===v._cachedWrapV&&this._cachedWrapR===v._cachedWrapR&&this._cachedAnisotropicFilteringLevel===v._cachedAnisotropicFilteringLevel&&this.samplingMode===v.samplingMode&&this._comparisonFunction===v._comparisonFunction&&this._useMipMaps===v._useMipMaps}}},11262:(v,y,n)=>{"use strict";function B(v){-1===v.indexOf("vClipPlane")&&v.push("vClipPlane"),-1===v.indexOf("vClipPlane2")&&v.push("vClipPlane2"),-1===v.indexOf("vClipPlane3")&&v.push("vClipPlane3"),-1===v.indexOf("vClipPlane4")&&v.push("vClipPlane4"),-1===v.indexOf("vClipPlane5")&&v.push("vClipPlane5"),-1===v.indexOf("vClipPlane6")&&v.push("vClipPlane6")}function J(v,y,n){const B=!!(v.clipPlane??y.clipPlane),J=!!(v.clipPlane2??y.clipPlane2),P=!!(v.clipPlane3??y.clipPlane3),b=!!(v.clipPlane4??y.clipPlane4),Y=!!(v.clipPlane5??y.clipPlane5),l=!!(v.clipPlane6??y.clipPlane6);B&&n.push("#define CLIPPLANE"),J&&n.push("#define CLIPPLANE2"),P&&n.push("#define CLIPPLANE3"),b&&n.push("#define CLIPPLANE4"),Y&&n.push("#define CLIPPLANE5"),l&&n.push("#define CLIPPLANE6")}function P(v,y,n){let B=!1;const J=!!(v.clipPlane??y.clipPlane),P=!!(v.clipPlane2??y.clipPlane2),b=!!(v.clipPlane3??y.clipPlane3),Y=!!(v.clipPlane4??y.clipPlane4),l=!!(v.clipPlane5??y.clipPlane5),a=!!(v.clipPlane6??y.clipPlane6);return n.CLIPPLANE!==J&&(n.CLIPPLANE=J,B=!0),n.CLIPPLANE2!==P&&(n.CLIPPLANE2=P,B=!0),n.CLIPPLANE3!==b&&(n.CLIPPLANE3=b,B=!0),n.CLIPPLANE4!==Y&&(n.CLIPPLANE4=Y,B=!0),n.CLIPPLANE5!==l&&(n.CLIPPLANE5=l,B=!0),n.CLIPPLANE6!==a&&(n.CLIPPLANE6=a,B=!0),B}function b(v,y,n){let B=y.clipPlane??n.clipPlane;Y(v,"vClipPlane",B),B=y.clipPlane2??n.clipPlane2,Y(v,"vClipPlane2",B),B=y.clipPlane3??n.clipPlane3,Y(v,"vClipPlane3",B),B=y.clipPlane4??n.clipPlane4,Y(v,"vClipPlane4",B),B=y.clipPlane5??n.clipPlane5,Y(v,"vClipPlane5",B),B=y.clipPlane6??n.clipPlane6,Y(v,"vClipPlane6",B)}function Y(v,y,n){n&&v.setFloat4(y,n.k.x,n.k.y,n.k.z,n.d)}n.d(y,{e:()=>B,h:()=>b,j:()=>P,l:()=>J})},11112:(v,y,n)=>{"use strict";function B(v){v.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}n.d(y,{b:()=>B})},11507:(v,y,n)=>{"use strict";function B(v){return void 0===v.getPipelineContext}n.d(y,{b:()=>B})},11249:(v,y,n)=>{"use strict";n.d(y,{d:()=>B});class B{static GetEffect(v){return void 0===v.getPipelineContext?v.effect:v}constructor(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=v.createDrawContext(),y&&(this.materialContext=v.createMaterialContext())}setEffect(v,y){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var B;(this.effect=v,void 0!==y&&(this.defines=y),n)&&(null===(B=this.drawContext)||void 0===B||B.reset())}dispose(){var v;null===(v=this.drawContext)||void 0===v||v.dispose()}}},10871:(v,y,n)=>{"use strict";n.d(y,{c:()=>x,g:()=>N,h:()=>a,i:()=>Z});var B=n(10797),J=n(10880),P=n(10866),b=n(10801),Y=n(10841),l=n(10845);function a(v,y){return(0,J.C)(y).cachedPipelines[v]}function Z(v){const y=v._name,n=v.context;if(y&&n){const v=(0,J.C)(n),B=v.cachedPipelines[y];null===B||void 0===B||B.dispose(),delete v.cachedPipelines[y]}}function x(v,y,n,J,P,b,l){let a,Z;const x=(0,B.k)()?null===b||void 0===b?void 0:b.getHostDocument():null;a="string"===typeof y?y:y.vertexSource?"source:"+y.vertexSource:y.vertexElement?(null===x||void 0===x?void 0:x.getElementById(y.vertexElement))||y.vertexElement:y.vertex||y,Z="string"===typeof y?y:y.fragmentSource?"source:"+y.fragmentSource:y.fragmentElement?(null===x||void 0===x?void 0:x.getElementById(y.fragmentElement))||y.fragmentElement:y.fragment||y;const N=[void 0,void 0],i=()=>{if(N[0]&&N[1]){v.isFragment=!0;const[B,a]=N;(0,Y.g)(a,v,((b,a)=>{l&&(l._fragmentSourceCodeBeforeMigration=a),n&&(b=n("fragment",b));const Z=(0,Y.b)(B,b,v);v=null;const x=function(v,y,n,B){if(n){return{vertexSourceCode:(1===B?"//":"")+"#define SHADER_NAME vertex:"+(n.vertexElement||n.vertex||n.spectorName||n)+"\n"+v,fragmentSourceCode:(1===B?"//":"")+"#define SHADER_NAME fragment:"+(n.fragmentElement||n.fragment||n.spectorName||n)+"\n"+y}}return{vertexSourceCode:v,fragmentSourceCode:y}}(Z.vertexCode,Z.fragmentCode,y,P);null===J||void 0===J||J(x.vertexSourceCode,x.fragmentSourceCode)}),b)}};f(a,"Vertex","",(y=>{(0,Y.f)(v),(0,Y.g)(y,v,((v,B)=>{l&&(l._rawVertexSourceCode=y,l._vertexSourceCodeBeforeMigration=B),n&&(v=n("vertex",v)),N[0]=v,i()}),b)}),P),f(Z,"Fragment","Pixel",(v=>{l&&(l._rawFragmentSourceCode=v),N[1]=v,i()}),P)}function f(v,y,n,J,b,Y){if("undefined"!==typeof HTMLElement&&v instanceof HTMLElement){return void J((0,B.c)(v))}if("source:"===v.substring(0,7))return void J(v.substring(7));if("base64:"===v.substring(0,7)){return void J(window.atob(v.substring(7)))}const a=P.b.GetShadersStore(b);if(a[v+y+"Shader"])return void J(a[v+y+"Shader"]);if(n&&a[v+n+"Shader"])return void J(a[v+n+"Shader"]);let Z;if(Z="."===v[0]||"/"===v[0]||v.indexOf("http")>-1?v:P.b.GetShadersRepository(b)+v,!(Y=Y||l.l))throw new Error("loadFileInjection is not defined");Y(Z+"."+y.toLowerCase()+".fx",J)}const N=(v,y,n,B)=>{try{const P=v.existingPipelineContext||y(v.shaderProcessingContext);if(P._name=v.name,v.name&&v.context){(0,J.C)(v.context).cachedPipelines[v.name]=P}return n(P,v.vertex,v.fragment,!!v.createAsRaw,"","",v.rebuildRebind,v.defines,v.transformFeedbackVaryings,"",(()=>{B(P,(()=>{var y;null===(y=v.onRenderingStateCompiled)||void 0===y||y.call(v,P)}))})),P}catch(P){throw b.e.Error("Error compiling effect"),P}}},10857:(v,y,n)=>{"use strict";n.d(y,{b:()=>Y});var B=n(10795),J=n(10801),P=n(10866),b=n(10871);class Y{static get ShadersRepository(){return P.b.ShadersRepository}static set ShadersRepository(v){P.b.ShadersRepository=v}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new B.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(v,y,n){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,f=arguments.length>9?arguments[9]:void 0,N=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",i=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,g=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new B.e,this.onErrorObservable=new B.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=v,this._key=N;const c=this._key.replace(/\r/g,"").replace(/\n/g,"|");let h;if(y.attributes){const v=y;if(this._engine=n,this._attributesNames=v.attributes,this._uniformsNames=v.uniformsNames.concat(v.samplers),this._samplerList=v.samplers.slice(),this.defines=v.defines,this.onError=v.onError,this.onCompiled=v.onCompiled,this._fallbacks=v.fallbacks,this._indexParameters=v.indexParameters,this._transformFeedbackVaryings=v.transformFeedbackVaryings||null,this._multiTarget=!!v.multiTarget,this._shaderLanguage=v.shaderLanguage??0,v.uniformBuffersNames){this._uniformBuffersNamesList=v.uniformBuffersNames.slice();for(let y=0;y<v.uniformBuffersNames.length;y++)this._uniformBuffersNames[v.uniformBuffersNames[y]]=y}this._processFinalCode=v.processFinalCode??null,this._processCodeAfterIncludes=v.processCodeAfterIncludes??void 0,h=v.existingPipelineContext}else this._engine=P,this.defines=null==l?"":l,this._uniformsNames=n.concat(J),this._samplerList=J?J.slice():[],this._attributesNames=y,this._uniformBuffersNamesList=[],this._shaderLanguage=i,this.onError=x,this.onCompiled=Z,this._indexParameters=f,this._fallbacks=a;"WEBGL2"===this._engine.shaderPlatformName&&(h=(0,b.h)(c,this._engine._gl)??h),this._attributeLocationByName={},this.uniqueId=Y._UniqueIdSeed++,h?(this._pipelineContext=h,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,g)}async _processShaderCodeAsync(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3?arguments[3]:void 0;B&&await B(),this._processingContext=n||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const J={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:v??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:P.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:P.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,b.c)(J,this.name,this._processFinalCode,((v,n)=>{this._vertexSourceCode=v,this._fragmentSourceCode=n,this._prepareEffect(y)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(v){return this._attributes[v]}getAttributeLocationByName(v){return this._attributeLocationByName[v]}getAttributesCount(){return this._attributes.length}getUniformIndex(v){return this._uniformsNames.indexOf(v)}getUniform(v){return this._uniforms[v]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(v){this.isReady()?v(this):(this.onCompileObservable.add((y=>{v(y)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(v){try{if(this._isReadyInternal())return}catch(y){return void this._processCompilationErrors(y,v)}this._isDisposed||setTimeout((()=>{this._checkIsReady(v)}),16)}get vertexSourceCode(){var v;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(v=this._pipelineContext)||void 0===v?void 0:v._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var v;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(v=this._pipelineContext)||void 0===v?void 0:v._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(v,y,n,B){this._isReady=!1,this._vertexSourceCodeOverride=v,this._fragmentSourceCodeOverride=y,this.onError=(v,y)=>{B&&B(y)},this.onCompiled=()=>{var v,y;const B=this.getEngine().scenes;if(B)for(let n=0;n<B.length;n++)B[n].markAllMaterialsAsDirty(63);null===(v=(y=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===v||v.call(y,n)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(v){if(this._pipelineContext=v,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let y=0;y<this._attributesNames.length;y++){const v=this._attributesNames[y];this._attributeLocationByName[v]=this._attributes[y]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),Y.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y=this._pipelineContext;this._isReady=!1;try{const n=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),B=n?null:this.defines,J=n?this._vertexSourceCodeOverride:this._vertexSourceCode,P=n?this._fragmentSourceCodeOverride:this._fragmentSourceCode,Y=this._engine;this._pipelineContext=(0,b.g)({existingPipelineContext:v?y:null,vertex:J,fragment:P,context:"WEBGL2"===Y.shaderPlatformName?Y._gl:void 0,rebuildRebind:(v,y,n,B)=>this._rebuildProgram(v,y,n,B),defines:B,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:n,parallelShaderCompile:Y._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:n=>{y&&!v&&this._engine._deletePipelineContext(y),n&&this._onRenderingStateCompiled(n)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(y)}catch(n){this._processCompilationErrors(n,y)}}_getShaderCodeAndErrorLine(v,y,n){const B=n?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let J=null;if(y&&v){const P=y.match(B);if(P&&2===P.length){const y=parseInt(P[1]),B=v.split("\n",-1);B.length>=y&&(J=`Offending line [${y}] in ${n?"fragment":"vertex"} code: ${B[y-1]}`)}}return[v,J]}_processCompilationErrors(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=v.message;const n=this._attributesNames,B=this._fallbacks;if(J.e.Error("Unable to compile effect:"),J.e.Error("Uniforms: "+this._uniformsNames.map((function(v){return" "+v}))),J.e.Error("Attributes: "+n.map((function(v){return" "+v}))),J.e.Error("Defines:\n"+this.defines),Y.LogShaderCodeOnCompilationError){var P,b;let v=null,y=null,n=null;var l;if(null!==(P=this._pipelineContext)&&void 0!==P&&P._getVertexShaderCode()&&([n,v]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),n&&(J.e.Error("Vertex code:"),J.e.Error(n))),null!==(b=this._pipelineContext)&&void 0!==b&&b._getFragmentShaderCode())[n,y]=this._getShaderCodeAndErrorLine(null===(l=this._pipelineContext)||void 0===l?void 0:l._getFragmentShaderCode(),this._compilationError,!0),n&&(J.e.Error("Fragment code:"),J.e.Error(n));v&&J.e.Error(v),y&&J.e.Error(y)}J.e.Error("Error: "+this._compilationError);const a=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};y&&(this._pipelineContext=y,this._isReady=!0,a()),B?(this._pipelineContext=null,B.hasMoreFallbacks?(this._allFallbacksProcessed=!1,J.e.Error("Trying next fallback."),this.defines=B.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,a(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,y||a())}get isSupported(){return""===this._compilationError}_bindTexture(v,y){this._engine._bindTexture(this._samplers[v],y,v)}setTexture(v,y){this._engine.setTexture(this._samplers[v],this._uniforms[v],y,v)}setTextureArray(v,y){const n=v+"Ex";if(-1===this._samplerList.indexOf(n+"0")){const B=this._samplerList.indexOf(v);for(let v=1;v<y.length;v++){const y=n+(v-1).toString();this._samplerList.splice(B+v,0,y)}let J=0;for(const v of this._samplerList)this._samplers[v]=J,J+=1}this._engine.setTextureArray(this._samplers[v],this._uniforms[v],y,v)}bindUniformBuffer(v,y){const n=this._uniformBuffersNames[y];void 0===n||Y._BaseCache[n]===v&&this._engine._features.useUBOBindingCache||(Y._BaseCache[n]=v,this._engine.bindUniformBufferBase(v,n,y))}bindUniformBlock(v,y){this._engine.bindUniformBlock(this._pipelineContext,v,y)}setInt(v,y){return this._pipelineContext.setInt(v,y),this}setInt2(v,y,n){return this._pipelineContext.setInt2(v,y,n),this}setInt3(v,y,n,B){return this._pipelineContext.setInt3(v,y,n,B),this}setInt4(v,y,n,B,J){return this._pipelineContext.setInt4(v,y,n,B,J),this}setIntArray(v,y){return this._pipelineContext.setIntArray(v,y),this}setIntArray2(v,y){return this._pipelineContext.setIntArray2(v,y),this}setIntArray3(v,y){return this._pipelineContext.setIntArray3(v,y),this}setIntArray4(v,y){return this._pipelineContext.setIntArray4(v,y),this}setUInt(v,y){return this._pipelineContext.setUInt(v,y),this}setUInt2(v,y,n){return this._pipelineContext.setUInt2(v,y,n),this}setUInt3(v,y,n,B){return this._pipelineContext.setUInt3(v,y,n,B),this}setUInt4(v,y,n,B,J){return this._pipelineContext.setUInt4(v,y,n,B,J),this}setUIntArray(v,y){return this._pipelineContext.setUIntArray(v,y),this}setUIntArray2(v,y){return this._pipelineContext.setUIntArray2(v,y),this}setUIntArray3(v,y){return this._pipelineContext.setUIntArray3(v,y),this}setUIntArray4(v,y){return this._pipelineContext.setUIntArray4(v,y),this}setFloatArray(v,y){return this._pipelineContext.setArray(v,y),this}setFloatArray2(v,y){return this._pipelineContext.setArray2(v,y),this}setFloatArray3(v,y){return this._pipelineContext.setArray3(v,y),this}setFloatArray4(v,y){return this._pipelineContext.setArray4(v,y),this}setArray(v,y){return this._pipelineContext.setArray(v,y),this}setArray2(v,y){return this._pipelineContext.setArray2(v,y),this}setArray3(v,y){return this._pipelineContext.setArray3(v,y),this}setArray4(v,y){return this._pipelineContext.setArray4(v,y),this}setMatrices(v,y){return this._pipelineContext.setMatrices(v,y),this}setMatrix(v,y){return this._pipelineContext.setMatrix(v,y),this}setMatrix3x3(v,y){return this._pipelineContext.setMatrix3x3(v,y),this}setMatrix2x2(v,y){return this._pipelineContext.setMatrix2x2(v,y),this}setFloat(v,y){return this._pipelineContext.setFloat(v,y),this}setBool(v,y){return this._pipelineContext.setInt(v,y?1:0),this}setVector2(v,y){return this._pipelineContext.setVector2(v,y),this}setFloat2(v,y,n){return this._pipelineContext.setFloat2(v,y,n),this}setVector3(v,y){return this._pipelineContext.setVector3(v,y),this}setFloat3(v,y,n,B){return this._pipelineContext.setFloat3(v,y,n,B),this}setVector4(v,y){return this._pipelineContext.setVector4(v,y),this}setQuaternion(v,y){return this._pipelineContext.setQuaternion(v,y),this}setFloat4(v,y,n,B,J){return this._pipelineContext.setFloat4(v,y,n,B,J),this}setColor3(v,y){return this._pipelineContext.setColor3(v,y),this}setColor4(v,y,n){return this._pipelineContext.setColor4(v,y,n),this}setDirectColor4(v,y){return this._pipelineContext.setDirectColor4(v,y),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,b.i)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;y&&(P.b.GetShadersStore(B)[`${v}PixelShader`]=y),n&&(P.b.GetShadersStore(B)[`${v}VertexShader`]=n)}static ResetCache(){Y._BaseCache={}}}Y.LogShaderCodeOnCompilationError=!0,Y.AutomaticallyClearCodeCache=!1,Y._UniqueIdSeed=0,Y._BaseCache={},Y.ShadersStore=P.b.ShadersStore,Y.IncludesShadersStore=P.b.IncludesShadersStore},11311:(v,y,n)=>{"use strict";n.d(y,{e:()=>B});class B{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(v,y){this._defines[v]||(v<this._currentRank&&(this._currentRank=v),v>this._maxRank&&(this._maxRank=v),this._defines[v]=new Array),this._defines[v].push(y)}addCPUSkinningFallback(v,y){this._mesh=y,v<this._currentRank&&(this._currentRank=v),v>this._maxRank&&(this._maxRank=v)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(v,y){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,v=v.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),y._bonesComputationForcedToCPU=!0;const n=this._mesh.va();for(let v=0;v<n.meshes.length;v++){const B=n.meshes[v];if(B.material){if(B.computeBonesUsingShaders&&0!==B.numBoneInfluencers)if(B.material.getEffect()===y)B.computeBonesUsingShaders=!1;else if(B.Ag)for(const v of B.Ag){if(v.effect===y){B.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&B.computeBonesUsingShaders&&B.numBoneInfluencers>0&&(B.computeBonesUsingShaders=!1)}}else{const y=this._defines[this._currentRank];if(y)for(let n=0;n<y.length;n++)v=v.replace("#define "+y[n],"");this._currentRank++}return v}}},11615:(v,y,n)=>{"use strict";n.d(y,{c:()=>a,e:()=>Z});var B=n(11127),J=n(11355),P=n(10795),b=n(10857),Y=n(11249);n(11622);const l={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class a{constructor(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;this._fullscreenViewport=new J.c(0,0,1,1);const n=y.xa??l.xa,P=y.indices??l.indices;this.Od=v,this._vertexBuffers={[B.i.PositionKind]:new B.i(v,n,B.i.PositionKind,!1,!1,2)},this._indexBuffer=v.createIndexBuffer(P),this._onContextRestoredObserver=v.onContextRestoredObservable.add((()=>{this._indexBuffer=v.createIndexBuffer(P);for(const v in this._vertexBuffers){this._vertexBuffers[v]._rebuild()}}))}setViewport(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.Od.setViewport(v)}bindBuffers(v){this.Od.bindBuffers(this._vertexBuffers,this._indexBuffer,v)}applyEffectWrapper(v){this.Od.setState(!0),this.Od.depthCullingState.depthTest=!1,this.Od.stencilState.stencilTest=!1,this.Od.enableEffect(v.drawWrapper),this.bindBuffers(v.effect),v.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.Od.depthCullingState.depthTest,this._savedStateStencilTest=this.Od.stencilState.stencilTest}restoreStates(){this.Od.depthCullingState.depthTest=this._savedStateDepthTest,this.Od.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.Od.drawElementsType(0,0,6)}_isRenderTargetTexture(v){return void 0!==v.renderTarget}render(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!v.effect.isReady())return;this.saveStates(),this.setViewport();const n=null===y?null:this._isRenderTargetTexture(y)?y.renderTarget:y;n&&this.Od.bindFramebuffer(n),this.applyEffectWrapper(v),this.draw(),n&&this.Od.unBindFramebuffer(n),this.restoreStates()}dispose(){const v=this._vertexBuffers[B.i.PositionKind];v&&(v.dispose(),delete this._vertexBuffers[B.i.PositionKind]),this._indexBuffer&&this.Od._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.Od.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class Z{static RegisterShaderCodeProcessing(v,y){y?Z._CustomShaderCodeProcessing[v??""]=y:delete Z._CustomShaderCodeProcessing[v??""]}static _GetShaderCodeProcessing(v){return Z._CustomShaderCodeProcessing[v]??Z._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(v){this.options.name=v}isReady(){var v;return(null===(v=this._drawWrapper.effect)||void 0===v?void 0:v.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(v){this._drawWrapper.effect=v}constructor(v){this.alphaMode=0,this.onEffectCreatedObservable=new P.e(void 0,!0),this.onApplyObservable=new P.e,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...v,name:v.name||"effectWrapper",Od:v.Od,uniforms:v.uniforms||v.uniformNames||[],uniformNames:void 0,samplers:v.samplers||v.samplerNames||[],samplerNames:void 0,attributeNames:v.attributeNames||["position"],uniformBuffers:v.uniformBuffers||[],defines:v.defines||"",useShaderStore:v.useShaderStore||!1,vertexUrl:v.vertexUrl||v.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:v.fragmentShader||"pass",indexParameters:v.indexParameters,blockCompilation:v.blockCompilation||!1,shaderLanguage:v.shaderLanguage||0,onCompiled:v.onCompiled||void 0,extraInitializations:v.extraInitializations||void 0,extraInitializationsAsync:v.extraInitializationsAsync||void 0,useAsPostProcess:v.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),v.vertexUrl||v.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.Od.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new Y.d(this.options.Od),this._webGPUReady=1===this.options.shaderLanguage;const y=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,y,this.options.extraInitializations)}_gatherImports(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(v&&this._webGPUReady?y.push(Promise.all([n.e(37).then(n.bind(n,13566))])):y.push(Promise.all([Promise.resolve().then(n.bind(n,11622))])))}_postConstructor(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,B&&this._importPromises.push(...B);const J=this.options.Od.isWebGPU&&!Z.ForceGLSL;this._gatherImports(J,this._importPromises),void 0!==n&&n(J,this._importPromises),J&&this._webGPUReady&&(this.options.shaderLanguage=1),v||this.updateEffect(y)}updateEffect(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3?arguments[3]:void 0,J=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0;const a=Z._GetShaderCodeProcessing(this.name);if(null!==a&&void 0!==a&&a.defineCustomBindings){var x,f;const B=(null===(x=y)||void 0===x?void 0:x.slice())??[];B.push(...this.options.uniforms);const J=(null===(f=n)||void 0===f?void 0:f.slice())??[];J.push(...this.options.samplers),v=a.defineCustomBindings(this.name,v,B,J),y=B,n=J}this.options.defines=v||"";const N=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let i;i=this.options.extraInitializationsAsync?async()=>{null===N||void 0===N||N(),await this.options.extraInitializationsAsync}:N,this.options.useShaderStore?this._drawWrapper.effect=this.options.Od.createEffect({vertex:Y??this._shaderPath.vertex,fragment:l??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:y||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:n||this.options.samplers,defines:null!==v?v:"",fallbacks:null,onCompiled:J??this.options.onCompiled,onError:P??null,indexParameters:B||this.options.indexParameters,processCodeAfterIncludes:null!==a&&void 0!==a&&a.processCodeAfterIncludes?(v,y)=>a.processCodeAfterIncludes(this.name,v,y):null,processFinalCode:null!==a&&void 0!==a&&a.processFinalCode?(v,y)=>a.processFinalCode(this.name,v,y):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:i},this.options.Od):this._drawWrapper.effect=new b.b(this._shaderPath,this.options.attributeNames,y||this.options.uniforms,n||this.options.samplerNames,this.options.Od,v,void 0,J||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,i),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var v,y;this.options.useAsPostProcess&&(this.options.Od.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(v=Z._GetShaderCodeProcessing(this.name))||void 0===v||null===(y=v.bindCustomBindings)||void 0===y||y.call(v,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}Z.ForceGLSL=!1,Z._CustomShaderCodeProcessing={}},11117:(v,y,n)=>{"use strict";n.d(y,{e:()=>P,g:()=>J});var B=n(11112);function J(v,y){y.EXPOSURE&&v.push("exposureLinear"),y.CONTRAST&&v.push("contrast"),y.COLORGRADING&&v.push("colorTransformSettings"),(y.VIGNETTE||y.DITHER)&&v.push("vInverseScreenSize"),y.VIGNETTE&&(v.push("vignetteSettings1"),v.push("vignetteSettings2")),y.COLORCURVES&&(0,B.b)(v),y.DITHER&&v.push("ditherIntensity")}function P(v,y){y.COLORGRADING&&v.push("txColorTransform")}},11094:(v,y,n)=>{"use strict";n.d(y,{e:()=>N});var B=n(11050),J=n(11055),P=n(10795),b=n(11103),Y=n(11110),l=n(11112);class a{constructor(){this._dirty=!0,this._tempColor=new b.e(0,0,0,0),this._globalCurve=new b.e(0,0,0,0),this._highlightsCurve=new b.e(0,0,0,0),this._midtonesCurve=new b.e(0,0,0,0),this._shadowsCurve=new b.e(0,0,0,0),this._positiveCurve=new b.e(0,0,0,0),this._negativeCurve=new b.e(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(v){this._globalHue=v,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(v){this._globalDensity=v,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(v){this._globalSaturation=v,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(v){this._globalExposure=v,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(v){this._highlightsHue=v,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(v){this._highlightsDensity=v,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(v){this._highlightsSaturation=v,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(v){this._highlightsExposure=v,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(v){this._midtonesHue=v,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(v){this._midtonesDensity=v,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(v){this._midtonesSaturation=v,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(v){this._midtonesExposure=v,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(v){this._shadowsHue=v,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(v){this._shadowsDensity=v,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(v){this._shadowsSaturation=v,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(v){this._shadowsExposure=v,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";v._dirty&&(v._dirty=!1,v._getColorGradingDataToRef(v._globalHue,v._globalDensity,v._globalSaturation,v._globalExposure,v._globalCurve),v._getColorGradingDataToRef(v._highlightsHue,v._highlightsDensity,v._highlightsSaturation,v._highlightsExposure,v._tempColor),v._tempColor.multiplyToRef(v._globalCurve,v._highlightsCurve),v._getColorGradingDataToRef(v._midtonesHue,v._midtonesDensity,v._midtonesSaturation,v._midtonesExposure,v._tempColor),v._tempColor.multiplyToRef(v._globalCurve,v._midtonesCurve),v._getColorGradingDataToRef(v._shadowsHue,v._shadowsDensity,v._shadowsSaturation,v._shadowsExposure,v._tempColor),v._tempColor.multiplyToRef(v._globalCurve,v._shadowsCurve),v._highlightsCurve.subtractToRef(v._midtonesCurve,v._positiveCurve),v._midtonesCurve.subtractToRef(v._shadowsCurve,v._negativeCurve)),y&&(y.setFloat4(n,v._positiveCurve.r,v._positiveCurve.g,v._positiveCurve.b,v._positiveCurve.a),y.setFloat4(B,v._midtonesCurve.r,v._midtonesCurve.g,v._midtonesCurve.b,v._midtonesCurve.a),y.setFloat4(J,v._negativeCurve.r,v._negativeCurve.g,v._negativeCurve.b,v._negativeCurve.a))}_getColorGradingDataToRef(v,y,n,B,J){null!=v&&(v=a._Clamp(v,0,360),y=a._Clamp(y,-100,100),n=a._Clamp(n,-100,100),B=a._Clamp(B,-100,100),y=a._ApplyColorGradingSliderNonlinear(y),y*=.5,B=a._ApplyColorGradingSliderNonlinear(B),y<0&&(y*=-1,v=(v+180)%360),a._FromHSBToRef(v,y,50+.25*B,J),J.scaleToRef(2,J),J.a=1+.01*n)}static _ApplyColorGradingSliderNonlinear(v){v/=100;let y=Math.abs(v);return y=Math.pow(y,2),v<0&&(y*=-1),y*=100,y}static _FromHSBToRef(v,y,n,B){let J=a._Clamp(v,0,360);const P=a._Clamp(y/100,0,1),b=a._Clamp(n/100,0,1);if(0===P)B.r=b,B.g=b,B.b=b;else{J/=60;const v=Math.floor(J),y=J-v,n=b*(1-P),Y=b*(1-P*y),l=b*(1-P*(1-y));switch(v){case 0:B.r=b,B.g=l,B.b=n;break;case 1:B.r=Y,B.g=b,B.b=n;break;case 2:B.r=n,B.g=b,B.b=l;break;case 3:B.r=n,B.g=Y,B.b=b;break;case 4:B.r=l,B.g=n,B.b=b;break;default:B.r=b,B.g=n,B.b=Y}}B.a=1}static _Clamp(v,y,n){return Math.min(Math.max(v,y),n)}clone(){return Y.d.Clone((()=>new a),this)}serialize(){return Y.d.Serialize(this)}static Parse(v){return Y.d.Parse((()=>new a),v,null,null)}}a.PrepareUniforms=l.b,(0,B.c)([(0,J.M)()],a.prototype,"_globalHue",void 0),(0,B.c)([(0,J.M)()],a.prototype,"_globalDensity",void 0),(0,B.c)([(0,J.M)()],a.prototype,"_globalSaturation",void 0),(0,B.c)([(0,J.M)()],a.prototype,"_globalExposure",void 0),(0,B.c)([(0,J.M)()],a.prototype,"_highlightsHue",void 0),(0,B.c)([(0,J.M)()],a.prototype,"_highlightsDensity",void 0),(0,B.c)([(0,J.M)()],a.prototype,"_highlightsSaturation",void 0),(0,B.c)([(0,J.M)()],a.prototype,"_highlightsExposure",void 0),(0,B.c)([(0,J.M)()],a.prototype,"_midtonesHue",void 0),(0,B.c)([(0,J.M)()],a.prototype,"_midtonesDensity",void 0),(0,B.c)([(0,J.M)()],a.prototype,"_midtonesSaturation",void 0),(0,B.c)([(0,J.M)()],a.prototype,"_midtonesExposure",void 0),Y.d._ColorCurvesParser=a.Parse;var Z=n(10914),x=n(11117),f=n(10908);class N{constructor(){this.colorCurves=new a,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=N.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new b.e(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=N.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new P.e}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(v){this._colorCurvesEnabled!==v&&(this._colorCurvesEnabled=v,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(v){this._colorGradingTexture!==v&&(this._colorGradingTexture=v,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(v){this._colorGradingEnabled!==v&&(this._colorGradingEnabled=v,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(v){this._colorGradingWithGreenDepth!==v&&(this._colorGradingWithGreenDepth=v,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(v){this._colorGradingBGR!==v&&(this._colorGradingBGR=v,this._updateParameters())}get exposure(){return this._exposure}set exposure(v){this._exposure!==v&&(this._exposure=v,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(v){this._toneMappingEnabled!==v&&(this._toneMappingEnabled=v,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(v){this._toneMappingType!==v&&(this._toneMappingType=v,this._updateParameters())}get contrast(){return this._contrast}set contrast(v){this._contrast!==v&&(this._contrast=v,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(v){this.vignetteCenterY=v}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(v){this.vignetteCenterX=v}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(v){this._vignetteBlendMode!==v&&(this._vignetteBlendMode=v,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(v){this._vignetteEnabled!==v&&(this._vignetteEnabled=v,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(v){this._ditheringEnabled!==v&&(this._ditheringEnabled=v,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(v){this._ditheringIntensity!==v&&(this._ditheringIntensity=v,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(v){this._skipFinalColorClamp!==v&&(this._skipFinalColorClamp=v,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(v){this._applyByPostProcess!==v&&(this._applyByPostProcess=v,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(v){this._isEnabled!==v&&(this._isEnabled=v,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(v){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return v.VIGNETTE=!1,v.TONEMAPPING=0,v.CONTRAST=!1,v.EXPOSURE=!1,v.COLORCURVES=!1,v.COLORGRADING=!1,v.COLORGRADING3D=!1,v.DITHER=!1,v.IMAGEPROCESSING=!1,v.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(v.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(v.VIGNETTE=this.vignetteEnabled,v.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===N._VIGNETTEMODE_MULTIPLY,v.VIGNETTEBLENDMODEOPAQUE=!v.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case N.TONEMAPPING_KHR_PBR_NEUTRAL:v.TONEMAPPING=3;break;case N.TONEMAPPING_ACES:v.TONEMAPPING=2;break;default:v.TONEMAPPING=1}else v.TONEMAPPING=0;v.CONTRAST=1!==this.contrast,v.EXPOSURE=1!==this.exposure,v.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,v.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,v.COLORGRADING?v.COLORGRADING3D=this.colorGradingTexture.is3D:v.COLORGRADING3D=!1,v.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,v.SAMPLER3DBGRMAP=this.colorGradingBGR,v.DITHER=this._ditheringEnabled,v.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,v.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,v.IMAGEPROCESSING=v.VIGNETTE||!!v.TONEMAPPING||v.CONTRAST||v.EXPOSURE||v.COLORCURVES||v.COLORGRADING||v.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(v,y){if(this._colorCurvesEnabled&&this.colorCurves&&a.Bind(this.colorCurves,v),this._vignetteEnabled||this._ditheringEnabled){const n=1/v.getEngine().getRenderWidth(),B=1/v.getEngine().getRenderHeight();if(v.setFloat2("vInverseScreenSize",n,B),this._ditheringEnabled&&v.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const J=null!=y?y:B/n;let P=Math.tan(.5*this.vignetteCameraFov),b=P*J;const Y=Math.sqrt(b*P);b=(0,Z.n)(b,Y,this.vignetteStretch),P=(0,Z.n)(P,Y,this.vignetteStretch),v.setFloat4("vignetteSettings1",b,P,-b*this.vignetteCenterX,-P*this.vignetteCenterY);const l=-2*this.vignetteWeight;v.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,l)}}if(v.setFloat("exposureLinear",this.exposure),v.setFloat("contrast",this.contrast),this.colorGradingTexture){v.setTexture("txColorTransform",this.colorGradingTexture);const y=this.colorGradingTexture.getSize().height;v.setFloat4("colorTransformSettings",(y-1)/y,.5/y,y,this.colorGradingTexture.level)}}clone(){return Y.d.Clone((()=>new N),this)}serialize(){return Y.d.Serialize(this)}static Parse(v){const y=Y.d.Parse((()=>new N),v,null,null);return void 0!==v.vignetteCentreX&&(y.vignetteCenterX=v.vignetteCentreX),void 0!==v.vignetteCentreY&&(y.vignetteCenterY=v.vignetteCentreY),y}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}N.TONEMAPPING_STANDARD=0,N.TONEMAPPING_ACES=1,N.TONEMAPPING_KHR_PBR_NEUTRAL=2,N.PrepareUniforms=x.g,N.PrepareSamplers=x.e,N._VIGNETTEMODE_MULTIPLY=0,N._VIGNETTEMODE_OPAQUE=1,(0,B.c)([(0,J.i)()],N.prototype,"colorCurves",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_colorCurvesEnabled",void 0),(0,B.c)([(0,J.E)("colorGradingTexture")],N.prototype,"_colorGradingTexture",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_colorGradingEnabled",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_colorGradingWithGreenDepth",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_colorGradingBGR",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_exposure",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_toneMappingEnabled",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_toneMappingType",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_contrast",void 0),(0,B.c)([(0,J.M)()],N.prototype,"vignetteStretch",void 0),(0,B.c)([(0,J.M)()],N.prototype,"vignetteCenterX",void 0),(0,B.c)([(0,J.M)()],N.prototype,"vignetteCenterY",void 0),(0,B.c)([(0,J.M)()],N.prototype,"vignetteWeight",void 0),(0,B.c)([(0,J.m)()],N.prototype,"vignetteColor",void 0),(0,B.c)([(0,J.M)()],N.prototype,"vignetteCameraFov",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_vignetteBlendMode",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_vignetteEnabled",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_ditheringEnabled",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_ditheringIntensity",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_skipFinalColorClamp",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_applyByPostProcess",void 0),(0,B.c)([(0,J.M)()],N.prototype,"_isEnabled",void 0),Y.d._ImageProcessingConfigurationParser=N.Parse,(0,f.g)("BABYLON.ImageProcessingConfiguration",N)},11320:(v,y,n)=>{"use strict";n.d(y,{d:()=>x});var B=n(11050),J=n(11200),P=n(11055),b=n(11303),Y=n(11267),l=n(11327),a=n(11256);class Z extends Y.d{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class x extends l.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(v,"DetailMap",140,new Z,y),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=J.d.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=v._dirtyCallbacks[1]}isReadyForSubMesh(v,y,n){return!this._isEnabled||!(v._areTexturesDirty&&y.texturesEnabled&&n.getCaps().standardDerivatives&&this._texture&&b.b.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(v,y){if(this._isEnabled){v.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const n=y.getEngine();v._areTexturesDirty&&(n.getCaps().standardDerivatives&&this._texture&&b.b.DetailTextureEnabled&&this._isEnabled?((0,a.T)(this._texture,v,"DETAIL"),v.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):v.DETAIL=!1)}else v.DETAIL=!1}bindForSubMesh(v,y){if(!this._isEnabled)return;const n=this._material.isFrozen;v.useUbo&&n&&v.isSync||this._texture&&b.b.DetailTextureEnabled&&(v.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,a.w)(this._texture,v,"detail")),y.texturesEnabled&&this._texture&&b.b.DetailTextureEnabled&&v.setTexture("detailSampler",this._texture)}hasTexture(v){return this._texture===v}getActiveTextures(v){this._texture&&v.push(this._texture)}getAnimatables(v){this._texture&&this._texture.animations&&this._texture.animations.length>0&&v.push(this._texture)}dispose(v){var y;v&&(null===(y=this._texture)||void 0===y||y.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(v){v.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,B.c)([(0,P.E)("detailTexture"),(0,P.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"texture",void 0),(0,B.c)([(0,P.M)()],x.prototype,"diffuseBlendLevel",void 0),(0,B.c)([(0,P.M)()],x.prototype,"roughnessBlendLevel",void 0),(0,B.c)([(0,P.M)()],x.prototype,"bumpLevel",void 0),(0,B.c)([(0,P.M)(),(0,P.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"normalBlendMethod",void 0),(0,B.c)([(0,P.M)(),(0,P.d)("_markAllSubMeshesAsTexturesDirty")],x.prototype,"isEnabled",void 0)},11200:(v,y,n)=>{"use strict";n.d(y,{d:()=>c});var B=n(11050),J=n(11055),P=n(10791),b=n(10795),Y=n(10820),l=n(11202),a=n(11120),Z=n(10801),x=n(11180),f=n(11249),N=n(11110);class i{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(v){this._func=v}get funcRef(){return this._funcRef}set funcRef(v){this._funcRef=v}get funcMask(){return this._funcMask}set funcMask(v){this._funcMask=v}get opStencilFail(){return this._opStencilFail}set opStencilFail(v){this._opStencilFail=v}get opDepthFail(){return this._opDepthFail}set opDepthFail(v){this._opDepthFail=v}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(v){this._opStencilDepthPass=v}get mask(){return this._mask}set mask(v){this._mask=v}get enabled(){return this._enabled}set enabled(v){this._enabled=v}getClassName(){return"MaterialStencilState"}copyTo(v){N.d.Clone((()=>v),this)}serialize(){return N.d.Serialize(this)}parse(v,y,n){N.d.Parse((()=>this),v,y,n)}}(0,B.c)([(0,J.M)()],i.prototype,"func",null),(0,B.c)([(0,J.M)()],i.prototype,"funcRef",null),(0,B.c)([(0,J.M)()],i.prototype,"funcMask",null),(0,B.c)([(0,J.M)()],i.prototype,"opStencilFail",null),(0,B.c)([(0,J.M)()],i.prototype,"opDepthFail",null),(0,B.c)([(0,J.M)()],i.prototype,"opStencilDepthPass",null),(0,B.c)([(0,J.M)()],i.prototype,"mask",null),(0,B.c)([(0,J.M)()],i.prototype,"enabled",null);var g=n(11256);class c{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(v){if(this._alpha===v)return;const y=this._alpha;this._alpha=v,1!==y&&1!==v||this.eh(c.MiscDirtyFlag+c.PrePassDirtyFlag)}get alpha(){return this._alpha}set Ch(v){this._backFaceCulling!==v&&(this._backFaceCulling=v,this.eh(c.TextureDirtyFlag))}get Ch(){return this._backFaceCulling}set cullBackFaces(v){this._cullBackFaces!==v&&(this._cullBackFaces=v,this.eh(c.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(v){this._blockDirtyMechanism!==v&&(this._blockDirtyMechanism=v,v||this.rj())}atomicMaterialsUpdate(v){this.blockDirtyMechanism=!0;try{v(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(v){this._onDisposeObserver&&this.xj.remove(this._onDisposeObserver),this._onDisposeObserver=this.xj.add(v)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new b.e),this._onBindObservable}set onBind(v){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(v)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new b.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new b.e),this._onEffectCreatedObservable}set alphaMode(v){this._alphaMode!==v&&(this._alphaMode=v,this.eh(c.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(v){this._needDepthPrePass!==v&&(this._needDepthPrePass=v,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(v){this._fogEnabled!==v&&(this._fogEnabled=v,this.eh(c.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case c.WireFrameFillMode:case c.LineListDrawMode:case c.LineLoopDrawMode:case c.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(v){this.fillMode=v?c.WireFrameFillMode:c.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case c.PointFillMode:case c.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(v){this.fillMode=v?c.PointFillMode:c.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(v){this._fillMode!==v&&(this._fillMode=v,this.eh(c.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(v){const y=this.va().getEngine().getCaps().fragmentDepthSupported;v&&!y&&Z.e.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=v&&y,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(v){this._drawWrapper=v}constructor(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.xj=new b.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new i,this._useUBO=!1,this._fillMode=c.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=v;const J=y||Y.b.LastCreatedScene;J&&(this._scene=J,this._dirtyCallbacks={},this._forceGLSL=B,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=v||P.g.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new f.d(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new a.b(this._scene.getEngine(),void 0,void 0,v),this._useUBO=this.va().getEngine().supportsUniformBuffers,this._createUniformBuffer(),n||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),c.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var v;const y=this.va().getEngine();null===(v=this._uniformBuffer)||void 0===v||v.dispose(),y.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new a.b(y,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new a.b(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(v){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.rj(),this.checkReadyOnlyOnce=!0}unfreeze(){this.rj(),this.checkReadyOnlyOnce=!1}isReady(v,y){return!0}isReadyForSubMesh(v,y,n){const B=y.materialDefines;return!!B&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=B,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}va(){return this._scene}_getEffectiveOrientation(v){return null!==this.sideOrientation?this.sideOrientation:v.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(v){this._transparencyMode!==v&&(this._transparencyMode=v,this._forceAlphaTest=v===c.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===c.MATERIAL_OPAQUE||this._transparencyMode===c.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(v){return v.visibility<1||!this._disableAlphaBlending&&(v.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(v){return!this.needAlphaBlendingForMesh(v)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}rj(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y=this.va().meshes;for(const n of y)if(n.Ag)for(const y of n.Ag)if(y.Ha()===this)for(const n of y._drawWrappers)n&&this._materialContext===n.materialContext&&(n._wasPreviouslyReady=!1,n._wasPreviouslyUsingInstances=null,n._forceRebindOnNextCall=v);v&&this.eh(c.AllDirtyFlag)}_preBind(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this._scene.getEngine(),B=(null==y?this.sideOrientation:y)===c.ClockWiseSideOrientation;return n.enableEffect(v||this._getDrawWrapper()),n.setState(this.Ch,this.zOffset,!1,B,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),B}bind(v,y){}buildUniformLayout(){const v=this._uniformBuffer;this._eventInfo.ubo=v,this._callbackPluginEventGeneric(8,this._eventInfo),v.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(v,y,n){const B=n._drawWrapper;this._eventInfo.subMesh=n,this._callbackPluginEventBindForSubMesh(this._eventInfo),B._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(v){}bindView(v){this._useUBO?this._needToBindSceneUbo=!0:v.setMatrix("view",this.va().getViewMatrix())}bindViewProjection(v){this._useUBO?this._needToBindSceneUbo=!0:(v.setMatrix("viewProjection",this.va().getTransformMatrix()),v.setMatrix("projection",this.va().getProjectionMatrix()))}bindEyePosition(v,y){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(v,y)}_afterBind(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&y&&(this._needToBindSceneUbo=!1,(0,g.t)(y,this.va().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=v?v.visibility:1,this._onBindObservable&&v&&this._onBindObservable.notifyObservers(v),this.disableDepthWrite){const v=this._scene.getEngine();this._cachedDepthWriteState=v.getDepthWrite(),v.setDepthWrite(!1)}if(this.disableColorWrite){const v=this._scene.getEngine();this._cachedColorWriteState=v.getColorWrite(),v.setColorWrite(!1)}if(0!==this.depthFunction){const v=this._scene.getEngine();this._cachedDepthFunctionState=v.getDepthFunction()||0,v.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(v){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=v,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(v){return null}_clonePlugins(v,y){const n={};if(this._serializePlugins(n),c._ParsePlugins(n,v,this._scene,y),this.pluginManager)for(const B of this.pluginManager._plugins){const y=v.pluginManager.getPlugin(B.name);y&&B.copyTo(y)}}getBindedMeshes(){if(this.meshMap){const v=[];for(const y in this.meshMap){const n=this.meshMap[y];n&&v.push(n)}return v}return this._scene.meshes.filter((v=>v.material===this))}forceCompilation(v,y,n,B){const J={clipPlane:!1,useInstances:!1,...n},P=this.va(),b=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const Y=()=>{if(!this._scene||!this._scene.getEngine())return;const n=P.clipPlane;if(J.clipPlane&&(P.clipPlane=new x.e(0,0,0,1)),this._storeEffectOnSubMeshes){let n=!0,P=null;if(v.Ag){const y=new l.d(0,0,0,0,0,v,void 0,!1,!1);y.materialDefines&&(y.materialDefines._renderId=-1),this.isReadyForSubMesh(v,y,J.useInstances)||(y.effect&&y.effect.getCompilationError()&&y.effect.allFallbacksProcessed()?P=y.effect.getCompilationError():(n=!1,setTimeout(Y,16)))}n&&(this.allowShaderHotSwapping=b,P&&B&&B(P),y&&y(this))}else this.isReady()?(this.allowShaderHotSwapping=b,y&&y(this)):setTimeout(Y,16);J.clipPlane&&(P.clipPlane=n)};Y()}forceCompilationAsync(v,y){return new Promise(((n,B)=>{this.forceCompilation(v,(()=>{n()}),y,(v=>{B(v)}))}))}eh(v){this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(c._DirtyCallbackArray.length=0,v&c.TextureDirtyFlag&&c._DirtyCallbackArray.push(c._TextureDirtyCallBack),v&c.LightDirtyFlag&&c._DirtyCallbackArray.push(c._LightsDirtyCallBack),v&c.FresnelDirtyFlag&&c._DirtyCallbackArray.push(c._FresnelDirtyCallBack),v&c.AttributesDirtyFlag&&c._DirtyCallbackArray.push(c._AttributeDirtyCallBack),v&c.MiscDirtyFlag&&c._DirtyCallbackArray.push(c._MiscDirtyCallBack),v&c.PrePassDirtyFlag&&c._DirtyCallbackArray.push(c._PrePassDirtyCallBack),c._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(c._RunDirtyCallBacks),this.va().resetCachedMaterial())}resetDrawCache(){const v=this.va().meshes;for(const y of v)if(y.Ag)for(const v of y.Ag)v.Ha()===this&&v.resetDrawCache()}_markAllSubMeshesAsDirty(v){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const y=this.va().meshes;for(const n of y)if(n.Ag)for(const y of n.Ag)if(y.Ha(!1)===this)for(const n of y._drawWrappers)n&&n.defines&&n.defines.markAllAsDirty&&this._materialContext===n.materialContext&&v(n.defines)}_markScenePrePassDirty(){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const v=this.va().enablePrePassRenderer();v&&v.eh()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(c._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(c._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(c._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(c._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(c._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(c._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(c._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(c._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(c._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(c._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const v=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.xj.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(v)}))}}setPrePassRenderer(v){return!1}dispose(v,y,n){const B=this.va();if(B.stopAnimation(this),B.freeProcessedMaterials(),B.removeMaterial(this),this._eventInfo.forceDisposeTextures=y,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const v=this._parentContainer.materials.indexOf(this);v>-1&&this._parentContainer.materials.splice(v,1),this._parentContainer=null}if(!0!==n)if(this.meshMap)for(const J in this.meshMap){const y=this.meshMap[J];y&&(y.material=null,this.releaseVertexArrayObject(y,v))}else{const y=B.meshes;for(const n of y)n.material!==this||n.sourceMesh||(n.material=null,this.releaseVertexArrayObject(n,v))}this._uniformBuffer.dispose(),v&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.xj.notifyObservers(this),this.xj.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(v,y){const n=v.Rj;if(n)if(this._storeEffectOnSubMeshes){if(v.Ag)for(const B of v.Ag)n._releaseVertexArrayObject(B.effect),y&&B.effect&&B.effect.dispose()}else n._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const v=N.d.Serialize(this);return v.stencil=this.stencil.serialize(),v.uniqueId=this.uniqueId,this._serializePlugins(v),v}_serializePlugins(v){if(v.plugins={},this.pluginManager)for(const y of this.pluginManager._plugins)v.plugins[y.getClassName()]=y.serialize()}static Parse(v,y,n){if(v.customType){if("BABYLON.PBRMaterial"===v.customType&&v.overloadedAlbedo&&(v.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return Z.e.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else v.customType="BABYLON.StandardMaterial";const B=P.g.Instantiate(v.customType).Parse(v,y,n);return B._loadedUniqueId=v.uniqueId,B}static _ParsePlugins(v,y,n,B){if(v.plugins)for(const Y in v.plugins){var J,b;const l=v.plugins[Y];let a=null===(J=y.pluginManager)||void 0===J?void 0:J.getPlugin(l.name);if(!a){const v=P.g.Instantiate("BABYLON."+Y);v&&(a=new v(y))}null===(b=a)||void 0===b||b.parse(l,n,B)}}}c.TriangleFillMode=0,c.WireFrameFillMode=1,c.PointFillMode=2,c.PointListDrawMode=3,c.LineListDrawMode=4,c.LineLoopDrawMode=5,c.LineStripDrawMode=6,c.TriangleStripDrawMode=7,c.TriangleFanDrawMode=8,c.ClockWiseSideOrientation=0,c.CounterClockWiseSideOrientation=1,c.TextureDirtyFlag=1,c.LightDirtyFlag=2,c.FresnelDirtyFlag=4,c.AttributesDirtyFlag=8,c.MiscDirtyFlag=16,c.PrePassDirtyFlag=32,c.AllDirtyFlag=63,c.MATERIAL_OPAQUE=0,c.MATERIAL_ALPHATEST=1,c.MATERIAL_ALPHABLEND=2,c.MATERIAL_ALPHATESTANDBLEND=3,c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,c.MATERIAL_NORMALBLENDMETHOD_RNM=1,c.OnEventObservable=new b.e,c._AllDirtyCallBack=v=>v.markAllAsDirty(),c._ImageProcessingDirtyCallBack=v=>v.markAsImageProcessingDirty(),c._TextureDirtyCallBack=v=>v.markAsTexturesDirty(),c._FresnelDirtyCallBack=v=>v.markAsFresnelDirty(),c._MiscDirtyCallBack=v=>v.markAsMiscDirty(),c._PrePassDirtyCallBack=v=>v.markAsPrePassDirty(),c._LightsDirtyCallBack=v=>v.markAsLightDirty(),c._AttributeDirtyCallBack=v=>v.markAsAttributesDirty(),c._FresnelAndMiscDirtyCallBack=v=>{c._FresnelDirtyCallBack(v),c._MiscDirtyCallBack(v)},c._TextureAndMiscDirtyCallBack=v=>{c._TextureDirtyCallBack(v),c._MiscDirtyCallBack(v)},c._DirtyCallbackArray=[],c._RunDirtyCallBacks=v=>{for(const y of c._DirtyCallbackArray)y(v)},(0,B.c)([(0,J.M)()],c.prototype,"id",void 0),(0,B.c)([(0,J.M)()],c.prototype,"uniqueId",void 0),(0,B.c)([(0,J.M)()],c.prototype,"name",void 0),(0,B.c)([(0,J.M)()],c.prototype,"metadata",void 0),(0,B.c)([(0,J.M)()],c.prototype,"checkReadyOnEveryCall",void 0),(0,B.c)([(0,J.M)()],c.prototype,"checkReadyOnlyOnce",void 0),(0,B.c)([(0,J.M)()],c.prototype,"state",void 0),(0,B.c)([(0,J.M)("alpha")],c.prototype,"_alpha",void 0),(0,B.c)([(0,J.M)("Ch")],c.prototype,"_backFaceCulling",void 0),(0,B.c)([(0,J.M)("cullBackFaces")],c.prototype,"_cullBackFaces",void 0),(0,B.c)([(0,J.M)()],c.prototype,"sideOrientation",void 0),(0,B.c)([(0,J.M)("alphaMode")],c.prototype,"_alphaMode",void 0),(0,B.c)([(0,J.M)()],c.prototype,"_needDepthPrePass",void 0),(0,B.c)([(0,J.M)()],c.prototype,"disableDepthWrite",void 0),(0,B.c)([(0,J.M)()],c.prototype,"disableColorWrite",void 0),(0,B.c)([(0,J.M)()],c.prototype,"forceDepthWrite",void 0),(0,B.c)([(0,J.M)()],c.prototype,"depthFunction",void 0),(0,B.c)([(0,J.M)()],c.prototype,"separateCullingPass",void 0),(0,B.c)([(0,J.M)("fogEnabled")],c.prototype,"_fogEnabled",void 0),(0,B.c)([(0,J.M)()],c.prototype,"pointSize",void 0),(0,B.c)([(0,J.M)()],c.prototype,"zOffset",void 0),(0,B.c)([(0,J.M)()],c.prototype,"zOffsetUnits",void 0),(0,B.c)([(0,J.M)()],c.prototype,"pointsCloud",null),(0,B.c)([(0,J.M)()],c.prototype,"fillMode",null),(0,B.c)([(0,J.M)()],c.prototype,"useLogarithmicDepth",null),(0,B.c)([(0,J.M)()],c.prototype,"transparencyMode",null)},11267:(v,y,n)=>{"use strict";n.d(y,{d:()=>B});class B{constructor(v){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=v,v)for(const y in v)Object.prototype.hasOwnProperty.call(v,y)&&this._setDefaultValue(y)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||v,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const v of Object.keys(this))"_"!==v[0]&&this._keys.push(v);if(this._externalProperties)for(const v in this._externalProperties)-1===this._keys.indexOf(v)&&this._keys.push(v)}isEqual(v){if(this._keys.length!==v._keys.length)return!1;for(let y=0;y<this._keys.length;y++){const n=this._keys[y];if(this[n]!==v[n])return!1}return!0}cloneTo(v){this._keys.length!==v._keys.length&&(v._keys=this._keys.slice(0));for(let y=0;y<this._keys.length;y++){const n=this._keys[y];v[n]=this[n]}}reset(){this._keys.forEach((v=>this._setDefaultValue(v)))}_setDefaultValue(v){var y,n,B,J;const P=(null===(y=this._externalProperties)||void 0===y||null===(n=y[v])||void 0===n?void 0:n.type)??typeof this[v],b=null===(B=this._externalProperties)||void 0===B||null===(J=B[v])||void 0===J?void 0:J.default;switch(P){case"number":this[v]=b??0;break;case"string":this[v]=b??"";break;default:this[v]=b??!1}}toString(){let v="";for(let y=0;y<this._keys.length;y++){const n=this._keys[y],B=this[n];switch(typeof B){case"number":case"string":v+="#define "+n+" "+B+"\n";break;default:B&&(v+="#define "+n+"\n")}}return v}}},11303:(v,y,n)=>{"use strict";n.d(y,{b:()=>J});var B=n(10849);class J{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(v){this._DiffuseTextureEnabled!==v&&(this._DiffuseTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(v){this._DetailTextureEnabled!==v&&(this._DetailTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(v){this._DecalMapEnabled!==v&&(this._DecalMapEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(v){this._AmbientTextureEnabled!==v&&(this._AmbientTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(v){this._OpacityTextureEnabled!==v&&(this._OpacityTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(v){this._ReflectionTextureEnabled!==v&&(this._ReflectionTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(v){this._EmissiveTextureEnabled!==v&&(this._EmissiveTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(v){this._SpecularTextureEnabled!==v&&(this._SpecularTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(v){this._BumpTextureEnabled!==v&&(this._BumpTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(v){this._LightmapTextureEnabled!==v&&(this._LightmapTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(v){this._RefractionTextureEnabled!==v&&(this._RefractionTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(v){this._ColorGradingTextureEnabled!==v&&(this._ColorGradingTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(v){this._FresnelEnabled!==v&&(this._FresnelEnabled=v,B.c.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(v){this._ClearCoatTextureEnabled!==v&&(this._ClearCoatTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(v){this._ClearCoatBumpTextureEnabled!==v&&(this._ClearCoatBumpTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(v){this._ClearCoatTintTextureEnabled!==v&&(this._ClearCoatTintTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(v){this._SheenTextureEnabled!==v&&(this._SheenTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(v){this._AnisotropicTextureEnabled!==v&&(this._AnisotropicTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(v){this._ThicknessTextureEnabled!==v&&(this._ThicknessTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(v){this._RefractionIntensityTextureEnabled!==v&&(this._RefractionIntensityTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(v){this._TranslucencyIntensityTextureEnabled!==v&&(this._TranslucencyIntensityTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(v){this._TranslucencyColorTextureEnabled!==v&&(this._TranslucencyColorTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(v){this._IridescenceTextureEnabled!==v&&(this._IridescenceTextureEnabled=v,B.c.MarkAllMaterialsAsDirty(1))}}J._DiffuseTextureEnabled=!0,J._DetailTextureEnabled=!0,J._DecalMapEnabled=!0,J._AmbientTextureEnabled=!0,J._OpacityTextureEnabled=!0,J._ReflectionTextureEnabled=!0,J._EmissiveTextureEnabled=!0,J._SpecularTextureEnabled=!0,J._BumpTextureEnabled=!0,J._LightmapTextureEnabled=!0,J._RefractionTextureEnabled=!0,J._ColorGradingTextureEnabled=!0,J._FresnelEnabled=!0,J._ClearCoatTextureEnabled=!0,J._ClearCoatBumpTextureEnabled=!0,J._ClearCoatTintTextureEnabled=!0,J._SheenTextureEnabled=!0,J._AnisotropicTextureEnabled=!0,J._ThicknessTextureEnabled=!0,J._RefractionIntensityTextureEnabled=!0,J._TranslucencyIntensityTextureEnabled=!0,J._TranslucencyColorTextureEnabled=!0,J._IridescenceTextureEnabled=!0},11256:(v,y,n)=>{"use strict";n.d(y,{D:()=>C,H:()=>r,K:()=>x,M:()=>t,N:()=>L,Q:()=>d,T:()=>g,X:()=>O,_:()=>G,bb:()=>R,e:()=>E,fb:()=>F,gb:()=>w,h:()=>Z,hb:()=>f,j:()=>s,m:()=>a,q:()=>N,t:()=>i,w:()=>c,y:()=>u,z:()=>h});var B=n(10801),J=n(11103),P=n(10820),b=n(11186),Y=n(11262);const l=J.d.Black();function a(v,y,n){if(!v||v.LOGARITHMICDEPTH||v.indexOf&&v.indexOf("LOGARITHMICDEPTH")>=0){const v=n.activeCamera;1===v.mode&&B.e.Error("Logarithmic depth is not compatible with orthographic cameras!",20),y.setFloat("logarithmicDepthConstant",2/(Math.log(v.maxZ+1)/Math.LN2))}}function Z(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n&&v.fogEnabled&&(!y||y.applyFog)&&0!==v.fogMode&&(n.setFloat4("vFogInfos",v.fogMode,v.fogStart,v.fogEnd,v.fogDensity),B?(v.fogColor.toLinearSpaceToRef(l,v.getEngine().useExactSrgbConversions),n.setColor3("vFogColor",l)):n.setColor3("vFogColor",v.fogColor))}function x(v,y,n){const J=n.NUM_MORPH_INFLUENCERS;if(J>0&&P.b.LastCreatedEngine){const b=P.b.LastCreatedEngine.getCaps().maxVertexAttribs,Y=y.morphTargetManager;if(null!==Y&&void 0!==Y&&Y.isUsingTextureForTargets)return;const l=Y&&Y.supportsNormals&&n.NORMAL,a=Y&&Y.supportsTangents&&n.TANGENT,Z=Y&&Y.supportsUVs&&n.UV1;for(let n=0;n<J;n++)v.push("position"+n),l&&v.push("normal"+n),a&&v.push("tangent"+n),Z&&v.push("uv_"+n),v.length>b&&B.e.Error("Cannot add more vertex attributes for mesh "+y.name)}}function f(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v.push("world0"),v.push("world1"),v.push("world2"),v.push("world3"),y&&(v.push("previousWorld0"),v.push("previousWorld1"),v.push("previousWorld2"),v.push("previousWorld3"))}function N(v,y){const n=v.morphTargetManager;v&&n&&y.setFloatArray("morphTargetInfluences",n.influences)}function i(v,y){y.bindToEffect(v,"Scene")}function g(v,y,n){y._needUVs=!0,y[n]=!0,v.optimizeUVAllocation&&v.getTextureMatrix().isIdentityAs3x2()?(y[n+"DIRECTUV"]=v.coordinatesIndex+1,y["MAINUV"+(v.coordinatesIndex+1)]=!0):y[n+"DIRECTUV"]=0}function c(v,y,n){const B=v.getTextureMatrix();y.Vj(n+"Matrix",B)}function h(v,y,n){n.BAKED_VERTEX_ANIMATION_TEXTURE&&n.INSTANCES&&v.push("bakedVertexAnimationSettingsInstanced")}function E(v,y,n){var B;if(y&&v&&(v.computeBonesUsingShaders&&y._bonesComputationForcedToCPU&&(v.computeBonesUsingShaders=!1),v.useBones&&v.computeBonesUsingShaders&&v.skeleton)){const J=v.skeleton;if(J.isUsingTextureForMatrices&&y.getUniformIndex("boneTextureWidth")>-1){const n=J.getTransformMatrixTexture(v);y.setTexture("boneSampler",n),y.setFloat("boneTextureWidth",4*(J.bones.length+1))}else{const P=J.getTransformMatrices(v);P&&(y.setMatrices("mBones",P),n&&v.va().prePassRenderer&&v.va().prePassRenderer.getIndex(2)&&(n.previousBones[v.uniqueId]||(n.previousBones[v.uniqueId]=P.slice()),y.setMatrices("mPreviousBones",n.previousBones[v.uniqueId]),B=P,n.previousBones[v.uniqueId].set(B)))}}}function W(v,y,n,B,J){let P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];v._bindLight(y,n,B,J,P)}function s(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const P=Math.min(y.lightSources.length,J);for(let b=0;b<P;b++){W(y.lightSources[b],b,v,n,"boolean"===typeof B?B:B.SPECULARTERM,y.receiveShadows)}}function C(v,y,n,B){n.NUM_BONE_INFLUENCERS>0&&(B.addCPUSkinningFallback(0,y),v.push("matricesIndices"),v.push("matricesWeights"),n.NUM_BONE_INFLUENCERS>4&&(v.push("matricesIndicesExtra"),v.push("matricesWeightsExtra")))}function r(v,y){(y.INSTANCES||y.THIN_INSTANCES)&&f(v,!!y.PREPASS_VELOCITY),y.INSTANCESCOLOR&&v.push("instanceColor")}function u(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,J=0;for(let P=0;P<n&&v["LIGHT"+P];P++)P>0&&(J=B+P,y.addFallback(J,"LIGHT"+P)),v.SHADOWS||(v["SHADOW"+P]&&y.addFallback(B,"SHADOW"+P),v["SHADOWPCF"+P]&&y.addFallback(B,"SHADOWPCF"+P),v["SHADOWPCSS"+P]&&y.addFallback(B,"SHADOWPCSS"+P),v["SHADOWPOISSON"+P]&&y.addFallback(B,"SHADOWPOISSON"+P),v["SHADOWESM"+P]&&y.addFallback(B,"SHADOWESM"+P),v["SHADOWCLOSEESM"+P]&&y.addFallback(B,"SHADOWCLOSEESM"+P));return J++}function O(v,y,n,B,J,P,b){let Y=arguments.length>7&&void 0!==arguments[7]&&arguments[7];b._areMiscDirty&&(b.LOGARITHMICDEPTH=n,b.POINTSIZE=B,b.FOG=J&&function(v,y){return y.fogEnabled&&v.applyFog&&0!==y.fogMode}(v,y),b.NONUNIFORMSCALING=v.nonUniformScaling,b.ALPHATEST=P,b.DECAL_AFTER_DETAIL=Y)}function d(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!n._areLightsDirty)return n._needNormals;let b=0;const Y={needNormals:n._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(v.lightsEnabled&&!P)for(const a of y.lightSources)if(q(v,y,a,b,n,B,Y),b++,b===J)break;n.SPECULARTERM=Y.specularEnabled,n.SHADOWS=Y.shadowEnabled;for(let a=b;a<J;a++)void 0!==n["LIGHT"+a]&&(n["LIGHT"+a]=!1,n["HEMILIGHT"+a]=!1,n["POINTLIGHT"+a]=!1,n["DIRLIGHT"+a]=!1,n["SPOTLIGHT"+a]=!1,n["SHADOW"+a]=!1,n["SHADOWCSM"+a]=!1,n["SHADOWCSMDEBUG"+a]=!1,n["SHADOWCSMNUM_CASCADES"+a]=!1,n["SHADOWCSMUSESHADOWMAXZ"+a]=!1,n["SHADOWCSMNOBLEND"+a]=!1,n["SHADOWCSM_RIGHTHANDED"+a]=!1,n["SHADOWPCF"+a]=!1,n["SHADOWPCSS"+a]=!1,n["SHADOWPOISSON"+a]=!1,n["SHADOWESM"+a]=!1,n["SHADOWCLOSEESM"+a]=!1,n["SHADOWCUBE"+a]=!1,n["SHADOWLOWQUALITY"+a]=!1,n["SHADOWMEDIUMQUALITY"+a]=!1);const l=v.getEngine().getCaps();return void 0===n.SHADOWFLOAT&&(Y.needRebuild=!0),n.SHADOWFLOAT=Y.shadowEnabled&&(l.textureFloatRender&&l.textureFloatLinearFiltering||l.textureHalfFloatRender&&l.textureHalfFloatLinearFiltering),n.LIGHTMAPEXCLUDED=Y.lightmapMode,Y.needRebuild&&n.rebuild(),Y.needNormals}function q(v,y,n,B,J,P,Y){switch(Y.needNormals=!0,void 0===J["LIGHT"+B]&&(Y.needRebuild=!0),J["LIGHT"+B]=!0,J["SPOTLIGHT"+B]=!1,J["HEMILIGHT"+B]=!1,J["POINTLIGHT"+B]=!1,J["DIRLIGHT"+B]=!1,n.prepareLightSpecificDefines(J,B),J["LIGHT_FALLOFF_PHYSICAL"+B]=!1,J["LIGHT_FALLOFF_GLTF"+B]=!1,J["LIGHT_FALLOFF_STANDARD"+B]=!1,n.falloffType){case b.e.FALLOFF_GLTF:J["LIGHT_FALLOFF_GLTF"+B]=!0;break;case b.e.FALLOFF_PHYSICAL:J["LIGHT_FALLOFF_PHYSICAL"+B]=!0;break;case b.e.FALLOFF_STANDARD:J["LIGHT_FALLOFF_STANDARD"+B]=!0}if(P&&!n.Rh.equalsFloats(0,0,0)&&(Y.specularEnabled=!0),J["SHADOW"+B]=!1,J["SHADOWCSM"+B]=!1,J["SHADOWCSMDEBUG"+B]=!1,J["SHADOWCSMNUM_CASCADES"+B]=!1,J["SHADOWCSMUSESHADOWMAXZ"+B]=!1,J["SHADOWCSMNOBLEND"+B]=!1,J["SHADOWCSM_RIGHTHANDED"+B]=!1,J["SHADOWPCF"+B]=!1,J["SHADOWPCSS"+B]=!1,J["SHADOWPOISSON"+B]=!1,J["SHADOWESM"+B]=!1,J["SHADOWCLOSEESM"+B]=!1,J["SHADOWCUBE"+B]=!1,J["SHADOWLOWQUALITY"+B]=!1,J["SHADOWMEDIUMQUALITY"+B]=!1,y&&y.receiveShadows&&v.shadowsEnabled&&n.shadowEnabled){const y=n.getShadowGenerator(v.activeCamera)??n.getShadowGenerator();if(y){const v=y.getShadowMap();v&&v.renderList&&v.renderList.length>0&&(Y.shadowEnabled=!0,y.prepareDefines(J,B))}}n.lightmapMode!=b.e.LIGHTMAP_DEFAULT?(Y.lightmapMode=!0,J["LIGHTMAPEXCLUDED"+B]=!0,J["LIGHTMAPNOSPECULAR"+B]=n.lightmapMode==b.e.LIGHTMAP_SHADOWSONLY):(J["LIGHTMAPEXCLUDED"+B]=!1,J["LIGHTMAPNOSPECULAR"+B]=!1)}function L(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=function(v,y){let n=!1;if(v.activeCamera){const B=y.CAMERA_ORTHOGRAPHIC?1:0,J=y.CAMERA_PERSPECTIVE?1:0,P=1===v.activeCamera.mode?1:0,b=0===v.activeCamera.mode?1:0;(B^P||J^b)&&(y.CAMERA_ORTHOGRAPHIC=1===P,y.CAMERA_PERSPECTIVE=1===b,n=!0)}return n}(v,B);!1!==P&&(l=(0,Y.j)(n,v,B)),B.DEPTHPREPASS!==!y.getColorWrite()&&(B.DEPTHPREPASS=!B.DEPTHPREPASS,l=!0),B.INSTANCES!==J&&(B.INSTANCES=J,l=!0),B.THIN_INSTANCES!==b&&(B.THIN_INSTANCES=b,l=!0),l&&B.markAsUnprocessed()}function t(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]&&arguments[4],P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],b=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!y._areAttributesDirty&&y._needNormals===y._normals&&y._needUVs===y._uvs)return!1;y._normals=y._needNormals,y._uvs=y._needUVs,y.NORMAL=y._needNormals&&v.isVerticesDataPresent("normal"),y._needNormals&&v.isVerticesDataPresent("tangent")&&(y.TANGENT=!0);for(let Y=1;Y<=6;++Y)y["UV"+Y]=!!y._needUVs&&v.isVerticesDataPresent(`uv${1===Y?"":Y}`);if(n){const n=v.useVertexColors&&v.isVerticesDataPresent("color");y.VERTEXCOLOR=n,y.VERTEXALPHA=v.hasVertexAlpha&&n&&P}return v.isVerticesDataPresent("instanceColor")&&(v.hasInstances||v.hasThinInstances)&&(y.INSTANCESCOLOR=!0),B&&function(v,y){if(v.useBones&&v.computeBonesUsingShaders&&v.skeleton){y.NUM_BONE_INFLUENCERS=v.numBoneInfluencers;const n=void 0!==y.BONETEXTURE;if(v.skeleton.isUsingTextureForMatrices&&n)y.BONETEXTURE=!0;else{y.BonesPerMesh=v.skeleton.bones.length+1,y.BONETEXTURE=!n&&void 0;const B=v.va().prePassRenderer;if(B&&B.enabled){const n=-1===B.excludedSkinnedMesh.indexOf(v);y.BONES_VELOCITY_ENABLED=n}}}else y.NUM_BONE_INFLUENCERS=0,y.BonesPerMesh=0,void 0!==y.BONETEXTURE&&(y.BONETEXTURE=!1)}(v,y),J&&function(v,y){const n=v.morphTargetManager;n?(y.MORPHTARGETS_UV=n.supportsUVs&&y.UV1,y.MORPHTARGETS_TANGENT=n.supportsTangents&&y.TANGENT,y.MORPHTARGETS_NORMAL=n.supportsNormals&&y.NORMAL,y.NUM_MORPH_INFLUENCERS=n.numMaxInfluencers||n.numInfluencers,y.MORPHTARGETS=y.NUM_MORPH_INFLUENCERS>0,y.MORPHTARGETS_TEXTURE=n.isUsingTextureForTargets):(y.MORPHTARGETS_UV=!1,y.MORPHTARGETS_TANGENT=!1,y.MORPHTARGETS_NORMAL=!1,y.MORPHTARGETS=!1,y.NUM_MORPH_INFLUENCERS=0)}(v,y),b&&function(v,y){const n=v.bakedVertexAnimationManager;y.BAKED_VERTEX_ANIMATION_TEXTURE=!(!n||!n.isEnabled)}(v,y),!0}function G(v,y){if(v.activeCamera){const n=y.MULTIVIEW;y.MULTIVIEW=null!==v.activeCamera.outputRenderTarget&&v.activeCamera.outputRenderTarget.getViewCount()>1,y.MULTIVIEW!=n&&y.markAsUnprocessed()}}function R(v,y,n){const B=y.ORDER_INDEPENDENT_TRANSPARENCY,J=y.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;y.ORDER_INDEPENDENT_TRANSPARENCY=v.useOrderIndependentTransparency&&n,y.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!v.getEngine().getCaps().textureFloatLinearFiltering,B===y.ORDER_INDEPENDENT_TRANSPARENCY&&J===y.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||y.markAsUnprocessed()}function F(v,y,n){const B=y.PREPASS;if(!y._arePrePassDirty)return;const J=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(v.prePassRenderer&&v.prePassRenderer.enabled&&n){y.PREPASS=!0,y.SCENE_MRT_COUNT=v.prePassRenderer.mrtCount,y.PREPASS_NORMAL_WORLDSPACE=v.prePassRenderer.generateNormalsInWorldSpace,y.PREPASS_COLOR=!0,y.PREPASS_COLOR_INDEX=0;for(let n=0;n<J.length;n++){const B=v.prePassRenderer.getIndex(J[n].type);-1!==B?(y[J[n].define]=!0,y[J[n].index]=B):y[J[n].define]=!1}}else{y.PREPASS=!1;for(let v=0;v<J.length;v++)y[J[v].define]=!1}y.PREPASS!=B&&(y.markAsUnprocessed(),y.markAsImageProcessingDirty())}function S(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];J&&J.push("Light"+v),P||(y.push("vLightData"+v,"vLightDiffuse"+v,"vLightSpecular"+v,"vLightDirection"+v,"vLightFalloff"+v,"vLightGround"+v,"lightMatrix"+v,"shadowsInfo"+v,"depthValues"+v),n.push("shadowTexture"+v),n.push("depthTexture"+v),y.push("viewFrustumZ"+v,"cascadeBlendFactor"+v,"lightSizeUVCorrection"+v,"depthCorrection"+v,"penumbraDarkness"+v,"frustumLengths"+v),B&&(n.push("projectionLightTexture"+v),y.push("textureProjectionMatrix"+v)))}function w(v,y,n){let B,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,P=null;if(v.uniformsNames){const b=v;B=b.uniformsNames,P=b.uniformBuffersNames,y=b.samplers,n=b.defines,J=b.maxSimultaneousLights||0}else B=v,y||(y=[]);for(let b=0;b<J&&n["LIGHT"+b];b++)S(b,B,y,n["PROJECTEDLIGHTTEXTURE"+b],P);n.NUM_MORPH_INFLUENCERS&&(B.push("morphTargetInfluences"),B.push("morphTargetCount")),n.BAKED_VERTEX_ANIMATION_TEXTURE&&(B.push("bakedVertexAnimationSettings"),B.push("bakedVertexAnimationTextureSizeInverted"),B.push("bakedVertexAnimationTime"),y.push("bakedVertexAnimationTexture"))}},11336:(v,y,n)=>{"use strict";n.d(y,{b:()=>P});var B,J=n(11081);!function(v){v[v.Zero=0]="Zero",v[v.One=1]="One",v[v.MaxViewZ=2]="MaxViewZ"}(B||(B={}));class P{static CreateConfiguration(v){return P._Configurations[v]={defines:{},previousWorldMatrices:{},previousViewProjection:J.d.Zero(),currentViewProjection:J.d.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},P._Configurations[v]}static DeleteConfiguration(v){delete P._Configurations[v]}static GetConfiguration(v){return P._Configurations[v]}static AddUniformsAndSamplers(v,y){v.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(v,y){for(const n of y)if(n.Ag)for(const y of n.Ag)y._removeDrawWrapper(v)}static PrepareDefines(v,y,n){if(!n._arePrePassDirty)return;const B=P._Configurations[v];if(!B)return;n.PREPASS=!0,n.PREPASS_COLOR=!1,n.PREPASS_COLOR_INDEX=-1;let J=0;for(let b=0;b<P.GeometryTextureDescriptions.length;b++){const v=P.GeometryTextureDescriptions[b],y=v.define,Y=v.defineIndex,l=B.defines[Y];void 0!==l?(n[y]=!0,n[Y]=l,J++):(n[y]=!1,delete n[Y])}n.SCENE_MRT_COUNT=J,n.BONES_VELOCITY_ENABLED=y.useBones&&y.computeBonesUsingShaders&&y.skeleton&&!y.skeleton.isUsingTextureForMatrices&&-1===B.excludedSkinnedMesh.indexOf(y)}static Bind(v,y,n,B){const J=P._Configurations[v];if(J&&(void 0!==J.defines.PREPASS_VELOCITY_INDEX||void 0!==J.defines.PREPASS_VELOCITY_LINEAR_INDEX)){J.previousWorldMatrices[n.uniqueId]||(J.previousWorldMatrices[n.uniqueId]=B.clone());const v=n.va();J.previousViewProjection||(J.previousViewProjection=v.getTransformMatrix().clone(),J.currentViewProjection=v.getTransformMatrix().clone());const P=v.getEngine();if(J.currentViewProjection.updateFlag!==v.getTransformMatrix().updateFlag?(J.lastUpdateFrameId=P.frameId,J.previousViewProjection.p(J.currentViewProjection),J.currentViewProjection.p(v.getTransformMatrix())):J.lastUpdateFrameId!==P.frameId&&(J.lastUpdateFrameId=P.frameId,J.previousViewProjection.p(J.currentViewProjection)),y.setMatrix("previousWorld",J.previousWorldMatrices[n.uniqueId]),y.setMatrix("previousViewProjection",J.previousViewProjection),J.previousWorldMatrices[n.uniqueId]=B.clone(),n.useBones&&n.computeBonesUsingShaders&&n.skeleton){const v=n.skeleton;if(!v.isUsingTextureForMatrices||-1===y.getUniformIndex("boneTextureWidth")){const B=v.getTransformMatrices(n);B&&(J.previousBones[n.uniqueId]||(J.previousBones[n.uniqueId]=B.slice()),y.setMatrices("mPreviousBones",J.previousBones[n.uniqueId]),J.previousBones[n.uniqueId].set(B))}}}}}P.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],P._Configurations={}},11327:(v,y,n)=>{"use strict";n.d(y,{c:()=>h});var B=n(11050),J=n(11055),P=n(11200),b=n(10820),Y=n(10841),l=n(10866);const a=new RegExp("^([gimus]+)!");class Z{constructor(v){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=v,this._scene=v.va(),this._engine=this._scene.getEngine()}_addPlugin(v){for(let B=0;B<this._plugins.length;++B)if(this._plugins[B].name===v.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!v.isCompatible(this._material.shaderLanguage))throw`The plugin "${v.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const y=v.getClassName();Z._MaterialPluginClassToMainDefine[y]||(Z._MaterialPluginClassToMainDefine[y]="MATERIALPLUGIN_"+ ++Z._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(v,y)=>this._handlePluginEvent(v,y),this._plugins.push(v),this._plugins.sort(((v,y)=>v.priority-y.priority)),this._codeInjectionPoints={};const n={};n[Z._MaterialPluginClassToMainDefine[y]]={type:"boolean",default:!0};for(const B of this._plugins)B.collectDefines(n),this._collectPointNames("vertex",B.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",B.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=n,!0}_activatePlugin(v){-1===this._activePlugins.indexOf(v)&&(this._activePlugins.push(v),this._activePlugins.sort(((v,y)=>v.priority-y.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),v.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(v),this._activePluginsForExtraEvents.sort(((v,y)=>v.priority-y.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(v){for(let y=0;y<this._plugins.length;++y)if(this._plugins[y].name===v)return this._plugins[y];return null}_handlePluginEventIsReadyForSubMesh(v){let y=!0;for(const n of this._activePlugins)y=y&&n.isReadyForSubMesh(v.defines,this._scene,this._engine,v.subMesh);v.isReadyForSubMesh=y}_handlePluginEventPrepareDefinesBeforeAttributes(v){for(const y of this._activePlugins)y.prepareDefinesBeforeAttributes(v.defines,this._scene,v.mesh)}_handlePluginEventPrepareDefines(v){for(const y of this._activePlugins)y.prepareDefines(v.defines,this._scene,v.mesh)}_handlePluginEventHardBindForSubMesh(v){for(const y of this._activePluginsForExtraEvents)y.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,v.subMesh)}_handlePluginEventBindForSubMesh(v){for(const y of this._activePlugins)y.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,v.subMesh)}_handlePluginEventHasRenderTargetTextures(v){let y=!1;for(const n of this._activePluginsForExtraEvents)if(y=n.hasRenderTargetTextures(),y)break;v.hasRenderTargetTextures=y}_handlePluginEventFillRenderTargetTextures(v){for(const y of this._activePluginsForExtraEvents)y.fillRenderTargetTextures(v.renderTargets)}_handlePluginEvent(v,y){switch(v){case 512:{const v=y;for(const y of this._activePlugins)y.getActiveTextures(v.activeTextures);break}case 256:{const v=y;for(const y of this._activePlugins)y.getAnimatables(v.animatables);break}case 1024:{const v=y;let n=!1;for(const y of this._activePlugins)if(n=y.hasTexture(v.texture),n)break;v.hasTexture=n;break}case 2:{const v=y;for(const y of this._plugins)y.dispose(v.forceDisposeTextures);break}case 4:y.defineNames=this._defineNamesFromPlugins;break;case 128:{const v=y;for(const y of this._activePlugins)v.fallbackRank=y.addFallbacks(v.defines,v.fallbacks,v.fallbackRank),y.getAttributes(v.attributes,this._scene,v.mesh);this._uniformList.length>0&&v.uniforms.push(...this._uniformList),this._samplerList.length>0&&v.samplers.push(...this._samplerList),this._uboList.length>0&&v.uniformBuffersNames.push(...this._uboList),v.customCode=this._injectCustomCode(v,v.customCode);break}case 8:{const v=y;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const n=1===this._material.shaderLanguage;for(const y of this._plugins){const B=y.getUniforms(this._material.shaderLanguage);if(B){if(B.ubo)for(const y of B.ubo){if(y.size&&y.type){const B=y.arraySize??0;if(v.ubo.addUniform(y.name,y.size,B),n){let v;switch(y.type){case"mat4":v="mat4x4f";break;case"float":v="f32";break;default:v=`${y.type}f`}this._uboDeclaration+=`uniform ${y.name}: ${v}${B>0?`[${B}]`:""};\n`}else this._uboDeclaration+=`${y.type} ${y.name}${B>0?`[${B}]`:""};\n`}this._uniformList.push(y.name)}B.vertex&&(this._vertexDeclaration+=B.vertex+"\n"),B.fragment&&(this._fragmentDeclaration+=B.fragment+"\n")}y.getSamplers(this._samplerList),y.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(v,y){if(y)for(const n in y)this._codeInjectionPoints[v]||(this._codeInjectionPoints[v]={}),this._codeInjectionPoints[v][n]=!0}_injectCustomCode(v,y){return(n,B)=>{var J;y&&(B=y(n,B)),this._uboDeclaration&&(B=B.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(B=B.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(B=B.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const P=null===(J=this._codeInjectionPoints)||void 0===J?void 0:J[n];if(!P)return B;let b=null;for(let y in P){let J="";for(const B of this._activePlugins){var Z;let P=null===(Z=B.getCustomCode(n,this._material.shaderLanguage))||void 0===Z?void 0:Z[y];if(P){if(B.resolveIncludes){if(null===b){const y=0;b={defines:[],indexParameters:v.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:l.b.GetShadersRepository(y),includesShadersStore:l.b.GetIncludesShadersStore(y),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}b.isFragment="fragment"===n,(0,Y.j)(P,b,(v=>P=v))}J+=P+"\n"}}if(J.length>0)if("!"===y.charAt(0)){y=y.substring(1);let v="g";if("!"===y.charAt(0))v="",y=y.substring(1);else{const n=a.exec(y);n&&n.length>=2&&(v=n[1],y=y.substring(v.length+1))}v.indexOf("g")<0&&(v+="g");const n=B,P=new RegExp(y,v);let b=P.exec(n);for(;null!==b;){let v=J;for(let y=0;y<b.length;++y)v=v.replace("$"+y,b[y]);B=B.replace(b[0],v),b=P.exec(n)}}else{const v="#define "+y;B=B.replace(v,"\n"+J+"\n"+v)}}return B}}}Z._MaterialPluginClassToMainDefine={},Z._MaterialPluginCounter=0,b.b.OnEnginesDisposedObservable.add((()=>{i()}));const x=[];let f=!1,N=null;function i(){x.length=0,f=!1,P.d.OnEventObservable.remove(N),N=null}var g=n(11110),c=n(10908);class h{isCompatible(v){return 0===v}_enable(v){v&&this._pluginManager._activatePlugin(this)}constructor(v,y,n,B){let J=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=v,this.name=y,this.priority=n,this.resolveIncludes=b,v.pluginManager||(v.pluginManager=new Z(v),v.xj.add((()=>{v.pluginManager=void 0}))),this._pluginDefineNames=B,this._pluginManager=v.pluginManager,J&&this._pluginManager._addPlugin(this),P&&this._enable(!0),this.markAllDefinesAsDirty=v._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(v,y,n,B){return!0}hardBindForSubMesh(v,y,n,B){}bindForSubMesh(v,y,n,B){}dispose(v){}getCustomCode(v){return null}collectDefines(v){if(this._pluginDefineNames)for(const y of Object.keys(this._pluginDefineNames)){if("_"===y[0])continue;const n=typeof this._pluginDefineNames[y];v[y]={type:"number"===n?"number":"string"===n?"string":"boolean"===n?"boolean":"object",default:this._pluginDefineNames[y]}}}prepareDefinesBeforeAttributes(v,y,n){}prepareDefines(v,y,n){}hasTexture(v){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(v){}getActiveTextures(v){}getAnimatables(v){}addFallbacks(v,y,n){return n}getSamplers(v){}getAttributes(v,y,n){}getUniformBuffersNames(v){}getUniforms(){return{}}copyTo(v){g.d.Clone((()=>v),this)}serialize(){return g.d.Serialize(this)}parse(v,y,n){g.d.Parse((()=>this),v,y,n)}}(0,B.c)([(0,J.M)()],h.prototype,"name",void 0),(0,B.c)([(0,J.M)()],h.prototype,"priority",void 0),(0,B.c)([(0,J.M)()],h.prototype,"resolveIncludes",void 0),(0,B.c)([(0,J.M)()],h.prototype,"registerForExtraEvents",void 0),(0,c.g)("BABYLON.MaterialPluginBase",h)},11398:(v,y,n)=>{"use strict";n.d(y,{b:()=>b});var B=n(11200),J=n(11076),P=n(10908);class b extends B.d{get Bg(){return this._subMaterials}set Bg(v){this._subMaterials=v,this._hookArray(v)}getChildren(){return this.Bg}constructor(v,y){super(v,y,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.Bg=[],this._storeEffectOnSubMeshes=!0}_hookArray(v){var y=this;const n=v.push;v.push=function(){for(var B=arguments.length,J=new Array(B),P=0;P<B;P++)J[P]=arguments[P];const b=n.apply(v,J);return y._markAllSubMeshesAsTexturesDirty(),b};const B=v.splice;v.splice=(y,n)=>{const J=B.apply(v,[y,n]);return this._markAllSubMeshesAsTexturesDirty(),J}}getSubMaterial(v){return v<0||v>=this.Bg.length?this.va().defaultMaterial:this.Bg[v]}getActiveTextures(){return super.getActiveTextures().concat(...this.Bg.map((v=>v?v.getActiveTextures():[])))}hasTexture(v){if(super.hasTexture(v))return!0;for(let n=0;n<this.Bg.length;n++){var y;if(null!==(y=this.Bg[n])&&void 0!==y&&y.hasTexture(v))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(v,y,n){for(let B=0;B<this.Bg.length;B++){const J=this.Bg[B];if(J){if(J._storeEffectOnSubMeshes){if(!J.isReadyForSubMesh(v,y,n))return!1;continue}if(!J.isReady(v))return!1}}return!0}clone(v,y){const n=new b(v,this.va());for(let B=0;B<this.Bg.length;B++){let J=null;const P=this.Bg[B];J=y&&P?P.clone(v+"-"+P.name):this.Bg[B],n.Bg.push(J)}return n}serialize(){const v={};v.name=this.name,v.id=this.id,v.uniqueId=this.uniqueId,J.c&&(v.tags=J.c.GetTags(this)),v.materialsUniqueIds=[],v.materials=[];for(let y=0;y<this.Bg.length;y++){const n=this.Bg[y];n?(v.materialsUniqueIds.push(n.uniqueId),v.materials.push(n.id)):(v.materialsUniqueIds.push(null),v.materials.push(null))}return v}dispose(v,y,n){const B=this.va();if(!B)return;if(n)for(let P=0;P<this.Bg.length;P++){const n=this.Bg[P];n&&n.dispose(v,y)}const J=B.multiMaterials.indexOf(this);J>=0&&B.multiMaterials.splice(J,1),super.dispose(v,y)}static ParseMultiMaterial(v,y){const n=new b(v.name,y);return n.id=v.id,n._loadedUniqueId=v.uniqueId,J.c&&J.c.AddTagsTo(n,v.tags),v.materialsUniqueIds?n._waitingSubMaterialsUniqueIds=v.materialsUniqueIds:v.materials.forEach((v=>n.Bg.push(y.getLastMaterialById(v)))),n}}(0,P.g)("BABYLON.MultiMaterial",b)},11193:(v,y,n)=>{"use strict";n.d(y,{d:()=>B});class B{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(v){v.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(v){}bindForSubMesh(v,y,n,B,J){if(y.prePassRenderer&&y.prePassRenderer.enabled&&y.prePassRenderer.currentRTisSceneRT&&(-1!==y.prePassRenderer.getIndex(2)||-1!==y.prePassRenderer.getIndex(11))){this.previousWorldMatrices[n.uniqueId]||(this.previousWorldMatrices[n.uniqueId]=B.clone()),this.previousViewProjection||(this.previousViewProjection=y.getTransformMatrix().clone(),this.currentViewProjection=y.getTransformMatrix().clone());const J=y.getEngine();this.currentViewProjection.updateFlag!==y.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=J.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(y.getTransformMatrix())):this._lastUpdateFrameId!==J.frameId&&(this._lastUpdateFrameId=J.frameId,this.previousViewProjection.p(this.currentViewProjection)),v.setMatrix("previousWorld",this.previousWorldMatrices[n.uniqueId]),v.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[n.uniqueId]=B.clone()}}}},11275:(v,y,n)=>{"use strict";n.d(y,{c:()=>P});var B=n(11081),J=n(11200);class P extends J.d{constructor(v,y){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(v,y,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new B.d,this._storeEffectOnSubMeshes=n}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(v,y){return!!v&&(!this._storeEffectOnSubMeshes||(!v.Ag||0===v.Ag.length||this.isReadyForSubMesh(v,v.Ag[0],y)))}_isReadyForSubMesh(v){const y=v.materialDefines;return!(this.checkReadyOnEveryCall||!v.effect||!y||y._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(v){this._activeEffect.setMatrix("world",v)}bindOnlyNormalMatrix(v){this._activeEffect.setMatrix("normalMatrix",v)}bind(v,y){y&&this.bindForSubMesh(v,y,y.Ag[0])}_afterBind(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;super._afterBind(v,y,n),this.va()._cachedEffect=y,n?n._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return n._drawWrapper._forceRebindOnNextCall||v.isCachedMaterialInvalid(this,y,B)}dispose(v,y,n){this._activeEffect=void 0,super.dispose(v,y,n)}}},11043:(v,y,n)=>{"use strict";n.d(y,{d:()=>q});var B=n(11050),J=n(11055),P=n(11065),b=n(11070),Y=n(11081),l=n(11103),a=n(11127),Z=n(11193),x=n(11094),f=n(11200),N=n(11267),i=n(11275),g=n(11281),c=n(10908),h=n(11303),E=n(11311),W=n(11320),s=n(11262),C=n(11256),r=n(11110),u=n(11336);const O={effect:null,subMesh:null};class d extends N.d{constructor(v){super(v),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(v){const y=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const n of y)this[n]=n===v}}class q extends i.c{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(v){this._attachImageProcessingConfiguration(v),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(v){v!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=v||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(v){this.imageProcessingConfiguration.colorCurvesEnabled=v}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(v){this.imageProcessingConfiguration.colorGradingEnabled=v}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(v){this._imageProcessingConfiguration.toneMappingEnabled=v}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(v){this._imageProcessingConfiguration.exposure=v}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(v){this._imageProcessingConfiguration.contrast=v}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(v){this._imageProcessingConfiguration.colorGradingTexture=v}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(v){this._imageProcessingConfiguration.colorCurves=v}get canRenderToMRT(){return!0}constructor(v,y){super(v,y,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||q.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new l.d(0,0,0),this.diffuseColor=new l.d(1,1,1),this.specularColor=new l.d(1,1,1),this.emissiveColor=new l.d(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new P.e(16),this._worldViewProjectionMatrix=Y.d.Zero(),this._globalAmbientColor=new l.d(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new W.d(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new Z.d,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),q.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),q.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(q.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(q.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"nb"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===f.d.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Pe&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==f.d.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Pe||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(v,y){let B=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const J=y._drawWrapper;if(J.effect&&this.isFrozen&&J._wasPreviouslyReady&&J._wasPreviouslyUsingInstances===B)return!0;y.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),y.materialDefines=new d(this._eventInfo.defineNames));const P=this.va(),b=y.materialDefines;if(this._isReadyForSubMesh(y))return!0;const Y=P.getEngine();b._needNormals=(0,C.Q)(P,v,b,!0,this._maxSimultaneousLights,this._disableLighting),(0,C._)(P,b);const l=this.needAlphaBlendingForMesh(v)&&this.va().useOrderIndependentTransparency;if((0,C.fb)(P,b,this.canRenderToMRT&&!l),(0,C.bb)(P,b,l),u.b.PrepareDefines(Y.currentRenderPassId,v,b),b._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,b._needUVs=!1;for(let v=1;v<=6;++v)b["MAINUV"+v]=!1;if(P.texturesEnabled){if(b.DIFFUSEDIRECTUV=0,b.BUMPDIRECTUV=0,b.AMBIENTDIRECTUV=0,b.OPACITYDIRECTUV=0,b.EMISSIVEDIRECTUV=0,b.SPECULARDIRECTUV=0,b.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&q.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,C.T)(this._diffuseTexture,b,"DIFFUSE")}else b.DIFFUSE=!1;if(this._ambientTexture&&q.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,C.T)(this._ambientTexture,b,"AMBIENT")}else b.AMBIENT=!1;if(this._opacityTexture&&q.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,C.T)(this._opacityTexture,b,"OPACITY"),b.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else b.OPACITY=!1;if(this._reflectionTexture&&q.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(b._needNormals=!0,b.REFLECTION=!0,b.ROUGHNESS=this._roughness>0,b.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,b.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===g.b.INVCUBIC_MODE,b.REFLECTIONMAP_3D=this._reflectionTexture.isCube,b.REFLECTIONMAP_OPPOSITEZ=b.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,b.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case g.b.EXPLICIT_MODE:b.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case g.b.PLANAR_MODE:b.setReflectionMode("REFLECTIONMAP_PLANAR");break;case g.b.PROJECTION_MODE:b.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case g.b.SKYBOX_MODE:b.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case g.b.SPHERICAL_MODE:b.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case g.b.EQUIRECTANGULAR_MODE:b.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case g.b.FIXED_EQUIRECTANGULAR_MODE:b.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case g.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:b.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case g.b.CUBIC_MODE:case g.b.INVCUBIC_MODE:default:b.setReflectionMode("REFLECTIONMAP_CUBIC")}b.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else b.REFLECTION=!1,b.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&q.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,C.T)(this._emissiveTexture,b,"EMISSIVE")}else b.EMISSIVE=!1;if(this._lightmapTexture&&q.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,C.T)(this._lightmapTexture,b,"LIGHTMAP"),b.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,b.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else b.LIGHTMAP=!1;if(this._specularTexture&&q.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,C.T)(this._specularTexture,b,"SPECULAR"),b.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else b.SPECULAR=!1;if(P.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&q.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,C.T)(this._bumpTexture,b,"BUMP"),b.PARALLAX=this._useParallax,b.PARALLAX_RHS=P.useRightHandedSystem,b.PARALLAXOCCLUSION=this._useParallaxOcclusion,b.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else b.BUMP=!1,b.PARALLAX=!1,b.PARALLAX_RHS=!1,b.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&q.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;b._needUVs=!0,b.REFRACTION=!0,b.REFRACTIONMAP_3D=this._refractionTexture.isCube,b.RGBDREFRACTION=this._refractionTexture.isRGBD,b.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else b.REFRACTION=!1;b.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else b.DIFFUSE=!1,b.AMBIENT=!1,b.OPACITY=!1,b.REFLECTION=!1,b.EMISSIVE=!1,b.LIGHTMAP=!1,b.BUMP=!1,b.REFRACTION=!1;b.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),b.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,b.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,b.SPECULAROVERALPHA=this._useSpecularOverAlpha,b.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,b.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,b.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(v)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=b,this._eventInfo.subMesh=y,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(b._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(b),b.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,b.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}b._areFresnelDirty&&(q.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(b.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,b.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,b.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,b.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,b.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,b.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,b._needNormals=!0,b.FRESNEL=!0):b.FRESNEL=!1),(0,C.X)(v,P,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(v)||this._forceAlphaTest,b,this._applyDecalMapAfterDetailMap),(0,C.N)(P,Y,this,b,B,null,y.getRenderingMesh().hasThinInstances),this._eventInfo.defines=b,this._eventInfo.mesh=v,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,C.M)(v,b,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let f=!1;if(b.isDirty){const B=b._areLightsDisposed;b.markAsProcessed();const J=new E.e;b.REFLECTION&&J.addFallback(0,"REFLECTION"),b.SPECULAR&&J.addFallback(0,"SPECULAR"),b.BUMP&&J.addFallback(0,"BUMP"),b.PARALLAX&&J.addFallback(1,"PARALLAX"),b.PARALLAX_RHS&&J.addFallback(1,"PARALLAX_RHS"),b.PARALLAXOCCLUSION&&J.addFallback(0,"PARALLAXOCCLUSION"),b.SPECULAROVERALPHA&&J.addFallback(0,"SPECULAROVERALPHA"),b.FOG&&J.addFallback(1,"FOG"),b.POINTSIZE&&J.addFallback(0,"POINTSIZE"),b.LOGARITHMICDEPTH&&J.addFallback(0,"LOGARITHMICDEPTH"),(0,C.y)(b,J,this._maxSimultaneousLights),b.SPECULARTERM&&J.addFallback(0,"SPECULARTERM"),b.DIFFUSEFRESNEL&&J.addFallback(1,"DIFFUSEFRESNEL"),b.OPACITYFRESNEL&&J.addFallback(2,"OPACITYFRESNEL"),b.REFLECTIONFRESNEL&&J.addFallback(3,"REFLECTIONFRESNEL"),b.EMISSIVEFRESNEL&&J.addFallback(4,"EMISSIVEFRESNEL"),b.FRESNEL&&J.addFallback(4,"FRESNEL"),b.MULTIVIEW&&J.addFallback(0,"MULTIVIEW");const l=[a.i.PositionKind];b.NORMAL&&l.push(a.i.NormalKind),b.TANGENT&&l.push(a.i.TangentKind);for(let v=1;v<=6;++v)b["UV"+v]&&l.push(`uv${1===v?"":v}`);b.VERTEXCOLOR&&l.push(a.i.ColorKind),(0,C.D)(l,v,b,J),(0,C.H)(l,b),(0,C.K)(l,v,b),(0,C.z)(l,v,b);let N="default";const i=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],g=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],c=["Material","Scene","Mesh"],h={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:b.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=J,this._eventInfo.fallbackRank=0,this._eventInfo.defines=b,this._eventInfo.uniforms=i,this._eventInfo.attributes=l,this._eventInfo.samplers=g,this._eventInfo.uniformBuffersNames=c,this._eventInfo.customCode=void 0,this._eventInfo.mesh=v,this._eventInfo.indexParameters=h,this._callbackPluginEventGeneric(128,this._eventInfo),u.b.AddUniformsAndSamplers(i,g),Z.d.AddUniforms(i),Z.d.AddSamplers(g),x.e&&(x.e.PrepareUniforms(i,b),x.e.PrepareSamplers(g,b)),(0,C.gb)({uniformsNames:i,uniformBuffersNames:c,samplers:g,defines:b,maxSimultaneousLights:this._maxSimultaneousLights}),(0,s.e)(i);const W={};this.customShaderNameResolve&&(N=this.customShaderNameResolve(N,i,c,g,b,l,W));const r=b.toString(),d=y.effect;let q=P.getEngine().createEffect(N,{attributes:l,uniformsNames:i,uniformBuffersNames:c,samplers:g,defines:r,fallbacks:J,onCompiled:this.onCompiled,onError:this.onError,indexParameters:h,processFinalCode:W.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:b.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([n.e(21),n.e(19)]).then(n.bind(n,13073)),Promise.all([n.e(22),n.e(20)]).then(n.bind(n,13221))]):await Promise.all([Promise.all([n.e(25),n.e(24)]).then(n.bind(n,13301)),Promise.all([n.e(27),n.e(26)]).then(n.bind(n,13452))]),this._shadersLoaded=!0}},Y);if(this._eventInfo.customCode=void 0,q)if(this._onEffectCreatedObservable&&(O.effect=q,O.subMesh=y,this._onEffectCreatedObservable.notifyObservers(O)),this.allowShaderHotSwapping&&d&&!q.isReady()){if(q=d,b.markAsUnprocessed(),f=this.isFrozen,B)return b._areLightsDisposed=!0,!1}else P.resetCachedMaterial(),y.setEffect(q,b,this._materialContext)}return!(!y.effect||!y.effect.isReady())&&(b._renderId=P.getRenderId(),J._wasPreviouslyReady=!f,J._wasPreviouslyUsingInstances=B,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const v=this._uniformBuffer;v.addUniform("diffuseLeftColor",4),v.addUniform("diffuseRightColor",4),v.addUniform("opacityParts",4),v.addUniform("reflectionLeftColor",4),v.addUniform("reflectionRightColor",4),v.addUniform("refractionLeftColor",4),v.addUniform("refractionRightColor",4),v.addUniform("emissiveLeftColor",4),v.addUniform("emissiveRightColor",4),v.addUniform("vDiffuseInfos",2),v.addUniform("vAmbientInfos",2),v.addUniform("vOpacityInfos",2),v.addUniform("vReflectionInfos",2),v.addUniform("vReflectionPosition",3),v.addUniform("vReflectionSize",3),v.addUniform("vEmissiveInfos",2),v.addUniform("vLightmapInfos",2),v.addUniform("vSpecularInfos",2),v.addUniform("vBumpInfos",3),v.addUniform("diffuseMatrix",16),v.addUniform("ambientMatrix",16),v.addUniform("opacityMatrix",16),v.addUniform("reflectionMatrix",16),v.addUniform("emissiveMatrix",16),v.addUniform("lightmapMatrix",16),v.addUniform("specularMatrix",16),v.addUniform("bumpMatrix",16),v.addUniform("vTangentSpaceParams",2),v.addUniform("pointSize",1),v.addUniform("alphaCutOff",1),v.addUniform("refractionMatrix",16),v.addUniform("vRefractionInfos",4),v.addUniform("vRefractionPosition",3),v.addUniform("vRefractionSize",3),v.addUniform("vSpecularColor",4),v.addUniform("vEmissiveColor",3),v.addUniform("vDiffuseColor",4),v.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(v,y,n){const B=this.va(),J=n.materialDefines;if(!J)return;const P=n.effect;if(!P)return;this._activeEffect=P,y.getMeshUniformBuffer().bindToEffect(P,"Mesh"),y.transferToEffect(v),this._uniformBuffer.bindToEffect(P,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,B,y,v,this.isFrozen),u.b.Bind(B.getEngine().currentRenderPassId,this._activeEffect,y,v),this._eventInfo.subMesh=n,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),J.OBJECTSPACE_NORMALMAP&&(v.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const Y=this._mustRebind(B,P,n,y.visibility);(0,C.e)(y,P);const a=this._uniformBuffer;if(Y){if(this.bindViewProjection(P),!a.useUbo||!this.isFrozen||!a.isSync||n._drawWrapper._forceRebindOnNextCall){if(q.FresnelEnabled&&J.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(a.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),a.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&a.updateColor4("opacityParts",new l.d(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(a.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),a.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(a.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),a.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(a.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),a.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),B.texturesEnabled){if(this._diffuseTexture&&q.DiffuseTextureEnabled&&(a.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,C.w)(this._diffuseTexture,a,"diffuse")),this._ambientTexture&&q.AmbientTextureEnabled&&(a.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,C.w)(this._ambientTexture,a,"ambient")),this._opacityTexture&&q.OpacityTextureEnabled&&(a.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,C.w)(this._opacityTexture,a,"opacity")),this._hasAlphaChannel()&&a.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&q.ReflectionTextureEnabled&&(a.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),a.Vj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const v=this._reflectionTexture;a.updateVector3("vReflectionPosition",v.boundingBoxPosition),a.updateVector3("vReflectionSize",v.boundingBoxSize)}if(this._emissiveTexture&&q.EmissiveTextureEnabled&&(a.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,C.w)(this._emissiveTexture,a,"emissive")),this._lightmapTexture&&q.LightmapTextureEnabled&&(a.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,C.w)(this._lightmapTexture,a,"lightmap")),this._specularTexture&&q.SpecularTextureEnabled&&(a.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,C.w)(this._specularTexture,a,"specular")),this._bumpTexture&&B.getEngine().getCaps().standardDerivatives&&q.BumpTextureEnabled&&(a.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,C.w)(this._bumpTexture,a,"bump"),B._mirroredCameraPosition?a.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):a.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&q.RefractionTextureEnabled){let v=1;if(this._refractionTexture.isCube||(a.Vj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(v=this._refractionTexture.depth)),a.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,v,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const v=this._refractionTexture;a.updateVector3("vRefractionPosition",v.boundingBoxPosition),a.updateVector3("vRefractionSize",v.boundingBoxSize)}}}this.pointsCloud&&a.updateFloat("pointSize",this.pointSize),a.updateColor4("vSpecularColor",this.specularColor,this.specularPower),a.updateColor3("vEmissiveColor",q.EmissiveTextureEnabled?this.emissiveColor:l.d.BlackReadOnly),a.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),B.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),a.updateColor3("vAmbientColor",this._globalAmbientColor)}B.texturesEnabled&&(this._diffuseTexture&&q.DiffuseTextureEnabled&&P.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&q.AmbientTextureEnabled&&P.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&q.OpacityTextureEnabled&&P.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&q.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?P.setTexture("reflectionCubeSampler",this._reflectionTexture):P.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&q.EmissiveTextureEnabled&&P.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&q.LightmapTextureEnabled&&P.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&q.SpecularTextureEnabled&&P.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&B.getEngine().getCaps().standardDerivatives&&q.BumpTextureEnabled&&P.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&q.RefractionTextureEnabled&&(this._refractionTexture.isCube?P.setTexture("refractionCubeSampler",this._refractionTexture):P.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(y)&&this.va().depthPeelingRenderer.bind(P),this._eventInfo.subMesh=n,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,s.h)(P,this,B),this.bindEyePosition(P)}else B.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(Y||!this.isFrozen){var Z;if(B.lightsEnabled&&!this._disableLighting&&(0,C.j)(B,y,P,J,this._maxSimultaneousLights),(B.fogEnabled&&y.applyFog&&B.fogMode!==b.e.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||y.receiveShadows||J.PREPASS)&&this.bindView(P),(0,C.h)(B,y,P),J.NUM_MORPH_INFLUENCERS&&(0,C.q)(y,P),J.BAKED_VERTEX_ANIMATION_TEXTURE)null===(Z=y.bakedVertexAnimationManager)||void 0===Z||Z.bind(P,J.INSTANCES);this.useLogarithmicDepth&&(0,C.m)(J,P,B),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(y,this._activeEffect,n),a.update()}getAnimatables(){const v=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&v.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&v.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&v.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&v.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&v.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&v.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&v.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&v.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&v.push(this._refractionTexture),v}getActiveTextures(){const v=super.getActiveTextures();return this._diffuseTexture&&v.push(this._diffuseTexture),this._ambientTexture&&v.push(this._ambientTexture),this._opacityTexture&&v.push(this._opacityTexture),this._reflectionTexture&&v.push(this._reflectionTexture),this._emissiveTexture&&v.push(this._emissiveTexture),this._specularTexture&&v.push(this._specularTexture),this._bumpTexture&&v.push(this._bumpTexture),this._lightmapTexture&&v.push(this._lightmapTexture),this._refractionTexture&&v.push(this._refractionTexture),v}hasTexture(v){return!!super.hasTexture(v)||(this._diffuseTexture===v||(this._ambientTexture===v||(this._opacityTexture===v||(this._reflectionTexture===v||(this._emissiveTexture===v||(this._specularTexture===v||(this._bumpTexture===v||(this._lightmapTexture===v||this._refractionTexture===v))))))))}dispose(v,y){var n,B,J,P,b,Y,l,a,Z;y&&(null===(n=this._diffuseTexture)||void 0===n||n.dispose(),null===(B=this._ambientTexture)||void 0===B||B.dispose(),null===(J=this._opacityTexture)||void 0===J||J.dispose(),null===(P=this._reflectionTexture)||void 0===P||P.dispose(),null===(b=this._emissiveTexture)||void 0===b||b.dispose(),null===(Y=this._specularTexture)||void 0===Y||Y.dispose(),null===(l=this._bumpTexture)||void 0===l||l.dispose(),null===(a=this._lightmapTexture)||void 0===a||a.dispose(),null===(Z=this._refractionTexture)||void 0===Z||Z.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(v,y)}clone(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const B=r.d.Clone((()=>new q(v,this.va())),this,{cloneTexturesOnlyOnce:y});return B.name=v,B.id=v,this.stencil.copyTo(B.stencil),this._clonePlugins(B,n),B}static Parse(v,y,n){const B=r.d.Parse((()=>new q(v.name,y)),v,y,n);return v.stencil&&B.stencil.parse(v.stencil,y,n),f.d._ParsePlugins(v,B,y,n),B}static get DiffuseTextureEnabled(){return h.b.DiffuseTextureEnabled}static set DiffuseTextureEnabled(v){h.b.DiffuseTextureEnabled=v}static get DetailTextureEnabled(){return h.b.DetailTextureEnabled}static set DetailTextureEnabled(v){h.b.DetailTextureEnabled=v}static get AmbientTextureEnabled(){return h.b.AmbientTextureEnabled}static set AmbientTextureEnabled(v){h.b.AmbientTextureEnabled=v}static get OpacityTextureEnabled(){return h.b.OpacityTextureEnabled}static set OpacityTextureEnabled(v){h.b.OpacityTextureEnabled=v}static get ReflectionTextureEnabled(){return h.b.ReflectionTextureEnabled}static set ReflectionTextureEnabled(v){h.b.ReflectionTextureEnabled=v}static get EmissiveTextureEnabled(){return h.b.EmissiveTextureEnabled}static set EmissiveTextureEnabled(v){h.b.EmissiveTextureEnabled=v}static get SpecularTextureEnabled(){return h.b.SpecularTextureEnabled}static set SpecularTextureEnabled(v){h.b.SpecularTextureEnabled=v}static get BumpTextureEnabled(){return h.b.BumpTextureEnabled}static set BumpTextureEnabled(v){h.b.BumpTextureEnabled=v}static get LightmapTextureEnabled(){return h.b.LightmapTextureEnabled}static set LightmapTextureEnabled(v){h.b.LightmapTextureEnabled=v}static get RefractionTextureEnabled(){return h.b.RefractionTextureEnabled}static set RefractionTextureEnabled(v){h.b.RefractionTextureEnabled=v}static get ColorGradingTextureEnabled(){return h.b.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(v){h.b.ColorGradingTextureEnabled=v}static get FresnelEnabled(){return h.b.FresnelEnabled}static set FresnelEnabled(v){h.b.FresnelEnabled=v}}q.ForceGLSL=!1,(0,B.c)([(0,J.E)("diffuseTexture")],q.prototype,"_diffuseTexture",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],q.prototype,"diffuseTexture",void 0),(0,B.c)([(0,J.E)("ambientTexture")],q.prototype,"_ambientTexture",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"ambientTexture",void 0),(0,B.c)([(0,J.E)("opacityTexture")],q.prototype,"_opacityTexture",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],q.prototype,"opacityTexture",void 0),(0,B.c)([(0,J.E)("reflectionTexture")],q.prototype,"_reflectionTexture",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"reflectionTexture",void 0),(0,B.c)([(0,J.E)("emissiveTexture")],q.prototype,"_emissiveTexture",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"emissiveTexture",void 0),(0,B.c)([(0,J.E)("specularTexture")],q.prototype,"_specularTexture",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"specularTexture",void 0),(0,B.c)([(0,J.E)("bumpTexture")],q.prototype,"_bumpTexture",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"bumpTexture",void 0),(0,B.c)([(0,J.E)("lightmapTexture")],q.prototype,"_lightmapTexture",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"lightmapTexture",void 0),(0,B.c)([(0,J.E)("refractionTexture")],q.prototype,"_refractionTexture",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"refractionTexture",void 0),(0,B.c)([(0,J.j)("ambient")],q.prototype,"ambientColor",void 0),(0,B.c)([(0,J.j)("diffuse")],q.prototype,"diffuseColor",void 0),(0,B.c)([(0,J.j)("specular")],q.prototype,"specularColor",void 0),(0,B.c)([(0,J.j)("emissive")],q.prototype,"emissiveColor",void 0),(0,B.c)([(0,J.M)()],q.prototype,"specularPower",void 0),(0,B.c)([(0,J.M)("useAlphaFromDiffuseTexture")],q.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],q.prototype,"useAlphaFromDiffuseTexture",void 0),(0,B.c)([(0,J.M)("useEmissiveAsIllumination")],q.prototype,"_useEmissiveAsIllumination",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useEmissiveAsIllumination",void 0),(0,B.c)([(0,J.M)("linkEmissiveWithDiffuse")],q.prototype,"_linkEmissiveWithDiffuse",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"linkEmissiveWithDiffuse",void 0),(0,B.c)([(0,J.M)("useSpecularOverAlpha")],q.prototype,"_useSpecularOverAlpha",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useSpecularOverAlpha",void 0),(0,B.c)([(0,J.M)("useReflectionOverAlpha")],q.prototype,"_useReflectionOverAlpha",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useReflectionOverAlpha",void 0),(0,B.c)([(0,J.M)("disableLighting")],q.prototype,"_disableLighting",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsLightsDirty")],q.prototype,"disableLighting",void 0),(0,B.c)([(0,J.M)("useObjectSpaceNormalMap")],q.prototype,"_useObjectSpaceNormalMap",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useObjectSpaceNormalMap",void 0),(0,B.c)([(0,J.M)("useParallax")],q.prototype,"_useParallax",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useParallax",void 0),(0,B.c)([(0,J.M)("useParallaxOcclusion")],q.prototype,"_useParallaxOcclusion",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useParallaxOcclusion",void 0),(0,B.c)([(0,J.M)()],q.prototype,"parallaxScaleBias",void 0),(0,B.c)([(0,J.M)("roughness")],q.prototype,"_roughness",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"roughness",void 0),(0,B.c)([(0,J.M)()],q.prototype,"indexOfRefraction",void 0),(0,B.c)([(0,J.M)()],q.prototype,"invertRefractionY",void 0),(0,B.c)([(0,J.M)()],q.prototype,"alphaCutOff",void 0),(0,B.c)([(0,J.M)("useLightmapAsShadowmap")],q.prototype,"_useLightmapAsShadowmap",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useLightmapAsShadowmap",void 0),(0,B.c)([(0,J.n)("diffuseFresnelParameters")],q.prototype,"_diffuseFresnelParameters",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsFresnelDirty")],q.prototype,"diffuseFresnelParameters",void 0),(0,B.c)([(0,J.n)("opacityFresnelParameters")],q.prototype,"_opacityFresnelParameters",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsFresnelAndMiscDirty")],q.prototype,"opacityFresnelParameters",void 0),(0,B.c)([(0,J.n)("reflectionFresnelParameters")],q.prototype,"_reflectionFresnelParameters",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsFresnelDirty")],q.prototype,"reflectionFresnelParameters",void 0),(0,B.c)([(0,J.n)("refractionFresnelParameters")],q.prototype,"_refractionFresnelParameters",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsFresnelDirty")],q.prototype,"refractionFresnelParameters",void 0),(0,B.c)([(0,J.n)("emissiveFresnelParameters")],q.prototype,"_emissiveFresnelParameters",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsFresnelDirty")],q.prototype,"emissiveFresnelParameters",void 0),(0,B.c)([(0,J.M)("useReflectionFresnelFromSpecular")],q.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsFresnelDirty")],q.prototype,"useReflectionFresnelFromSpecular",void 0),(0,B.c)([(0,J.M)("useGlossinessFromSpecularMapAlpha")],q.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,B.c)([(0,J.M)("maxSimultaneousLights")],q.prototype,"_maxSimultaneousLights",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsLightsDirty")],q.prototype,"maxSimultaneousLights",void 0),(0,B.c)([(0,J.M)("invertNormalMapX")],q.prototype,"_invertNormalMapX",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"invertNormalMapX",void 0),(0,B.c)([(0,J.M)("invertNormalMapY")],q.prototype,"_invertNormalMapY",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"invertNormalMapY",void 0),(0,B.c)([(0,J.M)("twoSidedLighting")],q.prototype,"_twoSidedLighting",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"twoSidedLighting",void 0),(0,B.c)([(0,J.M)("applyDecalMapAfterDetailMap")],q.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,B.c)([(0,J.d)("_markAllSubMeshesAsMiscDirty")],q.prototype,"applyDecalMapAfterDetailMap",void 0),(0,c.g)("BABYLON.StandardMaterial",q),b.e.DefaultMaterialFactory=v=>new q("default material",v)},11120:(v,y,n)=>{"use strict";n.d(y,{b:()=>P});var B=n(10801),J=n(10791);class P{constructor(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=v,this._noUBO=!v.supportsUniformBuffers||J,this._dynamic=n,this._name=B??"no-name",this._data=y||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.Vj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.Vj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(v){let y;if(y=v<=2?v:4,this._uniformLocationPointer%y!==0){const v=this._uniformLocationPointer;this._uniformLocationPointer+=y-this._uniformLocationPointer%y;const n=this._uniformLocationPointer-v;for(let y=0;y<n;y++)this._data.push(0)}}addUniform(v,y){let n,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[v]){if(B>0){if(y instanceof Array)throw"addUniform should not be use with Array in UBO: "+v;if(this._fillAlignment(4),this._uniformArraySizes[v]={strideSize:y,arraySize:B},16==y)y*=B;else{y=y*B+(4-y)*B}n=[];for(let v=0;v<y;v++)n.push(0)}else{if(y instanceof Array)n=y,y=n.length;else{n=[];for(let v=0;v<y;v++)n.push(0)}this._fillAlignment(y)}this._uniformSizes[v]=y,this._uniformLocations[v]=this._uniformLocationPointer,this._uniformLocationPointer+=y;for(let v=0;v<y;v++)this._data.push(n[v]);this._needSync=!0}}addMatrix(v,y){this.addUniform(v,Array.prototype.slice.call(y.wj()))}addFloat2(v,y,n){const B=[y,n];this.addUniform(v,B)}addFloat3(v,y,n,B){const J=[y,n,B];this.addUniform(v,J)}addColor3(v,y){const n=[y.r,y.g,y.b];this.addUniform(v,n)}addColor4(v,y,n){const B=[y.r,y.g,y.b,n];this.addUniform(v,B)}addVector3(v,y){const n=[y.x,y.y,y.z];this.addUniform(v,n)}addMatrix3x3(v){this.addUniform(v,12)}addMatrix2x2(v){this.addUniform(v,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const v=[];let y=0;for(const n in this._uniformLocations)if(v.push(n),10===++y)break;return v.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(v,y){for(let n=0;n<v.length;++n)if(v[n]!==y[n])return!1;return!0}_copyBuffer(v,y){for(let n=0;n<v.length;++n)y[n]=v[n]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(P._UpdatedUbosInFrame[this._name]||(P._UpdatedUbosInFrame[this._name]=0),P._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(v,y,n){this._checkNewFrame();let J=this._uniformLocations[v];if(void 0===J){if(this._buffer)return void B.e.Error("Cannot add an uniform after UBO has been created. uniformName="+v);this.addUniform(v,n),J=this._uniformLocations[v]}if(this._buffer||this.create(),this._dynamic)for(let B=0;B<n;B++)this._bufferData[J+B]=y[B];else{let v=!1;for(let B=0;B<n;B++)(16===n&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[J+B]!==Math.fround(y[B]))&&(v=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[J+B]=y[B]);this._needSync=this._needSync||v}}updateUniformArray(v,y,n){this._checkNewFrame();const P=this._uniformLocations[v];if(void 0===P)return void B.e.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const b=this._uniformArraySizes[v];if(this._dynamic)for(let B=0;B<n;B++)this._bufferData[P+B]=y[B];else{let v=!1,B=0,Y=0;for(let l=0;l<n;l++)if(this._bufferData[P+4*Y+B]!==J.g.FloatRound(y[l])&&(v=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[P+4*Y+B]=y[l]),B++,B===b.strideSize){for(;B<4;B++)this._bufferData[P+4*Y+B]=0;B=0,Y++}this._needSync=this._needSync||v}}_cacheMatrix(v,y){this._checkNewFrame();const n=this._valueCache[v],B=y.updateFlag;return(void 0===n||n!==B)&&(this._valueCache[v]=B,!0)}_updateMatrix3x3ForUniform(v,y){for(let n=0;n<3;n++)P._TempBuffer[4*n]=y[3*n],P._TempBuffer[4*n+1]=y[3*n+1],P._TempBuffer[4*n+2]=y[3*n+2],P._TempBuffer[4*n+3]=0;this.updateUniform(v,P._TempBuffer,12)}_updateMatrix3x3ForEffect(v,y){this._currentEffect.setMatrix3x3(v,y)}_updateMatrix2x2ForEffect(v,y){this._currentEffect.setMatrix2x2(v,y)}_updateMatrix2x2ForUniform(v,y){for(let n=0;n<2;n++)P._TempBuffer[4*n]=y[2*n],P._TempBuffer[4*n+1]=y[2*n+1],P._TempBuffer[4*n+2]=0,P._TempBuffer[4*n+3]=0;this.updateUniform(v,P._TempBuffer,8)}_updateFloatForEffect(v,y){this._currentEffect.setFloat(v,y)}_updateFloatForUniform(v,y){P._TempBuffer[0]=y,this.updateUniform(v,P._TempBuffer,1)}_updateFloat2ForEffect(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(v+B,y,n)}_updateFloat2ForUniform(v,y,n){P._TempBuffer[0]=y,P._TempBuffer[1]=n,this.updateUniform(v,P._TempBuffer,2)}_updateFloat3ForEffect(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(v+J,y,n,B)}_updateFloat3ForUniform(v,y,n,B){P._TempBuffer[0]=y,P._TempBuffer[1]=n,P._TempBuffer[2]=B,this.updateUniform(v,P._TempBuffer,3)}_updateFloat4ForEffect(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(v+P,y,n,B,J)}_updateFloat4ForUniform(v,y,n,B,J){P._TempBuffer[0]=y,P._TempBuffer[1]=n,P._TempBuffer[2]=B,P._TempBuffer[3]=J,this.updateUniform(v,P._TempBuffer,4)}_updateFloatArrayForEffect(v,y){this._currentEffect.setFloatArray(v,y)}_updateFloatArrayForUniform(v,y){this.updateUniformArray(v,y,y.length)}_updateArrayForEffect(v,y){this._currentEffect.setArray(v,y)}_updateArrayForUniform(v,y){this.updateUniformArray(v,y,y.length)}_updateIntArrayForEffect(v,y){this._currentEffect.setIntArray(v,y)}_updateIntArrayForUniform(v,y){P._TempBufferInt32View.set(y),this.updateUniformArray(v,P._TempBuffer,y.length)}_updateUIntArrayForEffect(v,y){this._currentEffect.setUIntArray(v,y)}_updateUIntArrayForUniform(v,y){P._TempBufferUInt32View.set(y),this.updateUniformArray(v,P._TempBuffer,y.length)}_updateMatrixForEffect(v,y){this._currentEffect.setMatrix(v,y)}_updateMatrixForUniform(v,y){this._cacheMatrix(v,y)&&this.updateUniform(v,y.wj(),16)}_updateMatricesForEffect(v,y){this._currentEffect.setMatrices(v,y)}_updateMatricesForUniform(v,y){this.updateUniform(v,y,y.length)}_updateVector3ForEffect(v,y){this._currentEffect.setVector3(v,y)}_updateVector3ForUniform(v,y){P._TempBuffer[0]=y.x,P._TempBuffer[1]=y.y,P._TempBuffer[2]=y.z,this.updateUniform(v,P._TempBuffer,3)}_updateVector4ForEffect(v,y){this._currentEffect.setVector4(v,y)}_updateVector4ForUniform(v,y){P._TempBuffer[0]=y.x,P._TempBuffer[1]=y.y,P._TempBuffer[2]=y.z,P._TempBuffer[3]=y.w,this.updateUniform(v,P._TempBuffer,4)}_updateColor3ForEffect(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(v+n,y)}_updateColor3ForUniform(v,y){P._TempBuffer[0]=y.r,P._TempBuffer[1]=y.g,P._TempBuffer[2]=y.b,this.updateUniform(v,P._TempBuffer,3)}_updateColor4ForEffect(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(v+B,y,n)}_updateDirectColor4ForEffect(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(v+n,y)}_updateColor4ForUniform(v,y,n){P._TempBuffer[0]=y.r,P._TempBuffer[1]=y.g,P._TempBuffer[2]=y.b,P._TempBuffer[3]=n,this.updateUniform(v,P._TempBuffer,4)}_updateDirectColor4ForUniform(v,y){P._TempBuffer[0]=y.r,P._TempBuffer[1]=y.g,P._TempBuffer[2]=y.b,P._TempBuffer[3]=y.a,this.updateUniform(v,P._TempBuffer,4)}_updateIntForEffect(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(v+n,y)}_updateIntForUniform(v,y){P._TempBufferInt32View[0]=y,this.updateUniform(v,P._TempBuffer,1)}_updateInt2ForEffect(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(v+B,y,n)}_updateInt2ForUniform(v,y,n){P._TempBufferInt32View[0]=y,P._TempBufferInt32View[1]=n,this.updateUniform(v,P._TempBuffer,2)}_updateInt3ForEffect(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(v+J,y,n,B)}_updateInt3ForUniform(v,y,n,B){P._TempBufferInt32View[0]=y,P._TempBufferInt32View[1]=n,P._TempBufferInt32View[2]=B,this.updateUniform(v,P._TempBuffer,3)}_updateInt4ForEffect(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(v+P,y,n,B,J)}_updateInt4ForUniform(v,y,n,B,J){P._TempBufferInt32View[0]=y,P._TempBufferInt32View[1]=n,P._TempBufferInt32View[2]=B,P._TempBufferInt32View[3]=J,this.updateUniform(v,P._TempBuffer,4)}_updateUIntForEffect(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(v+n,y)}_updateUIntForUniform(v,y){P._TempBufferUInt32View[0]=y,this.updateUniform(v,P._TempBuffer,1)}_updateUInt2ForEffect(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(v+B,y,n)}_updateUInt2ForUniform(v,y,n){P._TempBufferUInt32View[0]=y,P._TempBufferUInt32View[1]=n,this.updateUniform(v,P._TempBuffer,2)}_updateUInt3ForEffect(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(v+J,y,n,B)}_updateUInt3ForUniform(v,y,n,B){P._TempBufferUInt32View[0]=y,P._TempBufferUInt32View[1]=n,P._TempBufferUInt32View[2]=B,this.updateUniform(v,P._TempBuffer,3)}_updateUInt4ForEffect(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(v+P,y,n,B,J)}_updateUInt4ForUniform(v,y,n,B,J){P._TempBufferUInt32View[0]=y,P._TempBufferUInt32View[1]=n,P._TempBufferUInt32View[2]=B,P._TempBufferUInt32View[3]=J,this.updateUniform(v,P._TempBuffer,4)}setTexture(v,y){this._currentEffect.setTexture(v,y)}setTextureArray(v,y){this._currentEffect.setTextureArray(v,y)}bindTexture(v,y){this._currentEffect._bindTexture(v,y)}updateUniformDirectly(v,y){this.updateUniform(v,y,y.length),this.update()}bindToEffect(v,y){this._currentEffect=v,this._currentEffectName=y}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(v){if(!this._buffers)return this._buffer===v;for(let y=0;y<this._buffers.length;++y){if(this._buffers[y][0]===v)return this._bufferIndex=y,this._buffer=v,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const v=this._engine._uniformBuffers,y=v.indexOf(this);if(-1!==y&&(v[y]=v[v.length-1],v.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let n=0;n<this._buffers.length;++n){const v=this._buffers[n][0];this._engine._releaseBuffer(v)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}P._UpdatedUbosInFrame={},P._MAX_UNIFORM_SIZE=256,P._TempBuffer=new Float32Array(P._MAX_UNIFORM_SIZE),P._TempBufferInt32View=new Int32Array(P._TempBuffer.buffer),P._TempBufferUInt32View=new Uint32Array(P._TempBuffer.buffer)},11390:(v,y,n)=>{"use strict";n.d(y,{c:()=>b,e:()=>B});var B,J,P=n(11081);!function(v){v[v.LOCAL=0]="LOCAL",v[v.WORLD=1]="WORLD",v[v.BONE=2]="BONE"}(B||(B={}));class b{}b.X=new P.n(1,0,0),b.Y=new P.n(0,1,0),b.Z=new P.n(0,0,1),function(v){v[v.X=0]="X",v[v.Y=1]="Y",v[v.Z=2]="Z"}(J||(J={}))},11103:(v,y,n)=>{"use strict";n.d(y,{d:()=>x,e:()=>f,h:()=>N});var B=n(11088),J=n(10908),P=n(11086),b=n(11091);function Y(v){return Math.pow(v,P.h)}function l(v){return v<=.04045?.0773993808*v:Math.pow(.947867299*(v+.055),2.4)}function a(v){return Math.pow(v,P.g)}function Z(v){return v<=.0031308?12.92*v:1.055*Math.pow(v,.41666)-.055}class x{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=v,this.g=y,this.b=n}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"ib"}getHashCode(){let v=255*this.r|0;return v=397*v^255*this.g,v=397*v^255*this.b,v}toArray(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return v[y]=this.r,v[y+1]=this.g,v[y+2]=this.b,this}qd(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return x.FromArrayToRef(v,y,this),this}toColor4(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new f(this.r,this.g,this.b,v)}wj(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(v){return new x(this.r*v.r,this.g*v.g,this.b*v.b)}multiplyToRef(v,y){return y.r=this.r*v.r,y.g=this.g*v.g,y.b=this.b*v.b,y}multiplyInPlace(v){return this.r*=v.r,this.g*=v.g,this.b*=v.b,this}multiplyByFloats(v,y,n){return new x(this.r*v,this.g*y,this.b*n)}divide(v){throw new ReferenceError("Can not divide a color")}divideToRef(v,y){throw new ReferenceError("Can not divide a color")}divideInPlace(v){throw new ReferenceError("Can not divide a color")}minimizeInPlace(v){return this.minimizeInPlaceFromFloats(v.r,v.g,v.b)}maximizeInPlace(v){return this.maximizeInPlaceFromFloats(v.r,v.g,v.b)}minimizeInPlaceFromFloats(v,y,n){return this.r=Math.min(v,this.r),this.g=Math.min(y,this.g),this.b=Math.min(n,this.b),this}maximizeInPlaceFromFloats(v,y,n){return this.r=Math.max(v,this.r),this.g=Math.max(y,this.g),this.b=Math.max(n,this.b),this}floorToRef(v){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(v){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(v){return v&&this.r===v.r&&this.g===v.g&&this.b===v.b}equalsFloats(v,y,n){return this.equalsToFloats(v,y,n)}equalsToFloats(v,y,n){return this.r===v&&this.g===y&&this.b===n}equalsWithEpsilon(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.b;return(0,b.v)(this.r,v.r,y)&&(0,b.v)(this.g,v.g,y)&&(0,b.v)(this.b,v.b,y)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(v){throw new ReferenceError("Can not negate a color")}scale(v){return new x(this.r*v,this.g*v,this.b*v)}scaleInPlace(v){return this.r*=v,this.g*=v,this.b*=v,this}scaleToRef(v,y){return y.r=this.r*v,y.g=this.g*v,y.b=this.b*v,y}scaleAndAddToRef(v,y){return y.r+=this.r*v,y.g+=this.g*v,y.b+=this.b*v,y}clampToRef(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;return n.r=(0,b.c)(this.r,v,y),n.g=(0,b.c)(this.g,v,y),n.b=(0,b.c)(this.b,v,y),n}add(v){return new x(this.r+v.r,this.g+v.g,this.b+v.b)}addInPlace(v){return this.r+=v.r,this.g+=v.g,this.b+=v.b,this}addInPlaceFromFloats(v,y,n){return this.r+=v,this.g+=y,this.b+=n,this}addToRef(v,y){return y.r=this.r+v.r,y.g=this.g+v.g,y.b=this.b+v.b,y}od(v){return new x(this.r-v.r,this.g-v.g,this.b-v.b)}subtractToRef(v,y){return y.r=this.r-v.r,y.g=this.g-v.g,y.b=this.b-v.b,y}Ei(v){return this.r-=v.r,this.g-=v.g,this.b-=v.b,this}subtractFromFloats(v,y,n){return new x(this.r-v,this.g-y,this.b-n)}subtractFromFloatsToRef(v,y,n,B){return B.r=this.r-v,B.g=this.g-y,B.b=this.b-n,B}clone(){return new x(this.r,this.g,this.b)}p(v){return this.r=v.r,this.g=v.g,this.b=v.b,this}Ae(v,y,n){return this.r=v,this.g=y,this.b=n,this}set(v,y,n){return this.Ae(v,y,n)}xe(v){return this.r=this.g=this.b=v,this}toHexString(){const v=Math.round(255*this.r),y=Math.round(255*this.g),n=Math.round(255*this.b);return"#"+(0,b.r)(v)+(0,b.r)(y)+(0,b.r)(n)}fromHexString(v){return"#"!==v.substring(0,1)||7!==v.length||(this.r=parseInt(v.substring(1,3),16)/255,this.g=parseInt(v.substring(3,5),16)/255,this.b=parseInt(v.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new x)}toHSVToRef(v){const y=this.r,n=this.g,B=this.b,J=Math.max(y,n,B),P=Math.min(y,n,B);let b=0,Y=0;const l=J,a=J-P;return 0!==J&&(Y=a/J),J!=P&&(J==y?(b=(n-B)/a,n<B&&(b+=6)):J==n?b=(B-y)/a+2:J==B&&(b=(y-n)/a+4),b*=60),v.r=b,v.g=Y,v.b=l,v}toLinearSpace(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y=new x;return this.toLinearSpaceToRef(y,v),y}toLinearSpaceToRef(v){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(v.r=l(this.r),v.g=l(this.g),v.b=l(this.b)):(v.r=Y(this.r),v.g=Y(this.g),v.b=Y(this.b)),this}toGammaSpace(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y=new x;return this.toGammaSpaceToRef(y,v),y}toGammaSpaceToRef(v){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(v.r=Z(this.r),v.g=Z(this.g),v.b=Z(this.b)):(v.r=a(this.r),v.g=a(this.g),v.b=a(this.b)),this}static HSVtoRGBToRef(v,y,n,B){const J=n*y,P=v/60,b=J*(1-Math.abs(P%2-1));let Y=0,l=0,a=0;P>=0&&P<=1?(Y=J,l=b):P>=1&&P<=2?(Y=b,l=J):P>=2&&P<=3?(l=J,a=b):P>=3&&P<=4?(l=b,a=J):P>=4&&P<=5?(Y=b,a=J):P>=5&&P<=6&&(Y=J,a=b);const Z=n-J;return B.r=Y+Z,B.g=l+Z,B.b=a+Z,B}static FromHSV(v,y,n){const B=new x(0,0,0);return x.HSVtoRGBToRef(v,y,n,B),B}static FromHexString(v){return new x(0,0,0).fromHexString(v)}static qh(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new x(v[y],v[y+1],v[y+2])}static FromArrayToRef(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;n.r=v[y],n.g=v[y+1],n.b=v[y+2]}static FromInts(v,y,n){return new x(v/255,y/255,n/255)}static Lerp(v,y,n){const B=new x(0,0,0);return x.LerpToRef(v,y,n,B),B}static LerpToRef(v,y,n,B){B.r=v.r+(y.r-v.r)*n,B.g=v.g+(y.g-v.g)*n,B.b=v.b+(y.b-v.b)*n}static Hermite(v,y,n,B,J){const P=J*J,b=J*P,Y=2*b-3*P+1,l=-2*b+3*P,a=b-2*P+J,Z=b-P,f=v.r*Y+n.r*l+y.r*a+B.r*Z,N=v.g*Y+n.g*l+y.g*a+B.g*Z,i=v.b*Y+n.b*l+y.b*a+B.b*Z;return new x(f,N,i)}static Hermite1stDerivative(v,y,n,B,J){const P=x.Black();return this.Hermite1stDerivativeToRef(v,y,n,B,J,P),P}static Hermite1stDerivativeToRef(v,y,n,B,J,P){const b=J*J;P.r=6*(b-J)*v.r+(3*b-4*J+1)*y.r+6*(-b+J)*n.r+(3*b-2*J)*B.r,P.g=6*(b-J)*v.g+(3*b-4*J+1)*y.g+6*(-b+J)*n.g+(3*b-2*J)*B.g,P.b=6*(b-J)*v.b+(3*b-4*J+1)*y.b+6*(-b+J)*n.b+(3*b-2*J)*B.b}static Red(){return new x(1,0,0)}static Green(){return new x(0,1,0)}static Blue(){return new x(0,0,1)}static Black(){return new x(0,0,0)}static get BlackReadOnly(){return x._BlackReadOnly}static White(){return new x(1,1,1)}static Purple(){return new x(.5,0,.5)}static Magenta(){return new x(1,0,1)}static Yellow(){return new x(1,1,0)}static Gray(){return new x(.5,.5,.5)}static Teal(){return new x(0,1,1)}static Random(){return new x(Math.random(),Math.random(),Math.random())}}x._BlackReadOnly=x.Black(),Object.defineProperties(x.prototype,{dimension:{value:[3]},rank:{value:1}});class f{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=v,this.g=y,this.b=n,this.a=B}wj(){return[this.r,this.g,this.b,this.a]}toArray(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return v[y]=this.r,v[y+1]=this.g,v[y+2]=this.b,v[y+3]=this.a,this}qd(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=v[y],this.g=v[y+1],this.b=v[y+2],this.a=v[y+3],this}equals(v){return v&&this.r===v.r&&this.g===v.g&&this.b===v.b&&this.a===v.a}add(v){return new f(this.r+v.r,this.g+v.g,this.b+v.b,this.a+v.a)}addToRef(v,y){return y.r=this.r+v.r,y.g=this.g+v.g,y.b=this.b+v.b,y.a=this.a+v.a,y}addInPlace(v){return this.r+=v.r,this.g+=v.g,this.b+=v.b,this.a+=v.a,this}addInPlaceFromFloats(v,y,n,B){return this.r+=v,this.g+=y,this.b+=n,this.a+=B,this}od(v){return new f(this.r-v.r,this.g-v.g,this.b-v.b,this.a-v.a)}subtractToRef(v,y){return y.r=this.r-v.r,y.g=this.g-v.g,y.b=this.b-v.b,y.a=this.a-v.a,y}Ei(v){return this.r-=v.r,this.g-=v.g,this.b-=v.b,this.a-=v.a,this}subtractFromFloats(v,y,n,B){return new f(this.r-v,this.g-y,this.b-n,this.a-B)}subtractFromFloatsToRef(v,y,n,B,J){return J.r=this.r-v,J.g=this.g-y,J.b=this.b-n,J.a=this.a-B,J}scale(v){return new f(this.r*v,this.g*v,this.b*v,this.a*v)}scaleInPlace(v){return this.r*=v,this.g*=v,this.b*=v,this.a*=v,this}scaleToRef(v,y){return y.r=this.r*v,y.g=this.g*v,y.b=this.b*v,y.a=this.a*v,y}scaleAndAddToRef(v,y){return y.r+=this.r*v,y.g+=this.g*v,y.b+=this.b*v,y.a+=this.a*v,y}clampToRef(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;return n.r=(0,b.c)(this.r,v,y),n.g=(0,b.c)(this.g,v,y),n.b=(0,b.c)(this.b,v,y),n.a=(0,b.c)(this.a,v,y),n}multiply(v){return new f(this.r*v.r,this.g*v.g,this.b*v.b,this.a*v.a)}multiplyToRef(v,y){return y.r=this.r*v.r,y.g=this.g*v.g,y.b=this.b*v.b,y.a=this.a*v.a,y}multiplyInPlace(v){return this.r*=v.r,this.g*=v.g,this.b*=v.b,this.a*=v.a,this}multiplyByFloats(v,y,n,B){return new f(this.r*v,this.g*y,this.b*n,this.a*B)}divide(v){throw new ReferenceError("Can not divide a color")}divideToRef(v,y){throw new ReferenceError("Can not divide a color")}divideInPlace(v){throw new ReferenceError("Can not divide a color")}minimizeInPlace(v){return this.r=Math.min(this.r,v.r),this.g=Math.min(this.g,v.g),this.b=Math.min(this.b,v.b),this.a=Math.min(this.a,v.a),this}maximizeInPlace(v){return this.r=Math.max(this.r,v.r),this.g=Math.max(this.g,v.g),this.b=Math.max(this.b,v.b),this.a=Math.max(this.a,v.a),this}minimizeInPlaceFromFloats(v,y,n,B){return this.r=Math.min(v,this.r),this.g=Math.min(y,this.g),this.b=Math.min(n,this.b),this.a=Math.min(B,this.a),this}maximizeInPlaceFromFloats(v,y,n,B){return this.r=Math.max(v,this.r),this.g=Math.max(y,this.g),this.b=Math.max(n,this.b),this.a=Math.max(B,this.a),this}floorToRef(v){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(v){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(v){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.b;return(0,b.v)(this.r,v.r,y)&&(0,b.v)(this.g,v.g,y)&&(0,b.v)(this.b,v.b,y)&&(0,b.v)(this.a,v.a,y)}equalsToFloats(v,y,n,B){return this.r===v&&this.g===y&&this.b===n&&this.a===B}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"pb"}getHashCode(){let v=255*this.r|0;return v=397*v^255*this.g,v=397*v^255*this.b,v=397*v^255*this.a,v}clone(){return(new f).p(this)}p(v){return this.r=v.r,this.g=v.g,this.b=v.b,this.a=v.a,this}Ae(v,y,n,B){return this.r=v,this.g=y,this.b=n,this.a=B,this}set(v,y,n,B){return this.Ae(v,y,n,B)}xe(v){return this.r=this.g=this.b=this.a=v,this}toHexString(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y=Math.round(255*this.r),n=Math.round(255*this.g),B=Math.round(255*this.b);if(v)return"#"+(0,b.r)(y)+(0,b.r)(n)+(0,b.r)(B);const J=Math.round(255*this.a);return"#"+(0,b.r)(y)+(0,b.r)(n)+(0,b.r)(B)+(0,b.r)(J)}fromHexString(v){return"#"!==v.substring(0,1)||9!==v.length&&7!==v.length||(this.r=parseInt(v.substring(1,3),16)/255,this.g=parseInt(v.substring(3,5),16)/255,this.b=parseInt(v.substring(5,7),16)/255,9===v.length&&(this.a=parseInt(v.substring(7,9),16)/255)),this}toLinearSpace(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y=new f;return this.toLinearSpaceToRef(y,v),y}toLinearSpaceToRef(v){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(v.r=l(this.r),v.g=l(this.g),v.b=l(this.b)):(v.r=Y(this.r),v.g=Y(this.g),v.b=Y(this.b)),v.a=this.a,this}toGammaSpace(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y=new f;return this.toGammaSpaceToRef(y,v),y}toGammaSpaceToRef(v){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(v.r=Z(this.r),v.g=Z(this.g),v.b=Z(this.b)):(v.r=a(this.r),v.g=a(this.g),v.b=a(this.b)),v.a=this.a,this}static FromHexString(v){return"#"!==v.substring(0,1)||9!==v.length&&7!==v.length?new f(0,0,0,0):new f(0,0,0,1).fromHexString(v)}static Lerp(v,y,n){return f.LerpToRef(v,y,n,new f)}static LerpToRef(v,y,n,B){return B.r=v.r+(y.r-v.r)*n,B.g=v.g+(y.g-v.g)*n,B.b=v.b+(y.b-v.b)*n,B.a=v.a+(y.a-v.a)*n,B}static Hermite(v,y,n,B,J){const P=J*J,b=J*P,Y=2*b-3*P+1,l=-2*b+3*P,a=b-2*P+J,Z=b-P,x=v.r*Y+n.r*l+y.r*a+B.r*Z,N=v.g*Y+n.g*l+y.g*a+B.g*Z,i=v.b*Y+n.b*l+y.b*a+B.b*Z,g=v.a*Y+n.a*l+y.a*a+B.a*Z;return new f(x,N,i,g)}static Hermite1stDerivative(v,y,n,B,J){const P=new f;return this.Hermite1stDerivativeToRef(v,y,n,B,J,P),P}static Hermite1stDerivativeToRef(v,y,n,B,J,P){const b=J*J;P.r=6*(b-J)*v.r+(3*b-4*J+1)*y.r+6*(-b+J)*n.r+(3*b-2*J)*B.r,P.g=6*(b-J)*v.g+(3*b-4*J+1)*y.g+6*(-b+J)*n.g+(3*b-2*J)*B.g,P.b=6*(b-J)*v.b+(3*b-4*J+1)*y.b+6*(-b+J)*n.b+(3*b-2*J)*B.b,P.a=6*(b-J)*v.a+(3*b-4*J+1)*y.a+6*(-b+J)*n.a+(3*b-2*J)*B.a}static FromColor3(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new f(v.r,v.g,v.b,y)}static qh(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new f(v[y],v[y+1],v[y+2],v[y+3])}static FromArrayToRef(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;n.r=v[y],n.g=v[y+1],n.b=v[y+2],n.a=v[y+3]}static FromInts(v,y,n,B){return new f(v/255,y/255,n/255,B/255)}static CheckColors4(v,y){if(v.length===3*y){const y=[];for(let n=0;n<v.length;n+=3){const B=n/3*4;y[B]=v[n],y[B+1]=v[n+1],y[B+2]=v[n+2],y[B+3]=1}return y}return v}}Object.defineProperties(f.prototype,{dimension:{value:[4]},rank:{value:1}});class N{}N.ib=(0,B.c)(3,x.Black),N.pb=(0,B.c)(3,(()=>new f(0,0,0,0))),(0,J.g)("BABYLON.Color3",x),(0,J.g)("BABYLON.Color4",f)},11086:(v,y,n)=>{"use strict";n.d(y,{b:()=>b,c:()=>P,g:()=>B,h:()=>J});const B=1/2.2,J=2.2,P=(1+Math.sqrt(5))/2,b=.001},11171:(v,y,n)=>{"use strict";n.d(y,{e:()=>J});var B=n(11180);class J{static GetPlanes(v){const y=[];for(let n=0;n<6;n++)y.push(new B.e(0,0,0,0));return J.GetPlanesToRef(v,y),y}static GetNearPlaneToRef(v,y){const n=v.m;y.k.x=n[3]+n[2],y.k.y=n[7]+n[6],y.k.z=n[11]+n[10],y.d=n[15]+n[14],y.normalize()}static GetFarPlaneToRef(v,y){const n=v.m;y.k.x=n[3]-n[2],y.k.y=n[7]-n[6],y.k.z=n[11]-n[10],y.d=n[15]-n[14],y.normalize()}static GetLeftPlaneToRef(v,y){const n=v.m;y.k.x=n[3]+n[0],y.k.y=n[7]+n[4],y.k.z=n[11]+n[8],y.d=n[15]+n[12],y.normalize()}static GetRightPlaneToRef(v,y){const n=v.m;y.k.x=n[3]-n[0],y.k.y=n[7]-n[4],y.k.z=n[11]-n[8],y.d=n[15]-n[12],y.normalize()}static GetTopPlaneToRef(v,y){const n=v.m;y.k.x=n[3]-n[1],y.k.y=n[7]-n[5],y.k.z=n[11]-n[9],y.d=n[15]-n[13],y.normalize()}static GetBottomPlaneToRef(v,y){const n=v.m;y.k.x=n[3]+n[1],y.k.y=n[7]+n[5],y.k.z=n[11]+n[9],y.d=n[15]+n[13],y.normalize()}static GetPlanesToRef(v,y){J.GetNearPlaneToRef(v,y[0]),J.GetFarPlaneToRef(v,y[1]),J.GetLeftPlaneToRef(v,y[2]),J.GetRightPlaneToRef(v,y[3]),J.GetTopPlaneToRef(v,y[4]),J.GetBottomPlaneToRef(v,y[5])}static IsPointInFrustum(v,y){for(let n=0;n<6;n++)if(y[n].dotCoordinate(v)<0)return!1;return!0}}},11242:(v,y,n)=>{"use strict";n.d(y,{c:()=>Y,f:()=>l});var B=n(11050),J=n(11081),P=n(11055);class b{static extractMinAndMaxIndexed(v,y,n,B,J,P){for(let b=n;b<n+B;b++){const n=3*y[b],B=v[n],Y=v[n+1],l=v[n+2];J.minimizeInPlaceFromFloats(B,Y,l),P.maximizeInPlaceFromFloats(B,Y,l)}}static extractMinAndMax(v,y,n,B,J,P){for(let b=y,Y=y*B;b<y+n;b++,Y+=B){const y=v[Y],n=v[Y+1],B=v[Y+2];J.minimizeInPlaceFromFloats(y,n,B),P.maximizeInPlaceFromFloats(y,n,B)}}}function Y(v,y,n,B){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const Y=new J.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),l=new J.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return b.extractMinAndMaxIndexed(v,y,n,B,Y,l),P&&(Y.x-=Y.x*P.x+P.y,Y.y-=Y.y*P.x+P.y,Y.z-=Y.z*P.x+P.y,l.x+=l.x*P.x+P.y,l.y+=l.y*P.x+P.y,l.z+=l.z*P.x+P.y),{minimum:Y,maximum:l}}function l(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4?arguments[4]:void 0;const Y=new J.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),l=new J.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return P||(P=3),b.extractMinAndMax(v,y,n,P,Y,l),B&&(Y.x-=Y.x*B.x+B.y,Y.y-=Y.y*B.x+B.y,Y.z-=Y.z*B.x+B.y,l.x+=l.x*B.x+B.y,l.y+=l.y*B.x+B.y,l.z+=l.z*B.x+B.y),{minimum:Y,maximum:l}}(0,B.c)([P.g.filter((function(){for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];let[B,J]=y;return!Array.isArray(B)&&!Array.isArray(J)}))],b,"extractMinAndMaxIndexed",null),(0,B.c)([P.g.filter((function(){for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];let[B]=y;return!Array.isArray(B)}))],b,"extractMinAndMax",null)},11564:(v,y,n)=>{"use strict";n.d(y,{d:()=>B.i});n(11390),n(11103),n(11086),n(11171),n(11567),n(11180),n(11289);var B=n(11081);n(11355)},11567:(v,y,n)=>{"use strict";n.d(y,{e:()=>Y,g:()=>Z,k:()=>x});var B,J=n(11091),P=n(11081),b=n(11086);!function(v){v[v.CW=0]="CW",v[v.CCW=1]="CCW"}(B||(B={}));class Y{static Interpolate(v,y,n,B,J){const P=1-3*B+3*y,b=3*B-6*y,Y=3*y;let l=v;for(let a=0;a<5;a++){const y=l*l;l-=(P*(y*l)+b*y+Y*l-v)*(1/(3*P*y+2*b*l+Y)),l=Math.min(1,Math.max(0,l))}return 3*Math.pow(1-l,2)*l*n+3*(1-l)*Math.pow(l,2)*J+Math.pow(l,3)}}class l{constructor(v){this._radians=v,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(v,y){const n=y.od(v),B=Math.atan2(n.y,n.x);return new l(B)}static BetweenTwoVectors(v,y){let n=v.lengthSquared()*y.lengthSquared();if(0===n)return new l(Math.PI/2);n=Math.sqrt(n);let B=v.dot(y)/n;B=(0,J.c)(B,-1,1);const P=Math.acos(B);return new l(P)}static FromRadians(v){return new l(v)}static FromDegrees(v){return new l(v*Math.PI/180)}}class a{constructor(v,y,n){this.startPoint=v,this.midPoint=y,this.endPoint=n;const B=Math.pow(y.x,2)+Math.pow(y.y,2),J=(Math.pow(v.x,2)+Math.pow(v.y,2)-B)/2,b=(B-Math.pow(n.x,2)-Math.pow(n.y,2))/2,Y=(v.x-y.x)*(y.y-n.y)-(y.x-n.x)*(v.y-y.y);this.centerPoint=new P.j((J*(y.y-n.y)-b*(v.y-y.y))/Y,((v.x-y.x)*b-(y.x-n.x)*J)/Y),this.radius=this.centerPoint.od(this.startPoint).length(),this.startAngle=l.BetweenTwoPoints(this.centerPoint,this.startPoint);const a=this.startAngle.degrees();let Z=l.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),x=l.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();Z-a>180&&(Z-=360),Z-a<-180&&(Z+=360),x-Z>180&&(x-=360),x-Z<-180&&(x+=360),this.orientation=Z-a<0?0:1,this.angle=l.FromDegrees(0===this.orientation?a-x:x-a)}}class Z{constructor(v,y){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new P.j(v,y))}addLineTo(v,y){if(this.closed)return this;const n=new P.j(v,y),B=this._points[this._points.length-1];return this._points.push(n),this._length+=n.od(B).length(),this}addArcTo(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const b=this._points[this._points.length-1],Y=new P.j(v,y),l=new P.j(n,B),Z=new a(b,Y,l);let x=Z.angle.radians()/J;0===Z.orientation&&(x*=-1);let f=Z.startAngle.radians()+x;for(let P=0;P<J;P++){const v=Math.cos(f)*Z.radius+Z.centerPoint.x,y=Math.sin(f)*Z.radius+Z.centerPoint.y;this.addLineTo(v,y),f+=x}return this}addQuadraticCurveTo(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const P=(v,y,n,B)=>(1-v)*(1-v)*y+2*v*(1-v)*n+v*v*B,b=this._points[this._points.length-1];for(let Y=0;Y<=J;Y++){const l=Y/J,a=P(l,b.x,v,n),Z=P(l,b.y,y,B);this.addLineTo(a,Z)}return this}addBezierCurveTo(v,y,n,B,J,P){let b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const Y=(v,y,n,B,J)=>(1-v)*(1-v)*(1-v)*y+3*v*(1-v)*(1-v)*n+3*v*v*(1-v)*B+v*v*v*J,l=this._points[this._points.length-1];for(let a=0;a<=b;a++){const Z=a/b,x=Y(Z,l.x,v,n,J),f=Y(Z,l.y,y,B,P);this.addLineTo(x,f)}return this}isPointInside(v){let y=!1;const n=this._points.length;for(let B=n-1,J=0;J<n;B=J++){let n=this._points[B],P=this._points[J],b=P.x-n.x,Y=P.y-n.y;if(Math.abs(Y)>Number.EPSILON){if(Y<0&&(n=this._points[J],b=-b,P=this._points[B],Y=-Y),v.y<n.y||v.y>P.y)continue;if(v.y===n.y&&v.x===n.x)return!0;{const B=Y*(v.x-n.x)-b*(v.y-n.y);if(0===B)return!0;if(B<0)continue;y=!y}}else{if(v.y!==n.y)continue;if(P.x<=v.x&&v.x<=n.x||n.x<=v.x&&v.x<=P.x)return!0}}return y}close(){return this.closed=!0,this}length(){let v=this._length;if(this.closed){const y=this._points[this._points.length-1];v+=this._points[0].od(y).length()}return v}area(){const v=this._points.length;let y=0;for(let n=v-1,B=0;B<v;n=B++)y+=this._points[n].x*this._points[B].y-this._points[B].x*this._points[n].y;return.5*y}getPoints(){return this._points}getPointAtLengthPosition(v){if(v<0||v>1)return P.j.Zero();const y=v*this.length();let n=0;for(let B=0;B<this._points.length;B++){const v=(B+1)%this._points.length,J=this._points[B],b=this._points[v].od(J),Y=b.length()+n;if(y>=n&&y<=Y){const v=b.normalize(),B=y-n;return new P.j(J.x+v.x*B,J.y+v.y*B)}n=Y}return P.j.Zero()}static StartingAt(v,y){return new Z(v,y)}}class x{constructor(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=v,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:P.n.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:P.d.Identity()};for(let J=0;J<v.length;J++)this._curve[J]=v[J].clone();this._raw=n||!1,this._alignTangentsWithPath=B,this._compute(y,B)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(v){return this._updatePointAtData(v).point}getTangentAt(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(v,y),y?P.n.TransformCoordinates(P.n.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(v,y),y?P.n.TransformCoordinates(P.n.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(v,y),y?P.n.TransformCoordinates(P.n.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(v){return this.length()*v}getPreviousPointIndexAt(v){return this._updatePointAtData(v),this._pointAtData.previousPointArrayIndex}getSubPositionAt(v){return this._updatePointAtData(v),this._pointAtData.subPosition}getClosestPositionTo(v){let y=Number.MAX_VALUE,n=0;for(let B=0;B<this._curve.length-1;B++){const J=this._curve[B+0],b=this._curve[B+1].od(J).normalize(),Y=this._distances[B+1]-this._distances[B+0],l=Math.min(Math.max(P.n.Dot(b,v.od(J).normalize()),0)*P.n.Distance(J,v)/Y,1),a=P.n.Distance(J.add(b.scale(l*Y)),v);a<y&&(y=a,n=(this._distances[B+0]+Y*l)/this.length())}return n}slice(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(v<0&&(v=1- -1*v%1),y<0&&(y=1- -1*y%1),v>y){const n=v;v=y,y=n}const n=this.getCurve(),B=this.getPointAt(v);let J=this.getPreviousPointIndexAt(v);const P=this.getPointAt(y),b=this.getPreviousPointIndexAt(y)+1,Y=[];return 0!==v&&(J++,Y.push(B)),Y.push(...n.slice(J,b)),1===y&&1!==v||Y.push(P),new x(Y,this.getNormalAt(v),this._raw,this._alignTangentsWithPath)}update(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let B=0;B<v.length;B++)this._curve[B].x=v[B].x,this._curve[B].y=v[B].y,this._curve[B].z=v[B].z;return this._compute(y,n),this}_compute(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this._curve.length;if(n<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[n-1]=this._curve[n-1].od(this._curve[n-2]),this._raw||this._tangents[n-1].normalize();const B=this._tangents[0],J=this._normalVector(B,v);let b,Y,l,a,Z;this._normals[0]=J,this._raw||this._normals[0].normalize(),this._binormals[0]=P.n.Cross(B,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let x=1;x<n;x++)b=this._getLastNonNullVector(x),x<n-1&&(Y=this._getFirstNonNullVector(x),this._tangents[x]=y?Y:b.add(Y),this._tangents[x].normalize()),this._distances[x]=this._distances[x-1]+this._curve[x].od(this._curve[x-1]).length(),l=this._tangents[x],Z=this._binormals[x-1],this._normals[x]=P.n.Cross(Z,l),this._raw||(0===this._normals[x].length()?(a=this._normals[x-1],this._normals[x]=a.clone()):this._normals[x].normalize()),this._binormals[x]=P.n.Cross(l,this._normals[x]),this._raw||this._binormals[x].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(v){let y=1,n=this._curve[v+y].od(this._curve[v]);for(;0===n.length()&&v+y+1<this._curve.length;)y++,n=this._curve[v+y].od(this._curve[v]);return n}_getLastNonNullVector(v){let y=1,n=this._curve[v].od(this._curve[v-y]);for(;0===n.length()&&v>y+1;)y++,n=this._curve[v].od(this._curve[v-y]);return n}_normalVector(v,y){let n,B=v.length();if(0===B&&(B=1),void 0===y||null===y){let y;y=(0,J.v)(Math.abs(v.y)/B,1,b.b)?(0,J.v)(Math.abs(v.x)/B,1,b.b)?(0,J.v)(Math.abs(v.z)/B,1,b.b)?P.n.Zero():new P.n(0,0,1):new P.n(1,0,0):new P.n(0,-1,0),n=P.n.Cross(v,y)}else n=P.n.Cross(v,y),P.n.CrossToRef(n,v,n);return n.normalize(),n}_updatePointAtData(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===v)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=v;const n=this.getPoints();if(v<=0)return this._setPointAtData(0,0,n[0],0,y);if(v>=1)return this._setPointAtData(1,1,n[n.length-1],n.length-1,y);let B,J=n[0],b=0;const Y=v*this.length();for(let l=1;l<n.length;l++){B=n[l];const a=P.n.Distance(J,B);if(b+=a,b===Y)return this._setPointAtData(v,1,B,l,y);if(b>Y){const n=(b-Y)/a,P=J.od(B),Z=B.add(P.scaleInPlace(n));return this._setPointAtData(v,1-n,Z,l-1,y)}J=B}return this._pointAtData}_setPointAtData(v,y,n,B,J){return this._pointAtData.point=n,this._pointAtData.position=v,this._pointAtData.subPosition=y,this._pointAtData.previousPointArrayIndex=B,this._pointAtData.interpolateReady=J,J&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=P.d.Identity();const v=this._pointAtData.previousPointArrayIndex;if(v!==this._tangents.length-1){const y=v+1,n=this._tangents[v].clone(),B=this._normals[v].clone(),J=this._binormals[v].clone(),b=this._tangents[y].clone(),Y=this._normals[y].clone(),l=this._binormals[y].clone(),a=P.g.RotationQuaternionFromAxis(B,J,n),Z=P.g.RotationQuaternionFromAxis(Y,l,b);P.g.Slerp(a,Z,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},11180:(v,y,n)=>{"use strict";n.d(y,{e:()=>J});var B=n(11081);class J{constructor(v,y,n,J){this.k=new B.n(v,y,n),this.d=J}wj(){return[this.k.x,this.k.y,this.k.z,this.d]}clone(){return new J(this.k.x,this.k.y,this.k.z,this.d)}getClassName(){return"Plane"}getHashCode(){let v=this.k.getHashCode();return v=397*v^this.d,v}normalize(){const v=Math.sqrt(this.k.x*this.k.x+this.k.y*this.k.y+this.k.z*this.k.z);let y=0;return 0!==v&&(y=1/v),this.k.x*=y,this.k.y*=y,this.k.z*=y,this.d*=y,this}transform(v){const y=J._TmpMatrix;v.invertToRef(y);const n=y.m,B=this.k.x,P=this.k.y,b=this.k.z,Y=this.d,l=B*n[0]+P*n[1]+b*n[2]+Y*n[3],a=B*n[4]+P*n[5]+b*n[6]+Y*n[7],Z=B*n[8]+P*n[9]+b*n[10]+Y*n[11],x=B*n[12]+P*n[13]+b*n[14]+Y*n[15];return new J(l,a,Z,x)}dotCoordinate(v){return this.k.x*v.x+this.k.y*v.y+this.k.z*v.z+this.d}copyFromPoints(v,y,n){const B=y.x-v.x,J=y.y-v.y,P=y.z-v.z,b=n.x-v.x,Y=n.y-v.y,l=n.z-v.z,a=J*l-P*Y,Z=P*b-B*l,x=B*Y-J*b,f=Math.sqrt(a*a+Z*Z+x*x);let N;return N=0!==f?1/f:0,this.k.x=a*N,this.k.y=Z*N,this.k.z=x*N,this.d=-(this.k.x*v.x+this.k.y*v.y+this.k.z*v.z),this}isFrontFacingTo(v,y){return B.n.Dot(this.k,v)<=y}signedDistanceTo(v){return B.n.Dot(v,this.k)+this.d}static qh(v){return new J(v[0],v[1],v[2],v[3])}static FromPoints(v,y,n){const B=new J(0,0,0,0);return B.copyFromPoints(v,y,n),B}static FromPositionAndNormal(v,y){const n=new J(0,0,0,0);return this.FromPositionAndNormalToRef(v,y,n)}static FromPositionAndNormalToRef(v,y,n){return n.k.p(y),n.k.normalize(),n.d=-v.dot(n.k),n}static SignedDistanceToPlaneFromPositionAndNormal(v,y,n){const J=-(y.x*v.x+y.y*v.y+y.z*v.z);return B.n.Dot(n,y)+J}}J._TmpMatrix=B.d.Identity()},11091:(v,y,n)=>{"use strict";function B(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(v-y)<=n}function J(v,y){return v===y?v:Math.random()*(y-v)+v}function P(v,y,n){return v+(y-v)*n}function b(v,y,n,B,J){const P=J*J,b=J*P;return v*(2*b-3*P+1)+n*(-2*b+3*P)+y*(b-2*P+J)+B*(b-P)}function Y(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(n,Math.max(y,v))}function l(v){return v-=2*Math.PI*Math.floor((v+Math.PI)/(2*Math.PI))}function a(v){const y=v.toString(16);return v<=15?("0"+y).toUpperCase():y.toUpperCase()}function Z(v){if(Math.log2)return Math.floor(Math.log2(v));if(v<0)return NaN;if(0===v)return-1/0;let y=0;if(v<1){for(;v<1;)y++,v*=2;y=-y}else if(v>1)for(;v>1;)y++,v=Math.floor(v/2);return y}function x(v,y){const n=v%y;return 0===n?y:x(y,n)}n.d(y,{c:()=>Y,d:()=>b,g:()=>x,h:()=>Z,k:()=>P,m:()=>l,n:()=>J,r:()=>a,v:()=>B})},11289:(v,y,n)=>{"use strict";n.d(y,{c:()=>B});class B{constructor(v,y){this.width=v,this.height=y}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let v=0|this.width;return v=397*v^this.height,v}p(v){this.width=v.width,this.height=v.height}Ae(v,y){return this.width=v,this.height=y,this}set(v,y){return this.Ae(v,y)}multiplyByFloats(v,y){return new B(this.width*v,this.height*y)}clone(){return new B(this.width,this.height)}equals(v){return!!v&&(this.width===v.width&&this.height===v.height)}get surface(){return this.width*this.height}static Zero(){return new B(0,0)}add(v){return new B(this.width+v.width,this.height+v.height)}od(v){return new B(this.width-v.width,this.height-v.height)}scale(v){return new B(this.width*v,this.height*v)}static Lerp(v,y,n){const J=v.width+(y.width-v.width)*n,P=v.height+(y.height-v.height)*n;return new B(J,P)}}},11081:(v,y,n)=>{"use strict";n.d(y,{d:()=>i,g:()=>N,i:()=>c,j:()=>Z,n:()=>x,p:()=>f});var B=n(11086),J=n(11088),P=n(10908),b=n(10882),Y=n(10820),l=n(11091);const a=v=>parseInt(v.toString().replace(/\W/g,""));class Z{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=v,this.y=y}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let v=a(this.x);return v=397*v^a(this.y),v}toArray(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return v[y]=this.x,v[y+1]=this.y,this}qd(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Z.FromArrayToRef(v,y,this),this}wj(){return[this.x,this.y]}p(v){return this.x=v.x,this.y=v.y,this}Ae(v,y){return this.x=v,this.y=y,this}set(v,y){return this.Ae(v,y)}xe(v){return this.Ae(v,v)}add(v){return new Z(this.x+v.x,this.y+v.y)}addToRef(v,y){return y.x=this.x+v.x,y.y=this.y+v.y,y}addInPlace(v){return this.x+=v.x,this.y+=v.y,this}addInPlaceFromFloats(v,y){return this.x+=v,this.y+=y,this}addVector3(v){return new Z(this.x+v.x,this.y+v.y)}od(v){return new Z(this.x-v.x,this.y-v.y)}subtractToRef(v,y){return y.x=this.x-v.x,y.y=this.y-v.y,y}Ei(v){return this.x-=v.x,this.y-=v.y,this}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this}multiply(v){return new Z(this.x*v.x,this.y*v.y)}multiplyToRef(v,y){return y.x=this.x*v.x,y.y=this.y*v.y,y}multiplyByFloats(v,y){return new Z(this.x*v,this.y*y)}divide(v){return new Z(this.x/v.x,this.y/v.y)}divideToRef(v,y){return y.x=this.x/v.x,y.y=this.y/v.y,y}divideInPlace(v){return this.x=this.x/v.x,this.y=this.y/v.y,this}minimizeInPlace(v){return this.minimizeInPlaceFromFloats(v.x,v.y)}maximizeInPlace(v){return this.maximizeInPlaceFromFloats(v.x,v.y)}minimizeInPlaceFromFloats(v,y){return this.x=Math.min(v,this.x),this.y=Math.min(y,this.y),this}maximizeInPlaceFromFloats(v,y){return this.x=Math.max(v,this.x),this.y=Math.max(y,this.y),this}subtractFromFloats(v,y){return new Z(this.x-v,this.y-y)}subtractFromFloatsToRef(v,y,n){return n.x=this.x-v,n.y=this.y-y,n}negate(){return new Z(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(v){return v.x=-this.x,v.y=-this.y,v}scaleInPlace(v){return this.x*=v,this.y*=v,this}scale(v){return new Z(this.x*v,this.y*v)}scaleToRef(v,y){return y.x=this.x*v,y.y=this.y*v,y}scaleAndAddToRef(v,y){return y.x+=this.x*v,y.y+=this.y*v,y}equals(v){return v&&this.x===v.x&&this.y===v.y}equalsWithEpsilon(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.b;return v&&(0,l.v)(this.x,v.x,y)&&(0,l.v)(this.y,v.y,y)}equalsToFloats(v,y){return this.x===v&&this.y===y}floor(){return new Z(Math.floor(this.x),Math.floor(this.y))}floorToRef(v){return v.x=Math.floor(this.x),v.y=Math.floor(this.y),v}fract(){return new Z(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(v){return v.x=this.x-Math.floor(this.x),v.y=this.y-Math.floor(this.y),v}rotateToRef(v,y){const n=Math.cos(v),B=Math.sin(v),J=n*this.x-B*this.y,P=B*this.x+n*this.y;return y.x=J,y.y=P,y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(v){return 0===v||1===v?this:this.scaleInPlace(1/v)}normalizeToNew(){const v=new Z;return this.normalizeToRef(v),v}normalizeToRef(v){const y=this.length();return 0===y&&(v.x=this.x,v.y=this.y),this.scaleToRef(1/y,v)}clone(){return new Z(this.x,this.y)}dot(v){return this.x*v.x+this.y*v.y}static Zero(){return new Z(0,0)}static One(){return new Z(1,1)}static Random(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Z((0,l.n)(v,y),(0,l.n)(v,y))}static RandomToRef(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Ae((0,l.n)(v,y),(0,l.n)(v,y))}static get ZeroReadOnly(){return Z._ZeroReadOnly}static qh(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Z(v[y],v[y+1])}static FromArrayToRef(v,y,n){return n.x=v[y],n.y=v[y+1],n}static FromFloatsToRef(v,y,n){return n.Ae(v,y),n}static CatmullRom(v,y,n,B,J){const P=J*J,b=J*P,Y=.5*(2*y.x+(-v.x+n.x)*J+(2*v.x-5*y.x+4*n.x-B.x)*P+(-v.x+3*y.x-3*n.x+B.x)*b),l=.5*(2*y.y+(-v.y+n.y)*J+(2*v.y-5*y.y+4*n.y-B.y)*P+(-v.y+3*y.y-3*n.y+B.y)*b);return new Z(Y,l)}static ClampToRef(v,y,n,B){return B.x=(0,l.c)(v.x,y.x,n.x),B.y=(0,l.c)(v.y,y.y,n.y),B}static Clamp(v,y,n){const B=(0,l.c)(v.x,y.x,n.x),J=(0,l.c)(v.y,y.y,n.y);return new Z(B,J)}static Hermite(v,y,n,B,J){const P=J*J,b=J*P,Y=2*b-3*P+1,l=-2*b+3*P,a=b-2*P+J,x=b-P,f=v.x*Y+n.x*l+y.x*a+B.x*x,N=v.y*Y+n.y*l+y.y*a+B.y*x;return new Z(f,N)}static Hermite1stDerivative(v,y,n,B,J){return this.Hermite1stDerivativeToRef(v,y,n,B,J,new Z)}static Hermite1stDerivativeToRef(v,y,n,B,J,P){const b=J*J;return P.x=6*(b-J)*v.x+(3*b-4*J+1)*y.x+6*(-b+J)*n.x+(3*b-2*J)*B.x,P.y=6*(b-J)*v.y+(3*b-4*J+1)*y.y+6*(-b+J)*n.y+(3*b-2*J)*B.y,P}static Lerp(v,y,n){return Z.LerpToRef(v,y,n,new Z)}static LerpToRef(v,y,n,B){return B.x=v.x+(y.x-v.x)*n,B.y=v.y+(y.y-v.y)*n,B}static Dot(v,y){return v.x*y.x+v.y*y.y}static Normalize(v){return Z.NormalizeToRef(v,new Z)}static NormalizeToRef(v,y){return v.normalizeToRef(y),y}static Minimize(v,y){const n=v.x<y.x?v.x:y.x,B=v.y<y.y?v.y:y.y;return new Z(n,B)}static Maximize(v,y){const n=v.x>y.x?v.x:y.x,B=v.y>y.y?v.y:y.y;return new Z(n,B)}static Transform(v,y){return Z.TransformToRef(v,y,new Z)}static TransformToRef(v,y,n){const B=y.m,J=v.x*B[0]+v.y*B[4]+B[12],P=v.x*B[1]+v.y*B[5]+B[13];return n.x=J,n.y=P,n}static PointInTriangle(v,y,n,B){const J=.5*(-n.y*B.x+y.y*(-n.x+B.x)+y.x*(n.y-B.y)+n.x*B.y),P=J<0?-1:1,b=(y.y*B.x-y.x*B.y+(B.y-y.y)*v.x+(y.x-B.x)*v.y)*P,Y=(y.x*n.y-y.y*n.x+(y.y-n.y)*v.x+(n.x-y.x)*v.y)*P;return b>0&&Y>0&&b+Y<2*J*P}static Distance(v,y){return Math.sqrt(Z.DistanceSquared(v,y))}static DistanceSquared(v,y){const n=v.x-y.x,B=v.y-y.y;return n*n+B*B}static Center(v,y){return Z.CenterToRef(v,y,new Z)}static CenterToRef(v,y,n){return n.Ae((v.x+y.x)/2,(v.y+y.y)/2)}static DistanceOfPointFromSegment(v,y,n){const B=Z.DistanceSquared(y,n);if(0===B)return Z.Distance(v,y);const J=n.od(y),P=Math.max(0,Math.min(1,Z.Dot(v.od(y),J)/B)),b=y.add(J.multiplyByFloats(P,P));return Z.Distance(v,b)}}Z._ZeroReadOnly=Z.Zero(),Object.defineProperties(Z.prototype,{dimension:{value:[2]},rank:{value:1}});class x{get x(){return this._x}set x(v){this._x=v,this._isDirty=!0}get y(){return this._y}set y(v){this._y=v,this._isDirty=!0}get z(){return this._z}set z(v){this._z=v,this._isDirty=!0}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=v,this._y=y,this._z=n}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"o"}getHashCode(){let v=a(this._x);return v=397*v^a(this._y),v=397*v^a(this._z),v}wj(){return[this._x,this._y,this._z]}toArray(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return v[y]=this._x,v[y+1]=this._y,v[y+2]=this._z,this}qd(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return x.FromArrayToRef(v,y,this),this}toQuaternion(){return N.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(v){return this._x+=v._x,this._y+=v._y,this._z+=v._z,this._isDirty=!0,this}addInPlaceFromFloats(v,y,n){return this._x+=v,this._y+=y,this._z+=n,this._isDirty=!0,this}add(v){return new x(this._x+v._x,this._y+v._y,this._z+v._z)}addToRef(v,y){return y._x=this._x+v._x,y._y=this._y+v._y,y._z=this._z+v._z,y._isDirty=!0,y}Ei(v){return this._x-=v._x,this._y-=v._y,this._z-=v._z,this._isDirty=!0,this}od(v){return new x(this._x-v._x,this._y-v._y,this._z-v._z)}subtractToRef(v,y){return this.subtractFromFloatsToRef(v._x,v._y,v._z,y)}subtractFromFloats(v,y,n){return new x(this._x-v,this._y-y,this._z-n)}subtractFromFloatsToRef(v,y,n,B){return B._x=this._x-v,B._y=this._y-y,B._z=this._z-n,B._isDirty=!0,B}negate(){return new x(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(v){return v._x=-1*this._x,v._y=-1*this._y,v._z=-1*this._z,v._isDirty=!0,v}scaleInPlace(v){return this._x*=v,this._y*=v,this._z*=v,this._isDirty=!0,this}scale(v){return new x(this._x*v,this._y*v,this._z*v)}scaleToRef(v,y){return y._x=this._x*v,y._y=this._y*v,y._z=this._z*v,y._isDirty=!0,y}getNormalToRef(v){const y=this.length();let n=Math.acos(this.y/y);const B=Math.atan2(this.z,this.x);n>Math.PI/2?n-=Math.PI/2:n+=Math.PI/2;const J=y*Math.sin(n)*Math.cos(B),P=y*Math.cos(n),b=y*Math.sin(n)*Math.sin(B);return v.set(J,P,b),v}applyRotationQuaternionToRef(v,y){const n=this._x,B=this._y,J=this._z,P=v._x,b=v._y,Y=v._z,l=v._w,a=2*(b*J-Y*B),Z=2*(Y*n-P*J),x=2*(P*B-b*n);return y._x=n+l*a+b*x-Y*Z,y._y=B+l*Z+Y*a-P*x,y._z=J+l*x+P*Z-b*a,y._isDirty=!0,y}applyRotationQuaternionInPlace(v){return this.applyRotationQuaternionToRef(v,this)}applyRotationQuaternion(v){return this.applyRotationQuaternionToRef(v,new x)}scaleAndAddToRef(v,y){return y._x+=this._x*v,y._y+=this._y*v,y._z+=this._z*v,y._isDirty=!0,y}projectOnPlane(v,y){return this.projectOnPlaneToRef(v,y,new x)}projectOnPlaneToRef(v,y,n){const B=v.k,J=v.d,P=g.o[0];this.subtractToRef(y,P),P.normalize();const b=x.Dot(P,B);if(Math.abs(b)<1e-10)n.xe(1/0);else{const v=-(x.Dot(y,B)+J)/b,Y=P.scaleInPlace(v);y.addToRef(Y,n)}return n}equals(v){return v&&this._x===v._x&&this._y===v._y&&this._z===v._z}equalsWithEpsilon(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.b;return v&&(0,l.v)(this._x,v._x,y)&&(0,l.v)(this._y,v._y,y)&&(0,l.v)(this._z,v._z,y)}equalsToFloats(v,y,n){return this._x===v&&this._y===y&&this._z===n}multiplyInPlace(v){return this._x*=v._x,this._y*=v._y,this._z*=v._z,this._isDirty=!0,this}multiply(v){return this.multiplyByFloats(v._x,v._y,v._z)}multiplyToRef(v,y){return y._x=this._x*v._x,y._y=this._y*v._y,y._z=this._z*v._z,y._isDirty=!0,y}multiplyByFloats(v,y,n){return new x(this._x*v,this._y*y,this._z*n)}divide(v){return new x(this._x/v._x,this._y/v._y,this._z/v._z)}divideToRef(v,y){return y._x=this._x/v._x,y._y=this._y/v._y,y._z=this._z/v._z,y._isDirty=!0,y}divideInPlace(v){return this._x=this._x/v._x,this._y=this._y/v._y,this._z=this._z/v._z,this._isDirty=!0,this}minimizeInPlace(v){return this.minimizeInPlaceFromFloats(v._x,v._y,v._z)}maximizeInPlace(v){return this.maximizeInPlaceFromFloats(v._x,v._y,v._z)}minimizeInPlaceFromFloats(v,y,n){return v<this._x&&(this.x=v),y<this._y&&(this.y=y),n<this._z&&(this.z=n),this}maximizeInPlaceFromFloats(v,y,n){return v>this._x&&(this.x=v),y>this._y&&(this.y=y),n>this._z&&(this.z=n),this}isNonUniformWithinEpsilon(v){const y=Math.abs(this._x),n=Math.abs(this._y);if(!(0,l.v)(y,n,v))return!0;const B=Math.abs(this._z);return!(0,l.v)(y,B,v)||!(0,l.v)(n,B,v)}get isNonUniform(){const v=Math.abs(this._x);if(v!==Math.abs(this._y))return!0;return v!==Math.abs(this._z)}floorToRef(v){return v._x=Math.floor(this._x),v._y=Math.floor(this._y),v._z=Math.floor(this._z),v._isDirty=!0,v}floor(){return new x(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(v){return v._x=this.x-Math.floor(this._x),v._y=this.y-Math.floor(this._y),v._z=this.z-Math.floor(this._z),v._isDirty=!0,v}fract(){return new x(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(v){if("xyz"===(v=v.toLowerCase()))return this;const y=g.o[0].p(this);return this.x=y[v[0]],this.y=y[v[1]],this.z=y[v[2]],this}rotateByQuaternionToRef(v,y){return v.toRotationMatrix(g.Matrix[0]),x.TransformCoordinatesToRef(this,g.Matrix[0],y),y}rotateByQuaternionAroundPointToRef(v,y,n){return this.subtractToRef(y,g.o[0]),g.o[0].rotateByQuaternionToRef(v,g.o[0]),y.addToRef(g.o[0],n),n}cross(v){return x.CrossToRef(this,v,new x)}normalizeFromLength(v){return 0===v||1===v?this:this.scaleInPlace(1/v)}normalizeToNew(){return this.normalizeToRef(new x)}normalizeToRef(v){const y=this.length();return 0===y||1===y?(v._x=this._x,v._y=this._y,v._z=this._z,v._isDirty=!0,v):this.scaleToRef(1/y,v)}clone(){return new x(this._x,this._y,this._z)}p(v){return this.Ae(v._x,v._y,v._z)}Ae(v,y,n){return this._x=v,this._y=y,this._z=n,this._isDirty=!0,this}set(v,y,n){return this.Ae(v,y,n)}xe(v){return this._x=this._y=this._z=v,this._isDirty=!0,this}static GetClipFactor(v,y,n,B){const J=x.Dot(v,n);return(J-B)/(J-x.Dot(y,n))}static GetAngleBetweenVectors(v,y,n){const B=v.normalizeToRef(g.o[1]),J=y.normalizeToRef(g.o[2]);let P=x.Dot(B,J);P=(0,l.c)(P,-1,1);const b=Math.acos(P),Y=g.o[3];return x.CrossToRef(B,J,Y),x.Dot(Y,n)>0?isNaN(b)?0:b:isNaN(b)?-Math.PI:-Math.acos(P)}static GetAngleBetweenVectorsOnPlane(v,y,n){g.o[0].p(v);const B=g.o[0];g.o[1].p(y);const J=g.o[1];g.o[2].p(n);const P=g.o[2],b=g.o[3],Y=g.o[4];B.normalize(),J.normalize(),P.normalize(),x.CrossToRef(P,B,b),x.CrossToRef(b,P,Y);const a=Math.atan2(x.Dot(J,b),x.Dot(J,Y));return(0,l.m)(a)}static PitchYawRollToMoveBetweenPointsToRef(v,y,n){const B=c.o[0];return y.subtractToRef(v,B),n._y=Math.atan2(B.x,B.z)||0,n._x=Math.atan2(Math.sqrt(B.x**2+B.z**2),B.y)||0,n._z=0,n._isDirty=!0,n}static PitchYawRollToMoveBetweenPoints(v,y){const n=x.Zero();return x.PitchYawRollToMoveBetweenPointsToRef(v,y,n)}static SlerpToRef(v,y,n,J){n=(0,l.c)(n,0,1);const P=g.o[0],b=g.o[1];P.p(v);const Y=P.length();P.normalizeFromLength(Y),b.p(y);const a=b.length();b.normalizeFromLength(a);const Z=x.Dot(P,b);let f,N;if(Z<1-B.b){const v=Math.acos(Z),y=1/Math.sin(v);f=Math.sin((1-n)*v)*y,N=Math.sin(n*v)*y}else f=1-n,N=n;return P.scaleInPlace(f),b.scaleInPlace(N),J.p(P).addInPlace(b),J.scaleInPlace((0,l.k)(Y,a,n)),J}static SmoothToRef(v,y,n,B,J){return x.SlerpToRef(v,y,0===B?1:n/B,J),J}static qh(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new x(v[y],v[y+1],v[y+2])}static FromFloatArray(v,y){return x.qh(v,y)}static FromArrayToRef(v,y,n){return n._x=v[y],n._y=v[y+1],n._z=v[y+2],n._isDirty=!0,n}static FromFloatArrayToRef(v,y,n){return x.FromArrayToRef(v,y,n)}static FromFloatsToRef(v,y,n,B){return B.Ae(v,y,n),B}static Zero(){return new x(0,0,0)}static One(){return new x(1,1,1)}static Up(){return new x(0,1,0)}static get UpReadOnly(){return x._UpReadOnly}static get DownReadOnly(){return x._DownReadOnly}static get RightReadOnly(){return x._RightReadOnly}static get LeftReadOnly(){return x._LeftReadOnly}static get LeftHandedForwardReadOnly(){return x._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return x._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return x._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return x._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return x._ZeroReadOnly}static get OneReadOnly(){return x._OneReadOnly}static Down(){return new x(0,-1,0)}static Forward(){return new x(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new x(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new x(1,0,0)}static Left(){return new x(-1,0,0)}static Random(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new x((0,l.n)(v,y),(0,l.n)(v,y),(0,l.n)(v,y))}static RandomToRef(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Ae((0,l.n)(v,y),(0,l.n)(v,y),(0,l.n)(v,y))}static TransformCoordinates(v,y){const n=x.Zero();return x.TransformCoordinatesToRef(v,y,n),n}static TransformCoordinatesToRef(v,y,n){return x.TransformCoordinatesFromFloatsToRef(v._x,v._y,v._z,y,n),n}static TransformCoordinatesFromFloatsToRef(v,y,n,B,J){const P=B.m,b=v*P[0]+y*P[4]+n*P[8]+P[12],Y=v*P[1]+y*P[5]+n*P[9]+P[13],l=v*P[2]+y*P[6]+n*P[10]+P[14],a=1/(v*P[3]+y*P[7]+n*P[11]+P[15]);return J._x=b*a,J._y=Y*a,J._z=l*a,J._isDirty=!0,J}static TransformNormal(v,y){const n=x.Zero();return x.TransformNormalToRef(v,y,n),n}static TransformNormalToRef(v,y,n){return this.TransformNormalFromFloatsToRef(v._x,v._y,v._z,y,n),n}static TransformNormalFromFloatsToRef(v,y,n,B,J){const P=B.m;return J._x=v*P[0]+y*P[4]+n*P[8],J._y=v*P[1]+y*P[5]+n*P[9],J._z=v*P[2]+y*P[6]+n*P[10],J._isDirty=!0,J}static CatmullRom(v,y,n,B,J){const P=J*J,b=J*P,Y=.5*(2*y._x+(-v._x+n._x)*J+(2*v._x-5*y._x+4*n._x-B._x)*P+(-v._x+3*y._x-3*n._x+B._x)*b),l=.5*(2*y._y+(-v._y+n._y)*J+(2*v._y-5*y._y+4*n._y-B._y)*P+(-v._y+3*y._y-3*n._y+B._y)*b),a=.5*(2*y._z+(-v._z+n._z)*J+(2*v._z-5*y._z+4*n._z-B._z)*P+(-v._z+3*y._z-3*n._z+B._z)*b);return new x(Y,l,a)}static Clamp(v,y,n){const B=new x;return x.ClampToRef(v,y,n,B),B}static ClampToRef(v,y,n,B){let J=v._x;J=J>n._x?n._x:J,J=J<y._x?y._x:J;let P=v._y;P=P>n._y?n._y:P,P=P<y._y?y._y:P;let b=v._z;return b=b>n._z?n._z:b,b=b<y._z?y._z:b,B.Ae(J,P,b),B}static CheckExtends(v,y,n){y.minimizeInPlace(v),n.maximizeInPlace(v)}static Hermite(v,y,n,B,J){const P=J*J,b=J*P,Y=2*b-3*P+1,l=-2*b+3*P,a=b-2*P+J,Z=b-P,f=v._x*Y+n._x*l+y._x*a+B._x*Z,N=v._y*Y+n._y*l+y._y*a+B._y*Z,i=v._z*Y+n._z*l+y._z*a+B._z*Z;return new x(f,N,i)}static Hermite1stDerivative(v,y,n,B,J){const P=new x;return this.Hermite1stDerivativeToRef(v,y,n,B,J,P),P}static Hermite1stDerivativeToRef(v,y,n,B,J,P){const b=J*J;return P._x=6*(b-J)*v._x+(3*b-4*J+1)*y._x+6*(-b+J)*n._x+(3*b-2*J)*B._x,P._y=6*(b-J)*v._y+(3*b-4*J+1)*y._y+6*(-b+J)*n._y+(3*b-2*J)*B._y,P._z=6*(b-J)*v._z+(3*b-4*J+1)*y._z+6*(-b+J)*n._z+(3*b-2*J)*B._z,P._isDirty=!0,P}static Lerp(v,y,n){const B=new x(0,0,0);return x.LerpToRef(v,y,n,B),B}static LerpToRef(v,y,n,B){return B._x=v._x+(y._x-v._x)*n,B._y=v._y+(y._y-v._y)*n,B._z=v._z+(y._z-v._z)*n,B._isDirty=!0,B}static Dot(v,y){return v._x*y._x+v._y*y._y+v._z*y._z}dot(v){return this._x*v._x+this._y*v._y+this._z*v._z}static Cross(v,y){const n=new x;return x.CrossToRef(v,y,n),n}static CrossToRef(v,y,n){const B=v._y*y._z-v._z*y._y,J=v._z*y._x-v._x*y._z,P=v._x*y._y-v._y*y._x;return n.Ae(B,J,P),n}static Normalize(v){const y=x.Zero();return x.NormalizeToRef(v,y),y}static NormalizeToRef(v,y){return v.normalizeToRef(y),y}static Project(v,y,n,B){const J=new x;return x.ProjectToRef(v,y,n,B,J),J}static ProjectToRef(v,y,n,B,J){var P;const b=B.width,l=B.height,a=B.x,Z=B.y,f=g.Matrix[1],N=null===(P=Y.b.LastCreatedEngine)||void 0===P?void 0:P.isNDCHalfZRange,c=N?1:.5,h=N?0:.5;i.FromValuesToRef(b/2,0,0,0,0,-l/2,0,0,0,0,c,0,a+b/2,l/2+Z,h,1,f);const E=g.Matrix[0];return y.multiplyToRef(n,E),E.multiplyToRef(f,E),x.TransformCoordinatesToRef(v,E,J),J}static Reflect(v,y){return this.ReflectToRef(v,y,new x)}static ReflectToRef(v,y,n){const B=c.o[0];return B.p(y).scaleInPlace(2*x.Dot(v,y)),n.p(v).Ei(B)}static _UnprojectFromInvertedMatrixToRef(v,y,n){x.TransformCoordinatesToRef(v,y,n);const B=y.m,J=v._x*B[3]+v._y*B[7]+v._z*B[11]+B[15];return(0,l.v)(J,1)&&n.scaleInPlace(1/J),n}static UnprojectFromTransform(v,y,n,B,J){return this.Unproject(v,y,n,B,J,i.IdentityReadOnly)}static Unproject(v,y,n,B,J,P){const b=new x;return x.UnprojectToRef(v,y,n,B,J,P,b),b}static UnprojectToRef(v,y,n,B,J,P,b){return x.UnprojectFloatsToRef(v._x,v._y,v._z,y,n,B,J,P,b),b}static UnprojectFloatsToRef(v,y,n,B,J,P,b,l,a){var Z;const f=g.Matrix[0];P.multiplyToRef(b,f),f.multiplyToRef(l,f),f.invert();const N=g.o[0];return N.x=v/B*2-1,N.y=-(y/J*2-1),null!==(Z=Y.b.LastCreatedEngine)&&void 0!==Z&&Z.isNDCHalfZRange?N.z=n:N.z=2*n-1,x._UnprojectFromInvertedMatrixToRef(N,f,a),a}static Minimize(v,y){const n=new x;return n.p(v),n.minimizeInPlace(y),n}static Maximize(v,y){const n=new x;return n.p(v),n.maximizeInPlace(y),n}static Distance(v,y){return Math.sqrt(x.DistanceSquared(v,y))}static DistanceSquared(v,y){const n=v._x-y._x,B=v._y-y._y,J=v._z-y._z;return n*n+B*B+J*J}static ProjectOnTriangleToRef(v,y,n,J,P){const b=g.o[0],Y=g.o[1],a=g.o[2],Z=g.o[3],f=g.o[4];n.subtractToRef(y,b),J.subtractToRef(y,Y),J.subtractToRef(n,a);const N=b.length(),i=Y.length(),c=a.length();if(N<B.b||i<B.b||c<B.b)return P.p(y),x.Distance(v,y);v.subtractToRef(y,f),x.CrossToRef(b,Y,Z);const h=Z.length();if(h<B.b)return P.p(y),x.Distance(v,y);Z.normalizeFromLength(h);let E=f.length();if(E<B.b)return P.p(y),0;f.normalizeFromLength(E);const W=x.Dot(Z,f),s=g.o[5],C=g.o[6];s.p(Z).scaleInPlace(-E*W),C.p(v).addInPlace(s);const r=g.o[4],u=g.o[5],O=g.o[7],d=g.o[8];r.p(b).scaleInPlace(1/N),d.p(Y).scaleInPlace(1/i),r.addInPlace(d).scaleInPlace(-1),u.p(b).scaleInPlace(-1/N),d.p(a).scaleInPlace(1/c),u.addInPlace(d).scaleInPlace(-1),O.p(a).scaleInPlace(-1/c),d.p(Y).scaleInPlace(-1/i),O.addInPlace(d).scaleInPlace(-1);const q=g.o[9];let L;q.p(C).Ei(y),x.CrossToRef(r,q,d),L=x.Dot(d,Z);const t=L;q.p(C).Ei(n),x.CrossToRef(u,q,d),L=x.Dot(d,Z);const G=L;q.p(C).Ei(J),x.CrossToRef(O,q,d),L=x.Dot(d,Z);const R=L,F=g.o[10];let S,w;t>0&&G<0?(F.p(b),S=y,w=n):G>0&&R<0?(F.p(a),S=n,w=J):(F.p(Y).scaleInPlace(-1),S=J,w=y);const k=g.o[9],M=g.o[4];S.subtractToRef(C,d),w.subtractToRef(C,k),x.CrossToRef(d,k,M);if(!(x.Dot(M,Z)<0))return P.p(C),Math.abs(E*W);const I=g.o[5];x.CrossToRef(F,M,I),I.normalize();const j=g.o[9];j.p(S).Ei(C);const V=j.length();if(V<B.b)return P.p(S),x.Distance(v,S);j.normalizeFromLength(V);const p=x.Dot(I,j),H=g.o[7];H.p(C).addInPlace(I.scaleInPlace(V*p)),d.p(H).Ei(S),E=F.length(),F.normalizeFromLength(E);let A=x.Dot(d,F)/Math.max(E,B.b);return A=(0,l.c)(A,0,1),H.p(S).addInPlace(F.scaleInPlace(A*E)),P.p(H),x.Distance(v,H)}static Center(v,y){return x.CenterToRef(v,y,x.Zero())}static CenterToRef(v,y,n){return n.Ae((v._x+y._x)/2,(v._y+y._y)/2,(v._z+y._z)/2)}static RotationFromAxis(v,y,n){const B=new x;return x.RotationFromAxisToRef(v,y,n,B),B}static RotationFromAxisToRef(v,y,n,B){const J=g.Quaternion[0];return N.RotationQuaternionFromAxisToRef(v,y,n,J),J.toEulerAnglesToRef(B),B}}x._UpReadOnly=x.Up(),x._DownReadOnly=x.Down(),x._LeftHandedForwardReadOnly=x.Forward(!1),x._RightHandedForwardReadOnly=x.Forward(!0),x._LeftHandedBackwardReadOnly=x.Backward(!1),x._RightHandedBackwardReadOnly=x.Backward(!0),x._RightReadOnly=x.Right(),x._LeftReadOnly=x.Left(),x._ZeroReadOnly=x.Zero(),x._OneReadOnly=x.One(),Object.defineProperties(x.prototype,{dimension:{value:[3]},rank:{value:1}});class f{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=v,this.y=y,this.z=n,this.w=B}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let v=a(this.x);return v=397*v^a(this.y),v=397*v^a(this.z),v=397*v^a(this.w),v}wj(){return[this.x,this.y,this.z,this.w]}toArray(v,y){return void 0===y&&(y=0),v[y]=this.x,v[y+1]=this.y,v[y+2]=this.z,v[y+3]=this.w,this}qd(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return f.FromArrayToRef(v,y,this),this}addInPlace(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this}addInPlaceFromFloats(v,y,n,B){return this.x+=v,this.y+=y,this.z+=n,this.w+=B,this}add(v){return new f(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w)}addToRef(v,y){return y.x=this.x+v.x,y.y=this.y+v.y,y.z=this.z+v.z,y.w=this.w+v.w,y}Ei(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this.w-=v.w,this}od(v){return new f(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w)}subtractToRef(v,y){return y.x=this.x-v.x,y.y=this.y-v.y,y.z=this.z-v.z,y.w=this.w-v.w,y}subtractFromFloats(v,y,n,B){return new f(this.x-v,this.y-y,this.z-n,this.w-B)}subtractFromFloatsToRef(v,y,n,B,J){return J.x=this.x-v,J.y=this.y-y,J.z=this.z-n,J.w=this.w-B,J}negate(){return new f(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(v){return v.x=-this.x,v.y=-this.y,v.z=-this.z,v.w=-this.w,v}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}scale(v){return new f(this.x*v,this.y*v,this.z*v,this.w*v)}scaleToRef(v,y){return y.x=this.x*v,y.y=this.y*v,y.z=this.z*v,y.w=this.w*v,y}scaleAndAddToRef(v,y){return y.x+=this.x*v,y.y+=this.y*v,y.z+=this.z*v,y.w+=this.w*v,y}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z&&this.w===v.w}equalsWithEpsilon(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.b;return v&&(0,l.v)(this.x,v.x,y)&&(0,l.v)(this.y,v.y,y)&&(0,l.v)(this.z,v.z,y)&&(0,l.v)(this.w,v.w,y)}equalsToFloats(v,y,n,B){return this.x===v&&this.y===y&&this.z===n&&this.w===B}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this.w*=v.w,this}multiply(v){return new f(this.x*v.x,this.y*v.y,this.z*v.z,this.w*v.w)}multiplyToRef(v,y){return y.x=this.x*v.x,y.y=this.y*v.y,y.z=this.z*v.z,y.w=this.w*v.w,y}multiplyByFloats(v,y,n,B){return new f(this.x*v,this.y*y,this.z*n,this.w*B)}divide(v){return new f(this.x/v.x,this.y/v.y,this.z/v.z,this.w/v.w)}divideToRef(v,y){return y.x=this.x/v.x,y.y=this.y/v.y,y.z=this.z/v.z,y.w=this.w/v.w,y}divideInPlace(v){return this.divideToRef(v,this)}minimizeInPlace(v){return v.x<this.x&&(this.x=v.x),v.y<this.y&&(this.y=v.y),v.z<this.z&&(this.z=v.z),v.w<this.w&&(this.w=v.w),this}maximizeInPlace(v){return v.x>this.x&&(this.x=v.x),v.y>this.y&&(this.y=v.y),v.z>this.z&&(this.z=v.z),v.w>this.w&&(this.w=v.w),this}minimizeInPlaceFromFloats(v,y,n,B){return this.x=Math.min(v,this.x),this.y=Math.min(y,this.y),this.z=Math.min(n,this.z),this.w=Math.min(B,this.w),this}maximizeInPlaceFromFloats(v,y,n,B){return this.x=Math.max(v,this.x),this.y=Math.max(y,this.y),this.z=Math.max(n,this.z),this.w=Math.max(B,this.w),this}floorToRef(v){return v.x=Math.floor(this.x),v.y=Math.floor(this.y),v.z=Math.floor(this.z),v.w=Math.floor(this.w),v}floor(){return new f(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(v){return v.x=this.x-Math.floor(this.x),v.y=this.y-Math.floor(this.y),v.z=this.z-Math.floor(this.z),v.w=this.w-Math.floor(this.w),v}fract(){return new f(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(v){return 0===v||1===v?this:this.scaleInPlace(1/v)}normalizeToNew(){return this.normalizeToRef(new f)}normalizeToRef(v){const y=this.length();return 0===y||1===y?(v.x=this.x,v.y=this.y,v.z=this.z,v.w=this.w,v):this.scaleToRef(1/y,v)}toVector3(){return new x(this.x,this.y,this.z)}clone(){return new f(this.x,this.y,this.z,this.w)}p(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}Ae(v,y,n,B){return this.x=v,this.y=y,this.z=n,this.w=B,this}set(v,y,n,B){return this.Ae(v,y,n,B)}xe(v){return this.x=this.y=this.z=this.w=v,this}dot(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w}static qh(v,y){return y||(y=0),new f(v[y],v[y+1],v[y+2],v[y+3])}static FromArrayToRef(v,y,n){return n.x=v[y],n.y=v[y+1],n.z=v[y+2],n.w=v[y+3],n}static FromFloatArrayToRef(v,y,n){return f.FromArrayToRef(v,y,n),n}static FromFloatsToRef(v,y,n,B,J){return J.x=v,J.y=y,J.z=n,J.w=B,J}static Zero(){return new f(0,0,0,0)}static One(){return new f(1,1,1,1)}static Random(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new f((0,l.n)(v,y),(0,l.n)(v,y),(0,l.n)(v,y),(0,l.n)(v,y))}static RandomToRef(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;return n.x=(0,l.n)(v,y),n.y=(0,l.n)(v,y),n.z=(0,l.n)(v,y),n.w=(0,l.n)(v,y),n}static Clamp(v,y,n){return f.ClampToRef(v,y,n,new f)}static ClampToRef(v,y,n,B){return B.x=(0,l.c)(v.x,y.x,n.x),B.y=(0,l.c)(v.y,y.y,n.y),B.z=(0,l.c)(v.z,y.z,n.z),B.w=(0,l.c)(v.w,y.w,n.w),B}static CheckExtends(v,y,n){y.minimizeInPlace(v),n.maximizeInPlace(v)}static get ZeroReadOnly(){return f._ZeroReadOnly}static Normalize(v){return f.NormalizeToRef(v,new f)}static NormalizeToRef(v,y){return v.normalizeToRef(y),y}static Minimize(v,y){const n=new f;return n.p(v),n.minimizeInPlace(y),n}static Maximize(v,y){const n=new f;return n.p(v),n.maximizeInPlace(y),n}static Distance(v,y){return Math.sqrt(f.DistanceSquared(v,y))}static DistanceSquared(v,y){const n=v.x-y.x,B=v.y-y.y,J=v.z-y.z,P=v.w-y.w;return n*n+B*B+J*J+P*P}static Center(v,y){return f.CenterToRef(v,y,new f)}static CenterToRef(v,y,n){return n.x=(v.x+y.x)/2,n.y=(v.y+y.y)/2,n.z=(v.z+y.z)/2,n.w=(v.w+y.w)/2,n}static TransformCoordinates(v,y){return f.TransformCoordinatesToRef(v,y,new f)}static TransformCoordinatesToRef(v,y,n){return f.TransformCoordinatesFromFloatsToRef(v._x,v._y,v._z,y,n),n}static TransformCoordinatesFromFloatsToRef(v,y,n,B,J){const P=B.m,b=v*P[0]+y*P[4]+n*P[8]+P[12],Y=v*P[1]+y*P[5]+n*P[9]+P[13],l=v*P[2]+y*P[6]+n*P[10]+P[14],a=v*P[3]+y*P[7]+n*P[11]+P[15];return J.x=b,J.y=Y,J.z=l,J.w=a,J}static TransformNormal(v,y){return f.TransformNormalToRef(v,y,new f)}static TransformNormalToRef(v,y,n){const B=y.m,J=v.x*B[0]+v.y*B[4]+v.z*B[8],P=v.x*B[1]+v.y*B[5]+v.z*B[9],b=v.x*B[2]+v.y*B[6]+v.z*B[10];return n.x=J,n.y=P,n.z=b,n.w=v.w,n}static TransformNormalFromFloatsToRef(v,y,n,B,J,P){const b=J.m;return P.x=v*b[0]+y*b[4]+n*b[8],P.y=v*b[1]+y*b[5]+n*b[9],P.z=v*b[2]+y*b[6]+n*b[10],P.w=B,P}static FromVector3(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new f(v._x,v._y,v._z,y)}static Dot(v,y){return v.x*y.x+v.y*y.y+v.z*y.z+v.w*y.w}}f._ZeroReadOnly=f.Zero(),Object.defineProperties(f.prototype,{dimension:{value:[4]},rank:{value:1}});class N{get x(){return this._x}set x(v){this._x=v,this._isDirty=!0}get y(){return this._y}set y(v){this._y=v,this._isDirty=!0}get z(){return this._z}set z(v){this._z=v,this._isDirty=!0}get w(){return this._w}set w(v){this._w=v,this._isDirty=!0}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=v,this._y=y,this._z=n,this._w=B}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let v=a(this._x);return v=397*v^a(this._y),v=397*v^a(this._z),v=397*v^a(this._w),v}wj(){return[this._x,this._y,this._z,this._w]}toArray(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return v[y]=this._x,v[y+1]=this._y,v[y+2]=this._z,v[y+3]=this._w,this}qd(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return N.FromArrayToRef(v,y,this)}equals(v){return v&&this._x===v._x&&this._y===v._y&&this._z===v._z&&this._w===v._w}equalsWithEpsilon(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.b;return v&&(0,l.v)(this._x,v._x,y)&&(0,l.v)(this._y,v._y,y)&&(0,l.v)(this._z,v._z,y)&&(0,l.v)(this._w,v._w,y)}clone(){return new N(this._x,this._y,this._z,this._w)}p(v){return this._x=v._x,this._y=v._y,this._z=v._z,this._w=v._w,this._isDirty=!0,this}Ae(v,y,n,B){return this._x=v,this._y=y,this._z=n,this._w=B,this._isDirty=!0,this}set(v,y,n,B){return this.Ae(v,y,n,B)}xe(v){return this.Ae(v,v,v,v)}add(v){return new N(this._x+v._x,this._y+v._y,this._z+v._z,this._w+v._w)}addInPlace(v){return this._x+=v._x,this._y+=v._y,this._z+=v._z,this._w+=v._w,this._isDirty=!0,this}addToRef(v,y){return y._x=this._x+v._x,y._y=this._y+v._y,y._z=this._z+v._z,y._w=this._w+v._w,y._isDirty=!0,y}addInPlaceFromFloats(v,y,n,B){return this._x+=v,this._y+=y,this._z+=n,this._w+=B,this._isDirty=!0,this}subtractToRef(v,y){return y._x=this._x-v._x,y._y=this._y-v._y,y._z=this._z-v._z,y._w=this._w-v._w,y._isDirty=!0,y}subtractFromFloats(v,y,n,B){return this.subtractFromFloatsToRef(v,y,n,B,new N)}subtractFromFloatsToRef(v,y,n,B,J){return J._x=this._x-v,J._y=this._y-y,J._z=this._z-n,J._w=this._w-B,J._isDirty=!0,J}od(v){return new N(this._x-v._x,this._y-v._y,this._z-v._z,this._w-v._w)}Ei(v){return this._x-=v._x,this._y-=v._y,this._z-=v._z,this._w-=v._w,this._isDirty=!0,this}scale(v){return new N(this._x*v,this._y*v,this._z*v,this._w*v)}scaleToRef(v,y){return y._x=this._x*v,y._y=this._y*v,y._z=this._z*v,y._w=this._w*v,y._isDirty=!0,y}scaleInPlace(v){return this._x*=v,this._y*=v,this._z*=v,this._w*=v,this._isDirty=!0,this}scaleAndAddToRef(v,y){return y._x+=this._x*v,y._y+=this._y*v,y._z+=this._z*v,y._w+=this._w*v,y._isDirty=!0,y}multiply(v){const y=new N(0,0,0,1);return this.multiplyToRef(v,y),y}multiplyToRef(v,y){const n=this._x*v._w+this._y*v._z-this._z*v._y+this._w*v._x,B=-this._x*v._z+this._y*v._w+this._z*v._x+this._w*v._y,J=this._x*v._y-this._y*v._x+this._z*v._w+this._w*v._z,P=-this._x*v._x-this._y*v._y-this._z*v._z+this._w*v._w;return y.Ae(n,B,J,P),y}multiplyInPlace(v){return this.multiplyToRef(v,this)}multiplyByFloats(v,y,n,B){return this._x*=v,this._y*=y,this._z*=n,this._w*=B,this._isDirty=!0,this}divide(v){throw new ReferenceError("Can not divide a quaternion")}divideToRef(v,y){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(v){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new N)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(v){return v._x=-this._x,v._y=-this._y,v._z=-this._z,v._w=-this._w,v._isDirty=!0,v}equalsToFloats(v,y,n,B){return this._x===v&&this._y===y&&this._z===n&&this._w===B}floorToRef(v){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(v){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(v){return v.Ae(-this._x,-this._y,-this._z,this._w),v}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new N(-this._x,-this._y,-this._z,this._w)}invert(){const v=this.conjugate(),y=this.lengthSquared();return 0==y||1==y||v.scaleInPlace(1/y),v}invertInPlace(){this.conjugateInPlace();const v=this.lengthSquared();return 0==v||1==v||this.scaleInPlace(1/v),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(v){return 0===v||1===v?this:this.scaleInPlace(1/v)}normalizeToNew(){const v=new N(0,0,0,1);return this.normalizeToRef(v),v}normalizeToRef(v){const y=this.length();return 0===y||1===y?v.Ae(this._x,this._y,this._z,this._w):this.scaleToRef(1/y,v)}toEulerAngles(){const v=x.Zero();return this.toEulerAnglesToRef(v),v}toEulerAnglesToRef(v){const y=this._z,n=this._x,B=this._y,J=this._w,P=B*y-n*J,b=.4999999;if(P<-b)v._y=2*Math.atan2(B,J),v._x=Math.PI/2,v._z=0,v._isDirty=!0;else if(P>b)v._y=2*Math.atan2(B,J),v._x=-Math.PI/2,v._z=0,v._isDirty=!0;else{const b=J*J,Y=y*y,l=n*n,a=B*B;v._z=Math.atan2(2*(n*B+y*J),-Y-l+a+b),v._x=Math.asin(-2*P),v._y=Math.atan2(2*(y*n+B*J),Y-l-a+b),v._isDirty=!0}return v}toAlphaBetaGammaToRef(v){const y=this._z,n=this._x,B=this._y,J=this._w,P=Math.sqrt(n*n+B*B),b=Math.sqrt(y*y+J*J),Y=2*Math.atan2(P,b),l=2*Math.atan2(y,J),a=2*Math.atan2(B,n),Z=(l+a)/2,x=(l-a)/2;return v.set(x,Y,Z),v}toRotationMatrix(v){return i.FromQuaternionToRef(this,v),v}fromRotationMatrix(v){return N.FromRotationMatrixToRef(v,this),this}dot(v){return this._x*v._x+this._y*v._y+this._z*v._z+this._w*v._w}static FromRotationMatrix(v){const y=new N;return N.FromRotationMatrixToRef(v,y),y}static FromRotationMatrixToRef(v,y){const n=v.m,B=n[0],J=n[4],P=n[8],b=n[1],Y=n[5],l=n[9],a=n[2],Z=n[6],x=n[10],f=B+Y+x;let N;return f>0?(N=.5/Math.sqrt(f+1),y._w=.25/N,y._x=(Z-l)*N,y._y=(P-a)*N,y._z=(b-J)*N,y._isDirty=!0):B>Y&&B>x?(N=2*Math.sqrt(1+B-Y-x),y._w=(Z-l)/N,y._x=.25*N,y._y=(J+b)/N,y._z=(P+a)/N,y._isDirty=!0):Y>x?(N=2*Math.sqrt(1+Y-B-x),y._w=(P-a)/N,y._x=(J+b)/N,y._y=.25*N,y._z=(l+Z)/N,y._isDirty=!0):(N=2*Math.sqrt(1+x-B-Y),y._w=(b-J)/N,y._x=(P+a)/N,y._y=(l+Z)/N,y._z=.25*N,y._isDirty=!0),y}static Dot(v,y){return v._x*y._x+v._y*y._y+v._z*y._z+v._w*y._w}static AreClose(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const B=N.Dot(v,y);return 1-B*B<=n}static SmoothToRef(v,y,n,B,J){let P=0===B?1:n/B;return P=(0,l.c)(P,0,1),N.SlerpToRef(v,y,P,J),J}static Zero(){return new N(0,0,0,0)}static Inverse(v){return new N(-v._x,-v._y,-v._z,v._w)}static InverseToRef(v,y){return y.set(-v._x,-v._y,-v._z,v._w),y}static Identity(){return new N(0,0,0,1)}static IsIdentity(v){return v&&0===v._x&&0===v._y&&0===v._z&&1===v._w}static RotationAxis(v,y){return N.RotationAxisToRef(v,y,new N)}static RotationAxisToRef(v,y,n){n._w=Math.cos(y/2);const B=Math.sin(y/2)/v.length();return n._x=v._x*B,n._y=v._y*B,n._z=v._z*B,n._isDirty=!0,n}static qh(v,y){return y||(y=0),new N(v[y],v[y+1],v[y+2],v[y+3])}static FromArrayToRef(v,y,n){return n._x=v[y],n._y=v[y+1],n._z=v[y+2],n._w=v[y+3],n._isDirty=!0,n}static FromFloatsToRef(v,y,n,B,J){return J.Ae(v,y,n,B),J}static FromEulerAngles(v,y,n){const B=new N;return N.RotationYawPitchRollToRef(y,v,n,B),B}static FromEulerAnglesToRef(v,y,n,B){return N.RotationYawPitchRollToRef(y,v,n,B),B}static FromEulerVector(v){const y=new N;return N.RotationYawPitchRollToRef(v._y,v._x,v._z,y),y}static FromEulerVectorToRef(v,y){return N.RotationYawPitchRollToRef(v._y,v._x,v._z,y),y}static FromUnitVectorsToRef(v,y,n){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.b;const P=x.Dot(v,y)+1;return P<J?Math.abs(v.x)>Math.abs(v.z)?n.set(-v.y,v.x,0,0):n.set(0,-v.z,v.y,0):(x.CrossToRef(v,y,c.o[0]),n.set(c.o[0].x,c.o[0].y,c.o[0].z,P)),n.normalize()}static RotationYawPitchRoll(v,y,n){const B=new N;return N.RotationYawPitchRollToRef(v,y,n,B),B}static RotationYawPitchRollToRef(v,y,n,B){const J=.5*n,P=.5*y,b=.5*v,Y=Math.sin(J),l=Math.cos(J),a=Math.sin(P),Z=Math.cos(P),x=Math.sin(b),f=Math.cos(b);return B._x=f*a*l+x*Z*Y,B._y=x*Z*l-f*a*Y,B._z=f*Z*Y-x*a*l,B._w=f*Z*l+x*a*Y,B._isDirty=!0,B}static RotationAlphaBetaGamma(v,y,n){const B=new N;return N.RotationAlphaBetaGammaToRef(v,y,n,B),B}static RotationAlphaBetaGammaToRef(v,y,n,B){const J=.5*(n+v),P=.5*(n-v),b=.5*y;return B._x=Math.cos(P)*Math.sin(b),B._y=Math.sin(P)*Math.sin(b),B._z=Math.sin(J)*Math.cos(b),B._w=Math.cos(J)*Math.cos(b),B._isDirty=!0,B}static RotationQuaternionFromAxis(v,y,n){const B=new N(0,0,0,0);return N.RotationQuaternionFromAxisToRef(v,y,n,B),B}static RotationQuaternionFromAxisToRef(v,y,n,B){const J=g.Matrix[0];return v=v.normalizeToRef(g.o[0]),y=y.normalizeToRef(g.o[1]),n=n.normalizeToRef(g.o[2]),i.FromXYZAxesToRef(v,y,n,J),N.FromRotationMatrixToRef(J,B),B}static FromLookDirectionLH(v,y){const n=new N;return N.FromLookDirectionLHToRef(v,y,n),n}static FromLookDirectionLHToRef(v,y,n){const B=g.Matrix[0];return i.LookDirectionLHToRef(v,y,B),N.FromRotationMatrixToRef(B,n),n}static FromLookDirectionRH(v,y){const n=new N;return N.FromLookDirectionRHToRef(v,y,n),n}static FromLookDirectionRHToRef(v,y,n){const B=g.Matrix[0];return i.LookDirectionRHToRef(v,y,B),N.FromRotationMatrixToRef(B,n)}static Slerp(v,y,n){const B=N.Identity();return N.SlerpToRef(v,y,n,B),B}static SlerpToRef(v,y,n,B){let J,P,b=v._x*y._x+v._y*y._y+v._z*y._z+v._w*y._w,Y=!1;if(b<0&&(Y=!0,b=-b),b>.999999)P=1-n,J=Y?-n:n;else{const v=Math.acos(b),y=1/Math.sin(v);P=Math.sin((1-n)*v)*y,J=Y?-Math.sin(n*v)*y:Math.sin(n*v)*y}return B._x=P*v._x+J*y._x,B._y=P*v._y+J*y._y,B._z=P*v._z+J*y._z,B._w=P*v._w+J*y._w,B._isDirty=!0,B}static Hermite(v,y,n,B,J){const P=J*J,b=J*P,Y=2*b-3*P+1,l=-2*b+3*P,a=b-2*P+J,Z=b-P,x=v._x*Y+n._x*l+y._x*a+B._x*Z,f=v._y*Y+n._y*l+y._y*a+B._y*Z,i=v._z*Y+n._z*l+y._z*a+B._z*Z,g=v._w*Y+n._w*l+y._w*a+B._w*Z;return new N(x,f,i,g)}static Hermite1stDerivative(v,y,n,B,J){const P=new N;return this.Hermite1stDerivativeToRef(v,y,n,B,J,P),P}static Hermite1stDerivativeToRef(v,y,n,B,J,P){const b=J*J;return P._x=6*(b-J)*v._x+(3*b-4*J+1)*y._x+6*(-b+J)*n._x+(3*b-2*J)*B._x,P._y=6*(b-J)*v._y+(3*b-4*J+1)*y._y+6*(-b+J)*n._y+(3*b-2*J)*B._y,P._z=6*(b-J)*v._z+(3*b-4*J+1)*y._z+6*(-b+J)*n._z+(3*b-2*J)*B._z,P._w=6*(b-J)*v._w+(3*b-4*J+1)*y._w+6*(-b+J)*n._w+(3*b-2*J)*B._w,P._isDirty=!0,P}static Normalize(v){const y=N.Zero();return N.NormalizeToRef(v,y),y}static NormalizeToRef(v,y){return v.normalizeToRef(y),y}static Clamp(v,y,n){const B=new N;return N.ClampToRef(v,y,n,B),B}static ClampToRef(v,y,n,B){return B.Ae((0,l.c)(v.x,y.x,n.x),(0,l.c)(v.y,y.y,n.y),(0,l.c)(v.z,y.z,n.z),(0,l.c)(v.w,y.w,n.w))}static Random(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new N((0,l.n)(v,y),(0,l.n)(v,y),(0,l.n)(v,y),(0,l.n)(v,y))}static RandomToRef(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Ae((0,l.n)(v,y),(0,l.n)(v,y),(0,l.n)(v,y),(0,l.n)(v,y))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(v,y){return Math.sqrt(N.DistanceSquared(v,y))}static DistanceSquared(v,y){const n=v.x-y.x,B=v.y-y.y,J=v.z-y.z,P=v.w-y.w;return n*n+B*B+J*J+P*P}static Center(v,y){return N.CenterToRef(v,y,N.Zero())}static CenterToRef(v,y,n){return n.Ae((v.x+y.x)/2,(v.y+y.y)/2,(v.z+y.z)/2,(v.w+y.w)/2)}}Object.defineProperties(N.prototype,{dimension:{value:[4]},rank:{value:1}});class i{static get Use64Bits(){return b.d.MatrixUse64Bits}get m(){return this.bk}markAsUpdated(){this.updateFlag=i._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=v,this._isIdentity3x2=v||n,this._isIdentityDirty=!this._isIdentity&&y,this._isIdentity3x2Dirty=!this._isIdentity3x2&&B}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,b.d.MatrixTrackPrecisionChange&&b.d.MatrixTrackedMatrices.push(this),this.bk=new b.d.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const v=this.bk;this._isIdentity=1===v[0]&&0===v[1]&&0===v[2]&&0===v[3]&&0===v[4]&&1===v[5]&&0===v[6]&&0===v[7]&&0===v[8]&&0===v[9]&&1===v[10]&&0===v[11]&&0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.bk[0]||1!==this.bk[5]||1!==this.bk[15]||0!==this.bk[1]||0!==this.bk[2]||0!==this.bk[3]||0!==this.bk[4]||0!==this.bk[6]||0!==this.bk[7]||0!==this.bk[8]||0!==this.bk[9]||0!==this.bk[10]||0!==this.bk[11]||0!==this.bk[12]||0!==this.bk[13]||0!==this.bk[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const v=this.bk,y=v[0],n=v[1],B=v[2],J=v[3],P=v[4],b=v[5],Y=v[6],l=v[7],a=v[8],Z=v[9],x=v[10],f=v[11],N=v[12],i=v[13],g=v[14],c=v[15],h=x*c-g*f,E=Z*c-i*f,W=Z*g-i*x,s=a*c-N*f,C=a*g-x*N,r=a*i-N*Z;return y*+(b*h-Y*E+l*W)+n*-(P*h-Y*s+l*C)+B*+(P*E-b*s+l*r)+J*-(P*W-b*C+Y*r)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!v)return this.bk;const n=this.bk;for(let B=0;B<16;B++)v[y+B]=n[B];return this}wj(){return this.bk}qd(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i.FromArrayToRef(v,y,this)}Ae(){for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];return i.FromArrayToRef(y,0,this)}set(){const v=this.bk;for(let y=0;y<16;y++)v[y]=y<0||arguments.length<=y?void 0:arguments[y];return this.markAsUpdated(),this}xe(v){const y=this.bk;for(let n=0;n<16;n++)y[n]=v;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return i.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(v){const y=new i;return this.addToRef(v,y),y}addToRef(v,y){const n=this.bk,B=y.bk,J=v.m;for(let P=0;P<16;P++)B[P]=n[P]+J[P];return y.markAsUpdated(),y}addToSelf(v){const y=this.bk,n=v.m;return y[0]+=n[0],y[1]+=n[1],y[2]+=n[2],y[3]+=n[3],y[4]+=n[4],y[5]+=n[5],y[6]+=n[6],y[7]+=n[7],y[8]+=n[8],y[9]+=n[9],y[10]+=n[10],y[11]+=n[11],y[12]+=n[12],y[13]+=n[13],y[14]+=n[14],y[15]+=n[15],this.markAsUpdated(),this}addInPlace(v){const y=this.bk,n=v.m;for(let B=0;B<16;B++)y[B]+=n[B];return this.markAsUpdated(),this}addInPlaceFromFloats(){const v=this.bk;for(let y=0;y<16;y++)v[y]+=y<0||arguments.length<=y?void 0:arguments[y];return this.markAsUpdated(),this}od(v){const y=this.bk,n=v.m;for(let B=0;B<16;B++)y[B]-=n[B];return this.markAsUpdated(),this}subtractToRef(v,y){const n=this.bk,B=v.m,J=y.bk;for(let P=0;P<16;P++)J[P]=n[P]-B[P];return y.markAsUpdated(),y}Ei(v){const y=this.bk,n=v.m;for(let B=0;B<16;B++)y[B]-=n[B];return this.markAsUpdated(),this}subtractFromFloats(){for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];return this.subtractFromFloatsToRef(...y,new i)}subtractFromFloatsToRef(){for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];const B=y.pop(),J=this.bk,P=B.bk,b=y;for(let Y=0;Y<16;Y++)P[Y]=J[Y]-b[Y];return B.markAsUpdated(),B}invertToRef(v){if(!0===this._isIdentity)return i.IdentityToRef(v),v;const y=this.bk,n=y[0],B=y[1],J=y[2],P=y[3],b=y[4],Y=y[5],l=y[6],a=y[7],Z=y[8],x=y[9],f=y[10],N=y[11],g=y[12],c=y[13],h=y[14],E=y[15],W=f*E-h*N,s=x*E-c*N,C=x*h-c*f,r=Z*E-g*N,u=Z*h-f*g,O=Z*c-g*x,d=+(Y*W-l*s+a*C),q=-(b*W-l*r+a*u),L=+(b*s-Y*r+a*O),t=-(b*C-Y*u+l*O),G=n*d+B*q+J*L+P*t;if(0===G)return v.p(this),v;const R=1/G,F=l*E-h*a,S=Y*E-c*a,w=Y*h-c*l,k=b*E-g*a,M=b*h-g*l,I=b*c-g*Y,j=l*N-f*a,V=Y*N-x*a,p=Y*f-x*l,H=b*N-Z*a,A=b*f-Z*l,X=b*x-Z*Y,U=-(B*W-J*s+P*C),z=+(n*W-J*r+P*u),e=-(n*s-B*r+P*O),K=+(n*C-B*u+J*O),D=+(B*F-J*S+P*w),Q=-(n*F-J*k+P*M),o=+(n*S-B*k+P*I),T=-(n*w-B*M+J*I),m=-(B*j-J*V+P*p),vv=+(n*j-J*H+P*A),yv=-(n*V-B*H+P*X),nv=+(n*p-B*A+J*X);return i.FromValuesToRef(d*R,U*R,D*R,m*R,q*R,z*R,Q*R,vv*R,L*R,e*R,o*R,yv*R,t*R,K*R,T*R,nv*R,v),v}addAtIndex(v,y){return this.bk[v]+=y,this.markAsUpdated(),this}multiplyAtIndex(v,y){return this.bk[v]*=y,this.markAsUpdated(),this}setTranslationFromFloats(v,y,n){return this.bk[12]=v,this.bk[13]=y,this.bk[14]=n,this.markAsUpdated(),this}addTranslationFromFloats(v,y,n){return this.bk[12]+=v,this.bk[13]+=y,this.bk[14]+=n,this.markAsUpdated(),this}setTranslation(v){return this.setTranslationFromFloats(v._x,v._y,v._z)}getTranslation(){return new x(this.bk[12],this.bk[13],this.bk[14])}getTranslationToRef(v){return v.x=this.bk[12],v.y=this.bk[13],v.z=this.bk[14],v}removeRotationAndScaling(){const v=this.m;return i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v[12],v[13],v[14],v[15],this),this._updateIdentityStatus(0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]),this}p(v){v.copyToArray(this.bk);const y=v;return this.updateFlag=y.updateFlag,this._updateIdentityStatus(y._isIdentity,y._isIdentityDirty,y._isIdentity3x2,y._isIdentity3x2Dirty),this}copyToArray(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.bk;return v[y]=n[0],v[y+1]=n[1],v[y+2]=n[2],v[y+3]=n[3],v[y+4]=n[4],v[y+5]=n[5],v[y+6]=n[6],v[y+7]=n[7],v[y+8]=n[8],v[y+9]=n[9],v[y+10]=n[10],v[y+11]=n[11],v[y+12]=n[12],v[y+13]=n[13],v[y+14]=n[14],v[y+15]=n[15],this}multiply(v){const y=new i;return this.multiplyToRef(v,y),y}multiplyInPlace(v){const y=this.bk,n=v.m;for(let B=0;B<16;B++)y[B]*=n[B];return this.markAsUpdated(),this}multiplyByFloats(){const v=this.bk;for(let y=0;y<16;y++)v[y]*=y<0||arguments.length<=y?void 0:arguments[y];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];const B=y.pop(),J=this.bk,P=B.bk,b=y;for(let Y=0;Y<16;Y++)P[Y]=J[Y]*b[Y];return B.markAsUpdated(),B}multiplyToRef(v,y){return this._isIdentity?(y.p(v),y):v._isIdentity?(y.p(this),y):(this.multiplyToArray(v,y.bk,0),y.markAsUpdated(),y)}multiplyToArray(v,y,n){const B=this.bk,J=v.m,P=B[0],b=B[1],Y=B[2],l=B[3],a=B[4],Z=B[5],x=B[6],f=B[7],N=B[8],i=B[9],g=B[10],c=B[11],h=B[12],E=B[13],W=B[14],s=B[15],C=J[0],r=J[1],u=J[2],O=J[3],d=J[4],q=J[5],L=J[6],t=J[7],G=J[8],R=J[9],F=J[10],S=J[11],w=J[12],k=J[13],M=J[14],I=J[15];return y[n]=P*C+b*d+Y*G+l*w,y[n+1]=P*r+b*q+Y*R+l*k,y[n+2]=P*u+b*L+Y*F+l*M,y[n+3]=P*O+b*t+Y*S+l*I,y[n+4]=a*C+Z*d+x*G+f*w,y[n+5]=a*r+Z*q+x*R+f*k,y[n+6]=a*u+Z*L+x*F+f*M,y[n+7]=a*O+Z*t+x*S+f*I,y[n+8]=N*C+i*d+g*G+c*w,y[n+9]=N*r+i*q+g*R+c*k,y[n+10]=N*u+i*L+g*F+c*M,y[n+11]=N*O+i*t+g*S+c*I,y[n+12]=h*C+E*d+W*G+s*w,y[n+13]=h*r+E*q+W*R+s*k,y[n+14]=h*u+E*L+W*F+s*M,y[n+15]=h*O+E*t+W*S+s*I,this}divide(v){return this.divideToRef(v,new i)}divideToRef(v,y){const n=this.bk,B=v.m,J=y.bk;for(let P=0;P<16;P++)J[P]=n[P]/B[P];return y.markAsUpdated(),y}divideInPlace(v){const y=this.bk,n=v.m;for(let B=0;B<16;B++)y[B]/=n[B];return this.markAsUpdated(),this}minimizeInPlace(v){const y=this.bk,n=v.m;for(let B=0;B<16;B++)y[B]=Math.min(y[B],n[B]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const v=this.bk;for(let y=0;y<16;y++)v[y]=Math.min(v[y],y<0||arguments.length<=y?void 0:arguments[y]);return this.markAsUpdated(),this}maximizeInPlace(v){const y=this.bk,n=v.m;for(let B=0;B<16;B++)y[B]=Math.min(y[B],n[B]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const v=this.bk;for(let y=0;y<16;y++)v[y]=Math.min(v[y],y<0||arguments.length<=y?void 0:arguments[y]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new i)}negateInPlace(){const v=this.bk;for(let y=0;y<16;y++)v[y]=-v[y];return this.markAsUpdated(),this}negateToRef(v){const y=this.bk,n=v.bk;for(let B=0;B<16;B++)n[B]=-y[B];return v.markAsUpdated(),v}equals(v){const y=v;if(!y)return!1;if((this._isIdentity||y._isIdentity)&&!this._isIdentityDirty&&!y._isIdentityDirty)return this._isIdentity&&y._isIdentity;const n=this.m,B=y.m;return n[0]===B[0]&&n[1]===B[1]&&n[2]===B[2]&&n[3]===B[3]&&n[4]===B[4]&&n[5]===B[5]&&n[6]===B[6]&&n[7]===B[7]&&n[8]===B[8]&&n[9]===B[9]&&n[10]===B[10]&&n[11]===B[11]&&n[12]===B[12]&&n[13]===B[13]&&n[14]===B[14]&&n[15]===B[15]}equalsWithEpsilon(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.bk,B=v.m;for(let J=0;J<16;J++)if(!(0,l.v)(n[J],B[J],y))return!1;return!0}equalsToFloats(){const v=this.bk;for(let y=0;y<16;y++)if(v[y]!=(y<0||arguments.length<=y?void 0:arguments[y]))return!1;return!0}floor(){return this.floorToRef(new i)}floorToRef(v){const y=this.bk,n=v.bk;for(let B=0;B<16;B++)n[B]=Math.floor(y[B]);return v.markAsUpdated(),v}fract(){return this.fractToRef(new i)}fractToRef(v){const y=this.bk,n=v.bk;for(let B=0;B<16;B++)n[B]=y[B]-Math.floor(y[B]);return v.markAsUpdated(),v}clone(){const v=new i;return v.p(this),v}getClassName(){return"Matrix"}getHashCode(){let v=a(this.bk[0]);for(let y=1;y<16;y++)v=397*v^a(this.bk[y]);return v}decomposeToTransformNode(v){return v.rotationQuaternion=v.rotationQuaternion||new N,this.decompose(v.Be,v.rotationQuaternion,v.position)}decompose(v,y,n,B){let J=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return n&&n.xe(0),v&&v.xe(1),y&&y.Ae(0,0,0,1),!0;const P=this.bk;if(n&&n.Ae(P[12],P[13],P[14]),(v=v||g.o[0]).x=Math.sqrt(P[0]*P[0]+P[1]*P[1]+P[2]*P[2]),v.y=Math.sqrt(P[4]*P[4]+P[5]*P[5]+P[6]*P[6]),v.z=Math.sqrt(P[8]*P[8]+P[9]*P[9]+P[10]*P[10]),B){const y=(J?B.absoluteScaling.x:B.Be.x)<0?-1:1,n=(J?B.absoluteScaling.y:B.Be.y)<0?-1:1,P=(J?B.absoluteScaling.z:B.Be.z)<0?-1:1;v.x*=y,v.y*=n,v.z*=P}else this.determinant()<=0&&(v.y*=-1);if(0===v._x||0===v._y||0===v._z)return y&&y.Ae(0,0,0,1),!1;if(y){const n=1/v._x,B=1/v._y,J=1/v._z;i.FromValuesToRef(P[0]*n,P[1]*n,P[2]*n,0,P[4]*B,P[5]*B,P[6]*B,0,P[8]*J,P[9]*J,P[10]*J,0,0,0,0,1,g.Matrix[0]),N.FromRotationMatrixToRef(g.Matrix[0],y)}return!0}getRow(v){if(v<0||v>3)return null;const y=4*v;return new f(this.bk[y+0],this.bk[y+1],this.bk[y+2],this.bk[y+3])}getRowToRef(v,y){if(v>=0&&v<=3){const n=4*v;y.x=this.bk[n+0],y.y=this.bk[n+1],y.z=this.bk[n+2],y.w=this.bk[n+3]}return y}setRow(v,y){return this.setRowFromFloats(v,y.x,y.y,y.z,y.w)}transpose(){const v=new i;return i.TransposeToRef(this,v),v}transposeToRef(v){return i.TransposeToRef(this,v),v}setRowFromFloats(v,y,n,B,J){if(v<0||v>3)return this;const P=4*v;return this.bk[P+0]=y,this.bk[P+1]=n,this.bk[P+2]=B,this.bk[P+3]=J,this.markAsUpdated(),this}scale(v){const y=new i;return this.scaleToRef(v,y),y}scaleToRef(v,y){for(let n=0;n<16;n++)y.bk[n]=this.bk[n]*v;return y.markAsUpdated(),y}scaleAndAddToRef(v,y){for(let n=0;n<16;n++)y.bk[n]+=this.bk[n]*v;return y.markAsUpdated(),y}scaleInPlace(v){const y=this.bk;for(let n=0;n<16;n++)y[n]*=v;return this.markAsUpdated(),this}toNormalMatrix(v){const y=g.Matrix[0];this.invertToRef(y),y.transposeToRef(v);const n=v.bk;return i.FromValuesToRef(n[0],n[1],n[2],0,n[4],n[5],n[6],0,n[8],n[9],n[10],0,0,0,0,1,v),v}getRotationMatrix(){const v=new i;return this.getRotationMatrixToRef(v),v}getRotationMatrixToRef(v){const y=g.o[0];if(!this.decompose(y))return i.IdentityToRef(v),v;const n=this.bk,B=1/y._x,J=1/y._y,P=1/y._z;return i.FromValuesToRef(n[0]*B,n[1]*B,n[2]*B,0,n[4]*J,n[5]*J,n[6]*J,0,n[8]*P,n[9]*P,n[10]*P,0,0,0,0,1,v),v}toggleModelMatrixHandInPlace(){const v=this.bk;return v[2]*=-1,v[6]*=-1,v[8]*=-1,v[9]*=-1,v[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const v=this.bk;return v[8]*=-1,v[9]*=-1,v[10]*=-1,v[11]*=-1,this.markAsUpdated(),this}static qh(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=new i;return i.FromArrayToRef(v,y,n),n}static FromArrayToRef(v,y,n){for(let B=0;B<16;B++)n.bk[B]=v[B+y];return n.markAsUpdated(),n}static FromFloat32ArrayToRefScaled(v,y,n,B){return B.bk[0]=v[0+y]*n,B.bk[1]=v[1+y]*n,B.bk[2]=v[2+y]*n,B.bk[3]=v[3+y]*n,B.bk[4]=v[4+y]*n,B.bk[5]=v[5+y]*n,B.bk[6]=v[6+y]*n,B.bk[7]=v[7+y]*n,B.bk[8]=v[8+y]*n,B.bk[9]=v[9+y]*n,B.bk[10]=v[10+y]*n,B.bk[11]=v[11+y]*n,B.bk[12]=v[12+y]*n,B.bk[13]=v[13+y]*n,B.bk[14]=v[14+y]*n,B.bk[15]=v[15+y]*n,B.markAsUpdated(),B}static get IdentityReadOnly(){return i._IdentityReadOnly}static FromValuesToRef(v,y,n,B,J,P,b,Y,l,a,Z,x,f,N,i,g,c){const h=c.bk;h[0]=v,h[1]=y,h[2]=n,h[3]=B,h[4]=J,h[5]=P,h[6]=b,h[7]=Y,h[8]=l,h[9]=a,h[10]=Z,h[11]=x,h[12]=f,h[13]=N,h[14]=i,h[15]=g,c.markAsUpdated()}static FromValues(v,y,n,B,J,P,b,Y,l,a,Z,x,f,N,g,c){const h=new i,E=h.bk;return E[0]=v,E[1]=y,E[2]=n,E[3]=B,E[4]=J,E[5]=P,E[6]=b,E[7]=Y,E[8]=l,E[9]=a,E[10]=Z,E[11]=x,E[12]=f,E[13]=N,E[14]=g,E[15]=c,h.markAsUpdated(),h}static Compose(v,y,n){const B=new i;return i.ComposeToRef(v,y,n,B),B}static ComposeToRef(v,y,n,B){const J=B.bk,P=y._x,b=y._y,Y=y._z,l=y._w,a=P+P,Z=b+b,x=Y+Y,f=P*a,N=P*Z,i=P*x,g=b*Z,c=b*x,h=Y*x,E=l*a,W=l*Z,s=l*x,C=v._x,r=v._y,u=v._z;return J[0]=(1-(g+h))*C,J[1]=(N+s)*C,J[2]=(i-W)*C,J[3]=0,J[4]=(N-s)*r,J[5]=(1-(f+h))*r,J[6]=(c+E)*r,J[7]=0,J[8]=(i+W)*u,J[9]=(c-E)*u,J[10]=(1-(f+g))*u,J[11]=0,J[12]=n._x,J[13]=n._y,J[14]=n._z,J[15]=1,B.markAsUpdated(),B}static Identity(){const v=i.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return v._updateIdentityStatus(!0),v}static IdentityToRef(v){return i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,v),v._updateIdentityStatus(!0),v}static Zero(){const v=i.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return v._updateIdentityStatus(!1),v}static RotationX(v){const y=new i;return i.RotationXToRef(v,y),y}static Invert(v){const y=new i;return v.invertToRef(y),y}static RotationXToRef(v,y){const n=Math.sin(v),B=Math.cos(v);return i.FromValuesToRef(1,0,0,0,0,B,n,0,0,-n,B,0,0,0,0,1,y),y._updateIdentityStatus(1===B&&0===n),y}static RotationY(v){const y=new i;return i.RotationYToRef(v,y),y}static RotationYToRef(v,y){const n=Math.sin(v),B=Math.cos(v);return i.FromValuesToRef(B,0,-n,0,0,1,0,0,n,0,B,0,0,0,0,1,y),y._updateIdentityStatus(1===B&&0===n),y}static RotationZ(v){const y=new i;return i.RotationZToRef(v,y),y}static RotationZToRef(v,y){const n=Math.sin(v),B=Math.cos(v);return i.FromValuesToRef(B,n,0,0,-n,B,0,0,0,0,1,0,0,0,0,1,y),y._updateIdentityStatus(1===B&&0===n),y}static RotationAxis(v,y){const n=new i;return i.RotationAxisToRef(v,y,n),n}static RotationAxisToRef(v,y,n){const B=Math.sin(-y),J=Math.cos(-y),P=1-J;v=v.normalizeToRef(g.o[0]);const b=n.bk;return b[0]=v._x*v._x*P+J,b[1]=v._x*v._y*P-v._z*B,b[2]=v._x*v._z*P+v._y*B,b[3]=0,b[4]=v._y*v._x*P+v._z*B,b[5]=v._y*v._y*P+J,b[6]=v._y*v._z*P-v._x*B,b[7]=0,b[8]=v._z*v._x*P-v._y*B,b[9]=v._z*v._y*P+v._x*B,b[10]=v._z*v._z*P+J,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,n.markAsUpdated(),n}static RotationAlignToRef(v,y,n){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const P=x.Dot(y,v),b=n.bk;if(P<-1+B.b)b[0]=-1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=J?1:-1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=J?-1:1,b[11]=0;else{const n=x.Cross(y,v),B=1/(1+P);b[0]=n._x*n._x*B+P,b[1]=n._y*n._x*B-n._z,b[2]=n._z*n._x*B+n._y,b[3]=0,b[4]=n._x*n._y*B+n._z,b[5]=n._y*n._y*B+P,b[6]=n._z*n._y*B-n._x,b[7]=0,b[8]=n._x*n._z*B-n._y,b[9]=n._y*n._z*B+n._x,b[10]=n._z*n._z*B+P,b[11]=0}return b[12]=0,b[13]=0,b[14]=0,b[15]=1,n.markAsUpdated(),n}static RotationYawPitchRoll(v,y,n){const B=new i;return i.RotationYawPitchRollToRef(v,y,n,B),B}static RotationYawPitchRollToRef(v,y,n,B){return N.RotationYawPitchRollToRef(v,y,n,g.Quaternion[0]),g.Quaternion[0].toRotationMatrix(B),B}static Scaling(v,y,n){const B=new i;return i.ScalingToRef(v,y,n,B),B}static ScalingToRef(v,y,n,B){return i.FromValuesToRef(v,0,0,0,0,y,0,0,0,0,n,0,0,0,0,1,B),B._updateIdentityStatus(1===v&&1===y&&1===n),B}static Translation(v,y,n){const B=new i;return i.TranslationToRef(v,y,n,B),B}static TranslationToRef(v,y,n,B){return i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v,y,n,1,B),B._updateIdentityStatus(0===v&&0===y&&0===n),B}static Lerp(v,y,n){const B=new i;return i.LerpToRef(v,y,n,B),B}static LerpToRef(v,y,n,B){const J=B.bk,P=v.m,b=y.m;for(let Y=0;Y<16;Y++)J[Y]=P[Y]*(1-n)+b[Y]*n;return B.markAsUpdated(),B}static DecomposeLerp(v,y,n){const B=new i;return i.DecomposeLerpToRef(v,y,n,B),B}static DecomposeLerpToRef(v,y,n,B){const J=g.o[0],P=g.Quaternion[0],b=g.o[1];v.decompose(J,P,b);const Y=g.o[2],l=g.Quaternion[1],a=g.o[3];y.decompose(Y,l,a);const Z=g.o[4];x.LerpToRef(J,Y,n,Z);const f=g.Quaternion[2];N.SlerpToRef(P,l,n,f);const c=g.o[5];return x.LerpToRef(b,a,n,c),i.ComposeToRef(Z,f,c,B),B}static LookAtLH(v,y,n){const B=new i;return i.LookAtLHToRef(v,y,n,B),B}static LookAtLHToRef(v,y,n,B){const J=g.o[0],P=g.o[1],b=g.o[2];y.subtractToRef(v,b),b.normalize(),x.CrossToRef(n,b,J);const Y=J.lengthSquared();0===Y?J.x=1:J.normalizeFromLength(Math.sqrt(Y)),x.CrossToRef(b,J,P),P.normalize();const l=-x.Dot(J,v),a=-x.Dot(P,v),Z=-x.Dot(b,v);return i.FromValuesToRef(J._x,P._x,b._x,0,J._y,P._y,b._y,0,J._z,P._z,b._z,0,l,a,Z,1,B),B}static LookAtRH(v,y,n){const B=new i;return i.LookAtRHToRef(v,y,n,B),B}static LookAtRHToRef(v,y,n,B){const J=g.o[0],P=g.o[1],b=g.o[2];v.subtractToRef(y,b),b.normalize(),x.CrossToRef(n,b,J);const Y=J.lengthSquared();0===Y?J.x=1:J.normalizeFromLength(Math.sqrt(Y)),x.CrossToRef(b,J,P),P.normalize();const l=-x.Dot(J,v),a=-x.Dot(P,v),Z=-x.Dot(b,v);return i.FromValuesToRef(J._x,P._x,b._x,0,J._y,P._y,b._y,0,J._z,P._z,b._z,0,l,a,Z,1,B),B}static LookDirectionLH(v,y){const n=new i;return i.LookDirectionLHToRef(v,y,n),n}static LookDirectionLHToRef(v,y,n){const B=g.o[0];B.p(v),B.scaleInPlace(-1);const J=g.o[1];return x.CrossToRef(y,B,J),i.FromValuesToRef(J._x,J._y,J._z,0,y._x,y._y,y._z,0,B._x,B._y,B._z,0,0,0,0,1,n),n}static LookDirectionRH(v,y){const n=new i;return i.LookDirectionRHToRef(v,y,n),n}static LookDirectionRHToRef(v,y,n){const B=g.o[2];return x.CrossToRef(y,v,B),i.FromValuesToRef(B._x,B._y,B._z,0,y._x,y._y,y._z,0,v._x,v._y,v._z,0,0,0,0,1,n),n}static OrthoLH(v,y,n,B,J){const P=new i;return i.OrthoLHToRef(v,y,n,B,P,J),P}static OrthoLHToRef(v,y,n,B,J,P){const b=2/v,Y=2/y,l=2/(B-n),a=-(B+n)/(B-n);return i.FromValuesToRef(b,0,0,0,0,Y,0,0,0,0,l,0,0,0,a,1,J),P&&J.multiplyToRef(h,J),J._updateIdentityStatus(1===b&&1===Y&&1===l&&0===a),J}static OrthoOffCenterLH(v,y,n,B,J,P,b){const Y=new i;return i.OrthoOffCenterLHToRef(v,y,n,B,J,P,Y,b),Y}static OrthoOffCenterLHToRef(v,y,n,B,J,P,b,Y){const l=2/(y-v),a=2/(B-n),Z=2/(P-J),x=-(P+J)/(P-J),f=(v+y)/(v-y),N=(B+n)/(n-B);return i.FromValuesToRef(l,0,0,0,0,a,0,0,0,0,Z,0,f,N,x,1,b),Y&&b.multiplyToRef(h,b),b.markAsUpdated(),b}static ObliqueOffCenterLHToRef(v,y,n,B,J,P,b,Y,l,a,Z){const x=-b*Math.cos(Y),f=-b*Math.sin(Y);return i.TranslationToRef(0,0,-l,g.Matrix[1]),i.FromValuesToRef(1,0,0,0,0,1,0,0,x,f,1,0,0,0,0,1,g.Matrix[0]),g.Matrix[1].multiplyToRef(g.Matrix[0],g.Matrix[0]),i.TranslationToRef(0,0,l,g.Matrix[1]),g.Matrix[0].multiplyToRef(g.Matrix[1],g.Matrix[0]),i.OrthoOffCenterLHToRef(v,y,n,B,J,P,a,Z),g.Matrix[0].multiplyToRef(a,a),a}static OrthoOffCenterRH(v,y,n,B,J,P,b){const Y=new i;return i.OrthoOffCenterRHToRef(v,y,n,B,J,P,Y,b),Y}static OrthoOffCenterRHToRef(v,y,n,B,J,P,b,Y){return i.OrthoOffCenterLHToRef(v,y,n,B,J,P,b,Y),b.bk[10]*=-1,b}static ObliqueOffCenterRHToRef(v,y,n,B,J,P,b,Y,l,a,Z){const x=b*Math.cos(Y),f=b*Math.sin(Y);return i.TranslationToRef(0,0,l,g.Matrix[1]),i.FromValuesToRef(1,0,0,0,0,1,0,0,x,f,1,0,0,0,0,1,g.Matrix[0]),g.Matrix[1].multiplyToRef(g.Matrix[0],g.Matrix[0]),i.TranslationToRef(0,0,-l,g.Matrix[1]),g.Matrix[0].multiplyToRef(g.Matrix[1],g.Matrix[0]),i.OrthoOffCenterRHToRef(v,y,n,B,J,P,a,Z),g.Matrix[0].multiplyToRef(a,a),a}static PerspectiveLH(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const b=new i,Y=2*n/v,l=2*n/y,a=(B+n)/(B-n),Z=-2*B*n/(B-n),x=Math.tan(P);return i.FromValuesToRef(Y,0,0,0,0,l,0,x,0,0,a,1,0,0,Z,0,b),J&&b.multiplyToRef(h,b),b._updateIdentityStatus(!1),b}static PerspectiveFovLH(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const Y=new i;return i.PerspectiveFovLHToRef(v,y,n,B,Y,!0,J,P,b),Y}static PerspectiveFovLHToRef(v,y,n,B,J){let P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],b=arguments.length>6?arguments[6]:void 0,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const a=n,Z=B,x=1/Math.tan(.5*v),f=P?x/y:x,N=P?x:x*y,g=l&&0===a?-1:0!==Z?(Z+a)/(Z-a):1,c=l&&0===a?2*Z:0!==Z?-2*Z*a/(Z-a):-2*a,E=Math.tan(Y);return i.FromValuesToRef(f,0,0,0,0,N,0,E,0,0,g,1,0,0,c,0,J),b&&J.multiplyToRef(h,J),J._updateIdentityStatus(!1),J}static PerspectiveFovReverseLHToRef(v,y,n,B,J){let P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],b=arguments.length>6?arguments[6]:void 0,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const l=1/Math.tan(.5*v),a=P?l/y:l,Z=P?l:l*y,x=Math.tan(Y);return i.FromValuesToRef(a,0,0,0,0,Z,0,x,0,0,-n,1,0,0,1,0,J),b&&J.multiplyToRef(h,J),J._updateIdentityStatus(!1),J}static PerspectiveFovRH(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const Y=new i;return i.PerspectiveFovRHToRef(v,y,n,B,Y,!0,J,P,b),Y}static PerspectiveFovRHToRef(v,y,n,B,J){let P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],b=arguments.length>6?arguments[6]:void 0,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const a=n,Z=B,x=1/Math.tan(.5*v),f=P?x/y:x,N=P?x:x*y,g=l&&0===a?1:0!==Z?-(Z+a)/(Z-a):-1,c=l&&0===a?2*Z:0!==Z?-2*Z*a/(Z-a):-2*a,E=Math.tan(Y);return i.FromValuesToRef(f,0,0,0,0,N,0,E,0,0,g,-1,0,0,c,0,J),b&&J.multiplyToRef(h,J),J._updateIdentityStatus(!1),J}static PerspectiveFovReverseRHToRef(v,y,n,B,J){let P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],b=arguments.length>6?arguments[6]:void 0,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const l=1/Math.tan(.5*v),a=P?l/y:l,Z=P?l:l*y,x=Math.tan(Y);return i.FromValuesToRef(a,0,0,0,0,Z,0,x,0,0,-n,-1,0,0,-1,0,J),b&&J.multiplyToRef(h,J),J._updateIdentityStatus(!1),J}static GetFinalMatrix(v,y,n,B,J,P){const b=v.width,Y=v.height,l=v.x,a=v.y,Z=i.FromValues(b/2,0,0,0,0,-Y/2,0,0,0,0,P-J,0,l+b/2,Y/2+a,J,1),x=new i;return y.multiplyToRef(n,x),x.multiplyToRef(B,x),x.multiplyToRef(Z,x)}static GetAsMatrix2x2(v){const y=v.m,n=[y[0],y[1],y[4],y[5]];return b.d.MatrixUse64Bits?n:new Float32Array(n)}static GetAsMatrix3x3(v){const y=v.m,n=[y[0],y[1],y[2],y[4],y[5],y[6],y[8],y[9],y[10]];return b.d.MatrixUse64Bits?n:new Float32Array(n)}static Transpose(v){const y=new i;return i.TransposeToRef(v,y),y}static TransposeToRef(v,y){const n=v.m,B=n[0],J=n[4],P=n[8],b=n[12],Y=n[1],l=n[5],a=n[9],Z=n[13],x=n[2],f=n[6],N=n[10],i=n[14],g=n[3],c=n[7],h=n[11],E=n[15],W=y.bk;return W[0]=B,W[1]=J,W[2]=P,W[3]=b,W[4]=Y,W[5]=l,W[6]=a,W[7]=Z,W[8]=x,W[9]=f,W[10]=N,W[11]=i,W[12]=g,W[13]=c,W[14]=h,W[15]=E,y.markAsUpdated(),y._updateIdentityStatus(v._isIdentity,v._isIdentityDirty),y}static Reflection(v){const y=new i;return i.ReflectionToRef(v,y),y}static ReflectionToRef(v,y){v.normalize();const n=v.k.x,B=v.k.y,J=v.k.z,P=-2*n,b=-2*B,Y=-2*J;return i.FromValuesToRef(P*n+1,b*n,Y*n,0,P*B,b*B+1,Y*B,0,P*J,b*J,Y*J+1,0,P*v.d,b*v.d,Y*v.d,1,y),y}static FromXYZAxesToRef(v,y,n,B){return i.FromValuesToRef(v._x,v._y,v._z,0,y._x,y._y,y._z,0,n._x,n._y,n._z,0,0,0,0,1,B),B}static FromQuaternionToRef(v,y){const n=v._x*v._x,B=v._y*v._y,J=v._z*v._z,P=v._x*v._y,b=v._z*v._w,Y=v._z*v._x,l=v._y*v._w,a=v._y*v._z,Z=v._x*v._w;return y.bk[0]=1-2*(B+J),y.bk[1]=2*(P+b),y.bk[2]=2*(Y-l),y.bk[3]=0,y.bk[4]=2*(P-b),y.bk[5]=1-2*(J+n),y.bk[6]=2*(a+Z),y.bk[7]=0,y.bk[8]=2*(Y+l),y.bk[9]=2*(a-Z),y.bk[10]=1-2*(B+n),y.bk[11]=0,y.bk[12]=0,y.bk[13]=0,y.bk[14]=0,y.bk[15]=1,y.markAsUpdated(),y}}i._UpdateFlagSeed=0,i._IdentityReadOnly=i.Identity(),Object.defineProperties(i.prototype,{dimension:{value:[4,4]},rank:{value:2}});class g{}g.o=(0,J.e)(11,x.Zero),g.Matrix=(0,J.e)(2,i.Identity),g.Quaternion=(0,J.e)(3,N.Zero);class c{}c.Vector2=(0,J.e)(3,Z.Zero),c.o=(0,J.e)(13,x.Zero),c.Vector4=(0,J.e)(3,f.Zero),c.Quaternion=(0,J.e)(3,N.Zero),c.Matrix=(0,J.e)(8,i.Identity),(0,P.g)("BABYLON.Vector2",Z),(0,P.g)("BABYLON.Vector3",x),(0,P.g)("BABYLON.Vector4",f),(0,P.g)("BABYLON.Matrix",i);const h=i.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11355:(v,y,n)=>{"use strict";n.d(y,{c:()=>B});class B{constructor(v,y,n,B){this.x=v,this.y=y,this.width=n,this.height=B}toGlobal(v,y){return new B(this.x*v,this.y*y,this.width*v,this.height*y)}toGlobalToRef(v,y,n){return n.x=this.x*v,n.y=this.y*y,n.width=this.width*v,n.height=this.height*y,this}clone(){return new B(this.x,this.y,this.width,this.height)}}},11559:(v,y,n)=>{"use strict";n.d(y,{e:()=>a,f:()=>Z});var B=n(11081),J=n(11564);const P=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],b=[()=>1,v=>v.y,v=>v.z,v=>v.x,v=>v.x*v.y,v=>v.y*v.z,v=>3*v.z*v.z-1,v=>v.x*v.z,v=>v.x*v.x-v.y*v.y],Y=(v,y)=>P[v]*b[v](y),l=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class a{constructor(){this.preScaled=!1,this.l00=B.n.Zero(),this.l1_1=B.n.Zero(),this.l10=B.n.Zero(),this.l11=B.n.Zero(),this.l2_2=B.n.Zero(),this.l2_1=B.n.Zero(),this.l20=B.n.Zero(),this.l21=B.n.Zero(),this.l22=B.n.Zero()}addLight(v,y,n){J.d.o[0].set(y.r,y.g,y.b);const B=J.d.o[0],P=J.d.o[1];B.scaleToRef(n,P),P.scaleToRef(Y(0,v),J.d.o[2]),this.l00.addInPlace(J.d.o[2]),P.scaleToRef(Y(1,v),J.d.o[2]),this.l1_1.addInPlace(J.d.o[2]),P.scaleToRef(Y(2,v),J.d.o[2]),this.l10.addInPlace(J.d.o[2]),P.scaleToRef(Y(3,v),J.d.o[2]),this.l11.addInPlace(J.d.o[2]),P.scaleToRef(Y(4,v),J.d.o[2]),this.l2_2.addInPlace(J.d.o[2]),P.scaleToRef(Y(5,v),J.d.o[2]),this.l2_1.addInPlace(J.d.o[2]),P.scaleToRef(Y(6,v),J.d.o[2]),this.l20.addInPlace(J.d.o[2]),P.scaleToRef(Y(7,v),J.d.o[2]),this.l21.addInPlace(J.d.o[2]),P.scaleToRef(Y(8,v),J.d.o[2]),this.l22.addInPlace(J.d.o[2])}scaleInPlace(v){this.l00.scaleInPlace(v),this.l1_1.scaleInPlace(v),this.l10.scaleInPlace(v),this.l11.scaleInPlace(v),this.l2_2.scaleInPlace(v),this.l2_1.scaleInPlace(v),this.l20.scaleInPlace(v),this.l21.scaleInPlace(v),this.l22.scaleInPlace(v)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(l[0]),this.l1_1.scaleInPlace(l[1]),this.l10.scaleInPlace(l[2]),this.l11.scaleInPlace(l[3]),this.l2_2.scaleInPlace(l[4]),this.l2_1.scaleInPlace(l[5]),this.l20.scaleInPlace(l[6]),this.l21.scaleInPlace(l[7]),this.l22.scaleInPlace(l[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(P[0]),this.l1_1.scaleInPlace(P[1]),this.l10.scaleInPlace(P[2]),this.l11.scaleInPlace(P[3]),this.l2_2.scaleInPlace(P[4]),this.l2_1.scaleInPlace(P[5]),this.l20.scaleInPlace(P[6]),this.l21.scaleInPlace(P[7]),this.l22.scaleInPlace(P[8])}updateFromArray(v){return B.n.FromArrayToRef(v[0],0,this.l00),B.n.FromArrayToRef(v[1],0,this.l1_1),B.n.FromArrayToRef(v[2],0,this.l10),B.n.FromArrayToRef(v[3],0,this.l11),B.n.FromArrayToRef(v[4],0,this.l2_2),B.n.FromArrayToRef(v[5],0,this.l2_1),B.n.FromArrayToRef(v[6],0,this.l20),B.n.FromArrayToRef(v[7],0,this.l21),B.n.FromArrayToRef(v[8],0,this.l22),this}updateFromFloatsArray(v){return B.n.FromFloatsToRef(v[0],v[1],v[2],this.l00),B.n.FromFloatsToRef(v[3],v[4],v[5],this.l1_1),B.n.FromFloatsToRef(v[6],v[7],v[8],this.l10),B.n.FromFloatsToRef(v[9],v[10],v[11],this.l11),B.n.FromFloatsToRef(v[12],v[13],v[14],this.l2_2),B.n.FromFloatsToRef(v[15],v[16],v[17],this.l2_1),B.n.FromFloatsToRef(v[18],v[19],v[20],this.l20),B.n.FromFloatsToRef(v[21],v[22],v[23],this.l21),B.n.FromFloatsToRef(v[24],v[25],v[26],this.l22),this}static qh(v){return(new a).updateFromArray(v)}static FromPolynomial(v){const y=new a;return y.l00=v.xx.scale(.376127).add(v.yy.scale(.376127)).add(v.zz.scale(.376126)),y.l1_1=v.y.scale(.977204),y.l10=v.z.scale(.977204),y.l11=v.x.scale(.977204),y.l2_2=v.xy.scale(1.16538),y.l2_1=v.yz.scale(1.16538),y.l20=v.zz.scale(1.34567).od(v.xx.scale(.672834)).od(v.yy.scale(.672834)),y.l21=v.zx.scale(1.16538),y.l22=v.xx.scale(1.16538).od(v.yy.scale(1.16538)),y.l1_1.scaleInPlace(-1),y.l11.scaleInPlace(-1),y.l2_1.scaleInPlace(-1),y.l21.scaleInPlace(-1),y.scaleInPlace(Math.PI),y}}class Z{constructor(){this.x=B.n.Zero(),this.y=B.n.Zero(),this.z=B.n.Zero(),this.xx=B.n.Zero(),this.yy=B.n.Zero(),this.zz=B.n.Zero(),this.xy=B.n.Zero(),this.yz=B.n.Zero(),this.zx=B.n.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=a.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(v){J.d.o[0].Ae(v.r,v.g,v.b);const y=J.d.o[0];this.xx.addInPlace(y),this.yy.addInPlace(y),this.zz.addInPlace(y)}scaleInPlace(v){this.x.scaleInPlace(v),this.y.scaleInPlace(v),this.z.scaleInPlace(v),this.xx.scaleInPlace(v),this.yy.scaleInPlace(v),this.zz.scaleInPlace(v),this.yz.scaleInPlace(v),this.zx.scaleInPlace(v),this.xy.scaleInPlace(v)}updateFromHarmonics(v){return this._harmonics=v,this.x.p(v.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(v.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(v.l10),this.z.scaleInPlace(1.02333),this.xx.p(v.l00),J.d.o[0].p(v.l20).scaleInPlace(.247708),J.d.o[1].p(v.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).Ei(J.d.o[0]).addInPlace(J.d.o[1]),this.yy.p(v.l00),this.yy.scaleInPlace(.886277).Ei(J.d.o[0]).Ei(J.d.o[1]),this.zz.p(v.l00),J.d.o[0].p(v.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(J.d.o[0]),this.yz.p(v.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(v.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(v.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(v){return(new Z).updateFromHarmonics(v)}static qh(v){const y=new Z;return B.n.FromArrayToRef(v[0],0,y.x),B.n.FromArrayToRef(v[1],0,y.y),B.n.FromArrayToRef(v[2],0,y.z),B.n.FromArrayToRef(v[3],0,y.xx),B.n.FromArrayToRef(v[4],0,y.yy),B.n.FromArrayToRef(v[5],0,y.zz),B.n.FromArrayToRef(v[6],0,y.yz),B.n.FromArrayToRef(v[7],0,y.zx),B.n.FromArrayToRef(v[8],0,y.xy),y}}},11404:(v,y,n)=>{"use strict";n.d(y,{e:()=>a});var B=n(11081),J=n(11103),P=n(11338),b=n(11362),Y=n(11295);n(11409);function l(v){let y=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const n=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],P=[];let l=[];const a=v.width||v.size||1,Z=v.height||v.size||1,x=v.depth||v.size||1,f=v.wrap||!1;let N=void 0===v.topBaseAt?1:v.topBaseAt,i=void 0===v.bottomBaseAt?0:v.bottomBaseAt;N=(N+4)%4,i=(i+4)%4;let g=[2,0,3,1][N],c=[2,0,1,3][i],h=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(f){y=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],h=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let v=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],n=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const B=[17,18,19,16],J=[22,23,20,21];for(;g>0;)v.unshift(v.pop()),B.unshift(B.pop()),g--;for(;c>0;)n.unshift(n.pop()),J.unshift(J.pop()),c--;v=v.flat(),n=n.flat(),h=h.concat(v).concat(n),y.push(B[0],B[2],B[3],B[0],B[1],B[2]),y.push(J[0],J[2],J[3],J[0],J[1],J[2])}const E=[a/2,Z/2,x/2];l=h.reduce(((v,y,n)=>v.concat(y*E[n%3])),[]);const W=0===v.sideOrientation?0:v.sideOrientation||b.e.DEFAULTSIDE,s=v.faceUV||new Array(6),C=v.faceColors,r=[];for(let b=0;b<6;b++)void 0===s[b]&&(s[b]=new B.p(0,0,1,1)),C&&void 0===C[b]&&(C[b]=new J.e(1,1,1,1));for(let B=0;B<6;B++)if(P.push(s[B].z,Y.e?1-s[B].w:s[B].w),P.push(s[B].x,Y.e?1-s[B].w:s[B].w),P.push(s[B].x,Y.e?1-s[B].y:s[B].y),P.push(s[B].z,Y.e?1-s[B].y:s[B].y),C)for(let v=0;v<4;v++)r.push(C[B].r,C[B].g,C[B].b,C[B].a);b.e._ComputeSides(W,l,y,n,P,v.frontUVs,v.backUVs);const u=new b.e;if(u.indices=y,u.xa=l,u.ya=n,u.Aa=P,C){const v=W===b.e.DOUBLESIDE?r.concat(r):r;u.za=v}return u}function a(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new P.d(v,n);y.sideOrientation=P.d._GetDefaultSideOrientation(y.sideOrientation),B._originalBuilderSideOrientation=y.sideOrientation;return l(y).Ca(B,y.updatable),B}b.e.CreateBox=l,P.d.CreateBox=function(v,y){return a(v,{size:y,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11721:(v,y,n)=>{"use strict";n.d(y,{c:()=>Y});var B=n(11338),J=n(11362),P=n(11295);function b(v){const y=[],n=[],B=[],b=[],Y=v.radius||.5,l=v.tessellation||64,a=v.arc&&(v.arc<=0||v.arc>1)?1:v.arc||1,Z=0===v.sideOrientation?0:v.sideOrientation||J.e.DEFAULTSIDE;y.push(0,0,0),b.push(.5,.5);const x=2*Math.PI*a,f=1===a?x/l:x/(l-1);let N=0;for(let J=0;J<l;J++){const v=Math.cos(N),n=Math.sin(N),B=(v+1)/2,J=(1-n)/2;y.push(Y*v,Y*n,0),b.push(B,P.e?1-J:J),N+=f}1===a&&(y.push(y[3],y[4],y[5]),b.push(b[2],P.e?1-b[3]:b[3]));const i=y.length/3;for(let J=1;J<i-1;J++)n.push(J+1,0,J);J.e.ComputeNormals(y,n,B),J.e._ComputeSides(Z,y,n,B,b,v.frontUVs,v.backUVs);const g=new J.e;return g.indices=n,g.xa=y,g.ya=B,g.Aa=b,g}function Y(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new B.d(v,n);y.sideOrientation=B.d._GetDefaultSideOrientation(y.sideOrientation),J._originalBuilderSideOrientation=y.sideOrientation;return b(y).Ca(J,y.updatable),J}J.e.CreateDisc=b,B.d.CreateDisc=function(v,y,n){return Y(v,{radius:y,tessellation:n,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11409:(v,y,n)=>{"use strict";n.d(y,{f:()=>c,d:()=>E,g:()=>h});var B=n(11081),J=n(11103),P=n(11338),b=n(11362),Y=n(11127);P.d._GroundMeshParser=(v,y)=>l.Parse(v,y);class l extends P.d{constructor(v,y){super(v,y),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=v,this._subdivisionsY=v,this.subdivide(v);const n=this;n.createOrUpdateSubmeshesOctree&&n.createOrUpdateSubmeshesOctree(y)}getHeightAtCoordinates(v,y){const n=this.getWorldMatrix(),J=B.i.Matrix[5];n.invertToRef(J);const P=B.i.o[8];if(B.n.TransformCoordinatesFromFloatsToRef(v,0,y,J,P),v=P.x,y=P.z,v<this._minX||v>=this._maxX||y<=this._minZ||y>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const b=this._getFacetAt(v,y),Y=-(b.x*v+b.z*y+b.w)/b.y;return B.n.TransformCoordinatesFromFloatsToRef(0,Y,0,n,P),P.y}getNormalAtCoordinates(v,y){const n=new B.n(0,1,0);return this.getNormalAtCoordinatesToRef(v,y,n),n}getNormalAtCoordinatesToRef(v,y,n){const J=this.getWorldMatrix(),P=B.i.Matrix[5];J.invertToRef(P);const b=B.i.o[8];if(B.n.TransformCoordinatesFromFloatsToRef(v,0,y,P,b),v=b.x,y=b.z,v<this._minX||v>this._maxX||y<this._minZ||y>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Y=this._getFacetAt(v,y);return B.n.TransformNormalFromFloatsToRef(Y.x,Y.y,Y.z,J,n),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(v,y){const n=Math.floor((v+this._maxX)*this._subdivisionsX/this._width),B=Math.floor(-(y+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),J=this._heightQuads[B*this._subdivisionsX+n];let P;return P=y<J.slope.x*v+J.slope.y?J.facet1:J.facet2,P}_initHeightQuads(){const v=this._subdivisionsX,y=this._subdivisionsY;this._heightQuads=new Array;for(let n=0;n<y;n++)for(let y=0;y<v;y++){const J={slope:B.j.Zero(),facet1:new B.p(0,0,0,0),facet2:new B.p(0,0,0,0)};this._heightQuads[n*v+y]=J}return this}_computeHeightQuads(){const v=this.getVerticesData(Y.i.PositionKind);if(!v)return this;const y=B.i.o[3],n=B.i.o[2],J=B.i.o[1],P=B.i.o[0],b=B.i.o[4],l=B.i.o[5],a=B.i.o[6],Z=B.i.o[7],x=B.i.o[8];let f=0,N=0,i=0,g=0,c=0,h=0,E=0;const W=this._subdivisionsX,s=this._subdivisionsY;for(let Y=0;Y<s;Y++)for(let s=0;s<W;s++){f=3*s,N=Y*(W+1)*3,i=(Y+1)*(W+1)*3,y.x=v[N+f],y.y=v[N+f+1],y.z=v[N+f+2],n.x=v[N+f+3],n.y=v[N+f+4],n.z=v[N+f+5],J.x=v[i+f],J.y=v[i+f+1],J.z=v[i+f+2],P.x=v[i+f+3],P.y=v[i+f+4],P.z=v[i+f+5],g=(P.z-y.z)/(P.x-y.x),c=y.z-g*y.x,n.subtractToRef(y,b),J.subtractToRef(y,l),P.subtractToRef(y,a),B.n.CrossToRef(a,l,Z),B.n.CrossToRef(b,a,x),Z.normalize(),x.normalize(),h=-(Z.x*y.x+Z.y*y.y+Z.z*y.z),E=-(x.x*n.x+x.y*n.y+x.z*n.z);const C=this._heightQuads[Y*W+s];C.slope.Ae(g,c),C.facet1.Ae(Z.x,Z.y,Z.z,h),C.facet2.Ae(x.x,x.y,x.z,E)}return this}serialize(v){super.serialize(v),v.subdivisionsX=this._subdivisionsX,v.subdivisionsY=this._subdivisionsY,v.minX=this._minX,v.maxX=this._maxX,v.ij=this._minZ,v.maxZ=this._maxZ,v.width=this._width,v.height=this._height}static Parse(v,y){const n=new l(v.name,y);return n._subdivisionsX=v.subdivisionsX||1,n._subdivisionsY=v.subdivisionsY||1,n._minX=v.minX,n._maxX=v.maxX,n._minZ=v.ij,n._maxZ=v.maxZ,n._width=v.width,n._height=v.height,n}}var a=n(10791),Z=n(10820),x=n(11086),f=n(11295);function N(v){const y=[],n=[],J=[],P=[];let Y,l;const a=v.width||v.size||1,Z=v.height||v.size||1,x=0|(v.subdivisionsX||v.subdivisions||1),N=0|(v.subdivisionsY||v.subdivisions||1);for(Y=0;Y<=N;Y++)for(l=0;l<=x;l++){const v=new B.n(l*a/x-a/2,0,(N-Y)*Z/N-Z/2),y=new B.n(0,1,0);n.push(v.x,v.y,v.z),J.push(y.x,y.y,y.z),P.push(l/x,f.e?Y/N:1-Y/N)}for(Y=0;Y<N;Y++)for(l=0;l<x;l++)y.push(l+1+(Y+1)*(x+1)),y.push(l+1+Y*(x+1)),y.push(l+Y*(x+1)),y.push(l+(Y+1)*(x+1)),y.push(l+1+(Y+1)*(x+1)),y.push(l+Y*(x+1));const i=new b.e;return i.indices=y,i.xa=n,i.ya=J,i.Aa=P,i}function i(v){const y=void 0!==v.xmin&&null!==v.xmin?v.xmin:-1,n=void 0!==v.zmin&&null!==v.zmin?v.zmin:-1,J=void 0!==v.xmax&&null!==v.xmax?v.xmax:1,P=void 0!==v.zmax&&null!==v.zmax?v.zmax:1,Y=v.subdivisions||{w:1,h:1},l=v.precision||{w:1,h:1},a=[],Z=[],x=[],f=[];let N,i,g,c;Y.h=Y.h<1?1:Y.h,Y.w=Y.w<1?1:Y.w,l.w=l.w<1?1:l.w,l.h=l.h<1?1:l.h;const h=(J-y)/Y.w,E=(P-n)/Y.h;function W(v,y,n,J){const P=Z.length/3,b=l.w+1;for(N=0;N<l.h;N++)for(i=0;i<l.w;i++){const v=[P+i+N*b,P+(i+1)+N*b,P+(i+1)+(N+1)*b,P+i+(N+1)*b];a.push(v[1]),a.push(v[2]),a.push(v[3]),a.push(v[0]),a.push(v[1]),a.push(v[3])}const Y=B.n.Zero(),g=new B.n(0,1,0);for(N=0;N<=l.h;N++)for(Y.z=N*(J-y)/l.h+y,i=0;i<=l.w;i++)Y.x=i*(n-v)/l.w+v,Y.y=0,Z.push(Y.x,Y.y,Y.z),x.push(g.x,g.y,g.z),f.push(i/l.w,N/l.h)}for(g=0;g<Y.h;g++)for(c=0;c<Y.w;c++)W(y+c*h,n+g*E,y+(c+1)*h,n+(g+1)*E);const s=new b.e;return s.indices=a,s.xa=Z,s.ya=x,s.Aa=f,s}function g(v){const y=[],n=[],P=[],Y=[];let l,a;const Z=v.colorFilter||new J.d(.3,.59,.11),f=v.alphaFilter||0;let N=!1;if(v.minHeight>v.maxHeight){N=!0;const y=v.maxHeight;v.maxHeight=v.minHeight,v.minHeight=y}for(l=0;l<=v.subdivisions;l++)for(a=0;a<=v.subdivisions;a++){const y=new B.n(a*v.width/v.subdivisions-v.width/2,0,(v.subdivisions-l)*v.height/v.subdivisions-v.height/2),J=4*(((y.x+v.width/2)/v.width*(v.bufferWidth-1)|0)+((1-(y.z+v.height/2)/v.height)*(v.bufferHeight-1)|0)*v.bufferWidth);let b=v.buffer[J]/255,i=v.buffer[J+1]/255,g=v.buffer[J+2]/255;const c=v.buffer[J+3]/255;N&&(b=1-b,i=1-i,g=1-g);const h=b*Z.r+i*Z.g+g*Z.b;y.y=c>=f?v.minHeight+(v.maxHeight-v.minHeight)*h:v.minHeight-x.b,v.heightBuffer&&(v.heightBuffer[l*(v.subdivisions+1)+a]=y.y),n.push(y.x,y.y,y.z),P.push(0,0,0),Y.push(a/v.subdivisions,1-l/v.subdivisions)}for(l=0;l<v.subdivisions;l++)for(a=0;a<v.subdivisions;a++){const B=a+1+(l+1)*(v.subdivisions+1),J=a+1+l*(v.subdivisions+1),P=a+l*(v.subdivisions+1),b=a+(l+1)*(v.subdivisions+1),Y=n[3*B+1]>=v.minHeight,Z=n[3*J+1]>=v.minHeight,x=n[3*P+1]>=v.minHeight;Y&&Z&&x&&(y.push(B),y.push(J),y.push(P));n[3*b+1]>=v.minHeight&&Y&&x&&(y.push(b),y.push(B),y.push(P))}b.e.ComputeNormals(n,y,P);const i=new b.e;return i.indices=y,i.xa=n,i.ya=P,i.Aa=Y,i}function c(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new l(v,arguments.length>2?arguments[2]:void 0);n._setReady(!1),n._subdivisionsX=y.subdivisionsX||y.subdivisions||1,n._subdivisionsY=y.subdivisionsY||y.subdivisions||1,n._width=y.width||1,n._height=y.height||1,n._maxX=n._width/2,n._maxZ=n._height/2,n._minX=-n._maxX,n._minZ=-n._maxZ;return N(y).Ca(n,y.updatable),n._setReady(!0),n}function h(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new P.d(v,n);return i(y).Ca(B,y.updatable),B}function E(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const P=n.width||10,b=n.height||10,Y=n.subdivisions||1,x=n.minHeight||0,f=n.maxHeight||1,N=n.colorFilter||new J.d(.3,.59,.11),i=n.alphaFilter||0,c=n.updatable,h=n.onReady;B=B||Z.b.LastCreatedScene;const E=new l(v,B);let W;E._subdivisionsX=Y,E._subdivisionsY=Y,E._width=P,E._height=b,E._maxX=E._width/2,E._maxZ=E._height/2,E._minX=-E._maxX,E._minZ=-E._maxZ,E._setReady(!1),n.passHeightBufferInCallback&&(W=new Float32Array((Y+1)*(Y+1)));const s=(v,y,n)=>{g({width:P,height:b,subdivisions:Y,minHeight:x,maxHeight:f,colorFilter:N,buffer:v,bufferWidth:y,bufferHeight:n,alphaFilter:i,heightBuffer:W}).Ca(E,c),h&&h(E,W),E._setReady(!0)};if("string"===typeof y){const v=v=>{var y;const n=v.width,J=v.height;if(B.u)return;const P=null===(y=B)||void 0===y?void 0:y.getEngine().resizeImageBitmap(v,n,J);s(P,n,J)};a.g.LoadImage(y,v,n.onError?n.onError:()=>{},B.offlineProvider)}else s(y.data,y.width,y.height);return E}b.e.CreateGround=N,b.e.CreateTiledGround=i,b.e.CreateGroundFromHeightMap=g,P.d.CreateGround=(v,y,n,B,J,P)=>c(v,{width:y,height:n,subdivisions:B,updatable:P},J),P.d.CreateTiledGround=(v,y,n,B,J,P,b,Y,l)=>h(v,{xmin:y,zmin:n,xmax:B,zmax:J,subdivisions:P,precision:b,updatable:l},Y),P.d.CreateGroundFromHeightMap=(v,y,n,B,J,P,b,Y,l,a,Z)=>E(v,y,{width:n,height:B,subdivisions:J,minHeight:P,maxHeight:b,updatable:l,onReady:a,alphaFilter:Z},Y)},12770:(v,y,n)=>{"use strict";n.d(y,{b:()=>G,c:()=>L,d:()=>t});var B=n(11081),J=n(11338),P=n(11362),b=n(11103),Y=n(11127),l=n(12303),a=n(11200),Z=n(11110),x=n(11070),f=n(11281),N=n(10908),i=n(11311),g=n(10816),c=n(11275),h=n(10820),E=n(11262),W=n(11256);const s={effect:null,subMesh:null};class C extends c.c{constructor(v,y,n){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(v,y,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new B.d,this._cachedWorldViewProjectionMatrix=new B.d,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=n,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","k","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...J}}get shaderPath(){return this._shaderPath}set shaderPath(v){this._shaderPath=v}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(v){-1===this._options.uniforms.indexOf(v)&&this._options.uniforms.push(v)}setTexture(v,y){return-1===this._options.samplers.indexOf(v)&&this._options.samplers.push(v),this._textures[v]=y,this}removeTexture(v){delete this._textures[v]}setTextureArray(v,y){return-1===this._options.samplers.indexOf(v)&&this._options.samplers.push(v),this._checkUniform(v),this._textureArrays[v]=y,this}setExternalTexture(v,y){return-1===this._options.externalTextures.indexOf(v)&&this._options.externalTextures.push(v),this._externalTextures[v]=y,this}setFloat(v,y){return this._checkUniform(v),this._floats[v]=y,this}setInt(v,y){return this._checkUniform(v),this._ints[v]=y,this}setUInt(v,y){return this._checkUniform(v),this._uints[v]=y,this}setFloats(v,y){return this._checkUniform(v),this._floatsArrays[v]=y,this}setColor3(v,y){return this._checkUniform(v),this._colors3[v]=y,this}setColor3Array(v,y){return this._checkUniform(v),this._colors3Arrays[v]=y.reduce(((v,y)=>(y.toArray(v,v.length),v)),[]),this}setColor4(v,y){return this._checkUniform(v),this._colors4[v]=y,this}setColor4Array(v,y){return this._checkUniform(v),this._colors4Arrays[v]=y.reduce(((v,y)=>(y.toArray(v,v.length),v)),[]),this}setVector2(v,y){return this._checkUniform(v),this._vectors2[v]=y,this}setVector3(v,y){return this._checkUniform(v),this._vectors3[v]=y,this}setVector4(v,y){return this._checkUniform(v),this._vectors4[v]=y,this}setQuaternion(v,y){return this._checkUniform(v),this._quaternions[v]=y,this}setQuaternionArray(v,y){return this._checkUniform(v),this._quaternionsArrays[v]=y.reduce(((v,y)=>(y.toArray(v,v.length),v)),[]),this}setMatrix(v,y){return this._checkUniform(v),this._matrices[v]=y,this}setMatrices(v,y){this._checkUniform(v);const n=new Float32Array(16*y.length);for(let B=0;B<y.length;B++){y[B].copyToArray(n,16*B)}return this._matrixArrays[v]=n,this}setMatrix3x3(v,y){return this._checkUniform(v),this._matrices3x3[v]=y,this}setMatrix2x2(v,y){return this._checkUniform(v),this._matrices2x2[v]=y,this}setArray2(v,y){return this._checkUniform(v),this._vectors2Arrays[v]=y,this}setArray3(v,y){return this._checkUniform(v),this._vectors3Arrays[v]=y,this}setArray4(v,y){return this._checkUniform(v),this._vectors4Arrays[v]=y,this}setUniformBuffer(v,y){return-1===this._options.uniformBuffers.indexOf(v)&&this._options.uniformBuffers.push(v),this._uniformBuffers[v]=y,this}setTextureSampler(v,y){return-1===this._options.samplerObjects.indexOf(v)&&this._options.samplerObjects.push(v),this._textureSamplers[v]=y,this}setStorageBuffer(v,y){return-1===this._options.storageBuffers.indexOf(v)&&this._options.storageBuffers.push(v),this._storageBuffers[v]=y,this}setDefine(v,y){const n=v.trimEnd()+" ",B=this.options.defines.findIndex((y=>y===v||y.startsWith(n)));return B>=0&&this.options.defines.splice(B,1),("boolean"!==typeof y||y)&&this.options.defines.push(n+y),this}isReadyForSubMesh(v,y,n){return this.isReady(v,n,y)}isReady(v,y,n){var B;const J=n&&this._storeEffectOnSubMeshes;if(this.isFrozen){const v=J?n._drawWrapper:this._drawWrapper;if(v.effect&&v._wasPreviouslyReady&&v._wasPreviouslyUsingInstances===y)return!0}const P=this.va(),b=P.getEngine(),l=[],a=[],Z=new i.e;let f=this._shaderPath,N=this._options.uniforms,g=this._options.uniformBuffers,c=this._options.samplers;b.getCaps().multiview&&P.activeCamera&&P.activeCamera.outputRenderTarget&&P.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,l.push("#define MULTIVIEW"),-1!==N.indexOf("viewProjection")&&-1===N.indexOf("viewProjectionR")&&N.push("viewProjectionR"));for(let Y=0;Y<this._options.defines.length;Y++){const v=0===this._options.defines[Y].indexOf("#define")?this._options.defines[Y]:`#define ${this._options.defines[Y]}`;l.push(v)}for(let Y=0;Y<this._options.attributes.length;Y++)a.push(this._options.attributes[Y]);if(v&&v.isVerticesDataPresent(Y.i.ColorKind)&&(-1===a.indexOf(Y.i.ColorKind)&&a.push(Y.i.ColorKind),l.push("#define VERTEXCOLOR")),y&&(l.push("#define INSTANCES"),(0,W.hb)(a,this._materialHelperNeedsPreviousMatrices),null!==v&&void 0!==v&&v.hasThinInstances&&(l.push("#define THIN_INSTANCES"),v&&v.isVerticesDataPresent(Y.i.ColorInstanceKind)&&(a.push(Y.i.ColorInstanceKind),l.push("#define INSTANCESCOLOR")))),v&&v.useBones&&v.computeBonesUsingShaders&&v.skeleton){a.push(Y.i.MatricesIndicesKind),a.push(Y.i.MatricesWeightsKind),v.numBoneInfluencers>4&&(a.push(Y.i.MatricesIndicesExtraKind),a.push(Y.i.MatricesWeightsExtraKind));const y=v.skeleton;l.push("#define NUM_BONE_INFLUENCERS "+v.numBoneInfluencers),Z.addCPUSkinningFallback(0,v),y.isUsingTextureForMatrices?(l.push("#define BONETEXTURE"),-1===N.indexOf("boneTextureWidth")&&N.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(l.push("#define BonesPerMesh "+(y.bones.length+1)),-1===N.indexOf("mBones")&&N.push("mBones"))}else l.push("#define NUM_BONE_INFLUENCERS 0");let h=0;const C=v?v.morphTargetManager:null;if(C){const v=C.supportsUVs&&-1!==l.indexOf("#define UV1"),y=C.supportsTangents&&-1!==l.indexOf("#define TANGENT"),n=C.supportsNormals&&-1!==l.indexOf("#define NORMAL");h=C.numMaxInfluencers||C.numInfluencers,v&&l.push("#define MORPHTARGETS_UV"),y&&l.push("#define MORPHTARGETS_TANGENT"),n&&l.push("#define MORPHTARGETS_NORMAL"),h>0&&l.push("#define MORPHTARGETS"),C.isUsingTextureForTargets&&(l.push("#define MORPHTARGETS_TEXTURE"),-1===N.indexOf("morphTargetTextureIndices")&&N.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),l.push("#define NUM_MORPH_INFLUENCERS "+h);for(let B=0;B<h;B++)a.push(Y.i.PositionKind+B),n&&a.push(Y.i.NormalKind+B),y&&a.push(Y.i.TangentKind+B),v&&a.push(Y.i.UVKind+"_"+B);h>0&&(N=N.slice(),N.push("morphTargetInfluences"),N.push("morphTargetCount"),N.push("morphTargetTextureInfo"),N.push("morphTargetTextureIndices"))}else l.push("#define NUM_MORPH_INFLUENCERS 0");if(v){const y=v.bakedVertexAnimationManager;y&&y.isEnabled&&(l.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===N.indexOf("bakedVertexAnimationSettings")&&N.push("bakedVertexAnimationSettings"),-1===N.indexOf("bakedVertexAnimationTextureSizeInverted")&&N.push("bakedVertexAnimationTextureSizeInverted"),-1===N.indexOf("bakedVertexAnimationTime")&&N.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,W.z)(a,v,l)}for(const Y in this._textures)if(!this._textures[Y].isReady())return!1;v&&this._shouldTurnAlphaTestOn(v)&&l.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,E.e)(N),(0,E.l)(this,P,l)),P.fogEnabled&&null!==v&&void 0!==v&&v.applyFog&&P.fogMode!==x.e.FOGMODE_NONE&&(l.push("#define FOG"),-1===N.indexOf("view")&&N.push("view"),-1===N.indexOf("vFogInfos")&&N.push("vFogInfos"),-1===N.indexOf("vFogColor")&&N.push("vFogColor")),this._useLogarithmicDepth&&(l.push("#define LOGARITHMICDEPTH"),-1===N.indexOf("logarithmicDepthConstant")&&N.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(N=N.slice(),g=g.slice(),c=c.slice(),f=this.customShaderNameResolve(this.name,N,g,c,l,a));const r=J?n._getDrawWrapper(void 0,!0):this._drawWrapper,u=(null===r||void 0===r?void 0:r.effect)??null,O=(null===r||void 0===r?void 0:r.defines)??null,d=l.join("\n");let q=u;return O!==d&&(q=b.createEffect(f,{attributes:a,uniformsNames:N,uniformBuffersNames:g,samplers:c,defines:d,fallbacks:Z,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:h},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},b),J?n.setEffect(q,d,this._materialContext):r&&r.setEffect(q,d),this._onEffectCreatedObservable&&(s.effect=q,s.subMesh=n??(null===v||void 0===v?void 0:v.Ag[0])??null,this._onEffectCreatedObservable.notifyObservers(s))),r._wasPreviouslyUsingInstances=!!y,!((null===(B=q)||void 0===B||!B.isReady())??1)&&(u!==q&&P.resetCachedMaterial(),r._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(v,y){const n=this.va(),B=y??this.getEffect();B&&(-1!==this._options.uniforms.indexOf("world")&&B.setMatrix("world",v),-1!==this._options.uniforms.indexOf("worldView")&&(v.multiplyToRef(n.getViewMatrix(),this._cachedWorldViewMatrix),B.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(v.multiplyToRef(n.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),B.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&B.setMatrix("view",n.getViewMatrix()))}bindForSubMesh(v,y,n){var B;this.bind(v,y,null===(B=n._drawWrapperOverride)||void 0===B?void 0:B.effect,n)}bind(v,y,n,B){const J=B&&this._storeEffectOnSubMeshes,P=n??(J?B.effect:this.getEffect());if(!P)return;const b=this.va();this._activeEffect=P,this.bindOnlyWorldMatrix(v,n);const Y=this._options.uniformBuffers;let l=!1;if(P&&Y&&Y.length>0&&b.getEngine().supportsUniformBuffers)for(let x=0;x<Y.length;++x){switch(Y[x]){case"Mesh":y&&(y.getMeshUniformBuffer().bindToEffect(P,"Mesh"),y.transferToEffect(v));break;case"Scene":(0,W.t)(P,b.getSceneUniformBuffer()),b.finalizeSceneUbo(),l=!0}}const a=y&&J?this._mustRebind(b,P,B,y.visibility):b.getCachedMaterial()!==this;if(P&&a){let v;for(v in l||-1===this._options.uniforms.indexOf("view")||P.setMatrix("view",b.getViewMatrix()),l||-1===this._options.uniforms.indexOf("projection")||P.setMatrix("projection",b.getProjectionMatrix()),l||-1===this._options.uniforms.indexOf("viewProjection")||(P.setMatrix("viewProjection",b.getTransformMatrix()),this._multiview&&P.setMatrix("viewProjectionR",b._transformMatrixR)),b.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&P.setVector3("cameraPosition",b.activeCamera.globalPosition),(0,W.e)(y,P),(0,E.h)(P,this,b),this._useLogarithmicDepth&&(0,W.m)(J?B.materialDefines:P.defines,P,b),y&&(0,W.h)(b,y,P),this._textures)P.setTexture(v,this._textures[v]);for(v in this._textureArrays)P.setTextureArray(v,this._textureArrays[v]);for(v in this._ints)P.setInt(v,this._ints[v]);for(v in this._uints)P.setUInt(v,this._uints[v]);for(v in this._floats)P.setFloat(v,this._floats[v]);for(v in this._floatsArrays)P.setArray(v,this._floatsArrays[v]);for(v in this._colors3)P.setColor3(v,this._colors3[v]);for(v in this._colors3Arrays)P.setArray3(v,this._colors3Arrays[v]);for(v in this._colors4){const y=this._colors4[v];P.setFloat4(v,y.r,y.g,y.b,y.a)}for(v in this._colors4Arrays)P.setArray4(v,this._colors4Arrays[v]);for(v in this._vectors2)P.setVector2(v,this._vectors2[v]);for(v in this._vectors3)P.setVector3(v,this._vectors3[v]);for(v in this._vectors4)P.setVector4(v,this._vectors4[v]);for(v in this._quaternions)P.setQuaternion(v,this._quaternions[v]);for(v in this._matrices)P.setMatrix(v,this._matrices[v]);for(v in this._matrixArrays)P.setMatrices(v,this._matrixArrays[v]);for(v in this._matrices3x3)P.setMatrix3x3(v,this._matrices3x3[v]);for(v in this._matrices2x2)P.setMatrix2x2(v,this._matrices2x2[v]);for(v in this._vectors2Arrays)P.setArray2(v,this._vectors2Arrays[v]);for(v in this._vectors3Arrays)P.setArray3(v,this._vectors3Arrays[v]);for(v in this._vectors4Arrays)P.setArray4(v,this._vectors4Arrays[v]);for(v in this._quaternionsArrays)P.setArray4(v,this._quaternionsArrays[v]);for(v in this._uniformBuffers){const y=this._uniformBuffers[v].getBuffer();y&&P.bindUniformBuffer(y,v)}const n=b.getEngine(),Y=n.setExternalTexture;if(Y)for(v in this._externalTextures)Y.call(n,v,this._externalTextures[v]);const a=n.setTextureSampler;if(a)for(v in this._textureSamplers)a.call(n,v,this._textureSamplers[v]);const Z=n.setStorageBuffer;if(Z)for(v in this._storageBuffers)Z.call(n,v,this._storageBuffers[v])}if(P&&y&&(a||!this.isFrozen)){const v=y.morphTargetManager;v&&v.numInfluencers>0&&(0,W.q)(y,P);const n=y.bakedVertexAnimationManager;if(n&&n.isEnabled){var Z;const v=J?B._drawWrapper:this._drawWrapper;null===(Z=y.bakedVertexAnimationManager)||void 0===Z||Z.bind(P,!!v._wasPreviouslyUsingInstances)}}this._afterBind(y,P,B)}getActiveTextures(){const v=super.getActiveTextures();for(const y in this._textures)v.push(this._textures[y]);for(const y in this._textureArrays){const n=this._textureArrays[y];for(let y=0;y<n.length;y++)v.push(n[y])}return v}hasTexture(v){if(super.hasTexture(v))return!0;for(const y in this._textures)if(this._textures[y]===v)return!0;for(const y in this._textureArrays){const n=this._textureArrays[y];for(let y=0;y<n.length;y++)if(n[y]===v)return!0}return!1}clone(v){const y=Z.d.Clone((()=>new C(v,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);y.name=v,y.id=v,"object"===typeof y._shaderPath&&(y._shaderPath={...y._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((v=>{const y=this._options[v];Array.isArray(y)&&(this._options[v]=y.slice(0))})),this.stencil.copyTo(y.stencil);for(const n in this._textures)y.setTexture(n,this._textures[n]);for(const n in this._textureArrays)y.setTextureArray(n,this._textureArrays[n]);for(const n in this._externalTextures)y.setExternalTexture(n,this._externalTextures[n]);for(const n in this._ints)y.setInt(n,this._ints[n]);for(const n in this._uints)y.setUInt(n,this._uints[n]);for(const n in this._floats)y.setFloat(n,this._floats[n]);for(const n in this._floatsArrays)y.setFloats(n,this._floatsArrays[n]);for(const n in this._colors3)y.setColor3(n,this._colors3[n]);for(const n in this._colors3Arrays)y._colors3Arrays[n]=this._colors3Arrays[n];for(const n in this._colors4)y.setColor4(n,this._colors4[n]);for(const n in this._colors4Arrays)y._colors4Arrays[n]=this._colors4Arrays[n];for(const n in this._vectors2)y.setVector2(n,this._vectors2[n]);for(const n in this._vectors3)y.setVector3(n,this._vectors3[n]);for(const n in this._vectors4)y.setVector4(n,this._vectors4[n]);for(const n in this._quaternions)y.setQuaternion(n,this._quaternions[n]);for(const n in this._quaternionsArrays)y._quaternionsArrays[n]=this._quaternionsArrays[n];for(const n in this._matrices)y.setMatrix(n,this._matrices[n]);for(const n in this._matrixArrays)y._matrixArrays[n]=this._matrixArrays[n].slice();for(const n in this._matrices3x3)y.setMatrix3x3(n,this._matrices3x3[n]);for(const n in this._matrices2x2)y.setMatrix2x2(n,this._matrices2x2[n]);for(const n in this._vectors2Arrays)y.setArray2(n,this._vectors2Arrays[n]);for(const n in this._vectors3Arrays)y.setArray3(n,this._vectors3Arrays[n]);for(const n in this._vectors4Arrays)y.setArray4(n,this._vectors4Arrays[n]);for(const n in this._uniformBuffers)y.setUniformBuffer(n,this._uniformBuffers[n]);for(const n in this._textureSamplers)y.setTextureSampler(n,this._textureSamplers[n]);for(const n in this._storageBuffers)y.setStorageBuffer(n,this._storageBuffers[n]);return y}dispose(v,y,n){if(y){let v;for(v in this._textures)this._textures[v].dispose();for(v in this._textureArrays){const y=this._textureArrays[v];for(let v=0;v<y.length;v++)y[v].dispose()}}this._textures={},super.dispose(v,y,n)}serialize(){const v=Z.d.Serialize(this);let y;for(y in v.customType="BABYLON.ShaderMaterial",v.uniqueId=this.uniqueId,v.options=this._options,v.shaderPath=this._shaderPath,v.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,v.stencil=this.stencil.serialize(),v.textures={},this._textures)v.textures[y]=this._textures[y].serialize();for(y in v.textureArrays={},this._textureArrays){v.textureArrays[y]=[];const n=this._textureArrays[y];for(let B=0;B<n.length;B++)v.textureArrays[y].push(n[B].serialize())}for(y in v.ints={},this._ints)v.ints[y]=this._ints[y];for(y in v.uints={},this._uints)v.uints[y]=this._uints[y];for(y in v.floats={},this._floats)v.floats[y]=this._floats[y];for(y in v.floatsArrays={},this._floatsArrays)v.floatsArrays[y]=this._floatsArrays[y];for(y in v.colors3={},this._colors3)v.colors3[y]=this._colors3[y].wj();for(y in v.colors3Arrays={},this._colors3Arrays)v.colors3Arrays[y]=this._colors3Arrays[y];for(y in v.colors4={},this._colors4)v.colors4[y]=this._colors4[y].wj();for(y in v.colors4Arrays={},this._colors4Arrays)v.colors4Arrays[y]=this._colors4Arrays[y];for(y in v.vectors2={},this._vectors2)v.vectors2[y]=this._vectors2[y].wj();for(y in v.vectors3={},this._vectors3)v.vectors3[y]=this._vectors3[y].wj();for(y in v.vectors4={},this._vectors4)v.vectors4[y]=this._vectors4[y].wj();for(y in v.quaternions={},this._quaternions)v.quaternions[y]=this._quaternions[y].wj();for(y in v.matrices={},this._matrices)v.matrices[y]=this._matrices[y].wj();for(y in v.matrixArray={},this._matrixArrays)v.matrixArray[y]=this._matrixArrays[y];for(y in v.matrices3x3={},this._matrices3x3)v.matrices3x3[y]=this._matrices3x3[y];for(y in v.matrices2x2={},this._matrices2x2)v.matrices2x2[y]=this._matrices2x2[y];for(y in v.vectors2Arrays={},this._vectors2Arrays)v.vectors2Arrays[y]=this._vectors2Arrays[y];for(y in v.vectors3Arrays={},this._vectors3Arrays)v.vectors3Arrays[y]=this._vectors3Arrays[y];for(y in v.vectors4Arrays={},this._vectors4Arrays)v.vectors4Arrays[y]=this._vectors4Arrays[y];for(y in v.quaternionsArrays={},this._quaternionsArrays)v.quaternionsArrays[y]=this._quaternionsArrays[y];return v}static Parse(v,y,n){const J=Z.d.Parse((()=>new C(v.name,y,v.shaderPath,v.options,v.storeEffectOnSubMeshes)),v,y,n);let P;for(P in v.stencil&&J.stencil.parse(v.stencil,y,n),v.textures)J.setTexture(P,f.b.Parse(v.textures[P],y,n));for(P in v.textureArrays){const B=v.textureArrays[P],b=[];for(let v=0;v<B.length;v++)b.push(f.b.Parse(B[v],y,n));J.setTextureArray(P,b)}for(P in v.ints)J.setInt(P,v.ints[P]);for(P in v.uints)J.setUInt(P,v.uints[P]);for(P in v.floats)J.setFloat(P,v.floats[P]);for(P in v.floatsArrays)J.setFloats(P,v.floatsArrays[P]);for(P in v.colors3)J.setColor3(P,b.d.qh(v.colors3[P]));for(P in v.colors3Arrays){const y=v.colors3Arrays[P].reduce(((v,y,n)=>(n%3===0?v.push([y]):v[v.length-1].push(y),v)),[]).map((v=>b.d.qh(v)));J.setColor3Array(P,y)}for(P in v.colors4)J.setColor4(P,b.e.qh(v.colors4[P]));for(P in v.colors4Arrays){const y=v.colors4Arrays[P].reduce(((v,y,n)=>(n%4===0?v.push([y]):v[v.length-1].push(y),v)),[]).map((v=>b.e.qh(v)));J.setColor4Array(P,y)}for(P in v.vectors2)J.setVector2(P,B.j.qh(v.vectors2[P]));for(P in v.vectors3)J.setVector3(P,B.n.qh(v.vectors3[P]));for(P in v.vectors4)J.setVector4(P,B.p.qh(v.vectors4[P]));for(P in v.quaternions)J.setQuaternion(P,B.g.qh(v.quaternions[P]));for(P in v.matrices)J.setMatrix(P,B.d.qh(v.matrices[P]));for(P in v.matrixArray)J._matrixArrays[P]=new Float32Array(v.matrixArray[P]);for(P in v.matrices3x3)J.setMatrix3x3(P,v.matrices3x3[P]);for(P in v.matrices2x2)J.setMatrix2x2(P,v.matrices2x2[P]);for(P in v.vectors2Arrays)J.setArray2(P,v.vectors2Arrays[P]);for(P in v.vectors3Arrays)J.setArray3(P,v.vectors3Arrays[P]);for(P in v.vectors4Arrays)J.setArray4(P,v.vectors4Arrays[P]);for(P in v.quaternionsArrays)J.setArray4(P,v.quaternionsArrays[P]);return J}static ParseFromFileAsync(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((J,P)=>{const b=new g.c;b.addEventListener("readystatechange",(()=>{if(4==b.readyState)if(200==b.status){const y=JSON.parse(b.responseText),P=this.Parse(y,n||h.b.LastCreatedScene,B);v&&(P.name=v),J(P)}else P("Unable to load the ShaderMaterial")})),b.open("GET",y),b.send()}))}static ParseFromSnippetAsync(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((B,J)=>{const P=new g.c;P.addEventListener("readystatechange",(()=>{if(4==P.readyState)if(200==P.status){const J=JSON.parse(JSON.parse(P.responseText).jsonPayload),b=JSON.parse(J.shaderMaterial),Y=this.Parse(b,y||h.b.LastCreatedScene,n);Y.snippetId=v,B(Y)}else J("Unable to load the snippet "+v)})),P.open("GET",this.SnippetUrl+"/"+v.replace(/#/g,"/")),P.send()}))}}C.SnippetUrl="https://snippet.babylonjs.com",C.CreateFromSnippetAsync=C.ParseFromSnippetAsync,(0,N.g)("BABYLON.ShaderMaterial",C),J.d._LinesMeshParser=(v,y)=>r.Parse(v,y);class r extends J.d{_isShaderMaterial(v){return"ShaderMaterial"===v.getClassName()}constructor(v){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>5?arguments[5]:void 0,J=arguments.length>6?arguments[6]:void 0,P=arguments.length>7?arguments[7]:void 0;super(v,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,y,arguments.length>4?arguments[4]:void 0),this.useVertexColor=B,this.useVertexAlpha=J,this.color=new b.d(1,1,1),this.alpha=1,this._shaderLanguage=0,y&&(this.color=y.color.clone(),this.alpha=y.alpha,this.useVertexColor=y.useVertexColor,this.useVertexAlpha=y.useVertexAlpha),this.intersectionThreshold=.1;const l={attributes:[Y.i.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===J?l.needAlphaBlending=!1:l.defines.push("#define VERTEXALPHA"),B?(l.defines.push("#define VERTEXCOLOR"),l.attributes.push(Y.i.ColorKind)):(l.uniforms.push("color"),this._color4=new b.e),P)this.material=P;else{this.va().getEngine().isWebGPU&&!r.ForceGLSL&&(this._shaderLanguage=1),l.shaderLanguage=this._shaderLanguage,l.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([n.e(23).then(n.bind(n,13628)),n.e(47).then(n.bind(n,13633))]):await Promise.all([n.e(28).then(n.bind(n,13639)),n.e(48).then(n.bind(n,13641))])},this.material=new C("colorShader",this.va(),"color",l,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(v){this._lineMaterial=v,this._lineMaterial.fillMode=a.d.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(v){}_bind(v,y){if(!this._geometry)return this;const n=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(y,n):this._geometry._bind(y,n,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:v,g:y,b:n}=this.color;this._color4.set(v,y,n,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(v,y,n){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const B=this.va().getEngine();return this._unIndexed?B.drawArraysType(a.d.LineListDrawMode,v.verticesStart,v.verticesCount,n):B.drawElementsType(a.d.LineListDrawMode,v.indexStart,v.indexCount,n),this}dispose(v){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(v)}clone(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return new r(v,this.va(),y,this,n)}createInstance(v){const y=new u(v,this);if(this.instancedBuffers){y.instancedBuffers={};for(const v in this.instancedBuffers)y.instancedBuffers[v]=this.instancedBuffers[v]}return y}serialize(v){super.serialize(v),v.color=this.color.wj(),v.alpha=this.alpha}static Parse(v,y){const n=new r(v.name,y);return n.color=b.d.qh(v.color),n.alpha=v.alpha,n}}r.ForceGLSL=!1;class u extends l.d{constructor(v,y){super(v,y),this.intersectionThreshold=y.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var O=n(10801);function d(v){const y=[],n=[],B=v.lines,J=v.za,b=[];let Y=0;for(let P=0;P<B.length;P++){const v=B[P];for(let B=0;B<v.length;B++){const{x:l,y:a,z:Z}=v[B];if(n.push(l,a,Z),J){const v=J[P],{r:y,g:n,b:Y,a:l}=v[B];b.push(y,n,Y,l)}B>0&&(y.push(Y-1),y.push(Y)),Y++}}const l=new P.e;return l.indices=y,l.xa=n,J&&(l.za=b),l}function q(v){const y=v.dashSize||3,n=v.gapSize||1,J=v.dashNb||200,b=v.points,Y=[],l=[],a=B.n.Zero();let Z=0,x=0,f=0,N=0,i=0,g=0,c=0;for(c=0;c<b.length-1;c++)b[c+1].subtractToRef(b[c],a),Z+=a.length();for(f=Z/J,N=y*f/(y+n),c=0;c<b.length-1;c++){b[c+1].subtractToRef(b[c],a),x=Math.floor(a.length()/f),a.normalize();for(let v=0;v<x;v++)i=f*v,Y.push(b[c].x+i*a.x,b[c].y+i*a.y,b[c].z+i*a.z),Y.push(b[c].x+(i+N)*a.x,b[c].y+(i+N)*a.y,b[c].z+(i+N)*a.z),l.push(g,g+1),g+=2}const h=new P.e;return h.xa=Y,h.indices=l,h}function L(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=y.instance,J=y.lines,P=y.za;if(B){const v=B.getVerticesData(Y.i.PositionKind);let y,n;P&&(y=B.getVerticesData(Y.i.ColorKind));let b=0,l=0;for(let B=0;B<J.length;B++){const Y=J[B];for(let J=0;J<Y.length;J++)v[b]=Y[J].x,v[b+1]=Y[J].y,v[b+2]=Y[J].z,P&&y&&(n=P[B],y[l]=n[J].r,y[l+1]=n[J].g,y[l+2]=n[J].b,y[l+3]=n[J].a,l+=4),b+=3}return B.updateVerticesData(Y.i.PositionKind,v,!1,!1),P&&y&&B.updateVerticesData(Y.i.ColorKind,y,!1,!1),B.refreshBoundingInfo(),B}const b=new r(v,n,null,void 0,void 0,!!P,y.useVertexAlpha,y.material);return d(y).Ca(b,y.updatable),b}function t(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=y.za?[y.za]:null;return L(v,{lines:[y.points],updatable:y.updatable,instance:y.instance,za:B,useVertexAlpha:y.useVertexAlpha,material:y.material},n)}function G(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=y.points,b=y.instance,Y=y.gapSize||1,l=y.dashSize||3;if(b){const v=v=>{const y=B.n.Zero(),n=v.length/6;let J=0,Y=0,l=0,a=0,Z=0,x=0,f=0,N=0;for(f=0;f<P.length-1;f++)P[f+1].subtractToRef(P[f],y),J+=y.length();l=J/n;const i=b._creationDataStorage.dashSize;for(a=i*l/(i+b._creationDataStorage.gapSize),f=0;f<P.length-1;f++)for(P[f+1].subtractToRef(P[f],y),Y=Math.floor(y.length()/l),y.normalize(),N=0;N<Y&&x<v.length;)Z=l*N,v[x]=P[f].x+Z*y.x,v[x+1]=P[f].y+Z*y.y,v[x+2]=P[f].z+Z*y.z,v[x+3]=P[f].x+(Z+a)*y.x,v[x+4]=P[f].y+(Z+a)*y.y,v[x+5]=P[f].z+(Z+a)*y.z,x+=6,N++;for(;x<v.length;)v[x]=P[f].x,v[x+1]=P[f].y,v[x+2]=P[f].z,x+=3};return(y.dashNb||y.dashSize||y.gapSize||y.useVertexAlpha||y.material)&&O.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),b.updateMeshPositions(v,!1),b}const a=new r(v,n,null,void 0,void 0,void 0,y.useVertexAlpha,y.material);return q(y).Ca(a,y.updatable),a._creationDataStorage=new J.h,a._creationDataStorage.dashSize=l,a._creationDataStorage.gapSize=Y,a}P.e.CreateLineSystem=d,P.e.CreateDashedLines=q,J.d.rb=function(v,y){return t(v,{points:y,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},J.d.CreateDashedLines=function(v,y,n,B,J){return G(v,{points:y,dashSize:n,gapSize:B,dashNb:J,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11453:(v,y,n)=>{"use strict";n.d(y,{c:()=>Y,g:()=>l});var B=n(11338),J=n(11362),P=n(11295);function b(v){const y=[],n=[],B=[],b=[],Y=v.width||v.size||1,l=v.height||v.size||1,a=0===v.sideOrientation?0:v.sideOrientation||J.e.DEFAULTSIDE,Z=Y/2,x=l/2;n.push(-Z,-x,0),B.push(0,0,-1),b.push(0,P.e?1:0),n.push(Z,-x,0),B.push(0,0,-1),b.push(1,P.e?1:0),n.push(Z,x,0),B.push(0,0,-1),b.push(1,P.e?0:1),n.push(-Z,x,0),B.push(0,0,-1),b.push(0,P.e?0:1),y.push(0),y.push(1),y.push(2),y.push(0),y.push(2),y.push(3),J.e._ComputeSides(a,n,y,B,b,v.frontUVs,v.backUVs);const f=new J.e;return f.indices=y,f.xa=n,f.ya=B,f.Aa=b,f}function Y(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new B.d(v,n);y.sideOrientation=B.d._GetDefaultSideOrientation(y.sideOrientation),J._originalBuilderSideOrientation=y.sideOrientation;return b(y).Ca(J,y.updatable),y.sourcePlane&&(J.translate(y.sourcePlane.k,-y.sourcePlane.d),J.setDirection(y.sourcePlane.k.scale(-1))),J}const l={Cg:Y};J.e.Cg=b,B.d.Cg=(v,y,n,B,J)=>Y(v,{size:y,width:y,height:y,sideOrientation:J,updatable:B},n)},11703:(v,y,n)=>{"use strict";n.d(y,{c:()=>l});var B=n(11081),J=n(11338),P=n(11362),b=n(11295);function Y(v){const y=0|(v.segments||32),n=v.diameterX||v.diameter||1,J=v.diameterY||v.diameter||1,Y=v.diameterZ||v.diameter||1,l=v.arc&&(v.arc<=0||v.arc>1)?1:v.arc||1,a=v.slice&&v.slice<=0?1:v.slice||1,Z=0===v.sideOrientation?0:v.sideOrientation||P.e.DEFAULTSIDE,x=!!v.dedupTopBottomIndices,f=new B.n(n/2,J/2,Y/2),N=2+y,i=2*N,g=[],c=[],h=[],E=[];for(let P=0;P<=N;P++){const v=P/N,y=v*Math.PI*a;for(let n=0;n<=i;n++){const J=n/i,P=J*Math.PI*2*l,Y=B.d.RotationZ(-y),a=B.d.RotationY(P),Z=B.n.TransformCoordinates(B.n.Up(),Y),x=B.n.TransformCoordinates(Z,a),N=x.multiply(f),g=x.divide(f).normalize();c.push(N.x,N.y,N.z),h.push(g.x,g.y,g.z),E.push(J,b.e?1-v:v)}if(P>0){const v=c.length/3;for(let y=v-2*(i+1);y+i+2<v;y++)x?(P>1&&(g.push(y),g.push(y+1),g.push(y+i+1)),(P<N||a<1)&&(g.push(y+i+1),g.push(y+1),g.push(y+i+2))):(g.push(y),g.push(y+1),g.push(y+i+1),g.push(y+i+1),g.push(y+1),g.push(y+i+2))}}P.e._ComputeSides(Z,c,g,h,E,v.frontUVs,v.backUVs);const W=new P.e;return W.indices=g,W.xa=c,W.ya=h,W.Aa=E,W}function l(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new J.d(v,n);y.sideOrientation=J.d._GetDefaultSideOrientation(y.sideOrientation),B._originalBuilderSideOrientation=y.sideOrientation;return Y(y).Ca(B,y.updatable),B}P.e.CreateSphere=Y,J.d.CreateSphere=(v,y,n,B,J,P)=>l(v,{segments:y,diameterX:n,diameterY:n,diameterZ:n,sideOrientation:P,updatable:J},B)},12345:(v,y,n)=>{"use strict";n.d(y,{b:()=>x});var B=n(10791),J=n(12352),P=n(11367),b=n(11127),Y=n(11362),l=n(10801);function a(v,y,n,B,J){let P=null,b=null,Y=null;try{let l;P=new v.Decoder,b=new v.DecoderBuffer,b.Init(y,y.byteLength);const a=P.GetEncodedGeometryType(b);switch(a){case v.TRIANGULAR_MESH:{const y=new v.Mesh;if(l=P.DecodeBufferToMesh(b,y),!l.ok()||0===y.ptr)throw new Error(l.error_msg());const n=3*y.num_faces(),J=4*n,a=v._malloc(J);try{P.GetTrianglesUInt32Array(y,J,a);const b=new Uint32Array(n);b.set(new Uint32Array(v.HEAPF32.buffer,a,n)),B(b)}finally{v._free(a)}Y=y;break}case v.POINT_CLOUD:{const y=new v.PointCloud;if(l=P.DecodeBufferToPointCloud(b,y),!l.ok()||!y.ptr)throw new Error(l.error_msg());Y=y;break}default:throw new Error(`Invalid geometry type ${a}`)}const Z=Y.num_points(),x=(y,n,B,P)=>{const b=P.data_type(),Y=P.num_components(),l=P.normalized(),a=P.byte_stride(),x=P.byte_offset(),f={[v.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:v.HEAPF32},[v.DT_INT8]:{typedArrayConstructor:Int8Array,heap:v.HEAP8},[v.DT_INT16]:{typedArrayConstructor:Int16Array,heap:v.HEAP16},[v.DT_INT32]:{typedArrayConstructor:Int32Array,heap:v.HEAP32},[v.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:v.HEAPU8},[v.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:v.HEAPU16},[v.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:v.HEAPU32}}[b];if(!f)throw new Error(`Invalid data type ${b}`);const N=Z*Y,i=N*f.typedArrayConstructor.BYTES_PER_ELEMENT,g=v._malloc(i);try{y.GetAttributeDataArrayForAllPoints(n,P,b,i,g);const v=new f.typedArrayConstructor(f.heap.buffer,g,N);J(B,v.slice(),Y,x,a,l)}finally{v._free(g)}};if(n)for(const v in n){const y=n[v],B=P.GetAttributeByUniqueId(Y,y);x(P,Y,v,B)}else{const y={position:v.POSITION,k:v.NORMAL,color:v.COLOR,uv:v.TEX_COORD};for(const v in y){const n=P.GetAttributeId(Y,y[v]);if(-1!==n){const y=P.GetAttribute(Y,n);x(P,Y,v,y)}}}return Z}finally{Y&&v.destroy(Y),b&&v.destroy(b),P&&v.destroy(P)}}function Z(){let v;onmessage=y=>{const n=y.data;switch(n.id){case"init":{const y=n.decoder;y.url&&importScripts(y.url);const B=y.wasmBinary?{wasmBinary:y.wasmBinary}:{};v=DracoDecoderModule(B),postMessage({id:"initDone"});break}case"decodeMesh":if(!v)throw new Error("Draco decoder module is not available");v.then((v=>{const y=a(v,n.dataView,n.attributes,(v=>{postMessage({id:"indices",data:v},[v.buffer])}),((v,y,n,B,J,P)=>{postMessage({id:"attribute",kind:v,data:y,size:n,byteOffset:B,byteStride:J,normalized:P},[y.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:y})}))}}}class x{static get DecoderAvailable(){const v=x.Configuration.decoder;return!!(v.wasmUrl&&v.wasmBinaryUrl&&"object"===typeof WebAssembly||v.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return x._Default||(x._Default=new x),x._Default}static ResetDefault(v){x._Default&&(v||x._Default.dispose(),x._Default=null)}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.DefaultNumWorkers;const y=x.Configuration.decoder;if(y.workerPool||"object"===typeof v&&v.workerPool)this._workerPoolPromise=Promise.resolve(y.workerPool||v.workerPool);else{const n=y.wasmBinary||"object"===typeof v&&v.wasmBinary,P="number"===typeof v?v:v.numWorkers,b=P&&"function"===typeof Worker&&"function"===typeof URL,Y=b||!b&&!y.jsModule,l=y.wasmUrl&&y.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:Y?B.g.GetBabylonScriptURL(y.wasmUrl,!0):"",wasmBinaryPromise:n?Promise.resolve(n):B.g.LoadFileAsync(B.g.GetBabylonScriptURL(y.wasmBinaryUrl,!0))}:{url:Y?B.g.GetBabylonScriptURL(y.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};b?this._workerPoolPromise=l.wasmBinaryPromise.then((v=>{const y=`${a}(${Z})()`,n=URL.createObjectURL(new Blob([y],{type:"application/javascript"}));return new J.c(P,(()=>function(v,y,n){return new Promise(((B,J)=>{const P=y=>{v.removeEventListener("error",P),v.removeEventListener("message",b),J(y)},b=y=>{"initDone"===y.data.id&&(v.removeEventListener("error",P),v.removeEventListener("message",b),B(v))};if(v.addEventListener("error",P),v.addEventListener("message",b),y){const B=y.slice(0);v.postMessage({id:"init",decoder:{url:n,wasmBinary:B}},[B])}else v.postMessage({id:"init",decoder:{url:n}})}))}(new Worker(n),v,l.url)))})):this._decoderModulePromise=l.wasmBinaryPromise.then((async v=>{if("undefined"===typeof DracoDecoderModule&&!y.jsModule){if(!l.url)throw new Error("Draco decoder module is not available");await B.g.LoadBabylonScriptAsync(l.url)}return await(n=v,J=y.jsModule,new Promise((v=>{(J||DracoDecoderModule)({wasmBinary:n}).then((y=>{v({module:y})}))})));var n,J}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((v=>{v.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(v,y,n){const B=v instanceof ArrayBuffer?new Int8Array(v):new Int8Array(v.buffer,v.byteOffset,v.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((v=>new Promise(((J,P)=>{v.push(((v,b)=>{let Y=null;const a=[],Z=y=>{v.removeEventListener("error",Z),v.removeEventListener("message",x),P(y),b()},x=y=>{const B=y.data;switch(B.id){case"decodeMeshDone":v.removeEventListener("error",Z),v.removeEventListener("message",x),J({indices:Y,attributes:a,totalVertices:B.totalVertices}),b();break;case"indices":Y=B.data;break;case"attribute":a.push({kind:B.kind,data:B.data,size:B.size,byteOffset:B.byteOffset,byteStride:B.byteStride,normalized:(P=B.kind,f=B.normalized,n&&void 0!==n[P]?(f!==n[P]&&l.e.Warn(`Normalized flag from Draco data (${f}) does not match normalized flag from glTF accessor (${n[P]}). Using flag from glTF accessor.`),n[P]):f)})}var P,f};v.addEventListener("error",Z),v.addEventListener("message",x);const f=B.slice();v.postMessage({id:"decodeMesh",dataView:f,attributes:y},[f.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((v=>{let n=null;const J=[],P=a(v.module,B,y,(v=>{n=v}),((v,y,n,B,P,b)=>{J.push({kind:v,data:y,size:n,byteOffset:B,byteStride:P,normalized:b})}));return{indices:n,attributes:J,totalVertices:P}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(v,y,n,B){const J=await this.decodeMeshToMeshDataAsync(n,B),Y=new P.b(v,y);J.indices&&Y.setIndices(J.indices);for(const P of J.attributes)Y.setVerticesBuffer(new b.i(y.getEngine(),P.data,P.kind,!1,void 0,P.byteStride,void 0,P.byteOffset,P.size,void 0,P.normalized,!0),J.totalVertices);return Y}async _decodeMeshToGeometryForGltfAsync(v,y,n,B,J){const Y=await this.decodeMeshToMeshDataAsync(n,B,J),l=new P.b(v,y);Y.indices&&l.setIndices(Y.indices);for(const P of Y.attributes)l.setVerticesBuffer(new b.i(y.getEngine(),P.data,P.kind,!1,void 0,P.byteStride,void 0,P.byteOffset,P.size,void 0,P.normalized,!0),Y.totalVertices);return l}async decodeMeshAsync(v,y){const n=await this.decodeMeshToMeshDataAsync(v,y),B=new Y.e;n.indices&&(B.indices=n.indices);for(const J of n.attributes){const v=b.i.GetFloatData(J.data,J.size,b.i.GetDataType(J.data),J.byteOffset,J.byteStride,J.normalized,n.totalVertices);B.set(v,J.kind)}return B}}x.Configuration={decoder:{wasmUrl:`${B.g._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${B.g._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${B.g._DefaultCdnUrl}/draco_decoder_gltf.js`}},x.DefaultNumWorkers=x.GetDefaultNumWorkers(),x._Default=null},11510:(v,y,n)=>{"use strict";n.d(y,{c:()=>J});var B=n(11129);class J extends B.b{constructor(v){super(),this._buffer=v}get underlyingResource(){return this._buffer}}},11383:(v,y,n)=>{"use strict";n.d(y,{d:()=>u});var B=n(11050),J=n(10795),P=n(11081),b=n(11127),Y=n(11362),l=n(11387),a=n(11125),Z=n(11216),x=n(11120);class f{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new P.n(0,0,0),this._diffPositionForCollisions=new P.n(0,0,0),this._collisionResponse=!0}}var N=n(10811),i=n(11242),g=n(11103),c=n(11086),h=n(11390),E=n(10908),W=n(11055),s=n(10849);class C{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=P.n.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class r{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new C,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new f,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class u extends l.e{static get BILLBOARDMODE_NONE(){return l.e.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return l.e.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return l.e.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return l.e.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return l.e.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return l.e.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(v){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=v}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(v){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=v}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(v){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=v}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(v){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=v}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(v){this._internalAbstractMeshDataInfo._collisionRetryCount=v}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(v){this._internalAbstractMeshDataInfo._morphTargetManager!==v&&(this._internalAbstractMeshDataInfo._morphTargetManager=v,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(v){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==v&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=v,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(v){return!!super._updateNonUniformScalingState(v)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(v){this._internalAbstractMeshDataInfo._rawBoundingInfo=v}set Wk(v){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(v)}set onCollisionPositionChange(v){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(v)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(v){if(this._internalAbstractMeshDataInfo._visibility===v)return;const y=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=v,(1===y&&1!==v||1!==y&&1===v)&&this._markSubMeshesAsDirty((v=>{v.markAsMiscDirty(),v.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(v){this._internalAbstractMeshDataInfo._inheritVisibility=v}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let v=this._parentNode;for(;v;){const y=v.isVisible;if("undefined"!==typeof y)return y;v=v.parent}}return this._isVisible}set isVisible(v){this._isVisible=v}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(v){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=v}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(v){this._internalAbstractMeshDataInfo._renderingGroupId=v}get material(){return this._internalAbstractMeshDataInfo._material}set material(v){this._setMaterial(v)}_setMaterial(v){this._internalAbstractMeshDataInfo._material!==v&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=v,v&&v.meshMap&&(v.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.Ag&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(v){var y;return null===(y=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===y?void 0:y[v]}setMaterialForRenderPass(v,y){this.resetDrawCache(v),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[v]=y}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(v){this._internalAbstractMeshDataInfo._receiveShadows!==v&&(this._internalAbstractMeshDataInfo._receiveShadows=v,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(v){this._internalAbstractMeshDataInfo._hasVertexAlpha!==v&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=v,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(v){this._internalAbstractMeshDataInfo._useVertexColors!==v&&(this._internalAbstractMeshDataInfo._useVertexColors=v,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(v){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==v&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=v,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(v){this._internalAbstractMeshDataInfo._numBoneInfluencers!==v&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=v,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(v){this._internalAbstractMeshDataInfo._applyFog!==v&&(this._internalAbstractMeshDataInfo._applyFog=v,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(v){this._internalAbstractMeshDataInfo._enableDistantPicking=v}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(v){v!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=v,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(v){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(v)?-1:v}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(v){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=v}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(v){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(v)?-1:v}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(v){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=v}get lightSources(){return this._lightSources}set skeleton(v){const y=this._internalAbstractMeshDataInfo._skeleton;y&&y.needInitialSkinMatrix&&y._unregisterMeshWithPoseMatrix(this),v&&v.needInitialSkinMatrix&&v._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=v,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(v){var y;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(v,n,!1),y=this,this._internalAbstractMeshDataInfo=new r,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Ri=u.Si,this.onCollideObservable=new J.e,this.onCollisionPositionChangeObservable=new J.e,this.onMaterialChangedObservable=new J.e,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Kb=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=g.d.Red(),this.outlineWidth=.02,this.overlayColor=g.d.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.Jb=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new P.n(.5,1,.5),this.ellipsoidOffset=new P.n(0,0,0),this.edgesWidth=1,this.edgesColor=new g.e(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,Nc:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new J.e,this._onCollisionPositionChange=function(v,n){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n.subtractToRef(y._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,y._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),y._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>s.c.CollisionsEpsilon&&y.position.addInPlace(y._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),B&&y.onCollideObservable.notifyObservers(B),y.onCollisionPositionChangeObservable.notifyObservers(y.position)},n=this.va(),n.Ai(this),this._resyncLightSources(),this._uniformBuffer=new x.b(this.va().getEngine(),void 0,void 0,v,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),n.performancePriority){case 2:this.Da=!0;case 1:this.Jb=!0,this.Kb=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(v){const y=this._uniformBuffer;y.Vj("world",v),y.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),y.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(v){let y="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");y+=", # of submeshes: "+(this.Ag?this.Ag.length:0);const n=this._internalAbstractMeshDataInfo._skeleton;return n&&(y+=", skeleton: "+n.name),v&&(y+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],y+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.Nc?"YES":"NO")),y}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==l.e.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(y||this.actionManager.isRecursive)){if(!v)return this.actionManager;if(this.actionManager.hasSpecificTrigger(v))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(v,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.Ag){for(const v of this.Ag)v._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const v of this.va().lights)v.isEnabled()&&v.canAffectMesh(this)&&this._lightSources.push(v);this._markSubMeshesAsLightDirty()}_resyncLightSource(v){const y=v.isEnabled()&&v.canAffectMesh(this),n=this._lightSources.indexOf(v);let B=!1;if(-1===n){if(!y)return;this._lightSources.push(v)}else{if(y)return;B=!0,this._lightSources.splice(n,1)}this._markSubMeshesAsLightDirty(B)}_unBindEffect(){for(const v of this.Ag)v.setEffect(null)}_removeLightSource(v,y){const n=this._lightSources.indexOf(v);-1!==n&&(this._lightSources.splice(n,1),this._markSubMeshesAsLightDirty(y))}_markSubMeshesAsDirty(v){if(this.Ag)for(const y of this.Ag)for(let n=0;n<y._drawWrappers.length;++n){const B=y._drawWrappers[n];B&&B.defines&&B.defines.markAllAsDirty&&v(B.defines)}}_markSubMeshesAsLightDirty(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((y=>y.markAsLightDirty(v)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((v=>v.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((v=>v.markAsMiscDirty()))}eh(v){return this._currentRenderId=Number.MAX_VALUE,super.eh(v),this._isDirty=!0,this}resetDrawCache(v){if(this.Ag)for(const y of this.Ag)y.resetDrawCache(v)}get isBlocked(){return!1}getLOD(v){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}wg(){return null}getVerticesData(v){return null}Ga(v,y,n,B){return this}updateVerticesData(v,y,n,B){return this}setIndices(v,y){return this}isVerticesDataPresent(v){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(v){return this._boundingInfo=v,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(v,y,n){return this._boundingInfo=new Z.c(v,y,n),this._boundingInfo}normalizeToUnitCube(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(v,y,n)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(b.i.MatricesIndicesKind)&&this.isVerticesDataPresent(b.i.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(v){}_activate(v,y){return this._renderId=v,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===l.e.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(v,y,n){return this.position.addInPlace(this.calcMovePOV(v,y,n)),this}calcMovePOV(v,y,n){const B=new P.d;(this.rotationQuaternion?this.rotationQuaternion:P.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(B);const J=P.n.Zero(),b=this.definedFacingForward?-1:1;return P.n.TransformCoordinatesFromFloatsToRef(v*b,y,n*b,B,J),J}rotatePOV(v,y,n){return this.rotation.addInPlace(this.calcRotatePOV(v,y,n)),this}calcRotatePOV(v,y,n){const B=this.definedFacingForward?1:-1;return new P.n(v*B,y,n*B)}Fa(v,y){if(v){const n=(0,i.f)(v,0,this.getTotalVertices(),y);this._boundingInfo?this._boundingInfo.reConstruct(n.minimum,n.maximum):this._boundingInfo=new Z.c(n.minimum,n.maximum)}if(this.Ag)for(let n=0;n<this.Ag.length;n++)this.Ag[n].refreshBoundingInfo(v);this.Ea()}_refreshBoundingInfoDirect(v){if(this._boundingInfo?this._boundingInfo.reConstruct(v.minimum,v.maximum):this._boundingInfo=new Z.c(v.minimum,v.maximum),this.Ag)for(let y=0;y<this.Ag.length;y++)this.Ag[y].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(v,y,n,B,J,Y,l){!function(v,y,n,B,J,Y,l){const a=P.i.o[0],Z=P.i.Matrix[0],x=P.i.Matrix[1],f=y===b.i.NormalKind?P.n.TransformNormalFromFloatsToRef:P.n.TransformCoordinatesFromFloatsToRef;for(let b=0,N=0;b<v.length;b+=3,N+=4){let y,i;for(Z.reset(),y=0;y<4;y++)i=J[N+y],i>0&&(P.d.FromFloat32ArrayToRefScaled(n,Math.floor(16*B[N+y]),i,x),Z.addToSelf(x));if(Y&&l)for(y=0;y<4;y++)i=l[N+y],i>0&&(P.d.FromFloat32ArrayToRefScaled(n,Math.floor(16*Y[N+y]),i,x),Z.addToSelf(x));f(v[b],v[b+1],v[b+2],Z,a),a.toArray(v,b)}}(v,y,n,B,J,Y,l)}_getData(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.i.PositionKind;const B=v.cache,J=v=>{if(B){const y=B._vertexData||(B._vertexData={});return y[v]||this.copyVerticesData(v,y),y[v]}return this.getVerticesData(v)};if(y||(y=J(n)),!y)return null;if(B?(B._outputData?B._outputData.set(y):B._outputData=new Float32Array(y),y=B._outputData):(v.applyMorph&&this.morphTargetManager||v.applySkeleton&&this.skeleton)&&(y=y.slice()),v.applyMorph&&this.morphTargetManager&&function(v,y,n){let B=null;switch(y){case b.i.PositionKind:B=v=>v.getPositions();break;case b.i.NormalKind:B=v=>v.getNormals();break;case b.i.TangentKind:B=v=>v.getTangents();break;case b.i.UVKind:B=v=>v.getUVs();break;default:return}for(let J=0;J<v.length;J++){let y=v[J];for(let P=0;P<n.numTargets;P++){const b=n.getTarget(P),Y=b.influence;if(0!==Y){const n=B(b);n&&(y+=(n[J]-v[J])*Y)}}v[J]=y}}(y,n,this.morphTargetManager),v.applySkeleton&&this.skeleton){const v=J(b.i.MatricesIndicesKind),B=J(b.i.MatricesWeightsKind);if(B&&v){const P=this.numBoneInfluencers>4,Y=P?J(b.i.MatricesIndicesExtraKind):null,l=P?J(b.i.MatricesWeightsExtraKind):null,a=this.skeleton.getTransformMatrices(this);u._ApplySkeleton(y,n,a,v,B,Y,l)}}if(!1!==v.updatePositionsArray&&n===b.i.PositionKind){const v=this._internalAbstractMeshDataInfo._positions||[],n=v.length;if(v.length=y.length/3,n<v.length)for(let y=n;y<v.length;y++)v[y]=new P.n;for(let B=0,J=0;B<v.length;B++,J+=3)v[B].Ae(y[J],y[J+1],y[J+2]);this._internalAbstractMeshDataInfo._positions=v}return y}getNormalsData(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:v,applyMorph:y,updatePositionsArray:!1},null,b.i.NormalKind)}le(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:v,applyMorph:y,updatePositionsArray:!1},n,b.i.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new Z.c(P.n.Zero(),P.n.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(v){if(!this.Ag)return this;const y=this.Ag.length;for(let n=0;n<y;n++){const B=this.Ag[n];(y>1||!B.IsGlobal)&&B.updateBoundingInfo(v)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(v){return this.getBoundingInfo().isInFrustum(v,this.Ri)}isCompletelyInFrustum(v){return this.getBoundingInfo().isCompletelyInFrustum(v)}intersectsMesh(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;const B=this.getBoundingInfo(),J=v.getBoundingInfo();if(B.intersects(J,y))return!0;if(n)for(const P of this.getChildMeshes())if(P.intersectsMesh(v,y,!0))return!0;return!1}intersectsPoint(v){return this.getBoundingInfo().intersectsPoint(v)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(v){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=v}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(v){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const y=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=y.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,y.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,v,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(v,y,n){var B;if(this._generatePointsArray(),!this._positions)return this;if(!v._lastColliderWorldVertices||!v._lastColliderTransformMatrix.equals(y)){v._lastColliderTransformMatrix=y.clone(),v._lastColliderWorldVertices=[],v._trianglePlanes=[];const n=v.verticesStart,B=v.verticesStart+v.verticesCount;for(let J=n;J<B;J++)v._lastColliderWorldVertices.push(P.n.TransformCoordinates(this._positions[J],y))}return n._collide(v._trianglePlanes,v._lastColliderWorldVertices,this.wg(),v.indexStart,v.indexStart+v.indexCount,v.verticesStart,!!v.Ha(),this,this._shouldConvertRHS(),7===(null===(B=v.Ha())||void 0===B?void 0:B.fillMode)),this}_processCollisionsForSubMeshes(v,y){const n=this._scene.getCollidingSubMeshCandidates(this,v),B=n.length;for(let J=0;J<B;J++){const P=n.data[J];B>1&&!P._checkCollision(v)||this._collideForSubMesh(P,y,v)}return this}_shouldConvertRHS(){return!1}_checkCollision(v){if(!this.getBoundingInfo()._checkCollision(v))return this;const y=P.i.Matrix[0],n=P.i.Matrix[1];return P.d.ScalingToRef(1/v._radius.x,1/v._radius.y,1/v._radius.z,y),this.worldMatrixFromCache.multiplyToRef(y,n),this._processCollisionsForSubMeshes(v,n),this}_generatePointsArray(){return!1}intersects(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=new a.c,l=this.getClassName(),Z="InstancedLinesMesh"===l||"LinesMesh"===l||"GreasedLineMesh"===l?this.intersectionThreshold:0,x=this.getBoundingInfo();if(!this.Ag)return Y;if(!b&&(!v.intersectsSphere(x.boundingSphere,Z)||!v.intersectsBox(x.boundingBox,Z)))return Y;if(B)return Y.hit=!b,Y.pickedMesh=b?null:this,Y.distance=b?0:P.n.Distance(v.origin,x.boundingSphere.center),Y.subMeshId=0,Y;if(!this._generatePointsArray())return Y;let f=null;const N=this._scene.getIntersectingSubMeshCandidates(this,v),i=N.length;let g=!1;for(let P=0;P<i;P++){const v=N.data[P].Ha();if(v&&(7==v.fillMode||0==v.fillMode||1==v.fillMode||2==v.fillMode||4==v.fillMode)){g=!0;break}}if(!g)return Y.hit=!0,Y.pickedMesh=this,Y.distance=P.n.Distance(v.origin,x.boundingSphere.center),Y.subMeshId=-1,Y;for(let P=0;P<i;P++){const B=N.data[P];if(i>1&&!b&&!B.canIntersects(v))continue;const J=B.intersects(v,this._positions,this.wg(),y,n);if(J&&(y||!f||J.distance<f.distance)&&(f=J,f.subMeshId=P,y))break}if(f){const y=J??this.getWorldMatrix(),n=P.i.o[0],B=P.i.o[1];P.n.TransformCoordinatesToRef(v.origin,y,n),v.direction.scaleToRef(f.distance,B);const b=P.n.TransformNormal(B,y).addInPlace(n);return Y.hit=!0,Y.distance=P.n.Distance(n,b),Y.pickedPoint=b,Y.pickedMesh=this,Y.bu=f.bu||0,Y.bv=f.bv||0,Y.subMeshFaceId=f.faceId,Y.faceId=f.faceId+N.data[f.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),Y.subMeshId=f.subMeshId,Y}return Y}clone(v,y,n){return null}releaseSubMeshes(){if(this.Ag)for(;this.Ag.length;)this.Ag[0].dispose();else this.Ag=[];return this}dispose(v){let y,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const B=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),B.freeActiveMeshes(),B.freeRenderingGroups(),B.renderingManager.maintainStateBetweenFrames&&B.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((v=>v!==this&&v.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),y=0;y<this._intersectionsInProgress.length;y++){const v=this._intersectionsInProgress[y],n=v._intersectionsInProgress.indexOf(this);v._intersectionsInProgress.splice(n,1)}this._intersectionsInProgress.length=0;B.lights.forEach((v=>{let y=v.includedOnlyMeshes.indexOf(this);-1!==y&&v.includedOnlyMeshes.splice(y,1),y=v.excludedMeshes.indexOf(this),-1!==y&&v.excludedMeshes.splice(y,1);const n=v.getShadowGenerators();if(n){const v=n.values();for(let n=v.next();!0!==n.done;n=v.next()){const v=n.value.getShadowMap();v&&v.renderList&&(y=v.renderList.indexOf(this),-1!==y&&v.renderList.splice(y,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const J=B.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,J.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),J.wipeCaches(),B.sd(this),this._parentContainer){const v=this._parentContainer.meshes.indexOf(this);v>-1&&this._parentContainer.meshes.splice(v,1),this._parentContainer=null}if(n&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!v)for(y=0;y<B.Ej.length;y++)B.Ej[y].j===this&&(B.Ej[y].dispose(),y--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(v,n)}_initFacetData(){const v=this._internalAbstractMeshDataInfo._facetData;v.facetNormals||(v.facetNormals=[]),v.facetPositions||(v.facetPositions=[]),v.facetPartitioning||(v.facetPartitioning=new Array),v.facetNb=this.wg().length/3|0,v.partitioningSubdivisions=v.partitioningSubdivisions?v.partitioningSubdivisions:10,v.partitioningBBoxRatio=v.partitioningBBoxRatio?v.partitioningBBoxRatio:1.01;for(let y=0;y<v.facetNb;y++)v.facetNormals[y]=P.n.Zero(),v.facetPositions[y]=P.n.Zero();return v.facetDataEnabled=!0,this}updateFacetData(){const v=this._internalAbstractMeshDataInfo._facetData;v.facetDataEnabled||this._initFacetData();const y=this.getVerticesData(b.i.PositionKind),n=this.wg(),B=this.getVerticesData(b.i.NormalKind),J=this.getBoundingInfo();if(v.facetDepthSort&&!v.facetDepthSortEnabled){if(v.facetDepthSortEnabled=!0,n instanceof Uint16Array)v.depthSortedIndices=new Uint16Array(n);else if(n instanceof Uint32Array)v.depthSortedIndices=new Uint32Array(n);else{let y=!1;for(let v=0;v<n.length;v++)if(n[v]>65535){y=!0;break}v.depthSortedIndices=y?new Uint32Array(n):new Uint16Array(n)}if(v.facetDepthSortFunction=function(v,y){return y.sqDistance-v.sqDistance},!v.facetDepthSortFrom){const y=this.va().activeCamera;v.facetDepthSortFrom=y?y.position:P.n.Zero()}v.depthSortedFacets=[];for(let y=0;y<v.facetNb;y++){const n={ind:3*y,sqDistance:0};v.depthSortedFacets.push(n)}v.invertedMatrix=P.d.Identity(),v.facetDepthSortOrigin=P.n.Zero()}v.bbSize.x=J.maximum.x-J.minimum.x>c.b?J.maximum.x-J.minimum.x:c.b,v.bbSize.y=J.maximum.y-J.minimum.y>c.b?J.maximum.y-J.minimum.y:c.b,v.bbSize.z=J.maximum.z-J.minimum.z>c.b?J.maximum.z-J.minimum.z:c.b;let l=v.bbSize.x>v.bbSize.y?v.bbSize.x:v.bbSize.y;if(l=l>v.bbSize.z?l:v.bbSize.z,v.subDiv.max=v.partitioningSubdivisions,v.subDiv.X=Math.floor(v.subDiv.max*v.bbSize.x/l),v.subDiv.Y=Math.floor(v.subDiv.max*v.bbSize.y/l),v.subDiv.Z=Math.floor(v.subDiv.max*v.bbSize.z/l),v.subDiv.X=v.subDiv.X<1?1:v.subDiv.X,v.subDiv.Y=v.subDiv.Y<1?1:v.subDiv.Y,v.subDiv.Z=v.subDiv.Z<1?1:v.subDiv.Z,v.facetParameters.facetNormals=this.getFacetLocalNormals(),v.facetParameters.facetPositions=this.getFacetLocalPositions(),v.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),v.facetParameters.bInfo=J,v.facetParameters.bbSize=v.bbSize,v.facetParameters.subDiv=v.subDiv,v.facetParameters.ratio=this.partitioningBBoxRatio,v.facetParameters.depthSort=v.facetDepthSort,v.facetDepthSort&&v.facetDepthSortEnabled&&(this.ak(!0),this._worldMatrix.invertToRef(v.invertedMatrix),P.n.TransformCoordinatesToRef(v.facetDepthSortFrom,v.invertedMatrix,v.facetDepthSortOrigin),v.facetParameters.distanceTo=v.facetDepthSortOrigin),v.facetParameters.depthSortedFacets=v.depthSortedFacets,B&&Y.e.ComputeNormals(y,n,B,v.facetParameters),v.facetDepthSort&&v.facetDepthSortEnabled){v.depthSortedFacets.sort(v.facetDepthSortFunction);const y=v.depthSortedIndices.length/3|0;for(let B=0;B<y;B++){const y=v.depthSortedFacets[B].ind;v.depthSortedIndices[3*B]=n[y],v.depthSortedIndices[3*B+1]=n[y+1],v.depthSortedIndices[3*B+2]=n[y+2]}this.updateIndices(v.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const v=this._internalAbstractMeshDataInfo._facetData;return v.facetNormals||this.updateFacetData(),v.facetNormals}getFacetLocalPositions(){const v=this._internalAbstractMeshDataInfo._facetData;return v.facetPositions||this.updateFacetData(),v.facetPositions}getFacetLocalPartitioning(){const v=this._internalAbstractMeshDataInfo._facetData;return v.facetPartitioning||this.updateFacetData(),v.facetPartitioning}getFacetPosition(v){const y=P.n.Zero();return this.getFacetPositionToRef(v,y),y}getFacetPositionToRef(v,y){const n=this.getFacetLocalPositions()[v],B=this.getWorldMatrix();return P.n.TransformCoordinatesToRef(n,B,y),this}getFacetNormal(v){const y=P.n.Zero();return this.getFacetNormalToRef(v,y),y}getFacetNormalToRef(v,y){const n=this.getFacetLocalNormals()[v];return P.n.TransformNormalToRef(n,this.getWorldMatrix(),y),this}getFacetsAtLocalCoordinates(v,y,n){const B=this.getBoundingInfo(),J=this._internalAbstractMeshDataInfo._facetData,P=Math.floor((v-B.minimum.x*J.partitioningBBoxRatio)*J.subDiv.X*J.partitioningBBoxRatio/J.bbSize.x),b=Math.floor((y-B.minimum.y*J.partitioningBBoxRatio)*J.subDiv.Y*J.partitioningBBoxRatio/J.bbSize.y),Y=Math.floor((n-B.minimum.z*J.partitioningBBoxRatio)*J.subDiv.Z*J.partitioningBBoxRatio/J.bbSize.z);return P<0||P>J.subDiv.max||b<0||b>J.subDiv.max||Y<0||Y>J.subDiv.max?null:J.facetPartitioning[P+J.subDiv.max*b+J.subDiv.max*J.subDiv.max*Y]}getClosestFacetAtCoordinates(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]&&arguments[4],b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const Y=this.getWorldMatrix(),l=P.i.Matrix[5];Y.invertToRef(l);const a=P.i.o[8];P.n.TransformCoordinatesFromFloatsToRef(v,y,n,l,a);const Z=this.getClosestFacetAtLocalCoordinates(a.x,a.y,a.z,B,J,b);return B&&P.n.TransformCoordinatesFromFloatsToRef(B.x,B.y,B.z,Y,B),Z}getClosestFacetAtLocalCoordinates(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]&&arguments[4],P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],b=null,Y=0,l=0,a=0,Z=0,x=0,f=0,N=0,i=0;const g=this.getFacetLocalPositions(),c=this.getFacetLocalNormals(),h=this.getFacetsAtLocalCoordinates(v,y,n);if(!h)return null;let E,W,s,C=Number.MAX_VALUE,r=C;for(let u=0;u<h.length;u++)E=h[u],W=c[E],s=g[E],Z=(v-s.x)*W.x+(y-s.y)*W.y+(n-s.z)*W.z,(!J||J&&P&&Z>=0||J&&!P&&Z<=0)&&(Z=W.x*s.x+W.y*s.y+W.z*s.z,x=-(W.x*v+W.y*y+W.z*n-Z)/(W.x*W.x+W.y*W.y+W.z*W.z),f=v+W.x*x,N=y+W.y*x,i=n+W.z*x,Y=f-v,l=N-y,a=i-n,r=Y*Y+l*l+a*a,r<C&&(C=r,b=E,B&&(B.x=f,B.y=N,B.z=i)));return b}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const v=this._internalAbstractMeshDataInfo._facetData;return v.facetDataEnabled&&(v.facetDataEnabled=!1,v.facetPositions=[],v.facetNormals=[],v.facetPartitioning=new Array,v.facetParameters=null,v.depthSortedIndices=new Uint32Array(0)),this}updateIndices(v,y){return this}createNormals(v){const y=this.getVerticesData(b.i.PositionKind),n=this.wg();let B;return B=this.isVerticesDataPresent(b.i.NormalKind)?this.getVerticesData(b.i.NormalKind):[],Y.e.ComputeNormals(y,n,B,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(b.i.NormalKind,B,v),this}alignWithNormal(v,y){y||(y=h.c.Y);const n=P.i.o[0],B=P.i.o[1];return P.n.CrossToRef(y,v,B),P.n.CrossToRef(v,B,n),this.rotationQuaternion?P.g.RotationQuaternionFromAxisToRef(n,v,B,this.rotationQuaternion):P.n.RotationFromAxisToRef(n,v,B,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,N.e)("EdgesRenderer")}enableEdgesRendering(v,y,n){throw(0,N.e)("EdgesRenderer")}Fj(){return this._scene.Ej.filter((v=>v.j===this))}}u.OCCLUSION_TYPE_NONE=0,u.OCCLUSION_TYPE_OPTIMISTIC=1,u.OCCLUSION_TYPE_STRICT=2,u.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,u.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,u.CULLINGSTRATEGY_STANDARD=0,u.Si=1,u.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,u.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,B.c)([W.g.filter((function(){for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];let[B,J,P,b,Y]=y;return!Array.isArray(B)&&!Array.isArray(J)&&!Array.isArray(P)&&!Array.isArray(b)&&!Array.isArray(Y)}))],u,"_ApplySkeleton",null),(0,E.g)("BABYLON.AbstractMesh",u)},11367:(v,y,n)=>{"use strict";n.d(y,{b:()=>c});var B=n(11081),J=n(11103),P=n(11362),b=n(11127),Y=n(11202),l=n(11374),a=n(11216),Z=n(10791),x=n(11076),f=n(11242),N=n(10820),i=n(11295),g=n(10801);class c{get boundingBias(){return this._boundingBias}set boundingBias(v){this._boundingBias?this._boundingBias.p(v):this._boundingBias=v.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(v){const y=new c(c.RandomId(),v.va());return y.Ca(v),y}get meshes(){return this._meshes}constructor(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=y||N.b.LastCreatedScene,this._scene&&(this.id=v,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=B,n?this.setAllVerticesData(n,B):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),J&&(this.Ca(J),J.ak(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let v=0;v<this._meshes.length;v++)if(!this._meshes[v].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const v=new Set;for(const y in this._vertexBuffers)v.add(this._vertexBuffers[y].getWrapperBuffer());v.forEach((v=>{v._rebuild()}))}setAllVerticesData(v,y){v.applyToGeometry(this,y),this._notifyUpdate()}Ga(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;n&&Array.isArray(y)&&(y=new Float32Array(y));const J=new b.i(this._engine,y,v,{updatable:n,postponeInternalCreation:0===this._meshes.length,stride:B,label:"Geometry_"+this.id+"_"+v});this.setVerticesBuffer(J)}removeVerticesData(v){this._vertexBuffers[v]&&(this._vertexBuffers[v].dispose(),delete this._vertexBuffers[v]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const J=v.getKind();this._vertexBuffers[J]&&n&&this._vertexBuffers[J].dispose(),v._buffer&&v._buffer._increaseReferences(),this._vertexBuffers[J]=v;const P=this._meshes,Y=P.length;if(J===b.i.PositionKind){this._totalVertices=y??v._maxVerticesCount,this._updateExtend(v.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const n=this._extend&&this._extend.minimum||new B.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),J=this._extend&&this._extend.maximum||new B.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let v=0;v<Y;v++){const y=P[v];y.buildBoundingInfo(n,J),y._createGlobalSubMesh(y.isUnIndexed),y.ak(!0),y.synchronizeInstances()}}this._notifyUpdate(J)}updateVerticesDataDirectly(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const J=this.getVertexBuffer(v);J&&(J.updateDirectly(y,n,B),this._notifyUpdate(v))}updateVerticesData(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=this.getVertexBuffer(v);B&&(B.update(y),v===b.i.PositionKind&&this.Ea(n,y),this._notifyUpdate(v))}Ea(v,y){if(v&&this._updateExtend(y),this._resetPointsArrayCache(),v){const v=this._meshes;for(const y of v){y.hasBoundingInfo?y.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):y.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const v=y.Ag;for(const y of v)y.refreshBoundingInfo()}}}_bind(v,y,n,B){if(!v)return;void 0===y&&(y=this._indexBuffer);const J=this.getVertexBuffers();if(!J)return;if(y!=this._indexBuffer||!this._vertexArrayObjects&&!B)return void this._engine.bindBuffers(J,y,v,n);const P=B||this._vertexArrayObjects,b=this._engine;P[v.key]||(P[v.key]=b.recordVertexArrayObject(J,y,v,n)),b.bindVertexArrayObject(P[v.key],y)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(v,y,n){const B=this.getVertexBuffer(v);return B?B.getFloatData(this._totalVertices,n||y&&1!==this._meshes.length):null}copyVerticesData(v,y){const n=this.getVertexBuffer(v);if(!n)return;y[v]||(y[v]=new Float32Array(this._totalVertices*n.getSize()));const B=n.getData();B&&function(v,y,n,B,J,P,Y,l){const a=y*b.i.GetTypeByteLength(n),Z=Y*y;if(l.length!==Z)throw new Error("Output length is not valid");if(n===b.i.FLOAT&&J===a)if(v instanceof Array){const y=B/4;l.set(v,y)}else if(v instanceof ArrayBuffer){const y=new Float32Array(v,B,Z);l.set(y)}else{const y=v.byteOffset+B;if(y%4)return g.e.Warn("CopyFloatData: copied misaligned data."),void l.set(new Float32Array(v.buffer.slice(y,y+4*Z)));const n=new Float32Array(v.buffer,y,Z);l.set(n)}else b.i.ForEach(v,B,J,y,n,Z,P,((v,y)=>l[y]=v))}(B,n.getSize(),n.type,n.byteOffset,n.byteStride,n.normalized,this._totalVertices,y[v])}isVertexBufferUpdatable(v){const y=this._vertexBuffers[v];return!!y&&y.isUpdatable()}getVertexBuffer(v){return this.isReady()?this._vertexBuffers[v]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(v){return this._vertexBuffers?void 0!==this._vertexBuffers[v]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(v)}getVerticesDataKinds(){const v=[];let y;if(!this._vertexBuffers&&this._delayInfo)for(y in this._delayInfo)v.push(y);else for(y in this._vertexBuffers)v.push(y);return v}updateIndices(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const B=v.length!==this._indices.length;if(n||(this._indices=v.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,v,y),B)for(const v of this._meshes)v._createGlobalSubMesh(!0)}else this.setIndices(v,null,!0)}setIndexBuffer(v,y,n){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=v,this._totalVertices=y,this._totalIndices=n,v.is32Bits||(v.is32Bits=this._totalIndices>65535);for(const B of this._meshes)B._createGlobalSubMesh(!0),B.synchronizeInstances();this._notifyUpdate()}setIndices(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=v,this._indexBufferIsUpdatable=n,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,n,"Geometry_"+this.id+"_IndexBuffer")),void 0!=y&&(this._totalVertices=y);for(const J of this._meshes)J._createGlobalSubMesh(!B),J.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}wg(v,y){if(!this.isReady())return null;const n=this._indices;return y||v&&1!==this._meshes.length?n.slice():n}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;v&&this._vertexArrayObjects&&this._vertexArrayObjects[v.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[v.key]),delete this._vertexArrayObjects[v.key])}releaseForMesh(v,y){const n=this._meshes,B=n.indexOf(v);-1!==B&&(n.splice(B,1),this._vertexArrayObjects&&v._invalidateInstanceVertexArrayObject(),v._geometry=null,0===n.length&&y&&this.dispose())}Ca(v){if(v._geometry===this)return;const y=v._geometry;y&&y.releaseForMesh(v),this._vertexArrayObjects&&v._invalidateInstanceVertexArrayObject();const n=this._meshes;v._geometry=this,v._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),n.push(v),this.isReady()?this._applyToMesh(v):this._boundingInfo&&v.setBoundingInfo(this._boundingInfo)}_updateExtend(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!v&&(v=this.getVerticesData(b.i.PositionKind),!v))return;this._extend=(0,f.f)(v,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(v){const y=this._meshes.length;for(const n in this._vertexBuffers)1===y&&this._vertexBuffers[n].create(),n===b.i.PositionKind&&(this._extend||this._updateExtend(),v.buildBoundingInfo(this._extend.minimum,this._extend.maximum),v._createGlobalSubMesh(v.isUnIndexed),v.Ea());1===y&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),v._syncGeometryWithMorphTargetManager(),v.synchronizeInstances()}_notifyUpdate(v){this.onGeometryUpdated&&this.onGeometryUpdated(this,v),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const y of this._meshes)y._markSubMeshesAsAttributesDirty()}load(v,y){2!==this.delayLoadState&&(this.isReady()?y&&y():(this.delayLoadState=2,this._queueLoad(v,y)))}_queueLoad(v,y){this.delayLoadingFile&&(v.addPendingData(this),v._loadFile(this.delayLoadingFile,(n=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(n),this),this.delayLoadState=1,this._delayInfo=[],v.removePendingData(this);const B=this._meshes,J=B.length;for(let v=0;v<J;v++)this._applyToMesh(B[v]);y&&y()}),void 0,!0))}toLeftHanded(){const v=this.wg(!1);if(null!=v&&v.length>0){for(let y=0;y<v.length;y+=3){const n=v[y+0];v[y+0]=v[y+2],v[y+2]=n}this.setIndices(v)}const y=this.getVerticesData(b.i.PositionKind,!1);if(null!=y&&y.length>0){for(let v=0;v<y.length;v+=3)y[v+2]=-y[v+2];this.Ga(b.i.PositionKind,y,!1)}const n=this.getVerticesData(b.i.NormalKind,!1);if(null!=n&&n.length>0){for(let v=0;v<n.length;v+=3)n[v+2]=-n[v+2];this.Ga(b.i.NormalKind,n,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const v=this.getVerticesData(b.i.PositionKind);if(!v||0===v.length)return!1;for(let y=3*this._positionsCache.length,n=this._positionsCache.length;y<v.length;y+=3,++n)this._positionsCache[n]=B.n.qh(v,y);for(let y=0,n=0;y<v.length;y+=3,++n)this._positionsCache[n].set(v[0+y],v[1+y],v[2+y]);return this._positionsCache.length=v.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const n in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[n]);this._vertexArrayObjects={};const v=this._meshes,y=v.length;for(let n=0;n<y;n++)v[n]._invalidateInstanceVertexArrayObject()}}dispose(){const v=this._meshes,y=v.length;let n;for(n=0;n<y;n++)this.releaseForMesh(v[n]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const B in this._vertexBuffers)this._vertexBuffers[B].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const v=this._parentContainer.geometries.indexOf(this);v>-1&&this._parentContainer.geometries.splice(v,1),this._parentContainer=null}this._isDisposed=!0}i(v){const y=new P.e;y.indices=[];const n=this.wg();if(n)for(let P=0;P<n.length;P++)y.indices.push(n[P]);let B,J=!1,b=!1;for(B in this._vertexBuffers){const v=this.getVerticesData(B);if(v&&(v instanceof Float32Array?y.set(new Float32Array(v),B):y.set(v.slice(0),B),!b)){const v=this.getVertexBuffer(B);v&&(J=v.isUpdatable(),b=!J)}}const Y=new c(v,this._scene,y,J);for(B in Y.delayLoadState=this.delayLoadState,Y.delayLoadingFile=this.delayLoadingFile,Y._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)Y._delayInfo=Y._delayInfo||[],Y._delayInfo.push(B);return Y._boundingInfo=new a.c(this._extend.minimum,this._extend.maximum),Y}serialize(){const v={};return v.id=this.id,v.uniqueId=this.uniqueId,v.updatable=this._updatable,x.c&&x.c.HasTags(this)&&(v.tags=x.c.GetTags(this)),v}_toNumberArray(v){return Array.isArray(v)?v:Array.prototype.slice.call(v)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const v in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,v)&&(this._vertexBuffers[v]._buffer._data=null)}serializeVerticeData(){const v=this.serialize();return this.isVerticesDataPresent(b.i.PositionKind)&&(v.xa=this._toNumberArray(this.getVerticesData(b.i.PositionKind)),this.isVertexBufferUpdatable(b.i.PositionKind)&&(v.xa._updatable=!0)),this.isVerticesDataPresent(b.i.NormalKind)&&(v.ya=this._toNumberArray(this.getVerticesData(b.i.NormalKind)),this.isVertexBufferUpdatable(b.i.NormalKind)&&(v.ya._updatable=!0)),this.isVerticesDataPresent(b.i.TangentKind)&&(v.tangents=this._toNumberArray(this.getVerticesData(b.i.TangentKind)),this.isVertexBufferUpdatable(b.i.TangentKind)&&(v.tangents._updatable=!0)),this.isVerticesDataPresent(b.i.UVKind)&&(v.Aa=this._toNumberArray(this.getVerticesData(b.i.UVKind)),this.isVertexBufferUpdatable(b.i.UVKind)&&(v.Aa._updatable=!0)),this.isVerticesDataPresent(b.i.UV2Kind)&&(v.uvs2=this._toNumberArray(this.getVerticesData(b.i.UV2Kind)),this.isVertexBufferUpdatable(b.i.UV2Kind)&&(v.uvs2._updatable=!0)),this.isVerticesDataPresent(b.i.UV3Kind)&&(v.uvs3=this._toNumberArray(this.getVerticesData(b.i.UV3Kind)),this.isVertexBufferUpdatable(b.i.UV3Kind)&&(v.uvs3._updatable=!0)),this.isVerticesDataPresent(b.i.UV4Kind)&&(v.uvs4=this._toNumberArray(this.getVerticesData(b.i.UV4Kind)),this.isVertexBufferUpdatable(b.i.UV4Kind)&&(v.uvs4._updatable=!0)),this.isVerticesDataPresent(b.i.UV5Kind)&&(v.uvs5=this._toNumberArray(this.getVerticesData(b.i.UV5Kind)),this.isVertexBufferUpdatable(b.i.UV5Kind)&&(v.uvs5._updatable=!0)),this.isVerticesDataPresent(b.i.UV6Kind)&&(v.uvs6=this._toNumberArray(this.getVerticesData(b.i.UV6Kind)),this.isVertexBufferUpdatable(b.i.UV6Kind)&&(v.uvs6._updatable=!0)),this.isVerticesDataPresent(b.i.ColorKind)&&(v.za=this._toNumberArray(this.getVerticesData(b.i.ColorKind)),this.isVertexBufferUpdatable(b.i.ColorKind)&&(v.za._updatable=!0)),this.isVerticesDataPresent(b.i.MatricesIndicesKind)&&(v.matricesIndices=this._toNumberArray(this.getVerticesData(b.i.MatricesIndicesKind)),v.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(b.i.MatricesIndicesKind)&&(v.matricesIndices._updatable=!0)),this.isVerticesDataPresent(b.i.MatricesWeightsKind)&&(v.matricesWeights=this._toNumberArray(this.getVerticesData(b.i.MatricesWeightsKind)),this.isVertexBufferUpdatable(b.i.MatricesWeightsKind)&&(v.matricesWeights._updatable=!0)),v.indices=this._toNumberArray(this.wg()),v}static ExtractFromMesh(v,y){const n=v._geometry;return n?n.i(y):null}static RandomId(){return Z.g.RandomId()}static _GetGeometryByLoadedUniqueId(v,y){for(let n=0;n<y.geometries.length;n++)if(y.geometries[n]._loadedUniqueId===v)return y.geometries[n];return null}static _ImportGeometry(v,y){const n=y.va(),B=v.geometryUniqueId,P=v.geometryId;if(B||P){const v=B?this._GetGeometryByLoadedUniqueId(B,n):n.getGeometryById(P);v&&v.Ca(y)}else if(v instanceof ArrayBuffer){const n=y._binaryInfo;if(n.positionsAttrDesc&&n.positionsAttrDesc.count>0){const B=new Float32Array(v,n.positionsAttrDesc.offset,n.positionsAttrDesc.count);y.Ga(b.i.PositionKind,B,!1)}if(n.normalsAttrDesc&&n.normalsAttrDesc.count>0){const B=new Float32Array(v,n.normalsAttrDesc.offset,n.normalsAttrDesc.count);y.Ga(b.i.NormalKind,B,!1)}if(n.tangetsAttrDesc&&n.tangetsAttrDesc.count>0){const B=new Float32Array(v,n.tangetsAttrDesc.offset,n.tangetsAttrDesc.count);y.Ga(b.i.TangentKind,B,!1)}if(n.uvsAttrDesc&&n.uvsAttrDesc.count>0){const B=new Float32Array(v,n.uvsAttrDesc.offset,n.uvsAttrDesc.count);if(i.e)for(let v=1;v<B.length;v+=2)B[v]=1-B[v];y.Ga(b.i.UVKind,B,!1)}if(n.uvs2AttrDesc&&n.uvs2AttrDesc.count>0){const B=new Float32Array(v,n.uvs2AttrDesc.offset,n.uvs2AttrDesc.count);if(i.e)for(let v=1;v<B.length;v+=2)B[v]=1-B[v];y.Ga(b.i.UV2Kind,B,!1)}if(n.uvs3AttrDesc&&n.uvs3AttrDesc.count>0){const B=new Float32Array(v,n.uvs3AttrDesc.offset,n.uvs3AttrDesc.count);if(i.e)for(let v=1;v<B.length;v+=2)B[v]=1-B[v];y.Ga(b.i.UV3Kind,B,!1)}if(n.uvs4AttrDesc&&n.uvs4AttrDesc.count>0){const B=new Float32Array(v,n.uvs4AttrDesc.offset,n.uvs4AttrDesc.count);if(i.e)for(let v=1;v<B.length;v+=2)B[v]=1-B[v];y.Ga(b.i.UV4Kind,B,!1)}if(n.uvs5AttrDesc&&n.uvs5AttrDesc.count>0){const B=new Float32Array(v,n.uvs5AttrDesc.offset,n.uvs5AttrDesc.count);if(i.e)for(let v=1;v<B.length;v+=2)B[v]=1-B[v];y.Ga(b.i.UV5Kind,B,!1)}if(n.uvs6AttrDesc&&n.uvs6AttrDesc.count>0){const B=new Float32Array(v,n.uvs6AttrDesc.offset,n.uvs6AttrDesc.count);if(i.e)for(let v=1;v<B.length;v+=2)B[v]=1-B[v];y.Ga(b.i.UV6Kind,B,!1)}if(n.colorsAttrDesc&&n.colorsAttrDesc.count>0){const B=new Float32Array(v,n.colorsAttrDesc.offset,n.colorsAttrDesc.count);y.Ga(b.i.ColorKind,B,!1,n.colorsAttrDesc.stride)}if(n.matricesIndicesAttrDesc&&n.matricesIndicesAttrDesc.count>0){const B=new Int32Array(v,n.matricesIndicesAttrDesc.offset,n.matricesIndicesAttrDesc.count),J=[];for(let v=0;v<B.length;v++){const y=B[v];J.push(255&y),J.push((65280&y)>>8),J.push((16711680&y)>>16),J.push(y>>24&255)}y.Ga(b.i.MatricesIndicesKind,J,!1)}if(n.matricesIndicesExtraAttrDesc&&n.matricesIndicesExtraAttrDesc.count>0){const B=new Int32Array(v,n.matricesIndicesExtraAttrDesc.offset,n.matricesIndicesExtraAttrDesc.count),J=[];for(let v=0;v<B.length;v++){const y=B[v];J.push(255&y),J.push((65280&y)>>8),J.push((16711680&y)>>16),J.push(y>>24&255)}y.Ga(b.i.MatricesIndicesExtraKind,J,!1)}if(n.matricesWeightsAttrDesc&&n.matricesWeightsAttrDesc.count>0){const B=new Float32Array(v,n.matricesWeightsAttrDesc.offset,n.matricesWeightsAttrDesc.count);y.Ga(b.i.MatricesWeightsKind,B,!1)}if(n.indicesAttrDesc&&n.indicesAttrDesc.count>0){const B=new Int32Array(v,n.indicesAttrDesc.offset,n.indicesAttrDesc.count);y.setIndices(B,null)}if(n.subMeshesAttrDesc&&n.subMeshesAttrDesc.count>0){const B=new Int32Array(v,n.subMeshesAttrDesc.offset,5*n.subMeshesAttrDesc.count);y.Ag=[];for(let v=0;v<n.subMeshesAttrDesc.count;v++){const n=B[5*v+0],J=B[5*v+1],P=B[5*v+2],b=B[5*v+3],l=B[5*v+4];Y.d.AddToMesh(n,J,P,b,l,y)}}}else if(v.xa&&v.ya&&v.indices){if(y.Ga(b.i.PositionKind,v.xa,v.xa._updatable),y.Ga(b.i.NormalKind,v.ya,v.ya._updatable),v.tangents&&y.Ga(b.i.TangentKind,v.tangents,v.tangents._updatable),v.Aa&&y.Ga(b.i.UVKind,v.Aa,v.Aa._updatable),v.uvs2&&y.Ga(b.i.UV2Kind,v.uvs2,v.uvs2._updatable),v.uvs3&&y.Ga(b.i.UV3Kind,v.uvs3,v.uvs3._updatable),v.uvs4&&y.Ga(b.i.UV4Kind,v.uvs4,v.uvs4._updatable),v.uvs5&&y.Ga(b.i.UV5Kind,v.uvs5,v.uvs5._updatable),v.uvs6&&y.Ga(b.i.UV6Kind,v.uvs6,v.uvs6._updatable),v.za&&y.Ga(b.i.ColorKind,J.e.CheckColors4(v.za,v.xa.length/3),v.za._updatable),v.matricesIndices)if(v.matricesIndices._isExpanded)delete v.matricesIndices._isExpanded,y.Ga(b.i.MatricesIndicesKind,v.matricesIndices,v.matricesIndices._updatable);else{const n=[];for(let y=0;y<v.matricesIndices.length;y++){const B=v.matricesIndices[y];n.push(255&B),n.push((65280&B)>>8),n.push((16711680&B)>>16),n.push(B>>24&255)}y.Ga(b.i.MatricesIndicesKind,n,v.matricesIndices._updatable)}if(v.matricesIndicesExtra)if(v.matricesIndicesExtra._isExpanded)delete v.matricesIndices._isExpanded,y.Ga(b.i.MatricesIndicesExtraKind,v.matricesIndicesExtra,v.matricesIndicesExtra._updatable);else{const n=[];for(let y=0;y<v.matricesIndicesExtra.length;y++){const B=v.matricesIndicesExtra[y];n.push(255&B),n.push((65280&B)>>8),n.push((16711680&B)>>16),n.push(B>>24&255)}y.Ga(b.i.MatricesIndicesExtraKind,n,v.matricesIndicesExtra._updatable)}v.matricesWeights&&(c._CleanMatricesWeights(v,y),y.Ga(b.i.MatricesWeightsKind,v.matricesWeights,v.matricesWeights._updatable)),v.matricesWeightsExtra&&y.Ga(b.i.MatricesWeightsExtraKind,v.matricesWeightsExtra,v.matricesWeights._updatable),y.setIndices(v.indices,null)}if(v.Ag){y.Ag=[];for(let n=0;n<v.Ag.length;n++){const B=v.Ag[n];Y.d.AddToMesh(B.materialIndex,B.verticesStart,B.verticesCount,B.indexStart,B.indexCount,y)}}y._shouldGenerateFlatShading&&(y.convertToFlatShadedMesh(),y._shouldGenerateFlatShading=!1),y.ak(!0),n.onMeshImportedObservable.notifyObservers(y)}static _CleanMatricesWeights(v,y){const n=.001;if(!l.c.CleanBoneMatrixWeights)return;let B=0;if(!(v.skeletonId>-1))return;{const n=y.va().getLastSkeletonById(v.skeletonId);if(!n)return;B=n.bones.length}const J=y.getVerticesData(b.i.MatricesIndicesKind),P=y.getVerticesData(b.i.MatricesIndicesExtraKind),Y=v.matricesWeights,a=v.matricesWeightsExtra,Z=v.numBoneInfluencer,x=Y.length;for(let b=0;b<x;b+=4){let v=0,y=-1;for(let B=0;B<4;B++){const J=Y[b+B];v+=J,J<n&&y<0&&(y=B)}if(a)for(let B=0;B<4;B++){const J=a[b+B];v+=J,J<n&&y<0&&(y=B+4)}if((y<0||y>Z-1)&&(y=Z-1),v>n){const y=1/v;for(let v=0;v<4;v++)Y[b+v]*=y;if(a)for(let v=0;v<4;v++)a[b+v]*=y}else y>=4?(a[b+y-4]=1-v,P[b+y-4]=B):(Y[b+y]=1-v,J[b+y]=B)}y.Ga(b.i.MatricesIndicesKind,J),v.matricesWeightsExtra&&y.Ga(b.i.MatricesIndicesExtraKind,P)}static Parse(v,y,n){const J=new c(v.id,y,void 0,v.updatable);return J._loadedUniqueId=v.uniqueId,x.c&&x.c.AddTagsTo(J,v.tags),v.delayLoadingFile?(J.delayLoadState=4,J.delayLoadingFile=n+v.delayLoadingFile,J._boundingInfo=new a.c(B.n.qh(v.boundingBoxMinimum),B.n.qh(v.boundingBoxMaximum)),J._delayInfo=[],v.hasUVs&&J._delayInfo.push(b.i.UVKind),v.hasUVs2&&J._delayInfo.push(b.i.UV2Kind),v.hasUVs3&&J._delayInfo.push(b.i.UV3Kind),v.hasUVs4&&J._delayInfo.push(b.i.UV4Kind),v.hasUVs5&&J._delayInfo.push(b.i.UV5Kind),v.hasUVs6&&J._delayInfo.push(b.i.UV6Kind),v.hasColors&&J._delayInfo.push(b.i.ColorKind),v.hasMatricesIndices&&J._delayInfo.push(b.i.MatricesIndicesKind),v.hasMatricesWeights&&J._delayInfo.push(b.i.MatricesWeightsKind),J._delayLoadingFunction=P.e.ImportVertexData):P.e.ImportVertexData(v,J),y.pushGeometry(J,!0),J}}},12303:(v,y,n)=>{"use strict";n.d(y,{d:()=>f});var B=n(11081),J=n(10801),P=n(11383),b=n(11338),Y=n(10803),l=n(11387),a=n(11127),Z=n(10791),x=n(10908);b.d._instancedMeshFactory=(v,y)=>{const n=new f(v,y);if(y.instancedBuffers){n.instancedBuffers={};for(const v in y.instancedBuffers)n.instancedBuffers[v]=y.instancedBuffers[v]}return n};class f extends P.d{constructor(v,y){super(v,y.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,y.Uj(this),this._sourceMesh=y,this._unIndexed=y._unIndexed,this.position.p(y.position),this.rotation.p(y.rotation),this.Be.p(y.Be),y.rotationQuaternion&&(this.rotationQuaternion=y.rotationQuaternion.clone()),this.animations=y.animations.slice();for(const n of y.getAnimationRanges())null!=n&&this.createAnimationRange(n.name,n.from,n.to);this.infiniteDistance=y.infiniteDistance,this.setPivotMatrix(y.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(v){var y;(null===(y=this._sourceMesh)||void 0===y?void 0:y.receiveShadows)!==v&&Z.g.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(v){var y;(null===(y=this._sourceMesh)||void 0===y?void 0:y.material)!==v&&Z.g.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(v){var y;(null===(y=this._sourceMesh)||void 0===y?void 0:y.visibility)!==v&&Z.g.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(v){var y;(null===(y=this._sourceMesh)||void 0===y?void 0:y.skeleton)!==v&&Z.g.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(v){this._sourceMesh&&v!==this._sourceMesh.renderingGroupId&&J.e.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(v){return this._sourceMesh.createInstance(v)}isReady(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(v,!0)}getVerticesData(v,y,n){return this._sourceMesh.getVerticesData(v,y,n)}copyVerticesData(v,y){this._sourceMesh.copyVerticesData(v,y)}Ga(v,y,n,B){return this.sourceMesh&&this.sourceMesh.Ga(v,y,n,B),this.sourceMesh}updateVerticesData(v,y,n,B){return this.sourceMesh&&this.sourceMesh.updateVerticesData(v,y,n,B),this.sourceMesh}setIndices(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(v,y),this.sourceMesh}isVerticesDataPresent(v){return this._sourceMesh.isVerticesDataPresent(v)}wg(){return this._sourceMesh.wg()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let v,y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;v="object"===typeof y?y:{applySkeleton:y,applyMorph:n};const B=this._sourceMesh.Rj?this._sourceMesh.Rj.boundingBias:null;return this.Fa(this._sourceMesh._getData(v,null,a.i.PositionKind),B),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(v,y){if(super._activate(v,y),this._sourceMesh.Ag||J.e.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,v),y){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==l.e.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new B.d);const v=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,B.i.o[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.ak(!0)),this._currentLOD.position.p(B.i.o[7]),this._currentLOD._masterMesh=v,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(v){if(!v)return this;const y=this.sourceMesh.getLODLevels();if(y&&0!==y.length){const y=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(v,y.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(v){return this.sourceMesh._preActivateForIntermediateRendering(v)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.Ag)for(let v=0;v<this._sourceMesh.Ag.length;v++)this._sourceMesh.Ag[v].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;const B=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(v);if(Y.c.DeepCopy(this,B,["name","Ag","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Dj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),y&&(B.parent=y),!n)for(let J=0;J<this.va().meshes.length;J++){const v=this.va().meshes[J];v.parent===this&&v.clone(v.name,B)}return B.ak(!0),this.onClonedObservable.notifyObservers(B),B}dispose(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Tj(this),super.dispose(v,y)}_serializeAsParent(v){super._serializeAsParent(v),v.parentId=this._sourceMesh.uniqueId,v.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,y=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;const B=this.clone("Clone of "+(this.name||this.id),v||this.parent,!0,y&&y.newSourcedMesh);B&&n&&n(this,B);for(const J of this.getChildTransformNodes(!0))J.instantiateHierarchy(B,y,n);return B}}b.d.prototype.registerInstancedBuffer=function(v,y){var n,B;if(null===(n=this._userInstancedBuffersStorage)||void 0===n||null===(B=n.vertexBuffers[v])||void 0===B||B.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const v of this.instances)v.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[v]=null,this._userInstancedBuffersStorage.strides[v]=y,this._userInstancedBuffersStorage.sizes[v]=32*y,this._userInstancedBuffersStorage.data[v]=new Float32Array(this._userInstancedBuffersStorage.sizes[v]),this._userInstancedBuffersStorage.vertexBuffers[v]=new a.i(this.getEngine(),this._userInstancedBuffersStorage.data[v],v,!0,!1,y,!0);for(const J of this.instances)J.instancedBuffers[v]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},b.d.prototype._processInstancedBuffers=function(v,y){const n=v?v.length:0;for(const B in this.instancedBuffers){let J=this._userInstancedBuffersStorage.sizes[B];const P=this._userInstancedBuffersStorage.strides[B],b=(n+1)*P;for(;J<b;)J*=2;this._userInstancedBuffersStorage.data[B].length!=J&&(this._userInstancedBuffersStorage.data[B]=new Float32Array(J),this._userInstancedBuffersStorage.sizes[B]=J,this._userInstancedBuffersStorage.vertexBuffers[B]&&(this._userInstancedBuffersStorage.vertexBuffers[B].dispose(),this._userInstancedBuffersStorage.vertexBuffers[B]=null));const Y=this._userInstancedBuffersStorage.data[B];let l=0;if(y){const v=this.instancedBuffers[B];v.toArray?v.toArray(Y,l):v.copyToArray?v.copyToArray(Y,l):Y[l]=v,l+=P}for(let y=0;y<n;y++){const n=v[y].instancedBuffers[B];n.toArray?n.toArray(Y,l):n.copyToArray?n.copyToArray(Y,l):Y[l]=n,l+=P}this._userInstancedBuffersStorage.vertexBuffers[B]?this._userInstancedBuffersStorage.vertexBuffers[B].updateDirectly(Y,0):(this._userInstancedBuffersStorage.vertexBuffers[B]=new a.i(this.getEngine(),this._userInstancedBuffersStorage.data[B],B,!0,!1,P,!0),this._invalidateInstanceVertexArrayObject())}},b.d.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const v in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[v]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},b.d.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const v in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[v]&&this._userInstancedBuffersStorage.vertexBuffers[v].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,x.g)("BABYLON.InstancedMesh",f)},11338:(v,y,n)=>{"use strict";n.d(y,{d:()=>F,h:()=>q});var B=n(10795),J=n(10791),P=n(10803),b=n(11076),Y=n(11345),l=n(11348),a=n(11081),Z=n(11103),x=n(11351),f=n(11127),N=n(11362),i=n(11367),g=n(11383),c=n(11202),h=n(11200),E=n(11398),W=n(11374),s=n(11110),C=n(10801),r=n(10908),u=n(10811),O=n(11149);class d{constructor(v,y){this.distanceOrScreenCoverage=v,this.mesh=y}}class q{}class L{constructor(){this.visibleInstances={},this.batchCache=new t,this.batchCacheReplacementModeInFrozenMode=new t,this.instancesBufferSize=2048}}class t{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class G{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class R{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class F extends g.d{static _GetDefaultSideOrientation(v){return v||F.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(v){this._internalMeshDataInfo._useLODScreenCoverage=v,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(v){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==v&&(v&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(f.i.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(f.i.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=v,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new B.e),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new B.e),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new B.e),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new B.e),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new B.e),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(v){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(v)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(v){this._internalMeshDataInfo._forcedInstanceCount=v}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(v){this._internalMeshDataInfo._sideOrientation=v,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===v||!this._scene.useRightHandedSystem&&0===v}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(v){this.sideOrientation=v,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(v){this._internalMeshDataInfo._overrideRenderingFillMode=v}get material(){return this._internalAbstractMeshDataInfo._material}set material(v){v&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(v.sideOrientation=null),this._setMaterial(v)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(v){this._unIndexed!==v&&(this._unIndexed=v,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(v){this._instanceDataStorage.manualUpdate=v}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(v){this._instanceDataStorage.previousManualUpdate=v}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(v){this._instanceDataStorage.forceMatrixUpdates=v}_copySource(v,y){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const B=this.va();if(v._geometry&&v._geometry.Ca(this),P.c.DeepCopy(v,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Rj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Dj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=v,B.useClonedMeshMap&&(v._internalMeshDataInfo.meshMap||(v._internalMeshDataInfo.meshMap={}),v._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=v._originalBuilderSideOrientation,this._creationDataStorage=v._creationDataStorage,v._ranges){const y=v._ranges;for(const v in y)Object.prototype.hasOwnProperty.call(y,v)&&y[v]&&this.createAnimationRange(v,y[v].from,y[v].to)}if(v.metadata&&v.metadata.clone?this.metadata=v.metadata.clone():this.metadata=v.metadata,this._internalMetadata=v._internalMetadata,b.c&&b.c.HasTags(v)&&b.c.AddTagsTo(this,b.c.GetTags(v,!0)),this.Nb(v.isEnabled(!1)),this.parent=v.parent,this.setPivotMatrix(v.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+v.id,this.material=v.material,!y){const y=v.getDescendants(!0);for(let v=0;v<y.length;v++){const n=y[v];n.clone&&n.clone(this.name+"."+n.name,this)}}if(v.morphTargetManager&&(this.morphTargetManager=v.morphTargetManager),B.getPhysicsEngine){const y=B.getPhysicsEngine();if(n&&y)if(1===y.getPluginVersion()){const n=y.getImpostorForPhysicsObject(v);n&&(this.physicsImpostor=n.clone(this))}else 2===y.getPluginVersion()&&v.physicsBody&&v.physicsBody.clone(this)}for(let J=0;J<B.Ej.length;J++){const y=B.Ej[J];y.j===v&&y.clone(y.name,this)}this.skeleton=v.skeleton,this.refreshBoundingInfo(!0,!0),this.ak(!0)}constructor(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4?arguments[4]:void 0,b=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(v,y),this._internalMeshDataInfo=new R,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new L,this._thinInstanceDataStorage=new G,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=F.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,y=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(v,y,n)=>{v&&n&&(this._uniformBuffer?this.transferToEffect(y):n.bindOnlyWorldMatrix(y))},J&&this._copySource(J,P,b),null!==n&&(this.parent=n),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=v=>{v.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new B.e(this._internalMeshDataInfo._onMeshReadyObserverAdded),J&&J.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,y=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;const B=0===this.getTotalVertices()||y&&y.doNotInstantiate&&(!0===y.doNotInstantiate||y.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),v||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));B.parent=v||this.parent,B.position=this.position.clone(),B.Be=this.Be.clone(),this.rotationQuaternion?B.rotationQuaternion=this.rotationQuaternion.clone():B.rotation=this.rotation.clone(),n&&n(this,B);for(const J of this.getChildTransformNodes(!0))"InstancedMesh"===J.getClassName()&&"Mesh"===B.getClassName()&&J.sourceMesh===this?J.instantiateHierarchy(B,{doNotInstantiate:y&&y.doNotInstantiate||!1,newSourcedMesh:B},n):J.instantiateHierarchy(B,y,n);return B}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(v){let y=super.toString(v);if(y+=", n vertices: "+this.getTotalVertices(),y+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let n=0;n<this.animations.length;n++)y+=", animation[0]: "+this.animations[n].toString(v);if(v)if(this._geometry){const v=this.wg(),n=this.getVerticesData(f.i.PositionKind);n&&v&&(y+=", flat shading: "+(n.length/3===v.length?"YES":"NO"))}else y+=", flat shading: UNKNOWN";return y}_unBindEffect(){super._unBindEffect();for(const v of this.instances)v._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const v=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((y,n)=>y.distanceOrScreenCoverage<n.distanceOrScreenCoverage?v:y.distanceOrScreenCoverage>n.distanceOrScreenCoverage?-v:0))}addLODLevel(v,y){if(y&&y._masterMesh)return C.e.Warn("You cannot use a mesh as LOD level twice"),this;const n=new d(v,y);return this._internalMeshDataInfo._LODLevels.push(n),y&&(y._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(v){const y=this._internalMeshDataInfo;for(let n=0;n<y._LODLevels.length;n++){const B=y._LODLevels[n];if(B.distanceOrScreenCoverage===v)return B.mesh}return null}removeLODLevel(v){const y=this._internalMeshDataInfo;for(let n=0;n<y._LODLevels.length;n++)y._LODLevels[n].mesh===v&&(y._LODLevels.splice(n,1),v&&(v._masterMesh=null));return this._sortLODLevels(),this}getLOD(v,y){const n=this._internalMeshDataInfo;if(!n._LODLevels||0===n._LODLevels.length)return this;const B=y||this.getBoundingInfo().boundingSphere,J=v.mode===l.c.ORTHOGRAPHIC_CAMERA?v.ij:B.centerWorld.od(v.globalPosition).length();let P=J,b=1;if(n._useLODScreenCoverage){const y=v.screenArea;let n=B.radiusWorld*v.ij/J;n=n*n*Math.PI,P=n/y,b=-1}if(b*n._LODLevels[n._LODLevels.length-1].distanceOrScreenCoverage>b*P)return this.onLODLevelSelection&&this.onLODLevelSelection(P,this,this),this;for(let Y=0;Y<n._LODLevels.length;Y++){const v=n._LODLevels[Y];if(b*v.distanceOrScreenCoverage<b*P){if(v.mesh){if(4===v.mesh.delayLoadState)return v.mesh._checkDelayState(),this;if(2===v.mesh.delayLoadState)return this;v.mesh._preActivate(),v.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(P,this,v.mesh),v.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(P,this,this),this}get Rj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(v,y,n,B){var J,P;if(!this._geometry)return null;let b=B||null===(J=this._userInstancedBuffersStorage)||void 0===J||null===(P=J.vertexBuffers[v])||void 0===P?void 0:P.getFloatData(this.instances.length+1,n||y&&1!==this._geometry.meshes.length);return b||(b=this._geometry.getVerticesData(v,y,n)),b}copyVerticesData(v,y){this._geometry&&this._geometry.copyVerticesData(v,y)}getVertexBuffer(v,y){var n;return this._geometry?(y||null===(n=this._userInstancedBuffersStorage)||void 0===n?void 0:n.vertexBuffers[v])??this._geometry.getVertexBuffer(v):null}isVerticesDataPresent(v,y){var n;return this._geometry?!y&&void 0!==(null===(n=this._userInstancedBuffersStorage)||void 0===n?void 0:n.vertexBuffers[v])||this._geometry.isVerticesDataPresent(v):!!this._delayInfo&&-1!==this._delayInfo.indexOf(v)}isVertexBufferUpdatable(v,y){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(v);if(!y){var n;const y=null===(n=this._userInstancedBuffersStorage)||void 0===n?void 0:n.vertexBuffers[v];if(y)return y.isUpdatable()}return this._geometry.isVertexBufferUpdatable(v)}getVerticesDataKinds(v){if(!this._geometry){const v=[];return this._delayInfo&&this._delayInfo.forEach((function(y){v.push(y)})),v}const y=this._geometry.getVerticesDataKinds();if(!v&&this._userInstancedBuffersStorage)for(const n in this._userInstancedBuffersStorage.vertexBuffers)-1===y.indexOf(n)&&y.push(n);return y}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}wg(v,y){return this._geometry?this._geometry.wg(v,y):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(v))return!1;if(!this.Ag||0===this.Ag.length)return!0;if(!v)return!0;const n=this.getEngine(),B=this.va(),J=y||n.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.ak();const P=this.material||B.defaultMaterial;if(P)if(P._storeEffectOnSubMeshes)for(const f of this.Ag){const v=f.Ha();if(v)if(v._storeEffectOnSubMeshes){if(!v.isReadyForSubMesh(this,f,J))return!1}else if(!v.isReady(this,J))return!1}else if(!P.isReady(this,J))return!1;const b=n.currentRenderPassId;for(const f of this.lightSources){const v=f.getShadowGenerators();if(!v)continue;const y=v.values();for(let B=y.next();!0!==B.done;B=y.next()){var Y,l,a,Z;const v=B.value;if(v&&(null===(Y=v.getShadowMap())||void 0===Y||!Y.renderList||null!==(l=v.getShadowMap())&&void 0!==l&&l.renderList&&-1!==(null===(a=v.getShadowMap())||void 0===a||null===(Z=a.renderList)||void 0===Z?void 0:Z.indexOf(this)))){const y=v.getShadowMap().renderPassIds??[n.currentRenderPassId];for(let B=0;B<y.length;++B){n.currentRenderPassId=y[B];for(const y of this.Ag){var x;if(!v.isReady(y,J,(null===(x=y.Ha())||void 0===x?void 0:x.needAlphaBlendingForMesh(this))??!1))return n.currentRenderPassId=b,!1}}n.currentRenderPassId=b}}}for(const f of this._internalMeshDataInfo._LODLevels)if(f.mesh&&!f.mesh.isReady(J))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}ai(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(v){this._instanceDataStorage.overridenInstanceCount=v}_preActivate(){const v=this._internalMeshDataInfo,y=this.va().getRenderId();return v._preActivateId===y||(v._preActivateId=y,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(v){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=v),this}_registerInstanceForRenderId(v,y){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:y,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[y]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=y,this._instanceDataStorage.visibleInstances[y]=new Array),this._instanceDataStorage.visibleInstances[y].push(v),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let v,y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;v="object"===typeof y?y:{applySkeleton:y,applyMorph:n};const B=this.Rj?this.Rj.boundingBias:null;return this.Fa(this._getData(v,null,f.i.PositionKind),B),this}_createGlobalSubMesh(v){const y=this.getTotalVertices();if(!y||!this.wg())return null;if(this.Ag&&this.Ag.length>0){const n=this.wg();if(!n)return null;const B=n.length;let J=!1;if(v)J=!0;else for(const v of this.Ag){if(v.indexStart+v.indexCount>B){J=!0;break}if(v.verticesStart+v.verticesCount>y){J=!0;break}}if(!J)return this.Ag[0]}return this.releaseSubMeshes(),new c.d(0,0,y,0,this.getTotalIndices(),this)}subdivide(v){if(v<1)return;const y=this.getTotalIndices();let n=y/v|0,B=0;for(;n%3!==0;)n++;this.releaseSubMeshes();for(let J=0;J<v&&!(B>=y);J++)c.d.CreateFromIndices(0,B,J===v-1?y-B:n,this,void 0,!1),B+=n;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(v,y,n,B);else{const B=new N.e;B.set(y,v);const J=this.va();new i.b(i.b.RandomId(),J,B,n,this)}return this}removeVerticesData(v){this._geometry&&this._geometry.removeVerticesData(v)}markVerticesDataAsUpdatable(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.getVertexBuffer(v);n&&n.isUpdatable()!==y&&this.Ga(v,this.getVerticesData(v),y)}setVerticesBuffer(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=i.b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(v,null,y),this}updateVerticesData(v,y,n,B){return this._geometry?(B?(this.makeGeometryUnique(),this.updateVerticesData(v,y,n,!1)):this._geometry.updateVerticesData(v,y,n),this):this}updateMeshPositions(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.getVerticesData(f.i.PositionKind);if(!n)return this;if(v(n),this.updateVerticesData(f.i.PositionKind,n,!1,!1),y){const v=this.wg(),y=this.getVerticesData(f.i.NormalKind);if(!y)return this;N.e.ComputeNormals(n,v,y),this.updateVerticesData(f.i.NormalKind,y,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const v=this._geometry,y=this._geometry.i(i.b.RandomId());return v.releaseForMesh(this,!0),y.Ca(this),this}setIndexBuffer(v,y,n){let B=this._geometry;B||(B=new i.b(i.b.RandomId(),this.va(),void 0,void 0,this)),B.setIndexBuffer(v,y,n)}setIndices(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(v,y,n,B);else{const y=new N.e;y.indices=v;const B=this.va();new i.b(i.b.RandomId(),B,y,n,this)}return this}updateIndices(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(v,y,n),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(v,y,n){let B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const J=this.va().getEngine();let P;if(this._unIndexed)if(this._getRenderingFillMode(n)===h.d.WireFrameFillMode)P=v._getLinesIndexBuffer(this.wg(),J);else P=null;else switch(this._getRenderingFillMode(n)){case h.d.PointFillMode:P=null;break;case h.d.WireFrameFillMode:P=v._getLinesIndexBuffer(this.wg(),J);break;default:case h.d.TriangleFillMode:P=this._geometry.getIndexBuffer()}return this._bindDirect(y,P,B)}_bindDirect(v,y){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(v),n&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(v,y,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(v,y),this):this}_draw(v,y,n){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const B=this.va().getEngine();return this._unIndexed&&y!==h.d.WireFrameFillMode||y==h.d.PointFillMode?B.drawArraysType(y,v.verticesStart,v.verticesCount,this.forcedInstanceCount||n):y==h.d.WireFrameFillMode?B.drawElementsType(y,0,v._linesIndexCount,this.forcedInstanceCount||n):B.drawElementsType(y,v.indexStart,v.indexCount,this.forcedInstanceCount||n),this}registerBeforeRender(v){return this.onBeforeRenderObservable.add(v),this}unregisterBeforeRender(v){return this.onBeforeRenderObservable.removeCallback(v),this}registerAfterRender(v){return this.onAfterRenderObservable.add(v),this}unregisterAfterRender(v){return this.onAfterRenderObservable.removeCallback(v),this}_getInstancesRenderList(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(y)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[v]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[v]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const n=this.va(),B=n._isInIntermediateRendering(),J=B?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,P=this._instanceDataStorage.batchCache;if(P.mustReturn=!1,P.renderSelf[v]=y||!J&&this.isEnabled()&&this.isVisible,P.visibleInstances[v]=null,this._instanceDataStorage.visibleInstances&&!y){const y=this._instanceDataStorage.visibleInstances,J=n.getRenderId(),b=B?y.intermediateDefaultRenderId:y.defaultRenderId;P.visibleInstances[v]=y[J],!P.visibleInstances[v]&&b&&(P.visibleInstances[v]=y[b])}return P.hardwareInstancedRendering[v]=!y&&this._instanceDataStorage.hardwareInstancedRendering&&null!==P.visibleInstances[v]&&void 0!==P.visibleInstances[v],this._instanceDataStorage.previousBatch=P,P}_renderWithInstances(v,y,n,B,J){const P=n.visibleInstances[v._id],b=P?P.length:0,Y=this._instanceDataStorage,l=Y.instancesBufferSize;let Z=Y.instancesBuffer,x=Y.instancesPreviousBuffer;const N=16*(b+1)*4;for(;Y.instancesBufferSize<N;)Y.instancesBufferSize*=2;Y.instancesData&&l==Y.instancesBufferSize||(Y.instancesData=new Float32Array(Y.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!Y.instancesPreviousData||l!=Y.instancesBufferSize)&&(Y.instancesPreviousData=new Float32Array(Y.instancesBufferSize/4));let i=0,g=0;const c=n.renderSelf[v._id],h=!Z||l!==Y.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!Y.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||Y.isFrozen&&!h)g=(c?1:0)+b;else{const y=this.getWorldMatrix();if(c&&(this._scene.needsPreviousWorldMatrices&&(Y.masterMeshPreviousWorldMatrix?(Y.masterMeshPreviousWorldMatrix.copyToArray(Y.instancesPreviousData,i),Y.masterMeshPreviousWorldMatrix.p(y)):(Y.masterMeshPreviousWorldMatrix=y.clone(),Y.masterMeshPreviousWorldMatrix.copyToArray(Y.instancesPreviousData,i))),y.copyToArray(Y.instancesData,i),i+=16,g++),P){var E;if(F.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(E=v.Ha())&&void 0!==E&&E.needAlphaBlendingForMesh(v.getRenderingMesh())){const v=this._scene.activeCamera.globalPosition;for(let y=0;y<P.length;y++){const n=P[y];n._distanceToCamera=a.n.Distance(n.getBoundingInfo().boundingSphere.centerWorld,v)}P.sort(((v,y)=>v._distanceToCamera>y._distanceToCamera?-1:v._distanceToCamera<y._distanceToCamera?1:0))}for(let v=0;v<P.length;v++){const y=P[v],n=y.getWorldMatrix();n.copyToArray(Y.instancesData,i),this._scene.needsPreviousWorldMatrices&&(y._previousWorldMatrix?(y._previousWorldMatrix.copyToArray(Y.instancesPreviousData,i),y._previousWorldMatrix.p(n)):(y._previousWorldMatrix=n.clone(),y._previousWorldMatrix.copyToArray(Y.instancesPreviousData,i))),i+=16,g++}}}return h?(Z&&Z.dispose(),x&&x.dispose(),Z=new f.e(J,Y.instancesData,!0,16,!1,!0),Y.instancesBuffer=Z,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=Z.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=Z.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=Z.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=Z.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(x=new f.e(J,Y.instancesPreviousData,!0,16,!1,!0),Y.instancesPreviousBuffer=x,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=x.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=x.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=x.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=x.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(Z.updateDirectly(Y.instancesData,0,g),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||x.updateDirectly(Y.instancesPreviousData,0,g)),this._processInstancedBuffers(P,c),this.va()._activeIndices.addCount(v.indexCount*g,!1),J._currentDrawContext&&(J._currentDrawContext.useInstancing=!0),this._bind(v,B,y),this._draw(v,y,g),!this._scene.needsPreviousWorldMatrices||h||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||x.updateDirectly(Y.instancesData,0,g),J.unbindInstanceAttributes(),this}_renderWithThinInstances(v,y,n,B){var J;const P=(null===(J=this._thinInstanceDataStorage)||void 0===J?void 0:J.instancesCount)??0;this.va()._activeIndices.addCount(v.indexCount*P,!1),B._currentDrawContext&&(B._currentDrawContext.useInstancing=!0),this._bind(v,n,y),this._draw(v,y,P),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,P):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),B.unbindInstanceAttributes()}_processInstancedBuffers(v,y){}_processRendering(v,y,n,B,J,P,b,Y){const l=this.va(),a=l.getEngine();if(B=this._getRenderingFillMode(B),P&&y.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(y,B,n,a),this;if(P)this._renderWithInstances(y,B,J,n,a);else{a._currentDrawContext&&(a._currentDrawContext.useInstancing=!1);let n=0;J.renderSelf[y._id]&&(b&&b(!1,v.getWorldMatrix(),Y),n++,this._draw(y,B,this._instanceDataStorage.overridenInstanceCount));const P=J.visibleInstances[y._id];if(P){const v=P.length;n+=v;for(let n=0;n<v;n++){const v=P[n].getWorldMatrix();b&&b(!0,v,Y),this._draw(y,B)}}l._activeIndices.addCount(y.indexCount*n,!1)}return this}_rebuild(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(v&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const y in this._userInstancedBuffersStorage.vertexBuffers){const n=this._userInstancedBuffersStorage.vertexBuffers[y];n&&(v&&n.dispose(),this._userInstancedBuffersStorage.vertexBuffers[y]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(v)}_freeze(){if(this.Ag){for(let v=0;v<this.Ag.length;v++)this._getInstancesRenderList(v);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(v,y,n,B){let J=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const P=this._scene.getEngine(),b=P.currentRenderPassId;if(void 0!==v&&(P.currentRenderPassId=v),B)(!J||J&&B.isInFrustum(this._scene._frustumPlanes))&&this.render(B,!!y,n);else for(let Y=0;Y<this.Ag.length;Y++){const v=this.Ag[Y];(!J||J&&v.isInFrustum(this._scene._frustumPlanes))&&this.render(v,!!y,n)}return void 0!==v&&(P.currentRenderPassId=b),this}directRender(){if(!this.Ag)return this;for(const v of this.Ag)this.render(v,!1);return this}render(v,y,n){var B,J,P;const b=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const Y=(null===(B=b.activeCameras)||void 0===B?void 0:B.length)??0;if((Y>1&&b.activeCamera===b.activeCameras[0]||Y<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const l=this._getInstancesRenderList(v._id,!!n);if(l.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const a=b.getEngine();let Z=0,x=null;this.ignoreCameraMaxZ&&b.activeCamera&&!b._isInIntermediateRendering()&&(Z=b.activeCamera.maxZ,x=b.activeCamera,b.activeCamera.maxZ=0,b.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const f=v.getRenderingMesh(),N=l.hardwareInstancedRendering[v._id]||f.hasThinInstances||!!this._userInstancedBuffersStorage&&!v.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,i=this._instanceDataStorage,g=v.Ha();if(!g)return x&&(x.maxZ=Z,b.updateTransformMatrix(!0)),this;if(i.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===g){if(g._storeEffectOnSubMeshes&&(null===(J=v._drawWrapper)||void 0===J||!J._wasPreviouslyReady)||!g._storeEffectOnSubMeshes&&!g._getDrawWrapper()._wasPreviouslyReady)return x&&(x.maxZ=Z,b.updateTransformMatrix(!0)),this}else{if(g._storeEffectOnSubMeshes){if(!g.isReadyForSubMesh(this,v,N))return x&&(x.maxZ=Z,b.updateTransformMatrix(!0)),this}else if(!g.isReady(this,N))return x&&(x.maxZ=Z,b.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=g}let c;y&&a.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),c=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?v._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const E=(null===(P=c)||void 0===P?void 0:P.effect)??null;for(const h of b._beforeRenderingMeshStage)h.action(this,v,l,E);if(!c||!E)return x&&(x.maxZ=Z,b.updateTransformMatrix(!0)),this;const W=n||this;let s;if(i.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Ch&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)s=i.sideOrientation;else{const v=W._getWorldMatrixDeterminant();s=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),v<0&&(s=s===h.d.ClockWiseSideOrientation?h.d.CounterClockWiseSideOrientation:h.d.ClockWiseSideOrientation),i.sideOrientation=s}const C=this._internalMeshDataInfo._effectiveMaterial._preBind(c,s);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&a.setDepthWrite(!0);const r=this._internalMeshDataInfo._effectiveMaterial,u=r.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),N||this._bind(v,E,u,!1);const O=W.getWorldMatrix();r._storeEffectOnSubMeshes?r.bindForSubMesh(O,this,v):r.bind(O,this),!r.Ch&&r.separateCullingPass&&(a.setState(!0,r.zOffset,!1,!C,r.cullBackFaces,r.stencil,r.zOffsetUnits),this._processRendering(this,v,E,u,l,N,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),a.setState(!0,r.zOffset,!1,C,r.cullBackFaces,r.stencil,r.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(v)),this._processRendering(this,v,E,u,l,N,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const h of b._afterRenderingMeshStage)h.action(this,v,l,E);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),x&&(x.maxZ=Z,b.updateTransformMatrix(!0)),2!==b.performancePriority||i.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(f.i.MatricesWeightsKind)&&(this.isVerticesDataPresent(f.i.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const v=this.getVerticesData(f.i.MatricesWeightsKind),y=v.length;for(let n=0;n<y;n+=4){const y=v[n]+v[n+1]+v[n+2]+v[n+3];if(0===y)v[n]=1;else{const B=1/y;v[n]*=B,v[n+1]*=B,v[n+2]*=B,v[n+3]*=B}}this.Ga(f.i.MatricesWeightsKind,v)}_normalizeSkinWeightsAndExtra(){const v=this.getVerticesData(f.i.MatricesWeightsExtraKind),y=this.getVerticesData(f.i.MatricesWeightsKind),n=y.length;for(let B=0;B<n;B+=4){let n=y[B]+y[B+1]+y[B+2]+y[B+3];if(n+=v[B]+v[B+1]+v[B+2]+v[B+3],0===n)y[B]=1;else{const J=1/n;y[B]*=J,y[B+1]*=J,y[B+2]*=J,y[B+3]*=J,v[B]*=J,v[B+1]*=J,v[B+2]*=J,v[B+3]*=J}}this.Ga(f.i.MatricesWeightsKind,y),this.Ga(f.i.MatricesWeightsKind,v)}validateSkinning(){const v=this.getVerticesData(f.i.MatricesWeightsExtraKind),y=this.getVerticesData(f.i.MatricesWeightsKind);if(null===y||null==this.skeleton)return{skinned:!1,valid:!0,ym:"not skinned"};const n=y.length;let B=0,J=0,P=0,b=0;const Y=null===v?4:8,l=[];for(let f=0;f<=Y;f++)l[f]=0;for(let f=0;f<n;f+=4){let n=y[f],a=n,Z=0===a?0:1;for(let J=1;J<Y;J++){const P=J<4?y[f+J]:v[f+J-4];P>n&&B++,0!==P&&Z++,a+=P,n=P}if(l[Z]++,Z>P&&(P=Z),0===a)J++;else{const n=1/a;let B=0;for(let J=0;J<Y;J++)B+=J<4?Math.abs(y[f+J]-y[f+J]*n):Math.abs(v[f+J-4]-v[f+J-4]*n);B>.001&&b++}}const a=this.skeleton.bones.length,Z=this.getVerticesData(f.i.MatricesIndicesKind),x=this.getVerticesData(f.i.MatricesIndicesExtraKind);let N=0;for(let f=0;f<n;f+=4)for(let v=0;v<Y;v++){const y=v<4?Z[f+v]:x[f+v-4];(y>=a||y<0)&&N++}return{skinned:!0,valid:0===J&&0===b&&0===N,ym:"Number of Weights = "+n/4+"\nMaximum influences = "+P+"\nMissing Weights = "+J+"\nNot Sorted = "+B+"\nNot Normalized = "+b+"\nWeightCounts = ["+l+"]\nNumber of bones = "+a+"\nBad Bone Indices = "+N}}_checkDelayState(){const v=this.va();return this._geometry?this._geometry.load(v):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(v)),this}_queueLoad(v){v.addPendingData(this);const y=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return J.g.LoadFile(this.delayLoadingFile,(y=>{y instanceof ArrayBuffer?this._delayLoadingFunction(y,this):this._delayLoadingFunction(JSON.parse(y),this),this.instances.forEach((v=>{v.refreshBoundingInfo(),v._syncSubMeshes()})),this.delayLoadState=1,v.removePendingData(this)}),(()=>{}),v.offlineProvider,y),this}isInFrustum(v){return 2!==this.delayLoadState&&(!!super.isInFrustum(v)&&(this._checkDelayState(),!0))}setMaterialById(v){const y=this.va().materials;let n;for(n=y.length-1;n>-1;n--)if(y[n].id===v)return this.material=y[n],this;const B=this.va().multiMaterials;for(n=B.length-1;n>-1;n--)if(B[n].id===v)return this.material=B[n],this;return this}getAnimatables(){const v=[];return this.material&&v.push(this.material),this.skeleton&&v.push(this.skeleton),v}bakeTransformIntoVertices(v){if(!this.isVerticesDataPresent(f.i.PositionKind))return this;const y=this.Ag.splice(0);this._resetPointsArrayCache();let n=this.getVerticesData(f.i.PositionKind);const B=a.n.Zero();let J;for(J=0;J<n.length;J+=3)a.n.TransformCoordinatesFromFloatsToRef(n[J],n[J+1],n[J+2],v,B).toArray(n,J);if(this.Ga(f.i.PositionKind,n,this.getVertexBuffer(f.i.PositionKind).isUpdatable()),this.isVerticesDataPresent(f.i.NormalKind)){for(n=this.getVerticesData(f.i.NormalKind),J=0;J<n.length;J+=3)a.n.TransformNormalFromFloatsToRef(n[J],n[J+1],n[J+2],v,B).normalize().toArray(n,J);this.Ga(f.i.NormalKind,n,this.getVertexBuffer(f.i.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(f.i.TangentKind)){for(n=this.getVerticesData(f.i.TangentKind),J=0;J<n.length;J+=4)a.n.TransformNormalFromFloatsToRef(n[J],n[J+1],n[J+2],v,B).normalize().toArray(n,J);this.Ga(f.i.TangentKind,n,this.getVertexBuffer(f.i.TangentKind).isUpdatable())}return v.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.Ag=y,this}bakeCurrentTransformIntoVertices(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.ak(!0)),this.resetLocalMatrix(v),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new F(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),v,this,y,n)}dispose(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const n=this._internalMeshDataInfo;if(n._onBeforeDrawObservable&&n._onBeforeDrawObservable.clear(),n._onBeforeBindObservable&&n._onBeforeBindObservable.clear(),n._onBeforeRenderObservable&&n._onBeforeRenderObservable.clear(),n._onAfterRenderObservable&&n._onAfterRenderObservable.clear(),n._onBetweenPassObservable&&n._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(n.meshMap)for(const v in n.meshMap){const y=n.meshMap[v];y&&(y._internalMeshDataInfo._source=null,n.meshMap[v]=void 0)}n._source&&n._source._internalMeshDataInfo.meshMap&&(n._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const v=this.va().meshes;for(const y of v){const v=y;v._internalMeshDataInfo&&v._internalMeshDataInfo._source&&v._internalMeshDataInfo._source===this&&(v._internalMeshDataInfo._source=null)}}n._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(v,y)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(v,y,n,B,P,b){let Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7?arguments[7]:void 0;const a=this.va();return J.g.LoadImage(v,(v=>{const J=v.width,l=v.height,a=this.getEngine().createCanvas(J,l).getContext("2d");a.drawImage(v,0,0);const Z=a.getImageData(0,0,J,l).data;this.applyDisplacementMapFromBuffer(Z,J,l,y,n,P,b,Y),B&&B(this)}),l||(()=>{}),a.offlineProvider),this}applyDisplacementMapFromBuffer(v,y,n,B,J,P,b){let Y=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(f.i.PositionKind)||!this.isVerticesDataPresent(f.i.NormalKind)||!this.isVerticesDataPresent(f.i.UVKind))return C.e.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const l=this.getVerticesData(f.i.PositionKind,!0,!0),Z=this.getVerticesData(f.i.NormalKind),x=this.getVerticesData(f.i.UVKind);let i=a.n.Zero();const g=a.n.Zero(),c=a.j.Zero();P=P||a.j.Zero(),b=b||new a.j(1,1);for(let f=0;f<l.length;f+=3){a.n.FromArrayToRef(l,f,i),a.n.FromArrayToRef(Z,f,g),a.j.FromArrayToRef(x,f/3*2,c);const Y=4*((Math.abs(c.x*b.x+P.x%1)*(y-1)%y|0)+(Math.abs(c.y*b.y+P.y%1)*(n-1)%n|0)*y),N=.3*(v[Y]/255)+.59*(v[Y+1]/255)+.11*(v[Y+2]/255);g.normalize(),g.scaleInPlace(B+(J-B)*N),i=i.add(g),i.toArray(l,f)}return N.e.ComputeNormals(l,this.wg(),Z),Y?(this.Ga(f.i.PositionKind,l),this.Ga(f.i.NormalKind,Z),this.Ga(f.i.UVKind,x)):(this.updateVerticesData(f.i.PositionKind,l),this.updateVerticesData(f.i.NormalKind,Z)),this}_getFlattenedNormals(v,y){const n=new Float32Array(3*v.length);let B=0;const J=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let P=0;P<v.length;P+=3){const b=a.n.qh(y,3*v[P]),Y=a.n.qh(y,3*v[P+1]),l=a.n.qh(y,3*v[P+2]),Z=b.od(Y),x=l.od(Y),f=a.n.Normalize(a.n.Cross(Z,x));J&&f.scaleInPlace(-1);for(let v=0;v<3;v++)n[B++]=f.x,n[B++]=f.y,n[B++]=f.z}return n}_convertToUnIndexedMesh(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y=this.getVerticesDataKinds().filter((v=>{var y;return!(null!==(y=this.getVertexBuffer(v))&&void 0!==y&&y.getIsInstanced())})),n=this.wg(),B={},J=(v,y)=>{const B=new Float32Array(n.length*y);let J=0;for(let P=0;P<n.length;P++)for(let b=0;b<y;b++)B[J++]=v[n[P]*y+b];return B},P=this.getBoundingInfo(),b=this.Rj?this.Ag.slice(0):[];for(const Y of y)B[Y]=this.getVerticesData(Y);for(const Y of y){const y=this.getVertexBuffer(Y),P=y.getSize();if(v&&Y===f.i.NormalKind){const v=this._getFlattenedNormals(n,B[f.i.PositionKind]);this.Ga(f.i.NormalKind,v,y.isUpdatable(),P)}else this.Ga(Y,J(B[Y],P),y.isUpdatable(),P)}if(this.morphTargetManager){for(let y=0;y<this.morphTargetManager.numTargets;y++){const B=this.morphTargetManager.getTarget(y),P=B.getPositions();B.setPositions(J(P,3));const b=B.getNormals();b&&B.setNormals(v?this._getFlattenedNormals(n,P):J(b,3));const Y=B.getTangents();Y&&B.setTangents(J(Y,3));const l=B.getUVs();l&&B.setUVs(J(l,2))}this.morphTargetManager.synchronize()}for(let Y=0;Y<n.length;Y++)n[Y]=Y;this.setIndices(n),this._unIndexed=!0,this.releaseSubMeshes();for(const Y of b){const v=Y.getBoundingInfo();c.d.AddToMesh(Y.materialIndex,Y.indexStart,Y.indexCount,Y.indexStart,Y.indexCount,this).setBoundingInfo(v)}return this.setBoundingInfo(P),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y=N.e.ExtractFromMesh(this);let n;if(v&&this.isVerticesDataPresent(f.i.NormalKind)&&y.ya){for(n=0;n<y.ya.length;n++)y.ya[n]*=-1;this.Ga(f.i.NormalKind,y.ya,this.isVertexBufferUpdatable(f.i.NormalKind))}if(y.indices){let v;for(n=0;n<y.indices.length;n+=3)v=y.indices[n+1],y.indices[n+1]=y.indices[n+2],y.indices[n+2]=v;this.setIndices(y.indices,null,this.isVertexBufferUpdatable(f.i.PositionKind),!0)}return this}increaseVertices(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const y=N.e.ExtractFromMesh(this),n=y.indices&&!Array.isArray(y.indices)&&Array.from?Array.from(y.indices):y.indices,B=y.xa&&!Array.isArray(y.xa)&&Array.from?Array.from(y.xa):y.xa,J=y.Aa&&!Array.isArray(y.Aa)&&Array.from?Array.from(y.Aa):y.Aa,P=y.ya&&!Array.isArray(y.ya)&&Array.from?Array.from(y.ya):y.ya;if(n&&B){y.indices=n,y.xa=B,J&&(y.Aa=J),P&&(y.ya=P);const b=v+1,Y=new Array;for(let v=0;v<b+1;v++)Y[v]=new Array;let l,Z;const x=new a.n(0,0,0),N=new a.n(0,0,0),i=new a.j(0,0),g=new Array,c=new Array,h=new Array;let E,W,s,C=B.length;J&&(W=J.length),P&&(s=P.length);for(let v=0;v<n.length;v+=3){c[0]=n[v],c[1]=n[v+1],c[2]=n[v+2];for(let v=0;v<3;v++)if(l=c[v],Z=c[(v+1)%3],void 0===h[l]&&void 0===h[Z]?(h[l]=new Array,h[Z]=new Array):(void 0===h[l]&&(h[l]=new Array),void 0===h[Z]&&(h[Z]=new Array)),void 0===h[l][Z]&&void 0===h[Z][l]){h[l][Z]=[],x.x=(B[3*Z]-B[3*l])/b,x.y=(B[3*Z+1]-B[3*l+1])/b,x.z=(B[3*Z+2]-B[3*l+2])/b,P&&(N.x=(P[3*Z]-P[3*l])/b,N.y=(P[3*Z+1]-P[3*l+1])/b,N.z=(P[3*Z+2]-P[3*l+2])/b),J&&(i.x=(J[2*Z]-J[2*l])/b,i.y=(J[2*Z+1]-J[2*l+1])/b),h[l][Z].push(l);for(let v=1;v<b;v++)h[l][Z].push(B.length/3),B[C++]=B[3*l]+v*x.x,B[C++]=B[3*l+1]+v*x.y,B[C++]=B[3*l+2]+v*x.z,P&&(P[s++]=P[3*l]+v*N.x,P[s++]=P[3*l+1]+v*N.y,P[s++]=P[3*l+2]+v*N.z),J&&(J[W++]=J[2*l]+v*i.x,J[W++]=J[2*l+1]+v*i.y);h[l][Z].push(Z),h[Z][l]=new Array,E=h[l][Z].length;for(let v=0;v<E;v++)h[Z][l][v]=h[l][Z][E-1-v]}Y[0][0]=n[v],Y[1][0]=h[n[v]][n[v+1]][1],Y[1][1]=h[n[v]][n[v+2]][1];for(let y=2;y<b;y++){Y[y][0]=h[n[v]][n[v+1]][y],Y[y][y]=h[n[v]][n[v+2]][y],x.x=(B[3*Y[y][y]]-B[3*Y[y][0]])/y,x.y=(B[3*Y[y][y]+1]-B[3*Y[y][0]+1])/y,x.z=(B[3*Y[y][y]+2]-B[3*Y[y][0]+2])/y,P&&(N.x=(P[3*Y[y][y]]-P[3*Y[y][0]])/y,N.y=(P[3*Y[y][y]+1]-P[3*Y[y][0]+1])/y,N.z=(P[3*Y[y][y]+2]-P[3*Y[y][0]+2])/y),J&&(i.x=(J[2*Y[y][y]]-J[2*Y[y][0]])/y,i.y=(J[2*Y[y][y]+1]-J[2*Y[y][0]+1])/y);for(let v=1;v<y;v++)Y[y][v]=B.length/3,B[C++]=B[3*Y[y][0]]+v*x.x,B[C++]=B[3*Y[y][0]+1]+v*x.y,B[C++]=B[3*Y[y][0]+2]+v*x.z,P&&(P[s++]=P[3*Y[y][0]]+v*N.x,P[s++]=P[3*Y[y][0]+1]+v*N.y,P[s++]=P[3*Y[y][0]+2]+v*N.z),J&&(J[W++]=J[2*Y[y][0]]+v*i.x,J[W++]=J[2*Y[y][0]+1]+v*i.y)}Y[b]=h[n[v+1]][n[v+2]],g.push(Y[0][0],Y[1][0],Y[1][1]);for(let v=1;v<b;v++){let y;for(y=0;y<v;y++)g.push(Y[v][y],Y[v+1][y],Y[v+1][y+1]),g.push(Y[v][y],Y[v+1][y+1],Y[v][y+1]);g.push(Y[v][y],Y[v+1][y],Y[v+1][y+1])}}y.indices=g,y.Ca(this,this.isVertexBufferUpdatable(f.i.PositionKind))}else C.e.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const v=N.e.ExtractFromMesh(this),y=v.Aa,n=v.indices,B=v.xa,J=v.za,P=v.matricesIndices,b=v.matricesWeights,Y=v.matricesIndicesExtra,l=v.matricesWeightsExtra;if(void 0===n||void 0===B||null===n||null===B)C.e.Warn("VertexData contains empty entries");else{const a=new Array,Z=new Array,x=new Array,i=new Array,g=new Array,c=new Array,h=new Array,E=new Array;let W=new Array,s=0;const C={};let r,u;for(let v=0;v<n.length;v+=3){u=[n[v],n[v+1],n[v+2]],W=[];for(let v=0;v<3;v++){W[v]="";for(let y=0;y<3;y++)Math.abs(B[3*u[v]+y])<1e-8&&(B[3*u[v]+y]=0),W[v]+=B[3*u[v]+y]+"|"}if(W[0]!=W[1]&&W[0]!=W[2]&&W[1]!=W[2])for(let v=0;v<3;v++){if(r=C[W[v]],void 0===r){C[W[v]]=s,r=s++;for(let y=0;y<3;y++)a.push(B[3*u[v]+y]);if(null!==J&&void 0!==J)for(let y=0;y<4;y++)i.push(J[4*u[v]+y]);if(null!==y&&void 0!==y)for(let n=0;n<2;n++)x.push(y[2*u[v]+n]);if(null!==P&&void 0!==P)for(let y=0;y<4;y++)g.push(P[4*u[v]+y]);if(null!==b&&void 0!==b)for(let y=0;y<4;y++)c.push(b[4*u[v]+y]);if(null!==Y&&void 0!==Y)for(let y=0;y<4;y++)h.push(Y[4*u[v]+y]);if(null!==l&&void 0!==l)for(let y=0;y<4;y++)E.push(l[4*u[v]+y])}Z.push(r)}}const O=new Array;N.e.ComputeNormals(a,Z,O),v.xa=a,v.indices=Z,v.ya=O,null!==y&&void 0!==y&&(v.Aa=x),null!==J&&void 0!==J&&(v.za=i),null!==P&&void 0!==P&&(v.matricesIndices=g),null!==b&&void 0!==b&&(v.matricesWeights=c),null!==Y&&void 0!==Y&&(v.matricesIndicesExtra=h),null!==b&&void 0!==b&&(v.matricesWeightsExtra=E),v.Ca(this,this.isVertexBufferUpdatable(f.i.PositionKind))}}static _instancedMeshFactory(v,y){throw(0,u.e)("InstancedMesh")}static _PhysicsImpostorParser(v,y,n){throw(0,u.e)("PhysicsImpostor")}createInstance(v){const y=F._instancedMeshFactory(v,this);return y.parent=this.parent,y}synchronizeInstances(){for(let v=0;v<this.instances.length;v++){this.instances[v]._syncSubMeshes()}return this}optimizeIndices(v){const y=this.wg(),n=this.getVerticesData(f.i.PositionKind);if(!n||!y)return this;const B=[];for(let J=0;J<n.length;J+=3)B.push(a.n.qh(n,J));const P=[];return J.c.SyncAsyncForLoop(B.length,40,(v=>{const y=B.length-1-v,n=B[y];for(let J=0;J<y;++J){const v=B[J];if(n.equals(v)){P[y]=J;break}}}),(()=>{for(let v=0;v<y.length;++v)y[v]=P[y[v]]||y[v];const n=this.Ag.slice(0);this.setIndices(y),this.Ag=n,v&&v(this)})),this}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v.name=this.name,v.id=this.id,v.uniqueId=this.uniqueId,v.type=this.getClassName(),b.c&&b.c.HasTags(this)&&(v.tags=b.c.GetTags(this)),v.position=this.position.wj(),this.rotationQuaternion?v.rotationQuaternion=this.rotationQuaternion.wj():this.rotation&&(v.rotation=this.rotation.wj()),v.Be=this.Be.wj(),this._postMultiplyPivotMatrix?v.pivotMatrix=this.getPivotMatrix().wj():v.localMatrix=this.getPivotMatrix().wj(),v.isEnabled=this.isEnabled(!1),v.isVisible=this.isVisible,v.infiniteDistance=this.infiniteDistance,v.pickable=this.Kb,v.receiveShadows=this.receiveShadows,v.billboardMode=this.billboardMode,v.visibility=this.visibility,v.Jb=this.Jb,v.checkCollisions=this.checkCollisions,v.ellipsoid=this.ellipsoid.wj(),v.ellipsoidOffset=this.ellipsoidOffset.wj(),v.Da=this.Da,v.isBlocker=this.isBlocker,v.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(v),v.isUnIndexed=this.isUnIndexed;const y=this._geometry;if(y&&this.Ag){v.geometryUniqueId=y.uniqueId,v.geometryId=y.id,v.Ag=[];for(let y=0;y<this.Ag.length;y++){const n=this.Ag[y];v.Ag.push({materialIndex:n.materialIndex,verticesStart:n.verticesStart,verticesCount:n.verticesCount,indexStart:n.indexStart,indexCount:n.indexCount})}}if(this.material?this.material.doNotSerialize||(v.materialUniqueId=this.material.uniqueId,v.materialId=this.material.id):(this.material=null,v.materialUniqueId=this._scene.defaultMaterial.uniqueId,v.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(v.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(v.skeletonId=this.skeleton.id,v.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(O.b.NAME_PHYSICSENGINE)){const y=this.getPhysicsImpostor();y&&(v.physicsMass=y.getParam("mass"),v.physicsFriction=y.getParam("friction"),v.physicsRestitution=y.getParam("mass"),v.physicsImpostor=y.type)}this.metadata&&(v.metadata=this.metadata),v.instances=[];for(let n=0;n<this.instances.length;n++){const y=this.instances[n];if(y.doNotSerialize)continue;const B={name:y.name,id:y.id,isEnabled:y.isEnabled(!1),isVisible:y.isVisible,Kb:y.Kb,checkCollisions:y.checkCollisions,position:y.position.wj(),Be:y.Be.wj()};if(y.parent&&y.parent._serializeAsParent(B),y.rotationQuaternion?B.rotationQuaternion=y.rotationQuaternion.wj():y.rotation&&(B.rotation=y.rotation.wj()),this.va()._getComponent(O.b.NAME_PHYSICSENGINE)){const v=y.getPhysicsImpostor();v&&(B.physicsMass=v.getParam("mass"),B.physicsFriction=v.getParam("friction"),B.physicsRestitution=v.getParam("mass"),B.physicsImpostor=v.type)}y.metadata&&(B.metadata=y.metadata),y.actionManager&&(B.actions=y.actionManager.serialize(y.name)),v.instances.push(B),s.d.AppendSerializedAnimations(y,B),B.ranges=y.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(v.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const y={data:{},sizes:{},strides:{}};for(const v in this._userThinInstanceBuffersStorage.data)y.data[v]=Array.from(this._userThinInstanceBuffersStorage.data[v]),y.sizes[v]=this._userThinInstanceBuffersStorage.sizes[v],y.strides[v]=this._userThinInstanceBuffersStorage.strides[v];v.thinInstances.userThinInstance=y}return s.d.AppendSerializedAnimations(this,v),v.ranges=this.serializeAnimationRanges(),v.layerMask=this.layerMask,v.alphaIndex=this.alphaIndex,v.hasVertexAlpha=this.hasVertexAlpha,v.overlayAlpha=this.overlayAlpha,v.overlayColor=this.overlayColor.wj(),v.renderOverlay=this.renderOverlay,v.applyFog=this.applyFog,this.actionManager&&(v.actions=this.actionManager.serialize(this.name)),v}_syncGeometryWithMorphTargetManager(){if(!this.Rj)return;this._markSubMeshesAsAttributesDirty();const v=this._internalAbstractMeshDataInfo._morphTargetManager;if(v&&v.vertexCount){if(v.vertexCount!==this.getTotalVertices())return C.e.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(v.isUsingTextureForTargets)return;for(let y=0;y<v.numInfluencers;y++){const n=v.getActiveTarget(y),B=n.getPositions();if(!B)return void C.e.Error("Invalid morph target. Target must have positions.");this.Rj.Ga(f.i.PositionKind+y,B,!1,3);const J=n.getNormals();J&&this.Rj.Ga(f.i.NormalKind+y,J,!1,3);const P=n.getTangents();P&&this.Rj.Ga(f.i.TangentKind+y,P,!1,3);const b=n.getUVs();b&&this.Rj.Ga(f.i.UVKind+"_"+y,b,!1,2)}}else{let v=0;for(;this.Rj.isVerticesDataPresent(f.i.PositionKind+v);)this.Rj.removeVerticesData(f.i.PositionKind+v),this.Rj.isVerticesDataPresent(f.i.NormalKind+v)&&this.Rj.removeVerticesData(f.i.NormalKind+v),this.Rj.isVerticesDataPresent(f.i.TangentKind+v)&&this.Rj.removeVerticesData(f.i.TangentKind+v),this.Rj.isVerticesDataPresent(f.i.UVKind+v)&&this.Rj.removeVerticesData(f.i.UVKind+"_"+v),v++}}static Parse(v,y,n){let B;if(B=v.type&&"LinesMesh"===v.type?F._LinesMeshParser(v,y):v.type&&"GroundMesh"===v.type?F._GroundMeshParser(v,y):v.type&&"GoldbergMesh"===v.type?F._GoldbergMeshParser(v,y):v.type&&"GreasedLineMesh"===v.type?F._GreasedLineMeshParser(v,y):v.type&&"TrailMesh"===v.type?F._TrailMeshParser(v,y):new F(v.name,y),B.id=v.id,B._waitingParsedUniqueId=v.uniqueId,b.c&&b.c.AddTagsTo(B,v.tags),B.position=a.n.qh(v.position),void 0!==v.metadata&&(B.metadata=v.metadata),v.rotationQuaternion?B.rotationQuaternion=a.g.qh(v.rotationQuaternion):v.rotation&&(B.rotation=a.n.qh(v.rotation)),B.Be=a.n.qh(v.Be),v.localMatrix?B.setPreTransformMatrix(a.d.qh(v.localMatrix)):v.pivotMatrix&&B.setPivotMatrix(a.d.qh(v.pivotMatrix)),B.Nb(v.isEnabled),B.isVisible=v.isVisible,B.infiniteDistance=v.infiniteDistance,B.Jb=!!v.Jb,B.showBoundingBox=v.showBoundingBox,B.showSubMeshesBoundingBox=v.showSubMeshesBoundingBox,void 0!==v.applyFog&&(B.applyFog=v.applyFog),void 0!==v.pickable&&(B.Kb=v.pickable),void 0!==v.alphaIndex&&(B.alphaIndex=v.alphaIndex),B.receiveShadows=v.receiveShadows,void 0!==v.billboardMode&&(B.billboardMode=v.billboardMode),void 0!==v.visibility&&(B.visibility=v.visibility),B.checkCollisions=v.checkCollisions,B.Da=!!v.Da,v.ellipsoid&&(B.ellipsoid=a.n.qh(v.ellipsoid)),v.ellipsoidOffset&&(B.ellipsoidOffset=a.n.qh(v.ellipsoidOffset)),null!=v.overrideMaterialSideOrientation&&(B.sideOrientation=v.overrideMaterialSideOrientation),void 0!==v.sideOrientation&&(B.sideOrientation=v.sideOrientation),void 0!==v.isBlocker&&(B.isBlocker=v.isBlocker),B._shouldGenerateFlatShading=v.useFlatShading,v.Nc&&(B._waitingData.Nc=v.Nc),void 0!==v.parentId&&(B._waitingParentId=v.parentId),void 0!==v.parentInstanceIndex&&(B._waitingParentInstanceIndex=v.parentInstanceIndex),void 0!==v.actions&&(B._waitingData.actions=v.actions),void 0!==v.overlayAlpha&&(B.overlayAlpha=v.overlayAlpha),void 0!==v.overlayColor&&(B.overlayColor=Z.d.qh(v.overlayColor)),void 0!==v.renderOverlay&&(B.renderOverlay=v.renderOverlay),B.isUnIndexed=!!v.isUnIndexed,B.hasVertexAlpha=v.hasVertexAlpha,v.delayLoadingFile?(B.delayLoadState=4,B.delayLoadingFile=n+v.delayLoadingFile,B.buildBoundingInfo(a.n.qh(v.boundingBoxMinimum),a.n.qh(v.boundingBoxMaximum)),v._binaryInfo&&(B._binaryInfo=v._binaryInfo),B._delayInfo=[],v.hasUVs&&B._delayInfo.push(f.i.UVKind),v.hasUVs2&&B._delayInfo.push(f.i.UV2Kind),v.hasUVs3&&B._delayInfo.push(f.i.UV3Kind),v.hasUVs4&&B._delayInfo.push(f.i.UV4Kind),v.hasUVs5&&B._delayInfo.push(f.i.UV5Kind),v.hasUVs6&&B._delayInfo.push(f.i.UV6Kind),v.hasColors&&B._delayInfo.push(f.i.ColorKind),v.hasMatricesIndices&&B._delayInfo.push(f.i.MatricesIndicesKind),v.hasMatricesWeights&&B._delayInfo.push(f.i.MatricesWeightsKind),B._delayLoadingFunction=i.b._ImportGeometry,W.c.ForceFullSceneLoadingForIncremental&&B._checkDelayState()):i.b._ImportGeometry(v,B),v.materialUniqueId?B._waitingMaterialId=v.materialUniqueId:v.materialId&&(B._waitingMaterialId=v.materialId),v.morphTargetManagerId>-1&&(B._waitingMorphTargetManagerId=v.morphTargetManagerId),void 0!==v.skeletonId&&null!==v.skeletonId&&(B.skeleton=y.getLastSkeletonById(v.skeletonId),v.numBoneInfluencers&&(B.numBoneInfluencers=v.numBoneInfluencers)),v.animations){for(let y=0;y<v.animations.length;y++){const n=v.animations[y],J=(0,r.d)("BABYLON.Animation");J&&B.animations.push(J.Parse(n))}x.c.ParseAnimationRanges(B,v,y)}if(v.autoAnimate&&y.beginAnimation(B,v.autoAnimateFrom,v.autoAnimateTo,v.autoAnimateLoop,v.autoAnimateSpeed||1),v.layerMask&&!isNaN(v.layerMask)?B.layerMask=Math.abs(parseInt(v.layerMask)):B.layerMask=268435455,v.physicsImpostor&&(B.physicsImpostor=F._PhysicsImpostorParser(y,B,v)),v.lodMeshIds&&(B._waitingData.lods={ids:v.lodMeshIds,distances:v.lodDistances?v.lodDistances:null,coverages:v.lodCoverages?v.lodCoverages:null}),v.instances)for(let J=0;J<v.instances.length;J++){const n=v.instances[J],P=B.createInstance(n.name);if(n.id&&(P.id=n.id),b.c&&(n.tags?b.c.AddTagsTo(P,n.tags):b.c.AddTagsTo(P,v.tags)),P.position=a.n.qh(n.position),void 0!==n.metadata&&(P.metadata=n.metadata),void 0!==n.parentId&&(P._waitingParentId=n.parentId),void 0!==n.parentInstanceIndex&&(P._waitingParentInstanceIndex=n.parentInstanceIndex),void 0!==n.isEnabled&&null!==n.isEnabled&&P.Nb(n.isEnabled),void 0!==n.isVisible&&null!==n.isVisible&&(P.isVisible=n.isVisible),void 0!==n.Kb&&null!==n.Kb&&(P.Kb=n.Kb),n.rotationQuaternion?P.rotationQuaternion=a.g.qh(n.rotationQuaternion):n.rotation&&(P.rotation=a.n.qh(n.rotation)),P.Be=a.n.qh(n.Be),void 0!=n.checkCollisions&&null!=n.checkCollisions&&(P.checkCollisions=n.checkCollisions),void 0!=n.pickable&&null!=n.pickable&&(P.Kb=n.pickable),void 0!=n.showBoundingBox&&null!=n.showBoundingBox&&(P.showBoundingBox=n.showBoundingBox),void 0!=n.showSubMeshesBoundingBox&&null!=n.showSubMeshesBoundingBox&&(P.showSubMeshesBoundingBox=n.showSubMeshesBoundingBox),void 0!=n.alphaIndex&&null!=n.showSubMeshesBoundingBox&&(P.alphaIndex=n.alphaIndex),n.physicsImpostor&&(P.physicsImpostor=F._PhysicsImpostorParser(y,P,n)),void 0!==n.actions&&(P._waitingData.actions=n.actions),n.animations){for(let v=0;v<n.animations.length;v++){const y=n.animations[v],B=(0,r.d)("BABYLON.Animation");B&&P.animations.push(B.Parse(y))}x.c.ParseAnimationRanges(P,n,y),n.autoAnimate&&y.beginAnimation(P,n.autoAnimateFrom,n.autoAnimateTo,n.autoAnimateLoop,n.autoAnimateSpeed||1)}}if(v.thinInstances){const y=v.thinInstances;if(B.thinInstanceEnablePicking=!!y.enablePicking,y.matrixData?(B._b("matrix",new Float32Array(y.matrixData),16,!1),B._thinInstanceDataStorage.matrixBufferSize=y.matrixBufferSize,B._thinInstanceDataStorage.instancesCount=y.instancesCount):B._thinInstanceDataStorage.matrixBufferSize=y.matrixBufferSize,v.thinInstances.userThinInstance){const y=v.thinInstances.userThinInstance;for(const v in y.data)B._b(v,new Float32Array(y.data[v]),y.strides[v],!1),B._userThinInstanceBuffersStorage.sizes[v]=y.sizes[v]}}return B}setPositionsForCPUSkinning(){const v=this._internalMeshDataInfo;if(!v._sourcePositions){const y=this.getVerticesData(f.i.PositionKind);if(!y)return v._sourcePositions;v._sourcePositions=new Float32Array(y),this.isVertexBufferUpdatable(f.i.PositionKind)||this.Ga(f.i.PositionKind,y,!0)}return v._sourcePositions}setNormalsForCPUSkinning(){const v=this._internalMeshDataInfo;if(!v._sourceNormals){const y=this.getVerticesData(f.i.NormalKind);if(!y)return v._sourceNormals;v._sourceNormals=new Float32Array(y),this.isVertexBufferUpdatable(f.i.NormalKind)||this.Ga(f.i.NormalKind,y,!0)}return v._sourceNormals}applySkeleton(v){if(!this.Rj)return this;if(this.Rj._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.Rj._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(f.i.PositionKind))return this;if(!this.isVerticesDataPresent(f.i.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(f.i.MatricesWeightsKind))return this;const y=this.isVerticesDataPresent(f.i.NormalKind),n=this._internalMeshDataInfo;if(!n._sourcePositions){const v=this.Ag.slice();this.setPositionsForCPUSkinning(),this.Ag=v}y&&!n._sourceNormals&&this.setNormalsForCPUSkinning();let B=this.getVerticesData(f.i.PositionKind);if(!B)return this;B instanceof Float32Array||(B=new Float32Array(B));let J=this.getVerticesData(f.i.NormalKind);if(y){if(!J)return this;J instanceof Float32Array||(J=new Float32Array(J))}const P=this.getVerticesData(f.i.MatricesIndicesKind),b=this.getVerticesData(f.i.MatricesWeightsKind);if(!b||!P)return this;const Y=this.numBoneInfluencers>4,l=Y?this.getVerticesData(f.i.MatricesIndicesExtraKind):null,Z=Y?this.getVerticesData(f.i.MatricesWeightsExtraKind):null,x=v.getTransformMatrices(this),N=a.n.Zero(),i=new a.d,g=new a.d;let c,h=0;for(let f=0;f<B.length;f+=3,h+=4){let v;for(c=0;c<4;c++)v=b[h+c],v>0&&(a.d.FromFloat32ArrayToRefScaled(x,Math.floor(16*P[h+c]),v,g),i.addToSelf(g));if(Y)for(c=0;c<4;c++)v=Z[h+c],v>0&&(a.d.FromFloat32ArrayToRefScaled(x,Math.floor(16*l[h+c]),v,g),i.addToSelf(g));a.n.TransformCoordinatesFromFloatsToRef(n._sourcePositions[f],n._sourcePositions[f+1],n._sourcePositions[f+2],i,N),N.toArray(B,f),y&&(a.n.TransformNormalFromFloatsToRef(n._sourceNormals[f],n._sourceNormals[f+1],n._sourceNormals[f+2],i,N),N.toArray(J,f)),i.reset()}return this.updateVerticesData(f.i.PositionKind,B),y&&this.updateVerticesData(f.i.NormalKind,J),this}static MinMax(v){let y=null,n=null;return v.forEach((function(v){const B=v.getBoundingInfo().boundingBox;y&&n?(y.minimizeInPlace(B.minimumWorld),n.maximizeInPlace(B.maximumWorld)):(y=B.minimumWorld,n=B.maximumWorld)})),y&&n?{min:y,max:n}:{min:a.n.Zero(),max:a.n.Zero()}}static Center(v){const y=v instanceof Array?F.MinMax(v):v;return a.n.Center(y.min,y.max)}static MergeMeshes(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0,J=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0;return(0,Y.m)(F._MergeMeshesCoroutine(v,y,n,B,J,P,!1))}static MergeMeshesAsync(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0,J=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0;return(0,Y.k)(F._MergeMeshesCoroutine(v,y,n,B,J,P,!0),(0,Y.d)())}static*_MergeMeshesCoroutine(v){let y,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],B=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0,P=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0;if(0===(v=v.filter(Boolean)).length)return null;if(!B){let n=0;for(y=0;y<v.length;y++)if(n+=v[y].getTotalVertices(),n>=65536)return C.e.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}b&&(P=!1);const l=new Array,a=new Array,Z=new Array,x=v[0].sideOrientation;for(y=0;y<v.length;y++){const n=v[y];if(n.isAnInstance)return C.e.Warn("Cannot merge instance meshes."),null;if(x!==n.sideOrientation)return C.e.Warn("Cannot merge meshes with different sideOrientation values."),null;if(P&&Z.push(n.getTotalIndices()),b)if(n.material){const v=n.material;if(v instanceof E.b){for(let y=0;y<v.Bg.length;y++)l.indexOf(v.Bg[y])<0&&l.push(v.Bg[y]);for(let y=0;y<n.Ag.length;y++)a.push(l.indexOf(v.Bg[n.Ag[y].materialIndex])),Z.push(n.Ag[y].indexCount)}else{l.indexOf(v)<0&&l.push(v);for(let y=0;y<n.Ag.length;y++)a.push(l.indexOf(v)),Z.push(n.Ag[y].indexCount)}}else for(let v=0;v<n.Ag.length;v++)a.push(0),Z.push(n.Ag[v].indexCount)}const f=v[0],i=v=>{const y=v.ak(!0);return{vertexData:N.e.ExtractFromMesh(v,!1,!1),transform:y}},{vertexData:g,transform:h}=i(f);Y&&(yield);const W=new Array(v.length-1);for(let N=1;N<v.length;N++)W[N-1]=i(v[N]),Y&&(yield);const s=g._mergeCoroutine(h,W,B,Y,!n);let r=s.next();for(;!r.done;)Y&&(yield),r=s.next();const u=r.value;J||(J=new F(f.name+"_merged",f.va()));const O=u._applyToCoroutine(J,void 0,Y);let d=O.next();for(;!d.done;)Y&&(yield),d=O.next();if(J.checkCollisions=f.checkCollisions,J.sideOrientation=f.sideOrientation,n)for(y=0;y<v.length;y++)v[y].dispose();if(P||b){J.releaseSubMeshes(),y=0;let v=0;for(;y<Z.length;)c.d.CreateFromIndices(0,v,Z[y],J,void 0,!1),v+=Z[y],y++;for(const y of J.Ag)y.refreshBoundingInfo();J.ak(!0)}if(b){const v=new E.b(f.name+"_merged",f.va());v.Bg=l;for(let y=0;y<J.Ag.length;y++)J.Ag[y].materialIndex=a[y];J.material=v}else J.material=f.material;return J}Uj(v){v._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(v)}Tj(v){const y=v._indexInSourceMeshInstanceArray;if(-1!=y){if(y!==this.instances.length-1){const v=this.instances[this.instances.length-1];this.instances[y]=v,v._indexInSourceMeshInstanceArray=y}v._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===h.d.CounterClockWiseSideOrientation}_getRenderingFillMode(v){const y=this.va();return y.forcePointsCloud?h.d.PointFillMode:y.forceWireframe?h.d.WireFrameFillMode:this.overrideRenderingFillMode??v}setMaterialByID(v){return this.setMaterialById(v)}static CreateRibbon(v,y,n,B,J,P,b,Y,l){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(v,y,n,B,J,P){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(v,y,n,B,J){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(v,y,n,B,J,P){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(v,y,n,B){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(v,y,n,B,J,P,b,Y,l){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(v,y,n,B,J,P,b){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(v,y,n,B,J,P,b,Y,l,a){throw new Error("Import MeshBuilder to populate this function")}static rb(v,y,n,B,J){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(v,y,n,B,J,P,b,Y){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(v,y,n,B,J,P,b){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(v,y,n,B,J,P,b,Y){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(v,y,n,B,J,P,b,Y,l,a){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(v,y,n,B,J,P,b,Y,l,a,Z,x){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(v,y,n,B,J,P,b){throw new Error("Import MeshBuilder to populate this function")}static Cg(v,y,n,B,J){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(v,y,n,B,J,P){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(v,y,n,B,J,P,b,Y,l){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(v,y,n,B,J,P,b,Y,l,a,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(v,y,n,B,J,P,b,Y,l,a){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(v,y,n){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(v,y,n){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(v,y,n,B,J,P){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(v,y,n){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(v){throw new Error("Import MeshBuilder to populate this function")}}F.FRONTSIDE=N.e.FRONTSIDE,F.BACKSIDE=N.e.BACKSIDE,F.DOUBLESIDE=N.e.DOUBLESIDE,F.DEFAULTSIDE=N.e.DEFAULTSIDE,F.NO_CAP=0,F.CAP_START=1,F.CAP_END=2,F.CAP_ALL=3,F.NO_FLIP=0,F.FLIP_TILE=1,F.ROTATE_TILE=2,F.FLIP_ROW=3,F.ROTATE_ROW=4,F.FLIP_N_ROTATE_TILE=5,F.FLIP_N_ROTATE_ROW=6,F.CENTER=0,F.LEFT=1,F.RIGHT=2,F.TOP=3,F.BOTTOM=4,F.INSTANCEDMESH_SORT_TRANSPARENT=!1,F._GroundMeshParser=(v,y)=>{throw(0,u.e)("GroundMesh")},F._GoldbergMeshParser=(v,y)=>{throw(0,u.e)("GoldbergMesh")},F._LinesMeshParser=(v,y)=>{throw(0,u.e)("LinesMesh")},F._GreasedLineMeshParser=(v,y)=>{throw(0,u.e)("GreasedLineMesh")},F._GreasedLineRibbonMeshParser=(v,y)=>{throw(0,u.e)("GreasedLineRibbonMesh")},F._TrailMeshParser=(v,y)=>{throw(0,u.e)("TrailMesh")},(0,r.g)("BABYLON.Mesh",F)},11362:(v,y,n)=>{"use strict";n.d(y,{e:()=>i});var B=n(11050),J=n(11081),P=n(11127),b=n(10811),Y=n(11103),l=n(10801),a=n(11055),Z=n(11345),x=n(10831),f=n(11202);class N{}class i{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,Z.g)(this._applyToCoroutine.bind(this)),this.uniqueId=i._UniqueIDGenerator,i._UniqueIDGenerator++}set(v,y){switch(v.length||l.e.Warn(`Setting vertex data kind '${y}' with an empty array`),y){case P.i.PositionKind:this.xa=v;break;case P.i.NormalKind:this.ya=v;break;case P.i.TangentKind:this.tangents=v;break;case P.i.UVKind:this.Aa=v;break;case P.i.UV2Kind:this.uvs2=v;break;case P.i.UV3Kind:this.uvs3=v;break;case P.i.UV4Kind:this.uvs4=v;break;case P.i.UV5Kind:this.uvs5=v;break;case P.i.UV6Kind:this.uvs6=v;break;case P.i.ColorKind:this.za=v;break;case P.i.MatricesIndicesKind:this.matricesIndices=v;break;case P.i.MatricesWeightsKind:this.matricesWeights=v;break;case P.i.MatricesIndicesExtraKind:this.matricesIndicesExtra=v;break;case P.i.MatricesWeightsExtraKind:this.matricesWeightsExtra=v}}Ca(v,y){return this._applyTo(v,y,!1),this}applyToGeometry(v,y){return this._applyTo(v,y,!1),this}updateMesh(v){return this._update(v),this}updateGeometry(v){return this._update(v),this}*_applyToCoroutine(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;if(this.xa&&(v.Ga(P.i.PositionKind,this.xa,y),n&&(yield)),this.ya&&(v.Ga(P.i.NormalKind,this.ya,y),n&&(yield)),this.tangents&&(v.Ga(P.i.TangentKind,this.tangents,y),n&&(yield)),this.Aa&&(v.Ga(P.i.UVKind,this.Aa,y),n&&(yield)),this.uvs2&&(v.Ga(P.i.UV2Kind,this.uvs2,y),n&&(yield)),this.uvs3&&(v.Ga(P.i.UV3Kind,this.uvs3,y),n&&(yield)),this.uvs4&&(v.Ga(P.i.UV4Kind,this.uvs4,y),n&&(yield)),this.uvs5&&(v.Ga(P.i.UV5Kind,this.uvs5,y),n&&(yield)),this.uvs6&&(v.Ga(P.i.UV6Kind,this.uvs6,y),n&&(yield)),this.za&&(v.Ga(P.i.ColorKind,this.za,y),this.hasVertexAlpha&&void 0!==v.hasVertexAlpha&&(v.hasVertexAlpha=!0),n&&(yield)),this.matricesIndices&&(v.Ga(P.i.MatricesIndicesKind,this.matricesIndices,y),n&&(yield)),this.matricesWeights&&(v.Ga(P.i.MatricesWeightsKind,this.matricesWeights,y),n&&(yield)),this.matricesIndicesExtra&&(v.Ga(P.i.MatricesIndicesExtraKind,this.matricesIndicesExtra,y),n&&(yield)),this.matricesWeightsExtra&&(v.Ga(P.i.MatricesWeightsExtraKind,this.matricesWeightsExtra,y),n&&(yield)),this.indices?(v.setIndices(this.indices,null,y),n&&(yield)):v.setIndices([],null),v.Ag&&this.materialInfos&&this.materialInfos.length>1){const y=v;y.Ag=[];for(const v of this.materialInfos)new f.d(v.materialIndex,v.verticesStart,v.verticesCount,v.indexStart,v.indexCount,y)}return this}_update(v,y,n){return this.xa&&v.updateVerticesData(P.i.PositionKind,this.xa,y,n),this.ya&&v.updateVerticesData(P.i.NormalKind,this.ya,y,n),this.tangents&&v.updateVerticesData(P.i.TangentKind,this.tangents,y,n),this.Aa&&v.updateVerticesData(P.i.UVKind,this.Aa,y,n),this.uvs2&&v.updateVerticesData(P.i.UV2Kind,this.uvs2,y,n),this.uvs3&&v.updateVerticesData(P.i.UV3Kind,this.uvs3,y,n),this.uvs4&&v.updateVerticesData(P.i.UV4Kind,this.uvs4,y,n),this.uvs5&&v.updateVerticesData(P.i.UV5Kind,this.uvs5,y,n),this.uvs6&&v.updateVerticesData(P.i.UV6Kind,this.uvs6,y,n),this.za&&v.updateVerticesData(P.i.ColorKind,this.za,y,n),this.matricesIndices&&v.updateVerticesData(P.i.MatricesIndicesKind,this.matricesIndices,y,n),this.matricesWeights&&v.updateVerticesData(P.i.MatricesWeightsKind,this.matricesWeights,y,n),this.matricesIndicesExtra&&v.updateVerticesData(P.i.MatricesIndicesExtraKind,this.matricesIndicesExtra,y,n),this.matricesWeightsExtra&&v.updateVerticesData(P.i.MatricesWeightsExtraKind,this.matricesWeightsExtra,y,n),this.indices&&v.setIndices(this.indices,null),this}static _TransformVector3Coordinates(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.length;const P=J.i.o[0],b=J.i.o[1];for(let Y=n;Y<n+B;Y+=3)J.n.FromArrayToRef(v,Y,P),J.n.TransformCoordinatesToRef(P,y,b),v[Y]=b.x,v[Y+1]=b.y,v[Y+2]=b.z}static _TransformVector3Normals(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.length;const P=J.i.o[0],b=J.i.o[1];for(let Y=n;Y<n+B;Y+=3)J.n.FromArrayToRef(v,Y,P),J.n.TransformNormalToRef(P,y,b),v[Y]=b.x,v[Y+1]=b.y,v[Y+2]=b.z}static _TransformVector4Normals(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.length;const P=J.i.Vector4[0],b=J.i.Vector4[1];for(let Y=n;Y<n+B;Y+=4)J.p.FromArrayToRef(v,Y,P),J.p.TransformNormalToRef(P,y,b),v[Y]=b.x,v[Y+1]=b.y,v[Y+2]=b.z,v[Y+3]=b.w}static _FlipFaces(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.length;for(let B=y;B<y+n;B+=3){const y=v[B+1];v[B+1]=v[B+2],v[B+2]=y}}transform(v){const y=v.determinant()<0;return this.xa&&i._TransformVector3Coordinates(this.xa,v),this.ya&&i._TransformVector3Normals(this.ya,v),this.tangents&&i._TransformVector4Normals(this.tangents,v),y&&this.indices&&i._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const v=[];for(const y of this.materialInfos){const n=new i;if(this.xa&&(n.xa=this.xa.slice(3*y.verticesStart,3*(y.verticesCount+y.verticesStart))),this.ya&&(n.ya=this.ya.slice(3*y.verticesStart,3*(y.verticesCount+y.verticesStart))),this.tangents&&(n.tangents=this.tangents.slice(4*y.verticesStart,4*(y.verticesCount+y.verticesStart))),this.za&&(n.za=this.za.slice(4*y.verticesStart,4*(y.verticesCount+y.verticesStart))),this.Aa&&(n.Aa=this.Aa.slice(2*y.verticesStart,2*(y.verticesCount+y.verticesStart))),this.uvs2&&(n.uvs2=this.uvs2.slice(2*y.verticesStart,2*(y.verticesCount+y.verticesStart))),this.uvs3&&(n.uvs3=this.uvs3.slice(2*y.verticesStart,2*(y.verticesCount+y.verticesStart))),this.uvs4&&(n.uvs4=this.uvs4.slice(2*y.verticesStart,2*(y.verticesCount+y.verticesStart))),this.uvs5&&(n.uvs5=this.uvs5.slice(2*y.verticesStart,2*(y.verticesCount+y.verticesStart))),this.uvs6&&(n.uvs6=this.uvs6.slice(2*y.verticesStart,2*(y.verticesCount+y.verticesStart))),this.matricesIndices&&(n.matricesIndices=this.matricesIndices.slice(4*y.verticesStart,4*(y.verticesCount+y.verticesStart))),this.matricesIndicesExtra&&(n.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*y.verticesStart,4*(y.verticesCount+y.verticesStart))),this.matricesWeights&&(n.matricesWeights=this.matricesWeights.slice(4*y.verticesStart,4*(y.verticesCount+y.verticesStart))),this.matricesWeightsExtra&&(n.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*y.verticesStart,4*(y.verticesCount+y.verticesStart))),this.indices){n.indices=[];for(let v=y.indexStart;v<y.indexStart+y.indexCount;v++)n.indices.push(this.indices[v]-y.verticesStart)}const B=new N;B.indexStart=0,B.indexCount=n.indices?n.indices.length:0,B.materialIndex=y.materialIndex,B.verticesStart=0,B.verticesCount=(n.xa?n.xa.length:0)/3,n.materialInfos=[B],v.push(n)}return v}merge(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const P=Array.isArray(v)?v.map((v=>({vertexData:v}))):[{vertexData:v}];return(0,Z.m)(this._mergeCoroutine(void 0,P,y,!1,n,B,J))}*_mergeCoroutine(v,y){var n,B;let J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3?arguments[3]:void 0,Y=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let Z=y.map((v=>v.vertexData)),x=this;if(a)for(const P of Z)P&&(P._validate(),!this.ya&&P.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&P.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&P.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&P.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&P.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&P.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&P.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&P.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&P.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&P.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&P.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&P.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&P.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const P of Z)if(P)if(a)this.ya&&!P.ya&&(P.ya=new Float32Array(P.xa.length)),this.tangents&&!P.tangents&&(P.tangents=new Float32Array(P.xa.length/3*4)),this.Aa&&!P.Aa&&(P.Aa=new Float32Array(P.xa.length/3*2)),this.uvs2&&!P.uvs2&&(P.uvs2=new Float32Array(P.xa.length/3*2)),this.uvs3&&!P.uvs3&&(P.uvs3=new Float32Array(P.xa.length/3*2)),this.uvs4&&!P.uvs4&&(P.uvs4=new Float32Array(P.xa.length/3*2)),this.uvs5&&!P.uvs5&&(P.uvs5=new Float32Array(P.xa.length/3*2)),this.uvs6&&!P.uvs6&&(P.uvs6=new Float32Array(P.xa.length/3*2)),this.za&&!P.za&&(P.za=new Float32Array(P.xa.length/3*4),P.za.fill(1)),this.matricesIndices&&!P.matricesIndices&&(P.matricesIndices=new Float32Array(P.xa.length/3*4)),this.matricesWeights&&!P.matricesWeights&&(P.matricesWeights=new Float32Array(P.xa.length/3*4)),this.matricesIndicesExtra&&!P.matricesIndicesExtra&&(P.matricesIndicesExtra=new Float32Array(P.xa.length/3*4)),this.matricesWeightsExtra&&!P.matricesWeightsExtra&&(P.matricesWeightsExtra=new Float32Array(P.xa.length/3*4));else if(P._validate(),!this.ya!==!P.ya||!this.tangents!==!P.tangents||!this.Aa!==!P.Aa||!this.uvs2!==!P.uvs2||!this.uvs3!==!P.uvs3||!this.uvs4!==!P.uvs4||!this.uvs5!==!P.uvs5||!this.uvs6!==!P.uvs6||!this.za!==!P.za||!this.matricesIndices!==!P.matricesIndices||!this.matricesWeights!==!P.matricesWeights||!this.matricesIndicesExtra!==!P.matricesIndicesExtra||!this.matricesWeightsExtra!==!P.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(l){let n=0,B=0,J=0;const P=[];let b=null;const Y=[];for(const y of this.splitBasedOnMaterialID())Y.push({vertexData:y,transform:v});for(const v of y)if(v.vertexData)for(const y of v.vertexData.splitBasedOnMaterialID())Y.push({vertexData:y,transform:v.transform});Y.sort(((v,y)=>{const n=v.vertexData.materialInfos?v.vertexData.materialInfos[0].materialIndex:0,B=y.vertexData.materialInfos?y.vertexData.materialInfos[0].materialIndex:0;return n>B?1:n===B?0:-1}));for(const v of Y){const y=v.vertexData;if(n=y.materialInfos?y.materialInfos[0].materialIndex:0,b&&b.materialIndex===n)b.indexCount+=y.indices.length,b.verticesCount+=y.xa.length/3;else{const v=new N;v.materialIndex=n,v.indexStart=B,v.indexCount=y.indices.length,v.verticesStart=J,v.verticesCount=y.xa.length/3,P.push(v),b=v}B+=y.indices.length,J+=y.xa.length/3}const l=Y.splice(0,1)[0];x=l.vertexData,v=l.transform,Z=Y.map((v=>v.vertexData)),y=Y,this.materialInfos=P}const f=Z.reduce(((v,y)=>{var n;return v+((null===(n=y.indices)||void 0===n?void 0:n.length)??0)}),(null===(n=x.indices)||void 0===n?void 0:n.length)??0);let g=Y||Z.some((v=>v.indices===x.indices))?null===(B=x.indices)||void 0===B?void 0:B.slice():x.indices;if(f>0){var c;let n=(null===(c=g)||void 0===c?void 0:c.length)??0;if(g||(g=new Array(f)),g.length!==f){if(Array.isArray(g))g.length=f;else{const v=J||g instanceof Uint32Array?new Uint32Array(f):new Uint16Array(f);v.set(g),g=v}v&&v.determinant()<0&&i._FlipFaces(g,0,n)}let B=x.xa?x.xa.length/3:0;for(const{vertexData:v,transform:J}of y)if(v.indices){for(let y=0;y<v.indices.length;y++)g[n+y]=v.indices[y]+B;J&&J.determinant()<0&&i._FlipFaces(g,n,v.indices.length),B+=v.xa.length/3,n+=v.indices.length,b&&(yield)}}return this.indices=g,this.xa=i._MergeElement(P.i.PositionKind,x.xa,v,y.map((v=>[v.vertexData.xa,v.transform]))),b&&(yield),x.ya&&(this.ya=i._MergeElement(P.i.NormalKind,x.ya,v,y.map((v=>[v.vertexData.ya,v.transform]))),b&&(yield)),x.tangents&&(this.tangents=i._MergeElement(P.i.TangentKind,x.tangents,v,y.map((v=>[v.vertexData.tangents,v.transform]))),b&&(yield)),x.Aa&&(this.Aa=i._MergeElement(P.i.UVKind,x.Aa,v,y.map((v=>[v.vertexData.Aa,v.transform]))),b&&(yield)),x.uvs2&&(this.uvs2=i._MergeElement(P.i.UV2Kind,x.uvs2,v,y.map((v=>[v.vertexData.uvs2,v.transform]))),b&&(yield)),x.uvs3&&(this.uvs3=i._MergeElement(P.i.UV3Kind,x.uvs3,v,y.map((v=>[v.vertexData.uvs3,v.transform]))),b&&(yield)),x.uvs4&&(this.uvs4=i._MergeElement(P.i.UV4Kind,x.uvs4,v,y.map((v=>[v.vertexData.uvs4,v.transform]))),b&&(yield)),x.uvs5&&(this.uvs5=i._MergeElement(P.i.UV5Kind,x.uvs5,v,y.map((v=>[v.vertexData.uvs5,v.transform]))),b&&(yield)),x.uvs6&&(this.uvs6=i._MergeElement(P.i.UV6Kind,x.uvs6,v,y.map((v=>[v.vertexData.uvs6,v.transform]))),b&&(yield)),x.za&&(this.za=i._MergeElement(P.i.ColorKind,x.za,v,y.map((v=>[v.vertexData.za,v.transform]))),(void 0!==x.hasVertexAlpha||y.some((v=>void 0!==v.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=x.hasVertexAlpha||y.some((v=>v.vertexData.hasVertexAlpha))),b&&(yield)),x.matricesIndices&&(this.matricesIndices=i._MergeElement(P.i.MatricesIndicesKind,x.matricesIndices,v,y.map((v=>[v.vertexData.matricesIndices,v.transform]))),b&&(yield)),x.matricesWeights&&(this.matricesWeights=i._MergeElement(P.i.MatricesWeightsKind,x.matricesWeights,v,y.map((v=>[v.vertexData.matricesWeights,v.transform]))),b&&(yield)),x.matricesIndicesExtra&&(this.matricesIndicesExtra=i._MergeElement(P.i.MatricesIndicesExtraKind,x.matricesIndicesExtra,v,y.map((v=>[v.vertexData.matricesIndicesExtra,v.transform]))),b&&(yield)),x.matricesWeightsExtra&&(this.matricesWeightsExtra=i._MergeElement(P.i.MatricesWeightsExtraKind,x.matricesWeightsExtra,v,y.map((v=>[v.vertexData.matricesWeightsExtra,v.transform])))),this}static _MergeElement(v,y,n,B){const J=B.filter((v=>null!==v[0]&&void 0!==v[0]));if(!y&&0==J.length)return y;if(!y)return this._MergeElement(v,J[0][0],J[0][1],J.slice(1));const b=J.reduce(((v,y)=>v+y[0].length),y.length),Y=v===P.i.PositionKind?i._TransformVector3Coordinates:v===P.i.NormalKind?i._TransformVector3Normals:v===P.i.TangentKind?i._TransformVector4Normals:()=>{};if(y instanceof Float32Array){const v=new Float32Array(b);v.set(y),n&&Y(v,n,0,y.length);let B=y.length;for(const[y,n]of J)v.set(y,B),n&&Y(v,n,B,y.length),B+=y.length;return v}{const v=new Array(b);for(let n=0;n<y.length;n++)v[n]=y[n];n&&Y(v,n,0,y.length);let B=y.length;for(const[y,n]of J){for(let n=0;n<y.length;n++)v[B+n]=y[n];n&&Y(v,n,B,y.length),B+=y.length}return v}}_validate(){if(!this.xa)throw new x.j("Positions are required",x.f.MeshInvalidPositionsError);const v=(v,y)=>{const n=P.i.DeduceStride(v);if(y.length%n!==0)throw new Error("The "+v+"s array count must be a multiple of "+n);return y.length/n},y=v(P.i.PositionKind,this.xa),n=(n,B)=>{const J=v(n,B);if(J!==y)throw new Error("The "+n+"s element count ("+J+") does not match the positions count ("+y+")")};this.ya&&n(P.i.NormalKind,this.ya),this.tangents&&n(P.i.TangentKind,this.tangents),this.Aa&&n(P.i.UVKind,this.Aa),this.uvs2&&n(P.i.UV2Kind,this.uvs2),this.uvs3&&n(P.i.UV3Kind,this.uvs3),this.uvs4&&n(P.i.UV4Kind,this.uvs4),this.uvs5&&n(P.i.UV5Kind,this.uvs5),this.uvs6&&n(P.i.UV6Kind,this.uvs6),this.za&&n(P.i.ColorKind,this.za),this.matricesIndices&&n(P.i.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&n(P.i.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&n(P.i.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&n(P.i.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const v=this.serialize();return i.Parse(v)}serialize(){const v={};if(this.xa&&(v.xa=Array.from(this.xa)),this.ya&&(v.ya=Array.from(this.ya)),this.tangents&&(v.tangents=Array.from(this.tangents)),this.Aa&&(v.Aa=Array.from(this.Aa)),this.uvs2&&(v.uvs2=Array.from(this.uvs2)),this.uvs3&&(v.uvs3=Array.from(this.uvs3)),this.uvs4&&(v.uvs4=Array.from(this.uvs4)),this.uvs5&&(v.uvs5=Array.from(this.uvs5)),this.uvs6&&(v.uvs6=Array.from(this.uvs6)),this.za&&(v.za=Array.from(this.za),v.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(v.matricesIndices=Array.from(this.matricesIndices),v.matricesIndices._isExpanded=!0),this.matricesWeights&&(v.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(v.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),v.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(v.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),v.indices=Array.from(this.indices),this.materialInfos){v.materialInfos=[];for(const y of this.materialInfos){const n={indexStart:y.indexStart,indexCount:y.indexCount,materialIndex:y.materialIndex,verticesStart:y.verticesStart,verticesCount:y.verticesCount};v.materialInfos.push(n)}}return v}static ExtractFromMesh(v,y,n){return i._ExtractFrom(v,y,n)}static ExtractFromGeometry(v,y,n){return i._ExtractFrom(v,y,n)}static _ExtractFrom(v,y,n){const B=new i;if(v.isVerticesDataPresent(P.i.PositionKind)&&(B.xa=v.getVerticesData(P.i.PositionKind,y,n)),v.isVerticesDataPresent(P.i.NormalKind)&&(B.ya=v.getVerticesData(P.i.NormalKind,y,n)),v.isVerticesDataPresent(P.i.TangentKind)&&(B.tangents=v.getVerticesData(P.i.TangentKind,y,n)),v.isVerticesDataPresent(P.i.UVKind)&&(B.Aa=v.getVerticesData(P.i.UVKind,y,n)),v.isVerticesDataPresent(P.i.UV2Kind)&&(B.uvs2=v.getVerticesData(P.i.UV2Kind,y,n)),v.isVerticesDataPresent(P.i.UV3Kind)&&(B.uvs3=v.getVerticesData(P.i.UV3Kind,y,n)),v.isVerticesDataPresent(P.i.UV4Kind)&&(B.uvs4=v.getVerticesData(P.i.UV4Kind,y,n)),v.isVerticesDataPresent(P.i.UV5Kind)&&(B.uvs5=v.getVerticesData(P.i.UV5Kind,y,n)),v.isVerticesDataPresent(P.i.UV6Kind)&&(B.uvs6=v.getVerticesData(P.i.UV6Kind,y,n)),v.isVerticesDataPresent(P.i.ColorKind)){const J=v.Rj||v,b=J.getVertexBuffer(P.i.ColorKind),Y=J.getVerticesData(P.i.ColorKind,y,n);if(3===b.getSize()){const v=new Float32Array(4*Y.length/3);for(let y=0,n=0;y<Y.length;y+=3,n+=4)v[n]=Y[y],v[n+1]=Y[y+1],v[n+2]=Y[y+2],v[n+3]=1;B.za=v}else{if(4!==b.getSize())throw new Error(`Unexpected number of color components: ${b.getSize()}`);B.za=Y}}return v.isVerticesDataPresent(P.i.MatricesIndicesKind)&&(B.matricesIndices=v.getVerticesData(P.i.MatricesIndicesKind,y,n)),v.isVerticesDataPresent(P.i.MatricesWeightsKind)&&(B.matricesWeights=v.getVerticesData(P.i.MatricesWeightsKind,y,n)),v.isVerticesDataPresent(P.i.MatricesIndicesExtraKind)&&(B.matricesIndicesExtra=v.getVerticesData(P.i.MatricesIndicesExtraKind,y,n)),v.isVerticesDataPresent(P.i.MatricesWeightsExtraKind)&&(B.matricesWeightsExtra=v.getVerticesData(P.i.MatricesWeightsExtraKind,y,n)),B.indices=v.wg(y,n),B}static CreateRibbon(v){throw(0,b.e)("ribbonBuilder")}static CreateBox(v){throw(0,b.e)("boxBuilder")}static CreateTiledBox(v){throw(0,b.e)("tiledBoxBuilder")}static CreateTiledPlane(v){throw(0,b.e)("tiledPlaneBuilder")}static CreateSphere(v){throw(0,b.e)("sphereBuilder")}static CreateCylinder(v){throw(0,b.e)("cylinderBuilder")}static CreateTorus(v){throw(0,b.e)("torusBuilder")}static CreateLineSystem(v){throw(0,b.e)("linesBuilder")}static CreateDashedLines(v){throw(0,b.e)("linesBuilder")}static CreateGround(v){throw(0,b.e)("groundBuilder")}static CreateTiledGround(v){throw(0,b.e)("groundBuilder")}static CreateGroundFromHeightMap(v){throw(0,b.e)("groundBuilder")}static Cg(v){throw(0,b.e)("planeBuilder")}static CreateDisc(v){throw(0,b.e)("discBuilder")}static CreatePolygon(v,y,n,B,J,P,Y){throw(0,b.e)("polygonBuilder")}static CreateIcoSphere(v){throw(0,b.e)("icoSphereBuilder")}static CreatePolyhedron(v){throw(0,b.e)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||J.n.Up();throw(0,b.e)("capsuleBuilder")}static CreateTorusKnot(v){throw(0,b.e)("torusKnotBuilder")}static ComputeNormals(v,y,n,B){let P=0,b=0,Y=0,l=0,a=0,Z=0,x=0,f=0,N=0,i=0,g=0,c=0,h=0,E=0,W=0,s=0,C=0,r=0,u=0,O=0,d=!1,q=!1,L=!1,t=!1,G=1,R=0,F=null;B&&(d=!!B.facetNormals,q=!!B.facetPositions,L=!!B.facetPartitioning,G=!0===B.useRightHandedSystem?-1:1,R=B.ratio||0,t=!!B.depthSort,F=B.distanceTo,t&&void 0===F&&(F=J.n.Zero()));let S=0,w=0,k=0,M=0;for(L&&B&&B.bbSize&&(S=B.subDiv.X*R/B.bbSize.x,w=B.subDiv.Y*R/B.bbSize.y,k=B.subDiv.Z*R/B.bbSize.z,M=B.subDiv.max*B.subDiv.max,B.facetPartitioning.length=0),P=0;P<v.length;P++)n[P]=0;const I=y.length/3|0;for(P=0;P<I;P++){if(c=3*y[3*P],h=c+1,E=c+2,W=3*y[3*P+1],s=W+1,C=W+2,r=3*y[3*P+2],u=r+1,O=r+2,b=v[c]-v[W],Y=v[h]-v[s],l=v[E]-v[C],a=v[r]-v[W],Z=v[u]-v[s],x=v[O]-v[C],f=G*(Y*x-l*Z),N=G*(l*a-b*x),i=G*(b*Z-Y*a),g=Math.sqrt(f*f+N*N+i*i),g=0===g?1:g,f/=g,N/=g,i/=g,d&&B&&(B.facetNormals[P].x=f,B.facetNormals[P].y=N,B.facetNormals[P].z=i),q&&B&&(B.facetPositions[P].x=(v[c]+v[W]+v[r])/3,B.facetPositions[P].y=(v[h]+v[s]+v[u])/3,B.facetPositions[P].z=(v[E]+v[C]+v[O])/3),L&&B){const y=Math.floor((B.facetPositions[P].x-B.bInfo.minimum.x*R)*S),n=Math.floor((B.facetPositions[P].y-B.bInfo.minimum.y*R)*w),J=Math.floor((B.facetPositions[P].z-B.bInfo.minimum.z*R)*k),b=Math.floor((v[c]-B.bInfo.minimum.x*R)*S),Y=Math.floor((v[h]-B.bInfo.minimum.y*R)*w),l=Math.floor((v[E]-B.bInfo.minimum.z*R)*k),a=Math.floor((v[W]-B.bInfo.minimum.x*R)*S),Z=Math.floor((v[s]-B.bInfo.minimum.y*R)*w),x=Math.floor((v[C]-B.bInfo.minimum.z*R)*k),f=Math.floor((v[r]-B.bInfo.minimum.x*R)*S),N=Math.floor((v[u]-B.bInfo.minimum.y*R)*w),i=Math.floor((v[O]-B.bInfo.minimum.z*R)*k),g=b+B.subDiv.max*Y+M*l,d=a+B.subDiv.max*Z+M*x,q=f+B.subDiv.max*N+M*i,L=y+B.subDiv.max*n+M*J;B.facetPartitioning[L]=B.facetPartitioning[L]?B.facetPartitioning[L]:new Array,B.facetPartitioning[g]=B.facetPartitioning[g]?B.facetPartitioning[g]:new Array,B.facetPartitioning[d]=B.facetPartitioning[d]?B.facetPartitioning[d]:new Array,B.facetPartitioning[q]=B.facetPartitioning[q]?B.facetPartitioning[q]:new Array,B.facetPartitioning[g].push(P),d!=g&&B.facetPartitioning[d].push(P),q!=d&&q!=g&&B.facetPartitioning[q].push(P),L!=g&&L!=d&&L!=q&&B.facetPartitioning[L].push(P)}if(t&&B&&B.facetPositions){const v=B.depthSortedFacets[P];v.ind=3*P,v.sqDistance=J.n.DistanceSquared(B.facetPositions[P],F)}n[c]+=f,n[h]+=N,n[E]+=i,n[W]+=f,n[s]+=N,n[C]+=i,n[r]+=f,n[u]+=N,n[O]+=i}for(P=0;P<n.length/3;P++)f=n[3*P],N=n[3*P+1],i=n[3*P+2],g=Math.sqrt(f*f+N*N+i*i),g=0===g?1:g,f/=g,N/=g,i/=g,n[3*P]=f,n[3*P+1]=N,n[3*P+2]=i}static _ComputeSides(v,y,n,B,P,b,Y){const l=n.length,a=B.length;let Z,x;switch(v=v||i.DEFAULTSIDE){case i.FRONTSIDE:break;case i.BACKSIDE:for(Z=0;Z<l;Z+=3){const v=n[Z];n[Z]=n[Z+2],n[Z+2]=v}for(x=0;x<a;x++)B[x]=-B[x];break;case i.DOUBLESIDE:{const v=y.length,f=v/3;for(let n=0;n<v;n++)y[v+n]=y[n];for(Z=0;Z<l;Z+=3)n[Z+l]=n[Z+2]+f,n[Z+1+l]=n[Z+1]+f,n[Z+2+l]=n[Z]+f;for(x=0;x<a;x++)B[a+x]=-B[x];const N=P.length;let i=0;for(i=0;i<N;i++)P[i+N]=P[i];for(b=b||new J.p(0,0,1,1),Y=Y||new J.p(0,0,1,1),i=0,Z=0;Z<N/2;Z++)P[i]=b.x+(b.z-b.x)*P[i],P[i+1]=b.y+(b.w-b.y)*P[i+1],P[i+N]=Y.x+(Y.z-Y.x)*P[i+N],P[i+N+1]=Y.y+(Y.w-Y.y)*P[i+N+1],i+=2;break}}}static Parse(v){const y=new i,n=v.xa;n&&y.set(n,P.i.PositionKind);const B=v.ya;B&&y.set(B,P.i.NormalKind);const J=v.tangents;J&&y.set(J,P.i.TangentKind);const b=v.Aa;b&&y.set(b,P.i.UVKind);const l=v.uvs2;l&&y.set(l,P.i.UV2Kind);const a=v.uvs3;a&&y.set(a,P.i.UV3Kind);const Z=v.uvs4;Z&&y.set(Z,P.i.UV4Kind);const x=v.uvs5;x&&y.set(x,P.i.UV5Kind);const f=v.uvs6;f&&y.set(f,P.i.UV6Kind);const g=v.za;g&&(y.set(Y.e.CheckColors4(g,n.length/3),P.i.ColorKind),void 0!==v.hasVertexAlpha&&(y.hasVertexAlpha=v.hasVertexAlpha));const c=v.matricesIndices;c&&y.set(c,P.i.MatricesIndicesKind);const h=v.matricesWeights;h&&y.set(h,P.i.MatricesWeightsKind);const E=v.indices;E&&(y.indices=E);const W=v.materialInfos;if(W){y.materialInfos=[];for(const v of W){const n=new N;n.indexCount=v.indexCount,n.indexStart=v.indexStart,n.verticesCount=v.verticesCount,n.verticesStart=v.verticesStart,n.materialIndex=v.materialIndex,y.materialInfos.push(n)}}return y}static ImportVertexData(v,y){const n=i.Parse(v);y.setAllVerticesData(n,v.updatable)}}i.FRONTSIDE=0,i.BACKSIDE=1,i.DOUBLESIDE=2,i.DEFAULTSIDE=0,i._UniqueIDGenerator=0,(0,B.c)([a.g.filter((function(){for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];let[B]=y;return!Array.isArray(B)}))],i,"_TransformVector3Coordinates",null),(0,B.c)([a.g.filter((function(){for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];let[B]=y;return!Array.isArray(B)}))],i,"_TransformVector3Normals",null),(0,B.c)([a.g.filter((function(){for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];let[B]=y;return!Array.isArray(B)}))],i,"_TransformVector4Normals",null),(0,B.c)([a.g.filter((function(){for(var v=arguments.length,y=new Array(v),n=0;n<v;n++)y[n]=arguments[n];let[B]=y;return!Array.isArray(B)}))],i,"_FlipFaces",null)},12765:(v,y,n)=>{"use strict";n.d(y,{b:()=>gv});var B=n(11081),J=n(11338),P=n(11127),b=n(11362),Y=n(11295);function l(v){let y=v.pathArray;const n=v.closeArray||!1,B=v.closePath||!1,J=v.invertUV||!1,l=Math.floor(y[0].length/2);let a=v.offset||l;a=a>l?l:Math.floor(a);const Z=0===v.sideOrientation?0:v.sideOrientation||b.e.DEFAULTSIDE,x=v.Aa,f=v.za,N=[],i=[],g=[],c=[],h=[],E=[],W=[],s=[];let C;const r=[],u=[];let O,d,q;if(y.length<2){const v=[],n=[];for(d=0;d<y[0].length-a;d++)v.push(y[0][d]),n.push(y[0][d+a]);y=[v,n]}let L=0;const t=B?1:0,G=n?1:0;let R,F,S,w,k,M;for(C=y[0].length,O=0;O<y.length+G;O++){for(W[O]=0,h[O]=[0],R=O===y.length?y[0]:y[O],F=R.length,C=C<F?C:F,q=0;q<F;)N.push(R[q].x,R[q].y,R[q].z),q>0&&(S=R[q].od(R[q-1]).length(),w=S+W[O],h[O].push(w),W[O]=w),q++;B&&(q--,N.push(R[0].x,R[0].y,R[0].z),S=R[q].od(R[0]).length(),w=S+W[O],h[O].push(w),W[O]=w),r[O]=F+t,u[O]=L,L+=F+t}let I,j,V=null,p=null;for(d=0;d<C+t;d++)for(s[d]=0,E[d]=[0],O=0;O<y.length-1+G;O++)k=y[O],M=O===y.length-1?y[0]:y[O+1],d===C?(V=k[0],p=M[0]):(V=k[d],p=M[d]),S=p.od(V).length(),w=S+s[d],E[d].push(w),s[d]=w;if(x)for(O=0;O<x.length;O++)c.push(x[O].x,Y.e?1-x[O].y:x[O].y);else for(O=0;O<y.length+G;O++)for(d=0;d<C+t;d++)I=0!=W[O]?h[O][d]/W[O]:0,j=0!=s[d]?E[d][O]/s[d]:0,J?c.push(j,I):c.push(I,Y.e?1-j:j);O=0;let H=0,A=r[O]-1,X=r[O+1]-1,U=A<X?A:X,z=u[1]-u[0];const e=r.length-1;for(;H<=U&&O<e;)i.push(H,H+z,H+1),i.push(H+z+1,H+1,H+z),H+=1,H===U&&(O++,z=u[O+1]-u[O],A=r[O]-1,X=r[O+1]-1,H=u[O],U=A<X?A+H:X+H);if(b.e.ComputeNormals(N,i,g),B){let v=0,n=0;for(O=0;O<y.length;O++){v=3*u[O],n=O+1<y.length?3*(u[O+1]-1):g.length-3,g[v]=.5*(g[v]+g[n]),g[v+1]=.5*(g[v+1]+g[n+1]),g[v+2]=.5*(g[v+2]+g[n+2]);const B=Math.sqrt(g[v]*g[v]+g[v+1]*g[v+1]+g[v+2]*g[v+2]);g[v]/=B,g[v+1]/=B,g[v+2]/=B,g[n]=g[v],g[n+1]=g[v+1],g[n+2]=g[v+2]}}if(n){let v=3*u[0],n=3*u[y.length];for(d=0;d<C+t;d++){g[v]=.5*(g[v]+g[n]),g[v+1]=.5*(g[v+1]+g[n+1]),g[v+2]=.5*(g[v+2]+g[n+2]);const y=Math.sqrt(g[v]*g[v]+g[v+1]*g[v+1]+g[v+2]*g[v+2]);g[v]/=y,g[v+1]/=y,g[v+2]/=y,g[n]=g[v],g[n+1]=g[v+1],g[n+2]=g[v+2],v+=3,n+=3}}b.e._ComputeSides(Z,N,i,g,c,v.frontUVs,v.backUVs);let K=null;if(f){K=new Float32Array(4*f.length);for(let v=0;v<f.length;v++)K[4*v]=f[v].r,K[4*v+1]=f[v].g,K[4*v+2]=f[v].b,K[4*v+3]=f[v].a}const D=new b.e,Q=new Float32Array(N),o=new Float32Array(g),T=new Float32Array(c);return D.indices=i,D.xa=Q,D.ya=o,D.Aa=T,K&&D.set(K,P.i.ColorKind),B&&(D._idx=u),D}function a(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=y.pathArray,Z=y.closeArray,x=y.closePath,f=J.d._GetDefaultSideOrientation(y.sideOrientation),N=y.instance,i=y.updatable;if(N){const v=B.i.o[0].xe(Number.MAX_VALUE),n=B.i.o[1].xe(-Number.MAX_VALUE),l=y=>{let B=a[0].length;const P=N;let b=0;const Y=P._originalBuilderSideOrientation===J.d.DOUBLESIDE?2:1;for(let J=1;J<=Y;++J)for(let Y=0;Y<a.length;++Y){const J=a[Y],l=J.length;B=B<l?B:l;for(let P=0;P<B;++P){const B=J[P];y[b]=B.x,y[b+1]=B.y,y[b+2]=B.z,v.minimizeInPlaceFromFloats(B.x,B.y,B.z),n.maximizeInPlaceFromFloats(B.x,B.y,B.z),b+=3}if(P._creationDataStorage&&P._creationDataStorage.closePath){const v=J[0];y[b]=v.x,y[b+1]=v.y,y[b+2]=v.z,b+=3}}},Z=N.getVerticesData(P.i.PositionKind);if(l(Z),N.hasBoundingInfo?N.getBoundingInfo().reConstruct(v,n,N._worldMatrix):N.buildBoundingInfo(v,n,N._worldMatrix),N.updateVerticesData(P.i.PositionKind,Z,!1,!1),y.za){const v=N.getVerticesData(P.i.ColorKind);for(let n=0,B=0;n<y.za.length;n++,B+=4){const J=y.za[n];v[B]=J.r,v[B+1]=J.g,v[B+2]=J.b,v[B+3]=J.a}N.updateVerticesData(P.i.ColorKind,v,!1,!1)}if(y.Aa){const v=N.getVerticesData(P.i.UVKind);for(let n=0;n<y.Aa.length;n++)v[2*n]=y.Aa[n].x,v[2*n+1]=Y.e?1-y.Aa[n].y:y.Aa[n].y;N.updateVerticesData(P.i.UVKind,v,!1,!1)}if(!N.areNormalsFrozen||N.isFacetDataEnabled){const v=N.wg(),y=N.getVerticesData(P.i.NormalKind),n=N.isFacetDataEnabled?N.getFacetDataParameters():null;if(b.e.ComputeNormals(Z,v,y,n),N._creationDataStorage&&N._creationDataStorage.closePath){let v=0,n=0;for(let B=0;B<a.length;B++)v=3*N._creationDataStorage.idx[B],n=B+1<a.length?3*(N._creationDataStorage.idx[B+1]-1):y.length-3,y[v]=.5*(y[v]+y[n]),y[v+1]=.5*(y[v+1]+y[n+1]),y[v+2]=.5*(y[v+2]+y[n+2]),y[n]=y[v],y[n+1]=y[v+1],y[n+2]=y[v+2]}N.areNormalsFrozen||N.updateVerticesData(P.i.NormalKind,y,!1,!1)}return N}{const B=new J.d(v,n);B._originalBuilderSideOrientation=f,B._creationDataStorage=new J.h;const P=l(y);return x&&(B._creationDataStorage.idx=P._idx),B._creationDataStorage.closePath=x,B._creationDataStorage.closeArray=Z,P.Ca(B,i),B}}b.e.CreateRibbon=l,J.d.CreateRibbon=function(v,y){return a(v,{pathArray:y,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var Z=n(11721),x=n(11404),f=n(11103);function N(v){const y=v.pattern||J.d.NO_FLIP,n=v.tileWidth||v.tileSize||1,B=v.tileHeight||v.tileSize||1,P=v.alignHorizontal||0,Y=v.alignVertical||0,l=v.width||v.size||1,a=Math.floor(l/n);let Z=l-a*n;const x=v.height||v.size||1,f=Math.floor(x/B);let N=x-f*B;const i=n*a/2,g=B*f/2;let c=0,h=0,E=0,W=0,s=0,C=0;if(Z>0||N>0){switch(E=-i,W=-g,s=i,C=g,P){case J.d.CENTER:Z/=2,E-=Z,s+=Z;break;case J.d.LEFT:s+=Z,c=-Z/2;break;case J.d.RIGHT:E-=Z,c=Z/2}switch(Y){case J.d.CENTER:N/=2,W-=N,C+=N;break;case J.d.BOTTOM:C+=N,h=-N/2;break;case J.d.TOP:W-=N,h=N/2}}const r=[],u=[],O=[];O[0]=[0,0,1,0,1,1,0,1],O[1]=[0,0,1,0,1,1,0,1],y!==J.d.ROTATE_TILE&&y!==J.d.ROTATE_ROW||(O[1]=[1,1,0,1,0,0,1,0]),y!==J.d.FLIP_TILE&&y!==J.d.FLIP_ROW||(O[1]=[1,0,0,0,0,1,1,1]),y!==J.d.FLIP_N_ROTATE_TILE&&y!==J.d.FLIP_N_ROTATE_ROW||(O[1]=[0,1,1,1,1,0,0,0]);let d=[];const q=[],L=[];let t=0;for(let b=0;b<f;b++)for(let v=0;v<a;v++)r.push(v*n-i+c,b*B-g+h,0),r.push((v+1)*n-i+c,b*B-g+h,0),r.push((v+1)*n-i+c,(b+1)*B-g+h,0),r.push(v*n-i+c,(b+1)*B-g+h,0),L.push(t,t+1,t+3,t+1,t+2,t+3),d=y===J.d.FLIP_TILE||y===J.d.ROTATE_TILE||y===J.d.FLIP_N_ROTATE_TILE?d.concat(O[(v%2+b%2)%2]):y===J.d.FLIP_ROW||y===J.d.ROTATE_ROW||y===J.d.FLIP_N_ROTATE_ROW?d.concat(O[b%2]):d.concat(O[0]),q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),t+=4;if(Z>0||N>0){const v=N>0&&(Y===J.d.CENTER||Y===J.d.TOP),b=N>0&&(Y===J.d.CENTER||Y===J.d.BOTTOM),l=Z>0&&(P===J.d.CENTER||P===J.d.RIGHT),x=Z>0&&(P===J.d.CENTER||P===J.d.LEFT);let O,G,R,F,S=[];if(v&&l&&(r.push(E+c,W+h,0),r.push(-i+c,W+h,0),r.push(-i+c,W+N+h,0),r.push(E+c,W+N+h,0),L.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,O=1-Z/n,G=1-N/B,R=1,F=1,S=[O,G,R,G,R,F,O,F],y===J.d.ROTATE_ROW&&(S=[1-O,1-G,1-R,1-G,1-R,1-F,1-O,1-F]),y===J.d.FLIP_ROW&&(S=[1-O,G,1-R,G,1-R,F,1-O,F]),y===J.d.FLIP_N_ROTATE_ROW&&(S=[O,1-G,R,1-G,R,1-F,O,1-F]),d=d.concat(S),q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),v&&x&&(r.push(i+c,W+h,0),r.push(s+c,W+h,0),r.push(s+c,W+N+h,0),r.push(i+c,W+N+h,0),L.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,O=0,G=1-N/B,R=Z/n,F=1,S=[O,G,R,G,R,F,O,F],(y===J.d.ROTATE_ROW||y===J.d.ROTATE_TILE&&a%2===0)&&(S=[1-O,1-G,1-R,1-G,1-R,1-F,1-O,1-F]),(y===J.d.FLIP_ROW||y===J.d.FLIP_TILE&&a%2===0)&&(S=[1-O,G,1-R,G,1-R,F,1-O,F]),(y===J.d.FLIP_N_ROTATE_ROW||y===J.d.FLIP_N_ROTATE_TILE&&a%2===0)&&(S=[O,1-G,R,1-G,R,1-F,O,1-F]),d=d.concat(S),q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),b&&l&&(r.push(E+c,g+h,0),r.push(-i+c,g+h,0),r.push(-i+c,C+h,0),r.push(E+c,C+h,0),L.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,O=1-Z/n,G=0,R=1,F=N/B,S=[O,G,R,G,R,F,O,F],(y===J.d.ROTATE_ROW&&f%2===1||y===J.d.ROTATE_TILE&&f%1===0)&&(S=[1-O,1-G,1-R,1-G,1-R,1-F,1-O,1-F]),(y===J.d.FLIP_ROW&&f%2===1||y===J.d.FLIP_TILE&&f%2===0)&&(S=[1-O,G,1-R,G,1-R,F,1-O,F]),(y===J.d.FLIP_N_ROTATE_ROW&&f%2===1||y===J.d.FLIP_N_ROTATE_TILE&&f%2===0)&&(S=[O,1-G,R,1-G,R,1-F,O,1-F]),d=d.concat(S),q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),b&&x&&(r.push(i+c,g+h,0),r.push(s+c,g+h,0),r.push(s+c,C+h,0),r.push(i+c,C+h,0),L.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,O=0,G=0,R=Z/n,F=N/B,S=[O,G,R,G,R,F,O,F],(y===J.d.ROTATE_ROW&&f%2===1||y===J.d.ROTATE_TILE&&(f+a)%2===1)&&(S=[1-O,1-G,1-R,1-G,1-R,1-F,1-O,1-F]),(y===J.d.FLIP_ROW&&f%2===1||y===J.d.FLIP_TILE&&(f+a)%2===1)&&(S=[1-O,G,1-R,G,1-R,F,1-O,F]),(y===J.d.FLIP_N_ROTATE_ROW&&f%2===1||y===J.d.FLIP_N_ROTATE_TILE&&(f+a)%2===1)&&(S=[O,1-G,R,1-G,R,1-F,O,1-F]),d=d.concat(S),q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),v){const v=[];O=0,G=1-N/B,R=1,F=1,v[0]=[O,G,R,G,R,F,O,F],v[1]=[O,G,R,G,R,F,O,F],y!==J.d.ROTATE_TILE&&y!==J.d.ROTATE_ROW||(v[1]=[1-O,1-G,1-R,1-G,1-R,1-F,1-O,1-F]),y!==J.d.FLIP_TILE&&y!==J.d.FLIP_ROW||(v[1]=[1-O,G,1-R,G,1-R,F,1-O,F]),y!==J.d.FLIP_N_ROTATE_TILE&&y!==J.d.FLIP_N_ROTATE_ROW||(v[1]=[O,1-G,R,1-G,R,1-F,O,1-F]);for(let B=0;B<a;B++)r.push(B*n-i+c,W+h,0),r.push((B+1)*n-i+c,W+h,0),r.push((B+1)*n-i+c,W+N+h,0),r.push(B*n-i+c,W+N+h,0),L.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,d=y===J.d.FLIP_TILE||y===J.d.ROTATE_TILE||y===J.d.FLIP_N_ROTATE_TILE?d.concat(v[(B+1)%2]):y===J.d.FLIP_ROW||y===J.d.ROTATE_ROW||y===J.d.FLIP_N_ROTATE_ROW?d.concat(v[1]):d.concat(v[0]),q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(b){const v=[];O=0,G=0,R=1,F=N/B,v[0]=[O,G,R,G,R,F,O,F],v[1]=[O,G,R,G,R,F,O,F],y!==J.d.ROTATE_TILE&&y!==J.d.ROTATE_ROW||(v[1]=[1-O,1-G,1-R,1-G,1-R,1-F,1-O,1-F]),y!==J.d.FLIP_TILE&&y!==J.d.FLIP_ROW||(v[1]=[1-O,G,1-R,G,1-R,F,1-O,F]),y!==J.d.FLIP_N_ROTATE_TILE&&y!==J.d.FLIP_N_ROTATE_ROW||(v[1]=[O,1-G,R,1-G,R,1-F,O,1-F]);for(let B=0;B<a;B++)r.push(B*n-i+c,C-N+h,0),r.push((B+1)*n-i+c,C-N+h,0),r.push((B+1)*n-i+c,C+h,0),r.push(B*n-i+c,C+h,0),L.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,d=y===J.d.FLIP_TILE||y===J.d.ROTATE_TILE||y===J.d.FLIP_N_ROTATE_TILE?d.concat(v[(B+f)%2]):y===J.d.FLIP_ROW||y===J.d.ROTATE_ROW||y===J.d.FLIP_N_ROTATE_ROW?d.concat(v[f%2]):d.concat(v[0]),q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(l){const v=[];O=1-Z/n,G=0,R=1,F=1,v[0]=[O,G,R,G,R,F,O,F],v[1]=[O,G,R,G,R,F,O,F],y!==J.d.ROTATE_TILE&&y!==J.d.ROTATE_ROW||(v[1]=[1-O,1-G,1-R,1-G,1-R,1-F,1-O,1-F]),y!==J.d.FLIP_TILE&&y!==J.d.FLIP_ROW||(v[1]=[1-O,G,1-R,G,1-R,F,1-O,F]),y!==J.d.FLIP_N_ROTATE_TILE&&y!==J.d.FLIP_N_ROTATE_ROW||(v[1]=[O,1-G,R,1-G,R,1-F,O,1-F]);for(let n=0;n<f;n++)r.push(E+c,n*B-g+h,0),r.push(E+Z+c,n*B-g+h,0),r.push(E+Z+c,(n+1)*B-g+h,0),r.push(E+c,(n+1)*B-g+h,0),L.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,d=y===J.d.FLIP_TILE||y===J.d.ROTATE_TILE||y===J.d.FLIP_N_ROTATE_TILE?d.concat(v[(n+1)%2]):y===J.d.FLIP_ROW||y===J.d.ROTATE_ROW||y===J.d.FLIP_N_ROTATE_ROW?d.concat(v[n%2]):d.concat(v[0]),q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(x){const v=[];O=0,G=0,R=Z/B,F=1,v[0]=[O,G,R,G,R,F,O,F],v[1]=[O,G,R,G,R,F,O,F],y!==J.d.ROTATE_TILE&&y!==J.d.ROTATE_ROW||(v[1]=[1-O,1-G,1-R,1-G,1-R,1-F,1-O,1-F]),y!==J.d.FLIP_TILE&&y!==J.d.FLIP_ROW||(v[1]=[1-O,G,1-R,G,1-R,F,1-O,F]),y!==J.d.FLIP_N_ROTATE_TILE&&y!==J.d.FLIP_N_ROTATE_ROW||(v[1]=[O,1-G,R,1-G,R,1-F,O,1-F]);for(let n=0;n<f;n++)r.push(s-Z+c,n*B-g+h,0),r.push(s+c,n*B-g+h,0),r.push(s+c,(n+1)*B-g+h,0),r.push(s-Z+c,(n+1)*B-g+h,0),L.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,d=y===J.d.FLIP_TILE||y===J.d.ROTATE_TILE||y===J.d.FLIP_N_ROTATE_TILE?d.concat(v[(n+a)%2]):y===J.d.FLIP_ROW||y===J.d.ROTATE_ROW||y===J.d.FLIP_N_ROTATE_ROW?d.concat(v[n%2]):d.concat(v[0]),q.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const G=0===v.sideOrientation?0:v.sideOrientation||b.e.DEFAULTSIDE;b.e._ComputeSides(G,r,L,u,d,v.frontUVs,v.backUVs);const R=new b.e;R.indices=L,R.xa=r,R.ya=u,R.Aa=d;const F=G===b.e.DOUBLESIDE?q.concat(q):q;return R.za=F,R}function i(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new J.d(v,n);y.sideOrientation=J.d._GetDefaultSideOrientation(y.sideOrientation),B._originalBuilderSideOrientation=y.sideOrientation;return N(y).Ca(B,y.updatable),B}function g(v){const y=v.faceUV||new Array(6),n=v.faceColors,P=v.pattern||J.d.NO_FLIP,l=v.width||v.size||1,a=v.height||v.size||1,Z=v.depth||v.size||1,x=v.tileWidth||v.tileSize||1,i=v.tileHeight||v.tileSize||1,g=v.alignHorizontal||0,c=v.alignVertical||0,h=0===v.sideOrientation?0:v.sideOrientation||b.e.DEFAULTSIDE;for(let J=0;J<6;J++)void 0===y[J]&&(y[J]=new B.p(0,0,1,1)),n&&void 0===n[J]&&(n[J]=new f.e(1,1,1,1));const E=l/2,W=a/2,s=Z/2,C=[];for(let B=0;B<2;B++)C[B]=N({pattern:P,tileWidth:x,tileHeight:i,width:l,height:a,alignVertical:c,alignHorizontal:g,sideOrientation:h});for(let B=2;B<4;B++)C[B]=N({pattern:P,tileWidth:x,tileHeight:i,width:Z,height:a,alignVertical:c,alignHorizontal:g,sideOrientation:h});let r=c;c===J.d.BOTTOM?r=J.d.TOP:c===J.d.TOP&&(r=J.d.BOTTOM);for(let B=4;B<6;B++)C[B]=N({pattern:P,tileWidth:x,tileHeight:i,width:l,height:Z,alignVertical:r,alignHorizontal:g,sideOrientation:h});let u=[],O=[],d=[],q=[];const L=[],t=[],G=[],R=[];let F=0,S=0;for(let J=0;J<6;J++){const v=C[J].xa.length;t[J]=[],G[J]=[];for(let y=0;y<v/3;y++)t[J].push(new B.n(C[J].xa[3*y],C[J].xa[3*y+1],C[J].xa[3*y+2])),G[J].push(new B.n(C[J].ya[3*y],C[J].ya[3*y+1],C[J].ya[3*y+2]));F=C[J].Aa.length,R[J]=[];for(let n=0;n<F;n+=2)R[J][n]=y[J].x+(y[J].z-y[J].x)*C[J].Aa[n],R[J][n+1]=y[J].y+(y[J].w-y[J].y)*C[J].Aa[n+1],Y.e&&(R[J][n+1]=1-R[J][n+1]);if(d=d.concat(R[J]),q=q.concat(C[J].indices.map((v=>v+S))),S+=t[J].length,n)for(let y=0;y<4;y++)L.push(n[J].r,n[J].g,n[J].b,n[J].a)}const w=new B.n(0,0,s),k=B.d.RotationY(Math.PI);u=t[0].map((v=>B.n.TransformNormal(v,k).add(w))).map((v=>[v.x,v.y,v.z])).reduce(((v,y)=>v.concat(y)),[]),O=G[0].map((v=>B.n.TransformNormal(v,k))).map((v=>[v.x,v.y,v.z])).reduce(((v,y)=>v.concat(y)),[]),u=u.concat(t[1].map((v=>v.od(w))).map((v=>[v.x,v.y,v.z])).reduce(((v,y)=>v.concat(y)),[])),O=O.concat(G[1].map((v=>[v.x,v.y,v.z])).reduce(((v,y)=>v.concat(y)),[]));const M=new B.n(E,0,0),I=B.d.RotationY(-Math.PI/2);u=u.concat(t[2].map((v=>B.n.TransformNormal(v,I).add(M))).map((v=>[v.x,v.y,v.z])).reduce(((v,y)=>v.concat(y)),[])),O=O.concat(G[2].map((v=>B.n.TransformNormal(v,I))).map((v=>[v.x,v.y,v.z])).reduce(((v,y)=>v.concat(y)),[]));const j=B.d.RotationY(Math.PI/2);u=u.concat(t[3].map((v=>B.n.TransformNormal(v,j).od(M))).map((v=>[v.x,v.y,v.z])).reduce(((v,y)=>v.concat(y)),[])),O=O.concat(G[3].map((v=>B.n.TransformNormal(v,j))).map((v=>[v.x,v.y,v.z])).reduce(((v,y)=>v.concat(y)),[]));const V=new B.n(0,W,0),p=B.d.RotationX(Math.PI/2);u=u.concat(t[4].map((v=>B.n.TransformNormal(v,p).add(V))).map((v=>[v.x,v.y,v.z])).reduce(((v,y)=>v.concat(y)),[])),O=O.concat(G[4].map((v=>B.n.TransformNormal(v,p))).map((v=>[v.x,v.y,v.z])).reduce(((v,y)=>v.concat(y)),[]));const H=B.d.RotationX(-Math.PI/2);u=u.concat(t[5].map((v=>B.n.TransformNormal(v,H).od(V))).map((v=>[v.x,v.y,v.z])).reduce(((v,y)=>v.concat(y)),[])),O=O.concat(G[5].map((v=>B.n.TransformNormal(v,H))).map((v=>[v.x,v.y,v.z])).reduce(((v,y)=>v.concat(y)),[])),b.e._ComputeSides(h,u,q,O,d);const A=new b.e;if(A.indices=q,A.xa=u,A.ya=O,A.Aa=d,n){const v=h===b.e.DOUBLESIDE?L.concat(L):L;A.za=v}return A}function c(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new J.d(v,n);y.sideOrientation=J.d._GetDefaultSideOrientation(y.sideOrientation),B._originalBuilderSideOrientation=y.sideOrientation;return g(y).Ca(B,y.updatable),B}b.e.CreateTiledPlane=N;b.e.CreateTiledBox=g;var h=n(11703),E=n(11070),W=n(11390);function s(v){const y=v.height||2;let n=0===v.diameterTop?0:v.diameterTop||v.diameter||1,P=0===v.diameterBottom?0:v.diameterBottom||v.diameter||1;n=n||1e-5,P=P||1e-5;const l=0|(v.tessellation||24),a=0|(v.subdivisions||1),Z=!!v.hasRings,x=!!v.enclose,N=0===v.cap?0:v.cap||J.d.CAP_ALL,i=v.arc&&(v.arc<=0||v.arc>1)?1:v.arc||1,g=0===v.sideOrientation?0:v.sideOrientation||b.e.DEFAULTSIDE,c=v.faceUV||new Array(3),h=v.faceColors,E=2+(1+(1!==i&&x?2:0))*(Z?a:1);let s;for(s=0;s<E;s++)h&&void 0===h[s]&&(h[s]=new f.e(1,1,1,1));for(s=0;s<E;s++)c&&void 0===c[s]&&(c[s]=new B.p(0,0,1,1));const C=[],r=[],u=[],O=[],d=[],q=2*Math.PI*i/l;let L,t,G;const R=(P-n)/2/y,F=B.n.Zero(),S=B.n.Zero(),w=B.n.Zero(),k=B.n.Zero(),M=B.n.Zero(),I=W.c.Y;let j,V,p,H=1,A=1,X=0,U=0;for(j=0;j<=a;j++)for(t=j/a,G=(t*(n-P)+P)/2,H=Z&&0!==j&&j!==a?2:1,p=0;p<H;p++){for(Z&&(A+=p),x&&(A+=2*p),V=0;V<=l;V++)L=V*q,F.x=Math.cos(-L)*G,F.y=-y/2+t*y,F.z=Math.sin(-L)*G,0===n&&j===a?(S.x=u[u.length-3*(l+1)],S.y=u[u.length-3*(l+1)+1],S.z=u[u.length-3*(l+1)+2]):(S.x=F.x,S.z=F.z,S.y=Math.sqrt(S.x*S.x+S.z*S.z)*R,S.normalize()),0===V&&(w.p(F),k.p(S)),r.push(F.x,F.y,F.z),u.push(S.x,S.y,S.z),U=Z?X!==A?c[A].y:c[A].w:c[A].y+(c[A].w-c[A].y)*t,O.push(c[A].x+(c[A].z-c[A].x)*V/l,Y.e?1-U:U),h&&d.push(h[A].r,h[A].g,h[A].b,h[A].a);1!==i&&x&&(r.push(F.x,F.y,F.z),r.push(0,F.y,0),r.push(0,F.y,0),r.push(w.x,w.y,w.z),B.n.CrossToRef(I,S,M),M.normalize(),u.push(M.x,M.y,M.z,M.x,M.y,M.z),B.n.CrossToRef(k,I,M),M.normalize(),u.push(M.x,M.y,M.z,M.x,M.y,M.z),U=Z?X!==A?c[A+1].y:c[A+1].w:c[A+1].y+(c[A+1].w-c[A+1].y)*t,O.push(c[A+1].x,Y.e?1-U:U),O.push(c[A+1].z,Y.e?1-U:U),U=Z?X!==A?c[A+2].y:c[A+2].w:c[A+2].y+(c[A+2].w-c[A+2].y)*t,O.push(c[A+2].x,Y.e?1-U:U),O.push(c[A+2].z,Y.e?1-U:U),h&&(d.push(h[A+1].r,h[A+1].g,h[A+1].b,h[A+1].a),d.push(h[A+1].r,h[A+1].g,h[A+1].b,h[A+1].a),d.push(h[A+2].r,h[A+2].g,h[A+2].b,h[A+2].a),d.push(h[A+2].r,h[A+2].g,h[A+2].b,h[A+2].a))),X!==A&&(X=A)}const z=1!==i&&x?l+4:l;for(j=0,A=0;A<a;A++){let v=0,y=0,n=0,B=0;for(V=0;V<l;V++)v=j*(z+1)+V,y=(j+1)*(z+1)+V,n=j*(z+1)+(V+1),B=(j+1)*(z+1)+(V+1),C.push(v,y,n),C.push(B,n,y);1!==i&&x&&(C.push(v+2,y+2,n+2),C.push(B+2,n+2,y+2),C.push(v+4,y+4,n+4),C.push(B+4,n+4,y+4)),j=Z?j+2:j+1}const e=v=>{const J=v?n/2:P/2;if(0===J)return;let b,a,Z;const x=v?c[E-1]:c[0];let f=null;h&&(f=v?h[E-1]:h[0]);const N=r.length/3,g=v?y/2:-y/2,W=new B.n(0,g,0);r.push(W.x,W.y,W.z),u.push(0,v?1:-1,0);const s=x.y+.5*(x.w-x.y);O.push(x.x+.5*(x.z-x.x),Y.e?1-s:s),f&&d.push(f.r,f.g,f.b,f.a);const q=new B.j(.5,.5);for(Z=0;Z<=l;Z++){b=2*Math.PI*Z*i/l;const y=Math.cos(-b),n=Math.sin(-b);a=new B.n(y*J,g,n*J);const P=new B.j(y*q.x+.5,n*q.y+.5);r.push(a.x,a.y,a.z),u.push(0,v?1:-1,0);const N=x.y+(x.w-x.y)*P.y;O.push(x.x+(x.z-x.x)*P.x,Y.e?1-N:N),f&&d.push(f.r,f.g,f.b,f.a)}for(Z=0;Z<l;Z++)v?(C.push(N),C.push(N+(Z+2)),C.push(N+(Z+1))):(C.push(N),C.push(N+(Z+1)),C.push(N+(Z+2)))};N!==J.d.CAP_START&&N!==J.d.CAP_ALL||e(!1),N!==J.d.CAP_END&&N!==J.d.CAP_ALL||e(!0),b.e._ComputeSides(g,r,C,u,O,v.frontUVs,v.backUVs);const K=new b.e;return K.indices=C,K.xa=r,K.ya=u,K.Aa=O,h&&(K.za=d),K}function C(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const B=new J.d(v,n);y.sideOrientation=J.d._GetDefaultSideOrientation(y.sideOrientation),B._originalBuilderSideOrientation=y.sideOrientation;return s(y).Ca(B,y.updatable),B}function r(v){const y=[],n=[],J=[],P=[],l=v.diameter||1,a=v.thickness||.5,Z=0|(v.tessellation||16),x=0===v.sideOrientation?0:v.sideOrientation||b.e.DEFAULTSIDE,f=Z+1;for(let b=0;b<=Z;b++){const v=b/Z,x=b*Math.PI*2/Z-Math.PI/2,N=B.d.Translation(l/2,0,0).multiply(B.d.RotationY(x));for(let l=0;l<=Z;l++){const x=1-l/Z,i=l*Math.PI*2/Z+Math.PI,g=Math.cos(i),c=Math.sin(i);let h=new B.n(g,c,0),E=h.scale(a/2);const W=new B.j(v,x);E=B.n.TransformCoordinates(E,N),h=B.n.TransformNormal(h,N),n.push(E.x,E.y,E.z),J.push(h.x,h.y,h.z),P.push(W.x,Y.e?1-W.y:W.y);const s=(b+1)%f,C=(l+1)%f;y.push(b*f+l),y.push(b*f+C),y.push(s*f+l),y.push(b*f+C),y.push(s*f+C),y.push(s*f+l)}}b.e._ComputeSides(x,n,y,J,P,v.frontUVs,v.backUVs);const N=new b.e;return N.indices=y,N.xa=n,N.ya=J,N.Aa=P,N}function u(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const B=new J.d(v,n);y.sideOrientation=J.d._GetDefaultSideOrientation(y.sideOrientation),B._originalBuilderSideOrientation=y.sideOrientation;return r(y).Ca(B,y.updatable),B}b.e.CreateCylinder=s,J.d.CreateCylinder=(v,y,n,B,P,b,Y,l,a)=>{void 0!==Y&&Y instanceof E.e||(void 0!==Y&&(a=l||J.d.DEFAULTSIDE,l=Y),Y=b,b=1);return C(v,{height:y,diameterTop:n,diameterBottom:B,tessellation:P,subdivisions:b,sideOrientation:a,updatable:l},Y)};function O(v){const y=[],n=[],J=[],P=[],l=v.radius||2,a=v.tube||.5,Z=v.radialSegments||32,x=v.tubularSegments||32,f=v.p||2,N=v.q||3,i=0===v.sideOrientation?0:v.sideOrientation||b.e.DEFAULTSIDE,g=v=>{const y=Math.cos(v),n=Math.sin(v),J=N/f*v,P=Math.cos(J),b=l*(2+P)*.5*y,Y=l*(2+P)*n*.5,a=l*Math.sin(J)*.5;return new B.n(b,Y,a)};let c,h;for(c=0;c<=Z;c++){const v=c%Z/Z*2*f*Math.PI,y=g(v),J=g(v+.01),b=J.od(y);let l=J.add(y);const N=B.n.Cross(b,l);for(l=B.n.Cross(N,b),N.normalize(),l.normalize(),h=0;h<x;h++){const v=h%x/x*2*Math.PI,B=-a*Math.cos(v),J=a*Math.sin(v);n.push(y.x+B*l.x+J*N.x),n.push(y.y+B*l.y+J*N.y),n.push(y.z+B*l.z+J*N.z),P.push(c/Z),P.push(Y.e?1-h/x:h/x)}}for(c=0;c<Z;c++)for(h=0;h<x;h++){const v=(h+1)%x,n=c*x+h,B=(c+1)*x+h,J=(c+1)*x+v,P=c*x+v;y.push(P),y.push(B),y.push(n),y.push(P),y.push(J),y.push(B)}b.e.ComputeNormals(n,y,J),b.e._ComputeSides(i,n,y,J,P,v.frontUVs,v.backUVs);const E=new b.e;return E.indices=y,E.xa=n,E.ya=J,E.Aa=P,E}function d(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const B=new J.d(v,n);y.sideOrientation=J.d._GetDefaultSideOrientation(y.sideOrientation),B._originalBuilderSideOrientation=y.sideOrientation;return O(y).Ca(B,y.updatable),B}b.e.CreateTorus=r,J.d.CreateTorus=(v,y,n,B,J,P,b)=>u(v,{diameter:y,thickness:n,tessellation:B,sideOrientation:b,updatable:P},J);b.e.CreateTorusKnot=O,J.d.CreateTorusKnot=(v,y,n,B,J,P,b,Y,l,a)=>d(v,{radius:y,tube:n,radialSegments:B,tubularSegments:J,p:P,q:b,sideOrientation:a,updatable:l},Y);var q=n(12770),L=n(10801),t=n(11567),G=n(11086),R=n(10820);class F extends B.j{constructor(v,y){super(v.x,v.y),this.index=y}}class S{constructor(){this.elements=[]}add(v){const y=[];return v.forEach((v=>{const n=new F(v,this.elements.length);y.push(n),this.elements.push(n)})),y}computeBounds(){const v=new B.j(this.elements[0].x,this.elements[0].y),y=new B.j(this.elements[0].x,this.elements[0].y);return this.elements.forEach((n=>{n.x<v.x?v.x=n.x:n.x>y.x&&(y.x=n.x),n.y<v.y?v.y=n.y:n.y>y.y&&(y.y=n.y)})),{min:v,max:y,width:y.x-v.x,height:y.y-v.y}}}class w{_addToepoint(v){for(const y of v)this._epoints.push(y.x,y.y)}constructor(v,y,n){let B,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new S,this._outlinepoints=new S,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=J,this._name=v,this._scene=n||R.b.LastCreatedScene,B=y instanceof t.g?y.getPoints():y,this._addToepoint(B),this._points.add(B),this._outlinepoints.add(B),"undefined"===typeof this.bjsEarcut&&L.e.Warn("Earcut was not found, the polygon will not be built.")}addHole(v){this._points.add(v);const y=new S;return y.add(v),this._holes.push(y),this._eholes.push(this._epoints.length/2),this._addToepoint(v),this}build(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const B=new J.d(this._name,this._scene),b=this.buildVertexData(y,n);return B.Ga(P.i.PositionKind,b.xa,v),B.Ga(P.i.NormalKind,b.ya,v),B.Ga(P.i.UVKind,b.Aa,v),B.setIndices(b.indices),B}buildVertexData(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const n=new b.e,B=[],J=[],P=[],Y=this._points.computeBounds();this._points.elements.forEach((v=>{B.push(0,1,0),J.push(v.x,0,v.y),P.push((v.x-Y.min.x)/Y.width,(v.y-Y.min.y)/Y.height)}));const l=[],a=this.bjsEarcut(this._epoints,this._eholes,2);for(let b=0;b<a.length;b++)l.push(a[b]);if(v>0){const n=J.length/3;this._points.elements.forEach((y=>{B.push(0,-1,0),J.push(y.x,-v,y.y),P.push(1-(y.x-Y.min.x)/Y.width,1-(y.y-Y.min.y)/Y.height)}));const b=l.length;for(let v=0;v<b;v+=3){const y=l[v+0],B=l[v+1],J=l[v+2];l.push(J+n),l.push(B+n),l.push(y+n)}this._addSide(J,B,P,l,Y,this._outlinepoints,v,!1,y),this._holes.forEach((n=>{this._addSide(J,B,P,l,Y,n,v,!0,y)}))}return n.indices=l,n.xa=J,n.ya=B,n.Aa=P,n}_addSide(v,y,n,J,P,b,Y,l,a){let Z=v.length/3,x=0;for(let f=0;f<b.elements.length;f++){const N=b.elements[f],i=b.elements[(f+1)%b.elements.length];v.push(N.x,0,N.y),v.push(N.x,-Y,N.y),v.push(i.x,0,i.y),v.push(i.x,-Y,i.y);const g=b.elements[(f+b.elements.length-1)%b.elements.length],c=b.elements[(f+2)%b.elements.length];let h=new B.n(-(i.y-N.y),0,i.x-N.x),E=new B.n(-(N.y-g.y),0,N.x-g.x),W=new B.n(-(c.y-i.y),0,c.x-i.x);l||(h=h.scale(-1),E=E.scale(-1),W=W.scale(-1));const s=h.normalizeToNew();let C=E.normalizeToNew(),r=W.normalizeToNew();const u=B.n.Dot(C,s);C=u>a?u<G.b-1?new B.n(N.x,0,N.y).od(new B.n(i.x,0,i.y)).normalize():E.add(h).normalize():s;const O=B.n.Dot(W,h);r=O>a?O<G.b-1?new B.n(i.x,0,i.y).od(new B.n(N.x,0,N.y)).normalize():W.add(h).normalize():s,n.push(x/P.width,0),n.push(x/P.width,1),x+=h.length(),n.push(x/P.width,0),n.push(x/P.width,1),y.push(C.x,C.y,C.z),y.push(C.x,C.y,C.z),y.push(r.x,r.y,r.z),y.push(r.x,r.y,r.z),l?(J.push(Z),J.push(Z+2),J.push(Z+1),J.push(Z+1),J.push(Z+2),J.push(Z+3)):(J.push(Z),J.push(Z+1),J.push(Z+2),J.push(Z+1),J.push(Z+3),J.push(Z+2)),Z+=4}}}function k(v,y,n,J,l,a,Z){const x=n||new Array(3),N=J,i=[],g=Z||!1;for(let P=0;P<3;P++)void 0===x[P]&&(x[P]=new B.p(0,0,1,1)),N&&void 0===N[P]&&(N[P]=new f.e(1,1,1,1));const c=v.getVerticesData(P.i.PositionKind),h=v.getVerticesData(P.i.NormalKind),E=v.getVerticesData(P.i.UVKind),W=v.wg(),s=c.length/9;let C=0,r=0,u=0,O=0,d=0;const q=[0];if(g)for(let B=s;B<c.length/3;B+=4)r=c[3*(B+2)]-c[3*B],u=c[3*(B+2)+2]-c[3*B+2],O=Math.sqrt(r*r+u*u),d+=O,q.push(d);let L=0,t=0;for(let B=0;B<h.length;B+=3)Math.abs(h[B+1])<.001&&(t=1),Math.abs(h[B+1]-1)<.001&&(t=0),Math.abs(h[B+1]+1)<.001&&(t=2),L=B/3,1===t?(C=L-s,E[2*L]=C%4<1.5?g?x[t].x+(x[t].z-x[t].x)*q[Math.floor(C/4)]/d:x[t].x:g?x[t].x+(x[t].z-x[t].x)*q[Math.floor(C/4)+1]/d:x[t].z,E[2*L+1]=C%2===0?Y.e?1-x[t].w:x[t].w:Y.e?1-x[t].y:x[t].y):(E[2*L]=(1-E[2*L])*x[t].x+E[2*L]*x[t].z,E[2*L+1]=(1-E[2*L+1])*x[t].y+E[2*L+1]*x[t].w,Y.e&&(E[2*L+1]=1-E[2*L+1])),N&&i.push(N[t].r,N[t].g,N[t].b,N[t].a);b.e._ComputeSides(y,c,W,h,E,l,a);const G=new b.e;if(G.indices=W,G.xa=c,G.ya=h,G.Aa=E,N){const v=y===b.e.DOUBLESIDE?i.concat(i):i;G.za=v}return G}function M(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;y.sideOrientation=J.d._GetDefaultSideOrientation(y.sideOrientation);const b=y.shape,Y=y.holes||[],l=y.depth||0,a=y.smoothingThreshold||2,Z=[];let x=[];for(let J=0;J<b.length;J++)Z[J]=new B.j(b[J].x,b[J].z);Z[0].equalsWithEpsilon(Z[Z.length-1],1e-8)&&Z.pop();const f=new w(v,Z,n||R.b.LastCreatedScene,P);for(let J=0;J<Y.length;J++){x=[];for(let v=0;v<Y[J].length;v++)x.push(new B.j(Y[J][v].x,Y[J][v].z));f.addHole(x)}const N=f.build(!1,l,a);N._originalBuilderSideOrientation=y.sideOrientation;return k(N,y.sideOrientation,y.faceUV,y.faceColors,y.frontUVs,y.backUVs,y.wrap).Ca(N,y.updatable),N}function I(v,y){return M(v,y,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function j(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=y.path,P=y.shape,b=y.scale||1,Y=y.rotation||0,l=0===y.cap?0:y.cap||J.d.NO_CAP,a=y.updatable,Z=J.d._GetDefaultSideOrientation(y.sideOrientation),x=y.instance||null,f=y.invertUV||!1,N=y.closeShape||!1;return p(v,P,B,b,Y,null,null,y.closePath||!1,N,l,!1,n,!!a,Z,x,f,y.frontUVs||null,y.backUVs||null,y.firstNormal||null,!!y.adjustFrame)}function V(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=y.path,P=y.shape,b=y.scaleFunction||(()=>1),Y=y.rotationFunction||(()=>0),l=y.closePath||y.ribbonCloseArray||!1,a=y.closeShape||y.ribbonClosePath||!1,Z=0===y.cap?0:y.cap||J.d.NO_CAP,x=y.updatable,f=y.firstNormal||null,N=y.adjustFrame||!1;return p(v,P,B,null,null,b,Y,l,a,Z,!0,n,!!x,J.d._GetDefaultSideOrientation(y.sideOrientation),y.instance||null,y.invertUV||!1,y.frontUVs||null,y.backUVs||null,f,N)}function p(v,y,n,P,b,Y,l,Z,x,f,N,i,g,c,h,E,W,s,C,r){const u=(v,y,n,P,b,Y,l,a,Z,x,f)=>{const N=n.getTangents(),i=n.getNormals(),g=n.getBinormals(),c=n.getDistances();if(f)for(let J=0;J<N.length;J++)if(0==N[J].x&&0==N[J].y&&0==N[J].z&&N[J].p(N[J-1]),0==i[J].x&&0==i[J].y&&0==i[J].z&&i[J].p(i[J-1]),0==g[J].x&&0==g[J].y&&0==g[J].z&&g[J].p(g[J-1]),J>0){let v=N[J-1];B.n.Dot(v,N[J])<0&&N[J].scaleInPlace(-1),v=i[J-1],B.n.Dot(v,i[J])<0&&i[J].scaleInPlace(-1),v=g[J-1],B.n.Dot(v,g[J])<0&&g[J].scaleInPlace(-1)}let h=0;const E=x&&a?a:()=>null!==Y?Y:0,W=x&&l?l:()=>null!==b?b:1;let s=Z===J.d.NO_CAP||Z===J.d.CAP_END?0:2;const C=B.i.Matrix[0];for(let J=0;J<y.length;J++){const n=[],b=E(J,c[J]),Y=W(J,c[J]);B.d.RotationAxisToRef(N[J],h,C);for(let P=0;P<v.length;P++){const b=N[J].scale(v[P].z).add(i[J].scale(v[P].x)).add(g[J].scale(v[P].y)),l=B.n.Zero();B.n.TransformCoordinatesToRef(b,C,l),l.scaleInPlace(Y).addInPlace(y[J]),n[P]=l}P[s]=n,h+=b,s++}const r=v=>{const y=Array(),n=B.n.Zero();let J;for(J=0;J<v.length;J++)n.addInPlace(v[J]);for(n.scaleInPlace(1/v.length),J=0;J<v.length;J++)y.push(n);return y};switch(Z){case J.d.NO_CAP:break;case J.d.CAP_START:P[0]=r(P[2]),P[1]=P[2];break;case J.d.CAP_END:P[s]=P[s-1],P[s+1]=r(P[s-1]);break;case J.d.CAP_ALL:P[0]=r(P[2]),P[1]=P[2],P[s]=P[s-1],P[s+1]=r(P[s-1])}return P};let O,d;if(h){const v=h._creationDataStorage;return O=C?v.path3D.update(n,C):v.path3D.update(n),d=u(y,n,v.path3D,v.pathArray,P,b,Y,l,v.cap,N,r),h=a("",{pathArray:d,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:h},i||void 0)}O=C?new t.k(n,C):new t.k(n);d=u(y,n,O,new Array,P,b,Y,l,f=f<0||f>3?0:f,N,r);const q=a(v,{pathArray:d,closeArray:Z,closePath:x,updatable:g,sideOrientation:c,invertUV:E,frontUVs:W||void 0,backUVs:s||void 0},i);return q._creationDataStorage.pathArray=d,q._creationDataStorage.path3D=O,q._creationDataStorage.cap=f,q}b.e.CreatePolygon=k,J.d.CreatePolygon=function(v,y,n,B,J,P){return M(v,{shape:y,holes:B,updatable:J,sideOrientation:P},n,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},J.d.ExtrudePolygon=function(v,y,n,B,J,P,b){return I(v,{shape:y,holes:J,depth:n,updatable:P,sideOrientation:b},B,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function H(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=y.arc?y.arc<=0||y.arc>1?1:y.arc:1,b=void 0===y.closed||y.closed,Y=y.shape,l=y.radius||1,Z=y.tessellation||64,x=y.clip||0,f=y.updatable,N=J.d._GetDefaultSideOrientation(y.sideOrientation),i=y.cap||J.d.NO_CAP,g=2*Math.PI,c=[],h=y.invertUV||!1;let E=0,W=0;const s=g/Z*P;let C,r;for(E=0;E<=Z-x;E++){for(r=[],i!=J.d.CAP_START&&i!=J.d.CAP_ALL||(r.push(new B.n(0,Y[0].y,0)),r.push(new B.n(Math.cos(E*s)*Y[0].x*l,Y[0].y,Math.sin(E*s)*Y[0].x*l))),W=0;W<Y.length;W++)C=new B.n(Math.cos(E*s)*Y[W].x*l,Y[W].y,Math.sin(E*s)*Y[W].x*l),r.push(C);i!=J.d.CAP_END&&i!=J.d.CAP_ALL||(r.push(new B.n(Math.cos(E*s)*Y[Y.length-1].x*l,Y[Y.length-1].y,Math.sin(E*s)*Y[Y.length-1].x*l)),r.push(new B.n(0,Y[Y.length-1].y,0))),c.push(r)}return a(v,{pathArray:c,closeArray:b,sideOrientation:N,updatable:f,invertUV:h,frontUVs:y.frontUVs,backUVs:y.backUVs},n)}J.d.ExtrudeShape=function(v,y,n,B,P,b){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7?arguments[7]:void 0,a=arguments.length>8?arguments[8]:void 0,Z=arguments.length>9?arguments[9]:void 0;return j(v,{shape:y,path:n,scale:B,rotation:P,cap:0===b?0:b||J.d.NO_CAP,sideOrientation:a,instance:Z,updatable:l},Y)},J.d.ExtrudeShapeCustom=(v,y,n,B,P,b,Y,l,a,Z,x,f)=>V(v,{shape:y,path:n,scaleFunction:B,rotationFunction:P,ribbonCloseArray:b,ribbonClosePath:Y,cap:0===l?0:l||J.d.NO_CAP,sideOrientation:x,instance:f,updatable:Z},a);J.d.CreateLathe=(v,y,n,B,J,P,b)=>H(v,{shape:y,radius:n,tessellation:B,sideOrientation:b,updatable:P},J);var A=n(11453),X=n(11409);function U(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=y.path;let b=y.instance,Y=1;void 0!==y.radius?Y=y.radius:b&&(Y=b._creationDataStorage.radius);const l=y.tessellation||64,Z=y.radiusFunction||null;let x=y.cap||J.d.NO_CAP;const f=y.invertUV||!1,N=y.updatable,i=J.d._GetDefaultSideOrientation(y.sideOrientation);y.arc=y.arc&&(y.arc<=0||y.arc>1)?1:y.arc||1;const g=(v,y,n,P,b,Y,l,a)=>{const Z=y.getTangents(),x=y.getNormals(),f=y.getDistances(),N=2*Math.PI/b*a,i=Y||(()=>P);let g,c,h,E;const W=B.i.Matrix[0];let s=l===J.d.NO_CAP||l===J.d.CAP_END?0:2;for(let J=0;J<v.length;J++){c=i(J,f[J]),g=Array(),h=x[J];for(let y=0;y<b;y++)B.d.RotationAxisToRef(Z[J],N*y,W),E=g[y]?g[y]:B.n.Zero(),B.n.TransformCoordinatesToRef(h,W,E),E.scaleInPlace(c).addInPlace(v[J]),g[y]=E;n[s]=g,s++}const C=(y,n)=>{const B=Array();for(let J=0;J<y;J++)B.push(v[n]);return B};switch(l){case J.d.NO_CAP:break;case J.d.CAP_START:n[0]=C(b,0),n[1]=n[2].slice(0);break;case J.d.CAP_END:n[s]=n[s-1].slice(0),n[s+1]=C(b,v.length-1);break;case J.d.CAP_ALL:n[0]=C(b,0),n[1]=n[2].slice(0),n[s]=n[s-1].slice(0),n[s+1]=C(b,v.length-1)}return n};let c,h;if(b){const v=b._creationDataStorage,n=y.arc||v.arc;return c=v.path3D.update(P),h=g(P,c,v.pathArray,Y,v.tessellation,Z,v.cap,n),b=a("",{pathArray:h,instance:b}),v.path3D=c,v.pathArray=h,v.arc=n,v.radius=Y,b}c=new t.k(P);x=x<0||x>3?0:x,h=g(P,c,new Array,Y,l,Z,x,y.arc);const E=a(v,{pathArray:h,closePath:!0,closeArray:!1,updatable:N,sideOrientation:i,invertUV:f,frontUVs:y.frontUVs,backUVs:y.backUVs},n);return E._creationDataStorage.pathArray=h,E._creationDataStorage.path3D=c,E._creationDataStorage.tessellation=l,E._creationDataStorage.cap=x,E._creationDataStorage.arc=y.arc,E._creationDataStorage.radius=Y,E}function z(v){const y=[];y[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},y[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},y[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},y[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},y[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},y[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},y[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},y[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},y[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},y[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},y[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},y[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},y[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},y[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},y[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const n=v.type&&(v.type<0||v.type>=y.length)?0:v.type||0,J=v.size,P=v.sizeX||J||1,l=v.sizeY||J||1,a=v.sizeZ||J||1,Z=v.custom||y[n],x=Z.face.length,N=v.faceUV||new Array(x),i=v.faceColors,g=void 0===v.flat||v.flat,c=0===v.sideOrientation?0:v.sideOrientation||b.e.DEFAULTSIDE,h=[],E=[],W=[],s=[],C=[];let r=0,u=0;const O=[];let d,q,L,t,G,R,F=0,S=0;if(g)for(S=0;S<x;S++)i&&void 0===i[S]&&(i[S]=new f.e(1,1,1,1)),N&&void 0===N[S]&&(N[S]=new B.p(0,0,1,1));if(g)for(S=0;S<x;S++){const v=Z.face[S].length;for(L=2*Math.PI/v,t=.5*Math.tan(L/2),G=.5,F=0;F<v;F++)h.push(Z.vertex[Z.face[S][F]][0]*P,Z.vertex[Z.face[S][F]][1]*l,Z.vertex[Z.face[S][F]][2]*a),O.push(r),r++,d=N[S].x+(N[S].z-N[S].x)*(.5+t),q=N[S].y+(N[S].w-N[S].y)*(G-.5),s.push(d,Y.e?1-q:q),R=t*Math.cos(L)-G*Math.sin(L),G=t*Math.sin(L)+G*Math.cos(L),t=R,i&&C.push(i[S].r,i[S].g,i[S].b,i[S].a);for(F=0;F<v-2;F++)E.push(O[0+u],O[F+2+u],O[F+1+u]);u+=v}else{for(F=0;F<Z.vertex.length;F++)h.push(Z.vertex[F][0]*P,Z.vertex[F][1]*l,Z.vertex[F][2]*a),s.push(0,Y.e?1:0);for(S=0;S<x;S++)for(F=0;F<Z.face[S].length-2;F++)E.push(Z.face[S][0],Z.face[S][F+2],Z.face[S][F+1])}b.e.ComputeNormals(h,E,W),b.e._ComputeSides(c,h,E,W,s,v.frontUVs,v.backUVs);const w=new b.e;return w.xa=h,w.indices=E,w.ya=W,w.Aa=s,i&&g&&(w.za=C),w}function e(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new J.d(v,n);y.sideOrientation=J.d._GetDefaultSideOrientation(y.sideOrientation),B._originalBuilderSideOrientation=y.sideOrientation;return z(y).Ca(B,y.updatable),B}J.d.CreateTube=(v,y,n,B,J,P,b,Y,l,a)=>U(v,{path:y,radius:n,tessellation:B,radiusFunction:J,arc:1,cap:P,updatable:Y,sideOrientation:l,instance:a},b);function K(v){const y=v.sideOrientation||b.e.DEFAULTSIDE,n=v.radius||1,J=void 0===v.flat||v.flat,P=0|(v.subdivisions||4),l=v.radiusX||n,a=v.radiusY||n,Z=v.radiusZ||n,x=(1+Math.sqrt(5))/2,f=[-1,x,-0,1,x,0,-1,-x,0,1,-x,0,0,-1,-x,0,1,-x,0,-1,x,0,1,x,x,0,1,x,0,-1,-x,0,1,-x,0,-1],N=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],i=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],g=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],c=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],h=[],E=[],W=[],s=[];let C=0;const r=new Array(3),u=new Array(3);let O;for(O=0;O<3;O++)r[O]=B.n.Zero(),u[O]=B.j.Zero();for(let b=0;b<20;b++){for(O=0;O<3;O++){const v=N[3*b+O];r[O].Ae(f[3*i[v]],f[3*i[v]+1],f[3*i[v]+2]),r[O].normalize(),u[O].Ae(.134765625*g[2*v]+.05859375+-.0390625*c[b],.2333984375*g[2*v+1]+.025390625+.01953125*c[b])}const v=(v,y,n,b)=>{const x=B.n.Lerp(r[0],r[2],y/P),f=B.n.Lerp(r[1],r[2],y/P),N=P===y?r[2]:B.n.Lerp(x,f,v/(P-y));let i;if(N.normalize(),J){const v=B.n.Lerp(r[0],r[2],b/P),y=B.n.Lerp(r[1],r[2],b/P);i=B.n.Lerp(v,y,n/(P-b))}else i=new B.n(N.x,N.y,N.z);i.x/=l,i.y/=a,i.z/=Z,i.normalize();const g=B.j.Lerp(u[0],u[2],y/P),c=B.j.Lerp(u[1],u[2],y/P),O=P===y?u[2]:B.j.Lerp(g,c,v/(P-y));E.push(N.x*l,N.y*a,N.z*Z),W.push(i.x,i.y,i.z),s.push(O.x,Y.e?1-O.y:O.y),h.push(C),C++};for(let y=0;y<P;y++)for(let n=0;n+y<P;n++)v(n,y,n+1/3,y+1/3),v(n+1,y,n+1/3,y+1/3),v(n,y+1,n+1/3,y+1/3),n+y+1<P&&(v(n+1,y,n+2/3,y+2/3),v(n+1,y+1,n+2/3,y+2/3),v(n,y+1,n+2/3,y+2/3))}b.e._ComputeSides(y,E,h,W,s,v.frontUVs,v.backUVs);const d=new b.e;return d.indices=h,d.xa=E,d.ya=W,d.Aa=s,d}function D(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new J.d(v,n);y.sideOrientation=J.d._GetDefaultSideOrientation(y.sideOrientation),B._originalBuilderSideOrientation=y.sideOrientation;return K(y).Ca(B,y.updatable),B}b.e.CreatePolyhedron=z,J.d.CreatePolyhedron=(v,y,n)=>e(v,y,n);b.e.CreateIcoSphere=K,J.d.CreateIcoSphere=(v,y,n)=>D(v,y,n);var Q=n(11091);const o=new B.n(1,0,0),T=new B.n(-1,0,0),m=new B.n(0,1,0),vv=new B.n(0,-1,0),yv=new B.n(0,0,1),nv=new B.n(0,0,-1);class Bv{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.n.Zero(),y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.n.Up(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.j.Zero(),J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=v,this.k=y,this.uv=n,this.vertexIdx=J,this.vertexIdxForBones=P,this.localPositionOverride=b,this.localNormalOverride=Y,this.matrixIndicesOverride=l,this.matrixWeightsOverride=a}clone(){var v,y,n,B;return new Bv(this.position.clone(),this.k.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(v=this.localPositionOverride)||void 0===v?void 0:v.slice(),null===(y=this.localNormalOverride)||void 0===y?void 0:y.slice(),null===(n=this.matrixIndicesOverride)||void 0===n?void 0:n.slice(),null===(B=this.matrixWeightsOverride)||void 0===B?void 0:B.slice())}}function Jv(v,y,n){var l,a,Z,x;const f=!!y.skeleton,N=n.localMode||f,i=y.wg(),g=f?y.le(!0,!0):y.getVerticesData(P.i.PositionKind),c=f?y.getNormalsData(!0,!0):y.getVerticesData(P.i.NormalKind),h=N?f?y.getVerticesData(P.i.PositionKind):g:null,E=N?f?y.getVerticesData(P.i.NormalKind):c:null,W=y.getVerticesData(P.i.UVKind),s=f?y.getVerticesData(P.i.MatricesIndicesKind):null,C=f?y.getVerticesData(P.i.MatricesWeightsKind):null,r=f?y.getVerticesData(P.i.MatricesIndicesExtraKind):null,u=f?y.getVerticesData(P.i.MatricesWeightsExtraKind):null,O=n.position||B.n.Zero();let d=n.k||B.n.Up();const q=n.size||B.n.One(),L=n.angle||0;if(!d){const v=new B.n(0,0,1),n=y.va().activeCamera,J=B.n.TransformCoordinates(v,n.getWorldMatrix());d=n.globalPosition.od(J)}const t=-Math.atan2(d.z,d.x)-Math.PI/2,G=Math.sqrt(d.x*d.x+d.z*d.z),R=Math.atan2(d.y,G),F=new b.e;F.indices=[],F.xa=[],F.ya=[],F.Aa=[],F.matricesIndices=f?[]:null,F.matricesWeights=f?[]:null,F.matricesIndicesExtra=r?[]:null,F.matricesWeightsExtra=u?[]:null;let S=0;const w=(v,y)=>{const J=new Bv;if(!i||!g||!c)return J;const P=i[v];if(J.vertexIdx=3*P,J.vertexIdxForBones=4*P,J.position=new B.n(g[3*P],g[3*P+1],g[3*P+2]),B.n.TransformCoordinatesToRef(J.position,y,J.position),J.k=new B.n(c[3*P],c[3*P+1],c[3*P+2]),B.n.TransformNormalToRef(J.k,y,J.k),n.captureUVS&&W){const v=W[2*P+1];J.uv=new B.j(W[2*P],Y.e?1-v:v)}return J},k=[0,0,0,0],M=(v,y)=>{if(0===v.length)return v;const n=.5*Math.abs(B.n.Dot(q,y)),J=(v,y,n,B)=>{for(let J=0;J<B;++J)if(v[n+J]===y)return n+J;return-1},P=(v,P)=>{const b=B.n.GetClipFactor(v.position,P.position,y,n);let Y=k,l=k;if(s&&C){const y=v.matrixIndicesOverride?0:v.vertexIdxForBones,n=v.matrixIndicesOverride??s,B=v.matrixWeightsOverride??C,a=P.matrixIndicesOverride?0:P.vertexIdxForBones,Z=P.matrixIndicesOverride??s,x=P.matrixWeightsOverride??C;Y=[0,0,0,0],l=[0,0,0,0];let f=0;for(let v=0;v<4;++v)if(B[y+v]>0){const P=J(Z,n[y+v],a,4);Y[f]=n[y+v],l[f]=(0,Q.k)(B[y+v],P>=0?x[P]:0,b),f++}for(let v=0;v<4&&f<4;++v){const B=Z[a+v];-1===J(n,B,y,4)&&(Y[f]=B,l[f]=(0,Q.k)(0,x[a+v],b),f++)}const N=l[0]+l[1]+l[2]+l[3];l[0]/=N,l[1]/=N,l[2]/=N,l[3]/=N}const a=v.localPositionOverride?v.localPositionOverride[0]:(null===h||void 0===h?void 0:h[v.vertexIdx])??0,Z=v.localPositionOverride?v.localPositionOverride[1]:(null===h||void 0===h?void 0:h[v.vertexIdx+1])??0,x=v.localPositionOverride?v.localPositionOverride[2]:(null===h||void 0===h?void 0:h[v.vertexIdx+2])??0,f=P.localPositionOverride?P.localPositionOverride[0]:(null===h||void 0===h?void 0:h[P.vertexIdx])??0,N=P.localPositionOverride?P.localPositionOverride[1]:(null===h||void 0===h?void 0:h[P.vertexIdx+1])??0,i=P.localPositionOverride?P.localPositionOverride[2]:(null===h||void 0===h?void 0:h[P.vertexIdx+2])??0,g=v.localNormalOverride?v.localNormalOverride[0]:(null===E||void 0===E?void 0:E[v.vertexIdx])??0,c=v.localNormalOverride?v.localNormalOverride[1]:(null===E||void 0===E?void 0:E[v.vertexIdx+1])??0,W=v.localNormalOverride?v.localNormalOverride[2]:(null===E||void 0===E?void 0:E[v.vertexIdx+2])??0,r=g+((P.localNormalOverride?P.localNormalOverride[0]:(null===E||void 0===E?void 0:E[P.vertexIdx])??0)-g)*b,u=c+((P.localNormalOverride?P.localNormalOverride[1]:(null===E||void 0===E?void 0:E[P.vertexIdx+1])??0)-c)*b,O=W+((P.localNormalOverride?P.localNormalOverride[2]:(null===E||void 0===E?void 0:E[P.vertexIdx+2])??0)-W)*b,d=Math.sqrt(r*r+u*u+O*O);return new Bv(B.n.Lerp(v.position,P.position,b),B.n.Lerp(v.k,P.k,b).normalize(),B.j.Lerp(v.uv,P.uv,b),-1,-1,h?[a+(f-a)*b,Z+(N-Z)*b,x+(i-x)*b]:null,E?[r/d,u/d,O/d]:null,Y,l)};let b=null;v.length>3&&(b=[]);for(let Y=0;Y<v.length;Y+=3){let J=0,l=null,a=null,Z=null,x=null;const f=B.n.Dot(v[Y].position,y)-n>0,N=B.n.Dot(v[Y+1].position,y)-n>0,i=B.n.Dot(v[Y+2].position,y)-n>0;switch(J=(f?1:0)+(N?1:0)+(i?1:0),J){case 0:v.length>3?(b.push(v[Y]),b.push(v[Y+1]),b.push(v[Y+2])):b=v;break;case 1:if(b=b??new Array,f&&(l=v[Y+1],a=v[Y+2],Z=P(v[Y],l),x=P(v[Y],a)),N){l=v[Y],a=v[Y+2],Z=P(v[Y+1],l),x=P(v[Y+1],a),b.push(Z),b.push(a.clone()),b.push(l.clone()),b.push(a.clone()),b.push(Z.clone()),b.push(x);break}i&&(l=v[Y],a=v[Y+1],Z=P(v[Y+2],l),x=P(v[Y+2],a)),l&&a&&Z&&x&&(b.push(l.clone()),b.push(a.clone()),b.push(Z),b.push(x),b.push(Z.clone()),b.push(a.clone()));break;case 2:b=b??new Array,f||(l=v[Y].clone(),a=P(l,v[Y+1]),Z=P(l,v[Y+2]),b.push(l),b.push(a),b.push(Z)),N||(l=v[Y+1].clone(),a=P(l,v[Y+2]),Z=P(l,v[Y]),b.push(l),b.push(a),b.push(Z)),i||(l=v[Y+2].clone(),a=P(l,v[Y]),Z=P(l,v[Y+1]),b.push(l),b.push(a),b.push(Z))}}return b},I=y instanceof J.d?y:null,j=null===I||void 0===I?void 0:I._thinInstanceDataStorage.matrixData,V=(null===I||void 0===I?void 0:I.nc)||1,p=B.i.Matrix[0];p.p(B.d.IdentityReadOnly);for(let J=0;J<V;++J){if(null!==I&&void 0!==I&&I.hasThinInstances&&j){const v=16*J;p.setRowFromFloats(0,j[v+0],j[v+1],j[v+2],j[v+3]),p.setRowFromFloats(1,j[v+4],j[v+5],j[v+6],j[v+7]),p.setRowFromFloats(2,j[v+8],j[v+9],j[v+10],j[v+11]),p.setRowFromFloats(3,j[v+12],j[v+13],j[v+14],j[v+15])}const v=B.d.RotationYawPitchRoll(t,R,L).multiply(B.d.Translation(O.x,O.y,O.z)),P=B.d.Invert(v),b=y.getWorldMatrix(),l=p.multiply(b).multiply(P),a=new Array(3);for(let y=0;y<i.length;y+=3){let v=a;if(v[0]=w(y,l),v[1]=w(y+1,l),v[2]=w(y+2,l),!(n.cullBackFaces&&-v[0].k.z<=0&&-v[1].k.z<=0&&-v[2].k.z<=0)&&(v=M(v,o),v&&(v=M(v,T),v&&(v=M(v,m),v&&(v=M(v,vv),v&&(v=M(v,yv),v&&(v=M(v,nv),v)))))))for(let y=0;y<v.length;y++){const B=v[y];if(F.indices.push(S),N?(B.localPositionOverride?(F.xa[3*S]=B.localPositionOverride[0],F.xa[3*S+1]=B.localPositionOverride[1],F.xa[3*S+2]=B.localPositionOverride[2]):h&&(F.xa[3*S]=h[B.vertexIdx],F.xa[3*S+1]=h[B.vertexIdx+1],F.xa[3*S+2]=h[B.vertexIdx+2]),B.localNormalOverride?(F.ya[3*S]=B.localNormalOverride[0],F.ya[3*S+1]=B.localNormalOverride[1],F.ya[3*S+2]=B.localNormalOverride[2]):E&&(F.ya[3*S]=E[B.vertexIdx],F.ya[3*S+1]=E[B.vertexIdx+1],F.ya[3*S+2]=E[B.vertexIdx+2])):(B.position.toArray(F.xa,3*S),B.k.toArray(F.ya,3*S)),F.matricesIndices&&F.matricesWeights&&(B.matrixIndicesOverride?(F.matricesIndices[4*S]=B.matrixIndicesOverride[0],F.matricesIndices[4*S+1]=B.matrixIndicesOverride[1],F.matricesIndices[4*S+2]=B.matrixIndicesOverride[2],F.matricesIndices[4*S+3]=B.matrixIndicesOverride[3]):(s&&(F.matricesIndices[4*S]=s[B.vertexIdxForBones],F.matricesIndices[4*S+1]=s[B.vertexIdxForBones+1],F.matricesIndices[4*S+2]=s[B.vertexIdxForBones+2],F.matricesIndices[4*S+3]=s[B.vertexIdxForBones+3]),r&&F.matricesIndicesExtra&&(F.matricesIndicesExtra[4*S]=r[B.vertexIdxForBones],F.matricesIndicesExtra[4*S+1]=r[B.vertexIdxForBones+1],F.matricesIndicesExtra[4*S+2]=r[B.vertexIdxForBones+2],F.matricesIndicesExtra[4*S+3]=r[B.vertexIdxForBones+3])),B.matrixWeightsOverride?(F.matricesWeights[4*S]=B.matrixWeightsOverride[0],F.matricesWeights[4*S+1]=B.matrixWeightsOverride[1],F.matricesWeights[4*S+2]=B.matrixWeightsOverride[2],F.matricesWeights[4*S+3]=B.matrixWeightsOverride[3]):(C&&(F.matricesWeights[4*S]=C[B.vertexIdxForBones],F.matricesWeights[4*S+1]=C[B.vertexIdxForBones+1],F.matricesWeights[4*S+2]=C[B.vertexIdxForBones+2],F.matricesWeights[4*S+3]=C[B.vertexIdxForBones+3]),u&&F.matricesWeightsExtra&&(F.matricesWeightsExtra[4*S]=u[B.vertexIdxForBones],F.matricesWeightsExtra[4*S+1]=u[B.vertexIdxForBones+1],F.matricesWeightsExtra[4*S+2]=u[B.vertexIdxForBones+2],F.matricesWeightsExtra[4*S+3]=u[B.vertexIdxForBones+3]))),n.captureUVS)B.uv.toArray(F.Aa,2*S);else{F.Aa.push(.5+B.position.x/q.x);const v=.5+B.position.y/q.y;F.Aa.push(Y.e?1-v:v)}S++}}}0===F.indices.length&&(F.indices=null),0===F.xa.length&&(F.xa=null),0===F.ya.length&&(F.ya=null),0===F.Aa.length&&(F.Aa=null),0===(null===(l=F.matricesIndices)||void 0===l?void 0:l.length)&&(F.matricesIndices=null),0===(null===(a=F.matricesWeights)||void 0===a?void 0:a.length)&&(F.matricesWeights=null),0===(null===(Z=F.matricesIndicesExtra)||void 0===Z?void 0:Z.length)&&(F.matricesIndicesExtra=null),0===(null===(x=F.matricesWeightsExtra)||void 0===x?void 0:x.length)&&(F.matricesWeightsExtra=null);const H=new J.d(v,y.va());return F.Ca(H),N?(H.skeleton=y.skeleton,H.parent=y):(H.position=O.clone(),H.rotation=new B.n(R,t,L)),H.ak(!0),H.refreshBoundingInfo(!0,!0),H}function Pv(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const y=0|Math.max(v.subdivisions?v.subdivisions:2,1),n=0|Math.max(v.tessellation?v.tessellation:16,3),J=Math.max(v.height?v.height:1,0),P=Math.max(v.radius?v.radius:.25,0),l=0|Math.max(v.capSubdivisions?v.capSubdivisions:6,1),a=n,Z=y,x=Math.max(v.radiusTop?v.radiusTop:P,0),f=Math.max(v.radiusBottom?v.radiusBottom:P,0),N=J-(x+f),i=2*Math.PI,g=Math.max(v.topCapSubdivisions?v.topCapSubdivisions:l,1),c=Math.max(v.bottomCapSubdivisions?v.bottomCapSubdivisions:l,1),h=Math.acos((f-x)/J);let E=[];const W=[],s=[],C=[];let r=0;const u=[],O=.5*N,d=.5*Math.PI;let q,L;const t=B.n.Zero(),G=B.n.Zero(),R=Math.cos(h),F=Math.sin(h),S=new B.j(x*F,O+x*R).od(new B.j(f*F,f*R-O)).length(),w=x*h+S+f*(d-h);let k=0;for(L=0;L<=g;L++){const v=[],y=d-h*(L/g);k+=x*h/g;const n=Math.cos(y),B=Math.sin(y),J=n*x;for(q=0;q<=a;q++){const y=q/a,P=y*i+0,b=Math.sin(P),l=Math.cos(P);G.x=J*b,G.y=O+B*x,G.z=J*l,W.push(G.x,G.y,G.z),t.set(n*b,B,n*l),s.push(t.x,t.y,t.z),C.push(y,Y.e?k/w:1-k/w),v.push(r),r++}u.push(v)}const M=J-x-f+R*x-R*f,I=F*(f-x)/M;for(L=1;L<=Z;L++){const v=[];k+=S/Z;const y=F*(L*(f-x)/Z+x);for(q=0;q<=a;q++){const n=q/a,B=n*i+0,J=Math.sin(B),P=Math.cos(B);G.x=y*J,G.y=O+R*x-L*M/Z,G.z=y*P,W.push(G.x,G.y,G.z),t.set(J,I,P).normalize(),s.push(t.x,t.y,t.z),C.push(n,Y.e?k/w:1-k/w),v.push(r),r++}u.push(v)}for(L=1;L<=c;L++){const v=[],y=d-h-(Math.PI-h)*(L/c);k+=f*h/c;const n=Math.cos(y),B=Math.sin(y),J=n*f;for(q=0;q<=a;q++){const y=q/a,P=y*i+0,b=Math.sin(P),l=Math.cos(P);G.x=J*b,G.y=B*f-O,G.z=J*l,W.push(G.x,G.y,G.z),t.set(n*b,B,n*l),s.push(t.x,t.y,t.z),C.push(y,Y.e?k/w:1-k/w),v.push(r),r++}u.push(v)}for(q=0;q<a;q++)for(L=0;L<g+Z+c;L++){const v=u[L][q],y=u[L+1][q],n=u[L+1][q+1],B=u[L][q+1];E.push(v),E.push(y),E.push(B),E.push(y),E.push(n),E.push(B)}if(E=E.reverse(),v.orientation&&!v.orientation.equals(B.n.Up())){const y=new B.d;v.orientation.clone().scale(.5*Math.PI).cross(B.n.Up()).toQuaternion().toRotationMatrix(y);const n=B.n.Zero();for(let v=0;v<W.length;v+=3)n.set(W[v],W[v+1],W[v+2]),B.n.TransformCoordinatesToRef(n.clone(),y,n),W[v]=n.x,W[v+1]=n.y,W[v+2]=n.z}const j=new b.e;return j.xa=W,j.ya=s,j.Aa=C,j.indices=E,j}function bv(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:B.n.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new J.d(v,n);return Pv(y).Ca(P,y.updatable),P}J.d.CreateDecal=(v,y,n,B,J,P)=>Jv(v,y,{position:n,k:B,size:J,angle:P});J.d.CreateCapsule=(v,y,n)=>bv(v,y,n),b.e.CreateCapsule=Pv;class Yv{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=v,this.y=y,v!==Math.floor(v)&&(v=Math.floor(v),L.e.Warn("x is not an integer, floor(x) used")),y!==Math.floor(y)&&(y=Math.floor(y),L.e.Warn("y is not an integer, floor(y) used"))}clone(){return new Yv(this.x,this.y)}rotate60About(v){const y=this.x;return this.x=v.x+v.y-this.y,this.y=y+this.y-v.x,this}rotateNeg60About(v){const y=this.x;return this.x=y+this.y-v.y,this.y=v.x+v.y-y,this}rotate120(v,y){v!==Math.floor(v)&&(v=Math.floor(v),L.e.Warn("m not an integer only floor(m) used")),y!==Math.floor(y)&&(y=Math.floor(y),L.e.Warn("n not an integer only floor(n) used"));const n=this.x;return this.x=v-n-this.y,this.y=y+n,this}rotateNeg120(v,y){v!==Math.floor(v)&&(v=Math.floor(v),L.e.Warn("m is not an integer, floor(m) used")),y!==Math.floor(y)&&(y=Math.floor(y),L.e.Warn("n is not an integer,   floor(n) used"));const n=this.x;return this.x=this.y-y,this.y=v+y-n-this.y,this}toCartesianOrigin(v,y){const n=B.n.Zero();return n.x=v.x+2*this.x*y+this.y*y,n.y=v.y+Math.sqrt(3)*this.y*y,n}static Zero(){return new Yv(0,0)}}class lv{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new av("icosahedron","Regular",[[0,G.c,-1],[-G.c,1,0],[-1,0,-G.c],[1,0,-G.c],[G.c,1,0],[0,G.c,1],[-1,0,G.c],[-G.c,-1,0],[0,-G.c,-1],[G.c,-1,0],[1,0,G.c],[0,-G.c,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let v=12;const y={},n=this.m,B=this.n;let J,P,b,Y,l,a=n,Z=1,x=0;0!==B&&(a=(0,Q.g)(n,B)),Z=n/a,x=B/a;const f=Yv.Zero(),N=new Yv(n,B),i=new Yv(-B,n+B),g=Yv.Zero(),c=Yv.Zero(),h=Yv.Zero();let E,W,s,C,r=[];const u=[],O=this.vertByDist,d=(n,B,J,P)=>{E=n+"|"+J,W=B+"|"+P,E in y||W in y?E in y&&!(W in y)?y[W]=y[E]:W in y&&!(E in y)&&(y[E]=y[W]):(y[E]=v,y[W]=v,v++),O[J][0]>2?u[y[E]]=[-O[J][0],O[J][1],y[E]]:u[y[E]]=[r[O[J][0]],O[J][1],y[E]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let q=0;q<20;q++){if(r=this.IDATA.face[q],b=r[2],Y=r[1],l=r[0],s=f.x+"|"+f.y,E=q+"|"+s,E in y||(y[E]=b,u[b]=[r[O[s][0]],O[s][1]]),s=N.x+"|"+N.y,E=q+"|"+s,E in y||(y[E]=Y,u[Y]=[r[O[s][0]],O[s][1]]),s=i.x+"|"+i.y,E=q+"|"+s,E in y||(y[E]=l,u[l]=[r[O[s][0]],O[s][1]]),J=this.IDATA.edgematch[q][0],P=this.IDATA.edgematch[q][1],"B"===P)for(let v=1;v<a;v++)c.x=n-v*(Z+x),c.y=B+v*Z,h.x=-v*x,h.y=v*(Z+x),s=c.x+"|"+c.y,C=h.x+"|"+h.y,d(q,J,s,C);if("O"===P)for(let v=1;v<a;v++)h.x=-v*x,h.y=v*(Z+x),g.x=v*Z,g.y=v*x,s=h.x+"|"+h.y,C=g.x+"|"+g.y,d(q,J,s,C);if(J=this.IDATA.edgematch[q][2],P=this.IDATA.edgematch[q][3],P&&"A"===P)for(let v=1;v<a;v++)g.x=v*Z,g.y=v*x,c.x=n-(a-v)*(Z+x),c.y=B+(a-v)*Z,s=g.x+"|"+g.y,C=c.x+"|"+c.y,d(q,J,s,C);for(let n=0;n<this.vertices.length;n++)s=this.vertices[n].x+"|"+this.vertices[n].y,E=q+"|"+s,E in y||(y[E]=v++,O[s][0]>2?u[y[E]]=[-O[s][0],O[s][1],y[E]]:u[y[E]]=[r[O[s][0]],O[s][1],y[E]])}this.closestTo=u,this.vecToidx=y}calcCoeffs(){const v=this.m,y=this.n,n=Math.sqrt(3)/3,B=v*v+y*y+v*y;this.coau=(v+y)/B,this.cobu=-y/B,this.coav=-n*(v-y)/B,this.cobv=n*(2*v+y)/B}createInnerFacets(){const v=this.m,y=this.n;for(let n=0;n<y+v+1;n++)for(let v=this.min[n];v<this.max[n]+1;v++)v<this.max[n]&&v<this.max[n+1]+1&&this.innerFacets.push(["|"+v+"|"+n,"|"+v+"|"+(n+1),"|"+(v+1)+"|"+n]),n>0&&v<this.max[n-1]&&v+1<this.max[n]+1&&this.innerFacets.push(["|"+v+"|"+n,"|"+(v+1)+"|"+n,"|"+(v+1)+"|"+(n-1)])}edgeVecsABOB(){const v=this.m,y=this.n,n=new Yv(-y,v+y);for(let B=1;B<v+y;B++){const v=new Yv(this.min[B],B),y=new Yv(this.min[B-1],B-1),J=new Yv(this.min[B+1],B+1),P=v.clone(),b=y.clone(),Y=J.clone();P.rotate60About(n),b.rotate60About(n),Y.rotate60About(n);const l=new Yv(this.max[P.y],P.y),a=new Yv(this.max[P.y-1],P.y-1),Z=new Yv(this.max[P.y-1]-1,P.y-1);P.x===l.x&&P.y===l.y||(P.x!==a.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([v,a,Z]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([v,Z,l])):P.y===Y.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([v,y,a]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([v,a,J])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([v,y,a]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([v,a,l])))}}mapABOBtoOBOA(){const v=new Yv(0,0);for(let y=0;y<this.isoVecsABOB.length;y++){const n=[];for(let B=0;B<3;B++)v.x=this.isoVecsABOB[y][B].x,v.y=this.isoVecsABOB[y][B].y,0===this.vertexTypes[y][B]&&v.rotateNeg120(this.m,this.n),n.push(v.clone());this.isoVecsOBOA.push(n)}}mapABOBtoBAOA(){const v=new Yv(0,0);for(let y=0;y<this.isoVecsABOB.length;y++){const n=[];for(let B=0;B<3;B++)v.x=this.isoVecsABOB[y][B].x,v.y=this.isoVecsABOB[y][B].y,1===this.vertexTypes[y][B]&&v.rotate120(this.m,this.n),n.push(v.clone());this.isoVecsBAOA.push(n)}}MapToFace(v,y){const n=this.IDATA.face[v],J=n[2],P=n[1],b=n[0],Y=B.n.qh(this.IDATA.vertex[J]),l=B.n.qh(this.IDATA.vertex[P]),a=B.n.qh(this.IDATA.vertex[b]),Z=l.od(Y),x=a.od(Y),f=Z.scale(this.coau).add(x.scale(this.cobu)),N=Z.scale(this.coav).add(x.scale(this.cobv)),i=[];let g,c=B.i.o[0];for(let B=0;B<this.cartesian.length;B++)c=f.scale(this.cartesian[B].x).add(N.scale(this.cartesian[B].y)).add(Y),i[B]=[c.x,c.y,c.z],g=v+"|"+this.vertices[B].x+"|"+this.vertices[B].y,y.vertex[this.vecToidx[g]]=[c.x,c.y,c.z]}build(v,y){const n=[],B=Yv.Zero(),J=new Yv(v,y),P=new Yv(-y,v+y);n.push(B,J,P);for(let s=y;s<v+1;s++)for(let y=0;y<v+1-s;y++)n.push(new Yv(y,s));if(y>0){const B=(0,Q.g)(v,y),J=v/B,P=y/B;for(let Y=1;Y<B;Y++)n.push(new Yv(Y*J,Y*P)),n.push(new Yv(-Y*P,Y*(J+P))),n.push(new Yv(v-Y*(J+P),y+Y*J));const b=v/y;for(let Y=1;Y<y;Y++)for(let B=0;B<Y*b;B++)n.push(new Yv(B,Y)),n.push(new Yv(B,Y).rotate120(v,y)),n.push(new Yv(B,Y).rotateNeg120(v,y))}n.sort(((v,y)=>v.x-y.x)),n.sort(((v,y)=>v.y-y.y));const b=new Array(v+y+1),Y=new Array(v+y+1);for(let s=0;s<b.length;s++)b[s]=1/0,Y[s]=-1/0;let l=0,a=0;const Z=n.length;for(let s=0;s<Z;s++)a=n[s].x,l=n[s].y,b[l]=Math.min(a,b[l]),Y[l]=Math.max(a,Y[l]);const x=(n,B)=>{const J=n.clone();return"A"===B&&J.rotateNeg120(v,y),"B"===B&&J.rotate120(v,y),J.x<0?J.y:J.x+J.y},f=[],N=[],i=[],g=[],c={},h=[];let E=-1,W=-1;for(let s=0;s<Z;s++)f[s]=n[s].toCartesianOrigin(new Yv(0,0),.5),N[s]=x(n[s],"O"),i[s]=x(n[s],"A"),g[s]=x(n[s],"B"),N[s]===i[s]&&i[s]===g[s]?(E=3,W=N[s]):N[s]===i[s]?(E=4,W=N[s]):i[s]===g[s]?(E=5,W=i[s]):g[s]===N[s]&&(E=6,W=N[s]),N[s]<i[s]&&N[s]<g[s]&&(E=2,W=N[s]),i[s]<N[s]&&i[s]<g[s]&&(E=1,W=i[s]),g[s]<i[s]&&g[s]<N[s]&&(E=0,W=g[s]),h.push([E,W,n[s].x,n[s].y]);h.sort(((v,y)=>v[2]-y[2])),h.sort(((v,y)=>v[3]-y[3])),h.sort(((v,y)=>v[1]-y[1])),h.sort(((v,y)=>v[0]-y[0]));for(let s=0;s<h.length;s++)c[h[s][2]+"|"+h[s][3]]=[h[s][0],h[s][1],s];return this.m=v,this.n=y,this.vertices=n,this.vertByDist=c,this.cartesian=f,this.min=b,this.max=Y,this}}class av{constructor(v,y,n,B){this.name=v,this.category=y,this.vertex=n,this.face=B}}class Zv extends av{innerToData(v,y){for(let n=0;n<y.innerFacets.length;n++)this.face.push(y.innerFacets[n].map((n=>y.vecToidx[v+n])))}mapABOBtoDATA(v,y){const n=y.IDATA.edgematch[v][0];for(let B=0;B<y.isoVecsABOB.length;B++){const J=[];for(let P=0;P<3;P++)0===y.vertexTypes[B][P]?J.push(v+"|"+y.isoVecsABOB[B][P].x+"|"+y.isoVecsABOB[B][P].y):J.push(n+"|"+y.isoVecsABOB[B][P].x+"|"+y.isoVecsABOB[B][P].y);this.face.push([y.vecToidx[J[0]],y.vecToidx[J[1]],y.vecToidx[J[2]]])}}mapOBOAtoDATA(v,y){const n=y.IDATA.edgematch[v][0];for(let B=0;B<y.isoVecsOBOA.length;B++){const J=[];for(let P=0;P<3;P++)1===y.vertexTypes[B][P]?J.push(v+"|"+y.isoVecsOBOA[B][P].x+"|"+y.isoVecsOBOA[B][P].y):J.push(n+"|"+y.isoVecsOBOA[B][P].x+"|"+y.isoVecsOBOA[B][P].y);this.face.push([y.vecToidx[J[0]],y.vecToidx[J[1]],y.vecToidx[J[2]]])}}mapBAOAtoDATA(v,y){const n=y.IDATA.edgematch[v][2];for(let B=0;B<y.isoVecsBAOA.length;B++){const J=[];for(let P=0;P<3;P++)1===y.vertexTypes[B][P]?J.push(v+"|"+y.isoVecsBAOA[B][P].x+"|"+y.isoVecsBAOA[B][P].y):J.push(n+"|"+y.isoVecsBAOA[B][P].x+"|"+y.isoVecsBAOA[B][P].y);this.face.push([y.vecToidx[J[0]],y.vecToidx[J[1]],y.vecToidx[J[2]]])}}orderData(v){const y=[];for(let P=0;P<13;P++)y[P]=[];const n=v.closestTo;for(let P=0;P<n.length;P++)n[P][0]>-1?n[P][1]>0&&y[n[P][0]].push([P,n[P][1]]):y[12].push([P,n[P][0]]);const B=[];for(let P=0;P<12;P++)B[P]=P;let J=12;for(let P=0;P<12;P++){y[P].sort(((v,y)=>v[1]-y[1]));for(let v=0;v<y[P].length;v++)B[y[P][v][0]]=J++}for(let P=0;P<y[12].length;P++)B[y[12][P][0]]=J++;for(let P=0;P<this.vertex.length;P++)this.vertex[P].push(B[P]);this.vertex.sort(((v,y)=>v[3]-y[3]));for(let P=0;P<this.vertex.length;P++)this.vertex[P].pop();for(let P=0;P<this.face.length;P++)for(let v=0;v<this.face[P].length;v++)this.face[P][v]=B[this.face[P][v]];this.sharedNodes=y[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(v,y){const n=[],B=[];let J=y.pop();B.push(J);let P=this.face[J].indexOf(v);P=(P+2)%3;let b=this.face[J][P];n.push(b);let Y=0;for(;y.length>0;)J=y[Y],this.face[J].indexOf(b)>-1?(P=(this.face[J].indexOf(b)+1)%3,b=this.face[J][P],n.push(b),B.push(J),y.splice(Y,1),Y=0):Y++;return this.adjacentFaces.push(n),B}toGoldbergPolyhedronData(){const v=new av("GeoDual","Goldberg",[],[]);v.name="GD dual";const y=this.vertex.length,n=new Array(y);for(let l=0;l<y;l++)n[l]=[];for(let l=0;l<this.face.length;l++)for(let v=0;v<3;v++)n[this.face[l][v]].push(l);let B=0,J=0,P=0,b=[],Y=[];this.adjacentFaces=[];for(let l=0;l<n.length;l++)v.face[l]=this.setOrder(l,n[l].concat([])),n[l].forEach((y=>{B=0,J=0,P=0,b=this.face[y];for(let v=0;v<3;v++)Y=this.vertex[b[v]],B+=Y[0],J+=Y[1],P+=Y[2];v.vertex[y]=[B/3,J/3,P/3]}));return v}static BuildGeodesicData(v){const y=new Zv("Geodesic-m-n","Geodesic",[[0,G.c,-1],[-G.c,1,0],[-1,0,-G.c],[1,0,-G.c],[G.c,1,0],[0,G.c,1],[-1,0,G.c],[-G.c,-1,0],[0,-G.c,-1],[G.c,-1,0],[1,0,G.c],[0,-G.c,1]],[]);v.setIndices(),v.calcCoeffs(),v.createInnerFacets(),v.edgeVecsABOB(),v.mapABOBtoOBOA(),v.mapABOBtoBAOA();for(let n=0;n<v.IDATA.face.length;n++)v.MapToFace(n,y),y.innerToData(n,v),"B"===v.IDATA.edgematch[n][1]&&y.mapABOBtoDATA(n,v),"O"===v.IDATA.edgematch[n][1]&&y.mapOBOAtoDATA(n,v),"A"===v.IDATA.edgematch[n][3]&&y.mapBAOAtoDATA(n,v);y.orderData(v);return y.vertex=y.vertex.map((function(v){const y=v[0],n=v[1],B=v[2],J=Math.sqrt(y*y+n*n+B*B);return v[0]*=1/J,v[1]*=1/J,v[2]*=1/J,v})),y}}J.d._GoldbergMeshParser=(v,y)=>xv.Parse(v,y);class xv extends J.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(v,y){return void 0===y?(v>this.goldbergData.nbUnsharedFaces-1&&(L.e.Warn("Maximum number of unshared faces used"),v=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+v):(v>11&&(L.e.Warn("Last pole used"),v=11),y>this.goldbergData.nbFacesAtPole-1&&(L.e.Warn("Maximum number of faces at a pole used"),y=this.goldbergData.nbFacesAtPole-1),12+v*this.goldbergData.nbFacesAtPole+y)}_changeGoldbergFaceColors(v){for(let n=0;n<v.length;n++){const y=v[n][0],B=v[n][1],J=v[n][2];for(let v=y;v<B+1;v++)this.goldbergData.faceColors[v]=J}const y=[];for(let n=0;n<12;n++)for(let v=0;v<5;v++)y.push(this.goldbergData.faceColors[n].r,this.goldbergData.faceColors[n].g,this.goldbergData.faceColors[n].b,this.goldbergData.faceColors[n].a);for(let n=12;n<this.goldbergData.faceColors.length;n++)for(let v=0;v<6;v++)y.push(this.goldbergData.faceColors[n].r,this.goldbergData.faceColors[n].g,this.goldbergData.faceColors[n].b,this.goldbergData.faceColors[n].a);return y}setGoldbergFaceColors(v){const y=this._changeGoldbergFaceColors(v);this.Ga(P.i.ColorKind,y)}updateGoldbergFaceColors(v){const y=this._changeGoldbergFaceColors(v);this.updateVerticesData(P.i.ColorKind,y)}_changeGoldbergFaceUVs(v){const y=this.getVerticesData(P.i.UVKind);for(let n=0;n<v.length;n++){const B=v[n][0],J=v[n][1],P=v[n][2],b=v[n][3],Y=v[n][4],l=[],a=[];let Z,x;for(let v=0;v<5;v++)Z=P.x+b*Math.cos(Y+v*Math.PI/2.5),x=P.y+b*Math.sin(Y+v*Math.PI/2.5),Z<0&&(Z=0),Z>1&&(Z=1),l.push(Z,x);for(let v=0;v<6;v++)Z=P.x+b*Math.cos(Y+v*Math.PI/3),x=P.y+b*Math.sin(Y+v*Math.PI/3),Z<0&&(Z=0),Z>1&&(Z=1),a.push(Z,x);for(let v=B;v<Math.min(12,J+1);v++)for(let n=0;n<5;n++)y[10*v+2*n]=l[2*n],y[10*v+2*n+1]=l[2*n+1];for(let v=Math.max(12,B);v<J+1;v++)for(let n=0;n<6;n++)y[12*v-24+2*n]=a[2*n],y[12*v-23+2*n]=a[2*n+1]}return y}setGoldbergFaceUVs(v){const y=this._changeGoldbergFaceUVs(v);this.Ga(P.i.UVKind,y)}updateGoldbergFaceUVs(v){const y=this._changeGoldbergFaceUVs(v);this.updateVerticesData(P.i.UVKind,y)}placeOnGoldbergFaceAt(v,y,n){const J=B.n.RotationFromAxis(this.goldbergData.faceXaxis[y],this.goldbergData.faceYaxis[y],this.goldbergData.faceZaxis[y]);v.rotation=J,v.position=this.goldbergData.faceCenters[y].add(this.goldbergData.faceXaxis[y].scale(n.x)).add(this.goldbergData.faceYaxis[y].scale(n.y)).add(this.goldbergData.faceZaxis[y].scale(n.z))}serialize(v){super.serialize(v),v.type="GoldbergMesh";const y={};if(y.adjacentFaces=this.goldbergData.adjacentFaces,y.nbSharedFaces=this.goldbergData.nbSharedFaces,y.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,y.nbFaces=this.goldbergData.nbFaces,y.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){y.faceColors=[];for(const v of this.goldbergData.faceColors)y.faceColors.push(v.wj())}if(this.goldbergData.faceCenters){y.faceCenters=[];for(const v of this.goldbergData.faceCenters)y.faceCenters.push(v.wj())}if(this.goldbergData.faceZaxis){y.faceZaxis=[];for(const v of this.goldbergData.faceZaxis)y.faceZaxis.push(v.wj())}if(this.goldbergData.faceYaxis){y.faceYaxis=[];for(const v of this.goldbergData.faceYaxis)y.faceYaxis.push(v.wj())}if(this.goldbergData.faceXaxis){y.faceXaxis=[];for(const v of this.goldbergData.faceXaxis)y.faceXaxis.push(v.wj())}v.goldbergData=y}static Parse(v,y){const n=v.goldbergData;n.faceColors=n.faceColors.map((v=>f.e.qh(v))),n.faceCenters=n.faceCenters.map((v=>B.n.qh(v))),n.faceZaxis=n.faceZaxis.map((v=>B.n.qh(v))),n.faceXaxis=n.faceXaxis.map((v=>B.n.qh(v))),n.faceYaxis=n.faceYaxis.map((v=>B.n.qh(v)));const J=new xv(v.name,y);return J.goldbergData=n,J}}var fv=n(11387);class Nv{constructor(v){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=v}moveTo(v,y){this._currentPath=new t.g(v,y),this._tempPaths.push(this._currentPath)}lineTo(v,y){this._currentPath.addLineTo(v,y)}quadraticCurveTo(v,y,n,B){this._currentPath.addQuadraticCurveTo(v,y,n,B,this._resolution)}bezierCurveTo(v,y,n,B,J,P){this._currentPath.addBezierCurveTo(v,y,n,B,J,P,this._resolution)}extractHoles(){for(const v of this._tempPaths)v.area()>0?this._holes.push(v):this._paths.push(v);if(!this._paths.length&&this._holes.length){const v=this._holes;this._holes=this._paths,this._paths=v}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function iv(v,y,n,B,J,P){const b=P.glyphs[v]||P.glyphs["?"];if(!b)return null;const Y=new Nv(J);if(b.o){const v=b.o.split(" ");for(let J=0,P=v.length;J<P;){switch(v[J++]){case"m":{const P=parseInt(v[J++])*y+n,b=parseInt(v[J++])*y+B;Y.moveTo(P,b);break}case"l":{const P=parseInt(v[J++])*y+n,b=parseInt(v[J++])*y+B;Y.lineTo(P,b);break}case"q":{const P=parseInt(v[J++])*y+n,b=parseInt(v[J++])*y+B,l=parseInt(v[J++])*y+n,a=parseInt(v[J++])*y+B;Y.quadraticCurveTo(l,a,P,b);break}case"b":{const P=parseInt(v[J++])*y+n,b=parseInt(v[J++])*y+B,l=parseInt(v[J++])*y+n,a=parseInt(v[J++])*y+B,Z=parseInt(v[J++])*y+n,x=parseInt(v[J++])*y+B;Y.bezierCurveTo(l,a,Z,x,P,b);break}}}}return Y.extractHoles(),{offsetX:b.ha*y,shapePath:Y}}const gv={CreateBox:x.e,CreateTiledBox:c,CreateSphere:h.c,CreateDisc:Z.c,CreateIcoSphere:D,CreateRibbon:a,CreateCylinder:C,CreateTorus:u,CreateTorusKnot:d,CreateLineSystem:q.c,rb:q.d,CreateDashedLines:q.b,ExtrudeShape:j,ExtrudeShapeCustom:V,CreateLathe:H,CreateTiledPlane:i,Cg:A.c,CreateGround:X.f,CreateTiledGround:X.g,CreateGroundFromHeightMap:X.d,CreatePolygon:M,ExtrudePolygon:I,CreateTube:U,CreatePolyhedron:e,CreateGeodesic:function(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=y.m||1;B!==Math.floor(B)&&(B=Math.floor(B),L.e.Warn("m not an integer only floor(m) used"));let J=y.n||0;if(J!==Math.floor(J)&&(J=Math.floor(J),L.e.Warn("n not an integer only floor(n) used")),J>B){const v=J;J=B,B=v,L.e.Warn("n > m therefore m and n swapped")}const P=new lv;return P.build(B,J),e(v,{custom:Zv.BuildGeodesicData(P),size:y.size,sizeX:y.sizeX,sizeY:y.sizeY,sizeZ:y.sizeZ,faceUV:y.faceUV,faceColors:y.faceColors,flat:y.flat,updatable:y.updatable,sideOrientation:y.sideOrientation,frontUVs:y.frontUVs,backUVs:y.backUVs},n)},CreateGoldberg:function(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=y.size,l=y.sizeX||P||1,a=y.sizeY||P||1,Z=y.sizeZ||P||1;let x=y.m||1;x!==Math.floor(x)&&(x=Math.floor(x),L.e.Warn("m not an integer only floor(m) used"));let N=y.n||0;if(N!==Math.floor(N)&&(N=Math.floor(N),L.e.Warn("n not an integer only floor(n) used")),N>x){const v=N;N=x,x=v,L.e.Warn("n > m therefore m and n swapped")}const i=new lv;i.build(x,N);const g=Zv.BuildGeodesicData(i),c=g.toGoldbergPolyhedronData(),h=new xv(v,n);y.sideOrientation=J.d._GetDefaultSideOrientation(y.sideOrientation),h._originalBuilderSideOrientation=y.sideOrientation;(function(v,y){const n=v.size,J=v.sizeX||n||1,P=v.sizeY||n||1,l=v.sizeZ||n||1,a=0===v.sideOrientation?0:v.sideOrientation||b.e.DEFAULTSIDE,Z=[],x=[],f=[],N=[];let i=1/0,g=-1/0,c=1/0,h=-1/0;for(let B=0;B<y.vertex.length;B++)i=Math.min(i,y.vertex[B][0]*J),g=Math.max(g,y.vertex[B][0]*J),c=Math.min(c,y.vertex[B][1]*P),h=Math.max(h,y.vertex[B][1]*P);let E=0;for(let b=0;b<y.face.length;b++){const v=y.face[b],n=B.n.qh(y.vertex[v[0]]),a=B.n.qh(y.vertex[v[2]]),W=B.n.qh(y.vertex[v[1]]),s=a.od(n),C=W.od(n),r=B.n.Cross(C,s).normalize();for(let B=0;B<v.length;B++){f.push(r.x,r.y,r.z);const n=y.vertex[v[B]];Z.push(n[0]*J,n[1]*P,n[2]*l);const b=(n[1]*P-c)/(h-c);N.push((n[0]*J-i)/(g-i),Y.e?1-b:b)}for(let y=0;y<v.length-2;y++)x.push(E,E+y+2,E+y+1);E+=v.length}b.e._ComputeSides(a,Z,x,f,N);const W=new b.e;return W.xa=Z,W.indices=x,W.ya=f,W.Aa=N,W})(y,c).Ca(h,y.updatable),h.goldbergData.nbSharedFaces=g.sharedNodes,h.goldbergData.nbUnsharedFaces=g.poleNodes,h.goldbergData.adjacentFaces=g.adjacentFaces,h.goldbergData.nbFaces=h.goldbergData.nbSharedFaces+h.goldbergData.nbUnsharedFaces,h.goldbergData.nbFacesAtPole=(h.goldbergData.nbUnsharedFaces-12)/12;for(let J=0;J<g.vertex.length;J++)h.goldbergData.faceCenters.push(B.n.qh(g.vertex[J])),h.goldbergData.faceCenters[J].x*=l,h.goldbergData.faceCenters[J].y*=a,h.goldbergData.faceCenters[J].z*=Z,h.goldbergData.faceColors.push(new f.e(1,1,1,1));for(let J=0;J<c.face.length;J++){const v=c.face[J],y=B.n.qh(c.vertex[v[0]]),n=B.n.qh(c.vertex[v[2]]),P=B.n.qh(c.vertex[v[1]]),b=n.od(y),Y=P.od(y),l=B.n.Cross(Y,b).normalize(),a=B.n.Cross(Y,l).normalize();h.goldbergData.faceXaxis.push(Y.normalize()),h.goldbergData.faceYaxis.push(l),h.goldbergData.faceZaxis.push(a)}return h},CreateDecal:Jv,CreateCapsule:bv,CreateText:function(v,y,n){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const l=function(v,y,n,B){const J=Array.from(v),P=y/B.resolution,b=(B.boundingBox.yMax-B.boundingBox.yMin+B.underlineThickness)*P,Y=[];let l=0,a=0;for(let Z=0;Z<J.length;Z++){const v=J[Z];if("\n"===v)l=0,a-=b;else{const y=iv(v,P,l,a,n,B);y&&(l+=y.offsetX,Y.push(y.shapePath))}}return Y}(y,P.size||50,P.resolution||8,n),a=[];let Z=0;for(const i of l){if(!i.paths.length)continue;const y=i.holes.slice();for(const n of i.paths){var x,f;const l=[],N=[],i=n.getPoints();for(const v of i)N.push(new B.n(v.x,0,v.y));const g=y.slice();for(const v of g){const J=v.getPoints();let P=!1;for(const v of J)if(n.isPointInside(v)){P=!0;break}if(!P)continue;const b=[];for(const v of J)b.push(new B.n(v.x,0,v.y));l.push(b),y.splice(y.indexOf(v),1)}if(!l.length&&y.length)for(const v of y){const y=v.getPoints(),n=[];for(const v of y)n.push(new B.n(v.x,0,v.y));l.push(n)}const c=I(v,{shape:N,holes:l.length?l:void 0,depth:P.depth||1,faceUV:P.faceUV||(null===(x=P.perLetterFaceUV)||void 0===x?void 0:x.call(P,Z)),faceColors:P.faceColors||(null===(f=P.perLetterFaceColors)||void 0===f?void 0:f.call(P,Z)),sideOrientation:J.d._GetDefaultSideOrientation(P.sideOrientation||J.d.DOUBLESIDE)},b,Y);a.push(c),Z++}}const N=J.d.MergeMeshes(a,!0,!0);if(N){const y=N.getBoundingInfo().boundingBox;N.position.x+=-(y.minimumWorld.x+y.maximumWorld.x)/2,N.position.y+=-(y.minimumWorld.y+y.maximumWorld.y)/2,N.position.z+=-(y.minimumWorld.z+y.maximumWorld.z)/2+y.extendSize.z,N.name=v;const n=new fv.e("pivot",b);n.rotation.x=-Math.PI/2,N.parent=n,N.bakeCurrentTransformIntoVertices(),N.parent=null,n.dispose()}return N}}},11202:(v,y,n)=>{"use strict";n.d(y,{d:()=>l});var B=n(11127),J=n(11208),P=n(11216),b=n(11242),Y=n(11249);class l{get materialDefines(){var v;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(v=this._getDrawWrapper())||void 0===v?void 0:v.defines}set materialDefines(v){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=v}_getDrawWrapper(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v=v??this._engine.currentRenderPassId;let n=this._drawWrappers[v];return!n&&y&&(this._drawWrappers[v]=n=new Y.d(this._mesh.va().getEngine())),n}_removeDrawWrapper(v){var y;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(y=this._drawWrappers[v])||void 0===y||y.dispose());this._drawWrappers[v]=void 0}get effect(){var v;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(v=this._getDrawWrapper())||void 0===v?void 0:v.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(v){this._mainDrawWrapperOverride=v}setEffect(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const J=this._drawWrapper;J.setEffect(v,y,B),void 0!==n&&(J.materialContext=n),v||(J.defines=null,J.materialContext=void 0)}resetDrawCache(v){if(this._drawWrappers){if(void 0!==v)return void this._removeDrawWrapper(v);for(const v of this._drawWrappers)null===v||void 0===v||v.dispose()}this._drawWrappers=[]}static AddToMesh(v,y,n,B,J,P,b){return new l(v,y,n,B,J,P,b,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(v,y,n,B,J,P,b){let Y=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=v,this.verticesStart=y,this.verticesCount=n,this.indexStart=B,this.indexCount=J,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=P,this._renderingMesh=b||P,l&&P.Ag.push(this),this._engine=this._mesh.va().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=P.Ag.length-1,Y&&(this.refreshBoundingInfo(),P.ak(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(v){return this._boundingInfo=v,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const v=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return v||this._renderingMesh}Ha(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const y=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!y)return v?this._mesh.va().defaultMaterial:null;if(this._isMultiMaterial(y)){const v=y.getSubMaterial(this.materialIndex);return this._currentMaterial!==v&&(this._currentMaterial=v,this.resetDrawCache()),v}return y}_isMultiMaterial(v){return void 0!==v.getSubMaterial}refreshBoundingInfo(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Rj)return this;if(v||(v=this._renderingMesh.getVerticesData(B.i.PositionKind)),!v)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const y=this._renderingMesh.wg();let n;if(0===this.indexStart&&this.indexCount===y.length){const v=this._renderingMesh.getBoundingInfo();n={minimum:v.minimum.clone(),maximum:v.maximum.clone()}}else n=(0,b.c)(v,y,this.indexStart,this.indexCount,this._renderingMesh.Rj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(n.minimum,n.maximum):this._boundingInfo=new P.c(n.minimum,n.maximum),this}_checkCollision(v){return this.getBoundingInfo()._checkCollision(v)}updateBoundingInfo(v){let y=this.getBoundingInfo();return y||(this.refreshBoundingInfo(),y=this.getBoundingInfo()),y&&y.update(v),this}isInFrustum(v){const y=this.getBoundingInfo();return!!y&&y.isInFrustum(v,this._mesh.Ri)}isCompletelyInFrustum(v){const y=this.getBoundingInfo();return!!y&&y.isCompletelyInFrustum(v)}render(v){return this._renderingMesh.render(this,v,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(v,y){if(!this._linesIndexBuffer){const n=[];for(let y=this.indexStart;y<this.indexStart+this.indexCount;y+=3)n.push(v[y],v[y+1],v[y+1],v[y+2],v[y+2],v[y]);this._linesIndexBuffer=y.createIndexBuffer(n),this._linesIndexCount=n.length}return this._linesIndexBuffer}canIntersects(v){const y=this.getBoundingInfo();return!!y&&v.intersectsBox(y.boundingBox)}intersects(v,y,n,B,J){const P=this.Ha();if(!P)return null;let b=3,Y=!1;switch(P.fillMode){case 3:case 5:case 6:case 8:return null;case 7:b=1,Y=!0}return 4===P.fillMode?n.length?this._intersectLines(v,y,n,this._mesh.intersectionThreshold,B):this._intersectUnIndexedLines(v,y,n,this._mesh.intersectionThreshold,B):!n.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(v,y,n,B,J):this._intersectTriangles(v,y,n,b,Y,B,J)}_intersectLines(v,y,n,B,P){let b=null;for(let Y=this.indexStart;Y<this.indexStart+this.indexCount;Y+=2){const l=y[n[Y]],a=y[n[Y+1]],Z=v.intersectionSegment(l,a,B);if(!(Z<0)&&((P||!b||Z<b.distance)&&(b=new J.b(null,null,Z),b.faceId=Y/2,P)))break}return b}_intersectUnIndexedLines(v,y,n,B,P){let b=null;for(let Y=this.verticesStart;Y<this.verticesStart+this.verticesCount;Y+=2){const n=y[Y],l=y[Y+1],a=v.intersectionSegment(n,l,B);if(!(a<0)&&((P||!b||a<b.distance)&&(b=new J.b(null,null,a),b.faceId=Y/2,P)))break}return b}_intersectTriangles(v,y,n,B,J,P,b){let Y=null,l=-1;for(let a=this.indexStart;a<this.indexStart+this.indexCount-(3-B);a+=B){l++;const B=n[a],Z=n[a+1],x=n[a+2];if(J&&4294967295===x){a+=2;continue}const f=y[B],N=y[Z],i=y[x];if(!f||!N||!i)continue;if(b&&!b(f,N,i,v,B,Z,x))continue;const g=v.intersectsTriangle(f,N,i);if(g){if(g.distance<0)continue;if((P||!Y||g.distance<Y.distance)&&(Y=g,Y.faceId=l,P))break}}return Y}_intersectUnIndexedTriangles(v,y,n,B,J){let P=null;for(let b=this.verticesStart;b<this.verticesStart+this.verticesCount;b+=3){const n=y[b],Y=y[b+1],l=y[b+2];if(J&&!J(n,Y,l,v,-1,-1,-1))continue;const a=v.intersectsTriangle(n,Y,l);if(a){if(a.distance<0)continue;if((B||!P||a.distance<P.distance)&&(P=a,P.faceId=b/3,B))break}}return P}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(v,y){const n=new l(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,v,y,!1);if(!this.IsGlobal){const v=this.getBoundingInfo();if(!v)return n;n._boundingInfo=new P.c(v.minimum,v.maximum)}return n}dispose(){this._linesIndexBuffer&&(this._mesh.va().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const v=this._mesh.Ag.indexOf(this);this._mesh.Ag.splice(v,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(v,y,n,B,J){let P=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],b=Number.MAX_VALUE,Y=-Number.MAX_VALUE;const a=(J||B).wg();for(let l=y;l<y+n;l++){const v=a[l];v<b&&(b=v),v>Y&&(Y=v)}return new l(v,b,Y-b+1,y,n,B,J,P)}}},12338:(v,y,n)=>{"use strict";var B=n(11338),J=n(11127),P=n(11081),b=n(10801),Y=n(11216);B.d.prototype.thinInstanceAdd=function(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return b.e.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(v)?v.length:1);const n=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(v))for(let B=0;B<v.length;++B)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,v[B],B===v.length-1&&y);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,v,y);return n},B.d.prototype.thinInstanceAddSelf=function(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(P.d.IdentityReadOnly,v)},B.d.prototype.thinInstanceRegisterAttribute=function(v,y){v===J.i.ColorKind&&(v=J.i.ColorInstanceKind),this.removeVerticesData(v),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[v]=y,this._userThinInstanceBuffersStorage.sizes[v]=y*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[v]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[v]),this._userThinInstanceBuffersStorage.vertexBuffers[v]=new J.i(this.getEngine(),this._userThinInstanceBuffersStorage.data[v],v,!0,!1,y,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[v])},B.d.prototype.thinInstanceSetMatrixAt=function(v,y){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||v>=this._thinInstanceDataStorage.instancesCount)return!1;const B=this._thinInstanceDataStorage.matrixData;return y.copyToArray(B,16*v),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[v]=y),n&&(this.tc("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},B.d.prototype.thinInstanceSetAttributeAt=function(v,y,n){let B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return v===J.i.ColorKind&&(v=J.i.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[v]||y>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(v,0),this._userThinInstanceBuffersStorage.data[v].set(n,y*this._userThinInstanceBuffersStorage.strides[v]),B&&this.tc(v),!0)},Object.defineProperty(B.d.prototype,"nc",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(v){var y;const n=this._thinInstanceDataStorage.matrixData??(null===(y=this.source)||void 0===y?void 0:y._thinInstanceDataStorage.matrixData);v<=(n?n.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=v)},enumerable:!0,configurable:!0}),B.d.prototype._thinInstanceCreateMatrixBuffer=function(v,y){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const B=new J.e(this.getEngine(),y,!n,16,!1,!0);for(let J=0;J<4;J++)this.setVerticesBuffer(B.createVertexBuffer(v+J,4*J,4));return B},B.d.prototype._b=function(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var P;if(n=n||16,"matrix"===v)null===(P=this._thinInstanceDataStorage.matrixBuffer)||void 0===P||P.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=y?y.length:32*n,this._thinInstanceDataStorage.matrixData=y,this._thinInstanceDataStorage.worldMatrices=null,null!==y?(this._thinInstanceDataStorage.instancesCount=y.length/n,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",y,B),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===v){var b;null===(b=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===b||b.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=y,null!==y&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",y,B))}else{var Y;if(v===J.i.ColorKind&&(v=J.i.ColorInstanceKind),null===y)null!==(Y=this._userThinInstanceBuffersStorage)&&void 0!==Y&&Y.data[v]&&(this.removeVerticesData(v),delete this._userThinInstanceBuffersStorage.data[v],delete this._userThinInstanceBuffersStorage.strides[v],delete this._userThinInstanceBuffersStorage.sizes[v],delete this._userThinInstanceBuffersStorage.vertexBuffers[v]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[v]=y,this._userThinInstanceBuffersStorage.strides[v]=n,this._userThinInstanceBuffersStorage.sizes[v]=y.length,this._userThinInstanceBuffersStorage.vertexBuffers[v]=new J.i(this.getEngine(),y,v,!B,!1,n,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[v])}},B.d.prototype.tc=function(v){var y;if("matrix"===v)this.$j&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(v),null===(y=this._thinInstanceDataStorage.matrixBuffer)||void 0===y||y.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===v){var n;this.$j&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(v),null===(n=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===n||n.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var B;v===J.i.ColorKind&&(v=J.i.ColorInstanceKind),null!==(B=this._userThinInstanceBuffersStorage)&&void 0!==B&&B.vertexBuffers[v]&&(this.$j&&!this._userThinInstanceBuffersStorage.vertexBuffers[v].isUpdatable()&&this._thinInstanceRecreateBuffer(v),this._userThinInstanceBuffersStorage.vertexBuffers[v].updateDirectly(this._userThinInstanceBuffersStorage.data[v],0))}},B.d.prototype.thinInstancePartialBufferUpdate=function(v,y,n){var B;"matrix"===v?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(y,n):(v===J.i.ColorKind&&(v=J.i.ColorInstanceKind),null!==(B=this._userThinInstanceBuffersStorage)&&void 0!==B&&B.vertexBuffers[v]&&this._userThinInstanceBuffersStorage.vertexBuffers[v].updateDirectly(y,n))},B.d.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const v=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let y=0;y<this._thinInstanceDataStorage.instancesCount;++y)this._thinInstanceDataStorage.worldMatrices[y]=P.d.qh(v,16*y)}return this._thinInstanceDataStorage.worldMatrices},B.d.prototype.thinInstanceRefreshBoundingInfo=function(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const B=this._thinInstanceDataStorage.boundingVectors;if(v||!this.rawBoundingInfo){B.length=0,this.refreshBoundingInfo(y,n);const v=this.getBoundingInfo();this.rawBoundingInfo=new Y.c(v.minimum,v.maximum)}const J=this.getBoundingInfo(),b=this._thinInstanceDataStorage.matrixData;if(0===B.length)for(let P=0;P<J.boundingBox.vectors.length;++P)B.push(J.boundingBox.vectors[P].clone());P.i.o[0].xe(Number.POSITIVE_INFINITY),P.i.o[1].xe(Number.NEGATIVE_INFINITY);for(let Y=0;Y<this._thinInstanceDataStorage.instancesCount;++Y){P.d.FromArrayToRef(b,16*Y,P.i.Matrix[0]);for(let v=0;v<B.length;++v)P.n.TransformCoordinatesToRef(B[v],P.i.Matrix[0],P.i.o[2]),P.i.o[0].minimizeInPlace(P.i.o[2]),P.i.o[1].maximizeInPlace(P.i.o[2])}J.reConstruct(P.i.o[0],P.i.o[1]),this.Ea()},B.d.prototype._thinInstanceRecreateBuffer=function(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var n;if("matrix"===v)null===(n=this._thinInstanceDataStorage.matrixBuffer)||void 0===n||n.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,y);else if("previousMatrix"===v){var B;if(this._scene.needsPreviousWorldMatrices)null===(B=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===B||B.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,y)}else{var P;v===J.i.ColorKind&&(v=J.i.ColorInstanceKind),null===(P=this._userThinInstanceBuffersStorage.vertexBuffers[v])||void 0===P||P.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[v]=new J.i(this.getEngine(),this._userThinInstanceBuffersStorage.data[v],v,!y,!1,this._userThinInstanceBuffersStorage.strides[v],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[v])}},B.d.prototype._thinInstanceUpdateBufferSize=function(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;v===J.i.ColorKind&&(v=J.i.ColorInstanceKind);const n="matrix"===v;if(!n&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[v]))return;const B=n?16:this._userThinInstanceBuffersStorage.strides[v],P=n?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[v];let b=n?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[v];const Y=(this._thinInstanceDataStorage.instancesCount+y)*B;let l=P;for(;l<Y;)l*=2;if(!b||P!=l){if(b){const v=new Float32Array(l);v.set(b,0),b=v}else b=new Float32Array(l);var a,Z,x;if(n){if(null===(a=this._thinInstanceDataStorage.matrixBuffer)||void 0===a||a.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",b,!1),this._thinInstanceDataStorage.matrixData=b,this._thinInstanceDataStorage.matrixBufferSize=l,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(Z=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===Z||Z.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",b,!1)}else null===(x=this._userThinInstanceBuffersStorage.vertexBuffers[v])||void 0===x||x.dispose(),this._userThinInstanceBuffersStorage.data[v]=b,this._userThinInstanceBuffersStorage.sizes[v]=l,this._userThinInstanceBuffersStorage.vertexBuffers[v]=new J.i(this.getEngine(),b,v,!0,!1,B,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[v])}},B.d.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},B.d.prototype._disposeThinInstanceSpecificData=function(){var v;null!==(v=this._thinInstanceDataStorage)&&void 0!==v&&v.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11387:(v,y,n)=>{"use strict";n.d(y,{e:()=>x});var B=n(11050),J=n(11055),P=n(11110),b=n(10795),Y=n(11081),l=n(11351),a=n(10908);const Z=Y.d.Compose(Y.n.One(),Y.g.FromEulerAngles(0,Math.PI,0),Y.n.Zero());class x extends l.c{get billboardMode(){return this._billboardMode}set billboardMode(v){this._billboardMode!==v&&(this._billboardMode=v,this._cache.useBillboardPosition=0!==(this._billboardMode&x.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(v){v!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=v,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==x.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(v){this._infiniteDistance!==v&&(this._infiniteDistance=v)}constructor(v){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(v,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new Y.n(0,0,1),this._up=new Y.n(0,1,0),this._right=new Y.n(1,0,0),this._position=Y.n.Zero(),this._rotation=Y.n.Zero(),this._rotationQuaternion=null,this._scaling=Y.n.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=x.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.ck=Y.d.Zero(),this._usePivotMatrix=!1,this._absolutePosition=Y.n.Zero(),this._absoluteScaling=Y.n.Zero(),this._absoluteRotationQuaternion=Y.g.Identity(),this._pivotMatrix=Y.d.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new b.e,this._nonUniformScaling=!1,y&&this.va().addTransformNode(this)}getClassName(){return"tb"}get position(){return this._position}set position(v){this._position=v,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(v){this._rotation=v,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Be(){return this._scaling}set Be(v){this._scaling=v,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(v){this._rotationQuaternion=v,v&&this._rotation.xe(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return Y.n.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return Y.n.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return Y.n.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(v){return this._poseMatrix?(this._poseMatrix.p(v),this):(this._poseMatrix=v.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=Y.d.Identity()),this._poseMatrix}_isSynchronized(){const v=this._cache;return this._billboardMode===v.billboardMode&&this._billboardMode===x.BILLBOARDMODE_NONE&&(!v.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const v=this._cache;v.localMatrixUpdated=!1,v.billboardMode=-1,v.infiniteDistance=!1,v.useBillboardPosition=!1,v.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(v){return this.setPivotMatrix(v,!1)}setPivotMatrix(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(v),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=y,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=Y.d.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,y=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;const B=this.clone("Clone of "+(this.name||this.id),v||this.parent,!0);B&&n&&n(this,B);for(const J of this.getChildTransformNodes(!0))J.instantiateHierarchy(B,y,n);return B}Nc(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return v?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.xe(0),this._rotationQuaternion=this._rotationQuaternion||Y.g.Identity(),v.decompose(this._scaling,this._rotationQuaternion,this._position),this.ak(!0)):(this._worldMatrix=v,this._absolutePosition.Ae(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.ak(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.ak(!0),this}get Dj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.ak(),this._absolutePosition}setAbsolutePosition(v){if(!v)return this;let y,n,B;if(void 0===v.x){if(arguments.length<3)return this;y=arguments[0],n=arguments[1],B=arguments[2]}else y=v.x,n=v.y,B=v.z;if(this.parent){const v=Y.i.Matrix[0];this.parent.getWorldMatrix().invertToRef(v),Y.n.TransformCoordinatesFromFloatsToRef(y,n,B,v,this.position)}else this.position.x=y,this.position.y=n,this.position.z=B;return this._absolutePosition.p(v),this}setPositionWithLocalVector(v){return this.ak(),this.position=Y.n.TransformNormal(v,this.ck),this}getPositionExpressedInLocalSpace(){this.ak();const v=Y.i.Matrix[0];return this.ck.invertToRef(v),Y.n.TransformNormal(this.position,v)}locallyTranslate(v){return this.ak(!0),this.position=Y.n.TransformCoordinates(v,this.ck),this}lookAt(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const P=x._LookAtVectorCache,b=0===J?this.position:this.getAbsolutePosition();if(v.subtractToRef(b,P),this.setDirection(P,y,n,B),1===J&&this.parent)if(this.rotationQuaternion){const v=Y.i.Matrix[0];this.rotationQuaternion.toRotationMatrix(v);const y=Y.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(y),y.invert(),v.multiplyToRef(y,v),this.rotationQuaternion.fromRotationMatrix(v)}else{const v=Y.i.Quaternion[0];Y.g.FromEulerVectorToRef(this.rotation,v);const y=Y.i.Matrix[0];v.toRotationMatrix(y);const n=Y.i.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(n),n.invert(),y.multiplyToRef(n,y),v.fromRotationMatrix(y),v.toEulerAnglesToRef(this.rotation)}return this}uf(v){const y=Y.n.Zero();return this.getDirectionToRef(v,y),y}getDirectionToRef(v,y){return Y.n.TransformNormalToRef(v,this.getWorldMatrix(),y),this}setDirection(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const J=-Math.atan2(v.z,v.x)+Math.PI/2,P=Math.sqrt(v.x*v.x+v.z*v.z),b=-Math.atan2(v.y,P);return this.rotationQuaternion?Y.g.RotationYawPitchRollToRef(J+y,b+n,B,this.rotationQuaternion):(this.rotation.x=b+n,this.rotation.y=J+y,this.rotation.z=B),this}setPivotPoint(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.ak(!0);const n=this.getWorldMatrix();if(1==y){const y=Y.i.Matrix[0];n.invertToRef(y),v=Y.n.TransformCoordinates(v,y)}return this.setPivotMatrix(Y.d.Translation(-v.x,-v.y,-v.z),!0)}getPivotPoint(){const v=Y.n.Zero();return this.getPivotPointToRef(v),v}getPivotPointToRef(v){return v.x=-this._pivotMatrix.m[12],v.y=-this._pivotMatrix.m[13],v.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const v=Y.n.Zero();return this.getAbsolutePivotPointToRef(v),v}getAbsolutePivotPointToRef(v){return this.getPivotPointToRef(v),Y.n.TransformCoordinatesToRef(v,this.getWorldMatrix(),v),this}eh(v){if(this._isDirty)return this;if(this._children)for(const y of this._children)y.eh(v);return super.eh(v)}setParent(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!v&&!this.parent)return this;const B=Y.i.Quaternion[0],J=Y.i.o[0],P=Y.i.o[1],b=Y.i.Matrix[1];Y.d.IdentityToRef(b);const l=Y.i.Matrix[0];this.ak(!0);let a=this.rotationQuaternion;return a||(a=x._TmpRotation,Y.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,a)),Y.d.ComposeToRef(this.Be,a,this.position,l),this.parent&&l.multiplyToRef(this.parent.ak(!0),l),v&&(v.ak(!0).invertToRef(b),l.multiplyToRef(b,l)),l.decompose(P,B,J,y?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(B):B.toEulerAnglesToRef(this.rotation),this.Be.p(P),this.position.p(J),this.parent=v,n&&this.setPivotMatrix(Y.d.Identity()),this}addChild(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return v.setParent(this,y),this}removeChild(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return v.setParent(null,y),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(v){return this._nonUniformScaling!==v&&(this._nonUniformScaling=v,!0)}attachToBone(v,y){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=y,this.parent=v,v.getSkeleton().prepare(!0),v.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=v?this._currentParentWhenAttachingToBone:null,this):(v&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(v,y,n){let B;if(v.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.xe(0)),n&&0!==n){if(this.parent){const n=this.parent.getWorldMatrix(),B=Y.i.Matrix[0];n.invertToRef(B),v=Y.n.TransformNormal(v,B),n.determinant()<0&&(y*=-1)}B=Y.g.RotationAxisToRef(v,y,x._RotationAxisCache),B.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else B=Y.g.RotationAxisToRef(v,y,x._RotationAxisCache),this.rotationQuaternion.multiplyToRef(B,this.rotationQuaternion);return this}rotateAround(v,y,n){y.normalize(),this.rotationQuaternion||(this.rotationQuaternion=Y.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.xe(0));const B=Y.i.o[0],J=Y.i.o[1],P=Y.i.o[2],b=Y.i.Quaternion[0],l=Y.i.Matrix[0],a=Y.i.Matrix[1],Z=Y.i.Matrix[2],x=Y.i.Matrix[3];return v.subtractToRef(this.position,B),Y.d.TranslationToRef(B.x,B.y,B.z,l),Y.d.TranslationToRef(-B.x,-B.y,-B.z,a),Y.d.RotationAxisToRef(y,n,Z),a.multiplyToRef(Z,x),x.multiplyToRef(l,x),x.decompose(J,b,P),this.position.addInPlace(P),b.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(v,y,n){const B=v.scale(y);if(n&&0!==n)this.setAbsolutePosition(this.getAbsolutePosition().add(B));else{const v=this.getPositionExpressedInLocalSpace().add(B);this.setPositionWithLocalVector(v)}return this}addRotation(v,y,n){let B;this.rotationQuaternion?B=this.rotationQuaternion:(B=Y.i.Quaternion[1],Y.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,B));const J=Y.i.Quaternion[0];return Y.g.RotationYawPitchRollToRef(y,v,n,J),B.multiplyInPlace(J),this.rotationQuaternion||B.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==x.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}ak(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const n=this.va().getRenderId();if(!this._isDirty&&!v&&(this._currentRenderId===n||this.isSynchronized()))return this._currentRenderId=n,this._worldMatrix;y=y||this.va().activeCamera,this._updateCache();const B=this._cache;B.pivotMatrixUpdated=!1,B.billboardMode=this.billboardMode,B.infiniteDistance=this.infiniteDistance,B.parent=this._parentNode,this._currentRenderId=n,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const J=this._getEffectiveParent(),P=x._TmpScaling;let b,l=this._position;if(this._infiniteDistance&&!this.parent&&y){const v=y.getWorldMatrix(),n=new Y.n(v.m[12],v.m[13],v.m[14]);l=x._TmpTranslation,l.Ae(this._position.x+n.x,this._position.y+n.y,this._position.z+n.z)}if(P.Ae(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,b=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(Y.g.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Ae(0,0,0))}}else b=x._TmpRotation,Y.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,b);if(this._usePivotMatrix){const v=Y.i.Matrix[1];Y.d.ScalingToRef(P.x,P.y,P.z,v);const y=Y.i.Matrix[0];b.toRotationMatrix(y),this._pivotMatrix.multiplyToRef(v,Y.i.Matrix[4]),Y.i.Matrix[4].multiplyToRef(y,this.ck),this._postMultiplyPivotMatrix&&this.ck.multiplyToRef(this._pivotMatrixInverse,this.ck),this.ck.addTranslationFromFloats(l.x,l.y,l.z)}else Y.d.ComposeToRef(P,b,l,this.ck);if(J&&J.getWorldMatrix){if(v&&J.ak(v),B.useBillboardPath){if(this._transformToBoneReferal){const v=this.parent;v.getSkeleton().prepare(),v.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),Y.i.Matrix[7])}else Y.i.Matrix[7].p(J.getWorldMatrix());const v=Y.i.o[5],y=Y.i.o[6],n=Y.i.Quaternion[0];Y.i.Matrix[7].decompose(y,n,v),Y.d.ScalingToRef(y.x,y.y,y.z,Y.i.Matrix[7]),Y.i.Matrix[7].setTranslation(v),x.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(n,v),this.ck.setTranslation(v)),this.ck.multiplyToRef(Y.i.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const v=this.parent;v.getSkeleton().prepare(),this.ck.multiplyToRef(v.getFinalMatrix(),Y.i.Matrix[6]),Y.i.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.ck.multiplyToRef(J.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.ck);if(B.useBillboardPath&&y&&this.billboardMode&&!B.useBillboardPosition){const v=Y.i.o[0];if(this._worldMatrix.getTranslationToRef(v),Y.i.Matrix[1].p(y.getViewMatrix()),this._scene.useRightHandedSystem&&Y.i.Matrix[1].multiplyToRef(Z,Y.i.Matrix[1]),Y.i.Matrix[1].setTranslationFromFloats(0,0,0),Y.i.Matrix[1].invertToRef(Y.i.Matrix[0]),(this.billboardMode&x.BILLBOARDMODE_ALL)!==x.BILLBOARDMODE_ALL){Y.i.Matrix[0].decompose(void 0,Y.i.Quaternion[0],void 0);const v=Y.i.o[1];Y.i.Quaternion[0].toEulerAnglesToRef(v),(this.billboardMode&x.BILLBOARDMODE_X)!==x.BILLBOARDMODE_X&&(v.x=0),(this.billboardMode&x.BILLBOARDMODE_Y)!==x.BILLBOARDMODE_Y&&(v.y=0),(this.billboardMode&x.BILLBOARDMODE_Z)!==x.BILLBOARDMODE_Z&&(v.z=0),Y.d.RotationYawPitchRollToRef(v.y,v.x,v.z,Y.i.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(Y.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(Y.i.o[0])}else if(B.useBillboardPath&&y&&B.useBillboardPosition){const v=Y.i.o[0];this._worldMatrix.getTranslationToRef(v);const n=y.globalPosition;this._worldMatrix.invertToRef(Y.i.Matrix[1]);const B=Y.i.o[1];Y.n.TransformCoordinatesToRef(n,Y.i.Matrix[1],B),B.normalize();const J=-Math.atan2(B.z,B.x)+Math.PI/2,P=Math.sqrt(B.x*B.x+B.z*B.z),b=-Math.atan2(B.y,P);if(Y.g.RotationYawPitchRollToRef(J,b,0,Y.i.Quaternion[0]),(this.billboardMode&x.BILLBOARDMODE_ALL)!==x.BILLBOARDMODE_ALL){const v=Y.i.o[1];Y.i.Quaternion[0].toEulerAnglesToRef(v),(this.billboardMode&x.BILLBOARDMODE_X)!==x.BILLBOARDMODE_X&&(v.x=0),(this.billboardMode&x.BILLBOARDMODE_Y)!==x.BILLBOARDMODE_Y&&(v.y=0),(this.billboardMode&x.BILLBOARDMODE_Z)!==x.BILLBOARDMODE_Z&&(v.z=0),Y.d.RotationYawPitchRollToRef(v.y,v.x,v.z,Y.i.Matrix[0])}else Y.d.FromQuaternionToRef(Y.i.Quaternion[0],Y.i.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(Y.i.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(Y.i.o[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):J&&J._nonUniformScaling?this._updateNonUniformScalingState(J._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Ae(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=Y.d.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.ak(),v){const v=this.getChildren();for(let y=0;y<v.length;++y){const n=v[y];if(n){n.ak();const v=Y.i.Matrix[0];n.ck.multiplyToRef(this.ck,v);const y=Y.i.Quaternion[0];v.decompose(n.Be,y,n.position),n.rotationQuaternion?n.rotationQuaternion.p(y):y.toEulerAnglesToRef(n.rotation)}}}this.Be.Ae(1,1,1),this.position.Ae(0,0,0),this.rotation.Ae(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=Y.g.Identity()),this._worldMatrix=Y.d.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(v){return this.onAfterWorldMatrixUpdateObservable.add(v),this}unregisterAfterWorldMatrixUpdate(v){return this.onAfterWorldMatrixUpdateObservable.removeCallback(v),this}getPositionInCameraSpace(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return v||(v=this.va().activeCamera),Y.n.TransformCoordinates(this.getAbsolutePosition(),v.getViewMatrix())}getDistanceToCamera(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return v||(v=this.va().activeCamera),this.getAbsolutePosition().od(v.globalPosition).length()}clone(v,y,n){const B=P.d.Clone((()=>new x(v,this.va())),this);if(B.name=v,B.id=v,y&&(B.parent=y),!n){const y=this.getDescendants(!0);for(let n=0;n<y.length;n++){const J=y[n];J.clone&&J.clone(v+"."+J.name,B)}}return B}serialize(v){const y=P.d.Serialize(this,v);return y.type=this.getClassName(),y.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(y),y.localMatrix=this.getPivotMatrix().wj(),y.isEnabled=this.isEnabled(),P.d.AppendSerializedAnimations(this,y),y.ranges=this.serializeAnimationRanges(),y}static Parse(v,y,n){const B=P.d.Parse((()=>new x(v.name,y)),v,y,n);if(v.localMatrix?B.setPreTransformMatrix(Y.d.qh(v.localMatrix)):v.pivotMatrix&&B.setPivotMatrix(Y.d.qh(v.pivotMatrix)),B.Nb(v.isEnabled),B._waitingParsedUniqueId=v.uniqueId,void 0!==v.parentId&&(B._waitingParentId=v.parentId),void 0!==v.parentInstanceIndex&&(B._waitingParentInstanceIndex=v.parentInstanceIndex),v.animations){for(let y=0;y<v.animations.length;y++){const n=v.animations[y],J=(0,a.d)("BABYLON.Animation");J&&B.animations.push(J.Parse(n))}l.c.ParseAnimationRanges(B,v,y)}return v.autoAnimate&&y.beginAnimation(B,v.autoAnimateFrom,v.autoAnimateTo,v.autoAnimateLoop,v.autoAnimateSpeed||1),B}getChildTransformNodes(v,y){const n=[];return this._getDescendants(n,v,(v=>(!y||y(v))&&v instanceof x)),n}dispose(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const v=this._parentContainer.transformNodes.indexOf(this);v>-1&&this._parentContainer.transformNodes.splice(v,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),v){const v=this.getChildTransformNodes(!0);for(const y of v)y.parent=null,y.ak(!0)}super.dispose(v,y)}normalizeToUnitCube(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,B=null,J=null;y&&(this.rotationQuaternion?(J=this.rotationQuaternion.clone(),this.rotationQuaternion.Ae(0,0,0,1)):this.rotation&&(B=this.rotation.clone(),this.rotation.Ae(0,0,0)));const P=this.getHierarchyBoundingVectors(v,n),b=P.max.od(P.min),Y=Math.max(b.x,b.y,b.z);if(0===Y)return this;const l=1/Y;return this.Be.scaleInPlace(l),y&&(this.rotationQuaternion&&J?this.rotationQuaternion.p(J):this.rotation&&B&&this.rotation.p(B)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}x.BILLBOARDMODE_NONE=0,x.BILLBOARDMODE_X=1,x.BILLBOARDMODE_Y=2,x.BILLBOARDMODE_Z=4,x.BILLBOARDMODE_ALL=7,x.BILLBOARDMODE_USE_POSITION=128,x.BillboardUseParentOrientation=!1,x._TmpRotation=Y.g.Zero(),x._TmpScaling=Y.n.Zero(),x._TmpTranslation=Y.n.Zero(),x._LookAtVectorCache=new Y.n(0,0,0),x._RotationAxisCache=new Y.g,(0,B.c)([(0,J.I)("position")],x.prototype,"_position",void 0),(0,B.c)([(0,J.I)("rotation")],x.prototype,"_rotation",void 0),(0,B.c)([(0,J.B)("rotationQuaternion")],x.prototype,"_rotationQuaternion",void 0),(0,B.c)([(0,J.I)("Be")],x.prototype,"_scaling",void 0),(0,B.c)([(0,J.M)("billboardMode")],x.prototype,"_billboardMode",void 0),(0,B.c)([(0,J.M)()],x.prototype,"scalingDeterminant",void 0),(0,B.c)([(0,J.M)("infiniteDistance")],x.prototype,"_infiniteDistance",void 0),(0,B.c)([(0,J.M)()],x.prototype,"ignoreNonUniformScaling",void 0),(0,B.c)([(0,J.M)()],x.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11585:(v,y,n)=>{"use strict";n.d(y,{b:()=>a});var B=n(11081),J=n(11091),P=n(11559),b=n(11086),Y=n(11103);class l{constructor(v,y,n,B){this.name=v,this.worldAxisForNormal=y,this.worldAxisForFileX=n,this.worldAxisForFileY=B}}class a{static ConvertCubeMapTextureToSphericalPolynomial(v){var y;if(!v.isCube)return null;null===(y=v.va())||void 0===y||y.getEngine().flushFramebuffer();const n=v.getSize().width,B=v.readPixels(0,void 0,void 0,!1),J=v.readPixels(1,void 0,void 0,!1);let P,b;v.isRenderTarget?(P=v.readPixels(3,void 0,void 0,!1),b=v.readPixels(2,void 0,void 0,!1)):(P=v.readPixels(2,void 0,void 0,!1),b=v.readPixels(3,void 0,void 0,!1));const Y=v.readPixels(4,void 0,void 0,!1),l=v.readPixels(5,void 0,void 0,!1),a=v.gammaSpace;let Z=0;return 1!=v.textureType&&2!=v.textureType||(Z=1),new Promise((v=>{Promise.all([J,B,P,b,Y,l]).then((y=>{let[B,J,P,b,Y,l]=y;const x={size:n,right:J,left:B,up:P,down:b,front:Y,back:l,format:5,type:Z,gammaSpace:a};v(this.ConvertCubeMapToSphericalPolynomial(x))}))}))}static _AreaElement(v,y){return Math.atan2(v*y,Math.sqrt(v*v+y*y+1))}static ConvertCubeMapToSphericalPolynomial(v){const y=new P.e;let n=0;const B=2/v.size,l=B,a=.5*B,Z=a-1;for(let P=0;P<6;P++){const x=this._FileFaces[P],f=v[x.name];let N=Z;const i=5===v.format?4:3;for(let P=0;P<v.size;P++){let g=Z;for(let l=0;l<v.size;l++){const Z=x.worldAxisForFileX.scale(g).add(x.worldAxisForFileY.scale(N)).add(x.worldAxisForNormal);Z.normalize();const c=this._AreaElement(g-a,N-a)-this._AreaElement(g-a,N+a)-this._AreaElement(g+a,N-a)+this._AreaElement(g+a,N+a);let h=f[P*v.size*i+l*i+0],E=f[P*v.size*i+l*i+1],W=f[P*v.size*i+l*i+2];isNaN(h)&&(h=0),isNaN(E)&&(E=0),isNaN(W)&&(W=0),0===v.type&&(h/=255,E/=255,W/=255),v.gammaSpace&&(h=Math.pow((0,J.c)(h),b.h),E=Math.pow((0,J.c)(E),b.h),W=Math.pow((0,J.c)(W),b.h));const s=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const v=Math.max(h,E,W);if(v>s){const y=s/v;h*=y,E*=y,W*=y}}else h=(0,J.c)(h,0,s),E=(0,J.c)(E,0,s),W=(0,J.c)(W,0,s);const C=new Y.d(h,E,W);y.addLight(Z,C,c),n+=c,g+=B}N+=l}}const x=6*(4*Math.PI)/6/n;return y.scaleInPlace(x),y.convertIncidentRadianceToIrradiance(),y.convertIrradianceToLambertianRadiance(),P.f.FromHarmonics(y)}}a._FileFaces=[new l("right",new B.n(1,0,0),new B.n(0,0,-1),new B.n(0,-1,0)),new l("left",new B.n(-1,0,0),new B.n(0,0,1),new B.n(0,-1,0)),new l("up",new B.n(0,1,0),new B.n(1,0,0),new B.n(0,0,1)),new l("down",new B.n(0,-1,0),new B.n(1,0,0),new B.n(0,0,-1)),new l("front",new B.n(0,0,1),new B.n(1,0,0),new B.n(0,-1,0)),new l("back",new B.n(0,0,-1),new B.n(-1,0,0),new B.n(0,-1,0))],a.MAX_HDRI_VALUE=4096,a.PRESERVE_CLAMPED_COLORS=!1},11088:(v,y,n)=>{"use strict";function B(v,y){const n=[];for(let B=0;B<v;++B)n.push(y());return n}function J(v,y){return B(v,y)}n.d(y,{c:()=>B,e:()=>J,g:()=>b});const P=["push","splice","pop","shift","unshift"];function b(v,y){const n=P.map((n=>function(v,y,n){const B=v[y];if("function"!==typeof B)return null;const J=function(){const B=v.length,P=J.previous.apply(v,arguments);return n(y,B),P};return B.next=J,J.previous=B,v[y]=J,()=>{const n=J.previous;if(!n)return;const B=J.next;B?(n.next=B,B.previous=n):(n.next=void 0,v[y]=n),J.next=void 0,J.previous=void 0}}(v,n,y)));return()=>{n.forEach((v=>{null===v||void 0===v||v()}))}}},12284:(v,y,n)=>{"use strict";n.d(y,{c:()=>b});var B=n(11281),J=n(12287);let P=0;const b=v=>{if(!v.environmentBRDFTexture){const y=v.useDelayedTextureLoading;v.useDelayedTextureLoading=!1;const n=v._blockEntityCollection;v._blockEntityCollection=!1;const b=B.b.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+P++,v,!0,!1,B.b.BILINEAR_SAMPLINGMODE);v._blockEntityCollection=n;const Y=v.getEngine().getLoadedTexturesCache(),l=Y.indexOf(b.getInternalTexture());-1!==l&&Y.splice(l,1),b.isRGBD=!0,b.wrapU=B.b.CLAMP_ADDRESSMODE,b.wrapV=B.b.CLAMP_ADDRESSMODE,v.environmentBRDFTexture=b,v.useDelayedTextureLoading=y,J.c.ExpandRGBDTexture(b);const a=v.getEngine().onContextRestoredObservable.add((()=>{b.isRGBD=!0;const y=v.onBeforeRenderObservable.add((()=>{b.isReady()&&(v.onBeforeRenderObservable.remove(y),J.c.ExpandRGBDTexture(b))}))}));v.xj.add((()=>{v.getEngine().onContextRestoredObservable.remove(a)}))}return v.environmentBRDFTexture}},11345:(v,y,n)=>{"use strict";function B(v,y,n){try{const B=v.next();B.done?y(B):B.value?B.value.then((()=>{B.value=void 0,y(B)}),n):y(B)}catch(B){n(B)}}function J(){let v,y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(n,J,P)=>{const b=performance.now();void 0===v||b-v>y?(v=b,setTimeout((()=>{B(n,J,P)}),0)):B(n,J,P)}}function P(v,y,n,B,J){const P=()=>{let b;const Y=v=>{v.done?n(v.value):void 0===b?b=!0:P()};do{b=void 0,J&&J.aborted?B(new Error("Aborted")):y(v,Y,B),void 0===b&&(b=!1)}while(b)};P()}function b(v,y){let n;return P(v,B,(v=>n=v),(v=>{throw v}),y),n}function Y(v,y,n){return new Promise(((B,J)=>{P(v,y,B,J,n)}))}function l(v,y){return function(){return b(v(...arguments),y)}}n.d(y,{d:()=>J,g:()=>l,k:()=>Y,m:()=>b})},11576:(v,y,n)=>{"use strict";n.d(y,{e:()=>i});var B=n(11091),J=n(10801),P=n(11585),b=n(11594);n(11624);const Y=131072,l=131072;function a(v){return v.charCodeAt(0)+(v.charCodeAt(1)<<8)+(v.charCodeAt(2)<<16)+(v.charCodeAt(3)<<24)}const Z=a("DXT1"),x=a("DXT3"),f=a("DXT5"),N=a("DX10");class i{static GetDDSInfo(v){const y=new Int32Array(v.buffer,v.byteOffset,31),n=new Int32Array(v.buffer,v.byteOffset,35);let B=1;y[2]&Y&&(B=Math.max(1,y[7]));const J=y[21],P=J===N?n[32]:0;let b=0;switch(J){case 113:b=2;break;case 116:b=1;break;case N:if(10===P){b=2;break}if(2===P){b=1;break}}return{width:y[4],height:y[3],mipmapCount:B,isFourCC:4===(4&y[20]),isRGB:64===(64&y[20]),isLuminance:(y[20]&l)===l,isCube:512===(512&y[28]),isCompressed:J===Z||J===x||J===f,dxgiFormat:P,textureType:b}}static _GetHalfFloatAsFloatRGBAArrayBuffer(v,y,n,B,J,P){const Y=new Float32Array(B),l=new Uint16Array(J,n);let a=0;for(let Z=0;Z<y;Z++)for(let y=0;y<v;y++){const n=4*(y+Z*v);Y[a]=(0,b.e)(l[n]),Y[a+1]=(0,b.e)(l[n+1]),Y[a+2]=(0,b.e)(l[n+2]),i.StoreLODInAlphaChannel?Y[a+3]=P:Y[a+3]=(0,b.e)(l[n+3]),a+=4}return Y}static _GetHalfFloatRGBAArrayBuffer(v,y,n,B,J,P){if(i.StoreLODInAlphaChannel){const Y=new Uint16Array(B),l=new Uint16Array(J,n);let a=0;for(let n=0;n<y;n++)for(let y=0;y<v;y++){const B=4*(y+n*v);Y[a]=l[B],Y[a+1]=l[B+1],Y[a+2]=l[B+2],Y[a+3]=(0,b.i)(P),a+=4}return Y}return new Uint16Array(J,n,B)}static _GetFloatRGBAArrayBuffer(v,y,n,B,J,P){if(i.StoreLODInAlphaChannel){const b=new Float32Array(B),Y=new Float32Array(J,n);let l=0;for(let n=0;n<y;n++)for(let y=0;y<v;y++){const B=4*(y+n*v);b[l]=Y[B],b[l+1]=Y[B+1],b[l+2]=Y[B+2],b[l+3]=P,l+=4}return b}return new Float32Array(J,n,B)}static _GetFloatAsHalfFloatRGBAArrayBuffer(v,y,n,B,J,P){const Y=new Uint16Array(B),l=new Float32Array(J,n);let a=0;for(let Z=0;Z<y;Z++)for(let y=0;y<v;y++)Y[a]=(0,b.i)(l[a]),Y[a+1]=(0,b.i)(l[a+1]),Y[a+2]=(0,b.i)(l[a+2]),i.StoreLODInAlphaChannel?Y[a+3]=(0,b.i)(P):Y[a+3]=(0,b.i)(l[a+3]),a+=4;return Y}static _GetFloatAsUIntRGBAArrayBuffer(v,y,n,J,P,b){const Y=new Uint8Array(J),l=new Float32Array(P,n);let a=0;for(let Z=0;Z<y;Z++)for(let y=0;y<v;y++){const n=4*(y+Z*v);Y[a]=255*(0,B.c)(l[n]),Y[a+1]=255*(0,B.c)(l[n+1]),Y[a+2]=255*(0,B.c)(l[n+2]),i.StoreLODInAlphaChannel?Y[a+3]=b:Y[a+3]=255*(0,B.c)(l[n+3]),a+=4}return Y}static _GetHalfFloatAsUIntRGBAArrayBuffer(v,y,n,J,P,Y){const l=new Uint8Array(J),a=new Uint16Array(P,n);let Z=0;for(let x=0;x<y;x++)for(let y=0;y<v;y++){const n=4*(y+x*v);l[Z]=255*(0,B.c)((0,b.e)(a[n])),l[Z+1]=255*(0,B.c)((0,b.e)(a[n+1])),l[Z+2]=255*(0,B.c)((0,b.e)(a[n+2])),i.StoreLODInAlphaChannel?l[Z+3]=Y:l[Z+3]=255*(0,B.c)((0,b.e)(a[n+3])),Z+=4}return l}static _GetRGBAArrayBuffer(v,y,n,B,J,P,b,Y,l){const a=new Uint8Array(B),Z=new Uint8Array(J,n);let x=0;for(let f=0;f<y;f++)for(let y=0;y<v;y++){const n=4*(y+f*v);a[x]=Z[n+P],a[x+1]=Z[n+b],a[x+2]=Z[n+Y],a[x+3]=Z[n+l],x+=4}return a}static _ExtractLongWordOrder(v){return 0===v||255===v||-16777216===v?0:1+i._ExtractLongWordOrder(v>>8)}static _GetRGBArrayBuffer(v,y,n,B,J,P,b,Y){const l=new Uint8Array(B),a=new Uint8Array(J,n);let Z=0;for(let x=0;x<y;x++)for(let y=0;y<v;y++){const n=3*(y+x*v);l[Z]=a[n+P],l[Z+1]=a[n+b],l[Z+2]=a[n+Y],Z+=3}return l}static _GetLuminanceArrayBuffer(v,y,n,B,J){const P=new Uint8Array(B),b=new Uint8Array(J,n);let Y=0;for(let l=0;l<y;l++)for(let y=0;y<v;y++){const n=y+l*v;P[Y]=b[n],Y++}return P}static UploadDDSLevels(v,y,n,B,b,l){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,g=arguments.length>7?arguments[7]:void 0,c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],h=null;B.sphericalPolynomial&&(h=[]);const E=!!v.getCaps().s3tc;y.generateMipMaps=b;const W=new Int32Array(n.buffer,n.byteOffset,31);let s,C,r,u,O,d,q,L=0,t=0,G=1;if(542327876!==W[0])return void J.e.Error("Invalid magic number in DDS header");if(!B.isFourCC&&!B.isRGB&&!B.isLuminance)return void J.e.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(B.isCompressed&&!E)return void J.e.Error("Compressed textures are not supported on this platform.");let R=W[22];u=W[1]+4;let F=!1;if(B.isFourCC)switch(s=W[21],s){case Z:G=8,t=33777;break;case x:G=16,t=33778;break;case f:G=16,t=33779;break;case 113:F=!0,R=64;break;case 116:F=!0,R=128;break;case N:{u+=20;let v=!1;switch(B.dxgiFormat){case 10:F=!0,R=64,v=!0;break;case 2:F=!0,R=128,v=!0;break;case 88:B.isRGB=!0,B.isFourCC=!1,R=32,v=!0}if(v)break}default:return void J.e.Error(["Unsupported FourCC code:",(S=s,String.fromCharCode(255&S,S>>8&255,S>>16&255,S>>24&255))])}var S;const w=i._ExtractLongWordOrder(W[23]),k=i._ExtractLongWordOrder(W[24]),M=i._ExtractLongWordOrder(W[25]),I=i._ExtractLongWordOrder(W[26]);F&&(t=v._getRGBABufferInternalSizedFormat(B.textureType)),d=1,W[2]&Y&&!1!==b&&(d=Math.max(1,W[7]));const j=g||0,V=v.getCaps();for(let J=j;J<l;J++){for(C=W[4],r=W[3],q=0;q<d;++q){if(-1===a||a===q){const P=-1===a?q:0;if(!B.isCompressed&&B.isFourCC){y.format=5,L=C*r*4;let B=null;if(v._badOS||v._badDesktopOS||!V.textureHalfFloat&&!V.textureFloat)128===R?(B=i._GetFloatAsUIntRGBAArrayBuffer(C,r,n.byteOffset+u,L,n.buffer,P),h&&0==P&&h.push(i._GetFloatRGBAArrayBuffer(C,r,n.byteOffset+u,L,n.buffer,P))):64===R&&(B=i._GetHalfFloatAsUIntRGBAArrayBuffer(C,r,n.byteOffset+u,L,n.buffer,P),h&&0==P&&h.push(i._GetHalfFloatAsFloatRGBAArrayBuffer(C,r,n.byteOffset+u,L,n.buffer,P))),y.type=0;else{const v=V.textureFloat&&(c&&V.textureFloatLinearFiltering||!c),J=V.textureHalfFloat&&(c&&V.textureHalfFloatLinearFiltering||!c),b=(128===R||64===R&&!J)&&v?1:(64===R||128===R&&!v)&&J?2:0;let Y,l=null;if(128===R)switch(b){case 1:Y=i._GetFloatRGBAArrayBuffer,l=null;break;case 2:Y=i._GetFloatAsHalfFloatRGBAArrayBuffer,l=i._GetFloatRGBAArrayBuffer;break;case 0:Y=i._GetFloatAsUIntRGBAArrayBuffer,l=i._GetFloatRGBAArrayBuffer}else switch(b){case 1:Y=i._GetHalfFloatAsFloatRGBAArrayBuffer,l=null;break;case 2:Y=i._GetHalfFloatRGBAArrayBuffer,l=i._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:Y=i._GetHalfFloatAsUIntRGBAArrayBuffer,l=i._GetHalfFloatAsFloatRGBAArrayBuffer}y.type=b,B=Y(C,r,n.byteOffset+u,L,n.buffer,P),h&&0==P&&h.push(l?l(C,r,n.byteOffset+u,L,n.buffer,P):B)}B&&v._uploadDataToTextureDirectly(y,B,J,P)}else if(B.isRGB)y.type=0,24===R?(y.format=4,L=C*r*3,O=i._GetRGBArrayBuffer(C,r,n.byteOffset+u,L,n.buffer,w,k,M),v._uploadDataToTextureDirectly(y,O,J,P)):(y.format=5,L=C*r*4,O=i._GetRGBAArrayBuffer(C,r,n.byteOffset+u,L,n.buffer,w,k,M,I),v._uploadDataToTextureDirectly(y,O,J,P));else if(B.isLuminance){const B=v._getUnpackAlignement(),b=C;L=Math.floor((C+B-1)/B)*B*(r-1)+b,O=i._GetLuminanceArrayBuffer(C,r,n.byteOffset+u,L,n.buffer),y.format=1,y.type=0,v._uploadDataToTextureDirectly(y,O,J,P)}else L=Math.max(4,C)/4*Math.max(4,r)/4*G,O=new Uint8Array(n.buffer,n.byteOffset+u,L),y.type=0,v._uploadCompressedDataToTextureDirectly(y,t,C,r,O,J,P)}u+=R?C*r*(R/8):L,C*=.5,r*=.5,C=Math.max(1,C),r=Math.max(1,r)}if(void 0!==g)break}h&&h.length>0?B.sphericalPolynomial=P.b.ConvertCubeMapToSphericalPolynomial({size:W[4],right:h[0],left:h[1],up:h[2],down:h[3],front:h[4],back:h[5],format:5,type:1,gammaSpace:!1}):B.sphericalPolynomial=void 0}}i.StoreLODInAlphaChannel=!1},11059:(v,y,n)=>{"use strict";n.d(y,{b:()=>P,c:()=>b});const B={},J={};function P(v){const y=v.getClassName();return J[y]||(J[y]={}),J[y]}function b(v){const y=v.getClassName();if(B[y])return B[y];B[y]={};const n=B[y];let P=v,b=y;for(;b;){const v=J[b];for(const J in v)n[J]=v[J];let y,B=!1;do{if(y=Object.getPrototypeOf(P),!y.getClassName){B=!0;break}if(y.getClassName()!==b)break;P=y}while(y);if(B)break;b=y.getClassName(),P=y}return n}},11055:(v,y,n)=>{"use strict";n.d(y,{B:()=>c,E:()=>Y,H:()=>Z,I:()=>x,M:()=>b,d:()=>P,g:()=>E,i:()=>N,j:()=>l,m:()=>i,n:()=>a,q:()=>g,t:()=>h,x:()=>f});var B=n(11059);function J(v,y){return(n,J)=>{const P=(0,B.b)(n);P[J]||(P[J]={type:v,sourceName:y})}}function P(v){return function(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(n,B)=>{const J=y||"_"+B;Object.defineProperty(n,B,{get:function(){return this[J]},set:function(y){"function"===typeof this.equals&&this.equals(y)||this[J]!==y&&(this[J]=y,n[v].apply(this))},enumerable:!0,configurable:!0})}}(v,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function b(v){return J(0,v)}function Y(v){return J(1,v)}function l(v){return J(2,v)}function a(v){return J(3,v)}function Z(v){return J(4,v)}function x(v){return J(5,v)}function f(v){return J(6,v)}function N(v){return J(7,v)}function i(v){return J(8,v)}function g(v){return J(9,v)}function c(v){return J(10,v)}function h(v){return J(12,v)}function E(v,y,n,B){const J=n.value;n.value=function(){let n=J;if("undefined"!==typeof _native&&_native[y]){const v=_native[y];n=B?function(){return B(...arguments)?v(...arguments):J(...arguments)}:v}return v[y]=n,n(...arguments)}}E.filter=function(v){return(y,n,B)=>E(y,n,B,v)}},11110:(v,y,n)=>{"use strict";n.d(y,{d:()=>a});var B=n(10811),J=n(11076),P=n(11103),b=n(11081),Y=n(11059);const l=function(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const P=v();J.c&&J.c.HasTags(y)&&J.c.AddTagsTo(P,J.c.GetTags(y,!0));const b=(0,Y.c)(P),l={};for(const J in b){const v=b[J],Y=y[J],Z=v.type;if(void 0!==Y&&null!==Y&&("uniqueId"!==J||a.AllowLoadingUniqueId))switch(Z){case 0:case 6:case 11:P[J]=Y;break;case 1:B.cloneTexturesOnlyOnce&&l[Y.uniqueId]?P[J]=l[Y.uniqueId]:(P[J]=n||Y.isRenderTarget?Y:Y.clone(),l[Y.uniqueId]=P[J]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:P[J]=n?Y:Y.clone()}}return P};class a{static AppendSerializedAnimations(v,y){if(v.animations){y.animations=[];for(let n=0;n<v.animations.length;n++){const B=v.animations[n];y.animations.push(B.serialize())}}}static Serialize(v,y){y||(y={}),J.c&&(y.tags=J.c.GetTags(v));const n=(0,Y.c)(v);for(const B in n){const J=n[B],P=J.sourceName||B,b=J.type,Y=v[B];if(void 0!==Y&&null!==Y&&("uniqueId"!==B||a.AllowLoadingUniqueId))switch(b){case 0:y[P]=Y;break;case 1:case 3:case 7:case 9:y[P]=Y.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:y[P]=Y.wj();break;case 6:case 11:y[P]=Y.id}}return y}static ParseProperties(v,y,n,B){B||(B="");const J=(0,Y.c)(y);for(const Y in J){const l=J[Y],Z=v[l.sourceName||Y],x=l.type;if(void 0!==Z&&null!==Z&&("uniqueId"!==Y||a.AllowLoadingUniqueId)){const v=y;switch(x){case 0:v[Y]=Z;break;case 1:n&&(v[Y]=a._TextureParser(Z,n,B));break;case 2:v[Y]=P.d.qh(Z);break;case 3:v[Y]=a._FresnelParametersParser(Z);break;case 4:v[Y]=b.j.qh(Z);break;case 5:v[Y]=b.n.qh(Z);break;case 6:n&&(v[Y]=n.getLastMeshById(Z));break;case 7:v[Y]=a._ColorCurvesParser(Z);break;case 8:v[Y]=P.e.qh(Z);break;case 9:v[Y]=a._ImageProcessingConfigurationParser(Z);break;case 10:v[Y]=b.g.qh(Z);break;case 11:n&&(v[Y]=n.getCameraById(Z));break;case 12:v[Y]=b.d.qh(Z)}}}}static Parse(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const P=v();return J.c&&J.c.AddTagsTo(P,y.tags),a.ParseProperties(y,P,n,B),P}static Clone(v,y){return l(v,y,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(v,y){return l(v,y,!0)}}a.AllowLoadingUniqueId=!1,a._ImageProcessingConfigurationParser=v=>{throw(0,B.e)("ImageProcessingConfiguration")},a._FresnelParametersParser=v=>{throw(0,B.e)("FresnelParameters")},a._ColorCurvesParser=v=>{throw(0,B.e)("ColorCurves")},a._TextureParser=(v,y,n)=>{throw(0,B.e)("Texture")}},10803:(v,y,n)=>{"use strict";n.d(y,{c:()=>P});var B=n(10801);const J=(v,y,n)=>v?v.getClassName&&"Mesh"===v.getClassName()?null:!v.getClassName||"SubMesh"!==v.getClassName()&&"PhysicsBody"!==v.getClassName()?v.clone?v.clone():Array.isArray(v)?v.slice():n&&"object"===typeof v?{...v}:null:v.clone(y):null;class P{static DeepCopy(v,y,n,P){let b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const Y=function(v){const y=[];do{Object.getOwnPropertyNames(v).forEach((function(v){-1===y.indexOf(v)&&y.push(v)}))}while(v=Object.getPrototypeOf(v));return y}(v);for(const a of Y){if("_"===a[0]&&(!P||-1===P.indexOf(a)))continue;if(a.endsWith("Observable"))continue;if(n&&-1!==n.indexOf(a))continue;const Y=v[a],Z=typeof Y;if("function"!==Z)try{if("object"===Z)if(Y instanceof Uint8Array)y[a]=Uint8Array.from(Y);else if(Y instanceof Array){if(y[a]=[],Y.length>0)if("object"==typeof Y[0])for(let v=0;v<Y.length;v++){const n=J(Y[v],y,b);-1===y[a].indexOf(n)&&y[a].push(n)}else y[a]=Y.slice(0)}else y[a]=J(Y,y,b);else y[a]=Y}catch(l){B.e.Warn(l.message)}}}}},10811:(v,y,n)=>{"use strict";n.d(y,{e:()=>J});const B={};function J(v){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!B[v])return B[v]=!0,`${v} needs to be imported before as it contains a side-effect required by your code.`}},10797:(v,y,n)=>{"use strict";function B(){return"undefined"!==typeof window}function J(){return"undefined"!==typeof navigator}function P(){return"undefined"!==typeof document}function b(v){let y="",n=v.firstChild;for(;n;)3===n.nodeType&&(y+=n.textContent),n=n.nextSibling;return y}n.d(y,{c:()=>b,g:()=>P,h:()=>J,k:()=>B})},12321:(v,y,n)=>{"use strict";n.r(y),n.d(y,{Dispose:()=>f,DumpData:()=>x,DumpDataAsync:()=>Z,DumpFramebuffer:()=>a,DumpTools:()=>N});var B=n(11615),J=n(10791),P=n(11091),b=n(10820);let Y,l=null;async function a(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",P=arguments.length>5?arguments[5]:void 0,b=arguments.length>6?arguments[6]:void 0;const Y=await n.readPixels(0,0,v,y);x(v,y,new Uint8Array(Y.buffer),B,J,P,!0,void 0,b)}function Z(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",J=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7?arguments[7]:void 0;return new Promise((l=>{x(v,y,n,(v=>l(v)),B,J,P,b,Y)}))}function x(v,y,a,Z){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",N=arguments.length>5?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8?arguments[8]:void 0;(async function(){return l||(l=new Promise(((v,y)=>{let J,P=null;const l={Oh:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(n.bind(n,11503)).then((a=>{let{ThinEngine:Z}=a;try{J=new OffscreenCanvas(100,100),P=new Z(J,!1,l)}catch(N){J=document.createElement("canvas"),P=new Z(J,!1,l)}b.b.Instances.pop(),b.b.OnEnginesDisposedObservable.add((v=>{P&&v!==P&&!P.u&&0===b.b.Instances.length&&f()})),P.getCaps().parallelShaderCompile=void 0;const x=new B.c(P);n.e(34).then(n.bind(n,13557)).then((n=>{let{passPixelShader:b}=n;if(!P)return void y("Engine is not defined");const l=new B.e({Od:P,name:b.name,fragmentShader:b.shader,samplerNames:["textureSampler"]});Y={canvas:J,Od:P,renderer:x,wrapper:l},v(Y)}))})).catch(y)}))),await l})().then((n=>{if(n.Od.setSize(v,y,!0),a instanceof Float32Array){const v=new Uint8Array(a.length);let y=a.length;for(;y--;){const n=a[y];v[y]=Math.round(255*(0,P.c)(n))}a=v}const B=n.Od.createRawTexture(a,v,y,5,!1,!i,1);n.renderer.setViewport(),n.renderer.applyEffectWrapper(n.wrapper),n.wrapper.effect._bindTexture("textureSampler",B),n.renderer.draw(),g?J.g.ToBlob(n.canvas,(v=>{const y=new FileReader;y.onload=v=>{const y=v.target.result;Z&&Z(y)},y.readAsArrayBuffer(v)}),x,c):J.g.EncodeScreenshotCanvasData(n.canvas,Z,x,N,c),B.dispose()}))}function f(){var v;Y?(Y.wrapper.dispose(),Y.renderer.dispose(),Y.Od.dispose()):null===(v=l)||void 0===v||v.then((v=>{v.wrapper.dispose(),v.renderer.dispose(),v.Od.dispose()}));l=null,Y=null}const N={DumpData:x,DumpDataAsync:Z,DumpFramebuffer:a,Dispose:f};J.g.DumpData=x,J.g.DumpDataAsync=Z,J.g.DumpFramebuffer=a},12319:(v,y,n)=>{"use strict";n.d(y,{c:()=>i,g:()=>h,i:()=>s,k:()=>C});var B=n(10791),J=n(11081),P=n(11091),b=n(11559),Y=n(10885),l=n(11283),a=(n(11070),n(11609)),Z=n(10801);n(12287),n(12293),n(12321);const x="image/png",f=2,N=[134,22,135,150,246,214,150,54];function i(v){const y=new DataView(v.buffer,v.byteOffset,v.byteLength);let n=0;for(let b=0;b<N.length;b++)if(y.getUint8(n++)!==N[b])return Z.e.Error("Not a babylon environment map"),null;let B="",J=0;for(;J=y.getUint8(n++);)B+=String.fromCharCode(J);let P=JSON.parse(B);return P=g(P),P.Rh&&(P.Rh.specularDataPosition=n,P.Rh.lodGenerationScale=P.Rh.lodGenerationScale||.8),P}function g(v){if(v.version>f)throw new Error(`Unsupported babylon environment map version "${v.version}". Latest supported version is "${f}".`);return 2===v.version?v:v={...v,version:2,imageType:x}}function c(v,y){const n=(y=g(y)).Rh;let B=Math.log2(y.width);if(B=Math.round(B)+1,n.mipmaps.length!==6*B)throw new Error(`Unsupported specular mipmaps number "${n.mipmaps.length}"`);const J=new Array(B);for(let P=0;P<B;P++){J[P]=new Array(6);for(let y=0;y<6;y++){const B=n.mipmaps[6*P+y];J[P][y]=new Uint8Array(v.buffer,v.byteOffset+n.specularDataPosition+B.position,B.length)}}return J}function h(v,y,n){const B=(n=g(n)).Rh;if(!B)return Promise.resolve();v._lodGenerationScale=B.lodGenerationScale;return W(v,c(y,n),n.imageType)}function E(v,y,n,B,J,P,b,Y,l,a,Z){return new Promise(((x,f)=>{if(n){const n=y.createTexture(null,!0,!0,null,1,null,(v=>{f(v)}),v);null===B||void 0===B||B.onEffectCreatedObservable.addOnce((Y=>{Y.executeWhenCompiled((()=>{B.externalTextureSamplerBinding=!0,B.onApply=B=>{B._bindTexture("textureSampler",n),B.setFloat2("scale",1,y._features.needsInvertingBitmap&&v instanceof ImageBitmap?-1:1)},y.scenes.length&&(y.scenes[0].postProcessManager.directRender([B],a,!0,P,b),y.restoreDefaultFramebuffer(),n.dispose(),URL.revokeObjectURL(J),x())}))}))}else{if(y._uploadImageToTexture(Z,v,P,b),Y){const n=l[b];n&&y._uploadImageToTexture(n._texture,v,P,0)}x()}}))}async function W(v,y){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x;if(!B.g.IsExponentOfTwo(v.width))throw new Error("Texture size must be a power of two");const b=(0,P.h)(v.width)+1,Z=v.getEngine();let f=!1,N=!1,i=null,g=null,c=null;const h=Z.getCaps();v.format=5,v.type=0,v.generateMipMaps=!0,v._cachedAnisotropicFilteringLevel=null,Z.updateTextureSamplingMode(3,v),h.textureLOD?Z._features.supportRenderAndCopyToLodForFloatTextures?h.textureHalfFloatRender&&h.textureHalfFloatLinearFiltering?(f=!0,v.type=2):h.textureFloatRender&&h.textureFloatLinearFiltering&&(f=!0,v.type=1):f=!1:(f=!1,N=!0,c={});let W=0;if(f)Z.isWebGPU?(W=1,await n.e(39).then(n.bind(n,13573))):await n.e(41).then(n.bind(n,13583)),i=new a.c("rgbdDecode","rgbdDecode",null,null,1,null,3,Z,!1,void 0,v.type,void 0,null,!1,void 0,W),v._isRGBD=!1,v.invertY=!1,g=Z.createRenderTargetCubeTexture(v.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:v.type,format:5});else if(v._isRGBD=!0,v.invertY=!0,N){const y=3,n=v._lodGenerationScale,B=v._lodGenerationOffset;for(let J=0;J<y;J++){const P=(b-1)*n+B,a=B+(P-B)*(1-J/(y-1)),x=Math.round(Math.min(Math.max(a,0),P)),f=new Y.b(Z,2);f.isCube=!0,f.invertY=!0,f.generateMipMaps=!1,Z.updateTextureSamplingMode(2,f);const N=new l.b(null);switch(N._isCube=!0,N._texture=f,c[x]=N,J){case 0:v._lodTextureLow=N;break;case 1:v._lodTextureMid=N;break;case 2:v._lodTextureHigh=N}}}const s=[];for(let n=0;n<y.length;n++)for(let B=0;B<6;B++){const P=y[n][B],b=new Blob([P],{type:J}),Y=URL.createObjectURL(b);let l;if(Z._features.forceBitmapOverHTMLImageElement)l=Z.createImageBitmap(b,{premultiplyAlpha:"none"}).then((y=>E(y,Z,f,i,Y,B,n,N,c,g,v)));else{const y=new Image;y.src=Y,l=new Promise(((J,P)=>{y.onload=()=>{E(y,Z,f,i,Y,B,n,N,c,g,v).then((()=>J())).catch((v=>{P(v)}))},y.onerror=v=>{P(v)}}))}s.push(l)}if(y.length<b){let n;const B=Math.pow(2,b-1-y.length),J=B*B*4;switch(v.type){case 0:n=new Uint8Array(J);break;case 2:n=new Uint16Array(J);break;case 1:n=new Float32Array(J)}for(let P=y.length;P<b;P++)for(let y=0;y<6;y++)Z._uploadArrayBufferViewToTexture(v,n,y,P)}return Promise.all(s).then((()=>{g&&(Z._releaseTexture(v),g._swapAndDie(v)),i&&i.dispose(),N&&(v._lodTextureHigh&&v._lodTextureHigh._texture&&(v._lodTextureHigh._texture.isReady=!0),v._lodTextureMid&&v._lodTextureMid._texture&&(v._lodTextureMid._texture.isReady=!0),v._lodTextureLow&&v._lodTextureLow._texture&&(v._lodTextureLow._texture.isReady=!0))}))}function s(v,y){const n=(y=g(y)).irradiance;if(!n)return;const B=new b.f;J.n.FromArrayToRef(n.x,0,B.x),J.n.FromArrayToRef(n.y,0,B.y),J.n.FromArrayToRef(n.z,0,B.z),J.n.FromArrayToRef(n.xx,0,B.xx),J.n.FromArrayToRef(n.yy,0,B.yy),J.n.FromArrayToRef(n.zz,0,B.zz),J.n.FromArrayToRef(n.yz,0,B.yz),J.n.FromArrayToRef(n.zx,0,B.zx),J.n.FromArrayToRef(n.xy,0,B.xy),v._sphericalPolynomial=B}function C(v,y,n,B,J){const P=W(v.getEngine().createRawCubeTexture(null,v.width,v.format,v.type,v.generateMipMaps,v.invertY,v.samplingMode,v._compression),y).then((()=>v));return v.onRebuildCallback=v=>({proxy:P,isReady:!0,isAsync:!0}),v._source=13,v._bufferViewArrayArray=y,v._lodGenerationScale=B,v._lodGenerationOffset=J,v._sphericalPolynomial=n,W(v,y).then((()=>(v.isReady=!0,v)))}},10831:(v,y,n)=>{"use strict";n.d(y,{e:()=>B,f:()=>J,j:()=>P});class B extends Error{}B._setPrototypeOf=Object.setPrototypeOf||((v,y)=>(v.__proto__=y,v));const J={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class P extends B{constructor(v,y,n){super(v),this.errorCode=y,this.innerError=n,this.name="RuntimeError",B._setPrototypeOf(this,P.prototype)}}},10828:(v,y,n)=>{"use strict";n.d(y,{e:()=>G,f:()=>W,i:()=>L,q:()=>O,m:()=>c,s:()=>r,t:()=>u,w:()=>d,y:()=>s});var B=n(10816),J=n(10797),P=n(10795);class b{}b.FilesToLoad={};var Y=n(10831),l=n(10835),a=n(10841),Z=n(10820),x=n(10801),f=n(10847),N=n(10845),i=n(10849);const g=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class c extends Y.j{constructor(v,y){super(v,Y.f.LoadFileError),this.name="LoadFileError",Y.e._setPrototypeOf(this,c.prototype),y instanceof B.c?this.request=y:this.file=y}}class h extends Y.j{constructor(v,y){super(v,Y.f.RequestFileError),this.request=y,this.name="RequestFileError",Y.e._setPrototypeOf(this,h.prototype)}}class E extends Y.j{constructor(v,y){super(v,Y.f.ReadFileError),this.file=y,this.name="ReadFileError",Y.e._setPrototypeOf(this,E.prototype)}}const W={DefaultRetryStrategy:class{static ExponentialBackoff(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(n,B,J)=>0!==B.status||J>=v||-1!==n.indexOf("file:")?-1:Math.pow(2,J)*y}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:v=>v,ScriptBaseUrl:"",ScriptPreprocessUrl:v=>v,CleanUrl:v=>v=v.replace(/#/gm,"%23")},s=(v,y)=>{if((!v||0!==v.indexOf("data:"))&&W.CorsBehavior)if("string"===typeof W.CorsBehavior||W.CorsBehavior instanceof String)y.crossOrigin=W.CorsBehavior;else{const n=W.CorsBehavior(v);n&&(y.crossOrigin=n)}},C={getRequiredSize:null},r=function(v,y,n,J){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",Y=arguments.length>5?arguments[5]:void 0;const a=Z.b.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===a||void 0===a||!a._features.forceBitmapOverHTMLImageElement))return n("LoadImage is only supported in web or BabylonNative environments."),null;let x,f=!1;v instanceof ArrayBuffer||ArrayBuffer.isView(v)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(x=URL.createObjectURL(new Blob([v],{type:P})),f=!0):x=`data:${P};base64,`+(0,l.n)(v):v instanceof Blob?(x=URL.createObjectURL(v),f=!0):(x=W.CleanUrl(v),x=W.PreprocessUrl(x));const N=y=>{if(n){const B=x||v.toString();n(`Error while trying to load image: ${0===B.indexOf("http")||B.length<=128?B:B.slice(0,128)+"..."}`,y)}};if(null!==a&&void 0!==a&&a._features.forceBitmapOverHTMLImageElement)return O(x,(B=>{a.createImageBitmap(new Blob([B],{type:P}),{premultiplyAlpha:"none",...Y}).then((v=>{y(v),f&&URL.revokeObjectURL(x)})).catch((y=>{n&&n("Error while trying to load image: "+v,y)}))}),void 0,J||void 0,!0,((v,y)=>{N(y)})),null;const i=new Image;if(C.getRequiredSize){const y=C.getRequiredSize(v);y.width&&(i.width=y.width),y.height&&(i.height=y.height)}s(x,i);const g=[],c=()=>{g.forEach((v=>{v.target.removeEventListener(v.name,v.handler)})),g.length=0};g.push({target:i,name:"load",handler:()=>{c(),y(i),f&&i.src&&URL.revokeObjectURL(i.src)}}),g.push({target:i,name:"error",handler:v=>{c(),N(v),f&&i.src&&URL.revokeObjectURL(i.src)}}),g.push({target:document,name:"securitypolicyviolation",handler:v=>{if(v.blockedURI!==i.src||"ym"===v.disposition)return;c();const y=new Error(`CSP violation of policy ${v.effectiveDirective} ${v.blockedURI}. Current policy is ${v.originalPolicy}`);Z.b.UseFallbackTexture=!1,N(y),f&&i.src&&URL.revokeObjectURL(i.src),i.src=""}}),g.forEach((v=>{v.target.addEventListener(v.name,v.handler)}));const h="blob:"===x.substring(0,5),E="data:"===x.substring(0,5),r=()=>{h||E||!B.c.IsCustomRequestAvailable?i.src=x:O(x,((v,y,n)=>{const B=new Blob([v],{type:!P&&n?n:P}),J=URL.createObjectURL(B);f=!0,i.src=J}),void 0,J||void 0,!0,((v,y)=>{N(y)}))},u=()=>{J&&J.loadImage(x,i)};if(!h&&!E&&J&&J.enableTexturesOffline)J.open(u,r);else{if(-1!==x.indexOf("file:")){const v=decodeURIComponent(x.substring(5).toLowerCase());if(b.FilesToLoad[v]&&"undefined"!==typeof URL){try{let y;try{y=URL.createObjectURL(b.FilesToLoad[v])}catch(d){y=URL.createObjectURL(b.FilesToLoad[v])}i.src=y,f=!0}catch(q){i.src=""}return i}}r()}return i},u=(v,y,n,B,J)=>{const b=new FileReader,Y={onCompleteObservable:new P.e,abort:()=>b.abort()};return b.onloadend=()=>Y.onCompleteObservable.notifyObservers(Y),J&&(b.onerror=()=>{J(new E(`Unable to read ${v.name}`,v))}),b.onload=v=>{y(v.target.result)},n&&(b.onprogress=n),B?b.readAsArrayBuffer(v):b.readAsText(v),Y},O=(v,y,n,B,J,l,a)=>{if(v.name)return u(v,y,n,J,l?v=>{l(void 0,v)}:void 0);const Z=v;if(-1!==Z.indexOf("file:")){let v=decodeURIComponent(Z.substring(5).toLowerCase());0===v.indexOf("./")&&(v=v.substring(2));const B=b.FilesToLoad[v];if(B)return u(B,y,n,J,l?v=>l(void 0,new c(v.message,v.file)):void 0)}const{match:N,type:i}=t(Z);if(N){const v={onCompleteObservable:new P.e,abort:()=>()=>{}};try{const v=J?G(Z):R(Z);y(v,void 0,i)}catch(Y){l?l(void 0,Y):x.e.Error(Y.message||"Failed to parse the Data URL")}return f.c.SetImmediate((()=>{v.onCompleteObservable.notifyObservers(v)})),v}return d(Z,((v,n)=>{y(v,null===n||void 0===n?void 0:n.responseURL,null===n||void 0===n?void 0:n.getResponseHeader("content-type"))}),n,B,J,l?v=>{l(v.request,new c(v.message,v.request))}:void 0,a)},d=(v,y,n,b,Y,l,a)=>{v=W.CleanUrl(v),v=W.PreprocessUrl(v);const Z=W.BaseUrl+v;let f=!1;const N={onCompleteObservable:new P.e,abort:()=>f=!0},i=()=>{let v,P=new B.c,b=null;const i=()=>{P&&(n&&P.removeEventListener("progress",n),v&&P.removeEventListener("readystatechange",v),P.removeEventListener("loadend",g))};let g=()=>{i(),N.onCompleteObservable.notifyObservers(N),N.onCompleteObservable.clear(),n=void 0,v=null,g=null,l=void 0,a=void 0,y=void 0};N.abort=()=>{f=!0,g&&g(),P&&P.readyState!==(XMLHttpRequest.DONE||4)&&P.abort(),null!==b&&(clearTimeout(b),b=null),P=null};const c=v=>{const y=v.message||"Unknown error";l&&P?l(new h(y,P)):x.e.Error(y)},E=x=>{if(P){if(P.open("GET",Z),a)try{a(P)}catch(N){return void c(N)}Y&&(P.responseType="arraybuffer"),n&&P.addEventListener("progress",n),g&&P.addEventListener("loadend",g),v=()=>{if(!f&&P&&P.readyState===(XMLHttpRequest.DONE||4)){if(v&&P.removeEventListener("readystatechange",v),P.status>=200&&P.status<300||0===P.status&&(!(0,J.k)()||q())){try{y&&y(Y?P.response:P.responseText,P)}catch(N){c(N)}return}const n=W.DefaultRetryStrategy;if(n){const v=n(Z,P,x);if(-1!==v)return i(),P=new B.c,void(b=setTimeout((()=>E(x+1)),v))}const a=new h("Error status: "+P.status+" "+P.statusText+" - Unable to load "+Z,P);l&&l(a)}},P.addEventListener("readystatechange",v),P.send()}};E(0)};if(b&&b.enableSceneOffline){const B=v=>{v&&v.status>400?l&&l(v):i()},J=()=>{b&&b.loadFile(W.BaseUrl+v,(v=>{!f&&y&&y(v),N.onCompleteObservable.notifyObservers(N)}),n?v=>{!f&&n&&n(v)}:void 0,B,Y)};b.open(J,B)}else i();return N},q=()=>"undefined"!==typeof location&&"file:"===location.protocol,L=v=>g.test(v),t=v=>{const y=g.exec(v);if(null===y||0===y.length)return{match:!1,type:""};return{match:!0,type:y[0].replace("data:","").replace("base64,","")}};function G(v){return(0,l.d)(v.split(",")[1])}const R=v=>(0,l.f)(v.split(",")[1]);let F;i.c._FileToolsLoadImage=r,N.c.loadFile=O,a.l.loadFile=O;((v,y,n,B,J,P,b,Y,l,a)=>{F={DecodeBase64UrlToBinary:v,DecodeBase64UrlToString:y,DefaultRetryStrategy:n.DefaultRetryStrategy,BaseUrl:n.BaseUrl,CorsBehavior:n.CorsBehavior,PreprocessUrl:n.PreprocessUrl,IsBase64DataUrl:B,IsFileURL:J,LoadFile:P,LoadImage:b,ReadFile:Y,RequestFile:l,SetCorsBehavior:a},Object.defineProperty(F,"DefaultRetryStrategy",{get:function(){return n.DefaultRetryStrategy},set:function(v){n.DefaultRetryStrategy=v}}),Object.defineProperty(F,"BaseUrl",{get:function(){return n.BaseUrl},set:function(v){n.BaseUrl=v}}),Object.defineProperty(F,"PreprocessUrl",{get:function(){return n.PreprocessUrl},set:function(v){n.PreprocessUrl=v}}),Object.defineProperty(F,"CorsBehavior",{get:function(){return n.CorsBehavior},set:function(v){n.CorsBehavior=v}})})(G,R,W,L,q,O,r,u,d,s)},10911:(v,y,n)=>{"use strict";function B(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(v=>{const y=16*Math.random()|0;return("x"===v?y:3&y|8).toString(16)}))}n.d(y,{b:()=>B})},10899:(v,y,n)=>{"use strict";n.d(y,{b:()=>P});var B=n(10801),J=n(10908);class P{static Instantiate(v){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[v])return this.RegisteredExternalClasses[v];const y=(0,J.d)(v);if(y)return y;B.e.Warn(v+" not found, you may have missed an import.");const n=v.split(".");let P=window||this;for(let B=0,J=n.length;B<J;B++)P=P[n[B]];return"function"!==typeof P?null:P}}P.RegisteredExternalClasses={}},10801:(v,y,n)=>{"use strict";n.d(y,{e:()=>B});class B{static _CheckLimit(v,y){let n=B._LogLimitOutputs[v];return n?n.current++:(n={limit:y,current:1},B._LogLimitOutputs[v]=n),n.current<=n.limit}static _GenerateLimitMessage(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=B._LogLimitOutputs[v];if(!n||!B.MessageLimitReached)return;const J=this._Levels[y];n.current===n.limit&&B[J.name](B.MessageLimitReached.replace(/%LIMIT%/g,""+n.limit).replace(/%TYPE%/g,J.name??""))}static _AddLogEntry(v){B._LogCache=v+B._LogCache,B.OnNewCacheEntry&&B.OnNewCacheEntry(v)}static _FormatMessage(v){const y=v=>v<10?"0"+v:""+v,n=new Date;return"["+y(n.getHours())+":"+y(n.getMinutes())+":"+y(n.getSeconds())+"]: "+v}static _LogDisabled(v,y){}static _LogEnabled(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;const J=Array.isArray(y)?y[0]:y;if(void 0!==n&&!B._CheckLimit(J,n))return;const P=B._FormatMessage(J),b=this._Levels[v],Y=Array.isArray(y)?y.slice(1):[];b.logFunc&&b.logFunc("BJS - "+P,...Y);const l=`<div style='color:${b.color}'>${P}</div><br>`;B._AddLogEntry(l),B._GenerateLimitMessage(J,v)}static get LogCache(){return B._LogCache}static ClearLogCache(){B._LogCache="",B._LogLimitOutputs={},B.errorsCount=0}static set LogLevels(v){B.Log=B._LogDisabled,B.Warn=B._LogDisabled,B.Error=B._LogDisabled,[B.MessageLogLevel,B.WarningLogLevel,B.ErrorLogLevel].forEach((y=>{if((v&y)===y){const v=this._Levels[y];B[v.name]=B._LogEnabled.bind(B,y)}}))}}B.NoneLogLevel=0,B.MessageLogLevel=1,B.WarningLogLevel=2,B.ErrorLogLevel=4,B.AllLogLevel=7,B.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",B._LogCache="",B._LogLimitOutputs={},B._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],B.errorsCount=0,B.Log=B._LogEnabled.bind(B,B.MessageLogLevel),B.Warn=B._LogEnabled.bind(B,B.WarningLogLevel),B.Error=B._LogEnabled.bind(B,B.ErrorLogLevel)},10795:(v,y,n)=>{"use strict";n.d(y,{e:()=>P});class B{constructor(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;this.initialize(v,y,n,B)}initialize(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;return this.mask=v,this.skipNextObservers=y,this.target=n,this.currentTarget=B,this}}class J{constructor(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=v,this.mask=y,this.scope=n,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class P{static FromPromise(v,y){const n=new P;return v.then((v=>{n.notifyObservers(v)})).catch((v=>{if(!y)throw v;y.notifyObservers(v)})),n}get observers(){return this._observers}constructor(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=y,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new B(0),v&&(this._onObserverAdded=v)}add(v){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!v)return null;const B=new J(v,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return B.unregisterOnNextCall=n,y?this._observers.unshift(B):this._observers.push(B),this._onObserverAdded&&this._onObserverAdded(B),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(B,this._lastNotifiedValue),B._remove=()=>{this.remove(B)},B}addOnce(v){return this.add(v,void 0,void 0,void 0,!0)}remove(v){if(!v)return!1;v._remove=null;return-1!==this._observers.indexOf(v)&&(this._deferUnregister(v),!0)}removeCallback(v,y){for(let n=0;n<this._observers.length;n++){const B=this._observers[n];if(!B._willBeUnregistered&&(B.callback===v&&(!y||y===B.scope)))return this._deferUnregister(B),!0}return!1}_deferUnregister(v){v._willBeUnregistered||(this._numObserversMarkedAsDeleted++,v.unregisterOnNextCall=!1,v._willBeUnregistered=!0,setTimeout((()=>{this._remove(v)}),0))}_remove(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!v)return!1;const n=this._observers.indexOf(v);return-1!==n&&(y&&this._numObserversMarkedAsDeleted--,this._observers.splice(n,1),!0)}makeObserverTopPriority(v){this._remove(v,!1),this._observers.unshift(v)}makeObserverBottomPriority(v){this._remove(v,!1),this._observers.push(v)}notifyObservers(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0,J=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=v),!this._observers.length)return!0;const P=this._eventState;P.mask=y,P.target=n,P.currentTarget=B,P.skipNextObservers=!1,P.lastReturnValue=v,P.userInfo=J;for(const b of this._observers)if(!b._willBeUnregistered&&(b.mask&y&&(b.unregisterOnNextCall&&this._deferUnregister(b),b.scope?P.lastReturnValue=b.callback.apply(b.scope,[v,P]):P.lastReturnValue=b.callback(v,P)),P.skipNextObservers))return!1;return!0}notifyObserver(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=y),v._willBeUnregistered)return;const B=this._eventState;B.mask=n,B.skipNextObservers=!1,v.unregisterOnNextCall&&this._deferUnregister(v),v.callback(y,B)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const v=this._observers.pop();v&&(v._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const v=new P;return v._observers=this._observers.slice(0),v}hasSpecificMask(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const y of this._observers)if(y.mask&v||y.mask===v)return!0;return!1}}},10919:(v,y,n)=>{"use strict";n.d(y,{c:()=>J});var B=n(10805);class J{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(v,y){J.Enabled&&(this._current+=v,y&&this._fetchResult())}beginMonitoring(){J.Enabled&&(this._startMonitoringTime=B.d.Now)}endMonitoring(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!J.Enabled)return;v&&this.fetchNewFrame();const y=B.d.Now;this._current=y-this._startMonitoringTime,v&&this._fetchResult()}tj(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const v=B.d.Now;v-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=v,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}J.Enabled=!0},10805:(v,y,n)=>{"use strict";n.d(y,{d:()=>J});var B=n(10797);class J{static get Now(){return(0,B.k)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},12287:(v,y,n)=>{"use strict";n.d(y,{c:()=>P});var B=n(11609),J=n(11594);class P{static ExpandRGBDTexture(v){const y=v._texture;if(!y||!v.isRGBD)return;const J=y.getEngine(),P=J.getCaps(),b=y.isReady;let Y=!1;P.textureHalfFloatRender&&P.textureHalfFloatLinearFiltering?(Y=!0,y.type=2):P.textureFloatRender&&P.textureFloatLinearFiltering&&(Y=!0,y.type=1),Y&&(y.isReady=!1,y._isRGBD=!1,y.invertY=!1);const l=async()=>{const P=J.isWebGPU,b=P?1:0;y.isReady=!1,P?await Promise.all([n.e(39).then(n.bind(n,13573)),n.e(40).then(n.bind(n,13580))]):await Promise.all([n.e(41).then(n.bind(n,13583)),n.e(42).then(n.bind(n,13586))]);const Y=new B.c("rgbdDecode","rgbdDecode",null,null,1,null,3,J,!1,void 0,y.type,void 0,null,!1,void 0,b);Y.externalTextureSamplerBinding=!0;const l=J.createRenderTargetTexture(y.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:y.samplingMode,type:y.type,format:5});Y.onEffectCreatedObservable.addOnce((n=>{n.executeWhenCompiled((()=>{Y.onApply=v=>{v._bindTexture("textureSampler",y),v.setFloat2("scale",1,1)},v.va().postProcessManager.directRender([Y],l,!0),J.restoreDefaultFramebuffer(),J._releaseTexture(y),Y&&Y.dispose(),l._swapAndDie(y),y.isReady=!0}))}))};Y&&(b?l():v.onLoadObservable.addOnce(l))}static EncodeTextureToRGBD(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,J.c)("rgbdEncode",v,y,n,1,5)}}},11065:(v,y,n)=>{"use strict";n.d(y,{b:()=>J,e:()=>B});class B{constructor(v){this.length=0,this.data=new Array(v),this._id=B._GlobalId++}push(v){this.data[this.length++]=v,this.length>this.data.length&&(this.data.length*=2)}forEach(v){for(let y=0;y<this.length;y++)v(this.data[y])}sort(v){this.data.sort(v)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(v){if(0!==v.length){this.length+v.length>this.data.length&&(this.data.length=2*(this.length+v.length));for(let y=0;y<v.length;y++)this.data[this.length++]=(v.data||v)[y]}}indexOf(v){const y=this.data.indexOf(v);return y>=this.length?-1:y}contains(v){return-1!==this.indexOf(v)}}B._GlobalId=0;class J extends B{constructor(){super(...arguments),this._duplicateId=0}push(v){super.push(v),v.__smartArrayFlags||(v.__smartArrayFlags={}),v.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(v){return(!v.__smartArrayFlags||v.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(v),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(v){if(0!==v.length){this.length+v.length>this.data.length&&(this.data.length=2*(this.length+v.length));for(let y=0;y<v.length;y++){const n=(v.data||v)[y];this.pushNoDuplicate(n)}}}}},10835:(v,y,n)=>{"use strict";n.d(y,{d:()=>b,f:()=>P,j:()=>B,n:()=>J});const B=v=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(v);let y="";for(let n=0;n<v.byteLength;n++)y+=String.fromCharCode(v[n]);return y},J=v=>{const y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let n,B,J,P,b,Y,l,a="",Z=0;const x=ArrayBuffer.isView(v)?new Uint8Array(v.buffer,v.byteOffset,v.byteLength):new Uint8Array(v);for(;Z<x.length;)n=x[Z++],B=Z<x.length?x[Z++]:Number.NaN,J=Z<x.length?x[Z++]:Number.NaN,P=n>>2,b=(3&n)<<4|B>>4,Y=(15&B)<<2|J>>6,l=63&J,isNaN(B)?Y=l=64:isNaN(J)&&(l=64),a+=y.charAt(P)+y.charAt(b)+y.charAt(Y)+y.charAt(l);return a},P=v=>atob(v),b=v=>{const y=P(v),n=y.length,B=new Uint8Array(new ArrayBuffer(n));for(let J=0;J<n;J++)B[J]=y.charCodeAt(J);return B.buffer}},11076:(v,y,n)=>{"use strict";n.d(y,{c:()=>J});class B{static Eval(v,y){return"true"===(v=v.match(/\([^()]*\)/g)?v.replace(/\([^()]*\)/g,(v=>(v=v.slice(1,v.length-1),B._HandleParenthesisContent(v,y)))):B._HandleParenthesisContent(v,y))||"false"!==v&&B.Eval(v,y)}static _HandleParenthesisContent(v,y){let n;y=y||(v=>"true"===v);const J=v.split("||");for(const P in J)if(Object.prototype.hasOwnProperty.call(J,P)){let v=B._SimplifyNegation(J[P].trim());const b=v.split("&&");if(b.length>1)for(let J=0;J<b.length;++J){const P=B._SimplifyNegation(b[J].trim());if(n="true"!==P&&"false"!==P?"!"===P[0]?!y(P.substring(1)):y(P):"true"===P,!n){v="false";break}}if(n||"true"===v){n=!0;break}n="true"!==v&&"false"!==v?"!"===v[0]?!y(v.substring(1)):y(v):"true"===v}return n?"true":"false"}static _SimplifyNegation(v){return"!true"===(v=(v=v.replace(/^[\s!]+/,(v=>(v=v.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?v="false":"!false"===v&&(v="true"),v}}class J{static EnableFor(v){v._tags=v._tags||{},v.hasTags=()=>J.HasTags(v),v.addTags=y=>J.AddTagsTo(v,y),v.removeTags=y=>J.RemoveTagsFrom(v,y),v.matchesTagsQuery=y=>J.MatchesQuery(v,y)}static DisableFor(v){delete v._tags,delete v.hasTags,delete v.addTags,delete v.removeTags,delete v.matchesTagsQuery}static HasTags(v){if(!v._tags)return!1;const y=v._tags;for(const n in y)if(Object.prototype.hasOwnProperty.call(y,n))return!0;return!1}static GetTags(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!v._tags)return null;if(y){const y=[];for(const n in v._tags)Object.prototype.hasOwnProperty.call(v._tags,n)&&!0===v._tags[n]&&y.push(n);return y.join(" ")}return v._tags}static AddTagsTo(v,y){if(!y)return;if("string"!==typeof y)return;y.split(" ").forEach((function(y){J._AddTagTo(v,y)}))}static _AddTagTo(v,y){""!==(y=y.trim())&&"true"!==y&&"false"!==y&&(y.match(/[\s]/)||y.match(/^([!]|([|]|[&]){2})/)||(J.EnableFor(v),v._tags[y]=!0))}static RemoveTagsFrom(v,y){if(!J.HasTags(v))return;const n=y.split(" ");for(const B in n)J._RemoveTagFrom(v,n[B])}static _RemoveTagFrom(v,y){delete v._tags[y]}static MatchesQuery(v,y){return void 0===y||(""===y?J.HasTags(v):B.Eval(y,(y=>J.HasTags(v)&&v._tags[y])))}}},11594:(v,y,n)=>{"use strict";n.d(y,{c:()=>l,e:()=>f,i:()=>x});n(11281),n(11602);var B=n(11609),J=n(10849),P=n(10908),b=n(11110);class Y extends B.c{getClassName(){return"PassPostProcess"}constructor(v,y){super(v,"pass",null,null,y,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(v,y){v?(this._webGPUReady=!0,y.push(Promise.all([n.e(33).then(n.bind(n,13553))]))):y.push(Promise.all([n.e(34).then(n.bind(n,13557))])),super._gatherImports(v,y)}static _Parse(v,y,n,B){return b.d.Parse((()=>new Y(v.name,v.options,y,v.renderTargetSamplingMode,v._engine,v.reusable)),v,n,B)}}(0,P.g)("BABYLON.PassPostProcess",Y);B.c;function l(v,y,n,J,P,b,Y,l){const a=y.getEngine();return y.isReady=!1,P=P??y.samplingMode,J=J??y.type,b=b??y.format,Y=Y??y.width,l=l??y.height,-1===J&&(J=0),new Promise((Z=>{const x=new B.c("postprocess",v,null,null,1,null,P,a,!1,void 0,J,void 0,null,!1,b);x.externalTextureSamplerBinding=!0;const f=a.createRenderTargetTexture({width:Y,height:l},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:P,type:J,format:b});x.onEffectCreatedObservable.addOnce((v=>{v.executeWhenCompiled((()=>{x.onApply=v=>{v._bindTexture("textureSampler",y),v.setFloat2("scale",1,1)},n.postProcessManager.directRender([x],f,!0),a.restoreDefaultFramebuffer(),a._releaseTexture(y),x&&x.dispose(),f._swapAndDie(y),y.type=J,y.format=5,y.isReady=!0,Z(y)}))}))}))}let a,Z;function x(v){a||(a=new Float32Array(1),Z=new Int32Array(a.buffer)),a[0]=v;const y=Z[0];let n=y>>16&32768,B=y>>12&2047;const J=y>>23&255;return J<103?n:J>142?(n|=31744,n|=(255==J?0:1)&&8388607&y,n):J<113?(B|=2048,n|=(B>>114-J)+(B>>113-J&1),n):(n|=J-112<<10|B>>1,n+=1&B,n)}function f(v){const y=(32768&v)>>15,n=(31744&v)>>10,B=1023&v;return 0===n?(y?-1:1)*Math.pow(2,-14)*(B/Math.pow(2,10)):31==n?B?NaN:1/0*(y?-1:1):(y?-1:1)*Math.pow(2,n-15)*(1+B/Math.pow(2,10))}J.c._RescalePostProcessFactory=v=>new Y("rescale",1,null,2,v,!1,0)},10847:(v,y,n)=>{"use strict";n.d(y,{c:()=>J});var B=n(10797);class J{static SetImmediate(v){(0,B.k)()&&window.setImmediate?window.setImmediate(v):setTimeout(v,1)}}},10914:(v,y,n)=>{"use strict";function B(v){let y=1;do{y*=2}while(y<v);return y===v}function J(v,y,n){return v*(1-n)+y*n}function P(v){const y=b(v),n=Y(v);return y-v>v-n?n:y}function b(v){return v--,v|=v>>1,v|=v>>2,v|=v>>4,v|=v>>8,v|=v>>16,++v}function Y(v){return v|=v>>1,v|=v>>2,v|=v>>4,v|=v>>8,(v|=v>>16)-(v>>1)}function l(v,y){let n;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:n=Y(v);break;case 2:n=P(v);break;default:n=b(v)}return Math.min(n,y)}n.d(y,{e:()=>Y,g:()=>l,j:()=>B,n:()=>J,p:()=>P})},10791:(v,y,n)=>{"use strict";n.d(y,{c:()=>h,g:()=>c});var B=n(10795),J=n(10797),P=n(10801),b=n(10803),Y=n(10805),l=n(10811),a=n(10816),Z=n(10820),x=n(10828),f=n(10847),N=n(10899),i=n(10911),g=n(10914);class c{static get BaseUrl(){return x.f.BaseUrl}static set BaseUrl(v){x.f.BaseUrl=v}static get CleanUrl(){return x.f.CleanUrl}static set CleanUrl(v){x.f.CleanUrl=v}static IsAbsoluteUrl(v){return 0===v.indexOf("//")||-1!==v.indexOf("://")&&(-1!==v.indexOf(".")&&(-1!==v.indexOf("/")&&(!(v.indexOf(":")>v.indexOf("/"))&&(v.indexOf("://")<v.indexOf(".")||(0===v.indexOf("data:")||0===v.indexOf("blob:"))))))}static set ScriptBaseUrl(v){x.f.ScriptBaseUrl=v}static get ScriptBaseUrl(){return x.f.ScriptBaseUrl}static set ScriptPreprocessUrl(v){x.f.ScriptPreprocessUrl=v}static get ScriptPreprocessUrl(){return x.f.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return x.f.DefaultRetryStrategy}static set DefaultRetryStrategy(v){x.f.DefaultRetryStrategy=v}static get CorsBehavior(){return x.f.CorsBehavior}static set CorsBehavior(v){x.f.CorsBehavior=v}static get UseFallbackTexture(){return Z.b.UseFallbackTexture}static set UseFallbackTexture(v){Z.b.UseFallbackTexture=v}static get RegisteredExternalClasses(){return N.b.RegisteredExternalClasses}static set RegisteredExternalClasses(v){N.b.RegisteredExternalClasses=v}static get fallbackTexture(){return Z.b.FallbackTexture}static set fallbackTexture(v){Z.b.FallbackTexture=v}static FetchToRef(v,y,n,B,J,P){const b=4*((Math.abs(v)*n%n|0)+(Math.abs(y)*B%B|0)*n);P.r=J[b]/255,P.g=J[b+1]/255,P.b=J[b+2]/255,P.a=J[b+3]/255}static Mix(v,y,n){return 0}static Instantiate(v){return N.b.Instantiate(v)}static SetImmediate(v){f.c.SetImmediate(v)}static IsExponentOfTwo(v){return!0}static FloatRound(v){return Math.fround(v)}static GetFilename(v){const y=v.lastIndexOf("/");return y<0?v:v.substring(y+1)}static GetFolderPath(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=v.lastIndexOf("/");return n<0?y?v:"":v.substring(0,n+1)}static ToDegrees(v){return 180*v/Math.PI}static ToRadians(v){return v*Math.PI/180}static SmoothAngleChange(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const B=this.ToRadians(v),J=this.ToRadians(y);return this.ToDegrees(Math.atan2((1-n)*Math.sin(J)+n*Math.sin(B),(1-n)*Math.cos(J)+n*Math.cos(B)))}static MakeArray(v,y){return!0===y||void 0!==v&&null!=v?Array.isArray(v)?v:[v]:null}static GetPointerPrefix(v){return(0,J.k)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(v,y){(0,x.y)(v,y)}static SetReferrerPolicyBehavior(v,y){y.referrerPolicy=v}static get PreprocessUrl(){return x.f.PreprocessUrl}static set PreprocessUrl(v){x.f.PreprocessUrl=v}static LoadImage(v,y,n,B,J,P){return(0,x.s)(v,y,n,B,J,P)}static LoadFile(v,y,n,B,J,P){return(0,x.q)(v,y,n,B,J,P)}static LoadFileAsync(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((n,B)=>{(0,x.q)(v,(v=>{n(v)}),void 0,void 0,y,((v,y)=>{B(y)}))}))}static GetBabylonScriptURL(v,y){if(!v)return"";if(c.ScriptBaseUrl&&v.startsWith(c._DefaultCdnUrl)){const y="/"===c.ScriptBaseUrl[c.ScriptBaseUrl.length-1]?c.ScriptBaseUrl.substring(0,c.ScriptBaseUrl.length-1):c.ScriptBaseUrl;v=v.replace(c._DefaultCdnUrl,y)}return v=c.ScriptPreprocessUrl(v),y&&(v=c.GetAbsoluteUrl(v)),v}static LoadBabylonScript(v,y,n,B){v=c.GetBabylonScriptURL(v),c.LoadScript(v,y,n)}static LoadBabylonScriptAsync(v){return v=c.GetBabylonScriptURL(v),c.LoadScriptAsync(v)}static LoadScript(v,y,n,B){let P=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(v),y&&y()}catch(l){null===n||void 0===n||n(`Unable to load script '${v}' in worker`,l)}return}if(!(0,J.k)())return void(null===n||void 0===n||n(`Cannot load script '${v}' outside of a window or a worker`));const b=document.getElementsByTagName("head")[0],Y=document.createElement("script");P?(Y.setAttribute("type","module"),Y.innerText=v):(Y.setAttribute("type","text/javascript"),Y.setAttribute("src",v)),B&&(Y.id=B),Y.onload=()=>{y&&y()},Y.onerror=y=>{n&&n(`Unable to load script '${v}'`,y)},b.appendChild(Y)}static LoadScriptAsync(v,y){return new Promise(((n,B)=>{this.LoadScript(v,(()=>{n()}),((v,y)=>{B(y||new Error(v))}),y)}))}static ReadFileAsDataURL(v,y,n){const J=new FileReader,P={onCompleteObservable:new B.e,abort:()=>J.abort()};return J.onloadend=()=>{P.onCompleteObservable.notifyObservers(P)},J.onload=v=>{y(v.target.result)},J.onprogress=n,J.readAsDataURL(v),P}static ReadFile(v,y,n,B,J){return(0,x.t)(v,y,n,B,J)}static FileAsURL(v){const y=new Blob([v]);return window.URL.createObjectURL(y)}static Format(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return v.toFixed(y)}static DeepCopy(v,y,n,B){b.c.DeepCopy(v,y,n,B)}static IsEmpty(v){for(const y in v)if(Object.prototype.hasOwnProperty.call(v,y))return!1;return!0}static RegisterTopRootEvents(v,y){for(let B=0;B<y.length;B++){const J=y[B];v.addEventListener(J.name,J.handler,!1);try{window.parent&&window.parent.addEventListener(J.name,J.handler,!1)}catch(n){}}}static UnregisterTopRootEvents(v,y){for(let B=0;B<y.length;B++){const J=y[B];v.removeEventListener(J.name,J.handler);try{v.parent&&v.parent.removeEventListener(J.name,J.handler)}catch(n){}}}static async DumpFramebuffer(v,y,n,B){throw(0,l.e)("DumpTools")}static DumpData(v,y,n,B){throw(0,l.e)("DumpTools")}static DumpDataAsync(v,y,n){throw(0,l.e)("DumpTools")}static _IsOffScreenCanvas(v){return void 0!==v.convertToBlob}static ToBlob(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",B=arguments.length>3?arguments[3]:void 0;c._IsOffScreenCanvas(v)||v.toBlob||(v.toBlob=function(v,y,n){setTimeout((()=>{const B=atob(this.toDataURL(y,n).split(",")[1]),J=B.length,P=new Uint8Array(J);for(let v=0;v<J;v++)P[v]=B.charCodeAt(v);v(new Blob([P]))}))}),c._IsOffScreenCanvas(v)?v.convertToBlob({type:n,quality:B}).then((v=>y(v))):v.toBlob((function(v){y(v)}),n,B)}static DownloadBlob(v,y){if("download"in document.createElement("a")){if(!y){const v=new Date;y="screenshot_"+((v.getFullYear()+"-"+(v.getMonth()+1)).slice(2)+"-"+v.getDate()+"_"+v.getHours()+"-"+("0"+v.getMinutes()).slice(-2))+".png"}c.Download(v,y)}else if(v&&"undefined"!==typeof URL){const y=URL.createObjectURL(v),n=window.open("");if(!n)return;const B=n.document.createElement("img");B.onload=function(){URL.revokeObjectURL(y)},B.src=y,n.document.body.appendChild(B)}}static EncodeScreenshotCanvasData(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",B=arguments.length>3?arguments[3]:void 0,J=arguments.length>4?arguments[4]:void 0;if("string"!==typeof B&&y){if(y){if(c._IsOffScreenCanvas(v))return void v.convertToBlob({type:n,quality:J}).then((v=>{const n=new FileReader;n.readAsDataURL(v),n.onloadend=()=>{const v=n.result;y(v)}}));const B=v.toDataURL(n,J);y(B)}}else this.ToBlob(v,(function(v){v&&c.DownloadBlob(v,B),y&&y("")}),n,J)}static Download(v,y){if("undefined"===typeof URL)return;const n=window.URL.createObjectURL(v),B=document.createElement("a");document.body.appendChild(B),B.style.display="none",B.href=n,B.download=y,B.addEventListener("click",(()=>{B.parentElement&&B.parentElement.removeChild(B)})),B.click(),window.URL.revokeObjectURL(n)}static BackCompatCameraNoPreventDefault(v){return"boolean"===typeof v[0]?v[0]:"boolean"===typeof v[1]&&v[1]}static CreateScreenshot(v,y,n,B){throw(0,l.e)("ScreenshotTools")}static CreateScreenshotAsync(v,y,n){throw(0,l.e)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(v,y,n,B){throw(0,l.e)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(v,y,n){throw(0,l.e)("ScreenshotTools")}static RandomId(){return(0,i.b)()}static IsBase64(v){return(0,x.i)(v)}static DecodeBase64(v){return(0,x.e)(v)}static get errorsCount(){return P.e.errorsCount}static Log(v){P.e.Log(v)}static Warn(v){P.e.Warn(v)}static Error(v){P.e.Error(v)}static get LogCache(){return P.e.LogCache}static ClearLogCache(){P.e.ClearLogCache()}static set LogLevels(v){P.e.LogLevels=v}static set PerformanceLogLevel(v){return(v&c.PerformanceUserMarkLogLevel)===c.PerformanceUserMarkLogLevel?(c.StartPerformanceCounter=c._StartUserMark,void(c.EndPerformanceCounter=c._EndUserMark)):(v&c.PerformanceConsoleLogLevel)===c.PerformanceConsoleLogLevel?(c.StartPerformanceCounter=c._StartPerformanceConsole,void(c.EndPerformanceCounter=c._EndPerformanceConsole)):(c.StartPerformanceCounter=c._StartPerformanceCounterDisabled,void(c.EndPerformanceCounter=c._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(v,y){}static _EndPerformanceCounterDisabled(v,y){}static _StartUserMark(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!c._Performance){if(!(0,J.k)())return;c._Performance=window.performance}y&&c._Performance.mark&&c._Performance.mark(v+"-Begin")}static _EndUserMark(v){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&c._Performance.mark&&(c._Performance.mark(v+"-End"),c._Performance.measure(v,v+"-Begin",v+"-End"))}static _StartPerformanceConsole(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];y&&(c._StartUserMark(v,y),console.time&&console.time(v))}static _EndPerformanceConsole(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];y&&(c._EndUserMark(v,y),console.timeEnd(v))}static get Now(){return Y.d.Now}static GetClassName(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null;if(!y&&v.getClassName)n=v.getClassName();else{if(v instanceof Object){n=(y?v:Object.getPrototypeOf(v)).constructor.__bjsclassName__}n||(n=typeof v)}return n}static First(v,y){for(const n of v)if(y(n))return n;return null}static getFullClassName(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null,B=null;if(!y&&v.getClassName)n=v.getClassName();else{if(v instanceof Object){const J=y?v:Object.getPrototypeOf(v);n=J.constructor.__bjsclassName__,B=J.constructor.__bjsmoduleName__}n||(n=typeof v)}return n?(null!=B?B+".":"")+n:null}static DelayAsync(v){return new Promise((y=>{setTimeout((()=>{y()}),v)}))}static IsSafari(){return!!(0,J.h)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}c.UseCustomRequestHeaders=!1,c.CustomRequestHeaders=a.c.CustomRequestHeaders,c.GetDOMTextContent=J.c,c._DefaultCdnUrl="https://cdn.babylonjs.com",c.GetAbsoluteUrl="object"===typeof document?v=>{const y=document.createElement("a");return y.href=v,y.href}:"function"===typeof URL&&"object"===typeof location?v=>new URL(v,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},c.NoneLogLevel=P.e.NoneLogLevel,c.MessageLogLevel=P.e.MessageLogLevel,c.WarningLogLevel=P.e.WarningLogLevel,c.ErrorLogLevel=P.e.ErrorLogLevel,c.AllLogLevel=P.e.AllLogLevel,c.IsWindowObjectExist=J.k,c.PerformanceNoneLogLevel=0,c.PerformanceUserMarkLogLevel=1,c.PerformanceConsoleLogLevel=2,c.StartPerformanceCounter=c._StartPerformanceCounterDisabled,c.EndPerformanceCounter=c._EndPerformanceCounterDisabled;class h{constructor(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=v,this.index=B-1,this._done=!1,this._fn=y,this._successCallback=n}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(v,y,n){const B=new h(v,y,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return B.executeNext(),B}static SyncAsyncForLoop(v,y,n,B,J){let P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return h.Run(Math.ceil(v/y),(B=>{J&&J()?B.breakLoop():setTimeout((()=>{for(let P=0;P<y;++P){const b=B.index*y+P;if(b>=v)break;if(n(b),J&&J()){B.breakLoop();break}}B.executeNext()}),P)}),B)}}c.Mix=g.n,c.IsExponentOfTwo=g.j,Z.b.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},10908:(v,y,n)=>{"use strict";n.d(y,{d:()=>P,g:()=>J});const B={};function J(v,y){B[v]=y}function P(v){return B[v]}},11184:(v,y,n)=>{"use strict";n.d(y,{e:()=>B});class B{static get UniqueId(){const v=this._UniqueIdCounter;return this._UniqueIdCounter++,v}}B._UniqueIdCounter=1},10816:(v,y,n)=>{"use strict";n.d(y,{c:()=>B});class B{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(B.CustomRequestHeaders).length>0||B.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const v in B.CustomRequestHeaders){const y=B.CustomRequestHeaders[v];y&&this._xhr.setRequestHeader(v,y)}}_shouldSkipRequestModifications(v){return B.SkipRequestModificationForBabylonCDN&&(v.includes("preview.babylonjs.com")||v.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(v){this._xhr.onprogress=v}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(v){this._xhr.responseType=v}get timeout(){return this._xhr.timeout}set timeout(v){this._xhr.timeout=v}addEventListener(v,y,n){this._xhr.addEventListener(v,y,n)}removeEventListener(v,y,n){this._xhr.removeEventListener(v,y,n)}abort(){this._xhr.abort()}send(v){B.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(v)}open(v,y){for(const n of B.CustomRequestModifiers){if(this._shouldSkipRequestModifications(y))return;n(this._xhr,y)}y=(y=y.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=y,this._xhr.open(v,y,!0)}setRequestHeader(v,y){this._xhr.setRequestHeader(v,y)}getResponseHeader(v){return this._xhr.getResponseHeader(v)}}B.CustomRequestHeaders={},B.CustomRequestModifiers=new Array,B.SkipRequestModificationForBabylonCDN=!0},12352:(v,y,n)=>{"use strict";n.d(y,{c:()=>J});class B{constructor(v){this._pendingActions=new Array,this._workerInfos=v.map((v=>({workerPromise:Promise.resolve(v),idle:!0})))}dispose(){for(const v of this._workerInfos)v.workerPromise.then((v=>{v.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(v){this._executeOnIdleWorker(v)||this._pendingActions.push(v)}_executeOnIdleWorker(v){for(const y of this._workerInfos)if(y.idle)return this._execute(y,v),!0;return!1}_execute(v,y){v.idle=!1,v.workerPromise.then((n=>{y(n,(()=>{const y=this._pendingActions.shift();y?this._execute(v,y):v.idle=!0}))}))}}class J extends B{constructor(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.DefaultOptions;super([]),this._maxWorkers=v,this._createWorkerAsync=y,this._options=n}push(v){if(!this._executeOnIdleWorker(v))if(this._workerInfos.length<this._maxWorkers){const y={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(y),this._execute(y,v)}else this._pendingActions.push(v)}_execute(v,y){v.timeoutId&&(clearTimeout(v.timeoutId),delete v.timeoutId),super._execute(v,((n,B)=>{y(n,(()=>{B(),v.idle&&(v.timeoutId=setTimeout((()=>{v.workerPromise.then((v=>{v.terminate()}));const y=this._workerInfos.indexOf(v);-1!==y&&this._workerInfos.splice(y,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}J.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11498:(v,y,n)=>{"use strict";n.d(y,{d:()=>hv});var B=n(11081),J=n(11267);class P extends J.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var b=n(11103),Y=(n(11500),n(10908));class l{get noiseTexture(){return this._noiseTexture}set noiseTexture(v){this._noiseTexture!==v&&(this._noiseTexture=v,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(v){this._isAnimationSheetEnabled!=v&&(this._isAnimationSheetEnabled=v,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(v){this._useLogarithmicDepth=v&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:B.n.Zero()}set direction1(v){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=v)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:B.n.Zero()}set direction2(v){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=v)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:B.n.Zero()}set minEmitBox(v){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=v)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:B.n.Zero()}set maxEmitBox(v){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=v)}get billboardMode(){return this._billboardMode}set billboardMode(v){this._billboardMode!==v&&(this._billboardMode=v,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(v){this._isBillboardBased!==v&&(this._isBillboardBased=v,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(v){this._attachImageProcessingConfiguration(v)}_attachImageProcessingConfiguration(v){v!==this._imageProcessingConfiguration&&(!v&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=v)}_reset(){}_removeGradientAndTexture(v,y,n){if(!y)return this;let B=0;for(const J of y){if(J.gradient===v){y.splice(B,1);break}B++}return n&&n.dispose(),this}constructor(v){this.animations=[],this.renderingGroupId=0,this.j=B.n.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new B.n(10,10,10),this.onAnimationEnd=null,this.blendMode=l.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new B.j(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.ug=new B.n(0,0,0),this._useLogarithmicDepth=!1,this.gravity=B.n.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new b.e(1,1,1,1),this.color2=new b.e(1,1,1,1),this.colorDead=new b.e(0,0,0,1),this.textureMask=new b.e(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new P,this.id=v,this.name=v}createPointEmitter(v,y){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new B.n(0,1,0),arguments.length>2&&void 0!==arguments[2]||new B.n(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new B.n(0,1,0),arguments.length>4&&void 0!==arguments[4]||new B.n(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new B.n(0,1,0),arguments.length>3&&void 0!==arguments[3]||new B.n(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(v,y,n,B){throw new Error("Method not implemented.")}}l.BLENDMODE_ONEONE=0,l.BLENDMODE_STANDARD=1,l.BLENDMODE_ADD=2,l.BLENDMODE_MULTIPLY=3,l.BLENDMODE_MULTIPLYADD=4,(0,Y.g)("BABYLON.BaseParticleSystem",l);var a=n(11091),Z=n(10803);class x{constructor(){this.direction1=new B.n(0,1,0),this.direction2=new B.n(0,1,0),this.minEmitBox=new B.n(-.5,-.5,-.5),this.maxEmitBox=new B.n(.5,.5,.5)}startDirectionFunction(v,y,n,J){const P=(0,a.n)(this.direction1.x,this.direction2.x),b=(0,a.n)(this.direction1.y,this.direction2.y),Y=(0,a.n)(this.direction1.z,this.direction2.z);if(J)return y.x=P,y.y=b,void(y.z=Y);B.n.TransformNormalFromFloatsToRef(P,b,Y,v,y)}startPositionFunction(v,y,n,J){const P=(0,a.n)(this.minEmitBox.x,this.maxEmitBox.x),b=(0,a.n)(this.minEmitBox.y,this.maxEmitBox.y),Y=(0,a.n)(this.minEmitBox.z,this.maxEmitBox.z);if(J)return y.x=P,y.y=b,void(y.z=Y);B.n.TransformCoordinatesFromFloatsToRef(P,b,Y,v,y)}clone(){const v=new x;return Z.c.DeepCopy(this,v),v}applyToShader(v){v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2),v.setVector3("minEmitBox",this.minEmitBox),v.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(v){v.addUniform("direction1",3),v.addUniform("direction2",3),v.addUniform("minEmitBox",3),v.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.direction1=this.direction1.wj(),v.direction2=this.direction2.wj(),v.minEmitBox=this.minEmitBox.wj(),v.maxEmitBox=this.maxEmitBox.wj(),v}parse(v){B.n.FromArrayToRef(v.direction1,0,this.direction1),B.n.FromArrayToRef(v.direction2,0,this.direction2),B.n.FromArrayToRef(v.minEmitBox,0,this.minEmitBox),B.n.FromArrayToRef(v.maxEmitBox,0,this.maxEmitBox)}}class f{get radius(){return this._radius}set radius(v){this._radius=v,this._buildHeight()}get angle(){return this._angle}set angle(v){this._angle=v,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=n,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=y,this.radius=v}startDirectionFunction(v,y,n,J){J?B.i.o[0].p(n.we).normalize():n.position.subtractToRef(v.getTranslation(),B.i.o[0]).normalize();const P=(0,a.n)(0,this.directionRandomizer),b=(0,a.n)(0,this.directionRandomizer),Y=(0,a.n)(0,this.directionRandomizer);y.x=B.i.o[0].x+P,y.y=B.i.o[0].y+b,y.z=B.i.o[0].z+Y,y.normalize()}startPositionFunction(v,y,n,J){const P=(0,a.n)(0,2*Math.PI);let b;this.emitFromSpawnPointOnly?b=1e-4:(b=(0,a.n)(0,this.heightRange),b=1-b*b);let Y=this._radius-(0,a.n)(0,this._radius*this.radiusRange);Y*=b;const l=Y*Math.sin(P),Z=Y*Math.cos(P),x=b*this._height;if(J)return y.x=l,y.y=x,void(y.z=Z);B.n.TransformCoordinatesFromFloatsToRef(l,x,Z,v,y)}clone(){const v=new f(this._radius,this._angle,this.directionRandomizer);return Z.c.DeepCopy(this,v),v}applyToShader(v){v.setFloat2("radius",this._radius,this.radiusRange),v.setFloat("coneAngle",this._angle),v.setFloat2("height",this._height,this.heightRange),v.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(v){v.addUniform("radius",2),v.addUniform("coneAngle",1),v.addUniform("height",2),v.addUniform("directionRandomizer",1)}getEffectDefines(){let v="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(v+="\n#define CONEEMITTERSPAWNPOINT"),v}getClassName(){return"ConeParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.radius=this._radius,v.angle=this._angle,v.directionRandomizer=this.directionRandomizer,v.radiusRange=this.radiusRange,v.heightRange=this.heightRange,v.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,v}parse(v){this.radius=v.radius,this.angle=v.angle,this.directionRandomizer=v.directionRandomizer,this.radiusRange=void 0!==v.radiusRange?v.radiusRange:1,this.heightRange=void 0!==v.radiusRange?v.heightRange:1,this.emitFromSpawnPointOnly=void 0!==v.emitFromSpawnPointOnly&&v.emitFromSpawnPointOnly}}class N extends f{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.n(0,1,0),J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.n(0,1,0);super(v,y),this.direction1=n,this.direction2=J}startDirectionFunction(v,y){const n=(0,a.n)(this.direction1.x,this.direction2.x),J=(0,a.n)(this.direction1.y,this.direction2.y),P=(0,a.n)(this.direction1.z,this.direction2.z);B.n.TransformNormalFromFloatsToRef(n,J,P,v,y)}clone(){const v=new N(this.radius,this.angle,this.direction1,this.direction2);return Z.c.DeepCopy(this,v),v}applyToShader(v){v.setFloat("radius",this.radius),v.setFloat("radiusRange",this.radiusRange),v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("radius",1),v.addUniform("radiusRange",1),v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const v=super.serialize();return v.direction1=this.direction1.wj(),v.direction2=this.direction2.wj(),v}parse(v){super.parse(v),this.direction1.p(v.direction1),this.direction2.p(v.direction2)}}class i{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=v,this.height=y,this.radiusRange=n,this.directionRandomizer=J,this._tempVector=B.n.Zero()}startDirectionFunction(v,y,n,J,P){n.position.subtractToRef(v.getTranslation(),this._tempVector),this._tempVector.normalize(),B.n.TransformNormalToRef(this._tempVector,P,this._tempVector);const b=(0,a.n)(-this.directionRandomizer/2,this.directionRandomizer/2);let Y=Math.atan2(this._tempVector.x,this._tempVector.z);Y+=(0,a.n)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=b,this._tempVector.x=Math.sin(Y),this._tempVector.z=Math.cos(Y),this._tempVector.normalize(),J?y.p(this._tempVector):B.n.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,v,y)}startPositionFunction(v,y,n,J){const P=(0,a.n)(-this.height/2,this.height/2),b=(0,a.n)(0,2*Math.PI),Y=(0,a.n)((1-this.radiusRange)*(1-this.radiusRange),1),l=Math.sqrt(Y)*this.radius,Z=l*Math.cos(b),x=l*Math.sin(b);J?y.Ae(Z,P,x):B.n.TransformCoordinatesFromFloatsToRef(Z,P,x,v,y)}clone(){const v=new i(this.radius,this.directionRandomizer);return Z.c.DeepCopy(this,v),v}applyToShader(v){v.setFloat("radius",this.radius),v.setFloat("height",this.height),v.setFloat("radiusRange",this.radiusRange),v.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(v){v.addUniform("radius",1),v.addUniform("height",1),v.addUniform("radiusRange",1),v.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.radius=this.radius,v.height=this.height,v.radiusRange=this.radiusRange,v.directionRandomizer=this.directionRandomizer,v}parse(v){this.radius=v.radius,this.height=v.height,this.radiusRange=v.radiusRange,this.directionRandomizer=v.directionRandomizer}}class g extends i{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.n(0,1,0),P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.n(0,1,0);super(v,y,n),this.direction1=J,this.direction2=P}startDirectionFunction(v,y,n,J){const P=(0,a.n)(this.direction1.x,this.direction2.x),b=(0,a.n)(this.direction1.y,this.direction2.y),Y=(0,a.n)(this.direction1.z,this.direction2.z);J?y.Ae(P,b,Y):B.n.TransformNormalFromFloatsToRef(P,b,Y,v,y)}clone(){const v=new g(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return Z.c.DeepCopy(this,v),v}applyToShader(v){v.setFloat("radius",this.radius),v.setFloat("height",this.height),v.setFloat("radiusRange",this.radiusRange),v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("radius",1),v.addUniform("height",1),v.addUniform("radiusRange",1),v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const v=super.serialize();return v.direction1=this.direction1.wj(),v.direction2=this.direction2.wj(),v}parse(v){super.parse(v),B.n.FromArrayToRef(v.direction1,0,this.direction1),B.n.FromArrayToRef(v.direction2,0,this.direction2)}}class c{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=v,this.radiusRange=y,this.directionRandomizer=n}startDirectionFunction(v,y,n,J){const P=n.position.od(v.getTranslation()).normalize(),b=(0,a.n)(0,this.directionRandomizer),Y=(0,a.n)(0,this.directionRandomizer),l=(0,a.n)(0,this.directionRandomizer);P.x+=b,P.y+=Y,P.z+=l,P.normalize(),J?y.p(P):B.n.TransformNormalFromFloatsToRef(P.x,P.y,P.z,v,y)}startPositionFunction(v,y,n,J){const P=this.radius-(0,a.n)(0,this.radius*this.radiusRange),b=(0,a.n)(0,1),Y=(0,a.n)(0,2*Math.PI),l=Math.acos(2*b-1),Z=P*Math.cos(Y)*Math.sin(l),x=P*Math.cos(l),f=P*Math.sin(Y)*Math.sin(l);J?y.Ae(Z,Math.abs(x),f):B.n.TransformCoordinatesFromFloatsToRef(Z,Math.abs(x),f,v,y)}clone(){const v=new c(this.radius,this.directionRandomizer);return Z.c.DeepCopy(this,v),v}applyToShader(v){v.setFloat("radius",this.radius),v.setFloat("radiusRange",this.radiusRange),v.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(v){v.addUniform("radius",1),v.addUniform("radiusRange",1),v.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.radius=this.radius,v.radiusRange=this.radiusRange,v.directionRandomizer=this.directionRandomizer,v}parse(v){this.radius=v.radius,this.radiusRange=v.radiusRange,this.directionRandomizer=v.directionRandomizer}}class h{constructor(){this.direction1=new B.n(0,1,0),this.direction2=new B.n(0,1,0)}startDirectionFunction(v,y,n,J){const P=(0,a.n)(this.direction1.x,this.direction2.x),b=(0,a.n)(this.direction1.y,this.direction2.y),Y=(0,a.n)(this.direction1.z,this.direction2.z);J?y.Ae(P,b,Y):B.n.TransformNormalFromFloatsToRef(P,b,Y,v,y)}startPositionFunction(v,y,n,J){J?y.Ae(0,0,0):B.n.TransformCoordinatesFromFloatsToRef(0,0,0,v,y)}clone(){const v=new h;return Z.c.DeepCopy(this,v),v}applyToShader(v){v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.direction1=this.direction1.wj(),v.direction2=this.direction2.wj(),v}parse(v){B.n.FromArrayToRef(v.direction1,0,this.direction1),B.n.FromArrayToRef(v.direction2,0,this.direction2)}}class E{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=v,this.radiusRange=y,this.directionRandomizer=n}startDirectionFunction(v,y,n,J){const P=n.position.od(v.getTranslation()).normalize(),b=(0,a.n)(0,this.directionRandomizer),Y=(0,a.n)(0,this.directionRandomizer),l=(0,a.n)(0,this.directionRandomizer);P.x+=b,P.y+=Y,P.z+=l,P.normalize(),J?y.p(P):B.n.TransformNormalFromFloatsToRef(P.x,P.y,P.z,v,y)}startPositionFunction(v,y,n,J){const P=this.radius-(0,a.n)(0,this.radius*this.radiusRange),b=(0,a.n)(0,1),Y=(0,a.n)(0,2*Math.PI),l=Math.acos(2*b-1),Z=P*Math.cos(Y)*Math.sin(l),x=P*Math.cos(l),f=P*Math.sin(Y)*Math.sin(l);J?y.Ae(Z,x,f):B.n.TransformCoordinatesFromFloatsToRef(Z,x,f,v,y)}clone(){const v=new E(this.radius,this.directionRandomizer);return Z.c.DeepCopy(this,v),v}applyToShader(v){v.setFloat("radius",this.radius),v.setFloat("radiusRange",this.radiusRange),v.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(v){v.addUniform("radius",1),v.addUniform("radiusRange",1),v.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.radius=this.radius,v.radiusRange=this.radiusRange,v.directionRandomizer=this.directionRandomizer,v}parse(v){this.radius=v.radius,this.radiusRange=v.radiusRange,this.directionRandomizer=v.directionRandomizer}}class W extends E{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.n(0,1,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.n(0,1,0);super(v),this.direction1=y,this.direction2=n}startDirectionFunction(v,y){const n=(0,a.n)(this.direction1.x,this.direction2.x),J=(0,a.n)(this.direction1.y,this.direction2.y),P=(0,a.n)(this.direction1.z,this.direction2.z);B.n.TransformNormalFromFloatsToRef(n,J,P,v,y)}clone(){const v=new W(this.radius,this.direction1,this.direction2);return Z.c.DeepCopy(this,v),v}applyToShader(v){v.setFloat("radius",this.radius),v.setFloat("radiusRange",this.radiusRange),v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("radius",1),v.addUniform("radiusRange",1),v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const v=super.serialize();return v.direction1=this.direction1.wj(),v.direction2=this.direction2.wj(),v}parse(v){super.parse(v),this.direction1.p(v.direction1),this.direction2.p(v.direction2)}}class s{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(v,y,n,J){const P=B.i.o[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,n,P);const v=B.i.o[1];P.subtractToRef(n.position,v),v.scaleToRef(1/n.lifeTime,P)}else P.set(0,0,0);J?y.p(P):B.n.TransformNormalToRef(P,v,y)}startPositionFunction(v,y,n,J){const P=B.i.o[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,n,P):P.set(0,0,0),J?y.p(P):B.n.TransformCoordinatesToRef(P,v,y)}clone(){const v=new s;return Z.c.DeepCopy(this,v),v}applyToShader(v){}buildUniformLayout(v){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const v={};return v.type=this.getClassName(),v.particlePositionGenerator=this.particlePositionGenerator,v.particleDestinationGenerator=this.particleDestinationGenerator,v}parse(v){v.particlePositionGenerator&&(this.particlePositionGenerator=v.particlePositionGenerator),v.particleDestinationGenerator&&(this.particleDestinationGenerator=v.particleDestinationGenerator)}}var C=n(11127);class r{get mesh(){return this._mesh}set mesh(v){this._mesh!==v&&(this._mesh=v,v?(this._indices=v.wg(),this._positions=v.getVerticesData(C.i.PositionKind),this._normals=v.getVerticesData(C.i.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=B.n.Zero(),this._mesh=null,this.direction1=new B.n(0,1,0),this.direction2=new B.n(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=v}startDirectionFunction(v,y,n,J){if(this.useMeshNormalsForDirection&&this._normals)return void B.n.TransformNormalToRef(this._storedNormal,v,y);const P=(0,a.n)(this.direction1.x,this.direction2.x),b=(0,a.n)(this.direction1.y,this.direction2.y),Y=(0,a.n)(this.direction1.z,this.direction2.z);J?y.Ae(P,b,Y):B.n.TransformNormalFromFloatsToRef(P,b,Y,v,y)}startPositionFunction(v,y,n,J){if(!this._indices||!this._positions)return;const P=3*Math.random()*(this._indices.length/3)|0,b=Math.random(),Y=Math.random()*(1-b),l=1-b-Y,a=this._indices[P],Z=this._indices[P+1],x=this._indices[P+2],f=B.i.o[0],N=B.i.o[1],i=B.i.o[2],g=B.i.o[3];B.n.FromArrayToRef(this._positions,3*a,f),B.n.FromArrayToRef(this._positions,3*Z,N),B.n.FromArrayToRef(this._positions,3*x,i),g.x=b*f.x+Y*N.x+l*i.x,g.y=b*f.y+Y*N.y+l*i.y,g.z=b*f.z+Y*N.z+l*i.z,J?y.Ae(g.x,g.y,g.z):B.n.TransformCoordinatesFromFloatsToRef(g.x,g.y,g.z,v,y),this.useMeshNormalsForDirection&&this._normals&&(B.n.FromArrayToRef(this._normals,3*a,f),B.n.FromArrayToRef(this._normals,3*Z,N),B.n.FromArrayToRef(this._normals,3*x,i),this._storedNormal.x=b*f.x+Y*N.x+l*i.x,this._storedNormal.y=b*f.y+Y*N.y+l*i.y,this._storedNormal.z=b*f.z+Y*N.z+l*i.z)}clone(){const v=new r(this.mesh);return Z.c.DeepCopy(this,v),v}applyToShader(v){v.setVector3("direction1",this.direction1),v.setVector3("direction2",this.direction2)}buildUniformLayout(v){v.addUniform("direction1",3),v.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var v;const y={};return y.type=this.getClassName(),y.direction1=this.direction1.wj(),y.direction2=this.direction2.wj(),y.meshId=null===(v=this.mesh)||void 0===v?void 0:v.id,y.useMeshNormalsForDirection=this.useMeshNormalsForDirection,y}parse(v,y){B.n.FromArrayToRef(v.direction1,0,this.direction1),B.n.FromArrayToRef(v.direction2,0,this.direction2),v.meshId&&y&&(this.mesh=y.getLastMeshById(v.meshId)),this.useMeshNormalsForDirection=v.useMeshNormalsForDirection}}var u=n(10857);class O{_isUbo(v){return void 0!==v.addUniform}constructor(v){this._isUbo(v)?(this.setMatrix3x3=v.updateMatrix3x3.bind(v),this.setMatrix2x2=v.updateMatrix2x2.bind(v),this.setFloat=v.updateFloat.bind(v),this.setFloat2=v.updateFloat2.bind(v),this.setFloat3=v.updateFloat3.bind(v),this.setFloat4=v.updateFloat4.bind(v),this.setFloatArray=v.updateFloatArray.bind(v),this.setArray=v.updateArray.bind(v),this.setIntArray=v.updateIntArray.bind(v),this.setMatrix=v.Vj.bind(v),this.setMatrices=v.updateMatrices.bind(v),this.setVector3=v.updateVector3.bind(v),this.setVector4=v.updateVector4.bind(v),this.setColor3=v.updateColor3.bind(v),this.setColor4=v.updateColor4.bind(v),this.setDirectColor4=v.updateDirectColor4.bind(v),this.setInt=v.updateInt.bind(v),this.setInt2=v.updateInt2.bind(v),this.setInt3=v.updateInt3.bind(v),this.setInt4=v.updateInt4.bind(v)):(this.setMatrix3x3=v.setMatrix3x3.bind(v),this.setMatrix2x2=v.setMatrix2x2.bind(v),this.setFloat=v.setFloat.bind(v),this.setFloat2=v.setFloat2.bind(v),this.setFloat3=v.setFloat3.bind(v),this.setFloat4=v.setFloat4.bind(v),this.setFloatArray=v.setFloatArray.bind(v),this.setArray=v.setArray.bind(v),this.setIntArray=v.setIntArray.bind(v),this.setMatrix=v.setMatrix.bind(v),this.setMatrices=v.setMatrices.bind(v),this.setVector3=v.setVector3.bind(v),this.setVector4=v.setVector4.bind(v),this.setColor3=v.setColor3.bind(v),this.setColor4=v.setColor4.bind(v),this.setDirectColor4=v.setDirectColor4.bind(v),this.setInt=v.setInt.bind(v),this.setInt2=v.setInt2.bind(v),this.setInt3=v.setInt3.bind(v),this.setInt4=v.setInt4.bind(v))}}var d=n(10866);const q="gpuUpdateParticlesPixelShader",L="#version 300 es\nvoid main() {discard;}\n";d.b.ShadersStore[q]=L;const t="gpuUpdateParticlesVertexShader",G="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";d.b.ShadersStore[t]=G;(0,Y.g)("BABYLON.WebGL2ParticleSystem",class{constructor(v,y){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=v,this._engine=y,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var v;return(null===(v=this._updateEffect)||void 0===v?void 0:v.isReady())??!1}createUpdateBuffer(v){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof s&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=v,this._updateEffect=new u.b("gpuUpdateParticles",this._updateEffectOptions,this._engine),new O(this._updateEffect)}createVertexBuffers(v,y){this._updateVAO.push(this._createUpdateVAO(v)),this._renderVAO.push(this._engine.recordVertexArrayObject(y,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=y}createParticleBuffer(v){return v}bindDrawBuffers(v,y,n){n?this._engine.bindBuffers(this._renderVertexBuffers,n,y):this._engine.bindVertexArrayObject(this._renderVAO[v],null)}preUpdateParticleBuffer(){const v=this._engine;if(this._engine.enableEffect(this._updateEffect),!v.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(v,y,n){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[v],null);const B=this._engine;B.bindTransformFeedbackBuffer(y.getBuffer()),B.setRasterizerState(!1),B.beginTransformFeedback(!0),B.drawArraysType(3,0,n),B.endTransformFeedback(),B.setRasterizerState(!0),B.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let v=0;v<this._updateVAO.length;v++)this._engine.releaseVertexArrayObject(this._updateVAO[v]);this._updateVAO.length=0;for(let v=0;v<this._renderVAO.length;v++)this._engine.releaseVertexArrayObject(this._renderVAO[v]);this._renderVAO.length=0}_createUpdateVAO(v){const y={};y.position=v.createVertexBuffer("position",0,3);let n=3;y.age=v.createVertexBuffer("age",n,1),n+=1,y.size=v.createVertexBuffer("size",n,3),n+=3,y.life=v.createVertexBuffer("life",n,1),n+=1,y.seed=v.createVertexBuffer("seed",n,4),n+=4,y.direction=v.createVertexBuffer("direction",n,3),n+=3,this._parent.particleEmitterType instanceof s&&(y.initialPosition=v.createVertexBuffer("initialPosition",n,3),n+=3),this._parent._colorGradientsTexture||(y.color=v.createVertexBuffer("color",n,4),n+=4),this._parent._isBillboardBased||(y.initialDirection=v.createVertexBuffer("initialDirection",n,3),n+=3),this._parent.noiseTexture&&(y.noiseCoordinates1=v.createVertexBuffer("noiseCoordinates1",n,3),n+=3,y.noiseCoordinates2=v.createVertexBuffer("noiseCoordinates2",n,3),n+=3),this._parent._angularSpeedGradientsTexture?(y.angle=v.createVertexBuffer("angle",n,1),n+=1):(y.angle=v.createVertexBuffer("angle",n,2),n+=2),this._parent._isAnimationSheetEnabled&&(y.cellIndex=v.createVertexBuffer("cellIndex",n,1),n+=1,this._parent.spriteRandomStartCell&&(y.cellStartOffset=v.createVertexBuffer("cellStartOffset",n,1),n+=1));const B=this._engine.recordVertexArrayObject(y,null,this._updateEffect);return this._engine.bindArrayBuffer(null),B}});class R{constructor(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,B=arguments.length>3?arguments[3]:void 0;this._engine=v,this._label=B,this._engine._storageBuffers.push(this),this._create(y,n)}_create(v,y){this._bufferSize=v,this._creationFlags=y,this._buffer=this._engine.createStorageBuffer(v,y,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(v,y,n){this._buffer&&this._engine.updateStorageBuffer(this._buffer,v,y,n)}read(v,y,n,B){return this._engine.readFromStorageBuffer(this._buffer,v,y,n,B)}dispose(){const v=this._engine._storageBuffers,y=v.indexOf(this);-1!==y&&(v[y]=v[v.length-1],v.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var F=n(11050),S=n(11055),w=n(11110),k=n(11281),M=n(11184),I=n(10801),j=n(10891),V=n(10919);class p{constructor(){this._gpuTimeInFrameId=-1,this.counter=new V.c}_addDuration(v,y){v<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==v?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(y,!1),this._gpuTimeInFrameId=v):this.counter.addCount(y,!1))}}class H{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=v,this._engine=y,this.uniqueId=M.e.UniqueId,y.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new p),this._engine.getCaps().supportComputeShaders?B.bindingsMapping?(this._context=y.createComputeContext(),this._shaderPath=n,this._options={bindingsMapping:{},defines:[],...B}):I.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):I.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(v,y){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const B=this._bindings[v];this._bindings[v]={type:n?0:4,object:y,indexInGroupEntries:null===B||void 0===B?void 0:B.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!B||B.object!==y||B.type!==this._bindings[v].type)}setStorageTexture(v,y){const n=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!n||n.object!==y),this._bindings[v]={type:1,object:y,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}setExternalTexture(v,y){const n=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!n||n.object!==y),this._bindings[v]={type:6,object:y,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}setVideoTexture(v,y){return!!y.externalTexture&&(this.setExternalTexture(v,y.externalTexture),!0)}setUniformBuffer(v,y){const n=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!n||n.object!==y),this._bindings[v]={type:H._BufferIsDataBuffer(y)?7:2,object:y,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}setStorageBuffer(v,y){const n=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!n||n.object!==y),this._bindings[v]={type:H._BufferIsDataBuffer(y)?7:3,object:y,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}setTextureSampler(v,y){const n=this._bindings[v];this._contextIsDirty||(this._contextIsDirty=!n||!y.compareSampler(n.object)),this._bindings[v]={type:5,object:y,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}isReady(){let v=this._effect;for(const J in this._bindings){const v=this._bindings[J],y=v.type,n=v.object;switch(y){case 0:case 4:case 1:if(!n.isReady())return!1;break;case 6:if(!n.isReady())return!1;break}}const y=[],n=this._shaderPath;if(this._options.defines)for(let J=0;J<this._options.defines.length;J++)y.push(this._options.defines[J]);const B=y.join("\n");return this._cachedDefines!==B&&(this._cachedDefines=B,v=this._engine.createComputeEffect(n,{defines:B,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=v),!!v.isReady()}dispatch(v,y,n){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,v,y,n,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const n=H._BufferIsDataBuffer(v)?v:v.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,n,y,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const y in this._bindings){const n=this._bindings[y];if(!this._options.bindingsMapping[y])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+y+"'");switch(n.type){case 0:{const B=this._samplers[y],J=n.object;var v;if(!B||!J._texture||!B.compareSampler(J._texture))this._samplers[y]=(new j.e).setParameters(J.wrapU,J.wrapV,J.wrapR,J.anisotropicFilteringLevel,J._texture.samplingMode,null===(v=J._texture)||void 0===v?void 0:v._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const v=n.object;v.getBuffer()!==n.buffer&&(n.buffer=v.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((J=>{const P=()=>{this.dispatch(v,y,n)?J():setTimeout(P,B)};P()}))}serialize(){const v=w.d.Serialize(this);v.options=this._options,v.shaderPath=this._shaderPath,v.Lj={},v.textures={};for(const y in this._bindings){const n=this._bindings[y],B=n.object;switch(n.type){case 0:case 4:case 1:{const J=B.serialize();J&&(v.textures[y]=J,v.Lj[y]={type:n.type});break}}}return v}static Parse(v,y,n){const B=w.d.Parse((()=>new H(v.name,y.getEngine(),v.shaderPath,v.options)),v,y,n);for(const J in v.textures){const P=v.Lj[J],b=k.b.Parse(v.textures[J],y,n);0===P.type?B.setTexture(J,b):4===P.type?B.setTexture(J,b,!1):B.setStorageTexture(J,b)}return B}static _BufferIsDataBuffer(v){return void 0!==v.underlyingResource}}(0,F.c)([(0,S.M)()],H.prototype,"name",void 0),(0,F.c)([(0,S.M)()],H.prototype,"fastMode",void 0),(0,Y.g)("BABYLON.ComputeShader",H);var A=n(11120);const X="gpuUpdateParticlesComputeShader",U="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";d.b.ShadersStoreWGSL[X]=U;(0,Y.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(v,y){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=v,this._engine=y}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var v;return(null===(v=this._updateComputeShader)||void 0===v?void 0:v.isReady())??!1}createUpdateBuffer(v){var y;const n={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(n.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(n.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(n.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(n.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(n.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(n.noiseTexture={group:1,binding:11}),this._updateComputeShader=new H("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:n,defines:v.split("\n")}),null===(y=this._simParamsComputeShader)||void 0===y||y.dispose(),this._simParamsComputeShader=new A.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new O(this._simParamsComputeShader)}createVertexBuffers(v,y){this._renderVertexBuffers.push(y)}createParticleBuffer(v){const y=new R(this._engine,4*v.length,11,"ComputeShaderParticleSystemBuffer");return y.update(v),this._bufferComputeShader.push(y),y.getBuffer()}bindDrawBuffers(v,y,n){this._engine.bindBuffers(this._renderVertexBuffers[v],n,y)}preUpdateParticleBuffer(){}updateParticleBuffer(v,y,n){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[v]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^v]),this._updateComputeShader.dispatch(Math.ceil(n/64))}releaseBuffers(){var v;for(let y=0;y<this._bufferComputeShader.length;++y)this._bufferComputeShader[y].dispose();this._bufferComputeShader.length=0,null===(v=this._simParamsComputeShader)||void 0===v||v.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class z{constructor(v,y,n){this.gradient=v,this.color1=y,this.color2=n}getColorToRef(v){this.color2?b.e.LerpToRef(this.color1,this.color2,Math.random(),v):v.p(this.color1)}}class e{constructor(v,y){this.gradient=v,this.color=y}}class K{constructor(v,y,n){this.gradient=v,this.factor1=y,this.factor2=n}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class D{static GetCurrentGradient(v,y,n){if(y[0].gradient>v)return void n(y[0],y[0],1);for(let J=0;J<y.length-1;J++){const B=y[J],P=y[J+1];if(v>=B.gradient&&v<=P.gradient){return void n(B,P,(v-B.gradient)/(P.gradient-B.gradient))}}const B=y.length-1;n(y[B],y[B],1)}}var Q=n(10795),o=n(11523),T=n(10820);class m{constructor(v){this.particleSystem=v,this.position=B.n.Zero(),this.direction=B.n.Zero(),this.color=new b.e(0,0,0,0),this.colorStep=new b.e(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new B.j(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new b.e(0,0,0,0),this._currentColor2=new b.e(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=m._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let v=this.age,y=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===y?(y=1,v=this._randomCellOffset):v+=this._randomCellOffset);const n=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let B;B=this._initialSpriteCellLoop?(0,a.c)(v*y%this.lifeTime/this.lifeTime):(0,a.c)(v*y/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+B*n|0}_inheritParticleInfoToSubEmitter(v){if(v.particleSystem.j.position){const y=v.particleSystem.j;if(y.position.p(this.position),v.inheritDirection){const v=B.i.o[0];this.direction.normalizeToRef(v),y.setDirection(v,0,Math.PI/2)}}else{v.particleSystem.j.p(this.position)}this.direction.scaleToRef(v.inheritedVelocityAmount/2,B.i.o[0]),v.particleSystem._inheritedVelocityOffset.p(B.i.o[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((v=>{this._inheritParticleInfoToSubEmitter(v)}))}_reset(){this.age=0,this.id=m._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(v){v.position.p(this.position),this._initialDirection?v._initialDirection?v._initialDirection.p(this._initialDirection):v._initialDirection=this._initialDirection.clone():v._initialDirection=null,v.direction.p(this.direction),this.we&&(v.we?v.we.p(this.we):v.we=this.we.clone()),v.color.p(this.color),v.colorStep.p(this.colorStep),v.lifeTime=this.lifeTime,v.age=this.age,v._randomCellOffset=this._randomCellOffset,v.size=this.size,v.scale.p(this.scale),v.angle=this.angle,v.angularSpeed=this.angularSpeed,v.particleSystem=this.particleSystem,v.cellIndex=this.cellIndex,v.id=this.id,v._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(v._currentColorGradient=this._currentColorGradient,v._currentColor1.p(this._currentColor1),v._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(v._currentSizeGradient=this._currentSizeGradient,v._currentSize1=this._currentSize1,v._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(v._currentAngularSpeedGradient=this._currentAngularSpeedGradient,v._currentAngularSpeed1=this._currentAngularSpeed1,v._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(v._currentVelocityGradient=this._currentVelocityGradient,v._currentVelocity1=this._currentVelocity1,v._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(v._currentLimitVelocityGradient=this._currentLimitVelocityGradient,v._currentLimitVelocity1=this._currentLimitVelocity1,v._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(v._currentDragGradient=this._currentDragGradient,v._currentDrag1=this._currentDrag1,v._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(v._initialStartSpriteCellID=this._initialStartSpriteCellID,v._initialEndSpriteCellID=this._initialEndSpriteCellID,v._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(v.remapData&&this.remapData?v.remapData.p(this.remapData):v.remapData=new B.p(0,0,0,0)),this._randomNoiseCoordinates1&&(v._randomNoiseCoordinates1?(v._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),v._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(v._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),v._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}m._Count=0;var vv=n(11249),yv=(n(11531),n(11262)),nv=n(11256),Bv=n(11117);class Jv extends l{set onDispose(v){this._onDisposeObserver&&this.xj.remove(this._onDisposeObserver),this._onDisposeObserver=this.xj.add(v)}get useRampGradients(){return this._useRampGradients}set useRampGradients(v){this._useRampGradients!==v&&(this._useRampGradients=v,this._resetEffect())}get particles(){return this.Gj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.Gj.length}getClassName(){return"ub"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var v;let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(v=this._customWrappers[y])||void 0===v?void 0:v.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[v]??this._customWrappers[0]}setCustomEffect(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[y]=new vv.d(this._engine),this._customWrappers[y].effect=v,this._customWrappers[y].drawContext&&(this._customWrappers[y].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Q.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(v,y,n){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(v),this._emitterInverseWorldMatrix=B.d.Identity(),this._inheritedVelocityOffset=new B.n,this.xj=new Q.e,this.onStoppedObservable=new Q.e,this.Gj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new b.e(0,0,0,0),this._colorDiff=new b.e(0,0,0,0),this._scaledDirection=B.n.Zero(),this._scaledGravity=B.n.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=v=>{},this.recycleParticle=v=>{const y=this.Gj.pop();y!==v&&y.copyTo(v),this._stockParticles.push(y)},this._createParticle=()=>{let v;return 0!==this._stockParticles.length?(v=this._stockParticles.pop(),v._reset()):v=new m(this),this._prepareParticle(v),v},this._shadersLoaded=!1,this._capacity=y,this._epsilon=Y,this._isAnimationSheetEnabled=P,n&&"Scene"!==n.getClassName()?(this._engine=n,this.defaultProjectionMatrix=B.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=n||T.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ej.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new vv.d(this._engine)},this._customWrappers[0].effect=J,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new x;let l=null;this.updateFunction=v=>{let y=null;var n;this.noiseTexture&&(y=this.noiseTexture.getSize(),null===(n=this.noiseTexture.getContent())||void 0===n||n.then((v=>{l=v})));const J=v===this.Gj;for(let P=0;P<v.length;P++){const n=v[P];let Y=this._scaledUpdateSpeed;const Z=n.age;if(n.age+=Y,n.age>n.lifeTime){const v=n.age-Z;Y=(n.lifeTime-Z)*Y/v,n.age=n.lifeTime}const x=n.age/n.lifeTime;this._colorGradients&&this._colorGradients.length>0?D.GetCurrentGradient(x,this._colorGradients,((v,y,B)=>{v!==n._currentColorGradient&&(n._currentColor1.p(n._currentColor2),y.getColorToRef(n._currentColor2),n._currentColorGradient=v),b.e.LerpToRef(n._currentColor1,n._currentColor2,B,n.color)})):(n.colorStep.scaleToRef(Y,this._scaledColorStep),n.color.addInPlace(this._scaledColorStep),n.color.a<0&&(n.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&D.GetCurrentGradient(x,this._angularSpeedGradients,((v,y,B)=>{v!==n._currentAngularSpeedGradient&&(n._currentAngularSpeed1=n._currentAngularSpeed2,n._currentAngularSpeed2=y.getFactor(),n._currentAngularSpeedGradient=v),n.angularSpeed=(0,a.k)(n._currentAngularSpeed1,n._currentAngularSpeed2,B)})),n.angle+=n.angularSpeed*Y;let f=Y;if(this._velocityGradients&&this._velocityGradients.length>0&&D.GetCurrentGradient(x,this._velocityGradients,((v,y,B)=>{v!==n._currentVelocityGradient&&(n._currentVelocity1=n._currentVelocity2,n._currentVelocity2=y.getFactor(),n._currentVelocityGradient=v),f*=(0,a.k)(n._currentVelocity1,n._currentVelocity2,B)})),n.direction.scaleToRef(f,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&D.GetCurrentGradient(x,this._limitVelocityGradients,((v,y,B)=>{v!==n._currentLimitVelocityGradient&&(n._currentLimitVelocity1=n._currentLimitVelocity2,n._currentLimitVelocity2=y.getFactor(),n._currentLimitVelocityGradient=v);const J=(0,a.k)(n._currentLimitVelocity1,n._currentLimitVelocity2,B);n.direction.length()>J&&n.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&D.GetCurrentGradient(x,this._dragGradients,((v,y,B)=>{v!==n._currentDragGradient&&(n._currentDrag1=n._currentDrag2,n._currentDrag2=y.getFactor(),n._currentDragGradient=v);const J=(0,a.k)(n._currentDrag1,n._currentDrag2,B);this._scaledDirection.scaleInPlace(1-J)})),this.isLocal&&n.we?(n.we.addInPlace(this._scaledDirection),B.n.TransformCoordinatesToRef(n.we,this._emitterWorldMatrix,n.position)):n.position.addInPlace(this._scaledDirection),l&&y&&n._randomNoiseCoordinates1){const v=this._fetchR(n._randomNoiseCoordinates1.x,n._randomNoiseCoordinates1.y,y.width,y.height,l),J=this._fetchR(n._randomNoiseCoordinates1.z,n._randomNoiseCoordinates2.x,y.width,y.height,l),P=this._fetchR(n._randomNoiseCoordinates2.y,n._randomNoiseCoordinates2.z,y.width,y.height,l),b=B.i.o[0],a=B.i.o[1];b.Ae((2*v-1)*this.noiseStrength.x,(2*J-1)*this.noiseStrength.y,(2*P-1)*this.noiseStrength.z),b.scaleToRef(Y,a),n.direction.addInPlace(a)}this.gravity.scaleToRef(Y,this._scaledGravity),n.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&D.GetCurrentGradient(x,this._sizeGradients,((v,y,B)=>{v!==n._currentSizeGradient&&(n._currentSize1=n._currentSize2,n._currentSize2=y.getFactor(),n._currentSizeGradient=v),n.size=(0,a.k)(n._currentSize1,n._currentSize2,B)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&D.GetCurrentGradient(x,this._colorRemapGradients,((v,y,B)=>{const J=(0,a.k)(v.factor1,y.factor1,B),P=(0,a.k)(v.factor2,y.factor2,B);n.remapData.x=J,n.remapData.y=P-J})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&D.GetCurrentGradient(x,this._alphaRemapGradients,((v,y,B)=>{const J=(0,a.k)(v.factor1,y.factor1,B),P=(0,a.k)(v.factor2,y.factor2,B);n.remapData.z=J,n.remapData.w=P-J}))),this._isAnimationSheetEnabled&&n.updateCellIndex(),n._inheritParticleInfoToSubEmitters(),n.age>=n.lifeTime&&(this._emitFromParticle(n),n._attachedSubEmitters&&(n._attachedSubEmitters.forEach((v=>{v.particleSystem.disposeOnStop=!0,v.particleSystem.stop()})),n._attachedSubEmitters=null),this.recycleParticle(n),J&&P--)}}}serialize(v){throw new Error("Method not implemented.")}clone(v,y){throw new Error("Method not implemented.")}_addFactorGradient(v,y,n,B){const J=new K(y,n,B);v.push(J),v.sort(((v,y)=>v.gradient<y.gradient?-1:v.gradient>y.gradient?1:0))}_removeFactorGradient(v,y){if(!v)return;let n=0;for(const B of v){if(B.gradient===y){v.splice(n,1);break}n++}}addLifeTimeGradient(v,y,n){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,v,y,n),this}removeLifeTimeGradient(v){return this._removeFactorGradient(this._lifeTimeGradients,v),this}addSizeGradient(v,y,n){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,v,y,n),this}removeSizeGradient(v){return this._removeFactorGradient(this._sizeGradients,v),this}addColorRemapGradient(v,y,n){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,v,y,n),this}removeColorRemapGradient(v){return this._removeFactorGradient(this._colorRemapGradients,v),this}addAlphaRemapGradient(v,y,n){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,v,y,n),this}removeAlphaRemapGradient(v){return this._removeFactorGradient(this._alphaRemapGradients,v),this}addAngularSpeedGradient(v,y,n){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,v,y,n),this}removeAngularSpeedGradient(v){return this._removeFactorGradient(this._angularSpeedGradients,v),this}addVelocityGradient(v,y,n){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,v,y,n),this}removeVelocityGradient(v){return this._removeFactorGradient(this._velocityGradients,v),this}addLimitVelocityGradient(v,y,n){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,v,y,n),this}removeLimitVelocityGradient(v){return this._removeFactorGradient(this._limitVelocityGradients,v),this}addDragGradient(v,y,n){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,v,y,n),this}removeDragGradient(v){return this._removeFactorGradient(this._dragGradients,v),this}addEmitRateGradient(v,y,n){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,v,y,n),this}removeEmitRateGradient(v){return this._removeFactorGradient(this._emitRateGradients,v),this}addStartSizeGradient(v,y,n){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,v,y,n),this}removeStartSizeGradient(v){return this._removeFactorGradient(this._startSizeGradients,v),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const v=new Uint8Array(4*this._rawTextureWidth),y=b.h.ib[0];for(let n=0;n<this._rawTextureWidth;n++){const B=n/this._rawTextureWidth;D.GetCurrentGradient(B,this._rampGradients,((B,J,P)=>{b.d.LerpToRef(B.color,J.color,P,y),v[4*n]=255*y.r,v[4*n+1]=255*y.g,v[4*n+2]=255*y.b,v[4*n+3]=255}))}this._rampGradientsTexture=o.e.CreateRGBATexture(v,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((v,y)=>v.gradient<y.gradient?-1:v.gradient>y.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(v,y){this._rampGradients||(this._rampGradients=[]);const n=new e(v,y);return this._rampGradients.push(n),this._syncRampGradientTexture(),this}removeRampGradient(v){return this._removeGradientAndTexture(v,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(v,y,n){this._colorGradients||(this._colorGradients=[]);const B=new z(v,y,n);return this._colorGradients.push(B),this._colorGradients.sort(((v,y)=>v.gradient<y.gradient?-1:v.gradient>y.gradient?1:0)),this}removeColorGradient(v){if(!this._colorGradients)return this;let y=0;for(const n of this._colorGradients){if(n.gradient===v){this._colorGradients.splice(y,1);break}y++}return this}resetDrawCache(){for(const v of this._drawWrappers)if(v)for(const y of v)null===y||void 0===y||y.dispose();this._drawWrappers=[]}_fetchR(v,y,n,B,J){return J[4*(((v=.5*Math.abs(v)+.5)*n%n|0)+((y=.5*Math.abs(y)+.5)*B%B|0)*n)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const v=this._engine,y=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*y),this._vertexBuffer=new C.e(v,this._vertexData,!0,y);let n=0;const B=this._vertexBuffer.createVertexBuffer(C.i.PositionKind,n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[C.i.PositionKind]=B,n+=3;const J=this._vertexBuffer.createVertexBuffer(C.i.ColorKind,n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[C.i.ColorKind]=J,n+=4;const P=this._vertexBuffer.createVertexBuffer("angle",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=P,n+=1;const b=this._vertexBuffer.createVertexBuffer("size",n,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=b,n+=2,this._isAnimationSheetEnabled){const v=this._vertexBuffer.createVertexBuffer("cellIndex",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=v,n+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const v=this._vertexBuffer.createVertexBuffer("direction",n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=v,n+=3}if(this._useRampGradients){const v=this._vertexBuffer.createVertexBuffer("remapData",n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=v,n+=4}let Y;if(this._useInstancing){const y=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new C.e(v,y,!1,2),Y=this._spriteBuffer.createVertexBuffer("offset",0,2)}else Y=this._vertexBuffer.createVertexBuffer("offset",n,2,this._vertexBufferSize,this._useInstancing),n+=2;this._vertexBuffers.offset=Y,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const v=[],y=[];let n=0;for(let B=0;B<this._capacity;B++)v.push(n),v.push(n+1),v.push(n+2),v.push(n),v.push(n+2),v.push(n+3),y.push(n,n+1,n+1,n+2,n+2,n+3,n+3,n,n,n+3),n+=4;this._indexBuffer=this._engine.createIndexBuffer(v),this._linesIndexBuffer=this._engine.createIndexBuffer(y)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(v)setTimeout((()=>{this.start(0)}),v);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var y;-1!==(null===(y=this.j)||void 0===y?void 0:y.getClassName().indexOf("Mesh"))&&this.j.ak(!0);const v=this.noiseTexture;if(v&&v.onGeneratedObservable)v.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let y=0;y<this.preWarmCycles;y++)this.animate(!0),v.render()}))}));else for(let y=0;y<this.preWarmCycles;y++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(v))}_postStop(v){}reset(){this._stockParticles.length=0,this.Gj.length=0}_appendParticleVertex(v,y,n,J){let P=v*this._vertexBufferSize;if(this._vertexData[P++]=y.position.x+this.ug.x,this._vertexData[P++]=y.position.y+this.ug.y,this._vertexData[P++]=y.position.z+this.ug.z,this._vertexData[P++]=y.color.r,this._vertexData[P++]=y.color.g,this._vertexData[P++]=y.color.b,this._vertexData[P++]=y.color.a,this._vertexData[P++]=y.angle,this._vertexData[P++]=y.scale.x*y.size,this._vertexData[P++]=y.scale.y*y.size,this._isAnimationSheetEnabled&&(this._vertexData[P++]=y.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[P++]=y.direction.x,this._vertexData[P++]=y.direction.y,this._vertexData[P++]=y.direction.z);else if(y._initialDirection){let v=y._initialDirection;this.isLocal&&(B.n.TransformNormalToRef(v,this._emitterWorldMatrix,B.i.o[0]),v=B.i.o[0]),0===v.x&&0===v.z&&(v.x=.001),this._vertexData[P++]=v.x,this._vertexData[P++]=v.y,this._vertexData[P++]=v.z}else{let v=y.direction;this.isLocal&&(B.n.TransformNormalToRef(v,this._emitterWorldMatrix,B.i.o[0]),v=B.i.o[0]),0===v.x&&0===v.z&&(v.x=.001),this._vertexData[P++]=v.x,this._vertexData[P++]=v.y,this._vertexData[P++]=v.z}this._useRampGradients&&y.remapData&&(this._vertexData[P++]=y.remapData.x,this._vertexData[P++]=y.remapData.y,this._vertexData[P++]=y.remapData.z,this._vertexData[P++]=y.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===n?n=this._epsilon:1===n&&(n=1-this._epsilon),0===J?J=this._epsilon:1===J&&(J=1-this._epsilon)),this._vertexData[P++]=n,this._vertexData[P++]=J)}_prepareParticle(v){}_update(v){if(this._alive=this.Gj.length>0,this.j.position){const v=this.j;this._emitterWorldMatrix=v.getWorldMatrix()}else{const v=this.j;this._emitterWorldMatrix=B.d.Translation(v.x,v.y,v.z)}let y;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Gj);for(let n=0;n<v&&this.Gj.length!==this._capacity;n++){if(y=this._createParticle(),this.Gj.push(y),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const v=(0,a.c)(this._actualFrame/this.targetStopDuration);D.GetCurrentGradient(v,this._lifeTimeGradients,((n,B)=>{const J=n,P=B,b=J.getFactor(),Y=P.getFactor(),l=(v-J.gradient)/(P.gradient-J.gradient);y.lifeTime=(0,a.k)(b,Y,l)}))}else y.lifeTime=(0,a.n)(this.minLifeTime,this.maxLifeTime);const v=(0,a.n)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,y.position,y,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,y.position,y,this.isLocal),this.isLocal&&(y.we?y.we.p(y.position):y.we=y.position.clone(),B.n.TransformCoordinatesToRef(y.we,this._emitterWorldMatrix,y.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,y.direction,y,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,y.direction,y,this.isLocal,this._emitterInverseWorldMatrix),0===v?y._initialDirection?y._initialDirection.p(y.direction):y._initialDirection=y.direction.clone():y._initialDirection=null,y.direction.scaleInPlace(v),this._sizeGradients&&0!==this._sizeGradients.length?(y._currentSizeGradient=this._sizeGradients[0],y._currentSize1=y._currentSizeGradient.getFactor(),y.size=y._currentSize1,this._sizeGradients.length>1?y._currentSize2=this._sizeGradients[1].getFactor():y._currentSize2=y._currentSize1):y.size=(0,a.n)(this.minSize,this.maxSize),y.scale.Ae((0,a.n)(this.minScaleX,this.maxScaleX),(0,a.n)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const v=this._actualFrame/this.targetStopDuration;D.GetCurrentGradient(v,this._startSizeGradients,((v,n,B)=>{v!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=n.getFactor(),this._currentStartSizeGradient=v);const J=(0,a.k)(this._currentStartSize1,this._currentStartSize2,B);y.scale.scaleInPlace(J)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(y._currentAngularSpeedGradient=this._angularSpeedGradients[0],y.angularSpeed=y._currentAngularSpeedGradient.getFactor(),y._currentAngularSpeed1=y.angularSpeed,this._angularSpeedGradients.length>1?y._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():y._currentAngularSpeed2=y._currentAngularSpeed1):y.angularSpeed=(0,a.n)(this.minAngularSpeed,this.maxAngularSpeed),y.angle=(0,a.n)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(y._currentVelocityGradient=this._velocityGradients[0],y._currentVelocity1=y._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?y._currentVelocity2=this._velocityGradients[1].getFactor():y._currentVelocity2=y._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(y._currentLimitVelocityGradient=this._limitVelocityGradients[0],y._currentLimitVelocity1=y._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?y._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():y._currentLimitVelocity2=y._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(y._currentDragGradient=this._dragGradients[0],y._currentDrag1=y._currentDragGradient.getFactor(),this._dragGradients.length>1?y._currentDrag2=this._dragGradients[1].getFactor():y._currentDrag2=y._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)y._currentColorGradient=this._colorGradients[0],y._currentColorGradient.getColorToRef(y.color),y._currentColor1.p(y.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(y._currentColor2):y._currentColor2.p(y.color);else{const v=(0,a.n)(0,1);b.e.LerpToRef(this.color1,this.color2,v,y.color),this.colorDead.subtractToRef(y.color,this._colorDiff),this._colorDiff.scaleToRef(1/y.lifeTime,y.colorStep)}this._isAnimationSheetEnabled&&(y._initialStartSpriteCellID=this.startSpriteCellID,y._initialEndSpriteCellID=this.endSpriteCellID,y._initialSpriteCellLoop=this.spriteCellLoop),y.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(y.remapData=new B.p(0,1,0,1)),this.noiseTexture&&(y._randomNoiseCoordinates1?(y._randomNoiseCoordinates1.Ae(Math.random(),Math.random(),Math.random()),y._randomNoiseCoordinates2.Ae(Math.random(),Math.random(),Math.random())):(y._randomNoiseCoordinates1=new B.n(Math.random(),Math.random(),Math.random()),y._randomNoiseCoordinates2=new B.n(Math.random(),Math.random(),Math.random()))),y._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=[C.i.PositionKind,C.i.ColorKind,"angle","offset","size"];return v&&B.push("cellIndex"),y||B.push("direction"),n&&B.push("remapData"),B}static _GetEffectCreationOptions(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,yv.e)(B),v&&B.push("particlesInfos"),y&&B.push("logarithmicDepthConstant"),n&&(B.push("vFogInfos"),B.push("vFogColor")),B}fillDefines(v,y){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,yv.l)(this,this._scene,v),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&v.push("#define FOG")),this._isAnimationSheetEnabled&&v.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&v.push("#define LOGARITHMICDEPTH"),y===l.BLENDMODE_MULTIPLY&&v.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&v.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(v.push("#define BILLBOARD"),this.billboardMode){case 2:v.push("#define BILLBOARDY");break;case 8:case 9:v.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&v.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:v.push("#define BILLBOARDMODE_ALL")}n&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),v.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(v,y,n){y.push(...Jv._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),v.push(...Jv._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),n.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Bv.g)(v,this._imageProcessingConfigurationDefines),(0,Bv.e)(n,this._imageProcessingConfigurationDefines))}_getWrapper(v){const y=this._getCustomDrawWrapper(v);if(null!==y&&void 0!==y&&y.effect)return y;const n=[];this.fillDefines(n,v);const B=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let J=this._drawWrappers[B];J||(J=this._drawWrappers[B]=[]);let P=J[v];P||(P=new vv.d(this._engine),P.drawContext&&(P.drawContext.useInstancing=this._useInstancing),J[v]=P);const b=n.join("\n");if(P.defines!==b){const v=[],y=[],n=[];this.fillUniformsAttributesAndSamplerNames(y,v,n),P.setEffect(this._engine.createEffect("particles",v,y,n,b,void 0,void 0,void 0,void 0,this._shaderLanguage),b)}return P}animate(){var v;let y,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!n&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(n?this.preWarmStepOffset:(null===(v=this._scene)||void 0===v?void 0:v.getAnimationRatio())||1),this.manualEmitCount>-1)y=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let v=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const y=this._actualFrame/this.targetStopDuration;D.GetCurrentGradient(y,this._emitRateGradients,((y,n,B)=>{y!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=n.getFactor(),this._currentEmitRateGradient=y),v=(0,a.k)(this._currentEmitRate1,this._currentEmitRate2,B)}))}y=v*this._scaledUpdateSpeed|0,this._newPartsExcess+=v*this._scaledUpdateSpeed-y}if(this._newPartsExcess>1&&(y+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?y=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(y),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!n){let v=0;for(let y=0;y<this.Gj.length;y++){const n=this.Gj[y];this._appendParticleVertices(v,n),v+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Gj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(v,y){this._appendParticleVertex(v++,y,0,0),this._useInstancing||(this._appendParticleVertex(v++,y,1,0),this._appendParticleVertex(v++,y,1,1),this._appendParticleVertex(v++,y,0,1))}rebuild(){var v;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(v=this._spriteBuffer)||void 0===v||v._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Jv.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(n.bind(n,11814)),Promise.resolve().then(n.bind(n,11762))])):await Promise.all([Promise.resolve().then(n.bind(n,11750)),Promise.resolve().then(n.bind(n,11737))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==l.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(l.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(l.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(v){const y=this._getWrapper(v),n=y.effect,J=this._engine;J.enableEffect(y);const P=this.defaultViewMatrix??this._scene.getViewMatrix();if(n.setTexture("diffuseSampler",this.particleTexture),n.setMatrix("view",P),n.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const v=this.particleTexture.getBaseSize();n.setFloat3("particlesInfos",this.spriteCellWidth/v.width,this.spriteCellHeight/v.height,this.spriteCellWidth/v.width)}if(n.setVector2("translationPivot",this.translationPivot),n.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const v=this._scene.activeCamera;n.setVector3("eyePosition",v.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),n.setTexture("rampSampler",this._rampGradientsTexture));const b=n.defines;var Y,a,Z,x,f,N;(this._scene&&((0,yv.h)(n,this,this._scene),this.applyFog&&(0,nv.h)(this._scene,void 0,n)),b.indexOf("#define BILLBOARDMODE_ALL")>=0&&(P.invertToRef(B.i.Matrix[0]),n.setMatrix("invView",B.i.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?J.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,n):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,n)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?J.bindBuffers(this._vertexBuffers,null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._linesIndexBuffer:this._indexBuffer,n):J.bindBuffers(this._vertexBuffers,null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?this._linesIndexBufferUseInstancing:null,n);switch(this.useLogarithmicDepth&&this._scene&&(0,nv.m)(b,n,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(n),v){case l.BLENDMODE_ADD:J.setAlphaMode(1);break;case l.BLENDMODE_ONEONE:J.setAlphaMode(6);break;case l.BLENDMODE_STANDARD:J.setAlphaMode(2);break;case l.BLENDMODE_MULTIPLY:J.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(n),this._useInstancing)?null!==(f=this._scene)&&void 0!==f&&f.forceWireframe?J.drawElementsType(6,0,10,this.Gj.length):J.drawArraysType(7,0,4,this.Gj.length):null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?J.drawElementsType(1,0,10*this.Gj.length):J.drawElementsType(0,0,6*this.Gj.length);return this.Gj.length}render(){if(!this.isReady()||!this.Gj.length)return 0;const v=this._engine;v.setState&&(v.setState(!1),this.forceDepthWrite&&v.setDepthWrite(!0));let y=0;return y=this.blendMode===l.BLENDMODE_MULTIPLYADD?this._render(l.BLENDMODE_MULTIPLY)+this._render(l.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),y}_onDispose(){}dispose(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),v&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),v&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(y,n),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const v=this._scene.Ej.indexOf(this);v>-1&&this._scene.Ej.splice(v,1),this._scene._activeParticleSystems.dispose()}this.xj.notifyObservers(this),this.xj.clear(),this.onStoppedObservable.clear(),this.reset()}}Jv.ForceGLSL=!1;var Pv,bv=n(10811);!function(v){v[v.ATTACHED=0]="ATTACHED",v[v.END=1]="END"}(Pv||(Pv={}));class Yv{constructor(v){if(this.particleSystem=v,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!v.j||!v.j.dispose){const y=(0,Y.d)("BABYLON.AbstractMesh");v.j=new y("SubemitterSystemEmitter",v.va()),v._disposeEmitterOnDispose=!0}}clone(){let v=this.particleSystem.j;if(v){if(v instanceof B.n)v=v.clone();else if(-1!==v.getClassName().indexOf("Mesh")){v=new((0,Y.d)("BABYLON.Mesh"))("",v.va()),v.isVisible=!1}}else v=new B.n;const y=new Yv(this.particleSystem.clone(this.particleSystem.name,v));return y.particleSystem.name+="Clone",y.type=this.type,y.inheritDirection=this.inheritDirection,y.inheritedVelocityAmount=this.inheritedVelocityAmount,y.particleSystem._disposeEmitterOnDispose=!0,y.particleSystem.disposeOnStop=!0,y}serialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y={};return y.type=this.type,y.inheritDirection=this.inheritDirection,y.inheritedVelocityAmount=this.inheritedVelocityAmount,y.particleSystem=this.particleSystem.serialize(v),y}static _ParseParticleSystem(v,y,n){throw(0,bv.e)("ParseParticle")}static Parse(v,y,n){const B=v.particleSystem,J=new Yv(Yv._ParseParticleSystem(B,y,n,!0));return J.type=v.type,J.inheritDirection=v.inheritDirection,J.inheritedVelocityAmount=v.inheritedVelocityAmount,J.particleSystem._isSubEmitter=!0,J}dispose(){this.particleSystem.dispose()}}var lv=n(10849);function av(v,y){const n=new h;return n.direction1=v,n.direction2=y,n}function Zv(){return new c(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function xv(){return new E(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function fv(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.n(0,1,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.n(0,1,0);return new W(v,y,n)}function Nv(){return new i(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function iv(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.n(0,1,0),P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.n(0,1,0);return new g(v,y,n,J,P)}function gv(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new f(v,y)}function cv(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.n(0,1,0),J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.n(0,1,0);return new N(v,y,n,J)}class hv extends Jv{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=v=>{if(!this._subEmitters||0===this._subEmitters.length)return;const y=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[y].forEach((y=>{if(1===y.type){const n=y.clone();v._inheritParticleInfoToSubEmitter(n),n.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(n.particleSystem),n.particleSystem.start()}}))}}createPointEmitter(v,y){const n=av(v,y);return this.particleEmitterType=n,n}createHemisphericEmitter(){const v=Zv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=v,v}createSphereEmitter(){const v=xv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=v,v}createDirectedSphereEmitter(){const v=fv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.n(0,1,0));return this.particleEmitterType=v,v}createCylinderEmitter(){const v=Nv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=v,v}createDirectedCylinderEmitter(){const v=iv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.n(0,1,0));return this.particleEmitterType=v,v}createConeEmitter(){const v=gv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=v,v}createDirectedConeEmitter(){const v=cv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.n(0,1,0));return this.particleEmitterType=v,v}createBoxEmitter(v,y,n,B){const J=new x;return this.particleEmitterType=J,this.direction1=v,this.direction2=y,this.minEmitBox=n,this.maxEmitBox=B,J}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((v=>{v instanceof hv?this._subEmitters.push([new Yv(v)]):v instanceof Yv?this._subEmitters.push([v]):v instanceof Array&&this._subEmitters.push(v)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((v=>{v.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const v=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==v&&this._rootParticleSystem.activeSubSystems.splice(v,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(v){v&&this._stopSubEmitters()}_prepareParticle(v){if(this._subEmitters&&this._subEmitters.length>0){const y=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];v._attachedSubEmitters=[],y.forEach((y=>{if(0===y.type){const n=y.clone();v._attachedSubEmitters.push(n),n.particleSystem.start()}}))}}_onDispose(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var n;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),v)&&(null===(n=this.particles)||void 0===n||n.forEach((v=>{if(v._attachedSubEmitters)for(let y=v._attachedSubEmitters.length-1;y>=0;y-=1)v._attachedSubEmitters[y].dispose()})));if(y&&this.activeSubSystems)for(let B=this.activeSubSystems.length-1;B>=0;B-=1)this.activeSubSystems[B].dispose();if(this._subEmitters&&this._subEmitters.length){for(let v=0;v<this._subEmitters.length;v++)for(const y of this._subEmitters[v])y.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(v,y,n,J){let P;P=n instanceof lv.c?null:n;const l=(0,Y.d)("BABYLON.Texture");if(l&&P&&(v.texture?y.particleTexture=l.Parse(v.texture,P,J):v.textureName&&(y.particleTexture=new l(J+v.textureName,P,!1,void 0===v.invertY||v.invertY),y.particleTexture.name=v.textureName)),v.emitterId||0===v.emitterId||void 0!==v.j?v.emitterId&&P?y.j=P.getLastMeshById(v.emitterId):y.j=B.n.qh(v.j):y.j=B.n.Zero(),y.isLocal=!!v.isLocal,void 0!==v.renderingGroupId&&(y.renderingGroupId=v.renderingGroupId),void 0!==v.isBillboardBased&&(y.isBillboardBased=v.isBillboardBased),void 0!==v.billboardMode&&(y.billboardMode=v.billboardMode),void 0!==v.useLogarithmicDepth&&(y.useLogarithmicDepth=v.useLogarithmicDepth),v.animations){for(let n=0;n<v.animations.length;n++){const B=v.animations[n],J=(0,Y.d)("BABYLON.Animation");J&&y.animations.push(J.Parse(B))}y.beginAnimationOnStart=v.beginAnimationOnStart,y.beginAnimationFrom=v.beginAnimationFrom,y.beginAnimationTo=v.beginAnimationTo,y.beginAnimationLoop=v.beginAnimationLoop}if(v.autoAnimate&&P&&P.beginAnimation(y,v.autoAnimateFrom,v.autoAnimateTo,v.autoAnimateLoop,v.autoAnimateSpeed||1),y.startDelay=0|v.startDelay,y.minAngularSpeed=v.minAngularSpeed,y.maxAngularSpeed=v.maxAngularSpeed,y.minSize=v.minSize,y.maxSize=v.maxSize,v.minScaleX&&(y.minScaleX=v.minScaleX,y.maxScaleX=v.maxScaleX,y.minScaleY=v.minScaleY,y.maxScaleY=v.maxScaleY),void 0!==v.preWarmCycles&&(y.preWarmCycles=v.preWarmCycles,y.preWarmStepOffset=v.preWarmStepOffset),void 0!==v.minInitialRotation&&(y.minInitialRotation=v.minInitialRotation,y.maxInitialRotation=v.maxInitialRotation),y.minLifeTime=v.minLifeTime,y.maxLifeTime=v.maxLifeTime,y.minEmitPower=v.minEmitPower,y.maxEmitPower=v.maxEmitPower,y.emitRate=v.emitRate,y.gravity=B.n.qh(v.gravity),v.noiseStrength&&(y.noiseStrength=B.n.qh(v.noiseStrength)),y.color1=b.e.qh(v.color1),y.color2=b.e.qh(v.color2),y.colorDead=b.e.qh(v.colorDead),y.updateSpeed=v.updateSpeed,y.targetStopDuration=v.targetStopDuration,y.blendMode=v.blendMode,v.colorGradients)for(const B of v.colorGradients)y.addColorGradient(B.gradient,b.e.qh(B.color1),B.color2?b.e.qh(B.color2):void 0);if(v.rampGradients){for(const n of v.rampGradients)y.addRampGradient(n.gradient,b.d.qh(n.color));y.useRampGradients=v.useRampGradients}if(v.colorRemapGradients)for(const B of v.colorRemapGradients)y.addColorRemapGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(v.alphaRemapGradients)for(const B of v.alphaRemapGradients)y.addAlphaRemapGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(v.sizeGradients)for(const B of v.sizeGradients)y.addSizeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(v.angularSpeedGradients)for(const B of v.angularSpeedGradients)y.addAngularSpeedGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(v.velocityGradients)for(const B of v.velocityGradients)y.addVelocityGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(v.dragGradients)for(const B of v.dragGradients)y.addDragGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(v.emitRateGradients)for(const B of v.emitRateGradients)y.addEmitRateGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(v.startSizeGradients)for(const B of v.startSizeGradients)y.addStartSizeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(v.lifeTimeGradients)for(const B of v.lifeTimeGradients)y.addLifeTimeGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2);if(v.limitVelocityGradients){for(const n of v.limitVelocityGradients)y.addLimitVelocityGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);y.limitVelocityDamping=v.limitVelocityDamping}if(v.noiseTexture&&P){const n=(0,Y.d)("BABYLON.ProceduralTexture");y.noiseTexture=n.Parse(v.noiseTexture,P,J)}let a;if(v.particleEmitterType){switch(v.particleEmitterType.type){case"SphereParticleEmitter":a=new E;break;case"SphereDirectedParticleEmitter":a=new W;break;case"ConeEmitter":case"ConeParticleEmitter":a=new f;break;case"ConeDirectedParticleEmitter":a=new N;break;case"CylinderParticleEmitter":a=new i;break;case"CylinderDirectedParticleEmitter":a=new g;break;case"HemisphericParticleEmitter":a=new c;break;case"PointParticleEmitter":a=new h;break;case"MeshParticleEmitter":a=new r;break;case"CustomParticleEmitter":a=new s;break;default:a=new x}a.parse(v.particleEmitterType,P)}else a=new x,a.parse(v,P);y.particleEmitterType=a,y.startSpriteCellID=v.startSpriteCellID,y.endSpriteCellID=v.endSpriteCellID,y.spriteCellLoop=v.spriteCellLoop??!0,y.spriteCellWidth=v.spriteCellWidth,y.spriteCellHeight=v.spriteCellHeight,y.spriteCellChangeSpeed=v.spriteCellChangeSpeed,y.spriteRandomStartCell=v.spriteRandomStartCell,y.disposeOnStop=v.disposeOnStop??!1,y.manualEmitCount=v.manualEmitCount??-1}static Parse(v,y,n){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],P=arguments.length>4?arguments[4]:void 0;const Y=v.name;let l,a,Z=null,x=null;if(y instanceof lv.c?l=y:(a=y,l=a.getEngine()),v.customShader&&l.createEffectForParticles){x=v.customShader;const y=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"";Z=l.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,y)}const f=new hv(Y,P||v.ob,y,Z,v.isAnimationSheetEnabled);if(f.customShader=x,f._rootUrl=n,v.id&&(f.id=v.id),v.subEmitters){f.subEmitters=[];for(const B of v.subEmitters){const v=[];for(const J of B)v.push(Yv.Parse(J,y,n));f.subEmitters.push(v)}}return hv._Parse(v,f,y,n),v.textureMask&&(f.textureMask=b.e.qh(v.textureMask)),v.ug&&(f.ug=B.n.qh(v.ug)),v.preventAutoStart&&(f.preventAutoStart=v.preventAutoStart),J||f.preventAutoStart||f.start(),f}serialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y={};if(hv._Serialize(y,this,v),y.textureMask=this.textureMask.wj(),y.customShader=this.customShader,y.preventAutoStart=this.preventAutoStart,y.ug=this.ug.wj(),this.subEmitters){y.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const n of this._subEmitters){const B=[];for(const y of n)B.push(y.serialize(v));y.subEmitters.push(B)}}return y}static _Serialize(v,y,n){if(v.name=y.name,v.id=y.id,v.ob=y.getCapacity(),v.disposeOnStop=y.disposeOnStop,v.manualEmitCount=y.manualEmitCount,y.j.position){const n=y.j;v.emitterId=n.id}else{const n=y.j;v.j=n.wj()}y.particleEmitterType&&(v.particleEmitterType=y.particleEmitterType.serialize()),y.particleTexture&&(n?v.texture=y.particleTexture.serialize():(v.textureName=y.particleTexture.name,v.invertY=!!y.particleTexture._invertY)),v.isLocal=y.isLocal,w.d.AppendSerializedAnimations(y,v),v.beginAnimationOnStart=y.beginAnimationOnStart,v.beginAnimationFrom=y.beginAnimationFrom,v.beginAnimationTo=y.beginAnimationTo,v.beginAnimationLoop=y.beginAnimationLoop,v.startDelay=y.startDelay,v.renderingGroupId=y.renderingGroupId,v.isBillboardBased=y.isBillboardBased,v.billboardMode=y.billboardMode,v.minAngularSpeed=y.minAngularSpeed,v.maxAngularSpeed=y.maxAngularSpeed,v.minSize=y.minSize,v.maxSize=y.maxSize,v.minScaleX=y.minScaleX,v.maxScaleX=y.maxScaleX,v.minScaleY=y.minScaleY,v.maxScaleY=y.maxScaleY,v.minEmitPower=y.minEmitPower,v.maxEmitPower=y.maxEmitPower,v.minLifeTime=y.minLifeTime,v.maxLifeTime=y.maxLifeTime,v.emitRate=y.emitRate,v.gravity=y.gravity.wj(),v.noiseStrength=y.noiseStrength.wj(),v.color1=y.color1.wj(),v.color2=y.color2.wj(),v.colorDead=y.colorDead.wj(),v.updateSpeed=y.updateSpeed,v.targetStopDuration=y.targetStopDuration,v.blendMode=y.blendMode,v.preWarmCycles=y.preWarmCycles,v.preWarmStepOffset=y.preWarmStepOffset,v.minInitialRotation=y.minInitialRotation,v.maxInitialRotation=y.maxInitialRotation,v.startSpriteCellID=y.startSpriteCellID,v.spriteCellLoop=y.spriteCellLoop,v.endSpriteCellID=y.endSpriteCellID,v.spriteCellChangeSpeed=y.spriteCellChangeSpeed,v.spriteCellWidth=y.spriteCellWidth,v.spriteCellHeight=y.spriteCellHeight,v.spriteRandomStartCell=y.spriteRandomStartCell,v.isAnimationSheetEnabled=y.isAnimationSheetEnabled,v.useLogarithmicDepth=y.useLogarithmicDepth;const B=y.getColorGradients();if(B){v.colorGradients=[];for(const y of B){const n={gradient:y.gradient,color1:y.color1.wj()};y.color2?n.color2=y.color2.wj():n.color2=y.color1.wj(),v.colorGradients.push(n)}}const J=y.getRampGradients();if(J){v.rampGradients=[];for(const y of J){const n={gradient:y.gradient,color:y.color.wj()};v.rampGradients.push(n)}v.useRampGradients=y.useRampGradients}const P=y.getColorRemapGradients();if(P){v.colorRemapGradients=[];for(const y of P){const n={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?n.factor2=y.factor2:n.factor2=y.factor1,v.colorRemapGradients.push(n)}}const b=y.getAlphaRemapGradients();if(b){v.alphaRemapGradients=[];for(const y of b){const n={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?n.factor2=y.factor2:n.factor2=y.factor1,v.alphaRemapGradients.push(n)}}const Y=y.getSizeGradients();if(Y){v.sizeGradients=[];for(const y of Y){const n={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?n.factor2=y.factor2:n.factor2=y.factor1,v.sizeGradients.push(n)}}const l=y.getAngularSpeedGradients();if(l){v.angularSpeedGradients=[];for(const y of l){const n={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?n.factor2=y.factor2:n.factor2=y.factor1,v.angularSpeedGradients.push(n)}}const a=y.getVelocityGradients();if(a){v.velocityGradients=[];for(const y of a){const n={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?n.factor2=y.factor2:n.factor2=y.factor1,v.velocityGradients.push(n)}}const Z=y.getDragGradients();if(Z){v.dragGradients=[];for(const y of Z){const n={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?n.factor2=y.factor2:n.factor2=y.factor1,v.dragGradients.push(n)}}const x=y.getEmitRateGradients();if(x){v.emitRateGradients=[];for(const y of x){const n={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?n.factor2=y.factor2:n.factor2=y.factor1,v.emitRateGradients.push(n)}}const f=y.getStartSizeGradients();if(f){v.startSizeGradients=[];for(const y of f){const n={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?n.factor2=y.factor2:n.factor2=y.factor1,v.startSizeGradients.push(n)}}const N=y.getLifeTimeGradients();if(N){v.lifeTimeGradients=[];for(const y of N){const n={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?n.factor2=y.factor2:n.factor2=y.factor1,v.lifeTimeGradients.push(n)}}const i=y.getLimitVelocityGradients();if(i){v.limitVelocityGradients=[];for(const y of i){const n={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?n.factor2=y.factor2:n.factor2=y.factor1,v.limitVelocityGradients.push(n)}v.limitVelocityDamping=y.limitVelocityDamping}y.noiseTexture&&(v.noiseTexture=y.noiseTexture.serialize())}clone(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B={...this._customWrappers};let J=null;const P=this._engine;if(P.createEffectForParticles&&null!=this.customShader){J=this.customShader;const v=J.shaderOptions.defines.length>0?J.shaderOptions.defines.join("\n"):"",y=P.createEffectForParticles(J.shaderPath.fragmentElement,J.shaderOptions.uniforms,J.shaderOptions.samplers,v);B[0]?B[0].effect=y:this.setCustomEffect(y,0)}const b=this.serialize(n),Y=hv.Parse(b,this._scene||this._engine,this._rootUrl);return Y.name=v,Y.customShader=J,Y._customWrappers=B,void 0===y&&(y=this.j),this.noiseTexture&&(Y.noiseTexture=this.noiseTexture.clone()),Y.j=y,this.preventAutoStart||Y.start(),Y}}hv.BILLBOARDMODE_Y=2,hv.BILLBOARDMODE_ALL=7,hv.BILLBOARDMODE_STRETCHED=8,hv.BILLBOARDMODE_STRETCHED_LOCAL=9,Yv._ParseParticleSystem=hv.Parse;var Ev=n(11094),Wv=n(11070),sv=n(11538);sv.b.prototype.createTransformFeedback=function(){const v=this._gl.createTransformFeedback();if(!v)throw new Error("Unable to create Transform Feedback");return v},sv.b.prototype.deleteTransformFeedback=function(v){this._gl.deleteTransformFeedback(v)},sv.b.prototype.bindTransformFeedback=function(v){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,v)},sv.b.prototype.beginTransformFeedback=function(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(v?this._gl.POINTS:this._gl.TRIANGLES)},sv.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},sv.b.prototype.setTranformFeedbackVaryings=function(v,y){this._gl.transformFeedbackVaryings(v,y,this._gl.INTERLEAVED_ATTRIBS)},sv.b.prototype.bindTransformFeedbackBuffer=function(v){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,v?v.underlyingResource:null)},sv.b.prototype.readTransformFeedbackBuffer=function(v){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,v)};const Cv="clipPlaneFragmentDeclaration2",rv="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";d.b.IncludesShadersStore[Cv]=rv;n(11636),n(11638),n(11641),n(11647),n(11654),n(11656),n(11661),n(11668);const uv="gpuRenderParticlesPixelShader",Ov="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";d.b.ShadersStore[uv]=Ov;const dv="clipPlaneVertexDeclaration2",qv="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";d.b.IncludesShadersStore[dv]=qv;n(11676),n(11682),n(11688),n(11694);const Lv="gpuRenderParticlesVertexShader",tv="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";d.b.ShadersStore[Lv]=tv;class Gv extends l{static get IsSupported(){if(!T.b.LastCreatedEngine)return!1;const v=T.b.LastCreatedEngine.getCaps();return v.supportTransformFeedbacks||v.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(v){this._maxActiveParticleCount=Math.min(v,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(v){this.maxActiveParticleCount=v}createPointEmitter(v,y){const n=av(v,y);return this.particleEmitterType=n,n}createHemisphericEmitter(){const v=Zv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=v,v}createSphereEmitter(){const v=xv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=v,v}createDirectedSphereEmitter(){const v=fv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new B.n(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.n(0,1,0));return this.particleEmitterType=v,v}createCylinderEmitter(){const v=Nv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=v,v}createDirectedCylinderEmitter(){const v=iv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.n(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new B.n(0,1,0));return this.particleEmitterType=v,v}createConeEmitter(){const v=gv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=v,v}createDirectedConeEmitter(){const v=cv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new B.n(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new B.n(0,1,0));return this.particleEmitterType=v,v}createBoxEmitter(v,y,n,B){const J=new x;return this.particleEmitterType=J,this.direction1=v,this.direction2=y,this.minEmitBox=n,this.maxEmitBox=B,J}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==hv.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(hv.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(hv.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";v?setTimeout((()=>{this.start(0)}),v):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var v;let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(v=this._customWrappers[y])||void 0===v?void 0:v.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[v]??this._customWrappers[0]}setCustomEffect(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[y]=new vv.d(this._engine),this._customWrappers[y].effect=v}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Q.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(v,y,n){return super._removeGradientAndTexture(v,y,n),this._releaseBuffers(),this}addColorGradient(v,y){this._colorGradients||(this._colorGradients=[]);const n=new z(v,y);return this._colorGradients.push(n),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(v&&this._colorGradients.sort(((v,y)=>v.gradient<y.gradient?-1:v.gradient>y.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(v){return this._removeGradientAndTexture(v,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const y in this._drawWrappers){var v;null===(v=this._drawWrappers[y].drawContext)||void 0===v||v.reset()}}_addFactorGradient(v,y,n){const B=new K(y,n);v.push(B),this._releaseBuffers()}addSizeGradient(v,y){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,v,y),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(v){return this._removeGradientAndTexture(v,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(v,y){if(!v)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&v.sort(((v,y)=>v.gradient<y.gradient?-1:v.gradient>y.gradient?1:0));const n=this;n[y]&&(n[y].dispose(),n[y]=null)}addAngularSpeedGradient(v,y){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,v,y),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(v){return this._removeGradientAndTexture(v,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(v,y){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,v,y),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(v){return this._removeGradientAndTexture(v,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(v,y){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,v,y),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(v){return this._removeGradientAndTexture(v,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(v,y){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,v,y),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(v){return this._removeGradientAndTexture(v,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(v){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(v,y,n){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(v),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.xj=new Q.e,this.onStoppedObservable=new Q.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,n&&"Scene"!==n.getClassName()?(this._engine=n,this.defaultProjectionMatrix=B.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=n||T.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ej.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,Y.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,Y.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,Y.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,Y.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new vv.d(this._engine)},this._customWrappers[0].effect=J,this._drawWrappers={0:new vv.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(y=y??{}).randomTextureSize||delete y.randomTextureSize;const b={ob:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...y},l=y;isFinite(l)&&(b.ob=l),this._capacity=b.ob,this._maxActiveParticleCount=b.ob,this._currentActiveCount=0,this._isAnimationSheetEnabled=P,this.particleEmitterType=new x;const a=Math.min(this._engine.getCaps().maxTextureSize,b.randomTextureSize);let Z=[];for(let B=0;B<a;++B)Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random());this._randomTexture=new o.e(new Float32Array(Z),a,1,5,n,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,Z=[];for(let B=0;B<a;++B)Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random());this._randomTexture2=new o.e(new Float32Array(Z),a,1,5,n,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=a}_reset(){this._releaseBuffers()}_createVertexBuffers(v,y,n){const B={};B.position=y.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let J=3;B.age=y.createVertexBuffer("age",J,1,this._attributesStrideSize,!0),J+=1,B.size=y.createVertexBuffer("size",J,3,this._attributesStrideSize,!0),J+=3,B.life=y.createVertexBuffer("life",J,1,this._attributesStrideSize,!0),J+=1,J+=4,this.billboardMode===hv.BILLBOARDMODE_STRETCHED&&(B.direction=y.createVertexBuffer("direction",J,3,this._attributesStrideSize,!0)),J+=3,this._platform.alignDataInBuffer&&(J+=1),this.particleEmitterType instanceof s&&(J+=3,this._platform.alignDataInBuffer&&(J+=1)),this._colorGradientsTexture||(B.color=y.createVertexBuffer("color",J,4,this._attributesStrideSize,!0),J+=4),this._isBillboardBased||(B.initialDirection=y.createVertexBuffer("initialDirection",J,3,this._attributesStrideSize,!0),J+=3,this._platform.alignDataInBuffer&&(J+=1)),this.noiseTexture&&(B.noiseCoordinates1=y.createVertexBuffer("noiseCoordinates1",J,3,this._attributesStrideSize,!0),J+=3,this._platform.alignDataInBuffer&&(J+=1),B.noiseCoordinates2=y.createVertexBuffer("noiseCoordinates2",J,3,this._attributesStrideSize,!0),J+=3,this._platform.alignDataInBuffer&&(J+=1)),B.angle=y.createVertexBuffer("angle",J,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?J++:J+=2,this._isAnimationSheetEnabled&&(B.cellIndex=y.createVertexBuffer("cellIndex",J,1,this._attributesStrideSize,!0),J+=1,this.spriteRandomStartCell&&(B.cellStartOffset=y.createVertexBuffer("cellStartOffset",J,1,this._attributesStrideSize,!0),J+=1)),B.offset=n.createVertexBuffer("offset",0,2),B.uv=n.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(B),this._platform.createVertexBuffers(v,B),this.resetDrawCache()}_initialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!v)return;const y=this._engine,n=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof s&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const J=this.particleEmitterType instanceof s,P=B.i.o[0];let b=0;for(let B=0;B<this._capacity;B++)if(n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),J?(this.particleEmitterType.particleDestinationGenerator(B,null,P),n.push(P.x),n.push(P.y),n.push(P.z)):(n.push(0),n.push(0),n.push(0)),this._platform.alignDataInBuffer&&n.push(0),b+=16,J&&(this.particleEmitterType.particlePositionGenerator(B,null,P),n.push(P.x),n.push(P.y),n.push(P.z),this._platform.alignDataInBuffer&&n.push(0),b+=4),this._colorGradientsTexture||(n.push(0),n.push(0),n.push(0),n.push(0),b+=4),this.isBillboardBased||(n.push(0),n.push(0),n.push(0),this._platform.alignDataInBuffer&&n.push(0),b+=4),this.noiseTexture&&(n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),this._platform.alignDataInBuffer&&n.push(0),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),this._platform.alignDataInBuffer&&n.push(0),b+=8),n.push(0),b+=1,this._angularSpeedGradientsTexture||(n.push(0),b+=1),this._isAnimationSheetEnabled&&(n.push(0),b+=1,this.spriteRandomStartCell&&(n.push(0),b+=1)),this._platform.alignDataInBuffer){let v=3-(b+3&3);for(b+=v;v-- >0;)n.push(0)}const Y=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),l=this._platform.createParticleBuffer(n),a=this._platform.createParticleBuffer(n);this._buffer0=new C.e(y,l,!1,this._attributesStrideSize),this._buffer1=new C.e(y,a,!1,this._attributesStrideSize),this._spriteBuffer=new C.e(y,Y,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let v=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(v+="\n#define BILLBOARD"),this._colorGradientsTexture&&(v+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(v+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(v+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(v+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(v+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(v+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(v+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(v+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(v+="\n#define NOISE"),this.isLocal&&(v+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===v||(this._cachedUpdateDefines=v,this._updateBuffer=this._platform.createUpdateBuffer(v)),this._platform.isUpdateBufferReady()}_getWrapper(v){const y=this._getCustomDrawWrapper(v);if(null!==y&&void 0!==y&&y.effect)return y;const n=[];this.fillDefines(n,v);let B=this._drawWrappers[v];B||(B=new vv.d(this._engine),B.drawContext&&(B.drawContext.useInstancing=!0),this._drawWrappers[v]=B);const J=n.join("\n");if(B.defines!==J){const v=[],y=[],n=[];this.fillUniformsAttributesAndSamplerNames(y,v,n),B.setEffect(this._engine.createEffect("gpuRenderParticles",v,y,n,J),J)}return B}static _GetAttributeNamesOrOptions(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const J=[C.i.PositionKind,"age","life","size","angle"];return v||J.push(C.i.ColorKind),y&&J.push("cellIndex"),n||J.push("initialDirection"),B&&J.push("direction"),J.push("offset",C.i.UVKind),J}static _GetEffectCreationOptions(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=["emitterWM","ug","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,yv.e)(B),v&&B.push("sheetInfos"),y&&B.push("logarithmicDepthConstant"),n&&(B.push("vFogInfos"),B.push("vFogColor")),B}fillDefines(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,yv.l)(this,this._scene,v),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Wv.e.FOGMODE_NONE&&v.push("#define FOG")),y===hv.BLENDMODE_MULTIPLY&&v.push("#define BLENDMULTIPLYMODE"),this.isLocal&&v.push("#define LOCAL"),this.useLogarithmicDepth&&v.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(v.push("#define BILLBOARD"),this.billboardMode){case hv.BILLBOARDMODE_Y:v.push("#define BILLBOARDY");break;case hv.BILLBOARDMODE_STRETCHED:v.push("#define BILLBOARDSTRETCHED");break;case hv.BILLBOARDMODE_ALL:v.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&v.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&v.push("#define ANIMATESHEET"),n&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),v.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(v,y,n){y.push(...Gv._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===hv.BILLBOARDMODE_STRETCHED)),v.push(...Gv._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),n.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Ev.e.PrepareUniforms(v,this._imageProcessingConfigurationDefines),Ev.e.PrepareSamplers(n,this._imageProcessingConfigurationDefines))}animate(){var v;let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(y?this.preWarmStepOffset:(null===(v=this._scene)||void 0===v?void 0:v.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(v,y){const n=this[y];if(!v||!v.length||n)return;const B=new Float32Array(this._rawTextureWidth);for(let J=0;J<this._rawTextureWidth;J++){const y=J/this._rawTextureWidth;D.GetCurrentGradient(y,v,((v,y,n)=>{B[J]=(0,a.k)(v.factor1,y.factor1,n)}))}this[y]=o.e.CreateRTexture(B,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[y].name=y.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const v=new Uint8Array(4*this._rawTextureWidth),y=b.h.pb[0];for(let n=0;n<this._rawTextureWidth;n++){const B=n/this._rawTextureWidth;D.GetCurrentGradient(B,this._colorGradients,((B,J,P)=>{b.e.LerpToRef(B.color1,J.color1,P,y),v[4*n]=255*y.r,v[4*n+1]=255*y.g,v[4*n+2]=255*y.b,v[4*n+3]=255*y.a}))}this._colorGradientsTexture=o.e.CreateRGBATexture(v,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(v,y){var n,J,P,b;const Y=this._getWrapper(v),l=Y.effect;this._engine.enableEffect(Y);const a=(null===(n=this._scene)||void 0===n?void 0:n.getViewMatrix())||B.d.IdentityReadOnly;if(l.setMatrix("view",a),l.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),l.setTexture("diffuseSampler",this.particleTexture),l.setVector2("translationPivot",this.translationPivot),l.setVector3("ug",this.ug),this.isLocal&&l.setMatrix("emitterWM",y),this._colorGradientsTexture?l.setTexture("colorGradientSampler",this._colorGradientsTexture):l.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const v=this.particleTexture.getBaseSize();l.setFloat3("sheetInfos",this.spriteCellWidth/v.width,this.spriteCellHeight/v.height,v.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const v=this._scene.activeCamera;l.setVector3("eyePosition",v.globalPosition)}const Z=l.defines;if(this._scene&&((0,yv.h)(l,this,this._scene),this.applyFog&&(0,nv.h)(this._scene,void 0,l)),Z.indexOf("#define BILLBOARDMODE_ALL")>=0){const v=a.clone();v.invert(),l.setMatrix("invView",v)}switch(this.useLogarithmicDepth&&this._scene&&(0,nv.m)(Z,l,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(l),v){case hv.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case hv.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case hv.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case hv.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,l,null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(l),null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(b=this._scene)&&void 0!==b&&b.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(v){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!v)if(this.j.position){v=this.j.getWorldMatrix()}else{const y=this.j;v=B.i.Matrix[0],B.d.TranslationToRef(y.x,y.y,y.z,v)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",v),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const y=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=y}render(){let v,y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!y&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let v=0;v<this.preWarmCycles;v++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const v=0|this._accumulatedCount;this._accumulatedCount-=v,this._currentActiveCount+=v}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){v=this.j.getWorldMatrix()}else{const y=this.j;v=B.i.Matrix[0],B.d.TranslationToRef(y.x,y.y,y.z,v)}const J=this._engine;this.updateInAnimate||this._update(v);let P=0;return y||n||(J.setState(!1),this.forceDepthWrite&&J.setDepthWrite(!0),P=this.blendMode===hv.BLENDMODE_MULTIPLYADD?this._render(hv.BLENDMODE_MULTIPLY,v)+this._render(hv.BLENDMODE_ADD,v):this._render(this.blendMode,v),this._engine.setAlphaMode(0)),P}rebuild(){const v=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(v,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,v()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const y in this._drawWrappers){this._drawWrappers[y].dispose()}if(this._drawWrappers={},this._scene){const v=this._scene.Ej.indexOf(this);v>-1&&this._scene.Ej.splice(v,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let y=0;y<this._renderVertexBuffers.length;++y){const v=this._renderVertexBuffers[y];for(const y in v)v[y].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),v&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),v&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.xj.notifyObservers(this),this.xj.clear()}clone(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B={...this._customWrappers};let J=null;const P=this._engine;if(P.createEffectForParticles&&null!=this.customShader){J=this.customShader;const v=J.shaderOptions.defines.length>0?J.shaderOptions.defines.join("\n"):"";B[0]=P.createEffectForParticles(J.shaderPath.fragmentElement,J.shaderOptions.uniforms,J.shaderOptions.samplers,v,void 0,void 0,void 0,this)}const b=this.serialize(n),Y=Gv.Parse(b,this._scene||this._engine,this._rootUrl);return Y.name=v,Y.customShader=J,Y._customWrappers=B,void 0===y&&(y=this.j),this.noiseTexture&&(Y.noiseTexture=this.noiseTexture.clone()),Y.j=y,Y}serialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y={};return hv._Serialize(y,this,v),y.activeParticleCount=this.activeParticleCount,y.randomTextureSize=this._randomTextureSize,y.customShader=this.customShader,y}static Parse(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4?arguments[4]:void 0;const P=v.name;let b,Y;y instanceof lv.c?b=y:(Y=y,b=Y.getEngine());const l=new Gv(P,{ob:J||v.ob,randomTextureSize:v.randomTextureSize},y,null,v.isAnimationSheetEnabled);if(l._rootUrl=n,v.customShader&&b.createEffectForParticles){const y=v.customShader,n=y.shaderOptions.defines.length>0?y.shaderOptions.defines.join("\n"):"",B=b.createEffectForParticles(y.shaderPath.fragmentElement,y.shaderOptions.uniforms,y.shaderOptions.samplers,n,void 0,void 0,void 0,l);l.setCustomEffect(B,0),l.customShader=y}return v.id&&(l.id=v.id),v.activeParticleCount&&(l.activeParticleCount=v.activeParticleCount),hv._Parse(v,l,y,n),v.preventAutoStart&&(l.preventAutoStart=v.preventAutoStart),B||l.preventAutoStart||l.start(),l}}var Rv=n(10791),Fv=n(11703),Sv=n(11043);class wv{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(v){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const y of this.systems)y.j=v;this._emitterNode=v}setEmitterAsSphere(v,y,n){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:v,renderingGroupId:y};const B=(0,Fv.c)("emitterSphere",{diameter:v.diameter,segments:v.segments},n);B.renderingGroupId=y;const J=new Sv.d("emitterSphereMaterial",n);J.emissiveColor=v.color,B.material=J;for(const P of this.systems)P.j=B;this._emitterNode=B}start(v){for(const y of this.systems)v&&(y.j=v),y.start()}dispose(){for(const v of this.systems)v.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y={systems:[]};for(const n of this.systems)y.systems.push(n.serialize(v));return this._emitterNode&&(y.j=this._emitterCreationOptions),y}static Parse(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;const J=new wv,P=this.BaseAssetsUrl+"/textures/";y=y||T.b.LastCreatedScene;for(const b of v.systems)J.systems.push(n?Gv.Parse(b,y,P,!0,B):hv.Parse(b,y,P,!0,B));if(v.j){const n=v.j.options;if("Sphere"===v.j.kind)J.setEmitterAsSphere({diameter:n.diameter,segments:n.segments,color:b.d.qh(n.color)},v.j.renderingGroupId,y)}return J}}wv.BaseAssetsUrl="https://assets.babylonjs.com/particles";var kv=n(10816);class Mv{static CreateDefault(v){let y,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,B=arguments.length>2?arguments[2]:void 0;return y=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Gv("default system",{ob:n},B):new hv("default system",n,B),y.j=v,y.particleTexture=new k.b("https://assets.babylonjs.com/textures/flare.png",y.va()),y.createConeEmitter(.1,Math.PI/4),y.color1=new b.e(1,1,1,1),y.color2=new b.e(1,1,1,1),y.colorDead=new b.e(1,1,1,0),y.minSize=.1,y.maxSize=.1,y.minEmitPower=2,y.maxEmitPower=2,y.updateSpeed=1/60,y.emitRate=30,y}static CreateAsync(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0;y||(y=T.b.LastCreatedScene);const J={};return y.addPendingData(J),new Promise(((P,b)=>{if(n&&!Gv.IsSupported)return y.removePendingData(J),b("Particle system with GPU is not supported.");Rv.g.LoadFile(`${Mv.BaseAssetsUrl}/systems/${v}.json`,(v=>{y.removePendingData(J);const b=JSON.parse(v.toString());return P(wv.Parse(b,y,n,B))}),void 0,void 0,void 0,(()=>(y.removePendingData(J),b(`An error occurred with the creation of your particle system. Check if your type '${v}' exists.`))))}))}static ExportSet(v){const y=new wv;for(const n of v)y.systems.push(n);return y}static ParseFromFileAsync(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",P=arguments.length>5?arguments[5]:void 0;return new Promise(((b,Y)=>{const l=new kv.c;l.addEventListener("readystatechange",(()=>{if(4==l.readyState)if(200==l.status){const y=JSON.parse(l.responseText);let Y;Y=B?Gv.Parse(y,n,J,!1,P):hv.Parse(y,n,J,!1,P),v&&(Y.name=v),b(Y)}else Y("Unable to load the particle system")})),l.open("GET",y),l.send()}))}static ParseFromSnippetAsync(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",J=arguments.length>4?arguments[4]:void 0;if("_BLANK"===v){const v=this.CreateDefault(null);return v.start(),Promise.resolve(v)}return new Promise(((P,b)=>{const Y=new kv.c;Y.addEventListener("readystatechange",(()=>{if(4==Y.readyState)if(200==Y.status){const b=JSON.parse(JSON.parse(Y.responseText).jsonPayload),l=JSON.parse(b.particleSystem);let a;a=n?Gv.Parse(l,y,B,!1,J):hv.Parse(l,y,B,!1,J),a.snippetId=v,P(a)}else b("Unable to load the snippet "+v)})),Y.open("GET",this.SnippetUrl+"/"+v.replace(/#/g,"/")),Y.send()}))}}Mv.BaseAssetsUrl=wv.BaseAssetsUrl,Mv.SnippetUrl="https://snippet.babylonjs.com",Mv.CreateFromSnippetAsync=Mv.ParseFromSnippetAsync;var Iv=n(11338),jv=n(11149),Vv=n(11712);(0,Vv.f)(jv.b.NAME_PARTICLESYSTEM,((v,y,n,B)=>{const J=(0,Vv.i)(jv.b.NAME_PARTICLESYSTEM);if(J&&void 0!==v.Ej&&null!==v.Ej)for(let P=0,b=v.Ej.length;P<b;P++){const b=v.Ej[P];n.Ej.push(J(b,y,B))}})),(0,Vv.b)(jv.b.NAME_PARTICLESYSTEM,((v,y,n)=>{if(v.activeParticleCount){return Gv.Parse(v,y,n)}return hv.Parse(v,y,n)})),lv.c.prototype.createEffectForParticles=function(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",P=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Z=[],x=[];const f=[];return l?l.fillUniformsAttributesAndSamplerNames(x,Z,f):(Z=hv._GetAttributeNamesOrOptions(),x=hv._GetEffectCreationOptions()),-1===J.indexOf(" BILLBOARD")&&(J+="\n#define BILLBOARD\n"),null!==l&&void 0!==l&&l.isAnimationSheetEnabled&&-1===J.indexOf(" ANIMATESHEET")&&(J+="\n#define ANIMATESHEET\n"),-1===B.indexOf("diffuseSampler")&&B.push("diffuseSampler"),this.createEffect({vertex:(null===l||void 0===l?void 0:l.vertexShaderName)??"particles",fragmentElement:v},Z,x.concat(y),f.concat(B),J,P,b,Y,void 0,a,(async()=>{0===a?await Promise.resolve().then(n.bind(n,11750)):await Promise.resolve().then(n.bind(n,11814))}))},Iv.d.prototype.getEmittedParticleSystems=function(){const v=[];for(let y=0;y<this.va().Ej.length;y++){const n=this.va().Ej[y];n.j===this&&v.push(n)}return v},Iv.d.prototype.getHierarchyEmittedParticleSystems=function(){const v=[],y=this.getDescendants();y.push(this);for(let n=0;n<this.va().Ej.length;n++){const B=this.va().Ej[n],J=B.j;J.position&&-1!==y.indexOf(J)&&v.push(B)}return v};n(11216),n(11233),n(11383);n(11362),n(11721),n(11390),n(11202),n(11398);n(11564);var pv;n(11728),n(11283);!function(v){v[v.Color=2]="Color",v[v.UV=1]="UV",v[v.Random=0]="Random",v[v.Stated=3]="Stated"}(pv||(pv={}));n(11737),n(11750),n(11762),n(11814)},11609:(v,y,n)=>{"use strict";n.d(y,{c:()=>i});var B=n(11050),J=n(11065),P=n(10795),b=n(11081),Y=n(10857),l=n(11055),a=n(11110),Z=n(10908),x=n(10849),f=n(10914),N=n(11615);x.c.prototype.setTextureFromPostProcess=function(v,y,n){var B;let J=null;y&&(y._forcedOutputTexture?J=y._forcedOutputTexture:y._textures.data[y._currentRenderTextureInd]&&(J=y._textures.data[y._currentRenderTextureInd])),this._bindTexture(v,(null===(B=J)||void 0===B?void 0:B.texture)??null,n)},x.c.prototype.setTextureFromPostProcessOutput=function(v,y,n){var B;this._bindTexture(v,(null===y||void 0===y||null===(B=y._outputTexture)||void 0===B?void 0:B.texture)??null,n)},Y.b.prototype.setTextureFromPostProcess=function(v,y){this._engine.setTextureFromPostProcess(this._samplers[v],y,v)},Y.b.prototype.setTextureFromPostProcessOutput=function(v,y){this._engine.setTextureFromPostProcessOutput(this._samplers[v],y,v)};class i{static get ForceGLSL(){return N.e.ForceGLSL}static set ForceGLSL(v){N.e.ForceGLSL=v}static RegisterShaderCodeProcessing(v,y){N.e.RegisterShaderCodeProcessing(v,y)}get name(){return this._effectWrapper.name}set name(v){this._effectWrapper.name=v}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(v){this._effectWrapper.alphaMode=v}get samples(){return this._samples}set samples(v){this._samples=Math.min(v,this._engine.getCaps().maxMSAASamples),this._textures.forEach((v=>{v.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(v){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),v&&(this._onActivateObserver=this.onActivateObservable.add(v))}set onSizeChanged(v){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(v)}set onApply(v){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(v)}set onBeforeRender(v){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(v)}set onAfterRender(v){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(v)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(v){this._forcedOutputTexture=v}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.Ae(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(v,y,n,B,Y,l){var a;let Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,x=arguments.length>7?arguments[7]:void 0,f=arguments.length>8?arguments[8]:void 0,g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",E=arguments.length>12?arguments[12]:void 0,W=arguments.length>13&&void 0!==arguments[13]&&arguments[13],s=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,C=arguments.length>15?arguments[15]:void 0,r=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.fj=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new J.e(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new b.j(1,1),this._texelSize=b.j.Zero(),this.onActivateObservable=new P.e,this.onSizeChangedObservable=new P.e,this.onApplyObservable=new P.e,this.onBeforeRenderObservable=new P.e,this.onAfterRenderObservable=new P.e;let u,O=1,d=null;if(n&&!Array.isArray(n)){const v=n;n=v.uniforms??null,B=v.samplers??null,O=v.size??1,l=v.camera??null,Z=v.samplingMode??1,x=v.Od,f=v.reusable,g=Array.isArray(v.defines)?v.defines.join("\n"):v.defines??null,c=v.textureType??0,h=v.vertexUrl??"postprocess",E=v.indexParameters,W=v.blockCompilation??!1,s=v.textureFormat??5,C=v.shaderLanguage??0,d=v.uniformBuffers??null,r=v.extraInitializations,u=v.effectWrapper}else Y&&(O="number"===typeof Y?Y:{width:Y.width,height:Y.height});const q=!!u;if(this._effectWrapper=u??new N.e({name:v,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:y,Od:x||(null===(a=l)||void 0===a?void 0:a.va().getEngine()),uniforms:n,samplers:B,uniformBuffers:d,defines:g,vertexUrl:h,indexParameters:E,blockCompilation:W,shaderLanguage:C,extraInitializations:r}),this.name=v,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=l?(this._camera=l,this._scene=l.va(),l.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):x&&(this._engine=x,this._engine.postProcesses.push(this)),this._options=O,this.renderTargetSamplingMode=Z||1,this._reusable=f||!1,this._textureType=c,this._textureFormat=s,this._shaderLanguage=C||0,this._samplers=B||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=y,this._vertexUrl=h,this._parameters=n||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=d||[],this._indexParameters=E,!q){this._webGPUReady=1===this._shaderLanguage;const v=[];this._gatherImports(this._engine.isWebGPU&&!i.ForceGLSL,v),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(W,g,r,v)}}_gatherImports(){let v=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?v.push(Promise.all([n.e(37).then(n.bind(n,13566))])):v.push(Promise.all([Promise.resolve().then(n.bind(n,11622))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(v){return this._disposeTextures(),this._shareOutputWithPostProcess=v,this}useOwnOutput(){0==this._textures.length&&(this._textures=new J.e(2)),this._shareOutputWithPostProcess=null}updateEffect(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3?arguments[3]:void 0,J=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0,b=arguments.length>6?arguments[6]:void 0,Y=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(v,y,n,B,J,P,b,Y),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let J=0;J<this._textureCache.length;J++)if(this._textureCache[J].texture.width===v.width&&this._textureCache[J].texture.height===v.height&&this._textureCache[J].postProcessChannel===n&&this._textureCache[J].texture._generateDepthBuffer===y.generateDepthBuffer&&this._textureCache[J].texture.samples===y.samples)return this._textureCache[J].texture;const B=this._engine.createRenderTargetTexture(v,y);return this._textureCache.push({texture:B,postProcessChannel:n,lastUsedRenderId:-1}),B}_flushTextureCache(){const v=this._renderId;for(let y=this._textureCache.length-1;y>=0;y--)if(v-this._textureCache[y].lastUsedRenderId>100){let v=!1;for(let n=0;n<this._textures.length;n++)if(this._textures.data[n]===this._textureCache[y].texture){v=!0;break}v||(this._textureCache[y].texture.dispose(),this._textureCache.splice(y,1))}}resize(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],J=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=v,this.height=y;let P=null;if(n)for(let l=0;l<n._postProcesses.length;l++)if(null!==n._postProcesses[l]){P=n._postProcesses[l];break}const b={width:this.width,height:this.height},Y={generateMipMaps:B,generateDepthBuffer:J||P===this,generateStencilBuffer:(J||P===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(b,Y,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(b,Y,1)),this._texelSize.Ae(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let v;if(this._shareOutputWithPostProcess)v=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)v=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let y;v=this.inputTexture;for(let n=0;n<this._textureCache.length;n++)if(this._textureCache[n].texture===v){y=this._textureCache[n];break}y&&(y.lastUsedRenderId=this._renderId)}return v}activate(v){var y,n;let B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,J=arguments.length>2?arguments[2]:void 0;const P=(v=v||this._camera).va(),b=P.getEngine(),Y=b.getCaps().maxTextureSize,l=(B?B.width:this._engine.getRenderWidth(!0))*this._options|0,a=(B?B.height:this._engine.getRenderHeight(!0))*this._options|0;let Z=this._options.width||l,x=this._options.height||a;const N=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let i=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const v=b.currentViewport;v&&(Z*=v.width,x*=v.height)}(N||this.alwaysForcePOT)&&(this._options.width||(Z=b.needPOTTextures?(0,f.g)(Z,Y,this.scaleMode):Z),this._options.height||(x=b.needPOTTextures?(0,f.g)(x,Y,this.scaleMode):x)),this.width===Z&&this.height===x&&(i=this._getTarget())||this.resize(Z,x,v,N,J),this._textures.forEach((v=>{v.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(v,this.samples)})),this._flushTextureCache(),this._renderId++}return i||(i=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.Ae(l/Z,a/x),this._engine.bindFramebuffer(i,0,l,a,this.forceFullscreenViewport)):(this._scaleRatio.Ae(1,1),this._engine.bindFramebuffer(i,0,void 0,void 0,this.forceFullscreenViewport)),null===(y=(n=this._engine)._debugInsertMarker)||void 0===y||y.call(n,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(v),this.fj&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:P.clearColor,P._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),i}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let v;var y;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),v=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(y=v)||void 0===y?void 0:y.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let v=this._textureCache.length-1;v>=0;v--)this._textureCache[v].texture.dispose();this._textureCache.length=0}setPrePassRenderer(v){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=v.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(v){let y;if(v=v||this._camera,this._disposeTextures(),this._scene&&(y=this._scene.postProcesses.indexOf(this),-1!==y&&this._scene.postProcesses.splice(y,1)),this._parentContainer){const v=this._parentContainer.postProcesses.indexOf(this);v>-1&&this._parentContainer.postProcesses.splice(v,1),this._parentContainer=null}if(y=this._engine.postProcesses.indexOf(this),-1!==y&&this._engine.postProcesses.splice(y,1),v){if(v.detachPostProcess(this),y=v._postProcesses.indexOf(this),0===y&&v._postProcesses.length>0){const v=this._camera._getFirstPostProcess();v&&v.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const v=a.d.Serialize(this),y=this.getCamera()||this._scene&&this._scene.activeCamera;return v.customType="BABYLON."+this.getClassName(),v.cameraId=y?y.id:null,v.reusable=this._reusable,v.textureType=this._textureType,v.fragmentUrl=this._fragmentUrl,v.parameters=this._parameters,v.samplers=this._samplers,v.uniformBuffers=this._uniformBuffers,v.options=this._options,v.defines=this._postProcessDefines,v.textureFormat=this._textureFormat,v.vertexUrl=this._vertexUrl,v.indexParameters=this._indexParameters,v}clone(){const v=this.serialize();v._engine=this._engine,v.cameraId=null;const y=i.Parse(v,this._scene,"");return y?(y.onActivateObservable=this.onActivateObservable.clone(),y.onSizeChangedObservable=this.onSizeChangedObservable.clone(),y.onApplyObservable=this.onApplyObservable.clone(),y.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),y.onAfterRenderObservable=this.onAfterRenderObservable.clone(),y._prePassEffectConfiguration=this._prePassEffectConfiguration,y):null}static Parse(v,y,n){const B=(0,Z.d)(v.customType);if(!B||!B._Parse)return null;const J=y?y.getCameraById(v.cameraId):null;return B._Parse(v,J,y,n)}static _Parse(v,y,n,B){return a.d.Parse((()=>new i(v.name,v.fragmentUrl,v.parameters,v.samplers,v.options,y,v.renderTargetSamplingMode,v._engine,v.reusable,v.defines,v.textureType,v.vertexUrl,v.indexParameters,!1,v.textureFormat)),v,n,B)}}(0,B.c)([(0,l.M)()],i.prototype,"uniqueId",void 0),(0,B.c)([(0,l.M)()],i.prototype,"name",null),(0,B.c)([(0,l.M)()],i.prototype,"width",void 0),(0,B.c)([(0,l.M)()],i.prototype,"height",void 0),(0,B.c)([(0,l.M)()],i.prototype,"renderTargetSamplingMode",void 0),(0,B.c)([(0,l.m)()],i.prototype,"clearColor",void 0),(0,B.c)([(0,l.M)()],i.prototype,"fj",void 0),(0,B.c)([(0,l.M)()],i.prototype,"forceAutoClearInAlphaMode",void 0),(0,B.c)([(0,l.M)()],i.prototype,"alphaMode",null),(0,B.c)([(0,l.M)()],i.prototype,"alphaConstants",void 0),(0,B.c)([(0,l.M)()],i.prototype,"enablePixelPerfectMode",void 0),(0,B.c)([(0,l.M)()],i.prototype,"forceFullscreenViewport",void 0),(0,B.c)([(0,l.M)()],i.prototype,"scaleMode",void 0),(0,B.c)([(0,l.M)()],i.prototype,"alwaysForcePOT",void 0),(0,B.c)([(0,l.M)("samples")],i.prototype,"_samples",void 0),(0,B.c)([(0,l.M)()],i.prototype,"adaptScaleToCurrentViewport",void 0),(0,Z.g)("BABYLON.PostProcess",i)},11133:(v,y,n)=>{"use strict";n.d(y,{c:()=>P});var B=n(11127),J=n(10795);class P{constructor(v){this._vertexBuffers={},this.onBeforeRenderObservable=new J.e,this._scene=v}_prepareBuffers(){if(this._vertexBuffers[B.i.PositionKind])return;const v=[];v.push(1,1),v.push(-1,1),v.push(-1,-1),v.push(1,-1),this._vertexBuffers[B.i.PositionKind]=new B.i(this._scene.getEngine(),v,B.i.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const v=[];v.push(0),v.push(1),v.push(2),v.push(0),v.push(2),v.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(v)}_rebuild(){const v=this._vertexBuffers[B.i.PositionKind];v&&(v._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this._scene.activeCamera;return!!n&&(y=y||n._postProcesses.filter((v=>null!=v)),!(!y||0===y.length||!this._scene.postProcessesEnabled)&&(y[0].activate(n,v,null!==y&&void 0!==y),!0))}directRender(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const b=this._scene.getEngine();for(let l=0;l<v.length;l++){var Y;if(l<v.length-1)v[l+1].activate(this._scene.activeCamera,null===y||void 0===y?void 0:y.texture);else y?b.bindFramebuffer(y,B,void 0,void 0,n,J):P||b.restoreDefaultFramebuffer(),null===(Y=b._debugInsertMarker)||void 0===Y||Y.call(b,`post process ${v[l].name} output`);const a=v[l],Z=a.apply();Z&&(a.onBeforeRenderObservable.notifyObservers(Z),this._prepareBuffers(),b.bindBuffers(this._vertexBuffers,this._indexBuffer,Z),b.drawElementsType(0,0,6),a.onAfterRenderObservable.notifyObservers(Z))}b.setDepthBuffer(!0),b.setDepthWrite(!0)}_finalizeFrame(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const P=this._scene.activeCamera;if(!P)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(B=B||P._postProcesses.filter((v=>null!=v))).length||!this._scene.postProcessesEnabled)return;const b=this._scene.getEngine();for(let l=0,a=B.length;l<a;l++){const Z=B[l];var Y;if(l<a-1)Z._outputTexture=B[l+1].activate(P,null===y||void 0===y?void 0:y.texture);else y?(b.bindFramebuffer(y,n,void 0,void 0,J),Z._outputTexture=y):(b.restoreDefaultFramebuffer(),Z._outputTexture=null),null===(Y=b._debugInsertMarker)||void 0===Y||Y.call(b,`post process ${B[l].name} output`);if(v)break;const x=Z.apply();x&&(Z.onBeforeRenderObservable.notifyObservers(x),this._prepareBuffers(),b.bindBuffers(this._vertexBuffers,this._indexBuffer,x),b.drawElementsType(0,0,6),Z.onAfterRenderObservable.notifyObservers(x))}b.setDepthBuffer(!0),b.setDepthWrite(!0),b.setAlphaMode(0)}dispose(){const v=this._vertexBuffers[B.i.PositionKind];v&&(v.dispose(),this._vertexBuffers[B.i.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11142:(v,y,n)=>{"use strict";n.d(y,{b:()=>Y});var B=n(11065),J=n(11081);class P{set opaqueSortCompareFn(v){this._opaqueSortCompareFn=v||P.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(v){this._alphaTestSortCompareFn=v||P.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(v){this._transparentSortCompareFn=v||P.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=v,this._opaqueSubMeshes=new B.e(256),this._transparentSubMeshes=new B.e(256),this._alphaTestSubMeshes=new B.e(256),this._depthOnlySubMeshes=new B.e(256),this._particleSystems=new B.e(256),this._spriteManagers=new B.e(256),this._empty=!0,this._edgesRenderers=new B.b(16),this._scene=y,this.opaqueSortCompareFn=n,this.alphaTestSortCompareFn=J,this.transparentSortCompareFn=P}render(v,y,n,B){if(v)return void v(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const J=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(J.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),J.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const P=J.getStencilBuffer();if(J.setStencilBuffer(!1),y&&this._renderSprites(),n&&this._renderParticles(B),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(J.setStencilBuffer(P),this._scene.useOrderIndependentTransparency){const v=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);v.length&&this._renderTransparent(v)}else this._renderTransparent(this._transparentSubMeshes);J.setAlphaMode(0)}if(J.setStencilBuffer(!1),this._edgesRenderers.length){for(let v=0;v<this._edgesRenderers.length;v++)this._edgesRenderers.data[v].render();J.setAlphaMode(0)}J.setStencilBuffer(P)}_renderOpaqueSorted(v){P._RenderSorted(v,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(v){P._RenderSorted(v,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(v){P._RenderSorted(v,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(v,y,n,B){let b,Y=0;const l=n?n.globalPosition:P._ZeroVector;if(B)for(;Y<v.length;Y++)b=v.data[Y],b._alphaIndex=b.getMesh().alphaIndex,b._distanceToCamera=J.n.Distance(b.getBoundingInfo().boundingSphere.centerWorld,l);const a=v.length===v.data.length?v.data:v.data.slice(0,v.length);y&&a.sort(y);const Z=a[0].getMesh().va();for(Y=0;Y<a.length;Y++)if(b=a[Y],!Z._activeMeshesFrozenButKeepClipping||b.isInFrustum(Z._frustumPlanes)){if(B){const v=b.Ha();if(v&&v.needDepthPrePass){const y=v.va().getEngine();y.setColorWrite(!1),y.setAlphaMode(0),b.render(!1),y.setColorWrite(!0)}}b.render(B)}}static defaultTransparentSortCompare(v,y){return v._alphaIndex>y._alphaIndex?1:v._alphaIndex<y._alphaIndex?-1:P.backToFrontSortCompare(v,y)}static backToFrontSortCompare(v,y){return v._distanceToCamera<y._distanceToCamera?1:v._distanceToCamera>y._distanceToCamera?-1:0}static frontToBackSortCompare(v,y){return v._distanceToCamera<y._distanceToCamera?-1:v._distanceToCamera>y._distanceToCamera?1:0}static PainterSortCompare(v,y){const n=v.getMesh(),B=y.getMesh();return n.material&&B.material?n.material.uniqueId-B.material.uniqueId:n.uniqueId-B.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(v,y,n){void 0===y&&(y=v.getMesh()),void 0===n&&(n=v.Ha()),null!==n&&void 0!==n&&(n.needAlphaBlendingForMesh(y)?this._transparentSubMeshes.push(v):n.needAlphaTesting()?(n.needDepthPrePass&&this._depthOnlySubMeshes.push(v),this._alphaTestSubMeshes.push(v)):(n.needDepthPrePass&&this._depthOnlySubMeshes.push(v),this._opaqueSubMeshes.push(v)),y._renderingGroup=this,y._edgesRenderer&&y.isEnabled()&&y.isVisible&&y._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(y._edgesRenderer),this._empty=!1)}dispatchSprites(v){this._spriteManagers.push(v),this._empty=!1}dispatchParticles(v){this._particleSystems.push(v),this._empty=!1}_renderParticles(v){if(0===this._particleSystems.length)return;const y=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let n=0;n<this._particleSystems.length;n++){const B=this._particleSystems.data[n];if(0===(y&&y.layerMask&B.layerMask))continue;const J=B.j;J.position&&v&&-1===v.indexOf(J)||this._scene._activeParticles.addCount(B.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const v=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let y=0;y<this._spriteManagers.length;y++){const n=this._spriteManagers.data[y];0!==(v&&v.layerMask&n.layerMask)&&n.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}P._ZeroVector=J.n.Zero();class b{}class Y{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(v){v!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=v,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const v of this._scene.meshes)if(v.Ag)for(const y of v.Ag)y._wasDispatched=!1;if(this._scene.spriteManagers)for(const v of this._scene.spriteManagers)v._wasDispatched=!1;for(const v of this._scene.Ej)v._wasDispatched=!1}constructor(v){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new b,this._maintainStateBetweenFrames=!1,this._scene=v;for(let y=Y.MIN_RENDERINGGROUPS;y<Y.MAX_RENDERINGGROUPS;y++)this._autoClearDepthStencil[y]={fj:!0,depth:!0,stencil:!0}}getRenderingGroup(v){const y=v||0;return this._prepareRenderingGroup(y),this._renderingGroups[y]}_clearDepthStencilBuffer(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,v,y),this._depthStencilBufferAlreadyCleaned=!0)}render(v,y,n,B){const J=this._renderingGroupInfo;if(J.$d=this._scene,J.camera=this._scene.activeCamera,this._scene.spriteManagers&&B)for(let P=0;P<this._scene.spriteManagers.length;P++){const v=this._scene.spriteManagers[P];this.dispatchSprites(v)}for(let P=Y.MIN_RENDERINGGROUPS;P<Y.MAX_RENDERINGGROUPS;P++){this._depthStencilBufferAlreadyCleaned=P===Y.MIN_RENDERINGGROUPS;const b=this._renderingGroups[P];if(!b||b._empty)continue;const l=1<<P;if(J.renderingGroupId=P,this._scene.onBeforeRenderingGroupObservable.notifyObservers(J,l),Y.AUTOCLEAR){const v=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(P):this._autoClearDepthStencil[P];v&&v.fj&&this._clearDepthStencilBuffer(v.depth,v.stencil)}for(const v of this._scene._beforeRenderingGroupDrawStage)v.action(P);b.render(v,B,n,y);for(const v of this._scene._afterRenderingGroupDrawStage)v.action(P);this._scene.onAfterRenderingGroupObservable.notifyObservers(J,l)}}reset(){if(!this.maintainStateBetweenFrames)for(let v=Y.MIN_RENDERINGGROUPS;v<Y.MAX_RENDERINGGROUPS;v++){const y=this._renderingGroups[v];y&&y.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let v=Y.MIN_RENDERINGGROUPS;v<Y.MAX_RENDERINGGROUPS;v++){const y=this._renderingGroups[v];y&&y.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let v=Y.MIN_RENDERINGGROUPS;v<Y.MAX_RENDERINGGROUPS;v++){const y=this._renderingGroups[v];y&&y.dispose()}}_prepareRenderingGroup(v){void 0===this._renderingGroups[v]&&(this._renderingGroups[v]=new P(v,this._scene,this._customOpaqueSortCompareFn[v],this._customAlphaTestSortCompareFn[v],this._customTransparentSortCompareFn[v]))}dispatchSprites(v){this.maintainStateBetweenFrames&&v._wasDispatched||(v._wasDispatched=!0,this.getRenderingGroup(v.renderingGroupId).dispatchSprites(v))}dispatchParticles(v){this.maintainStateBetweenFrames&&v._wasDispatched||(v._wasDispatched=!0,this.getRenderingGroup(v.renderingGroupId).dispatchParticles(v))}dispatch(v,y,n){void 0===y&&(y=v.getMesh()),this.maintainStateBetweenFrames&&v._wasDispatched||(v._wasDispatched=!0,this.getRenderingGroup(y.renderingGroupId).dispatch(v,y,n))}setRenderingOrder(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[v]=y,this._customAlphaTestSortCompareFn[v]=n,this._customTransparentSortCompareFn[v]=B,this._renderingGroups[v]){const y=this._renderingGroups[v];y.opaqueSortCompareFn=this._customOpaqueSortCompareFn[v],y.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[v],y.transparentSortCompareFn=this._customTransparentSortCompareFn[v]}}setRenderingAutoClearDepthStencil(v,y){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[v]={fj:y,depth:n,stencil:B}}getAutoClearDepthStencilSetup(v){return this._autoClearDepthStencil[v]}}Y.MAX_RENDERINGGROUPS=4,Y.MIN_RENDERINGGROUPS=0,Y.AUTOCLEAR=!0},11793:(v,y,n)=>{"use strict";const B="clipPlaneFragment",J="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";n(10866).b.IncludesShadersStoreWGSL[B]=J},11769:(v,y,n)=>{"use strict";const B="clipPlaneFragmentDeclaration",J="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";n(10866).b.IncludesShadersStoreWGSL[B]=J},11834:(v,y,n)=>{"use strict";const B="clipPlaneVertex",J="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";n(10866).b.IncludesShadersStoreWGSL[B]=J},11823:(v,y,n)=>{"use strict";const B="clipPlaneVertexDeclaration",J="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";n(10866).b.IncludesShadersStoreWGSL[B]=J},11806:(v,y,n)=>{"use strict";const B="fogFragment",J="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";n(10866).b.IncludesShadersStoreWGSL[B]=J},11786:(v,y,n)=>{"use strict";const B="fogFragmentDeclaration",J="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";n(10866).b.IncludesShadersStoreWGSL[B]=J},11842:(v,y,n)=>{"use strict";const B="fogVertex",J="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";n(10866).b.IncludesShadersStoreWGSL[B]=J},11825:(v,y,n)=>{"use strict";const B="fogVertexDeclaration",J="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";n(10866).b.IncludesShadersStoreWGSL[B]=J},11780:(v,y,n)=>{"use strict";const B="helperFunctions",J="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";n(10866).b.IncludesShadersStoreWGSL[B]=J},11772:(v,y,n)=>{"use strict";const B="imageProcessingDeclaration",J="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";n(10866).b.IncludesShadersStoreWGSL[B]=J},11782:(v,y,n)=>{"use strict";const B="imageProcessingFunctions",J="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";n(10866).b.IncludesShadersStoreWGSL[B]=J},11774:(v,y,n)=>{"use strict";const B="logDepthDeclaration",J="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";n(10866).b.IncludesShadersStoreWGSL[B]=J},11801:(v,y,n)=>{"use strict";const B="logDepthFragment",J="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";n(10866).b.IncludesShadersStoreWGSL[B]=J},11844:(v,y,n)=>{"use strict";const B="logDepthVertex",J="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";n(10866).b.IncludesShadersStoreWGSL[B]=J},11762:(v,y,n)=>{"use strict";n.r(y),n.d(y,{particlesPixelShaderWGSL:()=>b});var B=n(10866);n(11769),n(11772),n(11774),n(11780),n(11782),n(11786),n(11793),n(11801),n(11806);const J="particlesPixelShader",P="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";B.b.ShadersStoreWGSL[J]=P;const b={name:J,shader:P}},11814:(v,y,n)=>{"use strict";n.r(y),n.d(y,{particlesVertexShaderWGSL:()=>b});var B=n(10866);n(11823),n(11825),n(11774),n(11834),n(11842),n(11844);const J="particlesVertexShader",P="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";B.b.ShadersStoreWGSL[J]=P;const b={name:J,shader:P}},11656:(v,y,n)=>{"use strict";const B="clipPlaneFragment",J="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";n(10866).b.IncludesShadersStore[B]=J},11746:(v,y,n)=>{"use strict";const B="clipPlaneFragmentDeclaration",J="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";n(10866).b.IncludesShadersStore[B]=J},11682:(v,y,n)=>{"use strict";const B="clipPlaneVertex",J="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";n(10866).b.IncludesShadersStore[B]=J},11758:(v,y,n)=>{"use strict";const B="clipPlaneVertexDeclaration",J="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";n(10866).b.IncludesShadersStore[B]=J},11668:(v,y,n)=>{"use strict";const B="fogFragment",J="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";n(10866).b.IncludesShadersStore[B]=J},11654:(v,y,n)=>{"use strict";const B="fogFragmentDeclaration",J="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";n(10866).b.IncludesShadersStore[B]=J},11688:(v,y,n)=>{"use strict";const B="fogVertex",J="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";n(10866).b.IncludesShadersStore[B]=J},11676:(v,y,n)=>{"use strict";const B="fogVertexDeclaration",J="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";n(10866).b.IncludesShadersStore[B]=J},11641:(v,y,n)=>{"use strict";const B="helperFunctions",J="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";n(10866).b.IncludesShadersStore[B]=J},11636:(v,y,n)=>{"use strict";const B="imageProcessingDeclaration",J="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";n(10866).b.IncludesShadersStore[B]=J},11647:(v,y,n)=>{"use strict";const B="imageProcessingFunctions",J="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";n(10866).b.IncludesShadersStore[B]=J},11638:(v,y,n)=>{"use strict";const B="logDepthDeclaration",J="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";n(10866).b.IncludesShadersStore[B]=J},11661:(v,y,n)=>{"use strict";const B="logDepthFragment",J="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";n(10866).b.IncludesShadersStore[B]=J},11694:(v,y,n)=>{"use strict";const B="logDepthVertex",J="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";n(10866).b.IncludesShadersStore[B]=J},11737:(v,y,n)=>{"use strict";n.r(y),n.d(y,{particlesPixelShader:()=>b});var B=n(10866);n(11746),n(11636),n(11638),n(11641),n(11647),n(11654),n(11656),n(11661),n(11668);const J="particlesPixelShader",P="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";B.b.ShadersStore[J]=P;const b={name:J,shader:P}},11750:(v,y,n)=>{"use strict";n.r(y),n.d(y,{particlesVertexShader:()=>b});var B=n(10866);n(11758),n(11676),n(11638),n(11682),n(11688),n(11694);const J="particlesVertexShader",P="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";B.b.ShadersStore[J]=P;const b={name:J,shader:P}},11622:(v,y,n)=>{"use strict";n.r(y),n.d(y,{postprocessVertexShader:()=>P});const B="postprocessVertexShader",J="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";n(10866).b.ShadersStore[B]=J;const P={name:B,shader:J}},11166:(v,y,n)=>{"use strict";n.d(y,{b:()=>B});class B{}B._IsPickingAvailable=!1},11351:(v,y,n)=>{"use strict";n.d(y,{c:()=>x});var B=n(11050),J=n(11081),P=n(11055),b=n(10795),Y=n(10820),l=n(10811),a=n(11110);class Z{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new b.e,this._onClonedObservable=new b.e}}class x{static AddNodeConstructor(v,y){this._NodeConstructors[v]=y}static Construct(v,y,n,B){const J=this._NodeConstructors[v];return J?J(y,n,B):null}set accessibilityTag(v){this._accessibilityTag=v,this.onAccessibilityTagChangedObservable.notifyObservers(v)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(v){this._nodeDataStorage._doNotSerialize=v}u(){return this._nodeDataStorage._isDisposed}set parent(v){if(this._parentNode===v)return;const y=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const y=this._parentNode._children.indexOf(this);-1!==y&&this._parentNode._children.splice(y,1),v||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=v,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),y||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(v){v.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const v=this._scene.rootNodes,y=v.length-1;v[this._nodeDataStorage._sceneRootNodesIndex]=v[y],v[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(v){this._animationPropertiesOverride=v}getClassName(){return"Node"}set onDispose(v){this._onDisposeObserver&&this.xj.remove(this._onDisposeObserver),this._onDisposeObserver=this.xj.add(v)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new Z,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new b.e,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=J.d.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.xj=new b.e,this._onDisposeObserver=null,this._behaviors=new Array,this.name=v,this.id=v,this._scene=y||Y.b.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),n&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(v)||(v.init(),this._scene.isLoading&&!y?this._scene.onDataLoadedObservable.addOnce((()=>{v.attach(this)})):v.attach(this),this._behaviors.push(v)),this}removeBehavior(v){const y=this._behaviors.indexOf(v);return-1===y||(this._behaviors[y].detach(),this._behaviors.splice(y,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(v){for(const y of this._behaviors)if(y.name===v)return y;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.ak(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(v){!v&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(v){return this.parent?this.parent._getActionManagerForTrigger(v,!1):null}_updateCache(v){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}eh(v){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((v=>{v._syncParentEnabledState()}))}Nb(v){this._nodeDataStorage._isEnabled!==v&&(this._nodeDataStorage._isEnabled=v,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(v))}isDescendantOf(v){return!!this.parent&&(this.parent===v||this.parent.isDescendantOf(v))}_getDescendants(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;if(this._children)for(let B=0;B<this._children.length;B++){const J=this._children[B];n&&!n(J)||v.push(J),y||J._getDescendants(v,!1,n)}}getDescendants(v,y){const n=[];return this._getDescendants(n,v,y),n}getChildMeshes(v,y){const n=[];return this._getDescendants(n,v,(v=>(!y||y(v))&&void 0!==v.Ri)),n}getChildren(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(y,v)}_setReady(v){v!==this._nodeDataStorage._isReady&&(v?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(v){for(let y=0;y<this.animations.length;y++){const n=this.animations[y];if(n.name===v)return n}return null}createAnimationRange(v,y,n){if(!this._ranges[v]){this._ranges[v]=x._AnimationRangeFactory(v,y,n);for(let B=0,J=this.animations.length;B<J;B++)this.animations[B]&&this.animations[B].createRange(v,y,n)}}deleteAnimationRange(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let n=0,B=this.animations.length;n<B;n++)this.animations[n]&&this.animations[n].deleteRange(v,y);this._ranges[v]=null}getAnimationRange(v){return this._ranges[v]||null}clone(v,y,n){const B=a.d.Clone((()=>new x(v,this.va())),this);if(y&&(B.parent=y),!n){const y=this.getDescendants(!0);for(let n=0;n<y.length;n++){const J=y[n];J.clone(v+"."+J.name,B)}}return B}getAnimationRanges(){const v=[];let y;for(y in this._ranges)v.push(this._ranges[y]);return v}beginAnimation(v,y,n,B){const J=this.getAnimationRange(v);return J?this._scene.beginAnimation(this,J.from,J.to,y,n,B):null}serializeAnimationRanges(){const v=[];for(const y in this._ranges){const n=this._ranges[y];if(!n)continue;const B={};B.name=y,B.from=n.from,B.to=n.to,v.push(B)}return v}ak(v){return this._worldMatrix||(this._worldMatrix=J.d.Identity()),this._worldMatrix}dispose(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!v){const n=this.getDescendants(!0);for(const B of n)B.dispose(v,y)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.xj.notifyObservers(this),this.xj.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const n of this._behaviors)n.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(v,y,n){if(y.ranges)for(let B=0;B<y.ranges.length;B++){const n=y.ranges[B];v.createAnimationRange(n.name,n.from,n.to)}}getHierarchyBoundingVectors(){let v,y,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.ak(!0);const P=this;if(P.getBoundingInfo&&P.Ag){const n=P.getBoundingInfo();v=n.boundingBox.minimumWorld.clone(),y=n.boundingBox.maximumWorld.clone()}else v=new J.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),y=new J.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(n){const n=this.getDescendants(!1);for(const P of n){const n=P;if(n.ak(!0),B&&!B(n))continue;if(!n.getBoundingInfo||0===n.getTotalVertices())continue;const b=n.getBoundingInfo().boundingBox,Y=b.minimumWorld,l=b.maximumWorld;J.n.CheckExtends(Y,v,y),J.n.CheckExtends(l,v,y)}}return{min:v,max:y}}}x._AnimationRangeFactory=(v,y,n)=>{throw(0,l.e)("AnimationRange")},x._NodeConstructors={},(0,B.c)([(0,P.M)()],x.prototype,"name",void 0),(0,B.c)([(0,P.M)()],x.prototype,"id",void 0),(0,B.c)([(0,P.M)()],x.prototype,"uniqueId",void 0),(0,B.c)([(0,P.M)()],x.prototype,"state",void 0),(0,B.c)([(0,P.M)()],x.prototype,"metadata",void 0)},11070:(v,y,n)=>{"use strict";n.d(y,{e:()=>vv});var B=n(10791),J=n(10805),P=n(10795),b=n(11065);class Y{constructor(){this._count=0,this._data={}}p(v){this.clear(),v.forEach(((v,y)=>this.add(v,y)))}get(v){const y=this._data[v];if(void 0!==y)return y}getOrAddWithFactory(v,y){let n=this.get(v);return void 0!==n||(n=y(v),n&&this.add(v,n)),n}getOrAdd(v,y){const n=this.get(v);return void 0!==n?n:(this.add(v,y),y)}contains(v){return void 0!==this._data[v]}add(v,y){return void 0===this._data[v]&&(this._data[v]=y,++this._count,!0)}set(v,y){return void 0!==this._data[v]&&(this._data[v]=y,!0)}getAndRemove(v){const y=this.get(v);return void 0!==y?(delete this._data[v],--this._count,y):null}remove(v){return!!this.contains(v)&&(delete this._data[v],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(v){for(const y in this._data){v(y,this._data[y])}}first(v){for(const y in this._data){const n=v(y,this._data[y]);if(n)return n}return null}}var l=n(11076),a=n(11081),Z=n(11094),x=n(11120),f=n(11125);class N{constructor(v,y,n,B,J,P){this.source=v,this.pointerX=y,this.pointerY=n,this.meshUnderPointer=B,this.sourceEvent=J,this.additionalData=P}static CreateNew(v,y,n){const B=v.va();return new N(v,B.pointerX,B.pointerY,B.meshUnderPointer||v,y,n)}static CreateNewFromSprite(v,y,n,B){return new N(v,y.pointerX,y.pointerY,y.meshUnderPointer,n,B)}static CreateNewFromScene(v,y){return new N(null,v.pointerX,v.pointerY,v.meshUnderPointer,y)}static CreateNewFromPrimitive(v,y,n,B){return new N(v,y.x,y.y,null,n,B)}}var i=n(11133),g=n(11142),c=n(11149),h=n(10797),E=n(10820),W=n(10811),s=n(11151);class C{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const v in C.Triggers)if(Object.prototype.hasOwnProperty.call(C.Triggers,v))return!0;return!1}static get HasPickTriggers(){for(const v in C.Triggers)if(Object.prototype.hasOwnProperty.call(C.Triggers,v)){const y=parseInt(v);if(y>=1&&y<=7)return!0}return!1}static HasSpecificTrigger(v){for(const y in C.Triggers)if(Object.prototype.hasOwnProperty.call(C.Triggers,y)){if(parseInt(y)===v)return!0}return!1}}C.Triggers={};var r,u,O,d,q,L,t,G=n(11160);!function(v){v[v.Generic=0]="Generic",v[v.Keyboard=1]="Keyboard",v[v.Mouse=2]="Mouse",v[v.Touch=3]="Touch",v[v.DualShock=4]="DualShock",v[v.Xbox=5]="Xbox",v[v.Switch=6]="Switch",v[v.DualSense=7]="DualSense"}(r||(r={})),function(v){v[v.Horizontal=0]="Horizontal",v[v.Vertical=1]="Vertical",v[v.LeftClick=2]="LeftClick",v[v.MiddleClick=3]="MiddleClick",v[v.RightClick=4]="RightClick",v[v.BrowserBack=5]="BrowserBack",v[v.BrowserForward=6]="BrowserForward",v[v.MouseWheelX=7]="MouseWheelX",v[v.MouseWheelY=8]="MouseWheelY",v[v.MouseWheelZ=9]="MouseWheelZ",v[v.Move=12]="Move"}(u||(u={})),function(v){v[v.Horizontal=0]="Horizontal",v[v.Vertical=1]="Vertical",v[v.LeftClick=2]="LeftClick",v[v.MiddleClick=3]="MiddleClick",v[v.RightClick=4]="RightClick",v[v.BrowserBack=5]="BrowserBack",v[v.BrowserForward=6]="BrowserForward",v[v.MouseWheelX=7]="MouseWheelX",v[v.MouseWheelY=8]="MouseWheelY",v[v.MouseWheelZ=9]="MouseWheelZ",v[v.DeltaHorizontal=10]="DeltaHorizontal",v[v.DeltaVertical=11]="DeltaVertical"}(O||(O={})),function(v){v[v.Cross=0]="Cross",v[v.Circle=1]="Circle",v[v.Square=2]="Square",v[v.Triangle=3]="Triangle",v[v.L1=4]="L1",v[v.R1=5]="R1",v[v.L2=6]="L2",v[v.R2=7]="R2",v[v.Share=8]="Share",v[v.Options=9]="Options",v[v.L3=10]="L3",v[v.R3=11]="R3",v[v.DPadUp=12]="DPadUp",v[v.DPadDown=13]="DPadDown",v[v.DPadLeft=14]="DPadLeft",v[v.DPadRight=15]="DPadRight",v[v.Home=16]="Home",v[v.TouchPad=17]="TouchPad",v[v.LStickXAxis=18]="LStickXAxis",v[v.LStickYAxis=19]="LStickYAxis",v[v.RStickXAxis=20]="RStickXAxis",v[v.RStickYAxis=21]="RStickYAxis"}(d||(d={})),function(v){v[v.Cross=0]="Cross",v[v.Circle=1]="Circle",v[v.Square=2]="Square",v[v.Triangle=3]="Triangle",v[v.L1=4]="L1",v[v.R1=5]="R1",v[v.L2=6]="L2",v[v.R2=7]="R2",v[v.Create=8]="Create",v[v.Options=9]="Options",v[v.L3=10]="L3",v[v.R3=11]="R3",v[v.DPadUp=12]="DPadUp",v[v.DPadDown=13]="DPadDown",v[v.DPadLeft=14]="DPadLeft",v[v.DPadRight=15]="DPadRight",v[v.Home=16]="Home",v[v.TouchPad=17]="TouchPad",v[v.LStickXAxis=18]="LStickXAxis",v[v.LStickYAxis=19]="LStickYAxis",v[v.RStickXAxis=20]="RStickXAxis",v[v.RStickYAxis=21]="RStickYAxis"}(q||(q={})),function(v){v[v.A=0]="A",v[v.B=1]="B",v[v.X=2]="X",v[v.Y=3]="Y",v[v.LB=4]="LB",v[v.RB=5]="RB",v[v.LT=6]="LT",v[v.RT=7]="RT",v[v.Back=8]="Back",v[v.Start=9]="Start",v[v.LS=10]="LS",v[v.RS=11]="RS",v[v.DPadUp=12]="DPadUp",v[v.DPadDown=13]="DPadDown",v[v.DPadLeft=14]="DPadLeft",v[v.DPadRight=15]="DPadRight",v[v.Home=16]="Home",v[v.LStickXAxis=17]="LStickXAxis",v[v.LStickYAxis=18]="LStickYAxis",v[v.RStickXAxis=19]="RStickXAxis",v[v.RStickYAxis=20]="RStickYAxis"}(L||(L={})),function(v){v[v.B=0]="B",v[v.A=1]="A",v[v.Y=2]="Y",v[v.X=3]="X",v[v.L=4]="L",v[v.R=5]="R",v[v.ZL=6]="ZL",v[v.ZR=7]="ZR",v[v.Minus=8]="Minus",v[v.Plus=9]="Plus",v[v.LS=10]="LS",v[v.RS=11]="RS",v[v.DPadUp=12]="DPadUp",v[v.DPadDown=13]="DPadDown",v[v.DPadLeft=14]="DPadLeft",v[v.DPadRight=15]="DPadRight",v[v.Home=16]="Home",v[v.Capture=17]="Capture",v[v.LStickXAxis=18]="LStickXAxis",v[v.LStickYAxis=19]="LStickYAxis",v[v.RStickXAxis=20]="RStickXAxis",v[v.RStickYAxis=21]="RStickYAxis"}(t||(t={}));var R=n(11162);class F{static CreateDeviceEvent(v,y,n,B,J,P,b){switch(v){case r.Keyboard:return this._CreateKeyboardEvent(n,B,J,P);case r.Mouse:if(n===u.MouseWheelX||n===u.MouseWheelY||n===u.MouseWheelZ)return this._CreateWheelEvent(v,y,n,B,J,P);case r.Touch:return this._CreatePointerEvent(v,y,n,B,J,P,b);default:throw`Unable to generate event for device ${r[v]}`}}static _CreatePointerEvent(v,y,n,B,J,P,b){const Y=this._CreateMouseEvent(v,y,n,B,J,P);v===r.Mouse?(Y.deviceType=r.Mouse,Y.pointerId=1,Y.pointerType="mouse"):(Y.deviceType=r.Touch,Y.pointerId=b??y,Y.pointerType="touch");let l=0;return l+=J.pollInput(v,y,u.LeftClick),l+=2*J.pollInput(v,y,u.RightClick),l+=4*J.pollInput(v,y,u.MiddleClick),Y.buttons=l,n===u.Move?Y.type="pointermove":n>=u.LeftClick&&n<=u.RightClick&&(Y.type=1===B?"pointerdown":"pointerup",Y.button=n-2),Y}static _CreateWheelEvent(v,y,n,B,J,P){const b=this._CreateMouseEvent(v,y,n,B,J,P);switch(b.pointerId=1,b.type="wheel",b.deltaMode=R.e.DOM_DELTA_PIXEL,b.deltaX=0,b.deltaY=0,b.deltaZ=0,n){case u.MouseWheelX:b.deltaX=B;break;case u.MouseWheelY:b.deltaY=B;break;case u.MouseWheelZ:b.deltaZ=B}return b}static _CreateMouseEvent(v,y,n,B,J,P){const b=this._CreateEvent(P),Y=J.pollInput(v,y,u.Horizontal),l=J.pollInput(v,y,u.Vertical);return P?(b.movementX=0,b.movementY=0,b.offsetX=b.movementX-P.getBoundingClientRect().x,b.offsetY=b.movementY-P.getBoundingClientRect().y):(b.movementX=J.pollInput(v,y,10),b.movementY=J.pollInput(v,y,11),b.offsetX=0,b.offsetY=0),this._CheckNonCharacterKeys(b,J),b.clientX=Y,b.clientY=l,b.x=Y,b.y=l,b.deviceType=v,b.deviceSlot=y,b.inputIndex=n,b}static _CreateKeyboardEvent(v,y,n,B){const J=this._CreateEvent(B);return this._CheckNonCharacterKeys(J,n),J.deviceType=r.Keyboard,J.deviceSlot=0,J.inputIndex=v,J.type=1===y?"keydown":"keyup",J.key=String.fromCharCode(v),J.keyCode=v,J}static _CheckNonCharacterKeys(v,y){const n=y.isDeviceAvailable(r.Keyboard),B=n&&1===y.pollInput(r.Keyboard,0,18),J=n&&1===y.pollInput(r.Keyboard,0,17),P=n&&(1===y.pollInput(r.Keyboard,0,91)||1===y.pollInput(r.Keyboard,0,92)||1===y.pollInput(r.Keyboard,0,93)),b=n&&1===y.pollInput(r.Keyboard,0,16);v.altKey=B,v.ctrlKey=J,v.metaKey=P,v.shiftKey=b}static _CreateEvent(v){const y={preventDefault:()=>{}};return y.target=v,y}}class S{constructor(v,y,n){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(v,y,((v,y,B,J)=>{const P=F.CreateDeviceEvent(v,y,B,J,this);n(v,y,P)})):this._createDummyNativeInput()}pollInput(v,y,n){return this._nativeInput.pollInput(v,y,n)}isDeviceAvailable(v){return v===r.Mouse||v===r.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const w=Object.keys(u).length/2;class k{constructor(v,y,n,J){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=B.g.IsSafari(),this._usingMacOS=(0,h.h)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=v=>{},this._keyboardUpEvent=v=>{},this._keyboardBlurEvent=v=>{},this._pointerMoveEvent=v=>{},this._pointerDownEvent=v=>{},this._pointerUpEvent=v=>{},this._pointerCancelEvent=v=>{},this._pointerWheelEvent=v=>{},this._pointerBlurEvent=v=>{},this._pointerMacOSChromeOutEvent=v=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,h.h)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,h.h)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=v=>{},this._gamepadDisconnectedEvent=v=>{},this._eventPrefix=B.g.GetPointerPrefix(v),this._engine=v,this._onDeviceConnected=y,this._onDeviceDisconnected=n,this._onInputChanged=J,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(v,y,n){const J=this._inputs[v][y];if(!J)throw`Unable to find device ${r[v]}`;v>=r.DualShock&&v<=r.DualSense&&this._updateDevice(v,y,n);const P=J[n];if(void 0===P)throw`Unable to find input ${n} for device ${r[v]} in slot ${y}`;return n===u.Move&&B.g.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),P}isDeviceAvailable(v){return void 0!==this._inputs[v]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const v=null===this||void 0===this?void 0:this._engine.getInputElement();if(v&&(!this._eventsAttached||this._elementToAttachTo!==v)){if(this._disableEvents(),this._inputs)for(const v of this._inputs)if(v)for(const y in v){const n=v[+y];if(n)for(let v=0;v<n.length;v++)n[v]=0}this._elementToAttachTo=v,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const v=navigator.getGamepads();for(const y of v)y&&this._addGamePad(y)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(r.Mouse,0,0,0)}_addGamePad(v){const y=this._getGamepadDeviceType(v.id),n=v.index;this._gamepads=this._gamepads||new Array(v.index+1),this._registerDevice(y,n,v.buttons.length+v.axes.length),this._gamepads[n]=y}_addPointerDevice(v,y,n,B){this._pointerActive||(this._pointerActive=!0),this._registerDevice(v,y,w);const J=this._inputs[v][y];J[0]=n,J[1]=B}_registerDevice(v,y,n){if(void 0===y)throw`Unable to register device ${r[v]} to undefined slot.`;if(this._inputs[v]||(this._inputs[v]={}),!this._inputs[v][y]){const B=new Array(n);B.fill(0),this._inputs[v][y]=B,this._onDeviceConnected(v,y)}}_unregisterDevice(v,y){this._inputs[v][y]&&(delete this._inputs[v][y],this._onDeviceDisconnected(v,y))}_handleKeyActions(){this._keyboardDownEvent=v=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(r.Keyboard,0,255));const y=this._inputs[r.Keyboard][0];if(y){y[v.keyCode]=1;const n=v;n.inputIndex=v.keyCode,this._usingMacOS&&v.metaKey&&"Meta"!==v.key&&(this._metaKeys.includes(v.keyCode)||this._metaKeys.push(v.keyCode)),this._onInputChanged(r.Keyboard,0,n)}},this._keyboardUpEvent=v=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(r.Keyboard,0,255));const y=this._inputs[r.Keyboard][0];if(y){y[v.keyCode]=0;const n=v;if(n.inputIndex=v.keyCode,this._usingMacOS&&"Meta"===v.key&&this._metaKeys.length>0){for(const v of this._metaKeys){const n=F.CreateDeviceEvent(r.Keyboard,0,v,0,this,this._elementToAttachTo);y[v]=0,this._onInputChanged(r.Keyboard,0,n)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(r.Keyboard,0,n)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const v=this._inputs[r.Keyboard][0];for(let y=0;y<v.length;y++)if(0!==v[y]){v[y]=0;const n=F.CreateDeviceEvent(r.Keyboard,0,y,0,this,this._elementToAttachTo);this._onInputChanged(r.Keyboard,0,n)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,h.h)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let B=0;B<this._maxTouchPoints;B++)this._activeTouchIds[B]=-1;this._pointerMoveEvent=v=>{const y=this._getPointerType(v);let n=y===r.Mouse?0:this._activeTouchIds.indexOf(v.pointerId);if(y===r.Touch&&-1===n){const J=this._activeTouchIds.indexOf(-1);if(!(J>=0))return void B.g.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);n=J,this._activeTouchIds[J]=v.pointerId,this._onDeviceConnected(y,n)}this._inputs[y]||(this._inputs[y]={}),this._inputs[y][n]||this._addPointerDevice(y,n,v.clientX,v.clientY);const J=this._inputs[y][n];if(J){const B=v;B.inputIndex=u.Move,J[u.Horizontal]=v.clientX,J[u.Vertical]=v.clientY,y===r.Touch&&0===J[u.LeftClick]&&(J[u.LeftClick]=1),void 0===v.pointerId&&(v.pointerId=this._mouseId),this._onInputChanged(y,n,B),this._usingSafari||-1===v.button||(B.inputIndex=v.button+2,J[v.button+2]=J[v.button+2]?0:1,this._onInputChanged(y,n,B))}},this._pointerDownEvent=v=>{const y=this._getPointerType(v);let n=y===r.Mouse?0:v.pointerId;if(y===r.Touch){let y=this._activeTouchIds.indexOf(v.pointerId);if(-1===y&&(y=this._activeTouchIds.indexOf(-1)),!(y>=0))return void B.g.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);n=y,this._activeTouchIds[y]=v.pointerId}this._inputs[y]||(this._inputs[y]={}),this._inputs[y][n]?y===r.Touch&&this._onDeviceConnected(y,n):this._addPointerDevice(y,n,v.clientX,v.clientY);const J=this._inputs[y][n];if(J){const B=J[u.Horizontal],b=J[u.Vertical];if(y===r.Mouse){if(void 0===v.pointerId&&(v.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(P){}}else if(v.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(v.pointerId)}catch(P){}J[u.Horizontal]=v.clientX,J[u.Vertical]=v.clientY,J[v.button+2]=1;const Y=v;Y.inputIndex=v.button+2,this._onInputChanged(y,n,Y),B===v.clientX&&b===v.clientY||(Y.inputIndex=u.Move,this._onInputChanged(y,n,Y))}},this._pointerUpEvent=v=>{var y;const n=this._getPointerType(v),B=n===r.Mouse?0:this._activeTouchIds.indexOf(v.pointerId);if(n===r.Touch){if(-1===B)return;this._activeTouchIds[B]=-1}const J=null===(y=this._inputs[n])||void 0===y?void 0:y[B];if(J&&0!==J[v.button+2]){var P,b,Y,l;const y=J[u.Horizontal],a=J[u.Vertical];J[u.Horizontal]=v.clientX,J[u.Vertical]=v.clientY,J[v.button+2]=0;const Z=v;void 0===v.pointerId&&(v.pointerId=this._mouseId),y===v.clientX&&a===v.clientY||(Z.inputIndex=u.Move,this._onInputChanged(n,B,Z)),Z.inputIndex=v.button+2,n===r.Mouse&&this._mouseId>=0&&null!==(P=(b=this._elementToAttachTo).hasPointerCapture)&&void 0!==P&&P.call(b,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):v.pointerId&&null!==(Y=(l=this._elementToAttachTo).hasPointerCapture)&&void 0!==Y&&Y.call(l,v.pointerId)&&this._elementToAttachTo.releasePointerCapture(v.pointerId),this._onInputChanged(n,B,Z),n===r.Touch&&this._onDeviceDisconnected(n,B)}},this._pointerCancelEvent=v=>{if("mouse"===v.pointerType){var y,n;const v=this._inputs[r.Mouse][0];this._mouseId>=0&&null!==(y=(n=this._elementToAttachTo).hasPointerCapture)&&void 0!==y&&y.call(n,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let y=u.LeftClick;y<=u.BrowserForward;y++)if(1===v[y]){v[y]=0;const n=F.CreateDeviceEvent(r.Mouse,0,y,0,this,this._elementToAttachTo);this._onInputChanged(r.Mouse,0,n)}}else{var B,J;const y=this._activeTouchIds.indexOf(v.pointerId);if(-1===y)return;null!==(B=(J=this._elementToAttachTo).hasPointerCapture)&&void 0!==B&&B.call(J,v.pointerId)&&this._elementToAttachTo.releasePointerCapture(v.pointerId),this._inputs[r.Touch][y][u.LeftClick]=0;const n=F.CreateDeviceEvent(r.Touch,y,u.LeftClick,0,this,this._elementToAttachTo,v.pointerId);this._onInputChanged(r.Touch,y,n),this._activeTouchIds[y]=-1,this._onDeviceDisconnected(r.Touch,y)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let v=!1;const y=function(){};try{const n=Object.defineProperty({},"passive",{get:function(){v=!0}});this._elementToAttachTo.addEventListener("test",y,n),this._elementToAttachTo.removeEventListener("test",y,n)}catch(n){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(r.Mouse)){var v,y;const n=this._inputs[r.Mouse][0];this._mouseId>=0&&null!==(v=(y=this._elementToAttachTo).hasPointerCapture)&&void 0!==v&&v.call(y,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let v=u.LeftClick;v<=u.BrowserForward;v++)if(1===n[v]){n[v]=0;const y=F.CreateDeviceEvent(r.Mouse,0,v,0,this,this._elementToAttachTo);this._onInputChanged(r.Mouse,0,y)}}if(this.isDeviceAvailable(r.Touch)){const v=this._inputs[r.Touch];for(let y=0;y<this._activeTouchIds.length;y++){var n,B,J;const P=this._activeTouchIds[y];if(null!==(n=(B=this._elementToAttachTo).hasPointerCapture)&&void 0!==n&&n.call(B,P)&&this._elementToAttachTo.releasePointerCapture(P),-1!==P&&1===(null===(J=v[y])||void 0===J?void 0:J[u.LeftClick])){v[y][u.LeftClick]=0;const n=F.CreateDeviceEvent(r.Touch,y,u.LeftClick,0,this,this._elementToAttachTo,P);this._onInputChanged(r.Touch,y,n),this._activeTouchIds[y]=-1,this._onDeviceDisconnected(r.Touch,y)}}}},this._pointerWheelEvent=v=>{const y=r.Mouse;this._inputs[y]||(this._inputs[y]=[]),this._inputs[y][0]||(this._pointerActive=!0,this._registerDevice(y,0,w));const n=this._inputs[y][0];if(n){n[u.MouseWheelX]=v.deltaX||0,n[u.MouseWheelY]=v.deltaY||v.wheelDelta||0,n[u.MouseWheelZ]=v.deltaZ||0;const B=v;void 0===v.pointerId&&(v.pointerId=this._mouseId),0!==n[u.MouseWheelX]&&(B.inputIndex=u.MouseWheelX,this._onInputChanged(y,0,B)),0!==n[u.MouseWheelY]&&(B.inputIndex=u.MouseWheelY,this._onInputChanged(y,0,B)),0!==n[u.MouseWheelZ]&&(B.inputIndex=u.MouseWheelZ,this._onInputChanged(y,0,B))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=v=>{v.buttons>1&&this._pointerCancelEvent(v)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!v&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(r.Mouse)){const v=this._inputs[r.Mouse][0];v[u.MouseWheelX]=0,v[u.MouseWheelY]=0,v[u.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=v=>{this._addGamePad(v.gamepad)},this._gamepadDisconnectedEvent=v=>{if(this._gamepads){const y=this._getGamepadDeviceType(v.gamepad.id),n=v.gamepad.index;this._unregisterDevice(y,n),delete this._gamepads[n]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(v,y,n){const B=navigator.getGamepads()[y];if(B&&v===this._gamepads[y]){const J=this._inputs[v][y];n>=B.buttons.length?J[n]=B.axes[n-B.buttons.length].valueOf():J[n]=B.buttons[n].value}}_getGamepadDeviceType(v){return-1!==v.indexOf("054c")?-1!==v.indexOf("0ce6")?r.DualSense:r.DualShock:-1!==v.indexOf("Xbox One")||-1!==v.search("Xbox 360")||-1!==v.search("xinput")?r.Xbox:-1!==v.indexOf("057e")?r.Switch:r.Generic}_getPointerType(v){let y=r.Mouse;return("touch"===v.pointerType||"pen"===v.pointerType||v.touches)&&(y=r.Touch),y}}class M{constructor(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=y,this.deviceSlot=n,this.onInputChangedObservable=new P.e,this._deviceInputSystem=v}getInput(v){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,v)}}class I{constructor(v){this._registeredManagers=new Array,this._refCount=0,this.registerManager=v=>{for(let y=0;y<this._devices.length;y++){const n=this._devices[y];for(const B in n){const n=+B;v._addDevice(new M(this._deviceInputSystem,y,n))}}this._registeredManagers.push(v)},this.unregisterManager=v=>{const y=this._registeredManagers.indexOf(v);y>-1&&this._registeredManagers.splice(y,1)};const y=Object.keys(r).length/2;this._devices=new Array(y);const n=(v,y)=>{this._devices[v]||(this._devices[v]=new Array),this._devices[v][y]||(this._devices[v][y]=y);for(const n of this._registeredManagers){const B=new M(this._deviceInputSystem,v,y);n._addDevice(B)}},B=(v,y)=>{var n;null!==(n=this._devices[v])&&void 0!==n&&n[y]&&delete this._devices[v][y];for(const B of this._registeredManagers)B._removeDevice(v,y)},J=(v,y,n)=>{if(n)for(const B of this._registeredManagers)B._onInputChanged(v,y,n)};"undefined"!==typeof _native?this._deviceInputSystem=new S(n,B,J):this._deviceInputSystem=new k(v,n,B,J)}dispose(){this._deviceInputSystem.dispose()}}class j{getDeviceSource(v,y){if(void 0===y){if(void 0===this._firstDevice[v])return null;y=this._firstDevice[v]}return this._devices[v]&&void 0!==this._devices[v][y]?this._devices[v][y]:null}getDeviceSources(v){return this._devices[v]?this._devices[v].filter((v=>!!v)):[]}constructor(v){const y=Object.keys(r).length/2;this._devices=new Array(y),this._firstDevice=new Array(y),this._engine=v,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new I(v)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new P.e((v=>{for(const y of this._devices)if(y)for(const n of y)n&&this.onDeviceConnectedObservable.notifyObserver(v,n)})),this.onDeviceDisconnectedObservable=new P.e,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=v.xj.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.xj.remove(this._onDisposeObserver)}_addDevice(v){this._devices[v.deviceType]||(this._devices[v.deviceType]=new Array),this._devices[v.deviceType][v.deviceSlot]||(this._devices[v.deviceType][v.deviceSlot]=v,this._updateFirstDevices(v.deviceType)),this.onDeviceConnectedObservable.notifyObservers(v)}_removeDevice(v,y){var n,B;const J=null===(n=this._devices[v])||void 0===n?void 0:n[y];this.onDeviceDisconnectedObservable.notifyObservers(J),null!==(B=this._devices[v])&&void 0!==B&&B[y]&&delete this._devices[v][y],this._updateFirstDevices(v)}_onInputChanged(v,y,n){var B,J;null===(B=this._devices[v])||void 0===B||null===(J=B[y])||void 0===J||J.onInputChangedObservable.notifyObservers(n)}_updateFirstDevices(v){switch(v){case r.Keyboard:case r.Mouse:this._firstDevice[v]=0;break;case r.Touch:case r.DualSense:case r.DualShock:case r.Xbox:case r.Switch:case r.Generic:{delete this._firstDevice[v];const y=this._devices[v];if(y)for(let n=0;n<y.length;n++)if(y[n]){this._firstDevice[v]=n;break}break}}}}var V=n(11166);class p{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(v){this._singleClick=v}set doubleClick(v){this._doubleClick=v}set hasSwiped(v){this._hasSwiped=v}set ignore(v){this._ignore=v}}class H{constructor(v){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new a.j(0,0),this._previousStartingPointerPosition=new a.j(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=v||E.b.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(v){return this._meshUnderPointerId[v]||null}get unTranslatedPointer(){return new a.j(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(v){this._pointerX=v}get pointerY(){return this._pointerY}set pointerY(v){this._pointerY=v}_updatePointerPosition(v){const y=this._scene.getEngine().getInputElementClientRect();y&&(this._pointerX=v.clientX-y.left,this._pointerY=v.clientY-y.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(v,y){const n=this._scene,B=n.getEngine(),J=B.getInputElement();J&&(J.tabIndex=B.canvasTabIndex,n.doNotHandleCursors||(J.style.cursor=n.defaultCursor)),this._setCursorAndPointerOverMesh(v,y,n);for(const l of n._pointerMoveStage){var P;const n=!(null===(P=v=v||this._pickMove(y))||void 0===P||!P.pickedMesh);v=l.action(this._unTranslatedPointerX,this._unTranslatedPointerY,v,n,J)}const b=y.inputIndex>=u.MouseWheelX&&y.inputIndex<=u.MouseWheelZ?s.d.POINTERWHEEL:s.d.POINTERMOVE;let Y;n.onPointerMove&&(v=v||this._pickMove(y),n.onPointerMove(y,v,b)),v?(Y=new s.i(b,y,v),this._setRayOnPointerInfo(v,y)):(Y=new s.i(b,y,null,this),this._movePointerInfo=Y),n.onPointerObservable.hasObservers()&&n.onPointerObservable.notifyObservers(Y,b)}_setRayOnPointerInfo(v,y){const n=this._scene;v&&V.b._IsPickingAvailable&&(v.ray||(v.ray=n.createPickingRay(y.offsetX,y.offsetY,a.d.Identity(),n.activeCamera)))}_addCameraPointerObserver(v,y){return this._cameraObserverCount++,this._scene.onPointerObservable.add(v,y)}_removeCameraPointerObserver(v){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(v)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(v,y,n){const B=this._scene,J=new s.e(n,y,this._unTranslatedPointerX,this._unTranslatedPointerY);return v&&(J.originalPickingInfo=v,J.ray=v.ray,"xr-near"===y.pointerType&&v.originMesh&&(J.nearInteractionPickingInfo=v)),B.onPrePointerObservable.notifyObservers(J,n),!!J.skipOnPointerObservable}_pickMove(v){const y=this._scene,n=y.nd(this._unTranslatedPointerX,this._unTranslatedPointerY,y.pointerMovePredicate,y.pointerMoveFastCheck,y.cameraToUseForPointers,y.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(n,v,y),n}_setCursorAndPointerOverMesh(v,y,n){const B=n.getEngine().getInputElement();if(null!==v&&void 0!==v&&v.pickedMesh){if(this.setPointerOverMesh(v.pickedMesh,y.pointerId,v,y),!n.doNotHandleCursors&&B&&this._pointerOverMesh){const v=this._pointerOverMesh._getActionManagerForTrigger();v&&v.hasPointerTriggers&&(B.style.cursor=v.hoverCursor||n.hoverCursor)}}else this.setPointerOverMesh(null,y.pointerId,v,y)}simulatePointerMove(v,y){const n=new PointerEvent("pointermove",y);n.inputIndex=u.Move,this._checkPrePointerObservable(v,n,s.d.POINTERMOVE)||this._processPointerMove(v,n)}simulatePointerDown(v,y){const n=new PointerEvent("pointerdown",y);n.inputIndex=n.button+2,this._checkPrePointerObservable(v,n,s.d.POINTERDOWN)||this._processPointerDown(v,n)}_processPointerDown(v,y){var n;const B=this._scene;if(null!==(n=v)&&void 0!==n&&n.pickedMesh){this._pickedDownMesh=v.pickedMesh;const n=v.pickedMesh._getActionManagerForTrigger();if(n){if(n.hasPickTriggers)switch(n.processTrigger(5,N.CreateNew(v.pickedMesh,y,v)),y.button){case 0:n.processTrigger(2,N.CreateNew(v.pickedMesh,y,v));break;case 1:n.processTrigger(4,N.CreateNew(v.pickedMesh,y,v));break;case 2:n.processTrigger(3,N.CreateNew(v.pickedMesh,y,v))}n.hasSpecificTrigger(8)&&window.setTimeout((()=>{const v=B.nd(this._unTranslatedPointerX,this._unTranslatedPointerY,(v=>v.Kb&&v.isVisible&&v.isReady()&&v.actionManager&&v.actionManager.hasSpecificTrigger(8)&&v===this._pickedDownMesh),!1,B.cameraToUseForPointers);null!==v&&void 0!==v&&v.pickedMesh&&n&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>H.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,n.processTrigger(8,N.CreateNew(v.pickedMesh,y)))}),H.LongPressDelay)}}else for(const b of B._pointerDownStage)v=b.action(this._unTranslatedPointerX,this._unTranslatedPointerY,v,y,!1);let J;const P=s.d.POINTERDOWN;v?(B.onPointerDown&&B.onPointerDown(y,v,P),J=new s.i(P,y,v),this._setRayOnPointerInfo(v,y)):J=new s.i(P,y,null,this),B.onPointerObservable.hasObservers()&&B.onPointerObservable.notifyObservers(J,P)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(v,y,n){const B=new PointerEvent("pointerup",y);B.inputIndex=u.Move;const J=new p;n?J.doubleClick=!0:J.singleClick=!0,this._checkPrePointerObservable(v,B,s.d.POINTERUP)||this._processPointerUp(v,B,J)}_processPointerUp(v,y,n){var B;const J=this._scene;if(null!==(B=v)&&void 0!==B&&B.pickedMesh){if(this._pickedUpMesh=v.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(J.onPointerPick&&J.onPointerPick(y,v),n.singleClick&&!n.ignore&&J.onPointerObservable.observers.length>this._cameraObserverCount)){const n=s.d.POINTERPICK,B=new s.i(n,y,v);this._setRayOnPointerInfo(v,y),J.onPointerObservable.notifyObservers(B,n)}const B=v.pickedMesh._getActionManagerForTrigger();if(B&&!n.ignore){B.processTrigger(7,N.CreateNew(v.pickedMesh,y,v)),!n.hasSwiped&&n.singleClick&&B.processTrigger(1,N.CreateNew(v.pickedMesh,y,v));const J=v.pickedMesh._getActionManagerForTrigger(6);n.doubleClick&&J&&J.processTrigger(6,N.CreateNew(v.pickedMesh,y,v))}}else if(!n.ignore)for(const P of J._pointerUpStage)v=P.action(this._unTranslatedPointerX,this._unTranslatedPointerY,v,y,n.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const v=this._pickedDownMesh._getActionManagerForTrigger(16);v&&v.processTrigger(16,N.CreateNew(this._pickedDownMesh,y))}if(!n.ignore){const B=new s.i(s.d.POINTERUP,y,v);if(this._setRayOnPointerInfo(v,y),J.onPointerObservable.notifyObservers(B,s.d.POINTERUP),J.onPointerUp&&J.onPointerUp(y,v,s.d.POINTERUP),!n.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let B=0;if(n.singleClick?B=s.d.POINTERTAP:n.doubleClick&&(B=s.d.POINTERDOUBLETAP),B){const n=new s.i(B,y,v);J.onPointerObservable.hasObservers()&&J.onPointerObservable.hasSpecificMask(B)&&J.onPointerObservable.notifyObservers(n,B)}}}}isPointerCaptured(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[v]}attachControl(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const J=this._scene,P=J.getEngine();B||(B=P.getInputElement()),this._alreadyAttached&&this.ej(),B&&(this._alreadyAttachedTo=B),this._deviceSourceManager=new j(P),this._initActionManager=v=>{if(!this._meshPickProceed){const y=J.skipPointerUpPicking||0===J._registeredActions&&!this._checkForPicking()&&!J.onPointerUp?null:J.nd(this._unTranslatedPointerX,this._unTranslatedPointerY,J.pointerUpPredicate,J.pointerUpFastCheck,J.cameraToUseForPointers,J.pointerUpTrianglePredicate);this._currentPickResult=y,y&&(v=y.hit&&y.pickedMesh?y.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return v},this._delayedSimpleClick=(v,y,n)=>{if((Date.now()-this._previousStartingPointerTime>H.DoubleClickDelay&&!this._doubleClickOccured||v!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,y.singleClick=!0,y.ignore=!1,this._delayedClicks[v])){const y=this._delayedClicks[v].evt,n=s.d.POINTERTAP,B=new s.i(n,y,this._currentPickResult);J.onPointerObservable.hasObservers()&&J.onPointerObservable.hasSpecificMask(n)&&J.onPointerObservable.notifyObservers(B,n),this._delayedClicks[v]=null}},this._initClickEvent=(v,y,n,B)=>{const J=new p;this._currentPickResult=null;let P=null,b=v.hasSpecificMask(s.d.POINTERPICK)||y.hasSpecificMask(s.d.POINTERPICK)||v.hasSpecificMask(s.d.POINTERTAP)||y.hasSpecificMask(s.d.POINTERTAP)||v.hasSpecificMask(s.d.POINTERDOUBLETAP)||y.hasSpecificMask(s.d.POINTERDOUBLETAP);!b&&C&&(P=this._initActionManager(P,J),P&&(b=P.hasPickTriggers));let Y=!1;if(b){const b=n.button;if(J.hasSwiped=this._isPointerSwiping(),!J.hasSwiped){let Z=!H.ExclusiveDoubleClickMode;if(Z||(Z=!v.hasSpecificMask(s.d.POINTERDOUBLETAP)&&!y.hasSpecificMask(s.d.POINTERDOUBLETAP),Z&&!C.HasSpecificTrigger(6)&&(P=this._initActionManager(P,J),P&&(Z=!P.hasSpecificTrigger(6)))),Z)(Date.now()-this._previousStartingPointerTime>H.DoubleClickDelay||b!==this._previousButtonPressed)&&(J.singleClick=!0,B(J,this._currentPickResult),Y=!0);else{const v={evt:n,clickInfo:J,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,b,J,B),H.DoubleClickDelay)};this._delayedClicks[b]=v}let x=v.hasSpecificMask(s.d.POINTERDOUBLETAP)||y.hasSpecificMask(s.d.POINTERDOUBLETAP);if(!x&&C.HasSpecificTrigger(6)&&(P=this._initActionManager(P,J),P&&(x=P.hasSpecificTrigger(6))),x)if(b===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<H.DoubleClickDelay&&!this._doubleClickOccured){if(J.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=b,H.ExclusiveDoubleClickMode){var l;if(this._delayedClicks[b])clearTimeout(null===(l=this._delayedClicks[b])||void 0===l?void 0:l.timeoutId),this._delayedClicks[b]=null;B(J,this._previousPickResult)}else B(J,this._currentPickResult);else{var a;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,J.doubleClick=!0,J.ignore=!1,H.ExclusiveDoubleClickMode&&this._delayedClicks[b])clearTimeout(null===(a=this._delayedClicks[b])||void 0===a?void 0:a.timeoutId),this._delayedClicks[b]=null;B(J,this._currentPickResult)}Y=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=b}}Y||B(J,this._currentPickResult)},this._onPointerMove=v=>{if(this._updatePointerPosition(v),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>H.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>H.DragMovementThreshold),P.isPointerLock&&P._verifyPointerLock(),this._checkPrePointerObservable(null,v,v.inputIndex>=u.MouseWheelX&&v.inputIndex<=u.MouseWheelZ?s.d.POINTERWHEEL:s.d.POINTERMOVE))return;if(!J.cameraToUseForPointers&&!J.activeCamera)return;if(J.nj)return void this._processPointerMove(new f.c,v);J.pointerMovePredicate||(J.pointerMovePredicate=v=>v.Kb&&v.isVisible&&v.isReady()&&v.isEnabled()&&(v.enablePointerMoveEvents||J.constantlyUpdateMeshUnderPointer||null!==v._getActionManagerForTrigger())&&(!J.cameraToUseForPointers||0!==(J.cameraToUseForPointers.layerMask&v.layerMask)));const y=J._registeredActions>0||J.constantlyUpdateMeshUnderPointer?this._pickMove(v):null;this._processPointerMove(y,v)},this._onPointerDown=v=>{const y=this._activePointerIds.indexOf(-1);if(-1===y?this._activePointerIds.push(v.pointerId):this._activePointerIds[y]=v.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,H.ExclusiveDoubleClickMode)for(let B=0;B<this._delayedClicks.length;B++)if(this._delayedClicks[B])if(v.button===B){var n;clearTimeout(null===(n=this._delayedClicks[B])||void 0===n?void 0:n.timeoutId)}else{const v=this._delayedClicks[B].clickInfo;this._doubleClickOccured=!1,v.singleClick=!0,v.ignore=!1;const y=this._delayedClicks[B].evt,n=s.d.POINTERTAP,P=new s.i(n,y,this._currentPickResult);J.onPointerObservable.hasObservers()&&J.onPointerObservable.hasSpecificMask(n)&&J.onPointerObservable.notifyObservers(P,n),this._delayedClicks[B]=null}if(this._updatePointerPosition(v),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=v.button),J.preventDefaultOnPointerDown&&B&&(v.preventDefault(),B.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,v,s.d.POINTERDOWN))return;if(!J.cameraToUseForPointers&&!J.activeCamera)return;let P;this._pointerCaptures[v.pointerId]=!0,J.pointerDownPredicate||(J.pointerDownPredicate=v=>v.Kb&&v.isVisible&&v.isReady()&&v.isEnabled()&&(!J.cameraToUseForPointers||0!==(J.cameraToUseForPointers.layerMask&v.layerMask))),this._pickedDownMesh=null,P=J.skipPointerDownPicking||0===J._registeredActions&&!this._checkForPicking()&&!J.onPointerDown?new f.c:J.nd(this._unTranslatedPointerX,this._unTranslatedPointerY,J.pointerDownPredicate,J.pointerDownFastCheck,J.cameraToUseForPointers,J.pointerDownTrianglePredicate),this._processPointerDown(P,v)},this._onPointerUp=v=>{const y=this._activePointerIds.indexOf(v.pointerId);-1!==y&&(this._activePointerIds[y]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(v),J.preventDefaultOnPointerUp&&B&&(v.preventDefault(),B.focus()),this._initClickEvent(J.onPrePointerObservable,J.onPointerObservable,v,((y,n)=>{if(J.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!y.ignore)){if(this._checkPrePointerObservable(null,v,s.d.POINTERUP))return this._swipeButtonPressed===v.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===v.buttons&&(this._pointerCaptures[v.pointerId]=!1));y.hasSwiped||(y.singleClick&&J.onPrePointerObservable.hasSpecificMask(s.d.POINTERTAP)&&this._checkPrePointerObservable(null,v,s.d.POINTERTAP)&&(this._skipPointerTap=!0),y.doubleClick&&J.onPrePointerObservable.hasSpecificMask(s.d.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,v,s.d.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[v.pointerId]?(0===v.buttons&&(this._pointerCaptures[v.pointerId]=!1),(J.cameraToUseForPointers||J.activeCamera)&&(J.pointerUpPredicate||(J.pointerUpPredicate=v=>v.Kb&&v.isVisible&&v.isReady()&&v.isEnabled()&&(!J.cameraToUseForPointers||0!==(J.cameraToUseForPointers.layerMask&v.layerMask))),!this._meshPickProceed&&(C&&C.HasTriggers||this._checkForPicking()||J.onPointerUp)&&this._initActionManager(null,y),n||(n=this._currentPickResult),this._processPointerUp(n,v,y),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===v.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===v.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=v=>{const y=G.b.KEYDOWN;if(J.onPreKeyboardObservable.hasObservers()){const n=new G.d(y,v);if(J.onPreKeyboardObservable.notifyObservers(n,y),n.skipOnKeyboardObservable)return}if(J.onKeyboardObservable.hasObservers()){const n=new G.g(y,v);J.onKeyboardObservable.notifyObservers(n,y)}J.actionManager&&J.actionManager.processTrigger(14,N.CreateNewFromScene(J,v))},this._onKeyUp=v=>{const y=G.b.KEYUP;if(J.onPreKeyboardObservable.hasObservers()){const n=new G.d(y,v);if(J.onPreKeyboardObservable.notifyObservers(n,y),n.skipOnKeyboardObservable)return}if(J.onKeyboardObservable.hasObservers()){const n=new G.g(y,v);J.onKeyboardObservable.notifyObservers(n,y)}J.actionManager&&J.actionManager.processTrigger(15,N.CreateNewFromScene(J,v))},this._deviceSourceManager.onDeviceConnectedObservable.add((B=>{B.deviceType===r.Mouse?B.onInputChangedObservable.add((J=>{this._originMouseEvent=J,J.inputIndex===u.LeftClick||J.inputIndex===u.MiddleClick||J.inputIndex===u.RightClick||J.inputIndex===u.BrowserBack||J.inputIndex===u.BrowserForward?y&&1===B.getInput(J.inputIndex)?this._onPointerDown(J):v&&0===B.getInput(J.inputIndex)&&this._onPointerUp(J):n&&(J.inputIndex===u.Move?this._onPointerMove(J):J.inputIndex!==u.MouseWheelX&&J.inputIndex!==u.MouseWheelY&&J.inputIndex!==u.MouseWheelZ||this._onPointerMove(J))})):B.deviceType===r.Touch?B.onInputChangedObservable.add((J=>{J.inputIndex===u.LeftClick&&(y&&1===B.getInput(J.inputIndex)?(this._onPointerDown(J),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):v&&0===B.getInput(J.inputIndex)&&(this._onPointerUp(J),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),n&&J.inputIndex===u.Move&&this._onPointerMove(J)})):B.deviceType===r.Keyboard&&B.onInputChangedObservable.add((v=>{"keydown"===v.type?this._onKeyDown(v):"keyup"===v.type&&this._onKeyUp(v)}))})),this._alreadyAttached=!0}ej(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,B=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[y]===v&&(!v||!v._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const J=this._meshUnderPointerId[y];let P;J&&(P=J._getActionManagerForTrigger(10),P&&P.processTrigger(10,N.CreateNew(J,B,{pointerId:y}))),v?(this._meshUnderPointerId[y]=v,this._pointerOverMesh=v,P=v._getActionManagerForTrigger(9),P&&P.processTrigger(9,N.CreateNew(v,B,{pointerId:y,pickResult:n}))):(delete this._meshUnderPointerId[y],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(v){this._pointerOverMesh===v&&(this._pointerOverMesh=null),this._pickedDownMesh===v&&(this._pickedDownMesh=null),this._pickedUpMesh===v&&(this._pickedUpMesh=null);for(const y in this._meshUnderPointerId)this._meshUnderPointerId[y]===v&&delete this._meshUnderPointerId[y]}}H.DragMovementThreshold=10,H.LongPressDelay=500,H.DoubleClickDelay=300,H.ExclusiveDoubleClickMode=!1;var A=n(10919),X=n(11103),U=n(11171),z=n(11184),e=n(10828),K=n(11186),D=n(11088);class Q{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.nj=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var o,T=n(10801),m=n(10908);!function(v){v[v.BackwardCompatible=0]="BackwardCompatible",v[v.Intermediate=1]="Intermediate",v[v.Aggressive=2]="Aggressive"}(o||(o={}));class vv{static DefaultMaterialFactory(v){throw(0,W.e)("nb")}static CollisionCoordinatorFactory(){throw(0,W.e)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(v){v!==this._clearColor&&(this._clearColor=v,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(v){if(v!==this._performancePriority){switch(this._performancePriority=v,v){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.nj=!1,this.fj=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.nj=!0,this.fj=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.nj=!0,this.fj=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(v)}}set forceWireframe(v){this._forceWireframe!==v&&(this._forceWireframe=v,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(v){this._skipFrustumClipping!==v&&(this._skipFrustumClipping=v)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(v){this._forcePointsCloud!==v&&(this._forcePointsCloud=v,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(v){this._environmentTexture!==v&&(this._environmentTexture=v,this.markAllMaterialsAsDirty(1))}getNodes(){let v=[];return v=v.concat(this.meshes),v=v.concat(this.lights),v=v.concat(this.cameras),v=v.concat(this.transformNodes),this.skeletons.forEach((y=>v=v.concat(y.bones))),v}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(v){this._animationPropertiesOverride=v}set onDispose(v){this._onDisposeObserver&&this.xj.remove(this._onDisposeObserver),this._onDisposeObserver=this.xj.add(v)}set beforeRender(v){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),v&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(v))}set afterRender(v){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),v&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(v))}set beforeCameraRender(v){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(v)}set afterCameraRender(v){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(v)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(v){this._pointerPickingConfiguration.pointerDownPredicate=v}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(v){this._pointerPickingConfiguration.pointerUpPredicate=v}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(v){this._pointerPickingConfiguration.pointerMovePredicate=v}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(v){this._pointerPickingConfiguration.pointerDownFastCheck=v}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(v){this._pointerPickingConfiguration.pointerUpFastCheck=v}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(v){this._pointerPickingConfiguration.pointerMoveFastCheck=v}get nj(){return this._pointerPickingConfiguration.nj}set nj(v){this._pointerPickingConfiguration.nj=v}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(v){this._pointerPickingConfiguration.skipPointerDownPicking=v}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(v){this._pointerPickingConfiguration.skipPointerUpPicking=v}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return H.DragMovementThreshold}static set DragMovementThreshold(v){H.DragMovementThreshold=v}static get LongPressDelay(){return H.LongPressDelay}static set LongPressDelay(v){H.LongPressDelay=v}static get DoubleClickDelay(){return H.DoubleClickDelay}static set DoubleClickDelay(v){H.DoubleClickDelay=v}static get ExclusiveDoubleClickMode(){return H.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(v){H.ExclusiveDoubleClickMode=v}bindEyePosition(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const B=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,J=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return a.i.Vector4[0].set(B.x,B.y,B.z,J?-1:1),v&&(n?v.setFloat3(y,a.i.Vector4[0].x,a.i.Vector4[0].y,a.i.Vector4[0].z):v.setVector4(y,a.i.Vector4[0])),a.i.Vector4[0]}finalizeSceneUbo(){const v=this.getSceneUniformBuffer(),y=this.bindEyePosition(null);return v.updateFloat4("vEyePosition",y.x,y.y,y.z,y.w),v.update(),v}set useRightHandedSystem(v){this._useRightHandedSystem!==v&&(this._useRightHandedSystem=v,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(v){this._currentStepId=v}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(v){this._fogEnabled!==v&&(this._fogEnabled=v,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(v){this._fogMode!==v&&(this._fogMode=v,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(v){this._shadowsEnabled!==v&&(this._shadowsEnabled=v,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(v){this._lightsEnabled!==v&&(this._lightsEnabled=v,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(v){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),v&&(this._unObserveActiveCameras=(0,D.g)(v,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=v}get activeCamera(){return this._activeCamera}set activeCamera(v){v!==this._activeCamera&&(this._activeCamera=v,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this.Ji||(this.Ji=vv.DefaultMaterialFactory(this)),this.Ji}set defaultMaterial(v){this.Ji=v}set texturesEnabled(v){this._texturesEnabled!==v&&(this._texturesEnabled=v,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(v){if(this._frameGraph)return this._frameGraph=v,void(v||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=v,v&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(v){this._skeletonsEnabled!==v&&(this._skeletonsEnabled=v,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=vv.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const v of this._transientComponents)v.register();this._transientComponents.length=0}}fb(v){this._components.push(v),this._transientComponents.push(v);const y=v;y.addFromContainer&&y.serialize&&this._serializableComponents.push(y)}_getComponent(v){for(const y of this._components)if(y.name===v)return y;return null}constructor(v,y){this._inputManager=new H(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.fj=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new X.e(.2,.2,.3,1),this.onClearColorChangedObservable=new P.e,this.ambientColor=new X.d(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new P.e,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Ej=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.nk=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.xj=new P.e,this._onDisposeObserver=null,this.onBeforeRenderObservable=new P.e,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new P.e,this.onAfterRenderCameraObservable=new P.e,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new P.e,this.onAfterAnimationsObservable=new P.e,this.onBeforeDrawPhaseObservable=new P.e,this.onAfterDrawPhaseObservable=new P.e,this.onReadyObservable=new P.e,this.onBeforeCameraRenderObservable=new P.e,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new P.e,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new P.e,this.onAfterActiveMeshesEvaluationObservable=new P.e,this.onBeforeParticlesRenderingObservable=new P.e,this.onAfterParticlesRenderingObservable=new P.e,this.onDataLoadedObservable=new P.e,this.onNewCameraAddedObservable=new P.e,this.onCameraRemovedObservable=new P.e,this.onNewLightAddedObservable=new P.e,this.onLightRemovedObservable=new P.e,this.onNewGeometryAddedObservable=new P.e,this.onGeometryRemovedObservable=new P.e,this.onNewTransformNodeAddedObservable=new P.e,this.onTransformNodeRemovedObservable=new P.e,this.onNewMeshAddedObservable=new P.e,this.onMeshRemovedObservable=new P.e,this.onNewSkeletonAddedObservable=new P.e,this.onSkeletonRemovedObservable=new P.e,this.onNewMaterialAddedObservable=new P.e,this.onNewMultiMaterialAddedObservable=new P.e,this.onMaterialRemovedObservable=new P.e,this.onMultiMaterialRemovedObservable=new P.e,this.onNewTextureAddedObservable=new P.e,this.onTextureRemovedObservable=new P.e,this.onBeforeRenderTargetsRenderObservable=new P.e,this.onAfterRenderTargetsRenderObservable=new P.e,this.onBeforeStepObservable=new P.e,this.onAfterStepObservable=new P.e,this.onActiveCameraChanged=new P.e,this.onActiveCamerasChanged=new P.e,this.onBeforeRenderingGroupObservable=new P.e,this.onAfterRenderingGroupObservable=new P.e,this.onMeshImportedObservable=new P.e,this.onAnimationFileImportedObservable=new P.e,this._registeredForLateAnimationBindings=new b.b(256),this._pointerPickingConfiguration=new Q,this.onPrePointerObservable=new P.e,this.onPointerObservable=new P.e,this.onPreKeyboardObservable=new P.e,this.onKeyboardObservable=new P.e,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=vv.FOGMODE_NONE,this.fogColor=new X.d(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new a.n(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new b.b(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new A.c,this._activeIndices=new A.c,this._activeParticles=new A.c,this._activeBones=new A.c,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new b.e(256),this._processedMaterials=new b.e(256),this._renderTargets=new b.b(256),this._materialsRenderTargets=new b.b(256),this._activeParticleSystems=new b.e(256),this._activeSkeletons=new b.b(32),this._softwareSkinnedMeshes=new b.b(32),this._activeAnimatables=new Array,this._transformMatrix=a.d.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=c.f.Create(),this._beforeClearStage=c.f.Create(),this._beforeRenderTargetClearStage=c.f.Create(),this._gatherRenderTargetsStage=c.f.Create(),this._gatherActiveCameraRenderTargetsStage=c.f.Create(),this._isReadyForMeshStage=c.f.Create(),this._beforeEvaluateActiveMeshStage=c.f.Create(),this._evaluateSubMeshStage=c.f.Create(),this._preActiveMeshStage=c.f.Create(),this._cameraDrawRenderTargetStage=c.f.Create(),this._beforeCameraDrawStage=c.f.Create(),this._beforeRenderTargetDrawStage=c.f.Create(),this._beforeRenderingGroupDrawStage=c.f.Create(),this._beforeRenderingMeshStage=c.f.Create(),this._afterRenderingMeshStage=c.f.Create(),this._afterRenderingGroupDrawStage=c.f.Create(),this._afterCameraDrawStage=c.f.Create(),this._afterCameraPostProcessStage=c.f.Create(),this._afterRenderTargetDrawStage=c.f.Create(),this._afterRenderTargetPostProcessStage=c.f.Create(),this._afterRenderStage=c.f.Create(),this._pointerMoveStage=c.f.Create(),this._pointerDownStage=c.f.Create(),this._pointerUpStage=c.f.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const n={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...y};v=this._engine=v||E.b.LastCreatedEngine,n.virtual?v._virtualScenes.push(this):(E.b._LastCreatedScene=this,v.scenes.push(this)),this._uid=null,this._renderingManager=new g.b(this),i.c&&(this.postProcessManager=new i.c(this)),(0,h.k)()&&this.attachControl(),this._createUbo(),Z.e&&(this._imageProcessingConfiguration=new Z.e),this.setDefaultCandidateProviders(),n.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=n.useMaterialMeshMap,this.useClonedMeshMap=n.useClonedMeshMap,y&&y.virtual||v.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(v){return this._defaultSubMeshCandidates.data=v.Ag,this._defaultSubMeshCandidates.length=v.Ag.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=v=>this._getDefaultSubMeshCandidates(v),this.getIntersectingSubMeshCandidates=(v,y)=>this._getDefaultSubMeshCandidates(v),this.getCollidingSubMeshCandidates=(v,y)=>this._getDefaultSubMeshCandidates(v)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(v){this._inputManager.pointerX=v}get pointerY(){return this._inputManager.pointerY}set pointerY(v){this._inputManager.pointerY=v}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==y||this._cachedMaterial!==v||this._cachedVisibility!==n}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(v,y){return this._inputManager.simulatePointerMove(v,y),this}simulatePointerDown(v,y){return this._inputManager.simulatePointerDown(v,y),this}simulatePointerUp(v,y,n){return this._inputManager.simulatePointerUp(v,y,n),this}isPointerCaptured(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(v)}attachControl(){let v=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(v,y,n)}ej(){this._inputManager.ej()}isReady(){var v,y;let n,B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const J=this.getEngine(),P=J.currentRenderPassId;J.currentRenderPassId=(null===(v=this.activeCamera)||void 0===v?void 0:v.renderPassId)??P;let b=!0;for(this._pendingData.length>0&&(b=!1),null===(y=this.prePassRenderer)||void 0===y||y.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&b&&(b=this.depthPeelingRenderer.isReady()),B&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),n=0;n<this.meshes.length;n++){const v=this.meshes[n];if(!v.Ag||0===v.Ag.length)continue;if(!v.isReady(!0)){b=!1;continue}const y=v.hasThinInstances||"InstancedMesh"===v.getClassName()||"InstancedLinesMesh"===v.getClassName()||J.getCaps().instancedArrays&&v.instances.length>0;for(const n of this._isReadyForMeshStage)n.action(v,y)||(b=!1);if(!B)continue;const P=v.material||this.defaultMaterial;if(P)if(P._storeEffectOnSubMeshes)for(const n of v.Ag){const v=n.Ha();v&&v.hasRenderTargetTextures&&null!=v.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(v)&&(this._processedMaterials.push(v),this._materialsRenderTargets.concatWithNoDuplicate(v.getRenderTargetTextures()))}else P.hasRenderTargetTextures&&null!=P.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(P)&&(this._processedMaterials.push(P),this._materialsRenderTargets.concatWithNoDuplicate(P.getRenderTargetTextures()))}if(B)for(n=0;n<this._materialsRenderTargets.length;++n){this._materialsRenderTargets.data[n].isReadyForRendering()||(b=!1)}for(n=0;n<this.geometries.length;n++){2===this.geometries[n].delayLoadState&&(b=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const Y of this.activeCameras)Y.isReady(!0)||(b=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(b=!1));for(const Y of this.Ej)Y.isReady()||(b=!1);if(this.layers)for(const Y of this.layers)Y.isReady()||(b=!1);return J.areAllEffectsReady()||(b=!1),J.currentRenderPassId=P,b}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(v){this.onBeforeRenderObservable.add(v)}unregisterBeforeRender(v){this.onBeforeRenderObservable.removeCallback(v)}registerAfterRender(v){this.onAfterRenderObservable.add(v)}unregisterAfterRender(v){this.onAfterRenderObservable.removeCallback(v)}_executeOnceBeforeRender(v){const y=()=>{v(),setTimeout((()=>{this.unregisterBeforeRender(y)}))};this.registerBeforeRender(y)}executeOnceBeforeRender(v,y){void 0!==y?setTimeout((()=>{this._executeOnceBeforeRender(v)}),y):this._executeOnceBeforeRender(v)}addPendingData(v){this._pendingData.push(v)}removePendingData(v){const y=this.isLoading,n=this._pendingData.indexOf(v);-1!==n&&this._pendingData.splice(n,1),y&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(v),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(y)}whenReadyAsync(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((y=>{this.executeWhenReady((()=>{y()}),v)}))}_checkIsReady(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(v)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(v)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=J.d.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(v,y,n,B){n||B||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===v.updateFlag&&this._projectionUpdateFlag===y.updateFlag||(this._viewUpdateFlag=v.updateFlag,this._projectionUpdateFlag=y.updateFlag,this._viewMatrix=v,this._projectionMatrix=y,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?U.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=U.e.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(n,B):this._sceneUbo.useUbo&&(this._sceneUbo.Vj("viewProjection",this._transformMatrix),this._sceneUbo.Vj("view",this._viewMatrix),this._sceneUbo.Vj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(v){const y=new x.b(this._engine,void 0,!1,v??"$d");return y.addUniform("viewProjection",16),y.addUniform("view",16),y.addUniform("projection",16),y.addUniform("vEyePosition",4),y}setSceneUniformBuffer(v){this._sceneUbo=v,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return z.e.UniqueId}Ai(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(v),v._resyncLightSources(),v.parent||v._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(v),y&&v.getChildMeshes().forEach((v=>{this.Ai(v)})))}sd(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.meshes.indexOf(v);return-1!==n&&(this.meshes.splice(n,1),v.parent||v._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(v),this.onMeshRemovedObservable.notifyObservers(v),y&&v.getChildMeshes().forEach((v=>{this.sd(v)})),n}addTransformNode(v){this._blockEntityCollection||v.va()===this&&-1!==v._indexInSceneTransformNodesArray||(v._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(v),v.parent||v._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(v))}removeTransformNode(v){const y=v._indexInSceneTransformNodesArray;if(-1!==y){if(y!==this.transformNodes.length-1){const v=this.transformNodes[this.transformNodes.length-1];this.transformNodes[y]=v,v._indexInSceneTransformNodesArray=y}v._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),v.parent||v._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(v),y}removeSkeleton(v){const y=this.skeletons.indexOf(v);return-1!==y&&(this.skeletons.splice(y,1),this.onSkeletonRemovedObservable.notifyObservers(v),this._executeActiveContainerCleanup(this._activeSkeletons)),y}removeMorphTargetManager(v){const y=this.morphTargetManagers.indexOf(v);return-1!==y&&this.morphTargetManagers.splice(y,1),y}removeLight(v){const y=this.lights.indexOf(v);if(-1!==y){for(const y of this.meshes)y._removeLightSource(v,!1);this.lights.splice(y,1),this.sortLightsByPriority(),v.parent||v._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(v),y}removeCamera(v){const y=this.cameras.indexOf(v);if(-1!==y&&(this.cameras.splice(y,1),v.parent||v._removeFromSceneRootNodes()),this.activeCameras){const y=this.activeCameras.indexOf(v);-1!==y&&this.activeCameras.splice(y,1)}return this.activeCamera===v&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(v),y}removeParticleSystem(v){const y=this.Ej.indexOf(v);return-1!==y&&(this.Ej.splice(y,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),y}removeAnimation(v){const y=this.animations.indexOf(v);return-1!==y&&this.animations.splice(y,1),y}stopAnimation(v,y,n){}removeAnimationGroup(v){const y=this.animationGroups.indexOf(v);return-1!==y&&this.animationGroups.splice(y,1),y}removeMultiMaterial(v){const y=this.multiMaterials.indexOf(v);return-1!==y&&this.multiMaterials.splice(y,1),this.onMultiMaterialRemovedObservable.notifyObservers(v),y}removeMaterial(v){const y=v._indexInSceneMaterialArray;if(-1!==y&&y<this.materials.length){if(y!==this.materials.length-1){const v=this.materials[this.materials.length-1];this.materials[y]=v,v._indexInSceneMaterialArray=y}v._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(v),y}removeActionManager(v){const y=this.actionManagers.indexOf(v);return-1!==y&&this.actionManagers.splice(y,1),y}removeTexture(v){const y=this.textures.indexOf(v);return-1!==y&&this.textures.splice(y,1),this.onTextureRemovedObservable.notifyObservers(v),y}addLight(v){if(!this._blockEntityCollection){this.lights.push(v),this.sortLightsByPriority(),v.parent||v._addToSceneRootNodes();for(const y of this.meshes)-1===y.lightSources.indexOf(v)&&(y.lightSources.push(v),y._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(v)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(K.e.CompareLightsPriority)}addCamera(v){this._blockEntityCollection||(this.cameras.push(v),this.onNewCameraAddedObservable.notifyObservers(v),v.parent||v._addToSceneRootNodes())}addSkeleton(v){this._blockEntityCollection||(this.skeletons.push(v),this.onNewSkeletonAddedObservable.notifyObservers(v))}addParticleSystem(v){this._blockEntityCollection||this.Ej.push(v)}addAnimation(v){this._blockEntityCollection||this.animations.push(v)}addAnimationGroup(v){this._blockEntityCollection||this.animationGroups.push(v)}addMultiMaterial(v){this._blockEntityCollection||(this.multiMaterials.push(v),this.onNewMultiMaterialAddedObservable.notifyObservers(v))}addMaterial(v){this._blockEntityCollection||v.va()===this&&-1!==v._indexInSceneMaterialArray||(v._indexInSceneMaterialArray=this.materials.length,this.materials.push(v),this.onNewMaterialAddedObservable.notifyObservers(v))}addMorphTargetManager(v){this._blockEntityCollection||this.morphTargetManagers.push(v)}addGeometry(v){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[v.uniqueId]=this.geometries.length),this.geometries.push(v))}addActionManager(v){this.actionManagers.push(v)}addTexture(v){this._blockEntityCollection||(this.textures.push(v),this.onNewTextureAddedObservable.notifyObservers(v))}switchActiveCamera(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.ej(),this.activeCamera=v,y&&v.attachControl())}setActiveCameraById(v){const y=this.getCameraById(v);return y?(this.activeCamera=y,y):null}setActiveCameraByName(v){const y=this.getCameraByName(v);return y?(this.activeCamera=y,y):null}getAnimationGroupByName(v){for(let y=0;y<this.animationGroups.length;y++)if(this.animationGroups[y].name===v)return this.animationGroups[y];return null}_getMaterial(v,y){for(let n=0;n<this.materials.length;n++){const v=this.materials[n];if(y(v))return v}if(v)for(let n=0;n<this.multiMaterials.length;n++){const v=this.multiMaterials[n];if(y(v))return v}return null}getMaterialByUniqueID(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(y,(y=>y.uniqueId===v))}getMaterialById(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(y,(y=>y.id===v))}getMaterialByName(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(y,(y=>y.name===v))}getLastMaterialById(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let n=this.materials.length-1;n>=0;n--)if(this.materials[n].id===v)return this.materials[n];if(y)for(let n=this.multiMaterials.length-1;n>=0;n--)if(this.multiMaterials[n].id===v)return this.multiMaterials[n];return null}getTextureByUniqueId(v){for(let y=0;y<this.textures.length;y++)if(this.textures[y].uniqueId===v)return this.textures[y];return null}getTextureByName(v){for(let y=0;y<this.textures.length;y++)if(this.textures[y].name===v)return this.textures[y];return null}getCameraById(v){for(let y=0;y<this.cameras.length;y++)if(this.cameras[y].id===v)return this.cameras[y];return null}getCameraByUniqueId(v){for(let y=0;y<this.cameras.length;y++)if(this.cameras[y].uniqueId===v)return this.cameras[y];return null}getCameraByName(v){for(let y=0;y<this.cameras.length;y++)if(this.cameras[y].name===v)return this.cameras[y];return null}getBoneById(v){for(let y=0;y<this.skeletons.length;y++){const n=this.skeletons[y];for(let y=0;y<n.bones.length;y++)if(n.bones[y].id===v)return n.bones[y]}return null}getBoneByName(v){for(let y=0;y<this.skeletons.length;y++){const n=this.skeletons[y];for(let y=0;y<n.bones.length;y++)if(n.bones[y].name===v)return n.bones[y]}return null}getLightByName(v){for(let y=0;y<this.lights.length;y++)if(this.lights[y].name===v)return this.lights[y];return null}getLightById(v){for(let y=0;y<this.lights.length;y++)if(this.lights[y].id===v)return this.lights[y];return null}getLightByUniqueId(v){for(let y=0;y<this.lights.length;y++)if(this.lights[y].uniqueId===v)return this.lights[y];return null}getParticleSystemById(v){for(let y=0;y<this.Ej.length;y++)if(this.Ej[y].id===v)return this.Ej[y];return null}getGeometryById(v){for(let y=0;y<this.geometries.length;y++)if(this.geometries[y].id===v)return this.geometries[y];return null}_getGeometryByUniqueId(v){if(this._geometriesByUniqueId){const y=this._geometriesByUniqueId[v];if(void 0!==y)return this.geometries[y]}else for(let y=0;y<this.geometries.length;y++)if(this.geometries[y].uniqueId===v)return this.geometries[y];return null}pushGeometry(v,y){return!(!y&&this._getGeometryByUniqueId(v.uniqueId))&&(this.addGeometry(v),this.onNewGeometryAddedObservable.notifyObservers(v),!0)}removeGeometry(v){let y;if(this._geometriesByUniqueId){if(y=this._geometriesByUniqueId[v.uniqueId],void 0===y)return!1}else if(y=this.geometries.indexOf(v),y<0)return!1;if(y!==this.geometries.length-1){const v=this.geometries[this.geometries.length-1];v&&(this.geometries[y]=v,this._geometriesByUniqueId&&(this._geometriesByUniqueId[v.uniqueId]=y))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[v.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(v),!0}getGeometries(){return this.geometries}getMeshById(v){for(let y=0;y<this.meshes.length;y++)if(this.meshes[y].id===v)return this.meshes[y];return null}getMeshesById(v){return this.meshes.filter((function(y){return y.id===v}))}getTransformNodeById(v){for(let y=0;y<this.transformNodes.length;y++)if(this.transformNodes[y].id===v)return this.transformNodes[y];return null}getTransformNodeByUniqueId(v){for(let y=0;y<this.transformNodes.length;y++)if(this.transformNodes[y].uniqueId===v)return this.transformNodes[y];return null}getTransformNodesById(v){return this.transformNodes.filter((function(y){return y.id===v}))}getMeshByUniqueId(v){for(let y=0;y<this.meshes.length;y++)if(this.meshes[y].uniqueId===v)return this.meshes[y];return null}getLastMeshById(v){for(let y=this.meshes.length-1;y>=0;y--)if(this.meshes[y].id===v)return this.meshes[y];return null}getLastTransformNodeById(v){for(let y=this.transformNodes.length-1;y>=0;y--)if(this.transformNodes[y].id===v)return this.transformNodes[y];return null}getLastEntryById(v){let y;for(y=this.meshes.length-1;y>=0;y--)if(this.meshes[y].id===v)return this.meshes[y];for(y=this.transformNodes.length-1;y>=0;y--)if(this.transformNodes[y].id===v)return this.transformNodes[y];for(y=this.cameras.length-1;y>=0;y--)if(this.cameras[y].id===v)return this.cameras[y];for(y=this.lights.length-1;y>=0;y--)if(this.lights[y].id===v)return this.lights[y];return null}getNodeById(v){const y=this.getMeshById(v);if(y)return y;const n=this.getTransformNodeById(v);if(n)return n;const B=this.getLightById(v);if(B)return B;const J=this.getCameraById(v);if(J)return J;const P=this.getBoneById(v);return P||null}getNodeByName(v){const y=this.getMeshByName(v);if(y)return y;const n=this.getTransformNodeByName(v);if(n)return n;const B=this.getLightByName(v);if(B)return B;const J=this.getCameraByName(v);if(J)return J;const P=this.getBoneByName(v);return P||null}getMeshByName(v){for(let y=0;y<this.meshes.length;y++)if(this.meshes[y].name===v)return this.meshes[y];return null}getTransformNodeByName(v){for(let y=0;y<this.transformNodes.length;y++)if(this.transformNodes[y].name===v)return this.transformNodes[y];return null}getLastSkeletonById(v){for(let y=this.skeletons.length-1;y>=0;y--)if(this.skeletons[y].id===v)return this.skeletons[y];return null}getSkeletonByUniqueId(v){for(let y=0;y<this.skeletons.length;y++)if(this.skeletons[y].uniqueId===v)return this.skeletons[y];return null}getSkeletonById(v){for(let y=0;y<this.skeletons.length;y++)if(this.skeletons[y].id===v)return this.skeletons[y];return null}getSkeletonByName(v){for(let y=0;y<this.skeletons.length;y++)if(this.skeletons[y].name===v)return this.skeletons[y];return null}getMorphTargetManagerById(v){for(let y=0;y<this.morphTargetManagers.length;y++)if(this.morphTargetManagers[y].uniqueId===v)return this.morphTargetManagers[y];return null}getMorphTargetById(v){for(let y=0;y<this.morphTargetManagers.length;++y){const n=this.morphTargetManagers[y];for(let y=0;y<n.numTargets;++y){const B=n.getTarget(y);if(B.id===v)return B}}return null}getMorphTargetByName(v){for(let y=0;y<this.morphTargetManagers.length;++y){const n=this.morphTargetManagers[y];for(let y=0;y<n.numTargets;++y){const B=n.getTarget(y);if(B.name===v)return B}}return null}getPostProcessByName(v){for(let y=0;y<this.postProcesses.length;++y){const n=this.postProcesses[y];if(n.name===v)return n}return null}isActiveMesh(v){return-1!==this._activeMeshes.indexOf(v)}get uid(){return this._uid||(this._uid=B.g.RandomId()),this._uid}addExternalData(v,y){return this._externalData||(this._externalData=new Y),this._externalData.add(v,y)}getExternalData(v){return this._externalData?this._externalData.get(v):null}getOrAddExternalDataWithFactory(v,y){return this._externalData||(this._externalData=new Y),this._externalData.getOrAddWithFactory(v,y)}removeExternalData(v){return this._externalData.remove(v)}_evaluateSubMesh(v,y,n,B){if(B||v.isInFrustum(this._frustumPlanes)){for(const B of this._evaluateSubMeshStage)B.action(y,v);const n=v.Ha();null!==n&&void 0!==n&&(n.hasRenderTargetTextures&&null!=n.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(n)&&(this._processedMaterials.push(n),this._materialsRenderTargets.concatWithNoDuplicate(n.getRenderTargetTextures())),this._renderingManager.dispatch(v,y,n))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(v){this._preventFreeActiveMeshesAndRenderingGroups!==v&&(v&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=v)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let v=0;v<this.activeCameras.length;v++){const y=this.activeCameras[v];y&&y._activeMeshes&&y._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let v=0;v<this.textures.length;v++){const y=this.textures[v];y&&y.renderList&&y.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],J=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=J,this._skipEvaluateActiveMeshesCompletely=v,B)for(let v=0;v<this._activeMeshes.length;v++)this._activeMeshes.data[v]._freeze();y&&y()}else n&&n("No active camera found")})),this}unfreezeActiveMeshes(){for(let v=0;v<this.meshes.length;v++){const y=this.meshes[v];y._internalAbstractMeshDataInfo&&(y._internalAbstractMeshDataInfo._isActive=!1)}for(let v=0;v<this._activeMeshes.length;v++)this._activeMeshes.data[v]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(v){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>v.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var v;if(this._activeMeshes.length>0)null===(v=this.activeCamera)||void 0===v||v._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const v=this._activeMeshes.length;for(let y=0;y<v;y++){this._activeMeshes.data[y].ak()}}if(this._activeParticleSystems){const v=this._activeParticleSystems.length;for(let y=0;y<v;y++)this._activeParticleSystems.data[y].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const B of this._beforeEvaluateActiveMeshStage)B.action();const y=this.getActiveMeshCandidates(),n=y.length;for(let B=0;B<n;B++){const v=y.data[B];if(v._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,v.isBlocked)continue;if(this._totalVertices.addCount(v.getTotalVertices(),!1),!v.isReady()||!v.isEnabled()||v.Be.hasAZeroComponent)continue;v.ak(),v.actionManager&&v.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(v);let n=this.customLODSelector?this.customLODSelector(v,this.activeCamera):v.getLOD(this.activeCamera);if(v._internalAbstractMeshDataInfo._currentLOD=n,v._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==n&&null!==n&&(n!==v&&0!==n.billboardMode&&n.ak(),v._preActivate(),v.isVisible&&v.visibility>0&&0!==(v.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||v.Jb||v.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(v),this.activeCamera._activeMeshes.push(v),n!==v&&n._activate(this._renderId,!1);for(const y of this._preActiveMeshStage)y.action(v);v._activate(this._renderId,!1)&&(v.isAnInstance?v._internalAbstractMeshDataInfo._actAsRegularMesh&&(n=v):n._internalAbstractMeshDataInfo._onlyForInstances=!1,n._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(v,n)),v._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let v=0;v<this.Ej.length;v++){const y=this.Ej[v];if(!y.isStarted()||!y.j)continue;const n=y.j;n.position&&!n.isEnabled()||(this._activeParticleSystems.push(y),y.animate(),this._renderingManager.dispatchParticles(y))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(v){this._skeletonsEnabled&&v.skeleton&&(this._activeSkeletons.pushNoDuplicate(v.skeleton)&&(v.skeleton.prepare(),this._activeBones.addCount(v.skeleton.bones.length,!1)),v.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(v)&&this.frameGraph&&v.applySkeleton(v.skeleton))}_activeMesh(v,y){this._prepareSkeleton(y);let n=v.hasInstances||v.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||y.Jb;if(y&&y.Ag&&y.Ag.length>0){const B=this.getActiveSubMeshCandidates(y),J=B.length;n=n||1===J;for(let P=0;P<J;P++){const J=B.data[P];this._evaluateSubMesh(J,y,v,n)}}}updateTransformMatrix(v){const y=this.activeCamera;if(y)if(y._renderingMultiview){const n=y._rigCameras[0],B=y._rigCameras[1];this.setTransformMatrix(n.getViewMatrix(),n.getProjectionMatrix(v),B.getViewMatrix(),B.getProjectionMatrix(v))}else this.setTransformMatrix(y.getViewMatrix(),y.getProjectionMatrix(v))}_bindFrameBuffer(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];v&&v._multiviewTexture?v._multiviewTexture._bindFrameBuffer():v&&v.outputRenderTarget?v.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),y&&this._clearFrameBuffer(v)}_clearFrameBuffer(v){if(v&&v._multiviewTexture);else if(v&&v.outputRenderTarget&&!v._renderingMultiview){const y=v.outputRenderTarget;y.onClearObservable.hasObservers()?y.onClearObservable.notifyObservers(this._engine):y.skipInitialClear||v.isRightCamera||(this.fj&&this._engine.clear(y.clearColor||this._clearColor,!y._cleared,!0,!0),y._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(v,y){var n;let J=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(v&&v._skipRendering)return;const P=this._engine;if(this._activeCamera=v,!this.activeCamera)throw new Error("Active camera not set");if(P.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&J){let y=!0;v._renderingMultiview&&v.outputRenderTarget&&(y=v.outputRenderTarget.skipInitialClear,this.fj&&(this._defaultFrameBufferCleared=!1,v.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),v._renderingMultiview&&v.outputRenderTarget&&(v.outputRenderTarget.skipInitialClear=y)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let B=0;B<this._softwareSkinnedMeshes.length;B++){const v=this._softwareSkinnedMeshes.data[B];v.applySkeleton(v.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),v.customRenderTargets&&v.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(v.customRenderTargets),y&&y.customRenderTargets&&y.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(y.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const B of this._gatherActiveCameraRenderTargetsStage)B.action(this._renderTargets);let b=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){B.g.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let v=0;v<this._renderTargets.length;v++){const y=this._renderTargets.data[v];if(y._shouldRender()){this._renderId++;const v=y.activeCamera&&y.activeCamera!==this.activeCamera;y.render(v,this.dumpNextRenderTargets),b=!0}}B.g.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const v of this._cameraDrawRenderTargetStage)b=v.action(this.activeCamera)||b;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(n=v.outputRenderTarget)||void 0===n?void 0:n.renderPassId)??v.renderPassId??0,b&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||v._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const B of this._beforeCameraDrawStage)B.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),P.snapshotRendering&&1===P.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const B of this._afterCameraDrawStage)B.action(this.activeCamera);if(this.postProcessManager&&!v._multiviewTexture){const y=v.outputRenderTarget?v.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(v.isIntermediate,y)}for(const B of this._afterCameraPostProcessStage)B.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===v.cameraRigMode||v._renderingMultiview)return v._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(v,void 0,y),void this.onAfterRenderCameraObservable.notifyObservers(v);if(v._useMultiviewToSingleView)this._renderMultiviewToSingleView(v);else{this.onBeforeCameraRenderObservable.notifyObservers(v);for(let y=0;y<v._rigCameras.length;y++)this._renderForCamera(v._rigCameras[y],v)}this._activeCamera=v,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(v)}_checkIntersections(){for(let v=0;v<this._meshesForIntersections.length;v++){const y=this._meshesForIntersections.data[v];if(y.actionManager)for(let v=0;y.actionManager&&v<y.actionManager.actions.length;v++){const n=y.actionManager.actions[v];if(12===n.trigger||13===n.trigger){const v=n.getTriggerParameter(),B=v.mesh?v.mesh:v,J=B.intersectsMesh(y,v.usePreciseIntersection),P=y._intersectionsInProgress.indexOf(B);J&&-1===P?12===n.trigger?(n._executeCurrent(N.CreateNew(y,void 0,B)),y._intersectionsInProgress.push(B)):13===n.trigger&&y._intersectionsInProgress.push(B):!J&&P>-1&&(13===n.trigger&&n._executeCurrent(N.CreateNew(y,void 0,B)),y.actionManager.hasSpecificTrigger(13,(v=>{const y=v.mesh?v.mesh:v;return B===y}))&&13!==n.trigger||y._intersectionsInProgress.splice(P,1))}}}}_advancePhysicsEngineStep(v){}_animate(v){}animate(){if(this._engine.isDeterministicLockStep()){let v=Math.max(vv.MinDeltaTime,Math.min(this._engine.getDeltaTime(),vv.MaxDeltaTime))+this._timeAccumulator;const y=this._engine.getTimeStep(),n=1e3/y/1e3;let B=0;const J=this._engine.getLockstepMaxSteps();let P=Math.floor(v/y);for(P=Math.min(P,J);v>0&&B<P;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=y*n,this._animate(y),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(y),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,B++,v-=y;this._timeAccumulator=v<0?0:v}else{const v=this.useConstantAnimationDeltaTime?16:Math.max(vv.MinDeltaTime,Math.min(this._engine.getDeltaTime(),vv.MaxDeltaTime));this._animationRatio=.06*v,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(v)}}_clear(){(this.autoClearDepthAndStencil||this.fj)&&this._engine.clear(this._clearColor,this.fj||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(v){var y;if(null===v||void 0===v||!v.outputRenderTarget||null!==v&&void 0!==v&&v.isRigCamera||(v.outputRenderTarget._cleared=!1),null!==v&&void 0!==v&&null!==(y=v.rigCameras)&&void 0!==y&&y.length)for(let n=0;n<v.rigCameras.length;++n){const y=v.rigCameras[n].outputRenderTarget;y&&(y._cleared=!1)}}resetDrawCache(v){if(this.meshes)for(const y of this.meshes)y.resetDrawCache(v)}_renderWithFrameGraph(){var v;let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),y)for(const J of this.cameras)if(J.update(),0!==J.cameraRigMode)for(let v=0;v<J._rigCameras.length;v++)J._rigCameras[v].update();for(const J of this._beforeClearStage)J.action();const n=this.getActiveMeshCandidates(),B=n.length;for(let J=0;J<B;J++){const v=n.data[J];v.isBlocked||(this._totalVertices.addCount(v.getTotalVertices(),!1),v.isReady()&&v.isEnabled()&&!v.Be.hasAZeroComponent&&(v.ak(),v.actionManager&&v.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(v)))}if(this.particlesEnabled)for(let J=0;J<this.Ej.length;J++){const v=this.Ej[J];if(!v.isStarted()||!v.j)continue;const y=v.j;y.position&&!y.isEnabled()||(this._activeParticleSystems.push(v),v.animate())}null===(v=this.frameGraph)||void 0===v||v.execute()}render(){var v;let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(v=this.activeCameras)&&void 0!==v&&v.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),n||this.animate();for(const v of this._beforeCameraUpdateStage)v.action();if(y)if(this.activeCameras&&this.activeCameras.length>0)for(let v=0;v<this.activeCameras.length;v++){const y=this.activeCameras[v];if(y.update(),0!==y.cameraRigMode)for(let v=0;v<y._rigCameras.length;v++)y._rigCameras[v].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let v=0;v<this.activeCamera._rigCameras.length;v++)this.activeCamera._rigCameras[v].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(y,n);else{var J;const v=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const y=null!==(J=this.activeCameras)&&void 0!==J&&J.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){B.g.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let n=0;n<this.customRenderTargets.length;n++){const B=this.customRenderTargets[n];if(B._shouldRender()){if(this._renderId++,this.activeCamera=B.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");v.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),B.render(y!==this.activeCamera,this.dumpNextRenderTargets)}}B.g.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(null===y||void 0===y?void 0:y.renderPassId)??0,this.activeCamera=y,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const n of this._beforeClearStage)n.action();this._clearFrameBuffer(this.activeCamera);for(const n of this._gatherRenderTargetsStage)n.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let n=0;n<this.activeCameras.length;n++)this._processSubCameras(this.activeCameras[n],n>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const v of this._afterRenderStage)v.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let v=0;v<this._toBeDisposed.length;v++){const y=this._toBeDisposed[v];y&&y.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let v=0;v<this.materials.length;v++)this.materials[v].freeze()}unfreezeMaterials(){for(let v=0;v<this.materials.length;v++)this.materials[v].unfreeze()}dispose(){if(this.u)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((v=>{v.onAnimationEndObservable.clear(),v.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const v=this._activeRequests.slice();for(const J of v)J.abort();this._activeRequests.length=0;try{this.xj.notifyObservers(this)}catch(B){T.e.Error("An error occurred while calling onDisposeObservable!",B)}this.ej();if(this._engine.getInputElement())for(let J=0;J<this.cameras.length;J++)this.cameras[J].ej();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(v=>v.dispose(!0))),this._disposeList(this.transformNodes,(v=>v.dispose(!0)));const y=this.cameras;this._disposeList(y),this.Ji&&this.Ji.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.Ej),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let n=this._engine.scenes.indexOf(this);n>-1&&this._engine.scenes.splice(n,1),E.b._LastCreatedScene===this&&(this._engine.scenes.length>0?E.b._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:E.b._LastCreatedScene=null),n=this._engine._virtualScenes.indexOf(this),n>-1&&this._engine._virtualScenes.splice(n,1),this._engine.wipeCaches(!0),this.xj.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this._isDisposed=!0}_disposeList(v,y){const n=v.slice(0);y=y??(v=>v.dispose());for(const B of n)y(B);v.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let v=0;v<this.meshes.length;v++){const y=this.meshes[v].Rj;y&&y.clearCachedData()}}cleanCachedTextureBuffer(){for(const v of this.textures){v._buffer&&(v._buffer=null)}}getWorldExtends(v){const y=new a.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new a.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return v=v||(()=>!0),this.meshes.filter(v).forEach((v=>{if(v.ak(!0),!v.Ag||0===v.Ag.length||v.infiniteDistance)return;const B=v.getBoundingInfo(),J=B.boundingBox.minimumWorld,P=B.boundingBox.maximumWorld;a.n.CheckExtends(J,y,n),a.n.CheckExtends(P,y,n)})),{min:y,max:n}}createPickingRay(v,y,n,B){throw(0,W.e)("Ray")}createPickingRayToRef(v,y,n,B,J){throw(0,W.e)("Ray")}createPickingRayInCameraSpace(v,y,n){throw(0,W.e)("Ray")}createPickingRayInCameraSpaceToRef(v,y,n,B){throw(0,W.e)("Ray")}nd(v,y,n,B,J,P){const b=(0,W.e)("Ray",!0);return b&&T.e.Warn(b),new f.c}pickWithBoundingInfo(v,y,n,B,J){const P=(0,W.e)("Ray",!0);return P&&T.e.Warn(P),new f.c}pickWithRay(v,y,n,B){throw(0,W.e)("Ray")}multiPick(v,y,n,B,J){throw(0,W.e)("Ray")}multiPickWithRay(v,y,n){throw(0,W.e)("Ray")}setPointerOverMesh(v,y,n){this._inputManager.setPointerOverMesh(v,y,n)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const v of this.geometries)v._rebuild();for(const v of this.meshes)v._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const v of this._components)v.rebuild();for(const v of this.Ej)v.rebuild();if(this.spriteManagers)for(const v of this.spriteManagers)v.rebuild()}_rebuildTextures(){for(const v of this.textures)v._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(v,y,n){if(void 0===y)return v;const B=[];for(const J in v){const P=v[J];l.c&&l.c.MatchesQuery(P,y)&&(!n||n(P))&&B.push(P)}return B}getMeshesByTags(v,y){return this._getByTags(this.meshes,v,y)}getCamerasByTags(v,y){return this._getByTags(this.cameras,v,y)}getLightsByTags(v,y){return this._getByTags(this.lights,v,y)}getMaterialByTags(v,y){return this._getByTags(this.materials,v,y).concat(this._getByTags(this.multiMaterials,v,y))}getTransformNodesByTags(v,y){return this._getByTags(this.transformNodes,v,y)}setRenderingOrder(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(v,y,n,B)}setRenderingAutoClearDepthStencil(v,y){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(v,y,n,B)}getAutoClearDepthStencilSetup(v){return this._renderingManager.getAutoClearDepthStencilSetup(v)}_forceBlockMaterialDirtyMechanism(v){this._blockMaterialDirtyMechanism=v}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(v){this._blockMaterialDirtyMechanism!==v&&(this._blockMaterialDirtyMechanism=v,v||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(v,y){if(!this._blockMaterialDirtyMechanism)for(const n of this.materials)y&&!y(n)||n.eh(v)}_loadFile(v,y,n,B,J,P,b){const Y=(0,e.q)(v,y,n,B?this.offlineProvider:void 0,J,P,b);return this._activeRequests.push(Y),Y.onCompleteObservable.add((v=>{this._activeRequests.splice(this._activeRequests.indexOf(v),1)})),Y}_loadFileAsync(v,y,n,B,J){return new Promise(((P,b)=>{this._loadFile(v,(v=>{P(v)}),y,n,B,((v,y)=>{b(y)}),J)}))}_requestFile(v,y,n,B,J,P,b){const Y=(0,e.w)(v,y,n,B?this.offlineProvider:void 0,J,P,b);return this._activeRequests.push(Y),Y.onCompleteObservable.add((v=>{this._activeRequests.splice(this._activeRequests.indexOf(v),1)})),Y}_requestFileAsync(v,y,n,B,J){return new Promise(((P,b)=>{this._requestFile(v,(v=>{P(v)}),y,n,B,(v=>{b(v)}),J)}))}_readFile(v,y,n,B,J){const P=(0,e.t)(v,y,n,B,J);return this._activeRequests.push(P),P.onCompleteObservable.add((v=>{this._activeRequests.splice(this._activeRequests.indexOf(v),1)})),P}_readFileAsync(v,y,n){return new Promise(((B,J)=>{this._readFile(v,(v=>{B(v)}),y,n,(v=>{J(v)}))}))}getPerfCollector(){throw(0,W.e)("performanceViewerSceneExtension")}setActiveCameraByID(v){return this.setActiveCameraById(v)}getMaterialByID(v){return this.getMaterialById(v)}getLastMaterialByID(v){return this.getLastMaterialById(v)}getTextureByUniqueID(v){return this.getTextureByUniqueId(v)}getCameraByID(v){return this.getCameraById(v)}getCameraByUniqueID(v){return this.getCameraByUniqueId(v)}getBoneByID(v){return this.getBoneById(v)}getLightByID(v){return this.getLightById(v)}getLightByUniqueID(v){return this.getLightByUniqueId(v)}getParticleSystemByID(v){return this.getParticleSystemById(v)}getGeometryByID(v){return this.getGeometryById(v)}getMeshByID(v){return this.getMeshById(v)}getMeshByUniqueID(v){return this.getMeshByUniqueId(v)}getLastMeshByID(v){return this.getLastMeshById(v)}getMeshesByID(v){return this.getMeshesById(v)}getTransformNodeByID(v){return this.getTransformNodeById(v)}getTransformNodeByUniqueID(v){return this.getTransformNodeByUniqueId(v)}getTransformNodesByID(v){return this.getTransformNodesById(v)}getNodeByID(v){return this.getNodeById(v)}getLastEntryByID(v){return this.getLastEntryById(v)}getLastSkeletonByID(v){return this.getLastSkeletonById(v)}}vv.FOGMODE_NONE=0,vv.FOGMODE_EXP=1,vv.FOGMODE_EXP2=2,vv.FOGMODE_LINEAR=3,vv.MinDeltaTime=1,vv.MaxDeltaTime=1e3,(0,m.g)("BABYLON.Scene",vv)},11149:(v,y,n)=>{"use strict";n.d(y,{b:()=>B,f:()=>J});class B{}B.NAME_EFFECTLAYER="EffectLayer",B.NAME_LAYER="Layer",B.NAME_LENSFLARESYSTEM="LensFlareSystem",B.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",B.NAME_PARTICLESYSTEM="ub",B.NAME_GAMEPAD="Gamepad",B.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",B.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",B.NAME_PREPASSRENDERER="PrePassRenderer",B.NAME_DEPTHRENDERER="DepthRenderer",B.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",B.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",B.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",B.NAME_SPRITE="Sprite",B.NAME_SUBSURFACE="SubSurface",B.NAME_OUTLINERENDERER="Outline",B.NAME_PROCEDURALTEXTURE="ProceduralTexture",B.NAME_SHADOWGENERATOR="ShadowGenerator",B.NAME_OCTREE="wb",B.NAME_PHYSICSENGINE="PhysicsEngine",B.NAME_AUDIO="Audio",B.NAME_FLUIDRENDERER="FluidRenderer",B.STEP_ISREADYFORMESH_EFFECTLAYER=0,B.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,B.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,B.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,B.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,B.STEP_BEFORECAMERADRAW_PREPASS=0,B.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,B.STEP_BEFORECAMERADRAW_LAYER=2,B.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,B.STEP_BEFORERENDERTARGETDRAW_LAYER=1,B.STEP_BEFORERENDERINGMESH_PREPASS=0,B.STEP_BEFORERENDERINGMESH_OUTLINE=1,B.STEP_AFTERRENDERINGMESH_PREPASS=0,B.STEP_AFTERRENDERINGMESH_OUTLINE=1,B.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,B.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,B.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,B.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,B.STEP_BEFORECLEAR_PREPASS=1,B.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,B.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,B.STEP_AFTERRENDERTARGETDRAW_LAYER=1,B.STEP_AFTERCAMERADRAW_PREPASS=0,B.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,B.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,B.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,B.STEP_AFTERCAMERADRAW_LAYER=4,B.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,B.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,B.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,B.STEP_AFTERRENDER_AUDIO=0,B.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,B.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,B.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,B.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,B.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,B.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,B.STEP_POINTERMOVE_SPRITE=0,B.STEP_POINTERDOWN_SPRITE=0,B.STEP_POINTERUP_SPRITE=0;class J extends Array{constructor(v){super(...v)}static Create(){return Object.create(J.prototype)}registerStep(v,y,n){let B=0,J=Number.MAX_VALUE;for(;B<this.length;B++){if(J=this[B].index,v<J)break}this.splice(B,0,{index:v,component:y,action:n.bind(y)})}clear(){this.length=0}}},11050:(v,y,n)=>{"use strict";n.d(y,{c:()=>B});function B(v,y,n,B){var J,P=arguments.length,b=P<3?y:null===B?B=Object.getOwnPropertyDescriptor(y,n):B;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)b=Reflect.decorate(v,y,n,B);else for(var Y=v.length-1;Y>=0;Y--)(J=v[Y])&&(b=(P<3?J(b):P>3?J(y,n,b):J(y,n))||b);return P>3&&b&&Object.defineProperty(y,n,b),b}Object.create;Object.create},12246:(v,y,n)=>{"use strict";class B{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((v,y)=>{this._resolve=v,this._reject=y}))}}var J=n(11081),P=n(11103),b=n(10791),Y=n(11348),l=n(12253),a=n(12270),Z=n(10795),x=n(11523),f=n(12275),N=n(12278),i=n(10820),g=n(10801),c=n(10803);class h{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(v){this._useTextureToStoreBoneMatrices=v,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(v){this._animationPropertiesOverride=v}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(v,y,n){this.name=v,this.id=y,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=J.d.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new Z.e,this.bones=[],this._scene=n||i.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const B=this._scene.getEngine().getCaps();this._canUseTextureForBones=B.textureFloat&&B.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((v=>!v.getParent()))}getTransformMatrices(v){if(this.needInitialSkinMatrix){if(!v)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return v._bonesTransformMatrices||this.prepare(!0),v._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(v){return this.needInitialSkinMatrix&&v._transformMatrixTexture?v._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(v){let y=`Name: ${this.name}, nBones: ${this.bones.length}`;if(y+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,v){y+=", Ranges: {";let v=!0;for(const n in this._ranges)v&&(y+=", ",v=!1),y+=n;y+="}"}return y}getBoneIndexByName(v){for(let y=0,n=this.bones.length;y<n;y++)if(this.bones[y].name===v)return y;return-1}createAnimationRange(v,y,n){if(!this._ranges[v]){this._ranges[v]=new N.b(v,y,n);for(let B=0,J=this.bones.length;B<J;B++)this.bones[B].animations[0]&&this.bones[B].animations[0].createRange(v,y,n)}}deleteAnimationRange(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let n=0,B=this.bones.length;n<B;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].deleteRange(v,y);this._ranges[v]=null}getAnimationRange(v){return this._ranges[v]||null}getAnimationRanges(){const v=[];let y;for(y in this._ranges)v.push(this._ranges[y]);return v}copyAnimationRange(v,y){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[y]||!v.getAnimationRange(y))return!1;let B=!0;const J=this._getHighestAnimationFrame()+1,P={},b=v.bones;let Y,l;for(l=0,Y=b.length;l<Y;l++)P[b[l].name]=b[l];this.bones.length!==b.length&&(g.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${b.length}`),B=!1);const a=n&&this.dimensionsAtRest&&v.dimensionsAtRest?this.dimensionsAtRest.divide(v.dimensionsAtRest):null;for(l=0,Y=this.bones.length;l<Y;l++){const v=this.bones[l].name,b=P[v];b?B=B&&this.bones[l].copyAnimationRange(b,y,J,n,a):(g.e.Warn("copyAnimationRange: not same rig, missing source bone "+v),B=!1)}const Z=v.getAnimationRange(y);return Z&&(this._ranges[y]=new N.b(y,Z.from+J,Z.to+J)),B}returnToRest(){for(const v of this.bones)-1!==v._index&&v.returnToRest()}_getHighestAnimationFrame(){let v=0;for(let y=0,n=this.bones.length;y<n;y++)if(this.bones[y].animations[0]){const n=this.bones[y].animations[0].getHighestFrame();v<n&&(v=n)}return v}beginAnimation(v,y,n,B){const J=this.getAnimationRange(v);return J?this._scene.beginAnimation(this,J.from,J.to,y,n,B):null}static MakeAnimationAdditive(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const B=v.getAnimationRange(n);if(!B)return null;const J=v._scene.getAllAnimatablesByTarget(v);let P=null;for(let Y=0;Y<J.length;Y++){const v=J[Y];if(v.fromFrame===(null===B||void 0===B?void 0:B.from)&&v.toFrame===(null===B||void 0===B?void 0:B.to)){P=v;break}}const b=v.getAnimatables();for(let Y=0;Y<b.length;Y++){const v=b[Y].animations;if(v)for(let B=0;B<v.length;B++)f.c.MakeAnimationAdditive(v[B],y,n)}return P&&(P.isAdditive=!0),v}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(v){this._meshesWithPoseMatrix.push(v)}_unregisterMeshWithPoseMatrix(v){const y=this._meshesWithPoseMatrix.indexOf(v);y>-1&&this._meshesWithPoseMatrix.splice(y,1)}_computeTransformMatrices(v,y){this.onBeforeComputeObservable.notifyObservers(this);for(let n=0;n<this.bones.length;n++){const B=this.bones[n];B._childUpdateId++;const J=B.getParent();if(J?B.getLocalMatrix().multiplyToRef(J.getFinalMatrix(),B.getFinalMatrix()):y?B.getLocalMatrix().multiplyToRef(y,B.getFinalMatrix()):B.getFinalMatrix().p(B.getLocalMatrix()),-1!==B._index){const y=null===B._index?n:B._index;B.getAbsoluteInverseBindMatrix().multiplyToArray(B.getFinalMatrix(),v,16*y)}}this._identity.copyToArray(v,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const v=this.va().getRenderId();if(this._currentRenderId===v)return;this._currentRenderId=v}if(this._numBonesWithLinkedTransformNode>0)for(const v of this.bones)if(v._linkedTransformNode){const y=v._linkedTransformNode;v.position=y.position,y.rotationQuaternion?v.rotationQuaternion=y.rotationQuaternion:v.rotation=y.rotation,v.Be=y.Be}if(this.needInitialSkinMatrix)for(const v of this._meshesWithPoseMatrix){const y=v.getPoseMatrix();let n=this._isDirty;if(v._bonesTransformMatrices&&v._bonesTransformMatrices.length===16*(this.bones.length+1)||(v._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),n=!0),n){if(this._synchronizedWithMesh!==v){this._synchronizedWithMesh=v;for(const v of this.bones)if(!v.getParent()){v.getBindMatrix().multiplyToRef(y,J.i.Matrix[1]),v._updateAbsoluteBindMatrices(J.i.Matrix[1])}if(this.isUsingTextureForMatrices){const y=4*(this.bones.length+1);v._transformMatrixTexture&&v._transformMatrixTexture.getSize().width===y||(v._transformMatrixTexture&&v._transformMatrixTexture.dispose(),v._transformMatrixTexture=x.e.CreateRGBATexture(v._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(v._bonesTransformMatrices,y),this.isUsingTextureForMatrices&&v._transformMatrixTexture&&v._transformMatrixTexture.update(v._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=x.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let v=0;v<this.bones.length;v++)this._animatables.push(this.bones[v])}return this._animatables}clone(v,y){const n=new h(v,y||v,this._scene);n.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let B=0;B<this.bones.length;B++){const v=this.bones[B];let y=null;const J=v.getParent();if(J){const v=this.bones.indexOf(J);y=n.bones[v]}const P=new a.c(v.name,n,y,v.getBindMatrix().clone(),v.getRestMatrix().clone());P._index=v._index,v._linkedTransformNode&&P.linkTransformNode(v._linkedTransformNode),c.c.DeepCopy(v.animations,P.animations)}if(this._ranges){n._ranges={};for(const v in this._ranges){const y=this._ranges[v];y&&(n._ranges[v]=y.clone())}}return this._isDirty=!0,n.prepare(!0),n}enableBlending(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((y=>{y.animations.forEach((y=>{y.enableBlending=!0,y.blendingSpeed=v}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const v=this._parentContainer.skeletons.indexOf(this);v>-1&&this._parentContainer.skeletons.splice(v,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const v={};v.name=this.name,v.id=this.id,this.dimensionsAtRest&&(v.dimensionsAtRest=this.dimensionsAtRest.wj()),v.bones=[],v.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let n=0;n<this.bones.length;n++){var y;const B=this.bones[n],J=B.getParent(),P={parentBoneIndex:J?this.bones.indexOf(J):-1,index:B.getIndex(),name:B.name,id:B.id,matrix:B.getBindMatrix().wj(),rest:B.getRestMatrix().wj(),linkedTransformNodeId:null===(y=B.getTransformNode())||void 0===y?void 0:y.id};v.bones.push(P),B.length&&(P.length=B.length),B.metadata&&(P.metadata=B.metadata),B.animations&&B.animations.length>0&&(P.animation=B.animations[0].serialize()),v.ranges=[];for(const y in this._ranges){const n=this._ranges[y];if(!n)continue;const B={};B.name=y,B.from=n.from,B.to=n.to,v.ranges.push(B)}}return v}static Parse(v,y){const n=new h(v.name,v.id,y);let B;for(v.dimensionsAtRest&&(n.dimensionsAtRest=J.n.qh(v.dimensionsAtRest)),n.needInitialSkinMatrix=v.needInitialSkinMatrix,B=0;B<v.bones.length;B++){const y=v.bones[B],P=v.bones[B].index;let b=null;y.parentBoneIndex>-1&&(b=n.bones[y.parentBoneIndex]);const Y=y.rest?J.d.qh(y.rest):null,l=new a.c(y.name,n,b,J.d.qh(y.matrix),Y,null,P);void 0!==y.id&&null!==y.id&&(l.id=y.id),y.length&&(l.length=y.length),y.metadata&&(l.metadata=y.metadata),y.animation&&l.animations.push(f.c.Parse(y.animation)),void 0!==y.linkedTransformNodeId&&null!==y.linkedTransformNodeId&&(n._hasWaitingData=!0,l._waitingTransformNodeId=y.linkedTransformNodeId)}if(v.ranges)for(B=0;B<v.ranges.length;B++){const y=v.ranges[B];n.createAnimationRange(y.name,y.from,y.to)}return n}computeAbsoluteMatrices(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||v)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(v)}getPoseMatrix(){let v=null;return this._meshesWithPoseMatrix.length>0&&(v=this._meshesWithPoseMatrix[0].getPoseMatrix()),v}sortBones(){const v=[],y=new Array(this.bones.length);for(let n=0;n<this.bones.length;n++)this._sortBones(n,v,y);this.bones=v}_sortBones(v,y,n){if(n[v])return;n[v]=!0;const B=this.bones[v];if(!B)return;void 0===B._index&&(B._index=v);const J=B.getParent();J&&this._sortBones(this.bones.indexOf(J),y,n),y.push(B)}setCurrentPoseAsRest(){this.bones.forEach((v=>{v.setCurrentPoseAsRest()}))}}var E=n(11200),W=n(11050),s=n(11055),C=n(12284),r=n(12291),u=n(10908),O=n(11110);class d extends r.b{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(v){this.subSurface.refractionTexture=v,v?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(v){this.subSurface.indexOfRefraction=v}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(v){this.subSurface.invertRefractionY=v}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(v){this.subSurface.linkRefractionWithTransparency=v,v&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===r.b.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(v){v!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=v?r.b.LIGHTFALLOFF_PHYSICAL:r.b.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===r.b.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(v){v!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=v?r.b.LIGHTFALLOFF_GLTF:r.b.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(v){this._attachImageProcessingConfiguration(v),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(v){this.imageProcessingConfiguration.colorCurvesEnabled=v}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(v){this.imageProcessingConfiguration.colorGradingEnabled=v}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(v){this._imageProcessingConfiguration.toneMappingEnabled=v}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(v){this._imageProcessingConfiguration.exposure=v}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(v){this._imageProcessingConfiguration.contrast=v}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(v){this._imageProcessingConfiguration.colorGradingTexture=v}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(v){this._imageProcessingConfiguration.colorCurves=v}constructor(v,y){super(v,y,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=P.d.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new P.d(0,0,0),this.albedoColor=new P.d(1,1,1),this.reflectivityColor=new P.d(1,1,1),this.reflectionColor=new P.d(1,1,1),this.emissiveColor=new P.d(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,C.c)(this.va())}getClassName(){return"PBRMaterial"}clone(v){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const B=O.d.Clone((()=>new d(v,this.va())),this,{cloneTexturesOnlyOnce:y});return B.id=v,B.name=v,this.stencil.copyTo(B.stencil),this._clonePlugins(B,n),B}serialize(){const v=super.serialize();return v.customType="BABYLON.PBRMaterial",v}static Parse(v,y,n){const B=O.d.Parse((()=>new d(v.name,y)),v,y,n);return v.stencil&&B.stencil.parse(v.stencil,y,n),E.d._ParsePlugins(v,B,y,n),v.clearCoat&&B.clearCoat.parse(v.clearCoat,y,n),v.anisotropy&&B.anisotropy.parse(v.anisotropy,y,n),v.brdf&&B.brdf.parse(v.brdf,y,n),v.sheen&&B.sheen.parse(v.sheen,y,n),v.subSurface&&B.subSurface.parse(v.subSurface,y,n),v.iridescence&&B.iridescence.parse(v.iridescence,y,n),B}}d.PBRMATERIAL_OPAQUE=r.b.PBRMATERIAL_OPAQUE,d.PBRMATERIAL_ALPHATEST=r.b.PBRMATERIAL_ALPHATEST,d.PBRMATERIAL_ALPHABLEND=r.b.PBRMATERIAL_ALPHABLEND,d.PBRMATERIAL_ALPHATESTANDBLEND=r.b.PBRMATERIAL_ALPHATESTANDBLEND,d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=r.b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"directIntensity",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"emissiveIntensity",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"environmentIntensity",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"specularIntensity",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"disableBumpMap",void 0),(0,W.c)([(0,s.E)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"albedoTexture",void 0),(0,W.c)([(0,s.E)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"ambientTexture",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"ambientTextureStrength",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,W.c)([(0,s.E)(),(0,s.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],d.prototype,"opacityTexture",void 0),(0,W.c)([(0,s.E)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"reflectionTexture",void 0),(0,W.c)([(0,s.E)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"emissiveTexture",void 0),(0,W.c)([(0,s.E)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"reflectivityTexture",void 0),(0,W.c)([(0,s.E)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"metallicTexture",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"metallic",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"roughness",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"metallicF0Factor",void 0),(0,W.c)([(0,s.j)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"metallicReflectanceColor",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,W.c)([(0,s.E)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"metallicReflectanceTexture",void 0),(0,W.c)([(0,s.E)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"reflectanceTexture",void 0),(0,W.c)([(0,s.E)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"microSurfaceTexture",void 0),(0,W.c)([(0,s.E)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"bumpTexture",void 0),(0,W.c)([(0,s.E)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty",null)],d.prototype,"lightmapTexture",void 0),(0,W.c)([(0,s.j)("ambient"),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"ambientColor",void 0),(0,W.c)([(0,s.j)("albedo"),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"albedoColor",void 0),(0,W.c)([(0,s.j)("reflectivity"),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"reflectivityColor",void 0),(0,W.c)([(0,s.j)("reflection"),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"reflectionColor",void 0),(0,W.c)([(0,s.j)("emissive"),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"emissiveColor",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"microSurface",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useLightmapAsShadowmap",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],d.prototype,"useAlphaFromAlbedoTexture",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],d.prototype,"forceAlphaTest",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesAndMiscDirty")],d.prototype,"alphaCutOff",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useSpecularOverAlpha",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useAmbientInGrayScale",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,W.c)([(0,s.M)()],d.prototype,"usePhysicalLightFalloff",null),(0,W.c)([(0,s.M)()],d.prototype,"useGLTFLightFalloff",null),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useRadianceOverAlpha",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useObjectSpaceNormalMap",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useParallax",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useParallaxOcclusion",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"parallaxScaleBias",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsLightsDirty")],d.prototype,"disableLighting",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"forceIrradianceInFragment",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsLightsDirty")],d.prototype,"maxSimultaneousLights",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"invertNormalMapX",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"invertNormalMapY",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"twoSidedLighting",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useAlphaFresnel",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useLinearAlphaFresnel",void 0),(0,W.c)([(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"environmentBRDFTexture",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"forceNormalForward",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"enableSpecularAntiAliasing",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useHorizonOcclusion",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsTexturesDirty")],d.prototype,"useRadianceOcclusion",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsMiscDirty")],d.prototype,"unlit",void 0),(0,W.c)([(0,s.M)(),(0,s.d)("_markAllSubMeshesAsMiscDirty")],d.prototype,"applyDecalMapAfterDetailMap",void 0),(0,u.g)("BABYLON.PBRMaterial",d);var q=n(11281),L=n(11387),t=n(11127),G=n(11367),R=n(11383),F=n(11338);class S{get influence(){return this._influence}set influence(v){if(this._influence===v)return;const y=this._influence;this._influence=v,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===y||0===v)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(v){this._animationPropertiesOverride=v}constructor(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=v,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new Z.e,this._onDataLayoutChanged=new Z.e,this._animationPropertiesOverride=null,this.id=v,this._scene=n||i.b.LastCreatedScene,this.influence=y,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(v){const y=this.hasPositions;this._positions=v,y!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(v){const y=this.hasNormals;this._normals=v,y!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(v){const y=this.hasTangents;this._tangents=v,y!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(v){const y=this.hasUVs;this._uvs=v,y!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const v=O.d.Clone((()=>new S(this.name,this.influence,this._scene)),this);return v._positions=this._positions,v._normals=this._normals,v._tangents=this._tangents,v._uvs=this._uvs,v}serialize(){const v={};return v.name=this.name,v.influence=this.influence,v.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(v.id=this.id),this.hasNormals&&(v.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(v.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(v.Aa=Array.prototype.slice.call(this.getUVs())),O.d.AppendSerializedAnimations(this,v),v}getClassName(){return"MorphTarget"}static Parse(v,y){const n=new S(v.name,v.influence);if(n.setPositions(v.xa),null!=v.id&&(n.id=v.id),v.ya&&n.setNormals(v.ya),v.tangents&&n.setTangents(v.tangents),v.Aa&&n.setUVs(v.Aa),v.animations){for(let y=0;y<v.animations.length;y++){const B=v.animations[y],J=(0,u.d)("BABYLON.Animation");J&&n.animations.push(J.Parse(B))}v.autoAnimate&&y&&y.beginAnimation(n,v.autoAnimateFrom,v.autoAnimateTo,v.autoAnimateLoop,v.autoAnimateSpeed||1)}return n}static FromMesh(v,y,n){y||(y=v.name);const B=new S(y,n,v.va());return B.setPositions(v.getVerticesData(t.i.PositionKind)),v.isVerticesDataPresent(t.i.NormalKind)&&B.setNormals(v.getVerticesData(t.i.NormalKind)),v.isVerticesDataPresent(t.i.TangentKind)&&B.setTangents(v.getVerticesData(t.i.TangentKind)),v.isVerticesDataPresent(t.i.UVKind)&&B.setUVs(v.getVerticesData(t.i.UVKind)),B}}(0,W.c)([(0,s.M)()],S.prototype,"id",void 0);var w=n(11065),k=n(11919);class M{set areUpdatesFrozen(v){v?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new w.e(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,v||(v=i.b.LastCreatedScene),this._scene=v,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const v=this._scene.getEngine().getCaps();this._canUseTextureForTargets=v.canUseGLVertexID&&v.textureFloat&&v.maxVertexTextureImageUnits>0&&v.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(v){this._numMaxInfluencers!==v&&(this._numMaxInfluencers=v,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(v){this._useTextureToStoreTargets=v}get isUsingTextureForTargets(){var v;return M.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(v=this._scene)&&void 0!==v&&v.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(v){return this._activeTargets.data[v]}getTarget(v){return this._targets[v]}getTargetByName(v){for(const y of this._targets)if(y.name===v)return y;return null}addTarget(v){this._targets.push(v),this._targetInfluenceChangedObservers.push(v.onInfluenceChanged.add((v=>{this._syncActiveTargets(v)}))),this._targetDataLayoutChangedObservers.push(v._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(v){const y=this._targets.indexOf(v);y>=0&&(this._targets.splice(y,1),v.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(y,1)[0]),v._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(y,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(v)}_bind(v){v.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),v.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),v.setTexture("morphTargets",this._targetStoreTexture),v.setInt("morphTargetCount",this.numInfluencers)}clone(){const v=new M(this._scene);for(const y of this._targets)v.addTarget(y.clone());return v.enableNormalMorphing=this.enableNormalMorphing,v.enableTangentMorphing=this.enableTangentMorphing,v.enableUVMorphing=this.enableUVMorphing,v}serialize(){const v={};v.id=this.uniqueId,v.targets=[];for(const y of this._targets)v.targets.push(y.serialize());return v}_syncActiveTargets(v){if(this.areUpdatesFrozen)return;let y=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let n=-1;for(const B of this._targets){if(n++,0===B.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=M.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(B),this._morphTargetTextureIndices[y]=n,this._tempInfluences[y++]=B.influence,this._supportsNormals=this._supportsNormals&&B.hasNormals,this._supportsTangents=this._supportsTangents&&B.hasTangents,this._supportsUVs=this._supportsUVs&&B.hasUVs;const v=B.getPositions();if(v){const y=v.length/3;if(0===this._vertexCount)this._vertexCount=y;else if(this._vertexCount!==y)return void g.e.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==y&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,y)),this._influences&&this._influences.length===y||(this._influences=new Float32Array(y));for(let B=0;B<y;B++)this._influences[B]=this._tempInfluences[B];v&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const v=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>v&&(this._textureHeight=Math.ceil(this._textureWidth/v),this._textureWidth=v);let y=!0;if(this._targetStoreTexture){const v=this._targetStoreTexture.getSize();v.width===this._textureWidth&&v.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(y=!1)}if(y){this._targetStoreTexture&&this._targetStoreTexture.dispose();const v=this._targets.length,y=new Float32Array(v*this._textureWidth*this._textureHeight*4);let n=0;for(let B=0;B<v;B++){const v=this._targets[B],J=v.getPositions(),P=v.getNormals(),b=v.getUVs(),Y=v.getTangents();if(!J)return void(0===B&&g.e.Error("Invalid morph target. Target must have positions."));n=B*this._textureWidth*this._textureHeight*4;for(let B=0;B<this._vertexCount;B++)y[n]=J[3*B],y[n+1]=J[3*B+1],y[n+2]=J[3*B+2],n+=4,this._supportsNormals&&P&&(y[n]=P[3*B],y[n+1]=P[3*B+1],y[n+2]=P[3*B+2],n+=4),this._supportsUVs&&b&&(y[n]=b[2*B],y[n+1]=b[2*B+1],n+=4),this._supportsTangents&&Y&&(y[n]=Y[3*B],y[n+1]=Y[3*B+1],y[n+2]=Y[3*B+2],n+=4)}this._targetStoreTexture=k.c.CreateRGBATexture(y,this._textureWidth,this._textureHeight,v,this._scene,!1,!1,1,1)}}for(const v of this._scene.meshes)v.morphTargetManager===this&&v._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const v=this._parentContainer.morphTargetManagers.indexOf(this);v>-1&&this._parentContainer.morphTargetManagers.splice(v,1),this._parentContainer=null}for(const v of this._targets)this._scene.stopAnimation(v)}}static Parse(v,y){const n=new M(y);for(const B of v.targets)n.addTarget(S.Parse(B,y));return n}}M.EnableTextureStorage=!0,M.MaxActiveMorphTargetsInVertexAttributeMode=8;var I=n(12296),j=n(10828),V=n(11216);function p(v,y,n,B){return J.n.qh(y,n).scaleInPlace(B)}class H{constructor(v,y,n,B){this.type=v,this.name=y,this.getValue=n,this.getStride=B}_buildAnimation(v,y,n){const B=new f.c(v,this.name,y,this.type);return B.setKeys(n),B}}class A extends H{buildAnimations(v,y,n,B,J){J(v._babylonTransformNode,this._buildAnimation(y,n,B))}}const X={translation:[new A(f.c.ANIMATIONTYPE_VECTOR3,"position",p,(()=>3))],rotation:[new A(f.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(v,y,n,B){return J.g.qh(y,n).scaleInPlace(B)}),(()=>4))],scale:[new A(f.c.ANIMATIONTYPE_VECTOR3,"Be",p,(()=>3))],weights:[new class extends H{buildAnimations(v,y,n,B,J){if(v._numMorphTargets)for(let P=0;P<v._numMorphTargets;P++){const b=new f.c(`${y}_${P}`,this.name,n,this.type);if(b.setKeys(B.map((v=>({frame:v.frame,inTangent:v.inTangent?v.inTangent[P]:void 0,value:v.value[P],outTangent:v.outTangent?v.outTangent[P]:void 0,interpolation:v.interpolation})))),v._primitiveBabylonMeshes)for(const y of v._primitiveBabylonMeshes)if(y.morphTargetManager){const v=y.morphTargetManager.getTarget(P),n=b.clone();v.animations.push(n),J(v,n)}}}}(f.c.ANIMATIONTYPE_FLOAT,"influence",(function(v,y,n,B){const J=new Array(v._numMorphTargets);for(let P=0;P<J.length;P++)J[P]=y[n++]*B;return J}),(v=>v._numMorphTargets))]},U=new Map,z=U;function e(v,y,n){K(v)&&g.e.Warn(`Extension with the name '${v}' already exists`),U.set(v,{isGLTFExtension:y,factory:n})}function K(v){return U.delete(v)}function D(){const v=v=>v&&"object"===typeof v;for(var y=arguments.length,n=new Array(y),B=0;B<y;B++)n[B]=arguments[B];return n.reduce(((y,n)=>(Object.keys(n).forEach((B=>{const J=y[B],P=n[B];Array.isArray(J)&&Array.isArray(P)?y[B]=J.concat(...P):v(J)&&v(P)?y[B]=D(J,P):y[B]=P})),y)),{})}class Q{static Get(v,y,n){if(!y||void 0==n||!y[n])throw new Error(`${v}: Failed to find index (${n})`);return y[n]}static TryGet(v,y){return v&&void 0!=y&&v[y]?v[y]:null}static Assign(v){if(v)for(let y=0;y<v.length;y++)v[y].index=y}}class o{static RegisterExtension(v,y){e(v,!1,y)}static UnregisterExtension(v){return K(v)}get aj(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(v){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=v}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((v=>v.dispose&&v.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(v,y,n,B,J,P){let b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=y,this._assetContainer=n,this._loadData(B);let P=null;if(v){const y={};if(this._gltf.nodes)for(const v of this._gltf.nodes)v.name&&(y[v.name]=v.index);P=(v instanceof Array?v:[v]).map((v=>{const n=y[v];if(void 0===n)throw new Error(`Failed to find node '${v}'`);return n}))}return this._loadAsync(J,b,P,(()=>({meshes:this._getMeshes(),Ej:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=v,this._loadData(y),this._loadAsync(n,J,null,(()=>{})))))}_loadAsync(v,y,n,B){return Promise.resolve().then((async()=>{this._rootUrl=v,this._uniqueRootUrl=!v.startsWith("file:")&&y?v:`${v}${Date.now()}/`,this._fileName=y,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const J=`${I.n[I.n.LOADING]} => ${I.n[I.n.READY]}`,P=`${I.n[I.n.LOADING]} => ${I.n[I.n.COMPLETE]}`;this._parent._startPerformanceCounter(J),this._parent._startPerformanceCounter(P),this._parent._setState(I.n.LOADING),this._extensionsOnLoading();const Y=new Array;if(!this.parent.loadOnlyMaterials)if(n)Y.push(this.loadSceneAsync("/nodes",{nodes:n,index:-1}));else if(void 0!=this._gltf.$d||this._gltf.scenes&&this._gltf.scenes[0]){const v=Q.Get("/scene",this._gltf.scenes,this._gltf.$d||0);Y.push(this.loadSceneAsync(`/scenes/${v.index}`,v))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let v=0;v<this._gltf.materials.length;++v){const y=this._gltf.materials[v],n="/materials/"+v,B=E.d.TriangleFillMode;Y.push(this._loadMaterialAsync(n,y,null,B,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&Y.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&Y.push(this._compileShadowGeneratorsAsync());return Promise.all(Y).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Nb(!0),this._extensionsOnReady(),this._parent._setState(I.n.READY),this._startAnimations(),B()))).then((v=>(this._parent._endPerformanceCounter(J),b.g.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(P),this._parent._setState(I.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(v=>{this._parent.onErrorObservable.notifyObservers(v),this._parent.onErrorObservable.clear(),this.dispose()}))})),v)))})).catch((v=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(v),this._parent.onErrorObservable.clear(),this.dispose()),v}))}_loadData(v){if(this._gltf=v.json,this._setupData(),v.bin){const y=this._gltf.buffers;if(y&&y[0]&&!y[0].uri){const n=y[0];(n.byteLength<v.bin.byteLength-3||n.byteLength>v.bin.byteLength)&&g.e.Warn(`Binary buffer length (${n.byteLength}) from JSON does not match chunk length (${v.bin.byteLength})`),this._bin=v.bin}else g.e.Warn("Unexpected BIN chunk")}}_setupData(){if(Q.Assign(this._gltf.accessors),Q.Assign(this._gltf.animations),Q.Assign(this._gltf.buffers),Q.Assign(this._gltf.bufferViews),Q.Assign(this._gltf.cameras),Q.Assign(this._gltf.images),Q.Assign(this._gltf.materials),Q.Assign(this._gltf.meshes),Q.Assign(this._gltf.nodes),Q.Assign(this._gltf.samplers),Q.Assign(this._gltf.scenes),Q.Assign(this._gltf.skins),Q.Assign(this._gltf.textures),this._gltf.nodes){const v={};for(const n of this._gltf.nodes)if(n.children)for(const y of n.children)v[y]=n.index;const y=this._createRootNode();for(const n of this._gltf.nodes){const B=v[n.index];n.parent=void 0===B?y:this._gltf.nodes[B]}}}async _loadExtensionsAsync(){const v=[];if(z.forEach(((y,n)=>{var B;!1===(null===(B=this.parent.extensionOptions[n])||void 0===B?void 0:B.enabled)?y.isGLTFExtension&&this.isExtensionUsed(n)&&g.e.Warn(`Extension ${n} is used but has been explicitly disabled.`):y.isGLTFExtension&&!this.isExtensionUsed(n)||v.push((async()=>{const v=await y.factory(this);return v.name!==n&&g.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${v.name} !== ${n}`),this._parent.onExtensionLoadedObservable.notifyObservers(v),v})())})),this._extensions.push(...await Promise.all(v)),this._extensions.sort(((v,y)=>(v.order||Number.MAX_VALUE)-(y.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const n of this._gltf.extensionsRequired){if(!this._extensions.some((v=>v.name===n&&v.enabled))){var y;if(!1===(null===(y=this.parent.extensionOptions[n])||void 0===y?void 0:y.enabled))throw new Error(`Required extension ${n} is disabled`);throw new Error(`Required extension ${n} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new F.d("__root__",this._babylonScene);this._rootBabylonMesh=v,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Nb(!1);const y={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case I.j.AUTO:this._babylonScene.useRightHandedSystem||(y.rotation=[0,1,0,0],y.scale=[1,1,-1],o._LoadTransform(y,this._rootBabylonMesh));break;case I.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(v),y}loadSceneAsync(v,y){const n=this._extensionsLoadSceneAsync(v,y);if(n)return n;const B=new Array;if(this.logOpen(`${v} ${y.name||""}`),y.nodes)for(const J of y.nodes){const y=Q.Get(`${v}/nodes/${J}`,this._gltf.nodes,J);B.push(this.loadNodeAsync(`/nodes/${y.index}`,y,(v=>{v.parent=this._rootBabylonMesh})))}for(const J of this._postSceneLoadActions)J();return B.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(B).then((()=>{}))}_forEachPrimitive(v,y){if(v._primitiveBabylonMeshes)for(const n of v._primitiveBabylonMeshes)y(n)}_getGeometries(){const v=[],y=this._gltf.nodes;if(y)for(const n of y)this._forEachPrimitive(n,(y=>{const n=y.Rj;n&&-1===v.indexOf(n)&&v.push(n)}));return v}_getMeshes(){const v=[];this._rootBabylonMesh instanceof R.d&&v.push(this._rootBabylonMesh);const y=this._gltf.nodes;if(y)for(const n of y)this._forEachPrimitive(n,(y=>{v.push(y)}));return v}_getTransformNodes(){const v=[],y=this._gltf.nodes;if(y)for(const n of y)n._babylonTransformNode&&"tb"===n._babylonTransformNode.getClassName()&&v.push(n._babylonTransformNode),n._babylonTransformNodeForSkin&&v.push(n._babylonTransformNodeForSkin);return v}_getSkeletons(){const v=[],y=this._gltf.skins;if(y)for(const n of y)n._data&&v.push(n._data.babylonSkeleton);return v}_getAnimationGroups(){const v=[],y=this._gltf.animations;if(y)for(const n of y)n._babylonAnimationGroup&&v.push(n._babylonAnimationGroup);return v}_startAnimations(){switch(this._parent.animationStartMode){case I.f.NONE:break;case I.f.FIRST:{const v=this._getAnimationGroups();0!==v.length&&v[0].start(!0);break}case I.f.ALL:{const v=this._getAnimationGroups();for(const y of v)y.start(!0);break}default:return void g.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadNodeAsync(v,y,n);if(B)return B;if(y._babylonTransformNode)throw new Error(`${v}: Invalid recursive node hierarchy`);const J=new Array;this.logOpen(`${v} ${y.name||""}`);const P=B=>{if(o.AddPointerMetadata(B,v),o._LoadTransform(y,B),void 0!=y.camera){const n=Q.Get(`${v}/camera`,this._gltf.cameras,y.camera);J.push(this.loadCameraAsync(`/cameras/${n.index}`,n,(v=>{v.parent=B})))}if(y.children)for(const n of y.children){const y=Q.Get(`${v}/children/${n}`,this._gltf.nodes,n);J.push(this.loadNodeAsync(`/nodes/${y.index}`,y,(v=>{v.parent=B})))}n(B)},b=void 0!=y.mesh,Y=this._parent.loadSkins&&void 0!=y.skin;if(!b||Y){const v=y.name||`node${y.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new L.e(v,this._babylonScene);n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==y.mesh?y._babylonTransformNode=n:y._babylonTransformNodeForSkin=n,P(n)}if(b)if(Y){const n=Q.Get(`${v}/mesh`,this._gltf.meshes,y.mesh);J.push(this._loadMeshAsync(`/meshes/${n.index}`,y,n,(n=>{const B=y._babylonTransformNodeForSkin;n.metadata=D(B.metadata,n.metadata||{});const P=Q.Get(`${v}/skin`,this._gltf.skins,y.skin);J.push(this._loadSkinAsync(`/skins/${P.index}`,y,P,(v=>{this._forEachPrimitive(y,(y=>{y.skeleton=v})),this._postSceneLoadActions.push((()=>{if(void 0!=P.skeleton){const v=Q.Get(`/skins/${P.index}/skeleton`,this._gltf.nodes,P.skeleton).parent;y.index===v.index?n.parent=B.parent:n.parent=v._babylonTransformNode}else n.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:B,skinnedNode:n})}))})))})))}else{const n=Q.Get(`${v}/mesh`,this._gltf.meshes,y.mesh);J.push(this._loadMeshAsync(`/meshes/${n.index}`,y,n,P))}return this.logClose(),Promise.all(J).then((()=>(this._forEachPrimitive(y,(v=>{v.Rj&&v.Rj.useBoundingInfoFromGeometry?v.Ea():v.refreshBoundingInfo(!0,!0)})),y._babylonTransformNode)))}_loadMeshAsync(v,y,n,B){const J=n.primitives;if(!J||!J.length)throw new Error(`${v}: Primitives are missing`);void 0==J[0].index&&Q.Assign(J);const P=new Array;this.logOpen(`${v} ${n.name||""}`);const b=y.name||`node${y.index}`;if(1===J.length){const B=n.primitives[0];P.push(this._loadMeshPrimitiveAsync(`${v}/primitives/${B.index}`,b,y,n,B,(v=>{y._babylonTransformNode=v,y._primitiveBabylonMeshes=[v]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,y._babylonTransformNode=new L.e(b,this._babylonScene),y._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y._primitiveBabylonMeshes=[];for(const B of J)P.push(this._loadMeshPrimitiveAsync(`${v}/primitives/${B.index}`,`${b}_primitive${B.index}`,y,n,B,(v=>{v.parent=y._babylonTransformNode,y._primitiveBabylonMeshes.push(v)})))}return B(y._babylonTransformNode),this.logClose(),Promise.all(P).then((()=>y._babylonTransformNode))}_loadMeshPrimitiveAsync(v,y,n,B,J,P){const b=this._extensionsLoadMeshPrimitiveAsync(v,y,n,B,J,P);if(b)return b;this.logOpen(`${v}`);const Y=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==n.skin&&!B.primitives[0].targets;let l,a;if(Y&&J._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,l=J._instanceData.babylonSourceMesh.createInstance(y),l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a=J._instanceData.promise;else{const P=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new F.d(y,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b.sideOrientation=this._babylonScene.useRightHandedSystem?E.d.CounterClockWiseSideOrientation:E.d.ClockWiseSideOrientation,this._createMorphTargets(v,n,B,J,b),P.push(this._loadVertexDataAsync(v,J,b).then((y=>this._loadMorphTargetsAsync(v,J,b,y).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,y.Ca(b),y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const Z=o._GetDrawMode(v,J.mode);if(void 0==J.material){let v=this._defaultBabylonMaterialData[Z];v||(v=this._createDefaultMaterial("__GLTFLoader._default",Z),this._parent.onMaterialLoadedObservable.notifyObservers(v),this._defaultBabylonMaterialData[Z]=v),b.material=v}else if(!this.parent.skipMaterials){const y=Q.Get(`${v}/material`,this._gltf.materials,J.material);P.push(this._loadMaterialAsync(`/materials/${y.index}`,y,b,Z,(v=>{b.material=v})))}a=Promise.all(P),Y&&(J._instanceData={babylonSourceMesh:b,promise:a}),l=b}return o.AddPointerMetadata(l,v),this._parent.onMeshLoadedObservable.notifyObservers(l),P(l),this.logClose(),a.then((()=>l))}_loadVertexDataAsync(v,y,n){const B=this._extensionsLoadVertexDataAsync(v,y,n);if(B)return B;const P=y.attributes;if(!P)throw new Error(`${v}: Attributes are missing`);const b=new Array,Y=new G.b(n.name,this._babylonScene);if(void 0==y.indices)n.isUnIndexed=!0;else{const n=Q.Get(`${v}/indices`,this._gltf.accessors,y.indices);b.push(this._loadIndicesAccessorAsync(`/accessors/${n.index}`,n).then((v=>{Y.setIndices(v)})))}const l=(y,B,l)=>{if(void 0==P[y])return;n._delayInfo=n._delayInfo||[],-1===n._delayInfo.indexOf(B)&&n._delayInfo.push(B);const a=Q.Get(`${v}/attributes/${y}`,this._gltf.accessors,P[y]);b.push(this._loadVertexAccessorAsync(`/accessors/${a.index}`,a,B).then((v=>{if(v.getKind()===t.i.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!n.skeleton&&a.min&&a.max){const v=J.i.o[0].Ae(...a.min),y=J.i.o[1].Ae(...a.max);if(a.normalized&&5126!==a.componentType){let n=1;switch(a.componentType){case 5120:n=127;break;case 5121:n=255;break;case 5122:n=32767;break;case 5123:n=65535}const B=1/n;v.scaleInPlace(B),y.scaleInPlace(B)}Y._boundingInfo=new V.c(v,y),Y.useBoundingInfoFromGeometry=!0}Y.setVerticesBuffer(v,a.count)}))),B==t.i.MatricesIndicesExtraKind&&(n.numBoneInfluencers=8),l&&l(a)};return l("POSITION",t.i.PositionKind),l("NORMAL",t.i.NormalKind),l("TANGENT",t.i.TangentKind),l("TEXCOORD_0",t.i.UVKind),l("TEXCOORD_1",t.i.UV2Kind),l("TEXCOORD_2",t.i.UV3Kind),l("TEXCOORD_3",t.i.UV4Kind),l("TEXCOORD_4",t.i.UV5Kind),l("TEXCOORD_5",t.i.UV6Kind),l("JOINTS_0",t.i.MatricesIndicesKind),l("WEIGHTS_0",t.i.MatricesWeightsKind),l("JOINTS_1",t.i.MatricesIndicesExtraKind),l("WEIGHTS_1",t.i.MatricesWeightsExtraKind),l("COLOR_0",t.i.ColorKind,(v=>{"VEC4"===v.type&&(n.hasVertexAlpha=!0)})),Promise.all(b).then((()=>Y))}_createMorphTargets(v,y,n,B,J){if(!B.targets||!this._parent.loadMorphTargets)return;if(void 0==y._numMorphTargets)y._numMorphTargets=B.targets.length;else if(B.targets.length!==y._numMorphTargets)throw new Error(`${v}: Primitives do not have the same number of targets`);const P=n.extras?n.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,J.morphTargetManager=new M(this._babylonScene),J.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J.morphTargetManager.areUpdatesFrozen=!0;for(let b=0;b<B.targets.length;b++){const v=y.weights?y.weights[b]:n.weights?n.weights[b]:0,B=P?P[b]:`morphTarget${b}`;J.morphTargetManager.addTarget(new S(B,v,J.va()))}}_loadMorphTargetsAsync(v,y,n,B){if(!y.targets||!this._parent.loadMorphTargets)return Promise.resolve();const J=new Array,P=n.morphTargetManager;for(let b=0;b<P.numTargets;b++){const n=P.getTarget(b);J.push(this._loadMorphTargetVertexDataAsync(`${v}/targets/${b}`,B,y.targets[b],n))}return Promise.all(J).then((()=>{P.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(v,y,n,B){const J=new Array,P=(B,P,b)=>{if(void 0==n[B])return;const Y=y.getVertexBuffer(P);if(!Y)return;const l=Q.Get(`${v}/${B}`,this._gltf.accessors,n[B]);J.push(this._loadFloatAccessorAsync(`/accessors/${l.index}`,l).then((v=>{b(Y,v)})))};return P("POSITION",t.i.PositionKind,((v,y)=>{const n=new Float32Array(y.length);v.forEach(y.length,((v,B)=>{n[B]=y[B]+v})),B.setPositions(n)})),P("NORMAL",t.i.NormalKind,((v,y)=>{const n=new Float32Array(y.length);v.forEach(n.length,((v,B)=>{n[B]=y[B]+v})),B.setNormals(n)})),P("TANGENT",t.i.TangentKind,((v,y)=>{const n=new Float32Array(y.length/3*4);let J=0;v.forEach(y.length/3*4,((v,B)=>{(B+1)%4!==0&&(n[J]=y[J]+v,J++)})),B.setTangents(n)})),Promise.all(J).then((()=>{}))}static _LoadTransform(v,y){if(void 0!=v.skin)return;let n=J.n.Zero(),B=J.g.Identity(),P=J.n.One();if(v.matrix){J.d.qh(v.matrix).decompose(P,B,n)}else v.translation&&(n=J.n.qh(v.translation)),v.rotation&&(B=J.g.qh(v.rotation)),v.scale&&(P=J.n.qh(v.scale));y.position=n,y.rotationQuaternion=B,y.Be=P}_loadSkinAsync(v,y,n,B){if(!this._parent.loadSkins)return Promise.resolve();const J=this._extensionsLoadSkinAsync(v,y,n);if(J)return J;if(n._data)return B(n._data.babylonSkeleton),n._data.promise;const P=`skeleton${n.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new h(n.name||P,P,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(v,n,b);const Y=this._loadSkinInverseBindMatricesDataAsync(v,n).then((v=>{this._updateBoneMatrices(b,v)}));return n._data={babylonSkeleton:b,promise:Y},B(b),Y}_loadBones(v,y,n){if(void 0==y.skeleton||this._parent.alwaysComputeSkeletonRootNode){const n=this._findSkeletonRootNode(`${v}/joints`,y.joints);if(n)if(void 0===y.skeleton)y.skeleton=n.index;else{const B=(v,y)=>{for(;y.parent;y=y.parent)if(y.parent===v)return!0;return!1},J=Q.Get(`${v}/skeleton`,this._gltf.nodes,y.skeleton);J===n||B(J,n)||(g.e.Warn(`${v}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),y.skeleton=n.index)}else g.e.Warn(`${v}: Failed to find common root`)}const B={};for(const J of y.joints){const P=Q.Get(`${v}/joints/${J}`,this._gltf.nodes,J);this._loadBone(P,y,n,B)}}_findSkeletonRootNode(v,y){if(0===y.length)return null;const n={};for(const J of y){const y=[];let B=Q.Get(`${v}/${J}`,this._gltf.nodes,J);for(;-1!==B.index;)y.unshift(B),B=B.parent;n[J]=y}let B=null;for(let J=0;;++J){let v=n[y[0]];if(J>=v.length)return B;const P=v[J];for(let b=1;b<y.length;++b)if(v=n[y[b]],J>=v.length||P!==v[J])return B;B=P}}_loadBone(v,y,n,B){v._isJoint=!0;let J=B[v.index];if(J)return J;let P=null;v.index!==y.skeleton&&(v.parent&&-1!==v.parent.index?P=this._loadBone(v.parent,y,n,B):void 0!==y.skeleton&&g.e.Warn(`/skins/${y.index}/skeleton: Skeleton node is not a common root`));const b=y.joints.indexOf(v.index);return J=new a.c(v.name||`joint${v.index}`,n,P,this._getNodeMatrix(v),null,null,b),B[v.index]=J,this._postSceneLoadActions.push((()=>{J.linkTransformNode(v._babylonTransformNode)})),J}_loadSkinInverseBindMatricesDataAsync(v,y){if(void 0==y.inverseBindMatrices)return Promise.resolve(null);const n=Q.Get(`${v}/inverseBindMatrices`,this._gltf.accessors,y.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${n.index}`,n)}_updateBoneMatrices(v,y){for(const n of v.bones){const v=J.d.Identity(),B=n._index;y&&-1!==B&&(J.d.FromArrayToRef(y,16*B,v),v.invertToRef(v));const P=n.getParent();P&&v.multiplyToRef(P.getAbsoluteInverseBindMatrix(),v),n.Vj(v,!1,!1),n._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(v){return v.matrix?J.d.qh(v.matrix):J.d.Compose(v.scale?J.n.qh(v.scale):J.n.One(),v.rotation?J.g.qh(v.rotation):J.g.Identity(),v.translation?J.n.qh(v.translation):J.n.Zero())}loadCameraAsync(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadCameraAsync(v,y,n);if(B)return B;const P=new Array;this.logOpen(`${v} ${y.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new l.b(y.name||`camera${y.index}`,J.n.Zero(),this._babylonScene,!1);switch(b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b.ignoreParentScaling=!0,y._babylonCamera=b,b.rotation.set(0,Math.PI,0),y.type){case"perspective":{const n=y.perspective;if(!n)throw new Error(`${v}: Camera perspective properties are missing`);b.fov=n.yfov,b.ij=n.znear,b.maxZ=n.zfar||0;break}case"orthographic":if(!y.orthographic)throw new Error(`${v}: Camera orthographic properties are missing`);b.mode=Y.c.ORTHOGRAPHIC_CAMERA,b.orthoLeft=-y.orthographic.xmag,b.orthoRight=y.orthographic.xmag,b.orthoBottom=-y.orthographic.ymag,b.orthoTop=y.orthographic.ymag,b.ij=y.orthographic.znear,b.maxZ=y.orthographic.zfar;break;default:throw new Error(`${v}: Invalid camera type (${y.type})`)}return o.AddPointerMetadata(b,v),this._parent.onCameraLoadedObservable.notifyObservers(b),n(b),this.logClose(),Promise.all(P).then((()=>b))}_loadAnimationsAsync(){const v=this._gltf.animations;if(!v)return Promise.resolve();const y=new Array;for(let n=0;n<v.length;n++){const B=v[n];y.push(this.loadAnimationAsync(`/animations/${B.index}`,B).then((v=>{0===v.targetedAnimations.length&&v.dispose()})))}return Promise.all(y).then((()=>{}))}loadAnimationAsync(v,y){const B=this._extensionsLoadAnimationAsync(v,y);return B||n.e(38).then(n.bind(n,13570)).then((n=>{let{AnimationGroup:B}=n;this._babylonScene._blockEntityCollection=!!this._assetContainer;const J=new B(y.name||`animation${y.index}`,this._babylonScene);J._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y._babylonAnimationGroup=J;const P=new Array;Q.Assign(y.channels),Q.Assign(y.samplers);for(const b of y.channels)P.push(this._loadAnimationChannelAsync(`${v}/channels/${b.index}`,v,y,b,((v,y)=>{v.animations=v.animations||[],v.animations.push(y),J.addTargetedAnimation(y,v)})));return Promise.all(P).then((()=>(J.normalize(0),J)))}))}_loadAnimationChannelAsync(v,y,n,B,J){const P=this._extensionsLoadAnimationChannelAsync(v,y,n,B,J);if(P)return P;if(void 0==B.target.node)return Promise.resolve();const b=Q.Get(`${v}/target/node`,this._gltf.nodes,B.target.node),Y=B.target.path,l="weights"===Y;if(l&&!b._numMorphTargets||!l&&!b._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!l&&!b._isJoint)return Promise.resolve();let a;switch(Y){case"translation":a=X.translation;break;case"rotation":a=X.rotation;break;case"scale":a=X.scale;break;case"weights":a=X.weights;break;default:throw new Error(`${v}/target/path: Invalid value (${B.target.path})`)}const Z={object:b,info:a};return this._loadAnimationChannelFromTargetInfoAsync(v,y,n,B,Z,J)}_loadAnimationChannelFromTargetInfoAsync(v,y,n,B,J,P){const b=this.parent.targetFps,Y=1/b,l=Q.Get(`${v}/sampler`,n.samplers,B.sampler);return this._loadAnimationSamplerAsync(`${y}/samplers/${B.sampler}`,l).then((v=>{let y=0;const l=J.object,a=J.info;for(const J of a){const a=J.getStride(l),Z=v.input,x=v.output,f=new Array(Z.length);let N=0;switch(v.interpolation){case"STEP":for(let v=0;v<Z.length;v++){const y=J.getValue(l,x,N,1);N+=a,f[v]={frame:Z[v]*b,value:y,interpolation:1}}break;case"CUBICSPLINE":for(let v=0;v<Z.length;v++){const y=J.getValue(l,x,N,Y);N+=a;const n=J.getValue(l,x,N,1);N+=a;const B=J.getValue(l,x,N,Y);N+=a,f[v]={frame:Z[v]*b,inTangent:y,value:n,outTangent:B}}break;case"LINEAR":for(let v=0;v<Z.length;v++){const y=J.getValue(l,x,N,1);N+=a,f[v]={frame:Z[v]*b,value:y}}}if(N>0){const v=`${n.name||`animation${n.index}`}_channel${B.index}_${y}`;J.buildAnimations(l,v,b,f,((v,n)=>{++y,P(v,n)}))}}}))}_loadAnimationSamplerAsync(v,y){if(y._data)return y._data;const n=y.interpolation||"LINEAR";switch(n){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${v}/interpolation: Invalid value (${y.interpolation})`)}const B=Q.Get(`${v}/input`,this._gltf.accessors,y.input),J=Q.Get(`${v}/output`,this._gltf.accessors,y.output);return y._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${B.index}`,B),this._loadFloatAccessorAsync(`/accessors/${J.index}`,J)]).then((v=>{let[y,B]=v;return{input:y,interpolation:n,output:B}})),y._data}loadBufferAsync(v,y,n,B){const J=this._extensionsLoadBufferAsync(v,y,n,B);if(J)return J;if(!y._data)if(y.uri)y._data=this.loadUriAsync(`${v}/uri`,y,y.uri);else{if(!this._bin)throw new Error(`${v}: Uri is missing or the binary glTF is missing its binary chunk`);y._data=this._bin.readAsync(0,y.byteLength)}return y._data.then((y=>{try{return new Uint8Array(y.buffer,y.byteOffset+n,B)}catch(J){throw new Error(`${v}: ${J.message}`)}}))}loadBufferViewAsync(v,y){const n=this._extensionsLoadBufferViewAsync(v,y);if(n)return n;if(y._data)return y._data;const B=Q.Get(`${v}/buffer`,this._gltf.buffers,y.buffer);return y._data=this.loadBufferAsync(`/buffers/${B.index}`,B,y.byteOffset||0,y.byteLength),y._data}_loadAccessorAsync(v,y,n){if(y._data)return y._data;const B=o._GetNumComponents(v,y.type),J=B*t.i.GetTypeByteLength(y.componentType),P=B*y.count;if(void 0==y.bufferView)y._data=Promise.resolve(new n(P));else{const b=Q.Get(`${v}/bufferView`,this._gltf.bufferViews,y.bufferView);y._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b).then((Y=>{if(5126!==y.componentType||y.normalized||b.byteStride&&b.byteStride!==J){const v=new n(P);return t.i.ForEach(Y,y.byteOffset||0,b.byteStride||J,B,y.componentType,v.length,y.normalized||!1,((y,n)=>{v[n]=y})),v}return o._GetTypedArray(v,y.componentType,Y,y.byteOffset,P)}))}if(y.sparse){const P=y.sparse;y._data=y._data.then((b=>{const Y=b,l=Q.Get(`${v}/sparse/indices/bufferView`,this._gltf.bufferViews,P.indices.bufferView),a=Q.Get(`${v}/sparse/values/bufferView`,this._gltf.bufferViews,P.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${l.index}`,l),this.loadBufferViewAsync(`/bufferViews/${a.index}`,a)]).then((b=>{let[l,a]=b;const Z=o._GetTypedArray(`${v}/sparse/indices`,P.indices.componentType,l,P.indices.byteOffset,P.count),x=B*P.count;let f;if(5126!==y.componentType||y.normalized){const b=o._GetTypedArray(`${v}/sparse/values`,y.componentType,a,P.values.byteOffset,x);f=new n(x),t.i.ForEach(b,0,J,B,y.componentType,f.length,y.normalized||!1,((v,y)=>{f[y]=v}))}else f=o._GetTypedArray(`${v}/sparse/values`,y.componentType,a,P.values.byteOffset,x);let N=0;for(let v=0;v<Z.length;v++){let y=Z[v]*B;for(let v=0;v<B;v++)Y[y++]=f[N++]}return Y}))}))}return y._data}_loadFloatAccessorAsync(v,y){return this._loadAccessorAsync(v,y,Float32Array)}_loadIndicesAccessorAsync(v,y){if("SCALAR"!==y.type)throw new Error(`${v}/type: Invalid value ${y.type}`);if(5121!==y.componentType&&5123!==y.componentType&&5125!==y.componentType)throw new Error(`${v}/componentType: Invalid value ${y.componentType}`);if(y._data)return y._data;if(y.sparse){const n=o._GetTypedArrayConstructor(`${v}/componentType`,y.componentType);y._data=this._loadAccessorAsync(v,y,n)}else{const n=Q.Get(`${v}/bufferView`,this._gltf.bufferViews,y.bufferView);y._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n).then((n=>o._GetTypedArray(v,y.componentType,n,y.byteOffset,y.count)))}return y._data}_loadVertexBufferViewAsync(v){if(v._babylonBuffer)return v._babylonBuffer;const y=this._babylonScene.getEngine();return v._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${v.index}`,v).then((v=>new t.e(y,v,!1))),v._babylonBuffer}_loadVertexAccessorAsync(v,y,n){var B;if(null!==(B=y._babylonVertexBuffer)&&void 0!==B&&B[n])return y._babylonVertexBuffer[n];y._babylonVertexBuffer||(y._babylonVertexBuffer={});const J=this._babylonScene.getEngine();if(y.sparse||void 0==y.bufferView)y._babylonVertexBuffer[n]=this._loadFloatAccessorAsync(v,y).then((v=>new t.i(J,v,n,!1)));else{const B=Q.Get(`${v}/bufferView`,this._gltf.bufferViews,y.bufferView);y._babylonVertexBuffer[n]=this._loadVertexBufferViewAsync(B).then((P=>{const b=o._GetNumComponents(v,y.type);return new t.i(J,P,n,!1,void 0,B.byteStride,void 0,y.byteOffset,b,y.componentType,y.normalized,!0,void 0,!0)}))}return y._babylonVertexBuffer[n]}_loadMaterialMetallicRoughnessPropertiesAsync(v,y,n){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);const B=new Array;return y&&(y.baseColorFactor?(n.albedoColor=P.d.qh(y.baseColorFactor),n.alpha=y.baseColorFactor[3]):n.albedoColor=P.d.White(),n.metallic=void 0==y.metallicFactor?1:y.metallicFactor,n.roughness=void 0==y.roughnessFactor?1:y.roughnessFactor,y.baseColorTexture&&B.push(this.loadTextureInfoAsync(`${v}/baseColorTexture`,y.baseColorTexture,(v=>{v.name=`${n.name} (Base Color)`,n.albedoTexture=v}))),y.metallicRoughnessTexture&&(y.metallicRoughnessTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${v}/metallicRoughnessTexture`,y.metallicRoughnessTexture,(v=>{v.name=`${n.name} (Metallic Roughness)`,n.metallicTexture=v}))),n.useMetallnessFromMetallicTextureBlue=!0,n.useRoughnessFromMetallicTextureGreen=!0,n.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(B).then((()=>{}))}_loadMaterialAsync(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const P=this._extensionsLoadMaterialAsync(v,y,n,B,J);if(P)return P;y._data=y._data||{};let b=y._data[B];if(!b){this.logOpen(`${v} ${y.name||""}`);const n=this.createMaterial(v,y,B);b={babylonMaterial:n,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(v,y,n)},y._data[B]=b,o.AddPointerMetadata(n,v),this._parent.onMaterialLoadedObservable.notifyObservers(n),this.logClose()}return n&&(b.babylonMeshes.push(n),n.xj.addOnce((()=>{const v=b.babylonMeshes.indexOf(n);-1!==v&&b.babylonMeshes.splice(v,1)}))),J(b.babylonMaterial),b.promise.then((()=>b.babylonMaterial))}_createDefaultMaterial(v,y){this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new d(v,this._babylonScene);return n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.fillMode=y,n.enableSpecularAntiAliasing=!0,n.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,n.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,n.transparencyMode=d.PBRMATERIAL_OPAQUE,n.metallic=1,n.roughness=1,n}createMaterial(v,y,n){const B=this._extensionsCreateMaterial(v,y,n);if(B)return B;const J=y.name||`material${y.index}`;return this._createDefaultMaterial(J,n)}loadMaterialPropertiesAsync(v,y,n){const B=this._extensionsLoadMaterialPropertiesAsync(v,y,n);if(B)return B;const J=new Array;return J.push(this.loadMaterialBasePropertiesAsync(v,y,n)),y.pbrMetallicRoughness&&J.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${v}/pbrMetallicRoughness`,y.pbrMetallicRoughness,n)),this.loadMaterialAlphaProperties(v,y,n),Promise.all(J).then((()=>{}))}loadMaterialBasePropertiesAsync(v,y,n){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);const B=new Array;return n.emissiveColor=y.emissiveFactor?P.d.qh(y.emissiveFactor):new P.d(0,0,0),y.doubleSided&&(n.Ch=!1,n.twoSidedLighting=!0),y.normalTexture&&(y.normalTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${v}/normalTexture`,y.normalTexture,(v=>{v.name=`${n.name} (Normal)`,n.bumpTexture=v}))),n.invertNormalMapX=!this._babylonScene.useRightHandedSystem,n.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=y.normalTexture.scale&&n.bumpTexture&&(n.bumpTexture.level=y.normalTexture.scale),n.forceIrradianceInFragment=!0),y.occlusionTexture&&(y.occlusionTexture.nonColorData=!0,B.push(this.loadTextureInfoAsync(`${v}/occlusionTexture`,y.occlusionTexture,(v=>{v.name=`${n.name} (Occlusion)`,n.ambientTexture=v}))),n.useAmbientInGrayScale=!0,void 0!=y.occlusionTexture.strength&&(n.ambientTextureStrength=y.occlusionTexture.strength)),y.emissiveTexture&&B.push(this.loadTextureInfoAsync(`${v}/emissiveTexture`,y.emissiveTexture,(v=>{v.name=`${n.name} (Emissive)`,n.emissiveTexture=v}))),Promise.all(B).then((()=>{}))}loadMaterialAlphaProperties(v,y,n){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);switch(y.alphaMode||"OPAQUE"){case"OPAQUE":n.transparencyMode=d.PBRMATERIAL_OPAQUE,n.alpha=1;break;case"MASK":n.transparencyMode=d.PBRMATERIAL_ALPHATEST,n.alphaCutOff=void 0==y.alphaCutoff?.5:y.alphaCutoff,n.albedoTexture&&(n.albedoTexture.Pe=!0);break;case"BLEND":n.transparencyMode=d.PBRMATERIAL_ALPHABLEND,n.albedoTexture&&(n.albedoTexture.Pe=!0,n.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${v}/alphaMode: Invalid value (${y.alphaMode})`)}}loadTextureInfoAsync(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadTextureInfoAsync(v,y,n);if(B)return B;if(this.logOpen(`${v}`),y.texCoord>=6)throw new Error(`${v}/texCoord: Invalid value (${y.texCoord})`);const J=Q.Get(`${v}/index`,this._gltf.textures,y.index);J._textureInfo=y;const P=this._loadTextureAsync(`/textures/${y.index}`,J,(B=>{B.coordinatesIndex=y.texCoord||0,o.AddPointerMetadata(B,v),this._parent.onTextureLoadedObservable.notifyObservers(B),n(B)}));return this.logClose(),P}_loadTextureAsync(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const B=this._extensionsLoadTextureAsync(v,y,n);if(B)return B;this.logOpen(`${v} ${y.name||""}`);const J=void 0==y.sampler?o.DefaultSampler:Q.Get(`${v}/sampler`,this._gltf.samplers,y.sampler),P=Q.Get(`${v}/source`,this._gltf.images,y.source),b=this._createTextureAsync(v,J,P,n,void 0,!y._textureInfo.nonColorData);return this.logClose(),b}_createTextureAsync(v,y,n){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},P=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0;const Y=this._loadSampler(`/samplers/${y.index}`,y),l=new Array,a=new B;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z={noMipmap:Y.noMipMaps,invertY:!1,samplingMode:Y.samplingMode,X:()=>{this._disposed||a.resolve()},onError:(y,n)=>{this._disposed||a.reject(new Error(`${v}: ${n&&n.message?n.message:y||"Failed to load texture"}`))},mimeType:n.mimeType,loaderOptions:P,useSRGBBuffer:!!b&&this._parent.useSRGBBuffers},x=new q.b(null,this._babylonScene,Z);return x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.push(a.promise),l.push(this.loadImageAsync(`/images/${n.index}`,n).then((v=>{const y=n.uri||`${this._fileName}#image${n.index}`,B=`data:${this._uniqueRootUrl}${y}`;x.updateURL(B,v);const J=x.getInternalTexture();J&&(J.label=n.name)}))),x.wrapU=Y.wrapU,x.wrapV=Y.wrapV,J(x),this._parent.useGltfTextureNames&&(x.name=n.name||n.uri||`image${n.index}`),Promise.all(l).then((()=>x))}_loadSampler(v,y){return y._data||(y._data={noMipMaps:9728===y.minFilter||9729===y.minFilter,samplingMode:o._GetTextureSamplingMode(v,y),wrapU:o._GetTextureWrapMode(`${v}/wrapS`,y.wrapS),wrapV:o._GetTextureWrapMode(`${v}/wrapT`,y.wrapT)}),y._data}loadImageAsync(v,y){if(!y._data){if(this.logOpen(`${v} ${y.name||""}`),y.uri)y._data=this.loadUriAsync(`${v}/uri`,y,y.uri);else{const n=Q.Get(`${v}/bufferView`,this._gltf.bufferViews,y.bufferView);y._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n)}this.logClose()}return y._data}loadUriAsync(v,y,n){const B=this._extensionsLoadUriAsync(v,y,n);if(B)return B;if(!o._ValidateUri(n))throw new Error(`${v}: '${n}' is invalid`);if((0,j.i)(n)){const y=new Uint8Array((0,j.e)(n));return this.log(`${v}: Decoded ${n.substring(0,64)}... (${y.length} bytes)`),Promise.resolve(y)}return this.log(`${v}: Loading ${n}`),this._parent.preprocessUrlAsync(this._rootUrl+n).then((y=>new Promise(((B,J)=>{this._parent._loadFile(this._babylonScene,y,(y=>{this._disposed||(this.log(`${v}: Loaded ${n} (${y.byteLength} bytes)`),B(new Uint8Array(y)))}),!0,(y=>{J(new j.m(`${v}: Failed to load '${n}'${y?": "+y.status+" "+y.statusText:""}`,y))}))}))))}static AddPointerMetadata(v,y){v.metadata=v.metadata||{};const n=v._internalMetadata=v._internalMetadata||{},B=n.aj=n.aj||{};(B.pointers=B.pointers||[]).push(y)}static _GetTextureWrapMode(v,y){switch(y=void 0==y?10497:y){case 33071:return q.b.CLAMP_ADDRESSMODE;case 33648:return q.b.MIRROR_ADDRESSMODE;case 10497:return q.b.WRAP_ADDRESSMODE;default:return g.e.Warn(`${v}: Invalid value (${y})`),q.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(v,y){const n=void 0==y.magFilter?9729:y.magFilter,B=void 0==y.minFilter?9987:y.minFilter;if(9729===n)switch(B){case 9728:return q.b.LINEAR_NEAREST;case 9729:return q.b.LINEAR_LINEAR;case 9984:return q.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return q.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return q.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return q.b.LINEAR_LINEAR_MIPLINEAR;default:return g.e.Warn(`${v}/minFilter: Invalid value (${B})`),q.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==n&&g.e.Warn(`${v}/magFilter: Invalid value (${n})`),B){case 9728:return q.b.NEAREST_NEAREST;case 9729:return q.b.NEAREST_LINEAR;case 9984:return q.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return q.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return q.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return q.b.NEAREST_LINEAR_MIPLINEAR;default:return g.e.Warn(`${v}/minFilter: Invalid value (${B})`),q.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(v,y){switch(y){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${v}: Invalid component type ${y}`)}}static _GetTypedArray(v,y,n,B,J){const P=n.buffer;B=n.byteOffset+(B||0);const b=o._GetTypedArrayConstructor(`${v}/componentType`,y),Y=t.i.GetTypeByteLength(y);return B%Y!==0?(g.e.Warn(`${v}: Copying buffer as byte offset (${B}) is not a multiple of component type byte length (${Y})`),new b(P.slice(B,B+J*Y),0)):new b(P,B,J)}static _GetNumComponents(v,y){switch(y){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${v}: Invalid type (${y})`)}static _ValidateUri(v){return b.g.IsBase64(v)||-1===v.indexOf("..")}static _GetDrawMode(v,y){switch(void 0==y&&(y=4),y){case 0:return E.d.PointListDrawMode;case 1:return E.d.LineListDrawMode;case 2:return E.d.LineLoopDrawMode;case 3:return E.d.LineStripDrawMode;case 4:return E.d.TriangleFillMode;case 5:return E.d.TriangleStripDrawMode;case 6:return E.d.TriangleFanDrawMode}throw new Error(`${v}: Invalid mesh primitive mode (${y})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const v=new Array;if(this._gltf.materials)for(const y of this._gltf.materials)if(y._data)for(const n in y._data){const B=y._data[n];for(const y of B.babylonMeshes){y.ak(!0);const n=B.babylonMaterial;v.push(n.forceCompilationAsync(y)),v.push(n.forceCompilationAsync(y,{useInstances:!0})),this._parent.useClipPlane&&(v.push(n.forceCompilationAsync(y,{clipPlane:!0})),v.push(n.forceCompilationAsync(y,{clipPlane:!0,useInstances:!0})))}}return Promise.all(v).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const v=new Array,y=this._babylonScene.lights;for(const n of y){const y=n.getShadowGenerator();y&&v.push(y.forceCompilationAsync())}return Promise.all(v).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(v){for(const y of this._extensions)y.enabled&&v(y)}_applyExtensions(v,y,n){for(const B of this._extensions)if(B.enabled){const J=`${B.name}.${y}`,P=v;P._activeLoaderExtensionFunctions=P._activeLoaderExtensionFunctions||{};const b=P._activeLoaderExtensionFunctions;if(!b[J]){b[J]=!0;try{const v=n(B);if(v)return v}finally{delete b[J]}}}return null}_extensionsOnLoading(){this._forEachExtensions((v=>v.onLoading&&v.onLoading()))}_extensionsOnReady(){this._forEachExtensions((v=>v.onReady&&v.onReady()))}_extensionsLoadSceneAsync(v,y){return this._applyExtensions(y,"loadScene",(n=>n.loadSceneAsync&&n.loadSceneAsync(v,y)))}_extensionsLoadNodeAsync(v,y,n){return this._applyExtensions(y,"loadNode",(B=>B.loadNodeAsync&&B.loadNodeAsync(v,y,n)))}_extensionsLoadCameraAsync(v,y,n){return this._applyExtensions(y,"loadCamera",(B=>B.loadCameraAsync&&B.loadCameraAsync(v,y,n)))}_extensionsLoadVertexDataAsync(v,y,n){return this._applyExtensions(y,"loadVertexData",(B=>B._loadVertexDataAsync&&B._loadVertexDataAsync(v,y,n)))}_extensionsLoadMeshPrimitiveAsync(v,y,n,B,J,P){return this._applyExtensions(J,"loadMeshPrimitive",(b=>b._loadMeshPrimitiveAsync&&b._loadMeshPrimitiveAsync(v,y,n,B,J,P)))}_extensionsLoadMaterialAsync(v,y,n,B,J){return this._applyExtensions(y,"loadMaterial",(P=>P._loadMaterialAsync&&P._loadMaterialAsync(v,y,n,B,J)))}_extensionsCreateMaterial(v,y,n){return this._applyExtensions(y,"createMaterial",(B=>B.createMaterial&&B.createMaterial(v,y,n)))}_extensionsLoadMaterialPropertiesAsync(v,y,n){return this._applyExtensions(y,"loadMaterialProperties",(B=>B.loadMaterialPropertiesAsync&&B.loadMaterialPropertiesAsync(v,y,n)))}_extensionsLoadTextureInfoAsync(v,y,n){return this._applyExtensions(y,"loadTextureInfo",(B=>B.loadTextureInfoAsync&&B.loadTextureInfoAsync(v,y,n)))}_extensionsLoadTextureAsync(v,y,n){return this._applyExtensions(y,"loadTexture",(B=>B._loadTextureAsync&&B._loadTextureAsync(v,y,n)))}_extensionsLoadAnimationAsync(v,y){return this._applyExtensions(y,"loadAnimation",(n=>n.loadAnimationAsync&&n.loadAnimationAsync(v,y)))}_extensionsLoadAnimationChannelAsync(v,y,n,B,J){return this._applyExtensions(n,"loadAnimationChannel",(P=>P._loadAnimationChannelAsync&&P._loadAnimationChannelAsync(v,y,n,B,J)))}_extensionsLoadSkinAsync(v,y,n){return this._applyExtensions(n,"loadSkin",(B=>B._loadSkinAsync&&B._loadSkinAsync(v,y,n)))}_extensionsLoadUriAsync(v,y,n){return this._applyExtensions(y,"loadUri",(B=>B._loadUriAsync&&B._loadUriAsync(v,y,n)))}_extensionsLoadBufferViewAsync(v,y){return this._applyExtensions(y,"loadBufferView",(n=>n.loadBufferViewAsync&&n.loadBufferViewAsync(v,y)))}_extensionsLoadBufferAsync(v,y,n,B){return this._applyExtensions(y,"loadBuffer",(J=>J.loadBufferAsync&&J.loadBufferAsync(v,y,n,B)))}static LoadExtensionAsync(v,y,n,B){if(!y.extensions)return null;const J=y.extensions[n];return J?B(`${v}/extensions/${n}`,J):null}static LoadExtraAsync(v,y,n,B){if(!y.extras)return null;const J=y.extras[n];return J?B(`${v}/extras/${n}`,J):null}isExtensionUsed(v){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(v)}logOpen(v){this._parent._logOpen(v)}logClose(){this._parent._logClose()}log(v){this._parent._log(v)}startPerformanceCounter(v){this._parent._startPerformanceCounter(v)}endPerformanceCounter(v){this._parent._endPerformanceCounter(v)}}o.DefaultSampler={index:-1},I.c._CreateGLTF2Loader=v=>new o(v);var T=n(11559),m=n(12319),vv=n(12330);class yv extends vv.c{constructor(v,y,n){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",v),this._texture=v.getEngine().createRawCubeTexture(y,n,B,J,P,b,Y,l)}update(v,y,n,B){let J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,v,y,n,B,J)}updateRGBDAsync(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,m.k)(this._texture,v,y,n,B).then((()=>{}))}clone(){return O.d.Clone((()=>{const v=this.va(),y=this._texture,n=new yv(v,y._bufferViewArray,y.width,y.format,y.type,y.generateMipMaps,y.invertY,y.samplingMode,y._compression);return 13===y.source&&n.updateRGBDAsync(y._bufferViewArrayArray,y._sphericalPolynomial,y._lodGenerationScale,y._lodGenerationOffset),n}),this)}}const nv="EXT_lights_image_based";class Bv{constructor(v){this.name=nv,this._loader=v,this.enabled=this._loader.isExtensionUsed(nv)}dispose(){this._loader=null,delete this._lights}onLoading(){const v=this._loader.aj.extensions;if(v&&v[this.name]){const y=v[this.name];this._lights=y.lights}}loadSceneAsync(v,y){return o.LoadExtensionAsync(v,y,this.name,((n,B)=>{this._loader._allMaterialsDirtyRequired=!0;const J=new Array;J.push(this._loader.loadSceneAsync(v,y)),this._loader.logOpen(`${n}`);const P=Q.Get(`${n}/light`,this._lights,B.eb);return J.push(this._loadLightAsync(`/extensions/${this.name}/lights/${B.eb}`,P).then((v=>{this._loader.babylonScene.environmentTexture=v}))),this._loader.logClose(),Promise.all(J).then((()=>{}))}))}_loadLightAsync(v,y){if(!y._loaded){const n=new Array;this._loader.logOpen(`${v}`);const B=new Array(y.specularImages.length);for(let J=0;J<y.specularImages.length;J++){const P=y.specularImages[J];B[J]=new Array(P.length);for(let y=0;y<P.length;y++){const b=`${v}/specularImages/${J}/${y}`;this._loader.logOpen(`${b}`);const Y=P[y],l=Q.Get(b,this._loader.aj.images,Y);n.push(this._loader.loadImageAsync(`/images/${Y}`,l).then((v=>{B[J][y]=v}))),this._loader.logClose()}}this._loader.logClose(),y._loaded=Promise.all(n).then((()=>{const n=new yv(this._loader.babylonScene,null,y.specularImageSize);if(n.name=y.name||"environment",y._babylonTexture=n,void 0!=y.mj&&(n.level=y.mj),y.rotation){let v=J.g.qh(y.rotation);this._loader.babylonScene.useRightHandedSystem||(v=J.g.Inverse(v)),J.d.FromQuaternionToRef(v,n.getReflectionTextureMatrix())}if(!y.irradianceCoefficients)throw new Error(`${v}: Irradiance coefficients are missing`);const P=T.e.qh(y.irradianceCoefficients);P.scaleInPlace(y.mj),P.convertIrradianceToLambertianRadiance();const b=T.f.FromHarmonics(P),Y=(B.length-1)/Math.log2(y.specularImageSize);return n.updateRGBDAsync(B,b,Y)}))}return y._loaded.then((()=>y._babylonTexture))}}K(nv),e(nv,!0,(v=>new Bv(v)));n(12338);const Jv="EXT_mesh_gpu_instancing";class Pv{constructor(v){this.name=Jv,this._loader=v,this.enabled=this._loader.isExtensionUsed(Jv)}dispose(){this._loader=null}loadNodeAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((v,B)=>{this._loader._disableInstancedMesh++;const P=this._loader.loadNodeAsync(`/nodes/${y.index}`,y,n);if(this._loader._disableInstancedMesh--,!y._primitiveBabylonMeshes)return P;const b=new Array;let Y=0;const l=y=>{if(void 0==B.attributes[y])return void b.push(Promise.resolve(null));const n=Q.Get(`${v}/attributes/${y}`,this._loader.aj.accessors,B.attributes[y]);if(b.push(this._loader._loadFloatAccessorAsync(`/accessors/${n.bufferView}`,n)),0===Y)Y=n.count;else if(Y!==n.count)throw new Error(`${v}/attributes: Instance buffer accessors do not have the same count.`)};return l("TRANSLATION"),l("ROTATION"),l("SCALE"),P.then((v=>Promise.all(b).then((n=>{let[B,P,b]=n;const l=new Float32Array(16*Y);J.i.o[0].Ae(0,0,0),J.i.Quaternion[0].Ae(0,0,0,1),J.i.o[1].Ae(1,1,1);for(let v=0;v<Y;++v)B&&J.n.FromArrayToRef(B,3*v,J.i.o[0]),P&&J.g.FromArrayToRef(P,4*v,J.i.Quaternion[0]),b&&J.n.FromArrayToRef(b,3*v,J.i.o[1]),J.d.ComposeToRef(J.i.o[1],J.i.Quaternion[0],J.i.o[0],J.i.Matrix[0]),J.i.Matrix[0].copyToArray(l,16*v);for(const v of y._primitiveBabylonMeshes)v._b("matrix",l,16,!0);return v}))))}))}}K(Jv),e(Jv,!0,(v=>new Pv(v)));class bv{static get Default(){return bv._Default||(bv._Default=new bv),bv._Default}constructor(){const v=bv.Configuration.decoder;this._decoderModulePromise=b.g.LoadBabylonScriptAsync(v.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(v,y,n,B,J){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const P=await MeshoptDecoder.decodeGltfBufferAsync(y,n,v,B,J);return MeshoptDecoder.useWorkers(0),P}))}}bv.Configuration={decoder:{url:`${b.g._DefaultCdnUrl}/meshopt_decoder.js`}},bv._Default=null;const Yv="EXT_meshopt_compression";class lv{constructor(v){this.name=Yv,this.enabled=v.isExtensionUsed(Yv),this._loader=v}dispose(){this._loader=null}loadBufferViewAsync(v,y){return o.LoadExtensionAsync(v,y,this.name,((n,B)=>{const J=y;if(J._meshOptData)return J._meshOptData;const P=Q.Get(`${v}/buffer`,this._loader.aj.buffers,B.buffer);return J._meshOptData=this._loader.loadBufferAsync(`/buffers/${P.index}`,P,B.byteOffset||0,B.byteLength).then((v=>bv.Default.decodeGltfBufferAsync(v,B.count,B.byteStride,B.mode,B.filter))),J._meshOptData}))}}K(Yv),e(Yv,!0,(v=>new lv(v)));const av="EXT_texture_webp";class Zv{constructor(v){this.name=av,this._loader=v,this.enabled=v.isExtensionUsed(av)}dispose(){this._loader=null}_loadTextureAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{const P=void 0==y.sampler?o.DefaultSampler:Q.Get(`${v}/sampler`,this._loader.aj.samplers,y.sampler),b=Q.Get(`${B}/source`,this._loader.aj.images,J.source);return this._loader._createTextureAsync(v,P,b,(v=>{n(v)}),void 0,!y._textureInfo.nonColorData)}))}}K(av),e(av,!0,(v=>new Zv(v)));const xv="EXT_texture_avif";class fv{constructor(v){this.name=xv,this._loader=v,this.enabled=v.isExtensionUsed(xv)}dispose(){this._loader=null}_loadTextureAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{const P=void 0==y.sampler?o.DefaultSampler:Q.Get(`${v}/sampler`,this._loader.aj.samplers,y.sampler),b=Q.Get(`${B}/source`,this._loader.aj.images,J.source);return this._loader._createTextureAsync(v,P,b,(v=>{n(v)}),void 0,!y._textureInfo.nonColorData)}))}}K(xv),e(xv,!0,(v=>new fv(v)));var Nv=n(12345);const iv="KHR_draco_mesh_compression";class gv{constructor(v){this.name=iv,this.useNormalizedFlagFromAccessor=!0,this._loader=v,this.enabled=Nv.b.DecoderAvailable&&this._loader.isExtensionUsed(iv)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{if(void 0!=y.mode&&4!==y.mode&&5!==y.mode)throw new Error(`${v}: Unsupported mode ${y.mode}`);const P={},b={},Y=(v,B)=>{const Y=J.attributes[v];if(void 0!=Y&&(n._delayInfo=n._delayInfo||[],-1===n._delayInfo.indexOf(B)&&n._delayInfo.push(B),P[B]=Y,this.useNormalizedFlagFromAccessor)){const n=Q.TryGet(this._loader.aj.accessors,y.attributes[v]);n&&(b[B]=n.normalized||!1)}};Y("POSITION",t.i.PositionKind),Y("NORMAL",t.i.NormalKind),Y("TANGENT",t.i.TangentKind),Y("TEXCOORD_0",t.i.UVKind),Y("TEXCOORD_1",t.i.UV2Kind),Y("TEXCOORD_2",t.i.UV3Kind),Y("TEXCOORD_3",t.i.UV4Kind),Y("TEXCOORD_4",t.i.UV5Kind),Y("TEXCOORD_5",t.i.UV6Kind),Y("JOINTS_0",t.i.MatricesIndicesKind),Y("WEIGHTS_0",t.i.MatricesWeightsKind),Y("COLOR_0",t.i.ColorKind);const l=Q.Get(B,this._loader.aj.bufferViews,J.bufferView);return l._dracoBabylonGeometry||(l._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then((y=>(this.dracoCompression||Nv.b.Default)._decodeMeshToGeometryForGltfAsync(n.name,this._loader.babylonScene,y,P,b).catch((y=>{throw new Error(`${v}: ${y.message}`)}))))),l._dracoBabylonGeometry}))}}K(iv),e(iv,!0,(v=>new gv(v)));var cv=n(12359),hv=n(11351),Ev=n(12306),Wv=n(12368);hv.c.AddNodeConstructor("Light_Type_0",((v,y)=>()=>new sv(v,J.n.Zero(),y)));class sv extends Wv.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(v){this._shadowAngle=v,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(v){const y=this.needCube();if(this._direction=v,this.needCube()!==y&&this._shadowGenerators){const v=this._shadowGenerators.values();for(let y=v.next();!0!==y.done;y=v.next()){y.value.recreateShadowMap()}}}constructor(v,y,n){super(v,n),this._shadowAngle=Math.PI/2,this.position=y}getClassName(){return"PointLight"}getTypeID(){return Ev.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(v){if(this.direction)return super.getShadowDirection(v);switch(v){case 0:return new J.n(1,0,0);case 1:return new J.n(-1,0,0);case 2:return new J.n(0,-1,0);case 3:return new J.n(0,1,0);case 4:return new J.n(0,0,1);case 5:return new J.n(0,0,-1)}return J.n.Zero()}_setDefaultShadowProjectionMatrix(v,y,n){const B=this.va().activeCamera;if(!B)return;const P=void 0!==this.shadowMinZ?this.shadowMinZ:B.ij,b=void 0!==this.shadowMaxZ?this.shadowMaxZ:B.maxZ,Y=this.va().getEngine().useReverseDepthBuffer;J.d.PerspectiveFovLHToRef(this.shadowAngle,1,Y?b:P,Y?P:b,v,!0,this._scene.getEngine().isNDCHalfZRange,void 0,Y)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(v,y){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,y):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,y),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,y),this}transferToNodeMaterialEffect(v,y){return this.computeTransformedInformation()?v.setFloat3(y,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):v.setFloat3(y,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(v,y){v["POINTLIGHT"+y]=!0}}(0,W.c)([(0,s.M)()],sv.prototype,"shadowAngle",null),(0,u.g)("BABYLON.PointLight",sv),hv.c.AddNodeConstructor("Light_Type_2",((v,y)=>()=>new Cv(v,J.n.Zero(),J.n.Zero(),0,0,y)));class Cv extends Wv.c{get angle(){return this._angle}set angle(v){this._angle=v,this._cosHalfAngle=Math.cos(.5*v),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(v){this._innerAngle=v,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(v){this._shadowAngleScale=v,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(v){this._projectionTextureLightNear=v,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(v){this._projectionTextureLightFar=v,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(v){this._projectionTextureUpDirection=v,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(v){this._projectionTexture!==v&&(this._projectionTexture=v,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Cv._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Cv._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(v){return void 0!==v.onGeneratedObservable}static _IsTexture(v){return void 0!==v.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(v){this._projectionTextureProjectionLightMatrix=v,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(v,y,n,B,P,b){super(v,b),this._innerAngle=0,this._projectionTextureMatrix=J.d.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=J.n.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=J.n.Zero(),this._projectionTextureViewLightMatrix=J.d.Zero(),this._projectionTextureProjectionLightMatrix=J.d.Zero(),this._projectionTextureScalingMatrix=J.d.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=y,this.direction=n,this.angle=B,this.exponent=P}getClassName(){return"SpotLight"}getTypeID(){return Ev.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(v){super._setDirection(v),this._projectionTextureViewLightDirty=!0}_setPosition(v){super._setPosition(v),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(v,y,n){const B=this.va().activeCamera;if(!B)return;this._shadowAngleScale=this._shadowAngleScale||1;const P=this._shadowAngleScale*this._angle,b=void 0!==this.shadowMinZ?this.shadowMinZ:B.ij,Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:B.maxZ,l=this.va().getEngine().useReverseDepthBuffer;J.d.PerspectiveFovLHToRef(P,1,l?Y:b,l?b:Y,v,!0,this._scene.getEngine().isNDCHalfZRange,void 0,l)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),J.d.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const v=this.projectionTextureLightFar,y=this.projectionTextureLightNear,n=v/(v-y),B=-n*y,P=1/Math.tan(this._angle/2);J.d.FromValuesToRef(P/1,0,0,0,0,P,0,0,0,0,n,1,0,0,B,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof q.b){const v=this._projectionTexture.uScale/2,y=this._projectionTexture.vScale/2;J.d.FromValuesToRef(v,0,0,0,0,y,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(v,y){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),v.setMatrix("textureProjectionMatrix"+y,this._projectionTextureMatrix),v.setTexture("projectionLightTexture"+y,this.projectionTexture)),this}transferToEffect(v,y){let n;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,y),n=J.n.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,y),n=J.n.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",n.x,n.y,n.z,this._cosHalfAngle,y),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,y),this}transferToNodeMaterialEffect(v,y){let n;return n=this.computeTransformedInformation()?J.n.Normalize(this.transformedDirection):J.n.Normalize(this.direction),this.va().useRightHandedSystem?v.setFloat3(y,-n.x,-n.y,-n.z):v.setFloat3(y,n.x,n.y,n.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(v){const y=this._scene.getEngine(),n=void 0!==this.shadowMinZ?this.shadowMinZ:v.ij;return y.useReverseDepthBuffer&&y.isNDCHalfZRange?n:this._scene.getEngine().isNDCHalfZRange?0:n}getDepthMaxZ(v){const y=this._scene.getEngine(),n=void 0!==this.shadowMaxZ?this.shadowMaxZ:v.maxZ;return y.useReverseDepthBuffer&&y.isNDCHalfZRange?0:n}prepareLightSpecificDefines(v,y){v["SPOTLIGHT"+y]=!0,v["PROJECTEDLIGHTTEXTURE"+y]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,W.c)([(0,s.M)()],Cv.prototype,"angle",null),(0,W.c)([(0,s.M)()],Cv.prototype,"innerAngle",null),(0,W.c)([(0,s.M)()],Cv.prototype,"shadowAngleScale",null),(0,W.c)([(0,s.M)()],Cv.prototype,"exponent",void 0),(0,W.c)([(0,s.M)()],Cv.prototype,"projectionTextureLightNear",null),(0,W.c)([(0,s.M)()],Cv.prototype,"projectionTextureLightFar",null),(0,W.c)([(0,s.M)()],Cv.prototype,"projectionTextureUpDirection",null),(0,W.c)([(0,s.E)("projectedLightTexture")],Cv.prototype,"_projectionTexture",void 0),(0,u.g)("BABYLON.SpotLight",Cv);const rv="KHR_lights_punctual";class uv{constructor(v){this.name=rv,this._loader=v,this.enabled=this._loader.isExtensionUsed(rv)}dispose(){this._loader=null,delete this._lights}onLoading(){const v=this._loader.aj.extensions;if(v&&v[this.name]){const y=v[this.name];this._lights=y.lights,Q.Assign(this._lights)}}loadNodeAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,b)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(v,y,(v=>{let y;const Y=Q.Get(B,this._lights,b.eb),l=Y.name||v.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,Y.type){case"directional":{const v=new cv.d(l,J.n.Backward(),this._loader.babylonScene);v.position.xe(0),y=v;break}case"point":y=new sv(l,J.n.Zero(),this._loader.babylonScene);break;case"spot":{const v=new Cv(l,J.n.Zero(),J.n.Backward(),0,1,this._loader.babylonScene);v.angle=2*(Y.spot&&Y.spot.outerConeAngle||Math.PI/4),v.innerAngle=2*(Y.spot&&Y.spot.innerConeAngle||0),y=v;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${B}: Invalid light type (${Y.type})`)}y._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,Y._babylonLight=y,y.falloffType=Ev.d.FALLOFF_GLTF,y.Qh=Y.color?P.d.qh(Y.color):P.d.White(),y.mj=void 0==Y.mj?1:Y.mj,y.range=void 0==Y.range?Number.MAX_VALUE:Y.range,y.parent=v,this._loader._babylonLights.push(y),o.AddPointerMetadata(y,B),n(v)})))))}}K(rv),e(rv,!0,(v=>new uv(v)));const Ov="KHR_materials_pbrSpecularGlossiness";class dv{constructor(v){this.name=Ov,this.order=200,this._loader=v,this.enabled=this._loader.isExtensionUsed(Ov)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{const P=new Array;return P.push(this._loader.loadMaterialBasePropertiesAsync(v,y,n)),P.push(this._loadSpecularGlossinessPropertiesAsync(B,J,n)),this._loader.loadMaterialAlphaProperties(v,y,n),Promise.all(P).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(v,y,n){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);const B=new Array;return n.metallic=null,n.roughness=null,y.diffuseFactor?(n.albedoColor=P.d.qh(y.diffuseFactor),n.alpha=y.diffuseFactor[3]):n.albedoColor=P.d.White(),n.reflectivityColor=y.specularFactor?P.d.qh(y.specularFactor):P.d.White(),n.microSurface=void 0==y.glossinessFactor?1:y.glossinessFactor,y.diffuseTexture&&B.push(this._loader.loadTextureInfoAsync(`${v}/diffuseTexture`,y.diffuseTexture,(v=>{v.name=`${n.name} (Diffuse)`,n.albedoTexture=v}))),y.specularGlossinessTexture&&(B.push(this._loader.loadTextureInfoAsync(`${v}/specularGlossinessTexture`,y.specularGlossinessTexture,(v=>{v.name=`${n.name} (Specular Glossiness)`,n.reflectivityTexture=v,n.reflectivityTexture.Pe=!0}))),n.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(B).then((()=>{}))}}K(Ov),e(Ov,!0,(v=>new dv(v)));const qv="KHR_materials_unlit";class Lv{constructor(v){this.name=qv,this.order=210,this._loader=v,this.enabled=this._loader.isExtensionUsed(qv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,(()=>this._loadUnlitPropertiesAsync(v,y,n)))}_loadUnlitPropertiesAsync(v,y,n){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);const B=new Array;n.unlit=!0;const J=y.pbrMetallicRoughness;return J&&(J.baseColorFactor?(n.albedoColor=P.d.qh(J.baseColorFactor),n.alpha=J.baseColorFactor[3]):n.albedoColor=P.d.White(),J.baseColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${v}/baseColorTexture`,J.baseColorTexture,(v=>{v.name=`${n.name} (Base Color)`,n.albedoTexture=v})))),y.doubleSided&&(n.Ch=!1,n.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(v,y,n),Promise.all(B).then((()=>{}))}}K(qv),e(qv,!0,(v=>new Lv(v)));const tv="KHR_materials_clearcoat";class Gv{constructor(v){this.name=tv,this.order=190,this._loader=v,this.enabled=this._loader.isExtensionUsed(tv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(v,y,n)),P.push(this._loadClearCoatPropertiesAsync(B,J,n)),Promise.all(P).then((()=>{}))}))}_loadClearCoatPropertiesAsync(v,y,n){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);const B=new Array;return n.clearCoat.isEnabled=!0,n.clearCoat.useRoughnessFromMainTexture=!1,n.clearCoat.remapF0OnInterfaceChange=!1,void 0!=y.clearcoatFactor?n.clearCoat.mj=y.clearcoatFactor:n.clearCoat.mj=0,y.clearcoatTexture&&B.push(this._loader.loadTextureInfoAsync(`${v}/clearcoatTexture`,y.clearcoatTexture,(v=>{v.name=`${n.name} (ClearCoat)`,n.clearCoat.texture=v}))),void 0!=y.clearcoatRoughnessFactor?n.clearCoat.roughness=y.clearcoatRoughnessFactor:n.clearCoat.roughness=0,y.clearcoatRoughnessTexture&&(y.clearcoatRoughnessTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${v}/clearcoatRoughnessTexture`,y.clearcoatRoughnessTexture,(v=>{v.name=`${n.name} (ClearCoat Roughness)`,n.clearCoat.textureRoughness=v})))),y.clearcoatNormalTexture&&(y.clearcoatNormalTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${v}/clearcoatNormalTexture`,y.clearcoatNormalTexture,(v=>{v.name=`${n.name} (ClearCoat Normal)`,n.clearCoat.bumpTexture=v}))),n.invertNormalMapX=!n.va().useRightHandedSystem,n.invertNormalMapY=n.va().useRightHandedSystem,void 0!=y.clearcoatNormalTexture.scale&&(n.clearCoat.bumpTexture.level=y.clearcoatNormalTexture.scale)),Promise.all(B).then((()=>{}))}}K(tv),e(tv,!0,(v=>new Gv(v)));const Rv="KHR_materials_iridescence";class Fv{constructor(v){this.name=Rv,this.order=195,this._loader=v,this.enabled=this._loader.isExtensionUsed(Rv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(v,y,n)),P.push(this._loadIridescencePropertiesAsync(B,J,n)),Promise.all(P).then((()=>{}))}))}_loadIridescencePropertiesAsync(v,y,n){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);const B=new Array;return n.iridescence.isEnabled=!0,n.iridescence.mj=y.iridescenceFactor??0,n.iridescence.indexOfRefraction=y.iridescenceIor??y.iridescenceIOR??1.3,n.iridescence.minimumThickness=y.iridescenceThicknessMinimum??100,n.iridescence.maximumThickness=y.iridescenceThicknessMaximum??400,y.iridescenceTexture&&B.push(this._loader.loadTextureInfoAsync(`${v}/iridescenceTexture`,y.iridescenceTexture,(v=>{v.name=`${n.name} (Iridescence)`,n.iridescence.texture=v}))),y.iridescenceThicknessTexture&&B.push(this._loader.loadTextureInfoAsync(`${v}/iridescenceThicknessTexture`,y.iridescenceThicknessTexture,(v=>{v.name=`${n.name} (Iridescence Thickness)`,n.iridescence.thicknessTexture=v}))),Promise.all(B).then((()=>{}))}}K(Rv),e(Rv,!0,(v=>new Fv(v)));const Sv="KHR_materials_anisotropy";class wv{constructor(v){this.name=Sv,this.order=195,this._loader=v,this.enabled=this._loader.isExtensionUsed(Sv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(v,y,n)),P.push(this._loadIridescencePropertiesAsync(B,J,n)),Promise.all(P).then((()=>{}))}))}_loadIridescencePropertiesAsync(v,y,n){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);const B=new Array;return n.anisotropy.isEnabled=!0,n.anisotropy.mj=y.anisotropyStrength??0,n.anisotropy.angle=y.anisotropyRotation??0,y.anisotropyTexture&&(y.anisotropyTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${v}/anisotropyTexture`,y.anisotropyTexture,(v=>{v.name=`${n.name} (Anisotropy Intensity)`,n.anisotropy.texture=v})))),Promise.all(B).then((()=>{}))}}K(Sv),e(Sv,!0,(v=>new wv(v)));const kv="KHR_materials_emissive_strength";class Mv{constructor(v){this.name=kv,this.order=170,this._loader=v,this.enabled=this._loader.isExtensionUsed(kv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>this._loader.loadMaterialPropertiesAsync(v,y,n).then((()=>{this._loadEmissiveProperties(B,J,n)}))))}_loadEmissiveProperties(v,y,n){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);void 0!==y.emissiveStrength&&(n.emissiveIntensity=y.emissiveStrength)}}K(kv),e(kv,!0,(v=>new Mv(v)));const Iv="KHR_materials_sheen";class jv{constructor(v){this.name=Iv,this.order=190,this._loader=v,this.enabled=this._loader.isExtensionUsed(Iv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(v,y,n)),P.push(this._loadSheenPropertiesAsync(B,J,n)),Promise.all(P).then((()=>{}))}))}_loadSheenPropertiesAsync(v,y,n){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);const B=new Array;return n.sheen.isEnabled=!0,n.sheen.mj=1,void 0!=y.sheenColorFactor?n.sheen.color=P.d.qh(y.sheenColorFactor):n.sheen.color=P.d.Black(),y.sheenColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${v}/sheenColorTexture`,y.sheenColorTexture,(v=>{v.name=`${n.name} (Sheen Color)`,n.sheen.texture=v}))),void 0!==y.sheenRoughnessFactor?n.sheen.roughness=y.sheenRoughnessFactor:n.sheen.roughness=0,y.sheenRoughnessTexture&&(y.sheenRoughnessTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${v}/sheenRoughnessTexture`,y.sheenRoughnessTexture,(v=>{v.name=`${n.name} (Sheen Roughness)`,n.sheen.textureRoughness=v})))),n.sheen.albedoScaling=!0,n.sheen.useRoughnessFromMainTexture=!1,Promise.all(B).then((()=>{}))}}K(Iv),e(Iv,!0,(v=>new jv(v)));const Vv="KHR_materials_specular";class pv{constructor(v){this.name=Vv,this.order=190,this._loader=v,this.enabled=this._loader.isExtensionUsed(Vv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(v,y,n)),P.push(this._loadSpecularPropertiesAsync(B,J,n)),Promise.all(P).then((()=>{}))}))}_loadSpecularPropertiesAsync(v,y,n){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);const B=new Array;return void 0!==y.specularFactor&&(n.metallicF0Factor=y.specularFactor),void 0!==y.specularColorFactor&&(n.metallicReflectanceColor=P.d.qh(y.specularColorFactor)),y.specularTexture&&(y.specularTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${v}/specularTexture`,y.specularTexture,(v=>{v.name=`${n.name} (Specular)`,n.metallicReflectanceTexture=v,n.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),y.specularColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${v}/specularColorTexture`,y.specularColorTexture,(v=>{v.name=`${n.name} (Specular Color)`,n.reflectanceTexture=v}))),Promise.all(B).then((()=>{}))}}K(Vv),e(Vv,!0,(v=>new pv(v)));const Hv="KHR_materials_ior";class Av{constructor(v){this.name=Hv,this.order=180,this._loader=v,this.enabled=this._loader.isExtensionUsed(Hv)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(v,y,n)),P.push(this._loadIorPropertiesAsync(B,J,n)),Promise.all(P).then((()=>{}))}))}_loadIorPropertiesAsync(v,y,n){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);return void 0!==y.ior?n.indexOfRefraction=y.ior:n.indexOfRefraction=Av._DEFAULT_IOR,Promise.resolve()}}Av._DEFAULT_IOR=1.5,K(Hv),e(Hv,!0,(v=>new Av(v)));const Xv="KHR_materials_variants";class Uv{constructor(v){this.name=Xv,this._loader=v,this.enabled=this._loader.isExtensionUsed(Xv)}dispose(){this._loader=null}static GetAvailableVariants(v){const y=this._GetExtensionMetadata(v);return y?Object.keys(y.variants):[]}getAvailableVariants(v){return Uv.GetAvailableVariants(v)}static SelectVariant(v,y){const n=this._GetExtensionMetadata(v);if(!n)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Xv} extension`);const B=v=>{const y=n.variants[v];if(y)for(const n of y)n.mesh.material=n.material};if(y instanceof Array)for(const J of y)B(J);else B(y);n.lastSelected=y}selectVariant(v,y){Uv.SelectVariant(v,y)}static Reset(v){const y=this._GetExtensionMetadata(v);if(!y)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Xv} extension`);for(const n of y.original)n.mesh.material=n.material;y.lastSelected=null}reset(v){Uv.Reset(v)}static GetLastSelectedVariant(v){const y=this._GetExtensionMetadata(v);if(!y)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Xv} extension`);return y.lastSelected}getLastSelectedVariant(v){return Uv.GetLastSelectedVariant(v)}static _GetExtensionMetadata(v){var y,n;return(null===v||void 0===v||null===(y=v._internalMetadata)||void 0===y||null===(n=y.aj)||void 0===n?void 0:n[Xv])||null}onLoading(){const v=this._loader.aj.extensions;if(v&&v[this.name]){const y=v[this.name];this._variants=y.variants}}_loadMeshPrimitiveAsync(v,y,n,B,J,P){return o.LoadExtensionAsync(v,J,this.name,((b,Y)=>{const l=new Array;return l.push(this._loader._loadMeshPrimitiveAsync(v,y,n,B,J,(y=>{if(P(y),y instanceof F.d){const n=o._GetDrawMode(v,J.mode),B=this._loader.rootBabylonMesh,P=B?B._internalMetadata=B._internalMetadata||{}:{},a=P.aj=P.aj||{},Z=a[Xv]=a[Xv]||{lastSelected:null,original:[],variants:{}};Z.original.push({mesh:y,material:y.material});for(let v=0;v<Y.mappings.length;++v){const J=Y.mappings[v],P=Q.Get(`${b}/mappings/${v}/material`,this._loader.aj.materials,J.material);l.push(this._loader._loadMaterialAsync(`#/materials/${J.material}`,P,y,n,(v=>{for(let n=0;n<J.variants.length;++n){const P=J.variants[n],b=Q.Get(`/extensions/${Xv}/variants/${P}`,this._variants,P);Z.variants[b.name]=Z.variants[b.name]||[],Z.variants[b.name].push({mesh:y,material:v}),y.onClonedObservable.add((v=>{const n=v;let J=null,P=n;do{if(P=P.parent,!P)return;J=Uv._GetExtensionMetadata(P)}while(null===J);if(B&&J===Uv._GetExtensionMetadata(B)){P._internalMetadata={};for(const v in B._internalMetadata)P._internalMetadata[v]=B._internalMetadata[v];P._internalMetadata.aj=[];for(const v in B._internalMetadata.aj)P._internalMetadata.aj[v]=B._internalMetadata.aj[v];P._internalMetadata.aj[Xv]={lastSelected:null,original:[],variants:{}};for(const v of J.original)P._internalMetadata.aj[Xv].original.push({mesh:v.mesh,material:v.material});for(const v in J.variants)if(Object.prototype.hasOwnProperty.call(J.variants,v)){P._internalMetadata.aj[Xv].variants[v]=[];for(const y of J.variants[v])P._internalMetadata.aj[Xv].variants[v].push({mesh:y.mesh,material:y.material})}J=P._internalMetadata.aj[Xv]}for(const B of J.original)B.mesh===y&&(B.mesh=n);for(const B of J.variants[b.name])B.mesh===y&&(B.mesh=n)}))}})))}}}))),Promise.all(l).then((v=>{let[y]=v;return y}))}))}}K(Xv),e(Xv,!0,(v=>new Uv(v)));var zv=n(11602);class ev{}ev.AUTOSAMPLERSUFFIX="Sampler",ev.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",ev.ALPHA_DISABLE=0,ev.ALPHA_ADD=1,ev.ALPHA_COMBINE=2,ev.ALPHA_SUBTRACT=3,ev.ALPHA_MULTIPLY=4,ev.ALPHA_MAXIMIZED=5,ev.ALPHA_ONEONE=6,ev.ALPHA_PREMULTIPLIED=7,ev.ALPHA_PREMULTIPLIED_PORTERDUFF=8,ev.ALPHA_INTERPOLATE=9,ev.ALPHA_SCREENMODE=10,ev.ALPHA_ONEONE_ONEONE=11,ev.ALPHA_ALPHATOCOLOR=12,ev.ALPHA_REVERSEONEMINUS=13,ev.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,ev.ALPHA_ONEONE_ONEZERO=15,ev.ALPHA_EXCLUSION=16,ev.ALPHA_LAYER_ACCUMULATE=17,ev.ALPHA_EQUATION_ADD=0,ev.ALPHA_EQUATION_SUBSTRACT=1,ev.ALPHA_EQUATION_REVERSE_SUBTRACT=2,ev.ALPHA_EQUATION_MAX=3,ev.ALPHA_EQUATION_MIN=4,ev.ALPHA_EQUATION_DARKEN=5,ev.DELAYLOADSTATE_NONE=0,ev.DELAYLOADSTATE_LOADED=1,ev.DELAYLOADSTATE_LOADING=2,ev.DELAYLOADSTATE_NOTLOADED=4,ev.NEVER=512,ev.ALWAYS=519,ev.LESS=513,ev.EQUAL=514,ev.LEQUAL=515,ev.GREATER=516,ev.GEQUAL=518,ev.NOTEQUAL=517,ev.KEEP=7680,ev.ZERO=0,ev.REPLACE=7681,ev.INCR=7682,ev.DECR=7683,ev.INVERT=5386,ev.INCR_WRAP=34055,ev.DECR_WRAP=34056,ev.TEXTURE_CLAMP_ADDRESSMODE=0,ev.TEXTURE_WRAP_ADDRESSMODE=1,ev.TEXTURE_MIRROR_ADDRESSMODE=2,ev.TEXTURE_CREATIONFLAG_STORAGE=1,ev.TEXTUREFORMAT_ALPHA=0,ev.TEXTUREFORMAT_LUMINANCE=1,ev.TEXTUREFORMAT_LUMINANCE_ALPHA=2,ev.TEXTUREFORMAT_RGB=4,ev.TEXTUREFORMAT_RGBA=5,ev.TEXTUREFORMAT_RED=6,ev.TEXTUREFORMAT_R=6,ev.TEXTUREFORMAT_RG=7,ev.TEXTUREFORMAT_RED_INTEGER=8,ev.TEXTUREFORMAT_R_INTEGER=8,ev.TEXTUREFORMAT_RG_INTEGER=9,ev.TEXTUREFORMAT_RGB_INTEGER=10,ev.TEXTUREFORMAT_RGBA_INTEGER=11,ev.TEXTUREFORMAT_BGRA=12,ev.TEXTUREFORMAT_DEPTH24_STENCIL8=13,ev.TEXTUREFORMAT_DEPTH32_FLOAT=14,ev.TEXTUREFORMAT_DEPTH16=15,ev.TEXTUREFORMAT_DEPTH24=16,ev.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,ev.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,ev.TEXTUREFORMAT_STENCIL8=19,ev.TEXTUREFORMAT_UNDEFINED=4294967295,ev.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,ev.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,ev.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,ev.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,ev.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,ev.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,ev.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,ev.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,ev.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,ev.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,ev.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,ev.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,ev.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,ev.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,ev.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,ev.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,ev.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,ev.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,ev.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,ev.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,ev.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,ev.TEXTURETYPE_UNSIGNED_BYTE=0,ev.TEXTURETYPE_UNSIGNED_INT=0,ev.TEXTURETYPE_FLOAT=1,ev.TEXTURETYPE_HALF_FLOAT=2,ev.TEXTURETYPE_BYTE=3,ev.TEXTURETYPE_SHORT=4,ev.TEXTURETYPE_UNSIGNED_SHORT=5,ev.TEXTURETYPE_INT=6,ev.TEXTURETYPE_UNSIGNED_INTEGER=7,ev.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,ev.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,ev.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,ev.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,ev.TEXTURETYPE_UNSIGNED_INT_24_8=12,ev.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,ev.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,ev.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,ev.TEXTURETYPE_UNDEFINED=16,ev.TEXTURE_2D=3553,ev.TEXTURE_2D_ARRAY=35866,ev.TEXTURE_CUBE_MAP=34067,ev.TEXTURE_CUBE_MAP_ARRAY=3735928559,ev.TEXTURE_3D=32879,ev.TEXTURE_NEAREST_SAMPLINGMODE=1,ev.TEXTURE_NEAREST_NEAREST=1,ev.TEXTURE_BILINEAR_SAMPLINGMODE=2,ev.TEXTURE_LINEAR_LINEAR=2,ev.TEXTURE_TRILINEAR_SAMPLINGMODE=3,ev.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,ev.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,ev.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,ev.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,ev.TEXTURE_NEAREST_LINEAR=7,ev.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,ev.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,ev.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,ev.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,ev.TEXTURE_LINEAR_NEAREST=12,ev.TEXTURE_EXPLICIT_MODE=0,ev.TEXTURE_SPHERICAL_MODE=1,ev.TEXTURE_PLANAR_MODE=2,ev.TEXTURE_CUBIC_MODE=3,ev.TEXTURE_PROJECTION_MODE=4,ev.TEXTURE_SKYBOX_MODE=5,ev.TEXTURE_INVCUBIC_MODE=6,ev.TEXTURE_EQUIRECTANGULAR_MODE=7,ev.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,ev.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,ev.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,ev.TEXTURE_FILTERING_QUALITY_HIGH=64,ev.TEXTURE_FILTERING_QUALITY_MEDIUM=16,ev.TEXTURE_FILTERING_QUALITY_LOW=8,ev.SCALEMODE_FLOOR=1,ev.SCALEMODE_NEAREST=2,ev.SCALEMODE_CEILING=3,ev.MATERIAL_TextureDirtyFlag=1,ev.MATERIAL_LightDirtyFlag=2,ev.MATERIAL_FresnelDirtyFlag=4,ev.MATERIAL_AttributesDirtyFlag=8,ev.MATERIAL_MiscDirtyFlag=16,ev.MATERIAL_PrePassDirtyFlag=32,ev.MATERIAL_AllDirtyFlag=63,ev.MATERIAL_TriangleFillMode=0,ev.MATERIAL_WireFrameFillMode=1,ev.MATERIAL_PointFillMode=2,ev.MATERIAL_PointListDrawMode=3,ev.MATERIAL_LineListDrawMode=4,ev.MATERIAL_LineLoopDrawMode=5,ev.MATERIAL_LineStripDrawMode=6,ev.MATERIAL_TriangleStripDrawMode=7,ev.MATERIAL_TriangleFanDrawMode=8,ev.MATERIAL_ClockWiseSideOrientation=0,ev.MATERIAL_CounterClockWiseSideOrientation=1,ev.ACTION_NothingTrigger=0,ev.ACTION_OnPickTrigger=1,ev.ACTION_OnLeftPickTrigger=2,ev.ACTION_OnRightPickTrigger=3,ev.ACTION_OnCenterPickTrigger=4,ev.ACTION_OnPickDownTrigger=5,ev.ACTION_OnDoublePickTrigger=6,ev.ACTION_OnPickUpTrigger=7,ev.ACTION_OnPickOutTrigger=16,ev.ACTION_OnLongPressTrigger=8,ev.ACTION_OnPointerOverTrigger=9,ev.ACTION_OnPointerOutTrigger=10,ev.ACTION_OnEveryFrameTrigger=11,ev.ACTION_OnIntersectionEnterTrigger=12,ev.ACTION_OnIntersectionExitTrigger=13,ev.ACTION_OnKeyDownTrigger=14,ev.ACTION_OnKeyUpTrigger=15,ev.PARTICLES_BILLBOARDMODE_Y=2,ev.PARTICLES_BILLBOARDMODE_ALL=7,ev.PARTICLES_BILLBOARDMODE_STRETCHED=8,ev.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,ev.MESHES_CULLINGSTRATEGY_STANDARD=0,ev.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,ev.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,ev.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,ev.SCENELOADER_NO_LOGGING=0,ev.SCENELOADER_MINIMAL_LOGGING=1,ev.SCENELOADER_SUMMARY_LOGGING=2,ev.SCENELOADER_DETAILED_LOGGING=3,ev.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,ev.PREPASS_POSITION_TEXTURE_TYPE=1,ev.PREPASS_VELOCITY_TEXTURE_TYPE=2,ev.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,ev.PREPASS_COLOR_TEXTURE_TYPE=4,ev.PREPASS_DEPTH_TEXTURE_TYPE=5,ev.PREPASS_NORMAL_TEXTURE_TYPE=6,ev.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,ev.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,ev.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,ev.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,ev.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,ev.PREPASS_ALBEDO_TEXTURE_TYPE=12,ev.BUFFER_CREATIONFLAG_READ=1,ev.BUFFER_CREATIONFLAG_WRITE=2,ev.BUFFER_CREATIONFLAG_READWRITE=3,ev.BUFFER_CREATIONFLAG_UNIFORM=4,ev.BUFFER_CREATIONFLAG_VERTEX=8,ev.BUFFER_CREATIONFLAG_INDEX=16,ev.BUFFER_CREATIONFLAG_STORAGE=32,ev.BUFFER_CREATIONFLAG_INDIRECT=64,ev.RENDERPASS_MAIN=0,ev.INPUT_ALT_KEY=18,ev.INPUT_CTRL_KEY=17,ev.INPUT_META_KEY1=91,ev.INPUT_META_KEY2=92,ev.INPUT_META_KEY3=93,ev.INPUT_SHIFT_KEY=16,ev.SNAPSHOTRENDERING_STANDARD=0,ev.SNAPSHOTRENDERING_FAST=1,ev.PERSPECTIVE_CAMERA=0,ev.ORTHOGRAPHIC_CAMERA=1,ev.FOVMODE_VERTICAL_FIXED=0,ev.FOVMODE_HORIZONTAL_FIXED=1,ev.RIG_MODE_NONE=0,ev.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,ev.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,ev.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,ev.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,ev.RIG_MODE_STEREOSCOPIC_INTERLACED=14,ev.RIG_MODE_VR=20,ev.RIG_MODE_CUSTOM=22,ev.MAX_SUPPORTED_UV_SETS=6,ev.GL_ALPHA_EQUATION_ADD=32774,ev.GL_ALPHA_EQUATION_MIN=32775,ev.GL_ALPHA_EQUATION_MAX=32776,ev.GL_ALPHA_EQUATION_SUBTRACT=32778,ev.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,ev.GL_ALPHA_FUNCTION_SRC=768,ev.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,ev.GL_ALPHA_FUNCTION_SRC_ALPHA=770,ev.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,ev.GL_ALPHA_FUNCTION_DST_ALPHA=772,ev.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,ev.GL_ALPHA_FUNCTION_DST_COLOR=774,ev.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,ev.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,ev.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,ev.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,ev.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,ev.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,ev.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,ev.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,ev.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,ev.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,ev.SnippetUrl="https://snippet.babylonjs.com",ev.FOGMODE_NONE=0,ev.FOGMODE_EXP=1,ev.FOGMODE_EXP2=2,ev.FOGMODE_LINEAR=3,ev.BYTE=5120,ev.UNSIGNED_BYTE=5121,ev.SHORT=5122,ev.UNSIGNED_SHORT=5123,ev.INT=5124,ev.UNSIGNED_INT=5125,ev.FLOAT=5126,ev.PositionKind="position",ev.NormalKind="k",ev.TangentKind="tangent",ev.UVKind="uv",ev.UV2Kind="uv2",ev.UV3Kind="uv3",ev.UV4Kind="uv4",ev.UV5Kind="uv5",ev.UV6Kind="uv6",ev.ColorKind="color",ev.ColorInstanceKind="instanceColor",ev.MatricesIndicesKind="matricesIndices",ev.MatricesWeightsKind="matricesWeights",ev.MatricesIndicesExtraKind="matricesIndicesExtra",ev.MatricesWeightsExtraKind="matricesWeightsExtra";class Kv{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:ev.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(v,y){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Kv._GetDefaultOptions(),...v},this._scene=y,this._scene._transmissionHelper=this,this.onErrorObservable=new Z.e,this._scene.xj.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(v){if(!Object.keys(v).filter((y=>this._options[y]!==v[y])).length)return;const y={...this._options,...v},n=this._options;this._options=y,y.renderSize===n.renderSize&&y.renderTargetTextureType===n.renderTargetTextureType&&y.generateMipmaps===n.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=y.samples,this._opaqueRenderTarget.lodGenerationScale=y.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=y.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(v){return!!v&&!!(v instanceof d&&v.subSurface.isRefractionEnabled)}_addMesh(v){this._materialObservers[v.uniqueId]=v.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),b.g.SetImmediate((()=>{this._shouldRenderAsTransmission(v.material)?(v.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(v)&&this._transparentMeshesCache.push(v)):-1===this._opaqueMeshesCache.indexOf(v)&&this._opaqueMeshesCache.push(v)}))}_removeMesh(v){v.onMaterialChangedObservable.remove(this._materialObservers[v.uniqueId]),delete this._materialObservers[v.uniqueId];let y=this._transparentMeshesCache.indexOf(v);-1!==y&&this._transparentMeshesCache.splice(y,1),y=this._opaqueMeshesCache.indexOf(v),-1!==y&&this._opaqueMeshesCache.splice(y,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(v){const y=this._transparentMeshesCache.indexOf(v),n=this._opaqueMeshesCache.indexOf(v);this._shouldRenderAsTransmission(v.material)?(v.material instanceof d&&(v.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==n?(this._opaqueMeshesCache.splice(n,1),this._transparentMeshesCache.push(v)):-1===y&&this._transparentMeshesCache.push(v)):-1!==y?(this._transparentMeshesCache.splice(y,1),this._opaqueMeshesCache.push(v)):-1===n&&this._opaqueMeshesCache.push(v)}_isRenderTargetValid(){var v;return null!==(null===(v=this._opaqueRenderTarget)||void 0===v?void 0:v.getInternalTexture())}_setupRenderTargets(){var v;let y,n;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new zv.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(v=this._options.clearColor)||void 0===v?void 0:v.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((v=>{n=this._scene.environmentIntensity,this._scene.environmentIntensity=1,y=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?v.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(v.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=n,this._scene.imageProcessingConfiguration._applyByPostProcess=y})),this._transparentMeshesCache.forEach((v=>{this._shouldRenderAsTransmission(v.material)&&(v.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Dv="KHR_materials_transmission";class Qv{constructor(v){this.name=Dv,this.order=175,this._loader=v,this.enabled=this._loader.isExtensionUsed(Dv),this.enabled&&(v.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(v,y,n)),P.push(this._loadTransparentPropertiesAsync(B,y,n,J)),Promise.all(P).then((()=>{}))}))}_loadTransparentPropertiesAsync(v,y,n,B){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);const J=n;if(J.subSurface.isRefractionEnabled=!0,J.subSurface.volumeIndexOfRefraction=1,J.subSurface.useAlbedoToTintRefraction=!0,void 0===B.transmissionFactor)return J.subSurface.refractionIntensity=0,J.subSurface.isRefractionEnabled=!1,Promise.resolve();{var P;J.subSurface.refractionIntensity=B.transmissionFactor;const v=J.va();if(J.subSurface.refractionIntensity&&!v._transmissionHelper)new Kv({},J.va());else if(J.subSurface.refractionIntensity&&(null===(P=v._transmissionHelper)||void 0===P||!P._isRenderTargetValid())){var b;null===(b=v._transmissionHelper)||void 0===b||b._setupRenderTargets()}}return J.subSurface.minimumThickness=0,J.subSurface.maximumThickness=0,B.transmissionTexture?(B.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${v}/transmissionTexture`,B.transmissionTexture,void 0).then((v=>{v.name=`${n.name} (Transmission)`,J.subSurface.refractionIntensityTexture=v,J.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}K(Dv),e(Dv,!0,(v=>new Qv(v)));const ov="KHR_materials_diffuse_transmission";class Tv{constructor(v){this.name=ov,this.order=174,this._loader=v,this.enabled=this._loader.isExtensionUsed(ov),this.enabled&&(v.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(v,y,n)),P.push(this._loadTranslucentPropertiesAsync(B,y,n,J)),Promise.all(P).then((()=>{}))}))}_loadTranslucentPropertiesAsync(v,y,n,B){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);const J=n;if(J.subSurface.isTranslucencyEnabled=!0,J.subSurface.volumeIndexOfRefraction=1,J.subSurface.minimumThickness=0,J.subSurface.maximumThickness=0,J.subSurface.useAlbedoToTintTranslucency=!1,void 0===B.diffuseTransmissionFactor)return J.subSurface.translucencyIntensity=0,J.subSurface.isTranslucencyEnabled=!1,Promise.resolve();J.subSurface.translucencyIntensity=B.diffuseTransmissionFactor;const b=new Array;return J.subSurface.useGltfStyleTextures=!0,B.diffuseTransmissionTexture&&(B.diffuseTransmissionTexture.nonColorData=!0,b.push(this._loader.loadTextureInfoAsync(`${v}/diffuseTransmissionTexture`,B.diffuseTransmissionTexture).then((v=>{v.name=`${n.name} (Diffuse Transmission)`,J.subSurface.translucencyIntensityTexture=v})))),void 0!==B.diffuseTransmissionColorFactor?J.subSurface.translucencyColor=P.d.qh(B.diffuseTransmissionColorFactor):J.subSurface.translucencyColor=P.d.White(),B.diffuseTransmissionColorTexture&&b.push(this._loader.loadTextureInfoAsync(`${v}/diffuseTransmissionColorTexture`,B.diffuseTransmissionColorTexture).then((v=>{v.name=`${n.name} (Diffuse Transmission Color)`,J.subSurface.translucencyColorTexture=v}))),Promise.all(b).then((()=>{}))}}K(ov),e(ov,!0,(v=>new Tv(v)));const mv="KHR_materials_volume";class vy{constructor(v){this.name=mv,this.order=173,this._loader=v,this.enabled=this._loader.isExtensionUsed(mv),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(v,y,n)),P.push(this._loadVolumePropertiesAsync(B,y,n,J)),Promise.all(P).then((()=>{}))}))}_loadVolumePropertiesAsync(v,y,n,B){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);if(!n.subSurface.isRefractionEnabled&&!n.subSurface.isTranslucencyEnabled||!B.thicknessFactor)return Promise.resolve();n.subSurface.volumeIndexOfRefraction=n.indexOfRefraction;const J=void 0!==B.attenuationDistance?B.attenuationDistance:Number.MAX_VALUE;return n.subSurface.tintColorAtDistance=J,void 0!==B.attenuationColor&&3==B.attenuationColor.length&&n.subSurface.tintColor.Ae(B.attenuationColor[0],B.attenuationColor[1],B.attenuationColor[2]),n.subSurface.minimumThickness=0,n.subSurface.maximumThickness=B.thicknessFactor,n.subSurface.useThicknessAsDepth=!0,B.thicknessTexture?(B.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${v}/thicknessTexture`,B.thicknessTexture).then((v=>{v.name=`${n.name} (Thickness)`,n.subSurface.thicknessTexture=v,n.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}K(mv),e(mv,!0,(v=>new vy(v)));const yy="KHR_materials_dispersion";class ny{constructor(v){this.name=yy,this.order=174,this._loader=v,this.enabled=this._loader.isExtensionUsed(yy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(v,y,n)),P.push(this._loadDispersionPropertiesAsync(B,y,n,J)),Promise.all(P).then((()=>{}))}))}_loadDispersionPropertiesAsync(v,y,n,B){if(!(n instanceof d))throw new Error(`${v}: Material type not supported`);return n.subSurface.isRefractionEnabled&&B.dispersion?(n.subSurface.isDispersionEnabled=!0,n.subSurface.dispersion=B.dispersion,Promise.resolve()):Promise.resolve()}}K(yy),e(yy,!0,(v=>new ny(v)));const By="KHR_mesh_quantization";class Jy{constructor(v){this.name=By,this.enabled=v.isExtensionUsed(By)}dispose(){}}K(By),e(By,!0,(v=>new Jy(v)));const Py="KHR_texture_basisu";class by{constructor(v){this.name=Py,this._loader=v,this.enabled=v.isExtensionUsed(Py)}dispose(){this._loader=null}_loadTextureAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>{const P=void 0==y.sampler?o.DefaultSampler:Q.Get(`${v}/sampler`,this._loader.aj.samplers,y.sampler),b=Q.Get(`${B}/source`,this._loader.aj.images,J.source);return this._loader._createTextureAsync(v,P,b,(v=>{n(v)}),y._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!y._textureInfo.nonColorData)}))}}K(Py),e(Py,!0,(v=>new by(v)));const Yy="KHR_texture_transform";class ly{constructor(v){this.name=Yy,this._loader=v,this.enabled=this._loader.isExtensionUsed(Yy)}dispose(){this._loader=null}loadTextureInfoAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((B,J)=>this._loader.loadTextureInfoAsync(v,y,(v=>{if(!(v instanceof q.b))throw new Error(`${B}: Texture type not supported`);J.offset&&(v.uOffset=J.offset[0],v.vOffset=J.offset[1]),v.uRotationCenter=0,v.vRotationCenter=0,J.rotation&&(v.wAng=-J.rotation),J.scale&&(v.uScale=J.scale[0],v.vScale=J.scale[1]),void 0!=J.texCoord&&(v.coordinatesIndex=J.texCoord),n(v)}))))}}K(Yy),e(Yy,!0,(v=>new ly(v)));const ay="KHR_xmp_json_ld";class Zy{constructor(v){this.name=ay,this.order=100,this._loader=v,this.enabled=this._loader.isExtensionUsed(ay)}dispose(){this._loader=null}onLoading(){var v,y,n;if(null===this._loader.rootBabylonMesh)return;const B=null===(v=this._loader.aj.extensions)||void 0===v?void 0:v.KHR_xmp_json_ld,J=null===(y=this._loader.aj.asset)||void 0===y||null===(n=y.extensions)||void 0===n?void 0:n.KHR_xmp_json_ld;if(B&&J){const v=+J.packet;B.packets&&v<B.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=B.packets[v])}}}function xy(v,y,n,B){return P.d.qh(y,n).scale(B)}function fy(v,y,n,B){return y[n]*B}function Ny(v,y,n,B){return-y[n]*B}function iy(v,y,n,B){return y[n+1]*B}function gy(v,y,n,B){return y[n]*B*2}function cy(v){return{scale:[new Ey(f.c.ANIMATIONTYPE_FLOAT,`${v}.uScale`,fy,(()=>2)),new Ey(f.c.ANIMATIONTYPE_FLOAT,`${v}.vScale`,iy,(()=>2))],offset:[new Ey(f.c.ANIMATIONTYPE_FLOAT,`${v}.uOffset`,fy,(()=>2)),new Ey(f.c.ANIMATIONTYPE_FLOAT,`${v}.vOffset`,iy,(()=>2))],rotation:[new Ey(f.c.ANIMATIONTYPE_FLOAT,`${v}.wAng`,Ny,(()=>1))]}}K(ay),e(ay,!0,(v=>new Zy(v)));class hy extends H{buildAnimations(v,y,n,B,J){J(v._babylonCamera,this._buildAnimation(y,n,B))}}class Ey extends H{buildAnimations(v,y,n,B,J){for(const P in v._data)J(v._data[P].babylonMaterial,this._buildAnimation(y,n,B))}}class Wy extends H{buildAnimations(v,y,n,B,J){J(v._babylonLight,this._buildAnimation(y,n,B))}}const sy={__array__:{__target__:!0,...X}},Cy={__array__:{__target__:!0,orthographic:{xmag:[new hy(f.c.ANIMATIONTYPE_FLOAT,"orthoLeft",Ny,(()=>1)),new hy(f.c.ANIMATIONTYPE_FLOAT,"orthoRight",iy,(()=>1))],ymag:[new hy(f.c.ANIMATIONTYPE_FLOAT,"orthoBottom",Ny,(()=>1)),new hy(f.c.ANIMATIONTYPE_FLOAT,"orthoTop",iy,(()=>1))],zfar:[new hy(f.c.ANIMATIONTYPE_FLOAT,"maxZ",fy,(()=>1))],znear:[new hy(f.c.ANIMATIONTYPE_FLOAT,"ij",fy,(()=>1))]},perspective:{yfov:[new hy(f.c.ANIMATIONTYPE_FLOAT,"fov",fy,(()=>1))],zfar:[new hy(f.c.ANIMATIONTYPE_FLOAT,"maxZ",fy,(()=>1))],znear:[new hy(f.c.ANIMATIONTYPE_FLOAT,"ij",fy,(()=>1))]}}},ry={nodes:sy,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new Ey(f.c.ANIMATIONTYPE_COLOR3,"albedoColor",xy,(()=>4)),new Ey(f.c.ANIMATIONTYPE_FLOAT,"alpha",(function(v,y,n,B){return y[n+3]*B}),(()=>4))],metallicFactor:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"metallic",fy,(()=>1))],roughnessFactor:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"roughness",fy,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:cy("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:cy("metallicTexture")}}},emissiveFactor:[new Ey(f.c.ANIMATIONTYPE_COLOR3,"emissiveColor",xy,(()=>3))],normalTexture:{scale:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",fy,(()=>1))],extensions:{KHR_texture_transform:cy("bumpTexture")}},occlusionTexture:{strength:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",fy,(()=>1))],extensions:{KHR_texture_transform:cy("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:cy("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",fy,(()=>1))],anisotropyRotation:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",fy,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:cy("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",fy,(()=>1))],clearcoatRoughnessFactor:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",fy,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:cy("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",fy,(()=>1))],extensions:{KHR_texture_transform:cy("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:cy("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",fy,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",fy,(()=>1))]},KHR_materials_ior:{ior:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",fy,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",fy,(()=>1))],iridescenceIor:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",fy,(()=>1))],iridescenceThicknessMinimum:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",fy,(()=>1))],iridescenceThicknessMaximum:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",fy,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:cy("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:cy("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new Ey(f.c.ANIMATIONTYPE_COLOR3,"sheen.color",xy,(()=>3))],sheenRoughnessFactor:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",fy,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:cy("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:cy("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",fy,(()=>1))],specularColorFactor:[new Ey(f.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",xy,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:cy("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:cy("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",fy,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:cy("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new Ey(f.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",xy,(()=>3))],attenuationDistance:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",fy,(()=>1))],thicknessFactor:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",fy,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:cy("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new Ey(f.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",fy,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:cy("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new Ey(f.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",xy,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:cy("subSurface.translucencyColorTexture")}}}}}},cameras:Cy,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new Wy(f.c.ANIMATIONTYPE_COLOR3,"diffuse",xy,(()=>3))],mj:[new Wy(f.c.ANIMATIONTYPE_FLOAT,"intensity",fy,(()=>1))],range:[new Wy(f.c.ANIMATIONTYPE_FLOAT,"range",fy,(()=>1))],spot:{innerConeAngle:[new Wy(f.c.ANIMATIONTYPE_FLOAT,"innerAngle",gy,(()=>1))],outerConeAngle:[new Wy(f.c.ANIMATIONTYPE_FLOAT,"angle",gy,(()=>1))]}}}}}};class uy{constructor(v,y){this._gltf=v,this._infoTree=y}convert(v){let y,n=this._gltf,B=this._infoTree;if(!v.startsWith("/"))throw new Error("Path must start with a /");const J=v.split("/");J.shift();for(const P of J){if(B.__array__)B=B.__array__;else if(B=B[P],!B)throw new Error(`Path ${v} is invalid`);if(void 0===n)throw new Error(`Path ${v} is invalid`);n=n[P],B.__target__&&(y=n)}return{object:y,info:B}}}const Oy="KHR_animation_pointer";class dy extends uy{constructor(v){super(v,ry)}}class qy{constructor(v){this.name=Oy,this._loader=v,this._pathToObjectConverter=new dy(this._loader.aj)}get enabled(){return this._loader.isExtensionUsed(Oy)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(v,y,n,B,J){var P;const b=null===(P=B.target.extensions)||void 0===P?void 0:P.KHR_animation_pointer;if(!b||!this._pathToObjectConverter)return null;"pointer"!==B.target.path&&g.e.Warn(`${v}/target/path: Value (${B.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=B.target.node&&g.e.Warn(`${v}/target/node: Value (${B.target.node}) must not be present when using the ${this.name} extension`);const Y=`${v}/extensions/${this.name}`,l=b.pointer;if(!l)throw new Error(`${Y}: Pointer is missing`);try{const P=this._pathToObjectConverter.convert(l);return this._loader._loadAnimationChannelFromTargetInfoAsync(v,y,n,B,P,J)}catch(a){return g.e.Warn(`${Y}/pointer: Invalid pointer (${l}) skipped`),null}}}K(Oy),e(Oy,!0,(v=>new qy(v)));class Ly{constructor(v,y,n){this.frame=v,this.action=y,this.onlyOnce=n,this.isDone=!1}_clone(){return new Ly(this.frame,this.action,this.onlyOnce)}}var ty=n(10811),Gy=n(10849);class Ry{get loop(){return this._loop}set loop(v){v!==this._loop&&(this._loop=v,this.updateOptions({loop:v}))}get currentTime(){var v;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(v=Gy.c.audioEngine)&&void 0!==v&&v.audioContext&&(this.isPlaying||this.isPaused)){const v=this.isPaused?0:Gy.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+v}return 0}get spatialSound(){return this._spatialSound}set spatialSound(v){if(v==this._spatialSound)return;const y=this.isPlaying;this.pause(),v?(this._spatialSound=v,this._updateSpatialParameters()):this._disableSpatialSound(),y&&this.play()}constructor(v,y,n){var B;let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new Z.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=J.n.Zero(),this._localDirection=new J.n(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=v,n=n||i.b.LastCreatedScene)if(this._scene=n,Ry._SceneComponentInitialization(n),this._readyToPlayCallback=P,this._customAttenuationFunction=(v,y,n,B,J)=>y<n?v*(1-y/n):0,Y&&(this.autoplay=Y.autoplay||!1,this._loop=Y.loop||!1,void 0!==Y.volume&&(this._volume=Y.volume),this._spatialSound=Y.spatialSound??!1,this.maxDistance=Y.maxDistance??100,this.useCustomAttenuation=Y.useCustomAttenuation??!1,this.rolloffFactor=Y.rolloffFactor||1,this.refDistance=Y.refDistance||1,this.distanceModel=Y.distanceModel||"linear",this._playbackRate=Y.playbackRate||1,this._streaming=Y.streaming??!1,this._length=Y.length,this._offset=Y.offset),null!==(B=Gy.c.audioEngine)&&void 0!==B&&B.canUseWebAudio&&Gy.c.audioEngine.audioContext){this._soundGain=Gy.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let v=!0;if(y)try{"string"===typeof y?(this._urlType="String",this._url=y):y instanceof ArrayBuffer?this._urlType="ArrayBuffer":y instanceof HTMLMediaElement?this._urlType="MediaElement":y instanceof MediaStream?this._urlType="MediaStream":y instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(y)&&(this._urlType="Array");let n=[],B=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Gy.c.audioEngine.audioContext.createMediaElementSource(y),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Gy.c.audioEngine.audioContext.createMediaStreamSource(y),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":y.byteLength>0&&(B=!0,this._soundLoaded(y));break;case"AudioBuffer":this._audioBufferLoaded(y);break;case"String":n.push(y);case"Array":0===n.length&&(n=y);for(let v=0;v<n.length;v++){const y=n[v];if(B=Y&&Y.skipCodecCheck||-1!==y.indexOf(".mp3",y.length-4)&&Gy.c.audioEngine.isMP3supported||-1!==y.indexOf(".ogg",y.length-4)&&Gy.c.audioEngine.isOGGsupported||-1!==y.indexOf(".wav",y.length-4)||-1!==y.indexOf(".m4a",y.length-4)||-1!==y.indexOf(".mp4",y.length-4)||-1!==y.indexOf("blob:"),B){this._streaming?(this._htmlAudioElement=new Audio(y),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,b.g.SetCorsBehavior(y,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(y,(v=>{this._soundLoaded(v)}),void 0,!0,!0,(v=>{v&&g.e.Error("XHR "+v.status+" error on: "+y+"."),g.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:v=!1}v?B||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):g.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(l){g.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Gy.c.audioEngine&&!Gy.c.audioEngine.WarnedWebAudioUnsupported&&(g.e.Error("Web Audio is not supported by your browser."),Gy.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var v;null!==(v=Gy.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(v){var y;null!==(y=Gy.c.audioEngine)&&void 0!==y&&y.audioContext&&(this._audioBuffer=v,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(v){var y;null!==(y=Gy.c.audioEngine)&&void 0!==y&&y.audioContext&&Gy.c.audioEngine.audioContext.decodeAudioData(v,(v=>{this._audioBufferLoaded(v)}),(v=>{g.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+v)}))}setAudioBuffer(v){var y;null!==(y=Gy.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&(this._audioBuffer=v,this._isReadyToPlay=!0)}updateOptions(v){v&&(this.loop=v.loop??this.loop,this.maxDistance=v.maxDistance??this.maxDistance,this.useCustomAttenuation=v.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=v.rolloffFactor??this.rolloffFactor,this.refDistance=v.refDistance??this.refDistance,this.distanceModel=v.distanceModel??this.distanceModel,this._playbackRate=v.playbackRate??this._playbackRate,this._length=v.length??void 0,this.spatialSound=v.spatialSound??this._spatialSound,this._setOffset(v.offset??void 0),this.setVolume(v.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var v;null!==(v=Gy.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&Gy.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Gy.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var v;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(v=this._soundPanner)||void 0===v||v.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var v;null!==(v=Gy.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(v){var y;null!==(y=Gy.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(v),this._isOutputConnected=!0)}setDirectionalCone(v,y,n){y<v?g.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=v,this._coneOuterAngle=y,this._coneOuterGain=n,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(v){if(v!=this._coneInnerAngle){var y;if(this._coneOuterAngle<v)return void g.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=v,null!==(y=Gy.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(v){if(v!=this._coneOuterAngle){var y;if(v<this._coneInnerAngle)return void g.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=v,null!==(y=Gy.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(v){var y;v.equals(this._position)||(this._position.p(v),null!==(y=Gy.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(v){var y;this._localDirection=v,null!==(y=Gy.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const v=this._connectedTransformNode.getWorldMatrix(),y=J.n.TransformNormal(this._localDirection,v);y.normalize(),this._soundPanner.orientationX.value=y.x,this._soundPanner.orientationY.value=y.y,this._soundPanner.orientationZ.value=y.z}updateDistanceFromListener(){var v;if(null!==(v=Gy.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const v=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.od(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,v,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(v){this._customAttenuationFunction=v}play(v,y,n){var B;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(B=Gy.c.audioEngine)&&void 0!==B&&B.audioContext)try{var J,P;this._clearTimeoutsAndObservers();let B=v?(null===(J=Gy.c.audioEngine)||void 0===J?void 0:J.audioContext.currentTime)+v:null===(P=Gy.c.audioEngine)||void 0===P?void 0:P.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Gy.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const v=()=>{var n;if(null!==(n=Gy.c.audioEngine)&&void 0!==n&&n.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=y??0;const n=this._htmlAudioElement.play();void 0!==n&&n.catch((()=>{var y,n;(null===(y=Gy.c.audioEngine)||void 0===y||y.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(n=Gy.c.audioEngine)||void 0===n?void 0:n.onAudioUnlockedObservable.addOnce((()=>{v()})))}))}else{var B;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(B=Gy.c.audioEngine)||void 0===B?void 0:B.onAudioUnlockedObservable.addOnce((()=>{v()}))}};v()}}else{var b;const J=()=>{var J;if(null!==(J=Gy.c.audioEngine)&&void 0!==J&&J.audioContext){var P;if(n=n||this._length,void 0!==y&&this._setOffset(y),this._soundSource){const v=this._soundSource;v.onended=()=>{v.disconnect()}}if(this._soundSource=null===(P=Gy.c.audioEngine)||void 0===P?void 0:P.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var b;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==y&&(this._soundSource.loopStart=y),void 0!==n&&(this._soundSource.loopEnd=(0|y)+n),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},B=v?(null===(b=Gy.c.audioEngine)||void 0===b?void 0:b.audioContext.currentTime)+v:Gy.c.audioEngine.audioContext.currentTime;const J=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(B,J,this.loop?void 0:n)}}};"suspended"===(null===(b=Gy.c.audioEngine)||void 0===b?void 0:b.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var v;"suspended"===(null===(v=Gy.c.audioEngine)||void 0===v?void 0:v.audioContext.state)?(Gy.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Gy.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{J()})))):J()}),500):J()}this._startTime=B,this.isPlaying=!0,this.isPaused=!1}catch(Y){g.e.Error("Error while trying to play audio: "+this.name+", "+Y.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(v){var y;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var n;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(n=this._streamingSource)||void 0===n||n.disconnect();this.isPlaying=!1}else if(null!==(y=Gy.c.audioEngine)&&void 0!==y&&y.audioContext&&this._soundSource){const y=v?Gy.c.audioEngine.audioContext.currentTime+v:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(y)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var v;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var y;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(y=this._streamingSource)||void 0===y||y.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(v=Gy.c.audioEngine)&&void 0!==v&&v.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Gy.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(v,y){var n;null!==(n=Gy.c.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._soundGain&&(y&&Gy.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Gy.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Gy.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(v,Gy.c.audioEngine.audioContext.currentTime+y)):this._soundGain.gain.value=v),this._volume=v}setPlaybackRate(v){this._playbackRate=v,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(v){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=v,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=v=>this._onRegisterAfterWorldMatrixUpdate(v),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(v){var y;if(v.getBoundingInfo){const y=v.getBoundingInfo();this.setPosition(y.boundingSphere.centerWorld)}else this.setPosition(v.absolutePosition);null!==(y=Gy.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const v=()=>{this._isReadyToPlay?(n._audioBuffer=this.getAudioBuffer(),n._isReadyToPlay=!0,n.autoplay&&n.play(0,this._offset,this._length)):setTimeout(v,300)},y={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},n=new Ry(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,y);return this.useCustomAttenuation&&n.setAttenuationFunction(this._customAttenuationFunction),n.setPosition(this._position),n.setPlaybackRate(this._playbackRate),v(),n}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const v={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(v.connectedMeshId=this._connectedTransformNode.id),v.position=this._position.wj(),v.refDistance=this.refDistance,v.distanceModel=this.distanceModel,v.isDirectional=this._isDirectional,v.localDirectionToMesh=this._localDirection.wj(),v.coneInnerAngle=this._coneInnerAngle,v.coneOuterAngle=this._coneOuterAngle,v.coneOuterGain=this._coneOuterGain),v}static Parse(v,y,n,B){const P=v.name;let b;b=v.url?n+v.url:n+P;const Y={autoplay:v.autoplay,loop:v.loop,volume:v.volume,spatialSound:v.spatialSound,maxDistance:v.maxDistance,rolloffFactor:v.rolloffFactor,refDistance:v.refDistance,distanceModel:v.distanceModel,playbackRate:v.playbackRate};let l;if(B){const v=()=>{B._isReadyToPlay?(l._audioBuffer=B.getAudioBuffer(),l._isReadyToPlay=!0,l.autoplay&&l.play(0,l._offset,l._length)):setTimeout(v,300)};l=new Ry(P,new ArrayBuffer(0),y,null,Y),v()}else l=new Ry(P,b,y,(()=>{y.removePendingData(l)}),Y),y.addPendingData(l);if(v.position){const y=J.n.qh(v.position);l.setPosition(y)}if(v.isDirectional&&(l.setDirectionalCone(v.coneInnerAngle||360,v.coneOuterAngle||360,v.coneOuterGain||0),v.localDirectionToMesh)){const y=J.n.qh(v.localDirectionToMesh);l.setLocalDirectionToMesh(y)}if(v.connectedMeshId){const n=y.getMeshById(v.connectedMeshId);n&&l.attachToMesh(n)}return v.metadata&&(l.metadata=v.metadata),l}_setOffset(v){this._offset!==v&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=v)}_clearTimeoutsAndObservers(){var v;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(v=Gy.c.audioEngine)||void 0===v||v.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Ry._SceneComponentInitialization=v=>{throw(0,ty.e)("AudioSceneComponent")},(0,u.g)("BABYLON.Sound",Ry);class Fy{constructor(v,y,n){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],y.length!==n.length)throw new Error("Sounds length does not equal weights length");this.loop=v,this._weights=n;let B=0;for(const P of n)B+=P;const J=B>0?1/B:0;for(let P=0;P<this._weights.length;P++)this._weights[P]*=J;this._sounds=y;for(const P of this._sounds)P.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(v){if(v!==this._coneInnerAngle){if(this._coneOuterAngle<v)return void g.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=v;for(const y of this._sounds)y.directionalConeInnerAngle=v}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(v){if(v!==this._coneOuterAngle){if(v<this._coneInnerAngle)return void g.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=v;for(const y of this._sounds)y.directionalConeOuterAngle=v}}get volume(){return this._volume}set volume(v){if(v!==this._volume)for(const y of this._sounds)y.setVolume(v)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(v){if(!this.isPaused){this.stop();const v=Math.random();let y=0;for(let n=0;n<this._weights.length;n++)if(y+=this._weights[n],v<=y){this._currentIndex=n;break}}const y=this._sounds[this._currentIndex??0];y.isReady()?y.play(0,this.isPaused?void 0:v):y.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Sy{constructor(v){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(v=v||i.b.LastCreatedScene)&&(this._scene=v,this.soundCollection=[],this._options=y,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var v;null!==(v=Gy.c.audioEngine)&&void 0!==v&&v.canUseWebAudio&&Gy.c.audioEngine.audioContext&&(this._outputAudioNode=Gy.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Gy.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Gy.c.audioEngine&&Gy.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(v){var y;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(y=Gy.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._outputAudioNode&&v.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==v.soundTrackId&&(-1===v.soundTrackId?this._scene.mainSoundTrack.removeSound(v):this._scene.soundTracks&&this._scene.soundTracks[v.soundTrackId].removeSound(v)),this.soundCollection.push(v),v.soundTrackId=this.id}removeSound(v){const y=this.soundCollection.indexOf(v);-1!==y&&this.soundCollection.splice(y,1)}setVolume(v){var y;null!==(y=Gy.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=v)}switchPanningModelToHRTF(){var v;if(null!==(v=Gy.c.audioEngine)&&void 0!==v&&v.canUseWebAudio)for(let y=0;y<this.soundCollection.length;y++)this.soundCollection[y].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var v;if(null!==(v=Gy.c.audioEngine)&&void 0!==v&&v.canUseWebAudio)for(let y=0;y<this.soundCollection.length;y++)this.soundCollection[y].switchPanningModelToEqualPower()}connectToAnalyser(v){var y;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=v,null!==(y=Gy.c.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Gy.c.audioEngine.masterGain))}}var wy=n(11149),ky=n(11070),My=(n(11630),n(10805));(0,n(11712).f)(wy.b.NAME_AUDIO,((v,y,n,B)=>{let J,P=[];if(n.nk=n.nk||[],void 0!==v.nk&&null!==v.nk)for(let Y=0,l=v.nk.length;Y<l;Y++){var b;const l=v.nk[Y];null!==(b=Gy.c.audioEngine)&&void 0!==b&&b.canUseWebAudio?(l.url||(l.url=l.name),P[l.url]?n.nk.push(Ry.Parse(l,y,B,P[l.url])):(J=Ry.Parse(l,y,B),P[l.url]=J,n.nk.push(J))):n.nk.push(new Ry(l.name,null,y))}P=[]})),Object.defineProperty(ky.e.prototype,"mainSoundTrack",{get:function(){let v=this._getComponent(wy.b.NAME_AUDIO);return v||(v=new Iy(this),this.fb(v)),this._mainSoundTrack||(this._mainSoundTrack=new Sy(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),ky.e.prototype.getSoundByName=function(v){let y;for(y=0;y<this.mainSoundTrack.soundCollection.length;y++)if(this.mainSoundTrack.soundCollection[y].name===v)return this.mainSoundTrack.soundCollection[y];if(this.soundTracks)for(let n=0;n<this.soundTracks.length;n++)for(y=0;y<this.soundTracks[n].soundCollection.length;y++)if(this.soundTracks[n].soundCollection[y].name===v)return this.soundTracks[n].soundCollection[y];return null},Object.defineProperty(ky.e.prototype,"audioEnabled",{get:function(){let v=this._getComponent(wy.b.NAME_AUDIO);return v||(v=new Iy(this),this.fb(v)),v.audioEnabled},set:function(v){let y=this._getComponent(wy.b.NAME_AUDIO);y||(y=new Iy(this),this.fb(y)),v?y.enableAudio():y.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(ky.e.prototype,"headphone",{get:function(){let v=this._getComponent(wy.b.NAME_AUDIO);return v||(v=new Iy(this),this.fb(v)),v.headphone},set:function(v){let y=this._getComponent(wy.b.NAME_AUDIO);y||(y=new Iy(this),this.fb(y)),v?y.switchAudioModeForHeadphones():y.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(ky.e.prototype,"audioListenerPositionProvider",{get:function(){let v=this._getComponent(wy.b.NAME_AUDIO);return v||(v=new Iy(this),this.fb(v)),v.audioListenerPositionProvider},set:function(v){let y=this._getComponent(wy.b.NAME_AUDIO);if(y||(y=new Iy(this),this.fb(y)),v&&"function"!==typeof v)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");y.audioListenerPositionProvider=v},enumerable:!0,configurable:!0}),Object.defineProperty(ky.e.prototype,"audioListenerRotationProvider",{get:function(){let v=this._getComponent(wy.b.NAME_AUDIO);return v||(v=new Iy(this),this.fb(v)),v.audioListenerRotationProvider},set:function(v){let y=this._getComponent(wy.b.NAME_AUDIO);if(y||(y=new Iy(this),this.fb(y)),v&&"function"!==typeof v)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");y.audioListenerRotationProvider=v},enumerable:!0,configurable:!0}),Object.defineProperty(ky.e.prototype,"audioPositioningRefreshRate",{get:function(){let v=this._getComponent(wy.b.NAME_AUDIO);return v||(v=new Iy(this),this.fb(v)),v.audioPositioningRefreshRate},set:function(v){let y=this._getComponent(wy.b.NAME_AUDIO);y||(y=new Iy(this),this.fb(y)),y.audioPositioningRefreshRate=v},enumerable:!0,configurable:!0});class Iy{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(v){this.name=wy.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new J.n,this._cachedCameraPosition=new J.n,this._lastCheck=0,this._invertMatrixTemp=new J.d,this._cameraDirectionTemp=new J.n,(v=v||i.b.LastCreatedScene)&&(this.$d=v,v.soundTracks=[],v.nk=[])}register(){this.$d._afterRenderStage.registerStep(wy.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(v){if(v.nk=[],this.$d.soundTracks)for(let y=0;y<this.$d.soundTracks.length;y++){const n=this.$d.soundTracks[y];for(let y=0;y<n.soundCollection.length;y++)v.nk.push(n.soundCollection[y].serialize())}}addFromContainer(v){v.nk&&v.nk.forEach((v=>{v.play(),v.autoplay=!0,this.$d.mainSoundTrack.addSound(v)}))}removeFromContainer(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v.nk&&v.nk.forEach((v=>{v.stop(),v.autoplay=!1,this.$d.mainSoundTrack.removeSound(v),y&&v.dispose()}))}dispose(){const v=this.$d;if(v._mainSoundTrack&&v.mainSoundTrack.dispose(),v.soundTracks)for(let y=0;y<v.soundTracks.length;y++)v.soundTracks[y].dispose()}disableAudio(){const v=this.$d;let y;for(this._audioEnabled=!1,Gy.c.audioEngine&&Gy.c.audioEngine.audioContext&&Gy.c.audioEngine.audioContext.suspend(),y=0;y<v.mainSoundTrack.soundCollection.length;y++)v.mainSoundTrack.soundCollection[y].pause();if(v.soundTracks)for(y=0;y<v.soundTracks.length;y++)for(let n=0;n<v.soundTracks[y].soundCollection.length;n++)v.soundTracks[y].soundCollection[n].pause()}enableAudio(){const v=this.$d;let y;for(this._audioEnabled=!0,Gy.c.audioEngine&&Gy.c.audioEngine.audioContext&&Gy.c.audioEngine.audioContext.resume(),y=0;y<v.mainSoundTrack.soundCollection.length;y++)v.mainSoundTrack.soundCollection[y].isPaused&&v.mainSoundTrack.soundCollection[y].play();if(v.soundTracks)for(y=0;y<v.soundTracks.length;y++)for(let n=0;n<v.soundTracks[y].soundCollection.length;n++)v.soundTracks[y].soundCollection[n].isPaused&&v.soundTracks[y].soundCollection[n].play()}switchAudioModeForHeadphones(){const v=this.$d;if(this._headphone=!0,v.mainSoundTrack.switchPanningModelToHRTF(),v.soundTracks)for(let y=0;y<v.soundTracks.length;y++)v.soundTracks[y].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const v=this.$d;if(this._headphone=!1,v.mainSoundTrack.switchPanningModelToEqualPower(),v.soundTracks)for(let y=0;y<v.soundTracks.length;y++)v.soundTracks[y].switchPanningModelToEqualPower()}_afterRender(){const v=My.d.Now;if(this._lastCheck&&v-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=v;const y=this.$d;if(!this._audioEnabled||!y._mainSoundTrack||!y.soundTracks||0===y._mainSoundTrack.soundCollection.length&&1===y.soundTracks.length)return;const n=Gy.c.audioEngine;if(n&&n.audioContext){let v,B=y.activeCamera;if(y.activeCameras&&y.activeCameras.length>0&&(B=y.activeCameras[0]),this.audioListenerPositionProvider){const v=this.audioListenerPositionProvider();n.audioContext.listener.setPosition(v.x||0,v.y||0,v.z||0)}else B?this._cachedCameraPosition.equals(B.globalPosition)||(this._cachedCameraPosition.p(B.globalPosition),n.audioContext.listener.setPosition(B.globalPosition.x,B.globalPosition.y,B.globalPosition.z)):n.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const v=this.audioListenerRotationProvider();n.audioContext.listener.setOrientation(v.x||0,v.y||0,v.z||0,0,1,0)}else B?(B.rigCameras&&B.rigCameras.length>0&&(B=B.rigCameras[0]),B.getViewMatrix().invertToRef(this._invertMatrixTemp),J.n.TransformNormalToRef(Iy._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),n.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):n.audioContext.listener.setOrientation(0,0,0,0,1,0);for(v=0;v<y.mainSoundTrack.soundCollection.length;v++){const n=y.mainSoundTrack.soundCollection[v];n.useCustomAttenuation&&n.updateDistanceFromListener()}if(y.soundTracks)for(v=0;v<y.soundTracks.length;v++)for(let n=0;n<y.soundTracks[v].soundCollection.length;n++){const B=y.soundTracks[v].soundCollection[n];B.useCustomAttenuation&&B.updateDistanceFromListener()}}}}Iy._CameraDirection=new J.n(0,0,-1),Ry._SceneComponentInitialization=v=>{let y=v._getComponent(wy.b.NAME_AUDIO);y||(y=new Iy(v),v.fb(y))};const jy="MSFT_audio_emitter";class Vy{constructor(v){this.name=jy,this._loader=v,this.enabled=this._loader.isExtensionUsed(jy)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const v=this._loader.aj.extensions;if(v&&v[this.name]){const y=v[this.name];this._clips=y.clips,this._emitters=y.emitters,Q.Assign(this._clips),Q.Assign(this._emitters)}}loadSceneAsync(v,y){return o.LoadExtensionAsync(v,y,this.name,((n,B)=>{const J=new Array;J.push(this._loader.loadSceneAsync(v,y));for(const v of B.emitters){const y=Q.Get(`${n}/emitters`,this._emitters,v);if(void 0!=y.refDistance||void 0!=y.maxDistance||void 0!=y.rolloffFactor||void 0!=y.distanceModel||void 0!=y.innerAngle||void 0!=y.outerAngle)throw new Error(`${n}: Direction or Distance properties are not allowed on emitters attached to a scene`);J.push(this._loadEmitterAsync(`${n}/emitters/${y.index}`,y))}return Promise.all(J).then((()=>{}))}))}loadNodeAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((v,B)=>{const P=new Array;return this._loader.loadNodeAsync(v,y,(y=>{for(const n of B.emitters){const B=Q.Get(`${v}/emitters`,this._emitters,n);P.push(this._loadEmitterAsync(`${v}/emitters/${B.index}`,B).then((()=>{for(const v of B._babylonSounds)v.attachToMesh(y),void 0==B.innerAngle&&void 0==B.outerAngle||(v.setLocalDirectionToMesh(J.n.Forward()),v.setDirectionalCone(2*b.g.ToDegrees(void 0==B.innerAngle?Math.PI:B.innerAngle),2*b.g.ToDegrees(void 0==B.outerAngle?Math.PI:B.outerAngle),0))})))}n(y)})).then((v=>Promise.all(P).then((()=>v))))}))}loadAnimationAsync(v,y){return o.LoadExtensionAsync(v,y,this.name,((n,B)=>this._loader.loadAnimationAsync(v,y).then((J=>{const P=new Array;Q.Assign(B.events);for(const b of B.events)P.push(this._loadAnimationEventAsync(`${n}/events/${b.index}`,v,y,b,J));return Promise.all(P).then((()=>J))}))))}_loadClipAsync(v,y){if(y._objectURL)return y._objectURL;let n;if(y.uri)n=this._loader.loadUriAsync(v,y,y.uri);else{const B=Q.Get(`${v}/bufferView`,this._loader.aj.bufferViews,y.bufferView);n=this._loader.loadBufferViewAsync(`/bufferViews/${B.index}`,B)}return y._objectURL=n.then((v=>URL.createObjectURL(new Blob([v],{type:y.mimeType})))),y._objectURL}_loadEmitterAsync(v,y){if(y._babylonSounds=y._babylonSounds||[],!y._babylonData){const v=new Array,n=y.name||`emitter${y.index}`,B={loop:!1,autoplay:!1,volume:void 0==y.volume?1:y.volume};for(let P=0;P<y.clips.length;P++){const J=`/extensions/${this.name}/clips`,b=Q.Get(J,this._clips,y.clips[P].clip);v.push(this._loadClipAsync(`${J}/${y.clips[P].clip}`,b).then((v=>{const J=y._babylonSounds[P]=new Ry(n,v,this._loader.babylonScene,null,B);J.refDistance=y.refDistance||1,J.maxDistance=y.maxDistance||256,J.rolloffFactor=y.rolloffFactor||1,J.distanceModel=y.distanceModel||"exponential"})))}const J=Promise.all(v).then((()=>{const v=y.clips.map((v=>v.weight||1)),n=new Fy(y.loop||!1,y._babylonSounds,v);y.innerAngle&&(n.directionalConeInnerAngle=2*b.g.ToDegrees(y.innerAngle)),y.outerAngle&&(n.directionalConeOuterAngle=2*b.g.ToDegrees(y.outerAngle)),y.volume&&(n.volume=y.volume),y._babylonData.sound=n}));y._babylonData={loaded:J}}return y._babylonData.loaded}_getEventAction(v,y,n,B,J){switch(n){case"play":return v=>{const n=(J||0)+(v-B);y.play(n)};case"stop":return()=>{y.stop()};case"pause":return()=>{y.pause()};default:throw new Error(`${v}: Unsupported action ${n}`)}}_loadAnimationEventAsync(v,y,n,B,J){if(0==J.targetedAnimations.length)return Promise.resolve();const P=J.targetedAnimations[0],b=B.j,Y=Q.Get(`/extensions/${this.name}/emitters`,this._emitters,b);return this._loadEmitterAsync(v,Y).then((()=>{const y=Y._babylonData.sound;if(y){const n=new Ly(B.time,this._getEventAction(v,y,B.action,B.time,B.startOffset));P.animation.addEvent(n),J.onAnimationGroupEndObservable.add((()=>{y.stop()})),J.onAnimationGroupPauseObservable.add((()=>{y.pause()}))}}))}}K(jy),e(jy,!0,(v=>new Vy(v)));const py="MSFT_lod";class Hy{constructor(v){var y;this.name=py,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new Z.e,this.onMaterialLODsLoadedObservable=new Z.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=v,this.maxLODsToLoad=(null===(y=this._loader.parent.extensionOptions[py])||void 0===y?void 0:y.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(py)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let v=0;v<this._nodePromiseLODs.length;v++){const y=Promise.all(this._nodePromiseLODs[v]).then((()=>{0!==v&&(this._loader.endPerformanceCounter(`Node LOD ${v}`),this._loader.log(`Loaded node LOD ${v}`)),this.onNodeLODsLoadedObservable.notifyObservers(v),v!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${v+1}`),this._loadBufferLOD(this._nodeBufferLODs,v+1),this._nodeSignalLODs[v]&&this._nodeSignalLODs[v].resolve())}));this._loader._completePromises.push(y)}for(let v=0;v<this._materialPromiseLODs.length;v++){const y=Promise.all(this._materialPromiseLODs[v]).then((()=>{0!==v&&(this._loader.endPerformanceCounter(`Material LOD ${v}`),this._loader.log(`Loaded material LOD ${v}`)),this.onMaterialLODsLoadedObservable.notifyObservers(v),v!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${v+1}`),this._loadBufferLOD(this._materialBufferLODs,v+1),this._materialSignalLODs[v]&&this._materialSignalLODs[v].resolve())}));this._loader._completePromises.push(y)}}loadSceneAsync(v,y){const n=this._loader.loadSceneAsync(v,y);return this._loadBufferLOD(this._bufferLODs,0),n}loadNodeAsync(v,y,n){return o.LoadExtensionAsync(v,y,this.name,((v,J)=>{let P;const b=this._getLODs(v,y,this._loader.aj.nodes,J.ids);this._loader.logOpen(`${v}`);for(let y=0;y<b.length;y++){const v=b[y];0!==y&&(this._nodeIndexLOD=y,this._nodeSignalLODs[y]=this._nodeSignalLODs[y]||new B);const J=v=>{n(v),v.Nb(!1)},Y=this._loader.loadNodeAsync(`/nodes/${v.index}`,v,J).then((v=>{if(0!==y){const v=b[y-1];v._babylonTransformNode&&(this._disposeTransformNode(v._babylonTransformNode),delete v._babylonTransformNode)}return v.Nb(!0),v}));this._nodePromiseLODs[y]=this._nodePromiseLODs[y]||[],0===y?P=Y:(this._nodeIndexLOD=null,this._nodePromiseLODs[y].push(Y))}return this._loader.logClose(),P}))}_loadMaterialAsync(v,y,n,B,J){return this._nodeIndexLOD?null:o.LoadExtensionAsync(v,y,this.name,((v,P)=>{let b;const Y=this._getLODs(v,y,this._loader.aj.materials,P.ids);this._loader.logOpen(`${v}`);for(let y=0;y<Y.length;y++){const v=Y[y];0!==y&&(this._materialIndexLOD=y);const P=this._loader._loadMaterialAsync(`/materials/${v.index}`,v,n,B,(v=>{0===y&&J(v)})).then((v=>{if(0!==y){J(v);const n=Y[y-1]._data;n[B]&&(this._disposeMaterials([n[B].babylonMaterial]),delete n[B])}return v}));this._materialPromiseLODs[y]=this._materialPromiseLODs[y]||[],0===y?b=P:(this._materialIndexLOD=null,this._materialPromiseLODs[y].push(P))}return this._loader.logClose(),b}))}_loadUriAsync(v,y,n){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const J=this._nodeIndexLOD-1;return this._nodeSignalLODs[J]=this._nodeSignalLODs[J]||new B,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(v,y,n)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const J=this._materialIndexLOD-1;return this._materialSignalLODs[J]=this._materialSignalLODs[J]||new B,this._materialSignalLODs[J].promise.then((()=>this._loader.loadUriAsync(v,y,n)))}return null}loadBufferAsync(v,y,n,J){if(this._loader.parent.useRangeRequests&&!y.uri){if(!this._loader.bin)throw new Error(`${v}: Uri is missing or the binary glTF is missing its binary chunk`);const y=(v,y)=>{const P=n,b=P+J-1;let Y=v[y];return Y?(Y.start=Math.min(Y.start,P),Y.end=Math.max(Y.end,b)):(Y={start:P,end:b,loaded:new B},v[y]=Y),Y.loaded.promise.then((v=>new Uint8Array(v.buffer,v.byteOffset+n-Y.start,J)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?y(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?y(this._materialBufferLODs,this._materialIndexLOD):y(this._bufferLODs,0)}return null}_loadBufferLOD(v,y){const n=v[y];n&&(this._loader.log(`Loading buffer range [${n.start}-${n.end}]`),this._loader.bin.readAsync(n.start,n.end-n.start+1).then((v=>{n.loaded.resolve(v)}),(v=>{n.loaded.reject(v)})))}_getLODs(v,y,n,B){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const J=[];for(let P=B.length-1;P>=0;P--)if(J.push(Q.Get(`${v}/ids/${B[P]}`,n,B[P])),J.length===this.maxLODsToLoad)return J;return J.push(y),J}_disposeTransformNode(v){const y=[],n=v.material;n&&y.push(n);for(const J of v.getChildMeshes())J.material&&y.push(J.material);v.dispose();const B=y.filter((v=>this._loader.babylonScene.meshes.every((y=>y.material!=v))));this._disposeMaterials(B)}_disposeMaterials(v){const y={};for(const n of v){for(const v of n.getActiveTextures())y[v.uniqueId]=v;n.dispose()}for(const n in y)for(const v of this._loader.babylonScene.materials)v.hasTexture(y[n])&&delete y[n];for(const n in y)y[n].dispose()}}K(py),e(py,!0,(v=>new Hy(v)));const Ay="MSFT_minecraftMesh";class Xy{constructor(v){this.name=Ay,this._loader=v,this.enabled=this._loader.isExtensionUsed(Ay)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtraAsync(v,y,this.name,((B,J)=>{if(J){if(!(n instanceof d))throw new Error(`${B}: Material type not supported`);const J=this._loader.loadMaterialPropertiesAsync(v,y,n);return n.needAlphaBlending()&&(n.forceDepthWrite=!0,n.separateCullingPass=!0),n.Ch=n.forceDepthWrite,n.twoSidedLighting=!0,J}return null}))}}K(Ay),e(Ay,!0,(v=>new Xy(v)));const Uy="MSFT_sRGBFactors";class zy{constructor(v){this.name=Uy,this._loader=v,this.enabled=this._loader.isExtensionUsed(Uy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(v,y,n){return o.LoadExtraAsync(v,y,this.name,((B,J)=>{if(J){if(!(n instanceof d))throw new Error(`${B}: Material type not supported`);const J=this._loader.loadMaterialPropertiesAsync(v,y,n),P=n.va().getEngine().useExactSrgbConversions;return n.albedoTexture||n.albedoColor.toLinearSpaceToRef(n.albedoColor,P),n.reflectivityTexture||n.reflectivityColor.toLinearSpaceToRef(n.reflectivityColor,P),J}return null}))}}K(Uy),e(Uy,!0,(v=>new zy(v)));var ey,Ky=n(10911);!function(v){v[v.Input=0]="Input",v[v.Output=1]="Output"}(ey||(ey={}));class Dy{constructor(v,y,n){this._ownerBlock=n,this._connectedPoint=[],this.uniqueId=(0,Ky.b)(),this.connectedPointIds=[],this.name=v,this._connectionType=y}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(v){if(this._connectionType===v._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||v._isSingularConnection()&&v._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(v),v._connectedPoint.push(this)}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v.uniqueId=this.uniqueId,v.name=this.name,v._connectionType=this._connectionType,v.connectedPointIds=[],v.className=this.getClassName();for(const y of this._connectedPoint)v.connectedPointIds.push(y.uniqueId)}getClassName(){return"FGConnection"}deserialize(v){this.uniqueId=v.uniqueId,this.name=v.name,this._connectionType=v._connectionType,this.connectedPointIds=v.connectedPointIds}static Parse(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},y=arguments.length>1?arguments[1]:void 0;const n=new(b.g.Instantiate(v.className))(v.name,v._connectionType,y);return n.deserialize(v),n}}class Qy{constructor(v){this.value=this._toInt(v)}_toInt(v){return 0|v}add(v){return new Qy(this.value+v.value)}od(v){return new Qy(this.value-v.value)}multiply(v){return new Qy(Math.imul(this.value,v.value))}divide(v){return new Qy(this.value/v.value)}getClassName(){return Qy.ClassName}equals(v){return this.value===v.value}static Parse(v){return new Qy(v.value)}}Qy.ClassName="FlowGraphInteger",(0,u.g)("FlowGraphInteger",Qy);class oy{constructor(v,y){this.typeName=v,this.defaultValue=y}serialize(v){v.typeName=this.typeName,v.defaultValue=this.defaultValue}static Parse(v){return new oy(v.typeName,v.defaultValue)}}const Ty=new oy("any",void 0),my=(new oy("string",""),new oy("number",0)),vn=new oy("boolean",!1),yn=new oy("Vector2",J.j.Zero()),nn=new oy("o",J.n.Zero()),Bn=(new oy("Vector4",J.p.Zero()),new oy("Matrix",J.d.Identity())),Jn=(new oy("ib",P.d.Black()),new oy("pb",new P.e(0,0,0,0)),new oy("Quaternion",J.g.Identity()),new oy("FlowGraphInteger",new Qy(0)));class Pn extends Dy{constructor(v,y,n,B){super(v,y,n),this.richType=B}_isSingularConnection(){return 0===this.connectionType}setValue(v,y){y._setConnectionValue(this,v)}connectTo(v){super.connectTo(v)}_getValueOrDefault(v){return v._hasConnectionValue(this)?v._getConnectionValue(this):this.richType.defaultValue}getValue(v){return 1===this.connectionType?(v._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(v),this._getValueOrDefault(v)):this.isConnected()?this._connectedPoint[0].getValue(v):this._getValueOrDefault(v)}getClassName(){return"FGDataConnection"}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(v),v.richType={},this.richType.serialize(v.richType)}static Parse(v,y){const n=Dy.Parse(v,y);return n.richType=oy.Parse(v.richType),n}}function bn(v){return"Mesh"===v||"AbstractMesh"===v||"GroundMesh"===v||"InstanceMesh"===v||"LinesMesh"===v||"GoldbergMesh"===v||"GreasedLineMesh"===v||"TrailMesh"===v}function Yn(v){return"Vector2"===v||"o"===v||"Vector4"===v||"Quaternion"===v||"ib"===v||"pb"===v}function ln(v,y,n){var B;const J=(null===y||void 0===y||null===(B=y.getClassName)||void 0===B?void 0:B.call(y))??"";bn(J)?n[v]={name:y.name,className:J}:Yn(J)?n[v]={value:y.wj(),className:J}:n[v]=y}function an(v,y,n){const B=y[v];let b;const Y=null===B||void 0===B?void 0:B.className;return b=bn(Y)?n.getMeshByName(B.name):Yn(Y)?function(v,y){if("Vector2"===v)return J.j.qh(y);if("o"===v)return J.n.qh(y);if("Vector4"===v)return J.p.qh(y);if("Quaternion"===v)return J.g.qh(y);if("ib"===v)return new P.d(y[0],y[1],y[2]);if("pb"===v)return new P.e(y[0],y[1],y[2],y[3]);throw new Error(`Unknown vector class name ${v}`)}(Y,B.value):"Matrix"===Y?J.d.qh(B.value):Y===Qy.ClassName?Qy.Parse(B):B&&void 0!==B.value?B.value:B,b}(0,u.g)("FGDataConnection",Pn);class Zn{constructor(v){var y;this.config=v,this.uniqueId=(0,Ky.b)(),this.name=(null===(y=this.config)||void 0===y?void 0:y.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(v){}registerDataInput(v,y){const n=new Pn(v,0,this,y);return this.dataInputs.push(n),n}registerDataOutput(v,y){const n=new Pn(v,1,this,y);return this.dataOutputs.push(n),n}getDataInput(v){return this.dataInputs.find((y=>y.name===v))}getDataOutput(v){return this.dataOutputs.find((y=>y.name===v))}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v.uniqueId=this.uniqueId,v.config={},this.config&&(v.config.name=this.config.name),v.dataInputs=[],v.dataOutputs=[],v.className=this.getClassName();for(const y of this.dataInputs){const n={};y.serialize(n),v.dataInputs.push(n)}for(const y of this.dataOutputs){const n={};y.serialize(n),v.dataOutputs.push(n)}}getClassName(){return"FGBlock"}static Parse(v,y){const n=b.g.Instantiate(v.className),B={},J=y.valueParseFunction??an;if(v.config)for(const b in v.config)B[b]=J(b,v.config,y.$d);var P;("FGSetPropertyBlock"===(P=v.className)||"FGGetPropertyBlock"===P||"FGPlayAnimationBlock"===P||"FGMeshPickEventBlock"===P)&&(B.pathConverter=y.pathConverter);const Y=new n(B);Y.uniqueId=v.uniqueId;for(let b=0;b<v.dataInputs.length;b++){const y=Y.getDataInput(v.dataInputs[b].name);if(!y)throw new Error("Could not find data input with name "+v.dataInputs[b].name+" in block "+v.className);y.deserialize(v.dataInputs[b])}for(let b=0;b<v.dataOutputs.length;b++){const y=Y.getDataOutput(v.dataOutputs[b].name);if(!y)throw new Error("Could not find data output with name "+v.dataOutputs[b].name+" in block "+v.className);y.deserialize(v.dataOutputs[b])}return Y.metadata=v.metadata,Y.deserialize&&Y.deserialize(v),Y}}class xn extends Dy{_isSingularConnection(){return 1===this.connectionType}_activateSignal(v){var y;0===this.connectionType?(v._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(v,this),v._increaseExecutionId()):null===(y=this._connectedPoint[0])||void 0===y||y._activateSignal(v)}}(0,u.g)("FlowGraphSignalConnection",xn);class fn extends Zn{constructor(v){super(v),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(v){const y=new xn(v,0,this);return this.signalInputs.push(y),y}_registerSignalOutput(v){const y=new xn(v,1,this);return this.signalOutputs.push(y),y}getSignalInput(v){return this.signalInputs.find((y=>y.name===v))}getSignalOutput(v){return this.signalOutputs.find((y=>y.name===v))}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(v),v.signalInputs=[],v.signalOutputs=[];for(const y of this.signalInputs){const n={};y.serialize(n),v.signalInputs.push(n)}for(const y of this.signalOutputs){const n={};y.serialize(n),v.signalOutputs.push(n)}}deserialize(v){for(let y=0;y<v.signalInputs.length;y++){const n=this.getSignalInput(v.signalInputs[y].name);if(!n)throw new Error("Could not find signal input with name "+v.signalInputs[y].name+" in block "+v.className);n.deserialize(v.signalInputs[y])}for(let y=0;y<v.signalOutputs.length;y++){const n=this.getSignalOutput(v.signalOutputs[y].name);if(!n)throw new Error("Could not find signal output with name "+v.signalOutputs[y].name+" in block "+v.className);n.deserialize(v.signalOutputs[y])}}getClassName(){return"FGExecutionBlock"}}class Nn extends fn{constructor(v){super(v),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(v){this._preparePendingTasks(v),v._addPendingBlock(this)}}class gn extends Nn{_execute(v){v._notifyExecuteNode(this),this.out._activateSignal(v)}}class cn{constructor(v){this.uniqueId=(0,Ky.b)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new Z.e,this._configuration=v}hasVariable(v){return v in this._userVariables}setVariable(v,y){this._userVariables[v]=y}getVariable(v){return this._userVariables[v]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(v,y){return`${v.uniqueId}_${y}`}_setExecutionVariable(v,y,n){this._executionVariables[this._getUniqueIdPrefixedName(v,y)]=n}_getExecutionVariable(v,y,n){return this._hasExecutionVariable(v,y)?this._executionVariables[this._getUniqueIdPrefixedName(v,y)]:n}_deleteExecutionVariable(v,y){delete this._executionVariables[this._getUniqueIdPrefixedName(v,y)]}_hasExecutionVariable(v,y){return this._getUniqueIdPrefixedName(v,y)in this._executionVariables}_hasConnectionValue(v){return v.uniqueId in this._connectionValues}_setConnectionValue(v,y){this._connectionValues[v.uniqueId]=y}_getConnectionValue(v){return this._connectionValues[v.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(v){this._pendingBlocks.push(v)}_removePendingBlock(v){const y=this._pendingBlocks.indexOf(v);-1!==y&&this._pendingBlocks.splice(y,1)}_clearPendingBlocks(){for(const v of this._pendingBlocks)v._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(v){this.onNodeExecutedObservable.notifyObservers(v)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ln;v.uniqueId=this.uniqueId,v._userVariables={};for(const n in this._userVariables)y(n,this._userVariables[n],v._userVariables);v._connectionValues={};for(const n in this._connectionValues)y(n,this._connectionValues[n],v._connectionValues)}getClassName(){return"FGContext"}static Parse(v,y){const n=y.graph.createContext(),B=y.valueParseFunction??an;n.uniqueId=v.uniqueId;for(const J in v._userVariables){const y=B(J,v._userVariables,n._configuration.$d);n._userVariables[J]=y}for(const J in v._connectionValues){const y=B(J,v._connectionValues,n._configuration.$d);n._connectionValues[J]=y}return n}}(0,W.c)([(0,s.M)()],cn.prototype,"uniqueId",void 0);var hn,En,Wn=n(11151);function sn(v,y){return!(!v.parent||v.parent!==y&&!sn(v.parent,y))}class Cn extends gn{constructor(v){super(v),this.config=v}_getReferencedMesh(){const v=this.config.pathConverter.convert(this.config.path),y=v.info.getObject(v.object);if(!y||!(y instanceof R.d))throw new Error("Mesh pick event block requires a valid mesh");return y}_preparePendingTasks(v){let y=v._getExecutionVariable(this,"meshPickObserver");if(!y){const n=this._getReferencedMesh();v._setExecutionVariable(this,"mesh",n),y=n.va().onPointerObservable.add((y=>{var B,J,P;y.type===Wn.d.POINTERPICK&&null!==(B=y.pickInfo)&&void 0!==B&&B.pickedMesh&&((null===(J=y.pickInfo)||void 0===J?void 0:J.pickedMesh)===n||sn(null===(P=y.pickInfo)||void 0===P?void 0:P.pickedMesh,n))&&this._execute(v)}));const B=n.xj.add((()=>this._onDispose));v._setExecutionVariable(this,"meshPickObserver",y),v._setExecutionVariable(this,"meshDisposeObserver",B)}}_onDispose(v){this._cancelPendingTasks(v),v._removePendingBlock(this)}_cancelPendingTasks(v){const y=v._getExecutionVariable(this,"mesh"),n=v._getExecutionVariable(this,"meshPickObserver"),B=v._getExecutionVariable(this,"meshDisposeObserver");y.va().onPointerObservable.remove(n),y.xj.remove(B),v._deleteExecutionVariable(this,"mesh"),v._deleteExecutionVariable(this,"meshPickObserver"),v._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return Cn.ClassName}serialize(v){super.serialize(v),v.config.path=this.config.path}}Cn.ClassName="FGMeshPickEventBlock",(0,u.g)(Cn.ClassName,Cn),function(v){v[v.Stopped=0]="Stopped",v[v.Started=1]="Started"}(hn||(hn={}));class rn{constructor(v){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=v.$d,this._coordinator=v.coordinator,this._sceneDisposeObserver=this._scene.xj.add((()=>this.dispose()))}createContext(){const v=new cn({$d:this._scene,coordinator:this._coordinator});return this._executionContexts.push(v),v}getContext(v){return this._executionContexts[v]}addEventBlock(v){this._eventBlocks.push(v)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const v of this._executionContexts){const y=this._getContextualOrder();for(const n of y)n._startPendingTasks(v)}}}_getContextualOrder(){const v=[];for(const y of this._eventBlocks)if(y.getClassName()===Cn.ClassName){const n=y._getReferencedMesh();let B=0;for(;B<v.length;B++){const y=v[B]._getReferencedMesh();if(n&&y&&sn(n,y))break}v.splice(B,0,y)}else v.push(y);return v}dispose(){if(0!==this.state){this.state=0;for(const v of this._executionContexts)v._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.xj.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(v){const y=[],n=new Set;for(const B of this._eventBlocks)y.push(B),n.add(B.uniqueId);for(;y.length>0;){const B=y.pop();v(B);for(const v of B.dataInputs)for(const B of v._connectedPoint)n.has(B._ownerBlock.uniqueId)||(y.push(B._ownerBlock),n.add(B._ownerBlock.uniqueId));if(B instanceof fn)for(const v of B.signalOutputs)for(const B of v._connectedPoint)n.has(B._ownerBlock.uniqueId)||(y.push(B._ownerBlock),n.add(B._ownerBlock.uniqueId))}}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},y=arguments.length>1?arguments[1]:void 0;v.allBlocks=[],this.visitAllBlocks((y=>{const n={};y.serialize(n),v.allBlocks.push(n)})),v.executionContexts=[];for(const n of this._executionContexts){const B={};n.serialize(B,y),v.executionContexts.push(B)}}static GetDataOutConnectionByUniqueId(v,y){for(const n of v)for(const v of n.dataOutputs)if(v.uniqueId===y)return v;throw new Error("Could not find data out connection with unique id "+y)}static GetSignalInConnectionByUniqueId(v,y){for(const n of v)if(n instanceof fn)for(const v of n.signalInputs)if(v.uniqueId===y)return v;throw new Error("Could not find signal in connection with unique id "+y)}static Parse(v,y){const n=y.coordinator.createGraph(),B=[],J=y.valueParseFunction??an;for(const P of v.allBlocks){const v=Zn.Parse(P,{$d:y.coordinator.config.$d,pathConverter:y.pathConverter,valueParseFunction:J});B.push(v),v instanceof gn&&n.addEventBlock(v)}for(const P of B){for(const v of P.dataInputs)for(const y of v.connectedPointIds){const n=rn.GetDataOutConnectionByUniqueId(B,y);v.connectTo(n)}if(P instanceof fn)for(const v of P.signalOutputs)for(const y of v.connectedPointIds){const n=rn.GetSignalInConnectionByUniqueId(B,y);v.connectTo(n)}}for(const P of v.executionContexts)cn.Parse(P,{graph:n,valueParseFunction:J});return n}}class un{constructor(v){this.config=v,this._flowGraphs=[],this._customEventsMap=new Map,this.config.$d.xj.add((()=>{this.dispose()}));(un.SceneCoordinators.get(this.config.$d)??[]).push(this)}createGraph(){const v=new rn({$d:this.config.$d,coordinator:this});return this._flowGraphs.push(v),v}removeGraph(v){const y=this._flowGraphs.indexOf(v);-1!==y&&(v.dispose(),this._flowGraphs.splice(y,1))}start(){this._flowGraphs.forEach((v=>v.start()))}dispose(){this._flowGraphs.forEach((v=>v.dispose())),this._flowGraphs.length=0;const v=un.SceneCoordinators.get(this.config.$d)??[],y=v.indexOf(this);-1!==y&&v.splice(y,1)}serialize(v,y){v._flowGraphs=[],this._flowGraphs.forEach((n=>{const B={};n.serialize(B,y),v._flowGraphs.push(B)}))}static Parse(v,y){var n;const B=y.valueParseFunction??an,J=new un({$d:y.$d});return null===(n=v._flowGraphs)||void 0===n||n.forEach((v=>{rn.Parse(v,{coordinator:J,valueParseFunction:B,pathConverter:y.pathConverter})})),J}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(v){let y=this._customEventsMap.get(v);return y||(y=new Z.e,this._customEventsMap.set(v,y)),y}notifyCustomEvent(v,y){const n=this._customEventsMap.get(v);n&&n.notifyObservers(y)}}un.SceneCoordinators=new Map;class On extends gn{_preparePendingTasks(v){if(!v._getExecutionVariable(this,"sceneReadyObserver")){const y=v.configuration.$d.onReadyObservable.add((()=>{this._execute(v)}));v._setExecutionVariable(this,"sceneReadyObserver",y)}}_cancelPendingTasks(v){const y=v._getExecutionVariable(this,"sceneReadyObserver");v.configuration.$d.onReadyObservable.remove(y),v._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return On.ClassName}}On.ClassName="FGSceneReadyEventBlock",(0,u.g)("FGSceneReadyEventBlock",On);class dn extends gn{_preparePendingTasks(v){if(!v._getExecutionVariable(this,"sceneBeforeRender")){const y=v.configuration.$d.onBeforeRenderObservable.add((()=>{this._execute(v)}));v._setExecutionVariable(this,"sceneBeforeRender",y)}}_cancelPendingTasks(v){const y=v._getExecutionVariable(this,"sceneBeforeRender");v.configuration.$d.onBeforeRenderObservable.remove(y),v._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return dn.ClassName}}dn.ClassName="FGSceneTickEventBlock",(0,u.g)(dn.ClassName,dn);class qn extends fn{constructor(v){super(v),this.out=this._registerSignalOutput("out")}}class Ln extends qn{constructor(v){super(v),this.message=this.registerDataInput("message",Ty)}_execute(v){const y=this.message.getValue(v);g.e.Log(y),this.out._activateSignal(v)}getClassName(){return Ln.ClassName}}Ln.ClassName="FGConsoleLogBlock",(0,u.g)(Ln.ClassName,Ln),function(v){v[v.INIT=0]="INIT",v[v.STARTED=1]="STARTED",v[v.ENDED=2]="ENDED"}(En||(En={}));class tn{constructor(v){this.onEachCountObservable=new Z.e,this.onTimerAbortedObservable=new Z.e,this.onTimerEndedObservable=new Z.e,this.onStateChangedObservable=new Z.e,this._observer=null,this._breakOnNextTick=!1,this._tick=v=>{const y=Date.now();this._timer=y-this._startTime;const n={startTime:this._startTime,currentTime:y,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:v},B=this._breakOnNextTick||this._breakCondition(n);B||this._timer>=this._timeToEnd?this._stop(n,B):this.onEachCountObservable.notifyObservers(n)},this._setState(0),this._contextObservable=v.contextObservable,this._observableParameters=v.observableParameters??{},this._breakCondition=v.breakCondition??(()=>!1),this._timeToEnd=v.timeout,v.onEnded&&this.onTimerEndedObservable.add(v.onEnded),v.qi&&this.onEachCountObservable.add(v.qi),v.onAborted&&this.onTimerAbortedObservable.add(v.onAborted)}set breakCondition(v){this._breakCondition=v}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=v,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(v){this._state=v,this.onStateChangedObservable.notifyObservers(this._state)}_stop(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),y?this.onTimerAbortedObservable.notifyObservers(v):this.onTimerEndedObservable.notifyObservers(v)}}class Gn extends Nn{constructor(v){super(v),this.timeout=this.registerDataInput("timeout",my)}_preparePendingTasks(v){const y=this.timeout.getValue(v);if(void 0!==y&&y>=0){const n=v._getExecutionVariable(this,"runningTimers")||[],B=v.configuration.$d,J=new tn({timeout:y,contextObservable:B.onBeforeRenderObservable,onEnded:()=>this._onEnded(J,v)});J.start(),n.push(J),v._setExecutionVariable(this,"runningTimers",n)}}_execute(v){this._startPendingTasks(v),this.out._activateSignal(v)}_onEnded(v,y){const n=y._getExecutionVariable(this,"runningTimers")||[],B=n.indexOf(v);-1!==B?n.splice(B,1):b.g.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),y._removePendingBlock(this),this.done._activateSignal(y)}_cancelPendingTasks(v){const y=v._getExecutionVariable(this,"runningTimers")||[];for(const n of y)n.dispose();v._deleteExecutionVariable(this,"runningTimers")}getClassName(){return Gn.ClassName}}Gn.ClassName="FGTimerBlock",(0,u.g)("FGTimerBlock",Gn);class Rn extends qn{constructor(v){super(v),this.config=v;for(let y=0;y<this.config.eventData.length;y++){const v=this.config.eventData[y];this.registerDataInput(v,Ty)}}_execute(v){const y=this.config.eventId,n=this.dataInputs.map((y=>y.getValue(v)));v.configuration.coordinator.notifyCustomEvent(y,n),this.out._activateSignal(v)}getClassName(){return Rn.ClassName}}Rn.ClassName="FGSendCustomEventBlock",(0,u.g)("FGSendCustomEventBlock",Rn);class Fn extends gn{constructor(v){super(v),this.config=v;for(let y=0;y<this.config.eventData.length;y++){const v=this.config.eventData[y];this.registerDataOutput(v,Ty)}}_preparePendingTasks(v){const y=v.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=y.add((y=>{for(let n=0;n<y.length;n++)this.dataOutputs[n].setValue(y[n],v);this._execute(v)}))}_cancelPendingTasks(v){const y=v.configuration.coordinator.getCustomEventObservable(this.config.eventId);y?y.remove(this._eventObserver):b.g.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return Fn.ClassName}serialize(v){super.serialize(v),v.eventId=this.config.eventId,v.eventData=this.config.eventData}}Fn.ClassName="FGReceiveCustomEventBlock",(0,u.g)(Fn.ClassName,Fn);class Sn extends fn{constructor(v){super(v),this.config=v,this.outFlows=[];for(let y=0;y<this.config.numberOutputFlows;y++)this.outFlows.push(this._registerSignalOutput(`${y}`))}_execute(v){for(let y=0;y<this.config.numberOutputFlows;y++)this.outFlows[y]._activateSignal(v)}getClassName(){return Sn.ClassName}}Sn.ClassName="FGSequenceBlock",(0,u.g)(Sn.ClassName,Sn);const wn=new RegExp(/\{(\w+)\}/g);class kn{constructor(v,y){this.path=v,this.ownerBlock=y,this.templatedInputs=[];let n=wn.exec(v);for(;n;){const[,B]=n;this.templatedInputs.push(y.registerDataInput(B,Jn)),n=wn.exec(v)}}getAccessor(v,y){let n=this.path;for(const B of this.templatedInputs){const v=B.getValue(y).value;n=n.replace(`{${B.name}}`,v.toString())}return v.convert(n)}}class Mn extends Zn{constructor(v){super(v),this.config=v,this.value=this.registerDataOutput("value",Ty),this.templateComponent=new kn(v.path,this)}_updateOutputs(v){const y=this.templateComponent.getAccessor(this.config.pathConverter,v),n=y.info.get(y.object);this.value.setValue(n,v)}getClassName(){return Mn.ClassName}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(v),v.config.path=this.config.path}}Mn.ClassName="FGGetPropertyBlock",(0,u.g)(Mn.ClassName,Mn);class In extends qn{constructor(v){super(v),this.config=v,this.a=this.registerDataInput("a",Ty),this.templateComponent=new kn(v.path,this)}_execute(v){const y=this.a.getValue(v),n=this.templateComponent.getAccessor(this.config.pathConverter,v);n.info.set(y,n.object),this.out._activateSignal(v)}serialize(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(v),v.config.path=this.config.path}getClassName(){return In.ClassName}}In.ClassName="FGSetPropertyBlock",(0,u.g)("FGSetPropertyBlock",In);const jn="cachedOperationValue",Vn="cachedExecutionId";class pn extends Zn{constructor(v,y){super(y),this.value=this.registerDataOutput("value",v)}_updateOutputs(v){const y=v._getExecutionVariable(this,Vn),n=v._getExecutionVariable(this,jn);if(void 0!==n&&y===v.executionId)this.value.setValue(n,v);else{const y=this._doOperation(v);v._setExecutionVariable(this,jn,y),v._setExecutionVariable(this,Vn,v.executionId),this.value.setValue(y,v)}}}class Hn extends pn{constructor(v,y,n,B,J,P){super(n,P),this._operation=B,this._className=J,this.a=this.registerDataInput("a",v),this.b=this.registerDataInput("b",y)}_doOperation(v){return this._operation(this.a.getValue(v),this.b.getValue(v))}getClassName(){return this._className}}class An extends pn{constructor(v,y,n,B){super(v,B),this._operation=y,this._className=n}_doOperation(v){return this._operation()}getClassName(){return this._className}}class Xn extends pn{constructor(v,y,n,B,J){super(y,J),this._operation=n,this._className=B,this.a=this.registerDataInput("a",v)}_doOperation(v){return this._operation(this.a.getValue(v))}getClassName(){return this._className}}class Un extends pn{constructor(v,y,n,B,J,P,b){super(B,b),this._operation=J,this._className=P,this.a=this.registerDataInput("a",v),this.b=this.registerDataInput("b",y),this.c=this.registerDataInput("c",n)}_doOperation(v){return this._operation(this.a.getValue(v),this.b.getValue(v),this.c.getValue(v))}getClassName(){return this._className}}function zn(v){return v.getClassName?v.getClassName():""}function en(v,y){return"Vector2"===v&&"Vector2"===y||"o"===v&&"o"===y||"Vector4"===v&&"Vector4"===y}function Kn(v,y){return"Matrix"===v&&"Matrix"===y}function Dn(v,y){return"FlowGraphInteger"===v&&"FlowGraphInteger"===y}class Qn extends Hn{constructor(v){super(Ty,Ty,Ty,((v,y)=>this._polymorphicAdd(v,y)),Qn.ClassName,v)}_polymorphicAdd(v,y){const n=zn(v),B=zn(y);return en(n,B)||Kn(n,B)||Dn(n,B)?v.add(y):v+y}}Qn.ClassName="FGAddBlock",(0,u.g)(Qn.ClassName,Qn);class on extends Hn{constructor(v){super(Ty,Ty,Ty,((v,y)=>this._polymorphicAdd(v,y)),on.ClassName,v)}_polymorphicAdd(v,y){const n=zn(v),B=zn(y);return en(n,B)||Dn(n,B)?v.od(y):Kn(n,B)?v.add(y.scale(-1)):v-y}}on.ClassName="FGSubBlock",(0,u.g)(on.ClassName,on);class Tn extends Hn{constructor(v){super(Ty,Ty,Ty,((v,y)=>this._polymorphicMultiply(v,y)),Tn.ClassName,v)}_polymorphicMultiply(v,y){const n=zn(v),B=zn(y);return en(n,B)||Dn(n,B)?v.multiply(y):Kn(n,B)?J.d.FromValues(v.m[0]*y.m[0],v.m[4]*y.m[4],v.m[8]*y.m[8],v.m[12]*y.m[12],v.m[1]*y.m[1],v.m[5]*y.m[5],v.m[9]*y.m[9],v.m[13]*y.m[13],v.m[2]*y.m[2],v.m[6]*y.m[6],v.m[10]*y.m[10],v.m[14]*y.m[14],v.m[3]*y.m[3],v.m[7]*y.m[7],v.m[11]*y.m[11],v.m[15]*y.m[15]):v*y}}Tn.ClassName="FGMultiplyBlock",(0,u.g)(Tn.ClassName,Tn);class mn extends Hn{constructor(v){super(Ty,Ty,Ty,((v,y)=>this._polymorphicDivide(v,y)),mn.ClassName,v)}_polymorphicDivide(v,y){const n=zn(v),B=zn(y);return en(n,B)||Dn(n,B)?v.divide(y):Kn(n,B)?J.d.FromValues(v.m[0]/y.m[0],v.m[4]/y.m[4],v.m[8]/y.m[8],v.m[12]/y.m[12],v.m[1]/y.m[1],v.m[5]/y.m[5],v.m[9]/y.m[9],v.m[13]/y.m[13],v.m[2]/y.m[2],v.m[6]/y.m[6],v.m[10]/y.m[10],v.m[14]/y.m[14],v.m[3]/y.m[3],v.m[7]/y.m[7],v.m[11]/y.m[11],v.m[15]/y.m[15]):v/y}}mn.ClassName="FGDivideBlock",(0,u.g)(mn.ClassName,mn);class vB extends An{constructor(v){super(my,(()=>Math.random()),vB.ClassName,v)}}vB.ClassName="FGRandomBlock",(0,u.g)(vB.ClassName,vB);class yB extends Hn{constructor(v){super(Ty,Ty,my,((v,y)=>this._polymorphicDot(v,y)),yB.ClassName,v)}_polymorphicDot(v,y){switch(zn(v)){case"Vector2":return J.j.Dot(v,y);case"o":return J.n.Dot(v,y);case"Vector4":return J.p.Dot(v,y);default:throw new Error(`Cannot get dot product of ${v} and ${y}`)}}}yB.ClassName="FGDotBlock",(0,u.g)(yB.ClassName,yB);class nB extends An{constructor(v){super(my,(()=>Math.E),nB.ClassName,v)}}nB.ClassName="FGEBlock",(0,u.g)(nB.ClassName,nB);class BB extends An{constructor(v){super(my,(()=>Math.PI),BB.ClassName,v)}}BB.ClassName="FGPIBlock",(0,u.g)(BB.ClassName,BB);class JB extends An{constructor(v){super(my,(()=>Number.POSITIVE_INFINITY),JB.ClassName,v)}}JB.ClassName="FGInfBlock",(0,u.g)(JB.ClassName,JB);class PB extends An{constructor(v){super(my,(()=>Number.NaN),PB.ClassName,v)}}function bB(v,y){switch(zn(v)){case"FlowGraphInteger":return new Qy(y(v.value));case"Vector2":return new J.j(y(v.x),y(v.y));case"o":return new J.n(y(v.x),y(v.y),y(v.z));case"Vector4":return new J.p(y(v.x),y(v.y),y(v.z),y(v.w));case"Matrix":return J.d.FromValues(y(v.m[0]),y(v.m[4]),y(v.m[8]),y(v.m[12]),y(v.m[1]),y(v.m[5]),y(v.m[9]),y(v.m[13]),y(v.m[2]),y(v.m[6]),y(v.m[10]),y(v.m[14]),y(v.m[3]),y(v.m[7]),y(v.m[11]),y(v.m[15]));default:return y(v)}}PB.ClassName="FGNaNBlock",(0,u.g)(PB.ClassName,PB);class YB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicAbs(v)),YB.ClassName,v)}_polymorphicAbs(v){return bB(v,Math.abs)}}YB.ClassName="FGAbsBlock",(0,u.g)(YB.ClassName,YB);class lB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicSign(v)),lB.ClassName,v)}_polymorphicSign(v){return bB(v,Math.sign)}}lB.ClassName="FGSignBlock",(0,u.g)(lB.ClassName,lB);class aB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicTrunc(v)),aB.ClassName,v)}_polymorphicTrunc(v){return bB(v,Math.trunc)}}aB.ClassName="FGTruncBlock",(0,u.g)(aB.ClassName,aB);class ZB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicFloor(v)),ZB.ClassName,v)}_polymorphicFloor(v){return bB(v,Math.floor)}}ZB.ClassName="FGFloorBlock",(0,u.g)(ZB.ClassName,ZB);class xB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicCeiling(v)),xB.ClassName,v)}_polymorphicCeiling(v){return bB(v,Math.ceil)}}xB.ClassName="FGCeilBlock",(0,u.g)(xB.ClassName,xB);class fB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicFract(v)),fB.ClassName,v)}_polymorphicFract(v){return bB(v,(v=>v-Math.floor(v)))}}fB.ClassName="FGFractBlock",(0,u.g)(fB.ClassName,fB);class NB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicNeg(v)),NB.ClassName,v)}_polymorphicNeg(v){return bB(v,(v=>-v))}}function iB(v,y,n){switch(zn(v)){case"FlowGraphInteger":return new Qy(n(v.value,y.value));case"Vector2":return new J.j(n(v.x,y.x),n(v.y,y.y));case"o":return new J.n(n(v.x,y.x),n(v.y,y.y),n(v.z,y.z));case"Vector4":return new J.p(n(v.x,y.x),n(v.y,y.y),n(v.z,y.z),n(v.w,y.w));case"Matrix":return J.d.FromValues(n(v.m[0],y.m[0]),n(v.m[4],y.m[4]),n(v.m[8],y.m[8]),n(v.m[12],y.m[12]),n(v.m[1],y.m[1]),n(v.m[5],y.m[5]),n(v.m[9],y.m[9]),n(v.m[13],y.m[13]),n(v.m[2],y.m[2]),n(v.m[6],y.m[6]),n(v.m[10],y.m[10]),n(v.m[14],y.m[14]),n(v.m[3],y.m[3]),n(v.m[7],y.m[7]),n(v.m[11],y.m[11]),n(v.m[15],y.m[15]));default:return n(v,y)}}NB.ClassName="FGNegBlock",(0,u.g)(NB.ClassName,NB);class gB extends Hn{constructor(v){super(Ty,Ty,Ty,((v,y)=>this._polymorphicRemainder(v,y)),gB.ClassName,v)}_polymorphicRemainder(v,y){return iB(v,y,((v,y)=>v%y))}}gB.ClassName="FGRemainderBlock",(0,u.g)(gB.ClassName,gB);class cB extends Hn{constructor(v){super(Ty,Ty,Ty,((v,y)=>this._polymorphicMin(v,y)),cB.ClassName,v)}_polymorphicMin(v,y){return iB(v,y,Math.min)}}cB.ClassName="FGMinBlock",(0,u.g)(cB.ClassName,cB);class hB extends Hn{constructor(v){super(Ty,Ty,Ty,((v,y)=>this._polymorphicMax(v,y)),hB.ClassName,v)}_polymorphicMax(v,y){return iB(v,y,Math.max)}}function EB(v,y,n){return Math.min(Math.max(v,Math.min(y,n)),Math.max(y,n))}function WB(v,y,n,B){switch(zn(v)){case"FlowGraphInteger":return new Qy(B(v.value,y.value,n.value));case"Vector2":return new J.j(B(v.x,y.x,n.x),B(v.y,y.y,n.y));case"o":return new J.n(B(v.x,y.x,n.x),B(v.y,y.y,n.y),B(v.z,y.z,n.z));case"Vector4":return new J.p(B(v.x,y.x,n.x),B(v.y,y.y,n.y),B(v.z,y.z,n.z),B(v.w,y.w,n.w));case"Matrix":return J.d.FromValues(B(v.m[0],y.m[0],n.m[0]),B(v.m[4],y.m[4],n.m[4]),B(v.m[8],y.m[8],n.m[8]),B(v.m[12],y.m[12],n.m[12]),B(v.m[1],y.m[1],n.m[1]),B(v.m[5],y.m[5],n.m[5]),B(v.m[9],y.m[9],n.m[9]),B(v.m[13],y.m[13],n.m[13]),B(v.m[2],y.m[2],n.m[2]),B(v.m[6],y.m[6],n.m[6]),B(v.m[10],y.m[10],n.m[10]),B(v.m[14],y.m[14],n.m[14]),B(v.m[3],y.m[3],n.m[3]),B(v.m[7],y.m[7],n.m[7]),B(v.m[11],y.m[11],n.m[11]),B(v.m[15],y.m[15],n.m[15]));default:return B(v,y,n)}}hB.ClassName="FGMaxBlock",(0,u.g)(hB.ClassName,hB);class sB extends Un{constructor(v){super(Ty,Ty,Ty,Ty,((v,y,n)=>this._polymorphicClamp(v,y,n)),sB.ClassName,v)}_polymorphicClamp(v,y,n){return WB(v,y,n,EB)}}function CB(v){return Math.min(Math.max(v,0),1)}sB.ClassName="FGClampBlock",(0,u.g)(sB.ClassName,sB);class rB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicSaturate(v)),rB.ClassName,v)}_polymorphicSaturate(v){return bB(v,CB)}}rB.ClassName="FGSaturateBlock",(0,u.g)(rB.ClassName,rB);class uB extends Un{constructor(v){super(Ty,Ty,Ty,Ty,((v,y,n)=>this._polymorphicInterpolate(v,y,n)),uB.ClassName,v)}_interpolate(v,y,n){return(1-n)*v+n*y}_polymorphicInterpolate(v,y,n){return WB(v,y,n,this._interpolate)}}uB.ClassName="FGInterpolateBlock",(0,u.g)(uB.ClassName,uB);class OB extends Hn{constructor(v){super(Ty,Ty,vn,((v,y)=>this._polymorphicEq(v,y)),OB.ClassName,v)}_polymorphicEq(v,y){const n=zn(v),B=zn(y);return en(n,B)||Kn(n,B)||Dn(n,B)?v.equals(y):v===y}}function dB(v,y,n){const B=zn(v);if(B===zn(y)){if(""===B)return n(v,y);if("FlowGraphInteger"===B)return n(v.value,y.value);throw new Error(`Cannot compare ${v} and ${y}`)}throw new Error(`${v} and ${y} are of different types.`)}OB.ClassName="FGEqBlock",(0,u.g)(OB.ClassName,OB);class qB extends Hn{constructor(v){super(Ty,Ty,vn,((v,y)=>this._polymorphicLessThan(v,y)),qB.ClassName,v)}_polymorphicLessThan(v,y){return dB(v,y,((v,y)=>v<y))}}qB.ClassName="FGLessThanBlock",(0,u.g)(qB.ClassName,qB);class LB extends Hn{constructor(v){super(Ty,Ty,vn,((v,y)=>this._polymorphicLessThanOrEqual(v,y)),LB.ClassName,v)}_polymorphicLessThanOrEqual(v,y){return dB(v,y,((v,y)=>v<=y))}}LB.ClassName="FGLessThanOrEqualBlock";class tB extends Hn{constructor(v){super(Ty,Ty,vn,((v,y)=>this._polymorphicGreaterThan(v,y)),tB.ClassName,v)}_polymorphicGreaterThan(v,y){return dB(v,y,((v,y)=>v>y))}}tB.ClassName="FGGreaterThanBlock",(0,u.g)(tB.ClassName,tB);class GB extends Hn{constructor(v){super(Ty,Ty,vn,((v,y)=>this._polymorphicGreaterThanOrEqual(v,y)),GB.ClassName,v)}_polymorphicGreaterThanOrEqual(v,y){return dB(v,y,((v,y)=>v>=y))}}GB.ClassName="FGGreaterThanOrEqualBlock",(0,u.g)(GB.ClassName,GB);class RB extends Xn{constructor(v){super(Ty,vn,(v=>this._polymorphicIsNan(v)),RB.ClassName,v)}_polymorphicIsNan(v){const y=zn(v);if(""===y)return isNaN(v);if("FlowGraphInteger"===y)return isNaN(v.value);throw new Error(`Cannot get NaN of ${v}`)}}RB.ClassName="FGIsNanBlock",(0,u.g)(RB.ClassName,RB);class FB extends Xn{constructor(v){super(Ty,vn,(v=>this._polymorphicIsInf(v)),FB.ClassName,v)}_polymorphicIsInf(v){const y=zn(v);if(""===y)return!isFinite(v);if("FlowGraphInteger"===y)return!isFinite(v.value);throw new Error(`Cannot get isInf of ${v}`)}}FB.ClassName="FGIsInfBlock";class SB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicDegToRad(v)),SB.ClassName,v)}_degToRad(v){return v*Math.PI/180}_polymorphicDegToRad(v){return bB(v,this._degToRad)}}SB.ClassName="FGDegToRadBlock",(0,u.g)(SB.ClassName,SB);class wB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicRadToDeg(v)),wB.ClassName,v)}_radToDeg(v){return 180*v/Math.PI}_polymorphicRadToDeg(v){return bB(v,this._radToDeg)}}wB.ClassName="FGRadToDegBlock",(0,u.g)(wB.ClassName,wB);class kB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicSin(v)),kB.ClassName,v)}_polymorphicSin(v){return bB(v,Math.sin)}}kB.ClassName="FGSinBlock",(0,u.g)(kB.ClassName,kB);class MB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicCos(v)),MB.ClassName,v)}_polymorphicCos(v){return bB(v,Math.cos)}}MB.ClassName="FGCosBlock",(0,u.g)(MB.ClassName,MB);class IB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicTan(v)),IB.ClassName,v)}_polymorphicTan(v){return bB(v,Math.tan)}}IB.ClassName="FGTanBlock",(0,u.g)(IB.ClassName,IB);class jB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicAsin(v)),jB.ClassName,v)}_polymorphicAsin(v){return bB(v,Math.asin)}}jB.ClassName="FGAsinBlock",(0,u.g)(jB.ClassName,jB);class VB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicAcos(v)),VB.ClassName,v)}_polymorphicAcos(v){return bB(v,Math.acos)}}VB.ClassName="FGAcosBlock",(0,u.g)(VB.ClassName,VB);class pB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicAtan(v)),pB.ClassName,v)}_polymorphicAtan(v){return bB(v,Math.atan)}}pB.ClassName="FGAtanBlock",(0,u.g)(pB.ClassName,pB);class HB extends Hn{constructor(v){super(Ty,Ty,Ty,((v,y)=>this._polymorphicAtan2(v,y)),HB.ClassName,v)}_polymorphicAtan2(v,y){return iB(v,y,Math.atan2)}}HB.ClassName="FGAtan2Block",(0,u.g)(HB.ClassName,HB);class AB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicSinh(v)),AB.ClassName,v)}_polymorphicSinh(v){return bB(v,Math.sinh)}}AB.ClassName="FGSinhBlock",(0,u.g)(AB.ClassName,AB);class XB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicCosh(v)),XB.ClassName,v)}_polymorphicCosh(v){return bB(v,Math.cosh)}}XB.ClassName="FGCoshBlock",(0,u.g)(XB.ClassName,XB);class UB extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicTanh(v)),UB.ClassName,v)}_polymorphicTanh(v){return bB(v,Math.tanh)}}UB.ClassName="FGTanhBlock",(0,u.g)(UB.ClassName,UB);class zB extends Xn{constructor(v){super(Ty,my,(v=>this._polymorphicAsinh(v)),zB.ClassName,v)}_polymorphicAsinh(v){return bB(v,Math.asinh)}}zB.ClassName="FGAsinhBlock",(0,u.g)(zB.ClassName,zB);class eB extends Xn{constructor(v){super(Ty,my,(v=>this._polymorphicAcosh(v)),eB.ClassName,v)}_polymorphicAcosh(v){return bB(v,Math.acosh)}}eB.ClassName="FGAcoshBlock",(0,u.g)(eB.ClassName,eB);class KB extends Xn{constructor(v){super(Ty,my,(v=>this._polymorphicAtanh(v)),KB.ClassName,v)}_polymorphicAtanh(v){return bB(v,Math.atanh)}}KB.ClassName="FGAtanhBlock",(0,u.g)(KB.ClassName,KB);class DB extends Xn{constructor(v){super(Ty,my,(v=>this._polymorphicExp(v)),DB.ClassName,v)}_polymorphicExp(v){return bB(v,Math.exp)}}DB.ClassName="FGExpBlock",(0,u.g)(DB.ClassName,DB);class QB extends Xn{constructor(v){super(Ty,my,(v=>this._polymorphicLog(v)),QB.ClassName,v)}_polymorphicLog(v){return bB(v,Math.log)}}QB.ClassName="FGLogBlock",(0,u.g)(QB.ClassName,QB);class oB extends Xn{constructor(v){super(Ty,my,(v=>this._polymorphicLog2(v)),oB.ClassName,v)}_polymorphicLog2(v){return bB(v,Math.log2)}}oB.ClassName="FGLog2Block",(0,u.g)(oB.ClassName,oB);class TB extends Xn{constructor(v){super(Ty,my,(v=>this._polymorphicLog10(v)),TB.ClassName,v)}_polymorphicLog10(v){return bB(v,Math.log10)}}TB.ClassName="FGLog10Block",(0,u.g)(TB.ClassName,TB);class mB extends Xn{constructor(v){super(Ty,my,(v=>this._polymorphicSqrt(v)),mB.ClassName,v)}_polymorphicSqrt(v){return bB(v,Math.sqrt)}}mB.ClassName="FGSqrtBlock",(0,u.g)(mB.ClassName,mB);class vJ extends Xn{constructor(v){super(Ty,my,(v=>this._polymorphicCubeRoot(v)),vJ.ClassName,v)}_polymorphicCubeRoot(v){return bB(v,Math.cbrt)}}vJ.ClassName="FGCubeRootBlock",(0,u.g)(vJ.ClassName,vJ);class yJ extends Hn{constructor(v){super(Ty,my,my,((v,y)=>this._polymorphicPow(v,y)),yJ.ClassName,v)}_polymorphicPow(v,y){return iB(v,y,Math.pow)}}yJ.ClassName="FGPowBlock",(0,u.g)(yJ.ClassName,yJ);class nJ extends Xn{constructor(v){super(Ty,my,(v=>this._polymorphicLength(v)),nJ.ClassName,v)}_polymorphicLength(v){switch(zn(v)){case"Vector2":case"o":case"Vector4":return v.length();default:throw new Error(`Cannot compute length of value ${v}`)}}}nJ.ClassName="FGLengthBlock",(0,u.g)(nJ.ClassName,nJ);class BJ extends Xn{constructor(v){super(Ty,Ty,(v=>this._polymorphicNormalize(v)),BJ.ClassName,v)}_polymorphicNormalize(v){switch(zn(v)){case"Vector2":case"o":case"Vector4":return v.normalize();default:throw new Error(`Cannot normalize value ${v}`)}}}BJ.ClassName="FGNormalizeBlock",(0,u.g)(BJ.ClassName,BJ);class JJ extends Hn{constructor(v){super(nn,nn,nn,((v,y)=>J.n.Cross(v,y)),JJ.ClassName,v)}}JJ.ClassName="FGCrossBlock",(0,u.g)(JJ.ClassName,JJ);class PJ extends Hn{constructor(v){super(yn,my,yn,((v,y)=>J.j.Transform(v,J.d.RotationZ(y))),PJ.ClassName,v)}}PJ.ClassName="FGRotate2DBlock",(0,u.g)(PJ.ClassName,PJ);class bJ extends Un{constructor(v){super(nn,nn,my,nn,((v,y,n)=>J.n.TransformCoordinates(v,J.d.RotationAxis(y,n))),bJ.ClassName,v)}}bJ.ClassName="FGRotate3DBlock",(0,u.g)(bJ.ClassName,bJ);class YJ extends Xn{constructor(v){super(Bn,Bn,(v=>J.d.Transpose(v)),YJ.ClassName,v)}}YJ.ClassName="FGTransposeBlock",(0,u.g)(YJ.ClassName,YJ);class lJ extends Xn{constructor(v){super(Bn,my,(v=>v.determinant()),lJ.ClassName,v)}}lJ.ClassName="FGDeterminantBlock",(0,u.g)(lJ.ClassName,lJ);class aJ extends Xn{constructor(v){super(Bn,Bn,(v=>J.d.Invert(v)),aJ.ClassName,v)}}aJ.ClassName="FGInvertMatrixBlock",(0,u.g)(aJ.ClassName,aJ);class ZJ extends Hn{constructor(v){super(Bn,Bn,Bn,((v,y)=>y.multiply(v)),ZJ.ClassName,v)}}ZJ.ClassName="FGMatMulBlock",(0,u.g)(ZJ.ClassName,ZJ);class xJ extends Xn{constructor(v){super(Jn,Jn,(v=>new Qy(~v.value)),xJ.ClassName,v)}}xJ.ClassName="FGBitwiseNotBlock",(0,u.g)(xJ.ClassName,xJ);class fJ extends Hn{constructor(v){super(Jn,Jn,Jn,((v,y)=>new Qy(v.value&y.value)),fJ.ClassName,v)}}fJ.ClassName="FGBitwiseAndBlock",(0,u.g)(fJ.ClassName,fJ);class NJ extends Hn{constructor(v){super(Jn,Jn,Jn,((v,y)=>new Qy(v.value|y.value)),NJ.ClassName,v)}}NJ.ClassName="FGBitwiseOrBlock",(0,u.g)(NJ.ClassName,NJ);class iJ extends Hn{constructor(v){super(Jn,Jn,Jn,((v,y)=>new Qy(v.value^y.value)),iJ.ClassName,v)}}iJ.ClassName="FGBitwiseXorBlock",(0,u.g)(iJ.ClassName,iJ);class gJ extends Hn{constructor(v){super(Jn,Jn,Jn,((v,y)=>new Qy(v.value<<y.value)),gJ.ClassName,v)}}gJ.ClassName="FGBitwiseLeftShiftBlock",(0,u.g)(gJ.ClassName,gJ);class cJ extends Hn{constructor(v){super(Jn,Jn,Jn,((v,y)=>new Qy(v.value>>y.value)),cJ.ClassName,v)}}cJ.ClassName="FGBitwiseRightShiftBlock",(0,u.g)(cJ.ClassName,cJ);class hJ extends Xn{constructor(v){super(Jn,Jn,(v=>new Qy(Math.clz32(v.value))),hJ.ClassName,v)}}hJ.ClassName="FGCountLeadingZerosBlock",(0,u.g)(hJ.ClassName,hJ);class EJ extends Xn{constructor(v){super(Jn,Jn,(v=>new Qy(v.value?31-Math.clz32(v.value&-v.value):32)),EJ.ClassName,v)}}EJ.ClassName="FGCountTrailingZerosBlock",(0,u.g)(EJ.ClassName,EJ);class WJ extends Xn{constructor(v){super(Jn,Jn,(v=>new Qy(function(v){let y=0;for(;v;)y+=1&v,v>>=1;return y}(v.value))),WJ.ClassName,v)}}WJ.ClassName="FGCountOneBitsBlock",(0,u.g)(WJ.ClassName,WJ);class sJ extends qn{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new Qy(0)};super(v),this.config=v,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",Jn),this.value=this.registerDataOutput("value",Jn)}_execute(v,y){if(y===this.reset)this.value.setValue(this.config.startIndex,v);else{const y=this.value.getValue(v);y.value<this.n.getValue(v).value&&(this.value.setValue(new Qy(y.value+1),v),this.out._activateSignal(v))}}getClassName(){return sJ.ClassName}}sJ.ClassName="FGDoNBlock",(0,u.g)(sJ.ClassName,sJ);class CJ extends Zn{constructor(v){super(v),this.config=v,this.output=this.registerDataOutput(v.variableName,Ty)}_updateOutputs(v){const y=this.config.variableName;v.hasVariable(y)&&this.output.setValue(v.getVariable(y),v)}getClassName(){return CJ.ClassName}serialize(v){super.serialize(v),v.config.variableName=this.config.variableName}}CJ.ClassName="FGGetVariableBlock",(0,u.g)(CJ.ClassName,CJ);class rJ extends qn{constructor(v){super(v),this.config=v,this.input=this.registerDataInput(v.variableName,Ty)}_execute(v){const y=this.config.variableName,n=this.input.getValue(v);v.setVariable(y,n),this.out._activateSignal(v)}getClassName(){return rJ.ClassName}}rJ.ClassName="FGSetVariableBlock",(0,u.g)(rJ.ClassName,rJ);class uJ extends qn{constructor(v){super(v),this.config=v,this.condition=this.registerDataInput("condition",vn),this.loopBody=this._registerSignalOutput("loopBody")}_execute(v,y){var n;let B=this.condition.getValue(v);for(null!==(n=this.config)&&void 0!==n&&n.isDo&&!B&&this.loopBody._activateSignal(v);B;)this.loopBody._activateSignal(v),B=this.condition.getValue(v);this.out._activateSignal(v)}getClassName(){return uJ.ClassName}serialize(v){var y;super.serialize(v),v.isDo=null===(y=this.config)||void 0===y?void 0:y.isDo}}uJ.ClassName="FGWhileLoopBlock",(0,u.g)(uJ.ClassName,uJ);const OJ={"lifecycle/onStart":On.ClassName,"lifecycle/onTick":dn.ClassName,log:Ln.ClassName,"flow/delay":Gn.ClassName,"customEvent/send":Rn.ClassName,"customEvent/receive":Fn.ClassName,"flow/sequence":Sn.ClassName,"world/get":Mn.ClassName,"world/set":In.ClassName,"flow/doN":sJ.ClassName,"variable/get":CJ.ClassName,"variable/set":rJ.ClassName,"flow/whileLoop":uJ.ClassName,"math/random":vB.ClassName,"math/e":nB.ClassName,"math/pi":BB.ClassName,"math/inf":JB.ClassName,"math/nan":PB.ClassName,"math/abs":YB.ClassName,"math/sign":lB.ClassName,"math/trunc":aB.ClassName,"math/floor":ZB.ClassName,"math/ceil":xB.ClassName,"math/fract":fB.ClassName,"math/neg":NB.ClassName,"math/add":Qn.ClassName,"math/sub":on.ClassName,"math/mul":Tn.ClassName,"math/div":mn.ClassName,"math/rem":gB.ClassName,"math/min":cB.ClassName,"math/max":hB.ClassName,"math/clamp":sB.ClassName,"math/saturate":rB.ClassName,"math/mix":uB.ClassName,"math/eq":OB.ClassName,"math/lt":qB.ClassName,"math/le":LB.ClassName,"math/gt":tB.ClassName,"math/ge":GB.ClassName,"math/isnan":RB.ClassName,"math/isinf":FB.ClassName,"math/rad":SB.ClassName,"math/deg":wB.ClassName,"math/sin":kB.ClassName,"math/cos":MB.ClassName,"math/tan":IB.ClassName,"math/asin":jB.ClassName,"math/acos":VB.ClassName,"math/atan":pB.ClassName,"math/atan2":HB.ClassName,"math/sinh":AB.ClassName,"math/cosh":XB.ClassName,"math/tanh":UB.ClassName,"math/asinh":zB.ClassName,"math/acosh":eB.ClassName,"math/atanh":KB.ClassName,"math/exp":DB.ClassName,"math/log":QB.ClassName,"math/log2":oB.ClassName,"math/log10":TB.ClassName,"math/sqrt":mB.ClassName,"math/cbrt":vJ.ClassName,"math/pow":yJ.ClassName,"math/length":nJ.ClassName,"math/normalize":BJ.ClassName,"math/dot":yB.ClassName,"math/cross":JJ.ClassName,"math/rotate2d":PJ.ClassName,"math/rotate3d":bJ.ClassName,"math/transpose":YJ.ClassName,"math/determinant":lJ.ClassName,"math/inverse":aJ.ClassName,"math/matmul":ZJ.ClassName,"math/not":xJ.ClassName,"math/and":fJ.ClassName,"math/or":NJ.ClassName,"math/xor":iJ.ClassName,"math/asr":cJ.ClassName,"math/lsl":gJ.ClassName,"math/clz":hJ.ClassName,"math/ctz":EJ.ClassName,"math/popcnt":WJ.ClassName},dJ={float2:"Vector2",float3:"o",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function qJ(v,y,n){if(void 0!==v.type){const B=y.types&&y.types[v.type];if(!B)throw new Error(`${n}: Unknown type: ${v.type}`);const J=B.signature;if(!J)throw new Error(`${n}: Type ${v.type} has no signature`);const P=dJ[J];return{value:v.value,className:P}}return v.value}function LJ(v,y,n){const B=OJ[y.type];if(!B)throw new Error(`/extensions/KHR_interactivity/nodes/${v}: Unknown block type: ${y.type}`);const J=v.toString(),P=function(v,y,n){const B={},J=v.configuration??[];for(const P of J)if("customEvent"===P.id){const v=y.customEvents&&y.customEvents[P.value];if(!v)throw new Error(`/extensions/KHR_interactivity/nodes/${n}: Unknown custom event: ${P.value}`);B.eventId=v.id,B.eventData=v.values.map((v=>v.id))}else if("variable"===P.id){const v=y.variables&&y.variables[P.value];if(!v)throw new Error(`/extensions/KHR_interactivity/nodes/${n}: Unknown variable: ${P.value}`);B.variableName=v.id}else if("path"===P.id){const v=P.value;B.path=v}else B[P.id]=qJ(P,y,`/extensions/KHR_interactivity/nodes/${n}`);return B}(y,n,J);return{className:B,config:P,uniqueId:J,metadata:y.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class tJ extends uy{constructor(v){super(v,RJ)}}const GJ={__array__:{__target__:!0,translation:{type:"o",get:v=>v._babylonTransformNode.position,set:(v,y)=>{y._babylonTransformNode.position=v},getObject:v=>v._babylonTransformNode}}},RJ={nodes:GJ},FJ="KHR_interactivity";class SJ{constructor(v){this._loader=v,this.name=FJ,this.enabled=this._loader.isExtensionUsed(FJ),this._pathConverter=new tJ(this._loader.aj)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var v;if(!this._loader.babylonScene||!this._pathConverter)return;const y=this._loader.babylonScene,n=function(v){const y={uniqueId:(0,Ky.b)(),_userVariables:{},_connectionValues:{}},n=[y],B=[];for(let P=0;P<v.nodes.length;P++){const y=LJ(P,v.nodes[P],v);B.push(y)}for(let P=0;P<v.nodes.length;P++){const n=v.nodes[P],J=B[P],b=n.flows??[];for(const v of b){const y=v.id,n={uniqueId:(0,Ky.b)(),name:y,_connectionType:1,connectedPointIds:[]};J.signalOutputs.push(n);const b=v.node,Y=v.socket,l=B[b];if(!l)throw new Error(`/extensions/KHR_interactivity/nodes/${P}: Could not find node with id ${b} that connects its input with with node ${P}'s output ${y}`);let a=l.signalInputs.find((v=>v.name===Y));a||(a={uniqueId:(0,Ky.b)(),name:Y,_connectionType:0,connectedPointIds:[]},l.signalInputs.push(a)),a.connectedPointIds.push(n.uniqueId),n.connectedPointIds.push(a.uniqueId)}const Y=n.values??[];for(const l of Y){const n=l.id,b={uniqueId:(0,Ky.b)(),name:n,_connectionType:0,connectedPointIds:[]};if(J.dataInputs.push(b),void 0!==l.value){const n=qJ(l,v,`/extensions/KHR_interactivity/nodes/${P}`);y._connectionValues[b.uniqueId]=n}else{if(void 0===l.node||void 0===l.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${P}: Invalid socket ${n} in node ${P}`);{const v=l.node,y=l.socket,J=B[v];if(!J)throw new Error(`/extensions/KHR_interactivity/nodes/${P}: Could not find node with id ${v} that connects its output with node${P}'s input ${n}`);let Y=J.dataOutputs.find((v=>v.name===y));Y||(Y={uniqueId:(0,Ky.b)(),name:y,_connectionType:1,connectedPointIds:[]},J.dataOutputs.push(Y)),b.connectedPointIds.push(Y.uniqueId),Y.connectedPointIds.push(b.uniqueId)}}}}const J=v.variables??[];for(let P=0;P<J.length;P++){const n=J[P],B=n.id;y._userVariables[B]=qJ(n,v,`/extensions/KHR_interactivity/variables/${P}`)}return{allBlocks:B,executionContexts:n}}(null===(v=this._loader.aj.extensions)||void 0===v?void 0:v.KHR_interactivity),B=new un({$d:y});rn.Parse(n,{coordinator:B,pathConverter:this._pathConverter}),B.start()}}K(FJ),e(FJ,!0,(v=>new SJ(v)));const wJ="KHR_node_visibility";class kJ{constructor(v){this.name=wJ,this._loader=v,this.enabled=v.isExtensionUsed(wJ)}async onReady(){var v;null===(v=this._loader.aj.nodes)||void 0===v||v.forEach((v=>{var y,n,B,J;(null===(y=v._primitiveBabylonMeshes)||void 0===y||y.forEach((v=>{v.inheritVisibility=!0})),null!==(n=v.extensions)&&void 0!==n&&n.KHR_node_visibility)&&(!1===(null===(B=v.extensions)||void 0===B?void 0:B.KHR_node_visibility.visible)&&(v._babylonTransformNode&&(v._babylonTransformNode.isVisible=!1),null===(J=v._primitiveBabylonMeshes)||void 0===J||J.forEach((v=>{v.isVisible=!1}))))}))}dispose(){this._loader=null}}K(wJ),e(wJ,!0,(v=>new kJ(v)));const MJ="ExtrasAsMetadata";class IJ{_assignExtras(v,y){if(y.extras&&Object.keys(y.extras).length>0){const n=v.metadata=v.metadata||{};(n.aj=n.aj||{}).extras=y.extras}}constructor(v){this.name=MJ,this.enabled=!0,this._loader=v}dispose(){this._loader=null}loadNodeAsync(v,y,n){return this._loader.loadNodeAsync(v,y,(v=>{this._assignExtras(v,y),n(v)}))}loadCameraAsync(v,y,n){return this._loader.loadCameraAsync(v,y,(v=>{this._assignExtras(v,y),n(v)}))}createMaterial(v,y,n){const B=this._loader.createMaterial(v,y,n);return this._assignExtras(B,y),B}}K(MJ),e(MJ,!1,(v=>new IJ(v)))},12296:(v,y,n)=>{"use strict";n.d(y,{c:()=>R,f:()=>O,j:()=>u,n:()=>d});var B=n(10795),J=n(10791),P=n(11445),b=n(11338),Y=n(11387),l=n(11383),a=n(10801),Z=n(10820),x=n(12303),f=n(12306),N=n(11348);class i{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Ej=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.nk=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(v){this._environmentTexture=v}getNodes(){let v=[];return v=v.concat(this.meshes),v=v.concat(this.lights),v=v.concat(this.cameras),v=v.concat(this.transformNodes),this.skeletons.forEach((y=>v=v.concat(y.bones))),v}}class g extends i{}class c{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((v=>{v.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((v=>{v.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((v=>{v.dispose()})),this.animationGroups.length=0}}class h extends i{constructor(v){super(),this._wasAddedToScene=!1,(v=v||Z.b.LastCreatedScene)&&(this.$d=v,this.proceduralTextures=[],v.xj.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=v.getEngine().onContextRestoredObservable.add((()=>{for(const v of this.geometries)v._rebuild();for(const v of this.meshes)v._rebuild();for(const v of this.Ej)v.rebuild();for(const v of this.textures)v._rebuild()})))}_topologicalSort(v){const y=new Map;for(const b of v)y.set(b.uniqueId,b);const n={dependsOn:new Map,dependedBy:new Map};for(const b of v){const v=b.uniqueId;n.dependsOn.set(v,new Set),n.dependedBy.set(v,new Set)}for(const b of v){const v=b.uniqueId,B=n.dependsOn.get(v);if(b instanceof x.d){const J=b.sourceMesh;y.has(J.uniqueId)&&(B.add(J.uniqueId),n.dependedBy.get(J.uniqueId).add(v))}const J=n.dependedBy.get(v);for(const P of b.getDescendants()){const B=P.uniqueId;if(y.has(B)){J.add(B);n.dependsOn.get(B).add(v)}}}const B=[],J=[];for(const b of v){const v=b.uniqueId;0===n.dependsOn.get(v).size&&(J.push(b),y.delete(v))}const P=J;for(;P.length>0;){const v=P.shift();B.push(v);const J=n.dependedBy.get(v.uniqueId);for(const B of Array.from(J.values())){const J=n.dependsOn.get(B);J.delete(v.uniqueId),0===J.size&&y.get(B)&&(P.push(y.get(B)),y.delete(B))}}return y.size>0&&(a.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),y.forEach((v=>a.e.Error(v.name)))),B}_addNodeAndDescendantsToList(v,y,n,B){if(n&&(!B||B(n))&&!y.has(n.uniqueId)){v.push(n),y.add(n.uniqueId);for(const J of n.getDescendants(!0))this._addNodeAndDescendantsToList(v,y,J,B)}}_isNodeInContainer(v){return v instanceof l.d&&-1!==this.meshes.indexOf(v)||(v instanceof Y.e&&-1!==this.transformNodes.indexOf(v)||(v instanceof f.d&&-1!==this.lights.indexOf(v)||v instanceof N.c&&-1!==this.cameras.indexOf(v)))}_isValidHierarchy(){for(const v of this.meshes)if(v.parent&&!this._isNodeInContainer(v.parent))return a.e.Warn(`Node ${v.name} has a parent that is not in the container.`),!1;for(const v of this.transformNodes)if(v.parent&&!this._isNodeInContainer(v.parent))return a.e.Warn(`Node ${v.name} has a parent that is not in the container.`),!1;for(const v of this.lights)if(v.parent&&!this._isNodeInContainer(v.parent))return a.e.Warn(`Node ${v.name} has a parent that is not in the container.`),!1;for(const v of this.cameras)if(v.parent&&!this._isNodeInContainer(v.parent))return a.e.Warn(`Node ${v.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(v){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||J.g.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const B={},P={},Y=new c,l=[],a=[],Z={doNotInstantiate:!0,...n},x=[],f=new Set;for(const J of this.transformNodes)null===J.parent&&this._addNodeAndDescendantsToList(x,f,J,Z.predicate);for(const J of this.meshes)null===J.parent&&this._addNodeAndDescendantsToList(x,f,J,Z.predicate);const N=this._topologicalSort(x),i=(n,J)=>{if(((y,n)=>{if(B[y.uniqueId]=n.uniqueId,P[n.uniqueId]=n,v&&(n.name=v(y.name)),n instanceof b.d){const v=n;if(v.morphTargetManager){const n=y.morphTargetManager;v.morphTargetManager=n.clone();for(let y=0;y<n.numTargets;y++){const J=n.getTarget(y),b=v.morphTargetManager.getTarget(y);B[J.uniqueId]=b.uniqueId,P[b.uniqueId]=b}}}})(n,J),n.parent){const v=B[n.parent.uniqueId],y=P[v];J.parent=y||n.parent}if(J.position&&n.position&&J.position.p(n.position),J.rotationQuaternion&&n.rotationQuaternion&&J.rotationQuaternion.p(n.rotationQuaternion),J.rotation&&n.rotation&&J.rotation.p(n.rotation),J.Be&&n.Be&&J.Be.p(n.Be),J.material){const b=J;if(b.material)if(y){const y=n.material;if(-1===a.indexOf(y)){let n=y.clone(v?v(y.name):"Clone of "+y.name);if(a.push(y),B[y.uniqueId]=n.uniqueId,P[n.uniqueId]=n,"MultiMaterial"===y.getClassName()){const J=y;for(const y of J.Bg)y&&(n=y.clone(v?v(y.name):"Clone of "+y.name),a.push(y),B[y.uniqueId]=n.uniqueId,P[n.uniqueId]=n);J.Bg=J.Bg.map((v=>v&&P[B[v.uniqueId]]))}}"InstancedMesh"!==b.getClassName()&&(b.material=P[B[y.uniqueId]])}else"MultiMaterial"===b.material.getClassName()?-1===this.$d.multiMaterials.indexOf(b.material)&&this.$d.addMultiMaterial(b.material):-1===this.$d.materials.indexOf(b.material)&&this.$d.addMaterial(b.material)}null===J.parent&&Y.rootNodes.push(J)};return N.forEach((v=>{if("InstancedMesh"===v.getClassName()){const y=v,n=y.sourceMesh,J=B[n.uniqueId],b=("number"===typeof J?P[J]:n).createInstance(y.name);i(y,b)}else{let y=!0;"tb"===v.getClassName()||"Node"===v.getClassName()||v.skeleton||!v.getTotalVertices||0===v.getTotalVertices()?y=!1:Z.doNotInstantiate&&(y="function"===typeof Z.doNotInstantiate?!Z.doNotInstantiate(v):!Z.doNotInstantiate);const n=y?v.createInstance(`instance of ${v.name}`):v.clone(`Clone of ${v.name}`,null,!0);if(!n)throw new Error(`Could not clone or instantiate node on Asset Container ${v.name}`);i(v,n)}})),this.skeletons.forEach((y=>{if(Z.predicate&&!Z.predicate(y))return;const n=y.clone(v?v(y.name):"Clone of "+y.name);for(const v of this.meshes)if(v.skeleton===y&&!v.isAnInstance){const y=P[B[v.uniqueId]];if(!y||y.isAnInstance)continue;if(y.skeleton=n,-1!==l.indexOf(n))continue;l.push(n);for(const v of n.bones)v._linkedTransformNode&&(v._linkedTransformNode=P[B[v._linkedTransformNode.uniqueId]])}Y.skeletons.push(n)})),this.animationGroups.forEach((y=>{if(Z.predicate&&!Z.predicate(y))return;const n=y.clone(v?v(y.name):"Clone of "+y.name,(v=>P[B[v.uniqueId]]||v));Y.animationGroups.push(n)})),Y}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||J.g.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.$d.environmentTexture=this.environmentTexture);for(const v of this.$d._serializableComponents)v.addFromContainer(this);this.$d.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const y=[];this.cameras.forEach((n=>{v&&!v(n)||(this.$d.addCamera(n),y.push(n))})),this.lights.forEach((n=>{v&&!v(n)||(this.$d.addLight(n),y.push(n))})),this.meshes.forEach((n=>{v&&!v(n)||(this.$d.Ai(n),y.push(n))})),this.skeletons.forEach((y=>{v&&!v(y)||this.$d.addSkeleton(y)})),this.animations.forEach((y=>{v&&!v(y)||this.$d.addAnimation(y)})),this.animationGroups.forEach((y=>{v&&!v(y)||this.$d.addAnimationGroup(y)})),this.multiMaterials.forEach((y=>{v&&!v(y)||this.$d.addMultiMaterial(y)})),this.materials.forEach((y=>{v&&!v(y)||this.$d.addMaterial(y)})),this.morphTargetManagers.forEach((y=>{v&&!v(y)||this.$d.addMorphTargetManager(y)})),this.geometries.forEach((y=>{v&&!v(y)||this.$d.addGeometry(y)})),this.transformNodes.forEach((n=>{v&&!v(n)||(this.$d.addTransformNode(n),y.push(n))})),this.actionManagers.forEach((y=>{v&&!v(y)||this.$d.addActionManager(y)})),this.textures.forEach((y=>{v&&!v(y)||this.$d.addTexture(y)})),this.reflectionProbes.forEach((y=>{v&&!v(y)||this.$d.addReflectionProbe(y)}));for(const n of y)n.parent&&-1===this.$d.getNodes().indexOf(n.parent)&&(n.setParent?n.setParent(null):n.parent=null)}removeAllFromScene(){this._isValidHierarchy()||J.g.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.$d.environmentTexture&&(this.$d.environmentTexture=null);for(const v of this.$d._serializableComponents)v.removeFromContainer(this)}removeFromScene(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((y=>{v&&!v(y)||this.$d.removeCamera(y)})),this.lights.forEach((y=>{v&&!v(y)||this.$d.removeLight(y)})),this.meshes.forEach((y=>{v&&!v(y)||this.$d.sd(y,!0)})),this.skeletons.forEach((y=>{v&&!v(y)||this.$d.removeSkeleton(y)})),this.animations.forEach((y=>{v&&!v(y)||this.$d.removeAnimation(y)})),this.animationGroups.forEach((y=>{v&&!v(y)||this.$d.removeAnimationGroup(y)})),this.multiMaterials.forEach((y=>{v&&!v(y)||this.$d.removeMultiMaterial(y)})),this.materials.forEach((y=>{v&&!v(y)||this.$d.removeMaterial(y)})),this.morphTargetManagers.forEach((y=>{v&&!v(y)||this.$d.removeMorphTargetManager(y)})),this.geometries.forEach((y=>{v&&!v(y)||this.$d.removeGeometry(y)})),this.transformNodes.forEach((y=>{v&&!v(y)||this.$d.removeTransformNode(y)})),this.actionManagers.forEach((y=>{v&&!v(y)||this.$d.removeActionManager(y)})),this.textures.forEach((y=>{v&&!v(y)||this.$d.removeTexture(y)})),this.reflectionProbes.forEach((y=>{v&&!v(y)||this.$d.removeReflectionProbe(y)}))}dispose(){this.cameras.slice(0).forEach((v=>{v.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((v=>{v.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((v=>{v.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((v=>{v.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((v=>{v.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((v=>{v.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((v=>{v.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((v=>{v.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((v=>{v.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((v=>{v.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((v=>{v.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((v=>{v.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((v=>{v.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const v of this.$d._serializableComponents)v.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.$d.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(v,y,n){if(v&&y)for(const B of v){let v=!0;if(n)for(const y of n)if(B===y){v=!1;break}v&&(y.push(B),B._parentContainer=this)}}moveAllFromScene(v){this._wasAddedToScene=!1,void 0===v&&(v=new g);for(const y in this)Object.prototype.hasOwnProperty.call(this,y)&&(this[y]=this[y]||("_environmentTexture"===y?null:[]),this._moveAssets(this.$d[y],this[y],v[y]));this.environmentTexture=this.$d.environmentTexture,this.removeAllFromScene()}createRootMesh(){const v=new b.d("assetContainerRootMesh",this.$d);return this.meshes.forEach((y=>{y.parent||v.addChild(y)})),this.meshes.unshift(v),v}mergeAnimationsTo(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z.b.LastCreatedScene,y=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!v)return a.e.Error("No scene available to merge animations to"),[];const B=n||(y=>{let n=null;const B=y.animations.length?y.animations[0].targetProperty:"",J=y.name.split(".").join("").split("_primitive")[0];switch(B){case"position":case"rotationQuaternion":n=v.getTransformNodeByName(y.name)||v.getTransformNodeByName(J);break;case"influence":n=v.getMorphTargetByName(y.name)||v.getMorphTargetByName(J);break;default:n=v.getNodeByName(y.name)||v.getNodeByName(J)}return n});this.getNodes().forEach((v=>{const y=B(v);if(null!==y){for(const n of v.animations){const v=y.animations.filter((v=>v.targetProperty===n.targetProperty));for(const n of v){const v=y.animations.indexOf(n,0);v>-1&&y.animations.splice(v,1)}}y.animations=y.animations.concat(v.animations)}}));const J=[];return this.animationGroups.slice().forEach((v=>{J.push(v.clone(v.name,B)),v.animatables.forEach((v=>{v.stop()}))})),y.forEach((y=>{const n=B(y.target);n&&(v.beginAnimation(n,y.fromFrame,y.toFrame,y.loopAnimation,y.speedRatio,y.onAnimationEnd?y.onAnimationEnd:void 0,void 0,!0,void 0,y.onAnimationLoop?y.onAnimationLoop:void 0),v.stopAnimation(y.target))})),J}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((v=>{v.parent||-1!==this.rootNodes.indexOf(v)||this.rootNodes.push(v)})),this.transformNodes.forEach((v=>{v.parent||-1!==this.rootNodes.indexOf(v)||this.rootNodes.push(v)})),this.lights.forEach((v=>{v.parent||-1!==this.rootNodes.indexOf(v)||this.rootNodes.push(v)})),this.cameras.forEach((v=>{v.parent||-1!==this.rootNodes.indexOf(v)||this.rootNodes.push(v)}))}addAllAssetsToContainer(v){if(!v)return;const y=[],n=new Set;for(y.push(v);y.length>0;){const v=y.pop();if(v instanceof b.d?(v.Rj&&-1===this.geometries.indexOf(v.Rj)&&this.geometries.push(v.Rj),this.meshes.push(v)):v instanceof Y.e?this.transformNodes.push(v):v instanceof f.d?this.lights.push(v):v instanceof N.c&&this.cameras.push(v),v instanceof l.d){if(v.material&&-1===this.materials.indexOf(v.material)){this.materials.push(v.material);for(const y of v.material.getActiveTextures())-1===this.textures.indexOf(y)&&this.textures.push(y)}v.skeleton&&-1===this.skeletons.indexOf(v.skeleton)&&this.skeletons.push(v.skeleton),v.morphTargetManager&&-1===this.morphTargetManagers.indexOf(v.morphTargetManager)&&this.morphTargetManagers.push(v.morphTargetManager)}for(const B of v.getChildren())n.has(B)||y.push(B);n.add(v)}this.populateRootNodes()}}var E=n(10835);class W{constructor(v){this.byteOffset=0,this.buffer=v}loadAsync(v){return this.buffer.readAsync(this.byteOffset,v).then((v=>{this._dataView=new DataView(v.buffer,v.byteOffset,v.byteLength),this._dataByteOffset=0}))}readUint32(){const v=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,v}readUint8Array(v){const y=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,v);return this._dataByteOffset+=v,this.byteOffset+=v,y}readString(v){return(0,E.j)(this.readUint8Array(v))}skipBytes(v){this._dataByteOffset+=v,this.byteOffset+=v}}var s=n(12315);const C="Z2xURg",r={name:"aj",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:v=>-1!==v.indexOf("asset")&&-1!==v.indexOf("version")||v.startsWith("data:base64,"+C)||v.startsWith("data:;base64,"+C)||v.startsWith("data:application/octet-stream;base64,"+C)||v.startsWith("data:model/gltf-binary;base64,"+C)};var u,O,d,q=n(10828),L=n(10831);function t(v,y,n){try{return Promise.resolve(new Uint8Array(v,y,n))}catch(B){return Promise.reject(B)}}!function(v){v[v.AUTO=0]="AUTO",v[v.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(u||(u={})),function(v){v[v.NONE=0]="NONE",v[v.FIRST=1]="FIRST",v[v.ALL=2]="ALL"}(O||(O={})),function(v){v[v.LOADING=0]="LOADING",v[v.READY=1]="READY",v[v.COMPLETE=2]="COMPLETE"}(d||(d={}));class G{constructor(){this.coordinateSystemMode=u.AUTO,this.animationStartMode=O.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=v=>Promise.resolve(v),this.extensionOptions={}}p(v){v&&(this.onParsed=v.onParsed,this.coordinateSystemMode=v.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=v.animationStartMode??this.animationStartMode,this.loadNodeAnimations=v.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=v.loadSkins??this.loadSkins,this.loadMorphTargets=v.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=v.compileMaterials??this.compileMaterials,this.useClipPlane=v.useClipPlane??this.useClipPlane,this.compileShadowGenerators=v.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=v.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=v.useRangeRequests??this.useRangeRequests,this.createInstances=v.createInstances??this.createInstances,this.alwaysComputeBoundingBox=v.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=v.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=v.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=v.skipMaterials??this.skipMaterials,this.useSRGBBuffers=v.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=v.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=v.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=v.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=v.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=v.customRootNode,this.onMeshLoaded=v.onMeshLoaded,this.onSkinLoaded=v.onSkinLoaded,this.onTextureLoaded=v.onTextureLoaded,this.onMaterialLoaded=v.onMaterialLoaded,this.onCameraLoaded=v.onCameraLoaded,this.extensionOptions=v.extensionOptions??this.extensionOptions)}}class R extends G{constructor(v){super(),this.onParsedObservable=new B.e,this.onMeshLoadedObservable=new B.e,this.onSkinLoadedObservable=new B.e,this.onTextureLoadedObservable=new B.e,this.onMaterialLoadedObservable=new B.e,this.onCameraLoadedObservable=new B.e,this.onCompleteObservable=new B.e,this.onErrorObservable=new B.e,this.xj=new B.e,this.onExtensionLoadedObservable=new B.e,this.validate=!1,this.onValidatedObservable=new B.e,this._loader=null,this._state=null,this._requests=new Array,this.name=r.name,this.extensions=r.extensions,this.onLoaderStateChangedObservable=new B.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(v)}set onParsed(v){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),v&&(this._onParsedObserver=this.onParsedObservable.add(v))}set onMeshLoaded(v){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),v&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(v))}set onSkinLoaded(v){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),v&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((y=>v(y.node,y.skinnedNode))))}set onTextureLoaded(v){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),v&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(v))}set onMaterialLoaded(v){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),v&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(v))}set onCameraLoaded(v){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),v&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(v))}set onComplete(v){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(v)}set onError(v){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(v)}set onDispose(v){this._onDisposeObserver&&this.xj.remove(this._onDisposeObserver),this._onDisposeObserver=this.xj.add(v)}set onExtensionLoaded(v){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(v)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(v){this._loggingEnabled!==v&&(this._loggingEnabled=v,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(v){this._capturePerformanceCounters!==v&&(this._capturePerformanceCounters=v,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(v){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(v)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const v of this._requests)v.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=v=>Promise.resolve(v),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.xj.notifyObservers(void 0),this.xj.clear()}loadFile(v,y,n,P,b,Y,l,Z){if(ArrayBuffer.isView(y))return this._loadBinary(v,y,n,P,l,Z),null;this._progressCallback=b;const x=y.name||J.g.GetFilename(y);if(Y){if(this.useRangeRequests){this.validate&&a.e.Warn("glTF validation is not supported when range requests are enabled");const n={abort:()=>{},onCompleteObservable:new B.e},J={readAsync:(n,B)=>new Promise(((J,P)=>{this._loadFile(v,y,(v=>{J(new Uint8Array(v))}),!0,(v=>{P(v)}),(v=>{v.setRequestHeader("Range",`bytes=${n}-${n+B-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new W(J)).then((v=>{n.onCompleteObservable.notifyObservers(n),P(v)}),l?v=>l(void 0,v):void 0),n}return this._loadFile(v,y,(y=>{this._validate(v,new Uint8Array(y,0,y.byteLength),n,x),this._unpackBinaryAsync(new W({readAsync:(v,n)=>t(y,v,n),byteLength:y.byteLength})).then((v=>{P(v)}),l?v=>l(void 0,v):void 0)}),!0,l)}return this._loadFile(v,y,(y=>{try{this._validate(v,y,n,x),P({json:this._parseJson(y)})}catch{l&&l()}}),!1,l)}_loadBinary(v,y,n,B,J,P){this._validate(v,new Uint8Array(y.buffer,y.byteOffset,y.byteLength),n,P),this._unpackBinaryAsync(new W({readAsync:(v,n)=>function(v,y,n){try{if(y<0||y>=v.byteLength)throw new RangeError("Offset is out of range.");if(y+n>v.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(v.buffer,v.byteOffset+y,n))}catch(B){return Promise.reject(B)}}(y,v,n),byteLength:y.byteLength})).then((v=>{B(v)}),J?v=>J(void 0,v):void 0)}importMeshAsync(v,y,n,B,J,P){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(n),this.onParsedObservable.clear(),this._log(`Loading ${P||""}`),this._loader=this._getLoader(n),this._loader.importMeshAsync(v,y,null,n,B,J,P))))}loadAsync(v,y,n,B,J){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(y),this.onParsedObservable.clear(),this._log(`Loading ${J||""}`),this._loader=this._getLoader(y),this._loader.loadAsync(v,y,n,B,J))))}loadAssetContainerAsync(v,y,n,B,J){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(y),this.onParsedObservable.clear(),this._log(`Loading ${J||""}`),this._loader=this._getLoader(y);const P=new h(v),b=[];this.onMaterialLoadedObservable.add((v=>{b.push(v)}));const Y=[];this.onTextureLoadedObservable.add((v=>{Y.push(v)}));const l=[];this.onCameraLoadedObservable.add((v=>{l.push(v)}));const a=[];return this.onMeshLoadedObservable.add((v=>{v.morphTargetManager&&a.push(v.morphTargetManager)})),this._loader.importMeshAsync(null,v,P,y,n,B,J).then((v=>(Array.prototype.push.apply(P.geometries,v.geometries),Array.prototype.push.apply(P.meshes,v.meshes),Array.prototype.push.apply(P.Ej,v.Ej),Array.prototype.push.apply(P.skeletons,v.skeletons),Array.prototype.push.apply(P.animationGroups,v.animationGroups),Array.prototype.push.apply(P.materials,b),Array.prototype.push.apply(P.textures,Y),Array.prototype.push.apply(P.lights,v.lights),Array.prototype.push.apply(P.transformNodes,v.transformNodes),Array.prototype.push.apply(P.cameras,l),Array.prototype.push.apply(P.morphTargetManagers,a),P)))}))}canDirectLoad(v){return r.canDirectLoad(v)}directLoad(v,y){if(y.startsWith("base64,"+C)||y.startsWith(";base64,"+C)||y.startsWith("application/octet-stream;base64,"+C)||y.startsWith("model/gltf-binary;base64,"+C)){const n=(0,q.e)(y);return this._validate(v,new Uint8Array(n,0,n.byteLength)),this._unpackBinaryAsync(new W({readAsync:(v,y)=>t(n,v,y),byteLength:n.byteLength}))}return this._validate(v,y),Promise.resolve({json:this._parseJson(y)})}createPlugin(v){return new R(v[r.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((v,y)=>{this.onCompleteObservable.addOnce((()=>{v()})),this.onErrorObservable.addOnce((v=>{y(v)}))}))}_setState(v){this._state!==v&&(this._state=v,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(d[this._state]))}_loadFile(v,y,n,B,J,P){const b=v._loadFile(y,n,(v=>{this._onProgress(v,b)}),!0,B,J,P);return b.onCompleteObservable.add((()=>{b._lengthComputable=!0,b._total=b._loaded})),this._requests.push(b),b}_onProgress(v,y){if(!this._progressCallback)return;y._lengthComputable=v.lengthComputable,y._loaded=v.loaded,y._total=v.total;let n=!0,B=0,J=0;for(const P of this._requests){if(void 0===P._lengthComputable||void 0===P._loaded||void 0===P._total)return;n=n&&P._lengthComputable,B+=P._loaded,J+=P._total}this._progressCallback({lengthComputable:n,loaded:B,total:n?J:0})}_validate(v,y){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),s.c.ValidateAsync(y,n,B,(y=>this.preprocessUrlAsync(n+y).then((y=>v._loadFileAsync(y,void 0,!0,!0).then((v=>new Uint8Array(v,0,v.byteLength))))))).then((v=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(v),this.onValidatedObservable.clear()}),(v=>{this._endPerformanceCounter("Validate JSON"),J.g.Warn(`Failed to validate: ${v.message}`),this.onValidatedObservable.clear()})))}_getLoader(v){const y=v.json.asset||{};this._log(`Asset version: ${y.version}`),y.minVersion&&this._log(`Asset minimum version: ${y.minVersion}`),y.generator&&this._log(`Asset generator: ${y.generator}`);const n=R._parseVersion(y.version);if(!n)throw new Error("Invalid version: "+y.version);if(void 0!==y.minVersion){const v=R._parseVersion(y.minVersion);if(!v)throw new Error("Invalid minimum version: "+y.minVersion);if(R._compareVersion(v,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+y.minVersion)}const B={1:R._CreateGLTF1Loader,2:R._CreateGLTF2Loader}[n.major];if(!B)throw new Error("Unsupported version: "+y.version);return B(this)}_parseJson(v){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${v.length}`);const y=JSON.parse(v);return this._endPerformanceCounter("Parse JSON"),y}_unpackBinaryAsync(v){return this._startPerformanceCounter("Unpack Binary"),v.loadAsync(20).then((()=>{const y=v.readUint32();if(1179937895!==y)throw new L.j("Unexpected magic: "+y,L.f.GLTFLoaderUnexpectedMagicError);const n=v.readUint32();this.loggingEnabled&&this._log(`Binary version: ${n}`);const B=v.readUint32();let J;switch(this.useRangeRequests||B===v.buffer.byteLength||a.e.Warn(`Length in header does not match actual data length: ${B} != ${v.buffer.byteLength}`),n){case 1:J=this._unpackBinaryV1Async(v,B);break;case 2:J=this._unpackBinaryV2Async(v,B);break;default:throw new Error("Unsupported version: "+n)}return this._endPerformanceCounter("Unpack Binary"),J}))}_unpackBinaryV1Async(v,y){const n=v.readUint32(),B=v.readUint32();if(0!==B)throw new Error(`Unexpected content format: ${B}`);const J=y-v.byteOffset,P={json:this._parseJson(v.readString(n)),bin:null};if(0!==J){const y=v.byteOffset;P.bin={readAsync:(n,B)=>v.buffer.readAsync(y+n,B),byteLength:J}}return Promise.resolve(P)}_unpackBinaryV2Async(v,y){const n=1313821514,B=5130562,J=v.readUint32();if(v.readUint32()!==n)throw new Error("First chunk format is not JSON");return v.byteOffset+J===y?v.loadAsync(J).then((()=>({json:this._parseJson(v.readString(J)),bin:null}))):v.loadAsync(J+8).then((()=>{const P={json:this._parseJson(v.readString(J)),bin:null},b=()=>{const J=v.readUint32();switch(v.readUint32()){case n:throw new Error("Unexpected JSON chunk");case B:{const y=v.byteOffset;P.bin={readAsync:(n,B)=>v.buffer.readAsync(y+n,B),byteLength:J},v.skipBytes(J);break}default:v.skipBytes(J)}return v.byteOffset!==y?v.loadAsync(8).then(b):Promise.resolve(P)};return b()}))}static _parseVersion(v){if("1.0"===v||"1.0.1"===v)return{major:1,minor:0};const y=(v+"").match(/^(\d+)\.(\d+)/);return y?{major:parseInt(y[1]),minor:parseInt(y[2])}:null}static _compareVersion(v,y){return v.major>y.major?1:v.major<y.major?-1:v.minor>y.minor?1:v.minor<y.minor?-1:0}_logOpen(v){this._log(v),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(v){const y=R._logSpaces.substring(0,2*this._logIndentLevel);a.e.Log(`${y}${v}`)}_logDisabled(v){}_startPerformanceCounterEnabled(v){J.g.StartPerformanceCounter(v)}_startPerformanceCounterDisabled(v){}_endPerformanceCounterEnabled(v){J.g.EndPerformanceCounter(v)}_endPerformanceCounterDisabled(v){}}R.IncrementalLoading=!0,R.HomogeneousCoordinates=!1,R._logSpaces="                                ",(0,P.g)(new R)},12315:(v,y,n)=>{"use strict";n.d(y,{c:()=>b});var B=n(10791);function J(v,y,n,B){const J={externalResourceFunction:B};return n&&(J.uri="file:"===y?n:y+n),ArrayBuffer.isView(v)?GLTFValidator.validateBytes(v,J):GLTFValidator.validateString(v,J)}function P(){const v=[];onmessage=y=>{const n=y.data;switch(n.id){case"init":importScripts(n.url);break;case"validate":J(n.data,n.rootUrl,n.fileName,(y=>new Promise(((n,B)=>{const J=v.length;v.push({resolve:n,reject:B}),postMessage({id:"getExternalResource",index:J,uri:y})})))).then((v=>{postMessage({id:"validate.resolve",value:v})}),(v=>{postMessage({id:"validate.reject",reason:v})}));break;case"getExternalResource.resolve":v[n.index].resolve(n.value);break;case"getExternalResource.reject":v[n.index].reject(n.reason)}}}class b{static ValidateAsync(v,y,n,b){return"function"===typeof Worker?new Promise(((Y,l)=>{const a=`${J}(${P})()`,Z=URL.createObjectURL(new Blob([a],{type:"application/javascript"})),x=new Worker(Z),f=v=>{x.removeEventListener("error",f),x.removeEventListener("message",N),l(v)},N=v=>{const y=v.data;switch(y.id){case"getExternalResource":b(y.uri).then((v=>{x.postMessage({id:"getExternalResource.resolve",index:y.index,value:v},[v.buffer])}),(v=>{x.postMessage({id:"getExternalResource.reject",index:y.index,reason:v})}));break;case"validate.resolve":x.removeEventListener("error",f),x.removeEventListener("message",N),Y(y.value),x.terminate();break;case"validate.reject":x.removeEventListener("error",f),x.removeEventListener("message",N),l(y.reason),x.terminate()}};if(x.addEventListener("error",f),x.addEventListener("message",N),x.postMessage({id:"init",url:B.g.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(v)){const B=v.slice();x.postMessage({id:"validate",data:B,rootUrl:y,fileName:n},[B.buffer])}else x.postMessage({id:"validate",data:v,rootUrl:y,fileName:n})})):(this._LoadScriptPromise||(this._LoadScriptPromise=B.g.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>J(v,y,n,b))))}}b.Configuration={url:`${B.g._DefaultCdnUrl}/gltf_validator.js`}},12783:(v,y,n)=>{"use strict";n.d(y,{d:()=>u});var B=n(11050),J=n(11055),P=n(11110),b=n(11081),Y=n(11267),l=n(11275),a=n(11127),Z=n(11070),x=n(10908),f=n(10866);n(11746),n(11638),n(11654),n(11641),n(11656),n(11661),n(11668);const N="imageProcessingCompatibility",i="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";f.b.IncludesShadersStore[N]=i;const g="skyPixelShader",c="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";f.b.ShadersStore[g]=c;n(11758),n(11676),n(11682),n(11694),n(11688);const h="skyVertexShader",E="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";f.b.ShadersStore[h]=E;var W=n(11311),s=n(11262),C=n(11256);class r extends Y.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class u extends l.c{constructor(v,y){super(v,y),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new b.n(0,100,0),this.useSunPosition=!1,this.cameraOffset=b.n.Zero(),this.up=b.n.Up(),this.dithering=!1,this._cameraPosition=b.n.Zero(),this._skyOrientation=new b.g}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(v,y){const n=y._drawWrapper;if(this.isFrozen&&n.effect&&n._wasPreviouslyReady)return!0;y.materialDefines||(y.materialDefines=new r);const B=y.materialDefines,J=this.va();if(this._isReadyForSubMesh(y))return!0;if((0,C.X)(v,J,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,B),(0,C.M)(v,B,!0,!1),B.IMAGEPROCESSINGPOSTPROCESS!==J.imageProcessingConfiguration.applyByPostProcess&&B.markAsMiscDirty(),B.DITHER!==this.dithering&&B.markAsMiscDirty(),B.isDirty){B.markAsProcessed(),J.resetCachedMaterial();const v=new W.e;B.FOG&&v.addFallback(1,"FOG"),B.IMAGEPROCESSINGPOSTPROCESS=J.imageProcessingConfiguration.applyByPostProcess,B.DITHER=this.dithering;const n=[a.i.PositionKind];B.VERTEXCOLOR&&n.push(a.i.ColorKind);const P="sky",b=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,s.e)(b);const Y=B.toString();y.setEffect(J.getEngine().createEffect(P,n,b,[],Y,v,this.onCompiled,this.onError),B,this._materialContext)}return!(!y.effect||!y.effect.isReady())&&(B._renderId=J.getRenderId(),n._wasPreviouslyReady=!0,!0)}bindForSubMesh(v,y,n){const B=this.va(),J=n.materialDefines;if(!J)return;const P=n.effect;if(!P)return;this._activeEffect=P,this.bindOnlyWorldMatrix(v),this._activeEffect.setMatrix("viewProjection",B.getTransformMatrix()),this._mustRebind(B,P,n)&&((0,s.h)(P,this,B),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,C.m)(J,P,B)),B.fogEnabled&&y.applyFog&&B.fogMode!==Z.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",B.getViewMatrix()),(0,C.h)(B,y,this._activeEffect);const Y=B.activeCamera;if(Y){const v=Y.getWorldMatrix();this._cameraPosition.x=v.m[12],this._cameraPosition.y=v.m[13],this._cameraPosition.z=v.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const v=Math.PI*(this.inclination-.5),y=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(y)*Math.cos(v),this.sunPosition.y=this.distance*Math.sin(-v),this.sunPosition.z=this.distance*Math.sin(y)*Math.cos(v),b.g.FromUnitVectorsToRef(b.n.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(y,this._activeEffect,n)}getAnimatables(){return[]}dispose(v){super.dispose(v)}clone(v){return P.d.Clone((()=>new u(v,this.va())),this)}serialize(){const v=super.serialize();return v.customType="BABYLON.SkyMaterial",v}getClassName(){return"SkyMaterial"}static Parse(v,y,n){return P.d.Parse((()=>new u(v.name,y)),v,y,n)}}(0,B.c)([(0,J.M)()],u.prototype,"luminance",void 0),(0,B.c)([(0,J.M)()],u.prototype,"turbidity",void 0),(0,B.c)([(0,J.M)()],u.prototype,"rayleigh",void 0),(0,B.c)([(0,J.M)()],u.prototype,"mieCoefficient",void 0),(0,B.c)([(0,J.M)()],u.prototype,"mieDirectionalG",void 0),(0,B.c)([(0,J.M)()],u.prototype,"distance",void 0),(0,B.c)([(0,J.M)()],u.prototype,"inclination",void 0),(0,B.c)([(0,J.M)()],u.prototype,"azimuth",void 0),(0,B.c)([(0,J.I)()],u.prototype,"sunPosition",void 0),(0,B.c)([(0,J.M)()],u.prototype,"useSunPosition",void 0),(0,B.c)([(0,J.I)()],u.prototype,"cameraOffset",void 0),(0,B.c)([(0,J.I)()],u.prototype,"up",void 0),(0,B.c)([(0,J.M)()],u.prototype,"dithering",void 0),(0,x.g)("BABYLON.SkyMaterial",u)},10648:(v,y,n)=>{"use strict";function B(v,y){y.headers=v.headers||{},y.statusMessage=v.statusText,y.statusCode=v.status,y.data=v.response}function J(v,y,n){return new Promise((function(J,P){n=n||{};var b,Y,l,a=new XMLHttpRequest,Z=n.body,x=n.headers||{};for(b in n.timeout&&(a.timeout=n.timeout),a.ontimeout=a.onerror=function(v){v.timeout="timeout"==v.type,P(v)},a.open(v,y.href||y),a.onload=function(){for(l=a.getAllResponseHeaders().trim().split(/[\r\n]+/),B(a,a);Y=l.shift();)Y=Y.split(": "),a.headers[Y.shift().toLowerCase()]=Y.join(": ");if((Y=a.headers["content-type"])&&~Y.indexOf("application/json"))try{a.data=JSON.parse(a.data,n.reviver)}catch(v){return B(a,v),P(v)}(a.status>=400?P:J)(a)},typeof FormData<"u"&&Z instanceof FormData||Z&&"object"==typeof Z&&(x["content-type"]="application/json",Z=JSON.stringify(Z)),a.withCredentials=!!n.withCredentials,x)a.setRequestHeader(b,x[b]);a.send(Z)}))}n.r(y),n.d(y,{del:()=>l,get:()=>P,patch:()=>Y,post:()=>b,put:()=>a,send:()=>J});var P=J.bind(J,"GET"),b=J.bind(J,"POST"),Y=J.bind(J,"PATCH"),l=J.bind(J,"DELETE"),a=J.bind(J,"PUT")},12895:(v,y,n)=>{"use strict";n.d(y,{b:()=>x});const B=.5*(Math.sqrt(3)-1),J=(3-Math.sqrt(3))/6,P=1/3,b=1/6,Y=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20,a=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Z=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const x=class{constructor(){let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const y="function"==typeof v?v:function(v){let y=0,n=0,B=0,J=1;const P=function(){let v=4022871197;return function(y){y=y.toString();for(let n=0;n<y.length;n++){v+=y.charCodeAt(n);let B=.02519603282416938*v;v=B>>>0,B-=v,B*=v,v=B>>>0,B-=v,v+=4294967296*B}return 2.3283064365386963e-10*(v>>>0)}}();y=P(" "),n=P(" "),B=P(" "),y-=P(v),y<0&&(y+=1);n-=P(v),n<0&&(n+=1);B-=P(v),B<0&&(B+=1);return function(){const v=2091639*y+2.3283064365386963e-10*J;return y=n,n=B,B=v-(J=0|v)}}(v);this.p=function(v){const y=new Uint8Array(256);for(let n=0;n<256;n++)y[n]=n;for(let n=0;n<255;n++){const B=n+~~(v()*(256-n)),J=y[n];y[n]=y[B],y[B]=J}return y}(y),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let n=0;n<512;n++)this.perm[n]=this.p[255&n],this.permMod12[n]=this.perm[n]%12}noise2D(v,y){const n=this.permMod12,P=this.perm;let b=0,Y=0,l=0;const Z=(v+y)*B,x=Math.floor(v+Z),f=Math.floor(y+Z),N=(x+f)*J,i=v-(x-N),g=y-(f-N);let c,h;i>g?(c=1,h=0):(c=0,h=1);const E=i-c+J,W=g-h+J,s=i-1+2*J,C=g-1+2*J,r=255&x,u=255&f;let O=.5-i*i-g*g;if(O>=0){const v=3*n[r+P[u]];O*=O,b=O*O*(a[v]*i+a[v+1]*g)}let d=.5-E*E-W*W;if(d>=0){const v=3*n[r+c+P[u+h]];d*=d,Y=d*d*(a[v]*E+a[v+1]*W)}let q=.5-s*s-C*C;if(q>=0){const v=3*n[r+1+P[u+1]];q*=q,l=q*q*(a[v]*s+a[v+1]*C)}return 70*(b+Y+l)}noise3D(v,y,n){const B=this.permMod12,J=this.perm;let Y,l,Z,x;const f=(v+y+n)*P,N=Math.floor(v+f),i=Math.floor(y+f),g=Math.floor(n+f),c=(N+i+g)*b,h=v-(N-c),E=y-(i-c),W=n-(g-c);let s,C,r,u,O,d;h>=E?E>=W?(s=1,C=0,r=0,u=1,O=1,d=0):h>=W?(s=1,C=0,r=0,u=1,O=0,d=1):(s=0,C=0,r=1,u=1,O=0,d=1):E<W?(s=0,C=0,r=1,u=0,O=1,d=1):h<W?(s=0,C=1,r=0,u=0,O=1,d=1):(s=0,C=1,r=0,u=1,O=1,d=0);const q=h-s+b,L=E-C+b,t=W-r+b,G=h-u+2*b,R=E-O+2*b,F=W-d+2*b,S=h-1+.5,w=E-1+.5,k=W-1+.5,M=255&N,I=255&i,j=255&g;let V=.6-h*h-E*E-W*W;if(V<0)Y=0;else{const v=3*B[M+J[I+J[j]]];V*=V,Y=V*V*(a[v]*h+a[v+1]*E+a[v+2]*W)}let p=.6-q*q-L*L-t*t;if(p<0)l=0;else{const v=3*B[M+s+J[I+C+J[j+r]]];p*=p,l=p*p*(a[v]*q+a[v+1]*L+a[v+2]*t)}let H=.6-G*G-R*R-F*F;if(H<0)Z=0;else{const v=3*B[M+u+J[I+O+J[j+d]]];H*=H,Z=H*H*(a[v]*G+a[v+1]*R+a[v+2]*F)}let A=.6-S*S-w*w-k*k;if(A<0)x=0;else{const v=3*B[M+1+J[I+1+J[j+1]]];A*=A,x=A*A*(a[v]*S+a[v+1]*w+a[v+2]*k)}return 32*(Y+l+Z+x)}noise4D(v,y,n,B){const J=this.perm;let P,b,a,x,f;const N=(v+y+n+B)*Y,i=Math.floor(v+N),g=Math.floor(y+N),c=Math.floor(n+N),h=Math.floor(B+N),E=(i+g+c+h)*l,W=v-(i-E),s=y-(g-E),C=n-(c-E),r=B-(h-E);let u=0,O=0,d=0,q=0;W>s?u++:O++,W>C?u++:d++,W>r?u++:q++,s>C?O++:d++,s>r?O++:q++,C>r?d++:q++;const L=u>=3?1:0,t=O>=3?1:0,G=d>=3?1:0,R=q>=3?1:0,F=u>=2?1:0,S=O>=2?1:0,w=d>=2?1:0,k=q>=2?1:0,M=u>=1?1:0,I=O>=1?1:0,j=d>=1?1:0,V=q>=1?1:0,p=W-L+l,H=s-t+l,A=C-G+l,X=r-R+l,U=W-F+2*l,z=s-S+2*l,e=C-w+2*l,K=r-k+2*l,D=W-M+3*l,Q=s-I+3*l,o=C-j+3*l,T=r-V+3*l,m=W-1+4*l,vv=s-1+4*l,yv=C-1+4*l,nv=r-1+4*l,Bv=255&i,Jv=255&g,Pv=255&c,bv=255&h;let Yv=.6-W*W-s*s-C*C-r*r;if(Yv<0)P=0;else{const v=J[Bv+J[Jv+J[Pv+J[bv]]]]%32*4;Yv*=Yv,P=Yv*Yv*(Z[v]*W+Z[v+1]*s+Z[v+2]*C+Z[v+3]*r)}let lv=.6-p*p-H*H-A*A-X*X;if(lv<0)b=0;else{const v=J[Bv+L+J[Jv+t+J[Pv+G+J[bv+R]]]]%32*4;lv*=lv,b=lv*lv*(Z[v]*p+Z[v+1]*H+Z[v+2]*A+Z[v+3]*X)}let av=.6-U*U-z*z-e*e-K*K;if(av<0)a=0;else{const v=J[Bv+F+J[Jv+S+J[Pv+w+J[bv+k]]]]%32*4;av*=av,a=av*av*(Z[v]*U+Z[v+1]*z+Z[v+2]*e+Z[v+3]*K)}let Zv=.6-D*D-Q*Q-o*o-T*T;if(Zv<0)x=0;else{const v=J[Bv+M+J[Jv+I+J[Pv+j+J[bv+V]]]]%32*4;Zv*=Zv,x=Zv*Zv*(Z[v]*D+Z[v+1]*Q+Z[v+2]*o+Z[v+3]*T)}let xv=.6-m*m-vv*vv-yv*yv-nv*nv;if(xv<0)f=0;else{const v=J[Bv+1+J[Jv+1+J[Pv+1+J[bv+1]]]]%32*4;xv*=xv,f=xv*xv*(Z[v]*m+Z[v+1]*vv+Z[v+2]*yv+Z[v+3]*nv)}return 27*(P+b+a+x+f)}}}}]);