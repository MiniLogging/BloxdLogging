"use strict";(self.z22hkk7o33f=self.z22hkk7o33f||[]).push([[9],{12786:(U,G,C)=>{C.d(G,{e:()=>S,i:()=>o,n:()=>w,m:()=>q,r:()=>a});class L{constructor(){this.children=[]}isValid(U){return!0}process(U,G,C){let L="";if(this.line){let C=this.line;const T=G.processor;if(T){var X,l,t,E,K,P,O;T.lineProcessor&&(C=T.lineProcessor(C,G.isFragment,G.processingContext));const L=null!==(X=null===(l=G.processor)||void 0===l?void 0:l.attributeKeywordName)&&void 0!==X?X:"attribute",D=G.isFragment&&null!==(t=G.processor)&&void 0!==t&&t.varyingFragmentKeywordName?null===(E=G.processor)||void 0===E?void 0:E.varyingFragmentKeywordName:!G.isFragment&&null!==(K=G.processor)&&void 0!==K&&K.varyingVertexKeywordName?null===(P=G.processor)||void 0===P?void 0:P.varyingVertexKeywordName:"varying";if(!G.isFragment&&T.attributeProcessor&&this.line.startsWith(L))C=T.attributeProcessor(this.line,U,G.processingContext);else if(T.varyingProcessor&&(null!==(O=T.varyingCheck)&&void 0!==O&&O.call(T,this.line,G.isFragment)||!T.varyingCheck&&this.line.startsWith(D)))C=T.varyingProcessor(this.line,G.isFragment,U,G.processingContext);else if(T.uniformProcessor&&T.uniformRegexp&&T.uniformRegexp.test(this.line))G.lookForClosingBracketForUniformBuffer||(C=T.uniformProcessor(this.line,G.isFragment,U,G.processingContext));else if(T.uniformBufferProcessor&&T.uniformBufferRegexp&&T.uniformBufferRegexp.test(this.line))G.lookForClosingBracketForUniformBuffer||(C=T.uniformBufferProcessor(this.line,G.isFragment,G.processingContext),G.lookForClosingBracketForUniformBuffer=!0);else if(T.textureProcessor&&T.textureRegexp&&T.textureRegexp.test(this.line))C=T.textureProcessor(this.line,G.isFragment,U,G.processingContext);else if((T.uniformProcessor||T.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!G.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?T.uniformProcessor&&(C=T.uniformProcessor(this.line,G.isFragment,U,G.processingContext)):T.uniformBufferProcessor&&(C=T.uniformBufferProcessor(this.line,G.isFragment,G.processingContext),G.lookForClosingBracketForUniformBuffer=!0)}G.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(G.lookForClosingBracketForUniformBuffer=!1,T.endOfUniformBufferProcessor&&(C=T.endOfUniformBufferProcessor(this.line,G.isFragment,G.processingContext)))}L+=C+"\n"}for(const T of this.children)L+=T.process(U,G,C);return this.additionalDefineKey&&(U[this.additionalDefineKey]=this.additionalDefineValue||"true",C[this.additionalDefineKey]=U[this.additionalDefineKey]),L}}class X{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(U){this._lines.length=0;for(const G of U){if(!G||"\r"===G)continue;if("#"===G[0]){this._lines.push(G);continue}const U=G.trim();if(!U)continue;if(U.startsWith("//")){this._lines.push(G);continue}const C=U.indexOf(";");if(-1===C)this._lines.push(U);else if(C===U.length-1)U.length>1&&this._lines.push(U);else{const U=G.split(";");for(let G=0;G<U.length;G++){let C=U[G];C&&(C=C.trim(),C&&this._lines.push(C+(G!==U.length-1?";":"")))}}}}}class l extends L{process(U,G,C){for(let L=0;L<this.children.length;L++){const X=this.children[L];if(X.isValid(U))return X.process(U,G,C)}return""}}class t extends L{isValid(U){return this.testExpression.isTrue(U)}}class E{isTrue(U){return!0}static postfixToInfix(U){const G=[];for(const C of U)if(void 0===E._OperatorPriority[C])G.push(C);else{const U=G[G.length-1],L=G[G.length-2];G.length-=2,G.push("(".concat(L).concat(C).concat(U,")"))}return G[G.length-1]}static infixToPostfix(U){const G=E._InfixToPostfixCache.get(U);if(G)return G.accessTime=Date.now(),G.result;if(!U.includes("&&")&&!U.includes("||")&&!U.includes(")")&&!U.includes("("))return[U];const C=[];let L=-1;const X=()=>{O=O.trim(),""!==O&&(C.push(O),O="")},l=U=>{L<E._Stack.length-1&&(E._Stack[++L]=U)},t=()=>E._Stack[L],K=()=>-1===L?"!!INVALID EXPRESSION!!":E._Stack[L--];let P=0,O="";for(;P<U.length;){const G=U.charAt(P),T=P<U.length-1?U.substring(P,2+P):"";if("("===G)O="",l(G);else if(")"===G){for(X();-1!==L&&"("!==t();)C.push(K());K()}else if(E._OperatorPriority[T]>1){for(X();-1!==L&&E._OperatorPriority[t()]>=E._OperatorPriority[T];)C.push(K());l(T),P++}else O+=G;P++}for(X();-1!==L;)"("===t()?K():C.push(K());return E._InfixToPostfixCache.size>=E.InfixToPostfixCacheLimitSize&&E.ClearCache(),E._InfixToPostfixCache.set(U,{result:C,accessTime:Date.now()}),C}static ClearCache(){const U=Array.from(E._InfixToPostfixCache.entries()).sort(((U,G)=>U[1].accessTime-G[1].accessTime));for(let G=0;G<E.InfixToPostfixCacheCleanupSize;G++)E._InfixToPostfixCache.delete(U[G][0])}}E.InfixToPostfixCacheLimitSize=5e4,E.InfixToPostfixCacheCleanupSize=25e3,E._InfixToPostfixCache=new Map,E._OperatorPriority={")":0,"(":1,"||":2,"&&":3},E._Stack=["","","","","","","","","","","","","","","","","","","",""];class K extends E{constructor(U){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=U,this.not=G}isTrue(U){let G=void 0!==U[this.define];return this.not&&(G=!G),G}}class P extends E{isTrue(U){return this.leftOperand.isTrue(U)||this.rightOperand.isTrue(U)}}class O extends E{isTrue(U){return this.leftOperand.isTrue(U)&&this.rightOperand.isTrue(U)}}class T extends E{constructor(U,G,C){super(),this.define=U,this.operand=G,this.testValue=C}toString(){return"".concat(this.define," ").concat(this.operand," ").concat(this.testValue)}isTrue(U){let G=!1;const C=parseInt(void 0!=U[this.define]?U[this.define]:this.define),L=parseInt(void 0!=U[this.testValue]?U[this.testValue]:this.testValue);if(isNaN(C)||isNaN(L))return!1;switch(this.operand){case">":G=C>L;break;case"<":G=C<L;break;case"<=":G=C<=L;break;case">=":G=C>=L;break;case"==":G=C===L;break;case"!=":G=C!==L}return G}}var D=C(12747),y=C(12792);const V=/defined\s*?\((.+?)\)/g,p=/defined\s*?\[(.+?)\]/g,I=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,H=/__decl__/,x=/light\{X\}.(\w*)/g,h=/\{X\}/g,N=[],b=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function o(U){U.processor&&U.processor.initializeShaders&&U.processor.initializeShaders(U.processingContext)}function w(U,G,C,L){var X;null!==(X=G.processor)&&void 0!==X&&X.preProcessShaderCode&&(U=G.processor.preProcessShaderCode(U,G.isFragment)),q(U,G,(U=>{G.processCodeAfterIncludes&&(U=G.processCodeAfterIncludes(G.isFragment?"fragment":"vertex",U,G.defines));const X=function(U,G,C){let L=function(U,G){var C;if(null!==(C=G.processor)&&void 0!==C&&C.noPrecision)return U;const L=G.shouldUseHighPrecisionShader;-1===U.indexOf("precision highp float")?U=L?"precision highp float;\n"+U:"precision mediump float;\n"+U:L||(U=U.replace("precision highp float","precision mediump float"));return U}(U,G);if(!G.processor)return L;if(0===G.processor.shaderLanguage&&-1!==L.indexOf("#version 3")&&(L=L.replace("#version 300 es",""),!G.processor.parseGLES3))return L;const X=G.defines,l=F(G,C);G.processor.preProcessor&&(L=G.processor.preProcessor(L,X,l,G.isFragment,G.processingContext));const t={};L=Z(L,l,G,t),G.processor.postProcessor&&(L=G.processor.postProcessor(L,X,G.isFragment,G.processingContext,C?{drawBuffersExtensionDisabled:!C.getCaps().drawBuffersExtension}:{},l,t));null!==C&&void 0!==C&&C._features.needShaderCodeInlining&&(L=C.inlineShaderCode(L));return L}(U,G,L);C(X,U)}))}function S(U,G,C){return C.processor&&C.processor.finalizeShaders?C.processor.finalizeShaders(U,G,C.processingContext):{vertexCode:U,fragmentCode:G}}function v(U){const G=/defined\((.+)\)/.exec(U);if(G&&G.length)return new K(G[1].trim(),"!"===U[0]);const C=["==","!=",">=","<=","<",">"];let L="",X=0;for(L of C)if(X=U.indexOf(L),X>-1)break;if(-1===X)return new K(U);const l=U.substring(0,X).trim(),t=U.substring(X+L.length).trim();return new T(l,L,t)}function u(U,G){const C=new t,L=U.substring(0,G);let X=U.substring(G);return X=X.substring(0,(X.indexOf("//")+1||X.length+1)-1).trim(),C.testExpression="#ifdef"===L?new K(X):"#ifndef"===L?new K(X,!0):function(U){U=U.replace(V,"defined[$1]");const G=E.infixToPostfix(U),C=[];for(const X of G)if("||"!==X&&"&&"!==X)C.push(X);else if(C.length>=2){let U=C[C.length-1],G=C[C.length-2];C.length-=2;const L="&&"==X?new O:new P;"string"===typeof U&&(U=U.replace(p,"defined($1)")),"string"===typeof G&&(G=G.replace(p,"defined($1)")),L.leftOperand="string"===typeof G?v(G):G,L.rightOperand="string"===typeof U?v(U):U,C.push(L)}let L=C[C.length-1];return"string"===typeof L&&(L=L.replace(p,"defined($1)")),"string"===typeof L?v(L):L}(X),C}function d(U,G,C,X){let l=U.currentLine;for(;g(U,C,X);){l=U.currentLine;const t=l.substring(0,5).toLowerCase();if("#else"===t){const C=new L;return G.children.push(C),void g(U,C,X)}if("#elif"===t){const U=u(l,5);G.children.push(U),C=U}}}function g(U,G,C){for(;U.canRead;){U.lineIndex++;const X=U.currentLine;if(X.indexOf("#")>=0){const L=b.exec(X);if(L&&L.length){switch(L[0]){case"#ifdef":{const L=new l;G.children.push(L);const t=u(X,6);L.children.push(t),d(U,L,t,C);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const L=new l;G.children.push(L);const t=u(X,7);L.children.push(t),d(U,L,t,C);break}case"#if":{const L=new l,t=u(X,3);G.children.push(L),L.children.push(t),d(U,L,t,C);break}}continue}}const t=new L;if(t.line=X,G.children.push(t),"#"===X[0]&&"d"===X[1]){const U=X.replace(";","").split(" ");t.additionalDefineKey=U[1],3===U.length&&(t.additionalDefineValue=U[2])}}return!1}function Z(U,G,C,l){const t=new L,E=new X;return E.lineIndex=-1,E.lines=U.split("\n"),g(E,t,l),t.process(G,C,l)}function F(U,G){var C;const L=U.defines,X={};for(const l of L){const U=l.replace("#define","").replace(";","").trim().split(" ");X[U[0]]=U.length>1?U[1]:""}return 0===(null===(C=U.processor)||void 0===C?void 0:C.shaderLanguage)&&(X.GL_ES="true"),X.__VERSION__=U.version,X[U.platformName]="true",(0,y.k)(X,null===G||void 0===G?void 0:G.isNDCHalfZRange,null===G||void 0===G?void 0:G.gt,null===G||void 0===G?void 0:G.useExactSrgbConversions),X}function q(U,G,C){let L;for(N.length=0;null!==(L=I.exec(U));)N.push(L);let X=String(U),l=[U],t=!1;for(const E of N){let U=E[1];if(-1!==U.indexOf("__decl__")&&(U=U.replace(H,""),G.supportsUniformBuffers&&(U=U.replace("Vertex","Ubo").replace("Fragment","Ubo")),U+="Declaration"),!G.includesShadersStore[U]){const L=G.shadersRepository+"ShadersInclude/"+U+".fx";return void a.loadFile(L,(L=>{G.includesShadersStore[U]=L,q(l.join(""),G,C)}))}{let C=G.includesShadersStore[U];if(E[2]){const U=E[3].split(",");for(let G=0;G<U.length;G+=2){const L=new RegExp(U[G],"g"),X=U[G+1];C=C.replace(L,X)}}if(E[4]){const U=E[5];if(-1!==U.indexOf("..")){const L=U.split(".."),X=parseInt(L[0]);let l=parseInt(L[1]),t=C.slice(0);C="",isNaN(l)&&(l=G.indexParameters[L[1]]);for(let U=X;U<l;U++)G.supportsUniformBuffers||(t=t.replace(x,((U,G)=>G+"{X}"))),C+=t.replace(h,U.toString())+"\n"}else G.supportsUniformBuffers||(C=C.replace(x,((U,G)=>G+"{X}"))),C=C.replace(h,U)}const L=[];for(const U of l){const G=U.split(E[0]);for(let U=0;U<G.length-1;U++)L.push(G[U]),L.push(C);L.push(G[G.length-1])}l=L,t=t||C.indexOf("#include<")>=0||C.indexOf("#include <")>=0}}N.length=0,X=l.join(""),t?q(X.toString(),G,C):C(X)}const a={loadFile:(U,G,C,L,X,l)=>{throw(0,D.d)("FileTools")}}},12792:(U,G,C)=>{C.d(G,{e:()=>X,g:()=>l,k:()=>E,m:()=>t,q:()=>K});var L=C(12747);C(12725);const X={};function l(U,G){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(G?G+"\n":"")+U}function t(U,G,C,l,t,E,K){const P=K||X.loadFile;if(P){return P(U,G,C,l,t,E)}throw(0,L.d)("FileTools")}function E(U,G,C,L){if(U)return G?U.IS_NDC_HALF_ZRANGE="":delete U.IS_NDC_HALF_ZRANGE,C?U.USE_REVERSE_DEPTHBUFFER="":delete U.USE_REVERSE_DEPTHBUFFER,void(L?U.USE_EXACT_SRGB_CONVERSIONS="":delete U.USE_EXACT_SRGB_CONVERSIONS);{let U="";return G&&(U+="#define IS_NDC_HALF_ZRANGE"),C&&(U&&(U+="\n"),U+="#define USE_REVERSE_DEPTHBUFFER"),L&&(U&&(U+="\n"),U+="#define USE_EXACT_SRGB_CONVERSIONS"),U}}function K(U,G){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],L=arguments.length>3?arguments[3]:void 0;switch(U){case 3:{const U=(ArrayBuffer,new Int8Array(G));return L&&U.set(new Int8Array(L)),U}case 0:{const U=(ArrayBuffer,new Uint8Array(G));return L&&U.set(new Uint8Array(L)),U}case 4:{const U=G instanceof ArrayBuffer?new Int16Array(G):new Int16Array(C?G/2:G);return L&&U.set(new Int16Array(L)),U}case 5:case 8:case 9:case 10:case 2:{const U=G instanceof ArrayBuffer?new Uint16Array(G):new Uint16Array(C?G/2:G);return L&&U.set(new Uint16Array(L)),U}case 6:{const U=G instanceof ArrayBuffer?new Int32Array(G):new Int32Array(C?G/4:G);return L&&U.set(new Int32Array(L)),U}case 7:case 11:case 12:case 13:case 14:case 15:{const U=G instanceof ArrayBuffer?new Uint32Array(G):new Uint32Array(C?G/4:G);return L&&U.set(new Uint32Array(L)),U}case 1:{const U=G instanceof ArrayBuffer?new Float32Array(G):new Float32Array(C?G/4:G);return L&&U.set(new Float32Array(L)),U}}const X=(ArrayBuffer,new Uint8Array(G));return L&&X.set(new Uint8Array(L)),X}},12808:(U,G,C)=>{C.d(G,{d:()=>L});class L{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?L.ShadersRepository:L.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?L.ShadersStore:L.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?L.IncludesShadersStore:L.IncludesShadersStoreWGSL}}L.ShadersRepository="src/Shaders/",L.ShadersStore={},L.IncludesShadersStore={},L.ShadersRepositoryWGSL="src/ShadersWGSL/",L.ShadersStoreWGSL={},L.IncludesShadersStoreWGSL={}},12813:(U,G,C)=>{C.d(G,{c:()=>D,f:()=>h,i:()=>V,j:()=>y,l:()=>p,o:()=>x,q:()=>T,u:()=>P,y:()=>O,z:()=>K,B:()=>E});class L{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.VG._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(U){U&&this.program&&U(this.program)}setEngine(U){this.VG=U}_fillEffectInformation(U,G,C,L,X,l,t,E){const K=this.VG;if(K.supportsUniformBuffers)for(const O in G)U.bindUniformBlock(O,G[O]);let P;for(this.VG.getUniforms(this,C).forEach(((U,G)=>{L[C[G]]=U})),this._uniforms=L,P=0;P<X.length;P++){null==U.getUniform(X[P])&&(X.splice(P,1),P--)}X.forEach(((U,G)=>{l[U]=G}));for(const O of K.getAttributes(this,t))E.push(O)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(U,G){const C=this._valueCache[U],L=G.updateFlag;return(void 0===C||C!==L)&&(this._valueCache[U]=L,!0)}_cacheFloat2(U,G,C){let L=this._valueCache[U];if(!L||2!==L.length)return L=[G,C],this._valueCache[U]=L,!0;let X=!1;return L[0]!==G&&(L[0]=G,X=!0),L[1]!==C&&(L[1]=C,X=!0),X}_cacheFloat3(U,G,C,L){let X=this._valueCache[U];if(!X||3!==X.length)return X=[G,C,L],this._valueCache[U]=X,!0;let l=!1;return X[0]!==G&&(X[0]=G,l=!0),X[1]!==C&&(X[1]=C,l=!0),X[2]!==L&&(X[2]=L,l=!0),l}_cacheFloat4(U,G,C,L,X){let l=this._valueCache[U];if(!l||4!==l.length)return l=[G,C,L,X],this._valueCache[U]=l,!0;let t=!1;return l[0]!==G&&(l[0]=G,t=!0),l[1]!==C&&(l[1]=C,t=!0),l[2]!==L&&(l[2]=L,t=!0),l[3]!==X&&(l[3]=X,t=!0),t}setInt(U,G){const C=this._valueCache[U];void 0!==C&&C===G||this.VG.setInt(this._uniforms[U],G)&&(this._valueCache[U]=G)}setInt2(U,G,C){this._cacheFloat2(U,G,C)&&(this.VG.setInt2(this._uniforms[U],G,C)||(this._valueCache[U]=null))}setInt3(U,G,C,L){this._cacheFloat3(U,G,C,L)&&(this.VG.setInt3(this._uniforms[U],G,C,L)||(this._valueCache[U]=null))}setInt4(U,G,C,L,X){this._cacheFloat4(U,G,C,L,X)&&(this.VG.setInt4(this._uniforms[U],G,C,L,X)||(this._valueCache[U]=null))}setIntArray(U,G){this._valueCache[U]=null,this.VG.setIntArray(this._uniforms[U],G)}setIntArray2(U,G){this._valueCache[U]=null,this.VG.setIntArray2(this._uniforms[U],G)}setIntArray3(U,G){this._valueCache[U]=null,this.VG.setIntArray3(this._uniforms[U],G)}setIntArray4(U,G){this._valueCache[U]=null,this.VG.setIntArray4(this._uniforms[U],G)}setUInt(U,G){const C=this._valueCache[U];void 0!==C&&C===G||this.VG.setUInt(this._uniforms[U],G)&&(this._valueCache[U]=G)}setUInt2(U,G,C){this._cacheFloat2(U,G,C)&&(this.VG.setUInt2(this._uniforms[U],G,C)||(this._valueCache[U]=null))}setUInt3(U,G,C,L){this._cacheFloat3(U,G,C,L)&&(this.VG.setUInt3(this._uniforms[U],G,C,L)||(this._valueCache[U]=null))}setUInt4(U,G,C,L,X){this._cacheFloat4(U,G,C,L,X)&&(this.VG.setUInt4(this._uniforms[U],G,C,L,X)||(this._valueCache[U]=null))}setUIntArray(U,G){this._valueCache[U]=null,this.VG.setUIntArray(this._uniforms[U],G)}setUIntArray2(U,G){this._valueCache[U]=null,this.VG.setUIntArray2(this._uniforms[U],G)}setUIntArray3(U,G){this._valueCache[U]=null,this.VG.setUIntArray3(this._uniforms[U],G)}setUIntArray4(U,G){this._valueCache[U]=null,this.VG.setUIntArray4(this._uniforms[U],G)}setArray(U,G){this._valueCache[U]=null,this.VG.setArray(this._uniforms[U],G)}setArray2(U,G){this._valueCache[U]=null,this.VG.setArray2(this._uniforms[U],G)}setArray3(U,G){this._valueCache[U]=null,this.VG.setArray3(this._uniforms[U],G)}setArray4(U,G){this._valueCache[U]=null,this.VG.setArray4(this._uniforms[U],G)}setMatrices(U,G){G&&(this._valueCache[U]=null,this.VG.setMatrices(this._uniforms[U],G))}setMatrix(U,G){this._cacheMatrix(U,G)&&(this.VG.setMatrices(this._uniforms[U],G.sE())||(this._valueCache[U]=null))}setMatrix3x3(U,G){this._valueCache[U]=null,this.VG.setMatrix3x3(this._uniforms[U],G)}setMatrix2x2(U,G){this._valueCache[U]=null,this.VG.setMatrix2x2(this._uniforms[U],G)}setFloat(U,G){const C=this._valueCache[U];void 0!==C&&C===G||this.VG.setFloat(this._uniforms[U],G)&&(this._valueCache[U]=G)}setVector2(U,G){this._cacheFloat2(U,G.x,G.y)&&(this.VG.setFloat2(this._uniforms[U],G.x,G.y)||(this._valueCache[U]=null))}setFloat2(U,G,C){this._cacheFloat2(U,G,C)&&(this.VG.setFloat2(this._uniforms[U],G,C)||(this._valueCache[U]=null))}setVector3(U,G){this._cacheFloat3(U,G.x,G.y,G.z)&&(this.VG.setFloat3(this._uniforms[U],G.x,G.y,G.z)||(this._valueCache[U]=null))}setFloat3(U,G,C,L){this._cacheFloat3(U,G,C,L)&&(this.VG.setFloat3(this._uniforms[U],G,C,L)||(this._valueCache[U]=null))}setVector4(U,G){this._cacheFloat4(U,G.x,G.y,G.z,G.w)&&(this.VG.setFloat4(this._uniforms[U],G.x,G.y,G.z,G.w)||(this._valueCache[U]=null))}setQuaternion(U,G){this._cacheFloat4(U,G.x,G.y,G.z,G.w)&&(this.VG.setFloat4(this._uniforms[U],G.x,G.y,G.z,G.w)||(this._valueCache[U]=null))}setFloat4(U,G,C,L,X){this._cacheFloat4(U,G,C,L,X)&&(this.VG.setFloat4(this._uniforms[U],G,C,L,X)||(this._valueCache[U]=null))}setColor3(U,G){this._cacheFloat3(U,G.r,G.g,G.b)&&(this.VG.setFloat3(this._uniforms[U],G.r,G.g,G.b)||(this._valueCache[U]=null))}setColor4(U,G,C){this._cacheFloat4(U,G.r,G.g,G.b,C)&&(this.VG.setFloat4(this._uniforms[U],G.r,G.g,G.b,C)||(this._valueCache[U]=null))}setDirectColor4(U,G){this._cacheFloat4(U,G.r,G.g,G.b,G.a)&&(this.VG.setFloat4(this._uniforms[U],G.r,G.g,G.b,G.a)||(this._valueCache[U]=null))}_getVertexShaderCode(){return this.vertexShader?this.VG._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.VG._getShaderSource(this.fragmentShader):null}}var X=C(12792);const l=new WeakMap,t={_webGLVersion:2,cachedPipelines:{}};function E(U){let G=l.get(U);if(!G){if(!U)return t;G={_webGLVersion:U.TEXTURE_BINDING_3D?2:1,_context:U,parallelShaderCompile:U.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},l.set(U,G)}return G}function K(U){l.delete(U)}function P(U,G,C,L,X,l){const t=E(L);var K;l||(l=null!==(K=t._createShaderProgramInjection)&&void 0!==K?K:D);return l(U,H(G,"vertex",L,t._contextWasLost),H(C,"fragment",L,t._contextWasLost),L,X,t.validateShaderPrograms)}function O(U,G,C,L,X){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6?arguments[6]:void 0;const K=E(X);var P;t||(t=null!==(P=K._createShaderProgramInjection)&&void 0!==P?P:D);const O=K._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return t(U,I(G,"vertex",L,O,X,K._contextWasLost),I(C,"fragment",L,O,X,K._contextWasLost),X,l,K.validateShaderPrograms)}function T(U,G){const C=new L,X=E(U);return X.parallelShaderCompile&&!X.disableParallelShaderCompile&&(C.isParallelCompiled=!0),C.context=X._context,C}function D(U,G,C,L){let X=arguments.length>5?arguments[5]:void 0;const l=L.createProgram();if(U.program=l,!l)throw new Error("Unable to create program");return L.attachShader(l,G),L.attachShader(l,C),L.linkProgram(l),U.context=L,U.vertexShader=G,U.fragmentShader=C,U.isParallelCompiled||V(U,L,X),l}function y(U,G,C){const L=U;if(L._isDisposed)return!1;const X=E(G);return!!(X&&X.parallelShaderCompile&&X.parallelShaderCompile.COMPLETION_STATUS_KHR&&L.program&&G.getProgramParameter(L.program,X.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(V(L,G,C),!0)}function V(U,G,C){const L=U.context,X=U.vertexShader,l=U.fragmentShader,t=U.program;if(!L.getProgramParameter(t,L.LINK_STATUS)){if(!G.getShaderParameter(X,G.COMPILE_STATUS)){const C=G.getShaderInfoLog(X);if(C)throw U.vertexCompilationError=C,new Error("VERTEX SHADER "+C)}if(!G.getShaderParameter(l,G.COMPILE_STATUS)){const C=G.getShaderInfoLog(l);if(C)throw U.fragmentCompilationError=C,new Error("FRAGMENT SHADER "+C)}const C=L.getProgramInfoLog(t);if(C)throw U.programLinkError=C,new Error(C)}if(C){L.validateProgram(t);if(!L.getProgramParameter(t,L.VALIDATE_STATUS)){const G=L.getProgramInfoLog(t);if(G)throw U.programValidationError=G,new Error(G)}}L.deleteShader(X),L.deleteShader(l),U.vertexShader=void 0,U.fragmentShader=void 0,U.onCompiled&&(U.onCompiled(),U.onCompiled=void 0)}function p(U,G,C,L,X,l,t,K,T){let D=arguments.length>10?arguments[10]:void 0,y=arguments.length>11?arguments[11]:void 0,V=arguments.length>12?arguments[12]:void 0;const p=E(U.context);var I,H;y||(y=null!==(I=p.createRawShaderProgramInjection)&&void 0!==I?I:P);V||(V=null!==(H=p.createShaderProgramInjection)&&void 0!==H?H:O);const x=U;x.program=L?y(x,G,C,x.context,T):V(x,G,C,K,x.context,T),x.program.__SPECTOR_rebuildProgram=t,D()}function I(U,G,C,L,l,t){return H((0,X.g)(U,C,L),G,l,t)}function H(U,G,C,L){const X=C.createShader("vertex"===G?C.VERTEX_SHADER:C.FRAGMENT_SHADER);if(!X){let U=C.NO_ERROR,X=C.NO_ERROR;for(;(X=C.getError())!==C.NO_ERROR;)U=X;throw new Error("Something went wrong while creating a gl ".concat(G," shader object. gl error=").concat(U,", gl isContextLost=").concat(C.isContextLost(),", _contextWasLost=").concat(L))}return C.shaderSource(X,U),C.compileShader(X),X}function x(U,G){G.useProgram(U)}function h(U,G){const C=U;if(!C.isParallelCompiled)return void G(U);const L=C.onCompiled;C.onCompiled=()=>{null===L||void 0===L||L(),G(U)}}},12810:(U,G,C)=>{C.d(G,{c:()=>T,d:()=>y,h:()=>P,l:()=>O});var L=C(12725),X=C(12813),l=C(12808),t=C(12731),E=C(12786),K=C(12792);function P(U,G){return(0,X.B)(G).cachedPipelines[U]}function O(U){const G=U._name,C=U.context;if(G&&C){const U=(0,X.B)(C),L=U.cachedPipelines[G];null===L||void 0===L||L.dispose(),delete U.cachedPipelines[G]}}function T(U,G,C,X,l,t,K){let P,O;const T=(0,L.k)()?null===t||void 0===t?void 0:t.getHostDocument():null;P="string"===typeof G?G:G.vertexSource?"source:"+G.vertexSource:G.vertexElement?(null===T||void 0===T?void 0:T.getElementById(G.vertexElement))||G.vertexElement:G.vertex||G,O="string"===typeof G?G:G.fragmentSource?"source:"+G.fragmentSource:G.fragmentElement?(null===T||void 0===T?void 0:T.getElementById(G.fragmentElement))||G.fragmentElement:G.fragment||G;const y=[void 0,void 0],V=()=>{if(y[0]&&y[1]){U.isFragment=!0;const[L,P]=y;(0,E.n)(P,U,((t,P)=>{K&&(K._fragmentSourceCodeBeforeMigration=P),C&&(t=C("fragment",t));const O=(0,E.e)(L,t,U);U=null;const T=function(U,G,C,L){if(C){return{vertexSourceCode:(1===L?"//":"")+"#define SHADER_NAME vertex:"+(C.vertexElement||C.vertex||C.spectorName||C)+"\n"+U,fragmentSourceCode:(1===L?"//":"")+"#define SHADER_NAME fragment:"+(C.fragmentElement||C.fragment||C.spectorName||C)+"\n"+G}}return{vertexSourceCode:U,fragmentSourceCode:G}}(O.vertexCode,O.fragmentCode,G,l);null===X||void 0===X||X(T.vertexSourceCode,T.fragmentSourceCode)}),t)}};D(P,"Vertex","",(G=>{(0,E.i)(U),(0,E.n)(G,U,((U,L)=>{K&&(K._rawVertexSourceCode=G,K._vertexSourceCodeBeforeMigration=L),C&&(U=C("vertex",U)),y[0]=U,V()}),t)}),l),D(O,"Fragment","Pixel",(U=>{K&&(K._rawFragmentSourceCode=U),y[1]=U,V()}),l)}function D(U,G,C,X,t,E){if("undefined"!==typeof HTMLElement&&U instanceof HTMLElement){return void X((0,L.c)(U))}if("source:"===U.substring(0,7))return void X(U.substring(7));if("base64:"===U.substring(0,7)){return void X(window.atob(U.substring(7)))}const P=l.d.GetShadersStore(t);if(P[U+G+"Shader"])return void X(P[U+G+"Shader"]);if(C&&P[U+C+"Shader"])return void X(P[U+C+"Shader"]);let O;if(O="."===U[0]||"/"===U[0]||U.indexOf("http")>-1?U:l.d.GetShadersRepository(t)+U,!(E=E||K.m))throw new Error("loadFileInjection is not defined");E(O+"."+G.toLowerCase()+".fx",X)}const y=(U,G,C,L)=>{try{const l=U.context?(0,X.B)(U.context):null;l&&(l.disableParallelShaderCompile=U.disableParallelCompilation);const t=U.existingPipelineContext||G(U.shaderProcessingContext);return t._name=U.name,U.name&&l&&(l.cachedPipelines[U.name]=t),C(t,U.vertex,U.fragment,!!U.createAsRaw,"","",U.rebuildRebind,U.defines,U.transformFeedbackVaryings,"",(()=>{L(t,(()=>{var G;null===(G=U.onRenderingStateCompiled)||void 0===G||G.call(U,t)}))})),t}catch(l){throw t.d.Error("Error compiling effect"),l}}},12805:(U,G,C)=>{C.r(G),C.d(G,{Effect:()=>K});var L=C(12721),X=C(12731),l=C(12808),t=C(12810),E=C(12794);class K{static get ShadersRepository(){return l.d.ShadersRepository}static set ShadersRepository(U){l.d.ShadersRepository=U}get t(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new L.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(U,G,C){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,O=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,D=arguments.length>9?arguments[9]:void 0,y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",V=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,p=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new L.e,this.onErrorObservable=new L.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=U,this._key=y;const I=this._key.replace(/\r/g,"").replace(/\n/g,"|");let H;if(G.attributes){var x,h,N;const U=G;if(this._engine=C,this._attributesNames=U.attributes,this._uniformsNames=U.uniformsNames.concat(U.samplers),this._samplerList=U.samplers.slice(),this.defines=U.defines,this.onError=U.onError,this.onCompiled=U.onCompiled,this._fallbacks=U.fallbacks,this._indexParameters=U.indexParameters,this._transformFeedbackVaryings=U.transformFeedbackVaryings||null,this._multiTarget=!!U.multiTarget,this._shaderLanguage=null!==(x=U.shaderLanguage)&&void 0!==x?x:0,this._disableParallelShaderCompilation=!!U.disableParallelShaderCompilation,U.uniformBuffersNames){this._uniformBuffersNamesList=U.uniformBuffersNames.slice();for(let G=0;G<U.uniformBuffersNames.length;G++)this._uniformBuffersNames[U.uniformBuffersNames[G]]=G}this._processFinalCode=null!==(h=U.processFinalCode)&&void 0!==h?h:null,this._processCodeAfterIncludes=null!==(N=U.processCodeAfterIncludes)&&void 0!==N?N:void 0,p=U.extraInitializationsAsync,H=U.existingPipelineContext}else this._engine=l,this.defines=null==E?"":E,this._uniformsNames=C.concat(X),this._samplerList=X?X.slice():[],this._attributesNames=G,this._uniformBuffersNamesList=[],this._shaderLanguage=V,this.onError=T,this.onCompiled=O,this._indexParameters=D,this._fallbacks=P;var b;"WEBGL2"===this._engine.shaderPlatformName&&(H=null!==(b=(0,t.h)(I,this._engine._gl))&&void 0!==b?b:H);this._attributeLocationByName={},this.uniqueId=K._UniqueIdSeed++,H?(this._pipelineContext=H,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,p),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.t||this.dispose(!0)}))}async _processShaderCodeAsync(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3?arguments[3]:void 0;L&&await L(),this._processingContext=C||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const X={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:null!==U&&void 0!==U?U:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:l.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:l.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,gt:this._engine.gt,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,t.c)(X,this.name,this._processFinalCode,((U,C)=>{this._vertexSourceCode=U,this._fragmentSourceCode=C,this._prepareEffect(G)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch(U){return!1}}_isReadyInternal(){return!!this._engine.t||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(U){return this._attributes[U]}getAttributeLocationByName(U){return this._attributeLocationByName[U]}getAttributesCount(){return this._attributes.length}getUniformIndex(U){return this._uniformsNames.indexOf(U)}getUniform(U){return this._uniforms[U]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((U=>{this.executeWhenCompiled(U)}))}executeWhenCompiled(U){this.isReady()?U(this):(this.onCompileObservable.add((G=>{U(G)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(U){(0,E.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(G=>{this._processCompilationErrors(G,U)}),16,12e4,!0," - Effect: ".concat("string"===typeof this.name?this.name:this.key))}get vertexSourceCode(){var U,G;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:null!==(U=null===(G=this._pipelineContext)||void 0===G?void 0:G._getVertexShaderCode())&&void 0!==U?U:this._vertexSourceCode}get fragmentSourceCode(){var U,G;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:null!==(U=null===(G=this._pipelineContext)||void 0===G?void 0:G._getFragmentShaderCode())&&void 0!==U?U:this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,gt:this._engine.gt,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(U,G,C,L){this._isReady=!1,this._vertexSourceCodeOverride=U,this._fragmentSourceCodeOverride=G,this.onError=(U,G)=>{L&&L(G)},this.onCompiled=()=>{var U,G;const L=this.getEngine().scenes;if(L)for(let C=0;C<L.length;C++)L[C].markAllMaterialsAsDirty(127);null===(U=(G=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===U||U.call(G,C)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(U){if(this._pipelineContext=U,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let G=0;G<this._attributesNames.length;G++){const U=this._attributesNames[G];this._attributeLocationByName[U]=this._attributes[G]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),K.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G=this._pipelineContext;this._isReady=!1;try{const C=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),L=C?null:this.defines,X=C?this._vertexSourceCodeOverride:this._vertexSourceCode,l=C?this._fragmentSourceCodeOverride:this._fragmentSourceCode,E=this._engine;this._pipelineContext=(0,t.d)({existingPipelineContext:U?G:null,vertex:X,fragment:l,context:"WEBGL2"===E.shaderPlatformName||"WEBGL1"===E.shaderPlatformName?E._gl:void 0,rebuildRebind:(U,G,C,L)=>this._rebuildProgram(U,G,C,L),defines:L,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:C,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:C=>{G&&!U&&this._engine._deletePipelineContext(G),C&&this._onRenderingStateCompiled(C)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(G)}catch(C){this._processCompilationErrors(C,G)}}_getShaderCodeAndErrorLine(U,G,C){const L=C?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let X=null;if(G&&U){const l=G.match(L);if(l&&2===l.length){const G=parseInt(l[1]),L=U.split("\n",-1);L.length>=G&&(X="Offending line [".concat(G,"] in ").concat(C?"fragment":"vertex"," code: ").concat(L[G-1]))}}return[U,X]}_processCompilationErrors(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=U.message;const C=this._attributesNames,L=this._fallbacks;if(X.d.Error("Unable to compile effect:"),X.d.Error("Uniforms: ".concat(this._uniformsNames.join(" "))),X.d.Error("Attributes: ".concat(C.join(" "))),X.d.Error("Defines:\n"+this.defines),K.LogShaderCodeOnCompilationError){var l,t;let U=null,G=null,C=null;var E;if(null!==(l=this._pipelineContext)&&void 0!==l&&l._getVertexShaderCode()&&([C,U]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),C&&(X.d.Error("Vertex code:"),X.d.Error(C))),null!==(t=this._pipelineContext)&&void 0!==t&&t._getFragmentShaderCode())[C,G]=this._getShaderCodeAndErrorLine(null===(E=this._pipelineContext)||void 0===E?void 0:E._getFragmentShaderCode(),this._compilationError,!0),C&&(X.d.Error("Fragment code:"),X.d.Error(C));U&&X.d.Error(U),G&&X.d.Error(G)}X.d.Error("Error: "+this._compilationError);const P=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};G&&(this._pipelineContext=G,this._isReady=!0,P()),L?(this._pipelineContext=null,L.hasMoreFallbacks?(this._allFallbacksProcessed=!1,X.d.Error("Trying next fallback."),this.defines=L.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,P(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,G||P())}get isSupported(){return""===this._compilationError}_bindTexture(U,G){this._engine._bindTexture(this._samplers[U],G,U)}setTexture(U,G){this._engine.setTexture(this._samplers[U],this._uniforms[U],G,U)}setTextureArray(U,G){const C=U+"Ex";if(-1===this._samplerList.indexOf(C+"0")){const L=this._samplerList.indexOf(U);for(let U=1;U<G.length;U++){const G=C+(U-1).toString();this._samplerList.splice(L+U,0,G)}let X=0;for(const U of this._samplerList)this._samplers[U]=X,X+=1}this._engine.setTextureArray(this._samplers[U],this._uniforms[U],G,U)}bindUniformBuffer(U,G){const C=this._uniformBuffersNames[G];void 0===C||K._BaseCache[C]===U&&this._engine._features.useUBOBindingCache||(K._BaseCache[C]=U,this._engine.bindUniformBufferBase(U,C,G))}bindUniformBlock(U,G){this._engine.bindUniformBlock(this._pipelineContext,U,G)}setInt(U,G){return this._pipelineContext.setInt(U,G),this}setInt2(U,G,C){return this._pipelineContext.setInt2(U,G,C),this}setInt3(U,G,C,L){return this._pipelineContext.setInt3(U,G,C,L),this}setInt4(U,G,C,L,X){return this._pipelineContext.setInt4(U,G,C,L,X),this}setIntArray(U,G){return this._pipelineContext.setIntArray(U,G),this}setIntArray2(U,G){return this._pipelineContext.setIntArray2(U,G),this}setIntArray3(U,G){return this._pipelineContext.setIntArray3(U,G),this}setIntArray4(U,G){return this._pipelineContext.setIntArray4(U,G),this}setUInt(U,G){return this._pipelineContext.setUInt(U,G),this}setUInt2(U,G,C){return this._pipelineContext.setUInt2(U,G,C),this}setUInt3(U,G,C,L){return this._pipelineContext.setUInt3(U,G,C,L),this}setUInt4(U,G,C,L,X){return this._pipelineContext.setUInt4(U,G,C,L,X),this}setUIntArray(U,G){return this._pipelineContext.setUIntArray(U,G),this}setUIntArray2(U,G){return this._pipelineContext.setUIntArray2(U,G),this}setUIntArray3(U,G){return this._pipelineContext.setUIntArray3(U,G),this}setUIntArray4(U,G){return this._pipelineContext.setUIntArray4(U,G),this}setFloatArray(U,G){return this._pipelineContext.setArray(U,G),this}setFloatArray2(U,G){return this._pipelineContext.setArray2(U,G),this}setFloatArray3(U,G){return this._pipelineContext.setArray3(U,G),this}setFloatArray4(U,G){return this._pipelineContext.setArray4(U,G),this}setArray(U,G){return this._pipelineContext.setArray(U,G),this}setArray2(U,G){return this._pipelineContext.setArray2(U,G),this}setArray3(U,G){return this._pipelineContext.setArray3(U,G),this}setArray4(U,G){return this._pipelineContext.setArray4(U,G),this}setMatrices(U,G){return this._pipelineContext.setMatrices(U,G),this}setMatrix(U,G){return this._pipelineContext.setMatrix(U,G),this}setMatrix3x3(U,G){return this._pipelineContext.setMatrix3x3(U,G),this}setMatrix2x2(U,G){return this._pipelineContext.setMatrix2x2(U,G),this}setFloat(U,G){return this._pipelineContext.setFloat(U,G),this}setBool(U,G){return this._pipelineContext.setInt(U,G?1:0),this}setVector2(U,G){return this._pipelineContext.setVector2(U,G),this}setFloat2(U,G,C){return this._pipelineContext.setFloat2(U,G,C),this}setVector3(U,G){return this._pipelineContext.setVector3(U,G),this}setFloat3(U,G,C,L){return this._pipelineContext.setFloat3(U,G,C,L),this}setVector4(U,G){return this._pipelineContext.setVector4(U,G),this}setQuaternion(U,G){return this._pipelineContext.setQuaternion(U,G),this}setFloat4(U,G,C,L,X){return this._pipelineContext.setFloat4(U,G,C,L,X),this}setColor3(U,G){return this._pipelineContext.setColor3(U,G),this}setColor4(U,G,C){return this._pipelineContext.setColor4(U,G,C),this}setDirectColor4(U,G){return this._pipelineContext.setDirectColor4(U,G),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(K.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,t.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;G&&(l.d.GetShadersStore(L)["".concat(U,"PixelShader")]=G),C&&(l.d.GetShadersStore(L)["".concat(U,"VertexShader")]=C)}static ResetCache(){K._BaseCache={}}}K.LogShaderCodeOnCompilationError=!0,K.PersistentMode=!1,K.AutomaticallyClearCodeCache=!1,K._UniqueIdSeed=0,K._BaseCache={},K.ShadersStore=l.d.ShadersStore,K.IncludesShadersStore=l.d.IncludesShadersStore},12747:(U,G,C)=>{C.d(G,{d:()=>X});const L={};function X(U){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!L[U])return L[U]=!0,"".concat(U," needs to be imported before as it contains a side-effect required by your code.")}},12725:(U,G,C)=>{function L(){return"undefined"!==typeof window}function X(){return"undefined"!==typeof navigator}function l(){return"undefined"!==typeof document}function t(U){let G="",C=U.firstChild;for(;C;)3===C.nodeType&&(G+=C.textContent),C=C.nextSibling;return G}C.d(G,{c:()=>t,e:()=>l,g:()=>X,k:()=>L})},12731:(U,G,C)=>{C.d(G,{d:()=>L});class L{static _CheckLimit(U,G){let C=L._LogLimitOutputs[U];return C?C.current++:(C={limit:G,current:1},L._LogLimitOutputs[U]=C),C.current<=C.limit}static _GenerateLimitMessage(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const C=L._LogLimitOutputs[U];if(!C||!L.MessageLimitReached)return;const X=this._Levels[G];var l;C.current===C.limit&&L[X.name](L.MessageLimitReached.replace(/%LIMIT%/g,""+C.limit).replace(/%TYPE%/g,null!==(l=X.name)&&void 0!==l?l:""))}static _AddLogEntry(U){L._LogCache=U+L._LogCache,L.OnNewCacheEntry&&L.OnNewCacheEntry(U)}static _FormatMessage(U){const G=U=>U<10?"0"+U:""+U,C=new Date;return"["+G(C.getHours())+":"+G(C.getMinutes())+":"+G(C.getSeconds())+"]: "+U}static _LogDisabled(U,G){}static _LogEnabled(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,G=arguments.length>1?arguments[1]:void 0,C=arguments.length>2?arguments[2]:void 0;const X=Array.isArray(G)?G[0]:G;if(void 0!==C&&!L._CheckLimit(X,C))return;const l=L._FormatMessage(X),t=this._Levels[U],E=Array.isArray(G)?G.slice(1):[];t.logFunc&&t.logFunc("BJS - "+l,...E);const K="<div style='color:".concat(t.color,"'>").concat(l,"</div><br>");L._AddLogEntry(K),L._GenerateLimitMessage(X,U)}static get LogCache(){return L._LogCache}static ClearLogCache(){L._LogCache="",L._LogLimitOutputs={},L.errorsCount=0}static set LogLevels(U){L.Log=L._LogDisabled,L.Warn=L._LogDisabled,L.Error=L._LogDisabled;const G=[L.MessageLogLevel,L.WarningLogLevel,L.ErrorLogLevel];for(const C of G)if((U&C)===C){const U=this._Levels[C];L[U.name]=L._LogEnabled.bind(L,C)}}}L.NoneLogLevel=0,L.MessageLogLevel=1,L.WarningLogLevel=2,L.ErrorLogLevel=4,L.AllLogLevel=7,L.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",L._LogCache="",L._LogLimitOutputs={},L._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],L.errorsCount=0,L.Log=L._LogEnabled.bind(L,L.MessageLogLevel),L.Warn=L._LogEnabled.bind(L,L.WarningLogLevel),L.Error=L._LogEnabled.bind(L,L.ErrorLogLevel)},12721:(U,G,C)=>{C.d(G,{e:()=>t});const L="undefined"!==typeof WeakRef;class X{constructor(U){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2?arguments[2]:void 0,L=arguments.length>3?arguments[3]:void 0;this.initialize(U,G,C,L)}initialize(U){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2?arguments[2]:void 0,L=arguments.length>3?arguments[3]:void 0;return this.mask=U,this.skipNextObservers=G,this.target=C,this.currentTarget=L,this}}class l{constructor(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=U,this.mask=G,this.scope=C,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(U)}}class t{static FromPromise(U,G){const C=new t;return U.then((U=>{C.notifyObservers(U)})).catch((U=>{if(!G)throw U;G.notifyObservers(U)})),C}get observers(){return this._observers}constructor(U){let G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=G,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new X(0),U&&(this._onObserverAdded=U)}add(U){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!U)return null;const X=new l(U,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);X.unregisterOnNextCall=C,G?this._observers.unshift(X):this._observers.push(X),this._onObserverAdded&&this._onObserverAdded(X),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(X,this._lastNotifiedValue);const t=L?new WeakRef(this):{deref:()=>this};return X._remove=function(){let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const G=t.deref();G&&(U?G.remove(X):G._remove(X))},X}addOnce(U){return this.add(U,void 0,void 0,void 0,!0)}remove(U){if(!U)return!1;U._remove=null;return-1!==this._observers.indexOf(U)&&(this._deferUnregister(U),!0)}removeCallback(U,G){for(let C=0;C<this._observers.length;C++){const L=this._observers[C];if(!L._willBeUnregistered&&(L.callback===U&&(!G||G===L.scope)))return this._deferUnregister(L),!0}return!1}_deferUnregister(U){U._willBeUnregistered||(this._numObserversMarkedAsDeleted++,U.unregisterOnNextCall=!1,U._willBeUnregistered=!0,setTimeout((()=>{this._remove(U)}),0))}_remove(U){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!U)return!1;const C=this._observers.indexOf(U);return-1!==C&&(G&&this._numObserversMarkedAsDeleted--,this._observers.splice(C,1),!0)}makeObserverTopPriority(U){this._remove(U,!1),this._observers.unshift(U)}makeObserverBottomPriority(U){this._remove(U,!1),this._observers.push(U)}notifyObservers(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,C=arguments.length>2?arguments[2]:void 0,L=arguments.length>3?arguments[3]:void 0,X=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=U),!this._observers.length)return!0;const l=this._eventState;l.mask=G,l.target=C,l.currentTarget=L,l.skipNextObservers=!1,l.lastReturnValue=U,l.userInfo=X;for(const t of this._observers)if(!t._willBeUnregistered&&(t.mask&G&&(t.unregisterOnNextCall&&this._deferUnregister(t),t.scope?l.lastReturnValue=t.callback.apply(t.scope,[U,l]):l.lastReturnValue=t.callback(U,l)),l.skipNextObservers))return!1;return!0}notifyObserver(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=G),U._willBeUnregistered)return;const L=this._eventState;L.mask=C,L.skipNextObservers=!1,U.unregisterOnNextCall&&this._deferUnregister(U),U.callback(G,L)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const U=this._observers.pop();U&&(U._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const U=new t;return U._observers=this._observers.slice(0),U}hasSpecificMask(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const G of this._observers)if(G.mask&U||G.mask===U)return!0;return!1}}},12794:(U,G,C)=>{C.d(G,{b:()=>X,f:()=>t});let L=[];class X{static SetImmediate(U){0===L.length&&setTimeout((()=>{const U=L;L=[];for(const G of U)G()}),1),L.push(U)}}function l(U,G,C){try{if(U())return G(),!0}catch(L){return null===C||void 0===C||C(L),!0}return!1}const t=function(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,t=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&l(U,G,C))return null;const E=setInterval((()=>{l(U,G,C)?clearInterval(E):(X-=L,X<0&&(clearInterval(E),null===C||void 0===C||C(new Error("Operation timed out after maximum retries. "+(t||"")),!0)))}),L);return()=>clearInterval(E)}}}]);